(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))r(s);new MutationObserver(s=>{for(const i of s)if(i.type==="childList")for(const o of i.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&r(o)}).observe(document,{childList:!0,subtree:!0});function t(s){const i={};return s.integrity&&(i.integrity=s.integrity),s.referrerPolicy&&(i.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?i.credentials="include":s.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function r(s){if(s.ep)return;s.ep=!0;const i=t(s);fetch(s.href,i)}})();function ZD(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}var Sb={exports:{}},zp={},bb={exports:{}},Ue={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var bd=Symbol.for("react.element"),e2=Symbol.for("react.portal"),t2=Symbol.for("react.fragment"),n2=Symbol.for("react.strict_mode"),r2=Symbol.for("react.profiler"),s2=Symbol.for("react.provider"),i2=Symbol.for("react.context"),o2=Symbol.for("react.forward_ref"),a2=Symbol.for("react.suspense"),l2=Symbol.for("react.memo"),c2=Symbol.for("react.lazy"),_E=Symbol.iterator;function u2(n){return n===null||typeof n!="object"?null:(n=_E&&n[_E]||n["@@iterator"],typeof n=="function"?n:null)}var Ab={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},Cb=Object.assign,Rb={};function ec(n,e,t){this.props=n,this.context=e,this.refs=Rb,this.updater=t||Ab}ec.prototype.isReactComponent={};ec.prototype.setState=function(n,e){if(typeof n!="object"&&typeof n!="function"&&n!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,n,e,"setState")};ec.prototype.forceUpdate=function(n){this.updater.enqueueForceUpdate(this,n,"forceUpdate")};function Nb(){}Nb.prototype=ec.prototype;function xv(n,e,t){this.props=n,this.context=e,this.refs=Rb,this.updater=t||Ab}var Tv=xv.prototype=new Nb;Tv.constructor=xv;Cb(Tv,ec.prototype);Tv.isPureReactComponent=!0;var vE=Array.isArray,Pb=Object.prototype.hasOwnProperty,Sv={current:null},kb={key:!0,ref:!0,__self:!0,__source:!0};function Db(n,e,t){var r,s={},i=null,o=null;if(e!=null)for(r in e.ref!==void 0&&(o=e.ref),e.key!==void 0&&(i=""+e.key),e)Pb.call(e,r)&&!kb.hasOwnProperty(r)&&(s[r]=e[r]);var a=arguments.length-2;if(a===1)s.children=t;else if(1<a){for(var l=Array(a),u=0;u<a;u++)l[u]=arguments[u+2];s.children=l}if(n&&n.defaultProps)for(r in a=n.defaultProps,a)s[r]===void 0&&(s[r]=a[r]);return{$$typeof:bd,type:n,key:i,ref:o,props:s,_owner:Sv.current}}function d2(n,e){return{$$typeof:bd,type:n.type,key:e,ref:n.ref,props:n.props,_owner:n._owner}}function bv(n){return typeof n=="object"&&n!==null&&n.$$typeof===bd}function h2(n){var e={"=":"=0",":":"=2"};return"$"+n.replace(/[=:]/g,function(t){return e[t]})}var wE=/\/+/g;function bg(n,e){return typeof n=="object"&&n!==null&&n.key!=null?h2(""+n.key):e.toString(36)}function rf(n,e,t,r,s){var i=typeof n;(i==="undefined"||i==="boolean")&&(n=null);var o=!1;if(n===null)o=!0;else switch(i){case"string":case"number":o=!0;break;case"object":switch(n.$$typeof){case bd:case e2:o=!0}}if(o)return o=n,s=s(o),n=r===""?"."+bg(o,0):r,vE(s)?(t="",n!=null&&(t=n.replace(wE,"$&/")+"/"),rf(s,e,t,"",function(u){return u})):s!=null&&(bv(s)&&(s=d2(s,t+(!s.key||o&&o.key===s.key?"":(""+s.key).replace(wE,"$&/")+"/")+n)),e.push(s)),1;if(o=0,r=r===""?".":r+":",vE(n))for(var a=0;a<n.length;a++){i=n[a];var l=r+bg(i,a);o+=rf(i,e,t,l,s)}else if(l=u2(n),typeof l=="function")for(n=l.call(n),a=0;!(i=n.next()).done;)i=i.value,l=r+bg(i,a++),o+=rf(i,e,t,l,s);else if(i==="object")throw e=String(n),Error("Objects are not valid as a React child (found: "+(e==="[object Object]"?"object with keys {"+Object.keys(n).join(", ")+"}":e)+"). If you meant to render a collection of children, use an array instead.");return o}function Th(n,e,t){if(n==null)return n;var r=[],s=0;return rf(n,r,"","",function(i){return e.call(t,i,s++)}),r}function f2(n){if(n._status===-1){var e=n._result;e=e(),e.then(function(t){(n._status===0||n._status===-1)&&(n._status=1,n._result=t)},function(t){(n._status===0||n._status===-1)&&(n._status=2,n._result=t)}),n._status===-1&&(n._status=0,n._result=e)}if(n._status===1)return n._result.default;throw n._result}var zn={current:null},sf={transition:null},p2={ReactCurrentDispatcher:zn,ReactCurrentBatchConfig:sf,ReactCurrentOwner:Sv};function Ob(){throw Error("act(...) is not supported in production builds of React.")}Ue.Children={map:Th,forEach:function(n,e,t){Th(n,function(){e.apply(this,arguments)},t)},count:function(n){var e=0;return Th(n,function(){e++}),e},toArray:function(n){return Th(n,function(e){return e})||[]},only:function(n){if(!bv(n))throw Error("React.Children.only expected to receive a single React element child.");return n}};Ue.Component=ec;Ue.Fragment=t2;Ue.Profiler=r2;Ue.PureComponent=xv;Ue.StrictMode=n2;Ue.Suspense=a2;Ue.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=p2;Ue.act=Ob;Ue.cloneElement=function(n,e,t){if(n==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+n+".");var r=Cb({},n.props),s=n.key,i=n.ref,o=n._owner;if(e!=null){if(e.ref!==void 0&&(i=e.ref,o=Sv.current),e.key!==void 0&&(s=""+e.key),n.type&&n.type.defaultProps)var a=n.type.defaultProps;for(l in e)Pb.call(e,l)&&!kb.hasOwnProperty(l)&&(r[l]=e[l]===void 0&&a!==void 0?a[l]:e[l])}var l=arguments.length-2;if(l===1)r.children=t;else if(1<l){a=Array(l);for(var u=0;u<l;u++)a[u]=arguments[u+2];r.children=a}return{$$typeof:bd,type:n.type,key:s,ref:i,props:r,_owner:o}};Ue.createContext=function(n){return n={$$typeof:i2,_currentValue:n,_currentValue2:n,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},n.Provider={$$typeof:s2,_context:n},n.Consumer=n};Ue.createElement=Db;Ue.createFactory=function(n){var e=Db.bind(null,n);return e.type=n,e};Ue.createRef=function(){return{current:null}};Ue.forwardRef=function(n){return{$$typeof:o2,render:n}};Ue.isValidElement=bv;Ue.lazy=function(n){return{$$typeof:c2,_payload:{_status:-1,_result:n},_init:f2}};Ue.memo=function(n,e){return{$$typeof:l2,type:n,compare:e===void 0?null:e}};Ue.startTransition=function(n){var e=sf.transition;sf.transition={};try{n()}finally{sf.transition=e}};Ue.unstable_act=Ob;Ue.useCallback=function(n,e){return zn.current.useCallback(n,e)};Ue.useContext=function(n){return zn.current.useContext(n)};Ue.useDebugValue=function(){};Ue.useDeferredValue=function(n){return zn.current.useDeferredValue(n)};Ue.useEffect=function(n,e){return zn.current.useEffect(n,e)};Ue.useId=function(){return zn.current.useId()};Ue.useImperativeHandle=function(n,e,t){return zn.current.useImperativeHandle(n,e,t)};Ue.useInsertionEffect=function(n,e){return zn.current.useInsertionEffect(n,e)};Ue.useLayoutEffect=function(n,e){return zn.current.useLayoutEffect(n,e)};Ue.useMemo=function(n,e){return zn.current.useMemo(n,e)};Ue.useReducer=function(n,e,t){return zn.current.useReducer(n,e,t)};Ue.useRef=function(n){return zn.current.useRef(n)};Ue.useState=function(n){return zn.current.useState(n)};Ue.useSyncExternalStore=function(n,e,t){return zn.current.useSyncExternalStore(n,e,t)};Ue.useTransition=function(){return zn.current.useTransition()};Ue.version="18.3.1";bb.exports=Ue;var L=bb.exports;const m2=ZD(L);/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var g2=L,y2=Symbol.for("react.element"),_2=Symbol.for("react.fragment"),v2=Object.prototype.hasOwnProperty,w2=g2.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,I2={key:!0,ref:!0,__self:!0,__source:!0};function Mb(n,e,t){var r,s={},i=null,o=null;t!==void 0&&(i=""+t),e.key!==void 0&&(i=""+e.key),e.ref!==void 0&&(o=e.ref);for(r in e)v2.call(e,r)&&!I2.hasOwnProperty(r)&&(s[r]=e[r]);if(n&&n.defaultProps)for(r in e=n.defaultProps,e)s[r]===void 0&&(s[r]=e[r]);return{$$typeof:y2,type:n,key:i,ref:o,props:s,_owner:w2.current}}zp.Fragment=_2;zp.jsx=Mb;zp.jsxs=Mb;Sb.exports=zp;var d=Sb.exports,Ny={},Lb={exports:{}},Tr={},Vb={exports:{}},Fb={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(n){function e($,G){var J=$.length;$.push(G);e:for(;0<J;){var he=J-1>>>1,pe=$[he];if(0<s(pe,G))$[he]=G,$[J]=pe,J=he;else break e}}function t($){return $.length===0?null:$[0]}function r($){if($.length===0)return null;var G=$[0],J=$.pop();if(J!==G){$[0]=J;e:for(var he=0,pe=$.length,Te=pe>>>1;he<Te;){var dt=2*(he+1)-1,At=$[dt],xe=dt+1,Ke=$[xe];if(0>s(At,J))xe<pe&&0>s(Ke,At)?($[he]=Ke,$[xe]=J,he=xe):($[he]=At,$[dt]=J,he=dt);else if(xe<pe&&0>s(Ke,J))$[he]=Ke,$[xe]=J,he=xe;else break e}}return G}function s($,G){var J=$.sortIndex-G.sortIndex;return J!==0?J:$.id-G.id}if(typeof performance=="object"&&typeof performance.now=="function"){var i=performance;n.unstable_now=function(){return i.now()}}else{var o=Date,a=o.now();n.unstable_now=function(){return o.now()-a}}var l=[],u=[],h=1,f=null,p=3,y=!1,I=!1,C=!1,P=typeof setTimeout=="function"?setTimeout:null,A=typeof clearTimeout=="function"?clearTimeout:null,T=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function R($){for(var G=t(u);G!==null;){if(G.callback===null)r(u);else if(G.startTime<=$)r(u),G.sortIndex=G.expirationTime,e(l,G);else break;G=t(u)}}function D($){if(C=!1,R($),!I)if(t(l)!==null)I=!0,le(F);else{var G=t(u);G!==null&&Be(D,G.startTime-$)}}function F($,G){I=!1,C&&(C=!1,A(_),_=-1),y=!0;var J=p;try{for(R(G),f=t(l);f!==null&&(!(f.expirationTime>G)||$&&!S());){var he=f.callback;if(typeof he=="function"){f.callback=null,p=f.priorityLevel;var pe=he(f.expirationTime<=G);G=n.unstable_now(),typeof pe=="function"?f.callback=pe:f===t(l)&&r(l),R(G)}else r(l);f=t(l)}if(f!==null)var Te=!0;else{var dt=t(u);dt!==null&&Be(D,dt.startTime-G),Te=!1}return Te}finally{f=null,p=J,y=!1}}var k=!1,E=null,_=-1,b=5,v=-1;function S(){return!(n.unstable_now()-v<b)}function N(){if(E!==null){var $=n.unstable_now();v=$;var G=!0;try{G=E(!0,$)}finally{G?w():(k=!1,E=null)}}else k=!1}var w;if(typeof T=="function")w=function(){T(N)};else if(typeof MessageChannel<"u"){var B=new MessageChannel,Ee=B.port2;B.port1.onmessage=N,w=function(){Ee.postMessage(null)}}else w=function(){P(N,0)};function le($){E=$,k||(k=!0,w())}function Be($,G){_=P(function(){$(n.unstable_now())},G)}n.unstable_IdlePriority=5,n.unstable_ImmediatePriority=1,n.unstable_LowPriority=4,n.unstable_NormalPriority=3,n.unstable_Profiling=null,n.unstable_UserBlockingPriority=2,n.unstable_cancelCallback=function($){$.callback=null},n.unstable_continueExecution=function(){I||y||(I=!0,le(F))},n.unstable_forceFrameRate=function($){0>$||125<$?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):b=0<$?Math.floor(1e3/$):5},n.unstable_getCurrentPriorityLevel=function(){return p},n.unstable_getFirstCallbackNode=function(){return t(l)},n.unstable_next=function($){switch(p){case 1:case 2:case 3:var G=3;break;default:G=p}var J=p;p=G;try{return $()}finally{p=J}},n.unstable_pauseExecution=function(){},n.unstable_requestPaint=function(){},n.unstable_runWithPriority=function($,G){switch($){case 1:case 2:case 3:case 4:case 5:break;default:$=3}var J=p;p=$;try{return G()}finally{p=J}},n.unstable_scheduleCallback=function($,G,J){var he=n.unstable_now();switch(typeof J=="object"&&J!==null?(J=J.delay,J=typeof J=="number"&&0<J?he+J:he):J=he,$){case 1:var pe=-1;break;case 2:pe=250;break;case 5:pe=1073741823;break;case 4:pe=1e4;break;default:pe=5e3}return pe=J+pe,$={id:h++,callback:G,priorityLevel:$,startTime:J,expirationTime:pe,sortIndex:-1},J>he?($.sortIndex=J,e(u,$),t(l)===null&&$===t(u)&&(C?(A(_),_=-1):C=!0,Be(D,J-he))):($.sortIndex=pe,e(l,$),I||y||(I=!0,le(F))),$},n.unstable_shouldYield=S,n.unstable_wrapCallback=function($){var G=p;return function(){var J=p;p=G;try{return $.apply(this,arguments)}finally{p=J}}}})(Fb);Vb.exports=Fb;var E2=Vb.exports;/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var x2=L,wr=E2;function H(n){for(var e="https://reactjs.org/docs/error-decoder.html?invariant="+n,t=1;t<arguments.length;t++)e+="&args[]="+encodeURIComponent(arguments[t]);return"Minified React error #"+n+"; visit "+e+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var jb=new Set,Du={};function ma(n,e){Il(n,e),Il(n+"Capture",e)}function Il(n,e){for(Du[n]=e,n=0;n<e.length;n++)jb.add(e[n])}var zs=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),Py=Object.prototype.hasOwnProperty,T2=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,IE={},EE={};function S2(n){return Py.call(EE,n)?!0:Py.call(IE,n)?!1:T2.test(n)?EE[n]=!0:(IE[n]=!0,!1)}function b2(n,e,t,r){if(t!==null&&t.type===0)return!1;switch(typeof e){case"function":case"symbol":return!0;case"boolean":return r?!1:t!==null?!t.acceptsBooleans:(n=n.toLowerCase().slice(0,5),n!=="data-"&&n!=="aria-");default:return!1}}function A2(n,e,t,r){if(e===null||typeof e>"u"||b2(n,e,t,r))return!0;if(r)return!1;if(t!==null)switch(t.type){case 3:return!e;case 4:return e===!1;case 5:return isNaN(e);case 6:return isNaN(e)||1>e}return!1}function qn(n,e,t,r,s,i,o){this.acceptsBooleans=e===2||e===3||e===4,this.attributeName=r,this.attributeNamespace=s,this.mustUseProperty=t,this.propertyName=n,this.type=e,this.sanitizeURL=i,this.removeEmptyString=o}var Tn={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(n){Tn[n]=new qn(n,0,!1,n,null,!1,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(n){var e=n[0];Tn[e]=new qn(e,1,!1,n[1],null,!1,!1)});["contentEditable","draggable","spellCheck","value"].forEach(function(n){Tn[n]=new qn(n,2,!1,n.toLowerCase(),null,!1,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(n){Tn[n]=new qn(n,2,!1,n,null,!1,!1)});"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(n){Tn[n]=new qn(n,3,!1,n.toLowerCase(),null,!1,!1)});["checked","multiple","muted","selected"].forEach(function(n){Tn[n]=new qn(n,3,!0,n,null,!1,!1)});["capture","download"].forEach(function(n){Tn[n]=new qn(n,4,!1,n,null,!1,!1)});["cols","rows","size","span"].forEach(function(n){Tn[n]=new qn(n,6,!1,n,null,!1,!1)});["rowSpan","start"].forEach(function(n){Tn[n]=new qn(n,5,!1,n.toLowerCase(),null,!1,!1)});var Av=/[\-:]([a-z])/g;function Cv(n){return n[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(n){var e=n.replace(Av,Cv);Tn[e]=new qn(e,1,!1,n,null,!1,!1)});"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(n){var e=n.replace(Av,Cv);Tn[e]=new qn(e,1,!1,n,"http://www.w3.org/1999/xlink",!1,!1)});["xml:base","xml:lang","xml:space"].forEach(function(n){var e=n.replace(Av,Cv);Tn[e]=new qn(e,1,!1,n,"http://www.w3.org/XML/1998/namespace",!1,!1)});["tabIndex","crossOrigin"].forEach(function(n){Tn[n]=new qn(n,1,!1,n.toLowerCase(),null,!1,!1)});Tn.xlinkHref=new qn("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1);["src","href","action","formAction"].forEach(function(n){Tn[n]=new qn(n,1,!1,n.toLowerCase(),null,!0,!0)});function Rv(n,e,t,r){var s=Tn.hasOwnProperty(e)?Tn[e]:null;(s!==null?s.type!==0:r||!(2<e.length)||e[0]!=="o"&&e[0]!=="O"||e[1]!=="n"&&e[1]!=="N")&&(A2(e,t,s,r)&&(t=null),r||s===null?S2(e)&&(t===null?n.removeAttribute(e):n.setAttribute(e,""+t)):s.mustUseProperty?n[s.propertyName]=t===null?s.type===3?!1:"":t:(e=s.attributeName,r=s.attributeNamespace,t===null?n.removeAttribute(e):(s=s.type,t=s===3||s===4&&t===!0?"":""+t,r?n.setAttributeNS(r,e,t):n.setAttribute(e,t))))}var ei=x2.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,Sh=Symbol.for("react.element"),Ka=Symbol.for("react.portal"),Qa=Symbol.for("react.fragment"),Nv=Symbol.for("react.strict_mode"),ky=Symbol.for("react.profiler"),Ub=Symbol.for("react.provider"),Bb=Symbol.for("react.context"),Pv=Symbol.for("react.forward_ref"),Dy=Symbol.for("react.suspense"),Oy=Symbol.for("react.suspense_list"),kv=Symbol.for("react.memo"),mi=Symbol.for("react.lazy"),$b=Symbol.for("react.offscreen"),xE=Symbol.iterator;function Rc(n){return n===null||typeof n!="object"?null:(n=xE&&n[xE]||n["@@iterator"],typeof n=="function"?n:null)}var Ft=Object.assign,Ag;function Hc(n){if(Ag===void 0)try{throw Error()}catch(t){var e=t.stack.trim().match(/\n( *(at )?)/);Ag=e&&e[1]||""}return`
`+Ag+n}var Cg=!1;function Rg(n,e){if(!n||Cg)return"";Cg=!0;var t=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(e)if(e=function(){throw Error()},Object.defineProperty(e.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(e,[])}catch(u){var r=u}Reflect.construct(n,[],e)}else{try{e.call()}catch(u){r=u}n.call(e.prototype)}else{try{throw Error()}catch(u){r=u}n()}}catch(u){if(u&&r&&typeof u.stack=="string"){for(var s=u.stack.split(`
`),i=r.stack.split(`
`),o=s.length-1,a=i.length-1;1<=o&&0<=a&&s[o]!==i[a];)a--;for(;1<=o&&0<=a;o--,a--)if(s[o]!==i[a]){if(o!==1||a!==1)do if(o--,a--,0>a||s[o]!==i[a]){var l=`
`+s[o].replace(" at new "," at ");return n.displayName&&l.includes("<anonymous>")&&(l=l.replace("<anonymous>",n.displayName)),l}while(1<=o&&0<=a);break}}}finally{Cg=!1,Error.prepareStackTrace=t}return(n=n?n.displayName||n.name:"")?Hc(n):""}function C2(n){switch(n.tag){case 5:return Hc(n.type);case 16:return Hc("Lazy");case 13:return Hc("Suspense");case 19:return Hc("SuspenseList");case 0:case 2:case 15:return n=Rg(n.type,!1),n;case 11:return n=Rg(n.type.render,!1),n;case 1:return n=Rg(n.type,!0),n;default:return""}}function My(n){if(n==null)return null;if(typeof n=="function")return n.displayName||n.name||null;if(typeof n=="string")return n;switch(n){case Qa:return"Fragment";case Ka:return"Portal";case ky:return"Profiler";case Nv:return"StrictMode";case Dy:return"Suspense";case Oy:return"SuspenseList"}if(typeof n=="object")switch(n.$$typeof){case Bb:return(n.displayName||"Context")+".Consumer";case Ub:return(n._context.displayName||"Context")+".Provider";case Pv:var e=n.render;return n=n.displayName,n||(n=e.displayName||e.name||"",n=n!==""?"ForwardRef("+n+")":"ForwardRef"),n;case kv:return e=n.displayName||null,e!==null?e:My(n.type)||"Memo";case mi:e=n._payload,n=n._init;try{return My(n(e))}catch{}}return null}function R2(n){var e=n.type;switch(n.tag){case 24:return"Cache";case 9:return(e.displayName||"Context")+".Consumer";case 10:return(e._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return n=e.render,n=n.displayName||n.name||"",e.displayName||(n!==""?"ForwardRef("+n+")":"ForwardRef");case 7:return"Fragment";case 5:return e;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return My(e);case 8:return e===Nv?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof e=="function")return e.displayName||e.name||null;if(typeof e=="string")return e}return null}function Hi(n){switch(typeof n){case"boolean":case"number":case"string":case"undefined":return n;case"object":return n;default:return""}}function zb(n){var e=n.type;return(n=n.nodeName)&&n.toLowerCase()==="input"&&(e==="checkbox"||e==="radio")}function N2(n){var e=zb(n)?"checked":"value",t=Object.getOwnPropertyDescriptor(n.constructor.prototype,e),r=""+n[e];if(!n.hasOwnProperty(e)&&typeof t<"u"&&typeof t.get=="function"&&typeof t.set=="function"){var s=t.get,i=t.set;return Object.defineProperty(n,e,{configurable:!0,get:function(){return s.call(this)},set:function(o){r=""+o,i.call(this,o)}}),Object.defineProperty(n,e,{enumerable:t.enumerable}),{getValue:function(){return r},setValue:function(o){r=""+o},stopTracking:function(){n._valueTracker=null,delete n[e]}}}}function bh(n){n._valueTracker||(n._valueTracker=N2(n))}function qb(n){if(!n)return!1;var e=n._valueTracker;if(!e)return!0;var t=e.getValue(),r="";return n&&(r=zb(n)?n.checked?"true":"false":n.value),n=r,n!==t?(e.setValue(n),!0):!1}function Df(n){if(n=n||(typeof document<"u"?document:void 0),typeof n>"u")return null;try{return n.activeElement||n.body}catch{return n.body}}function Ly(n,e){var t=e.checked;return Ft({},e,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:t??n._wrapperState.initialChecked})}function TE(n,e){var t=e.defaultValue==null?"":e.defaultValue,r=e.checked!=null?e.checked:e.defaultChecked;t=Hi(e.value!=null?e.value:t),n._wrapperState={initialChecked:r,initialValue:t,controlled:e.type==="checkbox"||e.type==="radio"?e.checked!=null:e.value!=null}}function Wb(n,e){e=e.checked,e!=null&&Rv(n,"checked",e,!1)}function Vy(n,e){Wb(n,e);var t=Hi(e.value),r=e.type;if(t!=null)r==="number"?(t===0&&n.value===""||n.value!=t)&&(n.value=""+t):n.value!==""+t&&(n.value=""+t);else if(r==="submit"||r==="reset"){n.removeAttribute("value");return}e.hasOwnProperty("value")?Fy(n,e.type,t):e.hasOwnProperty("defaultValue")&&Fy(n,e.type,Hi(e.defaultValue)),e.checked==null&&e.defaultChecked!=null&&(n.defaultChecked=!!e.defaultChecked)}function SE(n,e,t){if(e.hasOwnProperty("value")||e.hasOwnProperty("defaultValue")){var r=e.type;if(!(r!=="submit"&&r!=="reset"||e.value!==void 0&&e.value!==null))return;e=""+n._wrapperState.initialValue,t||e===n.value||(n.value=e),n.defaultValue=e}t=n.name,t!==""&&(n.name=""),n.defaultChecked=!!n._wrapperState.initialChecked,t!==""&&(n.name=t)}function Fy(n,e,t){(e!=="number"||Df(n.ownerDocument)!==n)&&(t==null?n.defaultValue=""+n._wrapperState.initialValue:n.defaultValue!==""+t&&(n.defaultValue=""+t))}var Kc=Array.isArray;function ol(n,e,t,r){if(n=n.options,e){e={};for(var s=0;s<t.length;s++)e["$"+t[s]]=!0;for(t=0;t<n.length;t++)s=e.hasOwnProperty("$"+n[t].value),n[t].selected!==s&&(n[t].selected=s),s&&r&&(n[t].defaultSelected=!0)}else{for(t=""+Hi(t),e=null,s=0;s<n.length;s++){if(n[s].value===t){n[s].selected=!0,r&&(n[s].defaultSelected=!0);return}e!==null||n[s].disabled||(e=n[s])}e!==null&&(e.selected=!0)}}function jy(n,e){if(e.dangerouslySetInnerHTML!=null)throw Error(H(91));return Ft({},e,{value:void 0,defaultValue:void 0,children:""+n._wrapperState.initialValue})}function bE(n,e){var t=e.value;if(t==null){if(t=e.children,e=e.defaultValue,t!=null){if(e!=null)throw Error(H(92));if(Kc(t)){if(1<t.length)throw Error(H(93));t=t[0]}e=t}e==null&&(e=""),t=e}n._wrapperState={initialValue:Hi(t)}}function Gb(n,e){var t=Hi(e.value),r=Hi(e.defaultValue);t!=null&&(t=""+t,t!==n.value&&(n.value=t),e.defaultValue==null&&n.defaultValue!==t&&(n.defaultValue=t)),r!=null&&(n.defaultValue=""+r)}function AE(n){var e=n.textContent;e===n._wrapperState.initialValue&&e!==""&&e!==null&&(n.value=e)}function Hb(n){switch(n){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function Uy(n,e){return n==null||n==="http://www.w3.org/1999/xhtml"?Hb(e):n==="http://www.w3.org/2000/svg"&&e==="foreignObject"?"http://www.w3.org/1999/xhtml":n}var Ah,Kb=function(n){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(e,t,r,s){MSApp.execUnsafeLocalFunction(function(){return n(e,t,r,s)})}:n}(function(n,e){if(n.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in n)n.innerHTML=e;else{for(Ah=Ah||document.createElement("div"),Ah.innerHTML="<svg>"+e.valueOf().toString()+"</svg>",e=Ah.firstChild;n.firstChild;)n.removeChild(n.firstChild);for(;e.firstChild;)n.appendChild(e.firstChild)}});function Ou(n,e){if(e){var t=n.firstChild;if(t&&t===n.lastChild&&t.nodeType===3){t.nodeValue=e;return}}n.textContent=e}var ou={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},P2=["Webkit","ms","Moz","O"];Object.keys(ou).forEach(function(n){P2.forEach(function(e){e=e+n.charAt(0).toUpperCase()+n.substring(1),ou[e]=ou[n]})});function Qb(n,e,t){return e==null||typeof e=="boolean"||e===""?"":t||typeof e!="number"||e===0||ou.hasOwnProperty(n)&&ou[n]?(""+e).trim():e+"px"}function Yb(n,e){n=n.style;for(var t in e)if(e.hasOwnProperty(t)){var r=t.indexOf("--")===0,s=Qb(t,e[t],r);t==="float"&&(t="cssFloat"),r?n.setProperty(t,s):n[t]=s}}var k2=Ft({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function By(n,e){if(e){if(k2[n]&&(e.children!=null||e.dangerouslySetInnerHTML!=null))throw Error(H(137,n));if(e.dangerouslySetInnerHTML!=null){if(e.children!=null)throw Error(H(60));if(typeof e.dangerouslySetInnerHTML!="object"||!("__html"in e.dangerouslySetInnerHTML))throw Error(H(61))}if(e.style!=null&&typeof e.style!="object")throw Error(H(62))}}function $y(n,e){if(n.indexOf("-")===-1)return typeof e.is=="string";switch(n){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var zy=null;function Dv(n){return n=n.target||n.srcElement||window,n.correspondingUseElement&&(n=n.correspondingUseElement),n.nodeType===3?n.parentNode:n}var qy=null,al=null,ll=null;function CE(n){if(n=Rd(n)){if(typeof qy!="function")throw Error(H(280));var e=n.stateNode;e&&(e=Kp(e),qy(n.stateNode,n.type,e))}}function Jb(n){al?ll?ll.push(n):ll=[n]:al=n}function Xb(){if(al){var n=al,e=ll;if(ll=al=null,CE(n),e)for(n=0;n<e.length;n++)CE(e[n])}}function Zb(n,e){return n(e)}function e1(){}var Ng=!1;function t1(n,e,t){if(Ng)return n(e,t);Ng=!0;try{return Zb(n,e,t)}finally{Ng=!1,(al!==null||ll!==null)&&(e1(),Xb())}}function Mu(n,e){var t=n.stateNode;if(t===null)return null;var r=Kp(t);if(r===null)return null;t=r[e];e:switch(e){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(r=!r.disabled)||(n=n.type,r=!(n==="button"||n==="input"||n==="select"||n==="textarea")),n=!r;break e;default:n=!1}if(n)return null;if(t&&typeof t!="function")throw Error(H(231,e,typeof t));return t}var Wy=!1;if(zs)try{var Nc={};Object.defineProperty(Nc,"passive",{get:function(){Wy=!0}}),window.addEventListener("test",Nc,Nc),window.removeEventListener("test",Nc,Nc)}catch{Wy=!1}function D2(n,e,t,r,s,i,o,a,l){var u=Array.prototype.slice.call(arguments,3);try{e.apply(t,u)}catch(h){this.onError(h)}}var au=!1,Of=null,Mf=!1,Gy=null,O2={onError:function(n){au=!0,Of=n}};function M2(n,e,t,r,s,i,o,a,l){au=!1,Of=null,D2.apply(O2,arguments)}function L2(n,e,t,r,s,i,o,a,l){if(M2.apply(this,arguments),au){if(au){var u=Of;au=!1,Of=null}else throw Error(H(198));Mf||(Mf=!0,Gy=u)}}function ga(n){var e=n,t=n;if(n.alternate)for(;e.return;)e=e.return;else{n=e;do e=n,e.flags&4098&&(t=e.return),n=e.return;while(n)}return e.tag===3?t:null}function n1(n){if(n.tag===13){var e=n.memoizedState;if(e===null&&(n=n.alternate,n!==null&&(e=n.memoizedState)),e!==null)return e.dehydrated}return null}function RE(n){if(ga(n)!==n)throw Error(H(188))}function V2(n){var e=n.alternate;if(!e){if(e=ga(n),e===null)throw Error(H(188));return e!==n?null:n}for(var t=n,r=e;;){var s=t.return;if(s===null)break;var i=s.alternate;if(i===null){if(r=s.return,r!==null){t=r;continue}break}if(s.child===i.child){for(i=s.child;i;){if(i===t)return RE(s),n;if(i===r)return RE(s),e;i=i.sibling}throw Error(H(188))}if(t.return!==r.return)t=s,r=i;else{for(var o=!1,a=s.child;a;){if(a===t){o=!0,t=s,r=i;break}if(a===r){o=!0,r=s,t=i;break}a=a.sibling}if(!o){for(a=i.child;a;){if(a===t){o=!0,t=i,r=s;break}if(a===r){o=!0,r=i,t=s;break}a=a.sibling}if(!o)throw Error(H(189))}}if(t.alternate!==r)throw Error(H(190))}if(t.tag!==3)throw Error(H(188));return t.stateNode.current===t?n:e}function r1(n){return n=V2(n),n!==null?s1(n):null}function s1(n){if(n.tag===5||n.tag===6)return n;for(n=n.child;n!==null;){var e=s1(n);if(e!==null)return e;n=n.sibling}return null}var i1=wr.unstable_scheduleCallback,NE=wr.unstable_cancelCallback,F2=wr.unstable_shouldYield,j2=wr.unstable_requestPaint,Wt=wr.unstable_now,U2=wr.unstable_getCurrentPriorityLevel,Ov=wr.unstable_ImmediatePriority,o1=wr.unstable_UserBlockingPriority,Lf=wr.unstable_NormalPriority,B2=wr.unstable_LowPriority,a1=wr.unstable_IdlePriority,qp=null,gs=null;function $2(n){if(gs&&typeof gs.onCommitFiberRoot=="function")try{gs.onCommitFiberRoot(qp,n,void 0,(n.current.flags&128)===128)}catch{}}var Qr=Math.clz32?Math.clz32:W2,z2=Math.log,q2=Math.LN2;function W2(n){return n>>>=0,n===0?32:31-(z2(n)/q2|0)|0}var Ch=64,Rh=4194304;function Qc(n){switch(n&-n){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return n&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return n&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return n}}function Vf(n,e){var t=n.pendingLanes;if(t===0)return 0;var r=0,s=n.suspendedLanes,i=n.pingedLanes,o=t&268435455;if(o!==0){var a=o&~s;a!==0?r=Qc(a):(i&=o,i!==0&&(r=Qc(i)))}else o=t&~s,o!==0?r=Qc(o):i!==0&&(r=Qc(i));if(r===0)return 0;if(e!==0&&e!==r&&!(e&s)&&(s=r&-r,i=e&-e,s>=i||s===16&&(i&4194240)!==0))return e;if(r&4&&(r|=t&16),e=n.entangledLanes,e!==0)for(n=n.entanglements,e&=r;0<e;)t=31-Qr(e),s=1<<t,r|=n[t],e&=~s;return r}function G2(n,e){switch(n){case 1:case 2:case 4:return e+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return e+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function H2(n,e){for(var t=n.suspendedLanes,r=n.pingedLanes,s=n.expirationTimes,i=n.pendingLanes;0<i;){var o=31-Qr(i),a=1<<o,l=s[o];l===-1?(!(a&t)||a&r)&&(s[o]=G2(a,e)):l<=e&&(n.expiredLanes|=a),i&=~a}}function Hy(n){return n=n.pendingLanes&-1073741825,n!==0?n:n&1073741824?1073741824:0}function l1(){var n=Ch;return Ch<<=1,!(Ch&4194240)&&(Ch=64),n}function Pg(n){for(var e=[],t=0;31>t;t++)e.push(n);return e}function Ad(n,e,t){n.pendingLanes|=e,e!==536870912&&(n.suspendedLanes=0,n.pingedLanes=0),n=n.eventTimes,e=31-Qr(e),n[e]=t}function K2(n,e){var t=n.pendingLanes&~e;n.pendingLanes=e,n.suspendedLanes=0,n.pingedLanes=0,n.expiredLanes&=e,n.mutableReadLanes&=e,n.entangledLanes&=e,e=n.entanglements;var r=n.eventTimes;for(n=n.expirationTimes;0<t;){var s=31-Qr(t),i=1<<s;e[s]=0,r[s]=-1,n[s]=-1,t&=~i}}function Mv(n,e){var t=n.entangledLanes|=e;for(n=n.entanglements;t;){var r=31-Qr(t),s=1<<r;s&e|n[r]&e&&(n[r]|=e),t&=~s}}var it=0;function c1(n){return n&=-n,1<n?4<n?n&268435455?16:536870912:4:1}var u1,Lv,d1,h1,f1,Ky=!1,Nh=[],ki=null,Di=null,Oi=null,Lu=new Map,Vu=new Map,yi=[],Q2="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function PE(n,e){switch(n){case"focusin":case"focusout":ki=null;break;case"dragenter":case"dragleave":Di=null;break;case"mouseover":case"mouseout":Oi=null;break;case"pointerover":case"pointerout":Lu.delete(e.pointerId);break;case"gotpointercapture":case"lostpointercapture":Vu.delete(e.pointerId)}}function Pc(n,e,t,r,s,i){return n===null||n.nativeEvent!==i?(n={blockedOn:e,domEventName:t,eventSystemFlags:r,nativeEvent:i,targetContainers:[s]},e!==null&&(e=Rd(e),e!==null&&Lv(e)),n):(n.eventSystemFlags|=r,e=n.targetContainers,s!==null&&e.indexOf(s)===-1&&e.push(s),n)}function Y2(n,e,t,r,s){switch(e){case"focusin":return ki=Pc(ki,n,e,t,r,s),!0;case"dragenter":return Di=Pc(Di,n,e,t,r,s),!0;case"mouseover":return Oi=Pc(Oi,n,e,t,r,s),!0;case"pointerover":var i=s.pointerId;return Lu.set(i,Pc(Lu.get(i)||null,n,e,t,r,s)),!0;case"gotpointercapture":return i=s.pointerId,Vu.set(i,Pc(Vu.get(i)||null,n,e,t,r,s)),!0}return!1}function p1(n){var e=Do(n.target);if(e!==null){var t=ga(e);if(t!==null){if(e=t.tag,e===13){if(e=n1(t),e!==null){n.blockedOn=e,f1(n.priority,function(){d1(t)});return}}else if(e===3&&t.stateNode.current.memoizedState.isDehydrated){n.blockedOn=t.tag===3?t.stateNode.containerInfo:null;return}}}n.blockedOn=null}function of(n){if(n.blockedOn!==null)return!1;for(var e=n.targetContainers;0<e.length;){var t=Qy(n.domEventName,n.eventSystemFlags,e[0],n.nativeEvent);if(t===null){t=n.nativeEvent;var r=new t.constructor(t.type,t);zy=r,t.target.dispatchEvent(r),zy=null}else return e=Rd(t),e!==null&&Lv(e),n.blockedOn=t,!1;e.shift()}return!0}function kE(n,e,t){of(n)&&t.delete(e)}function J2(){Ky=!1,ki!==null&&of(ki)&&(ki=null),Di!==null&&of(Di)&&(Di=null),Oi!==null&&of(Oi)&&(Oi=null),Lu.forEach(kE),Vu.forEach(kE)}function kc(n,e){n.blockedOn===e&&(n.blockedOn=null,Ky||(Ky=!0,wr.unstable_scheduleCallback(wr.unstable_NormalPriority,J2)))}function Fu(n){function e(s){return kc(s,n)}if(0<Nh.length){kc(Nh[0],n);for(var t=1;t<Nh.length;t++){var r=Nh[t];r.blockedOn===n&&(r.blockedOn=null)}}for(ki!==null&&kc(ki,n),Di!==null&&kc(Di,n),Oi!==null&&kc(Oi,n),Lu.forEach(e),Vu.forEach(e),t=0;t<yi.length;t++)r=yi[t],r.blockedOn===n&&(r.blockedOn=null);for(;0<yi.length&&(t=yi[0],t.blockedOn===null);)p1(t),t.blockedOn===null&&yi.shift()}var cl=ei.ReactCurrentBatchConfig,Ff=!0;function X2(n,e,t,r){var s=it,i=cl.transition;cl.transition=null;try{it=1,Vv(n,e,t,r)}finally{it=s,cl.transition=i}}function Z2(n,e,t,r){var s=it,i=cl.transition;cl.transition=null;try{it=4,Vv(n,e,t,r)}finally{it=s,cl.transition=i}}function Vv(n,e,t,r){if(Ff){var s=Qy(n,e,t,r);if(s===null)Bg(n,e,r,jf,t),PE(n,r);else if(Y2(s,n,e,t,r))r.stopPropagation();else if(PE(n,r),e&4&&-1<Q2.indexOf(n)){for(;s!==null;){var i=Rd(s);if(i!==null&&u1(i),i=Qy(n,e,t,r),i===null&&Bg(n,e,r,jf,t),i===s)break;s=i}s!==null&&r.stopPropagation()}else Bg(n,e,r,null,t)}}var jf=null;function Qy(n,e,t,r){if(jf=null,n=Dv(r),n=Do(n),n!==null)if(e=ga(n),e===null)n=null;else if(t=e.tag,t===13){if(n=n1(e),n!==null)return n;n=null}else if(t===3){if(e.stateNode.current.memoizedState.isDehydrated)return e.tag===3?e.stateNode.containerInfo:null;n=null}else e!==n&&(n=null);return jf=n,null}function m1(n){switch(n){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(U2()){case Ov:return 1;case o1:return 4;case Lf:case B2:return 16;case a1:return 536870912;default:return 16}default:return 16}}var Ti=null,Fv=null,af=null;function g1(){if(af)return af;var n,e=Fv,t=e.length,r,s="value"in Ti?Ti.value:Ti.textContent,i=s.length;for(n=0;n<t&&e[n]===s[n];n++);var o=t-n;for(r=1;r<=o&&e[t-r]===s[i-r];r++);return af=s.slice(n,1<r?1-r:void 0)}function lf(n){var e=n.keyCode;return"charCode"in n?(n=n.charCode,n===0&&e===13&&(n=13)):n=e,n===10&&(n=13),32<=n||n===13?n:0}function Ph(){return!0}function DE(){return!1}function Sr(n){function e(t,r,s,i,o){this._reactName=t,this._targetInst=s,this.type=r,this.nativeEvent=i,this.target=o,this.currentTarget=null;for(var a in n)n.hasOwnProperty(a)&&(t=n[a],this[a]=t?t(i):i[a]);return this.isDefaultPrevented=(i.defaultPrevented!=null?i.defaultPrevented:i.returnValue===!1)?Ph:DE,this.isPropagationStopped=DE,this}return Ft(e.prototype,{preventDefault:function(){this.defaultPrevented=!0;var t=this.nativeEvent;t&&(t.preventDefault?t.preventDefault():typeof t.returnValue!="unknown"&&(t.returnValue=!1),this.isDefaultPrevented=Ph)},stopPropagation:function(){var t=this.nativeEvent;t&&(t.stopPropagation?t.stopPropagation():typeof t.cancelBubble!="unknown"&&(t.cancelBubble=!0),this.isPropagationStopped=Ph)},persist:function(){},isPersistent:Ph}),e}var tc={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(n){return n.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},jv=Sr(tc),Cd=Ft({},tc,{view:0,detail:0}),eO=Sr(Cd),kg,Dg,Dc,Wp=Ft({},Cd,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:Uv,button:0,buttons:0,relatedTarget:function(n){return n.relatedTarget===void 0?n.fromElement===n.srcElement?n.toElement:n.fromElement:n.relatedTarget},movementX:function(n){return"movementX"in n?n.movementX:(n!==Dc&&(Dc&&n.type==="mousemove"?(kg=n.screenX-Dc.screenX,Dg=n.screenY-Dc.screenY):Dg=kg=0,Dc=n),kg)},movementY:function(n){return"movementY"in n?n.movementY:Dg}}),OE=Sr(Wp),tO=Ft({},Wp,{dataTransfer:0}),nO=Sr(tO),rO=Ft({},Cd,{relatedTarget:0}),Og=Sr(rO),sO=Ft({},tc,{animationName:0,elapsedTime:0,pseudoElement:0}),iO=Sr(sO),oO=Ft({},tc,{clipboardData:function(n){return"clipboardData"in n?n.clipboardData:window.clipboardData}}),aO=Sr(oO),lO=Ft({},tc,{data:0}),ME=Sr(lO),cO={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},uO={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},dO={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function hO(n){var e=this.nativeEvent;return e.getModifierState?e.getModifierState(n):(n=dO[n])?!!e[n]:!1}function Uv(){return hO}var fO=Ft({},Cd,{key:function(n){if(n.key){var e=cO[n.key]||n.key;if(e!=="Unidentified")return e}return n.type==="keypress"?(n=lf(n),n===13?"Enter":String.fromCharCode(n)):n.type==="keydown"||n.type==="keyup"?uO[n.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:Uv,charCode:function(n){return n.type==="keypress"?lf(n):0},keyCode:function(n){return n.type==="keydown"||n.type==="keyup"?n.keyCode:0},which:function(n){return n.type==="keypress"?lf(n):n.type==="keydown"||n.type==="keyup"?n.keyCode:0}}),pO=Sr(fO),mO=Ft({},Wp,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),LE=Sr(mO),gO=Ft({},Cd,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:Uv}),yO=Sr(gO),_O=Ft({},tc,{propertyName:0,elapsedTime:0,pseudoElement:0}),vO=Sr(_O),wO=Ft({},Wp,{deltaX:function(n){return"deltaX"in n?n.deltaX:"wheelDeltaX"in n?-n.wheelDeltaX:0},deltaY:function(n){return"deltaY"in n?n.deltaY:"wheelDeltaY"in n?-n.wheelDeltaY:"wheelDelta"in n?-n.wheelDelta:0},deltaZ:0,deltaMode:0}),IO=Sr(wO),EO=[9,13,27,32],Bv=zs&&"CompositionEvent"in window,lu=null;zs&&"documentMode"in document&&(lu=document.documentMode);var xO=zs&&"TextEvent"in window&&!lu,y1=zs&&(!Bv||lu&&8<lu&&11>=lu),VE=String.fromCharCode(32),FE=!1;function _1(n,e){switch(n){case"keyup":return EO.indexOf(e.keyCode)!==-1;case"keydown":return e.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function v1(n){return n=n.detail,typeof n=="object"&&"data"in n?n.data:null}var Ya=!1;function TO(n,e){switch(n){case"compositionend":return v1(e);case"keypress":return e.which!==32?null:(FE=!0,VE);case"textInput":return n=e.data,n===VE&&FE?null:n;default:return null}}function SO(n,e){if(Ya)return n==="compositionend"||!Bv&&_1(n,e)?(n=g1(),af=Fv=Ti=null,Ya=!1,n):null;switch(n){case"paste":return null;case"keypress":if(!(e.ctrlKey||e.altKey||e.metaKey)||e.ctrlKey&&e.altKey){if(e.char&&1<e.char.length)return e.char;if(e.which)return String.fromCharCode(e.which)}return null;case"compositionend":return y1&&e.locale!=="ko"?null:e.data;default:return null}}var bO={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function jE(n){var e=n&&n.nodeName&&n.nodeName.toLowerCase();return e==="input"?!!bO[n.type]:e==="textarea"}function w1(n,e,t,r){Jb(r),e=Uf(e,"onChange"),0<e.length&&(t=new jv("onChange","change",null,t,r),n.push({event:t,listeners:e}))}var cu=null,ju=null;function AO(n){P1(n,0)}function Gp(n){var e=Za(n);if(qb(e))return n}function CO(n,e){if(n==="change")return e}var I1=!1;if(zs){var Mg;if(zs){var Lg="oninput"in document;if(!Lg){var UE=document.createElement("div");UE.setAttribute("oninput","return;"),Lg=typeof UE.oninput=="function"}Mg=Lg}else Mg=!1;I1=Mg&&(!document.documentMode||9<document.documentMode)}function BE(){cu&&(cu.detachEvent("onpropertychange",E1),ju=cu=null)}function E1(n){if(n.propertyName==="value"&&Gp(ju)){var e=[];w1(e,ju,n,Dv(n)),t1(AO,e)}}function RO(n,e,t){n==="focusin"?(BE(),cu=e,ju=t,cu.attachEvent("onpropertychange",E1)):n==="focusout"&&BE()}function NO(n){if(n==="selectionchange"||n==="keyup"||n==="keydown")return Gp(ju)}function PO(n,e){if(n==="click")return Gp(e)}function kO(n,e){if(n==="input"||n==="change")return Gp(e)}function DO(n,e){return n===e&&(n!==0||1/n===1/e)||n!==n&&e!==e}var Zr=typeof Object.is=="function"?Object.is:DO;function Uu(n,e){if(Zr(n,e))return!0;if(typeof n!="object"||n===null||typeof e!="object"||e===null)return!1;var t=Object.keys(n),r=Object.keys(e);if(t.length!==r.length)return!1;for(r=0;r<t.length;r++){var s=t[r];if(!Py.call(e,s)||!Zr(n[s],e[s]))return!1}return!0}function $E(n){for(;n&&n.firstChild;)n=n.firstChild;return n}function zE(n,e){var t=$E(n);n=0;for(var r;t;){if(t.nodeType===3){if(r=n+t.textContent.length,n<=e&&r>=e)return{node:t,offset:e-n};n=r}e:{for(;t;){if(t.nextSibling){t=t.nextSibling;break e}t=t.parentNode}t=void 0}t=$E(t)}}function x1(n,e){return n&&e?n===e?!0:n&&n.nodeType===3?!1:e&&e.nodeType===3?x1(n,e.parentNode):"contains"in n?n.contains(e):n.compareDocumentPosition?!!(n.compareDocumentPosition(e)&16):!1:!1}function T1(){for(var n=window,e=Df();e instanceof n.HTMLIFrameElement;){try{var t=typeof e.contentWindow.location.href=="string"}catch{t=!1}if(t)n=e.contentWindow;else break;e=Df(n.document)}return e}function $v(n){var e=n&&n.nodeName&&n.nodeName.toLowerCase();return e&&(e==="input"&&(n.type==="text"||n.type==="search"||n.type==="tel"||n.type==="url"||n.type==="password")||e==="textarea"||n.contentEditable==="true")}function OO(n){var e=T1(),t=n.focusedElem,r=n.selectionRange;if(e!==t&&t&&t.ownerDocument&&x1(t.ownerDocument.documentElement,t)){if(r!==null&&$v(t)){if(e=r.start,n=r.end,n===void 0&&(n=e),"selectionStart"in t)t.selectionStart=e,t.selectionEnd=Math.min(n,t.value.length);else if(n=(e=t.ownerDocument||document)&&e.defaultView||window,n.getSelection){n=n.getSelection();var s=t.textContent.length,i=Math.min(r.start,s);r=r.end===void 0?i:Math.min(r.end,s),!n.extend&&i>r&&(s=r,r=i,i=s),s=zE(t,i);var o=zE(t,r);s&&o&&(n.rangeCount!==1||n.anchorNode!==s.node||n.anchorOffset!==s.offset||n.focusNode!==o.node||n.focusOffset!==o.offset)&&(e=e.createRange(),e.setStart(s.node,s.offset),n.removeAllRanges(),i>r?(n.addRange(e),n.extend(o.node,o.offset)):(e.setEnd(o.node,o.offset),n.addRange(e)))}}for(e=[],n=t;n=n.parentNode;)n.nodeType===1&&e.push({element:n,left:n.scrollLeft,top:n.scrollTop});for(typeof t.focus=="function"&&t.focus(),t=0;t<e.length;t++)n=e[t],n.element.scrollLeft=n.left,n.element.scrollTop=n.top}}var MO=zs&&"documentMode"in document&&11>=document.documentMode,Ja=null,Yy=null,uu=null,Jy=!1;function qE(n,e,t){var r=t.window===t?t.document:t.nodeType===9?t:t.ownerDocument;Jy||Ja==null||Ja!==Df(r)||(r=Ja,"selectionStart"in r&&$v(r)?r={start:r.selectionStart,end:r.selectionEnd}:(r=(r.ownerDocument&&r.ownerDocument.defaultView||window).getSelection(),r={anchorNode:r.anchorNode,anchorOffset:r.anchorOffset,focusNode:r.focusNode,focusOffset:r.focusOffset}),uu&&Uu(uu,r)||(uu=r,r=Uf(Yy,"onSelect"),0<r.length&&(e=new jv("onSelect","select",null,e,t),n.push({event:e,listeners:r}),e.target=Ja)))}function kh(n,e){var t={};return t[n.toLowerCase()]=e.toLowerCase(),t["Webkit"+n]="webkit"+e,t["Moz"+n]="moz"+e,t}var Xa={animationend:kh("Animation","AnimationEnd"),animationiteration:kh("Animation","AnimationIteration"),animationstart:kh("Animation","AnimationStart"),transitionend:kh("Transition","TransitionEnd")},Vg={},S1={};zs&&(S1=document.createElement("div").style,"AnimationEvent"in window||(delete Xa.animationend.animation,delete Xa.animationiteration.animation,delete Xa.animationstart.animation),"TransitionEvent"in window||delete Xa.transitionend.transition);function Hp(n){if(Vg[n])return Vg[n];if(!Xa[n])return n;var e=Xa[n],t;for(t in e)if(e.hasOwnProperty(t)&&t in S1)return Vg[n]=e[t];return n}var b1=Hp("animationend"),A1=Hp("animationiteration"),C1=Hp("animationstart"),R1=Hp("transitionend"),N1=new Map,WE="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function ao(n,e){N1.set(n,e),ma(e,[n])}for(var Fg=0;Fg<WE.length;Fg++){var jg=WE[Fg],LO=jg.toLowerCase(),VO=jg[0].toUpperCase()+jg.slice(1);ao(LO,"on"+VO)}ao(b1,"onAnimationEnd");ao(A1,"onAnimationIteration");ao(C1,"onAnimationStart");ao("dblclick","onDoubleClick");ao("focusin","onFocus");ao("focusout","onBlur");ao(R1,"onTransitionEnd");Il("onMouseEnter",["mouseout","mouseover"]);Il("onMouseLeave",["mouseout","mouseover"]);Il("onPointerEnter",["pointerout","pointerover"]);Il("onPointerLeave",["pointerout","pointerover"]);ma("onChange","change click focusin focusout input keydown keyup selectionchange".split(" "));ma("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" "));ma("onBeforeInput",["compositionend","keypress","textInput","paste"]);ma("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" "));ma("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" "));ma("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Yc="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),FO=new Set("cancel close invalid load scroll toggle".split(" ").concat(Yc));function GE(n,e,t){var r=n.type||"unknown-event";n.currentTarget=t,L2(r,e,void 0,n),n.currentTarget=null}function P1(n,e){e=(e&4)!==0;for(var t=0;t<n.length;t++){var r=n[t],s=r.event;r=r.listeners;e:{var i=void 0;if(e)for(var o=r.length-1;0<=o;o--){var a=r[o],l=a.instance,u=a.currentTarget;if(a=a.listener,l!==i&&s.isPropagationStopped())break e;GE(s,a,u),i=l}else for(o=0;o<r.length;o++){if(a=r[o],l=a.instance,u=a.currentTarget,a=a.listener,l!==i&&s.isPropagationStopped())break e;GE(s,a,u),i=l}}}if(Mf)throw n=Gy,Mf=!1,Gy=null,n}function Et(n,e){var t=e[n_];t===void 0&&(t=e[n_]=new Set);var r=n+"__bubble";t.has(r)||(k1(e,n,2,!1),t.add(r))}function Ug(n,e,t){var r=0;e&&(r|=4),k1(t,n,r,e)}var Dh="_reactListening"+Math.random().toString(36).slice(2);function Bu(n){if(!n[Dh]){n[Dh]=!0,jb.forEach(function(t){t!=="selectionchange"&&(FO.has(t)||Ug(t,!1,n),Ug(t,!0,n))});var e=n.nodeType===9?n:n.ownerDocument;e===null||e[Dh]||(e[Dh]=!0,Ug("selectionchange",!1,e))}}function k1(n,e,t,r){switch(m1(e)){case 1:var s=X2;break;case 4:s=Z2;break;default:s=Vv}t=s.bind(null,e,t,n),s=void 0,!Wy||e!=="touchstart"&&e!=="touchmove"&&e!=="wheel"||(s=!0),r?s!==void 0?n.addEventListener(e,t,{capture:!0,passive:s}):n.addEventListener(e,t,!0):s!==void 0?n.addEventListener(e,t,{passive:s}):n.addEventListener(e,t,!1)}function Bg(n,e,t,r,s){var i=r;if(!(e&1)&&!(e&2)&&r!==null)e:for(;;){if(r===null)return;var o=r.tag;if(o===3||o===4){var a=r.stateNode.containerInfo;if(a===s||a.nodeType===8&&a.parentNode===s)break;if(o===4)for(o=r.return;o!==null;){var l=o.tag;if((l===3||l===4)&&(l=o.stateNode.containerInfo,l===s||l.nodeType===8&&l.parentNode===s))return;o=o.return}for(;a!==null;){if(o=Do(a),o===null)return;if(l=o.tag,l===5||l===6){r=i=o;continue e}a=a.parentNode}}r=r.return}t1(function(){var u=i,h=Dv(t),f=[];e:{var p=N1.get(n);if(p!==void 0){var y=jv,I=n;switch(n){case"keypress":if(lf(t)===0)break e;case"keydown":case"keyup":y=pO;break;case"focusin":I="focus",y=Og;break;case"focusout":I="blur",y=Og;break;case"beforeblur":case"afterblur":y=Og;break;case"click":if(t.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":y=OE;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":y=nO;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":y=yO;break;case b1:case A1:case C1:y=iO;break;case R1:y=vO;break;case"scroll":y=eO;break;case"wheel":y=IO;break;case"copy":case"cut":case"paste":y=aO;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":y=LE}var C=(e&4)!==0,P=!C&&n==="scroll",A=C?p!==null?p+"Capture":null:p;C=[];for(var T=u,R;T!==null;){R=T;var D=R.stateNode;if(R.tag===5&&D!==null&&(R=D,A!==null&&(D=Mu(T,A),D!=null&&C.push($u(T,D,R)))),P)break;T=T.return}0<C.length&&(p=new y(p,I,null,t,h),f.push({event:p,listeners:C}))}}if(!(e&7)){e:{if(p=n==="mouseover"||n==="pointerover",y=n==="mouseout"||n==="pointerout",p&&t!==zy&&(I=t.relatedTarget||t.fromElement)&&(Do(I)||I[qs]))break e;if((y||p)&&(p=h.window===h?h:(p=h.ownerDocument)?p.defaultView||p.parentWindow:window,y?(I=t.relatedTarget||t.toElement,y=u,I=I?Do(I):null,I!==null&&(P=ga(I),I!==P||I.tag!==5&&I.tag!==6)&&(I=null)):(y=null,I=u),y!==I)){if(C=OE,D="onMouseLeave",A="onMouseEnter",T="mouse",(n==="pointerout"||n==="pointerover")&&(C=LE,D="onPointerLeave",A="onPointerEnter",T="pointer"),P=y==null?p:Za(y),R=I==null?p:Za(I),p=new C(D,T+"leave",y,t,h),p.target=P,p.relatedTarget=R,D=null,Do(h)===u&&(C=new C(A,T+"enter",I,t,h),C.target=R,C.relatedTarget=P,D=C),P=D,y&&I)t:{for(C=y,A=I,T=0,R=C;R;R=Ma(R))T++;for(R=0,D=A;D;D=Ma(D))R++;for(;0<T-R;)C=Ma(C),T--;for(;0<R-T;)A=Ma(A),R--;for(;T--;){if(C===A||A!==null&&C===A.alternate)break t;C=Ma(C),A=Ma(A)}C=null}else C=null;y!==null&&HE(f,p,y,C,!1),I!==null&&P!==null&&HE(f,P,I,C,!0)}}e:{if(p=u?Za(u):window,y=p.nodeName&&p.nodeName.toLowerCase(),y==="select"||y==="input"&&p.type==="file")var F=CO;else if(jE(p))if(I1)F=kO;else{F=NO;var k=RO}else(y=p.nodeName)&&y.toLowerCase()==="input"&&(p.type==="checkbox"||p.type==="radio")&&(F=PO);if(F&&(F=F(n,u))){w1(f,F,t,h);break e}k&&k(n,p,u),n==="focusout"&&(k=p._wrapperState)&&k.controlled&&p.type==="number"&&Fy(p,"number",p.value)}switch(k=u?Za(u):window,n){case"focusin":(jE(k)||k.contentEditable==="true")&&(Ja=k,Yy=u,uu=null);break;case"focusout":uu=Yy=Ja=null;break;case"mousedown":Jy=!0;break;case"contextmenu":case"mouseup":case"dragend":Jy=!1,qE(f,t,h);break;case"selectionchange":if(MO)break;case"keydown":case"keyup":qE(f,t,h)}var E;if(Bv)e:{switch(n){case"compositionstart":var _="onCompositionStart";break e;case"compositionend":_="onCompositionEnd";break e;case"compositionupdate":_="onCompositionUpdate";break e}_=void 0}else Ya?_1(n,t)&&(_="onCompositionEnd"):n==="keydown"&&t.keyCode===229&&(_="onCompositionStart");_&&(y1&&t.locale!=="ko"&&(Ya||_!=="onCompositionStart"?_==="onCompositionEnd"&&Ya&&(E=g1()):(Ti=h,Fv="value"in Ti?Ti.value:Ti.textContent,Ya=!0)),k=Uf(u,_),0<k.length&&(_=new ME(_,n,null,t,h),f.push({event:_,listeners:k}),E?_.data=E:(E=v1(t),E!==null&&(_.data=E)))),(E=xO?TO(n,t):SO(n,t))&&(u=Uf(u,"onBeforeInput"),0<u.length&&(h=new ME("onBeforeInput","beforeinput",null,t,h),f.push({event:h,listeners:u}),h.data=E))}P1(f,e)})}function $u(n,e,t){return{instance:n,listener:e,currentTarget:t}}function Uf(n,e){for(var t=e+"Capture",r=[];n!==null;){var s=n,i=s.stateNode;s.tag===5&&i!==null&&(s=i,i=Mu(n,t),i!=null&&r.unshift($u(n,i,s)),i=Mu(n,e),i!=null&&r.push($u(n,i,s))),n=n.return}return r}function Ma(n){if(n===null)return null;do n=n.return;while(n&&n.tag!==5);return n||null}function HE(n,e,t,r,s){for(var i=e._reactName,o=[];t!==null&&t!==r;){var a=t,l=a.alternate,u=a.stateNode;if(l!==null&&l===r)break;a.tag===5&&u!==null&&(a=u,s?(l=Mu(t,i),l!=null&&o.unshift($u(t,l,a))):s||(l=Mu(t,i),l!=null&&o.push($u(t,l,a)))),t=t.return}o.length!==0&&n.push({event:e,listeners:o})}var jO=/\r\n?/g,UO=/\u0000|\uFFFD/g;function KE(n){return(typeof n=="string"?n:""+n).replace(jO,`
`).replace(UO,"")}function Oh(n,e,t){if(e=KE(e),KE(n)!==e&&t)throw Error(H(425))}function Bf(){}var Xy=null,Zy=null;function e_(n,e){return n==="textarea"||n==="noscript"||typeof e.children=="string"||typeof e.children=="number"||typeof e.dangerouslySetInnerHTML=="object"&&e.dangerouslySetInnerHTML!==null&&e.dangerouslySetInnerHTML.__html!=null}var t_=typeof setTimeout=="function"?setTimeout:void 0,BO=typeof clearTimeout=="function"?clearTimeout:void 0,QE=typeof Promise=="function"?Promise:void 0,$O=typeof queueMicrotask=="function"?queueMicrotask:typeof QE<"u"?function(n){return QE.resolve(null).then(n).catch(zO)}:t_;function zO(n){setTimeout(function(){throw n})}function $g(n,e){var t=e,r=0;do{var s=t.nextSibling;if(n.removeChild(t),s&&s.nodeType===8)if(t=s.data,t==="/$"){if(r===0){n.removeChild(s),Fu(e);return}r--}else t!=="$"&&t!=="$?"&&t!=="$!"||r++;t=s}while(t);Fu(e)}function Mi(n){for(;n!=null;n=n.nextSibling){var e=n.nodeType;if(e===1||e===3)break;if(e===8){if(e=n.data,e==="$"||e==="$!"||e==="$?")break;if(e==="/$")return null}}return n}function YE(n){n=n.previousSibling;for(var e=0;n;){if(n.nodeType===8){var t=n.data;if(t==="$"||t==="$!"||t==="$?"){if(e===0)return n;e--}else t==="/$"&&e++}n=n.previousSibling}return null}var nc=Math.random().toString(36).slice(2),us="__reactFiber$"+nc,zu="__reactProps$"+nc,qs="__reactContainer$"+nc,n_="__reactEvents$"+nc,qO="__reactListeners$"+nc,WO="__reactHandles$"+nc;function Do(n){var e=n[us];if(e)return e;for(var t=n.parentNode;t;){if(e=t[qs]||t[us]){if(t=e.alternate,e.child!==null||t!==null&&t.child!==null)for(n=YE(n);n!==null;){if(t=n[us])return t;n=YE(n)}return e}n=t,t=n.parentNode}return null}function Rd(n){return n=n[us]||n[qs],!n||n.tag!==5&&n.tag!==6&&n.tag!==13&&n.tag!==3?null:n}function Za(n){if(n.tag===5||n.tag===6)return n.stateNode;throw Error(H(33))}function Kp(n){return n[zu]||null}var r_=[],el=-1;function lo(n){return{current:n}}function Tt(n){0>el||(n.current=r_[el],r_[el]=null,el--)}function _t(n,e){el++,r_[el]=n.current,n.current=e}var Ki={},Ln=lo(Ki),Zn=lo(!1),Ho=Ki;function El(n,e){var t=n.type.contextTypes;if(!t)return Ki;var r=n.stateNode;if(r&&r.__reactInternalMemoizedUnmaskedChildContext===e)return r.__reactInternalMemoizedMaskedChildContext;var s={},i;for(i in t)s[i]=e[i];return r&&(n=n.stateNode,n.__reactInternalMemoizedUnmaskedChildContext=e,n.__reactInternalMemoizedMaskedChildContext=s),s}function er(n){return n=n.childContextTypes,n!=null}function $f(){Tt(Zn),Tt(Ln)}function JE(n,e,t){if(Ln.current!==Ki)throw Error(H(168));_t(Ln,e),_t(Zn,t)}function D1(n,e,t){var r=n.stateNode;if(e=e.childContextTypes,typeof r.getChildContext!="function")return t;r=r.getChildContext();for(var s in r)if(!(s in e))throw Error(H(108,R2(n)||"Unknown",s));return Ft({},t,r)}function zf(n){return n=(n=n.stateNode)&&n.__reactInternalMemoizedMergedChildContext||Ki,Ho=Ln.current,_t(Ln,n),_t(Zn,Zn.current),!0}function XE(n,e,t){var r=n.stateNode;if(!r)throw Error(H(169));t?(n=D1(n,e,Ho),r.__reactInternalMemoizedMergedChildContext=n,Tt(Zn),Tt(Ln),_t(Ln,n)):Tt(Zn),_t(Zn,t)}var Ds=null,Qp=!1,zg=!1;function O1(n){Ds===null?Ds=[n]:Ds.push(n)}function GO(n){Qp=!0,O1(n)}function co(){if(!zg&&Ds!==null){zg=!0;var n=0,e=it;try{var t=Ds;for(it=1;n<t.length;n++){var r=t[n];do r=r(!0);while(r!==null)}Ds=null,Qp=!1}catch(s){throw Ds!==null&&(Ds=Ds.slice(n+1)),i1(Ov,co),s}finally{it=e,zg=!1}}return null}var tl=[],nl=0,qf=null,Wf=0,Cr=[],Rr=0,Ko=null,Ms=1,Ls="";function xo(n,e){tl[nl++]=Wf,tl[nl++]=qf,qf=n,Wf=e}function M1(n,e,t){Cr[Rr++]=Ms,Cr[Rr++]=Ls,Cr[Rr++]=Ko,Ko=n;var r=Ms;n=Ls;var s=32-Qr(r)-1;r&=~(1<<s),t+=1;var i=32-Qr(e)+s;if(30<i){var o=s-s%5;i=(r&(1<<o)-1).toString(32),r>>=o,s-=o,Ms=1<<32-Qr(e)+s|t<<s|r,Ls=i+n}else Ms=1<<i|t<<s|r,Ls=n}function zv(n){n.return!==null&&(xo(n,1),M1(n,1,0))}function qv(n){for(;n===qf;)qf=tl[--nl],tl[nl]=null,Wf=tl[--nl],tl[nl]=null;for(;n===Ko;)Ko=Cr[--Rr],Cr[Rr]=null,Ls=Cr[--Rr],Cr[Rr]=null,Ms=Cr[--Rr],Cr[Rr]=null}var gr=null,mr=null,Nt=!1,Gr=null;function L1(n,e){var t=Pr(5,null,null,0);t.elementType="DELETED",t.stateNode=e,t.return=n,e=n.deletions,e===null?(n.deletions=[t],n.flags|=16):e.push(t)}function ZE(n,e){switch(n.tag){case 5:var t=n.type;return e=e.nodeType!==1||t.toLowerCase()!==e.nodeName.toLowerCase()?null:e,e!==null?(n.stateNode=e,gr=n,mr=Mi(e.firstChild),!0):!1;case 6:return e=n.pendingProps===""||e.nodeType!==3?null:e,e!==null?(n.stateNode=e,gr=n,mr=null,!0):!1;case 13:return e=e.nodeType!==8?null:e,e!==null?(t=Ko!==null?{id:Ms,overflow:Ls}:null,n.memoizedState={dehydrated:e,treeContext:t,retryLane:1073741824},t=Pr(18,null,null,0),t.stateNode=e,t.return=n,n.child=t,gr=n,mr=null,!0):!1;default:return!1}}function s_(n){return(n.mode&1)!==0&&(n.flags&128)===0}function i_(n){if(Nt){var e=mr;if(e){var t=e;if(!ZE(n,e)){if(s_(n))throw Error(H(418));e=Mi(t.nextSibling);var r=gr;e&&ZE(n,e)?L1(r,t):(n.flags=n.flags&-4097|2,Nt=!1,gr=n)}}else{if(s_(n))throw Error(H(418));n.flags=n.flags&-4097|2,Nt=!1,gr=n}}}function ex(n){for(n=n.return;n!==null&&n.tag!==5&&n.tag!==3&&n.tag!==13;)n=n.return;gr=n}function Mh(n){if(n!==gr)return!1;if(!Nt)return ex(n),Nt=!0,!1;var e;if((e=n.tag!==3)&&!(e=n.tag!==5)&&(e=n.type,e=e!=="head"&&e!=="body"&&!e_(n.type,n.memoizedProps)),e&&(e=mr)){if(s_(n))throw V1(),Error(H(418));for(;e;)L1(n,e),e=Mi(e.nextSibling)}if(ex(n),n.tag===13){if(n=n.memoizedState,n=n!==null?n.dehydrated:null,!n)throw Error(H(317));e:{for(n=n.nextSibling,e=0;n;){if(n.nodeType===8){var t=n.data;if(t==="/$"){if(e===0){mr=Mi(n.nextSibling);break e}e--}else t!=="$"&&t!=="$!"&&t!=="$?"||e++}n=n.nextSibling}mr=null}}else mr=gr?Mi(n.stateNode.nextSibling):null;return!0}function V1(){for(var n=mr;n;)n=Mi(n.nextSibling)}function xl(){mr=gr=null,Nt=!1}function Wv(n){Gr===null?Gr=[n]:Gr.push(n)}var HO=ei.ReactCurrentBatchConfig;function Oc(n,e,t){if(n=t.ref,n!==null&&typeof n!="function"&&typeof n!="object"){if(t._owner){if(t=t._owner,t){if(t.tag!==1)throw Error(H(309));var r=t.stateNode}if(!r)throw Error(H(147,n));var s=r,i=""+n;return e!==null&&e.ref!==null&&typeof e.ref=="function"&&e.ref._stringRef===i?e.ref:(e=function(o){var a=s.refs;o===null?delete a[i]:a[i]=o},e._stringRef=i,e)}if(typeof n!="string")throw Error(H(284));if(!t._owner)throw Error(H(290,n))}return n}function Lh(n,e){throw n=Object.prototype.toString.call(e),Error(H(31,n==="[object Object]"?"object with keys {"+Object.keys(e).join(", ")+"}":n))}function tx(n){var e=n._init;return e(n._payload)}function F1(n){function e(A,T){if(n){var R=A.deletions;R===null?(A.deletions=[T],A.flags|=16):R.push(T)}}function t(A,T){if(!n)return null;for(;T!==null;)e(A,T),T=T.sibling;return null}function r(A,T){for(A=new Map;T!==null;)T.key!==null?A.set(T.key,T):A.set(T.index,T),T=T.sibling;return A}function s(A,T){return A=ji(A,T),A.index=0,A.sibling=null,A}function i(A,T,R){return A.index=R,n?(R=A.alternate,R!==null?(R=R.index,R<T?(A.flags|=2,T):R):(A.flags|=2,T)):(A.flags|=1048576,T)}function o(A){return n&&A.alternate===null&&(A.flags|=2),A}function a(A,T,R,D){return T===null||T.tag!==6?(T=Yg(R,A.mode,D),T.return=A,T):(T=s(T,R),T.return=A,T)}function l(A,T,R,D){var F=R.type;return F===Qa?h(A,T,R.props.children,D,R.key):T!==null&&(T.elementType===F||typeof F=="object"&&F!==null&&F.$$typeof===mi&&tx(F)===T.type)?(D=s(T,R.props),D.ref=Oc(A,T,R),D.return=A,D):(D=mf(R.type,R.key,R.props,null,A.mode,D),D.ref=Oc(A,T,R),D.return=A,D)}function u(A,T,R,D){return T===null||T.tag!==4||T.stateNode.containerInfo!==R.containerInfo||T.stateNode.implementation!==R.implementation?(T=Jg(R,A.mode,D),T.return=A,T):(T=s(T,R.children||[]),T.return=A,T)}function h(A,T,R,D,F){return T===null||T.tag!==7?(T=Bo(R,A.mode,D,F),T.return=A,T):(T=s(T,R),T.return=A,T)}function f(A,T,R){if(typeof T=="string"&&T!==""||typeof T=="number")return T=Yg(""+T,A.mode,R),T.return=A,T;if(typeof T=="object"&&T!==null){switch(T.$$typeof){case Sh:return R=mf(T.type,T.key,T.props,null,A.mode,R),R.ref=Oc(A,null,T),R.return=A,R;case Ka:return T=Jg(T,A.mode,R),T.return=A,T;case mi:var D=T._init;return f(A,D(T._payload),R)}if(Kc(T)||Rc(T))return T=Bo(T,A.mode,R,null),T.return=A,T;Lh(A,T)}return null}function p(A,T,R,D){var F=T!==null?T.key:null;if(typeof R=="string"&&R!==""||typeof R=="number")return F!==null?null:a(A,T,""+R,D);if(typeof R=="object"&&R!==null){switch(R.$$typeof){case Sh:return R.key===F?l(A,T,R,D):null;case Ka:return R.key===F?u(A,T,R,D):null;case mi:return F=R._init,p(A,T,F(R._payload),D)}if(Kc(R)||Rc(R))return F!==null?null:h(A,T,R,D,null);Lh(A,R)}return null}function y(A,T,R,D,F){if(typeof D=="string"&&D!==""||typeof D=="number")return A=A.get(R)||null,a(T,A,""+D,F);if(typeof D=="object"&&D!==null){switch(D.$$typeof){case Sh:return A=A.get(D.key===null?R:D.key)||null,l(T,A,D,F);case Ka:return A=A.get(D.key===null?R:D.key)||null,u(T,A,D,F);case mi:var k=D._init;return y(A,T,R,k(D._payload),F)}if(Kc(D)||Rc(D))return A=A.get(R)||null,h(T,A,D,F,null);Lh(T,D)}return null}function I(A,T,R,D){for(var F=null,k=null,E=T,_=T=0,b=null;E!==null&&_<R.length;_++){E.index>_?(b=E,E=null):b=E.sibling;var v=p(A,E,R[_],D);if(v===null){E===null&&(E=b);break}n&&E&&v.alternate===null&&e(A,E),T=i(v,T,_),k===null?F=v:k.sibling=v,k=v,E=b}if(_===R.length)return t(A,E),Nt&&xo(A,_),F;if(E===null){for(;_<R.length;_++)E=f(A,R[_],D),E!==null&&(T=i(E,T,_),k===null?F=E:k.sibling=E,k=E);return Nt&&xo(A,_),F}for(E=r(A,E);_<R.length;_++)b=y(E,A,_,R[_],D),b!==null&&(n&&b.alternate!==null&&E.delete(b.key===null?_:b.key),T=i(b,T,_),k===null?F=b:k.sibling=b,k=b);return n&&E.forEach(function(S){return e(A,S)}),Nt&&xo(A,_),F}function C(A,T,R,D){var F=Rc(R);if(typeof F!="function")throw Error(H(150));if(R=F.call(R),R==null)throw Error(H(151));for(var k=F=null,E=T,_=T=0,b=null,v=R.next();E!==null&&!v.done;_++,v=R.next()){E.index>_?(b=E,E=null):b=E.sibling;var S=p(A,E,v.value,D);if(S===null){E===null&&(E=b);break}n&&E&&S.alternate===null&&e(A,E),T=i(S,T,_),k===null?F=S:k.sibling=S,k=S,E=b}if(v.done)return t(A,E),Nt&&xo(A,_),F;if(E===null){for(;!v.done;_++,v=R.next())v=f(A,v.value,D),v!==null&&(T=i(v,T,_),k===null?F=v:k.sibling=v,k=v);return Nt&&xo(A,_),F}for(E=r(A,E);!v.done;_++,v=R.next())v=y(E,A,_,v.value,D),v!==null&&(n&&v.alternate!==null&&E.delete(v.key===null?_:v.key),T=i(v,T,_),k===null?F=v:k.sibling=v,k=v);return n&&E.forEach(function(N){return e(A,N)}),Nt&&xo(A,_),F}function P(A,T,R,D){if(typeof R=="object"&&R!==null&&R.type===Qa&&R.key===null&&(R=R.props.children),typeof R=="object"&&R!==null){switch(R.$$typeof){case Sh:e:{for(var F=R.key,k=T;k!==null;){if(k.key===F){if(F=R.type,F===Qa){if(k.tag===7){t(A,k.sibling),T=s(k,R.props.children),T.return=A,A=T;break e}}else if(k.elementType===F||typeof F=="object"&&F!==null&&F.$$typeof===mi&&tx(F)===k.type){t(A,k.sibling),T=s(k,R.props),T.ref=Oc(A,k,R),T.return=A,A=T;break e}t(A,k);break}else e(A,k);k=k.sibling}R.type===Qa?(T=Bo(R.props.children,A.mode,D,R.key),T.return=A,A=T):(D=mf(R.type,R.key,R.props,null,A.mode,D),D.ref=Oc(A,T,R),D.return=A,A=D)}return o(A);case Ka:e:{for(k=R.key;T!==null;){if(T.key===k)if(T.tag===4&&T.stateNode.containerInfo===R.containerInfo&&T.stateNode.implementation===R.implementation){t(A,T.sibling),T=s(T,R.children||[]),T.return=A,A=T;break e}else{t(A,T);break}else e(A,T);T=T.sibling}T=Jg(R,A.mode,D),T.return=A,A=T}return o(A);case mi:return k=R._init,P(A,T,k(R._payload),D)}if(Kc(R))return I(A,T,R,D);if(Rc(R))return C(A,T,R,D);Lh(A,R)}return typeof R=="string"&&R!==""||typeof R=="number"?(R=""+R,T!==null&&T.tag===6?(t(A,T.sibling),T=s(T,R),T.return=A,A=T):(t(A,T),T=Yg(R,A.mode,D),T.return=A,A=T),o(A)):t(A,T)}return P}var Tl=F1(!0),j1=F1(!1),Gf=lo(null),Hf=null,rl=null,Gv=null;function Hv(){Gv=rl=Hf=null}function Kv(n){var e=Gf.current;Tt(Gf),n._currentValue=e}function o_(n,e,t){for(;n!==null;){var r=n.alternate;if((n.childLanes&e)!==e?(n.childLanes|=e,r!==null&&(r.childLanes|=e)):r!==null&&(r.childLanes&e)!==e&&(r.childLanes|=e),n===t)break;n=n.return}}function ul(n,e){Hf=n,Gv=rl=null,n=n.dependencies,n!==null&&n.firstContext!==null&&(n.lanes&e&&(Qn=!0),n.firstContext=null)}function Mr(n){var e=n._currentValue;if(Gv!==n)if(n={context:n,memoizedValue:e,next:null},rl===null){if(Hf===null)throw Error(H(308));rl=n,Hf.dependencies={lanes:0,firstContext:n}}else rl=rl.next=n;return e}var Oo=null;function Qv(n){Oo===null?Oo=[n]:Oo.push(n)}function U1(n,e,t,r){var s=e.interleaved;return s===null?(t.next=t,Qv(e)):(t.next=s.next,s.next=t),e.interleaved=t,Ws(n,r)}function Ws(n,e){n.lanes|=e;var t=n.alternate;for(t!==null&&(t.lanes|=e),t=n,n=n.return;n!==null;)n.childLanes|=e,t=n.alternate,t!==null&&(t.childLanes|=e),t=n,n=n.return;return t.tag===3?t.stateNode:null}var gi=!1;function Yv(n){n.updateQueue={baseState:n.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function B1(n,e){n=n.updateQueue,e.updateQueue===n&&(e.updateQueue={baseState:n.baseState,firstBaseUpdate:n.firstBaseUpdate,lastBaseUpdate:n.lastBaseUpdate,shared:n.shared,effects:n.effects})}function Bs(n,e){return{eventTime:n,lane:e,tag:0,payload:null,callback:null,next:null}}function Li(n,e,t){var r=n.updateQueue;if(r===null)return null;if(r=r.shared,Ye&2){var s=r.pending;return s===null?e.next=e:(e.next=s.next,s.next=e),r.pending=e,Ws(n,t)}return s=r.interleaved,s===null?(e.next=e,Qv(r)):(e.next=s.next,s.next=e),r.interleaved=e,Ws(n,t)}function cf(n,e,t){if(e=e.updateQueue,e!==null&&(e=e.shared,(t&4194240)!==0)){var r=e.lanes;r&=n.pendingLanes,t|=r,e.lanes=t,Mv(n,t)}}function nx(n,e){var t=n.updateQueue,r=n.alternate;if(r!==null&&(r=r.updateQueue,t===r)){var s=null,i=null;if(t=t.firstBaseUpdate,t!==null){do{var o={eventTime:t.eventTime,lane:t.lane,tag:t.tag,payload:t.payload,callback:t.callback,next:null};i===null?s=i=o:i=i.next=o,t=t.next}while(t!==null);i===null?s=i=e:i=i.next=e}else s=i=e;t={baseState:r.baseState,firstBaseUpdate:s,lastBaseUpdate:i,shared:r.shared,effects:r.effects},n.updateQueue=t;return}n=t.lastBaseUpdate,n===null?t.firstBaseUpdate=e:n.next=e,t.lastBaseUpdate=e}function Kf(n,e,t,r){var s=n.updateQueue;gi=!1;var i=s.firstBaseUpdate,o=s.lastBaseUpdate,a=s.shared.pending;if(a!==null){s.shared.pending=null;var l=a,u=l.next;l.next=null,o===null?i=u:o.next=u,o=l;var h=n.alternate;h!==null&&(h=h.updateQueue,a=h.lastBaseUpdate,a!==o&&(a===null?h.firstBaseUpdate=u:a.next=u,h.lastBaseUpdate=l))}if(i!==null){var f=s.baseState;o=0,h=u=l=null,a=i;do{var p=a.lane,y=a.eventTime;if((r&p)===p){h!==null&&(h=h.next={eventTime:y,lane:0,tag:a.tag,payload:a.payload,callback:a.callback,next:null});e:{var I=n,C=a;switch(p=e,y=t,C.tag){case 1:if(I=C.payload,typeof I=="function"){f=I.call(y,f,p);break e}f=I;break e;case 3:I.flags=I.flags&-65537|128;case 0:if(I=C.payload,p=typeof I=="function"?I.call(y,f,p):I,p==null)break e;f=Ft({},f,p);break e;case 2:gi=!0}}a.callback!==null&&a.lane!==0&&(n.flags|=64,p=s.effects,p===null?s.effects=[a]:p.push(a))}else y={eventTime:y,lane:p,tag:a.tag,payload:a.payload,callback:a.callback,next:null},h===null?(u=h=y,l=f):h=h.next=y,o|=p;if(a=a.next,a===null){if(a=s.shared.pending,a===null)break;p=a,a=p.next,p.next=null,s.lastBaseUpdate=p,s.shared.pending=null}}while(1);if(h===null&&(l=f),s.baseState=l,s.firstBaseUpdate=u,s.lastBaseUpdate=h,e=s.shared.interleaved,e!==null){s=e;do o|=s.lane,s=s.next;while(s!==e)}else i===null&&(s.shared.lanes=0);Yo|=o,n.lanes=o,n.memoizedState=f}}function rx(n,e,t){if(n=e.effects,e.effects=null,n!==null)for(e=0;e<n.length;e++){var r=n[e],s=r.callback;if(s!==null){if(r.callback=null,r=t,typeof s!="function")throw Error(H(191,s));s.call(r)}}}var Nd={},ys=lo(Nd),qu=lo(Nd),Wu=lo(Nd);function Mo(n){if(n===Nd)throw Error(H(174));return n}function Jv(n,e){switch(_t(Wu,e),_t(qu,n),_t(ys,Nd),n=e.nodeType,n){case 9:case 11:e=(e=e.documentElement)?e.namespaceURI:Uy(null,"");break;default:n=n===8?e.parentNode:e,e=n.namespaceURI||null,n=n.tagName,e=Uy(e,n)}Tt(ys),_t(ys,e)}function Sl(){Tt(ys),Tt(qu),Tt(Wu)}function $1(n){Mo(Wu.current);var e=Mo(ys.current),t=Uy(e,n.type);e!==t&&(_t(qu,n),_t(ys,t))}function Xv(n){qu.current===n&&(Tt(ys),Tt(qu))}var Mt=lo(0);function Qf(n){for(var e=n;e!==null;){if(e.tag===13){var t=e.memoizedState;if(t!==null&&(t=t.dehydrated,t===null||t.data==="$?"||t.data==="$!"))return e}else if(e.tag===19&&e.memoizedProps.revealOrder!==void 0){if(e.flags&128)return e}else if(e.child!==null){e.child.return=e,e=e.child;continue}if(e===n)break;for(;e.sibling===null;){if(e.return===null||e.return===n)return null;e=e.return}e.sibling.return=e.return,e=e.sibling}return null}var qg=[];function Zv(){for(var n=0;n<qg.length;n++)qg[n]._workInProgressVersionPrimary=null;qg.length=0}var uf=ei.ReactCurrentDispatcher,Wg=ei.ReactCurrentBatchConfig,Qo=0,Vt=null,Zt=null,cn=null,Yf=!1,du=!1,Gu=0,KO=0;function Cn(){throw Error(H(321))}function e0(n,e){if(e===null)return!1;for(var t=0;t<e.length&&t<n.length;t++)if(!Zr(n[t],e[t]))return!1;return!0}function t0(n,e,t,r,s,i){if(Qo=i,Vt=e,e.memoizedState=null,e.updateQueue=null,e.lanes=0,uf.current=n===null||n.memoizedState===null?XO:ZO,n=t(r,s),du){i=0;do{if(du=!1,Gu=0,25<=i)throw Error(H(301));i+=1,cn=Zt=null,e.updateQueue=null,uf.current=eM,n=t(r,s)}while(du)}if(uf.current=Jf,e=Zt!==null&&Zt.next!==null,Qo=0,cn=Zt=Vt=null,Yf=!1,e)throw Error(H(300));return n}function n0(){var n=Gu!==0;return Gu=0,n}function as(){var n={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return cn===null?Vt.memoizedState=cn=n:cn=cn.next=n,cn}function Lr(){if(Zt===null){var n=Vt.alternate;n=n!==null?n.memoizedState:null}else n=Zt.next;var e=cn===null?Vt.memoizedState:cn.next;if(e!==null)cn=e,Zt=n;else{if(n===null)throw Error(H(310));Zt=n,n={memoizedState:Zt.memoizedState,baseState:Zt.baseState,baseQueue:Zt.baseQueue,queue:Zt.queue,next:null},cn===null?Vt.memoizedState=cn=n:cn=cn.next=n}return cn}function Hu(n,e){return typeof e=="function"?e(n):e}function Gg(n){var e=Lr(),t=e.queue;if(t===null)throw Error(H(311));t.lastRenderedReducer=n;var r=Zt,s=r.baseQueue,i=t.pending;if(i!==null){if(s!==null){var o=s.next;s.next=i.next,i.next=o}r.baseQueue=s=i,t.pending=null}if(s!==null){i=s.next,r=r.baseState;var a=o=null,l=null,u=i;do{var h=u.lane;if((Qo&h)===h)l!==null&&(l=l.next={lane:0,action:u.action,hasEagerState:u.hasEagerState,eagerState:u.eagerState,next:null}),r=u.hasEagerState?u.eagerState:n(r,u.action);else{var f={lane:h,action:u.action,hasEagerState:u.hasEagerState,eagerState:u.eagerState,next:null};l===null?(a=l=f,o=r):l=l.next=f,Vt.lanes|=h,Yo|=h}u=u.next}while(u!==null&&u!==i);l===null?o=r:l.next=a,Zr(r,e.memoizedState)||(Qn=!0),e.memoizedState=r,e.baseState=o,e.baseQueue=l,t.lastRenderedState=r}if(n=t.interleaved,n!==null){s=n;do i=s.lane,Vt.lanes|=i,Yo|=i,s=s.next;while(s!==n)}else s===null&&(t.lanes=0);return[e.memoizedState,t.dispatch]}function Hg(n){var e=Lr(),t=e.queue;if(t===null)throw Error(H(311));t.lastRenderedReducer=n;var r=t.dispatch,s=t.pending,i=e.memoizedState;if(s!==null){t.pending=null;var o=s=s.next;do i=n(i,o.action),o=o.next;while(o!==s);Zr(i,e.memoizedState)||(Qn=!0),e.memoizedState=i,e.baseQueue===null&&(e.baseState=i),t.lastRenderedState=i}return[i,r]}function z1(){}function q1(n,e){var t=Vt,r=Lr(),s=e(),i=!Zr(r.memoizedState,s);if(i&&(r.memoizedState=s,Qn=!0),r=r.queue,r0(H1.bind(null,t,r,n),[n]),r.getSnapshot!==e||i||cn!==null&&cn.memoizedState.tag&1){if(t.flags|=2048,Ku(9,G1.bind(null,t,r,s,e),void 0,null),hn===null)throw Error(H(349));Qo&30||W1(t,e,s)}return s}function W1(n,e,t){n.flags|=16384,n={getSnapshot:e,value:t},e=Vt.updateQueue,e===null?(e={lastEffect:null,stores:null},Vt.updateQueue=e,e.stores=[n]):(t=e.stores,t===null?e.stores=[n]:t.push(n))}function G1(n,e,t,r){e.value=t,e.getSnapshot=r,K1(e)&&Q1(n)}function H1(n,e,t){return t(function(){K1(e)&&Q1(n)})}function K1(n){var e=n.getSnapshot;n=n.value;try{var t=e();return!Zr(n,t)}catch{return!0}}function Q1(n){var e=Ws(n,1);e!==null&&Yr(e,n,1,-1)}function sx(n){var e=as();return typeof n=="function"&&(n=n()),e.memoizedState=e.baseState=n,n={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:Hu,lastRenderedState:n},e.queue=n,n=n.dispatch=JO.bind(null,Vt,n),[e.memoizedState,n]}function Ku(n,e,t,r){return n={tag:n,create:e,destroy:t,deps:r,next:null},e=Vt.updateQueue,e===null?(e={lastEffect:null,stores:null},Vt.updateQueue=e,e.lastEffect=n.next=n):(t=e.lastEffect,t===null?e.lastEffect=n.next=n:(r=t.next,t.next=n,n.next=r,e.lastEffect=n)),n}function Y1(){return Lr().memoizedState}function df(n,e,t,r){var s=as();Vt.flags|=n,s.memoizedState=Ku(1|e,t,void 0,r===void 0?null:r)}function Yp(n,e,t,r){var s=Lr();r=r===void 0?null:r;var i=void 0;if(Zt!==null){var o=Zt.memoizedState;if(i=o.destroy,r!==null&&e0(r,o.deps)){s.memoizedState=Ku(e,t,i,r);return}}Vt.flags|=n,s.memoizedState=Ku(1|e,t,i,r)}function ix(n,e){return df(8390656,8,n,e)}function r0(n,e){return Yp(2048,8,n,e)}function J1(n,e){return Yp(4,2,n,e)}function X1(n,e){return Yp(4,4,n,e)}function Z1(n,e){if(typeof e=="function")return n=n(),e(n),function(){e(null)};if(e!=null)return n=n(),e.current=n,function(){e.current=null}}function eA(n,e,t){return t=t!=null?t.concat([n]):null,Yp(4,4,Z1.bind(null,e,n),t)}function s0(){}function tA(n,e){var t=Lr();e=e===void 0?null:e;var r=t.memoizedState;return r!==null&&e!==null&&e0(e,r[1])?r[0]:(t.memoizedState=[n,e],n)}function nA(n,e){var t=Lr();e=e===void 0?null:e;var r=t.memoizedState;return r!==null&&e!==null&&e0(e,r[1])?r[0]:(n=n(),t.memoizedState=[n,e],n)}function rA(n,e,t){return Qo&21?(Zr(t,e)||(t=l1(),Vt.lanes|=t,Yo|=t,n.baseState=!0),e):(n.baseState&&(n.baseState=!1,Qn=!0),n.memoizedState=t)}function QO(n,e){var t=it;it=t!==0&&4>t?t:4,n(!0);var r=Wg.transition;Wg.transition={};try{n(!1),e()}finally{it=t,Wg.transition=r}}function sA(){return Lr().memoizedState}function YO(n,e,t){var r=Fi(n);if(t={lane:r,action:t,hasEagerState:!1,eagerState:null,next:null},iA(n))oA(e,t);else if(t=U1(n,e,t,r),t!==null){var s=Bn();Yr(t,n,r,s),aA(t,e,r)}}function JO(n,e,t){var r=Fi(n),s={lane:r,action:t,hasEagerState:!1,eagerState:null,next:null};if(iA(n))oA(e,s);else{var i=n.alternate;if(n.lanes===0&&(i===null||i.lanes===0)&&(i=e.lastRenderedReducer,i!==null))try{var o=e.lastRenderedState,a=i(o,t);if(s.hasEagerState=!0,s.eagerState=a,Zr(a,o)){var l=e.interleaved;l===null?(s.next=s,Qv(e)):(s.next=l.next,l.next=s),e.interleaved=s;return}}catch{}finally{}t=U1(n,e,s,r),t!==null&&(s=Bn(),Yr(t,n,r,s),aA(t,e,r))}}function iA(n){var e=n.alternate;return n===Vt||e!==null&&e===Vt}function oA(n,e){du=Yf=!0;var t=n.pending;t===null?e.next=e:(e.next=t.next,t.next=e),n.pending=e}function aA(n,e,t){if(t&4194240){var r=e.lanes;r&=n.pendingLanes,t|=r,e.lanes=t,Mv(n,t)}}var Jf={readContext:Mr,useCallback:Cn,useContext:Cn,useEffect:Cn,useImperativeHandle:Cn,useInsertionEffect:Cn,useLayoutEffect:Cn,useMemo:Cn,useReducer:Cn,useRef:Cn,useState:Cn,useDebugValue:Cn,useDeferredValue:Cn,useTransition:Cn,useMutableSource:Cn,useSyncExternalStore:Cn,useId:Cn,unstable_isNewReconciler:!1},XO={readContext:Mr,useCallback:function(n,e){return as().memoizedState=[n,e===void 0?null:e],n},useContext:Mr,useEffect:ix,useImperativeHandle:function(n,e,t){return t=t!=null?t.concat([n]):null,df(4194308,4,Z1.bind(null,e,n),t)},useLayoutEffect:function(n,e){return df(4194308,4,n,e)},useInsertionEffect:function(n,e){return df(4,2,n,e)},useMemo:function(n,e){var t=as();return e=e===void 0?null:e,n=n(),t.memoizedState=[n,e],n},useReducer:function(n,e,t){var r=as();return e=t!==void 0?t(e):e,r.memoizedState=r.baseState=e,n={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:n,lastRenderedState:e},r.queue=n,n=n.dispatch=YO.bind(null,Vt,n),[r.memoizedState,n]},useRef:function(n){var e=as();return n={current:n},e.memoizedState=n},useState:sx,useDebugValue:s0,useDeferredValue:function(n){return as().memoizedState=n},useTransition:function(){var n=sx(!1),e=n[0];return n=QO.bind(null,n[1]),as().memoizedState=n,[e,n]},useMutableSource:function(){},useSyncExternalStore:function(n,e,t){var r=Vt,s=as();if(Nt){if(t===void 0)throw Error(H(407));t=t()}else{if(t=e(),hn===null)throw Error(H(349));Qo&30||W1(r,e,t)}s.memoizedState=t;var i={value:t,getSnapshot:e};return s.queue=i,ix(H1.bind(null,r,i,n),[n]),r.flags|=2048,Ku(9,G1.bind(null,r,i,t,e),void 0,null),t},useId:function(){var n=as(),e=hn.identifierPrefix;if(Nt){var t=Ls,r=Ms;t=(r&~(1<<32-Qr(r)-1)).toString(32)+t,e=":"+e+"R"+t,t=Gu++,0<t&&(e+="H"+t.toString(32)),e+=":"}else t=KO++,e=":"+e+"r"+t.toString(32)+":";return n.memoizedState=e},unstable_isNewReconciler:!1},ZO={readContext:Mr,useCallback:tA,useContext:Mr,useEffect:r0,useImperativeHandle:eA,useInsertionEffect:J1,useLayoutEffect:X1,useMemo:nA,useReducer:Gg,useRef:Y1,useState:function(){return Gg(Hu)},useDebugValue:s0,useDeferredValue:function(n){var e=Lr();return rA(e,Zt.memoizedState,n)},useTransition:function(){var n=Gg(Hu)[0],e=Lr().memoizedState;return[n,e]},useMutableSource:z1,useSyncExternalStore:q1,useId:sA,unstable_isNewReconciler:!1},eM={readContext:Mr,useCallback:tA,useContext:Mr,useEffect:r0,useImperativeHandle:eA,useInsertionEffect:J1,useLayoutEffect:X1,useMemo:nA,useReducer:Hg,useRef:Y1,useState:function(){return Hg(Hu)},useDebugValue:s0,useDeferredValue:function(n){var e=Lr();return Zt===null?e.memoizedState=n:rA(e,Zt.memoizedState,n)},useTransition:function(){var n=Hg(Hu)[0],e=Lr().memoizedState;return[n,e]},useMutableSource:z1,useSyncExternalStore:q1,useId:sA,unstable_isNewReconciler:!1};function zr(n,e){if(n&&n.defaultProps){e=Ft({},e),n=n.defaultProps;for(var t in n)e[t]===void 0&&(e[t]=n[t]);return e}return e}function a_(n,e,t,r){e=n.memoizedState,t=t(r,e),t=t==null?e:Ft({},e,t),n.memoizedState=t,n.lanes===0&&(n.updateQueue.baseState=t)}var Jp={isMounted:function(n){return(n=n._reactInternals)?ga(n)===n:!1},enqueueSetState:function(n,e,t){n=n._reactInternals;var r=Bn(),s=Fi(n),i=Bs(r,s);i.payload=e,t!=null&&(i.callback=t),e=Li(n,i,s),e!==null&&(Yr(e,n,s,r),cf(e,n,s))},enqueueReplaceState:function(n,e,t){n=n._reactInternals;var r=Bn(),s=Fi(n),i=Bs(r,s);i.tag=1,i.payload=e,t!=null&&(i.callback=t),e=Li(n,i,s),e!==null&&(Yr(e,n,s,r),cf(e,n,s))},enqueueForceUpdate:function(n,e){n=n._reactInternals;var t=Bn(),r=Fi(n),s=Bs(t,r);s.tag=2,e!=null&&(s.callback=e),e=Li(n,s,r),e!==null&&(Yr(e,n,r,t),cf(e,n,r))}};function ox(n,e,t,r,s,i,o){return n=n.stateNode,typeof n.shouldComponentUpdate=="function"?n.shouldComponentUpdate(r,i,o):e.prototype&&e.prototype.isPureReactComponent?!Uu(t,r)||!Uu(s,i):!0}function lA(n,e,t){var r=!1,s=Ki,i=e.contextType;return typeof i=="object"&&i!==null?i=Mr(i):(s=er(e)?Ho:Ln.current,r=e.contextTypes,i=(r=r!=null)?El(n,s):Ki),e=new e(t,i),n.memoizedState=e.state!==null&&e.state!==void 0?e.state:null,e.updater=Jp,n.stateNode=e,e._reactInternals=n,r&&(n=n.stateNode,n.__reactInternalMemoizedUnmaskedChildContext=s,n.__reactInternalMemoizedMaskedChildContext=i),e}function ax(n,e,t,r){n=e.state,typeof e.componentWillReceiveProps=="function"&&e.componentWillReceiveProps(t,r),typeof e.UNSAFE_componentWillReceiveProps=="function"&&e.UNSAFE_componentWillReceiveProps(t,r),e.state!==n&&Jp.enqueueReplaceState(e,e.state,null)}function l_(n,e,t,r){var s=n.stateNode;s.props=t,s.state=n.memoizedState,s.refs={},Yv(n);var i=e.contextType;typeof i=="object"&&i!==null?s.context=Mr(i):(i=er(e)?Ho:Ln.current,s.context=El(n,i)),s.state=n.memoizedState,i=e.getDerivedStateFromProps,typeof i=="function"&&(a_(n,e,i,t),s.state=n.memoizedState),typeof e.getDerivedStateFromProps=="function"||typeof s.getSnapshotBeforeUpdate=="function"||typeof s.UNSAFE_componentWillMount!="function"&&typeof s.componentWillMount!="function"||(e=s.state,typeof s.componentWillMount=="function"&&s.componentWillMount(),typeof s.UNSAFE_componentWillMount=="function"&&s.UNSAFE_componentWillMount(),e!==s.state&&Jp.enqueueReplaceState(s,s.state,null),Kf(n,t,s,r),s.state=n.memoizedState),typeof s.componentDidMount=="function"&&(n.flags|=4194308)}function bl(n,e){try{var t="",r=e;do t+=C2(r),r=r.return;while(r);var s=t}catch(i){s=`
Error generating stack: `+i.message+`
`+i.stack}return{value:n,source:e,stack:s,digest:null}}function Kg(n,e,t){return{value:n,source:null,stack:t??null,digest:e??null}}function c_(n,e){try{console.error(e.value)}catch(t){setTimeout(function(){throw t})}}var tM=typeof WeakMap=="function"?WeakMap:Map;function cA(n,e,t){t=Bs(-1,t),t.tag=3,t.payload={element:null};var r=e.value;return t.callback=function(){Zf||(Zf=!0,v_=r),c_(n,e)},t}function uA(n,e,t){t=Bs(-1,t),t.tag=3;var r=n.type.getDerivedStateFromError;if(typeof r=="function"){var s=e.value;t.payload=function(){return r(s)},t.callback=function(){c_(n,e)}}var i=n.stateNode;return i!==null&&typeof i.componentDidCatch=="function"&&(t.callback=function(){c_(n,e),typeof r!="function"&&(Vi===null?Vi=new Set([this]):Vi.add(this));var o=e.stack;this.componentDidCatch(e.value,{componentStack:o!==null?o:""})}),t}function lx(n,e,t){var r=n.pingCache;if(r===null){r=n.pingCache=new tM;var s=new Set;r.set(e,s)}else s=r.get(e),s===void 0&&(s=new Set,r.set(e,s));s.has(t)||(s.add(t),n=mM.bind(null,n,e,t),e.then(n,n))}function cx(n){do{var e;if((e=n.tag===13)&&(e=n.memoizedState,e=e!==null?e.dehydrated!==null:!0),e)return n;n=n.return}while(n!==null);return null}function ux(n,e,t,r,s){return n.mode&1?(n.flags|=65536,n.lanes=s,n):(n===e?n.flags|=65536:(n.flags|=128,t.flags|=131072,t.flags&=-52805,t.tag===1&&(t.alternate===null?t.tag=17:(e=Bs(-1,1),e.tag=2,Li(t,e,1))),t.lanes|=1),n)}var nM=ei.ReactCurrentOwner,Qn=!1;function jn(n,e,t,r){e.child=n===null?j1(e,null,t,r):Tl(e,n.child,t,r)}function dx(n,e,t,r,s){t=t.render;var i=e.ref;return ul(e,s),r=t0(n,e,t,r,i,s),t=n0(),n!==null&&!Qn?(e.updateQueue=n.updateQueue,e.flags&=-2053,n.lanes&=~s,Gs(n,e,s)):(Nt&&t&&zv(e),e.flags|=1,jn(n,e,r,s),e.child)}function hx(n,e,t,r,s){if(n===null){var i=t.type;return typeof i=="function"&&!h0(i)&&i.defaultProps===void 0&&t.compare===null&&t.defaultProps===void 0?(e.tag=15,e.type=i,dA(n,e,i,r,s)):(n=mf(t.type,null,r,e,e.mode,s),n.ref=e.ref,n.return=e,e.child=n)}if(i=n.child,!(n.lanes&s)){var o=i.memoizedProps;if(t=t.compare,t=t!==null?t:Uu,t(o,r)&&n.ref===e.ref)return Gs(n,e,s)}return e.flags|=1,n=ji(i,r),n.ref=e.ref,n.return=e,e.child=n}function dA(n,e,t,r,s){if(n!==null){var i=n.memoizedProps;if(Uu(i,r)&&n.ref===e.ref)if(Qn=!1,e.pendingProps=r=i,(n.lanes&s)!==0)n.flags&131072&&(Qn=!0);else return e.lanes=n.lanes,Gs(n,e,s)}return u_(n,e,t,r,s)}function hA(n,e,t){var r=e.pendingProps,s=r.children,i=n!==null?n.memoizedState:null;if(r.mode==="hidden")if(!(e.mode&1))e.memoizedState={baseLanes:0,cachePool:null,transitions:null},_t(il,ur),ur|=t;else{if(!(t&1073741824))return n=i!==null?i.baseLanes|t:t,e.lanes=e.childLanes=1073741824,e.memoizedState={baseLanes:n,cachePool:null,transitions:null},e.updateQueue=null,_t(il,ur),ur|=n,null;e.memoizedState={baseLanes:0,cachePool:null,transitions:null},r=i!==null?i.baseLanes:t,_t(il,ur),ur|=r}else i!==null?(r=i.baseLanes|t,e.memoizedState=null):r=t,_t(il,ur),ur|=r;return jn(n,e,s,t),e.child}function fA(n,e){var t=e.ref;(n===null&&t!==null||n!==null&&n.ref!==t)&&(e.flags|=512,e.flags|=2097152)}function u_(n,e,t,r,s){var i=er(t)?Ho:Ln.current;return i=El(e,i),ul(e,s),t=t0(n,e,t,r,i,s),r=n0(),n!==null&&!Qn?(e.updateQueue=n.updateQueue,e.flags&=-2053,n.lanes&=~s,Gs(n,e,s)):(Nt&&r&&zv(e),e.flags|=1,jn(n,e,t,s),e.child)}function fx(n,e,t,r,s){if(er(t)){var i=!0;zf(e)}else i=!1;if(ul(e,s),e.stateNode===null)hf(n,e),lA(e,t,r),l_(e,t,r,s),r=!0;else if(n===null){var o=e.stateNode,a=e.memoizedProps;o.props=a;var l=o.context,u=t.contextType;typeof u=="object"&&u!==null?u=Mr(u):(u=er(t)?Ho:Ln.current,u=El(e,u));var h=t.getDerivedStateFromProps,f=typeof h=="function"||typeof o.getSnapshotBeforeUpdate=="function";f||typeof o.UNSAFE_componentWillReceiveProps!="function"&&typeof o.componentWillReceiveProps!="function"||(a!==r||l!==u)&&ax(e,o,r,u),gi=!1;var p=e.memoizedState;o.state=p,Kf(e,r,o,s),l=e.memoizedState,a!==r||p!==l||Zn.current||gi?(typeof h=="function"&&(a_(e,t,h,r),l=e.memoizedState),(a=gi||ox(e,t,a,r,p,l,u))?(f||typeof o.UNSAFE_componentWillMount!="function"&&typeof o.componentWillMount!="function"||(typeof o.componentWillMount=="function"&&o.componentWillMount(),typeof o.UNSAFE_componentWillMount=="function"&&o.UNSAFE_componentWillMount()),typeof o.componentDidMount=="function"&&(e.flags|=4194308)):(typeof o.componentDidMount=="function"&&(e.flags|=4194308),e.memoizedProps=r,e.memoizedState=l),o.props=r,o.state=l,o.context=u,r=a):(typeof o.componentDidMount=="function"&&(e.flags|=4194308),r=!1)}else{o=e.stateNode,B1(n,e),a=e.memoizedProps,u=e.type===e.elementType?a:zr(e.type,a),o.props=u,f=e.pendingProps,p=o.context,l=t.contextType,typeof l=="object"&&l!==null?l=Mr(l):(l=er(t)?Ho:Ln.current,l=El(e,l));var y=t.getDerivedStateFromProps;(h=typeof y=="function"||typeof o.getSnapshotBeforeUpdate=="function")||typeof o.UNSAFE_componentWillReceiveProps!="function"&&typeof o.componentWillReceiveProps!="function"||(a!==f||p!==l)&&ax(e,o,r,l),gi=!1,p=e.memoizedState,o.state=p,Kf(e,r,o,s);var I=e.memoizedState;a!==f||p!==I||Zn.current||gi?(typeof y=="function"&&(a_(e,t,y,r),I=e.memoizedState),(u=gi||ox(e,t,u,r,p,I,l)||!1)?(h||typeof o.UNSAFE_componentWillUpdate!="function"&&typeof o.componentWillUpdate!="function"||(typeof o.componentWillUpdate=="function"&&o.componentWillUpdate(r,I,l),typeof o.UNSAFE_componentWillUpdate=="function"&&o.UNSAFE_componentWillUpdate(r,I,l)),typeof o.componentDidUpdate=="function"&&(e.flags|=4),typeof o.getSnapshotBeforeUpdate=="function"&&(e.flags|=1024)):(typeof o.componentDidUpdate!="function"||a===n.memoizedProps&&p===n.memoizedState||(e.flags|=4),typeof o.getSnapshotBeforeUpdate!="function"||a===n.memoizedProps&&p===n.memoizedState||(e.flags|=1024),e.memoizedProps=r,e.memoizedState=I),o.props=r,o.state=I,o.context=l,r=u):(typeof o.componentDidUpdate!="function"||a===n.memoizedProps&&p===n.memoizedState||(e.flags|=4),typeof o.getSnapshotBeforeUpdate!="function"||a===n.memoizedProps&&p===n.memoizedState||(e.flags|=1024),r=!1)}return d_(n,e,t,r,i,s)}function d_(n,e,t,r,s,i){fA(n,e);var o=(e.flags&128)!==0;if(!r&&!o)return s&&XE(e,t,!1),Gs(n,e,i);r=e.stateNode,nM.current=e;var a=o&&typeof t.getDerivedStateFromError!="function"?null:r.render();return e.flags|=1,n!==null&&o?(e.child=Tl(e,n.child,null,i),e.child=Tl(e,null,a,i)):jn(n,e,a,i),e.memoizedState=r.state,s&&XE(e,t,!0),e.child}function pA(n){var e=n.stateNode;e.pendingContext?JE(n,e.pendingContext,e.pendingContext!==e.context):e.context&&JE(n,e.context,!1),Jv(n,e.containerInfo)}function px(n,e,t,r,s){return xl(),Wv(s),e.flags|=256,jn(n,e,t,r),e.child}var h_={dehydrated:null,treeContext:null,retryLane:0};function f_(n){return{baseLanes:n,cachePool:null,transitions:null}}function mA(n,e,t){var r=e.pendingProps,s=Mt.current,i=!1,o=(e.flags&128)!==0,a;if((a=o)||(a=n!==null&&n.memoizedState===null?!1:(s&2)!==0),a?(i=!0,e.flags&=-129):(n===null||n.memoizedState!==null)&&(s|=1),_t(Mt,s&1),n===null)return i_(e),n=e.memoizedState,n!==null&&(n=n.dehydrated,n!==null)?(e.mode&1?n.data==="$!"?e.lanes=8:e.lanes=1073741824:e.lanes=1,null):(o=r.children,n=r.fallback,i?(r=e.mode,i=e.child,o={mode:"hidden",children:o},!(r&1)&&i!==null?(i.childLanes=0,i.pendingProps=o):i=em(o,r,0,null),n=Bo(n,r,t,null),i.return=e,n.return=e,i.sibling=n,e.child=i,e.child.memoizedState=f_(t),e.memoizedState=h_,n):i0(e,o));if(s=n.memoizedState,s!==null&&(a=s.dehydrated,a!==null))return rM(n,e,o,r,a,s,t);if(i){i=r.fallback,o=e.mode,s=n.child,a=s.sibling;var l={mode:"hidden",children:r.children};return!(o&1)&&e.child!==s?(r=e.child,r.childLanes=0,r.pendingProps=l,e.deletions=null):(r=ji(s,l),r.subtreeFlags=s.subtreeFlags&14680064),a!==null?i=ji(a,i):(i=Bo(i,o,t,null),i.flags|=2),i.return=e,r.return=e,r.sibling=i,e.child=r,r=i,i=e.child,o=n.child.memoizedState,o=o===null?f_(t):{baseLanes:o.baseLanes|t,cachePool:null,transitions:o.transitions},i.memoizedState=o,i.childLanes=n.childLanes&~t,e.memoizedState=h_,r}return i=n.child,n=i.sibling,r=ji(i,{mode:"visible",children:r.children}),!(e.mode&1)&&(r.lanes=t),r.return=e,r.sibling=null,n!==null&&(t=e.deletions,t===null?(e.deletions=[n],e.flags|=16):t.push(n)),e.child=r,e.memoizedState=null,r}function i0(n,e){return e=em({mode:"visible",children:e},n.mode,0,null),e.return=n,n.child=e}function Vh(n,e,t,r){return r!==null&&Wv(r),Tl(e,n.child,null,t),n=i0(e,e.pendingProps.children),n.flags|=2,e.memoizedState=null,n}function rM(n,e,t,r,s,i,o){if(t)return e.flags&256?(e.flags&=-257,r=Kg(Error(H(422))),Vh(n,e,o,r)):e.memoizedState!==null?(e.child=n.child,e.flags|=128,null):(i=r.fallback,s=e.mode,r=em({mode:"visible",children:r.children},s,0,null),i=Bo(i,s,o,null),i.flags|=2,r.return=e,i.return=e,r.sibling=i,e.child=r,e.mode&1&&Tl(e,n.child,null,o),e.child.memoizedState=f_(o),e.memoizedState=h_,i);if(!(e.mode&1))return Vh(n,e,o,null);if(s.data==="$!"){if(r=s.nextSibling&&s.nextSibling.dataset,r)var a=r.dgst;return r=a,i=Error(H(419)),r=Kg(i,r,void 0),Vh(n,e,o,r)}if(a=(o&n.childLanes)!==0,Qn||a){if(r=hn,r!==null){switch(o&-o){case 4:s=2;break;case 16:s=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:s=32;break;case 536870912:s=268435456;break;default:s=0}s=s&(r.suspendedLanes|o)?0:s,s!==0&&s!==i.retryLane&&(i.retryLane=s,Ws(n,s),Yr(r,n,s,-1))}return d0(),r=Kg(Error(H(421))),Vh(n,e,o,r)}return s.data==="$?"?(e.flags|=128,e.child=n.child,e=gM.bind(null,n),s._reactRetry=e,null):(n=i.treeContext,mr=Mi(s.nextSibling),gr=e,Nt=!0,Gr=null,n!==null&&(Cr[Rr++]=Ms,Cr[Rr++]=Ls,Cr[Rr++]=Ko,Ms=n.id,Ls=n.overflow,Ko=e),e=i0(e,r.children),e.flags|=4096,e)}function mx(n,e,t){n.lanes|=e;var r=n.alternate;r!==null&&(r.lanes|=e),o_(n.return,e,t)}function Qg(n,e,t,r,s){var i=n.memoizedState;i===null?n.memoizedState={isBackwards:e,rendering:null,renderingStartTime:0,last:r,tail:t,tailMode:s}:(i.isBackwards=e,i.rendering=null,i.renderingStartTime=0,i.last=r,i.tail=t,i.tailMode=s)}function gA(n,e,t){var r=e.pendingProps,s=r.revealOrder,i=r.tail;if(jn(n,e,r.children,t),r=Mt.current,r&2)r=r&1|2,e.flags|=128;else{if(n!==null&&n.flags&128)e:for(n=e.child;n!==null;){if(n.tag===13)n.memoizedState!==null&&mx(n,t,e);else if(n.tag===19)mx(n,t,e);else if(n.child!==null){n.child.return=n,n=n.child;continue}if(n===e)break e;for(;n.sibling===null;){if(n.return===null||n.return===e)break e;n=n.return}n.sibling.return=n.return,n=n.sibling}r&=1}if(_t(Mt,r),!(e.mode&1))e.memoizedState=null;else switch(s){case"forwards":for(t=e.child,s=null;t!==null;)n=t.alternate,n!==null&&Qf(n)===null&&(s=t),t=t.sibling;t=s,t===null?(s=e.child,e.child=null):(s=t.sibling,t.sibling=null),Qg(e,!1,s,t,i);break;case"backwards":for(t=null,s=e.child,e.child=null;s!==null;){if(n=s.alternate,n!==null&&Qf(n)===null){e.child=s;break}n=s.sibling,s.sibling=t,t=s,s=n}Qg(e,!0,t,null,i);break;case"together":Qg(e,!1,null,null,void 0);break;default:e.memoizedState=null}return e.child}function hf(n,e){!(e.mode&1)&&n!==null&&(n.alternate=null,e.alternate=null,e.flags|=2)}function Gs(n,e,t){if(n!==null&&(e.dependencies=n.dependencies),Yo|=e.lanes,!(t&e.childLanes))return null;if(n!==null&&e.child!==n.child)throw Error(H(153));if(e.child!==null){for(n=e.child,t=ji(n,n.pendingProps),e.child=t,t.return=e;n.sibling!==null;)n=n.sibling,t=t.sibling=ji(n,n.pendingProps),t.return=e;t.sibling=null}return e.child}function sM(n,e,t){switch(e.tag){case 3:pA(e),xl();break;case 5:$1(e);break;case 1:er(e.type)&&zf(e);break;case 4:Jv(e,e.stateNode.containerInfo);break;case 10:var r=e.type._context,s=e.memoizedProps.value;_t(Gf,r._currentValue),r._currentValue=s;break;case 13:if(r=e.memoizedState,r!==null)return r.dehydrated!==null?(_t(Mt,Mt.current&1),e.flags|=128,null):t&e.child.childLanes?mA(n,e,t):(_t(Mt,Mt.current&1),n=Gs(n,e,t),n!==null?n.sibling:null);_t(Mt,Mt.current&1);break;case 19:if(r=(t&e.childLanes)!==0,n.flags&128){if(r)return gA(n,e,t);e.flags|=128}if(s=e.memoizedState,s!==null&&(s.rendering=null,s.tail=null,s.lastEffect=null),_t(Mt,Mt.current),r)break;return null;case 22:case 23:return e.lanes=0,hA(n,e,t)}return Gs(n,e,t)}var yA,p_,_A,vA;yA=function(n,e){for(var t=e.child;t!==null;){if(t.tag===5||t.tag===6)n.appendChild(t.stateNode);else if(t.tag!==4&&t.child!==null){t.child.return=t,t=t.child;continue}if(t===e)break;for(;t.sibling===null;){if(t.return===null||t.return===e)return;t=t.return}t.sibling.return=t.return,t=t.sibling}};p_=function(){};_A=function(n,e,t,r){var s=n.memoizedProps;if(s!==r){n=e.stateNode,Mo(ys.current);var i=null;switch(t){case"input":s=Ly(n,s),r=Ly(n,r),i=[];break;case"select":s=Ft({},s,{value:void 0}),r=Ft({},r,{value:void 0}),i=[];break;case"textarea":s=jy(n,s),r=jy(n,r),i=[];break;default:typeof s.onClick!="function"&&typeof r.onClick=="function"&&(n.onclick=Bf)}By(t,r);var o;t=null;for(u in s)if(!r.hasOwnProperty(u)&&s.hasOwnProperty(u)&&s[u]!=null)if(u==="style"){var a=s[u];for(o in a)a.hasOwnProperty(o)&&(t||(t={}),t[o]="")}else u!=="dangerouslySetInnerHTML"&&u!=="children"&&u!=="suppressContentEditableWarning"&&u!=="suppressHydrationWarning"&&u!=="autoFocus"&&(Du.hasOwnProperty(u)?i||(i=[]):(i=i||[]).push(u,null));for(u in r){var l=r[u];if(a=s!=null?s[u]:void 0,r.hasOwnProperty(u)&&l!==a&&(l!=null||a!=null))if(u==="style")if(a){for(o in a)!a.hasOwnProperty(o)||l&&l.hasOwnProperty(o)||(t||(t={}),t[o]="");for(o in l)l.hasOwnProperty(o)&&a[o]!==l[o]&&(t||(t={}),t[o]=l[o])}else t||(i||(i=[]),i.push(u,t)),t=l;else u==="dangerouslySetInnerHTML"?(l=l?l.__html:void 0,a=a?a.__html:void 0,l!=null&&a!==l&&(i=i||[]).push(u,l)):u==="children"?typeof l!="string"&&typeof l!="number"||(i=i||[]).push(u,""+l):u!=="suppressContentEditableWarning"&&u!=="suppressHydrationWarning"&&(Du.hasOwnProperty(u)?(l!=null&&u==="onScroll"&&Et("scroll",n),i||a===l||(i=[])):(i=i||[]).push(u,l))}t&&(i=i||[]).push("style",t);var u=i;(e.updateQueue=u)&&(e.flags|=4)}};vA=function(n,e,t,r){t!==r&&(e.flags|=4)};function Mc(n,e){if(!Nt)switch(n.tailMode){case"hidden":e=n.tail;for(var t=null;e!==null;)e.alternate!==null&&(t=e),e=e.sibling;t===null?n.tail=null:t.sibling=null;break;case"collapsed":t=n.tail;for(var r=null;t!==null;)t.alternate!==null&&(r=t),t=t.sibling;r===null?e||n.tail===null?n.tail=null:n.tail.sibling=null:r.sibling=null}}function Rn(n){var e=n.alternate!==null&&n.alternate.child===n.child,t=0,r=0;if(e)for(var s=n.child;s!==null;)t|=s.lanes|s.childLanes,r|=s.subtreeFlags&14680064,r|=s.flags&14680064,s.return=n,s=s.sibling;else for(s=n.child;s!==null;)t|=s.lanes|s.childLanes,r|=s.subtreeFlags,r|=s.flags,s.return=n,s=s.sibling;return n.subtreeFlags|=r,n.childLanes=t,e}function iM(n,e,t){var r=e.pendingProps;switch(qv(e),e.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Rn(e),null;case 1:return er(e.type)&&$f(),Rn(e),null;case 3:return r=e.stateNode,Sl(),Tt(Zn),Tt(Ln),Zv(),r.pendingContext&&(r.context=r.pendingContext,r.pendingContext=null),(n===null||n.child===null)&&(Mh(e)?e.flags|=4:n===null||n.memoizedState.isDehydrated&&!(e.flags&256)||(e.flags|=1024,Gr!==null&&(E_(Gr),Gr=null))),p_(n,e),Rn(e),null;case 5:Xv(e);var s=Mo(Wu.current);if(t=e.type,n!==null&&e.stateNode!=null)_A(n,e,t,r,s),n.ref!==e.ref&&(e.flags|=512,e.flags|=2097152);else{if(!r){if(e.stateNode===null)throw Error(H(166));return Rn(e),null}if(n=Mo(ys.current),Mh(e)){r=e.stateNode,t=e.type;var i=e.memoizedProps;switch(r[us]=e,r[zu]=i,n=(e.mode&1)!==0,t){case"dialog":Et("cancel",r),Et("close",r);break;case"iframe":case"object":case"embed":Et("load",r);break;case"video":case"audio":for(s=0;s<Yc.length;s++)Et(Yc[s],r);break;case"source":Et("error",r);break;case"img":case"image":case"link":Et("error",r),Et("load",r);break;case"details":Et("toggle",r);break;case"input":TE(r,i),Et("invalid",r);break;case"select":r._wrapperState={wasMultiple:!!i.multiple},Et("invalid",r);break;case"textarea":bE(r,i),Et("invalid",r)}By(t,i),s=null;for(var o in i)if(i.hasOwnProperty(o)){var a=i[o];o==="children"?typeof a=="string"?r.textContent!==a&&(i.suppressHydrationWarning!==!0&&Oh(r.textContent,a,n),s=["children",a]):typeof a=="number"&&r.textContent!==""+a&&(i.suppressHydrationWarning!==!0&&Oh(r.textContent,a,n),s=["children",""+a]):Du.hasOwnProperty(o)&&a!=null&&o==="onScroll"&&Et("scroll",r)}switch(t){case"input":bh(r),SE(r,i,!0);break;case"textarea":bh(r),AE(r);break;case"select":case"option":break;default:typeof i.onClick=="function"&&(r.onclick=Bf)}r=s,e.updateQueue=r,r!==null&&(e.flags|=4)}else{o=s.nodeType===9?s:s.ownerDocument,n==="http://www.w3.org/1999/xhtml"&&(n=Hb(t)),n==="http://www.w3.org/1999/xhtml"?t==="script"?(n=o.createElement("div"),n.innerHTML="<script><\/script>",n=n.removeChild(n.firstChild)):typeof r.is=="string"?n=o.createElement(t,{is:r.is}):(n=o.createElement(t),t==="select"&&(o=n,r.multiple?o.multiple=!0:r.size&&(o.size=r.size))):n=o.createElementNS(n,t),n[us]=e,n[zu]=r,yA(n,e,!1,!1),e.stateNode=n;e:{switch(o=$y(t,r),t){case"dialog":Et("cancel",n),Et("close",n),s=r;break;case"iframe":case"object":case"embed":Et("load",n),s=r;break;case"video":case"audio":for(s=0;s<Yc.length;s++)Et(Yc[s],n);s=r;break;case"source":Et("error",n),s=r;break;case"img":case"image":case"link":Et("error",n),Et("load",n),s=r;break;case"details":Et("toggle",n),s=r;break;case"input":TE(n,r),s=Ly(n,r),Et("invalid",n);break;case"option":s=r;break;case"select":n._wrapperState={wasMultiple:!!r.multiple},s=Ft({},r,{value:void 0}),Et("invalid",n);break;case"textarea":bE(n,r),s=jy(n,r),Et("invalid",n);break;default:s=r}By(t,s),a=s;for(i in a)if(a.hasOwnProperty(i)){var l=a[i];i==="style"?Yb(n,l):i==="dangerouslySetInnerHTML"?(l=l?l.__html:void 0,l!=null&&Kb(n,l)):i==="children"?typeof l=="string"?(t!=="textarea"||l!=="")&&Ou(n,l):typeof l=="number"&&Ou(n,""+l):i!=="suppressContentEditableWarning"&&i!=="suppressHydrationWarning"&&i!=="autoFocus"&&(Du.hasOwnProperty(i)?l!=null&&i==="onScroll"&&Et("scroll",n):l!=null&&Rv(n,i,l,o))}switch(t){case"input":bh(n),SE(n,r,!1);break;case"textarea":bh(n),AE(n);break;case"option":r.value!=null&&n.setAttribute("value",""+Hi(r.value));break;case"select":n.multiple=!!r.multiple,i=r.value,i!=null?ol(n,!!r.multiple,i,!1):r.defaultValue!=null&&ol(n,!!r.multiple,r.defaultValue,!0);break;default:typeof s.onClick=="function"&&(n.onclick=Bf)}switch(t){case"button":case"input":case"select":case"textarea":r=!!r.autoFocus;break e;case"img":r=!0;break e;default:r=!1}}r&&(e.flags|=4)}e.ref!==null&&(e.flags|=512,e.flags|=2097152)}return Rn(e),null;case 6:if(n&&e.stateNode!=null)vA(n,e,n.memoizedProps,r);else{if(typeof r!="string"&&e.stateNode===null)throw Error(H(166));if(t=Mo(Wu.current),Mo(ys.current),Mh(e)){if(r=e.stateNode,t=e.memoizedProps,r[us]=e,(i=r.nodeValue!==t)&&(n=gr,n!==null))switch(n.tag){case 3:Oh(r.nodeValue,t,(n.mode&1)!==0);break;case 5:n.memoizedProps.suppressHydrationWarning!==!0&&Oh(r.nodeValue,t,(n.mode&1)!==0)}i&&(e.flags|=4)}else r=(t.nodeType===9?t:t.ownerDocument).createTextNode(r),r[us]=e,e.stateNode=r}return Rn(e),null;case 13:if(Tt(Mt),r=e.memoizedState,n===null||n.memoizedState!==null&&n.memoizedState.dehydrated!==null){if(Nt&&mr!==null&&e.mode&1&&!(e.flags&128))V1(),xl(),e.flags|=98560,i=!1;else if(i=Mh(e),r!==null&&r.dehydrated!==null){if(n===null){if(!i)throw Error(H(318));if(i=e.memoizedState,i=i!==null?i.dehydrated:null,!i)throw Error(H(317));i[us]=e}else xl(),!(e.flags&128)&&(e.memoizedState=null),e.flags|=4;Rn(e),i=!1}else Gr!==null&&(E_(Gr),Gr=null),i=!0;if(!i)return e.flags&65536?e:null}return e.flags&128?(e.lanes=t,e):(r=r!==null,r!==(n!==null&&n.memoizedState!==null)&&r&&(e.child.flags|=8192,e.mode&1&&(n===null||Mt.current&1?tn===0&&(tn=3):d0())),e.updateQueue!==null&&(e.flags|=4),Rn(e),null);case 4:return Sl(),p_(n,e),n===null&&Bu(e.stateNode.containerInfo),Rn(e),null;case 10:return Kv(e.type._context),Rn(e),null;case 17:return er(e.type)&&$f(),Rn(e),null;case 19:if(Tt(Mt),i=e.memoizedState,i===null)return Rn(e),null;if(r=(e.flags&128)!==0,o=i.rendering,o===null)if(r)Mc(i,!1);else{if(tn!==0||n!==null&&n.flags&128)for(n=e.child;n!==null;){if(o=Qf(n),o!==null){for(e.flags|=128,Mc(i,!1),r=o.updateQueue,r!==null&&(e.updateQueue=r,e.flags|=4),e.subtreeFlags=0,r=t,t=e.child;t!==null;)i=t,n=r,i.flags&=14680066,o=i.alternate,o===null?(i.childLanes=0,i.lanes=n,i.child=null,i.subtreeFlags=0,i.memoizedProps=null,i.memoizedState=null,i.updateQueue=null,i.dependencies=null,i.stateNode=null):(i.childLanes=o.childLanes,i.lanes=o.lanes,i.child=o.child,i.subtreeFlags=0,i.deletions=null,i.memoizedProps=o.memoizedProps,i.memoizedState=o.memoizedState,i.updateQueue=o.updateQueue,i.type=o.type,n=o.dependencies,i.dependencies=n===null?null:{lanes:n.lanes,firstContext:n.firstContext}),t=t.sibling;return _t(Mt,Mt.current&1|2),e.child}n=n.sibling}i.tail!==null&&Wt()>Al&&(e.flags|=128,r=!0,Mc(i,!1),e.lanes=4194304)}else{if(!r)if(n=Qf(o),n!==null){if(e.flags|=128,r=!0,t=n.updateQueue,t!==null&&(e.updateQueue=t,e.flags|=4),Mc(i,!0),i.tail===null&&i.tailMode==="hidden"&&!o.alternate&&!Nt)return Rn(e),null}else 2*Wt()-i.renderingStartTime>Al&&t!==1073741824&&(e.flags|=128,r=!0,Mc(i,!1),e.lanes=4194304);i.isBackwards?(o.sibling=e.child,e.child=o):(t=i.last,t!==null?t.sibling=o:e.child=o,i.last=o)}return i.tail!==null?(e=i.tail,i.rendering=e,i.tail=e.sibling,i.renderingStartTime=Wt(),e.sibling=null,t=Mt.current,_t(Mt,r?t&1|2:t&1),e):(Rn(e),null);case 22:case 23:return u0(),r=e.memoizedState!==null,n!==null&&n.memoizedState!==null!==r&&(e.flags|=8192),r&&e.mode&1?ur&1073741824&&(Rn(e),e.subtreeFlags&6&&(e.flags|=8192)):Rn(e),null;case 24:return null;case 25:return null}throw Error(H(156,e.tag))}function oM(n,e){switch(qv(e),e.tag){case 1:return er(e.type)&&$f(),n=e.flags,n&65536?(e.flags=n&-65537|128,e):null;case 3:return Sl(),Tt(Zn),Tt(Ln),Zv(),n=e.flags,n&65536&&!(n&128)?(e.flags=n&-65537|128,e):null;case 5:return Xv(e),null;case 13:if(Tt(Mt),n=e.memoizedState,n!==null&&n.dehydrated!==null){if(e.alternate===null)throw Error(H(340));xl()}return n=e.flags,n&65536?(e.flags=n&-65537|128,e):null;case 19:return Tt(Mt),null;case 4:return Sl(),null;case 10:return Kv(e.type._context),null;case 22:case 23:return u0(),null;case 24:return null;default:return null}}var Fh=!1,kn=!1,aM=typeof WeakSet=="function"?WeakSet:Set,oe=null;function sl(n,e){var t=n.ref;if(t!==null)if(typeof t=="function")try{t(null)}catch(r){Bt(n,e,r)}else t.current=null}function m_(n,e,t){try{t()}catch(r){Bt(n,e,r)}}var gx=!1;function lM(n,e){if(Xy=Ff,n=T1(),$v(n)){if("selectionStart"in n)var t={start:n.selectionStart,end:n.selectionEnd};else e:{t=(t=n.ownerDocument)&&t.defaultView||window;var r=t.getSelection&&t.getSelection();if(r&&r.rangeCount!==0){t=r.anchorNode;var s=r.anchorOffset,i=r.focusNode;r=r.focusOffset;try{t.nodeType,i.nodeType}catch{t=null;break e}var o=0,a=-1,l=-1,u=0,h=0,f=n,p=null;t:for(;;){for(var y;f!==t||s!==0&&f.nodeType!==3||(a=o+s),f!==i||r!==0&&f.nodeType!==3||(l=o+r),f.nodeType===3&&(o+=f.nodeValue.length),(y=f.firstChild)!==null;)p=f,f=y;for(;;){if(f===n)break t;if(p===t&&++u===s&&(a=o),p===i&&++h===r&&(l=o),(y=f.nextSibling)!==null)break;f=p,p=f.parentNode}f=y}t=a===-1||l===-1?null:{start:a,end:l}}else t=null}t=t||{start:0,end:0}}else t=null;for(Zy={focusedElem:n,selectionRange:t},Ff=!1,oe=e;oe!==null;)if(e=oe,n=e.child,(e.subtreeFlags&1028)!==0&&n!==null)n.return=e,oe=n;else for(;oe!==null;){e=oe;try{var I=e.alternate;if(e.flags&1024)switch(e.tag){case 0:case 11:case 15:break;case 1:if(I!==null){var C=I.memoizedProps,P=I.memoizedState,A=e.stateNode,T=A.getSnapshotBeforeUpdate(e.elementType===e.type?C:zr(e.type,C),P);A.__reactInternalSnapshotBeforeUpdate=T}break;case 3:var R=e.stateNode.containerInfo;R.nodeType===1?R.textContent="":R.nodeType===9&&R.documentElement&&R.removeChild(R.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(H(163))}}catch(D){Bt(e,e.return,D)}if(n=e.sibling,n!==null){n.return=e.return,oe=n;break}oe=e.return}return I=gx,gx=!1,I}function hu(n,e,t){var r=e.updateQueue;if(r=r!==null?r.lastEffect:null,r!==null){var s=r=r.next;do{if((s.tag&n)===n){var i=s.destroy;s.destroy=void 0,i!==void 0&&m_(e,t,i)}s=s.next}while(s!==r)}}function Xp(n,e){if(e=e.updateQueue,e=e!==null?e.lastEffect:null,e!==null){var t=e=e.next;do{if((t.tag&n)===n){var r=t.create;t.destroy=r()}t=t.next}while(t!==e)}}function g_(n){var e=n.ref;if(e!==null){var t=n.stateNode;switch(n.tag){case 5:n=t;break;default:n=t}typeof e=="function"?e(n):e.current=n}}function wA(n){var e=n.alternate;e!==null&&(n.alternate=null,wA(e)),n.child=null,n.deletions=null,n.sibling=null,n.tag===5&&(e=n.stateNode,e!==null&&(delete e[us],delete e[zu],delete e[n_],delete e[qO],delete e[WO])),n.stateNode=null,n.return=null,n.dependencies=null,n.memoizedProps=null,n.memoizedState=null,n.pendingProps=null,n.stateNode=null,n.updateQueue=null}function IA(n){return n.tag===5||n.tag===3||n.tag===4}function yx(n){e:for(;;){for(;n.sibling===null;){if(n.return===null||IA(n.return))return null;n=n.return}for(n.sibling.return=n.return,n=n.sibling;n.tag!==5&&n.tag!==6&&n.tag!==18;){if(n.flags&2||n.child===null||n.tag===4)continue e;n.child.return=n,n=n.child}if(!(n.flags&2))return n.stateNode}}function y_(n,e,t){var r=n.tag;if(r===5||r===6)n=n.stateNode,e?t.nodeType===8?t.parentNode.insertBefore(n,e):t.insertBefore(n,e):(t.nodeType===8?(e=t.parentNode,e.insertBefore(n,t)):(e=t,e.appendChild(n)),t=t._reactRootContainer,t!=null||e.onclick!==null||(e.onclick=Bf));else if(r!==4&&(n=n.child,n!==null))for(y_(n,e,t),n=n.sibling;n!==null;)y_(n,e,t),n=n.sibling}function __(n,e,t){var r=n.tag;if(r===5||r===6)n=n.stateNode,e?t.insertBefore(n,e):t.appendChild(n);else if(r!==4&&(n=n.child,n!==null))for(__(n,e,t),n=n.sibling;n!==null;)__(n,e,t),n=n.sibling}var wn=null,qr=!1;function ui(n,e,t){for(t=t.child;t!==null;)EA(n,e,t),t=t.sibling}function EA(n,e,t){if(gs&&typeof gs.onCommitFiberUnmount=="function")try{gs.onCommitFiberUnmount(qp,t)}catch{}switch(t.tag){case 5:kn||sl(t,e);case 6:var r=wn,s=qr;wn=null,ui(n,e,t),wn=r,qr=s,wn!==null&&(qr?(n=wn,t=t.stateNode,n.nodeType===8?n.parentNode.removeChild(t):n.removeChild(t)):wn.removeChild(t.stateNode));break;case 18:wn!==null&&(qr?(n=wn,t=t.stateNode,n.nodeType===8?$g(n.parentNode,t):n.nodeType===1&&$g(n,t),Fu(n)):$g(wn,t.stateNode));break;case 4:r=wn,s=qr,wn=t.stateNode.containerInfo,qr=!0,ui(n,e,t),wn=r,qr=s;break;case 0:case 11:case 14:case 15:if(!kn&&(r=t.updateQueue,r!==null&&(r=r.lastEffect,r!==null))){s=r=r.next;do{var i=s,o=i.destroy;i=i.tag,o!==void 0&&(i&2||i&4)&&m_(t,e,o),s=s.next}while(s!==r)}ui(n,e,t);break;case 1:if(!kn&&(sl(t,e),r=t.stateNode,typeof r.componentWillUnmount=="function"))try{r.props=t.memoizedProps,r.state=t.memoizedState,r.componentWillUnmount()}catch(a){Bt(t,e,a)}ui(n,e,t);break;case 21:ui(n,e,t);break;case 22:t.mode&1?(kn=(r=kn)||t.memoizedState!==null,ui(n,e,t),kn=r):ui(n,e,t);break;default:ui(n,e,t)}}function _x(n){var e=n.updateQueue;if(e!==null){n.updateQueue=null;var t=n.stateNode;t===null&&(t=n.stateNode=new aM),e.forEach(function(r){var s=yM.bind(null,n,r);t.has(r)||(t.add(r),r.then(s,s))})}}function $r(n,e){var t=e.deletions;if(t!==null)for(var r=0;r<t.length;r++){var s=t[r];try{var i=n,o=e,a=o;e:for(;a!==null;){switch(a.tag){case 5:wn=a.stateNode,qr=!1;break e;case 3:wn=a.stateNode.containerInfo,qr=!0;break e;case 4:wn=a.stateNode.containerInfo,qr=!0;break e}a=a.return}if(wn===null)throw Error(H(160));EA(i,o,s),wn=null,qr=!1;var l=s.alternate;l!==null&&(l.return=null),s.return=null}catch(u){Bt(s,e,u)}}if(e.subtreeFlags&12854)for(e=e.child;e!==null;)xA(e,n),e=e.sibling}function xA(n,e){var t=n.alternate,r=n.flags;switch(n.tag){case 0:case 11:case 14:case 15:if($r(e,n),os(n),r&4){try{hu(3,n,n.return),Xp(3,n)}catch(C){Bt(n,n.return,C)}try{hu(5,n,n.return)}catch(C){Bt(n,n.return,C)}}break;case 1:$r(e,n),os(n),r&512&&t!==null&&sl(t,t.return);break;case 5:if($r(e,n),os(n),r&512&&t!==null&&sl(t,t.return),n.flags&32){var s=n.stateNode;try{Ou(s,"")}catch(C){Bt(n,n.return,C)}}if(r&4&&(s=n.stateNode,s!=null)){var i=n.memoizedProps,o=t!==null?t.memoizedProps:i,a=n.type,l=n.updateQueue;if(n.updateQueue=null,l!==null)try{a==="input"&&i.type==="radio"&&i.name!=null&&Wb(s,i),$y(a,o);var u=$y(a,i);for(o=0;o<l.length;o+=2){var h=l[o],f=l[o+1];h==="style"?Yb(s,f):h==="dangerouslySetInnerHTML"?Kb(s,f):h==="children"?Ou(s,f):Rv(s,h,f,u)}switch(a){case"input":Vy(s,i);break;case"textarea":Gb(s,i);break;case"select":var p=s._wrapperState.wasMultiple;s._wrapperState.wasMultiple=!!i.multiple;var y=i.value;y!=null?ol(s,!!i.multiple,y,!1):p!==!!i.multiple&&(i.defaultValue!=null?ol(s,!!i.multiple,i.defaultValue,!0):ol(s,!!i.multiple,i.multiple?[]:"",!1))}s[zu]=i}catch(C){Bt(n,n.return,C)}}break;case 6:if($r(e,n),os(n),r&4){if(n.stateNode===null)throw Error(H(162));s=n.stateNode,i=n.memoizedProps;try{s.nodeValue=i}catch(C){Bt(n,n.return,C)}}break;case 3:if($r(e,n),os(n),r&4&&t!==null&&t.memoizedState.isDehydrated)try{Fu(e.containerInfo)}catch(C){Bt(n,n.return,C)}break;case 4:$r(e,n),os(n);break;case 13:$r(e,n),os(n),s=n.child,s.flags&8192&&(i=s.memoizedState!==null,s.stateNode.isHidden=i,!i||s.alternate!==null&&s.alternate.memoizedState!==null||(l0=Wt())),r&4&&_x(n);break;case 22:if(h=t!==null&&t.memoizedState!==null,n.mode&1?(kn=(u=kn)||h,$r(e,n),kn=u):$r(e,n),os(n),r&8192){if(u=n.memoizedState!==null,(n.stateNode.isHidden=u)&&!h&&n.mode&1)for(oe=n,h=n.child;h!==null;){for(f=oe=h;oe!==null;){switch(p=oe,y=p.child,p.tag){case 0:case 11:case 14:case 15:hu(4,p,p.return);break;case 1:sl(p,p.return);var I=p.stateNode;if(typeof I.componentWillUnmount=="function"){r=p,t=p.return;try{e=r,I.props=e.memoizedProps,I.state=e.memoizedState,I.componentWillUnmount()}catch(C){Bt(r,t,C)}}break;case 5:sl(p,p.return);break;case 22:if(p.memoizedState!==null){wx(f);continue}}y!==null?(y.return=p,oe=y):wx(f)}h=h.sibling}e:for(h=null,f=n;;){if(f.tag===5){if(h===null){h=f;try{s=f.stateNode,u?(i=s.style,typeof i.setProperty=="function"?i.setProperty("display","none","important"):i.display="none"):(a=f.stateNode,l=f.memoizedProps.style,o=l!=null&&l.hasOwnProperty("display")?l.display:null,a.style.display=Qb("display",o))}catch(C){Bt(n,n.return,C)}}}else if(f.tag===6){if(h===null)try{f.stateNode.nodeValue=u?"":f.memoizedProps}catch(C){Bt(n,n.return,C)}}else if((f.tag!==22&&f.tag!==23||f.memoizedState===null||f===n)&&f.child!==null){f.child.return=f,f=f.child;continue}if(f===n)break e;for(;f.sibling===null;){if(f.return===null||f.return===n)break e;h===f&&(h=null),f=f.return}h===f&&(h=null),f.sibling.return=f.return,f=f.sibling}}break;case 19:$r(e,n),os(n),r&4&&_x(n);break;case 21:break;default:$r(e,n),os(n)}}function os(n){var e=n.flags;if(e&2){try{e:{for(var t=n.return;t!==null;){if(IA(t)){var r=t;break e}t=t.return}throw Error(H(160))}switch(r.tag){case 5:var s=r.stateNode;r.flags&32&&(Ou(s,""),r.flags&=-33);var i=yx(n);__(n,i,s);break;case 3:case 4:var o=r.stateNode.containerInfo,a=yx(n);y_(n,a,o);break;default:throw Error(H(161))}}catch(l){Bt(n,n.return,l)}n.flags&=-3}e&4096&&(n.flags&=-4097)}function cM(n,e,t){oe=n,TA(n)}function TA(n,e,t){for(var r=(n.mode&1)!==0;oe!==null;){var s=oe,i=s.child;if(s.tag===22&&r){var o=s.memoizedState!==null||Fh;if(!o){var a=s.alternate,l=a!==null&&a.memoizedState!==null||kn;a=Fh;var u=kn;if(Fh=o,(kn=l)&&!u)for(oe=s;oe!==null;)o=oe,l=o.child,o.tag===22&&o.memoizedState!==null?Ix(s):l!==null?(l.return=o,oe=l):Ix(s);for(;i!==null;)oe=i,TA(i),i=i.sibling;oe=s,Fh=a,kn=u}vx(n)}else s.subtreeFlags&8772&&i!==null?(i.return=s,oe=i):vx(n)}}function vx(n){for(;oe!==null;){var e=oe;if(e.flags&8772){var t=e.alternate;try{if(e.flags&8772)switch(e.tag){case 0:case 11:case 15:kn||Xp(5,e);break;case 1:var r=e.stateNode;if(e.flags&4&&!kn)if(t===null)r.componentDidMount();else{var s=e.elementType===e.type?t.memoizedProps:zr(e.type,t.memoizedProps);r.componentDidUpdate(s,t.memoizedState,r.__reactInternalSnapshotBeforeUpdate)}var i=e.updateQueue;i!==null&&rx(e,i,r);break;case 3:var o=e.updateQueue;if(o!==null){if(t=null,e.child!==null)switch(e.child.tag){case 5:t=e.child.stateNode;break;case 1:t=e.child.stateNode}rx(e,o,t)}break;case 5:var a=e.stateNode;if(t===null&&e.flags&4){t=a;var l=e.memoizedProps;switch(e.type){case"button":case"input":case"select":case"textarea":l.autoFocus&&t.focus();break;case"img":l.src&&(t.src=l.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(e.memoizedState===null){var u=e.alternate;if(u!==null){var h=u.memoizedState;if(h!==null){var f=h.dehydrated;f!==null&&Fu(f)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(H(163))}kn||e.flags&512&&g_(e)}catch(p){Bt(e,e.return,p)}}if(e===n){oe=null;break}if(t=e.sibling,t!==null){t.return=e.return,oe=t;break}oe=e.return}}function wx(n){for(;oe!==null;){var e=oe;if(e===n){oe=null;break}var t=e.sibling;if(t!==null){t.return=e.return,oe=t;break}oe=e.return}}function Ix(n){for(;oe!==null;){var e=oe;try{switch(e.tag){case 0:case 11:case 15:var t=e.return;try{Xp(4,e)}catch(l){Bt(e,t,l)}break;case 1:var r=e.stateNode;if(typeof r.componentDidMount=="function"){var s=e.return;try{r.componentDidMount()}catch(l){Bt(e,s,l)}}var i=e.return;try{g_(e)}catch(l){Bt(e,i,l)}break;case 5:var o=e.return;try{g_(e)}catch(l){Bt(e,o,l)}}}catch(l){Bt(e,e.return,l)}if(e===n){oe=null;break}var a=e.sibling;if(a!==null){a.return=e.return,oe=a;break}oe=e.return}}var uM=Math.ceil,Xf=ei.ReactCurrentDispatcher,o0=ei.ReactCurrentOwner,Dr=ei.ReactCurrentBatchConfig,Ye=0,hn=null,Yt=null,xn=0,ur=0,il=lo(0),tn=0,Qu=null,Yo=0,Zp=0,a0=0,fu=null,Kn=null,l0=0,Al=1/0,Ps=null,Zf=!1,v_=null,Vi=null,jh=!1,Si=null,ep=0,pu=0,w_=null,ff=-1,pf=0;function Bn(){return Ye&6?Wt():ff!==-1?ff:ff=Wt()}function Fi(n){return n.mode&1?Ye&2&&xn!==0?xn&-xn:HO.transition!==null?(pf===0&&(pf=l1()),pf):(n=it,n!==0||(n=window.event,n=n===void 0?16:m1(n.type)),n):1}function Yr(n,e,t,r){if(50<pu)throw pu=0,w_=null,Error(H(185));Ad(n,t,r),(!(Ye&2)||n!==hn)&&(n===hn&&(!(Ye&2)&&(Zp|=t),tn===4&&_i(n,xn)),tr(n,r),t===1&&Ye===0&&!(e.mode&1)&&(Al=Wt()+500,Qp&&co()))}function tr(n,e){var t=n.callbackNode;H2(n,e);var r=Vf(n,n===hn?xn:0);if(r===0)t!==null&&NE(t),n.callbackNode=null,n.callbackPriority=0;else if(e=r&-r,n.callbackPriority!==e){if(t!=null&&NE(t),e===1)n.tag===0?GO(Ex.bind(null,n)):O1(Ex.bind(null,n)),$O(function(){!(Ye&6)&&co()}),t=null;else{switch(c1(r)){case 1:t=Ov;break;case 4:t=o1;break;case 16:t=Lf;break;case 536870912:t=a1;break;default:t=Lf}t=kA(t,SA.bind(null,n))}n.callbackPriority=e,n.callbackNode=t}}function SA(n,e){if(ff=-1,pf=0,Ye&6)throw Error(H(327));var t=n.callbackNode;if(dl()&&n.callbackNode!==t)return null;var r=Vf(n,n===hn?xn:0);if(r===0)return null;if(r&30||r&n.expiredLanes||e)e=tp(n,r);else{e=r;var s=Ye;Ye|=2;var i=AA();(hn!==n||xn!==e)&&(Ps=null,Al=Wt()+500,Uo(n,e));do try{fM();break}catch(a){bA(n,a)}while(1);Hv(),Xf.current=i,Ye=s,Yt!==null?e=0:(hn=null,xn=0,e=tn)}if(e!==0){if(e===2&&(s=Hy(n),s!==0&&(r=s,e=I_(n,s))),e===1)throw t=Qu,Uo(n,0),_i(n,r),tr(n,Wt()),t;if(e===6)_i(n,r);else{if(s=n.current.alternate,!(r&30)&&!dM(s)&&(e=tp(n,r),e===2&&(i=Hy(n),i!==0&&(r=i,e=I_(n,i))),e===1))throw t=Qu,Uo(n,0),_i(n,r),tr(n,Wt()),t;switch(n.finishedWork=s,n.finishedLanes=r,e){case 0:case 1:throw Error(H(345));case 2:To(n,Kn,Ps);break;case 3:if(_i(n,r),(r&130023424)===r&&(e=l0+500-Wt(),10<e)){if(Vf(n,0)!==0)break;if(s=n.suspendedLanes,(s&r)!==r){Bn(),n.pingedLanes|=n.suspendedLanes&s;break}n.timeoutHandle=t_(To.bind(null,n,Kn,Ps),e);break}To(n,Kn,Ps);break;case 4:if(_i(n,r),(r&4194240)===r)break;for(e=n.eventTimes,s=-1;0<r;){var o=31-Qr(r);i=1<<o,o=e[o],o>s&&(s=o),r&=~i}if(r=s,r=Wt()-r,r=(120>r?120:480>r?480:1080>r?1080:1920>r?1920:3e3>r?3e3:4320>r?4320:1960*uM(r/1960))-r,10<r){n.timeoutHandle=t_(To.bind(null,n,Kn,Ps),r);break}To(n,Kn,Ps);break;case 5:To(n,Kn,Ps);break;default:throw Error(H(329))}}}return tr(n,Wt()),n.callbackNode===t?SA.bind(null,n):null}function I_(n,e){var t=fu;return n.current.memoizedState.isDehydrated&&(Uo(n,e).flags|=256),n=tp(n,e),n!==2&&(e=Kn,Kn=t,e!==null&&E_(e)),n}function E_(n){Kn===null?Kn=n:Kn.push.apply(Kn,n)}function dM(n){for(var e=n;;){if(e.flags&16384){var t=e.updateQueue;if(t!==null&&(t=t.stores,t!==null))for(var r=0;r<t.length;r++){var s=t[r],i=s.getSnapshot;s=s.value;try{if(!Zr(i(),s))return!1}catch{return!1}}}if(t=e.child,e.subtreeFlags&16384&&t!==null)t.return=e,e=t;else{if(e===n)break;for(;e.sibling===null;){if(e.return===null||e.return===n)return!0;e=e.return}e.sibling.return=e.return,e=e.sibling}}return!0}function _i(n,e){for(e&=~a0,e&=~Zp,n.suspendedLanes|=e,n.pingedLanes&=~e,n=n.expirationTimes;0<e;){var t=31-Qr(e),r=1<<t;n[t]=-1,e&=~r}}function Ex(n){if(Ye&6)throw Error(H(327));dl();var e=Vf(n,0);if(!(e&1))return tr(n,Wt()),null;var t=tp(n,e);if(n.tag!==0&&t===2){var r=Hy(n);r!==0&&(e=r,t=I_(n,r))}if(t===1)throw t=Qu,Uo(n,0),_i(n,e),tr(n,Wt()),t;if(t===6)throw Error(H(345));return n.finishedWork=n.current.alternate,n.finishedLanes=e,To(n,Kn,Ps),tr(n,Wt()),null}function c0(n,e){var t=Ye;Ye|=1;try{return n(e)}finally{Ye=t,Ye===0&&(Al=Wt()+500,Qp&&co())}}function Jo(n){Si!==null&&Si.tag===0&&!(Ye&6)&&dl();var e=Ye;Ye|=1;var t=Dr.transition,r=it;try{if(Dr.transition=null,it=1,n)return n()}finally{it=r,Dr.transition=t,Ye=e,!(Ye&6)&&co()}}function u0(){ur=il.current,Tt(il)}function Uo(n,e){n.finishedWork=null,n.finishedLanes=0;var t=n.timeoutHandle;if(t!==-1&&(n.timeoutHandle=-1,BO(t)),Yt!==null)for(t=Yt.return;t!==null;){var r=t;switch(qv(r),r.tag){case 1:r=r.type.childContextTypes,r!=null&&$f();break;case 3:Sl(),Tt(Zn),Tt(Ln),Zv();break;case 5:Xv(r);break;case 4:Sl();break;case 13:Tt(Mt);break;case 19:Tt(Mt);break;case 10:Kv(r.type._context);break;case 22:case 23:u0()}t=t.return}if(hn=n,Yt=n=ji(n.current,null),xn=ur=e,tn=0,Qu=null,a0=Zp=Yo=0,Kn=fu=null,Oo!==null){for(e=0;e<Oo.length;e++)if(t=Oo[e],r=t.interleaved,r!==null){t.interleaved=null;var s=r.next,i=t.pending;if(i!==null){var o=i.next;i.next=s,r.next=o}t.pending=r}Oo=null}return n}function bA(n,e){do{var t=Yt;try{if(Hv(),uf.current=Jf,Yf){for(var r=Vt.memoizedState;r!==null;){var s=r.queue;s!==null&&(s.pending=null),r=r.next}Yf=!1}if(Qo=0,cn=Zt=Vt=null,du=!1,Gu=0,o0.current=null,t===null||t.return===null){tn=1,Qu=e,Yt=null;break}e:{var i=n,o=t.return,a=t,l=e;if(e=xn,a.flags|=32768,l!==null&&typeof l=="object"&&typeof l.then=="function"){var u=l,h=a,f=h.tag;if(!(h.mode&1)&&(f===0||f===11||f===15)){var p=h.alternate;p?(h.updateQueue=p.updateQueue,h.memoizedState=p.memoizedState,h.lanes=p.lanes):(h.updateQueue=null,h.memoizedState=null)}var y=cx(o);if(y!==null){y.flags&=-257,ux(y,o,a,i,e),y.mode&1&&lx(i,u,e),e=y,l=u;var I=e.updateQueue;if(I===null){var C=new Set;C.add(l),e.updateQueue=C}else I.add(l);break e}else{if(!(e&1)){lx(i,u,e),d0();break e}l=Error(H(426))}}else if(Nt&&a.mode&1){var P=cx(o);if(P!==null){!(P.flags&65536)&&(P.flags|=256),ux(P,o,a,i,e),Wv(bl(l,a));break e}}i=l=bl(l,a),tn!==4&&(tn=2),fu===null?fu=[i]:fu.push(i),i=o;do{switch(i.tag){case 3:i.flags|=65536,e&=-e,i.lanes|=e;var A=cA(i,l,e);nx(i,A);break e;case 1:a=l;var T=i.type,R=i.stateNode;if(!(i.flags&128)&&(typeof T.getDerivedStateFromError=="function"||R!==null&&typeof R.componentDidCatch=="function"&&(Vi===null||!Vi.has(R)))){i.flags|=65536,e&=-e,i.lanes|=e;var D=uA(i,a,e);nx(i,D);break e}}i=i.return}while(i!==null)}RA(t)}catch(F){e=F,Yt===t&&t!==null&&(Yt=t=t.return);continue}break}while(1)}function AA(){var n=Xf.current;return Xf.current=Jf,n===null?Jf:n}function d0(){(tn===0||tn===3||tn===2)&&(tn=4),hn===null||!(Yo&268435455)&&!(Zp&268435455)||_i(hn,xn)}function tp(n,e){var t=Ye;Ye|=2;var r=AA();(hn!==n||xn!==e)&&(Ps=null,Uo(n,e));do try{hM();break}catch(s){bA(n,s)}while(1);if(Hv(),Ye=t,Xf.current=r,Yt!==null)throw Error(H(261));return hn=null,xn=0,tn}function hM(){for(;Yt!==null;)CA(Yt)}function fM(){for(;Yt!==null&&!F2();)CA(Yt)}function CA(n){var e=PA(n.alternate,n,ur);n.memoizedProps=n.pendingProps,e===null?RA(n):Yt=e,o0.current=null}function RA(n){var e=n;do{var t=e.alternate;if(n=e.return,e.flags&32768){if(t=oM(t,e),t!==null){t.flags&=32767,Yt=t;return}if(n!==null)n.flags|=32768,n.subtreeFlags=0,n.deletions=null;else{tn=6,Yt=null;return}}else if(t=iM(t,e,ur),t!==null){Yt=t;return}if(e=e.sibling,e!==null){Yt=e;return}Yt=e=n}while(e!==null);tn===0&&(tn=5)}function To(n,e,t){var r=it,s=Dr.transition;try{Dr.transition=null,it=1,pM(n,e,t,r)}finally{Dr.transition=s,it=r}return null}function pM(n,e,t,r){do dl();while(Si!==null);if(Ye&6)throw Error(H(327));t=n.finishedWork;var s=n.finishedLanes;if(t===null)return null;if(n.finishedWork=null,n.finishedLanes=0,t===n.current)throw Error(H(177));n.callbackNode=null,n.callbackPriority=0;var i=t.lanes|t.childLanes;if(K2(n,i),n===hn&&(Yt=hn=null,xn=0),!(t.subtreeFlags&2064)&&!(t.flags&2064)||jh||(jh=!0,kA(Lf,function(){return dl(),null})),i=(t.flags&15990)!==0,t.subtreeFlags&15990||i){i=Dr.transition,Dr.transition=null;var o=it;it=1;var a=Ye;Ye|=4,o0.current=null,lM(n,t),xA(t,n),OO(Zy),Ff=!!Xy,Zy=Xy=null,n.current=t,cM(t),j2(),Ye=a,it=o,Dr.transition=i}else n.current=t;if(jh&&(jh=!1,Si=n,ep=s),i=n.pendingLanes,i===0&&(Vi=null),$2(t.stateNode),tr(n,Wt()),e!==null)for(r=n.onRecoverableError,t=0;t<e.length;t++)s=e[t],r(s.value,{componentStack:s.stack,digest:s.digest});if(Zf)throw Zf=!1,n=v_,v_=null,n;return ep&1&&n.tag!==0&&dl(),i=n.pendingLanes,i&1?n===w_?pu++:(pu=0,w_=n):pu=0,co(),null}function dl(){if(Si!==null){var n=c1(ep),e=Dr.transition,t=it;try{if(Dr.transition=null,it=16>n?16:n,Si===null)var r=!1;else{if(n=Si,Si=null,ep=0,Ye&6)throw Error(H(331));var s=Ye;for(Ye|=4,oe=n.current;oe!==null;){var i=oe,o=i.child;if(oe.flags&16){var a=i.deletions;if(a!==null){for(var l=0;l<a.length;l++){var u=a[l];for(oe=u;oe!==null;){var h=oe;switch(h.tag){case 0:case 11:case 15:hu(8,h,i)}var f=h.child;if(f!==null)f.return=h,oe=f;else for(;oe!==null;){h=oe;var p=h.sibling,y=h.return;if(wA(h),h===u){oe=null;break}if(p!==null){p.return=y,oe=p;break}oe=y}}}var I=i.alternate;if(I!==null){var C=I.child;if(C!==null){I.child=null;do{var P=C.sibling;C.sibling=null,C=P}while(C!==null)}}oe=i}}if(i.subtreeFlags&2064&&o!==null)o.return=i,oe=o;else e:for(;oe!==null;){if(i=oe,i.flags&2048)switch(i.tag){case 0:case 11:case 15:hu(9,i,i.return)}var A=i.sibling;if(A!==null){A.return=i.return,oe=A;break e}oe=i.return}}var T=n.current;for(oe=T;oe!==null;){o=oe;var R=o.child;if(o.subtreeFlags&2064&&R!==null)R.return=o,oe=R;else e:for(o=T;oe!==null;){if(a=oe,a.flags&2048)try{switch(a.tag){case 0:case 11:case 15:Xp(9,a)}}catch(F){Bt(a,a.return,F)}if(a===o){oe=null;break e}var D=a.sibling;if(D!==null){D.return=a.return,oe=D;break e}oe=a.return}}if(Ye=s,co(),gs&&typeof gs.onPostCommitFiberRoot=="function")try{gs.onPostCommitFiberRoot(qp,n)}catch{}r=!0}return r}finally{it=t,Dr.transition=e}}return!1}function xx(n,e,t){e=bl(t,e),e=cA(n,e,1),n=Li(n,e,1),e=Bn(),n!==null&&(Ad(n,1,e),tr(n,e))}function Bt(n,e,t){if(n.tag===3)xx(n,n,t);else for(;e!==null;){if(e.tag===3){xx(e,n,t);break}else if(e.tag===1){var r=e.stateNode;if(typeof e.type.getDerivedStateFromError=="function"||typeof r.componentDidCatch=="function"&&(Vi===null||!Vi.has(r))){n=bl(t,n),n=uA(e,n,1),e=Li(e,n,1),n=Bn(),e!==null&&(Ad(e,1,n),tr(e,n));break}}e=e.return}}function mM(n,e,t){var r=n.pingCache;r!==null&&r.delete(e),e=Bn(),n.pingedLanes|=n.suspendedLanes&t,hn===n&&(xn&t)===t&&(tn===4||tn===3&&(xn&130023424)===xn&&500>Wt()-l0?Uo(n,0):a0|=t),tr(n,e)}function NA(n,e){e===0&&(n.mode&1?(e=Rh,Rh<<=1,!(Rh&130023424)&&(Rh=4194304)):e=1);var t=Bn();n=Ws(n,e),n!==null&&(Ad(n,e,t),tr(n,t))}function gM(n){var e=n.memoizedState,t=0;e!==null&&(t=e.retryLane),NA(n,t)}function yM(n,e){var t=0;switch(n.tag){case 13:var r=n.stateNode,s=n.memoizedState;s!==null&&(t=s.retryLane);break;case 19:r=n.stateNode;break;default:throw Error(H(314))}r!==null&&r.delete(e),NA(n,t)}var PA;PA=function(n,e,t){if(n!==null)if(n.memoizedProps!==e.pendingProps||Zn.current)Qn=!0;else{if(!(n.lanes&t)&&!(e.flags&128))return Qn=!1,sM(n,e,t);Qn=!!(n.flags&131072)}else Qn=!1,Nt&&e.flags&1048576&&M1(e,Wf,e.index);switch(e.lanes=0,e.tag){case 2:var r=e.type;hf(n,e),n=e.pendingProps;var s=El(e,Ln.current);ul(e,t),s=t0(null,e,r,n,s,t);var i=n0();return e.flags|=1,typeof s=="object"&&s!==null&&typeof s.render=="function"&&s.$$typeof===void 0?(e.tag=1,e.memoizedState=null,e.updateQueue=null,er(r)?(i=!0,zf(e)):i=!1,e.memoizedState=s.state!==null&&s.state!==void 0?s.state:null,Yv(e),s.updater=Jp,e.stateNode=s,s._reactInternals=e,l_(e,r,n,t),e=d_(null,e,r,!0,i,t)):(e.tag=0,Nt&&i&&zv(e),jn(null,e,s,t),e=e.child),e;case 16:r=e.elementType;e:{switch(hf(n,e),n=e.pendingProps,s=r._init,r=s(r._payload),e.type=r,s=e.tag=vM(r),n=zr(r,n),s){case 0:e=u_(null,e,r,n,t);break e;case 1:e=fx(null,e,r,n,t);break e;case 11:e=dx(null,e,r,n,t);break e;case 14:e=hx(null,e,r,zr(r.type,n),t);break e}throw Error(H(306,r,""))}return e;case 0:return r=e.type,s=e.pendingProps,s=e.elementType===r?s:zr(r,s),u_(n,e,r,s,t);case 1:return r=e.type,s=e.pendingProps,s=e.elementType===r?s:zr(r,s),fx(n,e,r,s,t);case 3:e:{if(pA(e),n===null)throw Error(H(387));r=e.pendingProps,i=e.memoizedState,s=i.element,B1(n,e),Kf(e,r,null,t);var o=e.memoizedState;if(r=o.element,i.isDehydrated)if(i={element:r,isDehydrated:!1,cache:o.cache,pendingSuspenseBoundaries:o.pendingSuspenseBoundaries,transitions:o.transitions},e.updateQueue.baseState=i,e.memoizedState=i,e.flags&256){s=bl(Error(H(423)),e),e=px(n,e,r,t,s);break e}else if(r!==s){s=bl(Error(H(424)),e),e=px(n,e,r,t,s);break e}else for(mr=Mi(e.stateNode.containerInfo.firstChild),gr=e,Nt=!0,Gr=null,t=j1(e,null,r,t),e.child=t;t;)t.flags=t.flags&-3|4096,t=t.sibling;else{if(xl(),r===s){e=Gs(n,e,t);break e}jn(n,e,r,t)}e=e.child}return e;case 5:return $1(e),n===null&&i_(e),r=e.type,s=e.pendingProps,i=n!==null?n.memoizedProps:null,o=s.children,e_(r,s)?o=null:i!==null&&e_(r,i)&&(e.flags|=32),fA(n,e),jn(n,e,o,t),e.child;case 6:return n===null&&i_(e),null;case 13:return mA(n,e,t);case 4:return Jv(e,e.stateNode.containerInfo),r=e.pendingProps,n===null?e.child=Tl(e,null,r,t):jn(n,e,r,t),e.child;case 11:return r=e.type,s=e.pendingProps,s=e.elementType===r?s:zr(r,s),dx(n,e,r,s,t);case 7:return jn(n,e,e.pendingProps,t),e.child;case 8:return jn(n,e,e.pendingProps.children,t),e.child;case 12:return jn(n,e,e.pendingProps.children,t),e.child;case 10:e:{if(r=e.type._context,s=e.pendingProps,i=e.memoizedProps,o=s.value,_t(Gf,r._currentValue),r._currentValue=o,i!==null)if(Zr(i.value,o)){if(i.children===s.children&&!Zn.current){e=Gs(n,e,t);break e}}else for(i=e.child,i!==null&&(i.return=e);i!==null;){var a=i.dependencies;if(a!==null){o=i.child;for(var l=a.firstContext;l!==null;){if(l.context===r){if(i.tag===1){l=Bs(-1,t&-t),l.tag=2;var u=i.updateQueue;if(u!==null){u=u.shared;var h=u.pending;h===null?l.next=l:(l.next=h.next,h.next=l),u.pending=l}}i.lanes|=t,l=i.alternate,l!==null&&(l.lanes|=t),o_(i.return,t,e),a.lanes|=t;break}l=l.next}}else if(i.tag===10)o=i.type===e.type?null:i.child;else if(i.tag===18){if(o=i.return,o===null)throw Error(H(341));o.lanes|=t,a=o.alternate,a!==null&&(a.lanes|=t),o_(o,t,e),o=i.sibling}else o=i.child;if(o!==null)o.return=i;else for(o=i;o!==null;){if(o===e){o=null;break}if(i=o.sibling,i!==null){i.return=o.return,o=i;break}o=o.return}i=o}jn(n,e,s.children,t),e=e.child}return e;case 9:return s=e.type,r=e.pendingProps.children,ul(e,t),s=Mr(s),r=r(s),e.flags|=1,jn(n,e,r,t),e.child;case 14:return r=e.type,s=zr(r,e.pendingProps),s=zr(r.type,s),hx(n,e,r,s,t);case 15:return dA(n,e,e.type,e.pendingProps,t);case 17:return r=e.type,s=e.pendingProps,s=e.elementType===r?s:zr(r,s),hf(n,e),e.tag=1,er(r)?(n=!0,zf(e)):n=!1,ul(e,t),lA(e,r,s),l_(e,r,s,t),d_(null,e,r,!0,n,t);case 19:return gA(n,e,t);case 22:return hA(n,e,t)}throw Error(H(156,e.tag))};function kA(n,e){return i1(n,e)}function _M(n,e,t,r){this.tag=n,this.key=t,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=e,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=r,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Pr(n,e,t,r){return new _M(n,e,t,r)}function h0(n){return n=n.prototype,!(!n||!n.isReactComponent)}function vM(n){if(typeof n=="function")return h0(n)?1:0;if(n!=null){if(n=n.$$typeof,n===Pv)return 11;if(n===kv)return 14}return 2}function ji(n,e){var t=n.alternate;return t===null?(t=Pr(n.tag,e,n.key,n.mode),t.elementType=n.elementType,t.type=n.type,t.stateNode=n.stateNode,t.alternate=n,n.alternate=t):(t.pendingProps=e,t.type=n.type,t.flags=0,t.subtreeFlags=0,t.deletions=null),t.flags=n.flags&14680064,t.childLanes=n.childLanes,t.lanes=n.lanes,t.child=n.child,t.memoizedProps=n.memoizedProps,t.memoizedState=n.memoizedState,t.updateQueue=n.updateQueue,e=n.dependencies,t.dependencies=e===null?null:{lanes:e.lanes,firstContext:e.firstContext},t.sibling=n.sibling,t.index=n.index,t.ref=n.ref,t}function mf(n,e,t,r,s,i){var o=2;if(r=n,typeof n=="function")h0(n)&&(o=1);else if(typeof n=="string")o=5;else e:switch(n){case Qa:return Bo(t.children,s,i,e);case Nv:o=8,s|=8;break;case ky:return n=Pr(12,t,e,s|2),n.elementType=ky,n.lanes=i,n;case Dy:return n=Pr(13,t,e,s),n.elementType=Dy,n.lanes=i,n;case Oy:return n=Pr(19,t,e,s),n.elementType=Oy,n.lanes=i,n;case $b:return em(t,s,i,e);default:if(typeof n=="object"&&n!==null)switch(n.$$typeof){case Ub:o=10;break e;case Bb:o=9;break e;case Pv:o=11;break e;case kv:o=14;break e;case mi:o=16,r=null;break e}throw Error(H(130,n==null?n:typeof n,""))}return e=Pr(o,t,e,s),e.elementType=n,e.type=r,e.lanes=i,e}function Bo(n,e,t,r){return n=Pr(7,n,r,e),n.lanes=t,n}function em(n,e,t,r){return n=Pr(22,n,r,e),n.elementType=$b,n.lanes=t,n.stateNode={isHidden:!1},n}function Yg(n,e,t){return n=Pr(6,n,null,e),n.lanes=t,n}function Jg(n,e,t){return e=Pr(4,n.children!==null?n.children:[],n.key,e),e.lanes=t,e.stateNode={containerInfo:n.containerInfo,pendingChildren:null,implementation:n.implementation},e}function wM(n,e,t,r,s){this.tag=e,this.containerInfo=n,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=Pg(0),this.expirationTimes=Pg(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=Pg(0),this.identifierPrefix=r,this.onRecoverableError=s,this.mutableSourceEagerHydrationData=null}function f0(n,e,t,r,s,i,o,a,l){return n=new wM(n,e,t,a,l),e===1?(e=1,i===!0&&(e|=8)):e=0,i=Pr(3,null,null,e),n.current=i,i.stateNode=n,i.memoizedState={element:r,isDehydrated:t,cache:null,transitions:null,pendingSuspenseBoundaries:null},Yv(i),n}function IM(n,e,t){var r=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:Ka,key:r==null?null:""+r,children:n,containerInfo:e,implementation:t}}function DA(n){if(!n)return Ki;n=n._reactInternals;e:{if(ga(n)!==n||n.tag!==1)throw Error(H(170));var e=n;do{switch(e.tag){case 3:e=e.stateNode.context;break e;case 1:if(er(e.type)){e=e.stateNode.__reactInternalMemoizedMergedChildContext;break e}}e=e.return}while(e!==null);throw Error(H(171))}if(n.tag===1){var t=n.type;if(er(t))return D1(n,t,e)}return e}function OA(n,e,t,r,s,i,o,a,l){return n=f0(t,r,!0,n,s,i,o,a,l),n.context=DA(null),t=n.current,r=Bn(),s=Fi(t),i=Bs(r,s),i.callback=e??null,Li(t,i,s),n.current.lanes=s,Ad(n,s,r),tr(n,r),n}function tm(n,e,t,r){var s=e.current,i=Bn(),o=Fi(s);return t=DA(t),e.context===null?e.context=t:e.pendingContext=t,e=Bs(i,o),e.payload={element:n},r=r===void 0?null:r,r!==null&&(e.callback=r),n=Li(s,e,o),n!==null&&(Yr(n,s,o,i),cf(n,s,o)),o}function np(n){if(n=n.current,!n.child)return null;switch(n.child.tag){case 5:return n.child.stateNode;default:return n.child.stateNode}}function Tx(n,e){if(n=n.memoizedState,n!==null&&n.dehydrated!==null){var t=n.retryLane;n.retryLane=t!==0&&t<e?t:e}}function p0(n,e){Tx(n,e),(n=n.alternate)&&Tx(n,e)}function EM(){return null}var MA=typeof reportError=="function"?reportError:function(n){console.error(n)};function m0(n){this._internalRoot=n}nm.prototype.render=m0.prototype.render=function(n){var e=this._internalRoot;if(e===null)throw Error(H(409));tm(n,e,null,null)};nm.prototype.unmount=m0.prototype.unmount=function(){var n=this._internalRoot;if(n!==null){this._internalRoot=null;var e=n.containerInfo;Jo(function(){tm(null,n,null,null)}),e[qs]=null}};function nm(n){this._internalRoot=n}nm.prototype.unstable_scheduleHydration=function(n){if(n){var e=h1();n={blockedOn:null,target:n,priority:e};for(var t=0;t<yi.length&&e!==0&&e<yi[t].priority;t++);yi.splice(t,0,n),t===0&&p1(n)}};function g0(n){return!(!n||n.nodeType!==1&&n.nodeType!==9&&n.nodeType!==11)}function rm(n){return!(!n||n.nodeType!==1&&n.nodeType!==9&&n.nodeType!==11&&(n.nodeType!==8||n.nodeValue!==" react-mount-point-unstable "))}function Sx(){}function xM(n,e,t,r,s){if(s){if(typeof r=="function"){var i=r;r=function(){var u=np(o);i.call(u)}}var o=OA(e,r,n,0,null,!1,!1,"",Sx);return n._reactRootContainer=o,n[qs]=o.current,Bu(n.nodeType===8?n.parentNode:n),Jo(),o}for(;s=n.lastChild;)n.removeChild(s);if(typeof r=="function"){var a=r;r=function(){var u=np(l);a.call(u)}}var l=f0(n,0,!1,null,null,!1,!1,"",Sx);return n._reactRootContainer=l,n[qs]=l.current,Bu(n.nodeType===8?n.parentNode:n),Jo(function(){tm(e,l,t,r)}),l}function sm(n,e,t,r,s){var i=t._reactRootContainer;if(i){var o=i;if(typeof s=="function"){var a=s;s=function(){var l=np(o);a.call(l)}}tm(e,o,n,s)}else o=xM(t,e,n,s,r);return np(o)}u1=function(n){switch(n.tag){case 3:var e=n.stateNode;if(e.current.memoizedState.isDehydrated){var t=Qc(e.pendingLanes);t!==0&&(Mv(e,t|1),tr(e,Wt()),!(Ye&6)&&(Al=Wt()+500,co()))}break;case 13:Jo(function(){var r=Ws(n,1);if(r!==null){var s=Bn();Yr(r,n,1,s)}}),p0(n,1)}};Lv=function(n){if(n.tag===13){var e=Ws(n,134217728);if(e!==null){var t=Bn();Yr(e,n,134217728,t)}p0(n,134217728)}};d1=function(n){if(n.tag===13){var e=Fi(n),t=Ws(n,e);if(t!==null){var r=Bn();Yr(t,n,e,r)}p0(n,e)}};h1=function(){return it};f1=function(n,e){var t=it;try{return it=n,e()}finally{it=t}};qy=function(n,e,t){switch(e){case"input":if(Vy(n,t),e=t.name,t.type==="radio"&&e!=null){for(t=n;t.parentNode;)t=t.parentNode;for(t=t.querySelectorAll("input[name="+JSON.stringify(""+e)+'][type="radio"]'),e=0;e<t.length;e++){var r=t[e];if(r!==n&&r.form===n.form){var s=Kp(r);if(!s)throw Error(H(90));qb(r),Vy(r,s)}}}break;case"textarea":Gb(n,t);break;case"select":e=t.value,e!=null&&ol(n,!!t.multiple,e,!1)}};Zb=c0;e1=Jo;var TM={usingClientEntryPoint:!1,Events:[Rd,Za,Kp,Jb,Xb,c0]},Lc={findFiberByHostInstance:Do,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},SM={bundleType:Lc.bundleType,version:Lc.version,rendererPackageName:Lc.rendererPackageName,rendererConfig:Lc.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:ei.ReactCurrentDispatcher,findHostInstanceByFiber:function(n){return n=r1(n),n===null?null:n.stateNode},findFiberByHostInstance:Lc.findFiberByHostInstance||EM,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var Uh=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!Uh.isDisabled&&Uh.supportsFiber)try{qp=Uh.inject(SM),gs=Uh}catch{}}Tr.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=TM;Tr.createPortal=function(n,e){var t=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!g0(e))throw Error(H(200));return IM(n,e,null,t)};Tr.createRoot=function(n,e){if(!g0(n))throw Error(H(299));var t=!1,r="",s=MA;return e!=null&&(e.unstable_strictMode===!0&&(t=!0),e.identifierPrefix!==void 0&&(r=e.identifierPrefix),e.onRecoverableError!==void 0&&(s=e.onRecoverableError)),e=f0(n,1,!1,null,null,t,!1,r,s),n[qs]=e.current,Bu(n.nodeType===8?n.parentNode:n),new m0(e)};Tr.findDOMNode=function(n){if(n==null)return null;if(n.nodeType===1)return n;var e=n._reactInternals;if(e===void 0)throw typeof n.render=="function"?Error(H(188)):(n=Object.keys(n).join(","),Error(H(268,n)));return n=r1(e),n=n===null?null:n.stateNode,n};Tr.flushSync=function(n){return Jo(n)};Tr.hydrate=function(n,e,t){if(!rm(e))throw Error(H(200));return sm(null,n,e,!0,t)};Tr.hydrateRoot=function(n,e,t){if(!g0(n))throw Error(H(405));var r=t!=null&&t.hydratedSources||null,s=!1,i="",o=MA;if(t!=null&&(t.unstable_strictMode===!0&&(s=!0),t.identifierPrefix!==void 0&&(i=t.identifierPrefix),t.onRecoverableError!==void 0&&(o=t.onRecoverableError)),e=OA(e,null,n,1,t??null,s,!1,i,o),n[qs]=e.current,Bu(n),r)for(n=0;n<r.length;n++)t=r[n],s=t._getVersion,s=s(t._source),e.mutableSourceEagerHydrationData==null?e.mutableSourceEagerHydrationData=[t,s]:e.mutableSourceEagerHydrationData.push(t,s);return new nm(e)};Tr.render=function(n,e,t){if(!rm(e))throw Error(H(200));return sm(null,n,e,!1,t)};Tr.unmountComponentAtNode=function(n){if(!rm(n))throw Error(H(40));return n._reactRootContainer?(Jo(function(){sm(null,null,n,!1,function(){n._reactRootContainer=null,n[qs]=null})}),!0):!1};Tr.unstable_batchedUpdates=c0;Tr.unstable_renderSubtreeIntoContainer=function(n,e,t,r){if(!rm(t))throw Error(H(200));if(n==null||n._reactInternals===void 0)throw Error(H(38));return sm(n,e,t,!1,r)};Tr.version="18.3.1-next-f1338f8080-20240426";function LA(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(LA)}catch(n){console.error(n)}}LA(),Lb.exports=Tr;var bM=Lb.exports,bx=bM;Ny.createRoot=bx.createRoot,Ny.hydrateRoot=bx.hydrateRoot;const AM="modulepreload",CM=function(n){return"/"+n},Ax={},Re=function(e,t,r){if(!t||t.length===0)return e();const s=document.getElementsByTagName("link");return Promise.all(t.map(i=>{if(i=CM(i),i in Ax)return;Ax[i]=!0;const o=i.endsWith(".css"),a=o?'[rel="stylesheet"]':"";if(!!r)for(let h=s.length-1;h>=0;h--){const f=s[h];if(f.href===i&&(!o||f.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${i}"]${a}`))return;const u=document.createElement("link");if(u.rel=o?"stylesheet":AM,o||(u.as="script",u.crossOrigin=""),u.href=i,document.head.appendChild(u),o)return new Promise((h,f)=>{u.addEventListener("load",h),u.addEventListener("error",()=>f(new Error(`Unable to preload CSS for ${i}`)))})})).then(()=>e()).catch(i=>{const o=new Event("vite:preloadError",{cancelable:!0});if(o.payload=i,window.dispatchEvent(o),!o.defaultPrevented)throw i})},RM=()=>{};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const VA={NODE_CLIENT:!1,NODE_ADMIN:!1,SDK_VERSION:"${JSCORE_VERSION}"};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Y=function(n,e){if(!n)throw rc(e)},rc=function(n){return new Error("Firebase Database ("+VA.SDK_VERSION+") INTERNAL ASSERT FAILED: "+n)};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const FA=function(n){const e=[];let t=0;for(let r=0;r<n.length;r++){let s=n.charCodeAt(r);s<128?e[t++]=s:s<2048?(e[t++]=s>>6|192,e[t++]=s&63|128):(s&64512)===55296&&r+1<n.length&&(n.charCodeAt(r+1)&64512)===56320?(s=65536+((s&1023)<<10)+(n.charCodeAt(++r)&1023),e[t++]=s>>18|240,e[t++]=s>>12&63|128,e[t++]=s>>6&63|128,e[t++]=s&63|128):(e[t++]=s>>12|224,e[t++]=s>>6&63|128,e[t++]=s&63|128)}return e},NM=function(n){const e=[];let t=0,r=0;for(;t<n.length;){const s=n[t++];if(s<128)e[r++]=String.fromCharCode(s);else if(s>191&&s<224){const i=n[t++];e[r++]=String.fromCharCode((s&31)<<6|i&63)}else if(s>239&&s<365){const i=n[t++],o=n[t++],a=n[t++],l=((s&7)<<18|(i&63)<<12|(o&63)<<6|a&63)-65536;e[r++]=String.fromCharCode(55296+(l>>10)),e[r++]=String.fromCharCode(56320+(l&1023))}else{const i=n[t++],o=n[t++];e[r++]=String.fromCharCode((s&15)<<12|(i&63)<<6|o&63)}}return e.join("")},y0={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:typeof atob=="function",encodeByteArray(n,e){if(!Array.isArray(n))throw Error("encodeByteArray takes an array as a parameter");this.init_();const t=e?this.byteToCharMapWebSafe_:this.byteToCharMap_,r=[];for(let s=0;s<n.length;s+=3){const i=n[s],o=s+1<n.length,a=o?n[s+1]:0,l=s+2<n.length,u=l?n[s+2]:0,h=i>>2,f=(i&3)<<4|a>>4;let p=(a&15)<<2|u>>6,y=u&63;l||(y=64,o||(p=64)),r.push(t[h],t[f],t[p],t[y])}return r.join("")},encodeString(n,e){return this.HAS_NATIVE_SUPPORT&&!e?btoa(n):this.encodeByteArray(FA(n),e)},decodeString(n,e){return this.HAS_NATIVE_SUPPORT&&!e?atob(n):NM(this.decodeStringToByteArray(n,e))},decodeStringToByteArray(n,e){this.init_();const t=e?this.charToByteMapWebSafe_:this.charToByteMap_,r=[];for(let s=0;s<n.length;){const i=t[n.charAt(s++)],a=s<n.length?t[n.charAt(s)]:0;++s;const u=s<n.length?t[n.charAt(s)]:64;++s;const f=s<n.length?t[n.charAt(s)]:64;if(++s,i==null||a==null||u==null||f==null)throw new PM;const p=i<<2|a>>4;if(r.push(p),u!==64){const y=a<<4&240|u>>2;if(r.push(y),f!==64){const I=u<<6&192|f;r.push(I)}}}return r},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let n=0;n<this.ENCODED_VALS.length;n++)this.byteToCharMap_[n]=this.ENCODED_VALS.charAt(n),this.charToByteMap_[this.byteToCharMap_[n]]=n,this.byteToCharMapWebSafe_[n]=this.ENCODED_VALS_WEBSAFE.charAt(n),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[n]]=n,n>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(n)]=n,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(n)]=n)}}};class PM extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}const jA=function(n){const e=FA(n);return y0.encodeByteArray(e,!0)},rp=function(n){return jA(n).replace(/\./g,"")},sp=function(n){try{return y0.decodeString(n,!0)}catch(e){console.error("base64Decode failed: ",e)}return null};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function kM(n){return UA(void 0,n)}function UA(n,e){if(!(e instanceof Object))return e;switch(e.constructor){case Date:const t=e;return new Date(t.getTime());case Object:n===void 0&&(n={});break;case Array:n=[];break;default:return e}for(const t in e)!e.hasOwnProperty(t)||!DM(t)||(n[t]=UA(n[t],e[t]));return n}function DM(n){return n!=="__proto__"}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function BA(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("Unable to locate global object.")}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const OM=()=>BA().__FIREBASE_DEFAULTS__,MM=()=>{if(typeof process>"u"||typeof process.env>"u")return;const n={}.__FIREBASE_DEFAULTS__;if(n)return JSON.parse(n)},LM=()=>{if(typeof document>"u")return;let n;try{n=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch{return}const e=n&&sp(n[1]);return e&&JSON.parse(e)},im=()=>{try{return RM()||OM()||MM()||LM()}catch(n){console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${n}`);return}},$A=n=>{var e,t;return(t=(e=im())==null?void 0:e.emulatorHosts)==null?void 0:t[n]},zA=n=>{const e=$A(n);if(!e)return;const t=e.lastIndexOf(":");if(t<=0||t+1===e.length)throw new Error(`Invalid host ${e} with no separate hostname and port!`);const r=parseInt(e.substring(t+1),10);return e[0]==="["?[e.substring(1,t-1),r]:[e.substring(0,t),r]},qA=()=>{var n;return(n=im())==null?void 0:n.config},WA=n=>{var e;return(e=im())==null?void 0:e[`_${n}`]};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class fr{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}wrapCallback(e){return(t,r)=>{t?this.reject(t):this.resolve(r),typeof e=="function"&&(this.promise.catch(()=>{}),e.length===1?e(t):e(t,r))}}}/**
 * @license
 * Copyright 2025 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ti(n){try{return(n.startsWith("http://")||n.startsWith("https://")?new URL(n).hostname:n).endsWith(".cloudworkstations.dev")}catch{return!1}}async function om(n){return(await fetch(n,{credentials:"include"})).ok}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function GA(n,e){if(n.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');const t={alg:"none",type:"JWT"},r=e||"demo-project",s=n.iat||0,i=n.sub||n.user_id;if(!i)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");const o={iss:`https://securetoken.google.com/${r}`,aud:r,iat:s,exp:s+3600,auth_time:s,sub:i,user_id:i,firebase:{sign_in_provider:"custom",identities:{}},...n},a="";return[rp(JSON.stringify(t)),rp(JSON.stringify(o)),a].join(".")}const mu={};function VM(){const n={prod:[],emulator:[]};for(const e of Object.keys(mu))mu[e]?n.emulator.push(e):n.prod.push(e);return n}function FM(n){let e=document.getElementById(n),t=!1;return e||(e=document.createElement("div"),e.setAttribute("id",n),t=!0),{created:t,element:e}}let Cx=!1;function _0(n,e){if(typeof window>"u"||typeof document>"u"||!ti(window.location.host)||mu[n]===e||mu[n]||Cx)return;mu[n]=e;function t(p){return`__firebase__banner__${p}`}const r="__firebase__banner",i=VM().prod.length>0;function o(){const p=document.getElementById(r);p&&p.remove()}function a(p){p.style.display="flex",p.style.background="#7faaf0",p.style.position="fixed",p.style.bottom="5px",p.style.left="5px",p.style.padding=".5em",p.style.borderRadius="5px",p.style.alignItems="center"}function l(p,y){p.setAttribute("width","24"),p.setAttribute("id",y),p.setAttribute("height","24"),p.setAttribute("viewBox","0 0 24 24"),p.setAttribute("fill","none"),p.style.marginLeft="-6px"}function u(){const p=document.createElement("span");return p.style.cursor="pointer",p.style.marginLeft="16px",p.style.fontSize="24px",p.innerHTML=" &times;",p.onclick=()=>{Cx=!0,o()},p}function h(p,y){p.setAttribute("id",y),p.innerText="Learn more",p.href="https://firebase.google.com/docs/studio/preview-apps#preview-backend",p.setAttribute("target","__blank"),p.style.paddingLeft="5px",p.style.textDecoration="underline"}function f(){const p=FM(r),y=t("text"),I=document.getElementById(y)||document.createElement("span"),C=t("learnmore"),P=document.getElementById(C)||document.createElement("a"),A=t("preprendIcon"),T=document.getElementById(A)||document.createElementNS("http://www.w3.org/2000/svg","svg");if(p.created){const R=p.element;a(R),h(P,C);const D=u();l(T,A),R.append(T,I,P,D),document.body.appendChild(R)}i?(I.innerText="Preview backend disconnected.",T.innerHTML=`<g clip-path="url(#clip0_6013_33858)">
<path d="M4.8 17.6L12 5.6L19.2 17.6H4.8ZM6.91667 16.4H17.0833L12 7.93333L6.91667 16.4ZM12 15.6C12.1667 15.6 12.3056 15.5444 12.4167 15.4333C12.5389 15.3111 12.6 15.1667 12.6 15C12.6 14.8333 12.5389 14.6944 12.4167 14.5833C12.3056 14.4611 12.1667 14.4 12 14.4C11.8333 14.4 11.6889 14.4611 11.5667 14.5833C11.4556 14.6944 11.4 14.8333 11.4 15C11.4 15.1667 11.4556 15.3111 11.5667 15.4333C11.6889 15.5444 11.8333 15.6 12 15.6ZM11.4 13.6H12.6V10.4H11.4V13.6Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6013_33858">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`):(T.innerHTML=`<g clip-path="url(#clip0_6083_34804)">
<path d="M11.4 15.2H12.6V11.2H11.4V15.2ZM12 10C12.1667 10 12.3056 9.94444 12.4167 9.83333C12.5389 9.71111 12.6 9.56667 12.6 9.4C12.6 9.23333 12.5389 9.09444 12.4167 8.98333C12.3056 8.86111 12.1667 8.8 12 8.8C11.8333 8.8 11.6889 8.86111 11.5667 8.98333C11.4556 9.09444 11.4 9.23333 11.4 9.4C11.4 9.56667 11.4556 9.71111 11.5667 9.83333C11.6889 9.94444 11.8333 10 12 10ZM12 18.4C11.1222 18.4 10.2944 18.2333 9.51667 17.9C8.73889 17.5667 8.05556 17.1111 7.46667 16.5333C6.88889 15.9444 6.43333 15.2611 6.1 14.4833C5.76667 13.7056 5.6 12.8778 5.6 12C5.6 11.1111 5.76667 10.2833 6.1 9.51667C6.43333 8.73889 6.88889 8.06111 7.46667 7.48333C8.05556 6.89444 8.73889 6.43333 9.51667 6.1C10.2944 5.76667 11.1222 5.6 12 5.6C12.8889 5.6 13.7167 5.76667 14.4833 6.1C15.2611 6.43333 15.9389 6.89444 16.5167 7.48333C17.1056 8.06111 17.5667 8.73889 17.9 9.51667C18.2333 10.2833 18.4 11.1111 18.4 12C18.4 12.8778 18.2333 13.7056 17.9 14.4833C17.5667 15.2611 17.1056 15.9444 16.5167 16.5333C15.9389 17.1111 15.2611 17.5667 14.4833 17.9C13.7167 18.2333 12.8889 18.4 12 18.4ZM12 17.2C13.4444 17.2 14.6722 16.6944 15.6833 15.6833C16.6944 14.6722 17.2 13.4444 17.2 12C17.2 10.5556 16.6944 9.32778 15.6833 8.31667C14.6722 7.30555 13.4444 6.8 12 6.8C10.5556 6.8 9.32778 7.30555 8.31667 8.31667C7.30556 9.32778 6.8 10.5556 6.8 12C6.8 13.4444 7.30556 14.6722 8.31667 15.6833C9.32778 16.6944 10.5556 17.2 12 17.2Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6083_34804">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`,I.innerText="Preview backend running in this workspace."),I.setAttribute("id",y)}document.readyState==="loading"?window.addEventListener("DOMContentLoaded",f):f()}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function nn(){return typeof navigator<"u"&&typeof navigator.userAgent=="string"?navigator.userAgent:""}function v0(){return typeof window<"u"&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(nn())}function HA(){var e;const n=(e=im())==null?void 0:e.forceEnvironment;if(n==="node")return!0;if(n==="browser")return!1;try{return Object.prototype.toString.call(global.process)==="[object process]"}catch{return!1}}function jM(){return typeof navigator<"u"&&navigator.userAgent==="Cloudflare-Workers"}function w0(){const n=typeof chrome=="object"?chrome.runtime:typeof browser=="object"?browser.runtime:void 0;return typeof n=="object"&&n.id!==void 0}function KA(){return typeof navigator=="object"&&navigator.product==="ReactNative"}function UM(){const n=nn();return n.indexOf("MSIE ")>=0||n.indexOf("Trident/")>=0}function QA(){return VA.NODE_ADMIN===!0}function YA(){return!HA()&&!!navigator.userAgent&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")}function JA(){return!HA()&&!!navigator.userAgent&&(navigator.userAgent.includes("Safari")||navigator.userAgent.includes("WebKit"))&&!navigator.userAgent.includes("Chrome")}function am(){try{return typeof indexedDB=="object"}catch{return!1}}function I0(){return new Promise((n,e)=>{try{let t=!0;const r="validate-browser-context-for-indexeddb-analytics-module",s=self.indexedDB.open(r);s.onsuccess=()=>{s.result.close(),t||self.indexedDB.deleteDatabase(r),n(!0)},s.onupgradeneeded=()=>{t=!1},s.onerror=()=>{var i;e(((i=s.error)==null?void 0:i.message)||"")}}catch(t){e(t)}})}function XA(){return!(typeof navigator>"u"||!navigator.cookieEnabled)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const BM="FirebaseError";class ts extends Error{constructor(e,t,r){super(t),this.code=e,this.customData=r,this.name=BM,Object.setPrototypeOf(this,ts.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,ya.prototype.create)}}class ya{constructor(e,t,r){this.service=e,this.serviceName=t,this.errors=r}create(e,...t){const r=t[0]||{},s=`${this.service}/${e}`,i=this.errors[e],o=i?$M(i,r):"Error",a=`${this.serviceName}: ${o} (${s}).`;return new ts(s,a,r)}}function $M(n,e){return n.replace(zM,(t,r)=>{const s=e[r];return s!=null?String(s):`<${r}?>`})}const zM=/\{\$([^}]+)}/g;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Yu(n){return JSON.parse(n)}function en(n){return JSON.stringify(n)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ZA=function(n){let e={},t={},r={},s="";try{const i=n.split(".");e=Yu(sp(i[0])||""),t=Yu(sp(i[1])||""),s=i[2],r=t.d||{},delete t.d}catch{}return{header:e,claims:t,data:r,signature:s}},qM=function(n){const e=ZA(n),t=e.claims;return!!t&&typeof t=="object"&&t.hasOwnProperty("iat")},WM=function(n){const e=ZA(n).claims;return typeof e=="object"&&e.admin===!0};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ns(n,e){return Object.prototype.hasOwnProperty.call(n,e)}function Xo(n,e){if(Object.prototype.hasOwnProperty.call(n,e))return n[e]}function ip(n){for(const e in n)if(Object.prototype.hasOwnProperty.call(n,e))return!1;return!0}function op(n,e,t){const r={};for(const s in n)Object.prototype.hasOwnProperty.call(n,s)&&(r[s]=e.call(t,n[s],s,n));return r}function Ir(n,e){if(n===e)return!0;const t=Object.keys(n),r=Object.keys(e);for(const s of t){if(!r.includes(s))return!1;const i=n[s],o=e[s];if(Rx(i)&&Rx(o)){if(!Ir(i,o))return!1}else if(i!==o)return!1}for(const s of r)if(!t.includes(s))return!1;return!0}function Rx(n){return n!==null&&typeof n=="object"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function _a(n){const e=[];for(const[t,r]of Object.entries(n))Array.isArray(r)?r.forEach(s=>{e.push(encodeURIComponent(t)+"="+encodeURIComponent(s))}):e.push(encodeURIComponent(t)+"="+encodeURIComponent(r));return e.length?"&"+e.join("&"):""}function Jc(n){const e={};return n.replace(/^\?/,"").split("&").forEach(r=>{if(r){const[s,i]=r.split("=");e[decodeURIComponent(s)]=decodeURIComponent(i)}}),e}function Xc(n){const e=n.indexOf("?");if(!e)return"";const t=n.indexOf("#",e);return n.substring(e,t>0?t:void 0)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class GM{constructor(){this.chain_=[],this.buf_=[],this.W_=[],this.pad_=[],this.inbuf_=0,this.total_=0,this.blockSize=512/8,this.pad_[0]=128;for(let e=1;e<this.blockSize;++e)this.pad_[e]=0;this.reset()}reset(){this.chain_[0]=1732584193,this.chain_[1]=4023233417,this.chain_[2]=2562383102,this.chain_[3]=271733878,this.chain_[4]=3285377520,this.inbuf_=0,this.total_=0}compress_(e,t){t||(t=0);const r=this.W_;if(typeof e=="string")for(let f=0;f<16;f++)r[f]=e.charCodeAt(t)<<24|e.charCodeAt(t+1)<<16|e.charCodeAt(t+2)<<8|e.charCodeAt(t+3),t+=4;else for(let f=0;f<16;f++)r[f]=e[t]<<24|e[t+1]<<16|e[t+2]<<8|e[t+3],t+=4;for(let f=16;f<80;f++){const p=r[f-3]^r[f-8]^r[f-14]^r[f-16];r[f]=(p<<1|p>>>31)&4294967295}let s=this.chain_[0],i=this.chain_[1],o=this.chain_[2],a=this.chain_[3],l=this.chain_[4],u,h;for(let f=0;f<80;f++){f<40?f<20?(u=a^i&(o^a),h=1518500249):(u=i^o^a,h=1859775393):f<60?(u=i&o|a&(i|o),h=2400959708):(u=i^o^a,h=3395469782);const p=(s<<5|s>>>27)+u+l+h+r[f]&4294967295;l=a,a=o,o=(i<<30|i>>>2)&4294967295,i=s,s=p}this.chain_[0]=this.chain_[0]+s&4294967295,this.chain_[1]=this.chain_[1]+i&4294967295,this.chain_[2]=this.chain_[2]+o&4294967295,this.chain_[3]=this.chain_[3]+a&4294967295,this.chain_[4]=this.chain_[4]+l&4294967295}update(e,t){if(e==null)return;t===void 0&&(t=e.length);const r=t-this.blockSize;let s=0;const i=this.buf_;let o=this.inbuf_;for(;s<t;){if(o===0)for(;s<=r;)this.compress_(e,s),s+=this.blockSize;if(typeof e=="string"){for(;s<t;)if(i[o]=e.charCodeAt(s),++o,++s,o===this.blockSize){this.compress_(i),o=0;break}}else for(;s<t;)if(i[o]=e[s],++o,++s,o===this.blockSize){this.compress_(i),o=0;break}}this.inbuf_=o,this.total_+=t}digest(){const e=[];let t=this.total_*8;this.inbuf_<56?this.update(this.pad_,56-this.inbuf_):this.update(this.pad_,this.blockSize-(this.inbuf_-56));for(let s=this.blockSize-1;s>=56;s--)this.buf_[s]=t&255,t/=256;this.compress_(this.buf_);let r=0;for(let s=0;s<5;s++)for(let i=24;i>=0;i-=8)e[r]=this.chain_[s]>>i&255,++r;return e}}function HM(n,e){const t=new KM(n,e);return t.subscribe.bind(t)}class KM{constructor(e,t){this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=t,this.task.then(()=>{e(this)}).catch(r=>{this.error(r)})}next(e){this.forEachObserver(t=>{t.next(e)})}error(e){this.forEachObserver(t=>{t.error(e)}),this.close(e)}complete(){this.forEachObserver(e=>{e.complete()}),this.close()}subscribe(e,t,r){let s;if(e===void 0&&t===void 0&&r===void 0)throw new Error("Missing Observer.");QM(e,["next","error","complete"])?s=e:s={next:e,error:t,complete:r},s.next===void 0&&(s.next=Xg),s.error===void 0&&(s.error=Xg),s.complete===void 0&&(s.complete=Xg);const i=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then(()=>{try{this.finalError?s.error(this.finalError):s.complete()}catch{}}),this.observers.push(s),i}unsubscribeOne(e){this.observers===void 0||this.observers[e]===void 0||(delete this.observers[e],this.observerCount-=1,this.observerCount===0&&this.onNoObservers!==void 0&&this.onNoObservers(this))}forEachObserver(e){if(!this.finalized)for(let t=0;t<this.observers.length;t++)this.sendOne(t,e)}sendOne(e,t){this.task.then(()=>{if(this.observers!==void 0&&this.observers[e]!==void 0)try{t(this.observers[e])}catch(r){typeof console<"u"&&console.error&&console.error(r)}})}close(e){this.finalized||(this.finalized=!0,e!==void 0&&(this.finalError=e),this.task.then(()=>{this.observers=void 0,this.onNoObservers=void 0}))}}function QM(n,e){if(typeof n!="object"||n===null)return!1;for(const t of e)if(t in n&&typeof n[t]=="function")return!0;return!1}function Xg(){}function Zo(n,e){return`${n} failed: ${e} argument `}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const YM=function(n){const e=[];let t=0;for(let r=0;r<n.length;r++){let s=n.charCodeAt(r);if(s>=55296&&s<=56319){const i=s-55296;r++,Y(r<n.length,"Surrogate pair missing trail surrogate.");const o=n.charCodeAt(r)-56320;s=65536+(i<<10)+o}s<128?e[t++]=s:s<2048?(e[t++]=s>>6|192,e[t++]=s&63|128):s<65536?(e[t++]=s>>12|224,e[t++]=s>>6&63|128,e[t++]=s&63|128):(e[t++]=s>>18|240,e[t++]=s>>12&63|128,e[t++]=s>>6&63|128,e[t++]=s&63|128)}return e},lm=function(n){let e=0;for(let t=0;t<n.length;t++){const r=n.charCodeAt(t);r<128?e++:r<2048?e+=2:r>=55296&&r<=56319?(e+=4,t++):e+=3}return e};/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const JM=1e3,XM=2,ZM=4*60*60*1e3,eL=.5;function Nx(n,e=JM,t=XM){const r=e*Math.pow(t,n),s=Math.round(eL*r*(Math.random()-.5)*2);return Math.min(ZM,r+s)}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ne(n){return n&&n._delegate?n._delegate:n}class sr{constructor(e,t,r){this.name=e,this.instanceFactory=t,this.type=r,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const So="[DEFAULT]";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class x_{constructor(e,t){this.name=e,this.container=t,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(e){const t=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(t)){const r=new fr;if(this.instancesDeferred.set(t,r),this.isInitialized(t)||this.shouldAutoInitialize())try{const s=this.getOrInitializeService({instanceIdentifier:t});s&&r.resolve(s)}catch{}}return this.instancesDeferred.get(t).promise}getImmediate(e){const t=this.normalizeInstanceIdentifier(e==null?void 0:e.identifier),r=(e==null?void 0:e.optional)??!1;if(this.isInitialized(t)||this.shouldAutoInitialize())try{return this.getOrInitializeService({instanceIdentifier:t})}catch(s){if(r)return null;throw s}else{if(r)return null;throw Error(`Service ${this.name} is not available`)}}getComponent(){return this.component}setComponent(e){if(e.name!==this.name)throw Error(`Mismatching Component ${e.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=e,!!this.shouldAutoInitialize()){if(nL(e))try{this.getOrInitializeService({instanceIdentifier:So})}catch{}for(const[t,r]of this.instancesDeferred.entries()){const s=this.normalizeInstanceIdentifier(t);try{const i=this.getOrInitializeService({instanceIdentifier:s});r.resolve(i)}catch{}}}}clearInstance(e=So){this.instancesDeferred.delete(e),this.instancesOptions.delete(e),this.instances.delete(e)}async delete(){const e=Array.from(this.instances.values());await Promise.all([...e.filter(t=>"INTERNAL"in t).map(t=>t.INTERNAL.delete()),...e.filter(t=>"_delete"in t).map(t=>t._delete())])}isComponentSet(){return this.component!=null}isInitialized(e=So){return this.instances.has(e)}getOptions(e=So){return this.instancesOptions.get(e)||{}}initialize(e={}){const{options:t={}}=e,r=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(r))throw Error(`${this.name}(${r}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const s=this.getOrInitializeService({instanceIdentifier:r,options:t});for(const[i,o]of this.instancesDeferred.entries()){const a=this.normalizeInstanceIdentifier(i);r===a&&o.resolve(s)}return s}onInit(e,t){const r=this.normalizeInstanceIdentifier(t),s=this.onInitCallbacks.get(r)??new Set;s.add(e),this.onInitCallbacks.set(r,s);const i=this.instances.get(r);return i&&e(i,r),()=>{s.delete(e)}}invokeOnInitCallbacks(e,t){const r=this.onInitCallbacks.get(t);if(r)for(const s of r)try{s(e,t)}catch{}}getOrInitializeService({instanceIdentifier:e,options:t={}}){let r=this.instances.get(e);if(!r&&this.component&&(r=this.component.instanceFactory(this.container,{instanceIdentifier:tL(e),options:t}),this.instances.set(e,r),this.instancesOptions.set(e,t),this.invokeOnInitCallbacks(r,e),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,e,r)}catch{}return r||null}normalizeInstanceIdentifier(e=So){return this.component?this.component.multipleInstances?e:So:e}shouldAutoInitialize(){return!!this.component&&this.component.instantiationMode!=="EXPLICIT"}}function tL(n){return n===So?void 0:n}function nL(n){return n.instantiationMode==="EAGER"}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class eC{constructor(e){this.name=e,this.providers=new Map}addComponent(e){const t=this.getProvider(e.name);if(t.isComponentSet())throw new Error(`Component ${e.name} has already been registered with ${this.name}`);t.setComponent(e)}addOrOverwriteComponent(e){this.getProvider(e.name).isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)}getProvider(e){if(this.providers.has(e))return this.providers.get(e);const t=new x_(e,this);return this.providers.set(e,t),t}getProviders(){return Array.from(this.providers.values())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Fe;(function(n){n[n.DEBUG=0]="DEBUG",n[n.VERBOSE=1]="VERBOSE",n[n.INFO=2]="INFO",n[n.WARN=3]="WARN",n[n.ERROR=4]="ERROR",n[n.SILENT=5]="SILENT"})(Fe||(Fe={}));const rL={debug:Fe.DEBUG,verbose:Fe.VERBOSE,info:Fe.INFO,warn:Fe.WARN,error:Fe.ERROR,silent:Fe.SILENT},sL=Fe.INFO,iL={[Fe.DEBUG]:"log",[Fe.VERBOSE]:"log",[Fe.INFO]:"info",[Fe.WARN]:"warn",[Fe.ERROR]:"error"},oL=(n,e,...t)=>{if(e<n.logLevel)return;const r=new Date().toISOString(),s=iL[e];if(s)console[s](`[${r}]  ${n.name}:`,...t);else throw new Error(`Attempted to log a message with an invalid logType (value: ${e})`)};class Pd{constructor(e){this.name=e,this._logLevel=sL,this._logHandler=oL,this._userLogHandler=null}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in Fe))throw new TypeError(`Invalid value "${e}" assigned to \`logLevel\``);this._logLevel=e}setLogLevel(e){this._logLevel=typeof e=="string"?rL[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if(typeof e!="function")throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(...e){this._userLogHandler&&this._userLogHandler(this,Fe.DEBUG,...e),this._logHandler(this,Fe.DEBUG,...e)}log(...e){this._userLogHandler&&this._userLogHandler(this,Fe.VERBOSE,...e),this._logHandler(this,Fe.VERBOSE,...e)}info(...e){this._userLogHandler&&this._userLogHandler(this,Fe.INFO,...e),this._logHandler(this,Fe.INFO,...e)}warn(...e){this._userLogHandler&&this._userLogHandler(this,Fe.WARN,...e),this._logHandler(this,Fe.WARN,...e)}error(...e){this._userLogHandler&&this._userLogHandler(this,Fe.ERROR,...e),this._logHandler(this,Fe.ERROR,...e)}}const aL=(n,e)=>e.some(t=>n instanceof t);let Px,kx;function lL(){return Px||(Px=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function cL(){return kx||(kx=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const tC=new WeakMap,T_=new WeakMap,nC=new WeakMap,Zg=new WeakMap,E0=new WeakMap;function uL(n){const e=new Promise((t,r)=>{const s=()=>{n.removeEventListener("success",i),n.removeEventListener("error",o)},i=()=>{t(Ui(n.result)),s()},o=()=>{r(n.error),s()};n.addEventListener("success",i),n.addEventListener("error",o)});return e.then(t=>{t instanceof IDBCursor&&tC.set(t,n)}).catch(()=>{}),E0.set(e,n),e}function dL(n){if(T_.has(n))return;const e=new Promise((t,r)=>{const s=()=>{n.removeEventListener("complete",i),n.removeEventListener("error",o),n.removeEventListener("abort",o)},i=()=>{t(),s()},o=()=>{r(n.error||new DOMException("AbortError","AbortError")),s()};n.addEventListener("complete",i),n.addEventListener("error",o),n.addEventListener("abort",o)});T_.set(n,e)}let S_={get(n,e,t){if(n instanceof IDBTransaction){if(e==="done")return T_.get(n);if(e==="objectStoreNames")return n.objectStoreNames||nC.get(n);if(e==="store")return t.objectStoreNames[1]?void 0:t.objectStore(t.objectStoreNames[0])}return Ui(n[e])},set(n,e,t){return n[e]=t,!0},has(n,e){return n instanceof IDBTransaction&&(e==="done"||e==="store")?!0:e in n}};function hL(n){S_=n(S_)}function fL(n){return n===IDBDatabase.prototype.transaction&&!("objectStoreNames"in IDBTransaction.prototype)?function(e,...t){const r=n.call(ey(this),e,...t);return nC.set(r,e.sort?e.sort():[e]),Ui(r)}:cL().includes(n)?function(...e){return n.apply(ey(this),e),Ui(tC.get(this))}:function(...e){return Ui(n.apply(ey(this),e))}}function pL(n){return typeof n=="function"?fL(n):(n instanceof IDBTransaction&&dL(n),aL(n,lL())?new Proxy(n,S_):n)}function Ui(n){if(n instanceof IDBRequest)return uL(n);if(Zg.has(n))return Zg.get(n);const e=pL(n);return e!==n&&(Zg.set(n,e),E0.set(e,n)),e}const ey=n=>E0.get(n);function rC(n,e,{blocked:t,upgrade:r,blocking:s,terminated:i}={}){const o=indexedDB.open(n,e),a=Ui(o);return r&&o.addEventListener("upgradeneeded",l=>{r(Ui(o.result),l.oldVersion,l.newVersion,Ui(o.transaction),l)}),t&&o.addEventListener("blocked",l=>t(l.oldVersion,l.newVersion,l)),a.then(l=>{i&&l.addEventListener("close",()=>i()),s&&l.addEventListener("versionchange",u=>s(u.oldVersion,u.newVersion,u))}).catch(()=>{}),a}const mL=["get","getKey","getAll","getAllKeys","count"],gL=["put","add","delete","clear"],ty=new Map;function Dx(n,e){if(!(n instanceof IDBDatabase&&!(e in n)&&typeof e=="string"))return;if(ty.get(e))return ty.get(e);const t=e.replace(/FromIndex$/,""),r=e!==t,s=gL.includes(t);if(!(t in(r?IDBIndex:IDBObjectStore).prototype)||!(s||mL.includes(t)))return;const i=async function(o,...a){const l=this.transaction(o,s?"readwrite":"readonly");let u=l.store;return r&&(u=u.index(a.shift())),(await Promise.all([u[t](...a),s&&l.done]))[0]};return ty.set(e,i),i}hL(n=>({...n,get:(e,t,r)=>Dx(e,t)||n.get(e,t,r),has:(e,t)=>!!Dx(e,t)||n.has(e,t)}));/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class yL{constructor(e){this.container=e}getPlatformInfoString(){return this.container.getProviders().map(t=>{if(_L(t)){const r=t.getImmediate();return`${r.library}/${r.version}`}else return null}).filter(t=>t).join(" ")}}function _L(n){const e=n.getComponent();return(e==null?void 0:e.type)==="VERSION"}const b_="@firebase/app",Ox="0.14.1";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Hs=new Pd("@firebase/app"),vL="@firebase/app-compat",wL="@firebase/analytics-compat",IL="@firebase/analytics",EL="@firebase/app-check-compat",xL="@firebase/app-check",TL="@firebase/auth",SL="@firebase/auth-compat",bL="@firebase/database",AL="@firebase/data-connect",CL="@firebase/database-compat",RL="@firebase/functions",NL="@firebase/functions-compat",PL="@firebase/installations",kL="@firebase/installations-compat",DL="@firebase/messaging",OL="@firebase/messaging-compat",ML="@firebase/performance",LL="@firebase/performance-compat",VL="@firebase/remote-config",FL="@firebase/remote-config-compat",jL="@firebase/storage",UL="@firebase/storage-compat",BL="@firebase/firestore",$L="@firebase/ai",zL="@firebase/firestore-compat",qL="firebase",WL="12.1.0";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ap="[DEFAULT]",GL={[b_]:"fire-core",[vL]:"fire-core-compat",[IL]:"fire-analytics",[wL]:"fire-analytics-compat",[xL]:"fire-app-check",[EL]:"fire-app-check-compat",[TL]:"fire-auth",[SL]:"fire-auth-compat",[bL]:"fire-rtdb",[AL]:"fire-data-connect",[CL]:"fire-rtdb-compat",[RL]:"fire-fn",[NL]:"fire-fn-compat",[PL]:"fire-iid",[kL]:"fire-iid-compat",[DL]:"fire-fcm",[OL]:"fire-fcm-compat",[ML]:"fire-perf",[LL]:"fire-perf-compat",[VL]:"fire-rc",[FL]:"fire-rc-compat",[jL]:"fire-gcs",[UL]:"fire-gcs-compat",[BL]:"fire-fst",[zL]:"fire-fst-compat",[$L]:"fire-vertex","fire-js":"fire-js",[qL]:"fire-js-all"};/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ju=new Map,HL=new Map,A_=new Map;function Mx(n,e){try{n.container.addComponent(e)}catch(t){Hs.debug(`Component ${e.name} failed to register with FirebaseApp ${n.name}`,t)}}function es(n){const e=n.name;if(A_.has(e))return Hs.debug(`There were multiple attempts to register component ${e}.`),!1;A_.set(e,n);for(const t of Ju.values())Mx(t,n);for(const t of HL.values())Mx(t,n);return!0}function bs(n,e){const t=n.container.getProvider("heartbeat").getImmediate({optional:!0});return t&&t.triggerHeartbeat(),n.container.getProvider(e)}function KL(n,e,t=ap){bs(n,e).clearInstance(t)}function Pt(n){return n==null?!1:n.settings!==void 0}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const QL={"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."},Bi=new ya("app","Firebase",QL);/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class YL{constructor(e,t,r){this._isDeleted=!1,this._options={...e},this._config={...t},this._name=t.name,this._automaticDataCollectionEnabled=t.automaticDataCollectionEnabled,this._container=r,this.container.addComponent(new sr("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this.checkDestroyed(),this._automaticDataCollectionEnabled=e}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(e){this._isDeleted=e}checkDestroyed(){if(this.isDeleted)throw Bi.create("app-deleted",{appName:this._name})}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const va=WL;function sC(n,e={}){let t=n;typeof e!="object"&&(e={name:e});const r={name:ap,automaticDataCollectionEnabled:!0,...e},s=r.name;if(typeof s!="string"||!s)throw Bi.create("bad-app-name",{appName:String(s)});if(t||(t=qA()),!t)throw Bi.create("no-options");const i=Ju.get(s);if(i){if(Ir(t,i.options)&&Ir(r,i.config))return i;throw Bi.create("duplicate-app",{appName:s})}const o=new eC(s);for(const l of A_.values())o.addComponent(l);const a=new YL(t,r,o);return Ju.set(s,a),a}function kd(n=ap){const e=Ju.get(n);if(!e&&n===ap&&qA())return sC();if(!e)throw Bi.create("no-app",{appName:n});return e}function JL(){return Array.from(Ju.values())}function nr(n,e,t){let r=GL[n]??n;t&&(r+=`-${t}`);const s=r.match(/\s|\//),i=e.match(/\s|\//);if(s||i){const o=[`Unable to register library "${r}" with version "${e}":`];s&&o.push(`library name "${r}" contains illegal characters (whitespace or "/")`),s&&i&&o.push("and"),i&&o.push(`version name "${e}" contains illegal characters (whitespace or "/")`),Hs.warn(o.join(" "));return}es(new sr(`${r}-version`,()=>({library:r,version:e}),"VERSION"))}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const XL="firebase-heartbeat-database",ZL=1,Xu="firebase-heartbeat-store";let ny=null;function iC(){return ny||(ny=rC(XL,ZL,{upgrade:(n,e)=>{switch(e){case 0:try{n.createObjectStore(Xu)}catch(t){console.warn(t)}}}}).catch(n=>{throw Bi.create("idb-open",{originalErrorMessage:n.message})})),ny}async function eV(n){try{const t=(await iC()).transaction(Xu),r=await t.objectStore(Xu).get(oC(n));return await t.done,r}catch(e){if(e instanceof ts)Hs.warn(e.message);else{const t=Bi.create("idb-get",{originalErrorMessage:e==null?void 0:e.message});Hs.warn(t.message)}}}async function Lx(n,e){try{const r=(await iC()).transaction(Xu,"readwrite");await r.objectStore(Xu).put(e,oC(n)),await r.done}catch(t){if(t instanceof ts)Hs.warn(t.message);else{const r=Bi.create("idb-set",{originalErrorMessage:t==null?void 0:t.message});Hs.warn(r.message)}}}function oC(n){return`${n.name}!${n.options.appId}`}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const tV=1024,nV=30;class rV{constructor(e){this.container=e,this._heartbeatsCache=null;const t=this.container.getProvider("app").getImmediate();this._storage=new iV(t),this._heartbeatsCachePromise=this._storage.read().then(r=>(this._heartbeatsCache=r,r))}async triggerHeartbeat(){var e,t;try{const s=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),i=Vx();if(((e=this._heartbeatsCache)==null?void 0:e.heartbeats)==null&&(this._heartbeatsCache=await this._heartbeatsCachePromise,((t=this._heartbeatsCache)==null?void 0:t.heartbeats)==null)||this._heartbeatsCache.lastSentHeartbeatDate===i||this._heartbeatsCache.heartbeats.some(o=>o.date===i))return;if(this._heartbeatsCache.heartbeats.push({date:i,agent:s}),this._heartbeatsCache.heartbeats.length>nV){const o=oV(this._heartbeatsCache.heartbeats);this._heartbeatsCache.heartbeats.splice(o,1)}return this._storage.overwrite(this._heartbeatsCache)}catch(r){Hs.warn(r)}}async getHeartbeatsHeader(){var e;try{if(this._heartbeatsCache===null&&await this._heartbeatsCachePromise,((e=this._heartbeatsCache)==null?void 0:e.heartbeats)==null||this._heartbeatsCache.heartbeats.length===0)return"";const t=Vx(),{heartbeatsToSend:r,unsentEntries:s}=sV(this._heartbeatsCache.heartbeats),i=rp(JSON.stringify({version:2,heartbeats:r}));return this._heartbeatsCache.lastSentHeartbeatDate=t,s.length>0?(this._heartbeatsCache.heartbeats=s,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),i}catch(t){return Hs.warn(t),""}}}function Vx(){return new Date().toISOString().substring(0,10)}function sV(n,e=tV){const t=[];let r=n.slice();for(const s of n){const i=t.find(o=>o.agent===s.agent);if(i){if(i.dates.push(s.date),Fx(t)>e){i.dates.pop();break}}else if(t.push({agent:s.agent,dates:[s.date]}),Fx(t)>e){t.pop();break}r=r.slice(1)}return{heartbeatsToSend:t,unsentEntries:r}}class iV{constructor(e){this.app=e,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return am()?I0().then(()=>!0).catch(()=>!1):!1}async read(){if(await this._canUseIndexedDBPromise){const t=await eV(this.app);return t!=null&&t.heartbeats?t:{heartbeats:[]}}else return{heartbeats:[]}}async overwrite(e){if(await this._canUseIndexedDBPromise){const r=await this.read();return Lx(this.app,{lastSentHeartbeatDate:e.lastSentHeartbeatDate??r.lastSentHeartbeatDate,heartbeats:e.heartbeats})}else return}async add(e){if(await this._canUseIndexedDBPromise){const r=await this.read();return Lx(this.app,{lastSentHeartbeatDate:e.lastSentHeartbeatDate??r.lastSentHeartbeatDate,heartbeats:[...r.heartbeats,...e.heartbeats]})}else return}}function Fx(n){return rp(JSON.stringify({version:2,heartbeats:n})).length}function oV(n){if(n.length===0)return-1;let e=0,t=n[0].date;for(let r=1;r<n.length;r++)n[r].date<t&&(t=n[r].date,e=r);return e}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function aV(n){es(new sr("platform-logger",e=>new yL(e),"PRIVATE")),es(new sr("heartbeat",e=>new rV(e),"PRIVATE")),nr(b_,Ox,n),nr(b_,Ox,"esm2020"),nr("fire-js","")}aV("");var lV="firebase",cV="12.1.0";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */nr(lV,cV,"app");const jx="@firebase/database",Ux="1.1.0";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let aC="";function lC(n){aC=n}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class uV{constructor(e){this.domStorage_=e,this.prefix_="firebase:"}set(e,t){t==null?this.domStorage_.removeItem(this.prefixedName_(e)):this.domStorage_.setItem(this.prefixedName_(e),en(t))}get(e){const t=this.domStorage_.getItem(this.prefixedName_(e));return t==null?null:Yu(t)}remove(e){this.domStorage_.removeItem(this.prefixedName_(e))}prefixedName_(e){return this.prefix_+e}toString(){return this.domStorage_.toString()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class dV{constructor(){this.cache_={},this.isInMemoryStorage=!0}set(e,t){t==null?delete this.cache_[e]:this.cache_[e]=t}get(e){return ns(this.cache_,e)?this.cache_[e]:null}remove(e){delete this.cache_[e]}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const cC=function(n){try{if(typeof window<"u"&&typeof window[n]<"u"){const e=window[n];return e.setItem("firebase:sentinel","cache"),e.removeItem("firebase:sentinel"),new uV(e)}}catch{}return new dV},Lo=cC("localStorage"),C_=cC("sessionStorage");/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const hl=new Pd("@firebase/database"),uC=function(){let n=1;return function(){return n++}}(),dC=function(n){const e=YM(n),t=new GM;t.update(e);const r=t.digest();return y0.encodeByteArray(r)},Dd=function(...n){let e="";for(let t=0;t<n.length;t++){const r=n[t];Array.isArray(r)||r&&typeof r=="object"&&typeof r.length=="number"?e+=Dd.apply(null,r):typeof r=="object"?e+=en(r):e+=r,e+=" "}return e};let $o=null,Bx=!0;const hC=function(n,e){Y(!e||n===!0||n===!1,"Can't turn on custom loggers persistently."),n===!0?(hl.logLevel=Fe.VERBOSE,$o=hl.log.bind(hl),e&&C_.set("logging_enabled",!0)):typeof n=="function"?$o=n:($o=null,C_.remove("logging_enabled"))},dn=function(...n){if(Bx===!0&&(Bx=!1,$o===null&&C_.get("logging_enabled")===!0&&hC(!0)),$o){const e=Dd.apply(null,n);$o(e)}},Od=function(n){return function(...e){dn(n,...e)}},R_=function(...n){const e="FIREBASE INTERNAL ERROR: "+Dd(...n);hl.error(e)},xs=function(...n){const e=`FIREBASE FATAL ERROR: ${Dd(...n)}`;throw hl.error(e),new Error(e)},Dn=function(...n){const e="FIREBASE WARNING: "+Dd(...n);hl.warn(e)},hV=function(){typeof window<"u"&&window.location&&window.location.protocol&&window.location.protocol.indexOf("https:")!==-1&&Dn("Insecure Firebase access from a secure page. Please use https in calls to new Firebase().")},cm=function(n){return typeof n=="number"&&(n!==n||n===Number.POSITIVE_INFINITY||n===Number.NEGATIVE_INFINITY)},fV=function(n){if(document.readyState==="complete")n();else{let e=!1;const t=function(){if(!document.body){setTimeout(t,Math.floor(10));return}e||(e=!0,n())};document.addEventListener?(document.addEventListener("DOMContentLoaded",t,!1),window.addEventListener("load",t,!1)):document.attachEvent&&(document.attachEvent("onreadystatechange",()=>{document.readyState==="complete"&&t()}),window.attachEvent("onload",t))}},Qi="[MIN_NAME]",Ks="[MAX_NAME]",wa=function(n,e){if(n===e)return 0;if(n===Qi||e===Ks)return-1;if(e===Qi||n===Ks)return 1;{const t=$x(n),r=$x(e);return t!==null?r!==null?t-r===0?n.length-e.length:t-r:-1:r!==null?1:n<e?-1:1}},pV=function(n,e){return n===e?0:n<e?-1:1},Vc=function(n,e){if(e&&n in e)return e[n];throw new Error("Missing required key ("+n+") in object: "+en(e))},x0=function(n){if(typeof n!="object"||n===null)return en(n);const e=[];for(const r in n)e.push(r);e.sort();let t="{";for(let r=0;r<e.length;r++)r!==0&&(t+=","),t+=en(e[r]),t+=":",t+=x0(n[e[r]]);return t+="}",t},fC=function(n,e){const t=n.length;if(t<=e)return[n];const r=[];for(let s=0;s<t;s+=e)s+e>t?r.push(n.substring(s,t)):r.push(n.substring(s,s+e));return r};function mn(n,e){for(const t in n)n.hasOwnProperty(t)&&e(t,n[t])}const pC=function(n){Y(!cm(n),"Invalid JSON number");const e=11,t=52,r=(1<<e-1)-1;let s,i,o,a,l;n===0?(i=0,o=0,s=1/n===-1/0?1:0):(s=n<0,n=Math.abs(n),n>=Math.pow(2,1-r)?(a=Math.min(Math.floor(Math.log(n)/Math.LN2),r),i=a+r,o=Math.round(n*Math.pow(2,t-a)-Math.pow(2,t))):(i=0,o=Math.round(n/Math.pow(2,1-r-t))));const u=[];for(l=t;l;l-=1)u.push(o%2?1:0),o=Math.floor(o/2);for(l=e;l;l-=1)u.push(i%2?1:0),i=Math.floor(i/2);u.push(s?1:0),u.reverse();const h=u.join("");let f="";for(l=0;l<64;l+=8){let p=parseInt(h.substr(l,8),2).toString(16);p.length===1&&(p="0"+p),f=f+p}return f.toLowerCase()},mV=function(){return!!(typeof window=="object"&&window.chrome&&window.chrome.extension&&!/^chrome/.test(window.location.href))},gV=function(){return typeof Windows=="object"&&typeof Windows.UI=="object"};function yV(n,e){let t="Unknown Error";n==="too_big"?t="The data requested exceeds the maximum size that can be accessed with a single request.":n==="permission_denied"?t="Client doesn't have permission to access the desired data.":n==="unavailable"&&(t="The service is unavailable");const r=new Error(n+" at "+e._path.toString()+": "+t);return r.code=n.toUpperCase(),r}const _V=new RegExp("^-?(0*)\\d{1,10}$"),vV=-2147483648,wV=2147483647,$x=function(n){if(_V.test(n)){const e=Number(n);if(e>=vV&&e<=wV)return e}return null},sc=function(n){try{n()}catch(e){setTimeout(()=>{const t=e.stack||"";throw Dn("Exception was thrown by user callback.",t),e},Math.floor(0))}},IV=function(){return(typeof window=="object"&&window.navigator&&window.navigator.userAgent||"").search(/googlebot|google webmaster tools|bingbot|yahoo! slurp|baiduspider|yandexbot|duckduckbot/i)>=0},gu=function(n,e){const t=setTimeout(n,e);return typeof t=="number"&&typeof Deno<"u"&&Deno.unrefTimer?Deno.unrefTimer(t):typeof t=="object"&&t.unref&&t.unref(),t};/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class EV{constructor(e,t){this.appCheckProvider=t,this.appName=e.name,Pt(e)&&e.settings.appCheckToken&&(this.serverAppAppCheckToken=e.settings.appCheckToken),this.appCheck=t==null?void 0:t.getImmediate({optional:!0}),this.appCheck||t==null||t.get().then(r=>this.appCheck=r)}getToken(e){if(this.serverAppAppCheckToken){if(e)throw new Error("Attempted reuse of `FirebaseServerApp.appCheckToken` after previous usage failed.");return Promise.resolve({token:this.serverAppAppCheckToken})}return this.appCheck?this.appCheck.getToken(e):new Promise((t,r)=>{setTimeout(()=>{this.appCheck?this.getToken(e).then(t,r):t(null)},0)})}addTokenChangeListener(e){var t;(t=this.appCheckProvider)==null||t.get().then(r=>r.addTokenListener(e))}notifyForInvalidToken(){Dn(`Provided AppCheck credentials for the app named "${this.appName}" are invalid. This usually indicates your app was not initialized correctly.`)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class xV{constructor(e,t,r){this.appName_=e,this.firebaseOptions_=t,this.authProvider_=r,this.auth_=null,this.auth_=r.getImmediate({optional:!0}),this.auth_||r.onInit(s=>this.auth_=s)}getToken(e){return this.auth_?this.auth_.getToken(e).catch(t=>t&&t.code==="auth/token-not-initialized"?(dn("Got auth/token-not-initialized error.  Treating as null token."),null):Promise.reject(t)):new Promise((t,r)=>{setTimeout(()=>{this.auth_?this.getToken(e).then(t,r):t(null)},0)})}addTokenChangeListener(e){this.auth_?this.auth_.addAuthTokenListener(e):this.authProvider_.get().then(t=>t.addAuthTokenListener(e))}removeTokenChangeListener(e){this.authProvider_.get().then(t=>t.removeAuthTokenListener(e))}notifyForInvalidToken(){let e='Provided authentication credentials for the app named "'+this.appName_+'" are invalid. This usually indicates your app was not initialized correctly. ';"credential"in this.firebaseOptions_?e+='Make sure the "credential" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':"serviceAccount"in this.firebaseOptions_?e+='Make sure the "serviceAccount" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':e+='Make sure the "apiKey" and "databaseURL" properties provided to initializeApp() match the values provided for your app at https://console.firebase.google.com/.',Dn(e)}}class fl{constructor(e){this.accessToken=e}getToken(e){return Promise.resolve({accessToken:this.accessToken})}addTokenChangeListener(e){e(this.accessToken)}removeTokenChangeListener(e){}notifyForInvalidToken(){}}fl.OWNER="owner";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const T0="5",mC="v",gC="s",yC="r",_C="f",vC=/(console\.firebase|firebase-console-\w+\.corp|firebase\.corp)\.google\.com/,wC="ls",IC="p",N_="ac",EC="websocket",xC="long_polling";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class TC{constructor(e,t,r,s,i=!1,o="",a=!1,l=!1,u=null){this.secure=t,this.namespace=r,this.webSocketOnly=s,this.nodeAdmin=i,this.persistenceKey=o,this.includeNamespaceInQueryParams=a,this.isUsingEmulator=l,this.emulatorOptions=u,this._host=e.toLowerCase(),this._domain=this._host.substr(this._host.indexOf(".")+1),this.internalHost=Lo.get("host:"+e)||this._host}isCacheableHost(){return this.internalHost.substr(0,2)==="s-"}isCustomHost(){return this._domain!=="firebaseio.com"&&this._domain!=="firebaseio-demo.com"}get host(){return this._host}set host(e){e!==this.internalHost&&(this.internalHost=e,this.isCacheableHost()&&Lo.set("host:"+this._host,this.internalHost))}toString(){let e=this.toURLString();return this.persistenceKey&&(e+="<"+this.persistenceKey+">"),e}toURLString(){const e=this.secure?"https://":"http://",t=this.includeNamespaceInQueryParams?`?ns=${this.namespace}`:"";return`${e}${this.host}/${t}`}}function TV(n){return n.host!==n.internalHost||n.isCustomHost()||n.includeNamespaceInQueryParams}function SC(n,e,t){Y(typeof e=="string","typeof type must == string"),Y(typeof t=="object","typeof params must == object");let r;if(e===EC)r=(n.secure?"wss://":"ws://")+n.internalHost+"/.ws?";else if(e===xC)r=(n.secure?"https://":"http://")+n.internalHost+"/.lp?";else throw new Error("Unknown connection type: "+e);TV(n)&&(t.ns=n.namespace);const s=[];return mn(t,(i,o)=>{s.push(i+"="+o)}),r+s.join("&")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class SV{constructor(){this.counters_={}}incrementCounter(e,t=1){ns(this.counters_,e)||(this.counters_[e]=0),this.counters_[e]+=t}get(){return kM(this.counters_)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ry={},sy={};function S0(n){const e=n.toString();return ry[e]||(ry[e]=new SV),ry[e]}function bV(n,e){const t=n.toString();return sy[t]||(sy[t]=e()),sy[t]}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class AV{constructor(e){this.onMessage_=e,this.pendingResponses=[],this.currentResponseNum=0,this.closeAfterResponse=-1,this.onClose=null}closeAfter(e,t){this.closeAfterResponse=e,this.onClose=t,this.closeAfterResponse<this.currentResponseNum&&(this.onClose(),this.onClose=null)}handleResponse(e,t){for(this.pendingResponses[e]=t;this.pendingResponses[this.currentResponseNum];){const r=this.pendingResponses[this.currentResponseNum];delete this.pendingResponses[this.currentResponseNum];for(let s=0;s<r.length;++s)r[s]&&sc(()=>{this.onMessage_(r[s])});if(this.currentResponseNum===this.closeAfterResponse){this.onClose&&(this.onClose(),this.onClose=null);break}this.currentResponseNum++}}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const zx="start",CV="close",RV="pLPCommand",NV="pRTLPCB",bC="id",AC="pw",CC="ser",PV="cb",kV="seg",DV="ts",OV="d",MV="dframe",RC=1870,NC=30,LV=RC-NC,VV=25e3,FV=3e4;class bi{constructor(e,t,r,s,i,o,a){this.connId=e,this.repoInfo=t,this.applicationId=r,this.appCheckToken=s,this.authToken=i,this.transportSessionId=o,this.lastSessionId=a,this.bytesSent=0,this.bytesReceived=0,this.everConnected_=!1,this.log_=Od(e),this.stats_=S0(t),this.urlFn=l=>(this.appCheckToken&&(l[N_]=this.appCheckToken),SC(t,xC,l))}open(e,t){this.curSegmentNum=0,this.onDisconnect_=t,this.myPacketOrderer=new AV(e),this.isClosed_=!1,this.connectTimeoutTimer_=setTimeout(()=>{this.log_("Timed out trying to connect."),this.onClosed_(),this.connectTimeoutTimer_=null},Math.floor(FV)),fV(()=>{if(this.isClosed_)return;this.scriptTagHolder=new b0((...i)=>{const[o,a,l,u,h]=i;if(this.incrementIncomingBytes_(i),!!this.scriptTagHolder)if(this.connectTimeoutTimer_&&(clearTimeout(this.connectTimeoutTimer_),this.connectTimeoutTimer_=null),this.everConnected_=!0,o===zx)this.id=a,this.password=l;else if(o===CV)a?(this.scriptTagHolder.sendNewPolls=!1,this.myPacketOrderer.closeAfter(a,()=>{this.onClosed_()})):this.onClosed_();else throw new Error("Unrecognized command received: "+o)},(...i)=>{const[o,a]=i;this.incrementIncomingBytes_(i),this.myPacketOrderer.handleResponse(o,a)},()=>{this.onClosed_()},this.urlFn);const r={};r[zx]="t",r[CC]=Math.floor(Math.random()*1e8),this.scriptTagHolder.uniqueCallbackIdentifier&&(r[PV]=this.scriptTagHolder.uniqueCallbackIdentifier),r[mC]=T0,this.transportSessionId&&(r[gC]=this.transportSessionId),this.lastSessionId&&(r[wC]=this.lastSessionId),this.applicationId&&(r[IC]=this.applicationId),this.appCheckToken&&(r[N_]=this.appCheckToken),typeof location<"u"&&location.hostname&&vC.test(location.hostname)&&(r[yC]=_C);const s=this.urlFn(r);this.log_("Connecting via long-poll to "+s),this.scriptTagHolder.addTag(s,()=>{})})}start(){this.scriptTagHolder.startLongPoll(this.id,this.password),this.addDisconnectPingFrame(this.id,this.password)}static forceAllow(){bi.forceAllow_=!0}static forceDisallow(){bi.forceDisallow_=!0}static isAvailable(){return bi.forceAllow_?!0:!bi.forceDisallow_&&typeof document<"u"&&document.createElement!=null&&!mV()&&!gV()}markConnectionHealthy(){}shutdown_(){this.isClosed_=!0,this.scriptTagHolder&&(this.scriptTagHolder.close(),this.scriptTagHolder=null),this.myDisconnFrame&&(document.body.removeChild(this.myDisconnFrame),this.myDisconnFrame=null),this.connectTimeoutTimer_&&(clearTimeout(this.connectTimeoutTimer_),this.connectTimeoutTimer_=null)}onClosed_(){this.isClosed_||(this.log_("Longpoll is closing itself"),this.shutdown_(),this.onDisconnect_&&(this.onDisconnect_(this.everConnected_),this.onDisconnect_=null))}close(){this.isClosed_||(this.log_("Longpoll is being closed."),this.shutdown_())}send(e){const t=en(e);this.bytesSent+=t.length,this.stats_.incrementCounter("bytes_sent",t.length);const r=jA(t),s=fC(r,LV);for(let i=0;i<s.length;i++)this.scriptTagHolder.enqueueSegment(this.curSegmentNum,s.length,s[i]),this.curSegmentNum++}addDisconnectPingFrame(e,t){this.myDisconnFrame=document.createElement("iframe");const r={};r[MV]="t",r[bC]=e,r[AC]=t,this.myDisconnFrame.src=this.urlFn(r),this.myDisconnFrame.style.display="none",document.body.appendChild(this.myDisconnFrame)}incrementIncomingBytes_(e){const t=en(e).length;this.bytesReceived+=t,this.stats_.incrementCounter("bytes_received",t)}}class b0{constructor(e,t,r,s){this.onDisconnect=r,this.urlFn=s,this.outstandingRequests=new Set,this.pendingSegs=[],this.currentSerial=Math.floor(Math.random()*1e8),this.sendNewPolls=!0;{this.uniqueCallbackIdentifier=uC(),window[RV+this.uniqueCallbackIdentifier]=e,window[NV+this.uniqueCallbackIdentifier]=t,this.myIFrame=b0.createIFrame_();let i="";this.myIFrame.src&&this.myIFrame.src.substr(0,11)==="javascript:"&&(i='<script>document.domain="'+document.domain+'";<\/script>');const o="<html><body>"+i+"</body></html>";try{this.myIFrame.doc.open(),this.myIFrame.doc.write(o),this.myIFrame.doc.close()}catch(a){dn("frame writing exception"),a.stack&&dn(a.stack),dn(a)}}}static createIFrame_(){const e=document.createElement("iframe");if(e.style.display="none",document.body){document.body.appendChild(e);try{e.contentWindow.document||dn("No IE domain setting required")}catch{const r=document.domain;e.src="javascript:void((function(){document.open();document.domain='"+r+"';document.close();})())"}}else throw"Document body has not initialized. Wait to initialize Firebase until after the document is ready.";return e.contentDocument?e.doc=e.contentDocument:e.contentWindow?e.doc=e.contentWindow.document:e.document&&(e.doc=e.document),e}close(){this.alive=!1,this.myIFrame&&(this.myIFrame.doc.body.textContent="",setTimeout(()=>{this.myIFrame!==null&&(document.body.removeChild(this.myIFrame),this.myIFrame=null)},Math.floor(0)));const e=this.onDisconnect;e&&(this.onDisconnect=null,e())}startLongPoll(e,t){for(this.myID=e,this.myPW=t,this.alive=!0;this.newRequest_(););}newRequest_(){if(this.alive&&this.sendNewPolls&&this.outstandingRequests.size<(this.pendingSegs.length>0?2:1)){this.currentSerial++;const e={};e[bC]=this.myID,e[AC]=this.myPW,e[CC]=this.currentSerial;let t=this.urlFn(e),r="",s=0;for(;this.pendingSegs.length>0&&this.pendingSegs[0].d.length+NC+r.length<=RC;){const o=this.pendingSegs.shift();r=r+"&"+kV+s+"="+o.seg+"&"+DV+s+"="+o.ts+"&"+OV+s+"="+o.d,s++}return t=t+r,this.addLongPollTag_(t,this.currentSerial),!0}else return!1}enqueueSegment(e,t,r){this.pendingSegs.push({seg:e,ts:t,d:r}),this.alive&&this.newRequest_()}addLongPollTag_(e,t){this.outstandingRequests.add(t);const r=()=>{this.outstandingRequests.delete(t),this.newRequest_()},s=setTimeout(r,Math.floor(VV)),i=()=>{clearTimeout(s),r()};this.addTag(e,i)}addTag(e,t){setTimeout(()=>{try{if(!this.sendNewPolls)return;const r=this.myIFrame.doc.createElement("script");r.type="text/javascript",r.async=!0,r.src=e,r.onload=r.onreadystatechange=function(){const s=r.readyState;(!s||s==="loaded"||s==="complete")&&(r.onload=r.onreadystatechange=null,r.parentNode&&r.parentNode.removeChild(r),t())},r.onerror=()=>{dn("Long-poll script failed to load: "+e),this.sendNewPolls=!1,this.close()},this.myIFrame.doc.body.appendChild(r)}catch{}},Math.floor(1))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const jV=16384,UV=45e3;let lp=null;typeof MozWebSocket<"u"?lp=MozWebSocket:typeof WebSocket<"u"&&(lp=WebSocket);class Nr{constructor(e,t,r,s,i,o,a){this.connId=e,this.applicationId=r,this.appCheckToken=s,this.authToken=i,this.keepaliveTimer=null,this.frames=null,this.totalFrames=0,this.bytesSent=0,this.bytesReceived=0,this.log_=Od(this.connId),this.stats_=S0(t),this.connURL=Nr.connectionURL_(t,o,a,s,r),this.nodeAdmin=t.nodeAdmin}static connectionURL_(e,t,r,s,i){const o={};return o[mC]=T0,typeof location<"u"&&location.hostname&&vC.test(location.hostname)&&(o[yC]=_C),t&&(o[gC]=t),r&&(o[wC]=r),s&&(o[N_]=s),i&&(o[IC]=i),SC(e,EC,o)}open(e,t){this.onDisconnect=t,this.onMessage=e,this.log_("Websocket connecting to "+this.connURL),this.everConnected_=!1,Lo.set("previous_websocket_failure",!0);try{let r;QA(),this.mySock=new lp(this.connURL,[],r)}catch(r){this.log_("Error instantiating WebSocket.");const s=r.message||r.data;s&&this.log_(s),this.onClosed_();return}this.mySock.onopen=()=>{this.log_("Websocket connected."),this.everConnected_=!0},this.mySock.onclose=()=>{this.log_("Websocket connection was disconnected."),this.mySock=null,this.onClosed_()},this.mySock.onmessage=r=>{this.handleIncomingFrame(r)},this.mySock.onerror=r=>{this.log_("WebSocket error.  Closing connection.");const s=r.message||r.data;s&&this.log_(s),this.onClosed_()}}start(){}static forceDisallow(){Nr.forceDisallow_=!0}static isAvailable(){let e=!1;if(typeof navigator<"u"&&navigator.userAgent){const t=/Android ([0-9]{0,}\.[0-9]{0,})/,r=navigator.userAgent.match(t);r&&r.length>1&&parseFloat(r[1])<4.4&&(e=!0)}return!e&&lp!==null&&!Nr.forceDisallow_}static previouslyFailed(){return Lo.isInMemoryStorage||Lo.get("previous_websocket_failure")===!0}markConnectionHealthy(){Lo.remove("previous_websocket_failure")}appendFrame_(e){if(this.frames.push(e),this.frames.length===this.totalFrames){const t=this.frames.join("");this.frames=null;const r=Yu(t);this.onMessage(r)}}handleNewFrameCount_(e){this.totalFrames=e,this.frames=[]}extractFrameCount_(e){if(Y(this.frames===null,"We already have a frame buffer"),e.length<=6){const t=Number(e);if(!isNaN(t))return this.handleNewFrameCount_(t),null}return this.handleNewFrameCount_(1),e}handleIncomingFrame(e){if(this.mySock===null)return;const t=e.data;if(this.bytesReceived+=t.length,this.stats_.incrementCounter("bytes_received",t.length),this.resetKeepAlive(),this.frames!==null)this.appendFrame_(t);else{const r=this.extractFrameCount_(t);r!==null&&this.appendFrame_(r)}}send(e){this.resetKeepAlive();const t=en(e);this.bytesSent+=t.length,this.stats_.incrementCounter("bytes_sent",t.length);const r=fC(t,jV);r.length>1&&this.sendString_(String(r.length));for(let s=0;s<r.length;s++)this.sendString_(r[s])}shutdown_(){this.isClosed_=!0,this.keepaliveTimer&&(clearInterval(this.keepaliveTimer),this.keepaliveTimer=null),this.mySock&&(this.mySock.close(),this.mySock=null)}onClosed_(){this.isClosed_||(this.log_("WebSocket is closing itself"),this.shutdown_(),this.onDisconnect&&(this.onDisconnect(this.everConnected_),this.onDisconnect=null))}close(){this.isClosed_||(this.log_("WebSocket is being closed"),this.shutdown_())}resetKeepAlive(){clearInterval(this.keepaliveTimer),this.keepaliveTimer=setInterval(()=>{this.mySock&&this.sendString_("0"),this.resetKeepAlive()},Math.floor(UV))}sendString_(e){try{this.mySock.send(e)}catch(t){this.log_("Exception thrown from WebSocket.send():",t.message||t.data,"Closing connection."),setTimeout(this.onClosed_.bind(this),0)}}}Nr.responsesRequiredToBeHealthy=2;Nr.healthyTimeout=3e4;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Cl{static get ALL_TRANSPORTS(){return[bi,Nr]}static get IS_TRANSPORT_INITIALIZED(){return this.globalTransportInitialized_}constructor(e){this.initTransports_(e)}initTransports_(e){const t=Nr&&Nr.isAvailable();let r=t&&!Nr.previouslyFailed();if(e.webSocketOnly&&(t||Dn("wss:// URL used, but browser isn't known to support websockets.  Trying anyway."),r=!0),r)this.transports_=[Nr];else{const s=this.transports_=[];for(const i of Cl.ALL_TRANSPORTS)i&&i.isAvailable()&&s.push(i);Cl.globalTransportInitialized_=!0}}initialTransport(){if(this.transports_.length>0)return this.transports_[0];throw new Error("No transports available")}upgradeTransport(){return this.transports_.length>1?this.transports_[1]:null}}Cl.globalTransportInitialized_=!1;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const BV=6e4,$V=5e3,zV=10*1024,qV=100*1024,iy="t",qx="d",WV="s",Wx="r",GV="e",Gx="o",Hx="a",Kx="n",Qx="p",HV="h";class KV{constructor(e,t,r,s,i,o,a,l,u,h){this.id=e,this.repoInfo_=t,this.applicationId_=r,this.appCheckToken_=s,this.authToken_=i,this.onMessage_=o,this.onReady_=a,this.onDisconnect_=l,this.onKill_=u,this.lastSessionId=h,this.connectionCount=0,this.pendingDataMessages=[],this.state_=0,this.log_=Od("c:"+this.id+":"),this.transportManager_=new Cl(t),this.log_("Connection created"),this.start_()}start_(){const e=this.transportManager_.initialTransport();this.conn_=new e(this.nextTransportId_(),this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,null,this.lastSessionId),this.primaryResponsesRequired_=e.responsesRequiredToBeHealthy||0;const t=this.connReceiver_(this.conn_),r=this.disconnReceiver_(this.conn_);this.tx_=this.conn_,this.rx_=this.conn_,this.secondaryConn_=null,this.isHealthy_=!1,setTimeout(()=>{this.conn_&&this.conn_.open(t,r)},Math.floor(0));const s=e.healthyTimeout||0;s>0&&(this.healthyTimeout_=gu(()=>{this.healthyTimeout_=null,this.isHealthy_||(this.conn_&&this.conn_.bytesReceived>qV?(this.log_("Connection exceeded healthy timeout but has received "+this.conn_.bytesReceived+" bytes.  Marking connection healthy."),this.isHealthy_=!0,this.conn_.markConnectionHealthy()):this.conn_&&this.conn_.bytesSent>zV?this.log_("Connection exceeded healthy timeout but has sent "+this.conn_.bytesSent+" bytes.  Leaving connection alive."):(this.log_("Closing unhealthy connection after timeout."),this.close()))},Math.floor(s)))}nextTransportId_(){return"c:"+this.id+":"+this.connectionCount++}disconnReceiver_(e){return t=>{e===this.conn_?this.onConnectionLost_(t):e===this.secondaryConn_?(this.log_("Secondary connection lost."),this.onSecondaryConnectionLost_()):this.log_("closing an old connection")}}connReceiver_(e){return t=>{this.state_!==2&&(e===this.rx_?this.onPrimaryMessageReceived_(t):e===this.secondaryConn_?this.onSecondaryMessageReceived_(t):this.log_("message on old connection"))}}sendRequest(e){const t={t:"d",d:e};this.sendData_(t)}tryCleanupConnection(){this.tx_===this.secondaryConn_&&this.rx_===this.secondaryConn_&&(this.log_("cleaning up and promoting a connection: "+this.secondaryConn_.connId),this.conn_=this.secondaryConn_,this.secondaryConn_=null)}onSecondaryControl_(e){if(iy in e){const t=e[iy];t===Hx?this.upgradeIfSecondaryHealthy_():t===Wx?(this.log_("Got a reset on secondary, closing it"),this.secondaryConn_.close(),(this.tx_===this.secondaryConn_||this.rx_===this.secondaryConn_)&&this.close()):t===Gx&&(this.log_("got pong on secondary."),this.secondaryResponsesRequired_--,this.upgradeIfSecondaryHealthy_())}}onSecondaryMessageReceived_(e){const t=Vc("t",e),r=Vc("d",e);if(t==="c")this.onSecondaryControl_(r);else if(t==="d")this.pendingDataMessages.push(r);else throw new Error("Unknown protocol layer: "+t)}upgradeIfSecondaryHealthy_(){this.secondaryResponsesRequired_<=0?(this.log_("Secondary connection is healthy."),this.isHealthy_=!0,this.secondaryConn_.markConnectionHealthy(),this.proceedWithUpgrade_()):(this.log_("sending ping on secondary."),this.secondaryConn_.send({t:"c",d:{t:Qx,d:{}}}))}proceedWithUpgrade_(){this.secondaryConn_.start(),this.log_("sending client ack on secondary"),this.secondaryConn_.send({t:"c",d:{t:Hx,d:{}}}),this.log_("Ending transmission on primary"),this.conn_.send({t:"c",d:{t:Kx,d:{}}}),this.tx_=this.secondaryConn_,this.tryCleanupConnection()}onPrimaryMessageReceived_(e){const t=Vc("t",e),r=Vc("d",e);t==="c"?this.onControl_(r):t==="d"&&this.onDataMessage_(r)}onDataMessage_(e){this.onPrimaryResponse_(),this.onMessage_(e)}onPrimaryResponse_(){this.isHealthy_||(this.primaryResponsesRequired_--,this.primaryResponsesRequired_<=0&&(this.log_("Primary connection is healthy."),this.isHealthy_=!0,this.conn_.markConnectionHealthy()))}onControl_(e){const t=Vc(iy,e);if(qx in e){const r=e[qx];if(t===HV){const s={...r};this.repoInfo_.isUsingEmulator&&(s.h=this.repoInfo_.host),this.onHandshake_(s)}else if(t===Kx){this.log_("recvd end transmission on primary"),this.rx_=this.secondaryConn_;for(let s=0;s<this.pendingDataMessages.length;++s)this.onDataMessage_(this.pendingDataMessages[s]);this.pendingDataMessages=[],this.tryCleanupConnection()}else t===WV?this.onConnectionShutdown_(r):t===Wx?this.onReset_(r):t===GV?R_("Server Error: "+r):t===Gx?(this.log_("got pong on primary."),this.onPrimaryResponse_(),this.sendPingOnPrimaryIfNecessary_()):R_("Unknown control packet command: "+t)}}onHandshake_(e){const t=e.ts,r=e.v,s=e.h;this.sessionId=e.s,this.repoInfo_.host=s,this.state_===0&&(this.conn_.start(),this.onConnectionEstablished_(this.conn_,t),T0!==r&&Dn("Protocol version mismatch detected"),this.tryStartUpgrade_())}tryStartUpgrade_(){const e=this.transportManager_.upgradeTransport();e&&this.startUpgrade_(e)}startUpgrade_(e){this.secondaryConn_=new e(this.nextTransportId_(),this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,this.sessionId),this.secondaryResponsesRequired_=e.responsesRequiredToBeHealthy||0;const t=this.connReceiver_(this.secondaryConn_),r=this.disconnReceiver_(this.secondaryConn_);this.secondaryConn_.open(t,r),gu(()=>{this.secondaryConn_&&(this.log_("Timed out trying to upgrade."),this.secondaryConn_.close())},Math.floor(BV))}onReset_(e){this.log_("Reset packet received.  New host: "+e),this.repoInfo_.host=e,this.state_===1?this.close():(this.closeConnections_(),this.start_())}onConnectionEstablished_(e,t){this.log_("Realtime connection established."),this.conn_=e,this.state_=1,this.onReady_&&(this.onReady_(t,this.sessionId),this.onReady_=null),this.primaryResponsesRequired_===0?(this.log_("Primary connection is healthy."),this.isHealthy_=!0):gu(()=>{this.sendPingOnPrimaryIfNecessary_()},Math.floor($V))}sendPingOnPrimaryIfNecessary_(){!this.isHealthy_&&this.state_===1&&(this.log_("sending ping on primary."),this.sendData_({t:"c",d:{t:Qx,d:{}}}))}onSecondaryConnectionLost_(){const e=this.secondaryConn_;this.secondaryConn_=null,(this.tx_===e||this.rx_===e)&&this.close()}onConnectionLost_(e){this.conn_=null,!e&&this.state_===0?(this.log_("Realtime connection failed."),this.repoInfo_.isCacheableHost()&&(Lo.remove("host:"+this.repoInfo_.host),this.repoInfo_.internalHost=this.repoInfo_.host)):this.state_===1&&this.log_("Realtime connection lost."),this.close()}onConnectionShutdown_(e){this.log_("Connection shutdown command received. Shutting down..."),this.onKill_&&(this.onKill_(e),this.onKill_=null),this.onDisconnect_=null,this.close()}sendData_(e){if(this.state_!==1)throw"Connection is not connected";this.tx_.send(e)}close(){this.state_!==2&&(this.log_("Closing realtime connection."),this.state_=2,this.closeConnections_(),this.onDisconnect_&&(this.onDisconnect_(),this.onDisconnect_=null))}closeConnections_(){this.log_("Shutting down all connections"),this.conn_&&(this.conn_.close(),this.conn_=null),this.secondaryConn_&&(this.secondaryConn_.close(),this.secondaryConn_=null),this.healthyTimeout_&&(clearTimeout(this.healthyTimeout_),this.healthyTimeout_=null)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class PC{put(e,t,r,s){}merge(e,t,r,s){}refreshAuthToken(e){}refreshAppCheckToken(e){}onDisconnectPut(e,t,r){}onDisconnectMerge(e,t,r){}onDisconnectCancel(e,t){}reportStats(e){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class kC{constructor(e){this.allowedEvents_=e,this.listeners_={},Y(Array.isArray(e)&&e.length>0,"Requires a non-empty array")}trigger(e,...t){if(Array.isArray(this.listeners_[e])){const r=[...this.listeners_[e]];for(let s=0;s<r.length;s++)r[s].callback.apply(r[s].context,t)}}on(e,t,r){this.validateEventType_(e),this.listeners_[e]=this.listeners_[e]||[],this.listeners_[e].push({callback:t,context:r});const s=this.getInitialEvent(e);s&&t.apply(r,s)}off(e,t,r){this.validateEventType_(e);const s=this.listeners_[e]||[];for(let i=0;i<s.length;i++)if(s[i].callback===t&&(!r||r===s[i].context)){s.splice(i,1);return}}validateEventType_(e){Y(this.allowedEvents_.find(t=>t===e),"Unknown event: "+e)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class cp extends kC{static getInstance(){return new cp}constructor(){super(["online"]),this.online_=!0,typeof window<"u"&&typeof window.addEventListener<"u"&&!v0()&&(window.addEventListener("online",()=>{this.online_||(this.online_=!0,this.trigger("online",!0))},!1),window.addEventListener("offline",()=>{this.online_&&(this.online_=!1,this.trigger("online",!1))},!1))}getInitialEvent(e){return Y(e==="online","Unknown event type: "+e),[this.online_]}currentlyOnline(){return this.online_}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Yx=32,Jx=768;class nt{constructor(e,t){if(t===void 0){this.pieces_=e.split("/");let r=0;for(let s=0;s<this.pieces_.length;s++)this.pieces_[s].length>0&&(this.pieces_[r]=this.pieces_[s],r++);this.pieces_.length=r,this.pieceNum_=0}else this.pieces_=e,this.pieceNum_=t}toString(){let e="";for(let t=this.pieceNum_;t<this.pieces_.length;t++)this.pieces_[t]!==""&&(e+="/"+this.pieces_[t]);return e||"/"}}function Ze(){return new nt("")}function ke(n){return n.pieceNum_>=n.pieces_.length?null:n.pieces_[n.pieceNum_]}function Yi(n){return n.pieces_.length-n.pieceNum_}function mt(n){let e=n.pieceNum_;return e<n.pieces_.length&&e++,new nt(n.pieces_,e)}function A0(n){return n.pieceNum_<n.pieces_.length?n.pieces_[n.pieces_.length-1]:null}function QV(n){let e="";for(let t=n.pieceNum_;t<n.pieces_.length;t++)n.pieces_[t]!==""&&(e+="/"+encodeURIComponent(String(n.pieces_[t])));return e||"/"}function Zu(n,e=0){return n.pieces_.slice(n.pieceNum_+e)}function DC(n){if(n.pieceNum_>=n.pieces_.length)return null;const e=[];for(let t=n.pieceNum_;t<n.pieces_.length-1;t++)e.push(n.pieces_[t]);return new nt(e,0)}function kt(n,e){const t=[];for(let r=n.pieceNum_;r<n.pieces_.length;r++)t.push(n.pieces_[r]);if(e instanceof nt)for(let r=e.pieceNum_;r<e.pieces_.length;r++)t.push(e.pieces_[r]);else{const r=e.split("/");for(let s=0;s<r.length;s++)r[s].length>0&&t.push(r[s])}return new nt(t,0)}function De(n){return n.pieceNum_>=n.pieces_.length}function Un(n,e){const t=ke(n),r=ke(e);if(t===null)return e;if(t===r)return Un(mt(n),mt(e));throw new Error("INTERNAL ERROR: innerPath ("+e+") is not within outerPath ("+n+")")}function YV(n,e){const t=Zu(n,0),r=Zu(e,0);for(let s=0;s<t.length&&s<r.length;s++){const i=wa(t[s],r[s]);if(i!==0)return i}return t.length===r.length?0:t.length<r.length?-1:1}function C0(n,e){if(Yi(n)!==Yi(e))return!1;for(let t=n.pieceNum_,r=e.pieceNum_;t<=n.pieces_.length;t++,r++)if(n.pieces_[t]!==e.pieces_[r])return!1;return!0}function kr(n,e){let t=n.pieceNum_,r=e.pieceNum_;if(Yi(n)>Yi(e))return!1;for(;t<n.pieces_.length;){if(n.pieces_[t]!==e.pieces_[r])return!1;++t,++r}return!0}class JV{constructor(e,t){this.errorPrefix_=t,this.parts_=Zu(e,0),this.byteLength_=Math.max(1,this.parts_.length);for(let r=0;r<this.parts_.length;r++)this.byteLength_+=lm(this.parts_[r]);OC(this)}}function XV(n,e){n.parts_.length>0&&(n.byteLength_+=1),n.parts_.push(e),n.byteLength_+=lm(e),OC(n)}function ZV(n){const e=n.parts_.pop();n.byteLength_-=lm(e),n.parts_.length>0&&(n.byteLength_-=1)}function OC(n){if(n.byteLength_>Jx)throw new Error(n.errorPrefix_+"has a key path longer than "+Jx+" bytes ("+n.byteLength_+").");if(n.parts_.length>Yx)throw new Error(n.errorPrefix_+"path specified exceeds the maximum depth that can be written ("+Yx+") or object contains a cycle "+bo(n))}function bo(n){return n.parts_.length===0?"":"in property '"+n.parts_.join(".")+"'"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class R0 extends kC{static getInstance(){return new R0}constructor(){super(["visible"]);let e,t;typeof document<"u"&&typeof document.addEventListener<"u"&&(typeof document.hidden<"u"?(t="visibilitychange",e="hidden"):typeof document.mozHidden<"u"?(t="mozvisibilitychange",e="mozHidden"):typeof document.msHidden<"u"?(t="msvisibilitychange",e="msHidden"):typeof document.webkitHidden<"u"&&(t="webkitvisibilitychange",e="webkitHidden")),this.visible_=!0,t&&document.addEventListener(t,()=>{const r=!document[e];r!==this.visible_&&(this.visible_=r,this.trigger("visible",r))},!1)}getInitialEvent(e){return Y(e==="visible","Unknown event type: "+e),[this.visible_]}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Fc=1e3,eF=60*5*1e3,Xx=30*1e3,tF=1.3,nF=3e4,rF="server_kill",Zx=3;class Or extends PC{constructor(e,t,r,s,i,o,a,l){if(super(),this.repoInfo_=e,this.applicationId_=t,this.onDataUpdate_=r,this.onConnectStatus_=s,this.onServerInfoUpdate_=i,this.authTokenProvider_=o,this.appCheckTokenProvider_=a,this.authOverride_=l,this.id=Or.nextPersistentConnectionId_++,this.log_=Od("p:"+this.id+":"),this.interruptReasons_={},this.listens=new Map,this.outstandingPuts_=[],this.outstandingGets_=[],this.outstandingPutCount_=0,this.outstandingGetCount_=0,this.onDisconnectRequestQueue_=[],this.connected_=!1,this.reconnectDelay_=Fc,this.maxReconnectDelay_=eF,this.securityDebugCallback_=null,this.lastSessionId=null,this.establishConnectionTimer_=null,this.visible_=!1,this.requestCBHash_={},this.requestNumber_=0,this.realtime_=null,this.authToken_=null,this.appCheckToken_=null,this.forceTokenRefresh_=!1,this.invalidAuthTokenCount_=0,this.invalidAppCheckTokenCount_=0,this.firstConnection_=!0,this.lastConnectionAttemptTime_=null,this.lastConnectionEstablishedTime_=null,l&&!QA())throw new Error("Auth override specified in options, but not supported on non Node.js platforms");R0.getInstance().on("visible",this.onVisible_,this),e.host.indexOf("fblocal")===-1&&cp.getInstance().on("online",this.onOnline_,this)}sendRequest(e,t,r){const s=++this.requestNumber_,i={r:s,a:e,b:t};this.log_(en(i)),Y(this.connected_,"sendRequest call when we're not connected not allowed."),this.realtime_.sendRequest(i),r&&(this.requestCBHash_[s]=r)}get(e){this.initConnection_();const t=new fr,s={action:"g",request:{p:e._path.toString(),q:e._queryObject},onComplete:o=>{const a=o.d;o.s==="ok"?t.resolve(a):t.reject(a)}};this.outstandingGets_.push(s),this.outstandingGetCount_++;const i=this.outstandingGets_.length-1;return this.connected_&&this.sendGet_(i),t.promise}listen(e,t,r,s){this.initConnection_();const i=e._queryIdentifier,o=e._path.toString();this.log_("Listen called for "+o+" "+i),this.listens.has(o)||this.listens.set(o,new Map),Y(e._queryParams.isDefault()||!e._queryParams.loadsAllData(),"listen() called for non-default but complete query"),Y(!this.listens.get(o).has(i),"listen() called twice for same path/queryId.");const a={onComplete:s,hashFn:t,query:e,tag:r};this.listens.get(o).set(i,a),this.connected_&&this.sendListen_(a)}sendGet_(e){const t=this.outstandingGets_[e];this.sendRequest("g",t.request,r=>{delete this.outstandingGets_[e],this.outstandingGetCount_--,this.outstandingGetCount_===0&&(this.outstandingGets_=[]),t.onComplete&&t.onComplete(r)})}sendListen_(e){const t=e.query,r=t._path.toString(),s=t._queryIdentifier;this.log_("Listen on "+r+" for "+s);const i={p:r},o="q";e.tag&&(i.q=t._queryObject,i.t=e.tag),i.h=e.hashFn(),this.sendRequest(o,i,a=>{const l=a.d,u=a.s;Or.warnOnListenWarnings_(l,t),(this.listens.get(r)&&this.listens.get(r).get(s))===e&&(this.log_("listen response",a),u!=="ok"&&this.removeListen_(r,s),e.onComplete&&e.onComplete(u,l))})}static warnOnListenWarnings_(e,t){if(e&&typeof e=="object"&&ns(e,"w")){const r=Xo(e,"w");if(Array.isArray(r)&&~r.indexOf("no_index")){const s='".indexOn": "'+t._queryParams.getIndex().toString()+'"',i=t._path.toString();Dn(`Using an unspecified index. Your data will be downloaded and filtered on the client. Consider adding ${s} at ${i} to your security rules for better performance.`)}}}refreshAuthToken(e){this.authToken_=e,this.log_("Auth token refreshed"),this.authToken_?this.tryAuth():this.connected_&&this.sendRequest("unauth",{},()=>{}),this.reduceReconnectDelayIfAdminCredential_(e)}reduceReconnectDelayIfAdminCredential_(e){(e&&e.length===40||WM(e))&&(this.log_("Admin auth credential detected.  Reducing max reconnect time."),this.maxReconnectDelay_=Xx)}refreshAppCheckToken(e){this.appCheckToken_=e,this.log_("App check token refreshed"),this.appCheckToken_?this.tryAppCheck():this.connected_&&this.sendRequest("unappeck",{},()=>{})}tryAuth(){if(this.connected_&&this.authToken_){const e=this.authToken_,t=qM(e)?"auth":"gauth",r={cred:e};this.authOverride_===null?r.noauth=!0:typeof this.authOverride_=="object"&&(r.authvar=this.authOverride_),this.sendRequest(t,r,s=>{const i=s.s,o=s.d||"error";this.authToken_===e&&(i==="ok"?this.invalidAuthTokenCount_=0:this.onAuthRevoked_(i,o))})}}tryAppCheck(){this.connected_&&this.appCheckToken_&&this.sendRequest("appcheck",{token:this.appCheckToken_},e=>{const t=e.s,r=e.d||"error";t==="ok"?this.invalidAppCheckTokenCount_=0:this.onAppCheckRevoked_(t,r)})}unlisten(e,t){const r=e._path.toString(),s=e._queryIdentifier;this.log_("Unlisten called for "+r+" "+s),Y(e._queryParams.isDefault()||!e._queryParams.loadsAllData(),"unlisten() called for non-default but complete query"),this.removeListen_(r,s)&&this.connected_&&this.sendUnlisten_(r,s,e._queryObject,t)}sendUnlisten_(e,t,r,s){this.log_("Unlisten on "+e+" for "+t);const i={p:e},o="n";s&&(i.q=r,i.t=s),this.sendRequest(o,i)}onDisconnectPut(e,t,r){this.initConnection_(),this.connected_?this.sendOnDisconnect_("o",e,t,r):this.onDisconnectRequestQueue_.push({pathString:e,action:"o",data:t,onComplete:r})}onDisconnectMerge(e,t,r){this.initConnection_(),this.connected_?this.sendOnDisconnect_("om",e,t,r):this.onDisconnectRequestQueue_.push({pathString:e,action:"om",data:t,onComplete:r})}onDisconnectCancel(e,t){this.initConnection_(),this.connected_?this.sendOnDisconnect_("oc",e,null,t):this.onDisconnectRequestQueue_.push({pathString:e,action:"oc",data:null,onComplete:t})}sendOnDisconnect_(e,t,r,s){const i={p:t,d:r};this.log_("onDisconnect "+e,i),this.sendRequest(e,i,o=>{s&&setTimeout(()=>{s(o.s,o.d)},Math.floor(0))})}put(e,t,r,s){this.putInternal("p",e,t,r,s)}merge(e,t,r,s){this.putInternal("m",e,t,r,s)}putInternal(e,t,r,s,i){this.initConnection_();const o={p:t,d:r};i!==void 0&&(o.h=i),this.outstandingPuts_.push({action:e,request:o,onComplete:s}),this.outstandingPutCount_++;const a=this.outstandingPuts_.length-1;this.connected_?this.sendPut_(a):this.log_("Buffering put: "+t)}sendPut_(e){const t=this.outstandingPuts_[e].action,r=this.outstandingPuts_[e].request,s=this.outstandingPuts_[e].onComplete;this.outstandingPuts_[e].queued=this.connected_,this.sendRequest(t,r,i=>{this.log_(t+" response",i),delete this.outstandingPuts_[e],this.outstandingPutCount_--,this.outstandingPutCount_===0&&(this.outstandingPuts_=[]),s&&s(i.s,i.d)})}reportStats(e){if(this.connected_){const t={c:e};this.log_("reportStats",t),this.sendRequest("s",t,r=>{if(r.s!=="ok"){const i=r.d;this.log_("reportStats","Error sending stats: "+i)}})}}onDataMessage_(e){if("r"in e){this.log_("from server: "+en(e));const t=e.r,r=this.requestCBHash_[t];r&&(delete this.requestCBHash_[t],r(e.b))}else{if("error"in e)throw"A server-side error has occurred: "+e.error;"a"in e&&this.onDataPush_(e.a,e.b)}}onDataPush_(e,t){this.log_("handleServerMessage",e,t),e==="d"?this.onDataUpdate_(t.p,t.d,!1,t.t):e==="m"?this.onDataUpdate_(t.p,t.d,!0,t.t):e==="c"?this.onListenRevoked_(t.p,t.q):e==="ac"?this.onAuthRevoked_(t.s,t.d):e==="apc"?this.onAppCheckRevoked_(t.s,t.d):e==="sd"?this.onSecurityDebugPacket_(t):R_("Unrecognized action received from server: "+en(e)+`
Are you using the latest client?`)}onReady_(e,t){this.log_("connection ready"),this.connected_=!0,this.lastConnectionEstablishedTime_=new Date().getTime(),this.handleTimestamp_(e),this.lastSessionId=t,this.firstConnection_&&this.sendConnectStats_(),this.restoreState_(),this.firstConnection_=!1,this.onConnectStatus_(!0)}scheduleConnect_(e){Y(!this.realtime_,"Scheduling a connect when we're already connected/ing?"),this.establishConnectionTimer_&&clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=setTimeout(()=>{this.establishConnectionTimer_=null,this.establishConnection_()},Math.floor(e))}initConnection_(){!this.realtime_&&this.firstConnection_&&this.scheduleConnect_(0)}onVisible_(e){e&&!this.visible_&&this.reconnectDelay_===this.maxReconnectDelay_&&(this.log_("Window became visible.  Reducing delay."),this.reconnectDelay_=Fc,this.realtime_||this.scheduleConnect_(0)),this.visible_=e}onOnline_(e){e?(this.log_("Browser went online."),this.reconnectDelay_=Fc,this.realtime_||this.scheduleConnect_(0)):(this.log_("Browser went offline.  Killing connection."),this.realtime_&&this.realtime_.close())}onRealtimeDisconnect_(){if(this.log_("data client disconnected"),this.connected_=!1,this.realtime_=null,this.cancelSentTransactions_(),this.requestCBHash_={},this.shouldReconnect_()){this.visible_?this.lastConnectionEstablishedTime_&&(new Date().getTime()-this.lastConnectionEstablishedTime_>nF&&(this.reconnectDelay_=Fc),this.lastConnectionEstablishedTime_=null):(this.log_("Window isn't visible.  Delaying reconnect."),this.reconnectDelay_=this.maxReconnectDelay_,this.lastConnectionAttemptTime_=new Date().getTime());const e=Math.max(0,new Date().getTime()-this.lastConnectionAttemptTime_);let t=Math.max(0,this.reconnectDelay_-e);t=Math.random()*t,this.log_("Trying to reconnect in "+t+"ms"),this.scheduleConnect_(t),this.reconnectDelay_=Math.min(this.maxReconnectDelay_,this.reconnectDelay_*tF)}this.onConnectStatus_(!1)}async establishConnection_(){if(this.shouldReconnect_()){this.log_("Making a connection attempt"),this.lastConnectionAttemptTime_=new Date().getTime(),this.lastConnectionEstablishedTime_=null;const e=this.onDataMessage_.bind(this),t=this.onReady_.bind(this),r=this.onRealtimeDisconnect_.bind(this),s=this.id+":"+Or.nextConnectionId_++,i=this.lastSessionId;let o=!1,a=null;const l=function(){a?a.close():(o=!0,r())},u=function(f){Y(a,"sendRequest call when we're not connected not allowed."),a.sendRequest(f)};this.realtime_={close:l,sendRequest:u};const h=this.forceTokenRefresh_;this.forceTokenRefresh_=!1;try{const[f,p]=await Promise.all([this.authTokenProvider_.getToken(h),this.appCheckTokenProvider_.getToken(h)]);o?dn("getToken() completed but was canceled"):(dn("getToken() completed. Creating connection."),this.authToken_=f&&f.accessToken,this.appCheckToken_=p&&p.token,a=new KV(s,this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,e,t,r,y=>{Dn(y+" ("+this.repoInfo_.toString()+")"),this.interrupt(rF)},i))}catch(f){this.log_("Failed to get token: "+f),o||(this.repoInfo_.nodeAdmin&&Dn(f),l())}}}interrupt(e){dn("Interrupting connection for reason: "+e),this.interruptReasons_[e]=!0,this.realtime_?this.realtime_.close():(this.establishConnectionTimer_&&(clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=null),this.connected_&&this.onRealtimeDisconnect_())}resume(e){dn("Resuming connection for reason: "+e),delete this.interruptReasons_[e],ip(this.interruptReasons_)&&(this.reconnectDelay_=Fc,this.realtime_||this.scheduleConnect_(0))}handleTimestamp_(e){const t=e-new Date().getTime();this.onServerInfoUpdate_({serverTimeOffset:t})}cancelSentTransactions_(){for(let e=0;e<this.outstandingPuts_.length;e++){const t=this.outstandingPuts_[e];t&&"h"in t.request&&t.queued&&(t.onComplete&&t.onComplete("disconnect"),delete this.outstandingPuts_[e],this.outstandingPutCount_--)}this.outstandingPutCount_===0&&(this.outstandingPuts_=[])}onListenRevoked_(e,t){let r;t?r=t.map(i=>x0(i)).join("$"):r="default";const s=this.removeListen_(e,r);s&&s.onComplete&&s.onComplete("permission_denied")}removeListen_(e,t){const r=new nt(e).toString();let s;if(this.listens.has(r)){const i=this.listens.get(r);s=i.get(t),i.delete(t),i.size===0&&this.listens.delete(r)}else s=void 0;return s}onAuthRevoked_(e,t){dn("Auth token revoked: "+e+"/"+t),this.authToken_=null,this.forceTokenRefresh_=!0,this.realtime_.close(),(e==="invalid_token"||e==="permission_denied")&&(this.invalidAuthTokenCount_++,this.invalidAuthTokenCount_>=Zx&&(this.reconnectDelay_=Xx,this.authTokenProvider_.notifyForInvalidToken()))}onAppCheckRevoked_(e,t){dn("App check token revoked: "+e+"/"+t),this.appCheckToken_=null,this.forceTokenRefresh_=!0,(e==="invalid_token"||e==="permission_denied")&&(this.invalidAppCheckTokenCount_++,this.invalidAppCheckTokenCount_>=Zx&&this.appCheckTokenProvider_.notifyForInvalidToken())}onSecurityDebugPacket_(e){this.securityDebugCallback_?this.securityDebugCallback_(e):"msg"in e&&console.log("FIREBASE: "+e.msg.replace(`
`,`
FIREBASE: `))}restoreState_(){this.tryAuth(),this.tryAppCheck();for(const e of this.listens.values())for(const t of e.values())this.sendListen_(t);for(let e=0;e<this.outstandingPuts_.length;e++)this.outstandingPuts_[e]&&this.sendPut_(e);for(;this.onDisconnectRequestQueue_.length;){const e=this.onDisconnectRequestQueue_.shift();this.sendOnDisconnect_(e.action,e.pathString,e.data,e.onComplete)}for(let e=0;e<this.outstandingGets_.length;e++)this.outstandingGets_[e]&&this.sendGet_(e)}sendConnectStats_(){const e={};let t="js";e["sdk."+t+"."+aC.replace(/\./g,"-")]=1,v0()?e["framework.cordova"]=1:KA()&&(e["framework.reactnative"]=1),this.reportStats(e)}shouldReconnect_(){const e=cp.getInstance().currentlyOnline();return ip(this.interruptReasons_)&&e}}Or.nextPersistentConnectionId_=0;Or.nextConnectionId_=0;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Le{constructor(e,t){this.name=e,this.node=t}static Wrap(e,t){return new Le(e,t)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class um{getCompare(){return this.compare.bind(this)}indexedValueChanged(e,t){const r=new Le(Qi,e),s=new Le(Qi,t);return this.compare(r,s)!==0}minPost(){return Le.MIN}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Bh;class MC extends um{static get __EMPTY_NODE(){return Bh}static set __EMPTY_NODE(e){Bh=e}compare(e,t){return wa(e.name,t.name)}isDefinedOn(e){throw rc("KeyIndex.isDefinedOn not expected to be called.")}indexedValueChanged(e,t){return!1}minPost(){return Le.MIN}maxPost(){return new Le(Ks,Bh)}makePost(e,t){return Y(typeof e=="string","KeyIndex indexValue must always be a string."),new Le(e,Bh)}toString(){return".key"}}const _s=new MC;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let $h=class{constructor(e,t,r,s,i=null){this.isReverse_=s,this.resultGenerator_=i,this.nodeStack_=[];let o=1;for(;!e.isEmpty();)if(e=e,o=t?r(e.key,t):1,s&&(o*=-1),o<0)this.isReverse_?e=e.left:e=e.right;else if(o===0){this.nodeStack_.push(e);break}else this.nodeStack_.push(e),this.isReverse_?e=e.right:e=e.left}getNext(){if(this.nodeStack_.length===0)return null;let e=this.nodeStack_.pop(),t;if(this.resultGenerator_?t=this.resultGenerator_(e.key,e.value):t={key:e.key,value:e.value},this.isReverse_)for(e=e.left;!e.isEmpty();)this.nodeStack_.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack_.push(e),e=e.left;return t}hasNext(){return this.nodeStack_.length>0}peek(){if(this.nodeStack_.length===0)return null;const e=this.nodeStack_[this.nodeStack_.length-1];return this.resultGenerator_?this.resultGenerator_(e.key,e.value):{key:e.key,value:e.value}}},dr=class Zc{constructor(e,t,r,s,i){this.key=e,this.value=t,this.color=r??Zc.RED,this.left=s??ds.EMPTY_NODE,this.right=i??ds.EMPTY_NODE}copy(e,t,r,s,i){return new Zc(e??this.key,t??this.value,r??this.color,s??this.left,i??this.right)}count(){return this.left.count()+1+this.right.count()}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||!!e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min_(){return this.left.isEmpty()?this:this.left.min_()}minKey(){return this.min_().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,r){let s=this;const i=r(e,s.key);return i<0?s=s.copy(null,null,null,s.left.insert(e,t,r),null):i===0?s=s.copy(null,t,null,null,null):s=s.copy(null,null,null,null,s.right.insert(e,t,r)),s.fixUp_()}removeMin_(){if(this.left.isEmpty())return ds.EMPTY_NODE;let e=this;return!e.left.isRed_()&&!e.left.left.isRed_()&&(e=e.moveRedLeft_()),e=e.copy(null,null,null,e.left.removeMin_(),null),e.fixUp_()}remove(e,t){let r,s;if(r=this,t(e,r.key)<0)!r.left.isEmpty()&&!r.left.isRed_()&&!r.left.left.isRed_()&&(r=r.moveRedLeft_()),r=r.copy(null,null,null,r.left.remove(e,t),null);else{if(r.left.isRed_()&&(r=r.rotateRight_()),!r.right.isEmpty()&&!r.right.isRed_()&&!r.right.left.isRed_()&&(r=r.moveRedRight_()),t(e,r.key)===0){if(r.right.isEmpty())return ds.EMPTY_NODE;s=r.right.min_(),r=r.copy(s.key,s.value,null,null,r.right.removeMin_())}r=r.copy(null,null,null,null,r.right.remove(e,t))}return r.fixUp_()}isRed_(){return this.color}fixUp_(){let e=this;return e.right.isRed_()&&!e.left.isRed_()&&(e=e.rotateLeft_()),e.left.isRed_()&&e.left.left.isRed_()&&(e=e.rotateRight_()),e.left.isRed_()&&e.right.isRed_()&&(e=e.colorFlip_()),e}moveRedLeft_(){let e=this.colorFlip_();return e.right.left.isRed_()&&(e=e.copy(null,null,null,null,e.right.rotateRight_()),e=e.rotateLeft_(),e=e.colorFlip_()),e}moveRedRight_(){let e=this.colorFlip_();return e.left.left.isRed_()&&(e=e.rotateRight_(),e=e.colorFlip_()),e}rotateLeft_(){const e=this.copy(null,null,Zc.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight_(){const e=this.copy(null,null,Zc.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip_(){const e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth_(){const e=this.check_();return Math.pow(2,e)<=this.count()+1}check_(){if(this.isRed_()&&this.left.isRed_())throw new Error("Red node has red child("+this.key+","+this.value+")");if(this.right.isRed_())throw new Error("Right child of ("+this.key+","+this.value+") is red");const e=this.left.check_();if(e!==this.right.check_())throw new Error("Black depths differ");return e+(this.isRed_()?0:1)}};dr.RED=!0;dr.BLACK=!1;class sF{copy(e,t,r,s,i){return this}insert(e,t,r){return new dr(e,t,null)}remove(e,t){return this}count(){return 0}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}check_(){return 0}isRed_(){return!1}}let ds=class gf{constructor(e,t=gf.EMPTY_NODE){this.comparator_=e,this.root_=t}insert(e,t){return new gf(this.comparator_,this.root_.insert(e,t,this.comparator_).copy(null,null,dr.BLACK,null,null))}remove(e){return new gf(this.comparator_,this.root_.remove(e,this.comparator_).copy(null,null,dr.BLACK,null,null))}get(e){let t,r=this.root_;for(;!r.isEmpty();){if(t=this.comparator_(e,r.key),t===0)return r.value;t<0?r=r.left:t>0&&(r=r.right)}return null}getPredecessorKey(e){let t,r=this.root_,s=null;for(;!r.isEmpty();)if(t=this.comparator_(e,r.key),t===0){if(r.left.isEmpty())return s?s.key:null;for(r=r.left;!r.right.isEmpty();)r=r.right;return r.key}else t<0?r=r.left:t>0&&(s=r,r=r.right);throw new Error("Attempted to find predecessor key for a nonexistent key.  What gives?")}isEmpty(){return this.root_.isEmpty()}count(){return this.root_.count()}minKey(){return this.root_.minKey()}maxKey(){return this.root_.maxKey()}inorderTraversal(e){return this.root_.inorderTraversal(e)}reverseTraversal(e){return this.root_.reverseTraversal(e)}getIterator(e){return new $h(this.root_,null,this.comparator_,!1,e)}getIteratorFrom(e,t){return new $h(this.root_,e,this.comparator_,!1,t)}getReverseIteratorFrom(e,t){return new $h(this.root_,e,this.comparator_,!0,t)}getReverseIterator(e){return new $h(this.root_,null,this.comparator_,!0,e)}};ds.EMPTY_NODE=new sF;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function iF(n,e){return wa(n.name,e.name)}function N0(n,e){return wa(n,e)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let P_;function oF(n){P_=n}const LC=function(n){return typeof n=="number"?"number:"+pC(n):"string:"+n},VC=function(n){if(n.isLeafNode()){const e=n.val();Y(typeof e=="string"||typeof e=="number"||typeof e=="object"&&ns(e,".sv"),"Priority must be a string or number.")}else Y(n===P_||n.isEmpty(),"priority of unexpected type.");Y(n===P_||n.getPriority().isEmpty(),"Priority nodes can't have a priority of their own.")};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let eT;class an{static set __childrenNodeConstructor(e){eT=e}static get __childrenNodeConstructor(){return eT}constructor(e,t=an.__childrenNodeConstructor.EMPTY_NODE){this.value_=e,this.priorityNode_=t,this.lazyHash_=null,Y(this.value_!==void 0&&this.value_!==null,"LeafNode shouldn't be created with null/undefined value."),VC(this.priorityNode_)}isLeafNode(){return!0}getPriority(){return this.priorityNode_}updatePriority(e){return new an(this.value_,e)}getImmediateChild(e){return e===".priority"?this.priorityNode_:an.__childrenNodeConstructor.EMPTY_NODE}getChild(e){return De(e)?this:ke(e)===".priority"?this.priorityNode_:an.__childrenNodeConstructor.EMPTY_NODE}hasChild(){return!1}getPredecessorChildName(e,t){return null}updateImmediateChild(e,t){return e===".priority"?this.updatePriority(t):t.isEmpty()&&e!==".priority"?this:an.__childrenNodeConstructor.EMPTY_NODE.updateImmediateChild(e,t).updatePriority(this.priorityNode_)}updateChild(e,t){const r=ke(e);return r===null?t:t.isEmpty()&&r!==".priority"?this:(Y(r!==".priority"||Yi(e)===1,".priority must be the last token in a path"),this.updateImmediateChild(r,an.__childrenNodeConstructor.EMPTY_NODE.updateChild(mt(e),t)))}isEmpty(){return!1}numChildren(){return 0}forEachChild(e,t){return!1}val(e){return e&&!this.getPriority().isEmpty()?{".value":this.getValue(),".priority":this.getPriority().val()}:this.getValue()}hash(){if(this.lazyHash_===null){let e="";this.priorityNode_.isEmpty()||(e+="priority:"+LC(this.priorityNode_.val())+":");const t=typeof this.value_;e+=t+":",t==="number"?e+=pC(this.value_):e+=this.value_,this.lazyHash_=dC(e)}return this.lazyHash_}getValue(){return this.value_}compareTo(e){return e===an.__childrenNodeConstructor.EMPTY_NODE?1:e instanceof an.__childrenNodeConstructor?-1:(Y(e.isLeafNode(),"Unknown node type"),this.compareToLeafNode_(e))}compareToLeafNode_(e){const t=typeof e.value_,r=typeof this.value_,s=an.VALUE_TYPE_ORDER.indexOf(t),i=an.VALUE_TYPE_ORDER.indexOf(r);return Y(s>=0,"Unknown leaf type: "+t),Y(i>=0,"Unknown leaf type: "+r),s===i?r==="object"?0:this.value_<e.value_?-1:this.value_===e.value_?0:1:i-s}withIndex(){return this}isIndexed(){return!0}equals(e){if(e===this)return!0;if(e.isLeafNode()){const t=e;return this.value_===t.value_&&this.priorityNode_.equals(t.priorityNode_)}else return!1}}an.VALUE_TYPE_ORDER=["object","boolean","number","string"];/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let FC,jC;function aF(n){FC=n}function lF(n){jC=n}class cF extends um{compare(e,t){const r=e.node.getPriority(),s=t.node.getPriority(),i=r.compareTo(s);return i===0?wa(e.name,t.name):i}isDefinedOn(e){return!e.getPriority().isEmpty()}indexedValueChanged(e,t){return!e.getPriority().equals(t.getPriority())}minPost(){return Le.MIN}maxPost(){return new Le(Ks,new an("[PRIORITY-POST]",jC))}makePost(e,t){const r=FC(e);return new Le(t,new an("[PRIORITY-POST]",r))}toString(){return".priority"}}const vt=new cF;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const uF=Math.log(2);class dF{constructor(e){const t=i=>parseInt(Math.log(i)/uF,10),r=i=>parseInt(Array(i+1).join("1"),2);this.count=t(e+1),this.current_=this.count-1;const s=r(this.count);this.bits_=e+1&s}nextBitIsOne(){const e=!(this.bits_&1<<this.current_);return this.current_--,e}}const up=function(n,e,t,r){n.sort(e);const s=function(l,u){const h=u-l;let f,p;if(h===0)return null;if(h===1)return f=n[l],p=t?t(f):f,new dr(p,f.node,dr.BLACK,null,null);{const y=parseInt(h/2,10)+l,I=s(l,y),C=s(y+1,u);return f=n[y],p=t?t(f):f,new dr(p,f.node,dr.BLACK,I,C)}},i=function(l){let u=null,h=null,f=n.length;const p=function(I,C){const P=f-I,A=f;f-=I;const T=s(P+1,A),R=n[P],D=t?t(R):R;y(new dr(D,R.node,C,null,T))},y=function(I){u?(u.left=I,u=I):(h=I,u=I)};for(let I=0;I<l.count;++I){const C=l.nextBitIsOne(),P=Math.pow(2,l.count-(I+1));C?p(P,dr.BLACK):(p(P,dr.BLACK),p(P,dr.RED))}return h},o=new dF(n.length),a=i(o);return new ds(r||e,a)};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let oy;const La={};class Vs{static get Default(){return Y(La&&vt,"ChildrenNode.ts has not been loaded"),oy=oy||new Vs({".priority":La},{".priority":vt}),oy}constructor(e,t){this.indexes_=e,this.indexSet_=t}get(e){const t=Xo(this.indexes_,e);if(!t)throw new Error("No index defined for "+e);return t instanceof ds?t:null}hasIndex(e){return ns(this.indexSet_,e.toString())}addIndex(e,t){Y(e!==_s,"KeyIndex always exists and isn't meant to be added to the IndexMap.");const r=[];let s=!1;const i=t.getIterator(Le.Wrap);let o=i.getNext();for(;o;)s=s||e.isDefinedOn(o.node),r.push(o),o=i.getNext();let a;s?a=up(r,e.getCompare()):a=La;const l=e.toString(),u={...this.indexSet_};u[l]=e;const h={...this.indexes_};return h[l]=a,new Vs(h,u)}addToIndexes(e,t){const r=op(this.indexes_,(s,i)=>{const o=Xo(this.indexSet_,i);if(Y(o,"Missing index implementation for "+i),s===La)if(o.isDefinedOn(e.node)){const a=[],l=t.getIterator(Le.Wrap);let u=l.getNext();for(;u;)u.name!==e.name&&a.push(u),u=l.getNext();return a.push(e),up(a,o.getCompare())}else return La;else{const a=t.get(e.name);let l=s;return a&&(l=l.remove(new Le(e.name,a))),l.insert(e,e.node)}});return new Vs(r,this.indexSet_)}removeFromIndexes(e,t){const r=op(this.indexes_,s=>{if(s===La)return s;{const i=t.get(e.name);return i?s.remove(new Le(e.name,i)):s}});return new Vs(r,this.indexSet_)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let jc;class ye{static get EMPTY_NODE(){return jc||(jc=new ye(new ds(N0),null,Vs.Default))}constructor(e,t,r){this.children_=e,this.priorityNode_=t,this.indexMap_=r,this.lazyHash_=null,this.priorityNode_&&VC(this.priorityNode_),this.children_.isEmpty()&&Y(!this.priorityNode_||this.priorityNode_.isEmpty(),"An empty node cannot have a priority")}isLeafNode(){return!1}getPriority(){return this.priorityNode_||jc}updatePriority(e){return this.children_.isEmpty()?this:new ye(this.children_,e,this.indexMap_)}getImmediateChild(e){if(e===".priority")return this.getPriority();{const t=this.children_.get(e);return t===null?jc:t}}getChild(e){const t=ke(e);return t===null?this:this.getImmediateChild(t).getChild(mt(e))}hasChild(e){return this.children_.get(e)!==null}updateImmediateChild(e,t){if(Y(t,"We should always be passing snapshot nodes"),e===".priority")return this.updatePriority(t);{const r=new Le(e,t);let s,i;t.isEmpty()?(s=this.children_.remove(e),i=this.indexMap_.removeFromIndexes(r,this.children_)):(s=this.children_.insert(e,t),i=this.indexMap_.addToIndexes(r,this.children_));const o=s.isEmpty()?jc:this.priorityNode_;return new ye(s,o,i)}}updateChild(e,t){const r=ke(e);if(r===null)return t;{Y(ke(e)!==".priority"||Yi(e)===1,".priority must be the last token in a path");const s=this.getImmediateChild(r).updateChild(mt(e),t);return this.updateImmediateChild(r,s)}}isEmpty(){return this.children_.isEmpty()}numChildren(){return this.children_.count()}val(e){if(this.isEmpty())return null;const t={};let r=0,s=0,i=!0;if(this.forEachChild(vt,(o,a)=>{t[o]=a.val(e),r++,i&&ye.INTEGER_REGEXP_.test(o)?s=Math.max(s,Number(o)):i=!1}),!e&&i&&s<2*r){const o=[];for(const a in t)o[a]=t[a];return o}else return e&&!this.getPriority().isEmpty()&&(t[".priority"]=this.getPriority().val()),t}hash(){if(this.lazyHash_===null){let e="";this.getPriority().isEmpty()||(e+="priority:"+LC(this.getPriority().val())+":"),this.forEachChild(vt,(t,r)=>{const s=r.hash();s!==""&&(e+=":"+t+":"+s)}),this.lazyHash_=e===""?"":dC(e)}return this.lazyHash_}getPredecessorChildName(e,t,r){const s=this.resolveIndex_(r);if(s){const i=s.getPredecessorKey(new Le(e,t));return i?i.name:null}else return this.children_.getPredecessorKey(e)}getFirstChildName(e){const t=this.resolveIndex_(e);if(t){const r=t.minKey();return r&&r.name}else return this.children_.minKey()}getFirstChild(e){const t=this.getFirstChildName(e);return t?new Le(t,this.children_.get(t)):null}getLastChildName(e){const t=this.resolveIndex_(e);if(t){const r=t.maxKey();return r&&r.name}else return this.children_.maxKey()}getLastChild(e){const t=this.getLastChildName(e);return t?new Le(t,this.children_.get(t)):null}forEachChild(e,t){const r=this.resolveIndex_(e);return r?r.inorderTraversal(s=>t(s.name,s.node)):this.children_.inorderTraversal(t)}getIterator(e){return this.getIteratorFrom(e.minPost(),e)}getIteratorFrom(e,t){const r=this.resolveIndex_(t);if(r)return r.getIteratorFrom(e,s=>s);{const s=this.children_.getIteratorFrom(e.name,Le.Wrap);let i=s.peek();for(;i!=null&&t.compare(i,e)<0;)s.getNext(),i=s.peek();return s}}getReverseIterator(e){return this.getReverseIteratorFrom(e.maxPost(),e)}getReverseIteratorFrom(e,t){const r=this.resolveIndex_(t);if(r)return r.getReverseIteratorFrom(e,s=>s);{const s=this.children_.getReverseIteratorFrom(e.name,Le.Wrap);let i=s.peek();for(;i!=null&&t.compare(i,e)>0;)s.getNext(),i=s.peek();return s}}compareTo(e){return this.isEmpty()?e.isEmpty()?0:-1:e.isLeafNode()||e.isEmpty()?1:e===Md?-1:0}withIndex(e){if(e===_s||this.indexMap_.hasIndex(e))return this;{const t=this.indexMap_.addIndex(e,this.children_);return new ye(this.children_,this.priorityNode_,t)}}isIndexed(e){return e===_s||this.indexMap_.hasIndex(e)}equals(e){if(e===this)return!0;if(e.isLeafNode())return!1;{const t=e;if(this.getPriority().equals(t.getPriority()))if(this.children_.count()===t.children_.count()){const r=this.getIterator(vt),s=t.getIterator(vt);let i=r.getNext(),o=s.getNext();for(;i&&o;){if(i.name!==o.name||!i.node.equals(o.node))return!1;i=r.getNext(),o=s.getNext()}return i===null&&o===null}else return!1;else return!1}}resolveIndex_(e){return e===_s?null:this.indexMap_.get(e.toString())}}ye.INTEGER_REGEXP_=/^(0|[1-9]\d*)$/;class hF extends ye{constructor(){super(new ds(N0),ye.EMPTY_NODE,Vs.Default)}compareTo(e){return e===this?0:1}equals(e){return e===this}getPriority(){return this}getImmediateChild(e){return ye.EMPTY_NODE}isEmpty(){return!1}}const Md=new hF;Object.defineProperties(Le,{MIN:{value:new Le(Qi,ye.EMPTY_NODE)},MAX:{value:new Le(Ks,Md)}});MC.__EMPTY_NODE=ye.EMPTY_NODE;an.__childrenNodeConstructor=ye;oF(Md);lF(Md);/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const fF=!0;function Lt(n,e=null){if(n===null)return ye.EMPTY_NODE;if(typeof n=="object"&&".priority"in n&&(e=n[".priority"]),Y(e===null||typeof e=="string"||typeof e=="number"||typeof e=="object"&&".sv"in e,"Invalid priority type found: "+typeof e),typeof n=="object"&&".value"in n&&n[".value"]!==null&&(n=n[".value"]),typeof n!="object"||".sv"in n){const t=n;return new an(t,Lt(e))}if(!(n instanceof Array)&&fF){const t=[];let r=!1;if(mn(n,(o,a)=>{if(o.substring(0,1)!=="."){const l=Lt(a);l.isEmpty()||(r=r||!l.getPriority().isEmpty(),t.push(new Le(o,l)))}}),t.length===0)return ye.EMPTY_NODE;const i=up(t,iF,o=>o.name,N0);if(r){const o=up(t,vt.getCompare());return new ye(i,Lt(e),new Vs({".priority":o},{".priority":vt}))}else return new ye(i,Lt(e),Vs.Default)}else{let t=ye.EMPTY_NODE;return mn(n,(r,s)=>{if(ns(n,r)&&r.substring(0,1)!=="."){const i=Lt(s);(i.isLeafNode()||!i.isEmpty())&&(t=t.updateImmediateChild(r,i))}}),t.updatePriority(Lt(e))}}aF(Lt);/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class P0 extends um{constructor(e){super(),this.indexPath_=e,Y(!De(e)&&ke(e)!==".priority","Can't create PathIndex with empty path or .priority key")}extractChild(e){return e.getChild(this.indexPath_)}isDefinedOn(e){return!e.getChild(this.indexPath_).isEmpty()}compare(e,t){const r=this.extractChild(e.node),s=this.extractChild(t.node),i=r.compareTo(s);return i===0?wa(e.name,t.name):i}makePost(e,t){const r=Lt(e),s=ye.EMPTY_NODE.updateChild(this.indexPath_,r);return new Le(t,s)}maxPost(){const e=ye.EMPTY_NODE.updateChild(this.indexPath_,Md);return new Le(Ks,e)}toString(){return Zu(this.indexPath_,0).join("/")}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class pF extends um{compare(e,t){const r=e.node.compareTo(t.node);return r===0?wa(e.name,t.name):r}isDefinedOn(e){return!0}indexedValueChanged(e,t){return!e.equals(t)}minPost(){return Le.MIN}maxPost(){return Le.MAX}makePost(e,t){const r=Lt(e);return new Le(t,r)}toString(){return".value"}}const k0=new pF;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function UC(n){return{type:"value",snapshotNode:n}}function Rl(n,e){return{type:"child_added",snapshotNode:e,childName:n}}function ed(n,e){return{type:"child_removed",snapshotNode:e,childName:n}}function td(n,e,t){return{type:"child_changed",snapshotNode:e,childName:n,oldSnap:t}}function mF(n,e){return{type:"child_moved",snapshotNode:e,childName:n}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class D0{constructor(e){this.index_=e}updateChild(e,t,r,s,i,o){Y(e.isIndexed(this.index_),"A node must be indexed if only a child is updated");const a=e.getImmediateChild(t);return a.getChild(s).equals(r.getChild(s))&&a.isEmpty()===r.isEmpty()||(o!=null&&(r.isEmpty()?e.hasChild(t)?o.trackChildChange(ed(t,a)):Y(e.isLeafNode(),"A child remove without an old child only makes sense on a leaf node"):a.isEmpty()?o.trackChildChange(Rl(t,r)):o.trackChildChange(td(t,r,a))),e.isLeafNode()&&r.isEmpty())?e:e.updateImmediateChild(t,r).withIndex(this.index_)}updateFullNode(e,t,r){return r!=null&&(e.isLeafNode()||e.forEachChild(vt,(s,i)=>{t.hasChild(s)||r.trackChildChange(ed(s,i))}),t.isLeafNode()||t.forEachChild(vt,(s,i)=>{if(e.hasChild(s)){const o=e.getImmediateChild(s);o.equals(i)||r.trackChildChange(td(s,i,o))}else r.trackChildChange(Rl(s,i))})),t.withIndex(this.index_)}updatePriority(e,t){return e.isEmpty()?ye.EMPTY_NODE:e.updatePriority(t)}filtersNodes(){return!1}getIndexedFilter(){return this}getIndex(){return this.index_}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class nd{constructor(e){this.indexedFilter_=new D0(e.getIndex()),this.index_=e.getIndex(),this.startPost_=nd.getStartPost_(e),this.endPost_=nd.getEndPost_(e),this.startIsInclusive_=!e.startAfterSet_,this.endIsInclusive_=!e.endBeforeSet_}getStartPost(){return this.startPost_}getEndPost(){return this.endPost_}matches(e){const t=this.startIsInclusive_?this.index_.compare(this.getStartPost(),e)<=0:this.index_.compare(this.getStartPost(),e)<0,r=this.endIsInclusive_?this.index_.compare(e,this.getEndPost())<=0:this.index_.compare(e,this.getEndPost())<0;return t&&r}updateChild(e,t,r,s,i,o){return this.matches(new Le(t,r))||(r=ye.EMPTY_NODE),this.indexedFilter_.updateChild(e,t,r,s,i,o)}updateFullNode(e,t,r){t.isLeafNode()&&(t=ye.EMPTY_NODE);let s=t.withIndex(this.index_);s=s.updatePriority(ye.EMPTY_NODE);const i=this;return t.forEachChild(vt,(o,a)=>{i.matches(new Le(o,a))||(s=s.updateImmediateChild(o,ye.EMPTY_NODE))}),this.indexedFilter_.updateFullNode(e,s,r)}updatePriority(e,t){return e}filtersNodes(){return!0}getIndexedFilter(){return this.indexedFilter_}getIndex(){return this.index_}static getStartPost_(e){if(e.hasStart()){const t=e.getIndexStartName();return e.getIndex().makePost(e.getIndexStartValue(),t)}else return e.getIndex().minPost()}static getEndPost_(e){if(e.hasEnd()){const t=e.getIndexEndName();return e.getIndex().makePost(e.getIndexEndValue(),t)}else return e.getIndex().maxPost()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class gF{constructor(e){this.withinDirectionalStart=t=>this.reverse_?this.withinEndPost(t):this.withinStartPost(t),this.withinDirectionalEnd=t=>this.reverse_?this.withinStartPost(t):this.withinEndPost(t),this.withinStartPost=t=>{const r=this.index_.compare(this.rangedFilter_.getStartPost(),t);return this.startIsInclusive_?r<=0:r<0},this.withinEndPost=t=>{const r=this.index_.compare(t,this.rangedFilter_.getEndPost());return this.endIsInclusive_?r<=0:r<0},this.rangedFilter_=new nd(e),this.index_=e.getIndex(),this.limit_=e.getLimit(),this.reverse_=!e.isViewFromLeft(),this.startIsInclusive_=!e.startAfterSet_,this.endIsInclusive_=!e.endBeforeSet_}updateChild(e,t,r,s,i,o){return this.rangedFilter_.matches(new Le(t,r))||(r=ye.EMPTY_NODE),e.getImmediateChild(t).equals(r)?e:e.numChildren()<this.limit_?this.rangedFilter_.getIndexedFilter().updateChild(e,t,r,s,i,o):this.fullLimitUpdateChild_(e,t,r,i,o)}updateFullNode(e,t,r){let s;if(t.isLeafNode()||t.isEmpty())s=ye.EMPTY_NODE.withIndex(this.index_);else if(this.limit_*2<t.numChildren()&&t.isIndexed(this.index_)){s=ye.EMPTY_NODE.withIndex(this.index_);let i;this.reverse_?i=t.getReverseIteratorFrom(this.rangedFilter_.getEndPost(),this.index_):i=t.getIteratorFrom(this.rangedFilter_.getStartPost(),this.index_);let o=0;for(;i.hasNext()&&o<this.limit_;){const a=i.getNext();if(this.withinDirectionalStart(a))if(this.withinDirectionalEnd(a))s=s.updateImmediateChild(a.name,a.node),o++;else break;else continue}}else{s=t.withIndex(this.index_),s=s.updatePriority(ye.EMPTY_NODE);let i;this.reverse_?i=s.getReverseIterator(this.index_):i=s.getIterator(this.index_);let o=0;for(;i.hasNext();){const a=i.getNext();o<this.limit_&&this.withinDirectionalStart(a)&&this.withinDirectionalEnd(a)?o++:s=s.updateImmediateChild(a.name,ye.EMPTY_NODE)}}return this.rangedFilter_.getIndexedFilter().updateFullNode(e,s,r)}updatePriority(e,t){return e}filtersNodes(){return!0}getIndexedFilter(){return this.rangedFilter_.getIndexedFilter()}getIndex(){return this.index_}fullLimitUpdateChild_(e,t,r,s,i){let o;if(this.reverse_){const f=this.index_.getCompare();o=(p,y)=>f(y,p)}else o=this.index_.getCompare();const a=e;Y(a.numChildren()===this.limit_,"");const l=new Le(t,r),u=this.reverse_?a.getFirstChild(this.index_):a.getLastChild(this.index_),h=this.rangedFilter_.matches(l);if(a.hasChild(t)){const f=a.getImmediateChild(t);let p=s.getChildAfterChild(this.index_,u,this.reverse_);for(;p!=null&&(p.name===t||a.hasChild(p.name));)p=s.getChildAfterChild(this.index_,p,this.reverse_);const y=p==null?1:o(p,l);if(h&&!r.isEmpty()&&y>=0)return i!=null&&i.trackChildChange(td(t,r,f)),a.updateImmediateChild(t,r);{i!=null&&i.trackChildChange(ed(t,f));const C=a.updateImmediateChild(t,ye.EMPTY_NODE);return p!=null&&this.rangedFilter_.matches(p)?(i!=null&&i.trackChildChange(Rl(p.name,p.node)),C.updateImmediateChild(p.name,p.node)):C}}else return r.isEmpty()?e:h&&o(u,l)>=0?(i!=null&&(i.trackChildChange(ed(u.name,u.node)),i.trackChildChange(Rl(t,r))),a.updateImmediateChild(t,r).updateImmediateChild(u.name,ye.EMPTY_NODE)):e}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class O0{constructor(){this.limitSet_=!1,this.startSet_=!1,this.startNameSet_=!1,this.startAfterSet_=!1,this.endSet_=!1,this.endNameSet_=!1,this.endBeforeSet_=!1,this.limit_=0,this.viewFrom_="",this.indexStartValue_=null,this.indexStartName_="",this.indexEndValue_=null,this.indexEndName_="",this.index_=vt}hasStart(){return this.startSet_}isViewFromLeft(){return this.viewFrom_===""?this.startSet_:this.viewFrom_==="l"}getIndexStartValue(){return Y(this.startSet_,"Only valid if start has been set"),this.indexStartValue_}getIndexStartName(){return Y(this.startSet_,"Only valid if start has been set"),this.startNameSet_?this.indexStartName_:Qi}hasEnd(){return this.endSet_}getIndexEndValue(){return Y(this.endSet_,"Only valid if end has been set"),this.indexEndValue_}getIndexEndName(){return Y(this.endSet_,"Only valid if end has been set"),this.endNameSet_?this.indexEndName_:Ks}hasLimit(){return this.limitSet_}hasAnchoredLimit(){return this.limitSet_&&this.viewFrom_!==""}getLimit(){return Y(this.limitSet_,"Only valid if limit has been set"),this.limit_}getIndex(){return this.index_}loadsAllData(){return!(this.startSet_||this.endSet_||this.limitSet_)}isDefault(){return this.loadsAllData()&&this.index_===vt}copy(){const e=new O0;return e.limitSet_=this.limitSet_,e.limit_=this.limit_,e.startSet_=this.startSet_,e.startAfterSet_=this.startAfterSet_,e.indexStartValue_=this.indexStartValue_,e.startNameSet_=this.startNameSet_,e.indexStartName_=this.indexStartName_,e.endSet_=this.endSet_,e.endBeforeSet_=this.endBeforeSet_,e.indexEndValue_=this.indexEndValue_,e.endNameSet_=this.endNameSet_,e.indexEndName_=this.indexEndName_,e.index_=this.index_,e.viewFrom_=this.viewFrom_,e}}function yF(n){return n.loadsAllData()?new D0(n.getIndex()):n.hasLimit()?new gF(n):new nd(n)}function _F(n,e){const t=n.copy();return t.limitSet_=!0,t.limit_=e,t.viewFrom_="l",t}function vF(n,e){const t=n.copy();return t.limitSet_=!0,t.limit_=e,t.viewFrom_="r",t}function k_(n,e,t){const r=n.copy();return r.startSet_=!0,e===void 0&&(e=null),r.indexStartValue_=e,t!=null?(r.startNameSet_=!0,r.indexStartName_=t):(r.startNameSet_=!1,r.indexStartName_=""),r}function wF(n,e,t){let r;return n.index_===_s||t?r=k_(n,e,t):r=k_(n,e,Ks),r.startAfterSet_=!0,r}function D_(n,e,t){const r=n.copy();return r.endSet_=!0,e===void 0&&(e=null),r.indexEndValue_=e,t!==void 0?(r.endNameSet_=!0,r.indexEndName_=t):(r.endNameSet_=!1,r.indexEndName_=""),r}function IF(n,e,t){let r;return n.index_===_s||t?r=D_(n,e,t):r=D_(n,e,Qi),r.endBeforeSet_=!0,r}function dm(n,e){const t=n.copy();return t.index_=e,t}function tT(n){const e={};if(n.isDefault())return e;let t;if(n.index_===vt?t="$priority":n.index_===k0?t="$value":n.index_===_s?t="$key":(Y(n.index_ instanceof P0,"Unrecognized index type!"),t=n.index_.toString()),e.orderBy=en(t),n.startSet_){const r=n.startAfterSet_?"startAfter":"startAt";e[r]=en(n.indexStartValue_),n.startNameSet_&&(e[r]+=","+en(n.indexStartName_))}if(n.endSet_){const r=n.endBeforeSet_?"endBefore":"endAt";e[r]=en(n.indexEndValue_),n.endNameSet_&&(e[r]+=","+en(n.indexEndName_))}return n.limitSet_&&(n.isViewFromLeft()?e.limitToFirst=n.limit_:e.limitToLast=n.limit_),e}function nT(n){const e={};if(n.startSet_&&(e.sp=n.indexStartValue_,n.startNameSet_&&(e.sn=n.indexStartName_),e.sin=!n.startAfterSet_),n.endSet_&&(e.ep=n.indexEndValue_,n.endNameSet_&&(e.en=n.indexEndName_),e.ein=!n.endBeforeSet_),n.limitSet_){e.l=n.limit_;let t=n.viewFrom_;t===""&&(n.isViewFromLeft()?t="l":t="r"),e.vf=t}return n.index_!==vt&&(e.i=n.index_.toString()),e}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class dp extends PC{reportStats(e){throw new Error("Method not implemented.")}static getListenId_(e,t){return t!==void 0?"tag$"+t:(Y(e._queryParams.isDefault(),"should have a tag if it's not a default query."),e._path.toString())}constructor(e,t,r,s){super(),this.repoInfo_=e,this.onDataUpdate_=t,this.authTokenProvider_=r,this.appCheckTokenProvider_=s,this.log_=Od("p:rest:"),this.listens_={}}listen(e,t,r,s){const i=e._path.toString();this.log_("Listen called for "+i+" "+e._queryIdentifier);const o=dp.getListenId_(e,r),a={};this.listens_[o]=a;const l=tT(e._queryParams);this.restRequest_(i+".json",l,(u,h)=>{let f=h;if(u===404&&(f=null,u=null),u===null&&this.onDataUpdate_(i,f,!1,r),Xo(this.listens_,o)===a){let p;u?u===401?p="permission_denied":p="rest_error:"+u:p="ok",s(p,null)}})}unlisten(e,t){const r=dp.getListenId_(e,t);delete this.listens_[r]}get(e){const t=tT(e._queryParams),r=e._path.toString(),s=new fr;return this.restRequest_(r+".json",t,(i,o)=>{let a=o;i===404&&(a=null,i=null),i===null?(this.onDataUpdate_(r,a,!1,null),s.resolve(a)):s.reject(new Error(a))}),s.promise}refreshAuthToken(e){}restRequest_(e,t={},r){return t.format="export",Promise.all([this.authTokenProvider_.getToken(!1),this.appCheckTokenProvider_.getToken(!1)]).then(([s,i])=>{s&&s.accessToken&&(t.auth=s.accessToken),i&&i.token&&(t.ac=i.token);const o=(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host+e+"?ns="+this.repoInfo_.namespace+_a(t);this.log_("Sending REST request for "+o);const a=new XMLHttpRequest;a.onreadystatechange=()=>{if(r&&a.readyState===4){this.log_("REST Response for "+o+" received. status:",a.status,"response:",a.responseText);let l=null;if(a.status>=200&&a.status<300){try{l=Yu(a.responseText)}catch{Dn("Failed to parse JSON response for "+o+": "+a.responseText)}r(null,l)}else a.status!==401&&a.status!==404&&Dn("Got unsuccessful REST response for "+o+" Status: "+a.status),r(a.status);r=null}},a.open("GET",o,!0),a.send()})}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class EF{constructor(){this.rootNode_=ye.EMPTY_NODE}getNode(e){return this.rootNode_.getChild(e)}updateSnapshot(e,t){this.rootNode_=this.rootNode_.updateChild(e,t)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function hp(){return{value:null,children:new Map}}function ic(n,e,t){if(De(e))n.value=t,n.children.clear();else if(n.value!==null)n.value=n.value.updateChild(e,t);else{const r=ke(e);n.children.has(r)||n.children.set(r,hp());const s=n.children.get(r);e=mt(e),ic(s,e,t)}}function O_(n,e){if(De(e))return n.value=null,n.children.clear(),!0;if(n.value!==null){if(n.value.isLeafNode())return!1;{const t=n.value;return n.value=null,t.forEachChild(vt,(r,s)=>{ic(n,new nt(r),s)}),O_(n,e)}}else if(n.children.size>0){const t=ke(e);return e=mt(e),n.children.has(t)&&O_(n.children.get(t),e)&&n.children.delete(t),n.children.size===0}else return!0}function M_(n,e,t){n.value!==null?t(e,n.value):xF(n,(r,s)=>{const i=new nt(e.toString()+"/"+r);M_(s,i,t)})}function xF(n,e){n.children.forEach((t,r)=>{e(r,t)})}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class TF{constructor(e){this.collection_=e,this.last_=null}get(){const e=this.collection_.get(),t={...e};return this.last_&&mn(this.last_,(r,s)=>{t[r]=t[r]-s}),this.last_=e,t}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const rT=10*1e3,SF=30*1e3,bF=5*60*1e3;class AF{constructor(e,t){this.server_=t,this.statsToReport_={},this.statsListener_=new TF(e);const r=rT+(SF-rT)*Math.random();gu(this.reportStats_.bind(this),Math.floor(r))}reportStats_(){const e=this.statsListener_.get(),t={};let r=!1;mn(e,(s,i)=>{i>0&&ns(this.statsToReport_,s)&&(t[s]=i,r=!0)}),r&&this.server_.reportStats(t),gu(this.reportStats_.bind(this),Math.floor(Math.random()*2*bF))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Hr;(function(n){n[n.OVERWRITE=0]="OVERWRITE",n[n.MERGE=1]="MERGE",n[n.ACK_USER_WRITE=2]="ACK_USER_WRITE",n[n.LISTEN_COMPLETE=3]="LISTEN_COMPLETE"})(Hr||(Hr={}));function M0(){return{fromUser:!0,fromServer:!1,queryId:null,tagged:!1}}function L0(){return{fromUser:!1,fromServer:!0,queryId:null,tagged:!1}}function V0(n){return{fromUser:!1,fromServer:!0,queryId:n,tagged:!0}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class fp{constructor(e,t,r){this.path=e,this.affectedTree=t,this.revert=r,this.type=Hr.ACK_USER_WRITE,this.source=M0()}operationForChild(e){if(De(this.path)){if(this.affectedTree.value!=null)return Y(this.affectedTree.children.isEmpty(),"affectedTree should not have overlapping affected paths."),this;{const t=this.affectedTree.subtree(new nt(e));return new fp(Ze(),t,this.revert)}}else return Y(ke(this.path)===e,"operationForChild called for unrelated child."),new fp(mt(this.path),this.affectedTree,this.revert)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class rd{constructor(e,t){this.source=e,this.path=t,this.type=Hr.LISTEN_COMPLETE}operationForChild(e){return De(this.path)?new rd(this.source,Ze()):new rd(this.source,mt(this.path))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ea{constructor(e,t,r){this.source=e,this.path=t,this.snap=r,this.type=Hr.OVERWRITE}operationForChild(e){return De(this.path)?new ea(this.source,Ze(),this.snap.getImmediateChild(e)):new ea(this.source,mt(this.path),this.snap)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Nl{constructor(e,t,r){this.source=e,this.path=t,this.children=r,this.type=Hr.MERGE}operationForChild(e){if(De(this.path)){const t=this.children.subtree(new nt(e));return t.isEmpty()?null:t.value?new ea(this.source,Ze(),t.value):new Nl(this.source,Ze(),t)}else return Y(ke(this.path)===e,"Can't get a merge for a child not on the path of the operation"),new Nl(this.source,mt(this.path),this.children)}toString(){return"Operation("+this.path+": "+this.source.toString()+" merge: "+this.children.toString()+")"}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ji{constructor(e,t,r){this.node_=e,this.fullyInitialized_=t,this.filtered_=r}isFullyInitialized(){return this.fullyInitialized_}isFiltered(){return this.filtered_}isCompleteForPath(e){if(De(e))return this.isFullyInitialized()&&!this.filtered_;const t=ke(e);return this.isCompleteForChild(t)}isCompleteForChild(e){return this.isFullyInitialized()&&!this.filtered_||this.node_.hasChild(e)}getNode(){return this.node_}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class CF{constructor(e){this.query_=e,this.index_=this.query_._queryParams.getIndex()}}function RF(n,e,t,r){const s=[],i=[];return e.forEach(o=>{o.type==="child_changed"&&n.index_.indexedValueChanged(o.oldSnap,o.snapshotNode)&&i.push(mF(o.childName,o.snapshotNode))}),Uc(n,s,"child_removed",e,r,t),Uc(n,s,"child_added",e,r,t),Uc(n,s,"child_moved",i,r,t),Uc(n,s,"child_changed",e,r,t),Uc(n,s,"value",e,r,t),s}function Uc(n,e,t,r,s,i){const o=r.filter(a=>a.type===t);o.sort((a,l)=>PF(n,a,l)),o.forEach(a=>{const l=NF(n,a,i);s.forEach(u=>{u.respondsTo(a.type)&&e.push(u.createEvent(l,n.query_))})})}function NF(n,e,t){return e.type==="value"||e.type==="child_removed"||(e.prevName=t.getPredecessorChildName(e.childName,e.snapshotNode,n.index_)),e}function PF(n,e,t){if(e.childName==null||t.childName==null)throw rc("Should only compare child_ events.");const r=new Le(e.childName,e.snapshotNode),s=new Le(t.childName,t.snapshotNode);return n.index_.compare(r,s)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function hm(n,e){return{eventCache:n,serverCache:e}}function yu(n,e,t,r){return hm(new Ji(e,t,r),n.serverCache)}function BC(n,e,t,r){return hm(n.eventCache,new Ji(e,t,r))}function pp(n){return n.eventCache.isFullyInitialized()?n.eventCache.getNode():null}function ta(n){return n.serverCache.isFullyInitialized()?n.serverCache.getNode():null}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let ay;const kF=()=>(ay||(ay=new ds(pV)),ay);class yt{static fromObject(e){let t=new yt(null);return mn(e,(r,s)=>{t=t.set(new nt(r),s)}),t}constructor(e,t=kF()){this.value=e,this.children=t}isEmpty(){return this.value===null&&this.children.isEmpty()}findRootMostMatchingPathAndValue(e,t){if(this.value!=null&&t(this.value))return{path:Ze(),value:this.value};if(De(e))return null;{const r=ke(e),s=this.children.get(r);if(s!==null){const i=s.findRootMostMatchingPathAndValue(mt(e),t);return i!=null?{path:kt(new nt(r),i.path),value:i.value}:null}else return null}}findRootMostValueAndPath(e){return this.findRootMostMatchingPathAndValue(e,()=>!0)}subtree(e){if(De(e))return this;{const t=ke(e),r=this.children.get(t);return r!==null?r.subtree(mt(e)):new yt(null)}}set(e,t){if(De(e))return new yt(t,this.children);{const r=ke(e),i=(this.children.get(r)||new yt(null)).set(mt(e),t),o=this.children.insert(r,i);return new yt(this.value,o)}}remove(e){if(De(e))return this.children.isEmpty()?new yt(null):new yt(null,this.children);{const t=ke(e),r=this.children.get(t);if(r){const s=r.remove(mt(e));let i;return s.isEmpty()?i=this.children.remove(t):i=this.children.insert(t,s),this.value===null&&i.isEmpty()?new yt(null):new yt(this.value,i)}else return this}}get(e){if(De(e))return this.value;{const t=ke(e),r=this.children.get(t);return r?r.get(mt(e)):null}}setTree(e,t){if(De(e))return t;{const r=ke(e),i=(this.children.get(r)||new yt(null)).setTree(mt(e),t);let o;return i.isEmpty()?o=this.children.remove(r):o=this.children.insert(r,i),new yt(this.value,o)}}fold(e){return this.fold_(Ze(),e)}fold_(e,t){const r={};return this.children.inorderTraversal((s,i)=>{r[s]=i.fold_(kt(e,s),t)}),t(e,this.value,r)}findOnPath(e,t){return this.findOnPath_(e,Ze(),t)}findOnPath_(e,t,r){const s=this.value?r(t,this.value):!1;if(s)return s;if(De(e))return null;{const i=ke(e),o=this.children.get(i);return o?o.findOnPath_(mt(e),kt(t,i),r):null}}foreachOnPath(e,t){return this.foreachOnPath_(e,Ze(),t)}foreachOnPath_(e,t,r){if(De(e))return this;{this.value&&r(t,this.value);const s=ke(e),i=this.children.get(s);return i?i.foreachOnPath_(mt(e),kt(t,s),r):new yt(null)}}foreach(e){this.foreach_(Ze(),e)}foreach_(e,t){this.children.inorderTraversal((r,s)=>{s.foreach_(kt(e,r),t)}),this.value&&t(e,this.value)}foreachChild(e){this.children.inorderTraversal((t,r)=>{r.value&&e(t,r.value)})}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Jr{constructor(e){this.writeTree_=e}static empty(){return new Jr(new yt(null))}}function _u(n,e,t){if(De(e))return new Jr(new yt(t));{const r=n.writeTree_.findRootMostValueAndPath(e);if(r!=null){const s=r.path;let i=r.value;const o=Un(s,e);return i=i.updateChild(o,t),new Jr(n.writeTree_.set(s,i))}else{const s=new yt(t),i=n.writeTree_.setTree(e,s);return new Jr(i)}}}function L_(n,e,t){let r=n;return mn(t,(s,i)=>{r=_u(r,kt(e,s),i)}),r}function sT(n,e){if(De(e))return Jr.empty();{const t=n.writeTree_.setTree(e,new yt(null));return new Jr(t)}}function V_(n,e){return Ia(n,e)!=null}function Ia(n,e){const t=n.writeTree_.findRootMostValueAndPath(e);return t!=null?n.writeTree_.get(t.path).getChild(Un(t.path,e)):null}function iT(n){const e=[],t=n.writeTree_.value;return t!=null?t.isLeafNode()||t.forEachChild(vt,(r,s)=>{e.push(new Le(r,s))}):n.writeTree_.children.inorderTraversal((r,s)=>{s.value!=null&&e.push(new Le(r,s.value))}),e}function $i(n,e){if(De(e))return n;{const t=Ia(n,e);return t!=null?new Jr(new yt(t)):new Jr(n.writeTree_.subtree(e))}}function F_(n){return n.writeTree_.isEmpty()}function Pl(n,e){return $C(Ze(),n.writeTree_,e)}function $C(n,e,t){if(e.value!=null)return t.updateChild(n,e.value);{let r=null;return e.children.inorderTraversal((s,i)=>{s===".priority"?(Y(i.value!==null,"Priority writes must always be leaf nodes"),r=i.value):t=$C(kt(n,s),i,t)}),!t.getChild(n).isEmpty()&&r!==null&&(t=t.updateChild(kt(n,".priority"),r)),t}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function fm(n,e){return GC(e,n)}function DF(n,e,t,r,s){Y(r>n.lastWriteId,"Stacking an older write on top of newer ones"),s===void 0&&(s=!0),n.allWrites.push({path:e,snap:t,writeId:r,visible:s}),s&&(n.visibleWrites=_u(n.visibleWrites,e,t)),n.lastWriteId=r}function OF(n,e,t,r){Y(r>n.lastWriteId,"Stacking an older merge on top of newer ones"),n.allWrites.push({path:e,children:t,writeId:r,visible:!0}),n.visibleWrites=L_(n.visibleWrites,e,t),n.lastWriteId=r}function MF(n,e){for(let t=0;t<n.allWrites.length;t++){const r=n.allWrites[t];if(r.writeId===e)return r}return null}function LF(n,e){const t=n.allWrites.findIndex(a=>a.writeId===e);Y(t>=0,"removeWrite called with nonexistent writeId.");const r=n.allWrites[t];n.allWrites.splice(t,1);let s=r.visible,i=!1,o=n.allWrites.length-1;for(;s&&o>=0;){const a=n.allWrites[o];a.visible&&(o>=t&&VF(a,r.path)?s=!1:kr(r.path,a.path)&&(i=!0)),o--}if(s){if(i)return FF(n),!0;if(r.snap)n.visibleWrites=sT(n.visibleWrites,r.path);else{const a=r.children;mn(a,l=>{n.visibleWrites=sT(n.visibleWrites,kt(r.path,l))})}return!0}else return!1}function VF(n,e){if(n.snap)return kr(n.path,e);for(const t in n.children)if(n.children.hasOwnProperty(t)&&kr(kt(n.path,t),e))return!0;return!1}function FF(n){n.visibleWrites=zC(n.allWrites,jF,Ze()),n.allWrites.length>0?n.lastWriteId=n.allWrites[n.allWrites.length-1].writeId:n.lastWriteId=-1}function jF(n){return n.visible}function zC(n,e,t){let r=Jr.empty();for(let s=0;s<n.length;++s){const i=n[s];if(e(i)){const o=i.path;let a;if(i.snap)kr(t,o)?(a=Un(t,o),r=_u(r,a,i.snap)):kr(o,t)&&(a=Un(o,t),r=_u(r,Ze(),i.snap.getChild(a)));else if(i.children){if(kr(t,o))a=Un(t,o),r=L_(r,a,i.children);else if(kr(o,t))if(a=Un(o,t),De(a))r=L_(r,Ze(),i.children);else{const l=Xo(i.children,ke(a));if(l){const u=l.getChild(mt(a));r=_u(r,Ze(),u)}}}else throw rc("WriteRecord should have .snap or .children")}}return r}function qC(n,e,t,r,s){if(!r&&!s){const i=Ia(n.visibleWrites,e);if(i!=null)return i;{const o=$i(n.visibleWrites,e);if(F_(o))return t;if(t==null&&!V_(o,Ze()))return null;{const a=t||ye.EMPTY_NODE;return Pl(o,a)}}}else{const i=$i(n.visibleWrites,e);if(!s&&F_(i))return t;if(!s&&t==null&&!V_(i,Ze()))return null;{const o=function(u){return(u.visible||s)&&(!r||!~r.indexOf(u.writeId))&&(kr(u.path,e)||kr(e,u.path))},a=zC(n.allWrites,o,e),l=t||ye.EMPTY_NODE;return Pl(a,l)}}}function UF(n,e,t){let r=ye.EMPTY_NODE;const s=Ia(n.visibleWrites,e);if(s)return s.isLeafNode()||s.forEachChild(vt,(i,o)=>{r=r.updateImmediateChild(i,o)}),r;if(t){const i=$i(n.visibleWrites,e);return t.forEachChild(vt,(o,a)=>{const l=Pl($i(i,new nt(o)),a);r=r.updateImmediateChild(o,l)}),iT(i).forEach(o=>{r=r.updateImmediateChild(o.name,o.node)}),r}else{const i=$i(n.visibleWrites,e);return iT(i).forEach(o=>{r=r.updateImmediateChild(o.name,o.node)}),r}}function BF(n,e,t,r,s){Y(r||s,"Either existingEventSnap or existingServerSnap must exist");const i=kt(e,t);if(V_(n.visibleWrites,i))return null;{const o=$i(n.visibleWrites,i);return F_(o)?s.getChild(t):Pl(o,s.getChild(t))}}function $F(n,e,t,r){const s=kt(e,t),i=Ia(n.visibleWrites,s);if(i!=null)return i;if(r.isCompleteForChild(t)){const o=$i(n.visibleWrites,s);return Pl(o,r.getNode().getImmediateChild(t))}else return null}function zF(n,e){return Ia(n.visibleWrites,e)}function qF(n,e,t,r,s,i,o){let a;const l=$i(n.visibleWrites,e),u=Ia(l,Ze());if(u!=null)a=u;else if(t!=null)a=Pl(l,t);else return[];if(a=a.withIndex(o),!a.isEmpty()&&!a.isLeafNode()){const h=[],f=o.getCompare(),p=i?a.getReverseIteratorFrom(r,o):a.getIteratorFrom(r,o);let y=p.getNext();for(;y&&h.length<s;)f(y,r)!==0&&h.push(y),y=p.getNext();return h}else return[]}function WF(){return{visibleWrites:Jr.empty(),allWrites:[],lastWriteId:-1}}function mp(n,e,t,r){return qC(n.writeTree,n.treePath,e,t,r)}function F0(n,e){return UF(n.writeTree,n.treePath,e)}function oT(n,e,t,r){return BF(n.writeTree,n.treePath,e,t,r)}function gp(n,e){return zF(n.writeTree,kt(n.treePath,e))}function GF(n,e,t,r,s,i){return qF(n.writeTree,n.treePath,e,t,r,s,i)}function j0(n,e,t){return $F(n.writeTree,n.treePath,e,t)}function WC(n,e){return GC(kt(n.treePath,e),n.writeTree)}function GC(n,e){return{treePath:n,writeTree:e}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class HF{constructor(){this.changeMap=new Map}trackChildChange(e){const t=e.type,r=e.childName;Y(t==="child_added"||t==="child_changed"||t==="child_removed","Only child changes supported for tracking"),Y(r!==".priority","Only non-priority child changes can be tracked.");const s=this.changeMap.get(r);if(s){const i=s.type;if(t==="child_added"&&i==="child_removed")this.changeMap.set(r,td(r,e.snapshotNode,s.snapshotNode));else if(t==="child_removed"&&i==="child_added")this.changeMap.delete(r);else if(t==="child_removed"&&i==="child_changed")this.changeMap.set(r,ed(r,s.oldSnap));else if(t==="child_changed"&&i==="child_added")this.changeMap.set(r,Rl(r,e.snapshotNode));else if(t==="child_changed"&&i==="child_changed")this.changeMap.set(r,td(r,e.snapshotNode,s.oldSnap));else throw rc("Illegal combination of changes: "+e+" occurred after "+s)}else this.changeMap.set(r,e)}getChanges(){return Array.from(this.changeMap.values())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class KF{getCompleteChild(e){return null}getChildAfterChild(e,t,r){return null}}const HC=new KF;class U0{constructor(e,t,r=null){this.writes_=e,this.viewCache_=t,this.optCompleteServerCache_=r}getCompleteChild(e){const t=this.viewCache_.eventCache;if(t.isCompleteForChild(e))return t.getNode().getImmediateChild(e);{const r=this.optCompleteServerCache_!=null?new Ji(this.optCompleteServerCache_,!0,!1):this.viewCache_.serverCache;return j0(this.writes_,e,r)}}getChildAfterChild(e,t,r){const s=this.optCompleteServerCache_!=null?this.optCompleteServerCache_:ta(this.viewCache_),i=GF(this.writes_,s,t,1,r,e);return i.length===0?null:i[0]}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function QF(n){return{filter:n}}function YF(n,e){Y(e.eventCache.getNode().isIndexed(n.filter.getIndex()),"Event snap not indexed"),Y(e.serverCache.getNode().isIndexed(n.filter.getIndex()),"Server snap not indexed")}function JF(n,e,t,r,s){const i=new HF;let o,a;if(t.type===Hr.OVERWRITE){const u=t;u.source.fromUser?o=j_(n,e,u.path,u.snap,r,s,i):(Y(u.source.fromServer,"Unknown source."),a=u.source.tagged||e.serverCache.isFiltered()&&!De(u.path),o=yp(n,e,u.path,u.snap,r,s,a,i))}else if(t.type===Hr.MERGE){const u=t;u.source.fromUser?o=ZF(n,e,u.path,u.children,r,s,i):(Y(u.source.fromServer,"Unknown source."),a=u.source.tagged||e.serverCache.isFiltered(),o=U_(n,e,u.path,u.children,r,s,a,i))}else if(t.type===Hr.ACK_USER_WRITE){const u=t;u.revert?o=nj(n,e,u.path,r,s,i):o=ej(n,e,u.path,u.affectedTree,r,s,i)}else if(t.type===Hr.LISTEN_COMPLETE)o=tj(n,e,t.path,r,i);else throw rc("Unknown operation type: "+t.type);const l=i.getChanges();return XF(e,o,l),{viewCache:o,changes:l}}function XF(n,e,t){const r=e.eventCache;if(r.isFullyInitialized()){const s=r.getNode().isLeafNode()||r.getNode().isEmpty(),i=pp(n);(t.length>0||!n.eventCache.isFullyInitialized()||s&&!r.getNode().equals(i)||!r.getNode().getPriority().equals(i.getPriority()))&&t.push(UC(pp(e)))}}function KC(n,e,t,r,s,i){const o=e.eventCache;if(gp(r,t)!=null)return e;{let a,l;if(De(t))if(Y(e.serverCache.isFullyInitialized(),"If change path is empty, we must have complete server data"),e.serverCache.isFiltered()){const u=ta(e),h=u instanceof ye?u:ye.EMPTY_NODE,f=F0(r,h);a=n.filter.updateFullNode(e.eventCache.getNode(),f,i)}else{const u=mp(r,ta(e));a=n.filter.updateFullNode(e.eventCache.getNode(),u,i)}else{const u=ke(t);if(u===".priority"){Y(Yi(t)===1,"Can't have a priority with additional path components");const h=o.getNode();l=e.serverCache.getNode();const f=oT(r,t,h,l);f!=null?a=n.filter.updatePriority(h,f):a=o.getNode()}else{const h=mt(t);let f;if(o.isCompleteForChild(u)){l=e.serverCache.getNode();const p=oT(r,t,o.getNode(),l);p!=null?f=o.getNode().getImmediateChild(u).updateChild(h,p):f=o.getNode().getImmediateChild(u)}else f=j0(r,u,e.serverCache);f!=null?a=n.filter.updateChild(o.getNode(),u,f,h,s,i):a=o.getNode()}}return yu(e,a,o.isFullyInitialized()||De(t),n.filter.filtersNodes())}}function yp(n,e,t,r,s,i,o,a){const l=e.serverCache;let u;const h=o?n.filter:n.filter.getIndexedFilter();if(De(t))u=h.updateFullNode(l.getNode(),r,null);else if(h.filtersNodes()&&!l.isFiltered()){const y=l.getNode().updateChild(t,r);u=h.updateFullNode(l.getNode(),y,null)}else{const y=ke(t);if(!l.isCompleteForPath(t)&&Yi(t)>1)return e;const I=mt(t),P=l.getNode().getImmediateChild(y).updateChild(I,r);y===".priority"?u=h.updatePriority(l.getNode(),P):u=h.updateChild(l.getNode(),y,P,I,HC,null)}const f=BC(e,u,l.isFullyInitialized()||De(t),h.filtersNodes()),p=new U0(s,f,i);return KC(n,f,t,s,p,a)}function j_(n,e,t,r,s,i,o){const a=e.eventCache;let l,u;const h=new U0(s,e,i);if(De(t))u=n.filter.updateFullNode(e.eventCache.getNode(),r,o),l=yu(e,u,!0,n.filter.filtersNodes());else{const f=ke(t);if(f===".priority")u=n.filter.updatePriority(e.eventCache.getNode(),r),l=yu(e,u,a.isFullyInitialized(),a.isFiltered());else{const p=mt(t),y=a.getNode().getImmediateChild(f);let I;if(De(p))I=r;else{const C=h.getCompleteChild(f);C!=null?A0(p)===".priority"&&C.getChild(DC(p)).isEmpty()?I=C:I=C.updateChild(p,r):I=ye.EMPTY_NODE}if(y.equals(I))l=e;else{const C=n.filter.updateChild(a.getNode(),f,I,p,h,o);l=yu(e,C,a.isFullyInitialized(),n.filter.filtersNodes())}}}return l}function aT(n,e){return n.eventCache.isCompleteForChild(e)}function ZF(n,e,t,r,s,i,o){let a=e;return r.foreach((l,u)=>{const h=kt(t,l);aT(e,ke(h))&&(a=j_(n,a,h,u,s,i,o))}),r.foreach((l,u)=>{const h=kt(t,l);aT(e,ke(h))||(a=j_(n,a,h,u,s,i,o))}),a}function lT(n,e,t){return t.foreach((r,s)=>{e=e.updateChild(r,s)}),e}function U_(n,e,t,r,s,i,o,a){if(e.serverCache.getNode().isEmpty()&&!e.serverCache.isFullyInitialized())return e;let l=e,u;De(t)?u=r:u=new yt(null).setTree(t,r);const h=e.serverCache.getNode();return u.children.inorderTraversal((f,p)=>{if(h.hasChild(f)){const y=e.serverCache.getNode().getImmediateChild(f),I=lT(n,y,p);l=yp(n,l,new nt(f),I,s,i,o,a)}}),u.children.inorderTraversal((f,p)=>{const y=!e.serverCache.isCompleteForChild(f)&&p.value===null;if(!h.hasChild(f)&&!y){const I=e.serverCache.getNode().getImmediateChild(f),C=lT(n,I,p);l=yp(n,l,new nt(f),C,s,i,o,a)}}),l}function ej(n,e,t,r,s,i,o){if(gp(s,t)!=null)return e;const a=e.serverCache.isFiltered(),l=e.serverCache;if(r.value!=null){if(De(t)&&l.isFullyInitialized()||l.isCompleteForPath(t))return yp(n,e,t,l.getNode().getChild(t),s,i,a,o);if(De(t)){let u=new yt(null);return l.getNode().forEachChild(_s,(h,f)=>{u=u.set(new nt(h),f)}),U_(n,e,t,u,s,i,a,o)}else return e}else{let u=new yt(null);return r.foreach((h,f)=>{const p=kt(t,h);l.isCompleteForPath(p)&&(u=u.set(h,l.getNode().getChild(p)))}),U_(n,e,t,u,s,i,a,o)}}function tj(n,e,t,r,s){const i=e.serverCache,o=BC(e,i.getNode(),i.isFullyInitialized()||De(t),i.isFiltered());return KC(n,o,t,r,HC,s)}function nj(n,e,t,r,s,i){let o;if(gp(r,t)!=null)return e;{const a=new U0(r,e,s),l=e.eventCache.getNode();let u;if(De(t)||ke(t)===".priority"){let h;if(e.serverCache.isFullyInitialized())h=mp(r,ta(e));else{const f=e.serverCache.getNode();Y(f instanceof ye,"serverChildren would be complete if leaf node"),h=F0(r,f)}h=h,u=n.filter.updateFullNode(l,h,i)}else{const h=ke(t);let f=j0(r,h,e.serverCache);f==null&&e.serverCache.isCompleteForChild(h)&&(f=l.getImmediateChild(h)),f!=null?u=n.filter.updateChild(l,h,f,mt(t),a,i):e.eventCache.getNode().hasChild(h)?u=n.filter.updateChild(l,h,ye.EMPTY_NODE,mt(t),a,i):u=l,u.isEmpty()&&e.serverCache.isFullyInitialized()&&(o=mp(r,ta(e)),o.isLeafNode()&&(u=n.filter.updateFullNode(u,o,i)))}return o=e.serverCache.isFullyInitialized()||gp(r,Ze())!=null,yu(e,u,o,n.filter.filtersNodes())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class rj{constructor(e,t){this.query_=e,this.eventRegistrations_=[];const r=this.query_._queryParams,s=new D0(r.getIndex()),i=yF(r);this.processor_=QF(i);const o=t.serverCache,a=t.eventCache,l=s.updateFullNode(ye.EMPTY_NODE,o.getNode(),null),u=i.updateFullNode(ye.EMPTY_NODE,a.getNode(),null),h=new Ji(l,o.isFullyInitialized(),s.filtersNodes()),f=new Ji(u,a.isFullyInitialized(),i.filtersNodes());this.viewCache_=hm(f,h),this.eventGenerator_=new CF(this.query_)}get query(){return this.query_}}function sj(n){return n.viewCache_.serverCache.getNode()}function ij(n){return pp(n.viewCache_)}function oj(n,e){const t=ta(n.viewCache_);return t&&(n.query._queryParams.loadsAllData()||!De(e)&&!t.getImmediateChild(ke(e)).isEmpty())?t.getChild(e):null}function cT(n){return n.eventRegistrations_.length===0}function aj(n,e){n.eventRegistrations_.push(e)}function uT(n,e,t){const r=[];if(t){Y(e==null,"A cancel should cancel all event registrations.");const s=n.query._path;n.eventRegistrations_.forEach(i=>{const o=i.createCancelEvent(t,s);o&&r.push(o)})}if(e){let s=[];for(let i=0;i<n.eventRegistrations_.length;++i){const o=n.eventRegistrations_[i];if(!o.matches(e))s.push(o);else if(e.hasAnyCallback()){s=s.concat(n.eventRegistrations_.slice(i+1));break}}n.eventRegistrations_=s}else n.eventRegistrations_=[];return r}function dT(n,e,t,r){e.type===Hr.MERGE&&e.source.queryId!==null&&(Y(ta(n.viewCache_),"We should always have a full cache before handling merges"),Y(pp(n.viewCache_),"Missing event cache, even though we have a server cache"));const s=n.viewCache_,i=JF(n.processor_,s,e,t,r);return YF(n.processor_,i.viewCache),Y(i.viewCache.serverCache.isFullyInitialized()||!s.serverCache.isFullyInitialized(),"Once a server snap is complete, it should never go back"),n.viewCache_=i.viewCache,QC(n,i.changes,i.viewCache.eventCache.getNode(),null)}function lj(n,e){const t=n.viewCache_.eventCache,r=[];return t.getNode().isLeafNode()||t.getNode().forEachChild(vt,(i,o)=>{r.push(Rl(i,o))}),t.isFullyInitialized()&&r.push(UC(t.getNode())),QC(n,r,t.getNode(),e)}function QC(n,e,t,r){const s=r?[r]:n.eventRegistrations_;return RF(n.eventGenerator_,e,t,s)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let _p;class YC{constructor(){this.views=new Map}}function cj(n){Y(!_p,"__referenceConstructor has already been defined"),_p=n}function uj(){return Y(_p,"Reference.ts has not been loaded"),_p}function dj(n){return n.views.size===0}function B0(n,e,t,r){const s=e.source.queryId;if(s!==null){const i=n.views.get(s);return Y(i!=null,"SyncTree gave us an op for an invalid query."),dT(i,e,t,r)}else{let i=[];for(const o of n.views.values())i=i.concat(dT(o,e,t,r));return i}}function JC(n,e,t,r,s){const i=e._queryIdentifier,o=n.views.get(i);if(!o){let a=mp(t,s?r:null),l=!1;a?l=!0:r instanceof ye?(a=F0(t,r),l=!1):(a=ye.EMPTY_NODE,l=!1);const u=hm(new Ji(a,l,!1),new Ji(r,s,!1));return new rj(e,u)}return o}function hj(n,e,t,r,s,i){const o=JC(n,e,r,s,i);return n.views.has(e._queryIdentifier)||n.views.set(e._queryIdentifier,o),aj(o,t),lj(o,t)}function fj(n,e,t,r){const s=e._queryIdentifier,i=[];let o=[];const a=Xi(n);if(s==="default")for(const[l,u]of n.views.entries())o=o.concat(uT(u,t,r)),cT(u)&&(n.views.delete(l),u.query._queryParams.loadsAllData()||i.push(u.query));else{const l=n.views.get(s);l&&(o=o.concat(uT(l,t,r)),cT(l)&&(n.views.delete(s),l.query._queryParams.loadsAllData()||i.push(l.query)))}return a&&!Xi(n)&&i.push(new(uj())(e._repo,e._path)),{removed:i,events:o}}function XC(n){const e=[];for(const t of n.views.values())t.query._queryParams.loadsAllData()||e.push(t);return e}function zi(n,e){let t=null;for(const r of n.views.values())t=t||oj(r,e);return t}function ZC(n,e){if(e._queryParams.loadsAllData())return pm(n);{const r=e._queryIdentifier;return n.views.get(r)}}function eR(n,e){return ZC(n,e)!=null}function Xi(n){return pm(n)!=null}function pm(n){for(const e of n.views.values())if(e.query._queryParams.loadsAllData())return e;return null}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let vp;function pj(n){Y(!vp,"__referenceConstructor has already been defined"),vp=n}function mj(){return Y(vp,"Reference.ts has not been loaded"),vp}let gj=1;class hT{constructor(e){this.listenProvider_=e,this.syncPointTree_=new yt(null),this.pendingWriteTree_=WF(),this.tagToQueryMap=new Map,this.queryToTagMap=new Map}}function $0(n,e,t,r,s){return DF(n.pendingWriteTree_,e,t,r,s),s?oc(n,new ea(M0(),e,t)):[]}function yj(n,e,t,r){OF(n.pendingWriteTree_,e,t,r);const s=yt.fromObject(t);return oc(n,new Nl(M0(),e,s))}function Ai(n,e,t=!1){const r=MF(n.pendingWriteTree_,e);if(LF(n.pendingWriteTree_,e)){let i=new yt(null);return r.snap!=null?i=i.set(Ze(),!0):mn(r.children,o=>{i=i.set(new nt(o),!0)}),oc(n,new fp(r.path,i,t))}else return[]}function Ld(n,e,t){return oc(n,new ea(L0(),e,t))}function _j(n,e,t){const r=yt.fromObject(t);return oc(n,new Nl(L0(),e,r))}function vj(n,e){return oc(n,new rd(L0(),e))}function wj(n,e,t){const r=z0(n,t);if(r){const s=q0(r),i=s.path,o=s.queryId,a=Un(i,e),l=new rd(V0(o),a);return W0(n,i,l)}else return[]}function wp(n,e,t,r,s=!1){const i=e._path,o=n.syncPointTree_.get(i);let a=[];if(o&&(e._queryIdentifier==="default"||eR(o,e))){const l=fj(o,e,t,r);dj(o)&&(n.syncPointTree_=n.syncPointTree_.remove(i));const u=l.removed;if(a=l.events,!s){const h=u.findIndex(p=>p._queryParams.loadsAllData())!==-1,f=n.syncPointTree_.findOnPath(i,(p,y)=>Xi(y));if(h&&!f){const p=n.syncPointTree_.subtree(i);if(!p.isEmpty()){const y=xj(p);for(let I=0;I<y.length;++I){const C=y[I],P=C.query,A=sR(n,C);n.listenProvider_.startListening(vu(P),sd(n,P),A.hashFn,A.onComplete)}}}!f&&u.length>0&&!r&&(h?n.listenProvider_.stopListening(vu(e),null):u.forEach(p=>{const y=n.queryToTagMap.get(gm(p));n.listenProvider_.stopListening(vu(p),y)}))}Tj(n,u)}return a}function tR(n,e,t,r){const s=z0(n,r);if(s!=null){const i=q0(s),o=i.path,a=i.queryId,l=Un(o,e),u=new ea(V0(a),l,t);return W0(n,o,u)}else return[]}function Ij(n,e,t,r){const s=z0(n,r);if(s){const i=q0(s),o=i.path,a=i.queryId,l=Un(o,e),u=yt.fromObject(t),h=new Nl(V0(a),l,u);return W0(n,o,h)}else return[]}function B_(n,e,t,r=!1){const s=e._path;let i=null,o=!1;n.syncPointTree_.foreachOnPath(s,(p,y)=>{const I=Un(p,s);i=i||zi(y,I),o=o||Xi(y)});let a=n.syncPointTree_.get(s);a?(o=o||Xi(a),i=i||zi(a,Ze())):(a=new YC,n.syncPointTree_=n.syncPointTree_.set(s,a));let l;i!=null?l=!0:(l=!1,i=ye.EMPTY_NODE,n.syncPointTree_.subtree(s).foreachChild((y,I)=>{const C=zi(I,Ze());C&&(i=i.updateImmediateChild(y,C))}));const u=eR(a,e);if(!u&&!e._queryParams.loadsAllData()){const p=gm(e);Y(!n.queryToTagMap.has(p),"View does not exist, but we have a tag");const y=Sj();n.queryToTagMap.set(p,y),n.tagToQueryMap.set(y,p)}const h=fm(n.pendingWriteTree_,s);let f=hj(a,e,t,h,i,l);if(!u&&!o&&!r){const p=ZC(a,e);f=f.concat(bj(n,e,p))}return f}function mm(n,e,t){const s=n.pendingWriteTree_,i=n.syncPointTree_.findOnPath(e,(o,a)=>{const l=Un(o,e),u=zi(a,l);if(u)return u});return qC(s,e,i,t,!0)}function Ej(n,e){const t=e._path;let r=null;n.syncPointTree_.foreachOnPath(t,(u,h)=>{const f=Un(u,t);r=r||zi(h,f)});let s=n.syncPointTree_.get(t);s?r=r||zi(s,Ze()):(s=new YC,n.syncPointTree_=n.syncPointTree_.set(t,s));const i=r!=null,o=i?new Ji(r,!0,!1):null,a=fm(n.pendingWriteTree_,e._path),l=JC(s,e,a,i?o.getNode():ye.EMPTY_NODE,i);return ij(l)}function oc(n,e){return nR(e,n.syncPointTree_,null,fm(n.pendingWriteTree_,Ze()))}function nR(n,e,t,r){if(De(n.path))return rR(n,e,t,r);{const s=e.get(Ze());t==null&&s!=null&&(t=zi(s,Ze()));let i=[];const o=ke(n.path),a=n.operationForChild(o),l=e.children.get(o);if(l&&a){const u=t?t.getImmediateChild(o):null,h=WC(r,o);i=i.concat(nR(a,l,u,h))}return s&&(i=i.concat(B0(s,n,r,t))),i}}function rR(n,e,t,r){const s=e.get(Ze());t==null&&s!=null&&(t=zi(s,Ze()));let i=[];return e.children.inorderTraversal((o,a)=>{const l=t?t.getImmediateChild(o):null,u=WC(r,o),h=n.operationForChild(o);h&&(i=i.concat(rR(h,a,l,u)))}),s&&(i=i.concat(B0(s,n,r,t))),i}function sR(n,e){const t=e.query,r=sd(n,t);return{hashFn:()=>(sj(e)||ye.EMPTY_NODE).hash(),onComplete:s=>{if(s==="ok")return r?wj(n,t._path,r):vj(n,t._path);{const i=yV(s,t);return wp(n,t,null,i)}}}}function sd(n,e){const t=gm(e);return n.queryToTagMap.get(t)}function gm(n){return n._path.toString()+"$"+n._queryIdentifier}function z0(n,e){return n.tagToQueryMap.get(e)}function q0(n){const e=n.indexOf("$");return Y(e!==-1&&e<n.length-1,"Bad queryKey."),{queryId:n.substr(e+1),path:new nt(n.substr(0,e))}}function W0(n,e,t){const r=n.syncPointTree_.get(e);Y(r,"Missing sync point for query tag that we're tracking");const s=fm(n.pendingWriteTree_,e);return B0(r,t,s,null)}function xj(n){return n.fold((e,t,r)=>{if(t&&Xi(t))return[pm(t)];{let s=[];return t&&(s=XC(t)),mn(r,(i,o)=>{s=s.concat(o)}),s}})}function vu(n){return n._queryParams.loadsAllData()&&!n._queryParams.isDefault()?new(mj())(n._repo,n._path):n}function Tj(n,e){for(let t=0;t<e.length;++t){const r=e[t];if(!r._queryParams.loadsAllData()){const s=gm(r),i=n.queryToTagMap.get(s);n.queryToTagMap.delete(s),n.tagToQueryMap.delete(i)}}}function Sj(){return gj++}function bj(n,e,t){const r=e._path,s=sd(n,e),i=sR(n,t),o=n.listenProvider_.startListening(vu(e),s,i.hashFn,i.onComplete),a=n.syncPointTree_.subtree(r);if(s)Y(!Xi(a.value),"If we're adding a query, it shouldn't be shadowed");else{const l=a.fold((u,h,f)=>{if(!De(u)&&h&&Xi(h))return[pm(h).query];{let p=[];return h&&(p=p.concat(XC(h).map(y=>y.query))),mn(f,(y,I)=>{p=p.concat(I)}),p}});for(let u=0;u<l.length;++u){const h=l[u];n.listenProvider_.stopListening(vu(h),sd(n,h))}}return o}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class G0{constructor(e){this.node_=e}getImmediateChild(e){const t=this.node_.getImmediateChild(e);return new G0(t)}node(){return this.node_}}class H0{constructor(e,t){this.syncTree_=e,this.path_=t}getImmediateChild(e){const t=kt(this.path_,e);return new H0(this.syncTree_,t)}node(){return mm(this.syncTree_,this.path_)}}const Aj=function(n){return n=n||{},n.timestamp=n.timestamp||new Date().getTime(),n},fT=function(n,e,t){if(!n||typeof n!="object")return n;if(Y(".sv"in n,"Unexpected leaf node or priority contents"),typeof n[".sv"]=="string")return Cj(n[".sv"],e,t);if(typeof n[".sv"]=="object")return Rj(n[".sv"],e);Y(!1,"Unexpected server value: "+JSON.stringify(n,null,2))},Cj=function(n,e,t){switch(n){case"timestamp":return t.timestamp;default:Y(!1,"Unexpected server value: "+n)}},Rj=function(n,e,t){n.hasOwnProperty("increment")||Y(!1,"Unexpected server value: "+JSON.stringify(n,null,2));const r=n.increment;typeof r!="number"&&Y(!1,"Unexpected increment value: "+r);const s=e.node();if(Y(s!==null&&typeof s<"u","Expected ChildrenNode.EMPTY_NODE for nulls"),!s.isLeafNode())return r;const o=s.getValue();return typeof o!="number"?r:o+r},iR=function(n,e,t,r){return Q0(e,new H0(t,n),r)},K0=function(n,e,t){return Q0(n,new G0(e),t)};function Q0(n,e,t){const r=n.getPriority().val(),s=fT(r,e.getImmediateChild(".priority"),t);let i;if(n.isLeafNode()){const o=n,a=fT(o.getValue(),e,t);return a!==o.getValue()||s!==o.getPriority().val()?new an(a,Lt(s)):n}else{const o=n;return i=o,s!==o.getPriority().val()&&(i=i.updatePriority(new an(s))),o.forEachChild(vt,(a,l)=>{const u=Q0(l,e.getImmediateChild(a),t);u!==l&&(i=i.updateImmediateChild(a,u))}),i}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Y0{constructor(e="",t=null,r={children:{},childCount:0}){this.name=e,this.parent=t,this.node=r}}function ym(n,e){let t=e instanceof nt?e:new nt(e),r=n,s=ke(t);for(;s!==null;){const i=Xo(r.node.children,s)||{children:{},childCount:0};r=new Y0(s,r,i),t=mt(t),s=ke(t)}return r}function Ea(n){return n.node.value}function J0(n,e){n.node.value=e,$_(n)}function oR(n){return n.node.childCount>0}function Nj(n){return Ea(n)===void 0&&!oR(n)}function _m(n,e){mn(n.node.children,(t,r)=>{e(new Y0(t,n,r))})}function aR(n,e,t,r){t&&!r&&e(n),_m(n,s=>{aR(s,e,!0,r)}),t&&r&&e(n)}function Pj(n,e,t){let r=t?n:n.parent;for(;r!==null;){if(e(r))return!0;r=r.parent}return!1}function Vd(n){return new nt(n.parent===null?n.name:Vd(n.parent)+"/"+n.name)}function $_(n){n.parent!==null&&kj(n.parent,n.name,n)}function kj(n,e,t){const r=Nj(t),s=ns(n.node.children,e);r&&s?(delete n.node.children[e],n.node.childCount--,$_(n)):!r&&!s&&(n.node.children[e]=t.node,n.node.childCount++,$_(n))}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Dj=/[\[\].#$\/\u0000-\u001F\u007F]/,Oj=/[\[\].#$\u0000-\u001F\u007F]/,ly=10*1024*1024,vm=function(n){return typeof n=="string"&&n.length!==0&&!Dj.test(n)},lR=function(n){return typeof n=="string"&&n.length!==0&&!Oj.test(n)},Mj=function(n){return n&&(n=n.replace(/^\/*\.info(\/|$)/,"/")),lR(n)},id=function(n){return n===null||typeof n=="string"||typeof n=="number"&&!cm(n)||n&&typeof n=="object"&&ns(n,".sv")},Ts=function(n,e,t,r){r&&e===void 0||Fd(Zo(n,"value"),e,t)},Fd=function(n,e,t){const r=t instanceof nt?new JV(t,n):t;if(e===void 0)throw new Error(n+"contains undefined "+bo(r));if(typeof e=="function")throw new Error(n+"contains a function "+bo(r)+" with contents = "+e.toString());if(cm(e))throw new Error(n+"contains "+e.toString()+" "+bo(r));if(typeof e=="string"&&e.length>ly/3&&lm(e)>ly)throw new Error(n+"contains a string greater than "+ly+" utf8 bytes "+bo(r)+" ('"+e.substring(0,50)+"...')");if(e&&typeof e=="object"){let s=!1,i=!1;if(mn(e,(o,a)=>{if(o===".value")s=!0;else if(o!==".priority"&&o!==".sv"&&(i=!0,!vm(o)))throw new Error(n+" contains an invalid key ("+o+") "+bo(r)+`.  Keys must be non-empty strings and can't contain ".", "#", "$", "/", "[", or "]"`);XV(r,o),Fd(n,a,r),ZV(r)}),s&&i)throw new Error(n+' contains ".value" child '+bo(r)+" in addition to actual children.")}},Lj=function(n,e){let t,r;for(t=0;t<e.length;t++){r=e[t];const i=Zu(r);for(let o=0;o<i.length;o++)if(!(i[o]===".priority"&&o===i.length-1)){if(!vm(i[o]))throw new Error(n+"contains an invalid key ("+i[o]+") in path "+r.toString()+`. Keys must be non-empty strings and can't contain ".", "#", "$", "/", "[", or "]"`)}}e.sort(YV);let s=null;for(t=0;t<e.length;t++){if(r=e[t],s!==null&&kr(s,r))throw new Error(n+"contains a path "+s.toString()+" that is ancestor of another path "+r.toString());s=r}},cR=function(n,e,t,r){if(r&&e===void 0)return;const s=Zo(n,"values");if(!(e&&typeof e=="object")||Array.isArray(e))throw new Error(s+" must be an object containing the children to replace.");const i=[];mn(e,(o,a)=>{const l=new nt(o);if(Fd(s,a,kt(t,l)),A0(l)===".priority"&&!id(a))throw new Error(s+"contains an invalid value for '"+l.toString()+"', which must be a valid Firebase priority (a string, finite number, server value, or null).");i.push(l)}),Lj(s,i)},X0=function(n,e,t){if(!(t&&e===void 0)){if(cm(e))throw new Error(Zo(n,"priority")+"is "+e.toString()+", but must be a valid Firebase priority (a string, finite number, server value, or null).");if(!id(e))throw new Error(Zo(n,"priority")+"must be a valid Firebase priority (a string, finite number, server value, or null).")}},jd=function(n,e,t,r){if(!(r&&t===void 0)&&!vm(t))throw new Error(Zo(n,e)+'was an invalid key = "'+t+`".  Firebase keys must be non-empty strings and can't contain ".", "#", "$", "/", "[", or "]").`)},Z0=function(n,e,t,r){if(!(r&&t===void 0)&&!lR(t))throw new Error(Zo(n,e)+'was an invalid path = "'+t+`". Paths must be non-empty strings and can't contain ".", "#", "$", "[", or "]"`)},Vj=function(n,e,t,r){t&&(t=t.replace(/^\/*\.info(\/|$)/,"/")),Z0(n,e,t,r)},hs=function(n,e){if(ke(e)===".info")throw new Error(n+" failed = Can't modify data under /.info/")},uR=function(n,e){const t=e.path.toString();if(typeof e.repoInfo.host!="string"||e.repoInfo.host.length===0||!vm(e.repoInfo.namespace)&&e.repoInfo.host.split(":")[0]!=="localhost"||t.length!==0&&!Mj(t))throw new Error(Zo(n,"url")+`must be a valid firebase URL and the path can't contain ".", "#", "$", "[", or "]".`)};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Fj{constructor(){this.eventLists_=[],this.recursionDepth_=0}}function wm(n,e){let t=null;for(let r=0;r<e.length;r++){const s=e[r],i=s.getPath();t!==null&&!C0(i,t.path)&&(n.eventLists_.push(t),t=null),t===null&&(t={events:[],path:i}),t.events.push(s)}t&&n.eventLists_.push(t)}function dR(n,e,t){wm(n,t),hR(n,r=>C0(r,e))}function Er(n,e,t){wm(n,t),hR(n,r=>kr(r,e)||kr(e,r))}function hR(n,e){n.recursionDepth_++;let t=!0;for(let r=0;r<n.eventLists_.length;r++){const s=n.eventLists_[r];if(s){const i=s.path;e(i)?(jj(n.eventLists_[r]),n.eventLists_[r]=null):t=!1}}t&&(n.eventLists_=[]),n.recursionDepth_--}function jj(n){for(let e=0;e<n.events.length;e++){const t=n.events[e];if(t!==null){n.events[e]=null;const r=t.getEventRunner();$o&&dn("event: "+t.toString()),sc(r)}}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const fR="repo_interrupt",Uj=25;class Bj{constructor(e,t,r,s){this.repoInfo_=e,this.forceRestClient_=t,this.authTokenProvider_=r,this.appCheckProvider_=s,this.dataUpdateCount=0,this.statsListener_=null,this.eventQueue_=new Fj,this.nextWriteId_=1,this.interceptServerDataCallback_=null,this.onDisconnect_=hp(),this.transactionQueueTree_=new Y0,this.persistentConnection_=null,this.key=this.repoInfo_.toURLString()}toString(){return(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host}}function $j(n,e,t){if(n.stats_=S0(n.repoInfo_),n.forceRestClient_||IV())n.server_=new dp(n.repoInfo_,(r,s,i,o)=>{pT(n,r,s,i,o)},n.authTokenProvider_,n.appCheckProvider_),setTimeout(()=>mT(n,!0),0);else{if(typeof t<"u"&&t!==null){if(typeof t!="object")throw new Error("Only objects are supported for option databaseAuthVariableOverride");try{en(t)}catch(r){throw new Error("Invalid authOverride provided: "+r)}}n.persistentConnection_=new Or(n.repoInfo_,e,(r,s,i,o)=>{pT(n,r,s,i,o)},r=>{mT(n,r)},r=>{zj(n,r)},n.authTokenProvider_,n.appCheckProvider_,t),n.server_=n.persistentConnection_}n.authTokenProvider_.addTokenChangeListener(r=>{n.server_.refreshAuthToken(r)}),n.appCheckProvider_.addTokenChangeListener(r=>{n.server_.refreshAppCheckToken(r.token)}),n.statsReporter_=bV(n.repoInfo_,()=>new AF(n.stats_,n.server_)),n.infoData_=new EF,n.infoSyncTree_=new hT({startListening:(r,s,i,o)=>{let a=[];const l=n.infoData_.getNode(r._path);return l.isEmpty()||(a=Ld(n.infoSyncTree_,r._path,l),setTimeout(()=>{o("ok")},0)),a},stopListening:()=>{}}),ew(n,"connected",!1),n.serverSyncTree_=new hT({startListening:(r,s,i,o)=>(n.server_.listen(r,i,s,(a,l)=>{const u=o(a,l);Er(n.eventQueue_,r._path,u)}),[]),stopListening:(r,s)=>{n.server_.unlisten(r,s)}})}function pR(n){const t=n.infoData_.getNode(new nt(".info/serverTimeOffset")).val()||0;return new Date().getTime()+t}function Ud(n){return Aj({timestamp:pR(n)})}function pT(n,e,t,r,s){n.dataUpdateCount++;const i=new nt(e);t=n.interceptServerDataCallback_?n.interceptServerDataCallback_(e,t):t;let o=[];if(s)if(r){const l=op(t,u=>Lt(u));o=Ij(n.serverSyncTree_,i,l,s)}else{const l=Lt(t);o=tR(n.serverSyncTree_,i,l,s)}else if(r){const l=op(t,u=>Lt(u));o=_j(n.serverSyncTree_,i,l)}else{const l=Lt(t);o=Ld(n.serverSyncTree_,i,l)}let a=i;o.length>0&&(a=kl(n,i)),Er(n.eventQueue_,a,o)}function mT(n,e){ew(n,"connected",e),e===!1&&Gj(n)}function zj(n,e){mn(e,(t,r)=>{ew(n,t,r)})}function ew(n,e,t){const r=new nt("/.info/"+e),s=Lt(t);n.infoData_.updateSnapshot(r,s);const i=Ld(n.infoSyncTree_,r,s);Er(n.eventQueue_,r,i)}function Im(n){return n.nextWriteId_++}function qj(n,e,t){const r=Ej(n.serverSyncTree_,e);return r!=null?Promise.resolve(r):n.server_.get(e).then(s=>{const i=Lt(s).withIndex(e._queryParams.getIndex());B_(n.serverSyncTree_,e,t,!0);let o;if(e._queryParams.loadsAllData())o=Ld(n.serverSyncTree_,e._path,i);else{const a=sd(n.serverSyncTree_,e);o=tR(n.serverSyncTree_,e._path,i,a)}return Er(n.eventQueue_,e._path,o),wp(n.serverSyncTree_,e,t,null,!0),i},s=>(ac(n,"get for query "+en(e)+" failed: "+s),Promise.reject(new Error(s))))}function tw(n,e,t,r,s){ac(n,"set",{path:e.toString(),value:t,priority:r});const i=Ud(n),o=Lt(t,r),a=mm(n.serverSyncTree_,e),l=K0(o,a,i),u=Im(n),h=$0(n.serverSyncTree_,e,l,u,!0);wm(n.eventQueue_,h),n.server_.put(e.toString(),o.val(!0),(p,y)=>{const I=p==="ok";I||Dn("set at "+e+" failed: "+p);const C=Ai(n.serverSyncTree_,u,!I);Er(n.eventQueue_,e,C),Zi(n,s,p,y)});const f=rw(n,e);kl(n,f),Er(n.eventQueue_,f,[])}function Wj(n,e,t,r){ac(n,"update",{path:e.toString(),value:t});let s=!0;const i=Ud(n),o={};if(mn(t,(a,l)=>{s=!1,o[a]=iR(kt(e,a),Lt(l),n.serverSyncTree_,i)}),s)dn("update() called with empty data.  Don't do anything."),Zi(n,r,"ok",void 0);else{const a=Im(n),l=yj(n.serverSyncTree_,e,o,a);wm(n.eventQueue_,l),n.server_.merge(e.toString(),t,(u,h)=>{const f=u==="ok";f||Dn("update at "+e+" failed: "+u);const p=Ai(n.serverSyncTree_,a,!f),y=p.length>0?kl(n,e):e;Er(n.eventQueue_,y,p),Zi(n,r,u,h)}),mn(t,u=>{const h=rw(n,kt(e,u));kl(n,h)}),Er(n.eventQueue_,e,[])}}function Gj(n){ac(n,"onDisconnectEvents");const e=Ud(n),t=hp();M_(n.onDisconnect_,Ze(),(s,i)=>{const o=iR(s,i,n.serverSyncTree_,e);ic(t,s,o)});let r=[];M_(t,Ze(),(s,i)=>{r=r.concat(Ld(n.serverSyncTree_,s,i));const o=rw(n,s);kl(n,o)}),n.onDisconnect_=hp(),Er(n.eventQueue_,Ze(),r)}function Hj(n,e,t){n.server_.onDisconnectCancel(e.toString(),(r,s)=>{r==="ok"&&O_(n.onDisconnect_,e),Zi(n,t,r,s)})}function gT(n,e,t,r){const s=Lt(t);n.server_.onDisconnectPut(e.toString(),s.val(!0),(i,o)=>{i==="ok"&&ic(n.onDisconnect_,e,s),Zi(n,r,i,o)})}function Kj(n,e,t,r,s){const i=Lt(t,r);n.server_.onDisconnectPut(e.toString(),i.val(!0),(o,a)=>{o==="ok"&&ic(n.onDisconnect_,e,i),Zi(n,s,o,a)})}function Qj(n,e,t,r){if(ip(t)){dn("onDisconnect().update() called with empty data.  Don't do anything."),Zi(n,r,"ok",void 0);return}n.server_.onDisconnectMerge(e.toString(),t,(s,i)=>{s==="ok"&&mn(t,(o,a)=>{const l=Lt(a);ic(n.onDisconnect_,kt(e,o),l)}),Zi(n,r,s,i)})}function Yj(n,e,t){let r;ke(e._path)===".info"?r=B_(n.infoSyncTree_,e,t):r=B_(n.serverSyncTree_,e,t),dR(n.eventQueue_,e._path,r)}function z_(n,e,t){let r;ke(e._path)===".info"?r=wp(n.infoSyncTree_,e,t):r=wp(n.serverSyncTree_,e,t),dR(n.eventQueue_,e._path,r)}function mR(n){n.persistentConnection_&&n.persistentConnection_.interrupt(fR)}function Jj(n){n.persistentConnection_&&n.persistentConnection_.resume(fR)}function ac(n,...e){let t="";n.persistentConnection_&&(t=n.persistentConnection_.id+":"),dn(t,...e)}function Zi(n,e,t,r){e&&sc(()=>{if(t==="ok")e(null);else{const s=(t||"error").toUpperCase();let i=s;r&&(i+=": "+r);const o=new Error(i);o.code=s,e(o)}})}function Xj(n,e,t,r,s,i){ac(n,"transaction on "+e);const o={path:e,update:t,onComplete:r,status:null,order:uC(),applyLocally:i,retryCount:0,unwatcher:s,abortReason:null,currentWriteId:null,currentInputSnapshot:null,currentOutputSnapshotRaw:null,currentOutputSnapshotResolved:null},a=nw(n,e,void 0);o.currentInputSnapshot=a;const l=o.update(a.val());if(l===void 0)o.unwatcher(),o.currentOutputSnapshotRaw=null,o.currentOutputSnapshotResolved=null,o.onComplete&&o.onComplete(null,!1,o.currentInputSnapshot);else{Fd("transaction failed: Data returned ",l,o.path),o.status=0;const u=ym(n.transactionQueueTree_,e),h=Ea(u)||[];h.push(o),J0(u,h);let f;typeof l=="object"&&l!==null&&ns(l,".priority")?(f=Xo(l,".priority"),Y(id(f),"Invalid priority returned by transaction. Priority must be a valid string, finite number, server value, or null.")):f=(mm(n.serverSyncTree_,e)||ye.EMPTY_NODE).getPriority().val();const p=Ud(n),y=Lt(l,f),I=K0(y,a,p);o.currentOutputSnapshotRaw=y,o.currentOutputSnapshotResolved=I,o.currentWriteId=Im(n);const C=$0(n.serverSyncTree_,e,I,o.currentWriteId,o.applyLocally);Er(n.eventQueue_,e,C),Em(n,n.transactionQueueTree_)}}function nw(n,e,t){return mm(n.serverSyncTree_,e,t)||ye.EMPTY_NODE}function Em(n,e=n.transactionQueueTree_){if(e||xm(n,e),Ea(e)){const t=yR(n,e);Y(t.length>0,"Sending zero length transaction queue"),t.every(s=>s.status===0)&&Zj(n,Vd(e),t)}else oR(e)&&_m(e,t=>{Em(n,t)})}function Zj(n,e,t){const r=t.map(u=>u.currentWriteId),s=nw(n,e,r);let i=s;const o=s.hash();for(let u=0;u<t.length;u++){const h=t[u];Y(h.status===0,"tryToSendTransactionQueue_: items in queue should all be run."),h.status=1,h.retryCount++;const f=Un(e,h.path);i=i.updateChild(f,h.currentOutputSnapshotRaw)}const a=i.val(!0),l=e;n.server_.put(l.toString(),a,u=>{ac(n,"transaction put response",{path:l.toString(),status:u});let h=[];if(u==="ok"){const f=[];for(let p=0;p<t.length;p++)t[p].status=2,h=h.concat(Ai(n.serverSyncTree_,t[p].currentWriteId)),t[p].onComplete&&f.push(()=>t[p].onComplete(null,!0,t[p].currentOutputSnapshotResolved)),t[p].unwatcher();xm(n,ym(n.transactionQueueTree_,e)),Em(n,n.transactionQueueTree_),Er(n.eventQueue_,e,h);for(let p=0;p<f.length;p++)sc(f[p])}else{if(u==="datastale")for(let f=0;f<t.length;f++)t[f].status===3?t[f].status=4:t[f].status=0;else{Dn("transaction at "+l.toString()+" failed: "+u);for(let f=0;f<t.length;f++)t[f].status=4,t[f].abortReason=u}kl(n,e)}},o)}function kl(n,e){const t=gR(n,e),r=Vd(t),s=yR(n,t);return e4(n,s,r),r}function e4(n,e,t){if(e.length===0)return;const r=[];let s=[];const o=e.filter(a=>a.status===0).map(a=>a.currentWriteId);for(let a=0;a<e.length;a++){const l=e[a],u=Un(t,l.path);let h=!1,f;if(Y(u!==null,"rerunTransactionsUnderNode_: relativePath should not be null."),l.status===4)h=!0,f=l.abortReason,s=s.concat(Ai(n.serverSyncTree_,l.currentWriteId,!0));else if(l.status===0)if(l.retryCount>=Uj)h=!0,f="maxretry",s=s.concat(Ai(n.serverSyncTree_,l.currentWriteId,!0));else{const p=nw(n,l.path,o);l.currentInputSnapshot=p;const y=e[a].update(p.val());if(y!==void 0){Fd("transaction failed: Data returned ",y,l.path);let I=Lt(y);typeof y=="object"&&y!=null&&ns(y,".priority")||(I=I.updatePriority(p.getPriority()));const P=l.currentWriteId,A=Ud(n),T=K0(I,p,A);l.currentOutputSnapshotRaw=I,l.currentOutputSnapshotResolved=T,l.currentWriteId=Im(n),o.splice(o.indexOf(P),1),s=s.concat($0(n.serverSyncTree_,l.path,T,l.currentWriteId,l.applyLocally)),s=s.concat(Ai(n.serverSyncTree_,P,!0))}else h=!0,f="nodata",s=s.concat(Ai(n.serverSyncTree_,l.currentWriteId,!0))}Er(n.eventQueue_,t,s),s=[],h&&(e[a].status=2,function(p){setTimeout(p,Math.floor(0))}(e[a].unwatcher),e[a].onComplete&&(f==="nodata"?r.push(()=>e[a].onComplete(null,!1,e[a].currentInputSnapshot)):r.push(()=>e[a].onComplete(new Error(f),!1,null))))}xm(n,n.transactionQueueTree_);for(let a=0;a<r.length;a++)sc(r[a]);Em(n,n.transactionQueueTree_)}function gR(n,e){let t,r=n.transactionQueueTree_;for(t=ke(e);t!==null&&Ea(r)===void 0;)r=ym(r,t),e=mt(e),t=ke(e);return r}function yR(n,e){const t=[];return _R(n,e,t),t.sort((r,s)=>r.order-s.order),t}function _R(n,e,t){const r=Ea(e);if(r)for(let s=0;s<r.length;s++)t.push(r[s]);_m(e,s=>{_R(n,s,t)})}function xm(n,e){const t=Ea(e);if(t){let r=0;for(let s=0;s<t.length;s++)t[s].status!==2&&(t[r]=t[s],r++);t.length=r,J0(e,t.length>0?t:void 0)}_m(e,r=>{xm(n,r)})}function rw(n,e){const t=Vd(gR(n,e)),r=ym(n.transactionQueueTree_,e);return Pj(r,s=>{cy(n,s)}),cy(n,r),aR(r,s=>{cy(n,s)}),t}function cy(n,e){const t=Ea(e);if(t){const r=[];let s=[],i=-1;for(let o=0;o<t.length;o++)t[o].status===3||(t[o].status===1?(Y(i===o-1,"All SENT items should be at beginning of queue."),i=o,t[o].status=3,t[o].abortReason="set"):(Y(t[o].status===0,"Unexpected transaction status in abort"),t[o].unwatcher(),s=s.concat(Ai(n.serverSyncTree_,t[o].currentWriteId,!0)),t[o].onComplete&&r.push(t[o].onComplete.bind(null,new Error("set"),!1,null))));i===-1?J0(e,void 0):t.length=i+1,Er(n.eventQueue_,Vd(e),s);for(let o=0;o<r.length;o++)sc(r[o])}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function t4(n){let e="";const t=n.split("/");for(let r=0;r<t.length;r++)if(t[r].length>0){let s=t[r];try{s=decodeURIComponent(s.replace(/\+/g," "))}catch{}e+="/"+s}return e}function n4(n){const e={};n.charAt(0)==="?"&&(n=n.substring(1));for(const t of n.split("&")){if(t.length===0)continue;const r=t.split("=");r.length===2?e[decodeURIComponent(r[0])]=decodeURIComponent(r[1]):Dn(`Invalid query segment '${t}' in query '${n}'`)}return e}const q_=function(n,e){const t=r4(n),r=t.namespace;t.domain==="firebase.com"&&xs(t.host+" is no longer supported. Please use <YOUR FIREBASE>.firebaseio.com instead"),(!r||r==="undefined")&&t.domain!=="localhost"&&xs("Cannot parse Firebase url. Please use https://<YOUR FIREBASE>.firebaseio.com"),t.secure||hV();const s=t.scheme==="ws"||t.scheme==="wss";return{repoInfo:new TC(t.host,t.secure,r,s,e,"",r!==t.subdomain),path:new nt(t.pathString)}},r4=function(n){let e="",t="",r="",s="",i="",o=!0,a="https",l=443;if(typeof n=="string"){let u=n.indexOf("//");u>=0&&(a=n.substring(0,u-1),n=n.substring(u+2));let h=n.indexOf("/");h===-1&&(h=n.length);let f=n.indexOf("?");f===-1&&(f=n.length),e=n.substring(0,Math.min(h,f)),h<f&&(s=t4(n.substring(h,f)));const p=n4(n.substring(Math.min(n.length,f)));u=e.indexOf(":"),u>=0?(o=a==="https"||a==="wss",l=parseInt(e.substring(u+1),10)):u=e.length;const y=e.slice(0,u);if(y.toLowerCase()==="localhost")t="localhost";else if(y.split(".").length<=2)t=y;else{const I=e.indexOf(".");r=e.substring(0,I).toLowerCase(),t=e.substring(I+1),i=r}"ns"in p&&(i=p.ns)}return{host:e,port:l,domain:t,subdomain:r,secure:o,scheme:a,pathString:s,namespace:i}};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const yT="-0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ_abcdefghijklmnopqrstuvwxyz",s4=function(){let n=0;const e=[];return function(t){const r=t===n;n=t;let s;const i=new Array(8);for(s=7;s>=0;s--)i[s]=yT.charAt(t%64),t=Math.floor(t/64);Y(t===0,"Cannot push at time == 0");let o=i.join("");if(r){for(s=11;s>=0&&e[s]===63;s--)e[s]=0;e[s]++}else for(s=0;s<12;s++)e[s]=Math.floor(Math.random()*64);for(s=0;s<12;s++)o+=yT.charAt(e[s]);return Y(o.length===20,"nextPushId: Length should be 20."),o}}();/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class vR{constructor(e,t,r,s){this.eventType=e,this.eventRegistration=t,this.snapshot=r,this.prevName=s}getPath(){const e=this.snapshot.ref;return this.eventType==="value"?e._path:e.parent._path}getEventType(){return this.eventType}getEventRunner(){return this.eventRegistration.getEventRunner(this)}toString(){return this.getPath().toString()+":"+this.eventType+":"+en(this.snapshot.exportVal())}}class wR{constructor(e,t,r){this.eventRegistration=e,this.error=t,this.path=r}getPath(){return this.path}getEventType(){return"cancel"}getEventRunner(){return this.eventRegistration.getEventRunner(this)}toString(){return this.path.toString()+":cancel"}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class sw{constructor(e,t){this.snapshotCallback=e,this.cancelCallback=t}onValue(e,t){this.snapshotCallback.call(null,e,t)}onCancel(e){return Y(this.hasCancelCallback,"Raising a cancel event on a listener with no cancel callback"),this.cancelCallback.call(null,e)}get hasCancelCallback(){return!!this.cancelCallback}matches(e){return this.snapshotCallback===e.snapshotCallback||this.snapshotCallback.userCallback!==void 0&&this.snapshotCallback.userCallback===e.snapshotCallback.userCallback&&this.snapshotCallback.context===e.snapshotCallback.context}}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class i4{constructor(e,t){this._repo=e,this._path=t}cancel(){const e=new fr;return Hj(this._repo,this._path,e.wrapCallback(()=>{})),e.promise}remove(){hs("OnDisconnect.remove",this._path);const e=new fr;return gT(this._repo,this._path,null,e.wrapCallback(()=>{})),e.promise}set(e){hs("OnDisconnect.set",this._path),Ts("OnDisconnect.set",e,this._path,!1);const t=new fr;return gT(this._repo,this._path,e,t.wrapCallback(()=>{})),t.promise}setWithPriority(e,t){hs("OnDisconnect.setWithPriority",this._path),Ts("OnDisconnect.setWithPriority",e,this._path,!1),X0("OnDisconnect.setWithPriority",t,!1);const r=new fr;return Kj(this._repo,this._path,e,t,r.wrapCallback(()=>{})),r.promise}update(e){hs("OnDisconnect.update",this._path),cR("OnDisconnect.update",e,this._path,!1);const t=new fr;return Qj(this._repo,this._path,e,t.wrapCallback(()=>{})),t.promise}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class br{constructor(e,t,r,s){this._repo=e,this._path=t,this._queryParams=r,this._orderByCalled=s}get key(){return De(this._path)?null:A0(this._path)}get ref(){return new rs(this._repo,this._path)}get _queryIdentifier(){const e=nT(this._queryParams),t=x0(e);return t==="{}"?"default":t}get _queryObject(){return nT(this._queryParams)}isEqual(e){if(e=ne(e),!(e instanceof br))return!1;const t=this._repo===e._repo,r=C0(this._path,e._path),s=this._queryIdentifier===e._queryIdentifier;return t&&r&&s}toJSON(){return this.toString()}toString(){return this._repo.toString()+QV(this._path)}}function Tm(n,e){if(n._orderByCalled===!0)throw new Error(e+": You can't combine multiple orderBy calls.")}function uo(n){let e=null,t=null;if(n.hasStart()&&(e=n.getIndexStartValue()),n.hasEnd()&&(t=n.getIndexEndValue()),n.getIndex()===_s){const r="Query: When ordering by key, you may only pass one argument to startAt(), endAt(), or equalTo().",s="Query: When ordering by key, the argument passed to startAt(), startAfter(), endAt(), endBefore(), or equalTo() must be a string.";if(n.hasStart()){if(n.getIndexStartName()!==Qi)throw new Error(r);if(typeof e!="string")throw new Error(s)}if(n.hasEnd()){if(n.getIndexEndName()!==Ks)throw new Error(r);if(typeof t!="string")throw new Error(s)}}else if(n.getIndex()===vt){if(e!=null&&!id(e)||t!=null&&!id(t))throw new Error("Query: When ordering by priority, the first argument passed to startAt(), startAfter() endAt(), endBefore(), or equalTo() must be a valid priority value (null, a number, or a string).")}else if(Y(n.getIndex()instanceof P0||n.getIndex()===k0,"unknown index type."),e!=null&&typeof e=="object"||t!=null&&typeof t=="object")throw new Error("Query: First argument passed to startAt(), startAfter(), endAt(), endBefore(), or equalTo() cannot be an object.")}function Sm(n){if(n.hasStart()&&n.hasEnd()&&n.hasLimit()&&!n.hasAnchoredLimit())throw new Error("Query: Can't combine startAt(), startAfter(), endAt(), endBefore(), and limit(). Use limitToFirst() or limitToLast() instead.")}class rs extends br{constructor(e,t){super(e,t,new O0,!1)}get parent(){const e=DC(this._path);return e===null?null:new rs(this._repo,e)}get root(){let e=this;for(;e.parent!==null;)e=e.parent;return e}}class na{constructor(e,t,r){this._node=e,this.ref=t,this._index=r}get priority(){return this._node.getPriority().val()}get key(){return this.ref.key}get size(){return this._node.numChildren()}child(e){const t=new nt(e),r=Dl(this.ref,e);return new na(this._node.getChild(t),r,vt)}exists(){return!this._node.isEmpty()}exportVal(){return this._node.val(!0)}forEach(e){return this._node.isLeafNode()?!1:!!this._node.forEachChild(this._index,(r,s)=>e(new na(s,Dl(this.ref,r),vt)))}hasChild(e){const t=new nt(e);return!this._node.getChild(t).isEmpty()}hasChildren(){return this._node.isLeafNode()?!1:!this._node.isEmpty()}toJSON(){return this.exportVal()}val(){return this._node.val()}}function tt(n,e){return n=ne(n),n._checkNotDeleted("ref"),e!==void 0?Dl(n._root,e):n._root}function I8(n,e){n=ne(n),n._checkNotDeleted("refFromURL");const t=q_(e,n._repo.repoInfo_.nodeAdmin);uR("refFromURL",t);const r=t.repoInfo;return!n._repo.repoInfo_.isCustomHost()&&r.host!==n._repo.repoInfo_.host&&xs("refFromURL: Host name does not match the current database: (found "+r.host+" but expected "+n._repo.repoInfo_.host+")"),tt(n,t.path.toString())}function Dl(n,e){return n=ne(n),ke(n._path)===null?Vj("child","path",e,!1):Z0("child","path",e,!1),new rs(n._repo,kt(n._path,e))}function E8(n){return n=ne(n),new i4(n._repo,n._path)}function o4(n,e){n=ne(n),hs("push",n._path),Ts("push",e,n._path,!0);const t=pR(n._repo),r=s4(t),s=Dl(n,r),i=Dl(n,r);let o;return e!=null?o=Hn(i,e).then(()=>i):o=Promise.resolve(i),s.then=o.then.bind(o),s.catch=o.then.bind(o,void 0),s}function x8(n){return hs("remove",n._path),Hn(n,null)}function Hn(n,e){n=ne(n),hs("set",n._path),Ts("set",e,n._path,!1);const t=new fr;return tw(n._repo,n._path,e,null,t.wrapCallback(()=>{})),t.promise}function T8(n,e){n=ne(n),hs("setPriority",n._path),X0("setPriority",e,!1);const t=new fr;return tw(n._repo,kt(n._path,".priority"),e,null,t.wrapCallback(()=>{})),t.promise}function S8(n,e,t){if(hs("setWithPriority",n._path),Ts("setWithPriority",e,n._path,!1),X0("setWithPriority",t,!1),n.key===".length"||n.key===".keys")throw"setWithPriority failed: "+n.key+" is a read-only object.";const r=new fr;return tw(n._repo,n._path,e,t,r.wrapCallback(()=>{})),r.promise}function b8(n,e){cR("update",e,n._path,!1);const t=new fr;return Wj(n._repo,n._path,e,t.wrapCallback(()=>{})),t.promise}function on(n){n=ne(n);const e=new sw(()=>{}),t=new Bd(e);return qj(n._repo,n,t).then(r=>new na(r,new rs(n._repo,n._path),n._queryParams.getIndex()))}class Bd{constructor(e){this.callbackContext=e}respondsTo(e){return e==="value"}createEvent(e,t){const r=t._queryParams.getIndex();return new vR("value",this,new na(e.snapshotNode,new rs(t._repo,t._path),r))}getEventRunner(e){return e.getEventType()==="cancel"?()=>this.callbackContext.onCancel(e.error):()=>this.callbackContext.onValue(e.snapshot,null)}createCancelEvent(e,t){return this.callbackContext.hasCancelCallback?new wR(this,e,t):null}matches(e){return e instanceof Bd?!e.callbackContext||!this.callbackContext?!0:e.callbackContext.matches(this.callbackContext):!1}hasAnyCallback(){return this.callbackContext!==null}}class bm{constructor(e,t){this.eventType=e,this.callbackContext=t}respondsTo(e){let t=e==="children_added"?"child_added":e;return t=t==="children_removed"?"child_removed":t,this.eventType===t}createCancelEvent(e,t){return this.callbackContext.hasCancelCallback?new wR(this,e,t):null}createEvent(e,t){Y(e.childName!=null,"Child events should have a childName.");const r=Dl(new rs(t._repo,t._path),e.childName),s=t._queryParams.getIndex();return new vR(e.type,this,new na(e.snapshotNode,r,s),e.prevName)}getEventRunner(e){return e.getEventType()==="cancel"?()=>this.callbackContext.onCancel(e.error):()=>this.callbackContext.onValue(e.snapshot,e.prevName)}matches(e){return e instanceof bm?this.eventType===e.eventType&&(!this.callbackContext||!e.callbackContext||this.callbackContext.matches(e.callbackContext)):!1}hasAnyCallback(){return!!this.callbackContext}}function $d(n,e,t,r,s){let i;if(typeof r=="object"&&(i=void 0,s=r),typeof r=="function"&&(i=r),s&&s.onlyOnce){const l=t,u=(h,f)=>{z_(n._repo,n,a),l(h,f)};u.userCallback=t.userCallback,u.context=t.context,t=u}const o=new sw(t,i||void 0),a=e==="value"?new Bd(o):new bm(e,o);return Yj(n._repo,n,a),()=>z_(n._repo,n,a)}function a4(n,e,t,r){return $d(n,"value",e,t,r)}function A8(n,e,t,r){return $d(n,"child_added",e,t,r)}function C8(n,e,t,r){return $d(n,"child_changed",e,t,r)}function R8(n,e,t,r){return $d(n,"child_moved",e,t,r)}function N8(n,e,t,r){return $d(n,"child_removed",e,t,r)}function P8(n,e,t){let r=null;const s=t?new sw(t):null;e==="value"?r=new Bd(s):e&&(r=new bm(e,s)),z_(n._repo,n,r)}let ss=class{},IR=class extends ss{constructor(e,t){super(),this._value=e,this._key=t,this.type="endAt"}_apply(e){Ts("endAt",this._value,e._path,!0);const t=D_(e._queryParams,this._value,this._key);if(Sm(t),uo(t),e._queryParams.hasEnd())throw new Error("endAt: Starting point was already set (by another call to endAt, endBefore or equalTo).");return new br(e._repo,e._path,t,e._orderByCalled)}};function O8(n,e){return jd("endAt","key",e,!0),new IR(n,e)}class l4 extends ss{constructor(e,t){super(),this._value=e,this._key=t,this.type="endBefore"}_apply(e){Ts("endBefore",this._value,e._path,!1);const t=IF(e._queryParams,this._value,this._key);if(Sm(t),uo(t),e._queryParams.hasEnd())throw new Error("endBefore: Starting point was already set (by another call to endAt, endBefore or equalTo).");return new br(e._repo,e._path,t,e._orderByCalled)}}function M8(n,e){return jd("endBefore","key",e,!0),new l4(n,e)}let ER=class extends ss{constructor(e,t){super(),this._value=e,this._key=t,this.type="startAt"}_apply(e){Ts("startAt",this._value,e._path,!0);const t=k_(e._queryParams,this._value,this._key);if(Sm(t),uo(t),e._queryParams.hasStart())throw new Error("startAt: Starting point was already set (by another call to startAt, startBefore or equalTo).");return new br(e._repo,e._path,t,e._orderByCalled)}};function V8(n=null,e){return jd("startAt","key",e,!0),new ER(n,e)}class c4 extends ss{constructor(e,t){super(),this._value=e,this._key=t,this.type="startAfter"}_apply(e){Ts("startAfter",this._value,e._path,!1);const t=wF(e._queryParams,this._value,this._key);if(Sm(t),uo(t),e._queryParams.hasStart())throw new Error("startAfter: Starting point was already set (by another call to startAt, startAfter, or equalTo).");return new br(e._repo,e._path,t,e._orderByCalled)}}function F8(n,e){return jd("startAfter","key",e,!0),new c4(n,e)}class u4 extends ss{constructor(e){super(),this._limit=e,this.type="limitToFirst"}_apply(e){if(e._queryParams.hasLimit())throw new Error("limitToFirst: Limit was already set (by another call to limitToFirst or limitToLast).");return new br(e._repo,e._path,_F(e._queryParams,this._limit),e._orderByCalled)}}function j8(n){if(typeof n!="number"||Math.floor(n)!==n||n<=0)throw new Error("limitToFirst: First argument must be a positive integer.");return new u4(n)}class d4 extends ss{constructor(e){super(),this._limit=e,this.type="limitToLast"}_apply(e){if(e._queryParams.hasLimit())throw new Error("limitToLast: Limit was already set (by another call to limitToFirst or limitToLast).");return new br(e._repo,e._path,vF(e._queryParams,this._limit),e._orderByCalled)}}function U8(n){if(typeof n!="number"||Math.floor(n)!==n||n<=0)throw new Error("limitToLast: First argument must be a positive integer.");return new d4(n)}class h4 extends ss{constructor(e){super(),this._path=e,this.type="orderByChild"}_apply(e){Tm(e,"orderByChild");const t=new nt(this._path);if(De(t))throw new Error("orderByChild: cannot pass in empty path. Use orderByValue() instead.");const r=new P0(t),s=dm(e._queryParams,r);return uo(s),new br(e._repo,e._path,s,!0)}}function B8(n){if(n==="$key")throw new Error('orderByChild: "$key" is invalid.  Use orderByKey() instead.');if(n==="$priority")throw new Error('orderByChild: "$priority" is invalid.  Use orderByPriority() instead.');if(n==="$value")throw new Error('orderByChild: "$value" is invalid.  Use orderByValue() instead.');return Z0("orderByChild","path",n,!1),new h4(n)}class f4 extends ss{constructor(){super(...arguments),this.type="orderByKey"}_apply(e){Tm(e,"orderByKey");const t=dm(e._queryParams,_s);return uo(t),new br(e._repo,e._path,t,!0)}}function $8(){return new f4}class p4 extends ss{constructor(){super(...arguments),this.type="orderByPriority"}_apply(e){Tm(e,"orderByPriority");const t=dm(e._queryParams,vt);return uo(t),new br(e._repo,e._path,t,!0)}}function z8(){return new p4}class m4 extends ss{constructor(){super(...arguments),this.type="orderByValue"}_apply(e){Tm(e,"orderByValue");const t=dm(e._queryParams,k0);return uo(t),new br(e._repo,e._path,t,!0)}}function q8(){return new m4}class g4 extends ss{constructor(e,t){super(),this._value=e,this._key=t,this.type="equalTo"}_apply(e){if(Ts("equalTo",this._value,e._path,!1),e._queryParams.hasStart())throw new Error("equalTo: Starting point was already set (by another call to startAt/startAfter or equalTo).");if(e._queryParams.hasEnd())throw new Error("equalTo: Ending point was already set (by another call to endAt/endBefore or equalTo).");return new IR(this._value,this._key)._apply(new ER(this._value,this._key)._apply(e))}}function W8(n,e){return jd("equalTo","key",e,!0),new g4(n,e)}function G8(n,...e){let t=ne(n);for(const r of e)t=r._apply(t);return t}cj(rs);pj(rs);/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const y4="FIREBASE_DATABASE_EMULATOR_HOST",W_={};let xR=!1;function _4(n,e,t,r){const s=e.lastIndexOf(":"),i=e.substring(0,s),o=ti(i);n.repoInfo_=new TC(e,o,n.repoInfo_.namespace,n.repoInfo_.webSocketOnly,n.repoInfo_.nodeAdmin,n.repoInfo_.persistenceKey,n.repoInfo_.includeNamespaceInQueryParams,!0,t),r&&(n.authTokenProvider_=r)}function TR(n,e,t,r,s){let i=r||n.options.databaseURL;i===void 0&&(n.options.projectId||xs("Can't determine Firebase Database URL. Be sure to include  a Project ID when calling firebase.initializeApp()."),dn("Using default host for project ",n.options.projectId),i=`${n.options.projectId}-default-rtdb.firebaseio.com`);let o=q_(i,s),a=o.repoInfo,l,u;typeof process<"u"&&process.env&&(u=process.env[y4]),u?(l=!0,i=`http://${u}?ns=${a.namespace}`,o=q_(i,s),a=o.repoInfo):l=!o.repoInfo.secure;const h=s&&l?new fl(fl.OWNER):new xV(n.name,n.options,e);uR("Invalid Firebase Database URL",o),De(o.path)||xs("Database URL must point to the root of a Firebase Database (not including a child path).");const f=w4(a,n,h,new EV(n,t));return new E4(f,n)}function v4(n,e){const t=W_[e];(!t||t[n.key]!==n)&&xs(`Database ${e}(${n.repoInfo_}) has already been deleted.`),mR(n),delete t[n.key]}function w4(n,e,t,r){let s=W_[e.name];s||(s={},W_[e.name]=s);let i=s[n.toURLString()];return i&&xs("Database initialized multiple times. Please make sure the format of the database URL matches with each database() call."),i=new Bj(n,xR,t,r),s[n.toURLString()]=i,i}function I4(n){xR=n}class E4{constructor(e,t){this._repoInternal=e,this.app=t,this.type="database",this._instanceStarted=!1}get _repo(){return this._instanceStarted||($j(this._repoInternal,this.app.options.appId,this.app.options.databaseAuthVariableOverride),this._instanceStarted=!0),this._repoInternal}get _root(){return this._rootInternal||(this._rootInternal=new rs(this._repo,Ze())),this._rootInternal}_delete(){return this._rootInternal!==null&&(v4(this._repo,this.app.name),this._repoInternal=null,this._rootInternal=null),Promise.resolve()}_checkNotDeleted(e){this._rootInternal===null&&xs("Cannot call "+e+" on a deleted database.")}}function SR(){Cl.IS_TRANSPORT_INITIALIZED&&Dn("Transport has already been initialized. Please call this function before calling ref or setting up a listener")}function H8(){SR(),bi.forceDisallow()}function K8(){SR(),Nr.forceDisallow(),bi.forceAllow()}function x4(n=kd(),e){const t=bs(n,"database").getImmediate({identifier:e});if(!t._instanceStarted){const r=zA("database");r&&T4(t,...r)}return t}function T4(n,e,t,r={}){n=ne(n),n._checkNotDeleted("useEmulator");const s=`${e}:${t}`,i=n._repoInternal;if(n._instanceStarted){if(s===n._repoInternal.repoInfo_.host&&Ir(r,i.repoInfo_.emulatorOptions))return;xs("connectDatabaseEmulator() cannot initialize or alter the emulator configuration after the database instance has started.")}let o;if(i.repoInfo_.nodeAdmin)r.mockUserToken&&xs('mockUserToken is not supported by the Admin SDK. For client access with mock users, please use the "firebase" package instead of "firebase-admin".'),o=new fl(fl.OWNER);else if(r.mockUserToken){const a=typeof r.mockUserToken=="string"?r.mockUserToken:GA(r.mockUserToken,n.app.options.projectId);o=new fl(a)}ti(e)&&(om(e),_0("Database",!0)),_4(i,s,r,o)}function Q8(n){n=ne(n),n._checkNotDeleted("goOffline"),mR(n._repo)}function Y8(n){n=ne(n),n._checkNotDeleted("goOnline"),Jj(n._repo)}function J8(n,e){hC(n,e)}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function S4(n){lC(va),es(new sr("database",(e,{instanceIdentifier:t})=>{const r=e.getProvider("app").getImmediate(),s=e.getProvider("auth-internal"),i=e.getProvider("app-check-internal");return TR(r,s,i,t)},"PUBLIC").setMultipleInstances(!0)),nr(jx,Ux,n),nr(jx,Ux,"esm2020")}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const b4={".sv":"timestamp"};function X8(){return b4}function Z8(n){return{".sv":{increment:n}}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class A4{constructor(e,t){this.committed=e,this.snapshot=t}toJSON(){return{committed:this.committed,snapshot:this.snapshot.toJSON()}}}function e7(n,e,t){if(n=ne(n),hs("Reference.transaction",n._path),n.key===".length"||n.key===".keys")throw"Reference.transaction failed: "+n.key+" is a read-only object.";const r=(t==null?void 0:t.applyLocally)??!0,s=new fr,i=(a,l,u)=>{let h=null;a?s.reject(a):(h=new na(u,new rs(n._repo,n._path),vt),s.resolve(new A4(l,h)))},o=a4(n,()=>{});return Xj(n._repo,n._path,e,i,o,r),s.promise}Or.prototype.simpleListen=function(n,e){this.sendRequest("q",{p:n},e)};Or.prototype.echo=function(n,e){this.sendRequest("echo",{d:n},e)};const t7=function(n){const e=Or.prototype.put;return Or.prototype.put=function(t,r,s,i){i!==void 0&&(i=n()),e.call(this,t,r,s,i)},function(){Or.prototype.put=e}},n7=function(n){I4(n)};/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function r7({app:n,url:e,version:t,customAuthImpl:r,customAppCheckImpl:s,nodeAdmin:i=!1}){lC(t);const o=new eC("database-standalone"),a=new x_("auth-internal",o);let l;return s&&(l=new x_("app-check-internal",o),l.setComponent(new sr("app-check-internal",()=>s,"PRIVATE"))),a.setComponent(new sr("auth-internal",()=>r,"PRIVATE")),TR(n,a,l,e,i)}S4();var _T=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};/** @license
Copyright The Closure Library Authors.
SPDX-License-Identifier: Apache-2.0
*/var qi,bR;(function(){var n;/** @license

 Copyright The Closure Library Authors.
 SPDX-License-Identifier: Apache-2.0
*/function e(E,_){function b(){}b.prototype=_.prototype,E.D=_.prototype,E.prototype=new b,E.prototype.constructor=E,E.C=function(v,S,N){for(var w=Array(arguments.length-2),B=2;B<arguments.length;B++)w[B-2]=arguments[B];return _.prototype[S].apply(v,w)}}function t(){this.blockSize=-1}function r(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.B=Array(this.blockSize),this.o=this.h=0,this.s()}e(r,t),r.prototype.s=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.o=this.h=0};function s(E,_,b){b||(b=0);var v=Array(16);if(typeof _=="string")for(var S=0;16>S;++S)v[S]=_.charCodeAt(b++)|_.charCodeAt(b++)<<8|_.charCodeAt(b++)<<16|_.charCodeAt(b++)<<24;else for(S=0;16>S;++S)v[S]=_[b++]|_[b++]<<8|_[b++]<<16|_[b++]<<24;_=E.g[0],b=E.g[1],S=E.g[2];var N=E.g[3],w=_+(N^b&(S^N))+v[0]+3614090360&4294967295;_=b+(w<<7&4294967295|w>>>25),w=N+(S^_&(b^S))+v[1]+3905402710&4294967295,N=_+(w<<12&4294967295|w>>>20),w=S+(b^N&(_^b))+v[2]+606105819&4294967295,S=N+(w<<17&4294967295|w>>>15),w=b+(_^S&(N^_))+v[3]+3250441966&4294967295,b=S+(w<<22&4294967295|w>>>10),w=_+(N^b&(S^N))+v[4]+4118548399&4294967295,_=b+(w<<7&4294967295|w>>>25),w=N+(S^_&(b^S))+v[5]+1200080426&4294967295,N=_+(w<<12&4294967295|w>>>20),w=S+(b^N&(_^b))+v[6]+2821735955&4294967295,S=N+(w<<17&4294967295|w>>>15),w=b+(_^S&(N^_))+v[7]+4249261313&4294967295,b=S+(w<<22&4294967295|w>>>10),w=_+(N^b&(S^N))+v[8]+1770035416&4294967295,_=b+(w<<7&4294967295|w>>>25),w=N+(S^_&(b^S))+v[9]+2336552879&4294967295,N=_+(w<<12&4294967295|w>>>20),w=S+(b^N&(_^b))+v[10]+4294925233&4294967295,S=N+(w<<17&4294967295|w>>>15),w=b+(_^S&(N^_))+v[11]+2304563134&4294967295,b=S+(w<<22&4294967295|w>>>10),w=_+(N^b&(S^N))+v[12]+1804603682&4294967295,_=b+(w<<7&4294967295|w>>>25),w=N+(S^_&(b^S))+v[13]+4254626195&4294967295,N=_+(w<<12&4294967295|w>>>20),w=S+(b^N&(_^b))+v[14]+2792965006&4294967295,S=N+(w<<17&4294967295|w>>>15),w=b+(_^S&(N^_))+v[15]+1236535329&4294967295,b=S+(w<<22&4294967295|w>>>10),w=_+(S^N&(b^S))+v[1]+4129170786&4294967295,_=b+(w<<5&4294967295|w>>>27),w=N+(b^S&(_^b))+v[6]+3225465664&4294967295,N=_+(w<<9&4294967295|w>>>23),w=S+(_^b&(N^_))+v[11]+643717713&4294967295,S=N+(w<<14&4294967295|w>>>18),w=b+(N^_&(S^N))+v[0]+3921069994&4294967295,b=S+(w<<20&4294967295|w>>>12),w=_+(S^N&(b^S))+v[5]+3593408605&4294967295,_=b+(w<<5&4294967295|w>>>27),w=N+(b^S&(_^b))+v[10]+38016083&4294967295,N=_+(w<<9&4294967295|w>>>23),w=S+(_^b&(N^_))+v[15]+3634488961&4294967295,S=N+(w<<14&4294967295|w>>>18),w=b+(N^_&(S^N))+v[4]+3889429448&4294967295,b=S+(w<<20&4294967295|w>>>12),w=_+(S^N&(b^S))+v[9]+568446438&4294967295,_=b+(w<<5&4294967295|w>>>27),w=N+(b^S&(_^b))+v[14]+3275163606&4294967295,N=_+(w<<9&4294967295|w>>>23),w=S+(_^b&(N^_))+v[3]+4107603335&4294967295,S=N+(w<<14&4294967295|w>>>18),w=b+(N^_&(S^N))+v[8]+1163531501&4294967295,b=S+(w<<20&4294967295|w>>>12),w=_+(S^N&(b^S))+v[13]+2850285829&4294967295,_=b+(w<<5&4294967295|w>>>27),w=N+(b^S&(_^b))+v[2]+4243563512&4294967295,N=_+(w<<9&4294967295|w>>>23),w=S+(_^b&(N^_))+v[7]+1735328473&4294967295,S=N+(w<<14&4294967295|w>>>18),w=b+(N^_&(S^N))+v[12]+2368359562&4294967295,b=S+(w<<20&4294967295|w>>>12),w=_+(b^S^N)+v[5]+4294588738&4294967295,_=b+(w<<4&4294967295|w>>>28),w=N+(_^b^S)+v[8]+2272392833&4294967295,N=_+(w<<11&4294967295|w>>>21),w=S+(N^_^b)+v[11]+1839030562&4294967295,S=N+(w<<16&4294967295|w>>>16),w=b+(S^N^_)+v[14]+4259657740&4294967295,b=S+(w<<23&4294967295|w>>>9),w=_+(b^S^N)+v[1]+2763975236&4294967295,_=b+(w<<4&4294967295|w>>>28),w=N+(_^b^S)+v[4]+1272893353&4294967295,N=_+(w<<11&4294967295|w>>>21),w=S+(N^_^b)+v[7]+4139469664&4294967295,S=N+(w<<16&4294967295|w>>>16),w=b+(S^N^_)+v[10]+3200236656&4294967295,b=S+(w<<23&4294967295|w>>>9),w=_+(b^S^N)+v[13]+681279174&4294967295,_=b+(w<<4&4294967295|w>>>28),w=N+(_^b^S)+v[0]+3936430074&4294967295,N=_+(w<<11&4294967295|w>>>21),w=S+(N^_^b)+v[3]+3572445317&4294967295,S=N+(w<<16&4294967295|w>>>16),w=b+(S^N^_)+v[6]+76029189&4294967295,b=S+(w<<23&4294967295|w>>>9),w=_+(b^S^N)+v[9]+3654602809&4294967295,_=b+(w<<4&4294967295|w>>>28),w=N+(_^b^S)+v[12]+3873151461&4294967295,N=_+(w<<11&4294967295|w>>>21),w=S+(N^_^b)+v[15]+530742520&4294967295,S=N+(w<<16&4294967295|w>>>16),w=b+(S^N^_)+v[2]+3299628645&4294967295,b=S+(w<<23&4294967295|w>>>9),w=_+(S^(b|~N))+v[0]+4096336452&4294967295,_=b+(w<<6&4294967295|w>>>26),w=N+(b^(_|~S))+v[7]+1126891415&4294967295,N=_+(w<<10&4294967295|w>>>22),w=S+(_^(N|~b))+v[14]+2878612391&4294967295,S=N+(w<<15&4294967295|w>>>17),w=b+(N^(S|~_))+v[5]+4237533241&4294967295,b=S+(w<<21&4294967295|w>>>11),w=_+(S^(b|~N))+v[12]+1700485571&4294967295,_=b+(w<<6&4294967295|w>>>26),w=N+(b^(_|~S))+v[3]+2399980690&4294967295,N=_+(w<<10&4294967295|w>>>22),w=S+(_^(N|~b))+v[10]+4293915773&4294967295,S=N+(w<<15&4294967295|w>>>17),w=b+(N^(S|~_))+v[1]+2240044497&4294967295,b=S+(w<<21&4294967295|w>>>11),w=_+(S^(b|~N))+v[8]+1873313359&4294967295,_=b+(w<<6&4294967295|w>>>26),w=N+(b^(_|~S))+v[15]+4264355552&4294967295,N=_+(w<<10&4294967295|w>>>22),w=S+(_^(N|~b))+v[6]+2734768916&4294967295,S=N+(w<<15&4294967295|w>>>17),w=b+(N^(S|~_))+v[13]+1309151649&4294967295,b=S+(w<<21&4294967295|w>>>11),w=_+(S^(b|~N))+v[4]+4149444226&4294967295,_=b+(w<<6&4294967295|w>>>26),w=N+(b^(_|~S))+v[11]+3174756917&4294967295,N=_+(w<<10&4294967295|w>>>22),w=S+(_^(N|~b))+v[2]+718787259&4294967295,S=N+(w<<15&4294967295|w>>>17),w=b+(N^(S|~_))+v[9]+3951481745&4294967295,E.g[0]=E.g[0]+_&4294967295,E.g[1]=E.g[1]+(S+(w<<21&4294967295|w>>>11))&4294967295,E.g[2]=E.g[2]+S&4294967295,E.g[3]=E.g[3]+N&4294967295}r.prototype.u=function(E,_){_===void 0&&(_=E.length);for(var b=_-this.blockSize,v=this.B,S=this.h,N=0;N<_;){if(S==0)for(;N<=b;)s(this,E,N),N+=this.blockSize;if(typeof E=="string"){for(;N<_;)if(v[S++]=E.charCodeAt(N++),S==this.blockSize){s(this,v),S=0;break}}else for(;N<_;)if(v[S++]=E[N++],S==this.blockSize){s(this,v),S=0;break}}this.h=S,this.o+=_},r.prototype.v=function(){var E=Array((56>this.h?this.blockSize:2*this.blockSize)-this.h);E[0]=128;for(var _=1;_<E.length-8;++_)E[_]=0;var b=8*this.o;for(_=E.length-8;_<E.length;++_)E[_]=b&255,b/=256;for(this.u(E),E=Array(16),_=b=0;4>_;++_)for(var v=0;32>v;v+=8)E[b++]=this.g[_]>>>v&255;return E};function i(E,_){var b=a;return Object.prototype.hasOwnProperty.call(b,E)?b[E]:b[E]=_(E)}function o(E,_){this.h=_;for(var b=[],v=!0,S=E.length-1;0<=S;S--){var N=E[S]|0;v&&N==_||(b[S]=N,v=!1)}this.g=b}var a={};function l(E){return-128<=E&&128>E?i(E,function(_){return new o([_|0],0>_?-1:0)}):new o([E|0],0>E?-1:0)}function u(E){if(isNaN(E)||!isFinite(E))return f;if(0>E)return P(u(-E));for(var _=[],b=1,v=0;E>=b;v++)_[v]=E/b|0,b*=4294967296;return new o(_,0)}function h(E,_){if(E.length==0)throw Error("number format error: empty string");if(_=_||10,2>_||36<_)throw Error("radix out of range: "+_);if(E.charAt(0)=="-")return P(h(E.substring(1),_));if(0<=E.indexOf("-"))throw Error('number format error: interior "-" character');for(var b=u(Math.pow(_,8)),v=f,S=0;S<E.length;S+=8){var N=Math.min(8,E.length-S),w=parseInt(E.substring(S,S+N),_);8>N?(N=u(Math.pow(_,N)),v=v.j(N).add(u(w))):(v=v.j(b),v=v.add(u(w)))}return v}var f=l(0),p=l(1),y=l(16777216);n=o.prototype,n.m=function(){if(C(this))return-P(this).m();for(var E=0,_=1,b=0;b<this.g.length;b++){var v=this.i(b);E+=(0<=v?v:4294967296+v)*_,_*=4294967296}return E},n.toString=function(E){if(E=E||10,2>E||36<E)throw Error("radix out of range: "+E);if(I(this))return"0";if(C(this))return"-"+P(this).toString(E);for(var _=u(Math.pow(E,6)),b=this,v="";;){var S=D(b,_).g;b=A(b,S.j(_));var N=((0<b.g.length?b.g[0]:b.h)>>>0).toString(E);if(b=S,I(b))return N+v;for(;6>N.length;)N="0"+N;v=N+v}},n.i=function(E){return 0>E?0:E<this.g.length?this.g[E]:this.h};function I(E){if(E.h!=0)return!1;for(var _=0;_<E.g.length;_++)if(E.g[_]!=0)return!1;return!0}function C(E){return E.h==-1}n.l=function(E){return E=A(this,E),C(E)?-1:I(E)?0:1};function P(E){for(var _=E.g.length,b=[],v=0;v<_;v++)b[v]=~E.g[v];return new o(b,~E.h).add(p)}n.abs=function(){return C(this)?P(this):this},n.add=function(E){for(var _=Math.max(this.g.length,E.g.length),b=[],v=0,S=0;S<=_;S++){var N=v+(this.i(S)&65535)+(E.i(S)&65535),w=(N>>>16)+(this.i(S)>>>16)+(E.i(S)>>>16);v=w>>>16,N&=65535,w&=65535,b[S]=w<<16|N}return new o(b,b[b.length-1]&-2147483648?-1:0)};function A(E,_){return E.add(P(_))}n.j=function(E){if(I(this)||I(E))return f;if(C(this))return C(E)?P(this).j(P(E)):P(P(this).j(E));if(C(E))return P(this.j(P(E)));if(0>this.l(y)&&0>E.l(y))return u(this.m()*E.m());for(var _=this.g.length+E.g.length,b=[],v=0;v<2*_;v++)b[v]=0;for(v=0;v<this.g.length;v++)for(var S=0;S<E.g.length;S++){var N=this.i(v)>>>16,w=this.i(v)&65535,B=E.i(S)>>>16,Ee=E.i(S)&65535;b[2*v+2*S]+=w*Ee,T(b,2*v+2*S),b[2*v+2*S+1]+=N*Ee,T(b,2*v+2*S+1),b[2*v+2*S+1]+=w*B,T(b,2*v+2*S+1),b[2*v+2*S+2]+=N*B,T(b,2*v+2*S+2)}for(v=0;v<_;v++)b[v]=b[2*v+1]<<16|b[2*v];for(v=_;v<2*_;v++)b[v]=0;return new o(b,0)};function T(E,_){for(;(E[_]&65535)!=E[_];)E[_+1]+=E[_]>>>16,E[_]&=65535,_++}function R(E,_){this.g=E,this.h=_}function D(E,_){if(I(_))throw Error("division by zero");if(I(E))return new R(f,f);if(C(E))return _=D(P(E),_),new R(P(_.g),P(_.h));if(C(_))return _=D(E,P(_)),new R(P(_.g),_.h);if(30<E.g.length){if(C(E)||C(_))throw Error("slowDivide_ only works with positive integers.");for(var b=p,v=_;0>=v.l(E);)b=F(b),v=F(v);var S=k(b,1),N=k(v,1);for(v=k(v,2),b=k(b,2);!I(v);){var w=N.add(v);0>=w.l(E)&&(S=S.add(b),N=w),v=k(v,1),b=k(b,1)}return _=A(E,S.j(_)),new R(S,_)}for(S=f;0<=E.l(_);){for(b=Math.max(1,Math.floor(E.m()/_.m())),v=Math.ceil(Math.log(b)/Math.LN2),v=48>=v?1:Math.pow(2,v-48),N=u(b),w=N.j(_);C(w)||0<w.l(E);)b-=v,N=u(b),w=N.j(_);I(N)&&(N=p),S=S.add(N),E=A(E,w)}return new R(S,E)}n.A=function(E){return D(this,E).h},n.and=function(E){for(var _=Math.max(this.g.length,E.g.length),b=[],v=0;v<_;v++)b[v]=this.i(v)&E.i(v);return new o(b,this.h&E.h)},n.or=function(E){for(var _=Math.max(this.g.length,E.g.length),b=[],v=0;v<_;v++)b[v]=this.i(v)|E.i(v);return new o(b,this.h|E.h)},n.xor=function(E){for(var _=Math.max(this.g.length,E.g.length),b=[],v=0;v<_;v++)b[v]=this.i(v)^E.i(v);return new o(b,this.h^E.h)};function F(E){for(var _=E.g.length+1,b=[],v=0;v<_;v++)b[v]=E.i(v)<<1|E.i(v-1)>>>31;return new o(b,E.h)}function k(E,_){var b=_>>5;_%=32;for(var v=E.g.length-b,S=[],N=0;N<v;N++)S[N]=0<_?E.i(N+b)>>>_|E.i(N+b+1)<<32-_:E.i(N+b);return new o(S,E.h)}r.prototype.digest=r.prototype.v,r.prototype.reset=r.prototype.s,r.prototype.update=r.prototype.u,bR=r,o.prototype.add=o.prototype.add,o.prototype.multiply=o.prototype.j,o.prototype.modulo=o.prototype.A,o.prototype.compare=o.prototype.l,o.prototype.toNumber=o.prototype.m,o.prototype.toString=o.prototype.toString,o.prototype.getBits=o.prototype.i,o.fromNumber=u,o.fromString=h,qi=o}).apply(typeof _T<"u"?_T:typeof self<"u"?self:typeof window<"u"?window:{});var zh=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};/** @license
Copyright The Closure Library Authors.
SPDX-License-Identifier: Apache-2.0
*/var AR,eu,CR,yf,G_,RR,NR,PR;(function(){var n,e=typeof Object.defineProperties=="function"?Object.defineProperty:function(c,m,g){return c==Array.prototype||c==Object.prototype||(c[m]=g.value),c};function t(c){c=[typeof globalThis=="object"&&globalThis,c,typeof window=="object"&&window,typeof self=="object"&&self,typeof zh=="object"&&zh];for(var m=0;m<c.length;++m){var g=c[m];if(g&&g.Math==Math)return g}throw Error("Cannot find global object")}var r=t(this);function s(c,m){if(m)e:{var g=r;c=c.split(".");for(var x=0;x<c.length-1;x++){var O=c[x];if(!(O in g))break e;g=g[O]}c=c[c.length-1],x=g[c],m=m(x),m!=x&&m!=null&&e(g,c,{configurable:!0,writable:!0,value:m})}}function i(c,m){c instanceof String&&(c+="");var g=0,x=!1,O={next:function(){if(!x&&g<c.length){var U=g++;return{value:m(U,c[U]),done:!1}}return x=!0,{done:!0,value:void 0}}};return O[Symbol.iterator]=function(){return O},O}s("Array.prototype.values",function(c){return c||function(){return i(this,function(m,g){return g})}});/** @license

 Copyright The Closure Library Authors.
 SPDX-License-Identifier: Apache-2.0
*/var o=o||{},a=this||self;function l(c){var m=typeof c;return m=m!="object"?m:c?Array.isArray(c)?"array":m:"null",m=="array"||m=="object"&&typeof c.length=="number"}function u(c){var m=typeof c;return m=="object"&&c!=null||m=="function"}function h(c,m,g){return c.call.apply(c.bind,arguments)}function f(c,m,g){if(!c)throw Error();if(2<arguments.length){var x=Array.prototype.slice.call(arguments,2);return function(){var O=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(O,x),c.apply(m,O)}}return function(){return c.apply(m,arguments)}}function p(c,m,g){return p=Function.prototype.bind&&Function.prototype.bind.toString().indexOf("native code")!=-1?h:f,p.apply(null,arguments)}function y(c,m){var g=Array.prototype.slice.call(arguments,1);return function(){var x=g.slice();return x.push.apply(x,arguments),c.apply(this,x)}}function I(c,m){function g(){}g.prototype=m.prototype,c.aa=m.prototype,c.prototype=new g,c.prototype.constructor=c,c.Qb=function(x,O,U){for(var ee=Array(arguments.length-2),pt=2;pt<arguments.length;pt++)ee[pt-2]=arguments[pt];return m.prototype[O].apply(x,ee)}}function C(c){const m=c.length;if(0<m){const g=Array(m);for(let x=0;x<m;x++)g[x]=c[x];return g}return[]}function P(c,m){for(let g=1;g<arguments.length;g++){const x=arguments[g];if(l(x)){const O=c.length||0,U=x.length||0;c.length=O+U;for(let ee=0;ee<U;ee++)c[O+ee]=x[ee]}else c.push(x)}}class A{constructor(m,g){this.i=m,this.j=g,this.h=0,this.g=null}get(){let m;return 0<this.h?(this.h--,m=this.g,this.g=m.next,m.next=null):m=this.i(),m}}function T(c){return/^[\s\xa0]*$/.test(c)}function R(){var c=a.navigator;return c&&(c=c.userAgent)?c:""}function D(c){return D[" "](c),c}D[" "]=function(){};var F=R().indexOf("Gecko")!=-1&&!(R().toLowerCase().indexOf("webkit")!=-1&&R().indexOf("Edge")==-1)&&!(R().indexOf("Trident")!=-1||R().indexOf("MSIE")!=-1)&&R().indexOf("Edge")==-1;function k(c,m,g){for(const x in c)m.call(g,c[x],x,c)}function E(c,m){for(const g in c)m.call(void 0,c[g],g,c)}function _(c){const m={};for(const g in c)m[g]=c[g];return m}const b="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function v(c,m){let g,x;for(let O=1;O<arguments.length;O++){x=arguments[O];for(g in x)c[g]=x[g];for(let U=0;U<b.length;U++)g=b[U],Object.prototype.hasOwnProperty.call(x,g)&&(c[g]=x[g])}}function S(c){var m=1;c=c.split(":");const g=[];for(;0<m&&c.length;)g.push(c.shift()),m--;return c.length&&g.push(c.join(":")),g}function N(c){a.setTimeout(()=>{throw c},0)}function w(){var c=G;let m=null;return c.g&&(m=c.g,c.g=c.g.next,c.g||(c.h=null),m.next=null),m}class B{constructor(){this.h=this.g=null}add(m,g){const x=Ee.get();x.set(m,g),this.h?this.h.next=x:this.g=x,this.h=x}}var Ee=new A(()=>new le,c=>c.reset());class le{constructor(){this.next=this.g=this.h=null}set(m,g){this.h=m,this.g=g,this.next=null}reset(){this.next=this.g=this.h=null}}let Be,$=!1,G=new B,J=()=>{const c=a.Promise.resolve(void 0);Be=()=>{c.then(he)}};var he=()=>{for(var c;c=w();){try{c.h.call(c.g)}catch(g){N(g)}var m=Ee;m.j(c),100>m.h&&(m.h++,c.next=m.g,m.g=c)}$=!1};function pe(){this.s=this.s,this.C=this.C}pe.prototype.s=!1,pe.prototype.ma=function(){this.s||(this.s=!0,this.N())},pe.prototype.N=function(){if(this.C)for(;this.C.length;)this.C.shift()()};function Te(c,m){this.type=c,this.g=this.target=m,this.defaultPrevented=!1}Te.prototype.h=function(){this.defaultPrevented=!0};var dt=function(){if(!a.addEventListener||!Object.defineProperty)return!1;var c=!1,m=Object.defineProperty({},"passive",{get:function(){c=!0}});try{const g=()=>{};a.addEventListener("test",g,m),a.removeEventListener("test",g,m)}catch{}return c}();function At(c,m){if(Te.call(this,c?c.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,c){var g=this.type=c.type,x=c.changedTouches&&c.changedTouches.length?c.changedTouches[0]:null;if(this.target=c.target||c.srcElement,this.g=m,m=c.relatedTarget){if(F){e:{try{D(m.nodeName);var O=!0;break e}catch{}O=!1}O||(m=null)}}else g=="mouseover"?m=c.fromElement:g=="mouseout"&&(m=c.toElement);this.relatedTarget=m,x?(this.clientX=x.clientX!==void 0?x.clientX:x.pageX,this.clientY=x.clientY!==void 0?x.clientY:x.pageY,this.screenX=x.screenX||0,this.screenY=x.screenY||0):(this.clientX=c.clientX!==void 0?c.clientX:c.pageX,this.clientY=c.clientY!==void 0?c.clientY:c.pageY,this.screenX=c.screenX||0,this.screenY=c.screenY||0),this.button=c.button,this.key=c.key||"",this.ctrlKey=c.ctrlKey,this.altKey=c.altKey,this.shiftKey=c.shiftKey,this.metaKey=c.metaKey,this.pointerId=c.pointerId||0,this.pointerType=typeof c.pointerType=="string"?c.pointerType:xe[c.pointerType]||"",this.state=c.state,this.i=c,c.defaultPrevented&&At.aa.h.call(this)}}I(At,Te);var xe={2:"touch",3:"pen",4:"mouse"};At.prototype.h=function(){At.aa.h.call(this);var c=this.i;c.preventDefault?c.preventDefault():c.returnValue=!1};var Ke="closure_listenable_"+(1e6*Math.random()|0),Se=0;function ie(c,m,g,x,O){this.listener=c,this.proxy=null,this.src=m,this.type=g,this.capture=!!x,this.ha=O,this.key=++Se,this.da=this.fa=!1}function we(c){c.da=!0,c.listener=null,c.proxy=null,c.src=null,c.ha=null}function de(c){this.src=c,this.g={},this.h=0}de.prototype.add=function(c,m,g,x,O){var U=c.toString();c=this.g[U],c||(c=this.g[U]=[],this.h++);var ee=fe(c,m,x,O);return-1<ee?(m=c[ee],g||(m.fa=!1)):(m=new ie(m,this.src,U,!!x,O),m.fa=g,c.push(m)),m};function Ae(c,m){var g=m.type;if(g in c.g){var x=c.g[g],O=Array.prototype.indexOf.call(x,m,void 0),U;(U=0<=O)&&Array.prototype.splice.call(x,O,1),U&&(we(m),c.g[g].length==0&&(delete c.g[g],c.h--))}}function fe(c,m,g,x){for(var O=0;O<c.length;++O){var U=c[O];if(!U.da&&U.listener==m&&U.capture==!!g&&U.ha==x)return O}return-1}var Ce="closure_lm_"+(1e6*Math.random()|0),Qe={};function ht(c,m,g,x,O){if(x&&x.once)return Oe(c,m,g,x,O);if(Array.isArray(m)){for(var U=0;U<m.length;U++)ht(c,m[U],g,x,O);return null}return g=is(g),c&&c[Ke]?c.K(m,g,u(x)?!!x.capture:!!x,O):Ne(c,m,g,!1,x,O)}function Ne(c,m,g,x,O,U){if(!m)throw Error("Invalid event type");var ee=u(O)?!!O.capture:!!O,pt=Wn(c);if(pt||(c[Ce]=pt=new de(c)),g=pt.add(m,g,x,ee,U),g.proxy)return g;if(x=_e(),g.proxy=x,x.src=c,x.listener=g,c.addEventListener)dt||(O=ee),O===void 0&&(O=!1),c.addEventListener(m.toString(),x,O);else if(c.attachEvent)c.attachEvent(ar(m.toString()),x);else if(c.addListener&&c.removeListener)c.addListener(x);else throw Error("addEventListener and attachEvent are unavailable.");return g}function _e(){function c(g){return m.call(c.src,c.listener,g)}const m=jr;return c}function Oe(c,m,g,x,O){if(Array.isArray(m)){for(var U=0;U<m.length;U++)Oe(c,m[U],g,x,O);return null}return g=is(g),c&&c[Ke]?c.L(m,g,u(x)?!!x.capture:!!x,O):Ne(c,m,g,!0,x,O)}function at(c,m,g,x,O){if(Array.isArray(m))for(var U=0;U<m.length;U++)at(c,m[U],g,x,O);else x=u(x)?!!x.capture:!!x,g=is(g),c&&c[Ke]?(c=c.i,m=String(m).toString(),m in c.g&&(U=c.g[m],g=fe(U,g,x,O),-1<g&&(we(U[g]),Array.prototype.splice.call(U,g,1),U.length==0&&(delete c.g[m],c.h--)))):c&&(c=Wn(c))&&(m=c.g[m.toString()],c=-1,m&&(c=fe(m,g,x,O)),(g=-1<c?m[c]:null)&&Vn(g))}function Vn(c){if(typeof c!="number"&&c&&!c.da){var m=c.src;if(m&&m[Ke])Ae(m.i,c);else{var g=c.type,x=c.proxy;m.removeEventListener?m.removeEventListener(g,x,c.capture):m.detachEvent?m.detachEvent(ar(g),x):m.addListener&&m.removeListener&&m.removeListener(x),(g=Wn(m))?(Ae(g,c),g.h==0&&(g.src=null,m[Ce]=null)):we(c)}}}function ar(c){return c in Qe?Qe[c]:Qe[c]="on"+c}function jr(c,m){if(c.da)c=!0;else{m=new At(m,this);var g=c.listener,x=c.ha||c.src;c.fa&&Vn(c),c=g.call(x,m)}return c}function Wn(c){return c=c[Ce],c instanceof de?c:null}var Ar="__closure_events_fn_"+(1e9*Math.random()>>>0);function is(c){return typeof c=="function"?c:(c[Ar]||(c[Ar]=function(m){return c.handleEvent(m)}),c[Ar])}function Je(){pe.call(this),this.i=new de(this),this.M=this,this.F=null}I(Je,pe),Je.prototype[Ke]=!0,Je.prototype.removeEventListener=function(c,m,g,x){at(this,c,m,g,x)};function Xt(c,m){var g,x=c.F;if(x)for(g=[];x;x=x.F)g.push(x);if(c=c.M,x=m.type||m,typeof m=="string")m=new Te(m,c);else if(m instanceof Te)m.target=m.target||c;else{var O=m;m=new Te(x,c),v(m,O)}if(O=!0,g)for(var U=g.length-1;0<=U;U--){var ee=m.g=g[U];O=Sn(ee,x,!0,m)&&O}if(ee=m.g=c,O=Sn(ee,x,!0,m)&&O,O=Sn(ee,x,!1,m)&&O,g)for(U=0;U<g.length;U++)ee=m.g=g[U],O=Sn(ee,x,!1,m)&&O}Je.prototype.N=function(){if(Je.aa.N.call(this),this.i){var c=this.i,m;for(m in c.g){for(var g=c.g[m],x=0;x<g.length;x++)we(g[x]);delete c.g[m],c.h--}}this.F=null},Je.prototype.K=function(c,m,g,x){return this.i.add(String(c),m,!1,g,x)},Je.prototype.L=function(c,m,g,x){return this.i.add(String(c),m,!0,g,x)};function Sn(c,m,g,x){if(m=c.i.g[String(m)],!m)return!0;m=m.concat();for(var O=!0,U=0;U<m.length;++U){var ee=m[U];if(ee&&!ee.da&&ee.capture==g){var pt=ee.listener,vn=ee.ha||ee.src;ee.fa&&Ae(c.i,ee),O=pt.call(vn,x)!==!1&&O}}return O&&!x.defaultPrevented}function lr(c,m,g){if(typeof c=="function")g&&(c=p(c,g));else if(c&&typeof c.handleEvent=="function")c=p(c.handleEvent,c);else throw Error("Invalid listener argument");return 2147483647<Number(m)?-1:a.setTimeout(c,m||0)}function Ur(c){c.g=lr(()=>{c.g=null,c.i&&(c.i=!1,Ur(c))},c.l);const m=c.h;c.h=null,c.m.apply(null,m)}class _o extends pe{constructor(m,g){super(),this.m=m,this.l=g,this.h=null,this.i=!1,this.g=null}j(m){this.h=arguments,this.g?this.i=!0:Ur(this)}N(){super.N(),this.g&&(a.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function Gn(c){pe.call(this),this.h=c,this.g={}}I(Gn,pe);var As=[];function ch(c){k(c.g,function(m,g){this.g.hasOwnProperty(g)&&Vn(m)},c),c.g={}}Gn.prototype.N=function(){Gn.aa.N.call(this),ch(this)},Gn.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var wc=a.JSON.stringify,fg=a.JSON.parse,pg=class{stringify(c){return a.JSON.stringify(c,void 0)}parse(c){return a.JSON.parse(c,void 0)}};function j(){}j.prototype.h=null;function Q(c){return c.h||(c.h=c.i())}function W(){}var re={OPEN:"a",kb:"b",Ja:"c",wb:"d"};function ge(){Te.call(this,"d")}I(ge,Te);function Ie(){Te.call(this,"c")}I(Ie,Te);var Pe={},We=null;function $e(){return We=We||new Je}Pe.La="serverreachability";function Ge(c){Te.call(this,Pe.La,c)}I(Ge,Te);function lt(c){const m=$e();Xt(m,new Ge(m))}Pe.STAT_EVENT="statevent";function Ct(c,m){Te.call(this,Pe.STAT_EVENT,c),this.stat=m}I(Ct,Te);function ce(c){const m=$e();Xt(m,new Ct(m,c))}Pe.Ma="timingevent";function me(c,m){Te.call(this,Pe.Ma,c),this.size=m}I(me,Te);function ze(c,m){if(typeof c!="function")throw Error("Fn must not be null and must be a function");return a.setTimeout(function(){c()},m)}function ft(){this.g=!0}ft.prototype.xa=function(){this.g=!1};function yn(c,m,g,x,O,U){c.info(function(){if(c.g)if(U)for(var ee="",pt=U.split("&"),vn=0;vn<pt.length;vn++){var Xe=pt[vn].split("=");if(1<Xe.length){var bn=Xe[0];Xe=Xe[1];var An=bn.split("_");ee=2<=An.length&&An[1]=="type"?ee+(bn+"="+Xe+"&"):ee+(bn+"=redacted&")}}else ee=null;else ee=U;return"XMLHTTP REQ ("+x+") [attempt "+O+"]: "+m+`
`+g+`
`+ee})}function _n(c,m,g,x,O,U,ee){c.info(function(){return"XMLHTTP RESP ("+x+") [ attempt "+O+"]: "+m+`
`+g+`
`+U+" "+ee})}function ct(c,m,g,x){c.info(function(){return"XMLHTTP TEXT ("+m+"): "+Me(c,g)+(x?" "+x:"")})}function et(c,m){c.info(function(){return"TIMEOUT: "+m})}ft.prototype.info=function(){};function Me(c,m){if(!c.g)return m;if(!m)return null;try{var g=JSON.parse(m);if(g){for(c=0;c<g.length;c++)if(Array.isArray(g[c])){var x=g[c];if(!(2>x.length)){var O=x[1];if(Array.isArray(O)&&!(1>O.length)){var U=O[0];if(U!="noop"&&U!="stop"&&U!="close")for(var ee=1;ee<O.length;ee++)O[ee]=""}}}}return wc(g)}catch{return m}}var sn={NO_ERROR:0,gb:1,tb:2,sb:3,nb:4,rb:5,ub:6,Ia:7,TIMEOUT:8,xb:9},Cs={lb:"complete",Hb:"success",Ja:"error",Ia:"abort",zb:"ready",Ab:"readystatechange",TIMEOUT:"timeout",vb:"incrementaldata",yb:"progress",ob:"downloadprogress",Pb:"uploadprogress"},Pa;function qt(){}I(qt,j),qt.prototype.g=function(){return new XMLHttpRequest},qt.prototype.i=function(){return{}},Pa=new qt;function Fn(c,m,g,x){this.j=c,this.i=m,this.l=g,this.R=x||1,this.U=new Gn(this),this.I=45e3,this.H=null,this.o=!1,this.m=this.A=this.v=this.L=this.F=this.S=this.B=null,this.D=[],this.g=null,this.C=0,this.s=this.u=null,this.X=-1,this.J=!1,this.O=0,this.M=null,this.W=this.K=this.T=this.P=!1,this.h=new uh}function uh(){this.i=null,this.g="",this.h=!1}var dh={},mg={};function gg(c,m,g){c.L=1,c.v=mh(Rs(m)),c.m=g,c.P=!0,LI(c,null)}function LI(c,m){c.F=Date.now(),hh(c),c.A=Rs(c.v);var g=c.A,x=c.R;Array.isArray(x)||(x=[String(x)]),YI(g.i,"t",x),c.C=0,g=c.j.J,c.h=new uh,c.g=pE(c.j,g?m:null,!c.m),0<c.O&&(c.M=new _o(p(c.Y,c,c.g),c.O)),m=c.U,g=c.g,x=c.ca;var O="readystatechange";Array.isArray(O)||(O&&(As[0]=O.toString()),O=As);for(var U=0;U<O.length;U++){var ee=ht(g,O[U],x||m.handleEvent,!1,m.h||m);if(!ee)break;m.g[ee.key]=ee}m=c.H?_(c.H):{},c.m?(c.u||(c.u="POST"),m["Content-Type"]="application/x-www-form-urlencoded",c.g.ea(c.A,c.u,c.m,m)):(c.u="GET",c.g.ea(c.A,c.u,null,m)),lt(),yn(c.i,c.u,c.A,c.l,c.R,c.m)}Fn.prototype.ca=function(c){c=c.target;const m=this.M;m&&Ns(c)==3?m.j():this.Y(c)},Fn.prototype.Y=function(c){try{if(c==this.g)e:{const An=Ns(this.g);var m=this.g.Ba();const Oa=this.g.Z();if(!(3>An)&&(An!=3||this.g&&(this.h.h||this.g.oa()||rE(this.g)))){this.J||An!=4||m==7||(m==8||0>=Oa?lt(3):lt(2)),yg(this);var g=this.g.Z();this.X=g;t:if(VI(this)){var x=rE(this.g);c="";var O=x.length,U=Ns(this.g)==4;if(!this.h.i){if(typeof TextDecoder>"u"){vo(this),Ic(this);var ee="";break t}this.h.i=new a.TextDecoder}for(m=0;m<O;m++)this.h.h=!0,c+=this.h.i.decode(x[m],{stream:!(U&&m==O-1)});x.length=0,this.h.g+=c,this.C=0,ee=this.h.g}else ee=this.g.oa();if(this.o=g==200,_n(this.i,this.u,this.A,this.l,this.R,An,g),this.o){if(this.T&&!this.K){t:{if(this.g){var pt,vn=this.g;if((pt=vn.g?vn.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!T(pt)){var Xe=pt;break t}}Xe=null}if(g=Xe)ct(this.i,this.l,g,"Initial handshake response via X-HTTP-Initial-Response"),this.K=!0,_g(this,g);else{this.o=!1,this.s=3,ce(12),vo(this),Ic(this);break e}}if(this.P){g=!0;let Br;for(;!this.J&&this.C<ee.length;)if(Br=OD(this,ee),Br==mg){An==4&&(this.s=4,ce(14),g=!1),ct(this.i,this.l,null,"[Incomplete Response]");break}else if(Br==dh){this.s=4,ce(15),ct(this.i,this.l,ee,"[Invalid Chunk]"),g=!1;break}else ct(this.i,this.l,Br,null),_g(this,Br);if(VI(this)&&this.C!=0&&(this.h.g=this.h.g.slice(this.C),this.C=0),An!=4||ee.length!=0||this.h.h||(this.s=1,ce(16),g=!1),this.o=this.o&&g,!g)ct(this.i,this.l,ee,"[Invalid Chunked Response]"),vo(this),Ic(this);else if(0<ee.length&&!this.W){this.W=!0;var bn=this.j;bn.g==this&&bn.ba&&!bn.M&&(bn.j.info("Great, no buffering proxy detected. Bytes received: "+ee.length),Tg(bn),bn.M=!0,ce(11))}}else ct(this.i,this.l,ee,null),_g(this,ee);An==4&&vo(this),this.o&&!this.J&&(An==4?uE(this.j,this):(this.o=!1,hh(this)))}else JD(this.g),g==400&&0<ee.indexOf("Unknown SID")?(this.s=3,ce(12)):(this.s=0,ce(13)),vo(this),Ic(this)}}}catch{}finally{}};function VI(c){return c.g?c.u=="GET"&&c.L!=2&&c.j.Ca:!1}function OD(c,m){var g=c.C,x=m.indexOf(`
`,g);return x==-1?mg:(g=Number(m.substring(g,x)),isNaN(g)?dh:(x+=1,x+g>m.length?mg:(m=m.slice(x,x+g),c.C=x+g,m)))}Fn.prototype.cancel=function(){this.J=!0,vo(this)};function hh(c){c.S=Date.now()+c.I,FI(c,c.I)}function FI(c,m){if(c.B!=null)throw Error("WatchDog timer not null");c.B=ze(p(c.ba,c),m)}function yg(c){c.B&&(a.clearTimeout(c.B),c.B=null)}Fn.prototype.ba=function(){this.B=null;const c=Date.now();0<=c-this.S?(et(this.i,this.A),this.L!=2&&(lt(),ce(17)),vo(this),this.s=2,Ic(this)):FI(this,this.S-c)};function Ic(c){c.j.G==0||c.J||uE(c.j,c)}function vo(c){yg(c);var m=c.M;m&&typeof m.ma=="function"&&m.ma(),c.M=null,ch(c.U),c.g&&(m=c.g,c.g=null,m.abort(),m.ma())}function _g(c,m){try{var g=c.j;if(g.G!=0&&(g.g==c||vg(g.h,c))){if(!c.K&&vg(g.h,c)&&g.G==3){try{var x=g.Da.g.parse(m)}catch{x=null}if(Array.isArray(x)&&x.length==3){var O=x;if(O[0]==0){e:if(!g.u){if(g.g)if(g.g.F+3e3<c.F)Ih(g),vh(g);else break e;xg(g),ce(18)}}else g.za=O[1],0<g.za-g.T&&37500>O[2]&&g.F&&g.v==0&&!g.C&&(g.C=ze(p(g.Za,g),6e3));if(1>=BI(g.h)&&g.ca){try{g.ca()}catch{}g.ca=void 0}}else Io(g,11)}else if((c.K||g.g==c)&&Ih(g),!T(m))for(O=g.Da.g.parse(m),m=0;m<O.length;m++){let Xe=O[m];if(g.T=Xe[0],Xe=Xe[1],g.G==2)if(Xe[0]=="c"){g.K=Xe[1],g.ia=Xe[2];const bn=Xe[3];bn!=null&&(g.la=bn,g.j.info("VER="+g.la));const An=Xe[4];An!=null&&(g.Aa=An,g.j.info("SVER="+g.Aa));const Oa=Xe[5];Oa!=null&&typeof Oa=="number"&&0<Oa&&(x=1.5*Oa,g.L=x,g.j.info("backChannelRequestTimeoutMs_="+x)),x=g;const Br=c.g;if(Br){const xh=Br.g?Br.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(xh){var U=x.h;U.g||xh.indexOf("spdy")==-1&&xh.indexOf("quic")==-1&&xh.indexOf("h2")==-1||(U.j=U.l,U.g=new Set,U.h&&(wg(U,U.h),U.h=null))}if(x.D){const Sg=Br.g?Br.g.getResponseHeader("X-HTTP-Session-Id"):null;Sg&&(x.ya=Sg,It(x.I,x.D,Sg))}}g.G=3,g.l&&g.l.ua(),g.ba&&(g.R=Date.now()-c.F,g.j.info("Handshake RTT: "+g.R+"ms")),x=g;var ee=c;if(x.qa=fE(x,x.J?x.ia:null,x.W),ee.K){$I(x.h,ee);var pt=ee,vn=x.L;vn&&(pt.I=vn),pt.B&&(yg(pt),hh(pt)),x.g=ee}else lE(x);0<g.i.length&&wh(g)}else Xe[0]!="stop"&&Xe[0]!="close"||Io(g,7);else g.G==3&&(Xe[0]=="stop"||Xe[0]=="close"?Xe[0]=="stop"?Io(g,7):Eg(g):Xe[0]!="noop"&&g.l&&g.l.ta(Xe),g.v=0)}}lt(4)}catch{}}var MD=class{constructor(c,m){this.g=c,this.map=m}};function jI(c){this.l=c||10,a.PerformanceNavigationTiming?(c=a.performance.getEntriesByType("navigation"),c=0<c.length&&(c[0].nextHopProtocol=="hq"||c[0].nextHopProtocol=="h2")):c=!!(a.chrome&&a.chrome.loadTimes&&a.chrome.loadTimes()&&a.chrome.loadTimes().wasFetchedViaSpdy),this.j=c?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}function UI(c){return c.h?!0:c.g?c.g.size>=c.j:!1}function BI(c){return c.h?1:c.g?c.g.size:0}function vg(c,m){return c.h?c.h==m:c.g?c.g.has(m):!1}function wg(c,m){c.g?c.g.add(m):c.h=m}function $I(c,m){c.h&&c.h==m?c.h=null:c.g&&c.g.has(m)&&c.g.delete(m)}jI.prototype.cancel=function(){if(this.i=zI(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&this.g.size!==0){for(const c of this.g.values())c.cancel();this.g.clear()}};function zI(c){if(c.h!=null)return c.i.concat(c.h.D);if(c.g!=null&&c.g.size!==0){let m=c.i;for(const g of c.g.values())m=m.concat(g.D);return m}return C(c.i)}function LD(c){if(c.V&&typeof c.V=="function")return c.V();if(typeof Map<"u"&&c instanceof Map||typeof Set<"u"&&c instanceof Set)return Array.from(c.values());if(typeof c=="string")return c.split("");if(l(c)){for(var m=[],g=c.length,x=0;x<g;x++)m.push(c[x]);return m}m=[],g=0;for(x in c)m[g++]=c[x];return m}function VD(c){if(c.na&&typeof c.na=="function")return c.na();if(!c.V||typeof c.V!="function"){if(typeof Map<"u"&&c instanceof Map)return Array.from(c.keys());if(!(typeof Set<"u"&&c instanceof Set)){if(l(c)||typeof c=="string"){var m=[];c=c.length;for(var g=0;g<c;g++)m.push(g);return m}m=[],g=0;for(const x in c)m[g++]=x;return m}}}function qI(c,m){if(c.forEach&&typeof c.forEach=="function")c.forEach(m,void 0);else if(l(c)||typeof c=="string")Array.prototype.forEach.call(c,m,void 0);else for(var g=VD(c),x=LD(c),O=x.length,U=0;U<O;U++)m.call(void 0,x[U],g&&g[U],c)}var WI=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function FD(c,m){if(c){c=c.split("&");for(var g=0;g<c.length;g++){var x=c[g].indexOf("="),O=null;if(0<=x){var U=c[g].substring(0,x);O=c[g].substring(x+1)}else U=c[g];m(U,O?decodeURIComponent(O.replace(/\+/g," ")):"")}}}function wo(c){if(this.g=this.o=this.j="",this.s=null,this.m=this.l="",this.h=!1,c instanceof wo){this.h=c.h,fh(this,c.j),this.o=c.o,this.g=c.g,ph(this,c.s),this.l=c.l;var m=c.i,g=new Tc;g.i=m.i,m.g&&(g.g=new Map(m.g),g.h=m.h),GI(this,g),this.m=c.m}else c&&(m=String(c).match(WI))?(this.h=!1,fh(this,m[1]||"",!0),this.o=Ec(m[2]||""),this.g=Ec(m[3]||"",!0),ph(this,m[4]),this.l=Ec(m[5]||"",!0),GI(this,m[6]||"",!0),this.m=Ec(m[7]||"")):(this.h=!1,this.i=new Tc(null,this.h))}wo.prototype.toString=function(){var c=[],m=this.j;m&&c.push(xc(m,HI,!0),":");var g=this.g;return(g||m=="file")&&(c.push("//"),(m=this.o)&&c.push(xc(m,HI,!0),"@"),c.push(encodeURIComponent(String(g)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),g=this.s,g!=null&&c.push(":",String(g))),(g=this.l)&&(this.g&&g.charAt(0)!="/"&&c.push("/"),c.push(xc(g,g.charAt(0)=="/"?BD:UD,!0))),(g=this.i.toString())&&c.push("?",g),(g=this.m)&&c.push("#",xc(g,zD)),c.join("")};function Rs(c){return new wo(c)}function fh(c,m,g){c.j=g?Ec(m,!0):m,c.j&&(c.j=c.j.replace(/:$/,""))}function ph(c,m){if(m){if(m=Number(m),isNaN(m)||0>m)throw Error("Bad port number "+m);c.s=m}else c.s=null}function GI(c,m,g){m instanceof Tc?(c.i=m,qD(c.i,c.h)):(g||(m=xc(m,$D)),c.i=new Tc(m,c.h))}function It(c,m,g){c.i.set(m,g)}function mh(c){return It(c,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),c}function Ec(c,m){return c?m?decodeURI(c.replace(/%25/g,"%2525")):decodeURIComponent(c):""}function xc(c,m,g){return typeof c=="string"?(c=encodeURI(c).replace(m,jD),g&&(c=c.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),c):null}function jD(c){return c=c.charCodeAt(0),"%"+(c>>4&15).toString(16)+(c&15).toString(16)}var HI=/[#\/\?@]/g,UD=/[#\?:]/g,BD=/[#\?]/g,$D=/[#\?@]/g,zD=/#/g;function Tc(c,m){this.h=this.g=null,this.i=c||null,this.j=!!m}function li(c){c.g||(c.g=new Map,c.h=0,c.i&&FD(c.i,function(m,g){c.add(decodeURIComponent(m.replace(/\+/g," ")),g)}))}n=Tc.prototype,n.add=function(c,m){li(this),this.i=null,c=ka(this,c);var g=this.g.get(c);return g||this.g.set(c,g=[]),g.push(m),this.h+=1,this};function KI(c,m){li(c),m=ka(c,m),c.g.has(m)&&(c.i=null,c.h-=c.g.get(m).length,c.g.delete(m))}function QI(c,m){return li(c),m=ka(c,m),c.g.has(m)}n.forEach=function(c,m){li(this),this.g.forEach(function(g,x){g.forEach(function(O){c.call(m,O,x,this)},this)},this)},n.na=function(){li(this);const c=Array.from(this.g.values()),m=Array.from(this.g.keys()),g=[];for(let x=0;x<m.length;x++){const O=c[x];for(let U=0;U<O.length;U++)g.push(m[x])}return g},n.V=function(c){li(this);let m=[];if(typeof c=="string")QI(this,c)&&(m=m.concat(this.g.get(ka(this,c))));else{c=Array.from(this.g.values());for(let g=0;g<c.length;g++)m=m.concat(c[g])}return m},n.set=function(c,m){return li(this),this.i=null,c=ka(this,c),QI(this,c)&&(this.h-=this.g.get(c).length),this.g.set(c,[m]),this.h+=1,this},n.get=function(c,m){return c?(c=this.V(c),0<c.length?String(c[0]):m):m};function YI(c,m,g){KI(c,m),0<g.length&&(c.i=null,c.g.set(ka(c,m),C(g)),c.h+=g.length)}n.toString=function(){if(this.i)return this.i;if(!this.g)return"";const c=[],m=Array.from(this.g.keys());for(var g=0;g<m.length;g++){var x=m[g];const U=encodeURIComponent(String(x)),ee=this.V(x);for(x=0;x<ee.length;x++){var O=U;ee[x]!==""&&(O+="="+encodeURIComponent(String(ee[x]))),c.push(O)}}return this.i=c.join("&")};function ka(c,m){return m=String(m),c.j&&(m=m.toLowerCase()),m}function qD(c,m){m&&!c.j&&(li(c),c.i=null,c.g.forEach(function(g,x){var O=x.toLowerCase();x!=O&&(KI(this,x),YI(this,O,g))},c)),c.j=m}function WD(c,m){const g=new ft;if(a.Image){const x=new Image;x.onload=y(ci,g,"TestLoadImage: loaded",!0,m,x),x.onerror=y(ci,g,"TestLoadImage: error",!1,m,x),x.onabort=y(ci,g,"TestLoadImage: abort",!1,m,x),x.ontimeout=y(ci,g,"TestLoadImage: timeout",!1,m,x),a.setTimeout(function(){x.ontimeout&&x.ontimeout()},1e4),x.src=c}else m(!1)}function GD(c,m){const g=new ft,x=new AbortController,O=setTimeout(()=>{x.abort(),ci(g,"TestPingServer: timeout",!1,m)},1e4);fetch(c,{signal:x.signal}).then(U=>{clearTimeout(O),U.ok?ci(g,"TestPingServer: ok",!0,m):ci(g,"TestPingServer: server error",!1,m)}).catch(()=>{clearTimeout(O),ci(g,"TestPingServer: error",!1,m)})}function ci(c,m,g,x,O){try{O&&(O.onload=null,O.onerror=null,O.onabort=null,O.ontimeout=null),x(g)}catch{}}function HD(){this.g=new pg}function KD(c,m,g){const x=g||"";try{qI(c,function(O,U){let ee=O;u(O)&&(ee=wc(O)),m.push(x+U+"="+encodeURIComponent(ee))})}catch(O){throw m.push(x+"type="+encodeURIComponent("_badmap")),O}}function gh(c){this.l=c.Ub||null,this.j=c.eb||!1}I(gh,j),gh.prototype.g=function(){return new yh(this.l,this.j)},gh.prototype.i=function(c){return function(){return c}}({});function yh(c,m){Je.call(this),this.D=c,this.o=m,this.m=void 0,this.status=this.readyState=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.u=new Headers,this.h=null,this.B="GET",this.A="",this.g=!1,this.v=this.j=this.l=null}I(yh,Je),n=yh.prototype,n.open=function(c,m){if(this.readyState!=0)throw this.abort(),Error("Error reopening a connection");this.B=c,this.A=m,this.readyState=1,bc(this)},n.send=function(c){if(this.readyState!=1)throw this.abort(),Error("need to call open() first. ");this.g=!0;const m={headers:this.u,method:this.B,credentials:this.m,cache:void 0};c&&(m.body=c),(this.D||a).fetch(new Request(this.A,m)).then(this.Sa.bind(this),this.ga.bind(this))},n.abort=function(){this.response=this.responseText="",this.u=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),1<=this.readyState&&this.g&&this.readyState!=4&&(this.g=!1,Sc(this)),this.readyState=0},n.Sa=function(c){if(this.g&&(this.l=c,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=c.headers,this.readyState=2,bc(this)),this.g&&(this.readyState=3,bc(this),this.g)))if(this.responseType==="arraybuffer")c.arrayBuffer().then(this.Qa.bind(this),this.ga.bind(this));else if(typeof a.ReadableStream<"u"&&"body"in c){if(this.j=c.body.getReader(),this.o){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.v=new TextDecoder;JI(this)}else c.text().then(this.Ra.bind(this),this.ga.bind(this))};function JI(c){c.j.read().then(c.Pa.bind(c)).catch(c.ga.bind(c))}n.Pa=function(c){if(this.g){if(this.o&&c.value)this.response.push(c.value);else if(!this.o){var m=c.value?c.value:new Uint8Array(0);(m=this.v.decode(m,{stream:!c.done}))&&(this.response=this.responseText+=m)}c.done?Sc(this):bc(this),this.readyState==3&&JI(this)}},n.Ra=function(c){this.g&&(this.response=this.responseText=c,Sc(this))},n.Qa=function(c){this.g&&(this.response=c,Sc(this))},n.ga=function(){this.g&&Sc(this)};function Sc(c){c.readyState=4,c.l=null,c.j=null,c.v=null,bc(c)}n.setRequestHeader=function(c,m){this.u.append(c,m)},n.getResponseHeader=function(c){return this.h&&this.h.get(c.toLowerCase())||""},n.getAllResponseHeaders=function(){if(!this.h)return"";const c=[],m=this.h.entries();for(var g=m.next();!g.done;)g=g.value,c.push(g[0]+": "+g[1]),g=m.next();return c.join(`\r
`)};function bc(c){c.onreadystatechange&&c.onreadystatechange.call(c)}Object.defineProperty(yh.prototype,"withCredentials",{get:function(){return this.m==="include"},set:function(c){this.m=c?"include":"same-origin"}});function XI(c){let m="";return k(c,function(g,x){m+=x,m+=":",m+=g,m+=`\r
`}),m}function Ig(c,m,g){e:{for(x in g){var x=!1;break e}x=!0}x||(g=XI(g),typeof c=="string"?g!=null&&encodeURIComponent(String(g)):It(c,m,g))}function Ut(c){Je.call(this),this.headers=new Map,this.o=c||null,this.h=!1,this.v=this.g=null,this.D="",this.m=0,this.l="",this.j=this.B=this.u=this.A=!1,this.I=null,this.H="",this.J=!1}I(Ut,Je);var QD=/^https?$/i,YD=["POST","PUT"];n=Ut.prototype,n.Ha=function(c){this.J=c},n.ea=function(c,m,g,x){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.D+"; newUri="+c);m=m?m.toUpperCase():"GET",this.D=c,this.l="",this.m=0,this.A=!1,this.h=!0,this.g=this.o?this.o.g():Pa.g(),this.v=this.o?Q(this.o):Q(Pa),this.g.onreadystatechange=p(this.Ea,this);try{this.B=!0,this.g.open(m,String(c),!0),this.B=!1}catch(U){ZI(this,U);return}if(c=g||"",g=new Map(this.headers),x)if(Object.getPrototypeOf(x)===Object.prototype)for(var O in x)g.set(O,x[O]);else if(typeof x.keys=="function"&&typeof x.get=="function")for(const U of x.keys())g.set(U,x.get(U));else throw Error("Unknown input type for opt_headers: "+String(x));x=Array.from(g.keys()).find(U=>U.toLowerCase()=="content-type"),O=a.FormData&&c instanceof a.FormData,!(0<=Array.prototype.indexOf.call(YD,m,void 0))||x||O||g.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(const[U,ee]of g)this.g.setRequestHeader(U,ee);this.H&&(this.g.responseType=this.H),"withCredentials"in this.g&&this.g.withCredentials!==this.J&&(this.g.withCredentials=this.J);try{nE(this),this.u=!0,this.g.send(c),this.u=!1}catch(U){ZI(this,U)}};function ZI(c,m){c.h=!1,c.g&&(c.j=!0,c.g.abort(),c.j=!1),c.l=m,c.m=5,eE(c),_h(c)}function eE(c){c.A||(c.A=!0,Xt(c,"complete"),Xt(c,"error"))}n.abort=function(c){this.g&&this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1,this.m=c||7,Xt(this,"complete"),Xt(this,"abort"),_h(this))},n.N=function(){this.g&&(this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1),_h(this,!0)),Ut.aa.N.call(this)},n.Ea=function(){this.s||(this.B||this.u||this.j?tE(this):this.bb())},n.bb=function(){tE(this)};function tE(c){if(c.h&&typeof o<"u"&&(!c.v[1]||Ns(c)!=4||c.Z()!=2)){if(c.u&&Ns(c)==4)lr(c.Ea,0,c);else if(Xt(c,"readystatechange"),Ns(c)==4){c.h=!1;try{const ee=c.Z();e:switch(ee){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var m=!0;break e;default:m=!1}var g;if(!(g=m)){var x;if(x=ee===0){var O=String(c.D).match(WI)[1]||null;!O&&a.self&&a.self.location&&(O=a.self.location.protocol.slice(0,-1)),x=!QD.test(O?O.toLowerCase():"")}g=x}if(g)Xt(c,"complete"),Xt(c,"success");else{c.m=6;try{var U=2<Ns(c)?c.g.statusText:""}catch{U=""}c.l=U+" ["+c.Z()+"]",eE(c)}}finally{_h(c)}}}}function _h(c,m){if(c.g){nE(c);const g=c.g,x=c.v[0]?()=>{}:null;c.g=null,c.v=null,m||Xt(c,"ready");try{g.onreadystatechange=x}catch{}}}function nE(c){c.I&&(a.clearTimeout(c.I),c.I=null)}n.isActive=function(){return!!this.g};function Ns(c){return c.g?c.g.readyState:0}n.Z=function(){try{return 2<Ns(this)?this.g.status:-1}catch{return-1}},n.oa=function(){try{return this.g?this.g.responseText:""}catch{return""}},n.Oa=function(c){if(this.g){var m=this.g.responseText;return c&&m.indexOf(c)==0&&(m=m.substring(c.length)),fg(m)}};function rE(c){try{if(!c.g)return null;if("response"in c.g)return c.g.response;switch(c.H){case"":case"text":return c.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in c.g)return c.g.mozResponseArrayBuffer}return null}catch{return null}}function JD(c){const m={};c=(c.g&&2<=Ns(c)&&c.g.getAllResponseHeaders()||"").split(`\r
`);for(let x=0;x<c.length;x++){if(T(c[x]))continue;var g=S(c[x]);const O=g[0];if(g=g[1],typeof g!="string")continue;g=g.trim();const U=m[O]||[];m[O]=U,U.push(g)}E(m,function(x){return x.join(", ")})}n.Ba=function(){return this.m},n.Ka=function(){return typeof this.l=="string"?this.l:String(this.l)};function Ac(c,m,g){return g&&g.internalChannelParams&&g.internalChannelParams[c]||m}function sE(c){this.Aa=0,this.i=[],this.j=new ft,this.ia=this.qa=this.I=this.W=this.g=this.ya=this.D=this.H=this.m=this.S=this.o=null,this.Ya=this.U=0,this.Va=Ac("failFast",!1,c),this.F=this.C=this.u=this.s=this.l=null,this.X=!0,this.za=this.T=-1,this.Y=this.v=this.B=0,this.Ta=Ac("baseRetryDelayMs",5e3,c),this.cb=Ac("retryDelaySeedMs",1e4,c),this.Wa=Ac("forwardChannelMaxRetries",2,c),this.wa=Ac("forwardChannelRequestTimeoutMs",2e4,c),this.pa=c&&c.xmlHttpFactory||void 0,this.Xa=c&&c.Tb||void 0,this.Ca=c&&c.useFetchStreams||!1,this.L=void 0,this.J=c&&c.supportsCrossDomainXhr||!1,this.K="",this.h=new jI(c&&c.concurrentRequestLimit),this.Da=new HD,this.P=c&&c.fastHandshake||!1,this.O=c&&c.encodeInitMessageHeaders||!1,this.P&&this.O&&(this.O=!1),this.Ua=c&&c.Rb||!1,c&&c.xa&&this.j.xa(),c&&c.forceLongPolling&&(this.X=!1),this.ba=!this.P&&this.X&&c&&c.detectBufferingProxy||!1,this.ja=void 0,c&&c.longPollingTimeout&&0<c.longPollingTimeout&&(this.ja=c.longPollingTimeout),this.ca=void 0,this.R=0,this.M=!1,this.ka=this.A=null}n=sE.prototype,n.la=8,n.G=1,n.connect=function(c,m,g,x){ce(0),this.W=c,this.H=m||{},g&&x!==void 0&&(this.H.OSID=g,this.H.OAID=x),this.F=this.X,this.I=fE(this,null,this.W),wh(this)};function Eg(c){if(iE(c),c.G==3){var m=c.U++,g=Rs(c.I);if(It(g,"SID",c.K),It(g,"RID",m),It(g,"TYPE","terminate"),Cc(c,g),m=new Fn(c,c.j,m),m.L=2,m.v=mh(Rs(g)),g=!1,a.navigator&&a.navigator.sendBeacon)try{g=a.navigator.sendBeacon(m.v.toString(),"")}catch{}!g&&a.Image&&(new Image().src=m.v,g=!0),g||(m.g=pE(m.j,null),m.g.ea(m.v)),m.F=Date.now(),hh(m)}hE(c)}function vh(c){c.g&&(Tg(c),c.g.cancel(),c.g=null)}function iE(c){vh(c),c.u&&(a.clearTimeout(c.u),c.u=null),Ih(c),c.h.cancel(),c.s&&(typeof c.s=="number"&&a.clearTimeout(c.s),c.s=null)}function wh(c){if(!UI(c.h)&&!c.s){c.s=!0;var m=c.Ga;Be||J(),$||(Be(),$=!0),G.add(m,c),c.B=0}}function XD(c,m){return BI(c.h)>=c.h.j-(c.s?1:0)?!1:c.s?(c.i=m.D.concat(c.i),!0):c.G==1||c.G==2||c.B>=(c.Va?0:c.Wa)?!1:(c.s=ze(p(c.Ga,c,m),dE(c,c.B)),c.B++,!0)}n.Ga=function(c){if(this.s)if(this.s=null,this.G==1){if(!c){this.U=Math.floor(1e5*Math.random()),c=this.U++;const O=new Fn(this,this.j,c);let U=this.o;if(this.S&&(U?(U=_(U),v(U,this.S)):U=this.S),this.m!==null||this.O||(O.H=U,U=null),this.P)e:{for(var m=0,g=0;g<this.i.length;g++){t:{var x=this.i[g];if("__data__"in x.map&&(x=x.map.__data__,typeof x=="string")){x=x.length;break t}x=void 0}if(x===void 0)break;if(m+=x,4096<m){m=g;break e}if(m===4096||g===this.i.length-1){m=g+1;break e}}m=1e3}else m=1e3;m=aE(this,O,m),g=Rs(this.I),It(g,"RID",c),It(g,"CVER",22),this.D&&It(g,"X-HTTP-Session-Id",this.D),Cc(this,g),U&&(this.O?m="headers="+encodeURIComponent(String(XI(U)))+"&"+m:this.m&&Ig(g,this.m,U)),wg(this.h,O),this.Ua&&It(g,"TYPE","init"),this.P?(It(g,"$req",m),It(g,"SID","null"),O.T=!0,gg(O,g,null)):gg(O,g,m),this.G=2}}else this.G==3&&(c?oE(this,c):this.i.length==0||UI(this.h)||oE(this))};function oE(c,m){var g;m?g=m.l:g=c.U++;const x=Rs(c.I);It(x,"SID",c.K),It(x,"RID",g),It(x,"AID",c.T),Cc(c,x),c.m&&c.o&&Ig(x,c.m,c.o),g=new Fn(c,c.j,g,c.B+1),c.m===null&&(g.H=c.o),m&&(c.i=m.D.concat(c.i)),m=aE(c,g,1e3),g.I=Math.round(.5*c.wa)+Math.round(.5*c.wa*Math.random()),wg(c.h,g),gg(g,x,m)}function Cc(c,m){c.H&&k(c.H,function(g,x){It(m,x,g)}),c.l&&qI({},function(g,x){It(m,x,g)})}function aE(c,m,g){g=Math.min(c.i.length,g);var x=c.l?p(c.l.Na,c.l,c):null;e:{var O=c.i;let U=-1;for(;;){const ee=["count="+g];U==-1?0<g?(U=O[0].g,ee.push("ofs="+U)):U=0:ee.push("ofs="+U);let pt=!0;for(let vn=0;vn<g;vn++){let Xe=O[vn].g;const bn=O[vn].map;if(Xe-=U,0>Xe)U=Math.max(0,O[vn].g-100),pt=!1;else try{KD(bn,ee,"req"+Xe+"_")}catch{x&&x(bn)}}if(pt){x=ee.join("&");break e}}}return c=c.i.splice(0,g),m.D=c,x}function lE(c){if(!c.g&&!c.u){c.Y=1;var m=c.Fa;Be||J(),$||(Be(),$=!0),G.add(m,c),c.v=0}}function xg(c){return c.g||c.u||3<=c.v?!1:(c.Y++,c.u=ze(p(c.Fa,c),dE(c,c.v)),c.v++,!0)}n.Fa=function(){if(this.u=null,cE(this),this.ba&&!(this.M||this.g==null||0>=this.R)){var c=2*this.R;this.j.info("BP detection timer enabled: "+c),this.A=ze(p(this.ab,this),c)}},n.ab=function(){this.A&&(this.A=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.F=!1,this.M=!0,ce(10),vh(this),cE(this))};function Tg(c){c.A!=null&&(a.clearTimeout(c.A),c.A=null)}function cE(c){c.g=new Fn(c,c.j,"rpc",c.Y),c.m===null&&(c.g.H=c.o),c.g.O=0;var m=Rs(c.qa);It(m,"RID","rpc"),It(m,"SID",c.K),It(m,"AID",c.T),It(m,"CI",c.F?"0":"1"),!c.F&&c.ja&&It(m,"TO",c.ja),It(m,"TYPE","xmlhttp"),Cc(c,m),c.m&&c.o&&Ig(m,c.m,c.o),c.L&&(c.g.I=c.L);var g=c.g;c=c.ia,g.L=1,g.v=mh(Rs(m)),g.m=null,g.P=!0,LI(g,c)}n.Za=function(){this.C!=null&&(this.C=null,vh(this),xg(this),ce(19))};function Ih(c){c.C!=null&&(a.clearTimeout(c.C),c.C=null)}function uE(c,m){var g=null;if(c.g==m){Ih(c),Tg(c),c.g=null;var x=2}else if(vg(c.h,m))g=m.D,$I(c.h,m),x=1;else return;if(c.G!=0){if(m.o)if(x==1){g=m.m?m.m.length:0,m=Date.now()-m.F;var O=c.B;x=$e(),Xt(x,new me(x,g)),wh(c)}else lE(c);else if(O=m.s,O==3||O==0&&0<m.X||!(x==1&&XD(c,m)||x==2&&xg(c)))switch(g&&0<g.length&&(m=c.h,m.i=m.i.concat(g)),O){case 1:Io(c,5);break;case 4:Io(c,10);break;case 3:Io(c,6);break;default:Io(c,2)}}}function dE(c,m){let g=c.Ta+Math.floor(Math.random()*c.cb);return c.isActive()||(g*=2),g*m}function Io(c,m){if(c.j.info("Error code "+m),m==2){var g=p(c.fb,c),x=c.Xa;const O=!x;x=new wo(x||"//www.google.com/images/cleardot.gif"),a.location&&a.location.protocol=="http"||fh(x,"https"),mh(x),O?WD(x.toString(),g):GD(x.toString(),g)}else ce(2);c.G=0,c.l&&c.l.sa(m),hE(c),iE(c)}n.fb=function(c){c?(this.j.info("Successfully pinged google.com"),ce(2)):(this.j.info("Failed to ping google.com"),ce(1))};function hE(c){if(c.G=0,c.ka=[],c.l){const m=zI(c.h);(m.length!=0||c.i.length!=0)&&(P(c.ka,m),P(c.ka,c.i),c.h.i.length=0,C(c.i),c.i.length=0),c.l.ra()}}function fE(c,m,g){var x=g instanceof wo?Rs(g):new wo(g);if(x.g!="")m&&(x.g=m+"."+x.g),ph(x,x.s);else{var O=a.location;x=O.protocol,m=m?m+"."+O.hostname:O.hostname,O=+O.port;var U=new wo(null);x&&fh(U,x),m&&(U.g=m),O&&ph(U,O),g&&(U.l=g),x=U}return g=c.D,m=c.ya,g&&m&&It(x,g,m),It(x,"VER",c.la),Cc(c,x),x}function pE(c,m,g){if(m&&!c.J)throw Error("Can't create secondary domain capable XhrIo object.");return m=c.Ca&&!c.pa?new Ut(new gh({eb:g})):new Ut(c.pa),m.Ha(c.J),m}n.isActive=function(){return!!this.l&&this.l.isActive(this)};function mE(){}n=mE.prototype,n.ua=function(){},n.ta=function(){},n.sa=function(){},n.ra=function(){},n.isActive=function(){return!0},n.Na=function(){};function Eh(){}Eh.prototype.g=function(c,m){return new cr(c,m)};function cr(c,m){Je.call(this),this.g=new sE(m),this.l=c,this.h=m&&m.messageUrlParams||null,c=m&&m.messageHeaders||null,m&&m.clientProtocolHeaderRequired&&(c?c["X-Client-Protocol"]="webchannel":c={"X-Client-Protocol":"webchannel"}),this.g.o=c,c=m&&m.initMessageHeaders||null,m&&m.messageContentType&&(c?c["X-WebChannel-Content-Type"]=m.messageContentType:c={"X-WebChannel-Content-Type":m.messageContentType}),m&&m.va&&(c?c["X-WebChannel-Client-Profile"]=m.va:c={"X-WebChannel-Client-Profile":m.va}),this.g.S=c,(c=m&&m.Sb)&&!T(c)&&(this.g.m=c),this.v=m&&m.supportsCrossDomainXhr||!1,this.u=m&&m.sendRawJson||!1,(m=m&&m.httpSessionIdParam)&&!T(m)&&(this.g.D=m,c=this.h,c!==null&&m in c&&(c=this.h,m in c&&delete c[m])),this.j=new Da(this)}I(cr,Je),cr.prototype.m=function(){this.g.l=this.j,this.v&&(this.g.J=!0),this.g.connect(this.l,this.h||void 0)},cr.prototype.close=function(){Eg(this.g)},cr.prototype.o=function(c){var m=this.g;if(typeof c=="string"){var g={};g.__data__=c,c=g}else this.u&&(g={},g.__data__=wc(c),c=g);m.i.push(new MD(m.Ya++,c)),m.G==3&&wh(m)},cr.prototype.N=function(){this.g.l=null,delete this.j,Eg(this.g),delete this.g,cr.aa.N.call(this)};function gE(c){ge.call(this),c.__headers__&&(this.headers=c.__headers__,this.statusCode=c.__status__,delete c.__headers__,delete c.__status__);var m=c.__sm__;if(m){e:{for(const g in m){c=g;break e}c=void 0}(this.i=c)&&(c=this.i,m=m!==null&&c in m?m[c]:void 0),this.data=m}else this.data=c}I(gE,ge);function yE(){Ie.call(this),this.status=1}I(yE,Ie);function Da(c){this.g=c}I(Da,mE),Da.prototype.ua=function(){Xt(this.g,"a")},Da.prototype.ta=function(c){Xt(this.g,new gE(c))},Da.prototype.sa=function(c){Xt(this.g,new yE)},Da.prototype.ra=function(){Xt(this.g,"b")},Eh.prototype.createWebChannel=Eh.prototype.g,cr.prototype.send=cr.prototype.o,cr.prototype.open=cr.prototype.m,cr.prototype.close=cr.prototype.close,PR=function(){return new Eh},NR=function(){return $e()},RR=Pe,G_={mb:0,pb:1,qb:2,Jb:3,Ob:4,Lb:5,Mb:6,Kb:7,Ib:8,Nb:9,PROXY:10,NOPROXY:11,Gb:12,Cb:13,Db:14,Bb:15,Eb:16,Fb:17,ib:18,hb:19,jb:20},sn.NO_ERROR=0,sn.TIMEOUT=8,sn.HTTP_ERROR=6,yf=sn,Cs.COMPLETE="complete",CR=Cs,W.EventType=re,re.OPEN="a",re.CLOSE="b",re.ERROR="c",re.MESSAGE="d",Je.prototype.listen=Je.prototype.K,eu=W,Ut.prototype.listenOnce=Ut.prototype.L,Ut.prototype.getLastError=Ut.prototype.Ka,Ut.prototype.getLastErrorCode=Ut.prototype.Ba,Ut.prototype.getStatus=Ut.prototype.Z,Ut.prototype.getResponseJson=Ut.prototype.Oa,Ut.prototype.getResponseText=Ut.prototype.oa,Ut.prototype.send=Ut.prototype.ea,Ut.prototype.setWithCredentials=Ut.prototype.Ha,AR=Ut}).apply(typeof zh<"u"?zh:typeof self<"u"?self:typeof window<"u"?window:{});const vT="@firebase/firestore",wT="4.9.0";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let un=class{constructor(e){this.uid=e}isAuthenticated(){return this.uid!=null}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}};un.UNAUTHENTICATED=new un(null),un.GOOGLE_CREDENTIALS=new un("google-credentials-uid"),un.FIRST_PARTY=new un("first-party-uid"),un.MOCK_USER=new un("mock-user");/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let lc="12.0.0";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const eo=new Pd("@firebase/firestore");function za(){return eo.logLevel}function i7(n){eo.setLogLevel(n)}function q(n,...e){if(eo.logLevel<=Fe.DEBUG){const t=e.map(iw);eo.debug(`Firestore (${lc}): ${n}`,...t)}}function Gt(n,...e){if(eo.logLevel<=Fe.ERROR){const t=e.map(iw);eo.error(`Firestore (${lc}): ${n}`,...t)}}function Vr(n,...e){if(eo.logLevel<=Fe.WARN){const t=e.map(iw);eo.warn(`Firestore (${lc}): ${n}`,...t)}}function iw(n){if(typeof n=="string")return n;try{/**
* @license
* Copyright 2020 Google LLC
*
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
*   http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
*/return function(t){return JSON.stringify(t)}(n)}catch{return n}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function se(n,e,t){let r="Unexpected state";typeof e=="string"?r=e:t=e,kR(n,r,t)}function kR(n,e,t){let r=`FIRESTORE (${lc}) INTERNAL ASSERTION FAILED: ${e} (ID: ${n.toString(16)})`;if(t!==void 0)try{r+=" CONTEXT: "+JSON.stringify(t)}catch{r+=" CONTEXT: "+t}throw Gt(r),new Error(r)}function ae(n,e,t,r){let s="Unexpected state";typeof t=="string"?s=t:r=t,n||kR(e,s,r)}function o7(n,e){n||se(57014,e)}function Z(n,e){return n}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const V={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class z extends ts{constructor(e,t){super(e,t),this.code=e,this.message=t,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class fn{constructor(){this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class DR{constructor(e,t){this.user=t,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}}class C4{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,t){e.enqueueRetryable(()=>t(un.UNAUTHENTICATED))}shutdown(){}}class R4{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,t){this.changeListener=t,e.enqueueRetryable(()=>t(this.token.user))}shutdown(){this.changeListener=null}}class N4{constructor(e){this.t=e,this.currentUser=un.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(e,t){ae(this.o===void 0,42304);let r=this.i;const s=l=>this.i!==r?(r=this.i,t(l)):Promise.resolve();let i=new fn;this.o=()=>{this.i++,this.currentUser=this.u(),i.resolve(),i=new fn,e.enqueueRetryable(()=>s(this.currentUser))};const o=()=>{const l=i;e.enqueueRetryable(async()=>{await l.promise,await s(this.currentUser)})},a=l=>{q("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=l,this.o&&(this.auth.addAuthTokenListener(this.o),o())};this.t.onInit(l=>a(l)),setTimeout(()=>{if(!this.auth){const l=this.t.getImmediate({optional:!0});l?a(l):(q("FirebaseAuthCredentialsProvider","Auth not yet detected"),i.resolve(),i=new fn)}},0),o()}getToken(){const e=this.i,t=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(t).then(r=>this.i!==e?(q("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):r?(ae(typeof r.accessToken=="string",31837,{l:r}),new DR(r.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.o&&this.auth.removeAuthTokenListener(this.o),this.o=void 0}u(){const e=this.auth&&this.auth.getUid();return ae(e===null||typeof e=="string",2055,{h:e}),new un(e)}}class P4{constructor(e,t,r){this.P=e,this.T=t,this.I=r,this.type="FirstParty",this.user=un.FIRST_PARTY,this.A=new Map}R(){return this.I?this.I():null}get headers(){this.A.set("X-Goog-AuthUser",this.P);const e=this.R();return e&&this.A.set("Authorization",e),this.T&&this.A.set("X-Goog-Iam-Authorization-Token",this.T),this.A}}class k4{constructor(e,t,r){this.P=e,this.T=t,this.I=r}getToken(){return Promise.resolve(new P4(this.P,this.T,this.I))}start(e,t){e.enqueueRetryable(()=>t(un.FIRST_PARTY))}shutdown(){}invalidateToken(){}}class H_{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class D4{constructor(e,t){this.V=t,this.forceRefresh=!1,this.appCheck=null,this.m=null,this.p=null,Pt(e)&&e.settings.appCheckToken&&(this.p=e.settings.appCheckToken)}start(e,t){ae(this.o===void 0,3512);const r=i=>{i.error!=null&&q("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${i.error.message}`);const o=i.token!==this.m;return this.m=i.token,q("FirebaseAppCheckTokenProvider",`Received ${o?"new":"existing"} token.`),o?t(i.token):Promise.resolve()};this.o=i=>{e.enqueueRetryable(()=>r(i))};const s=i=>{q("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=i,this.o&&this.appCheck.addTokenListener(this.o)};this.V.onInit(i=>s(i)),setTimeout(()=>{if(!this.appCheck){const i=this.V.getImmediate({optional:!0});i?s(i):q("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}},0)}getToken(){if(this.p)return Promise.resolve(new H_(this.p));const e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then(t=>t?(ae(typeof t.token=="string",44558,{tokenResult:t}),this.m=t.token,new H_(t.token)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.o&&this.appCheck.removeTokenListener(this.o),this.o=void 0}}class a7{getToken(){return Promise.resolve(new H_(""))}invalidateToken(){}start(e,t){}shutdown(){}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function O4(n){const e=typeof self<"u"&&(self.crypto||self.msCrypto),t=new Uint8Array(n);if(e&&typeof e.getRandomValues=="function")e.getRandomValues(t);else for(let r=0;r<n;r++)t[r]=Math.floor(256*Math.random());return t}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ow{static newId(){const e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",t=62*Math.floor(4.129032258064516);let r="";for(;r.length<20;){const s=O4(40);for(let i=0;i<s.length;++i)r.length<20&&s[i]<t&&(r+=e.charAt(s[i]%62))}return r}}function ve(n,e){return n<e?-1:n>e?1:0}function K_(n,e){const t=Math.min(n.length,e.length);for(let r=0;r<t;r++){const s=n.charAt(r),i=e.charAt(r);if(s!==i)return uy(s)===uy(i)?ve(s,i):uy(s)?1:-1}return ve(n.length,e.length)}const M4=55296,L4=57343;function uy(n){const e=n.charCodeAt(0);return e>=M4&&e<=L4}function Ol(n,e,t){return n.length===e.length&&n.every((r,s)=>t(r,e[s]))}function OR(n){return n+"\0"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Q_="__name__";class ls{constructor(e,t,r){t===void 0?t=0:t>e.length&&se(637,{offset:t,range:e.length}),r===void 0?r=e.length-t:r>e.length-t&&se(1746,{length:r,range:e.length-t}),this.segments=e,this.offset=t,this.len=r}get length(){return this.len}isEqual(e){return ls.comparator(this,e)===0}child(e){const t=this.segments.slice(this.offset,this.limit());return e instanceof ls?e.forEach(r=>{t.push(r)}):t.push(e),this.construct(t)}limit(){return this.offset+this.length}popFirst(e){return e=e===void 0?1:e,this.construct(this.segments,this.offset+e,this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return this.length===0}isPrefixOf(e){if(e.length<this.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}forEach(e){for(let t=this.offset,r=this.limit();t<r;t++)e(this.segments[t])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,t){const r=Math.min(e.length,t.length);for(let s=0;s<r;s++){const i=ls.compareSegments(e.get(s),t.get(s));if(i!==0)return i}return ve(e.length,t.length)}static compareSegments(e,t){const r=ls.isNumericId(e),s=ls.isNumericId(t);return r&&!s?-1:!r&&s?1:r&&s?ls.extractNumericId(e).compare(ls.extractNumericId(t)):K_(e,t)}static isNumericId(e){return e.startsWith("__id")&&e.endsWith("__")}static extractNumericId(e){return qi.fromString(e.substring(4,e.length-2))}}class Ve extends ls{construct(e,t,r){return new Ve(e,t,r)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...e){const t=[];for(const r of e){if(r.indexOf("//")>=0)throw new z(V.INVALID_ARGUMENT,`Invalid segment (${r}). Paths must not contain // in them.`);t.push(...r.split("/").filter(s=>s.length>0))}return new Ve(t)}static emptyPath(){return new Ve([])}}const V4=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class Dt extends ls{construct(e,t,r){return new Dt(e,t,r)}static isValidIdentifier(e){return V4.test(e)}canonicalString(){return this.toArray().map(e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),Dt.isValidIdentifier(e)||(e="`"+e+"`"),e)).join(".")}toString(){return this.canonicalString()}isKeyField(){return this.length===1&&this.get(0)===Q_}static keyField(){return new Dt([Q_])}static fromServerFormat(e){const t=[];let r="",s=0;const i=()=>{if(r.length===0)throw new z(V.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);t.push(r),r=""};let o=!1;for(;s<e.length;){const a=e[s];if(a==="\\"){if(s+1===e.length)throw new z(V.INVALID_ARGUMENT,"Path has trailing escape character: "+e);const l=e[s+1];if(l!=="\\"&&l!=="."&&l!=="`")throw new z(V.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);r+=l,s+=2}else a==="`"?(o=!o,s++):a!=="."||o?(r+=a,s++):(i(),s++)}if(i(),o)throw new z(V.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new Dt(t)}static emptyPath(){return new Dt([])}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class X{constructor(e){this.path=e}static fromPath(e){return new X(Ve.fromString(e))}static fromName(e){return new X(Ve.fromString(e).popFirst(5))}static empty(){return new X(Ve.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return e!==null&&Ve.comparator(this.path,e.path)===0}toString(){return this.path.toString()}static comparator(e,t){return Ve.comparator(e.path,t.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new X(new Ve(e.slice()))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function aw(n,e,t){if(!t)throw new z(V.INVALID_ARGUMENT,`Function ${n}() cannot be called with an empty ${e}.`)}function F4(n,e,t,r){if(e===!0&&r===!0)throw new z(V.INVALID_ARGUMENT,`${n} and ${t} cannot be used together.`)}function IT(n){if(!X.isDocumentKey(n))throw new z(V.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${n} has ${n.length}.`)}function ET(n){if(X.isDocumentKey(n))throw new z(V.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${n} has ${n.length}.`)}function MR(n){return typeof n=="object"&&n!==null&&(Object.getPrototypeOf(n)===Object.prototype||Object.getPrototypeOf(n)===null)}function Am(n){if(n===void 0)return"undefined";if(n===null)return"null";if(typeof n=="string")return n.length>20&&(n=`${n.substring(0,20)}...`),JSON.stringify(n);if(typeof n=="number"||typeof n=="boolean")return""+n;if(typeof n=="object"){if(n instanceof Array)return"an array";{const e=function(r){return r.constructor?r.constructor.name:null}(n);return e?`a custom ${e} object`:"an object"}}return typeof n=="function"?"a function":se(12329,{type:typeof n})}function je(n,e){if("_delegate"in n&&(n=n._delegate),!(n instanceof e)){if(e.name===n.constructor.name)throw new z(V.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{const t=Am(n);throw new z(V.INVALID_ARGUMENT,`Expected type '${e.name}', but it was: ${t}`)}}return n}function LR(n,e){if(e<=0)throw new z(V.INVALID_ARGUMENT,`Function ${n}() requires a positive number, but it was: ${e}.`)}/**
 * @license
 * Copyright 2025 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Jt(n,e){const t={typeString:n};return e&&(t.value=e),t}function xa(n,e){if(!MR(n))throw new z(V.INVALID_ARGUMENT,"JSON must be an object");let t;for(const r in e)if(e[r]){const s=e[r].typeString,i="value"in e[r]?{value:e[r].value}:void 0;if(!(r in n)){t=`JSON missing required field: '${r}'`;break}const o=n[r];if(s&&typeof o!==s){t=`JSON field '${r}' must be a ${s}.`;break}if(i!==void 0&&o!==i.value){t=`Expected '${r}' field to equal '${i.value}'`;break}}if(t)throw new z(V.INVALID_ARGUMENT,t);return!0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const xT=-62135596800,TT=1e6;class rt{static now(){return rt.fromMillis(Date.now())}static fromDate(e){return rt.fromMillis(e.getTime())}static fromMillis(e){const t=Math.floor(e/1e3),r=Math.floor((e-1e3*t)*TT);return new rt(t,r)}constructor(e,t){if(this.seconds=e,this.nanoseconds=t,t<0)throw new z(V.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(t>=1e9)throw new z(V.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(e<xT)throw new z(V.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e);if(e>=253402300800)throw new z(V.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/TT}_compareTo(e){return this.seconds===e.seconds?ve(this.nanoseconds,e.nanoseconds):ve(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{type:rt._jsonSchemaVersion,seconds:this.seconds,nanoseconds:this.nanoseconds}}static fromJSON(e){if(xa(e,rt._jsonSchema))return new rt(e.seconds,e.nanoseconds)}valueOf(){const e=this.seconds-xT;return String(e).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}rt._jsonSchemaVersion="firestore/timestamp/1.0",rt._jsonSchema={type:Jt("string",rt._jsonSchemaVersion),seconds:Jt("number"),nanoseconds:Jt("number")};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ue{static fromTimestamp(e){return new ue(e)}static min(){return new ue(new rt(0,0))}static max(){return new ue(new rt(253402300799,999999999))}constructor(e){this.timestamp=e}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ml=-1;class Ll{constructor(e,t,r,s){this.indexId=e,this.collectionGroup=t,this.fields=r,this.indexState=s}}function Y_(n){return n.fields.find(e=>e.kind===2)}function Ao(n){return n.fields.filter(e=>e.kind!==2)}function j4(n,e){let t=ve(n.collectionGroup,e.collectionGroup);if(t!==0)return t;for(let r=0;r<Math.min(n.fields.length,e.fields.length);++r)if(t=U4(n.fields[r],e.fields[r]),t!==0)return t;return ve(n.fields.length,e.fields.length)}Ll.UNKNOWN_ID=-1;class zo{constructor(e,t){this.fieldPath=e,this.kind=t}}function U4(n,e){const t=Dt.comparator(n.fieldPath,e.fieldPath);return t!==0?t:ve(n.kind,e.kind)}class Vl{constructor(e,t){this.sequenceNumber=e,this.offset=t}static empty(){return new Vl(0,xr.min())}}function VR(n,e){const t=n.toTimestamp().seconds,r=n.toTimestamp().nanoseconds+1,s=ue.fromTimestamp(r===1e9?new rt(t+1,0):new rt(t,r));return new xr(s,X.empty(),e)}function FR(n){return new xr(n.readTime,n.key,Ml)}class xr{constructor(e,t,r){this.readTime=e,this.documentKey=t,this.largestBatchId=r}static min(){return new xr(ue.min(),X.empty(),Ml)}static max(){return new xr(ue.max(),X.empty(),Ml)}}function lw(n,e){let t=n.readTime.compareTo(e.readTime);return t!==0?t:(t=X.comparator(n.documentKey,e.documentKey),t!==0?t:ve(n.largestBatchId,e.largestBatchId))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const jR="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class UR{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach(e=>e())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function ho(n){if(n.code!==V.FAILED_PRECONDITION||n.message!==jR)throw n;q("LocalStore","Unexpectedly lost primary lease")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class M{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e(t=>{this.isDone=!0,this.result=t,this.nextCallback&&this.nextCallback(t)},t=>{this.isDone=!0,this.error=t,this.catchCallback&&this.catchCallback(t)})}catch(e){return this.next(void 0,e)}next(e,t){return this.callbackAttached&&se(59440),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(t,this.error):this.wrapSuccess(e,this.result):new M((r,s)=>{this.nextCallback=i=>{this.wrapSuccess(e,i).next(r,s)},this.catchCallback=i=>{this.wrapFailure(t,i).next(r,s)}})}toPromise(){return new Promise((e,t)=>{this.next(e,t)})}wrapUserFunction(e){try{const t=e();return t instanceof M?t:M.resolve(t)}catch(t){return M.reject(t)}}wrapSuccess(e,t){return e?this.wrapUserFunction(()=>e(t)):M.resolve(t)}wrapFailure(e,t){return e?this.wrapUserFunction(()=>e(t)):M.reject(t)}static resolve(e){return new M((t,r)=>{t(e)})}static reject(e){return new M((t,r)=>{r(e)})}static waitFor(e){return new M((t,r)=>{let s=0,i=0,o=!1;e.forEach(a=>{++s,a.next(()=>{++i,o&&i===s&&t()},l=>r(l))}),o=!0,i===s&&t()})}static or(e){let t=M.resolve(!1);for(const r of e)t=t.next(s=>s?M.resolve(s):r());return t}static forEach(e,t){const r=[];return e.forEach((s,i)=>{r.push(t.call(this,s,i))}),this.waitFor(r)}static mapArray(e,t){return new M((r,s)=>{const i=e.length,o=new Array(i);let a=0;for(let l=0;l<i;l++){const u=l;t(e[u]).next(h=>{o[u]=h,++a,a===i&&r(o)},h=>s(h))}})}static doWhile(e,t){return new M((r,s)=>{const i=()=>{e()===!0?t().next(()=>{i()},s):r()};i()})}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const hr="SimpleDb";class Cm{static open(e,t,r,s){try{return new Cm(t,e.transaction(s,r))}catch(i){throw new wu(t,i)}}constructor(e,t){this.action=e,this.transaction=t,this.aborted=!1,this.S=new fn,this.transaction.oncomplete=()=>{this.S.resolve()},this.transaction.onabort=()=>{t.error?this.S.reject(new wu(e,t.error)):this.S.resolve()},this.transaction.onerror=r=>{const s=cw(r.target.error);this.S.reject(new wu(e,s))}}get D(){return this.S.promise}abort(e){e&&this.S.reject(e),this.aborted||(q(hr,"Aborting transaction:",e?e.message:"Client-initiated abort"),this.aborted=!0,this.transaction.abort())}C(){const e=this.transaction;this.aborted||typeof e.commit!="function"||e.commit()}store(e){const t=this.transaction.objectStore(e);return new $4(t)}}class vs{static delete(e){return q(hr,"Removing database:",e),Ro(BA().indexedDB.deleteDatabase(e)).toPromise()}static v(){if(!am())return!1;if(vs.F())return!0;const e=nn(),t=vs.M(e),r=0<t&&t<10,s=BR(e),i=0<s&&s<4.5;return!(e.indexOf("MSIE ")>0||e.indexOf("Trident/")>0||e.indexOf("Edge/")>0||r||i)}static F(){var e;return typeof process<"u"&&((e=process.__PRIVATE_env)==null?void 0:e.__PRIVATE_USE_MOCK_PERSISTENCE)==="YES"}static O(e,t){return e.store(t)}static M(e){const t=e.match(/i(?:phone|pad|pod) os ([\d_]+)/i),r=t?t[1].split("_").slice(0,2).join("."):"-1";return Number(r)}constructor(e,t,r){this.name=e,this.version=t,this.N=r,this.B=null,vs.M(nn())===12.2&&Gt("Firestore persistence suffers from a bug in iOS 12.2 Safari that may cause your app to stop working. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.")}async L(e){return this.db||(q(hr,"Opening database:",this.name),this.db=await new Promise((t,r)=>{const s=indexedDB.open(this.name,this.version);s.onsuccess=i=>{const o=i.target.result;t(o)},s.onblocked=()=>{r(new wu(e,"Cannot upgrade IndexedDB schema while another tab is open. Close all tabs that access Firestore and reload this page to proceed."))},s.onerror=i=>{const o=i.target.error;o.name==="VersionError"?r(new z(V.FAILED_PRECONDITION,"A newer version of the Firestore SDK was previously used and so the persisted data is not compatible with the version of the SDK you are now using. The SDK will operate with persistence disabled. If you need persistence, please re-upgrade to a newer version of the SDK or else clear the persisted IndexedDB data for your app to start fresh.")):o.name==="InvalidStateError"?r(new z(V.FAILED_PRECONDITION,"Unable to open an IndexedDB connection. This could be due to running in a private browsing session on a browser whose private browsing sessions do not support IndexedDB: "+o)):r(new wu(e,o))},s.onupgradeneeded=i=>{q(hr,'Database "'+this.name+'" requires upgrade from version:',i.oldVersion);const o=i.target.result;this.N.k(o,s.transaction,i.oldVersion,this.version).next(()=>{q(hr,"Database upgrade to version "+this.version+" complete")})}})),this.q&&(this.db.onversionchange=t=>this.q(t)),this.db}$(e){this.q=e,this.db&&(this.db.onversionchange=t=>e(t))}async runTransaction(e,t,r,s){const i=t==="readonly";let o=0;for(;;){++o;try{this.db=await this.L(e);const a=Cm.open(this.db,e,i?"readonly":"readwrite",r),l=s(a).next(u=>(a.C(),u)).catch(u=>(a.abort(u),M.reject(u))).toPromise();return l.catch(()=>{}),await a.D,l}catch(a){const l=a,u=l.name!=="FirebaseError"&&o<3;if(q(hr,"Transaction failed with error:",l.message,"Retrying:",u),this.close(),!u)return Promise.reject(l)}}}close(){this.db&&this.db.close(),this.db=void 0}}function BR(n){const e=n.match(/Android ([\d.]+)/i),t=e?e[1].split(".").slice(0,2).join("."):"-1";return Number(t)}class B4{constructor(e){this.U=e,this.K=!1,this.W=null}get isDone(){return this.K}get G(){return this.W}set cursor(e){this.U=e}done(){this.K=!0}j(e){this.W=e}delete(){return Ro(this.U.delete())}}class wu extends z{constructor(e,t){super(V.UNAVAILABLE,`IndexedDB transaction '${e}' failed: ${t}`),this.name="IndexedDbTransactionError"}}function fo(n){return n.name==="IndexedDbTransactionError"}class $4{constructor(e){this.store=e}put(e,t){let r;return t!==void 0?(q(hr,"PUT",this.store.name,e,t),r=this.store.put(t,e)):(q(hr,"PUT",this.store.name,"<auto-key>",e),r=this.store.put(e)),Ro(r)}add(e){return q(hr,"ADD",this.store.name,e,e),Ro(this.store.add(e))}get(e){return Ro(this.store.get(e)).next(t=>(t===void 0&&(t=null),q(hr,"GET",this.store.name,e,t),t))}delete(e){return q(hr,"DELETE",this.store.name,e),Ro(this.store.delete(e))}count(){return q(hr,"COUNT",this.store.name),Ro(this.store.count())}J(e,t){const r=this.options(e,t),s=r.index?this.store.index(r.index):this.store;if(typeof s.getAll=="function"){const i=s.getAll(r.range);return new M((o,a)=>{i.onerror=l=>{a(l.target.error)},i.onsuccess=l=>{o(l.target.result)}})}{const i=this.cursor(r),o=[];return this.H(i,(a,l)=>{o.push(l)}).next(()=>o)}}Y(e,t){const r=this.store.getAll(e,t===null?void 0:t);return new M((s,i)=>{r.onerror=o=>{i(o.target.error)},r.onsuccess=o=>{s(o.target.result)}})}Z(e,t){q(hr,"DELETE ALL",this.store.name);const r=this.options(e,t);r.X=!1;const s=this.cursor(r);return this.H(s,(i,o,a)=>a.delete())}ee(e,t){let r;t?r=e:(r={},t=e);const s=this.cursor(r);return this.H(s,t)}te(e){const t=this.cursor({});return new M((r,s)=>{t.onerror=i=>{const o=cw(i.target.error);s(o)},t.onsuccess=i=>{const o=i.target.result;o?e(o.primaryKey,o.value).next(a=>{a?o.continue():r()}):r()}})}H(e,t){const r=[];return new M((s,i)=>{e.onerror=o=>{i(o.target.error)},e.onsuccess=o=>{const a=o.target.result;if(!a)return void s();const l=new B4(a),u=t(a.primaryKey,a.value,l);if(u instanceof M){const h=u.catch(f=>(l.done(),M.reject(f)));r.push(h)}l.isDone?s():l.G===null?a.continue():a.continue(l.G)}}).next(()=>M.waitFor(r))}options(e,t){let r;return e!==void 0&&(typeof e=="string"?r=e:t=e),{index:r,range:t}}cursor(e){let t="next";if(e.reverse&&(t="prev"),e.index){const r=this.store.index(e.index);return e.X?r.openKeyCursor(e.range,t):r.openCursor(e.range,t)}return this.store.openCursor(e.range,t)}}function Ro(n){return new M((e,t)=>{n.onsuccess=r=>{const s=r.target.result;e(s)},n.onerror=r=>{const s=cw(r.target.error);t(s)}})}let ST=!1;function cw(n){const e=vs.M(nn());if(e>=12.2&&e<13){const t="An internal error was encountered in the Indexed Database server";if(n.message.indexOf(t)>=0){const r=new z("internal",`IOS_INDEXEDDB_BUG1: IndexedDb has thrown '${t}'. This is likely due to an unavoidable bug in iOS. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.`);return ST||(ST=!0,setTimeout(()=>{throw r},0)),r}}return n}const Iu="IndexBackfiller";class z4{constructor(e,t){this.asyncQueue=e,this.ne=t,this.task=null}start(){this.re(15e3)}stop(){this.task&&(this.task.cancel(),this.task=null)}get started(){return this.task!==null}re(e){q(Iu,`Scheduled in ${e}ms`),this.task=this.asyncQueue.enqueueAfterDelay("index_backfill",e,async()=>{this.task=null;try{const t=await this.ne.ie();q(Iu,`Documents written: ${t}`)}catch(t){fo(t)?q(Iu,"Ignoring IndexedDB error during index backfill: ",t):await ho(t)}await this.re(6e4)})}}class q4{constructor(e,t){this.localStore=e,this.persistence=t}async ie(e=50){return this.persistence.runTransaction("Backfill Indexes","readwrite-primary",t=>this.se(t,e))}se(e,t){const r=new Set;let s=t,i=!0;return M.doWhile(()=>i===!0&&s>0,()=>this.localStore.indexManager.getNextCollectionGroupToUpdate(e).next(o=>{if(o!==null&&!r.has(o))return q(Iu,`Processing collection: ${o}`),this.oe(e,o,s).next(a=>{s-=a,r.add(o)});i=!1})).next(()=>t-s)}oe(e,t,r){return this.localStore.indexManager.getMinOffsetFromCollectionGroup(e,t).next(s=>this.localStore.localDocuments.getNextDocuments(e,t,s,r).next(i=>{const o=i.changes;return this.localStore.indexManager.updateIndexEntries(e,o).next(()=>this._e(s,i)).next(a=>(q(Iu,`Updating offset: ${a}`),this.localStore.indexManager.updateCollectionGroup(e,t,a))).next(()=>o.size)}))}_e(e,t){let r=e;return t.changes.forEach((s,i)=>{const o=FR(i);lw(o,r)>0&&(r=o)}),new xr(r.readTime,r.documentKey,Math.max(t.batchId,e.largestBatchId))}}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Yn{constructor(e,t){this.previousValue=e,t&&(t.sequenceNumberHandler=r=>this.ae(r),this.ue=r=>t.writeSequenceNumber(r))}ae(e){return this.previousValue=Math.max(e,this.previousValue),this.previousValue}next(){const e=++this.previousValue;return this.ue&&this.ue(e),e}}Yn.ce=-1;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Wi=-1;function zd(n){return n==null}function od(n){return n===0&&1/n==-1/0}function $R(n){return typeof n=="number"&&Number.isInteger(n)&&!od(n)&&n<=Number.MAX_SAFE_INTEGER&&n>=Number.MIN_SAFE_INTEGER}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ip="";function On(n){let e="";for(let t=0;t<n.length;t++)e.length>0&&(e=bT(e)),e=W4(n.get(t),e);return bT(e)}function W4(n,e){let t=e;const r=n.length;for(let s=0;s<r;s++){const i=n.charAt(s);switch(i){case"\0":t+="";break;case Ip:t+="";break;default:t+=i}}return t}function bT(n){return n+Ip+""}function fs(n){const e=n.length;if(ae(e>=2,64408,{path:n}),e===2)return ae(n.charAt(0)===Ip&&n.charAt(1)==="",56145,{path:n}),Ve.emptyPath();const t=e-2,r=[];let s="";for(let i=0;i<e;){const o=n.indexOf(Ip,i);switch((o<0||o>t)&&se(50515,{path:n}),n.charAt(o+1)){case"":const a=n.substring(i,o);let l;s.length===0?l=a:(s+=a,l=s,s=""),r.push(l);break;case"":s+=n.substring(i,o),s+="\0";break;case"":s+=n.substring(i,o+1);break;default:se(61167,{path:n})}i=o+2}return new Ve(r)}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Co="remoteDocuments",qd="owner",Va="owner",ad="mutationQueues",G4="userId",Wr="mutations",AT="batchId",Vo="userMutationsIndex",CT=["userId","batchId"];/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function _f(n,e){return[n,On(e)]}function zR(n,e,t){return[n,On(e),t]}const H4={},Fl="documentMutations",Ep="remoteDocumentsV14",K4=["prefixPath","collectionGroup","readTime","documentId"],vf="documentKeyIndex",Q4=["prefixPath","collectionGroup","documentId"],qR="collectionGroupIndex",Y4=["collectionGroup","readTime","prefixPath","documentId"],ld="remoteDocumentGlobal",J_="remoteDocumentGlobalKey",jl="targets",WR="queryTargetsIndex",J4=["canonicalId","targetId"],Ul="targetDocuments",X4=["targetId","path"],uw="documentTargetsIndex",Z4=["path","targetId"],xp="targetGlobalKey",qo="targetGlobal",cd="collectionParents",e3=["collectionId","parent"],Bl="clientMetadata",t3="clientId",Rm="bundles",n3="bundleId",Nm="namedQueries",r3="name",dw="indexConfiguration",s3="indexId",X_="collectionGroupIndex",i3="collectionGroup",Eu="indexState",o3=["indexId","uid"],GR="sequenceNumberIndex",a3=["uid","sequenceNumber"],xu="indexEntries",l3=["indexId","uid","arrayValue","directionalValue","orderedDocumentKey","documentKey"],HR="documentKeyIndex",c3=["indexId","uid","orderedDocumentKey"],Pm="documentOverlays",u3=["userId","collectionPath","documentId"],Z_="collectionPathOverlayIndex",d3=["userId","collectionPath","largestBatchId"],KR="collectionGroupOverlayIndex",h3=["userId","collectionGroup","largestBatchId"],hw="globals",f3="name",QR=[ad,Wr,Fl,Co,jl,qd,qo,Ul,Bl,ld,cd,Rm,Nm],p3=[...QR,Pm],YR=[ad,Wr,Fl,Ep,jl,qd,qo,Ul,Bl,ld,cd,Rm,Nm,Pm],JR=YR,fw=[...JR,dw,Eu,xu],m3=fw,XR=[...fw,hw],g3=XR;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ev extends UR{constructor(e,t){super(),this.le=e,this.currentSequenceNumber=t}}function rn(n,e){const t=Z(n);return vs.O(t.le,e)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function RT(n){let e=0;for(const t in n)Object.prototype.hasOwnProperty.call(n,t)&&e++;return e}function po(n,e){for(const t in n)Object.prototype.hasOwnProperty.call(n,t)&&e(t,n[t])}function ZR(n,e){const t=[];for(const r in n)Object.prototype.hasOwnProperty.call(n,r)&&t.push(e(n[r],r,n));return t}function eN(n){for(const e in n)if(Object.prototype.hasOwnProperty.call(n,e))return!1;return!0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class wt{constructor(e,t){this.comparator=e,this.root=t||In.EMPTY}insert(e,t){return new wt(this.comparator,this.root.insert(e,t,this.comparator).copy(null,null,In.BLACK,null,null))}remove(e){return new wt(this.comparator,this.root.remove(e,this.comparator).copy(null,null,In.BLACK,null,null))}get(e){let t=this.root;for(;!t.isEmpty();){const r=this.comparator(e,t.key);if(r===0)return t.value;r<0?t=t.left:r>0&&(t=t.right)}return null}indexOf(e){let t=0,r=this.root;for(;!r.isEmpty();){const s=this.comparator(e,r.key);if(s===0)return t+r.left.size;s<0?r=r.left:(t+=r.left.size+1,r=r.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal((t,r)=>(e(t,r),!1))}toString(){const e=[];return this.inorderTraversal((t,r)=>(e.push(`${t}:${r}`),!1)),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new qh(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new qh(this.root,e,this.comparator,!1)}getReverseIterator(){return new qh(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new qh(this.root,e,this.comparator,!0)}}class qh{constructor(e,t,r,s){this.isReverse=s,this.nodeStack=[];let i=1;for(;!e.isEmpty();)if(i=t?r(e.key,t):1,t&&s&&(i*=-1),i<0)e=this.isReverse?e.left:e.right;else{if(i===0){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop();const t={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return t}hasNext(){return this.nodeStack.length>0}peek(){if(this.nodeStack.length===0)return null;const e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}}class In{constructor(e,t,r,s,i){this.key=e,this.value=t,this.color=r??In.RED,this.left=s??In.EMPTY,this.right=i??In.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,t,r,s,i){return new In(e??this.key,t??this.value,r??this.color,s??this.left,i??this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,r){let s=this;const i=r(e,s.key);return s=i<0?s.copy(null,null,null,s.left.insert(e,t,r),null):i===0?s.copy(null,t,null,null,null):s.copy(null,null,null,null,s.right.insert(e,t,r)),s.fixUp()}removeMin(){if(this.left.isEmpty())return In.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),e=e.copy(null,null,null,e.left.removeMin(),null),e.fixUp()}remove(e,t){let r,s=this;if(t(e,s.key)<0)s.left.isEmpty()||s.left.isRed()||s.left.left.isRed()||(s=s.moveRedLeft()),s=s.copy(null,null,null,s.left.remove(e,t),null);else{if(s.left.isRed()&&(s=s.rotateRight()),s.right.isEmpty()||s.right.isRed()||s.right.left.isRed()||(s=s.moveRedRight()),t(e,s.key)===0){if(s.right.isEmpty())return In.EMPTY;r=s.right.min(),s=s.copy(r.key,r.value,null,null,s.right.removeMin())}s=s.copy(null,null,null,null,s.right.remove(e,t))}return s.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=e.copy(null,null,null,null,e.right.rotateRight()),e=e.rotateLeft(),e=e.colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=e.rotateRight(),e=e.colorFlip()),e}rotateLeft(){const e=this.copy(null,null,In.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){const e=this.copy(null,null,In.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){const e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth(){const e=this.check();return Math.pow(2,e)<=this.size+1}check(){if(this.isRed()&&this.left.isRed())throw se(43730,{key:this.key,value:this.value});if(this.right.isRed())throw se(14113,{key:this.key,value:this.value});const e=this.left.check();if(e!==this.right.check())throw se(27949);return e+(this.isRed()?0:1)}}In.EMPTY=null,In.RED=!0,In.BLACK=!1;In.EMPTY=new class{constructor(){this.size=0}get key(){throw se(57766)}get value(){throw se(16141)}get color(){throw se(16727)}get left(){throw se(29726)}get right(){throw se(36894)}copy(e,t,r,s,i){return this}insert(e,t,r){return new In(e,t)}remove(e,t){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ot{constructor(e){this.comparator=e,this.data=new wt(this.comparator)}has(e){return this.data.get(e)!==null}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal((t,r)=>(e(t),!1))}forEachInRange(e,t){const r=this.data.getIteratorFrom(e[0]);for(;r.hasNext();){const s=r.getNext();if(this.comparator(s.key,e[1])>=0)return;t(s.key)}}forEachWhile(e,t){let r;for(r=t!==void 0?this.data.getIteratorFrom(t):this.data.getIterator();r.hasNext();)if(!e(r.getNext().key))return}firstAfterOrEqual(e){const t=this.data.getIteratorFrom(e);return t.hasNext()?t.getNext().key:null}getIterator(){return new NT(this.data.getIterator())}getIteratorFrom(e){return new NT(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let t=this;return t.size<e.size&&(t=e,e=this),e.forEach(r=>{t=t.add(r)}),t}isEqual(e){if(!(e instanceof ot)||this.size!==e.size)return!1;const t=this.data.getIterator(),r=e.data.getIterator();for(;t.hasNext();){const s=t.getNext().key,i=r.getNext().key;if(this.comparator(s,i)!==0)return!1}return!0}toArray(){const e=[];return this.forEach(t=>{e.push(t)}),e}toString(){const e=[];return this.forEach(t=>e.push(t)),"SortedSet("+e.toString()+")"}copy(e){const t=new ot(this.comparator);return t.data=e,t}}class NT{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}function Fa(n){return n.hasNext()?n.getNext():void 0}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Jn{constructor(e){this.fields=e,e.sort(Dt.comparator)}static empty(){return new Jn([])}unionWith(e){let t=new ot(Dt.comparator);for(const r of this.fields)t=t.add(r);for(const r of e)t=t.add(r);return new Jn(t.toArray())}covers(e){for(const t of this.fields)if(t.isPrefixOf(e))return!0;return!1}isEqual(e){return Ol(this.fields,e.fields,(t,r)=>t.isEqual(r))}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class tN extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function c7(){return typeof atob<"u"}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class $t{constructor(e){this.binaryString=e}static fromBase64String(e){const t=function(s){try{return atob(s)}catch(i){throw typeof DOMException<"u"&&i instanceof DOMException?new tN("Invalid base64 string: "+i):i}}(e);return new $t(t)}static fromUint8Array(e){const t=function(s){let i="";for(let o=0;o<s.length;++o)i+=String.fromCharCode(s[o]);return i}(e);return new $t(t)}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return function(t){return btoa(t)}(this.binaryString)}toUint8Array(){return function(t){const r=new Uint8Array(t.length);for(let s=0;s<t.length;s++)r[s]=t.charCodeAt(s);return r}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return ve(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}}$t.EMPTY_BYTE_STRING=new $t("");const y3=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function Qs(n){if(ae(!!n,39018),typeof n=="string"){let e=0;const t=y3.exec(n);if(ae(!!t,46558,{timestamp:n}),t[1]){let s=t[1];s=(s+"000000000").substr(0,9),e=Number(s)}const r=new Date(n);return{seconds:Math.floor(r.getTime()/1e3),nanos:e}}return{seconds:Rt(n.seconds),nanos:Rt(n.nanos)}}function Rt(n){return typeof n=="number"?n:typeof n=="string"?Number(n):0}function Ys(n){return typeof n=="string"?$t.fromBase64String(n):$t.fromUint8Array(n)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const nN="server_timestamp",rN="__type__",sN="__previous_value__",iN="__local_write_time__";function km(n){var t,r;return((r=(((t=n==null?void 0:n.mapValue)==null?void 0:t.fields)||{})[rN])==null?void 0:r.stringValue)===nN}function Dm(n){const e=n.mapValue.fields[sN];return km(e)?Dm(e):e}function ud(n){const e=Qs(n.mapValue.fields[iN].timestampValue);return new rt(e.seconds,e.nanos)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class _3{constructor(e,t,r,s,i,o,a,l,u,h){this.databaseId=e,this.appId=t,this.persistenceKey=r,this.host=s,this.ssl=i,this.forceLongPolling=o,this.autoDetectLongPolling=a,this.longPollingOptions=l,this.useFetchStreams=u,this.isUsingEmulator=h}}const dd="(default)";class ra{constructor(e,t){this.projectId=e,this.database=t||dd}static empty(){return new ra("","")}get isDefaultDatabase(){return this.database===dd}isEqual(e){return e instanceof ra&&e.projectId===this.projectId&&e.database===this.database}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const pw="__type__",oN="__max__",Ci={mapValue:{fields:{__type__:{stringValue:oN}}}},mw="__vector__",$l="value",wf={nullValue:"NULL_VALUE"};function to(n){return"nullValue"in n?0:"booleanValue"in n?1:"integerValue"in n||"doubleValue"in n?2:"timestampValue"in n?3:"stringValue"in n?5:"bytesValue"in n?6:"referenceValue"in n?7:"geoPointValue"in n?8:"arrayValue"in n?9:"mapValue"in n?km(n)?4:aN(n)?9007199254740991:Om(n)?10:11:se(28295,{value:n})}function Ss(n,e){if(n===e)return!0;const t=to(n);if(t!==to(e))return!1;switch(t){case 0:case 9007199254740991:return!0;case 1:return n.booleanValue===e.booleanValue;case 4:return ud(n).isEqual(ud(e));case 3:return function(s,i){if(typeof s.timestampValue=="string"&&typeof i.timestampValue=="string"&&s.timestampValue.length===i.timestampValue.length)return s.timestampValue===i.timestampValue;const o=Qs(s.timestampValue),a=Qs(i.timestampValue);return o.seconds===a.seconds&&o.nanos===a.nanos}(n,e);case 5:return n.stringValue===e.stringValue;case 6:return function(s,i){return Ys(s.bytesValue).isEqual(Ys(i.bytesValue))}(n,e);case 7:return n.referenceValue===e.referenceValue;case 8:return function(s,i){return Rt(s.geoPointValue.latitude)===Rt(i.geoPointValue.latitude)&&Rt(s.geoPointValue.longitude)===Rt(i.geoPointValue.longitude)}(n,e);case 2:return function(s,i){if("integerValue"in s&&"integerValue"in i)return Rt(s.integerValue)===Rt(i.integerValue);if("doubleValue"in s&&"doubleValue"in i){const o=Rt(s.doubleValue),a=Rt(i.doubleValue);return o===a?od(o)===od(a):isNaN(o)&&isNaN(a)}return!1}(n,e);case 9:return Ol(n.arrayValue.values||[],e.arrayValue.values||[],Ss);case 10:case 11:return function(s,i){const o=s.mapValue.fields||{},a=i.mapValue.fields||{};if(RT(o)!==RT(a))return!1;for(const l in o)if(o.hasOwnProperty(l)&&(a[l]===void 0||!Ss(o[l],a[l])))return!1;return!0}(n,e);default:return se(52216,{left:n})}}function hd(n,e){return(n.values||[]).find(t=>Ss(t,e))!==void 0}function no(n,e){if(n===e)return 0;const t=to(n),r=to(e);if(t!==r)return ve(t,r);switch(t){case 0:case 9007199254740991:return 0;case 1:return ve(n.booleanValue,e.booleanValue);case 2:return function(i,o){const a=Rt(i.integerValue||i.doubleValue),l=Rt(o.integerValue||o.doubleValue);return a<l?-1:a>l?1:a===l?0:isNaN(a)?isNaN(l)?0:-1:1}(n,e);case 3:return PT(n.timestampValue,e.timestampValue);case 4:return PT(ud(n),ud(e));case 5:return K_(n.stringValue,e.stringValue);case 6:return function(i,o){const a=Ys(i),l=Ys(o);return a.compareTo(l)}(n.bytesValue,e.bytesValue);case 7:return function(i,o){const a=i.split("/"),l=o.split("/");for(let u=0;u<a.length&&u<l.length;u++){const h=ve(a[u],l[u]);if(h!==0)return h}return ve(a.length,l.length)}(n.referenceValue,e.referenceValue);case 8:return function(i,o){const a=ve(Rt(i.latitude),Rt(o.latitude));return a!==0?a:ve(Rt(i.longitude),Rt(o.longitude))}(n.geoPointValue,e.geoPointValue);case 9:return kT(n.arrayValue,e.arrayValue);case 10:return function(i,o){var p,y,I,C;const a=i.fields||{},l=o.fields||{},u=(p=a[$l])==null?void 0:p.arrayValue,h=(y=l[$l])==null?void 0:y.arrayValue,f=ve(((I=u==null?void 0:u.values)==null?void 0:I.length)||0,((C=h==null?void 0:h.values)==null?void 0:C.length)||0);return f!==0?f:kT(u,h)}(n.mapValue,e.mapValue);case 11:return function(i,o){if(i===Ci.mapValue&&o===Ci.mapValue)return 0;if(i===Ci.mapValue)return 1;if(o===Ci.mapValue)return-1;const a=i.fields||{},l=Object.keys(a),u=o.fields||{},h=Object.keys(u);l.sort(),h.sort();for(let f=0;f<l.length&&f<h.length;++f){const p=K_(l[f],h[f]);if(p!==0)return p;const y=no(a[l[f]],u[h[f]]);if(y!==0)return y}return ve(l.length,h.length)}(n.mapValue,e.mapValue);default:throw se(23264,{he:t})}}function PT(n,e){if(typeof n=="string"&&typeof e=="string"&&n.length===e.length)return ve(n,e);const t=Qs(n),r=Qs(e),s=ve(t.seconds,r.seconds);return s!==0?s:ve(t.nanos,r.nanos)}function kT(n,e){const t=n.values||[],r=e.values||[];for(let s=0;s<t.length&&s<r.length;++s){const i=no(t[s],r[s]);if(i)return i}return ve(t.length,r.length)}function zl(n){return tv(n)}function tv(n){return"nullValue"in n?"null":"booleanValue"in n?""+n.booleanValue:"integerValue"in n?""+n.integerValue:"doubleValue"in n?""+n.doubleValue:"timestampValue"in n?function(t){const r=Qs(t);return`time(${r.seconds},${r.nanos})`}(n.timestampValue):"stringValue"in n?n.stringValue:"bytesValue"in n?function(t){return Ys(t).toBase64()}(n.bytesValue):"referenceValue"in n?function(t){return X.fromName(t).toString()}(n.referenceValue):"geoPointValue"in n?function(t){return`geo(${t.latitude},${t.longitude})`}(n.geoPointValue):"arrayValue"in n?function(t){let r="[",s=!0;for(const i of t.values||[])s?s=!1:r+=",",r+=tv(i);return r+"]"}(n.arrayValue):"mapValue"in n?function(t){const r=Object.keys(t.fields||{}).sort();let s="{",i=!0;for(const o of r)i?i=!1:s+=",",s+=`${o}:${tv(t.fields[o])}`;return s+"}"}(n.mapValue):se(61005,{value:n})}function If(n){switch(to(n)){case 0:case 1:return 4;case 2:return 8;case 3:case 8:return 16;case 4:const e=Dm(n);return e?16+If(e):16;case 5:return 2*n.stringValue.length;case 6:return Ys(n.bytesValue).approximateByteSize();case 7:return n.referenceValue.length;case 9:return function(r){return(r.values||[]).reduce((s,i)=>s+If(i),0)}(n.arrayValue);case 10:case 11:return function(r){let s=0;return po(r.fields,(i,o)=>{s+=i.length+If(o)}),s}(n.mapValue);default:throw se(13486,{value:n})}}function sa(n,e){return{referenceValue:`projects/${n.projectId}/databases/${n.database}/documents/${e.path.canonicalString()}`}}function nv(n){return!!n&&"integerValue"in n}function fd(n){return!!n&&"arrayValue"in n}function DT(n){return!!n&&"nullValue"in n}function OT(n){return!!n&&"doubleValue"in n&&isNaN(Number(n.doubleValue))}function Ef(n){return!!n&&"mapValue"in n}function Om(n){var t,r;return((r=(((t=n==null?void 0:n.mapValue)==null?void 0:t.fields)||{})[pw])==null?void 0:r.stringValue)===mw}function Tu(n){if(n.geoPointValue)return{geoPointValue:{...n.geoPointValue}};if(n.timestampValue&&typeof n.timestampValue=="object")return{timestampValue:{...n.timestampValue}};if(n.mapValue){const e={mapValue:{fields:{}}};return po(n.mapValue.fields,(t,r)=>e.mapValue.fields[t]=Tu(r)),e}if(n.arrayValue){const e={arrayValue:{values:[]}};for(let t=0;t<(n.arrayValue.values||[]).length;++t)e.arrayValue.values[t]=Tu(n.arrayValue.values[t]);return e}return{...n}}function aN(n){return(((n.mapValue||{}).fields||{}).__type__||{}).stringValue===oN}const lN={mapValue:{fields:{[pw]:{stringValue:mw},[$l]:{arrayValue:{}}}}};function v3(n){return"nullValue"in n?wf:"booleanValue"in n?{booleanValue:!1}:"integerValue"in n||"doubleValue"in n?{doubleValue:NaN}:"timestampValue"in n?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"stringValue"in n?{stringValue:""}:"bytesValue"in n?{bytesValue:""}:"referenceValue"in n?sa(ra.empty(),X.empty()):"geoPointValue"in n?{geoPointValue:{latitude:-90,longitude:-180}}:"arrayValue"in n?{arrayValue:{}}:"mapValue"in n?Om(n)?lN:{mapValue:{}}:se(35942,{value:n})}function w3(n){return"nullValue"in n?{booleanValue:!1}:"booleanValue"in n?{doubleValue:NaN}:"integerValue"in n||"doubleValue"in n?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"timestampValue"in n?{stringValue:""}:"stringValue"in n?{bytesValue:""}:"bytesValue"in n?sa(ra.empty(),X.empty()):"referenceValue"in n?{geoPointValue:{latitude:-90,longitude:-180}}:"geoPointValue"in n?{arrayValue:{}}:"arrayValue"in n?lN:"mapValue"in n?Om(n)?{mapValue:{}}:Ci:se(61959,{value:n})}function MT(n,e){const t=no(n.value,e.value);return t!==0?t:n.inclusive&&!e.inclusive?-1:!n.inclusive&&e.inclusive?1:0}function LT(n,e){const t=no(n.value,e.value);return t!==0?t:n.inclusive&&!e.inclusive?1:!n.inclusive&&e.inclusive?-1:0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class En{constructor(e){this.value=e}static empty(){return new En({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let t=this.value;for(let r=0;r<e.length-1;++r)if(t=(t.mapValue.fields||{})[e.get(r)],!Ef(t))return null;return t=(t.mapValue.fields||{})[e.lastSegment()],t||null}}set(e,t){this.getFieldsMap(e.popLast())[e.lastSegment()]=Tu(t)}setAll(e){let t=Dt.emptyPath(),r={},s=[];e.forEach((o,a)=>{if(!t.isImmediateParentOf(a)){const l=this.getFieldsMap(t);this.applyChanges(l,r,s),r={},s=[],t=a.popLast()}o?r[a.lastSegment()]=Tu(o):s.push(a.lastSegment())});const i=this.getFieldsMap(t);this.applyChanges(i,r,s)}delete(e){const t=this.field(e.popLast());Ef(t)&&t.mapValue.fields&&delete t.mapValue.fields[e.lastSegment()]}isEqual(e){return Ss(this.value,e.value)}getFieldsMap(e){let t=this.value;t.mapValue.fields||(t.mapValue={fields:{}});for(let r=0;r<e.length;++r){let s=t.mapValue.fields[e.get(r)];Ef(s)&&s.mapValue.fields||(s={mapValue:{fields:{}}},t.mapValue.fields[e.get(r)]=s),t=s}return t.mapValue.fields}applyChanges(e,t,r){po(t,(s,i)=>e[s]=i);for(const s of r)delete e[s]}clone(){return new En(Tu(this.value))}}function cN(n){const e=[];return po(n.fields,(t,r)=>{const s=new Dt([t]);if(Ef(r)){const i=cN(r.mapValue).fields;if(i.length===0)e.push(s);else for(const o of i)e.push(s.child(o))}else e.push(s)}),new Jn(e)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class xt{constructor(e,t,r,s,i,o,a){this.key=e,this.documentType=t,this.version=r,this.readTime=s,this.createTime=i,this.data=o,this.documentState=a}static newInvalidDocument(e){return new xt(e,0,ue.min(),ue.min(),ue.min(),En.empty(),0)}static newFoundDocument(e,t,r,s){return new xt(e,1,t,ue.min(),r,s,0)}static newNoDocument(e,t){return new xt(e,2,t,ue.min(),ue.min(),En.empty(),0)}static newUnknownDocument(e,t){return new xt(e,3,t,ue.min(),ue.min(),En.empty(),2)}convertToFoundDocument(e,t){return!this.createTime.isEqual(ue.min())||this.documentType!==2&&this.documentType!==0||(this.createTime=e),this.version=e,this.documentType=1,this.data=t,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=En.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=En.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=ue.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return this.documentState===1}get hasCommittedMutations(){return this.documentState===2}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return this.documentType!==0}isFoundDocument(){return this.documentType===1}isNoDocument(){return this.documentType===2}isUnknownDocument(){return this.documentType===3}isEqual(e){return e instanceof xt&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new xt(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ro{constructor(e,t){this.position=e,this.inclusive=t}}function VT(n,e,t){let r=0;for(let s=0;s<n.position.length;s++){const i=e[s],o=n.position[s];if(i.field.isKeyField()?r=X.comparator(X.fromName(o.referenceValue),t.key):r=no(o,t.data.field(i.field)),i.dir==="desc"&&(r*=-1),r!==0)break}return r}function FT(n,e){if(n===null)return e===null;if(e===null||n.inclusive!==e.inclusive||n.position.length!==e.position.length)return!1;for(let t=0;t<n.position.length;t++)if(!Ss(n.position[t],e.position[t]))return!1;return!0}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class pd{constructor(e,t="asc"){this.field=e,this.dir=t}}function I3(n,e){return n.dir===e.dir&&n.field.isEqual(e.field)}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class uN{}class qe extends uN{constructor(e,t,r){super(),this.field=e,this.op=t,this.value=r}static create(e,t,r){return e.isKeyField()?t==="in"||t==="not-in"?this.createKeyFieldInFilter(e,t,r):new E3(e,t,r):t==="array-contains"?new S3(e,r):t==="in"?new gN(e,r):t==="not-in"?new b3(e,r):t==="array-contains-any"?new A3(e,r):new qe(e,t,r)}static createKeyFieldInFilter(e,t,r){return t==="in"?new x3(e,r):new T3(e,r)}matches(e){const t=e.data.field(this.field);return this.op==="!="?t!==null&&t.nullValue===void 0&&this.matchesComparison(no(t,this.value)):t!==null&&to(this.value)===to(t)&&this.matchesComparison(no(t,this.value))}matchesComparison(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return e===0;case"!=":return e!==0;case">":return e>0;case">=":return e>=0;default:return se(47266,{operator:this.op})}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}}class st extends uN{constructor(e,t){super(),this.filters=e,this.op=t,this.Pe=null}static create(e,t){return new st(e,t)}matches(e){return ql(this)?this.filters.find(t=>!t.matches(e))===void 0:this.filters.find(t=>t.matches(e))!==void 0}getFlattenedFilters(){return this.Pe!==null||(this.Pe=this.filters.reduce((e,t)=>e.concat(t.getFlattenedFilters()),[])),this.Pe}getFilters(){return Object.assign([],this.filters)}}function ql(n){return n.op==="and"}function rv(n){return n.op==="or"}function gw(n){return dN(n)&&ql(n)}function dN(n){for(const e of n.filters)if(e instanceof st)return!1;return!0}function sv(n){if(n instanceof qe)return n.field.canonicalString()+n.op.toString()+zl(n.value);if(gw(n))return n.filters.map(e=>sv(e)).join(",");{const e=n.filters.map(t=>sv(t)).join(",");return`${n.op}(${e})`}}function hN(n,e){return n instanceof qe?function(r,s){return s instanceof qe&&r.op===s.op&&r.field.isEqual(s.field)&&Ss(r.value,s.value)}(n,e):n instanceof st?function(r,s){return s instanceof st&&r.op===s.op&&r.filters.length===s.filters.length?r.filters.reduce((i,o,a)=>i&&hN(o,s.filters[a]),!0):!1}(n,e):void se(19439)}function fN(n,e){const t=n.filters.concat(e);return st.create(t,n.op)}function pN(n){return n instanceof qe?function(t){return`${t.field.canonicalString()} ${t.op} ${zl(t.value)}`}(n):n instanceof st?function(t){return t.op.toString()+" {"+t.getFilters().map(pN).join(" ,")+"}"}(n):"Filter"}class E3 extends qe{constructor(e,t,r){super(e,t,r),this.key=X.fromName(r.referenceValue)}matches(e){const t=X.comparator(e.key,this.key);return this.matchesComparison(t)}}class x3 extends qe{constructor(e,t){super(e,"in",t),this.keys=mN("in",t)}matches(e){return this.keys.some(t=>t.isEqual(e.key))}}class T3 extends qe{constructor(e,t){super(e,"not-in",t),this.keys=mN("not-in",t)}matches(e){return!this.keys.some(t=>t.isEqual(e.key))}}function mN(n,e){var t;return(((t=e.arrayValue)==null?void 0:t.values)||[]).map(r=>X.fromName(r.referenceValue))}class S3 extends qe{constructor(e,t){super(e,"array-contains",t)}matches(e){const t=e.data.field(this.field);return fd(t)&&hd(t.arrayValue,this.value)}}class gN extends qe{constructor(e,t){super(e,"in",t)}matches(e){const t=e.data.field(this.field);return t!==null&&hd(this.value.arrayValue,t)}}class b3 extends qe{constructor(e,t){super(e,"not-in",t)}matches(e){if(hd(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;const t=e.data.field(this.field);return t!==null&&t.nullValue===void 0&&!hd(this.value.arrayValue,t)}}class A3 extends qe{constructor(e,t){super(e,"array-contains-any",t)}matches(e){const t=e.data.field(this.field);return!(!fd(t)||!t.arrayValue.values)&&t.arrayValue.values.some(r=>hd(this.value.arrayValue,r))}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class C3{constructor(e,t=null,r=[],s=[],i=null,o=null,a=null){this.path=e,this.collectionGroup=t,this.orderBy=r,this.filters=s,this.limit=i,this.startAt=o,this.endAt=a,this.Te=null}}function iv(n,e=null,t=[],r=[],s=null,i=null,o=null){return new C3(n,e,t,r,s,i,o)}function ia(n){const e=Z(n);if(e.Te===null){let t=e.path.canonicalString();e.collectionGroup!==null&&(t+="|cg:"+e.collectionGroup),t+="|f:",t+=e.filters.map(r=>sv(r)).join(","),t+="|ob:",t+=e.orderBy.map(r=>function(i){return i.field.canonicalString()+i.dir}(r)).join(","),zd(e.limit)||(t+="|l:",t+=e.limit),e.startAt&&(t+="|lb:",t+=e.startAt.inclusive?"b:":"a:",t+=e.startAt.position.map(r=>zl(r)).join(",")),e.endAt&&(t+="|ub:",t+=e.endAt.inclusive?"a:":"b:",t+=e.endAt.position.map(r=>zl(r)).join(",")),e.Te=t}return e.Te}function Wd(n,e){if(n.limit!==e.limit||n.orderBy.length!==e.orderBy.length)return!1;for(let t=0;t<n.orderBy.length;t++)if(!I3(n.orderBy[t],e.orderBy[t]))return!1;if(n.filters.length!==e.filters.length)return!1;for(let t=0;t<n.filters.length;t++)if(!hN(n.filters[t],e.filters[t]))return!1;return n.collectionGroup===e.collectionGroup&&!!n.path.isEqual(e.path)&&!!FT(n.startAt,e.startAt)&&FT(n.endAt,e.endAt)}function Tp(n){return X.isDocumentKey(n.path)&&n.collectionGroup===null&&n.filters.length===0}function Sp(n,e){return n.filters.filter(t=>t instanceof qe&&t.field.isEqual(e))}function jT(n,e,t){let r=wf,s=!0;for(const i of Sp(n,e)){let o=wf,a=!0;switch(i.op){case"<":case"<=":o=v3(i.value);break;case"==":case"in":case">=":o=i.value;break;case">":o=i.value,a=!1;break;case"!=":case"not-in":o=wf}MT({value:r,inclusive:s},{value:o,inclusive:a})<0&&(r=o,s=a)}if(t!==null){for(let i=0;i<n.orderBy.length;++i)if(n.orderBy[i].field.isEqual(e)){const o=t.position[i];MT({value:r,inclusive:s},{value:o,inclusive:t.inclusive})<0&&(r=o,s=t.inclusive);break}}return{value:r,inclusive:s}}function UT(n,e,t){let r=Ci,s=!0;for(const i of Sp(n,e)){let o=Ci,a=!0;switch(i.op){case">=":case">":o=w3(i.value),a=!1;break;case"==":case"in":case"<=":o=i.value;break;case"<":o=i.value,a=!1;break;case"!=":case"not-in":o=Ci}LT({value:r,inclusive:s},{value:o,inclusive:a})>0&&(r=o,s=a)}if(t!==null){for(let i=0;i<n.orderBy.length;++i)if(n.orderBy[i].field.isEqual(e)){const o=t.position[i];LT({value:r,inclusive:s},{value:o,inclusive:t.inclusive})>0&&(r=o,s=t.inclusive);break}}return{value:r,inclusive:s}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ni{constructor(e,t=null,r=[],s=[],i=null,o="F",a=null,l=null){this.path=e,this.collectionGroup=t,this.explicitOrderBy=r,this.filters=s,this.limit=i,this.limitType=o,this.startAt=a,this.endAt=l,this.Ie=null,this.Ee=null,this.de=null,this.startAt,this.endAt}}function yN(n,e,t,r,s,i,o,a){return new ni(n,e,t,r,s,i,o,a)}function cc(n){return new ni(n)}function BT(n){return n.filters.length===0&&n.limit===null&&n.startAt==null&&n.endAt==null&&(n.explicitOrderBy.length===0||n.explicitOrderBy.length===1&&n.explicitOrderBy[0].field.isKeyField())}function yw(n){return n.collectionGroup!==null}function pl(n){const e=Z(n);if(e.Ie===null){e.Ie=[];const t=new Set;for(const i of e.explicitOrderBy)e.Ie.push(i),t.add(i.field.canonicalString());const r=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc";(function(o){let a=new ot(Dt.comparator);return o.filters.forEach(l=>{l.getFlattenedFilters().forEach(u=>{u.isInequality()&&(a=a.add(u.field))})}),a})(e).forEach(i=>{t.has(i.canonicalString())||i.isKeyField()||e.Ie.push(new pd(i,r))}),t.has(Dt.keyField().canonicalString())||e.Ie.push(new pd(Dt.keyField(),r))}return e.Ie}function Mn(n){const e=Z(n);return e.Ee||(e.Ee=vN(e,pl(n))),e.Ee}function _N(n){const e=Z(n);return e.de||(e.de=vN(e,n.explicitOrderBy)),e.de}function vN(n,e){if(n.limitType==="F")return iv(n.path,n.collectionGroup,e,n.filters,n.limit,n.startAt,n.endAt);{e=e.map(s=>{const i=s.dir==="desc"?"asc":"desc";return new pd(s.field,i)});const t=n.endAt?new ro(n.endAt.position,n.endAt.inclusive):null,r=n.startAt?new ro(n.startAt.position,n.startAt.inclusive):null;return iv(n.path,n.collectionGroup,e,n.filters,n.limit,t,r)}}function ov(n,e){const t=n.filters.concat([e]);return new ni(n.path,n.collectionGroup,n.explicitOrderBy.slice(),t,n.limit,n.limitType,n.startAt,n.endAt)}function bp(n,e,t){return new ni(n.path,n.collectionGroup,n.explicitOrderBy.slice(),n.filters.slice(),e,t,n.startAt,n.endAt)}function Gd(n,e){return Wd(Mn(n),Mn(e))&&n.limitType===e.limitType}function wN(n){return`${ia(Mn(n))}|lt:${n.limitType}`}function qa(n){return`Query(target=${function(t){let r=t.path.canonicalString();return t.collectionGroup!==null&&(r+=" collectionGroup="+t.collectionGroup),t.filters.length>0&&(r+=`, filters: [${t.filters.map(s=>pN(s)).join(", ")}]`),zd(t.limit)||(r+=", limit: "+t.limit),t.orderBy.length>0&&(r+=`, orderBy: [${t.orderBy.map(s=>function(o){return`${o.field.canonicalString()} (${o.dir})`}(s)).join(", ")}]`),t.startAt&&(r+=", startAt: ",r+=t.startAt.inclusive?"b:":"a:",r+=t.startAt.position.map(s=>zl(s)).join(",")),t.endAt&&(r+=", endAt: ",r+=t.endAt.inclusive?"a:":"b:",r+=t.endAt.position.map(s=>zl(s)).join(",")),`Target(${r})`}(Mn(n))}; limitType=${n.limitType})`}function Hd(n,e){return e.isFoundDocument()&&function(r,s){const i=s.key.path;return r.collectionGroup!==null?s.key.hasCollectionId(r.collectionGroup)&&r.path.isPrefixOf(i):X.isDocumentKey(r.path)?r.path.isEqual(i):r.path.isImmediateParentOf(i)}(n,e)&&function(r,s){for(const i of pl(r))if(!i.field.isKeyField()&&s.data.field(i.field)===null)return!1;return!0}(n,e)&&function(r,s){for(const i of r.filters)if(!i.matches(s))return!1;return!0}(n,e)&&function(r,s){return!(r.startAt&&!function(o,a,l){const u=VT(o,a,l);return o.inclusive?u<=0:u<0}(r.startAt,pl(r),s)||r.endAt&&!function(o,a,l){const u=VT(o,a,l);return o.inclusive?u>=0:u>0}(r.endAt,pl(r),s))}(n,e)}function IN(n){return n.collectionGroup||(n.path.length%2==1?n.path.lastSegment():n.path.get(n.path.length-2))}function EN(n){return(e,t)=>{let r=!1;for(const s of pl(n)){const i=R3(s,e,t);if(i!==0)return i;r=r||s.field.isKeyField()}return 0}}function R3(n,e,t){const r=n.field.isKeyField()?X.comparator(e.key,t.key):function(i,o,a){const l=o.data.field(i),u=a.data.field(i);return l!==null&&u!==null?no(l,u):se(42886)}(n.field,e,t);switch(n.dir){case"asc":return r;case"desc":return-1*r;default:return se(19790,{direction:n.dir})}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ri{constructor(e,t){this.mapKeyFn=e,this.equalsFn=t,this.inner={},this.innerSize=0}get(e){const t=this.mapKeyFn(e),r=this.inner[t];if(r!==void 0){for(const[s,i]of r)if(this.equalsFn(s,e))return i}}has(e){return this.get(e)!==void 0}set(e,t){const r=this.mapKeyFn(e),s=this.inner[r];if(s===void 0)return this.inner[r]=[[e,t]],void this.innerSize++;for(let i=0;i<s.length;i++)if(this.equalsFn(s[i][0],e))return void(s[i]=[e,t]);s.push([e,t]),this.innerSize++}delete(e){const t=this.mapKeyFn(e),r=this.inner[t];if(r===void 0)return!1;for(let s=0;s<r.length;s++)if(this.equalsFn(r[s][0],e))return r.length===1?delete this.inner[t]:r.splice(s,1),this.innerSize--,!0;return!1}forEach(e){po(this.inner,(t,r)=>{for(const[s,i]of r)e(s,i)})}isEmpty(){return eN(this.inner)}size(){return this.innerSize}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const N3=new wt(X.comparator);function Xn(){return N3}const xN=new wt(X.comparator);function tu(...n){let e=xN;for(const t of n)e=e.insert(t.key,t);return e}function TN(n){let e=xN;return n.forEach((t,r)=>e=e.insert(t,r.overlayedDocument)),e}function ps(){return Su()}function SN(){return Su()}function Su(){return new ri(n=>n.toString(),(n,e)=>n.isEqual(e))}const P3=new wt(X.comparator),k3=new ot(X.comparator);function be(...n){let e=k3;for(const t of n)e=e.add(t);return e}const D3=new ot(ve);function _w(){return D3}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function vw(n,e){if(n.useProto3Json){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:od(e)?"-0":e}}function bN(n){return{integerValue:""+n}}function AN(n,e){return $R(e)?bN(e):vw(n,e)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Mm{constructor(){this._=void 0}}function O3(n,e,t){return n instanceof Wl?function(s,i){const o={fields:{[rN]:{stringValue:nN},[iN]:{timestampValue:{seconds:s.seconds,nanos:s.nanoseconds}}}};return i&&km(i)&&(i=Dm(i)),i&&(o.fields[sN]=i),{mapValue:o}}(t,e):n instanceof oa?RN(n,e):n instanceof aa?NN(n,e):function(s,i){const o=CN(s,i),a=$T(o)+$T(s.Ae);return nv(o)&&nv(s.Ae)?bN(a):vw(s.serializer,a)}(n,e)}function M3(n,e,t){return n instanceof oa?RN(n,e):n instanceof aa?NN(n,e):t}function CN(n,e){return n instanceof Gl?function(r){return nv(r)||function(i){return!!i&&"doubleValue"in i}(r)}(e)?e:{integerValue:0}:null}class Wl extends Mm{}class oa extends Mm{constructor(e){super(),this.elements=e}}function RN(n,e){const t=PN(e);for(const r of n.elements)t.some(s=>Ss(s,r))||t.push(r);return{arrayValue:{values:t}}}class aa extends Mm{constructor(e){super(),this.elements=e}}function NN(n,e){let t=PN(e);for(const r of n.elements)t=t.filter(s=>!Ss(s,r));return{arrayValue:{values:t}}}class Gl extends Mm{constructor(e,t){super(),this.serializer=e,this.Ae=t}}function $T(n){return Rt(n.integerValue||n.doubleValue)}function PN(n){return fd(n)&&n.arrayValue.values?n.arrayValue.values.slice():[]}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Kd{constructor(e,t){this.field=e,this.transform=t}}function L3(n,e){return n.field.isEqual(e.field)&&function(r,s){return r instanceof oa&&s instanceof oa||r instanceof aa&&s instanceof aa?Ol(r.elements,s.elements,Ss):r instanceof Gl&&s instanceof Gl?Ss(r.Ae,s.Ae):r instanceof Wl&&s instanceof Wl}(n.transform,e.transform)}class V3{constructor(e,t){this.version=e,this.transformResults=t}}class Ot{constructor(e,t){this.updateTime=e,this.exists=t}static none(){return new Ot}static exists(e){return new Ot(void 0,e)}static updateTime(e){return new Ot(e)}get isNone(){return this.updateTime===void 0&&this.exists===void 0}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}}function xf(n,e){return n.updateTime!==void 0?e.isFoundDocument()&&e.version.isEqual(n.updateTime):n.exists===void 0||n.exists===e.isFoundDocument()}class Lm{}function kN(n,e){if(!n.hasLocalMutations||e&&e.fields.length===0)return null;if(e===null)return n.isNoDocument()?new dc(n.key,Ot.none()):new uc(n.key,n.data,Ot.none());{const t=n.data,r=En.empty();let s=new ot(Dt.comparator);for(let i of e.fields)if(!s.has(i)){let o=t.field(i);o===null&&i.length>1&&(i=i.popLast(),o=t.field(i)),o===null?r.delete(i):r.set(i,o),s=s.add(i)}return new si(n.key,r,new Jn(s.toArray()),Ot.none())}}function F3(n,e,t){n instanceof uc?function(s,i,o){const a=s.value.clone(),l=qT(s.fieldTransforms,i,o.transformResults);a.setAll(l),i.convertToFoundDocument(o.version,a).setHasCommittedMutations()}(n,e,t):n instanceof si?function(s,i,o){if(!xf(s.precondition,i))return void i.convertToUnknownDocument(o.version);const a=qT(s.fieldTransforms,i,o.transformResults),l=i.data;l.setAll(DN(s)),l.setAll(a),i.convertToFoundDocument(o.version,l).setHasCommittedMutations()}(n,e,t):function(s,i,o){i.convertToNoDocument(o.version).setHasCommittedMutations()}(0,e,t)}function bu(n,e,t,r){return n instanceof uc?function(i,o,a,l){if(!xf(i.precondition,o))return a;const u=i.value.clone(),h=WT(i.fieldTransforms,l,o);return u.setAll(h),o.convertToFoundDocument(o.version,u).setHasLocalMutations(),null}(n,e,t,r):n instanceof si?function(i,o,a,l){if(!xf(i.precondition,o))return a;const u=WT(i.fieldTransforms,l,o),h=o.data;return h.setAll(DN(i)),h.setAll(u),o.convertToFoundDocument(o.version,h).setHasLocalMutations(),a===null?null:a.unionWith(i.fieldMask.fields).unionWith(i.fieldTransforms.map(f=>f.field))}(n,e,t,r):function(i,o,a){return xf(i.precondition,o)?(o.convertToNoDocument(o.version).setHasLocalMutations(),null):a}(n,e,t)}function j3(n,e){let t=null;for(const r of n.fieldTransforms){const s=e.data.field(r.field),i=CN(r.transform,s||null);i!=null&&(t===null&&(t=En.empty()),t.set(r.field,i))}return t||null}function zT(n,e){return n.type===e.type&&!!n.key.isEqual(e.key)&&!!n.precondition.isEqual(e.precondition)&&!!function(r,s){return r===void 0&&s===void 0||!(!r||!s)&&Ol(r,s,(i,o)=>L3(i,o))}(n.fieldTransforms,e.fieldTransforms)&&(n.type===0?n.value.isEqual(e.value):n.type!==1||n.data.isEqual(e.data)&&n.fieldMask.isEqual(e.fieldMask))}class uc extends Lm{constructor(e,t,r,s=[]){super(),this.key=e,this.value=t,this.precondition=r,this.fieldTransforms=s,this.type=0}getFieldMask(){return null}}class si extends Lm{constructor(e,t,r,s,i=[]){super(),this.key=e,this.data=t,this.fieldMask=r,this.precondition=s,this.fieldTransforms=i,this.type=1}getFieldMask(){return this.fieldMask}}function DN(n){const e=new Map;return n.fieldMask.fields.forEach(t=>{if(!t.isEmpty()){const r=n.data.field(t);e.set(t,r)}}),e}function qT(n,e,t){const r=new Map;ae(n.length===t.length,32656,{Re:t.length,Ve:n.length});for(let s=0;s<t.length;s++){const i=n[s],o=i.transform,a=e.data.field(i.field);r.set(i.field,M3(o,a,t[s]))}return r}function WT(n,e,t){const r=new Map;for(const s of n){const i=s.transform,o=t.data.field(s.field);r.set(s.field,O3(i,o,e))}return r}class dc extends Lm{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class ww extends Lm{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Iw{constructor(e,t,r,s){this.batchId=e,this.localWriteTime=t,this.baseMutations=r,this.mutations=s}applyToRemoteDocument(e,t){const r=t.mutationResults;for(let s=0;s<this.mutations.length;s++){const i=this.mutations[s];i.key.isEqual(e.key)&&F3(i,e,r[s])}}applyToLocalView(e,t){for(const r of this.baseMutations)r.key.isEqual(e.key)&&(t=bu(r,e,t,this.localWriteTime));for(const r of this.mutations)r.key.isEqual(e.key)&&(t=bu(r,e,t,this.localWriteTime));return t}applyToLocalDocumentSet(e,t){const r=SN();return this.mutations.forEach(s=>{const i=e.get(s.key),o=i.overlayedDocument;let a=this.applyToLocalView(o,i.mutatedFields);a=t.has(s.key)?null:a;const l=kN(o,a);l!==null&&r.set(s.key,l),o.isValidDocument()||o.convertToNoDocument(ue.min())}),r}keys(){return this.mutations.reduce((e,t)=>e.add(t.key),be())}isEqual(e){return this.batchId===e.batchId&&Ol(this.mutations,e.mutations,(t,r)=>zT(t,r))&&Ol(this.baseMutations,e.baseMutations,(t,r)=>zT(t,r))}}class Ew{constructor(e,t,r,s){this.batch=e,this.commitVersion=t,this.mutationResults=r,this.docVersions=s}static from(e,t,r){ae(e.mutations.length===r.length,58842,{me:e.mutations.length,fe:r.length});let s=function(){return P3}();const i=e.mutations;for(let o=0;o<i.length;o++)s=s.insert(i[o].key,r[o].version);return new Ew(e,t,r,s)}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class xw{constructor(e,t){this.largestBatchId=e,this.mutation=t}getKey(){return this.mutation.key}isEqual(e){return e!==null&&this.mutation===e.mutation}toString(){return`Overlay{
      largestBatchId: ${this.largestBatchId},
      mutation: ${this.mutation.toString()}
    }`}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ON{constructor(e,t,r){this.alias=e,this.aggregateType=t,this.fieldPath=r}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class U3{constructor(e,t){this.count=e,this.unchangedNames=t}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Kt,He;function MN(n){switch(n){case V.OK:return se(64938);case V.CANCELLED:case V.UNKNOWN:case V.DEADLINE_EXCEEDED:case V.RESOURCE_EXHAUSTED:case V.INTERNAL:case V.UNAVAILABLE:case V.UNAUTHENTICATED:return!1;case V.INVALID_ARGUMENT:case V.NOT_FOUND:case V.ALREADY_EXISTS:case V.PERMISSION_DENIED:case V.FAILED_PRECONDITION:case V.ABORTED:case V.OUT_OF_RANGE:case V.UNIMPLEMENTED:case V.DATA_LOSS:return!0;default:return se(15467,{code:n})}}function LN(n){if(n===void 0)return Gt("GRPC error has no .code"),V.UNKNOWN;switch(n){case Kt.OK:return V.OK;case Kt.CANCELLED:return V.CANCELLED;case Kt.UNKNOWN:return V.UNKNOWN;case Kt.DEADLINE_EXCEEDED:return V.DEADLINE_EXCEEDED;case Kt.RESOURCE_EXHAUSTED:return V.RESOURCE_EXHAUSTED;case Kt.INTERNAL:return V.INTERNAL;case Kt.UNAVAILABLE:return V.UNAVAILABLE;case Kt.UNAUTHENTICATED:return V.UNAUTHENTICATED;case Kt.INVALID_ARGUMENT:return V.INVALID_ARGUMENT;case Kt.NOT_FOUND:return V.NOT_FOUND;case Kt.ALREADY_EXISTS:return V.ALREADY_EXISTS;case Kt.PERMISSION_DENIED:return V.PERMISSION_DENIED;case Kt.FAILED_PRECONDITION:return V.FAILED_PRECONDITION;case Kt.ABORTED:return V.ABORTED;case Kt.OUT_OF_RANGE:return V.OUT_OF_RANGE;case Kt.UNIMPLEMENTED:return V.UNIMPLEMENTED;case Kt.DATA_LOSS:return V.DATA_LOSS;default:return se(39323,{code:n})}}(He=Kt||(Kt={}))[He.OK=0]="OK",He[He.CANCELLED=1]="CANCELLED",He[He.UNKNOWN=2]="UNKNOWN",He[He.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",He[He.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",He[He.NOT_FOUND=5]="NOT_FOUND",He[He.ALREADY_EXISTS=6]="ALREADY_EXISTS",He[He.PERMISSION_DENIED=7]="PERMISSION_DENIED",He[He.UNAUTHENTICATED=16]="UNAUTHENTICATED",He[He.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",He[He.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",He[He.ABORTED=10]="ABORTED",He[He.OUT_OF_RANGE=11]="OUT_OF_RANGE",He[He.UNIMPLEMENTED=12]="UNIMPLEMENTED",He[He.INTERNAL=13]="INTERNAL",He[He.UNAVAILABLE=14]="UNAVAILABLE",He[He.DATA_LOSS=15]="DATA_LOSS";/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Au=null;/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function VN(){return new TextEncoder}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const B3=new qi([4294967295,4294967295],0);function GT(n){const e=VN().encode(n),t=new bR;return t.update(e),new Uint8Array(t.digest())}function HT(n){const e=new DataView(n.buffer),t=e.getUint32(0,!0),r=e.getUint32(4,!0),s=e.getUint32(8,!0),i=e.getUint32(12,!0);return[new qi([t,r],0),new qi([s,i],0)]}class Tw{constructor(e,t,r){if(this.bitmap=e,this.padding=t,this.hashCount=r,t<0||t>=8)throw new nu(`Invalid padding: ${t}`);if(r<0)throw new nu(`Invalid hash count: ${r}`);if(e.length>0&&this.hashCount===0)throw new nu(`Invalid hash count: ${r}`);if(e.length===0&&t!==0)throw new nu(`Invalid padding when bitmap length is 0: ${t}`);this.ge=8*e.length-t,this.pe=qi.fromNumber(this.ge)}ye(e,t,r){let s=e.add(t.multiply(qi.fromNumber(r)));return s.compare(B3)===1&&(s=new qi([s.getBits(0),s.getBits(1)],0)),s.modulo(this.pe).toNumber()}we(e){return!!(this.bitmap[Math.floor(e/8)]&1<<e%8)}mightContain(e){if(this.ge===0)return!1;const t=GT(e),[r,s]=HT(t);for(let i=0;i<this.hashCount;i++){const o=this.ye(r,s,i);if(!this.we(o))return!1}return!0}static create(e,t,r){const s=e%8==0?0:8-e%8,i=new Uint8Array(Math.ceil(e/8)),o=new Tw(i,s,t);return r.forEach(a=>o.insert(a)),o}insert(e){if(this.ge===0)return;const t=GT(e),[r,s]=HT(t);for(let i=0;i<this.hashCount;i++){const o=this.ye(r,s,i);this.Se(o)}}Se(e){const t=Math.floor(e/8),r=e%8;this.bitmap[t]|=1<<r}}class nu extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Qd{constructor(e,t,r,s,i){this.snapshotVersion=e,this.targetChanges=t,this.targetMismatches=r,this.documentUpdates=s,this.resolvedLimboDocuments=i}static createSynthesizedRemoteEventForCurrentChange(e,t,r){const s=new Map;return s.set(e,Yd.createSynthesizedTargetChangeForCurrentChange(e,t,r)),new Qd(ue.min(),s,new wt(ve),Xn(),be())}}class Yd{constructor(e,t,r,s,i){this.resumeToken=e,this.current=t,this.addedDocuments=r,this.modifiedDocuments=s,this.removedDocuments=i}static createSynthesizedTargetChangeForCurrentChange(e,t,r){return new Yd(r,t,be(),be(),be())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Tf{constructor(e,t,r,s){this.be=e,this.removedTargetIds=t,this.key=r,this.De=s}}class FN{constructor(e,t){this.targetId=e,this.Ce=t}}class jN{constructor(e,t,r=$t.EMPTY_BYTE_STRING,s=null){this.state=e,this.targetIds=t,this.resumeToken=r,this.cause=s}}class KT{constructor(){this.ve=0,this.Fe=QT(),this.Me=$t.EMPTY_BYTE_STRING,this.xe=!1,this.Oe=!0}get current(){return this.xe}get resumeToken(){return this.Me}get Ne(){return this.ve!==0}get Be(){return this.Oe}Le(e){e.approximateByteSize()>0&&(this.Oe=!0,this.Me=e)}ke(){let e=be(),t=be(),r=be();return this.Fe.forEach((s,i)=>{switch(i){case 0:e=e.add(s);break;case 2:t=t.add(s);break;case 1:r=r.add(s);break;default:se(38017,{changeType:i})}}),new Yd(this.Me,this.xe,e,t,r)}qe(){this.Oe=!1,this.Fe=QT()}Qe(e,t){this.Oe=!0,this.Fe=this.Fe.insert(e,t)}$e(e){this.Oe=!0,this.Fe=this.Fe.remove(e)}Ue(){this.ve+=1}Ke(){this.ve-=1,ae(this.ve>=0,3241,{ve:this.ve})}We(){this.Oe=!0,this.xe=!0}}class $3{constructor(e){this.Ge=e,this.ze=new Map,this.je=Xn(),this.Je=Wh(),this.He=Wh(),this.Ye=new wt(ve)}Ze(e){for(const t of e.be)e.De&&e.De.isFoundDocument()?this.Xe(t,e.De):this.et(t,e.key,e.De);for(const t of e.removedTargetIds)this.et(t,e.key,e.De)}tt(e){this.forEachTarget(e,t=>{const r=this.nt(t);switch(e.state){case 0:this.rt(t)&&r.Le(e.resumeToken);break;case 1:r.Ke(),r.Ne||r.qe(),r.Le(e.resumeToken);break;case 2:r.Ke(),r.Ne||this.removeTarget(t);break;case 3:this.rt(t)&&(r.We(),r.Le(e.resumeToken));break;case 4:this.rt(t)&&(this.it(t),r.Le(e.resumeToken));break;default:se(56790,{state:e.state})}})}forEachTarget(e,t){e.targetIds.length>0?e.targetIds.forEach(t):this.ze.forEach((r,s)=>{this.rt(s)&&t(s)})}st(e){const t=e.targetId,r=e.Ce.count,s=this.ot(t);if(s){const i=s.target;if(Tp(i))if(r===0){const o=new X(i.path);this.et(t,o,xt.newNoDocument(o,ue.min()))}else ae(r===1,20013,{expectedCount:r});else{const o=this._t(t);if(o!==r){const a=this.ut(e),l=a?this.ct(a,e,o):1;if(l!==0){this.it(t);const u=l===2?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.Ye=this.Ye.insert(t,u)}Au==null||Au.lt(function(h,f,p,y,I){var A,T,R;const C={localCacheCount:h,existenceFilterCount:f.count,databaseId:p.database,projectId:p.projectId},P=f.unchangedNames;return P&&(C.bloomFilter={applied:I===0,hashCount:(P==null?void 0:P.hashCount)??0,bitmapLength:((T=(A=P==null?void 0:P.bits)==null?void 0:A.bitmap)==null?void 0:T.length)??0,padding:((R=P==null?void 0:P.bits)==null?void 0:R.padding)??0,mightContain:D=>(y==null?void 0:y.mightContain(D))??!1}),C}(o,e.Ce,this.Ge.ht(),a,l))}}}}ut(e){const t=e.Ce.unchangedNames;if(!t||!t.bits)return null;const{bits:{bitmap:r="",padding:s=0},hashCount:i=0}=t;let o,a;try{o=Ys(r).toUint8Array()}catch(l){if(l instanceof tN)return Vr("Decoding the base64 bloom filter in existence filter failed ("+l.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw l}try{a=new Tw(o,s,i)}catch(l){return Vr(l instanceof nu?"BloomFilter error: ":"Applying bloom filter failed: ",l),null}return a.ge===0?null:a}ct(e,t,r){return t.Ce.count===r-this.Pt(e,t.targetId)?0:2}Pt(e,t){const r=this.Ge.getRemoteKeysForTarget(t);let s=0;return r.forEach(i=>{const o=this.Ge.ht(),a=`projects/${o.projectId}/databases/${o.database}/documents/${i.path.canonicalString()}`;e.mightContain(a)||(this.et(t,i,null),s++)}),s}Tt(e){const t=new Map;this.ze.forEach((i,o)=>{const a=this.ot(o);if(a){if(i.current&&Tp(a.target)){const l=new X(a.target.path);this.It(l).has(o)||this.Et(o,l)||this.et(o,l,xt.newNoDocument(l,e))}i.Be&&(t.set(o,i.ke()),i.qe())}});let r=be();this.He.forEach((i,o)=>{let a=!0;o.forEachWhile(l=>{const u=this.ot(l);return!u||u.purpose==="TargetPurposeLimboResolution"||(a=!1,!1)}),a&&(r=r.add(i))}),this.je.forEach((i,o)=>o.setReadTime(e));const s=new Qd(e,t,this.Ye,this.je,r);return this.je=Xn(),this.Je=Wh(),this.He=Wh(),this.Ye=new wt(ve),s}Xe(e,t){if(!this.rt(e))return;const r=this.Et(e,t.key)?2:0;this.nt(e).Qe(t.key,r),this.je=this.je.insert(t.key,t),this.Je=this.Je.insert(t.key,this.It(t.key).add(e)),this.He=this.He.insert(t.key,this.dt(t.key).add(e))}et(e,t,r){if(!this.rt(e))return;const s=this.nt(e);this.Et(e,t)?s.Qe(t,1):s.$e(t),this.He=this.He.insert(t,this.dt(t).delete(e)),this.He=this.He.insert(t,this.dt(t).add(e)),r&&(this.je=this.je.insert(t,r))}removeTarget(e){this.ze.delete(e)}_t(e){const t=this.nt(e).ke();return this.Ge.getRemoteKeysForTarget(e).size+t.addedDocuments.size-t.removedDocuments.size}Ue(e){this.nt(e).Ue()}nt(e){let t=this.ze.get(e);return t||(t=new KT,this.ze.set(e,t)),t}dt(e){let t=this.He.get(e);return t||(t=new ot(ve),this.He=this.He.insert(e,t)),t}It(e){let t=this.Je.get(e);return t||(t=new ot(ve),this.Je=this.Je.insert(e,t)),t}rt(e){const t=this.ot(e)!==null;return t||q("WatchChangeAggregator","Detected inactive target",e),t}ot(e){const t=this.ze.get(e);return t&&t.Ne?null:this.Ge.At(e)}it(e){this.ze.set(e,new KT),this.Ge.getRemoteKeysForTarget(e).forEach(t=>{this.et(e,t,null)})}Et(e,t){return this.Ge.getRemoteKeysForTarget(e).has(t)}}function Wh(){return new wt(X.comparator)}function QT(){return new wt(X.comparator)}const z3=(()=>({asc:"ASCENDING",desc:"DESCENDING"}))(),q3=(()=>({"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"}))(),W3=(()=>({and:"AND",or:"OR"}))();class G3{constructor(e,t){this.databaseId=e,this.useProto3Json=t}}function av(n,e){return n.useProto3Json||zd(e)?e:{value:e}}function Hl(n,e){return n.useProto3Json?`${new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+e.nanoseconds).slice(-9)}Z`:{seconds:""+e.seconds,nanos:e.nanoseconds}}function UN(n,e){return n.useProto3Json?e.toBase64():e.toUint8Array()}function H3(n,e){return Hl(n,e.toTimestamp())}function Ht(n){return ae(!!n,49232),ue.fromTimestamp(function(t){const r=Qs(t);return new rt(r.seconds,r.nanos)}(n))}function Sw(n,e){return lv(n,e).canonicalString()}function lv(n,e){const t=function(s){return new Ve(["projects",s.projectId,"databases",s.database])}(n).child("documents");return e===void 0?t:t.child(e)}function BN(n){const e=Ve.fromString(n);return ae(YN(e),10190,{key:e.toString()}),e}function md(n,e){return Sw(n.databaseId,e.path)}function ws(n,e){const t=BN(e);if(t.get(1)!==n.databaseId.projectId)throw new z(V.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+t.get(1)+" vs "+n.databaseId.projectId);if(t.get(3)!==n.databaseId.database)throw new z(V.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+t.get(3)+" vs "+n.databaseId.database);return new X(qN(t))}function $N(n,e){return Sw(n.databaseId,e)}function zN(n){const e=BN(n);return e.length===4?Ve.emptyPath():qN(e)}function cv(n){return new Ve(["projects",n.databaseId.projectId,"databases",n.databaseId.database]).canonicalString()}function qN(n){return ae(n.length>4&&n.get(4)==="documents",29091,{key:n.toString()}),n.popFirst(5)}function YT(n,e,t){return{name:md(n,e),fields:t.value.mapValue.fields}}function Vm(n,e,t){const r=ws(n,e.name),s=Ht(e.updateTime),i=e.createTime?Ht(e.createTime):ue.min(),o=new En({mapValue:{fields:e.fields}}),a=xt.newFoundDocument(r,s,i,o);return t&&a.setHasCommittedMutations(),t?a.setHasCommittedMutations():a}function K3(n,e){return"found"in e?function(r,s){ae(!!s.found,43571),s.found.name,s.found.updateTime;const i=ws(r,s.found.name),o=Ht(s.found.updateTime),a=s.found.createTime?Ht(s.found.createTime):ue.min(),l=new En({mapValue:{fields:s.found.fields}});return xt.newFoundDocument(i,o,a,l)}(n,e):"missing"in e?function(r,s){ae(!!s.missing,3894),ae(!!s.readTime,22933);const i=ws(r,s.missing),o=Ht(s.readTime);return xt.newNoDocument(i,o)}(n,e):se(7234,{result:e})}function Q3(n,e){let t;if("targetChange"in e){e.targetChange;const r=function(u){return u==="NO_CHANGE"?0:u==="ADD"?1:u==="REMOVE"?2:u==="CURRENT"?3:u==="RESET"?4:se(39313,{state:u})}(e.targetChange.targetChangeType||"NO_CHANGE"),s=e.targetChange.targetIds||[],i=function(u,h){return u.useProto3Json?(ae(h===void 0||typeof h=="string",58123),$t.fromBase64String(h||"")):(ae(h===void 0||h instanceof Buffer||h instanceof Uint8Array,16193),$t.fromUint8Array(h||new Uint8Array))}(n,e.targetChange.resumeToken),o=e.targetChange.cause,a=o&&function(u){const h=u.code===void 0?V.UNKNOWN:LN(u.code);return new z(h,u.message||"")}(o);t=new jN(r,s,i,a||null)}else if("documentChange"in e){e.documentChange;const r=e.documentChange;r.document,r.document.name,r.document.updateTime;const s=ws(n,r.document.name),i=Ht(r.document.updateTime),o=r.document.createTime?Ht(r.document.createTime):ue.min(),a=new En({mapValue:{fields:r.document.fields}}),l=xt.newFoundDocument(s,i,o,a),u=r.targetIds||[],h=r.removedTargetIds||[];t=new Tf(u,h,l.key,l)}else if("documentDelete"in e){e.documentDelete;const r=e.documentDelete;r.document;const s=ws(n,r.document),i=r.readTime?Ht(r.readTime):ue.min(),o=xt.newNoDocument(s,i),a=r.removedTargetIds||[];t=new Tf([],a,o.key,o)}else if("documentRemove"in e){e.documentRemove;const r=e.documentRemove;r.document;const s=ws(n,r.document),i=r.removedTargetIds||[];t=new Tf([],i,s,null)}else{if(!("filter"in e))return se(11601,{Rt:e});{e.filter;const r=e.filter;r.targetId;const{count:s=0,unchangedNames:i}=r,o=new U3(s,i),a=r.targetId;t=new FN(a,o)}}return t}function gd(n,e){let t;if(e instanceof uc)t={update:YT(n,e.key,e.value)};else if(e instanceof dc)t={delete:md(n,e.key)};else if(e instanceof si)t={update:YT(n,e.key,e.data),updateMask:t6(e.fieldMask)};else{if(!(e instanceof ww))return se(16599,{Vt:e.type});t={verify:md(n,e.key)}}return e.fieldTransforms.length>0&&(t.updateTransforms=e.fieldTransforms.map(r=>function(i,o){const a=o.transform;if(a instanceof Wl)return{fieldPath:o.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(a instanceof oa)return{fieldPath:o.field.canonicalString(),appendMissingElements:{values:a.elements}};if(a instanceof aa)return{fieldPath:o.field.canonicalString(),removeAllFromArray:{values:a.elements}};if(a instanceof Gl)return{fieldPath:o.field.canonicalString(),increment:a.Ae};throw se(20930,{transform:o.transform})}(0,r))),e.precondition.isNone||(t.currentDocument=function(s,i){return i.updateTime!==void 0?{updateTime:H3(s,i.updateTime)}:i.exists!==void 0?{exists:i.exists}:se(27497)}(n,e.precondition)),t}function uv(n,e){const t=e.currentDocument?function(i){return i.updateTime!==void 0?Ot.updateTime(Ht(i.updateTime)):i.exists!==void 0?Ot.exists(i.exists):Ot.none()}(e.currentDocument):Ot.none(),r=e.updateTransforms?e.updateTransforms.map(s=>function(o,a){let l=null;if("setToServerValue"in a)ae(a.setToServerValue==="REQUEST_TIME",16630,{proto:a}),l=new Wl;else if("appendMissingElements"in a){const h=a.appendMissingElements.values||[];l=new oa(h)}else if("removeAllFromArray"in a){const h=a.removeAllFromArray.values||[];l=new aa(h)}else"increment"in a?l=new Gl(o,a.increment):se(16584,{proto:a});const u=Dt.fromServerFormat(a.fieldPath);return new Kd(u,l)}(n,s)):[];if(e.update){e.update.name;const s=ws(n,e.update.name),i=new En({mapValue:{fields:e.update.fields}});if(e.updateMask){const o=function(l){const u=l.fieldPaths||[];return new Jn(u.map(h=>Dt.fromServerFormat(h)))}(e.updateMask);return new si(s,i,o,t,r)}return new uc(s,i,t,r)}if(e.delete){const s=ws(n,e.delete);return new dc(s,t)}if(e.verify){const s=ws(n,e.verify);return new ww(s,t)}return se(1463,{proto:e})}function Y3(n,e){return n&&n.length>0?(ae(e!==void 0,14353),n.map(t=>function(s,i){let o=s.updateTime?Ht(s.updateTime):Ht(i);return o.isEqual(ue.min())&&(o=Ht(i)),new V3(o,s.transformResults||[])}(t,e))):[]}function WN(n,e){return{documents:[$N(n,e.path)]}}function Fm(n,e){const t={structuredQuery:{}},r=e.path;let s;e.collectionGroup!==null?(s=r,t.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(s=r.popLast(),t.structuredQuery.from=[{collectionId:r.lastSegment()}]),t.parent=$N(n,s);const i=function(u){if(u.length!==0)return QN(st.create(u,"and"))}(e.filters);i&&(t.structuredQuery.where=i);const o=function(u){if(u.length!==0)return u.map(h=>function(p){return{field:vi(p.field),direction:X3(p.dir)}}(h))}(e.orderBy);o&&(t.structuredQuery.orderBy=o);const a=av(n,e.limit);return a!==null&&(t.structuredQuery.limit=a),e.startAt&&(t.structuredQuery.startAt=function(u){return{before:u.inclusive,values:u.position}}(e.startAt)),e.endAt&&(t.structuredQuery.endAt=function(u){return{before:!u.inclusive,values:u.position}}(e.endAt)),{ft:t,parent:s}}function GN(n,e,t,r){const{ft:s,parent:i}=Fm(n,e),o={},a=[];let l=0;return t.forEach(u=>{const h=r?u.alias:"aggregate_"+l++;o[h]=u.alias,u.aggregateType==="count"?a.push({alias:h,count:{}}):u.aggregateType==="avg"?a.push({alias:h,avg:{field:vi(u.fieldPath)}}):u.aggregateType==="sum"&&a.push({alias:h,sum:{field:vi(u.fieldPath)}})}),{request:{structuredAggregationQuery:{aggregations:a,structuredQuery:s.structuredQuery},parent:s.parent},gt:o,parent:i}}function HN(n){let e=zN(n.parent);const t=n.structuredQuery,r=t.from?t.from.length:0;let s=null;if(r>0){ae(r===1,65062);const h=t.from[0];h.allDescendants?s=h.collectionId:e=e.child(h.collectionId)}let i=[];t.where&&(i=function(f){const p=KN(f);return p instanceof st&&gw(p)?p.getFilters():[p]}(t.where));let o=[];t.orderBy&&(o=function(f){return f.map(p=>function(I){return new pd(Wa(I.field),function(P){switch(P){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(I.direction))}(p))}(t.orderBy));let a=null;t.limit&&(a=function(f){let p;return p=typeof f=="object"?f.value:f,zd(p)?null:p}(t.limit));let l=null;t.startAt&&(l=function(f){const p=!!f.before,y=f.values||[];return new ro(y,p)}(t.startAt));let u=null;return t.endAt&&(u=function(f){const p=!f.before,y=f.values||[];return new ro(y,p)}(t.endAt)),yN(e,s,o,i,a,"F",l,u)}function J3(n,e){const t=function(s){switch(s){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return se(28987,{purpose:s})}}(e.purpose);return t==null?null:{"goog-listen-tags":t}}function KN(n){return n.unaryFilter!==void 0?function(t){switch(t.unaryFilter.op){case"IS_NAN":const r=Wa(t.unaryFilter.field);return qe.create(r,"==",{doubleValue:NaN});case"IS_NULL":const s=Wa(t.unaryFilter.field);return qe.create(s,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const i=Wa(t.unaryFilter.field);return qe.create(i,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const o=Wa(t.unaryFilter.field);return qe.create(o,"!=",{nullValue:"NULL_VALUE"});case"OPERATOR_UNSPECIFIED":return se(61313);default:return se(60726)}}(n):n.fieldFilter!==void 0?function(t){return qe.create(Wa(t.fieldFilter.field),function(s){switch(s){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";case"OPERATOR_UNSPECIFIED":return se(58110);default:return se(50506)}}(t.fieldFilter.op),t.fieldFilter.value)}(n):n.compositeFilter!==void 0?function(t){return st.create(t.compositeFilter.filters.map(r=>KN(r)),function(s){switch(s){case"AND":return"and";case"OR":return"or";default:return se(1026)}}(t.compositeFilter.op))}(n):se(30097,{filter:n})}function X3(n){return z3[n]}function Z3(n){return q3[n]}function e6(n){return W3[n]}function vi(n){return{fieldPath:n.canonicalString()}}function Wa(n){return Dt.fromServerFormat(n.fieldPath)}function QN(n){return n instanceof qe?function(t){if(t.op==="=="){if(OT(t.value))return{unaryFilter:{field:vi(t.field),op:"IS_NAN"}};if(DT(t.value))return{unaryFilter:{field:vi(t.field),op:"IS_NULL"}}}else if(t.op==="!="){if(OT(t.value))return{unaryFilter:{field:vi(t.field),op:"IS_NOT_NAN"}};if(DT(t.value))return{unaryFilter:{field:vi(t.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:vi(t.field),op:Z3(t.op),value:t.value}}}(n):n instanceof st?function(t){const r=t.getFilters().map(s=>QN(s));return r.length===1?r[0]:{compositeFilter:{op:e6(t.op),filters:r}}}(n):se(54877,{filter:n})}function t6(n){const e=[];return n.fields.forEach(t=>e.push(t.canonicalString())),{fieldPaths:e}}function YN(n){return n.length>=4&&n.get(0)==="projects"&&n.get(2)==="databases"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Fs{constructor(e,t,r,s,i=ue.min(),o=ue.min(),a=$t.EMPTY_BYTE_STRING,l=null){this.target=e,this.targetId=t,this.purpose=r,this.sequenceNumber=s,this.snapshotVersion=i,this.lastLimboFreeSnapshotVersion=o,this.resumeToken=a,this.expectedCount=l}withSequenceNumber(e){return new Fs(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(e,t){return new Fs(this.target,this.targetId,this.purpose,this.sequenceNumber,t,this.lastLimboFreeSnapshotVersion,e,null)}withExpectedCount(e){return new Fs(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,e)}withLastLimboFreeSnapshotVersion(e){return new Fs(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken,this.expectedCount)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class JN{constructor(e){this.yt=e}}function n6(n,e){let t;if(e.document)t=Vm(n.yt,e.document,!!e.hasCommittedMutations);else if(e.noDocument){const r=X.fromSegments(e.noDocument.path),s=ca(e.noDocument.readTime);t=xt.newNoDocument(r,s),e.hasCommittedMutations&&t.setHasCommittedMutations()}else{if(!e.unknownDocument)return se(56709);{const r=X.fromSegments(e.unknownDocument.path),s=ca(e.unknownDocument.version);t=xt.newUnknownDocument(r,s)}}return e.readTime&&t.setReadTime(function(s){const i=new rt(s[0],s[1]);return ue.fromTimestamp(i)}(e.readTime)),t}function JT(n,e){const t=e.key,r={prefixPath:t.getCollectionPath().popLast().toArray(),collectionGroup:t.collectionGroup,documentId:t.path.lastSegment(),readTime:Ap(e.readTime),hasCommittedMutations:e.hasCommittedMutations};if(e.isFoundDocument())r.document=function(i,o){return{name:md(i,o.key),fields:o.data.value.mapValue.fields,updateTime:Hl(i,o.version.toTimestamp()),createTime:Hl(i,o.createTime.toTimestamp())}}(n.yt,e);else if(e.isNoDocument())r.noDocument={path:t.path.toArray(),readTime:la(e.version)};else{if(!e.isUnknownDocument())return se(57904,{document:e});r.unknownDocument={path:t.path.toArray(),version:la(e.version)}}return r}function Ap(n){const e=n.toTimestamp();return[e.seconds,e.nanoseconds]}function la(n){const e=n.toTimestamp();return{seconds:e.seconds,nanoseconds:e.nanoseconds}}function ca(n){const e=new rt(n.seconds,n.nanoseconds);return ue.fromTimestamp(e)}function No(n,e){const t=(e.baseMutations||[]).map(i=>uv(n.yt,i));for(let i=0;i<e.mutations.length-1;++i){const o=e.mutations[i];if(i+1<e.mutations.length&&e.mutations[i+1].transform!==void 0){const a=e.mutations[i+1];o.updateTransforms=a.transform.fieldTransforms,e.mutations.splice(i+1,1),++i}}const r=e.mutations.map(i=>uv(n.yt,i)),s=rt.fromMillis(e.localWriteTimeMs);return new Iw(e.batchId,s,t,r)}function ru(n){const e=ca(n.readTime),t=n.lastLimboFreeSnapshotVersion!==void 0?ca(n.lastLimboFreeSnapshotVersion):ue.min();let r;return r=function(i){return i.documents!==void 0}(n.query)?function(i){const o=i.documents.length;return ae(o===1,1966,{count:o}),Mn(cc(zN(i.documents[0])))}(n.query):function(i){return Mn(HN(i))}(n.query),new Fs(r,n.targetId,"TargetPurposeListen",n.lastListenSequenceNumber,e,t,$t.fromBase64String(n.resumeToken))}function XN(n,e){const t=la(e.snapshotVersion),r=la(e.lastLimboFreeSnapshotVersion);let s;s=Tp(e.target)?WN(n.yt,e.target):Fm(n.yt,e.target).ft;const i=e.resumeToken.toBase64();return{targetId:e.targetId,canonicalId:ia(e.target),readTime:t,resumeToken:i,lastListenSequenceNumber:e.sequenceNumber,lastLimboFreeSnapshotVersion:r,query:s}}function jm(n){const e=HN({parent:n.parent,structuredQuery:n.structuredQuery});return n.limitType==="LAST"?bp(e,e.limit,"L"):e}function dy(n,e){return new xw(e.largestBatchId,uv(n.yt,e.overlayMutation))}function XT(n,e){const t=e.path.lastSegment();return[n,On(e.path.popLast()),t]}function ZT(n,e,t,r){return{indexId:n,uid:e,sequenceNumber:t,readTime:la(r.readTime),documentKey:On(r.documentKey.path),largestBatchId:r.largestBatchId}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class r6{getBundleMetadata(e,t){return eS(e).get(t).next(r=>{if(r)return function(i){return{id:i.bundleId,createTime:ca(i.createTime),version:i.version}}(r)})}saveBundleMetadata(e,t){return eS(e).put(function(s){return{bundleId:s.id,createTime:la(Ht(s.createTime)),version:s.version}}(t))}getNamedQuery(e,t){return tS(e).get(t).next(r=>{if(r)return function(i){return{name:i.name,query:jm(i.bundledQuery),readTime:ca(i.readTime)}}(r)})}saveNamedQuery(e,t){return tS(e).put(function(s){return{name:s.name,readTime:la(Ht(s.readTime)),bundledQuery:s.bundledQuery}}(t))}}function eS(n){return rn(n,Rm)}function tS(n){return rn(n,Nm)}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Um{constructor(e,t){this.serializer=e,this.userId=t}static wt(e,t){const r=t.uid||"";return new Um(e,r)}getOverlay(e,t){return Bc(e).get(XT(this.userId,t)).next(r=>r?dy(this.serializer,r):null)}getOverlays(e,t){const r=ps();return M.forEach(t,s=>this.getOverlay(e,s).next(i=>{i!==null&&r.set(s,i)})).next(()=>r)}saveOverlays(e,t,r){const s=[];return r.forEach((i,o)=>{const a=new xw(t,o);s.push(this.St(e,a))}),M.waitFor(s)}removeOverlaysForBatchId(e,t,r){const s=new Set;t.forEach(o=>s.add(On(o.getCollectionPath())));const i=[];return s.forEach(o=>{const a=IDBKeyRange.bound([this.userId,o,r],[this.userId,o,r+1],!1,!0);i.push(Bc(e).Z(Z_,a))}),M.waitFor(i)}getOverlaysForCollection(e,t,r){const s=ps(),i=On(t),o=IDBKeyRange.bound([this.userId,i,r],[this.userId,i,Number.POSITIVE_INFINITY],!0);return Bc(e).J(Z_,o).next(a=>{for(const l of a){const u=dy(this.serializer,l);s.set(u.getKey(),u)}return s})}getOverlaysForCollectionGroup(e,t,r,s){const i=ps();let o;const a=IDBKeyRange.bound([this.userId,t,r],[this.userId,t,Number.POSITIVE_INFINITY],!0);return Bc(e).ee({index:KR,range:a},(l,u,h)=>{const f=dy(this.serializer,u);i.size()<s||f.largestBatchId===o?(i.set(f.getKey(),f),o=f.largestBatchId):h.done()}).next(()=>i)}St(e,t){return Bc(e).put(function(s,i,o){const[a,l,u]=XT(i,o.mutation.key);return{userId:i,collectionPath:l,documentId:u,collectionGroup:o.mutation.key.getCollectionGroup(),largestBatchId:o.largestBatchId,overlayMutation:gd(s.yt,o.mutation)}}(this.serializer,this.userId,t))}}function Bc(n){return rn(n,Pm)}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class s6{bt(e){return rn(e,hw)}getSessionToken(e){return this.bt(e).get("sessionToken").next(t=>{const r=t==null?void 0:t.value;return r?$t.fromUint8Array(r):$t.EMPTY_BYTE_STRING})}setSessionToken(e,t){return this.bt(e).put({name:"sessionToken",value:t.toUint8Array()})}}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Po{constructor(){}Dt(e,t){this.Ct(e,t),t.vt()}Ct(e,t){if("nullValue"in e)this.Ft(t,5);else if("booleanValue"in e)this.Ft(t,10),t.Mt(e.booleanValue?1:0);else if("integerValue"in e)this.Ft(t,15),t.Mt(Rt(e.integerValue));else if("doubleValue"in e){const r=Rt(e.doubleValue);isNaN(r)?this.Ft(t,13):(this.Ft(t,15),od(r)?t.Mt(0):t.Mt(r))}else if("timestampValue"in e){let r=e.timestampValue;this.Ft(t,20),typeof r=="string"&&(r=Qs(r)),t.xt(`${r.seconds||""}`),t.Mt(r.nanos||0)}else if("stringValue"in e)this.Ot(e.stringValue,t),this.Nt(t);else if("bytesValue"in e)this.Ft(t,30),t.Bt(Ys(e.bytesValue)),this.Nt(t);else if("referenceValue"in e)this.Lt(e.referenceValue,t);else if("geoPointValue"in e){const r=e.geoPointValue;this.Ft(t,45),t.Mt(r.latitude||0),t.Mt(r.longitude||0)}else"mapValue"in e?aN(e)?this.Ft(t,Number.MAX_SAFE_INTEGER):Om(e)?this.kt(e.mapValue,t):(this.qt(e.mapValue,t),this.Nt(t)):"arrayValue"in e?(this.Qt(e.arrayValue,t),this.Nt(t)):se(19022,{$t:e})}Ot(e,t){this.Ft(t,25),this.Ut(e,t)}Ut(e,t){t.xt(e)}qt(e,t){const r=e.fields||{};this.Ft(t,55);for(const s of Object.keys(r))this.Ot(s,t),this.Ct(r[s],t)}kt(e,t){var o,a;const r=e.fields||{};this.Ft(t,53);const s=$l,i=((a=(o=r[s].arrayValue)==null?void 0:o.values)==null?void 0:a.length)||0;this.Ft(t,15),t.Mt(Rt(i)),this.Ot(s,t),this.Ct(r[s],t)}Qt(e,t){const r=e.values||[];this.Ft(t,50);for(const s of r)this.Ct(s,t)}Lt(e,t){this.Ft(t,37),X.fromName(e).path.forEach(r=>{this.Ft(t,60),this.Ut(r,t)})}Ft(e,t){e.Mt(t)}Nt(e){e.Mt(2)}}Po.Kt=new Po;/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law | agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES | CONDITIONS OF ANY KIND, either express | implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ja=255;function i6(n){if(n===0)return 8;let e=0;return n>>4||(e+=4,n<<=4),n>>6||(e+=2,n<<=2),n>>7||(e+=1),e}function nS(n){const e=64-function(r){let s=0;for(let i=0;i<8;++i){const o=i6(255&r[i]);if(s+=o,o!==8)break}return s}(n);return Math.ceil(e/8)}class o6{constructor(){this.buffer=new Uint8Array(1024),this.position=0}Wt(e){const t=e[Symbol.iterator]();let r=t.next();for(;!r.done;)this.Gt(r.value),r=t.next();this.zt()}jt(e){const t=e[Symbol.iterator]();let r=t.next();for(;!r.done;)this.Jt(r.value),r=t.next();this.Ht()}Yt(e){for(const t of e){const r=t.charCodeAt(0);if(r<128)this.Gt(r);else if(r<2048)this.Gt(960|r>>>6),this.Gt(128|63&r);else if(t<"\uD800"||"\uDBFF"<t)this.Gt(480|r>>>12),this.Gt(128|63&r>>>6),this.Gt(128|63&r);else{const s=t.codePointAt(0);this.Gt(240|s>>>18),this.Gt(128|63&s>>>12),this.Gt(128|63&s>>>6),this.Gt(128|63&s)}}this.zt()}Zt(e){for(const t of e){const r=t.charCodeAt(0);if(r<128)this.Jt(r);else if(r<2048)this.Jt(960|r>>>6),this.Jt(128|63&r);else if(t<"\uD800"||"\uDBFF"<t)this.Jt(480|r>>>12),this.Jt(128|63&r>>>6),this.Jt(128|63&r);else{const s=t.codePointAt(0);this.Jt(240|s>>>18),this.Jt(128|63&s>>>12),this.Jt(128|63&s>>>6),this.Jt(128|63&s)}}this.Ht()}Xt(e){const t=this.en(e),r=nS(t);this.tn(1+r),this.buffer[this.position++]=255&r;for(let s=t.length-r;s<t.length;++s)this.buffer[this.position++]=255&t[s]}nn(e){const t=this.en(e),r=nS(t);this.tn(1+r),this.buffer[this.position++]=~(255&r);for(let s=t.length-r;s<t.length;++s)this.buffer[this.position++]=~(255&t[s])}rn(){this.sn(ja),this.sn(255)}_n(){this.an(ja),this.an(255)}reset(){this.position=0}seed(e){this.tn(e.length),this.buffer.set(e,this.position),this.position+=e.length}un(){return this.buffer.slice(0,this.position)}en(e){const t=function(i){const o=new DataView(new ArrayBuffer(8));return o.setFloat64(0,i,!1),new Uint8Array(o.buffer)}(e),r=!!(128&t[0]);t[0]^=r?255:128;for(let s=1;s<t.length;++s)t[s]^=r?255:0;return t}Gt(e){const t=255&e;t===0?(this.sn(0),this.sn(255)):t===ja?(this.sn(ja),this.sn(0)):this.sn(t)}Jt(e){const t=255&e;t===0?(this.an(0),this.an(255)):t===ja?(this.an(ja),this.an(0)):this.an(e)}zt(){this.sn(0),this.sn(1)}Ht(){this.an(0),this.an(1)}sn(e){this.tn(1),this.buffer[this.position++]=e}an(e){this.tn(1),this.buffer[this.position++]=~e}tn(e){const t=e+this.position;if(t<=this.buffer.length)return;let r=2*this.buffer.length;r<t&&(r=t);const s=new Uint8Array(r);s.set(this.buffer),this.buffer=s}}class a6{constructor(e){this.cn=e}Bt(e){this.cn.Wt(e)}xt(e){this.cn.Yt(e)}Mt(e){this.cn.Xt(e)}vt(){this.cn.rn()}}class l6{constructor(e){this.cn=e}Bt(e){this.cn.jt(e)}xt(e){this.cn.Zt(e)}Mt(e){this.cn.nn(e)}vt(){this.cn._n()}}class $c{constructor(){this.cn=new o6,this.ln=new a6(this.cn),this.hn=new l6(this.cn)}seed(e){this.cn.seed(e)}Pn(e){return e===0?this.ln:this.hn}un(){return this.cn.un()}reset(){this.cn.reset()}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ko{constructor(e,t,r,s){this.Tn=e,this.In=t,this.En=r,this.dn=s}An(){const e=this.dn.length,t=e===0||this.dn[e-1]===255?e+1:e,r=new Uint8Array(t);return r.set(this.dn,0),t!==e?r.set([0],this.dn.length):++r[r.length-1],new ko(this.Tn,this.In,this.En,r)}Rn(e,t,r){return{indexId:this.Tn,uid:e,arrayValue:Sf(this.En),directionalValue:Sf(this.dn),orderedDocumentKey:Sf(t),documentKey:r.path.toArray()}}Vn(e,t,r){const s=this.Rn(e,t,r);return[s.indexId,s.uid,s.arrayValue,s.directionalValue,s.orderedDocumentKey,s.documentKey]}}function di(n,e){let t=n.Tn-e.Tn;return t!==0?t:(t=rS(n.En,e.En),t!==0?t:(t=rS(n.dn,e.dn),t!==0?t:X.comparator(n.In,e.In)))}function rS(n,e){for(let t=0;t<n.length&&t<e.length;++t){const r=n[t]-e[t];if(r!==0)return r}return n.length-e.length}function Sf(n){return JA()?function(t){let r="";for(let s=0;s<t.length;s++)r+=String.fromCharCode(t[s]);return r}(n):n}function sS(n){return typeof n!="string"?n:function(t){const r=new Uint8Array(t.length);for(let s=0;s<t.length;s++)r[s]=t.charCodeAt(s);return r}(n)}class iS{constructor(e){this.mn=new ot((t,r)=>Dt.comparator(t.field,r.field)),this.collectionId=e.collectionGroup!=null?e.collectionGroup:e.path.lastSegment(),this.fn=e.orderBy,this.gn=[];for(const t of e.filters){const r=t;r.isInequality()?this.mn=this.mn.add(r):this.gn.push(r)}}get pn(){return this.mn.size>1}yn(e){if(ae(e.collectionGroup===this.collectionId,49279),this.pn)return!1;const t=Y_(e);if(t!==void 0&&!this.wn(t))return!1;const r=Ao(e);let s=new Set,i=0,o=0;for(;i<r.length&&this.wn(r[i]);++i)s=s.add(r[i].fieldPath.canonicalString());if(i===r.length)return!0;if(this.mn.size>0){const a=this.mn.getIterator().getNext();if(!s.has(a.field.canonicalString())){const l=r[i];if(!this.Sn(a,l)||!this.bn(this.fn[o++],l))return!1}++i}for(;i<r.length;++i){const a=r[i];if(o>=this.fn.length||!this.bn(this.fn[o++],a))return!1}return!0}Dn(){if(this.pn)return null;let e=new ot(Dt.comparator);const t=[];for(const r of this.gn)if(!r.field.isKeyField())if(r.op==="array-contains"||r.op==="array-contains-any")t.push(new zo(r.field,2));else{if(e.has(r.field))continue;e=e.add(r.field),t.push(new zo(r.field,0))}for(const r of this.fn)r.field.isKeyField()||e.has(r.field)||(e=e.add(r.field),t.push(new zo(r.field,r.dir==="asc"?0:1)));return new Ll(Ll.UNKNOWN_ID,this.collectionId,t,Vl.empty())}wn(e){for(const t of this.gn)if(this.Sn(t,e))return!0;return!1}Sn(e,t){if(e===void 0||!e.field.isEqual(t.fieldPath))return!1;const r=e.op==="array-contains"||e.op==="array-contains-any";return t.kind===2===r}bn(e,t){return!!e.field.isEqual(t.fieldPath)&&(t.kind===0&&e.dir==="asc"||t.kind===1&&e.dir==="desc")}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ZN(n){var t,r;if(ae(n instanceof qe||n instanceof st,20012),n instanceof qe){if(n instanceof gN){const s=((r=(t=n.value.arrayValue)==null?void 0:t.values)==null?void 0:r.map(i=>qe.create(n.field,"==",i)))||[];return st.create(s,"or")}return n}const e=n.filters.map(s=>ZN(s));return st.create(e,n.op)}function c6(n){if(n.getFilters().length===0)return[];const e=fv(ZN(n));return ae(eP(e),7391),dv(e)||hv(e)?[e]:e.getFilters()}function dv(n){return n instanceof qe}function hv(n){return n instanceof st&&gw(n)}function eP(n){return dv(n)||hv(n)||function(t){if(t instanceof st&&rv(t)){for(const r of t.getFilters())if(!dv(r)&&!hv(r))return!1;return!0}return!1}(n)}function fv(n){if(ae(n instanceof qe||n instanceof st,34018),n instanceof qe)return n;if(n.filters.length===1)return fv(n.filters[0]);const e=n.filters.map(r=>fv(r));let t=st.create(e,n.op);return t=Cp(t),eP(t)?t:(ae(t instanceof st,64498),ae(ql(t),40251),ae(t.filters.length>1,57927),t.filters.reduce((r,s)=>bw(r,s)))}function bw(n,e){let t;return ae(n instanceof qe||n instanceof st,38388),ae(e instanceof qe||e instanceof st,25473),t=n instanceof qe?e instanceof qe?function(s,i){return st.create([s,i],"and")}(n,e):oS(n,e):e instanceof qe?oS(e,n):function(s,i){if(ae(s.filters.length>0&&i.filters.length>0,48005),ql(s)&&ql(i))return fN(s,i.getFilters());const o=rv(s)?s:i,a=rv(s)?i:s,l=o.filters.map(u=>bw(u,a));return st.create(l,"or")}(n,e),Cp(t)}function oS(n,e){if(ql(e))return fN(e,n.getFilters());{const t=e.filters.map(r=>bw(n,r));return st.create(t,"or")}}function Cp(n){if(ae(n instanceof qe||n instanceof st,11850),n instanceof qe)return n;const e=n.getFilters();if(e.length===1)return Cp(e[0]);if(dN(n))return n;const t=e.map(s=>Cp(s)),r=[];return t.forEach(s=>{s instanceof qe?r.push(s):s instanceof st&&(s.op===n.op?r.push(...s.filters):r.push(s))}),r.length===1?r[0]:st.create(r,n.op)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class u6{constructor(){this.Cn=new Aw}addToCollectionParentIndex(e,t){return this.Cn.add(t),M.resolve()}getCollectionParents(e,t){return M.resolve(this.Cn.getEntries(t))}addFieldIndex(e,t){return M.resolve()}deleteFieldIndex(e,t){return M.resolve()}deleteAllFieldIndexes(e){return M.resolve()}createTargetIndexes(e,t){return M.resolve()}getDocumentsMatchingTarget(e,t){return M.resolve(null)}getIndexType(e,t){return M.resolve(0)}getFieldIndexes(e,t){return M.resolve([])}getNextCollectionGroupToUpdate(e){return M.resolve(null)}getMinOffset(e,t){return M.resolve(xr.min())}getMinOffsetFromCollectionGroup(e,t){return M.resolve(xr.min())}updateCollectionGroup(e,t,r){return M.resolve()}updateIndexEntries(e,t){return M.resolve()}}class Aw{constructor(){this.index={}}add(e){const t=e.lastSegment(),r=e.popLast(),s=this.index[t]||new ot(Ve.comparator),i=!s.has(r);return this.index[t]=s.add(r),i}has(e){const t=e.lastSegment(),r=e.popLast(),s=this.index[t];return s&&s.has(r)}getEntries(e){return(this.index[e]||new ot(Ve.comparator)).toArray()}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const aS="IndexedDbIndexManager",Gh=new Uint8Array(0);class d6{constructor(e,t){this.databaseId=t,this.vn=new Aw,this.Fn=new ri(r=>ia(r),(r,s)=>Wd(r,s)),this.uid=e.uid||""}addToCollectionParentIndex(e,t){if(!this.vn.has(t)){const r=t.lastSegment(),s=t.popLast();e.addOnCommittedListener(()=>{this.vn.add(t)});const i={collectionId:r,parent:On(s)};return lS(e).put(i)}return M.resolve()}getCollectionParents(e,t){const r=[],s=IDBKeyRange.bound([t,""],[OR(t),""],!1,!0);return lS(e).J(s).next(i=>{for(const o of i){if(o.collectionId!==t)break;r.push(fs(o.parent))}return r})}addFieldIndex(e,t){const r=zc(e),s=function(a){return{indexId:a.indexId,collectionGroup:a.collectionGroup,fields:a.fields.map(l=>[l.fieldPath.canonicalString(),l.kind])}}(t);delete s.indexId;const i=r.add(s);if(t.indexState){const o=Ba(e);return i.next(a=>{o.put(ZT(a,this.uid,t.indexState.sequenceNumber,t.indexState.offset))})}return i.next()}deleteFieldIndex(e,t){const r=zc(e),s=Ba(e),i=Ua(e);return r.delete(t.indexId).next(()=>s.delete(IDBKeyRange.bound([t.indexId],[t.indexId+1],!1,!0))).next(()=>i.delete(IDBKeyRange.bound([t.indexId],[t.indexId+1],!1,!0)))}deleteAllFieldIndexes(e){const t=zc(e),r=Ua(e),s=Ba(e);return t.Z().next(()=>r.Z()).next(()=>s.Z())}createTargetIndexes(e,t){return M.forEach(this.Mn(t),r=>this.getIndexType(e,r).next(s=>{if(s===0||s===1){const i=new iS(r).Dn();if(i!=null)return this.addFieldIndex(e,i)}}))}getDocumentsMatchingTarget(e,t){const r=Ua(e);let s=!0;const i=new Map;return M.forEach(this.Mn(t),o=>this.xn(e,o).next(a=>{s&&(s=!!a),i.set(o,a)})).next(()=>{if(s){let o=be();const a=[];return M.forEach(i,(l,u)=>{q(aS,`Using index ${function(R){return`id=${R.indexId}|cg=${R.collectionGroup}|f=${R.fields.map(D=>`${D.fieldPath}:${D.kind}`).join(",")}`}(l)} to execute ${ia(t)}`);const h=function(R,D){const F=Y_(D);if(F===void 0)return null;for(const k of Sp(R,F.fieldPath))switch(k.op){case"array-contains-any":return k.value.arrayValue.values||[];case"array-contains":return[k.value]}return null}(u,l),f=function(R,D){const F=new Map;for(const k of Ao(D))for(const E of Sp(R,k.fieldPath))switch(E.op){case"==":case"in":F.set(k.fieldPath.canonicalString(),E.value);break;case"not-in":case"!=":return F.set(k.fieldPath.canonicalString(),E.value),Array.from(F.values())}return null}(u,l),p=function(R,D){const F=[];let k=!0;for(const E of Ao(D)){const _=E.kind===0?jT(R,E.fieldPath,R.startAt):UT(R,E.fieldPath,R.startAt);F.push(_.value),k&&(k=_.inclusive)}return new ro(F,k)}(u,l),y=function(R,D){const F=[];let k=!0;for(const E of Ao(D)){const _=E.kind===0?UT(R,E.fieldPath,R.endAt):jT(R,E.fieldPath,R.endAt);F.push(_.value),k&&(k=_.inclusive)}return new ro(F,k)}(u,l),I=this.On(l,u,p),C=this.On(l,u,y),P=this.Nn(l,u,f),A=this.Bn(l.indexId,h,I,p.inclusive,C,y.inclusive,P);return M.forEach(A,T=>r.Y(T,t.limit).next(R=>{R.forEach(D=>{const F=X.fromSegments(D.documentKey);o.has(F)||(o=o.add(F),a.push(F))})}))}).next(()=>a)}return M.resolve(null)})}Mn(e){let t=this.Fn.get(e);return t||(e.filters.length===0?t=[e]:t=c6(st.create(e.filters,"and")).map(r=>iv(e.path,e.collectionGroup,e.orderBy,r.getFilters(),e.limit,e.startAt,e.endAt)),this.Fn.set(e,t),t)}Bn(e,t,r,s,i,o,a){const l=(t!=null?t.length:1)*Math.max(r.length,i.length),u=l/(t!=null?t.length:1),h=[];for(let f=0;f<l;++f){const p=t?this.Ln(t[f/u]):Gh,y=this.kn(e,p,r[f%u],s),I=this.qn(e,p,i[f%u],o),C=a.map(P=>this.kn(e,p,P,!0));h.push(...this.createRange(y,I,C))}return h}kn(e,t,r,s){const i=new ko(e,X.empty(),t,r);return s?i:i.An()}qn(e,t,r,s){const i=new ko(e,X.empty(),t,r);return s?i.An():i}xn(e,t){const r=new iS(t),s=t.collectionGroup!=null?t.collectionGroup:t.path.lastSegment();return this.getFieldIndexes(e,s).next(i=>{let o=null;for(const a of i)r.yn(a)&&(!o||a.fields.length>o.fields.length)&&(o=a);return o})}getIndexType(e,t){let r=2;const s=this.Mn(t);return M.forEach(s,i=>this.xn(e,i).next(o=>{o?r!==0&&o.fields.length<function(l){let u=new ot(Dt.comparator),h=!1;for(const f of l.filters)for(const p of f.getFlattenedFilters())p.field.isKeyField()||(p.op==="array-contains"||p.op==="array-contains-any"?h=!0:u=u.add(p.field));for(const f of l.orderBy)f.field.isKeyField()||(u=u.add(f.field));return u.size+(h?1:0)}(i)&&(r=1):r=0})).next(()=>function(o){return o.limit!==null}(t)&&s.length>1&&r===2?1:r)}Qn(e,t){const r=new $c;for(const s of Ao(e)){const i=t.data.field(s.fieldPath);if(i==null)return null;const o=r.Pn(s.kind);Po.Kt.Dt(i,o)}return r.un()}Ln(e){const t=new $c;return Po.Kt.Dt(e,t.Pn(0)),t.un()}$n(e,t){const r=new $c;return Po.Kt.Dt(sa(this.databaseId,t),r.Pn(function(i){const o=Ao(i);return o.length===0?0:o[o.length-1].kind}(e))),r.un()}Nn(e,t,r){if(r===null)return[];let s=[];s.push(new $c);let i=0;for(const o of Ao(e)){const a=r[i++];for(const l of s)if(this.Un(t,o.fieldPath)&&fd(a))s=this.Kn(s,o,a);else{const u=l.Pn(o.kind);Po.Kt.Dt(a,u)}}return this.Wn(s)}On(e,t,r){return this.Nn(e,t,r.position)}Wn(e){const t=[];for(let r=0;r<e.length;++r)t[r]=e[r].un();return t}Kn(e,t,r){const s=[...e],i=[];for(const o of r.arrayValue.values||[])for(const a of s){const l=new $c;l.seed(a.un()),Po.Kt.Dt(o,l.Pn(t.kind)),i.push(l)}return i}Un(e,t){return!!e.filters.find(r=>r instanceof qe&&r.field.isEqual(t)&&(r.op==="in"||r.op==="not-in"))}getFieldIndexes(e,t){const r=zc(e),s=Ba(e);return(t?r.J(X_,IDBKeyRange.bound(t,t)):r.J()).next(i=>{const o=[];return M.forEach(i,a=>s.get([a.indexId,this.uid]).next(l=>{o.push(function(h,f){const p=f?new Vl(f.sequenceNumber,new xr(ca(f.readTime),new X(fs(f.documentKey)),f.largestBatchId)):Vl.empty(),y=h.fields.map(([I,C])=>new zo(Dt.fromServerFormat(I),C));return new Ll(h.indexId,h.collectionGroup,y,p)}(a,l))})).next(()=>o)})}getNextCollectionGroupToUpdate(e){return this.getFieldIndexes(e).next(t=>t.length===0?null:(t.sort((r,s)=>{const i=r.indexState.sequenceNumber-s.indexState.sequenceNumber;return i!==0?i:ve(r.collectionGroup,s.collectionGroup)}),t[0].collectionGroup))}updateCollectionGroup(e,t,r){const s=zc(e),i=Ba(e);return this.Gn(e).next(o=>s.J(X_,IDBKeyRange.bound(t,t)).next(a=>M.forEach(a,l=>i.put(ZT(l.indexId,this.uid,o,r)))))}updateIndexEntries(e,t){const r=new Map;return M.forEach(t,(s,i)=>{const o=r.get(s.collectionGroup);return(o?M.resolve(o):this.getFieldIndexes(e,s.collectionGroup)).next(a=>(r.set(s.collectionGroup,a),M.forEach(a,l=>this.zn(e,s,l).next(u=>{const h=this.jn(i,l);return u.isEqual(h)?M.resolve():this.Jn(e,i,l,u,h)}))))})}Hn(e,t,r,s){return Ua(e).put(s.Rn(this.uid,this.$n(r,t.key),t.key))}Yn(e,t,r,s){return Ua(e).delete(s.Vn(this.uid,this.$n(r,t.key),t.key))}zn(e,t,r){const s=Ua(e);let i=new ot(di);return s.ee({index:HR,range:IDBKeyRange.only([r.indexId,this.uid,Sf(this.$n(r,t))])},(o,a)=>{i=i.add(new ko(r.indexId,t,sS(a.arrayValue),sS(a.directionalValue)))}).next(()=>i)}jn(e,t){let r=new ot(di);const s=this.Qn(t,e);if(s==null)return r;const i=Y_(t);if(i!=null){const o=e.data.field(i.fieldPath);if(fd(o))for(const a of o.arrayValue.values||[])r=r.add(new ko(t.indexId,e.key,this.Ln(a),s))}else r=r.add(new ko(t.indexId,e.key,Gh,s));return r}Jn(e,t,r,s,i){q(aS,"Updating index entries for document '%s'",t.key);const o=[];return function(l,u,h,f,p){const y=l.getIterator(),I=u.getIterator();let C=Fa(y),P=Fa(I);for(;C||P;){let A=!1,T=!1;if(C&&P){const R=h(C,P);R<0?T=!0:R>0&&(A=!0)}else C!=null?T=!0:A=!0;A?(f(P),P=Fa(I)):T?(p(C),C=Fa(y)):(C=Fa(y),P=Fa(I))}}(s,i,di,a=>{o.push(this.Hn(e,t,r,a))},a=>{o.push(this.Yn(e,t,r,a))}),M.waitFor(o)}Gn(e){let t=1;return Ba(e).ee({index:GR,reverse:!0,range:IDBKeyRange.upperBound([this.uid,Number.MAX_SAFE_INTEGER])},(r,s,i)=>{i.done(),t=s.sequenceNumber+1}).next(()=>t)}createRange(e,t,r){r=r.sort((o,a)=>di(o,a)).filter((o,a,l)=>!a||di(o,l[a-1])!==0);const s=[];s.push(e);for(const o of r){const a=di(o,e),l=di(o,t);if(a===0)s[0]=e.An();else if(a>0&&l<0)s.push(o),s.push(o.An());else if(l>0)break}s.push(t);const i=[];for(let o=0;o<s.length;o+=2){if(this.Zn(s[o],s[o+1]))return[];const a=s[o].Vn(this.uid,Gh,X.empty()),l=s[o+1].Vn(this.uid,Gh,X.empty());i.push(IDBKeyRange.bound(a,l))}return i}Zn(e,t){return di(e,t)>0}getMinOffsetFromCollectionGroup(e,t){return this.getFieldIndexes(e,t).next(cS)}getMinOffset(e,t){return M.mapArray(this.Mn(t),r=>this.xn(e,r).next(s=>s||se(44426))).next(cS)}}function lS(n){return rn(n,cd)}function Ua(n){return rn(n,xu)}function zc(n){return rn(n,dw)}function Ba(n){return rn(n,Eu)}function cS(n){ae(n.length!==0,28825);let e=n[0].indexState.offset,t=e.largestBatchId;for(let r=1;r<n.length;r++){const s=n[r].indexState.offset;lw(s,e)<0&&(e=s),t<s.largestBatchId&&(t=s.largestBatchId)}return new xr(e.readTime,e.documentKey,t)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const uS={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0},tP=41943040;class Pn{static withCacheSize(e){return new Pn(e,Pn.DEFAULT_COLLECTION_PERCENTILE,Pn.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}constructor(e,t,r){this.cacheSizeCollectionThreshold=e,this.percentileToCollect=t,this.maximumSequenceNumbersToCollect=r}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function nP(n,e,t){const r=n.store(Wr),s=n.store(Fl),i=[],o=IDBKeyRange.only(t.batchId);let a=0;const l=r.ee({range:o},(h,f,p)=>(a++,p.delete()));i.push(l.next(()=>{ae(a===1,47070,{batchId:t.batchId})}));const u=[];for(const h of t.mutations){const f=zR(e,h.key.path,t.batchId);i.push(s.delete(f)),u.push(h.key)}return M.waitFor(i).next(()=>u)}function Rp(n){if(!n)return 0;let e;if(n.document)e=n.document;else if(n.unknownDocument)e=n.unknownDocument;else{if(!n.noDocument)throw se(14731);e=n.noDocument}return JSON.stringify(e).length}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */Pn.DEFAULT_COLLECTION_PERCENTILE=10,Pn.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,Pn.DEFAULT=new Pn(tP,Pn.DEFAULT_COLLECTION_PERCENTILE,Pn.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),Pn.DISABLED=new Pn(-1,0,0);class Bm{constructor(e,t,r,s){this.userId=e,this.serializer=t,this.indexManager=r,this.referenceDelegate=s,this.Xn={}}static wt(e,t,r,s){ae(e.uid!=="",64387);const i=e.isAuthenticated()?e.uid:"";return new Bm(i,t,r,s)}checkEmpty(e){let t=!0;const r=IDBKeyRange.bound([this.userId,Number.NEGATIVE_INFINITY],[this.userId,Number.POSITIVE_INFINITY]);return hi(e).ee({index:Vo,range:r},(s,i,o)=>{t=!1,o.done()}).next(()=>t)}addMutationBatch(e,t,r,s){const i=Ga(e),o=hi(e);return o.add({}).next(a=>{ae(typeof a=="number",49019);const l=new Iw(a,t,r,s),u=function(y,I,C){const P=C.baseMutations.map(T=>gd(y.yt,T)),A=C.mutations.map(T=>gd(y.yt,T));return{userId:I,batchId:C.batchId,localWriteTimeMs:C.localWriteTime.toMillis(),baseMutations:P,mutations:A}}(this.serializer,this.userId,l),h=[];let f=new ot((p,y)=>ve(p.canonicalString(),y.canonicalString()));for(const p of s){const y=zR(this.userId,p.key.path,a);f=f.add(p.key.path.popLast()),h.push(o.put(u)),h.push(i.put(y,H4))}return f.forEach(p=>{h.push(this.indexManager.addToCollectionParentIndex(e,p))}),e.addOnCommittedListener(()=>{this.Xn[a]=l.keys()}),M.waitFor(h).next(()=>l)})}lookupMutationBatch(e,t){return hi(e).get(t).next(r=>r?(ae(r.userId===this.userId,48,"Unexpected user for mutation batch",{userId:r.userId,batchId:t}),No(this.serializer,r)):null)}er(e,t){return this.Xn[t]?M.resolve(this.Xn[t]):this.lookupMutationBatch(e,t).next(r=>{if(r){const s=r.keys();return this.Xn[t]=s,s}return null})}getNextMutationBatchAfterBatchId(e,t){const r=t+1,s=IDBKeyRange.lowerBound([this.userId,r]);let i=null;return hi(e).ee({index:Vo,range:s},(o,a,l)=>{a.userId===this.userId&&(ae(a.batchId>=r,47524,{tr:r}),i=No(this.serializer,a)),l.done()}).next(()=>i)}getHighestUnacknowledgedBatchId(e){const t=IDBKeyRange.upperBound([this.userId,Number.POSITIVE_INFINITY]);let r=Wi;return hi(e).ee({index:Vo,range:t,reverse:!0},(s,i,o)=>{r=i.batchId,o.done()}).next(()=>r)}getAllMutationBatches(e){const t=IDBKeyRange.bound([this.userId,Wi],[this.userId,Number.POSITIVE_INFINITY]);return hi(e).J(Vo,t).next(r=>r.map(s=>No(this.serializer,s)))}getAllMutationBatchesAffectingDocumentKey(e,t){const r=_f(this.userId,t.path),s=IDBKeyRange.lowerBound(r),i=[];return Ga(e).ee({range:s},(o,a,l)=>{const[u,h,f]=o,p=fs(h);if(u===this.userId&&t.path.isEqual(p))return hi(e).get(f).next(y=>{if(!y)throw se(61480,{nr:o,batchId:f});ae(y.userId===this.userId,10503,"Unexpected user for mutation batch",{userId:y.userId,batchId:f}),i.push(No(this.serializer,y))});l.done()}).next(()=>i)}getAllMutationBatchesAffectingDocumentKeys(e,t){let r=new ot(ve);const s=[];return t.forEach(i=>{const o=_f(this.userId,i.path),a=IDBKeyRange.lowerBound(o),l=Ga(e).ee({range:a},(u,h,f)=>{const[p,y,I]=u,C=fs(y);p===this.userId&&i.path.isEqual(C)?r=r.add(I):f.done()});s.push(l)}),M.waitFor(s).next(()=>this.rr(e,r))}getAllMutationBatchesAffectingQuery(e,t){const r=t.path,s=r.length+1,i=_f(this.userId,r),o=IDBKeyRange.lowerBound(i);let a=new ot(ve);return Ga(e).ee({range:o},(l,u,h)=>{const[f,p,y]=l,I=fs(p);f===this.userId&&r.isPrefixOf(I)?I.length===s&&(a=a.add(y)):h.done()}).next(()=>this.rr(e,a))}rr(e,t){const r=[],s=[];return t.forEach(i=>{s.push(hi(e).get(i).next(o=>{if(o===null)throw se(35274,{batchId:i});ae(o.userId===this.userId,9748,"Unexpected user for mutation batch",{userId:o.userId,batchId:i}),r.push(No(this.serializer,o))}))}),M.waitFor(s).next(()=>r)}removeMutationBatch(e,t){return nP(e.le,this.userId,t).next(r=>(e.addOnCommittedListener(()=>{this.ir(t.batchId)}),M.forEach(r,s=>this.referenceDelegate.markPotentiallyOrphaned(e,s))))}ir(e){delete this.Xn[e]}performConsistencyCheck(e){return this.checkEmpty(e).next(t=>{if(!t)return M.resolve();const r=IDBKeyRange.lowerBound(function(o){return[o]}(this.userId)),s=[];return Ga(e).ee({range:r},(i,o,a)=>{if(i[0]===this.userId){const l=fs(i[1]);s.push(l)}else a.done()}).next(()=>{ae(s.length===0,56720,{sr:s.map(i=>i.canonicalString())})})})}containsKey(e,t){return rP(e,this.userId,t)}_r(e){return sP(e).get(this.userId).next(t=>t||{userId:this.userId,lastAcknowledgedBatchId:Wi,lastStreamToken:""})}}function rP(n,e,t){const r=_f(e,t.path),s=r[1],i=IDBKeyRange.lowerBound(r);let o=!1;return Ga(n).ee({range:i,X:!0},(a,l,u)=>{const[h,f,p]=a;h===e&&f===s&&(o=!0),u.done()}).next(()=>o)}function hi(n){return rn(n,Wr)}function Ga(n){return rn(n,Fl)}function sP(n){return rn(n,ad)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ua{constructor(e){this.ar=e}next(){return this.ar+=2,this.ar}static ur(){return new ua(0)}static cr(){return new ua(-1)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class h6{constructor(e,t){this.referenceDelegate=e,this.serializer=t}allocateTargetId(e){return this.lr(e).next(t=>{const r=new ua(t.highestTargetId);return t.highestTargetId=r.next(),this.hr(e,t).next(()=>t.highestTargetId)})}getLastRemoteSnapshotVersion(e){return this.lr(e).next(t=>ue.fromTimestamp(new rt(t.lastRemoteSnapshotVersion.seconds,t.lastRemoteSnapshotVersion.nanoseconds)))}getHighestSequenceNumber(e){return this.lr(e).next(t=>t.highestListenSequenceNumber)}setTargetsMetadata(e,t,r){return this.lr(e).next(s=>(s.highestListenSequenceNumber=t,r&&(s.lastRemoteSnapshotVersion=r.toTimestamp()),t>s.highestListenSequenceNumber&&(s.highestListenSequenceNumber=t),this.hr(e,s)))}addTargetData(e,t){return this.Pr(e,t).next(()=>this.lr(e).next(r=>(r.targetCount+=1,this.Tr(t,r),this.hr(e,r))))}updateTargetData(e,t){return this.Pr(e,t)}removeTargetData(e,t){return this.removeMatchingKeysForTargetId(e,t.targetId).next(()=>$a(e).delete(t.targetId)).next(()=>this.lr(e)).next(r=>(ae(r.targetCount>0,8065),r.targetCount-=1,this.hr(e,r)))}removeTargets(e,t,r){let s=0;const i=[];return $a(e).ee((o,a)=>{const l=ru(a);l.sequenceNumber<=t&&r.get(l.targetId)===null&&(s++,i.push(this.removeTargetData(e,l)))}).next(()=>M.waitFor(i)).next(()=>s)}forEachTarget(e,t){return $a(e).ee((r,s)=>{const i=ru(s);t(i)})}lr(e){return dS(e).get(xp).next(t=>(ae(t!==null,2888),t))}hr(e,t){return dS(e).put(xp,t)}Pr(e,t){return $a(e).put(XN(this.serializer,t))}Tr(e,t){let r=!1;return e.targetId>t.highestTargetId&&(t.highestTargetId=e.targetId,r=!0),e.sequenceNumber>t.highestListenSequenceNumber&&(t.highestListenSequenceNumber=e.sequenceNumber,r=!0),r}getTargetCount(e){return this.lr(e).next(t=>t.targetCount)}getTargetData(e,t){const r=ia(t),s=IDBKeyRange.bound([r,Number.NEGATIVE_INFINITY],[r,Number.POSITIVE_INFINITY]);let i=null;return $a(e).ee({range:s,index:WR},(o,a,l)=>{const u=ru(a);Wd(t,u.target)&&(i=u,l.done())}).next(()=>i)}addMatchingKeys(e,t,r){const s=[],i=wi(e);return t.forEach(o=>{const a=On(o.path);s.push(i.put({targetId:r,path:a})),s.push(this.referenceDelegate.addReference(e,r,o))}),M.waitFor(s)}removeMatchingKeys(e,t,r){const s=wi(e);return M.forEach(t,i=>{const o=On(i.path);return M.waitFor([s.delete([r,o]),this.referenceDelegate.removeReference(e,r,i)])})}removeMatchingKeysForTargetId(e,t){const r=wi(e),s=IDBKeyRange.bound([t],[t+1],!1,!0);return r.delete(s)}getMatchingKeysForTargetId(e,t){const r=IDBKeyRange.bound([t],[t+1],!1,!0),s=wi(e);let i=be();return s.ee({range:r,X:!0},(o,a,l)=>{const u=fs(o[1]),h=new X(u);i=i.add(h)}).next(()=>i)}containsKey(e,t){const r=On(t.path),s=IDBKeyRange.bound([r],[OR(r)],!1,!0);let i=0;return wi(e).ee({index:uw,X:!0,range:s},([o,a],l,u)=>{o!==0&&(i++,u.done())}).next(()=>i>0)}At(e,t){return $a(e).get(t).next(r=>r?ru(r):null)}}function $a(n){return rn(n,jl)}function dS(n){return rn(n,qo)}function wi(n){return rn(n,Ul)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const hS="LruGarbageCollector",iP=1048576;function fS([n,e],[t,r]){const s=ve(n,t);return s===0?ve(e,r):s}class f6{constructor(e){this.Ir=e,this.buffer=new ot(fS),this.Er=0}dr(){return++this.Er}Ar(e){const t=[e,this.dr()];if(this.buffer.size<this.Ir)this.buffer=this.buffer.add(t);else{const r=this.buffer.last();fS(t,r)<0&&(this.buffer=this.buffer.delete(r).add(t))}}get maxValue(){return this.buffer.last()[0]}}class oP{constructor(e,t,r){this.garbageCollector=e,this.asyncQueue=t,this.localStore=r,this.Rr=null}start(){this.garbageCollector.params.cacheSizeCollectionThreshold!==-1&&this.Vr(6e4)}stop(){this.Rr&&(this.Rr.cancel(),this.Rr=null)}get started(){return this.Rr!==null}Vr(e){q(hS,`Garbage collection scheduled in ${e}ms`),this.Rr=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",e,async()=>{this.Rr=null;try{await this.localStore.collectGarbage(this.garbageCollector)}catch(t){fo(t)?q(hS,"Ignoring IndexedDB error during garbage collection: ",t):await ho(t)}await this.Vr(3e5)})}}class p6{constructor(e,t){this.mr=e,this.params=t}calculateTargetCount(e,t){return this.mr.gr(e).next(r=>Math.floor(t/100*r))}nthSequenceNumber(e,t){if(t===0)return M.resolve(Yn.ce);const r=new f6(t);return this.mr.forEachTarget(e,s=>r.Ar(s.sequenceNumber)).next(()=>this.mr.pr(e,s=>r.Ar(s))).next(()=>r.maxValue)}removeTargets(e,t,r){return this.mr.removeTargets(e,t,r)}removeOrphanedDocuments(e,t){return this.mr.removeOrphanedDocuments(e,t)}collect(e,t){return this.params.cacheSizeCollectionThreshold===-1?(q("LruGarbageCollector","Garbage collection skipped; disabled"),M.resolve(uS)):this.getCacheSize(e).next(r=>r<this.params.cacheSizeCollectionThreshold?(q("LruGarbageCollector",`Garbage collection skipped; Cache size ${r} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),uS):this.yr(e,t))}getCacheSize(e){return this.mr.getCacheSize(e)}yr(e,t){let r,s,i,o,a,l,u;const h=Date.now();return this.calculateTargetCount(e,this.params.percentileToCollect).next(f=>(f>this.params.maximumSequenceNumbersToCollect?(q("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${f}`),s=this.params.maximumSequenceNumbersToCollect):s=f,o=Date.now(),this.nthSequenceNumber(e,s))).next(f=>(r=f,a=Date.now(),this.removeTargets(e,r,t))).next(f=>(i=f,l=Date.now(),this.removeOrphanedDocuments(e,r))).next(f=>(u=Date.now(),za()<=Fe.DEBUG&&q("LruGarbageCollector",`LRU Garbage Collection
	Counted targets in ${o-h}ms
	Determined least recently used ${s} in `+(a-o)+`ms
	Removed ${i} targets in `+(l-a)+`ms
	Removed ${f} documents in `+(u-l)+`ms
Total Duration: ${u-h}ms`),M.resolve({didRun:!0,sequenceNumbersCollected:s,targetsRemoved:i,documentsRemoved:f})))}}function aP(n,e){return new p6(n,e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class m6{constructor(e,t){this.db=e,this.garbageCollector=aP(this,t)}gr(e){const t=this.wr(e);return this.db.getTargetCache().getTargetCount(e).next(r=>t.next(s=>r+s))}wr(e){let t=0;return this.pr(e,r=>{t++}).next(()=>t)}forEachTarget(e,t){return this.db.getTargetCache().forEachTarget(e,t)}pr(e,t){return this.Sr(e,(r,s)=>t(s))}addReference(e,t,r){return Hh(e,r)}removeReference(e,t,r){return Hh(e,r)}removeTargets(e,t,r){return this.db.getTargetCache().removeTargets(e,t,r)}markPotentiallyOrphaned(e,t){return Hh(e,t)}br(e,t){return function(s,i){let o=!1;return sP(s).te(a=>rP(s,a,i).next(l=>(l&&(o=!0),M.resolve(!l)))).next(()=>o)}(e,t)}removeOrphanedDocuments(e,t){const r=this.db.getRemoteDocumentCache().newChangeBuffer(),s=[];let i=0;return this.Sr(e,(o,a)=>{if(a<=t){const l=this.br(e,o).next(u=>{if(!u)return i++,r.getEntry(e,o).next(()=>(r.removeEntry(o,ue.min()),wi(e).delete(function(f){return[0,On(f.path)]}(o))))});s.push(l)}}).next(()=>M.waitFor(s)).next(()=>r.apply(e)).next(()=>i)}removeTarget(e,t){const r=t.withSequenceNumber(e.currentSequenceNumber);return this.db.getTargetCache().updateTargetData(e,r)}updateLimboDocument(e,t){return Hh(e,t)}Sr(e,t){const r=wi(e);let s,i=Yn.ce;return r.ee({index:uw},([o,a],{path:l,sequenceNumber:u})=>{o===0?(i!==Yn.ce&&t(new X(fs(s)),i),i=u,s=l):i=Yn.ce}).next(()=>{i!==Yn.ce&&t(new X(fs(s)),i)})}getCacheSize(e){return this.db.getRemoteDocumentCache().getSize(e)}}function Hh(n,e){return wi(n).put(function(r,s){return{targetId:0,path:On(r.path),sequenceNumber:s}}(e,n.currentSequenceNumber))}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class lP{constructor(){this.changes=new ri(e=>e.toString(),(e,t)=>e.isEqual(t)),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,t){this.assertNotApplied(),this.changes.set(e,xt.newInvalidDocument(e).setReadTime(t))}getEntry(e,t){this.assertNotApplied();const r=this.changes.get(t);return r!==void 0?M.resolve(r):this.getFromCache(e,t)}getEntries(e,t){return this.getAllFromCache(e,t)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class g6{constructor(e){this.serializer=e}setIndexManager(e){this.indexManager=e}addEntry(e,t,r){return Eo(e).put(r)}removeEntry(e,t,r){return Eo(e).delete(function(i,o){const a=i.path.toArray();return[a.slice(0,a.length-2),a[a.length-2],Ap(o),a[a.length-1]]}(t,r))}updateMetadata(e,t){return this.getMetadata(e).next(r=>(r.byteSize+=t,this.Dr(e,r)))}getEntry(e,t){let r=xt.newInvalidDocument(t);return Eo(e).ee({index:vf,range:IDBKeyRange.only(qc(t))},(s,i)=>{r=this.Cr(t,i)}).next(()=>r)}vr(e,t){let r={size:0,document:xt.newInvalidDocument(t)};return Eo(e).ee({index:vf,range:IDBKeyRange.only(qc(t))},(s,i)=>{r={document:this.Cr(t,i),size:Rp(i)}}).next(()=>r)}getEntries(e,t){let r=Xn();return this.Fr(e,t,(s,i)=>{const o=this.Cr(s,i);r=r.insert(s,o)}).next(()=>r)}Mr(e,t){let r=Xn(),s=new wt(X.comparator);return this.Fr(e,t,(i,o)=>{const a=this.Cr(i,o);r=r.insert(i,a),s=s.insert(i,Rp(o))}).next(()=>({documents:r,Or:s}))}Fr(e,t,r){if(t.isEmpty())return M.resolve();let s=new ot(gS);t.forEach(l=>s=s.add(l));const i=IDBKeyRange.bound(qc(s.first()),qc(s.last())),o=s.getIterator();let a=o.getNext();return Eo(e).ee({index:vf,range:i},(l,u,h)=>{const f=X.fromSegments([...u.prefixPath,u.collectionGroup,u.documentId]);for(;a&&gS(a,f)<0;)r(a,null),a=o.getNext();a&&a.isEqual(f)&&(r(a,u),a=o.hasNext()?o.getNext():null),a?h.j(qc(a)):h.done()}).next(()=>{for(;a;)r(a,null),a=o.hasNext()?o.getNext():null})}getDocumentsMatchingQuery(e,t,r,s,i){const o=t.path,a=[o.popLast().toArray(),o.lastSegment(),Ap(r.readTime),r.documentKey.path.isEmpty()?"":r.documentKey.path.lastSegment()],l=[o.popLast().toArray(),o.lastSegment(),[Number.MAX_SAFE_INTEGER,Number.MAX_SAFE_INTEGER],""];return Eo(e).J(IDBKeyRange.bound(a,l,!0)).next(u=>{i==null||i.incrementDocumentReadCount(u.length);let h=Xn();for(const f of u){const p=this.Cr(X.fromSegments(f.prefixPath.concat(f.collectionGroup,f.documentId)),f);p.isFoundDocument()&&(Hd(t,p)||s.has(p.key))&&(h=h.insert(p.key,p))}return h})}getAllFromCollectionGroup(e,t,r,s){let i=Xn();const o=mS(t,r),a=mS(t,xr.max());return Eo(e).ee({index:qR,range:IDBKeyRange.bound(o,a,!0)},(l,u,h)=>{const f=this.Cr(X.fromSegments(u.prefixPath.concat(u.collectionGroup,u.documentId)),u);i=i.insert(f.key,f),i.size===s&&h.done()}).next(()=>i)}newChangeBuffer(e){return new y6(this,!!e&&e.trackRemovals)}getSize(e){return this.getMetadata(e).next(t=>t.byteSize)}getMetadata(e){return pS(e).get(J_).next(t=>(ae(!!t,20021),t))}Dr(e,t){return pS(e).put(J_,t)}Cr(e,t){if(t){const r=n6(this.serializer,t);if(!(r.isNoDocument()&&r.version.isEqual(ue.min())))return r}return xt.newInvalidDocument(e)}}function cP(n){return new g6(n)}class y6 extends lP{constructor(e,t){super(),this.Nr=e,this.trackRemovals=t,this.Br=new ri(r=>r.toString(),(r,s)=>r.isEqual(s))}applyChanges(e){const t=[];let r=0,s=new ot((i,o)=>ve(i.canonicalString(),o.canonicalString()));return this.changes.forEach((i,o)=>{const a=this.Br.get(i);if(t.push(this.Nr.removeEntry(e,i,a.readTime)),o.isValidDocument()){const l=JT(this.Nr.serializer,o);s=s.add(i.path.popLast());const u=Rp(l);r+=u-a.size,t.push(this.Nr.addEntry(e,i,l))}else if(r-=a.size,this.trackRemovals){const l=JT(this.Nr.serializer,o.convertToNoDocument(ue.min()));t.push(this.Nr.addEntry(e,i,l))}}),s.forEach(i=>{t.push(this.Nr.indexManager.addToCollectionParentIndex(e,i))}),t.push(this.Nr.updateMetadata(e,r)),M.waitFor(t)}getFromCache(e,t){return this.Nr.vr(e,t).next(r=>(this.Br.set(t,{size:r.size,readTime:r.document.readTime}),r.document))}getAllFromCache(e,t){return this.Nr.Mr(e,t).next(({documents:r,Or:s})=>(s.forEach((i,o)=>{this.Br.set(i,{size:o,readTime:r.get(i).readTime})}),r))}}function pS(n){return rn(n,ld)}function Eo(n){return rn(n,Ep)}function qc(n){const e=n.path.toArray();return[e.slice(0,e.length-2),e[e.length-2],e[e.length-1]]}function mS(n,e){const t=e.documentKey.path.toArray();return[n,Ap(e.readTime),t.slice(0,t.length-2),t.length>0?t[t.length-1]:""]}function gS(n,e){const t=n.path.toArray(),r=e.path.toArray();let s=0;for(let i=0;i<t.length-2&&i<r.length-2;++i)if(s=ve(t[i],r[i]),s)return s;return s=ve(t.length,r.length),s||(s=ve(t[t.length-2],r[r.length-2]),s||ve(t[t.length-1],r[r.length-1]))}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class _6{constructor(e,t){this.overlayedDocument=e,this.mutatedFields=t}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class uP{constructor(e,t,r,s){this.remoteDocumentCache=e,this.mutationQueue=t,this.documentOverlayCache=r,this.indexManager=s}getDocument(e,t){let r=null;return this.documentOverlayCache.getOverlay(e,t).next(s=>(r=s,this.remoteDocumentCache.getEntry(e,t))).next(s=>(r!==null&&bu(r.mutation,s,Jn.empty(),rt.now()),s))}getDocuments(e,t){return this.remoteDocumentCache.getEntries(e,t).next(r=>this.getLocalViewOfDocuments(e,r,be()).next(()=>r))}getLocalViewOfDocuments(e,t,r=be()){const s=ps();return this.populateOverlays(e,s,t).next(()=>this.computeViews(e,t,s,r).next(i=>{let o=tu();return i.forEach((a,l)=>{o=o.insert(a,l.overlayedDocument)}),o}))}getOverlayedDocuments(e,t){const r=ps();return this.populateOverlays(e,r,t).next(()=>this.computeViews(e,t,r,be()))}populateOverlays(e,t,r){const s=[];return r.forEach(i=>{t.has(i)||s.push(i)}),this.documentOverlayCache.getOverlays(e,s).next(i=>{i.forEach((o,a)=>{t.set(o,a)})})}computeViews(e,t,r,s){let i=Xn();const o=Su(),a=function(){return Su()}();return t.forEach((l,u)=>{const h=r.get(u.key);s.has(u.key)&&(h===void 0||h.mutation instanceof si)?i=i.insert(u.key,u):h!==void 0?(o.set(u.key,h.mutation.getFieldMask()),bu(h.mutation,u,h.mutation.getFieldMask(),rt.now())):o.set(u.key,Jn.empty())}),this.recalculateAndSaveOverlays(e,i).next(l=>(l.forEach((u,h)=>o.set(u,h)),t.forEach((u,h)=>a.set(u,new _6(h,o.get(u)??null))),a))}recalculateAndSaveOverlays(e,t){const r=Su();let s=new wt((o,a)=>o-a),i=be();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,t).next(o=>{for(const a of o)a.keys().forEach(l=>{const u=t.get(l);if(u===null)return;let h=r.get(l)||Jn.empty();h=a.applyToLocalView(u,h),r.set(l,h);const f=(s.get(a.batchId)||be()).add(l);s=s.insert(a.batchId,f)})}).next(()=>{const o=[],a=s.getReverseIterator();for(;a.hasNext();){const l=a.getNext(),u=l.key,h=l.value,f=SN();h.forEach(p=>{if(!i.has(p)){const y=kN(t.get(p),r.get(p));y!==null&&f.set(p,y),i=i.add(p)}}),o.push(this.documentOverlayCache.saveOverlays(e,u,f))}return M.waitFor(o)}).next(()=>r)}recalculateAndSaveOverlaysForDocumentKeys(e,t){return this.remoteDocumentCache.getEntries(e,t).next(r=>this.recalculateAndSaveOverlays(e,r))}getDocumentsMatchingQuery(e,t,r,s){return function(o){return X.isDocumentKey(o.path)&&o.collectionGroup===null&&o.filters.length===0}(t)?this.getDocumentsMatchingDocumentQuery(e,t.path):yw(t)?this.getDocumentsMatchingCollectionGroupQuery(e,t,r,s):this.getDocumentsMatchingCollectionQuery(e,t,r,s)}getNextDocuments(e,t,r,s){return this.remoteDocumentCache.getAllFromCollectionGroup(e,t,r,s).next(i=>{const o=s-i.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(e,t,r.largestBatchId,s-i.size):M.resolve(ps());let a=Ml,l=i;return o.next(u=>M.forEach(u,(h,f)=>(a<f.largestBatchId&&(a=f.largestBatchId),i.get(h)?M.resolve():this.remoteDocumentCache.getEntry(e,h).next(p=>{l=l.insert(h,p)}))).next(()=>this.populateOverlays(e,u,i)).next(()=>this.computeViews(e,l,u,be())).next(h=>({batchId:a,changes:TN(h)})))})}getDocumentsMatchingDocumentQuery(e,t){return this.getDocument(e,new X(t)).next(r=>{let s=tu();return r.isFoundDocument()&&(s=s.insert(r.key,r)),s})}getDocumentsMatchingCollectionGroupQuery(e,t,r,s){const i=t.collectionGroup;let o=tu();return this.indexManager.getCollectionParents(e,i).next(a=>M.forEach(a,l=>{const u=function(f,p){return new ni(p,null,f.explicitOrderBy.slice(),f.filters.slice(),f.limit,f.limitType,f.startAt,f.endAt)}(t,l.child(i));return this.getDocumentsMatchingCollectionQuery(e,u,r,s).next(h=>{h.forEach((f,p)=>{o=o.insert(f,p)})})}).next(()=>o))}getDocumentsMatchingCollectionQuery(e,t,r,s){let i;return this.documentOverlayCache.getOverlaysForCollection(e,t.path,r.largestBatchId).next(o=>(i=o,this.remoteDocumentCache.getDocumentsMatchingQuery(e,t,r,i,s))).next(o=>{i.forEach((l,u)=>{const h=u.getKey();o.get(h)===null&&(o=o.insert(h,xt.newInvalidDocument(h)))});let a=tu();return o.forEach((l,u)=>{const h=i.get(l);h!==void 0&&bu(h.mutation,u,Jn.empty(),rt.now()),Hd(t,u)&&(a=a.insert(l,u))}),a})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class v6{constructor(e){this.serializer=e,this.Lr=new Map,this.kr=new Map}getBundleMetadata(e,t){return M.resolve(this.Lr.get(t))}saveBundleMetadata(e,t){return this.Lr.set(t.id,function(s){return{id:s.id,version:s.version,createTime:Ht(s.createTime)}}(t)),M.resolve()}getNamedQuery(e,t){return M.resolve(this.kr.get(t))}saveNamedQuery(e,t){return this.kr.set(t.name,function(s){return{name:s.name,query:jm(s.bundledQuery),readTime:Ht(s.readTime)}}(t)),M.resolve()}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class w6{constructor(){this.overlays=new wt(X.comparator),this.qr=new Map}getOverlay(e,t){return M.resolve(this.overlays.get(t))}getOverlays(e,t){const r=ps();return M.forEach(t,s=>this.getOverlay(e,s).next(i=>{i!==null&&r.set(s,i)})).next(()=>r)}saveOverlays(e,t,r){return r.forEach((s,i)=>{this.St(e,t,i)}),M.resolve()}removeOverlaysForBatchId(e,t,r){const s=this.qr.get(r);return s!==void 0&&(s.forEach(i=>this.overlays=this.overlays.remove(i)),this.qr.delete(r)),M.resolve()}getOverlaysForCollection(e,t,r){const s=ps(),i=t.length+1,o=new X(t.child("")),a=this.overlays.getIteratorFrom(o);for(;a.hasNext();){const l=a.getNext().value,u=l.getKey();if(!t.isPrefixOf(u.path))break;u.path.length===i&&l.largestBatchId>r&&s.set(l.getKey(),l)}return M.resolve(s)}getOverlaysForCollectionGroup(e,t,r,s){let i=new wt((u,h)=>u-h);const o=this.overlays.getIterator();for(;o.hasNext();){const u=o.getNext().value;if(u.getKey().getCollectionGroup()===t&&u.largestBatchId>r){let h=i.get(u.largestBatchId);h===null&&(h=ps(),i=i.insert(u.largestBatchId,h)),h.set(u.getKey(),u)}}const a=ps(),l=i.getIterator();for(;l.hasNext()&&(l.getNext().value.forEach((u,h)=>a.set(u,h)),!(a.size()>=s)););return M.resolve(a)}St(e,t,r){const s=this.overlays.get(r.key);if(s!==null){const o=this.qr.get(s.largestBatchId).delete(r.key);this.qr.set(s.largestBatchId,o)}this.overlays=this.overlays.insert(r.key,new xw(t,r));let i=this.qr.get(t);i===void 0&&(i=be(),this.qr.set(t,i)),this.qr.set(t,i.add(r.key))}}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class I6{constructor(){this.sessionToken=$t.EMPTY_BYTE_STRING}getSessionToken(e){return M.resolve(this.sessionToken)}setSessionToken(e,t){return this.sessionToken=t,M.resolve()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Cw{constructor(){this.Qr=new ot(ln.$r),this.Ur=new ot(ln.Kr)}isEmpty(){return this.Qr.isEmpty()}addReference(e,t){const r=new ln(e,t);this.Qr=this.Qr.add(r),this.Ur=this.Ur.add(r)}Wr(e,t){e.forEach(r=>this.addReference(r,t))}removeReference(e,t){this.Gr(new ln(e,t))}zr(e,t){e.forEach(r=>this.removeReference(r,t))}jr(e){const t=new X(new Ve([])),r=new ln(t,e),s=new ln(t,e+1),i=[];return this.Ur.forEachInRange([r,s],o=>{this.Gr(o),i.push(o.key)}),i}Jr(){this.Qr.forEach(e=>this.Gr(e))}Gr(e){this.Qr=this.Qr.delete(e),this.Ur=this.Ur.delete(e)}Hr(e){const t=new X(new Ve([])),r=new ln(t,e),s=new ln(t,e+1);let i=be();return this.Ur.forEachInRange([r,s],o=>{i=i.add(o.key)}),i}containsKey(e){const t=new ln(e,0),r=this.Qr.firstAfterOrEqual(t);return r!==null&&e.isEqual(r.key)}}class ln{constructor(e,t){this.key=e,this.Yr=t}static $r(e,t){return X.comparator(e.key,t.key)||ve(e.Yr,t.Yr)}static Kr(e,t){return ve(e.Yr,t.Yr)||X.comparator(e.key,t.key)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class E6{constructor(e,t){this.indexManager=e,this.referenceDelegate=t,this.mutationQueue=[],this.tr=1,this.Zr=new ot(ln.$r)}checkEmpty(e){return M.resolve(this.mutationQueue.length===0)}addMutationBatch(e,t,r,s){const i=this.tr;this.tr++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];const o=new Iw(i,t,r,s);this.mutationQueue.push(o);for(const a of s)this.Zr=this.Zr.add(new ln(a.key,i)),this.indexManager.addToCollectionParentIndex(e,a.key.path.popLast());return M.resolve(o)}lookupMutationBatch(e,t){return M.resolve(this.Xr(t))}getNextMutationBatchAfterBatchId(e,t){const r=t+1,s=this.ei(r),i=s<0?0:s;return M.resolve(this.mutationQueue.length>i?this.mutationQueue[i]:null)}getHighestUnacknowledgedBatchId(){return M.resolve(this.mutationQueue.length===0?Wi:this.tr-1)}getAllMutationBatches(e){return M.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,t){const r=new ln(t,0),s=new ln(t,Number.POSITIVE_INFINITY),i=[];return this.Zr.forEachInRange([r,s],o=>{const a=this.Xr(o.Yr);i.push(a)}),M.resolve(i)}getAllMutationBatchesAffectingDocumentKeys(e,t){let r=new ot(ve);return t.forEach(s=>{const i=new ln(s,0),o=new ln(s,Number.POSITIVE_INFINITY);this.Zr.forEachInRange([i,o],a=>{r=r.add(a.Yr)})}),M.resolve(this.ti(r))}getAllMutationBatchesAffectingQuery(e,t){const r=t.path,s=r.length+1;let i=r;X.isDocumentKey(i)||(i=i.child(""));const o=new ln(new X(i),0);let a=new ot(ve);return this.Zr.forEachWhile(l=>{const u=l.key.path;return!!r.isPrefixOf(u)&&(u.length===s&&(a=a.add(l.Yr)),!0)},o),M.resolve(this.ti(a))}ti(e){const t=[];return e.forEach(r=>{const s=this.Xr(r);s!==null&&t.push(s)}),t}removeMutationBatch(e,t){ae(this.ni(t.batchId,"removed")===0,55003),this.mutationQueue.shift();let r=this.Zr;return M.forEach(t.mutations,s=>{const i=new ln(s.key,t.batchId);return r=r.delete(i),this.referenceDelegate.markPotentiallyOrphaned(e,s.key)}).next(()=>{this.Zr=r})}ir(e){}containsKey(e,t){const r=new ln(t,0),s=this.Zr.firstAfterOrEqual(r);return M.resolve(t.isEqual(s&&s.key))}performConsistencyCheck(e){return this.mutationQueue.length,M.resolve()}ni(e,t){return this.ei(e)}ei(e){return this.mutationQueue.length===0?0:e-this.mutationQueue[0].batchId}Xr(e){const t=this.ei(e);return t<0||t>=this.mutationQueue.length?null:this.mutationQueue[t]}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class x6{constructor(e){this.ri=e,this.docs=function(){return new wt(X.comparator)}(),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,t){const r=t.key,s=this.docs.get(r),i=s?s.size:0,o=this.ri(t);return this.docs=this.docs.insert(r,{document:t.mutableCopy(),size:o}),this.size+=o-i,this.indexManager.addToCollectionParentIndex(e,r.path.popLast())}removeEntry(e){const t=this.docs.get(e);t&&(this.docs=this.docs.remove(e),this.size-=t.size)}getEntry(e,t){const r=this.docs.get(t);return M.resolve(r?r.document.mutableCopy():xt.newInvalidDocument(t))}getEntries(e,t){let r=Xn();return t.forEach(s=>{const i=this.docs.get(s);r=r.insert(s,i?i.document.mutableCopy():xt.newInvalidDocument(s))}),M.resolve(r)}getDocumentsMatchingQuery(e,t,r,s){let i=Xn();const o=t.path,a=new X(o.child("__id-9223372036854775808__")),l=this.docs.getIteratorFrom(a);for(;l.hasNext();){const{key:u,value:{document:h}}=l.getNext();if(!o.isPrefixOf(u.path))break;u.path.length>o.length+1||lw(FR(h),r)<=0||(s.has(h.key)||Hd(t,h))&&(i=i.insert(h.key,h.mutableCopy()))}return M.resolve(i)}getAllFromCollectionGroup(e,t,r,s){se(9500)}ii(e,t){return M.forEach(this.docs,r=>t(r))}newChangeBuffer(e){return new T6(this)}getSize(e){return M.resolve(this.size)}}class T6 extends lP{constructor(e){super(),this.Nr=e}applyChanges(e){const t=[];return this.changes.forEach((r,s)=>{s.isValidDocument()?t.push(this.Nr.addEntry(e,s)):this.Nr.removeEntry(r)}),M.waitFor(t)}getFromCache(e,t){return this.Nr.getEntry(e,t)}getAllFromCache(e,t){return this.Nr.getEntries(e,t)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class S6{constructor(e){this.persistence=e,this.si=new ri(t=>ia(t),Wd),this.lastRemoteSnapshotVersion=ue.min(),this.highestTargetId=0,this.oi=0,this._i=new Cw,this.targetCount=0,this.ai=ua.ur()}forEachTarget(e,t){return this.si.forEach((r,s)=>t(s)),M.resolve()}getLastRemoteSnapshotVersion(e){return M.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return M.resolve(this.oi)}allocateTargetId(e){return this.highestTargetId=this.ai.next(),M.resolve(this.highestTargetId)}setTargetsMetadata(e,t,r){return r&&(this.lastRemoteSnapshotVersion=r),t>this.oi&&(this.oi=t),M.resolve()}Pr(e){this.si.set(e.target,e);const t=e.targetId;t>this.highestTargetId&&(this.ai=new ua(t),this.highestTargetId=t),e.sequenceNumber>this.oi&&(this.oi=e.sequenceNumber)}addTargetData(e,t){return this.Pr(t),this.targetCount+=1,M.resolve()}updateTargetData(e,t){return this.Pr(t),M.resolve()}removeTargetData(e,t){return this.si.delete(t.target),this._i.jr(t.targetId),this.targetCount-=1,M.resolve()}removeTargets(e,t,r){let s=0;const i=[];return this.si.forEach((o,a)=>{a.sequenceNumber<=t&&r.get(a.targetId)===null&&(this.si.delete(o),i.push(this.removeMatchingKeysForTargetId(e,a.targetId)),s++)}),M.waitFor(i).next(()=>s)}getTargetCount(e){return M.resolve(this.targetCount)}getTargetData(e,t){const r=this.si.get(t)||null;return M.resolve(r)}addMatchingKeys(e,t,r){return this._i.Wr(t,r),M.resolve()}removeMatchingKeys(e,t,r){this._i.zr(t,r);const s=this.persistence.referenceDelegate,i=[];return s&&t.forEach(o=>{i.push(s.markPotentiallyOrphaned(e,o))}),M.waitFor(i)}removeMatchingKeysForTargetId(e,t){return this._i.jr(t),M.resolve()}getMatchingKeysForTargetId(e,t){const r=this._i.Hr(t);return M.resolve(r)}containsKey(e,t){return M.resolve(this._i.containsKey(t))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Rw{constructor(e,t){this.ui={},this.overlays={},this.ci=new Yn(0),this.li=!1,this.li=!0,this.hi=new I6,this.referenceDelegate=e(this),this.Pi=new S6(this),this.indexManager=new u6,this.remoteDocumentCache=function(s){return new x6(s)}(r=>this.referenceDelegate.Ti(r)),this.serializer=new JN(t),this.Ii=new v6(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.li=!1,Promise.resolve()}get started(){return this.li}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let t=this.overlays[e.toKey()];return t||(t=new w6,this.overlays[e.toKey()]=t),t}getMutationQueue(e,t){let r=this.ui[e.toKey()];return r||(r=new E6(t,this.referenceDelegate),this.ui[e.toKey()]=r),r}getGlobalsCache(){return this.hi}getTargetCache(){return this.Pi}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.Ii}runTransaction(e,t,r){q("MemoryPersistence","Starting transaction:",e);const s=new b6(this.ci.next());return this.referenceDelegate.Ei(),r(s).next(i=>this.referenceDelegate.di(s).next(()=>i)).toPromise().then(i=>(s.raiseOnCommittedEvent(),i))}Ai(e,t){return M.or(Object.values(this.ui).map(r=>()=>r.containsKey(e,t)))}}class b6 extends UR{constructor(e){super(),this.currentSequenceNumber=e}}class $m{constructor(e){this.persistence=e,this.Ri=new Cw,this.Vi=null}static mi(e){return new $m(e)}get fi(){if(this.Vi)return this.Vi;throw se(60996)}addReference(e,t,r){return this.Ri.addReference(r,t),this.fi.delete(r.toString()),M.resolve()}removeReference(e,t,r){return this.Ri.removeReference(r,t),this.fi.add(r.toString()),M.resolve()}markPotentiallyOrphaned(e,t){return this.fi.add(t.toString()),M.resolve()}removeTarget(e,t){this.Ri.jr(t.targetId).forEach(s=>this.fi.add(s.toString()));const r=this.persistence.getTargetCache();return r.getMatchingKeysForTargetId(e,t.targetId).next(s=>{s.forEach(i=>this.fi.add(i.toString()))}).next(()=>r.removeTargetData(e,t))}Ei(){this.Vi=new Set}di(e){const t=this.persistence.getRemoteDocumentCache().newChangeBuffer();return M.forEach(this.fi,r=>{const s=X.fromPath(r);return this.gi(e,s).next(i=>{i||t.removeEntry(s,ue.min())})}).next(()=>(this.Vi=null,t.apply(e)))}updateLimboDocument(e,t){return this.gi(e,t).next(r=>{r?this.fi.delete(t.toString()):this.fi.add(t.toString())})}Ti(e){return 0}gi(e,t){return M.or([()=>M.resolve(this.Ri.containsKey(t)),()=>this.persistence.getTargetCache().containsKey(e,t),()=>this.persistence.Ai(e,t)])}}class Np{constructor(e,t){this.persistence=e,this.pi=new ri(r=>On(r.path),(r,s)=>r.isEqual(s)),this.garbageCollector=aP(this,t)}static mi(e,t){return new Np(e,t)}Ei(){}di(e){return M.resolve()}forEachTarget(e,t){return this.persistence.getTargetCache().forEachTarget(e,t)}gr(e){const t=this.wr(e);return this.persistence.getTargetCache().getTargetCount(e).next(r=>t.next(s=>r+s))}wr(e){let t=0;return this.pr(e,r=>{t++}).next(()=>t)}pr(e,t){return M.forEach(this.pi,(r,s)=>this.br(e,r,s).next(i=>i?M.resolve():t(s)))}removeTargets(e,t,r){return this.persistence.getTargetCache().removeTargets(e,t,r)}removeOrphanedDocuments(e,t){let r=0;const s=this.persistence.getRemoteDocumentCache(),i=s.newChangeBuffer();return s.ii(e,o=>this.br(e,o,t).next(a=>{a||(r++,i.removeEntry(o,ue.min()))})).next(()=>i.apply(e)).next(()=>r)}markPotentiallyOrphaned(e,t){return this.pi.set(t,e.currentSequenceNumber),M.resolve()}removeTarget(e,t){const r=t.withSequenceNumber(e.currentSequenceNumber);return this.persistence.getTargetCache().updateTargetData(e,r)}addReference(e,t,r){return this.pi.set(r,e.currentSequenceNumber),M.resolve()}removeReference(e,t,r){return this.pi.set(r,e.currentSequenceNumber),M.resolve()}updateLimboDocument(e,t){return this.pi.set(t,e.currentSequenceNumber),M.resolve()}Ti(e){let t=e.key.toString().length;return e.isFoundDocument()&&(t+=If(e.data.value)),t}br(e,t,r){return M.or([()=>this.persistence.Ai(e,t),()=>this.persistence.getTargetCache().containsKey(e,t),()=>{const s=this.pi.get(t);return M.resolve(s!==void 0&&s>r)}])}getCacheSize(e){return this.persistence.getRemoteDocumentCache().getSize(e)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class A6{constructor(e){this.serializer=e}k(e,t,r,s){const i=new Cm("createOrUpgrade",t);r<1&&s>=1&&(function(l){l.createObjectStore(qd)}(e),function(l){l.createObjectStore(ad,{keyPath:G4}),l.createObjectStore(Wr,{keyPath:AT,autoIncrement:!0}).createIndex(Vo,CT,{unique:!0}),l.createObjectStore(Fl)}(e),yS(e),function(l){l.createObjectStore(Co)}(e));let o=M.resolve();return r<3&&s>=3&&(r!==0&&(function(l){l.deleteObjectStore(Ul),l.deleteObjectStore(jl),l.deleteObjectStore(qo)}(e),yS(e)),o=o.next(()=>function(l){const u=l.store(qo),h={highestTargetId:0,highestListenSequenceNumber:0,lastRemoteSnapshotVersion:ue.min().toTimestamp(),targetCount:0};return u.put(xp,h)}(i))),r<4&&s>=4&&(r!==0&&(o=o.next(()=>function(l,u){return u.store(Wr).J().next(f=>{l.deleteObjectStore(Wr),l.createObjectStore(Wr,{keyPath:AT,autoIncrement:!0}).createIndex(Vo,CT,{unique:!0});const p=u.store(Wr),y=f.map(I=>p.put(I));return M.waitFor(y)})}(e,i))),o=o.next(()=>{(function(l){l.createObjectStore(Bl,{keyPath:t3})})(e)})),r<5&&s>=5&&(o=o.next(()=>this.yi(i))),r<6&&s>=6&&(o=o.next(()=>(function(l){l.createObjectStore(ld)}(e),this.wi(i)))),r<7&&s>=7&&(o=o.next(()=>this.Si(i))),r<8&&s>=8&&(o=o.next(()=>this.bi(e,i))),r<9&&s>=9&&(o=o.next(()=>{(function(l){l.objectStoreNames.contains("remoteDocumentChanges")&&l.deleteObjectStore("remoteDocumentChanges")})(e)})),r<10&&s>=10&&(o=o.next(()=>this.Di(i))),r<11&&s>=11&&(o=o.next(()=>{(function(l){l.createObjectStore(Rm,{keyPath:n3})})(e),function(l){l.createObjectStore(Nm,{keyPath:r3})}(e)})),r<12&&s>=12&&(o=o.next(()=>{(function(l){const u=l.createObjectStore(Pm,{keyPath:u3});u.createIndex(Z_,d3,{unique:!1}),u.createIndex(KR,h3,{unique:!1})})(e)})),r<13&&s>=13&&(o=o.next(()=>function(l){const u=l.createObjectStore(Ep,{keyPath:K4});u.createIndex(vf,Q4),u.createIndex(qR,Y4)}(e)).next(()=>this.Ci(e,i)).next(()=>e.deleteObjectStore(Co))),r<14&&s>=14&&(o=o.next(()=>this.Fi(e,i))),r<15&&s>=15&&(o=o.next(()=>function(l){l.createObjectStore(dw,{keyPath:s3,autoIncrement:!0}).createIndex(X_,i3,{unique:!1}),l.createObjectStore(Eu,{keyPath:o3}).createIndex(GR,a3,{unique:!1}),l.createObjectStore(xu,{keyPath:l3}).createIndex(HR,c3,{unique:!1})}(e))),r<16&&s>=16&&(o=o.next(()=>{t.objectStore(Eu).clear()}).next(()=>{t.objectStore(xu).clear()})),r<17&&s>=17&&(o=o.next(()=>{(function(l){l.createObjectStore(hw,{keyPath:f3})})(e)})),r<18&&s>=18&&JA()&&(o=o.next(()=>{t.objectStore(Eu).clear()}).next(()=>{t.objectStore(xu).clear()})),o}wi(e){let t=0;return e.store(Co).ee((r,s)=>{t+=Rp(s)}).next(()=>{const r={byteSize:t};return e.store(ld).put(J_,r)})}yi(e){const t=e.store(ad),r=e.store(Wr);return t.J().next(s=>M.forEach(s,i=>{const o=IDBKeyRange.bound([i.userId,Wi],[i.userId,i.lastAcknowledgedBatchId]);return r.J(Vo,o).next(a=>M.forEach(a,l=>{ae(l.userId===i.userId,18650,"Cannot process batch from unexpected user",{batchId:l.batchId});const u=No(this.serializer,l);return nP(e,i.userId,u).next(()=>{})}))}))}Si(e){const t=e.store(Ul),r=e.store(Co);return e.store(qo).get(xp).next(s=>{const i=[];return r.ee((o,a)=>{const l=new Ve(o),u=function(f){return[0,On(f)]}(l);i.push(t.get(u).next(h=>h?M.resolve():(f=>t.put({targetId:0,path:On(f),sequenceNumber:s.highestListenSequenceNumber}))(l)))}).next(()=>M.waitFor(i))})}bi(e,t){e.createObjectStore(cd,{keyPath:e3});const r=t.store(cd),s=new Aw,i=o=>{if(s.add(o)){const a=o.lastSegment(),l=o.popLast();return r.put({collectionId:a,parent:On(l)})}};return t.store(Co).ee({X:!0},(o,a)=>{const l=new Ve(o);return i(l.popLast())}).next(()=>t.store(Fl).ee({X:!0},([o,a,l],u)=>{const h=fs(a);return i(h.popLast())}))}Di(e){const t=e.store(jl);return t.ee((r,s)=>{const i=ru(s),o=XN(this.serializer,i);return t.put(o)})}Ci(e,t){const r=t.store(Co),s=[];return r.ee((i,o)=>{const a=t.store(Ep),l=function(f){return f.document?new X(Ve.fromString(f.document.name).popFirst(5)):f.noDocument?X.fromSegments(f.noDocument.path):f.unknownDocument?X.fromSegments(f.unknownDocument.path):se(36783)}(o).path.toArray(),u={prefixPath:l.slice(0,l.length-2),collectionGroup:l[l.length-2],documentId:l[l.length-1],readTime:o.readTime||[0,0],unknownDocument:o.unknownDocument,noDocument:o.noDocument,document:o.document,hasCommittedMutations:!!o.hasCommittedMutations};s.push(a.put(u))}).next(()=>M.waitFor(s))}Fi(e,t){const r=t.store(Wr),s=cP(this.serializer),i=new Rw($m.mi,this.serializer.yt);return r.J().next(o=>{const a=new Map;return o.forEach(l=>{let u=a.get(l.userId)??be();No(this.serializer,l).keys().forEach(h=>u=u.add(h)),a.set(l.userId,u)}),M.forEach(a,(l,u)=>{const h=new un(u),f=Um.wt(this.serializer,h),p=i.getIndexManager(h),y=Bm.wt(h,this.serializer,p,i.referenceDelegate);return new uP(s,y,f,p).recalculateAndSaveOverlaysForDocumentKeys(new ev(t,Yn.ce),l).next()})})}}function yS(n){n.createObjectStore(Ul,{keyPath:X4}).createIndex(uw,Z4,{unique:!0}),n.createObjectStore(jl,{keyPath:"targetId"}).createIndex(WR,J4,{unique:!0}),n.createObjectStore(qo)}const fi="IndexedDbPersistence",hy=18e5,fy=5e3,py="Failed to obtain exclusive access to the persistence layer. To allow shared access, multi-tab synchronization has to be enabled in all tabs. If you are using `experimentalForceOwningTab:true`, make sure that only one tab has persistence enabled at any given time.",dP="main";class Nw{constructor(e,t,r,s,i,o,a,l,u,h,f=18){if(this.allowTabSynchronization=e,this.persistenceKey=t,this.clientId=r,this.Mi=i,this.window=o,this.document=a,this.xi=u,this.Oi=h,this.Ni=f,this.ci=null,this.li=!1,this.isPrimary=!1,this.networkEnabled=!0,this.Bi=null,this.inForeground=!1,this.Li=null,this.ki=null,this.qi=Number.NEGATIVE_INFINITY,this.Qi=p=>Promise.resolve(),!Nw.v())throw new z(V.UNIMPLEMENTED,"This platform is either missing IndexedDB or is known to have an incomplete implementation. Offline persistence has been disabled.");this.referenceDelegate=new m6(this,s),this.$i=t+dP,this.serializer=new JN(l),this.Ui=new vs(this.$i,this.Ni,new A6(this.serializer)),this.hi=new s6,this.Pi=new h6(this.referenceDelegate,this.serializer),this.remoteDocumentCache=cP(this.serializer),this.Ii=new r6,this.window&&this.window.localStorage?this.Ki=this.window.localStorage:(this.Ki=null,h===!1&&Gt(fi,"LocalStorage is unavailable. As a result, persistence may not work reliably. In particular enablePersistence() could fail immediately after refreshing the page."))}start(){return this.Wi().then(()=>{if(!this.isPrimary&&!this.allowTabSynchronization)throw new z(V.FAILED_PRECONDITION,py);return this.Gi(),this.zi(),this.ji(),this.runTransaction("getHighestListenSequenceNumber","readonly",e=>this.Pi.getHighestSequenceNumber(e))}).then(e=>{this.ci=new Yn(e,this.xi)}).then(()=>{this.li=!0}).catch(e=>(this.Ui&&this.Ui.close(),Promise.reject(e)))}Ji(e){return this.Qi=async t=>{if(this.started)return e(t)},e(this.isPrimary)}setDatabaseDeletedListener(e){this.Ui.$(async t=>{t.newVersion===null&&await e()})}setNetworkEnabled(e){this.networkEnabled!==e&&(this.networkEnabled=e,this.Mi.enqueueAndForget(async()=>{this.started&&await this.Wi()}))}Wi(){return this.runTransaction("updateClientMetadataAndTryBecomePrimary","readwrite",e=>Kh(e).put({clientId:this.clientId,updateTimeMs:Date.now(),networkEnabled:this.networkEnabled,inForeground:this.inForeground}).next(()=>{if(this.isPrimary)return this.Hi(e).next(t=>{t||(this.isPrimary=!1,this.Mi.enqueueRetryable(()=>this.Qi(!1)))})}).next(()=>this.Yi(e)).next(t=>this.isPrimary&&!t?this.Zi(e).next(()=>!1):!!t&&this.Xi(e).next(()=>!0))).catch(e=>{if(fo(e))return q(fi,"Failed to extend owner lease: ",e),this.isPrimary;if(!this.allowTabSynchronization)throw e;return q(fi,"Releasing owner lease after error during lease refresh",e),!1}).then(e=>{this.isPrimary!==e&&this.Mi.enqueueRetryable(()=>this.Qi(e)),this.isPrimary=e})}Hi(e){return Wc(e).get(Va).next(t=>M.resolve(this.es(t)))}ts(e){return Kh(e).delete(this.clientId)}async ns(){if(this.isPrimary&&!this.rs(this.qi,hy)){this.qi=Date.now();const e=await this.runTransaction("maybeGarbageCollectMultiClientState","readwrite-primary",t=>{const r=rn(t,Bl);return r.J().next(s=>{const i=this.ss(s,hy),o=s.filter(a=>i.indexOf(a)===-1);return M.forEach(o,a=>r.delete(a.clientId)).next(()=>o)})}).catch(()=>[]);if(this.Ki)for(const t of e)this.Ki.removeItem(this._s(t.clientId))}}ji(){this.ki=this.Mi.enqueueAfterDelay("client_metadata_refresh",4e3,()=>this.Wi().then(()=>this.ns()).then(()=>this.ji()))}es(e){return!!e&&e.ownerId===this.clientId}Yi(e){return this.Oi?M.resolve(!0):Wc(e).get(Va).next(t=>{if(t!==null&&this.rs(t.leaseTimestampMs,fy)&&!this.us(t.ownerId)){if(this.es(t)&&this.networkEnabled)return!0;if(!this.es(t)){if(!t.allowTabSynchronization)throw new z(V.FAILED_PRECONDITION,py);return!1}}return!(!this.networkEnabled||!this.inForeground)||Kh(e).J().next(r=>this.ss(r,fy).find(s=>{if(this.clientId!==s.clientId){const i=!this.networkEnabled&&s.networkEnabled,o=!this.inForeground&&s.inForeground,a=this.networkEnabled===s.networkEnabled;if(i||o&&a)return!0}return!1})===void 0)}).next(t=>(this.isPrimary!==t&&q(fi,`Client ${t?"is":"is not"} eligible for a primary lease.`),t))}async shutdown(){this.li=!1,this.cs(),this.ki&&(this.ki.cancel(),this.ki=null),this.ls(),this.hs(),await this.Ui.runTransaction("shutdown","readwrite",[qd,Bl],e=>{const t=new ev(e,Yn.ce);return this.Zi(t).next(()=>this.ts(t))}),this.Ui.close(),this.Ps()}ss(e,t){return e.filter(r=>this.rs(r.updateTimeMs,t)&&!this.us(r.clientId))}Ts(){return this.runTransaction("getActiveClients","readonly",e=>Kh(e).J().next(t=>this.ss(t,hy).map(r=>r.clientId)))}get started(){return this.li}getGlobalsCache(){return this.hi}getMutationQueue(e,t){return Bm.wt(e,this.serializer,t,this.referenceDelegate)}getTargetCache(){return this.Pi}getRemoteDocumentCache(){return this.remoteDocumentCache}getIndexManager(e){return new d6(e,this.serializer.yt.databaseId)}getDocumentOverlayCache(e){return Um.wt(this.serializer,e)}getBundleCache(){return this.Ii}runTransaction(e,t,r){q(fi,"Starting transaction:",e);const s=t==="readonly"?"readonly":"readwrite",i=function(l){return l===18?g3:l===17?XR:l===16?m3:l===15?fw:l===14?JR:l===13?YR:l===12?p3:l===11?QR:void se(60245)}(this.Ni);let o;return this.Ui.runTransaction(e,s,i,a=>(o=new ev(a,this.ci?this.ci.next():Yn.ce),t==="readwrite-primary"?this.Hi(o).next(l=>!!l||this.Yi(o)).next(l=>{if(!l)throw Gt(`Failed to obtain primary lease for action '${e}'.`),this.isPrimary=!1,this.Mi.enqueueRetryable(()=>this.Qi(!1)),new z(V.FAILED_PRECONDITION,jR);return r(o)}).next(l=>this.Xi(o).next(()=>l)):this.Is(o).next(()=>r(o)))).then(a=>(o.raiseOnCommittedEvent(),a))}Is(e){return Wc(e).get(Va).next(t=>{if(t!==null&&this.rs(t.leaseTimestampMs,fy)&&!this.us(t.ownerId)&&!this.es(t)&&!(this.Oi||this.allowTabSynchronization&&t.allowTabSynchronization))throw new z(V.FAILED_PRECONDITION,py)})}Xi(e){const t={ownerId:this.clientId,allowTabSynchronization:this.allowTabSynchronization,leaseTimestampMs:Date.now()};return Wc(e).put(Va,t)}static v(){return vs.v()}Zi(e){const t=Wc(e);return t.get(Va).next(r=>this.es(r)?(q(fi,"Releasing primary lease."),t.delete(Va)):M.resolve())}rs(e,t){const r=Date.now();return!(e<r-t)&&(!(e>r)||(Gt(`Detected an update time that is in the future: ${e} > ${r}`),!1))}Gi(){this.document!==null&&typeof this.document.addEventListener=="function"&&(this.Li=()=>{this.Mi.enqueueAndForget(()=>(this.inForeground=this.document.visibilityState==="visible",this.Wi()))},this.document.addEventListener("visibilitychange",this.Li),this.inForeground=this.document.visibilityState==="visible")}ls(){this.Li&&(this.document.removeEventListener("visibilitychange",this.Li),this.Li=null)}zi(){var e;typeof((e=this.window)==null?void 0:e.addEventListener)=="function"&&(this.Bi=()=>{this.cs();const t=/(?:Version|Mobile)\/1[456]/;YA()&&(navigator.appVersion.match(t)||navigator.userAgent.match(t))&&this.Mi.enterRestrictedMode(!0),this.Mi.enqueueAndForget(()=>this.shutdown())},this.window.addEventListener("pagehide",this.Bi))}hs(){this.Bi&&(this.window.removeEventListener("pagehide",this.Bi),this.Bi=null)}us(e){var t;try{const r=((t=this.Ki)==null?void 0:t.getItem(this._s(e)))!==null;return q(fi,`Client '${e}' ${r?"is":"is not"} zombied in LocalStorage`),r}catch(r){return Gt(fi,"Failed to get zombied client id.",r),!1}}cs(){if(this.Ki)try{this.Ki.setItem(this._s(this.clientId),String(Date.now()))}catch(e){Gt("Failed to set zombie client id.",e)}}Ps(){if(this.Ki)try{this.Ki.removeItem(this._s(this.clientId))}catch{}}_s(e){return`firestore_zombie_${this.persistenceKey}_${e}`}}function Wc(n){return rn(n,qd)}function Kh(n){return rn(n,Bl)}function Pw(n,e){let t=n.projectId;return n.isDefaultDatabase||(t+="."+n.database),"firestore/"+e+"/"+t+"/"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class kw{constructor(e,t,r,s){this.targetId=e,this.fromCache=t,this.Es=r,this.ds=s}static As(e,t){let r=be(),s=be();for(const i of t.docChanges)switch(i.type){case 0:r=r.add(i.doc.key);break;case 1:s=s.add(i.doc.key)}return new kw(e,t.fromCache,r,s)}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class C6{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(e){this._documentReadCount+=e}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class hP{constructor(){this.Rs=!1,this.Vs=!1,this.fs=100,this.gs=function(){return YA()?8:BR(nn())>0?6:4}()}initialize(e,t){this.ps=e,this.indexManager=t,this.Rs=!0}getDocumentsMatchingQuery(e,t,r,s){const i={result:null};return this.ys(e,t).next(o=>{i.result=o}).next(()=>{if(!i.result)return this.ws(e,t,s,r).next(o=>{i.result=o})}).next(()=>{if(i.result)return;const o=new C6;return this.Ss(e,t,o).next(a=>{if(i.result=a,this.Vs)return this.bs(e,t,o,a.size)})}).next(()=>i.result)}bs(e,t,r,s){return r.documentReadCount<this.fs?(za()<=Fe.DEBUG&&q("QueryEngine","SDK will not create cache indexes for query:",qa(t),"since it only creates cache indexes for collection contains","more than or equal to",this.fs,"documents"),M.resolve()):(za()<=Fe.DEBUG&&q("QueryEngine","Query:",qa(t),"scans",r.documentReadCount,"local documents and returns",s,"documents as results."),r.documentReadCount>this.gs*s?(za()<=Fe.DEBUG&&q("QueryEngine","The SDK decides to create cache indexes for query:",qa(t),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(e,Mn(t))):M.resolve())}ys(e,t){if(BT(t))return M.resolve(null);let r=Mn(t);return this.indexManager.getIndexType(e,r).next(s=>s===0?null:(t.limit!==null&&s===1&&(t=bp(t,null,"F"),r=Mn(t)),this.indexManager.getDocumentsMatchingTarget(e,r).next(i=>{const o=be(...i);return this.ps.getDocuments(e,o).next(a=>this.indexManager.getMinOffset(e,r).next(l=>{const u=this.Ds(t,a);return this.Cs(t,u,o,l.readTime)?this.ys(e,bp(t,null,"F")):this.vs(e,u,t,l)}))})))}ws(e,t,r,s){return BT(t)||s.isEqual(ue.min())?M.resolve(null):this.ps.getDocuments(e,r).next(i=>{const o=this.Ds(t,i);return this.Cs(t,o,r,s)?M.resolve(null):(za()<=Fe.DEBUG&&q("QueryEngine","Re-using previous result from %s to execute query: %s",s.toString(),qa(t)),this.vs(e,o,t,VR(s,Ml)).next(a=>a))})}Ds(e,t){let r=new ot(EN(e));return t.forEach((s,i)=>{Hd(e,i)&&(r=r.add(i))}),r}Cs(e,t,r,s){if(e.limit===null)return!1;if(r.size!==t.size)return!0;const i=e.limitType==="F"?t.last():t.first();return!!i&&(i.hasPendingWrites||i.version.compareTo(s)>0)}Ss(e,t,r){return za()<=Fe.DEBUG&&q("QueryEngine","Using full collection scan to execute query:",qa(t)),this.ps.getDocumentsMatchingQuery(e,t,xr.min(),r)}vs(e,t,r,s){return this.ps.getDocumentsMatchingQuery(e,r,s).next(i=>(t.forEach(o=>{i=i.insert(o.key,o)}),i))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Dw="LocalStore",R6=3e8;class N6{constructor(e,t,r,s){this.persistence=e,this.Fs=t,this.serializer=s,this.Ms=new wt(ve),this.xs=new ri(i=>ia(i),Wd),this.Os=new Map,this.Ns=e.getRemoteDocumentCache(),this.Pi=e.getTargetCache(),this.Ii=e.getBundleCache(),this.Bs(r)}Bs(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new uP(this.Ns,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.Ns.setIndexManager(this.indexManager),this.Fs.initialize(this.localDocuments,this.indexManager)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",t=>e.collect(t,this.Ms))}}function fP(n,e,t,r){return new N6(n,e,t,r)}async function pP(n,e){const t=Z(n);return await t.persistence.runTransaction("Handle user change","readonly",r=>{let s;return t.mutationQueue.getAllMutationBatches(r).next(i=>(s=i,t.Bs(e),t.mutationQueue.getAllMutationBatches(r))).next(i=>{const o=[],a=[];let l=be();for(const u of s){o.push(u.batchId);for(const h of u.mutations)l=l.add(h.key)}for(const u of i){a.push(u.batchId);for(const h of u.mutations)l=l.add(h.key)}return t.localDocuments.getDocuments(r,l).next(u=>({Ls:u,removedBatchIds:o,addedBatchIds:a}))})})}function P6(n,e){const t=Z(n);return t.persistence.runTransaction("Acknowledge batch","readwrite-primary",r=>{const s=e.batch.keys(),i=t.Ns.newChangeBuffer({trackRemovals:!0});return function(a,l,u,h){const f=u.batch,p=f.keys();let y=M.resolve();return p.forEach(I=>{y=y.next(()=>h.getEntry(l,I)).next(C=>{const P=u.docVersions.get(I);ae(P!==null,48541),C.version.compareTo(P)<0&&(f.applyToRemoteDocument(C,u),C.isValidDocument()&&(C.setReadTime(u.commitVersion),h.addEntry(C)))})}),y.next(()=>a.mutationQueue.removeMutationBatch(l,f))}(t,r,e,i).next(()=>i.apply(r)).next(()=>t.mutationQueue.performConsistencyCheck(r)).next(()=>t.documentOverlayCache.removeOverlaysForBatchId(r,s,e.batch.batchId)).next(()=>t.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(r,function(a){let l=be();for(let u=0;u<a.mutationResults.length;++u)a.mutationResults[u].transformResults.length>0&&(l=l.add(a.batch.mutations[u].key));return l}(e))).next(()=>t.localDocuments.getDocuments(r,s))})}function mP(n){const e=Z(n);return e.persistence.runTransaction("Get last remote snapshot version","readonly",t=>e.Pi.getLastRemoteSnapshotVersion(t))}function k6(n,e){const t=Z(n),r=e.snapshotVersion;let s=t.Ms;return t.persistence.runTransaction("Apply remote event","readwrite-primary",i=>{const o=t.Ns.newChangeBuffer({trackRemovals:!0});s=t.Ms;const a=[];e.targetChanges.forEach((h,f)=>{const p=s.get(f);if(!p)return;a.push(t.Pi.removeMatchingKeys(i,h.removedDocuments,f).next(()=>t.Pi.addMatchingKeys(i,h.addedDocuments,f)));let y=p.withSequenceNumber(i.currentSequenceNumber);e.targetMismatches.get(f)!==null?y=y.withResumeToken($t.EMPTY_BYTE_STRING,ue.min()).withLastLimboFreeSnapshotVersion(ue.min()):h.resumeToken.approximateByteSize()>0&&(y=y.withResumeToken(h.resumeToken,r)),s=s.insert(f,y),function(C,P,A){return C.resumeToken.approximateByteSize()===0||P.snapshotVersion.toMicroseconds()-C.snapshotVersion.toMicroseconds()>=R6?!0:A.addedDocuments.size+A.modifiedDocuments.size+A.removedDocuments.size>0}(p,y,h)&&a.push(t.Pi.updateTargetData(i,y))});let l=Xn(),u=be();if(e.documentUpdates.forEach(h=>{e.resolvedLimboDocuments.has(h)&&a.push(t.persistence.referenceDelegate.updateLimboDocument(i,h))}),a.push(gP(i,o,e.documentUpdates).next(h=>{l=h.ks,u=h.qs})),!r.isEqual(ue.min())){const h=t.Pi.getLastRemoteSnapshotVersion(i).next(f=>t.Pi.setTargetsMetadata(i,i.currentSequenceNumber,r));a.push(h)}return M.waitFor(a).next(()=>o.apply(i)).next(()=>t.localDocuments.getLocalViewOfDocuments(i,l,u)).next(()=>l)}).then(i=>(t.Ms=s,i))}function gP(n,e,t){let r=be(),s=be();return t.forEach(i=>r=r.add(i)),e.getEntries(n,r).next(i=>{let o=Xn();return t.forEach((a,l)=>{const u=i.get(a);l.isFoundDocument()!==u.isFoundDocument()&&(s=s.add(a)),l.isNoDocument()&&l.version.isEqual(ue.min())?(e.removeEntry(a,l.readTime),o=o.insert(a,l)):!u.isValidDocument()||l.version.compareTo(u.version)>0||l.version.compareTo(u.version)===0&&u.hasPendingWrites?(e.addEntry(l),o=o.insert(a,l)):q(Dw,"Ignoring outdated watch update for ",a,". Current version:",u.version," Watch version:",l.version)}),{ks:o,qs:s}})}function D6(n,e){const t=Z(n);return t.persistence.runTransaction("Get next mutation batch","readonly",r=>(e===void 0&&(e=Wi),t.mutationQueue.getNextMutationBatchAfterBatchId(r,e)))}function Kl(n,e){const t=Z(n);return t.persistence.runTransaction("Allocate target","readwrite",r=>{let s;return t.Pi.getTargetData(r,e).next(i=>i?(s=i,M.resolve(s)):t.Pi.allocateTargetId(r).next(o=>(s=new Fs(e,o,"TargetPurposeListen",r.currentSequenceNumber),t.Pi.addTargetData(r,s).next(()=>s))))}).then(r=>{const s=t.Ms.get(r.targetId);return(s===null||r.snapshotVersion.compareTo(s.snapshotVersion)>0)&&(t.Ms=t.Ms.insert(r.targetId,r),t.xs.set(e,r.targetId)),r})}async function Ql(n,e,t){const r=Z(n),s=r.Ms.get(e),i=t?"readwrite":"readwrite-primary";try{t||await r.persistence.runTransaction("Release target",i,o=>r.persistence.referenceDelegate.removeTarget(o,s))}catch(o){if(!fo(o))throw o;q(Dw,`Failed to update sequence numbers for target ${e}: ${o}`)}r.Ms=r.Ms.remove(e),r.xs.delete(s.target)}function Pp(n,e,t){const r=Z(n);let s=ue.min(),i=be();return r.persistence.runTransaction("Execute query","readwrite",o=>function(l,u,h){const f=Z(l),p=f.xs.get(h);return p!==void 0?M.resolve(f.Ms.get(p)):f.Pi.getTargetData(u,h)}(r,o,Mn(e)).next(a=>{if(a)return s=a.lastLimboFreeSnapshotVersion,r.Pi.getMatchingKeysForTargetId(o,a.targetId).next(l=>{i=l})}).next(()=>r.Fs.getDocumentsMatchingQuery(o,e,t?s:ue.min(),t?i:be())).next(a=>(vP(r,IN(e),a),{documents:a,Qs:i})))}function yP(n,e){const t=Z(n),r=Z(t.Pi),s=t.Ms.get(e);return s?Promise.resolve(s.target):t.persistence.runTransaction("Get target data","readonly",i=>r.At(i,e).next(o=>o?o.target:null))}function _P(n,e){const t=Z(n),r=t.Os.get(e)||ue.min();return t.persistence.runTransaction("Get new document changes","readonly",s=>t.Ns.getAllFromCollectionGroup(s,e,VR(r,Ml),Number.MAX_SAFE_INTEGER)).then(s=>(vP(t,e,s),s))}function vP(n,e,t){let r=n.Os.get(e)||ue.min();t.forEach((s,i)=>{i.readTime.compareTo(r)>0&&(r=i.readTime)}),n.Os.set(e,r)}async function O6(n,e,t,r){const s=Z(n);let i=be(),o=Xn();for(const u of t){const h=e.$s(u.metadata.name);u.document&&(i=i.add(h));const f=e.Us(u);f.setReadTime(e.Ks(u.metadata.readTime)),o=o.insert(h,f)}const a=s.Ns.newChangeBuffer({trackRemovals:!0}),l=await Kl(s,function(h){return Mn(cc(Ve.fromString(`__bundle__/docs/${h}`)))}(r));return s.persistence.runTransaction("Apply bundle documents","readwrite",u=>gP(u,a,o).next(h=>(a.apply(u),h)).next(h=>s.Pi.removeMatchingKeysForTargetId(u,l.targetId).next(()=>s.Pi.addMatchingKeys(u,i,l.targetId)).next(()=>s.localDocuments.getLocalViewOfDocuments(u,h.ks,h.qs)).next(()=>h.ks)))}async function M6(n,e,t=be()){const r=await Kl(n,Mn(jm(e.bundledQuery))),s=Z(n);return s.persistence.runTransaction("Save named query","readwrite",i=>{const o=Ht(e.readTime);if(r.snapshotVersion.compareTo(o)>=0)return s.Ii.saveNamedQuery(i,e);const a=r.withResumeToken($t.EMPTY_BYTE_STRING,o);return s.Ms=s.Ms.insert(a.targetId,a),s.Pi.updateTargetData(i,a).next(()=>s.Pi.removeMatchingKeysForTargetId(i,r.targetId)).next(()=>s.Pi.addMatchingKeys(i,t,r.targetId)).next(()=>s.Ii.saveNamedQuery(i,e))})}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const wP="firestore_clients";function _S(n,e){return`${wP}_${n}_${e}`}const IP="firestore_mutations";function vS(n,e,t){let r=`${IP}_${n}_${t}`;return e.isAuthenticated()&&(r+=`_${e.uid}`),r}const EP="firestore_targets";function my(n,e){return`${EP}_${n}_${e}`}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const cs="SharedClientState";class kp{constructor(e,t,r,s){this.user=e,this.batchId=t,this.state=r,this.error=s}static Ws(e,t,r){const s=JSON.parse(r);let i,o=typeof s=="object"&&["pending","acknowledged","rejected"].indexOf(s.state)!==-1&&(s.error===void 0||typeof s.error=="object");return o&&s.error&&(o=typeof s.error.message=="string"&&typeof s.error.code=="string",o&&(i=new z(s.error.code,s.error.message))),o?new kp(e,t,s.state,i):(Gt(cs,`Failed to parse mutation state for ID '${t}': ${r}`),null)}Gs(){const e={state:this.state,updateTimeMs:Date.now()};return this.error&&(e.error={code:this.error.code,message:this.error.message}),JSON.stringify(e)}}class Cu{constructor(e,t,r){this.targetId=e,this.state=t,this.error=r}static Ws(e,t){const r=JSON.parse(t);let s,i=typeof r=="object"&&["not-current","current","rejected"].indexOf(r.state)!==-1&&(r.error===void 0||typeof r.error=="object");return i&&r.error&&(i=typeof r.error.message=="string"&&typeof r.error.code=="string",i&&(s=new z(r.error.code,r.error.message))),i?new Cu(e,r.state,s):(Gt(cs,`Failed to parse target state for ID '${e}': ${t}`),null)}Gs(){const e={state:this.state,updateTimeMs:Date.now()};return this.error&&(e.error={code:this.error.code,message:this.error.message}),JSON.stringify(e)}}class Dp{constructor(e,t){this.clientId=e,this.activeTargetIds=t}static Ws(e,t){const r=JSON.parse(t);let s=typeof r=="object"&&r.activeTargetIds instanceof Array,i=_w();for(let o=0;s&&o<r.activeTargetIds.length;++o)s=$R(r.activeTargetIds[o]),i=i.add(r.activeTargetIds[o]);return s?new Dp(e,i):(Gt(cs,`Failed to parse client data for instance '${e}': ${t}`),null)}}class Ow{constructor(e,t){this.clientId=e,this.onlineState=t}static Ws(e){const t=JSON.parse(e);return typeof t=="object"&&["Unknown","Online","Offline"].indexOf(t.onlineState)!==-1&&typeof t.clientId=="string"?new Ow(t.clientId,t.onlineState):(Gt(cs,`Failed to parse online state: ${e}`),null)}}class pv{constructor(){this.activeTargetIds=_w()}zs(e){this.activeTargetIds=this.activeTargetIds.add(e)}js(e){this.activeTargetIds=this.activeTargetIds.delete(e)}Gs(){const e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}}class gy{constructor(e,t,r,s,i){this.window=e,this.Mi=t,this.persistenceKey=r,this.Js=s,this.syncEngine=null,this.onlineStateHandler=null,this.sequenceNumberHandler=null,this.Hs=this.Ys.bind(this),this.Zs=new wt(ve),this.started=!1,this.Xs=[];const o=r.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");this.storage=this.window.localStorage,this.currentUser=i,this.eo=_S(this.persistenceKey,this.Js),this.no=function(l){return`firestore_sequence_number_${l}`}(this.persistenceKey),this.Zs=this.Zs.insert(this.Js,new pv),this.ro=new RegExp(`^${wP}_${o}_([^_]*)$`),this.io=new RegExp(`^${IP}_${o}_(\\d+)(?:_(.*))?$`),this.so=new RegExp(`^${EP}_${o}_(\\d+)$`),this.oo=function(l){return`firestore_online_state_${l}`}(this.persistenceKey),this._o=function(l){return`firestore_bundle_loaded_v2_${l}`}(this.persistenceKey),this.window.addEventListener("storage",this.Hs)}static v(e){return!(!e||!e.localStorage)}async start(){const e=await this.syncEngine.Ts();for(const r of e){if(r===this.Js)continue;const s=this.getItem(_S(this.persistenceKey,r));if(s){const i=Dp.Ws(r,s);i&&(this.Zs=this.Zs.insert(i.clientId,i))}}this.ao();const t=this.storage.getItem(this.oo);if(t){const r=this.uo(t);r&&this.co(r)}for(const r of this.Xs)this.Ys(r);this.Xs=[],this.window.addEventListener("pagehide",()=>this.shutdown()),this.started=!0}writeSequenceNumber(e){this.setItem(this.no,JSON.stringify(e))}getAllActiveQueryTargets(){return this.lo(this.Zs)}isActiveQueryTarget(e){let t=!1;return this.Zs.forEach((r,s)=>{s.activeTargetIds.has(e)&&(t=!0)}),t}addPendingMutation(e){this.ho(e,"pending")}updateMutationState(e,t,r){this.ho(e,t,r),this.Po(e)}addLocalQueryTarget(e,t=!0){let r="not-current";if(this.isActiveQueryTarget(e)){const s=this.storage.getItem(my(this.persistenceKey,e));if(s){const i=Cu.Ws(e,s);i&&(r=i.state)}}return t&&this.To.zs(e),this.ao(),r}removeLocalQueryTarget(e){this.To.js(e),this.ao()}isLocalQueryTarget(e){return this.To.activeTargetIds.has(e)}clearQueryState(e){this.removeItem(my(this.persistenceKey,e))}updateQueryState(e,t,r){this.Io(e,t,r)}handleUserChange(e,t,r){t.forEach(s=>{this.Po(s)}),this.currentUser=e,r.forEach(s=>{this.addPendingMutation(s)})}setOnlineState(e){this.Eo(e)}notifyBundleLoaded(e){this.Ao(e)}shutdown(){this.started&&(this.window.removeEventListener("storage",this.Hs),this.removeItem(this.eo),this.started=!1)}getItem(e){const t=this.storage.getItem(e);return q(cs,"READ",e,t),t}setItem(e,t){q(cs,"SET",e,t),this.storage.setItem(e,t)}removeItem(e){q(cs,"REMOVE",e),this.storage.removeItem(e)}Ys(e){const t=e;if(t.storageArea===this.storage){if(q(cs,"EVENT",t.key,t.newValue),t.key===this.eo)return void Gt("Received WebStorage notification for local change. Another client might have garbage-collected our state");this.Mi.enqueueRetryable(async()=>{if(this.started){if(t.key!==null){if(this.ro.test(t.key)){if(t.newValue==null){const r=this.Ro(t.key);return this.Vo(r,null)}{const r=this.mo(t.key,t.newValue);if(r)return this.Vo(r.clientId,r)}}else if(this.io.test(t.key)){if(t.newValue!==null){const r=this.fo(t.key,t.newValue);if(r)return this.po(r)}}else if(this.so.test(t.key)){if(t.newValue!==null){const r=this.yo(t.key,t.newValue);if(r)return this.wo(r)}}else if(t.key===this.oo){if(t.newValue!==null){const r=this.uo(t.newValue);if(r)return this.co(r)}}else if(t.key===this.no){const r=function(i){let o=Yn.ce;if(i!=null)try{const a=JSON.parse(i);ae(typeof a=="number",30636,{So:i}),o=a}catch(a){Gt(cs,"Failed to read sequence number from WebStorage",a)}return o}(t.newValue);r!==Yn.ce&&this.sequenceNumberHandler(r)}else if(t.key===this._o){const r=this.bo(t.newValue);await Promise.all(r.map(s=>this.syncEngine.Do(s)))}}}else this.Xs.push(t)})}}get To(){return this.Zs.get(this.Js)}ao(){this.setItem(this.eo,this.To.Gs())}ho(e,t,r){const s=new kp(this.currentUser,e,t,r),i=vS(this.persistenceKey,this.currentUser,e);this.setItem(i,s.Gs())}Po(e){const t=vS(this.persistenceKey,this.currentUser,e);this.removeItem(t)}Eo(e){const t={clientId:this.Js,onlineState:e};this.storage.setItem(this.oo,JSON.stringify(t))}Io(e,t,r){const s=my(this.persistenceKey,e),i=new Cu(e,t,r);this.setItem(s,i.Gs())}Ao(e){const t=JSON.stringify(Array.from(e));this.setItem(this._o,t)}Ro(e){const t=this.ro.exec(e);return t?t[1]:null}mo(e,t){const r=this.Ro(e);return Dp.Ws(r,t)}fo(e,t){const r=this.io.exec(e),s=Number(r[1]),i=r[2]!==void 0?r[2]:null;return kp.Ws(new un(i),s,t)}yo(e,t){const r=this.so.exec(e),s=Number(r[1]);return Cu.Ws(s,t)}uo(e){return Ow.Ws(e)}bo(e){return JSON.parse(e)}async po(e){if(e.user.uid===this.currentUser.uid)return this.syncEngine.Co(e.batchId,e.state,e.error);q(cs,`Ignoring mutation for non-active user ${e.user.uid}`)}wo(e){return this.syncEngine.vo(e.targetId,e.state,e.error)}Vo(e,t){const r=t?this.Zs.insert(e,t):this.Zs.remove(e),s=this.lo(this.Zs),i=this.lo(r),o=[],a=[];return i.forEach(l=>{s.has(l)||o.push(l)}),s.forEach(l=>{i.has(l)||a.push(l)}),this.syncEngine.Fo(o,a).then(()=>{this.Zs=r})}co(e){this.Zs.get(e.clientId)&&this.onlineStateHandler(e.onlineState)}lo(e){let t=_w();return e.forEach((r,s)=>{t=t.unionWith(s.activeTargetIds)}),t}}class xP{constructor(){this.Mo=new pv,this.xo={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,t,r){}addLocalQueryTarget(e,t=!0){return t&&this.Mo.zs(e),this.xo[e]||"not-current"}updateQueryState(e,t,r){this.xo[e]=t}removeLocalQueryTarget(e){this.Mo.js(e)}isLocalQueryTarget(e){return this.Mo.activeTargetIds.has(e)}clearQueryState(e){delete this.xo[e]}getAllActiveQueryTargets(){return this.Mo.activeTargetIds}isActiveQueryTarget(e){return this.Mo.activeTargetIds.has(e)}start(){return this.Mo=new pv,Promise.resolve()}handleUserChange(e,t,r){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class L6{Oo(e){}shutdown(){}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const wS="ConnectivityMonitor";class IS{constructor(){this.No=()=>this.Bo(),this.Lo=()=>this.ko(),this.qo=[],this.Qo()}Oo(e){this.qo.push(e)}shutdown(){window.removeEventListener("online",this.No),window.removeEventListener("offline",this.Lo)}Qo(){window.addEventListener("online",this.No),window.addEventListener("offline",this.Lo)}Bo(){q(wS,"Network connectivity changed: AVAILABLE");for(const e of this.qo)e(0)}ko(){q(wS,"Network connectivity changed: UNAVAILABLE");for(const e of this.qo)e(1)}static v(){return typeof window<"u"&&window.addEventListener!==void 0&&window.removeEventListener!==void 0}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Qh=null;function mv(){return Qh===null?Qh=function(){return 268435456+Math.round(2147483648*Math.random())}():Qh++,"0x"+Qh.toString(16)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const yy="RestConnection",V6={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};class F6{get $o(){return!1}constructor(e){this.databaseInfo=e,this.databaseId=e.databaseId;const t=e.ssl?"https":"http",r=encodeURIComponent(this.databaseId.projectId),s=encodeURIComponent(this.databaseId.database);this.Uo=t+"://"+e.host,this.Ko=`projects/${r}/databases/${s}`,this.Wo=this.databaseId.database===dd?`project_id=${r}`:`project_id=${r}&database_id=${s}`}Go(e,t,r,s,i){const o=mv(),a=this.zo(e,t.toUriEncodedString());q(yy,`Sending RPC '${e}' ${o}:`,a,r);const l={"google-cloud-resource-prefix":this.Ko,"x-goog-request-params":this.Wo};this.jo(l,s,i);const{host:u}=new URL(a),h=ti(u);return this.Jo(e,a,l,r,h).then(f=>(q(yy,`Received RPC '${e}' ${o}: `,f),f),f=>{throw Vr(yy,`RPC '${e}' ${o} failed with error: `,f,"url: ",a,"request:",r),f})}Ho(e,t,r,s,i,o){return this.Go(e,t,r,s,i)}jo(e,t,r){e["X-Goog-Api-Client"]=function(){return"gl-js/ fire/"+lc}(),e["Content-Type"]="text/plain",this.databaseInfo.appId&&(e["X-Firebase-GMPID"]=this.databaseInfo.appId),t&&t.headers.forEach((s,i)=>e[i]=s),r&&r.headers.forEach((s,i)=>e[i]=s)}zo(e,t){const r=V6[e];return`${this.Uo}/v1/${t}:${r}`}terminate(){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class j6{constructor(e){this.Yo=e.Yo,this.Zo=e.Zo}Xo(e){this.e_=e}t_(e){this.n_=e}r_(e){this.i_=e}onMessage(e){this.s_=e}close(){this.Zo()}send(e){this.Yo(e)}o_(){this.e_()}__(){this.n_()}a_(e){this.i_(e)}u_(e){this.s_(e)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Nn="WebChannelConnection";class U6 extends F6{constructor(e){super(e),this.c_=[],this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams,this.longPollingOptions=e.longPollingOptions}Jo(e,t,r,s,i){const o=mv();return new Promise((a,l)=>{const u=new AR;u.setWithCredentials(!0),u.listenOnce(CR.COMPLETE,()=>{try{switch(u.getLastErrorCode()){case yf.NO_ERROR:const f=u.getResponseJson();q(Nn,`XHR for RPC '${e}' ${o} received:`,JSON.stringify(f)),a(f);break;case yf.TIMEOUT:q(Nn,`RPC '${e}' ${o} timed out`),l(new z(V.DEADLINE_EXCEEDED,"Request time out"));break;case yf.HTTP_ERROR:const p=u.getStatus();if(q(Nn,`RPC '${e}' ${o} failed with status:`,p,"response text:",u.getResponseText()),p>0){let y=u.getResponseJson();Array.isArray(y)&&(y=y[0]);const I=y==null?void 0:y.error;if(I&&I.status&&I.message){const C=function(A){const T=A.toLowerCase().replace(/_/g,"-");return Object.values(V).indexOf(T)>=0?T:V.UNKNOWN}(I.status);l(new z(C,I.message))}else l(new z(V.UNKNOWN,"Server responded with status "+u.getStatus()))}else l(new z(V.UNAVAILABLE,"Connection failed."));break;default:se(9055,{l_:e,streamId:o,h_:u.getLastErrorCode(),P_:u.getLastError()})}}finally{q(Nn,`RPC '${e}' ${o} completed.`)}});const h=JSON.stringify(s);q(Nn,`RPC '${e}' ${o} sending request:`,s),u.send(t,"POST",h,r,15)})}T_(e,t,r){const s=mv(),i=[this.Uo,"/","google.firestore.v1.Firestore","/",e,"/channel"],o=PR(),a=NR(),l={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},u=this.longPollingOptions.timeoutSeconds;u!==void 0&&(l.longPollingTimeout=Math.round(1e3*u)),this.useFetchStreams&&(l.useFetchStreams=!0),this.jo(l.initMessageHeaders,t,r),l.encodeInitMessageHeaders=!0;const h=i.join("");q(Nn,`Creating RPC '${e}' stream ${s}: ${h}`,l);const f=o.createWebChannel(h,l);this.I_(f);let p=!1,y=!1;const I=new j6({Yo:P=>{y?q(Nn,`Not sending because RPC '${e}' stream ${s} is closed:`,P):(p||(q(Nn,`Opening RPC '${e}' stream ${s} transport.`),f.open(),p=!0),q(Nn,`RPC '${e}' stream ${s} sending:`,P),f.send(P))},Zo:()=>f.close()}),C=(P,A,T)=>{P.listen(A,R=>{try{T(R)}catch(D){setTimeout(()=>{throw D},0)}})};return C(f,eu.EventType.OPEN,()=>{y||(q(Nn,`RPC '${e}' stream ${s} transport opened.`),I.o_())}),C(f,eu.EventType.CLOSE,()=>{y||(y=!0,q(Nn,`RPC '${e}' stream ${s} transport closed`),I.a_(),this.E_(f))}),C(f,eu.EventType.ERROR,P=>{y||(y=!0,Vr(Nn,`RPC '${e}' stream ${s} transport errored. Name:`,P.name,"Message:",P.message),I.a_(new z(V.UNAVAILABLE,"The operation could not be completed")))}),C(f,eu.EventType.MESSAGE,P=>{var A;if(!y){const T=P.data[0];ae(!!T,16349);const R=T,D=(R==null?void 0:R.error)||((A=R[0])==null?void 0:A.error);if(D){q(Nn,`RPC '${e}' stream ${s} received error:`,D);const F=D.status;let k=function(b){const v=Kt[b];if(v!==void 0)return LN(v)}(F),E=D.message;k===void 0&&(k=V.INTERNAL,E="Unknown error status: "+F+" with message "+D.message),y=!0,I.a_(new z(k,E)),f.close()}else q(Nn,`RPC '${e}' stream ${s} received:`,T),I.u_(T)}}),C(a,RR.STAT_EVENT,P=>{P.stat===G_.PROXY?q(Nn,`RPC '${e}' stream ${s} detected buffering proxy`):P.stat===G_.NOPROXY&&q(Nn,`RPC '${e}' stream ${s} detected no buffering proxy`)}),setTimeout(()=>{I.__()},0),I}terminate(){this.c_.forEach(e=>e.close()),this.c_=[]}I_(e){this.c_.push(e)}E_(e){this.c_=this.c_.filter(t=>t===e)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function TP(){return typeof window<"u"?window:null}function bf(){return typeof document<"u"?document:null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ta(n){return new G3(n,!0)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Mw{constructor(e,t,r=1e3,s=1.5,i=6e4){this.Mi=e,this.timerId=t,this.d_=r,this.A_=s,this.R_=i,this.V_=0,this.m_=null,this.f_=Date.now(),this.reset()}reset(){this.V_=0}g_(){this.V_=this.R_}p_(e){this.cancel();const t=Math.floor(this.V_+this.y_()),r=Math.max(0,Date.now()-this.f_),s=Math.max(0,t-r);s>0&&q("ExponentialBackoff",`Backing off for ${s} ms (base delay: ${this.V_} ms, delay with jitter: ${t} ms, last attempt: ${r} ms ago)`),this.m_=this.Mi.enqueueAfterDelay(this.timerId,s,()=>(this.f_=Date.now(),e())),this.V_*=this.A_,this.V_<this.d_&&(this.V_=this.d_),this.V_>this.R_&&(this.V_=this.R_)}w_(){this.m_!==null&&(this.m_.skipDelay(),this.m_=null)}cancel(){this.m_!==null&&(this.m_.cancel(),this.m_=null)}y_(){return(Math.random()-.5)*this.V_}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ES="PersistentStream";class SP{constructor(e,t,r,s,i,o,a,l){this.Mi=e,this.S_=r,this.b_=s,this.connection=i,this.authCredentialsProvider=o,this.appCheckCredentialsProvider=a,this.listener=l,this.state=0,this.D_=0,this.C_=null,this.v_=null,this.stream=null,this.F_=0,this.M_=new Mw(e,t)}x_(){return this.state===1||this.state===5||this.O_()}O_(){return this.state===2||this.state===3}start(){this.F_=0,this.state!==4?this.auth():this.N_()}async stop(){this.x_()&&await this.close(0)}B_(){this.state=0,this.M_.reset()}L_(){this.O_()&&this.C_===null&&(this.C_=this.Mi.enqueueAfterDelay(this.S_,6e4,()=>this.k_()))}q_(e){this.Q_(),this.stream.send(e)}async k_(){if(this.O_())return this.close(0)}Q_(){this.C_&&(this.C_.cancel(),this.C_=null)}U_(){this.v_&&(this.v_.cancel(),this.v_=null)}async close(e,t){this.Q_(),this.U_(),this.M_.cancel(),this.D_++,e!==4?this.M_.reset():t&&t.code===V.RESOURCE_EXHAUSTED?(Gt(t.toString()),Gt("Using maximum backoff delay to prevent overloading the backend."),this.M_.g_()):t&&t.code===V.UNAUTHENTICATED&&this.state!==3&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),this.stream!==null&&(this.K_(),this.stream.close(),this.stream=null),this.state=e,await this.listener.r_(t)}K_(){}auth(){this.state=1;const e=this.W_(this.D_),t=this.D_;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then(([r,s])=>{this.D_===t&&this.G_(r,s)},r=>{e(()=>{const s=new z(V.UNKNOWN,"Fetching auth token failed: "+r.message);return this.z_(s)})})}G_(e,t){const r=this.W_(this.D_);this.stream=this.j_(e,t),this.stream.Xo(()=>{r(()=>this.listener.Xo())}),this.stream.t_(()=>{r(()=>(this.state=2,this.v_=this.Mi.enqueueAfterDelay(this.b_,1e4,()=>(this.O_()&&(this.state=3),Promise.resolve())),this.listener.t_()))}),this.stream.r_(s=>{r(()=>this.z_(s))}),this.stream.onMessage(s=>{r(()=>++this.F_==1?this.J_(s):this.onNext(s))})}N_(){this.state=5,this.M_.p_(async()=>{this.state=0,this.start()})}z_(e){return q(ES,`close with error: ${e}`),this.stream=null,this.close(4,e)}W_(e){return t=>{this.Mi.enqueueAndForget(()=>this.D_===e?t():(q(ES,"stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve()))}}}class B6 extends SP{constructor(e,t,r,s,i,o){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",t,r,s,o),this.serializer=i}j_(e,t){return this.connection.T_("Listen",e,t)}J_(e){return this.onNext(e)}onNext(e){this.M_.reset();const t=Q3(this.serializer,e),r=function(i){if(!("targetChange"in i))return ue.min();const o=i.targetChange;return o.targetIds&&o.targetIds.length?ue.min():o.readTime?Ht(o.readTime):ue.min()}(e);return this.listener.H_(t,r)}Y_(e){const t={};t.database=cv(this.serializer),t.addTarget=function(i,o){let a;const l=o.target;if(a=Tp(l)?{documents:WN(i,l)}:{query:Fm(i,l).ft},a.targetId=o.targetId,o.resumeToken.approximateByteSize()>0){a.resumeToken=UN(i,o.resumeToken);const u=av(i,o.expectedCount);u!==null&&(a.expectedCount=u)}else if(o.snapshotVersion.compareTo(ue.min())>0){a.readTime=Hl(i,o.snapshotVersion.toTimestamp());const u=av(i,o.expectedCount);u!==null&&(a.expectedCount=u)}return a}(this.serializer,e);const r=J3(this.serializer,e);r&&(t.labels=r),this.q_(t)}Z_(e){const t={};t.database=cv(this.serializer),t.removeTarget=e,this.q_(t)}}class $6 extends SP{constructor(e,t,r,s,i,o){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",t,r,s,o),this.serializer=i}get X_(){return this.F_>0}start(){this.lastStreamToken=void 0,super.start()}K_(){this.X_&&this.ea([])}j_(e,t){return this.connection.T_("Write",e,t)}J_(e){return ae(!!e.streamToken,31322),this.lastStreamToken=e.streamToken,ae(!e.writeResults||e.writeResults.length===0,55816),this.listener.ta()}onNext(e){ae(!!e.streamToken,12678),this.lastStreamToken=e.streamToken,this.M_.reset();const t=Y3(e.writeResults,e.commitTime),r=Ht(e.commitTime);return this.listener.na(r,t)}ra(){const e={};e.database=cv(this.serializer),this.q_(e)}ea(e){const t={streamToken:this.lastStreamToken,writes:e.map(r=>gd(this.serializer,r))};this.q_(t)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class z6{}class q6 extends z6{constructor(e,t,r,s){super(),this.authCredentials=e,this.appCheckCredentials=t,this.connection=r,this.serializer=s,this.ia=!1}sa(){if(this.ia)throw new z(V.FAILED_PRECONDITION,"The client has already been terminated.")}Go(e,t,r,s){return this.sa(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([i,o])=>this.connection.Go(e,lv(t,r),s,i,o)).catch(i=>{throw i.name==="FirebaseError"?(i.code===V.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),i):new z(V.UNKNOWN,i.toString())})}Ho(e,t,r,s,i){return this.sa(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([o,a])=>this.connection.Ho(e,lv(t,r),s,o,a,i)).catch(o=>{throw o.name==="FirebaseError"?(o.code===V.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),o):new z(V.UNKNOWN,o.toString())})}terminate(){this.ia=!0,this.connection.terminate()}}class W6{constructor(e,t){this.asyncQueue=e,this.onlineStateHandler=t,this.state="Unknown",this.oa=0,this._a=null,this.aa=!0}ua(){this.oa===0&&(this.ca("Unknown"),this._a=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,()=>(this._a=null,this.la("Backend didn't respond within 10 seconds."),this.ca("Offline"),Promise.resolve())))}ha(e){this.state==="Online"?this.ca("Unknown"):(this.oa++,this.oa>=1&&(this.Pa(),this.la(`Connection failed 1 times. Most recent error: ${e.toString()}`),this.ca("Offline")))}set(e){this.Pa(),this.oa=0,e==="Online"&&(this.aa=!1),this.ca(e)}ca(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}la(e){const t=`Could not reach Cloud Firestore backend. ${e}
This typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.aa?(Gt(t),this.aa=!1):q("OnlineStateTracker",t)}Pa(){this._a!==null&&(this._a.cancel(),this._a=null)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const da="RemoteStore";class G6{constructor(e,t,r,s,i){this.localStore=e,this.datastore=t,this.asyncQueue=r,this.remoteSyncer={},this.Ta=[],this.Ia=new Map,this.Ea=new Set,this.da=[],this.Aa=i,this.Aa.Oo(o=>{r.enqueueAndForget(async()=>{mo(this)&&(q(da,"Restarting streams for network reachability change."),await async function(l){const u=Z(l);u.Ea.add(4),await hc(u),u.Ra.set("Unknown"),u.Ea.delete(4),await Jd(u)}(this))})}),this.Ra=new W6(r,s)}}async function Jd(n){if(mo(n))for(const e of n.da)await e(!0)}async function hc(n){for(const e of n.da)await e(!1)}function zm(n,e){const t=Z(n);t.Ia.has(e.targetId)||(t.Ia.set(e.targetId,e),Fw(t)?Vw(t):pc(t).O_()&&Lw(t,e))}function Yl(n,e){const t=Z(n),r=pc(t);t.Ia.delete(e),r.O_()&&bP(t,e),t.Ia.size===0&&(r.O_()?r.L_():mo(t)&&t.Ra.set("Unknown"))}function Lw(n,e){if(n.Va.Ue(e.targetId),e.resumeToken.approximateByteSize()>0||e.snapshotVersion.compareTo(ue.min())>0){const t=n.remoteSyncer.getRemoteKeysForTarget(e.targetId).size;e=e.withExpectedCount(t)}pc(n).Y_(e)}function bP(n,e){n.Va.Ue(e),pc(n).Z_(e)}function Vw(n){n.Va=new $3({getRemoteKeysForTarget:e=>n.remoteSyncer.getRemoteKeysForTarget(e),At:e=>n.Ia.get(e)||null,ht:()=>n.datastore.serializer.databaseId}),pc(n).start(),n.Ra.ua()}function Fw(n){return mo(n)&&!pc(n).x_()&&n.Ia.size>0}function mo(n){return Z(n).Ea.size===0}function AP(n){n.Va=void 0}async function H6(n){n.Ra.set("Online")}async function K6(n){n.Ia.forEach((e,t)=>{Lw(n,e)})}async function Q6(n,e){AP(n),Fw(n)?(n.Ra.ha(e),Vw(n)):n.Ra.set("Unknown")}async function Y6(n,e,t){if(n.Ra.set("Online"),e instanceof jN&&e.state===2&&e.cause)try{await async function(s,i){const o=i.cause;for(const a of i.targetIds)s.Ia.has(a)&&(await s.remoteSyncer.rejectListen(a,o),s.Ia.delete(a),s.Va.removeTarget(a))}(n,e)}catch(r){q(da,"Failed to remove targets %s: %s ",e.targetIds.join(","),r),await Op(n,r)}else if(e instanceof Tf?n.Va.Ze(e):e instanceof FN?n.Va.st(e):n.Va.tt(e),!t.isEqual(ue.min()))try{const r=await mP(n.localStore);t.compareTo(r)>=0&&await function(i,o){const a=i.Va.Tt(o);return a.targetChanges.forEach((l,u)=>{if(l.resumeToken.approximateByteSize()>0){const h=i.Ia.get(u);h&&i.Ia.set(u,h.withResumeToken(l.resumeToken,o))}}),a.targetMismatches.forEach((l,u)=>{const h=i.Ia.get(l);if(!h)return;i.Ia.set(l,h.withResumeToken($t.EMPTY_BYTE_STRING,h.snapshotVersion)),bP(i,l);const f=new Fs(h.target,l,u,h.sequenceNumber);Lw(i,f)}),i.remoteSyncer.applyRemoteEvent(a)}(n,t)}catch(r){q(da,"Failed to raise snapshot:",r),await Op(n,r)}}async function Op(n,e,t){if(!fo(e))throw e;n.Ea.add(1),await hc(n),n.Ra.set("Offline"),t||(t=()=>mP(n.localStore)),n.asyncQueue.enqueueRetryable(async()=>{q(da,"Retrying IndexedDB access"),await t(),n.Ea.delete(1),await Jd(n)})}function CP(n,e){return e().catch(t=>Op(n,t,e))}async function fc(n){const e=Z(n),t=so(e);let r=e.Ta.length>0?e.Ta[e.Ta.length-1].batchId:Wi;for(;J6(e);)try{const s=await D6(e.localStore,r);if(s===null){e.Ta.length===0&&t.L_();break}r=s.batchId,X6(e,s)}catch(s){await Op(e,s)}RP(e)&&NP(e)}function J6(n){return mo(n)&&n.Ta.length<10}function X6(n,e){n.Ta.push(e);const t=so(n);t.O_()&&t.X_&&t.ea(e.mutations)}function RP(n){return mo(n)&&!so(n).x_()&&n.Ta.length>0}function NP(n){so(n).start()}async function Z6(n){so(n).ra()}async function e5(n){const e=so(n);for(const t of n.Ta)e.ea(t.mutations)}async function t5(n,e,t){const r=n.Ta.shift(),s=Ew.from(r,e,t);await CP(n,()=>n.remoteSyncer.applySuccessfulWrite(s)),await fc(n)}async function n5(n,e){e&&so(n).X_&&await async function(r,s){if(function(o){return MN(o)&&o!==V.ABORTED}(s.code)){const i=r.Ta.shift();so(r).B_(),await CP(r,()=>r.remoteSyncer.rejectFailedWrite(i.batchId,s)),await fc(r)}}(n,e),RP(n)&&NP(n)}async function xS(n,e){const t=Z(n);t.asyncQueue.verifyOperationInProgress(),q(da,"RemoteStore received new credentials");const r=mo(t);t.Ea.add(3),await hc(t),r&&t.Ra.set("Unknown"),await t.remoteSyncer.handleCredentialChange(e),t.Ea.delete(3),await Jd(t)}async function gv(n,e){const t=Z(n);e?(t.Ea.delete(2),await Jd(t)):e||(t.Ea.add(2),await hc(t),t.Ra.set("Unknown"))}function pc(n){return n.ma||(n.ma=function(t,r,s){const i=Z(t);return i.sa(),new B6(r,i.connection,i.authCredentials,i.appCheckCredentials,i.serializer,s)}(n.datastore,n.asyncQueue,{Xo:H6.bind(null,n),t_:K6.bind(null,n),r_:Q6.bind(null,n),H_:Y6.bind(null,n)}),n.da.push(async e=>{e?(n.ma.B_(),Fw(n)?Vw(n):n.Ra.set("Unknown")):(await n.ma.stop(),AP(n))})),n.ma}function so(n){return n.fa||(n.fa=function(t,r,s){const i=Z(t);return i.sa(),new $6(r,i.connection,i.authCredentials,i.appCheckCredentials,i.serializer,s)}(n.datastore,n.asyncQueue,{Xo:()=>Promise.resolve(),t_:Z6.bind(null,n),r_:n5.bind(null,n),ta:e5.bind(null,n),na:t5.bind(null,n)}),n.da.push(async e=>{e?(n.fa.B_(),await fc(n)):(await n.fa.stop(),n.Ta.length>0&&(q(da,`Stopping write stream with ${n.Ta.length} pending writes`),n.Ta=[]))})),n.fa}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class jw{constructor(e,t,r,s,i){this.asyncQueue=e,this.timerId=t,this.targetTimeMs=r,this.op=s,this.removalCallback=i,this.deferred=new fn,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(o=>{})}get promise(){return this.deferred.promise}static createAndSchedule(e,t,r,s,i){const o=Date.now()+r,a=new jw(e,t,o,s,i);return a.start(r),a}start(e){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){this.timerHandle!==null&&(this.clearTimeout(),this.deferred.reject(new z(V.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>this.timerHandle!==null?(this.clearTimeout(),this.op().then(e=>this.deferred.resolve(e))):Promise.resolve())}clearTimeout(){this.timerHandle!==null&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function mc(n,e){if(Gt("AsyncQueue",`${e}: ${n}`),fo(n))return new z(V.UNAVAILABLE,`${e}: ${n}`);throw n}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Wo{static emptySet(e){return new Wo(e.comparator)}constructor(e){this.comparator=e?(t,r)=>e(t,r)||X.comparator(t.key,r.key):(t,r)=>X.comparator(t.key,r.key),this.keyedMap=tu(),this.sortedSet=new wt(this.comparator)}has(e){return this.keyedMap.get(e)!=null}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){const t=this.keyedMap.get(e);return t?this.sortedSet.indexOf(t):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal((t,r)=>(e(t),!1))}add(e){const t=this.delete(e.key);return t.copy(t.keyedMap.insert(e.key,e),t.sortedSet.insert(e,null))}delete(e){const t=this.get(e);return t?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(t)):this}isEqual(e){if(!(e instanceof Wo)||this.size!==e.size)return!1;const t=this.sortedSet.getIterator(),r=e.sortedSet.getIterator();for(;t.hasNext();){const s=t.getNext().key,i=r.getNext().key;if(!s.isEqual(i))return!1}return!0}toString(){const e=[];return this.forEach(t=>{e.push(t.toString())}),e.length===0?"DocumentSet ()":`DocumentSet (
  `+e.join(`  
`)+`
)`}copy(e,t){const r=new Wo;return r.comparator=this.comparator,r.keyedMap=e,r.sortedSet=t,r}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class TS{constructor(){this.ga=new wt(X.comparator)}track(e){const t=e.doc.key,r=this.ga.get(t);r?e.type!==0&&r.type===3?this.ga=this.ga.insert(t,e):e.type===3&&r.type!==1?this.ga=this.ga.insert(t,{type:r.type,doc:e.doc}):e.type===2&&r.type===2?this.ga=this.ga.insert(t,{type:2,doc:e.doc}):e.type===2&&r.type===0?this.ga=this.ga.insert(t,{type:0,doc:e.doc}):e.type===1&&r.type===0?this.ga=this.ga.remove(t):e.type===1&&r.type===2?this.ga=this.ga.insert(t,{type:1,doc:r.doc}):e.type===0&&r.type===1?this.ga=this.ga.insert(t,{type:2,doc:e.doc}):se(63341,{Rt:e,pa:r}):this.ga=this.ga.insert(t,e)}ya(){const e=[];return this.ga.inorderTraversal((t,r)=>{e.push(r)}),e}}class ha{constructor(e,t,r,s,i,o,a,l,u){this.query=e,this.docs=t,this.oldDocs=r,this.docChanges=s,this.mutatedKeys=i,this.fromCache=o,this.syncStateChanged=a,this.excludesMetadataChanges=l,this.hasCachedResults=u}static fromInitialDocuments(e,t,r,s,i){const o=[];return t.forEach(a=>{o.push({type:0,doc:a})}),new ha(e,t,Wo.emptySet(t),o,r,s,!0,!1,i)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(!(this.fromCache===e.fromCache&&this.hasCachedResults===e.hasCachedResults&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&Gd(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;const t=this.docChanges,r=e.docChanges;if(t.length!==r.length)return!1;for(let s=0;s<t.length;s++)if(t[s].type!==r[s].type||!t[s].doc.isEqual(r[s].doc))return!1;return!0}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class r5{constructor(){this.wa=void 0,this.Sa=[]}ba(){return this.Sa.some(e=>e.Da())}}class s5{constructor(){this.queries=SS(),this.onlineState="Unknown",this.Ca=new Set}terminate(){(function(t,r){const s=Z(t),i=s.queries;s.queries=SS(),i.forEach((o,a)=>{for(const l of a.Sa)l.onError(r)})})(this,new z(V.ABORTED,"Firestore shutting down"))}}function SS(){return new ri(n=>wN(n),Gd)}async function Uw(n,e){const t=Z(n);let r=3;const s=e.query;let i=t.queries.get(s);i?!i.ba()&&e.Da()&&(r=2):(i=new r5,r=e.Da()?0:1);try{switch(r){case 0:i.wa=await t.onListen(s,!0);break;case 1:i.wa=await t.onListen(s,!1);break;case 2:await t.onFirstRemoteStoreListen(s)}}catch(o){const a=mc(o,`Initialization of query '${qa(e.query)}' failed`);return void e.onError(a)}t.queries.set(s,i),i.Sa.push(e),e.va(t.onlineState),i.wa&&e.Fa(i.wa)&&$w(t)}async function Bw(n,e){const t=Z(n),r=e.query;let s=3;const i=t.queries.get(r);if(i){const o=i.Sa.indexOf(e);o>=0&&(i.Sa.splice(o,1),i.Sa.length===0?s=e.Da()?0:1:!i.ba()&&e.Da()&&(s=2))}switch(s){case 0:return t.queries.delete(r),t.onUnlisten(r,!0);case 1:return t.queries.delete(r),t.onUnlisten(r,!1);case 2:return t.onLastRemoteStoreUnlisten(r);default:return}}function i5(n,e){const t=Z(n);let r=!1;for(const s of e){const i=s.query,o=t.queries.get(i);if(o){for(const a of o.Sa)a.Fa(s)&&(r=!0);o.wa=s}}r&&$w(t)}function o5(n,e,t){const r=Z(n),s=r.queries.get(e);if(s)for(const i of s.Sa)i.onError(t);r.queries.delete(e)}function $w(n){n.Ca.forEach(e=>{e.next()})}var yv,bS;(bS=yv||(yv={})).Ma="default",bS.Cache="cache";class zw{constructor(e,t,r){this.query=e,this.xa=t,this.Oa=!1,this.Na=null,this.onlineState="Unknown",this.options=r||{}}Fa(e){if(!this.options.includeMetadataChanges){const r=[];for(const s of e.docChanges)s.type!==3&&r.push(s);e=new ha(e.query,e.docs,e.oldDocs,r,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0,e.hasCachedResults)}let t=!1;return this.Oa?this.Ba(e)&&(this.xa.next(e),t=!0):this.La(e,this.onlineState)&&(this.ka(e),t=!0),this.Na=e,t}onError(e){this.xa.error(e)}va(e){this.onlineState=e;let t=!1;return this.Na&&!this.Oa&&this.La(this.Na,e)&&(this.ka(this.Na),t=!0),t}La(e,t){if(!e.fromCache||!this.Da())return!0;const r=t!=="Offline";return(!this.options.qa||!r)&&(!e.docs.isEmpty()||e.hasCachedResults||t==="Offline")}Ba(e){if(e.docChanges.length>0)return!0;const t=this.Na&&this.Na.hasPendingWrites!==e.hasPendingWrites;return!(!e.syncStateChanged&&!t)&&this.options.includeMetadataChanges===!0}ka(e){e=ha.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache,e.hasCachedResults),this.Oa=!0,this.xa.next(e)}Da(){return this.options.source!==yv.Cache}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class PP{constructor(e,t){this.Qa=e,this.byteLength=t}$a(){return"metadata"in this.Qa}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class AS{constructor(e){this.serializer=e}$s(e){return ws(this.serializer,e)}Us(e){return e.metadata.exists?Vm(this.serializer,e.document,!1):xt.newNoDocument(this.$s(e.metadata.name),this.Ks(e.metadata.readTime))}Ks(e){return Ht(e)}}class qw{constructor(e,t){this.Ua=e,this.serializer=t,this.Ka=[],this.Wa=[],this.collectionGroups=new Set,this.progress=kP(e)}get queries(){return this.Ka}get documents(){return this.Wa}Ga(e){this.progress.bytesLoaded+=e.byteLength;let t=this.progress.documentsLoaded;if(e.Qa.namedQuery)this.Ka.push(e.Qa.namedQuery);else if(e.Qa.documentMetadata){this.Wa.push({metadata:e.Qa.documentMetadata}),e.Qa.documentMetadata.exists||++t;const r=Ve.fromString(e.Qa.documentMetadata.name);this.collectionGroups.add(r.get(r.length-2))}else e.Qa.document&&(this.Wa[this.Wa.length-1].document=e.Qa.document,++t);return t!==this.progress.documentsLoaded?(this.progress.documentsLoaded=t,{...this.progress}):null}za(e){const t=new Map,r=new AS(this.serializer);for(const s of e)if(s.metadata.queries){const i=r.$s(s.metadata.name);for(const o of s.metadata.queries){const a=(t.get(o)||be()).add(i);t.set(o,a)}}return t}async ja(e){const t=await O6(e,new AS(this.serializer),this.Wa,this.Ua.id),r=this.za(this.documents);for(const s of this.Ka)await M6(e,s,r.get(s.name));return this.progress.taskState="Success",{progress:this.progress,Ja:this.collectionGroups,Ha:t}}}function kP(n){return{taskState:"Running",documentsLoaded:0,bytesLoaded:0,totalDocuments:n.totalDocuments,totalBytes:n.totalBytes}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class DP{constructor(e){this.key=e}}class OP{constructor(e){this.key=e}}class MP{constructor(e,t){this.query=e,this.Ya=t,this.Za=null,this.hasCachedResults=!1,this.current=!1,this.Xa=be(),this.mutatedKeys=be(),this.eu=EN(e),this.tu=new Wo(this.eu)}get nu(){return this.Ya}ru(e,t){const r=t?t.iu:new TS,s=t?t.tu:this.tu;let i=t?t.mutatedKeys:this.mutatedKeys,o=s,a=!1;const l=this.query.limitType==="F"&&s.size===this.query.limit?s.last():null,u=this.query.limitType==="L"&&s.size===this.query.limit?s.first():null;if(e.inorderTraversal((h,f)=>{const p=s.get(h),y=Hd(this.query,f)?f:null,I=!!p&&this.mutatedKeys.has(p.key),C=!!y&&(y.hasLocalMutations||this.mutatedKeys.has(y.key)&&y.hasCommittedMutations);let P=!1;p&&y?p.data.isEqual(y.data)?I!==C&&(r.track({type:3,doc:y}),P=!0):this.su(p,y)||(r.track({type:2,doc:y}),P=!0,(l&&this.eu(y,l)>0||u&&this.eu(y,u)<0)&&(a=!0)):!p&&y?(r.track({type:0,doc:y}),P=!0):p&&!y&&(r.track({type:1,doc:p}),P=!0,(l||u)&&(a=!0)),P&&(y?(o=o.add(y),i=C?i.add(h):i.delete(h)):(o=o.delete(h),i=i.delete(h)))}),this.query.limit!==null)for(;o.size>this.query.limit;){const h=this.query.limitType==="F"?o.last():o.first();o=o.delete(h.key),i=i.delete(h.key),r.track({type:1,doc:h})}return{tu:o,iu:r,Cs:a,mutatedKeys:i}}su(e,t){return e.hasLocalMutations&&t.hasCommittedMutations&&!t.hasLocalMutations}applyChanges(e,t,r,s){const i=this.tu;this.tu=e.tu,this.mutatedKeys=e.mutatedKeys;const o=e.iu.ya();o.sort((h,f)=>function(y,I){const C=P=>{switch(P){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return se(20277,{Rt:P})}};return C(y)-C(I)}(h.type,f.type)||this.eu(h.doc,f.doc)),this.ou(r),s=s??!1;const a=t&&!s?this._u():[],l=this.Xa.size===0&&this.current&&!s?1:0,u=l!==this.Za;return this.Za=l,o.length!==0||u?{snapshot:new ha(this.query,e.tu,i,o,e.mutatedKeys,l===0,u,!1,!!r&&r.resumeToken.approximateByteSize()>0),au:a}:{au:a}}va(e){return this.current&&e==="Offline"?(this.current=!1,this.applyChanges({tu:this.tu,iu:new TS,mutatedKeys:this.mutatedKeys,Cs:!1},!1)):{au:[]}}uu(e){return!this.Ya.has(e)&&!!this.tu.has(e)&&!this.tu.get(e).hasLocalMutations}ou(e){e&&(e.addedDocuments.forEach(t=>this.Ya=this.Ya.add(t)),e.modifiedDocuments.forEach(t=>{}),e.removedDocuments.forEach(t=>this.Ya=this.Ya.delete(t)),this.current=e.current)}_u(){if(!this.current)return[];const e=this.Xa;this.Xa=be(),this.tu.forEach(r=>{this.uu(r.key)&&(this.Xa=this.Xa.add(r.key))});const t=[];return e.forEach(r=>{this.Xa.has(r)||t.push(new OP(r))}),this.Xa.forEach(r=>{e.has(r)||t.push(new DP(r))}),t}cu(e){this.Ya=e.Qs,this.Xa=be();const t=this.ru(e.documents);return this.applyChanges(t,!0)}lu(){return ha.fromInitialDocuments(this.query,this.tu,this.mutatedKeys,this.Za===0,this.hasCachedResults)}}const go="SyncEngine";class a5{constructor(e,t,r){this.query=e,this.targetId=t,this.view=r}}class l5{constructor(e){this.key=e,this.hu=!1}}class c5{constructor(e,t,r,s,i,o){this.localStore=e,this.remoteStore=t,this.eventManager=r,this.sharedClientState=s,this.currentUser=i,this.maxConcurrentLimboResolutions=o,this.Pu={},this.Tu=new ri(a=>wN(a),Gd),this.Iu=new Map,this.Eu=new Set,this.du=new wt(X.comparator),this.Au=new Map,this.Ru=new Cw,this.Vu={},this.mu=new Map,this.fu=ua.cr(),this.onlineState="Unknown",this.gu=void 0}get isPrimaryClient(){return this.gu===!0}}async function u5(n,e,t=!0){const r=qm(n);let s;const i=r.Tu.get(e);return i?(r.sharedClientState.addLocalQueryTarget(i.targetId),s=i.view.lu()):s=await LP(r,e,t,!0),s}async function d5(n,e){const t=qm(n);await LP(t,e,!0,!1)}async function LP(n,e,t,r){const s=await Kl(n.localStore,Mn(e)),i=s.targetId,o=n.sharedClientState.addLocalQueryTarget(i,t);let a;return r&&(a=await Ww(n,e,i,o==="current",s.resumeToken)),n.isPrimaryClient&&t&&zm(n.remoteStore,s),a}async function Ww(n,e,t,r,s){n.pu=(f,p,y)=>async function(C,P,A,T){let R=P.view.ru(A);R.Cs&&(R=await Pp(C.localStore,P.query,!1).then(({documents:E})=>P.view.ru(E,R)));const D=T&&T.targetChanges.get(P.targetId),F=T&&T.targetMismatches.get(P.targetId)!=null,k=P.view.applyChanges(R,C.isPrimaryClient,D,F);return _v(C,P.targetId,k.au),k.snapshot}(n,f,p,y);const i=await Pp(n.localStore,e,!0),o=new MP(e,i.Qs),a=o.ru(i.documents),l=Yd.createSynthesizedTargetChangeForCurrentChange(t,r&&n.onlineState!=="Offline",s),u=o.applyChanges(a,n.isPrimaryClient,l);_v(n,t,u.au);const h=new a5(e,t,o);return n.Tu.set(e,h),n.Iu.has(t)?n.Iu.get(t).push(e):n.Iu.set(t,[e]),u.snapshot}async function h5(n,e,t){const r=Z(n),s=r.Tu.get(e),i=r.Iu.get(s.targetId);if(i.length>1)return r.Iu.set(s.targetId,i.filter(o=>!Gd(o,e))),void r.Tu.delete(e);r.isPrimaryClient?(r.sharedClientState.removeLocalQueryTarget(s.targetId),r.sharedClientState.isActiveQueryTarget(s.targetId)||await Ql(r.localStore,s.targetId,!1).then(()=>{r.sharedClientState.clearQueryState(s.targetId),t&&Yl(r.remoteStore,s.targetId),Jl(r,s.targetId)}).catch(ho)):(Jl(r,s.targetId),await Ql(r.localStore,s.targetId,!0))}async function f5(n,e){const t=Z(n),r=t.Tu.get(e),s=t.Iu.get(r.targetId);t.isPrimaryClient&&s.length===1&&(t.sharedClientState.removeLocalQueryTarget(r.targetId),Yl(t.remoteStore,r.targetId))}async function p5(n,e,t){const r=Qw(n);try{const s=await function(o,a){const l=Z(o),u=rt.now(),h=a.reduce((y,I)=>y.add(I.key),be());let f,p;return l.persistence.runTransaction("Locally write mutations","readwrite",y=>{let I=Xn(),C=be();return l.Ns.getEntries(y,h).next(P=>{I=P,I.forEach((A,T)=>{T.isValidDocument()||(C=C.add(A))})}).next(()=>l.localDocuments.getOverlayedDocuments(y,I)).next(P=>{f=P;const A=[];for(const T of a){const R=j3(T,f.get(T.key).overlayedDocument);R!=null&&A.push(new si(T.key,R,cN(R.value.mapValue),Ot.exists(!0)))}return l.mutationQueue.addMutationBatch(y,u,A,a)}).next(P=>{p=P;const A=P.applyToLocalDocumentSet(f,C);return l.documentOverlayCache.saveOverlays(y,P.batchId,A)})}).then(()=>({batchId:p.batchId,changes:TN(f)}))}(r.localStore,e);r.sharedClientState.addPendingMutation(s.batchId),function(o,a,l){let u=o.Vu[o.currentUser.toKey()];u||(u=new wt(ve)),u=u.insert(a,l),o.Vu[o.currentUser.toKey()]=u}(r,s.batchId,t),await ii(r,s.changes),await fc(r.remoteStore)}catch(s){const i=mc(s,"Failed to persist write");t.reject(i)}}async function VP(n,e){const t=Z(n);try{const r=await k6(t.localStore,e);e.targetChanges.forEach((s,i)=>{const o=t.Au.get(i);o&&(ae(s.addedDocuments.size+s.modifiedDocuments.size+s.removedDocuments.size<=1,22616),s.addedDocuments.size>0?o.hu=!0:s.modifiedDocuments.size>0?ae(o.hu,14607):s.removedDocuments.size>0&&(ae(o.hu,42227),o.hu=!1))}),await ii(t,r,e)}catch(r){await ho(r)}}function CS(n,e,t){const r=Z(n);if(r.isPrimaryClient&&t===0||!r.isPrimaryClient&&t===1){const s=[];r.Tu.forEach((i,o)=>{const a=o.view.va(e);a.snapshot&&s.push(a.snapshot)}),function(o,a){const l=Z(o);l.onlineState=a;let u=!1;l.queries.forEach((h,f)=>{for(const p of f.Sa)p.va(a)&&(u=!0)}),u&&$w(l)}(r.eventManager,e),s.length&&r.Pu.H_(s),r.onlineState=e,r.isPrimaryClient&&r.sharedClientState.setOnlineState(e)}}async function m5(n,e,t){const r=Z(n);r.sharedClientState.updateQueryState(e,"rejected",t);const s=r.Au.get(e),i=s&&s.key;if(i){let o=new wt(X.comparator);o=o.insert(i,xt.newNoDocument(i,ue.min()));const a=be().add(i),l=new Qd(ue.min(),new Map,new wt(ve),o,a);await VP(r,l),r.du=r.du.remove(i),r.Au.delete(e),Kw(r)}else await Ql(r.localStore,e,!1).then(()=>Jl(r,e,t)).catch(ho)}async function g5(n,e){const t=Z(n),r=e.batch.batchId;try{const s=await P6(t.localStore,e);Hw(t,r,null),Gw(t,r),t.sharedClientState.updateMutationState(r,"acknowledged"),await ii(t,s)}catch(s){await ho(s)}}async function y5(n,e,t){const r=Z(n);try{const s=await function(o,a){const l=Z(o);return l.persistence.runTransaction("Reject batch","readwrite-primary",u=>{let h;return l.mutationQueue.lookupMutationBatch(u,a).next(f=>(ae(f!==null,37113),h=f.keys(),l.mutationQueue.removeMutationBatch(u,f))).next(()=>l.mutationQueue.performConsistencyCheck(u)).next(()=>l.documentOverlayCache.removeOverlaysForBatchId(u,h,a)).next(()=>l.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(u,h)).next(()=>l.localDocuments.getDocuments(u,h))})}(r.localStore,e);Hw(r,e,t),Gw(r,e),r.sharedClientState.updateMutationState(e,"rejected",t),await ii(r,s)}catch(s){await ho(s)}}async function _5(n,e){const t=Z(n);mo(t.remoteStore)||q(go,"The network is disabled. The task returned by 'awaitPendingWrites()' will not complete until the network is enabled.");try{const r=await function(o){const a=Z(o);return a.persistence.runTransaction("Get highest unacknowledged batch id","readonly",l=>a.mutationQueue.getHighestUnacknowledgedBatchId(l))}(t.localStore);if(r===Wi)return void e.resolve();const s=t.mu.get(r)||[];s.push(e),t.mu.set(r,s)}catch(r){const s=mc(r,"Initialization of waitForPendingWrites() operation failed");e.reject(s)}}function Gw(n,e){(n.mu.get(e)||[]).forEach(t=>{t.resolve()}),n.mu.delete(e)}function Hw(n,e,t){const r=Z(n);let s=r.Vu[r.currentUser.toKey()];if(s){const i=s.get(e);i&&(t?i.reject(t):i.resolve(),s=s.remove(e)),r.Vu[r.currentUser.toKey()]=s}}function Jl(n,e,t=null){n.sharedClientState.removeLocalQueryTarget(e);for(const r of n.Iu.get(e))n.Tu.delete(r),t&&n.Pu.yu(r,t);n.Iu.delete(e),n.isPrimaryClient&&n.Ru.jr(e).forEach(r=>{n.Ru.containsKey(r)||FP(n,r)})}function FP(n,e){n.Eu.delete(e.path.canonicalString());const t=n.du.get(e);t!==null&&(Yl(n.remoteStore,t),n.du=n.du.remove(e),n.Au.delete(t),Kw(n))}function _v(n,e,t){for(const r of t)r instanceof DP?(n.Ru.addReference(r.key,e),v5(n,r)):r instanceof OP?(q(go,"Document no longer in limbo: "+r.key),n.Ru.removeReference(r.key,e),n.Ru.containsKey(r.key)||FP(n,r.key)):se(19791,{wu:r})}function v5(n,e){const t=e.key,r=t.path.canonicalString();n.du.get(t)||n.Eu.has(r)||(q(go,"New document in limbo: "+t),n.Eu.add(r),Kw(n))}function Kw(n){for(;n.Eu.size>0&&n.du.size<n.maxConcurrentLimboResolutions;){const e=n.Eu.values().next().value;n.Eu.delete(e);const t=new X(Ve.fromString(e)),r=n.fu.next();n.Au.set(r,new l5(t)),n.du=n.du.insert(t,r),zm(n.remoteStore,new Fs(Mn(cc(t.path)),r,"TargetPurposeLimboResolution",Yn.ce))}}async function ii(n,e,t){const r=Z(n),s=[],i=[],o=[];r.Tu.isEmpty()||(r.Tu.forEach((a,l)=>{o.push(r.pu(l,e,t).then(u=>{var h;if((u||t)&&r.isPrimaryClient){const f=u?!u.fromCache:(h=t==null?void 0:t.targetChanges.get(l.targetId))==null?void 0:h.current;r.sharedClientState.updateQueryState(l.targetId,f?"current":"not-current")}if(u){s.push(u);const f=kw.As(l.targetId,u);i.push(f)}}))}),await Promise.all(o),r.Pu.H_(s),await async function(l,u){const h=Z(l);try{await h.persistence.runTransaction("notifyLocalViewChanges","readwrite",f=>M.forEach(u,p=>M.forEach(p.Es,y=>h.persistence.referenceDelegate.addReference(f,p.targetId,y)).next(()=>M.forEach(p.ds,y=>h.persistence.referenceDelegate.removeReference(f,p.targetId,y)))))}catch(f){if(!fo(f))throw f;q(Dw,"Failed to update sequence numbers: "+f)}for(const f of u){const p=f.targetId;if(!f.fromCache){const y=h.Ms.get(p),I=y.snapshotVersion,C=y.withLastLimboFreeSnapshotVersion(I);h.Ms=h.Ms.insert(p,C)}}}(r.localStore,i))}async function w5(n,e){const t=Z(n);if(!t.currentUser.isEqual(e)){q(go,"User change. New user:",e.toKey());const r=await pP(t.localStore,e);t.currentUser=e,function(i,o){i.mu.forEach(a=>{a.forEach(l=>{l.reject(new z(V.CANCELLED,o))})}),i.mu.clear()}(t,"'waitForPendingWrites' promise is rejected due to a user change."),t.sharedClientState.handleUserChange(e,r.removedBatchIds,r.addedBatchIds),await ii(t,r.Ls)}}function I5(n,e){const t=Z(n),r=t.Au.get(e);if(r&&r.hu)return be().add(r.key);{let s=be();const i=t.Iu.get(e);if(!i)return s;for(const o of i){const a=t.Tu.get(o);s=s.unionWith(a.view.nu)}return s}}async function E5(n,e){const t=Z(n),r=await Pp(t.localStore,e.query,!0),s=e.view.cu(r);return t.isPrimaryClient&&_v(t,e.targetId,s.au),s}async function x5(n,e){const t=Z(n);return _P(t.localStore,e).then(r=>ii(t,r))}async function T5(n,e,t,r){const s=Z(n),i=await function(a,l){const u=Z(a),h=Z(u.mutationQueue);return u.persistence.runTransaction("Lookup mutation documents","readonly",f=>h.er(f,l).next(p=>p?u.localDocuments.getDocuments(f,p):M.resolve(null)))}(s.localStore,e);i!==null?(t==="pending"?await fc(s.remoteStore):t==="acknowledged"||t==="rejected"?(Hw(s,e,r||null),Gw(s,e),function(a,l){Z(Z(a).mutationQueue).ir(l)}(s.localStore,e)):se(6720,"Unknown batchState",{Su:t}),await ii(s,i)):q(go,"Cannot apply mutation batch with id: "+e)}async function S5(n,e){const t=Z(n);if(qm(t),Qw(t),e===!0&&t.gu!==!0){const r=t.sharedClientState.getAllActiveQueryTargets(),s=await RS(t,r.toArray());t.gu=!0,await gv(t.remoteStore,!0);for(const i of s)zm(t.remoteStore,i)}else if(e===!1&&t.gu!==!1){const r=[];let s=Promise.resolve();t.Iu.forEach((i,o)=>{t.sharedClientState.isLocalQueryTarget(o)?r.push(o):s=s.then(()=>(Jl(t,o),Ql(t.localStore,o,!0))),Yl(t.remoteStore,o)}),await s,await RS(t,r),function(o){const a=Z(o);a.Au.forEach((l,u)=>{Yl(a.remoteStore,u)}),a.Ru.Jr(),a.Au=new Map,a.du=new wt(X.comparator)}(t),t.gu=!1,await gv(t.remoteStore,!1)}}async function RS(n,e,t){const r=Z(n),s=[],i=[];for(const o of e){let a;const l=r.Iu.get(o);if(l&&l.length!==0){a=await Kl(r.localStore,Mn(l[0]));for(const u of l){const h=r.Tu.get(u),f=await E5(r,h);f.snapshot&&i.push(f.snapshot)}}else{const u=await yP(r.localStore,o);a=await Kl(r.localStore,u),await Ww(r,jP(u),o,!1,a.resumeToken)}s.push(a)}return r.Pu.H_(i),s}function jP(n){return yN(n.path,n.collectionGroup,n.orderBy,n.filters,n.limit,"F",n.startAt,n.endAt)}function b5(n){return function(t){return Z(Z(t).persistence).Ts()}(Z(n).localStore)}async function A5(n,e,t,r){const s=Z(n);if(s.gu)return void q(go,"Ignoring unexpected query state notification.");const i=s.Iu.get(e);if(i&&i.length>0)switch(t){case"current":case"not-current":{const o=await _P(s.localStore,IN(i[0])),a=Qd.createSynthesizedRemoteEventForCurrentChange(e,t==="current",$t.EMPTY_BYTE_STRING);await ii(s,o,a);break}case"rejected":await Ql(s.localStore,e,!0),Jl(s,e,r);break;default:se(64155,t)}}async function C5(n,e,t){const r=qm(n);if(r.gu){for(const s of e){if(r.Iu.has(s)&&r.sharedClientState.isActiveQueryTarget(s)){q(go,"Adding an already active target "+s);continue}const i=await yP(r.localStore,s),o=await Kl(r.localStore,i);await Ww(r,jP(i),o.targetId,!1,o.resumeToken),zm(r.remoteStore,o)}for(const s of t)r.Iu.has(s)&&await Ql(r.localStore,s,!1).then(()=>{Yl(r.remoteStore,s),Jl(r,s)}).catch(ho)}}function qm(n){const e=Z(n);return e.remoteStore.remoteSyncer.applyRemoteEvent=VP.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=I5.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=m5.bind(null,e),e.Pu.H_=i5.bind(null,e.eventManager),e.Pu.yu=o5.bind(null,e.eventManager),e}function Qw(n){const e=Z(n);return e.remoteStore.remoteSyncer.applySuccessfulWrite=g5.bind(null,e),e.remoteStore.remoteSyncer.rejectFailedWrite=y5.bind(null,e),e}function R5(n,e,t){const r=Z(n);(async function(i,o,a){try{const l=await o.getMetadata();if(await function(y,I){const C=Z(y),P=Ht(I.createTime);return C.persistence.runTransaction("hasNewerBundle","readonly",A=>C.Ii.getBundleMetadata(A,I.id)).then(A=>!!A&&A.createTime.compareTo(P)>=0)}(i.localStore,l))return await o.close(),a._completeWith(function(y){return{taskState:"Success",documentsLoaded:y.totalDocuments,bytesLoaded:y.totalBytes,totalDocuments:y.totalDocuments,totalBytes:y.totalBytes}}(l)),Promise.resolve(new Set);a._updateProgress(kP(l));const u=new qw(l,o.serializer);let h=await o.bu();for(;h;){const p=await u.Ga(h);p&&a._updateProgress(p),h=await o.bu()}const f=await u.ja(i.localStore);return await ii(i,f.Ha,void 0),await function(y,I){const C=Z(y);return C.persistence.runTransaction("Save bundle","readwrite",P=>C.Ii.saveBundleMetadata(P,I))}(i.localStore,l),a._completeWith(f.progress),Promise.resolve(f.Ja)}catch(l){return Vr(go,`Loading bundle failed with ${l}`),a._failWith(l),Promise.resolve(new Set)}})(r,e,t).then(s=>{r.sharedClientState.notifyBundleLoaded(s)})}class Xl{constructor(){this.kind="memory",this.synchronizeTabs=!1}async initialize(e){this.serializer=Ta(e.databaseInfo.databaseId),this.sharedClientState=this.Du(e),this.persistence=this.Cu(e),await this.persistence.start(),this.localStore=this.vu(e),this.gcScheduler=this.Fu(e,this.localStore),this.indexBackfillerScheduler=this.Mu(e,this.localStore)}Fu(e,t){return null}Mu(e,t){return null}vu(e){return fP(this.persistence,new hP,e.initialUser,this.serializer)}Cu(e){return new Rw($m.mi,this.serializer)}Du(e){return new xP}async terminate(){var e,t;(e=this.gcScheduler)==null||e.stop(),(t=this.indexBackfillerScheduler)==null||t.stop(),this.sharedClientState.shutdown(),await this.persistence.shutdown()}}Xl.provider={build:()=>new Xl};class Yw extends Xl{constructor(e){super(),this.cacheSizeBytes=e}Fu(e,t){ae(this.persistence.referenceDelegate instanceof Np,46915);const r=this.persistence.referenceDelegate.garbageCollector;return new oP(r,e.asyncQueue,t)}Cu(e){const t=this.cacheSizeBytes!==void 0?Pn.withCacheSize(this.cacheSizeBytes):Pn.DEFAULT;return new Rw(r=>Np.mi(r,t),this.serializer)}}class Jw extends Xl{constructor(e,t,r){super(),this.xu=e,this.cacheSizeBytes=t,this.forceOwnership=r,this.kind="persistent",this.synchronizeTabs=!1}async initialize(e){await super.initialize(e),await this.xu.initialize(this,e),await Qw(this.xu.syncEngine),await fc(this.xu.remoteStore),await this.persistence.Ji(()=>(this.gcScheduler&&!this.gcScheduler.started&&this.gcScheduler.start(),this.indexBackfillerScheduler&&!this.indexBackfillerScheduler.started&&this.indexBackfillerScheduler.start(),Promise.resolve()))}vu(e){return fP(this.persistence,new hP,e.initialUser,this.serializer)}Fu(e,t){const r=this.persistence.referenceDelegate.garbageCollector;return new oP(r,e.asyncQueue,t)}Mu(e,t){const r=new q4(t,this.persistence);return new z4(e.asyncQueue,r)}Cu(e){const t=Pw(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey),r=this.cacheSizeBytes!==void 0?Pn.withCacheSize(this.cacheSizeBytes):Pn.DEFAULT;return new Nw(this.synchronizeTabs,t,e.clientId,r,e.asyncQueue,TP(),bf(),this.serializer,this.sharedClientState,!!this.forceOwnership)}Du(e){return new xP}}class UP extends Jw{constructor(e,t){super(e,t,!1),this.xu=e,this.cacheSizeBytes=t,this.synchronizeTabs=!0}async initialize(e){await super.initialize(e);const t=this.xu.syncEngine;this.sharedClientState instanceof gy&&(this.sharedClientState.syncEngine={Co:T5.bind(null,t),vo:A5.bind(null,t),Fo:C5.bind(null,t),Ts:b5.bind(null,t),Do:x5.bind(null,t)},await this.sharedClientState.start()),await this.persistence.Ji(async r=>{await S5(this.xu.syncEngine,r),this.gcScheduler&&(r&&!this.gcScheduler.started?this.gcScheduler.start():r||this.gcScheduler.stop()),this.indexBackfillerScheduler&&(r&&!this.indexBackfillerScheduler.started?this.indexBackfillerScheduler.start():r||this.indexBackfillerScheduler.stop())})}Du(e){const t=TP();if(!gy.v(t))throw new z(V.UNIMPLEMENTED,"IndexedDB persistence is only available on platforms that support LocalStorage.");const r=Pw(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey);return new gy(t,e.asyncQueue,r,e.clientId,e.initialUser)}}class io{async initialize(e,t){this.localStore||(this.localStore=e.localStore,this.sharedClientState=e.sharedClientState,this.datastore=this.createDatastore(t),this.remoteStore=this.createRemoteStore(t),this.eventManager=this.createEventManager(t),this.syncEngine=this.createSyncEngine(t,!e.synchronizeTabs),this.sharedClientState.onlineStateHandler=r=>CS(this.syncEngine,r,1),this.remoteStore.remoteSyncer.handleCredentialChange=w5.bind(null,this.syncEngine),await gv(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(e){return function(){return new s5}()}createDatastore(e){const t=Ta(e.databaseInfo.databaseId),r=function(i){return new U6(i)}(e.databaseInfo);return function(i,o,a,l){return new q6(i,o,a,l)}(e.authCredentials,e.appCheckCredentials,r,t)}createRemoteStore(e){return function(r,s,i,o,a){return new G6(r,s,i,o,a)}(this.localStore,this.datastore,e.asyncQueue,t=>CS(this.syncEngine,t,0),function(){return IS.v()?new IS:new L6}())}createSyncEngine(e,t){return function(s,i,o,a,l,u,h){const f=new c5(s,i,o,a,l,u);return h&&(f.gu=!0),f}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,e.initialUser,e.maxConcurrentLimboResolutions,t)}async terminate(){var e,t;await async function(s){const i=Z(s);q(da,"RemoteStore shutting down."),i.Ea.add(5),await hc(i),i.Aa.shutdown(),i.Ra.set("Unknown")}(this.remoteStore),(e=this.datastore)==null||e.terminate(),(t=this.eventManager)==null||t.terminate()}}io.provider={build:()=>new io};function NS(n,e=10240){let t=0;return{async read(){if(t<n.byteLength){const r={value:n.slice(t,t+e),done:!1};return t+=e,r}return{done:!0}},async cancel(){},releaseLock(){},closed:Promise.resolve()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Wm{constructor(e){this.observer=e,this.muted=!1}next(e){this.muted||this.observer.next&&this.Ou(this.observer.next,e)}error(e){this.muted||(this.observer.error?this.Ou(this.observer.error,e):Gt("Uncaught Error in snapshot listener:",e.toString()))}Nu(){this.muted=!0}Ou(e,t){setTimeout(()=>{this.muted||e(t)},0)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class N5{constructor(e,t){this.Bu=e,this.serializer=t,this.metadata=new fn,this.buffer=new Uint8Array,this.Lu=function(){return new TextDecoder("utf-8")}(),this.ku().then(r=>{r&&r.$a()?this.metadata.resolve(r.Qa.metadata):this.metadata.reject(new Error(`The first element of the bundle is not a metadata, it is
             ${JSON.stringify(r==null?void 0:r.Qa)}`))},r=>this.metadata.reject(r))}close(){return this.Bu.cancel()}async getMetadata(){return this.metadata.promise}async bu(){return await this.getMetadata(),this.ku()}async ku(){const e=await this.qu();if(e===null)return null;const t=this.Lu.decode(e),r=Number(t);isNaN(r)&&this.Qu(`length string (${t}) is not valid number`);const s=await this.$u(r);return new PP(JSON.parse(s),e.length+r)}Uu(){return this.buffer.findIndex(e=>e==="{".charCodeAt(0))}async qu(){for(;this.Uu()<0&&!await this.Ku(););if(this.buffer.length===0)return null;const e=this.Uu();e<0&&this.Qu("Reached the end of bundle when a length string is expected.");const t=this.buffer.slice(0,e);return this.buffer=this.buffer.slice(e),t}async $u(e){for(;this.buffer.length<e;)await this.Ku()&&this.Qu("Reached the end of bundle when more is expected.");const t=this.Lu.decode(this.buffer.slice(0,e));return this.buffer=this.buffer.slice(e),t}Qu(e){throw this.Bu.cancel(),new Error(`Invalid bundle format: ${e}`)}async Ku(){const e=await this.Bu.read();if(!e.done){const t=new Uint8Array(this.buffer.length+e.value.length);t.set(this.buffer),t.set(e.value,this.buffer.length),this.buffer=t}return e.done}}/**
 * @license
 * Copyright 2025 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class P5{constructor(e,t){this.bundleData=e,this.serializer=t,this.cursor=0,this.elements=[];let r=this.bu();if(!r||!r.$a())throw new Error(`The first element of the bundle is not a metadata object, it is
         ${JSON.stringify(r==null?void 0:r.Qa)}`);this.metadata=r;do r=this.bu(),r!==null&&this.elements.push(r);while(r!==null)}getMetadata(){return this.metadata}Wu(){return this.elements}bu(){if(this.cursor===this.bundleData.length)return null;const e=this.qu(),t=this.$u(e);return new PP(JSON.parse(t),e)}$u(e){if(this.cursor+e>this.bundleData.length)throw new z(V.INTERNAL,"Reached the end of bundle when more is expected.");return this.bundleData.slice(this.cursor,this.cursor+=e)}qu(){const e=this.cursor;let t=this.cursor;for(;t<this.bundleData.length;){if(this.bundleData[t]==="{"){if(t===e)throw new Error("First character is a bracket and not a number");return this.cursor=t,Number(this.bundleData.slice(e,t))}t++}throw new Error("Reached the end of bundle when more is expected.")}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class k5{constructor(e){this.datastore=e,this.readVersions=new Map,this.mutations=[],this.committed=!1,this.lastTransactionError=null,this.writtenDocs=new Set}async lookup(e){if(this.ensureCommitNotCalled(),this.mutations.length>0)throw this.lastTransactionError=new z(V.INVALID_ARGUMENT,"Firestore transactions require all reads to be executed before all writes."),this.lastTransactionError;const t=await async function(s,i){const o=Z(s),a={documents:i.map(f=>md(o.serializer,f))},l=await o.Ho("BatchGetDocuments",o.serializer.databaseId,Ve.emptyPath(),a,i.length),u=new Map;l.forEach(f=>{const p=K3(o.serializer,f);u.set(p.key.toString(),p)});const h=[];return i.forEach(f=>{const p=u.get(f.toString());ae(!!p,55234,{key:f}),h.push(p)}),h}(this.datastore,e);return t.forEach(r=>this.recordVersion(r)),t}set(e,t){this.write(t.toMutation(e,this.precondition(e))),this.writtenDocs.add(e.toString())}update(e,t){try{this.write(t.toMutation(e,this.preconditionForUpdate(e)))}catch(r){this.lastTransactionError=r}this.writtenDocs.add(e.toString())}delete(e){this.write(new dc(e,this.precondition(e))),this.writtenDocs.add(e.toString())}async commit(){if(this.ensureCommitNotCalled(),this.lastTransactionError)throw this.lastTransactionError;const e=this.readVersions;this.mutations.forEach(t=>{e.delete(t.key.toString())}),e.forEach((t,r)=>{const s=X.fromPath(r);this.mutations.push(new ww(s,this.precondition(s)))}),await async function(r,s){const i=Z(r),o={writes:s.map(a=>gd(i.serializer,a))};await i.Go("Commit",i.serializer.databaseId,Ve.emptyPath(),o)}(this.datastore,this.mutations),this.committed=!0}recordVersion(e){let t;if(e.isFoundDocument())t=e.version;else{if(!e.isNoDocument())throw se(50498,{Gu:e.constructor.name});t=ue.min()}const r=this.readVersions.get(e.key.toString());if(r){if(!t.isEqual(r))throw new z(V.ABORTED,"Document version changed between two reads.")}else this.readVersions.set(e.key.toString(),t)}precondition(e){const t=this.readVersions.get(e.toString());return!this.writtenDocs.has(e.toString())&&t?t.isEqual(ue.min())?Ot.exists(!1):Ot.updateTime(t):Ot.none()}preconditionForUpdate(e){const t=this.readVersions.get(e.toString());if(!this.writtenDocs.has(e.toString())&&t){if(t.isEqual(ue.min()))throw new z(V.INVALID_ARGUMENT,"Can't update a document that doesn't exist.");return Ot.updateTime(t)}return Ot.exists(!0)}write(e){this.ensureCommitNotCalled(),this.mutations.push(e)}ensureCommitNotCalled(){}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class D5{constructor(e,t,r,s,i){this.asyncQueue=e,this.datastore=t,this.options=r,this.updateFunction=s,this.deferred=i,this.zu=r.maxAttempts,this.M_=new Mw(this.asyncQueue,"transaction_retry")}ju(){this.zu-=1,this.Ju()}Ju(){this.M_.p_(async()=>{const e=new k5(this.datastore),t=this.Hu(e);t&&t.then(r=>{this.asyncQueue.enqueueAndForget(()=>e.commit().then(()=>{this.deferred.resolve(r)}).catch(s=>{this.Yu(s)}))}).catch(r=>{this.Yu(r)})})}Hu(e){try{const t=this.updateFunction(e);return!zd(t)&&t.catch&&t.then?t:(this.deferred.reject(Error("Transaction callback must return a Promise")),null)}catch(t){return this.deferred.reject(t),null}}Yu(e){this.zu>0&&this.Zu(e)?(this.zu-=1,this.asyncQueue.enqueueAndForget(()=>(this.Ju(),Promise.resolve()))):this.deferred.reject(e)}Zu(e){if(e.name==="FirebaseError"){const t=e.code;return t==="aborted"||t==="failed-precondition"||t==="already-exists"||!MN(t)}return!1}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const oo="FirestoreClient";class O5{constructor(e,t,r,s,i){this.authCredentials=e,this.appCheckCredentials=t,this.asyncQueue=r,this.databaseInfo=s,this.user=un.UNAUTHENTICATED,this.clientId=ow.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this._uninitializedComponentsProvider=i,this.authCredentials.start(r,async o=>{q(oo,"Received user=",o.uid),await this.authCredentialListener(o),this.user=o}),this.appCheckCredentials.start(r,o=>(q(oo,"Received new app check token=",o),this.appCheckCredentialListener(o,this.user)))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}terminate(){this.asyncQueue.enterRestrictedMode();const e=new fn;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted(async()=>{try{this._onlineComponents&&await this._onlineComponents.terminate(),this._offlineComponents&&await this._offlineComponents.terminate(),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),e.resolve()}catch(t){const r=mc(t,"Failed to shutdown persistence");e.reject(r)}}),e.promise}}async function _y(n,e){n.asyncQueue.verifyOperationInProgress(),q(oo,"Initializing OfflineComponentProvider");const t=n.configuration;await e.initialize(t);let r=t.initialUser;n.setCredentialChangeListener(async s=>{r.isEqual(s)||(await pP(e.localStore,s),r=s)}),e.persistence.setDatabaseDeletedListener(()=>n.terminate()),n._offlineComponents=e}async function PS(n,e){n.asyncQueue.verifyOperationInProgress();const t=await Xw(n);q(oo,"Initializing OnlineComponentProvider"),await e.initialize(t,n.configuration),n.setCredentialChangeListener(r=>xS(e.remoteStore,r)),n.setAppCheckTokenChangeListener((r,s)=>xS(e.remoteStore,s)),n._onlineComponents=e}async function Xw(n){if(!n._offlineComponents)if(n._uninitializedComponentsProvider){q(oo,"Using user provided OfflineComponentProvider");try{await _y(n,n._uninitializedComponentsProvider._offline)}catch(e){const t=e;if(!function(s){return s.name==="FirebaseError"?s.code===V.FAILED_PRECONDITION||s.code===V.UNIMPLEMENTED:!(typeof DOMException<"u"&&s instanceof DOMException)||s.code===22||s.code===20||s.code===11}(t))throw t;Vr("Error using user provided cache. Falling back to memory cache: "+t),await _y(n,new Xl)}}else q(oo,"Using default OfflineComponentProvider"),await _y(n,new Yw(void 0));return n._offlineComponents}async function Gm(n){return n._onlineComponents||(n._uninitializedComponentsProvider?(q(oo,"Using user provided OnlineComponentProvider"),await PS(n,n._uninitializedComponentsProvider._online)):(q(oo,"Using default OnlineComponentProvider"),await PS(n,new io))),n._onlineComponents}function BP(n){return Xw(n).then(e=>e.persistence)}function gc(n){return Xw(n).then(e=>e.localStore)}function $P(n){return Gm(n).then(e=>e.remoteStore)}function Zw(n){return Gm(n).then(e=>e.syncEngine)}function zP(n){return Gm(n).then(e=>e.datastore)}async function Zl(n){const e=await Gm(n),t=e.eventManager;return t.onListen=u5.bind(null,e.syncEngine),t.onUnlisten=h5.bind(null,e.syncEngine),t.onFirstRemoteStoreListen=d5.bind(null,e.syncEngine),t.onLastRemoteStoreUnlisten=f5.bind(null,e.syncEngine),t}function M5(n){return n.asyncQueue.enqueue(async()=>{const e=await BP(n),t=await $P(n);return e.setNetworkEnabled(!0),function(s){const i=Z(s);return i.Ea.delete(0),Jd(i)}(t)})}function L5(n){return n.asyncQueue.enqueue(async()=>{const e=await BP(n),t=await $P(n);return e.setNetworkEnabled(!1),async function(s){const i=Z(s);i.Ea.add(0),await hc(i),i.Ra.set("Offline")}(t)})}function V5(n,e){const t=new fn;return n.asyncQueue.enqueueAndForget(async()=>async function(s,i,o){try{const a=await function(u,h){const f=Z(u);return f.persistence.runTransaction("read document","readonly",p=>f.localDocuments.getDocument(p,h))}(s,i);a.isFoundDocument()?o.resolve(a):a.isNoDocument()?o.resolve(null):o.reject(new z(V.UNAVAILABLE,"Failed to get document from cache. (However, this document may exist on the server. Run again without setting 'source' in the GetOptions to attempt to retrieve the document from the server.)"))}catch(a){const l=mc(a,`Failed to get document '${i} from cache`);o.reject(l)}}(await gc(n),e,t)),t.promise}function qP(n,e,t={}){const r=new fn;return n.asyncQueue.enqueueAndForget(async()=>function(i,o,a,l,u){const h=new Wm({next:p=>{h.Nu(),o.enqueueAndForget(()=>Bw(i,f));const y=p.docs.has(a);!y&&p.fromCache?u.reject(new z(V.UNAVAILABLE,"Failed to get document because the client is offline.")):y&&p.fromCache&&l&&l.source==="server"?u.reject(new z(V.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):u.resolve(p)},error:p=>u.reject(p)}),f=new zw(cc(a.path),h,{includeMetadataChanges:!0,qa:!0});return Uw(i,f)}(await Zl(n),n.asyncQueue,e,t,r)),r.promise}function F5(n,e){const t=new fn;return n.asyncQueue.enqueueAndForget(async()=>async function(s,i,o){try{const a=await Pp(s,i,!0),l=new MP(i,a.Qs),u=l.ru(a.documents),h=l.applyChanges(u,!1);o.resolve(h.snapshot)}catch(a){const l=mc(a,`Failed to execute query '${i} against cache`);o.reject(l)}}(await gc(n),e,t)),t.promise}function WP(n,e,t={}){const r=new fn;return n.asyncQueue.enqueueAndForget(async()=>function(i,o,a,l,u){const h=new Wm({next:p=>{h.Nu(),o.enqueueAndForget(()=>Bw(i,f)),p.fromCache&&l.source==="server"?u.reject(new z(V.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):u.resolve(p)},error:p=>u.reject(p)}),f=new zw(a,h,{includeMetadataChanges:!0,qa:!0});return Uw(i,f)}(await Zl(n),n.asyncQueue,e,t,r)),r.promise}function j5(n,e,t){const r=new fn;return n.asyncQueue.enqueueAndForget(async()=>{try{const s=await zP(n);r.resolve(async function(o,a,l){var C;const u=Z(o),{request:h,gt:f,parent:p}=GN(u.serializer,_N(a),l);u.connection.$o||delete h.parent;const y=(await u.Ho("RunAggregationQuery",u.serializer.databaseId,p,h,1)).filter(P=>!!P.result);ae(y.length===1,64727);const I=(C=y[0].result)==null?void 0:C.aggregateFields;return Object.keys(I).reduce((P,A)=>(P[f[A]]=I[A],P),{})}(s,e,t))}catch(s){r.reject(s)}}),r.promise}function U5(n,e){const t=new Wm(e);return n.asyncQueue.enqueueAndForget(async()=>function(s,i){Z(s).Ca.add(i),i.next()}(await Zl(n),t)),()=>{t.Nu(),n.asyncQueue.enqueueAndForget(async()=>function(s,i){Z(s).Ca.delete(i)}(await Zl(n),t))}}function B5(n,e,t,r){const s=function(o,a){let l;return l=typeof o=="string"?VN().encode(o):o,function(h,f){return new N5(h,f)}(function(h,f){if(h instanceof Uint8Array)return NS(h,f);if(h instanceof ArrayBuffer)return NS(new Uint8Array(h),f);if(h instanceof ReadableStream)return h.getReader();throw new Error("Source of `toByteStreamReader` has to be a ArrayBuffer or ReadableStream")}(l),a)}(t,Ta(e));n.asyncQueue.enqueueAndForget(async()=>{R5(await Zw(n),s,r)})}function $5(n,e){return n.asyncQueue.enqueue(async()=>function(r,s){const i=Z(r);return i.persistence.runTransaction("Get named query","readonly",o=>i.Ii.getNamedQuery(o,s))}(await gc(n),e))}function GP(n,e){return function(r,s){return new P5(r,s)}(n,e)}function z5(n,e){return n.asyncQueue.enqueue(async()=>async function(r,s){const i=Z(r),o=i.indexManager,a=[];return i.persistence.runTransaction("Configure indexes","readwrite",l=>o.getFieldIndexes(l).next(u=>function(f,p,y,I,C){f=[...f],p=[...p],f.sort(y),p.sort(y);const P=f.length,A=p.length;let T=0,R=0;for(;T<A&&R<P;){const D=y(f[R],p[T]);D<0?C(f[R++]):D>0?I(p[T++]):(T++,R++)}for(;T<A;)I(p[T++]);for(;R<P;)C(f[R++])}(u,s,j4,h=>{a.push(o.addFieldIndex(l,h))},h=>{a.push(o.deleteFieldIndex(l,h))})).next(()=>M.waitFor(a)))}(await gc(n),e))}function q5(n,e){return n.asyncQueue.enqueue(async()=>function(r,s){Z(r).Fs.Vs=s}(await gc(n),e))}function W5(n){return n.asyncQueue.enqueue(async()=>function(t){const r=Z(t),s=r.indexManager;return r.persistence.runTransaction("Delete All Indexes","readwrite",i=>s.deleteAllFieldIndexes(i))}(await gc(n)))}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function HP(n){const e={};return n.timeoutSeconds!==void 0&&(e.timeoutSeconds=n.timeoutSeconds),e}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const kS=new Map;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const KP="firestore.googleapis.com",DS=!0;class OS{constructor(e){if(e.host===void 0){if(e.ssl!==void 0)throw new z(V.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host=KP,this.ssl=DS}else this.host=e.host,this.ssl=e.ssl??DS;if(this.isUsingEmulator=e.emulatorOptions!==void 0,this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,this.localCache=e.localCache,e.cacheSizeBytes===void 0)this.cacheSizeBytes=tP;else{if(e.cacheSizeBytes!==-1&&e.cacheSizeBytes<iP)throw new z(V.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}F4("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:e.experimentalAutoDetectLongPolling===void 0?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=HP(e.experimentalLongPollingOptions??{}),function(r){if(r.timeoutSeconds!==void 0){if(isNaN(r.timeoutSeconds))throw new z(V.INVALID_ARGUMENT,`invalid long polling timeout: ${r.timeoutSeconds} (must not be NaN)`);if(r.timeoutSeconds<5)throw new z(V.INVALID_ARGUMENT,`invalid long polling timeout: ${r.timeoutSeconds} (minimum allowed value is 5)`);if(r.timeoutSeconds>30)throw new z(V.INVALID_ARGUMENT,`invalid long polling timeout: ${r.timeoutSeconds} (maximum allowed value is 30)`)}}(this.experimentalLongPollingOptions),this.useFetchStreams=!!e.useFetchStreams}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&function(r,s){return r.timeoutSeconds===s.timeoutSeconds}(this.experimentalLongPollingOptions,e.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}}class Xd{constructor(e,t,r,s){this._authCredentials=e,this._appCheckCredentials=t,this._databaseId=r,this._app=s,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new OS({}),this._settingsFrozen=!1,this._emulatorOptions={},this._terminateTask="notTerminated"}get app(){if(!this._app)throw new z(V.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return this._terminateTask!=="notTerminated"}_setSettings(e){if(this._settingsFrozen)throw new z(V.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new OS(e),this._emulatorOptions=e.emulatorOptions||{},e.credentials!==void 0&&(this._authCredentials=function(r){if(!r)return new C4;switch(r.type){case"firstParty":return new k4(r.sessionIndex||"0",r.iamToken||null,r.authTokenFactory||null);case"provider":return r.client;default:throw new z(V.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(e.credentials))}_getSettings(){return this._settings}_getEmulatorOptions(){return this._emulatorOptions}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask==="notTerminated"&&(this._terminateTask=this._terminate()),this._terminateTask}async _restart(){this._terminateTask==="notTerminated"?await this._terminate():this._terminateTask="notTerminated"}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(t){const r=kS.get(t);r&&(q("ComponentProvider","Removing Datastore"),kS.delete(t),r.terminate())}(this),Promise.resolve()}}function G5(n,e,t,r={}){var u;n=je(n,Xd);const s=ti(e),i=n._getSettings(),o={...i,emulatorOptions:n._getEmulatorOptions()},a=`${e}:${t}`;s&&(om(`https://${a}`),_0("Firestore",!0)),i.host!==KP&&i.host!==a&&Vr("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used.");const l={...i,host:a,ssl:s,emulatorOptions:r};if(!Ir(l,o)&&(n._setSettings(l),r.mockUserToken)){let h,f;if(typeof r.mockUserToken=="string")h=r.mockUserToken,f=un.MOCK_USER;else{h=GA(r.mockUserToken,(u=n._app)==null?void 0:u.options.projectId);const p=r.mockUserToken.sub||r.mockUserToken.user_id;if(!p)throw new z(V.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");f=new un(p)}n._authCredentials=new R4(new DR(h,f))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class gn{constructor(e,t,r){this.converter=t,this._query=r,this.type="query",this.firestore=e}withConverter(e){return new gn(this.firestore,e,this._query)}}class ut{constructor(e,t,r){this.converter=t,this._key=r,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new Is(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new ut(this.firestore,e,this._key)}toJSON(){return{type:ut._jsonSchemaVersion,referencePath:this._key.toString()}}static fromJSON(e,t,r){if(xa(t,ut._jsonSchema))return new ut(e,r||null,new X(Ve.fromString(t.referencePath)))}}ut._jsonSchemaVersion="firestore/documentReference/1.0",ut._jsonSchema={type:Jt("string",ut._jsonSchemaVersion),referencePath:Jt("string")};class Is extends gn{constructor(e,t,r){super(e,t,cc(r)),this._path=r,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const e=this._path.popLast();return e.isEmpty()?null:new ut(this.firestore,null,new X(e))}withConverter(e){return new Is(this.firestore,e,this._path)}}function vy(n,e,...t){if(n=ne(n),aw("collection","path",e),n instanceof Xd){const r=Ve.fromString(e,...t);return ET(r),new Is(n,null,r)}{if(!(n instanceof ut||n instanceof Is))throw new z(V.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const r=n._path.child(Ve.fromString(e,...t));return ET(r),new Is(n.firestore,null,r)}}function u7(n,e){if(n=je(n,Xd),aw("collectionGroup","collection id",e),e.indexOf("/")>=0)throw new z(V.INVALID_ARGUMENT,`Invalid collection ID '${e}' passed to function collectionGroup(). Collection IDs must not contain '/'.`);return new gn(n,null,function(r){return new ni(Ve.emptyPath(),r)}(e))}function su(n,e,...t){if(n=ne(n),arguments.length===1&&(e=ow.newId()),aw("doc","path",e),n instanceof Xd){const r=Ve.fromString(e,...t);return IT(r),new ut(n,null,new X(r))}{if(!(n instanceof ut||n instanceof Is))throw new z(V.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const r=n._path.child(Ve.fromString(e,...t));return IT(r),new ut(n.firestore,n instanceof Is?n.converter:null,new X(r))}}function d7(n,e){return n=ne(n),e=ne(e),(n instanceof ut||n instanceof Is)&&(e instanceof ut||e instanceof Is)&&n.firestore===e.firestore&&n.path===e.path&&n.converter===e.converter}function QP(n,e){return n=ne(n),e=ne(e),n instanceof gn&&e instanceof gn&&n.firestore===e.firestore&&Gd(n._query,e._query)&&n.converter===e.converter}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const MS="AsyncQueue";class LS{constructor(e=Promise.resolve()){this.Xu=[],this.ec=!1,this.tc=[],this.nc=null,this.rc=!1,this.sc=!1,this.oc=[],this.M_=new Mw(this,"async_queue_retry"),this._c=()=>{const r=bf();r&&q(MS,"Visibility state changed to "+r.visibilityState),this.M_.w_()},this.ac=e;const t=bf();t&&typeof t.addEventListener=="function"&&t.addEventListener("visibilitychange",this._c)}get isShuttingDown(){return this.ec}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.uc(),this.cc(e)}enterRestrictedMode(e){if(!this.ec){this.ec=!0,this.sc=e||!1;const t=bf();t&&typeof t.removeEventListener=="function"&&t.removeEventListener("visibilitychange",this._c)}}enqueue(e){if(this.uc(),this.ec)return new Promise(()=>{});const t=new fn;return this.cc(()=>this.ec&&this.sc?Promise.resolve():(e().then(t.resolve,t.reject),t.promise)).then(()=>t.promise)}enqueueRetryable(e){this.enqueueAndForget(()=>(this.Xu.push(e),this.lc()))}async lc(){if(this.Xu.length!==0){try{await this.Xu[0](),this.Xu.shift(),this.M_.reset()}catch(e){if(!fo(e))throw e;q(MS,"Operation failed with retryable error: "+e)}this.Xu.length>0&&this.M_.p_(()=>this.lc())}}cc(e){const t=this.ac.then(()=>(this.rc=!0,e().catch(r=>{throw this.nc=r,this.rc=!1,Gt("INTERNAL UNHANDLED ERROR: ",VS(r)),r}).then(r=>(this.rc=!1,r))));return this.ac=t,t}enqueueAfterDelay(e,t,r){this.uc(),this.oc.indexOf(e)>-1&&(t=0);const s=jw.createAndSchedule(this,e,t,r,i=>this.hc(i));return this.tc.push(s),s}uc(){this.nc&&se(47125,{Pc:VS(this.nc)})}verifyOperationInProgress(){}async Tc(){let e;do e=this.ac,await e;while(e!==this.ac)}Ic(e){for(const t of this.tc)if(t.timerId===e)return!0;return!1}Ec(e){return this.Tc().then(()=>{this.tc.sort((t,r)=>t.targetTimeMs-r.targetTimeMs);for(const t of this.tc)if(t.skipDelay(),e!=="all"&&t.timerId===e)break;return this.Tc()})}dc(e){this.oc.push(e)}hc(e){const t=this.tc.indexOf(e);this.tc.splice(t,1)}}function VS(n){let e=n.message||"";return n.stack&&(e=n.stack.includes(n.message)?n.stack:n.message+`
`+n.stack),e}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ml(n){return function(t,r){if(typeof t!="object"||t===null)return!1;const s=t;for(const i of r)if(i in s&&typeof s[i]=="function")return!0;return!1}(n,["next","error","complete"])}class H5{constructor(){this._progressObserver={},this._taskCompletionResolver=new fn,this._lastProgress={taskState:"Running",totalBytes:0,totalDocuments:0,bytesLoaded:0,documentsLoaded:0}}onProgress(e,t,r){this._progressObserver={next:e,error:t,complete:r}}catch(e){return this._taskCompletionResolver.promise.catch(e)}then(e,t){return this._taskCompletionResolver.promise.then(e,t)}_completeWith(e){this._updateProgress(e),this._progressObserver.complete&&this._progressObserver.complete(),this._taskCompletionResolver.resolve(e)}_failWith(e){this._lastProgress.taskState="Error",this._progressObserver.next&&this._progressObserver.next(this._lastProgress),this._progressObserver.error&&this._progressObserver.error(e),this._taskCompletionResolver.reject(e)}_updateProgress(e){this._lastProgress=e,this._progressObserver.next&&this._progressObserver.next(e)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const h7=-1;class gt extends Xd{constructor(e,t,r,s){super(e,t,r,s),this.type="firestore",this._queue=new LS,this._persistenceKey=(s==null?void 0:s.name)||"[DEFAULT]"}async _terminate(){if(this._firestoreClient){const e=this._firestoreClient.terminate();this._queue=new LS(e),this._firestoreClient=void 0,await e}}}function f7(n,e,t){t||(t=dd);const r=bs(n,"firestore");if(r.isInitialized(t)){const s=r.getImmediate({identifier:t}),i=r.getOptions(t);if(Ir(i,e))return s;throw new z(V.FAILED_PRECONDITION,"initializeFirestore() has already been called with different options. To avoid this error, call initializeFirestore() with the same options as when it was originally called, or call getFirestore() to return the already initialized instance.")}if(e.cacheSizeBytes!==void 0&&e.localCache!==void 0)throw new z(V.INVALID_ARGUMENT,"cache and cacheSizeBytes cannot be specified at the same time as cacheSizeBytes willbe deprecated. Instead, specify the cache size in the cache object");if(e.cacheSizeBytes!==void 0&&e.cacheSizeBytes!==-1&&e.cacheSizeBytes<iP)throw new z(V.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");return e.host&&ti(e.host)&&om(e.host),r.initialize({options:e,instanceIdentifier:t})}function K5(n,e){const t=typeof n=="object"?n:kd(),r=typeof n=="string"?n:e||dd,s=bs(t,"firestore").getImmediate({identifier:r});if(!s._initialized){const i=zA("firestore");i&&G5(s,...i)}return s}function jt(n){if(n._terminated)throw new z(V.FAILED_PRECONDITION,"The client has already been terminated.");return n._firestoreClient||YP(n),n._firestoreClient}function YP(n){var r,s,i;const e=n._freezeSettings(),t=function(a,l,u,h){return new _3(a,l,u,h.host,h.ssl,h.experimentalForceLongPolling,h.experimentalAutoDetectLongPolling,HP(h.experimentalLongPollingOptions),h.useFetchStreams,h.isUsingEmulator)}(n._databaseId,((r=n._app)==null?void 0:r.options.appId)||"",n._persistenceKey,e);n._componentsProvider||(s=e.localCache)!=null&&s._offlineComponentProvider&&((i=e.localCache)!=null&&i._onlineComponentProvider)&&(n._componentsProvider={_offline:e.localCache._offlineComponentProvider,_online:e.localCache._onlineComponentProvider}),n._firestoreClient=new O5(n._authCredentials,n._appCheckCredentials,n._queue,t,n._componentsProvider&&function(a){const l=a==null?void 0:a._online.build();return{_offline:a==null?void 0:a._offline.build(l),_online:l}}(n._componentsProvider))}function p7(n,e){Vr("enableIndexedDbPersistence() will be deprecated in the future, you can use `FirestoreSettings.cache` instead.");const t=n._freezeSettings();return JP(n,io.provider,{build:r=>new Jw(r,t.cacheSizeBytes,e==null?void 0:e.forceOwnership)}),Promise.resolve()}async function m7(n){Vr("enableMultiTabIndexedDbPersistence() will be deprecated in the future, you can use `FirestoreSettings.cache` instead.");const e=n._freezeSettings();JP(n,io.provider,{build:t=>new UP(t,e.cacheSizeBytes)})}function JP(n,e,t){if((n=je(n,gt))._firestoreClient||n._terminated)throw new z(V.FAILED_PRECONDITION,"Firestore has already been started and persistence can no longer be enabled. You can only enable persistence before calling any other methods on a Firestore object.");if(n._componentsProvider||n._getSettings().localCache)throw new z(V.FAILED_PRECONDITION,"SDK cache is already specified.");n._componentsProvider={_online:e,_offline:t},YP(n)}function g7(n){if(n._initialized&&!n._terminated)throw new z(V.FAILED_PRECONDITION,"Persistence can only be cleared before a Firestore instance is initialized or after it is terminated.");const e=new fn;return n._queue.enqueueAndForgetEvenWhileRestricted(async()=>{try{await async function(r){if(!vs.v())return Promise.resolve();const s=r+dP;await vs.delete(s)}(Pw(n._databaseId,n._persistenceKey)),e.resolve()}catch(t){e.reject(t)}}),e.promise}function y7(n){return function(t){const r=new fn;return t.asyncQueue.enqueueAndForget(async()=>_5(await Zw(t),r)),r.promise}(jt(n=je(n,gt)))}function _7(n){return M5(jt(n=je(n,gt)))}function v7(n){return L5(jt(n=je(n,gt)))}function w7(n){return KL(n.app,"firestore",n._databaseId.database),n._delete()}function FS(n,e){const t=jt(n=je(n,gt)),r=new H5;return B5(t,n._databaseId,e,r),r}function Q5(n,e){return $5(jt(n=je(n,gt)),e).then(t=>t?new gn(n,null,t.query):null)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class yd{constructor(e="count",t){this._internalFieldPath=t,this.type="AggregateField",this.aggregateType=e}}class Y5{constructor(e,t,r){this._userDataWriter=t,this._data=r,this.type="AggregateQuerySnapshot",this.query=e}data(){return this._userDataWriter.convertObjectMap(this._data)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class pr{constructor(e){this._byteString=e}static fromBase64String(e){try{return new pr($t.fromBase64String(e))}catch(t){throw new z(V.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+t)}}static fromUint8Array(e){return new pr($t.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}toJSON(){return{type:pr._jsonSchemaVersion,bytes:this.toBase64()}}static fromJSON(e){if(xa(e,pr._jsonSchema))return pr.fromBase64String(e.bytes)}}pr._jsonSchemaVersion="firestore/bytes/1.0",pr._jsonSchema={type:Jt("string",pr._jsonSchemaVersion),bytes:Jt("string")};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Sa{constructor(...e){for(let t=0;t<e.length;++t)if(e[t].length===0)throw new z(V.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new Dt(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}}function I7(){return new Sa(Q_)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ba{constructor(e){this._methodName=e}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Es{constructor(e,t){if(!isFinite(e)||e<-90||e>90)throw new z(V.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(t)||t<-180||t>180)throw new z(V.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+t);this._lat=e,this._long=t}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}_compareTo(e){return ve(this._lat,e._lat)||ve(this._long,e._long)}toJSON(){return{latitude:this._lat,longitude:this._long,type:Es._jsonSchemaVersion}}static fromJSON(e){if(xa(e,Es._jsonSchema))return new Es(e.latitude,e.longitude)}}Es._jsonSchemaVersion="firestore/geoPoint/1.0",Es._jsonSchema={type:Jt("string",Es._jsonSchemaVersion),latitude:Jt("number"),longitude:Jt("number")};/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Xr{constructor(e){this._values=(e||[]).map(t=>t)}toArray(){return this._values.map(e=>e)}isEqual(e){return function(r,s){if(r.length!==s.length)return!1;for(let i=0;i<r.length;++i)if(r[i]!==s[i])return!1;return!0}(this._values,e._values)}toJSON(){return{type:Xr._jsonSchemaVersion,vectorValues:this._values}}static fromJSON(e){if(xa(e,Xr._jsonSchema)){if(Array.isArray(e.vectorValues)&&e.vectorValues.every(t=>typeof t=="number"))return new Xr(e.vectorValues);throw new z(V.INVALID_ARGUMENT,"Expected 'vectorValues' field to be a number array")}}}Xr._jsonSchemaVersion="firestore/vectorValue/1.0",Xr._jsonSchema={type:Jt("string",Xr._jsonSchemaVersion),vectorValues:Jt("object")};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const J5=/^__.*__$/;class X5{constructor(e,t,r){this.data=e,this.fieldMask=t,this.fieldTransforms=r}toMutation(e,t){return this.fieldMask!==null?new si(e,this.data,this.fieldMask,t,this.fieldTransforms):new uc(e,this.data,t,this.fieldTransforms)}}class XP{constructor(e,t,r){this.data=e,this.fieldMask=t,this.fieldTransforms=r}toMutation(e,t){return new si(e,this.data,this.fieldMask,t,this.fieldTransforms)}}function ZP(n){switch(n){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw se(40011,{Ac:n})}}class Hm{constructor(e,t,r,s,i,o){this.settings=e,this.databaseId=t,this.serializer=r,this.ignoreUndefinedProperties=s,i===void 0&&this.Rc(),this.fieldTransforms=i||[],this.fieldMask=o||[]}get path(){return this.settings.path}get Ac(){return this.settings.Ac}Vc(e){return new Hm({...this.settings,...e},this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}mc(e){var s;const t=(s=this.path)==null?void 0:s.child(e),r=this.Vc({path:t,fc:!1});return r.gc(e),r}yc(e){var s;const t=(s=this.path)==null?void 0:s.child(e),r=this.Vc({path:t,fc:!1});return r.Rc(),r}wc(e){return this.Vc({path:void 0,fc:!0})}Sc(e){return Mp(e,this.settings.methodName,this.settings.bc||!1,this.path,this.settings.Dc)}contains(e){return this.fieldMask.find(t=>e.isPrefixOf(t))!==void 0||this.fieldTransforms.find(t=>e.isPrefixOf(t.field))!==void 0}Rc(){if(this.path)for(let e=0;e<this.path.length;e++)this.gc(this.path.get(e))}gc(e){if(e.length===0)throw this.Sc("Document fields must not be empty");if(ZP(this.Ac)&&J5.test(e))throw this.Sc('Document fields cannot begin and end with "__"')}}class Z5{constructor(e,t,r){this.databaseId=e,this.ignoreUndefinedProperties=t,this.serializer=r||Ta(e)}Cc(e,t,r,s=!1){return new Hm({Ac:e,methodName:t,Dc:r,path:Dt.emptyPath(),fc:!1,bc:s},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}}function Aa(n){const e=n._freezeSettings(),t=Ta(n._databaseId);return new Z5(n._databaseId,!!e.ignoreUndefinedProperties,t)}function Km(n,e,t,r,s,i={}){const o=n.Cc(i.merge||i.mergeFields?2:0,e,t,s);oI("Data must be an object, but it was:",o,r);const a=nk(r,o);let l,u;if(i.merge)l=new Jn(o.fieldMask),u=o.fieldTransforms;else if(i.mergeFields){const h=[];for(const f of i.mergeFields){const p=_d(e,f,t);if(!o.contains(p))throw new z(V.INVALID_ARGUMENT,`Field '${p}' is specified in your field mask but missing from your input data.`);sk(h,p)||h.push(p)}l=new Jn(h),u=o.fieldTransforms.filter(f=>l.covers(f.field))}else l=null,u=o.fieldTransforms;return new X5(new En(a),l,u)}class Zd extends ba{_toFieldTransform(e){if(e.Ac!==2)throw e.Ac===1?e.Sc(`${this._methodName}() can only appear at the top level of your update data`):e.Sc(`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return e.fieldMask.push(e.path),null}isEqual(e){return e instanceof Zd}}function ek(n,e,t){return new Hm({Ac:3,Dc:e.settings.Dc,methodName:n._methodName,fc:t},e.databaseId,e.serializer,e.ignoreUndefinedProperties)}class eI extends ba{_toFieldTransform(e){return new Kd(e.path,new Wl)}isEqual(e){return e instanceof eI}}class tI extends ba{constructor(e,t){super(e),this.vc=t}_toFieldTransform(e){const t=ek(this,e,!0),r=this.vc.map(i=>Ca(i,t)),s=new oa(r);return new Kd(e.path,s)}isEqual(e){return e instanceof tI&&Ir(this.vc,e.vc)}}class nI extends ba{constructor(e,t){super(e),this.vc=t}_toFieldTransform(e){const t=ek(this,e,!0),r=this.vc.map(i=>Ca(i,t)),s=new aa(r);return new Kd(e.path,s)}isEqual(e){return e instanceof nI&&Ir(this.vc,e.vc)}}class rI extends ba{constructor(e,t){super(e),this.Fc=t}_toFieldTransform(e){const t=new Gl(e.serializer,AN(e.serializer,this.Fc));return new Kd(e.path,t)}isEqual(e){return e instanceof rI&&this.Fc===e.Fc}}function sI(n,e,t,r){const s=n.Cc(1,e,t);oI("Data must be an object, but it was:",s,r);const i=[],o=En.empty();po(r,(l,u)=>{const h=Qm(e,l,t);u=ne(u);const f=s.yc(h);if(u instanceof Zd)i.push(h);else{const p=Ca(u,f);p!=null&&(i.push(h),o.set(h,p))}});const a=new Jn(i);return new XP(o,a,s.fieldTransforms)}function iI(n,e,t,r,s,i){const o=n.Cc(1,e,t),a=[_d(e,r,t)],l=[s];if(i.length%2!=0)throw new z(V.INVALID_ARGUMENT,`Function ${e}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let p=0;p<i.length;p+=2)a.push(_d(e,i[p])),l.push(i[p+1]);const u=[],h=En.empty();for(let p=a.length-1;p>=0;--p)if(!sk(u,a[p])){const y=a[p];let I=l[p];I=ne(I);const C=o.yc(y);if(I instanceof Zd)u.push(y);else{const P=Ca(I,C);P!=null&&(u.push(y),h.set(y,P))}}const f=new Jn(u);return new XP(h,f,o.fieldTransforms)}function tk(n,e,t,r=!1){return Ca(t,n.Cc(r?4:3,e))}function Ca(n,e){if(rk(n=ne(n)))return oI("Unsupported field value:",e,n),nk(n,e);if(n instanceof ba)return function(r,s){if(!ZP(s.Ac))throw s.Sc(`${r._methodName}() can only be used with update() and set()`);if(!s.path)throw s.Sc(`${r._methodName}() is not currently supported inside arrays`);const i=r._toFieldTransform(s);i&&s.fieldTransforms.push(i)}(n,e),null;if(n===void 0&&e.ignoreUndefinedProperties)return null;if(e.path&&e.fieldMask.push(e.path),n instanceof Array){if(e.settings.fc&&e.Ac!==4)throw e.Sc("Nested arrays are not supported");return function(r,s){const i=[];let o=0;for(const a of r){let l=Ca(a,s.wc(o));l==null&&(l={nullValue:"NULL_VALUE"}),i.push(l),o++}return{arrayValue:{values:i}}}(n,e)}return function(r,s){if((r=ne(r))===null)return{nullValue:"NULL_VALUE"};if(typeof r=="number")return AN(s.serializer,r);if(typeof r=="boolean")return{booleanValue:r};if(typeof r=="string")return{stringValue:r};if(r instanceof Date){const i=rt.fromDate(r);return{timestampValue:Hl(s.serializer,i)}}if(r instanceof rt){const i=new rt(r.seconds,1e3*Math.floor(r.nanoseconds/1e3));return{timestampValue:Hl(s.serializer,i)}}if(r instanceof Es)return{geoPointValue:{latitude:r.latitude,longitude:r.longitude}};if(r instanceof pr)return{bytesValue:UN(s.serializer,r._byteString)};if(r instanceof ut){const i=s.databaseId,o=r.firestore._databaseId;if(!o.isEqual(i))throw s.Sc(`Document reference is for database ${o.projectId}/${o.database} but should be for database ${i.projectId}/${i.database}`);return{referenceValue:Sw(r.firestore._databaseId||s.databaseId,r._key.path)}}if(r instanceof Xr)return function(o,a){return{mapValue:{fields:{[pw]:{stringValue:mw},[$l]:{arrayValue:{values:o.toArray().map(u=>{if(typeof u!="number")throw a.Sc("VectorValues must only contain numeric values.");return vw(a.serializer,u)})}}}}}}(r,s);throw s.Sc(`Unsupported field value: ${Am(r)}`)}(n,e)}function nk(n,e){const t={};return eN(n)?e.path&&e.path.length>0&&e.fieldMask.push(e.path):po(n,(r,s)=>{const i=Ca(s,e.mc(r));i!=null&&(t[r]=i)}),{mapValue:{fields:t}}}function rk(n){return!(typeof n!="object"||n===null||n instanceof Array||n instanceof Date||n instanceof rt||n instanceof Es||n instanceof pr||n instanceof ut||n instanceof ba||n instanceof Xr)}function oI(n,e,t){if(!rk(t)||!MR(t)){const r=Am(t);throw r==="an object"?e.Sc(n+" a custom object"):e.Sc(n+" "+r)}}function _d(n,e,t){if((e=ne(e))instanceof Sa)return e._internalPath;if(typeof e=="string")return Qm(n,e);throw Mp("Field path arguments must be of type string or ",n,!1,void 0,t)}const eU=new RegExp("[~\\*/\\[\\]]");function Qm(n,e,t){if(e.search(eU)>=0)throw Mp(`Invalid field path (${e}). Paths must not contain '~', '*', '/', '[', or ']'`,n,!1,void 0,t);try{return new Sa(...e.split("."))._internalPath}catch{throw Mp(`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,n,!1,void 0,t)}}function Mp(n,e,t,r,s){const i=r&&!r.isEmpty(),o=s!==void 0;let a=`Function ${e}() called with invalid data`;t&&(a+=" (via `toFirestore()`)"),a+=". ";let l="";return(i||o)&&(l+=" (found",i&&(l+=` in field ${r}`),o&&(l+=` in document ${s}`),l+=")"),new z(V.INVALID_ARGUMENT,a+n+l)}function sk(n,e){return n.some(t=>t.isEqual(e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class vd{constructor(e,t,r,s,i){this._firestore=e,this._userDataWriter=t,this._key=r,this._document=s,this._converter=i}get id(){return this._key.path.lastSegment()}get ref(){return new ut(this._firestore,this._converter,this._key)}exists(){return this._document!==null}data(){if(this._document){if(this._converter){const e=new tU(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}get(e){if(this._document){const t=this._document.data.field(Ym("DocumentSnapshot.get",e));if(t!==null)return this._userDataWriter.convertValue(t)}}}class tU extends vd{data(){return super.data()}}function Ym(n,e){return typeof e=="string"?Qm(n,e):e instanceof Sa?e._internalPath:e._delegate._internalPath}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ik(n){if(n.limitType==="L"&&n.explicitOrderBy.length===0)throw new z(V.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}class aI{}class eh extends aI{}function E7(n,e,...t){let r=[];e instanceof aI&&r.push(e),r=r.concat(t),function(i){const o=i.filter(l=>l instanceof yc).length,a=i.filter(l=>l instanceof th).length;if(o>1||o>0&&a>0)throw new z(V.INVALID_ARGUMENT,"InvalidQuery. When using composite filters, you cannot use more than one filter at the top level. Consider nesting the multiple filters within an `and(...)` statement. For example: change `query(query, where(...), or(...))` to `query(query, and(where(...), or(...)))`.")}(r);for(const s of r)n=s._apply(n);return n}class th extends eh{constructor(e,t,r){super(),this._field=e,this._op=t,this._value=r,this.type="where"}static _create(e,t,r){return new th(e,t,r)}_apply(e){const t=this._parse(e);return ak(e._query,t),new gn(e.firestore,e.converter,ov(e._query,t))}_parse(e){const t=Aa(e.firestore);return function(i,o,a,l,u,h,f){let p;if(u.isKeyField()){if(h==="array-contains"||h==="array-contains-any")throw new z(V.INVALID_ARGUMENT,`Invalid Query. You can't perform '${h}' queries on documentId().`);if(h==="in"||h==="not-in"){US(f,h);const I=[];for(const C of f)I.push(jS(l,i,C));p={arrayValue:{values:I}}}else p=jS(l,i,f)}else h!=="in"&&h!=="not-in"&&h!=="array-contains-any"||US(f,h),p=tk(a,o,f,h==="in"||h==="not-in");return qe.create(u,h,p)}(e._query,"where",t,e.firestore._databaseId,this._field,this._op,this._value)}}function x7(n,e,t){const r=e,s=Ym("where",n);return th._create(s,r,t)}class yc extends aI{constructor(e,t){super(),this.type=e,this._queryConstraints=t}static _create(e,t){return new yc(e,t)}_parse(e){const t=this._queryConstraints.map(r=>r._parse(e)).filter(r=>r.getFilters().length>0);return t.length===1?t[0]:st.create(t,this._getOperator())}_apply(e){const t=this._parse(e);return t.getFilters().length===0?e:(function(s,i){let o=s;const a=i.getFlattenedFilters();for(const l of a)ak(o,l),o=ov(o,l)}(e._query,t),new gn(e.firestore,e.converter,ov(e._query,t)))}_getQueryConstraints(){return this._queryConstraints}_getOperator(){return this.type==="and"?"and":"or"}}function T7(...n){return n.forEach(e=>lk("or",e)),yc._create("or",n)}function S7(...n){return n.forEach(e=>lk("and",e)),yc._create("and",n)}class lI extends eh{constructor(e,t){super(),this._field=e,this._direction=t,this.type="orderBy"}static _create(e,t){return new lI(e,t)}_apply(e){const t=function(s,i,o){if(s.startAt!==null)throw new z(V.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(s.endAt!==null)throw new z(V.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");return new pd(i,o)}(e._query,this._field,this._direction);return new gn(e.firestore,e.converter,function(s,i){const o=s.explicitOrderBy.concat([i]);return new ni(s.path,s.collectionGroup,o,s.filters.slice(),s.limit,s.limitType,s.startAt,s.endAt)}(e._query,t))}}function b7(n,e="asc"){const t=e,r=Ym("orderBy",n);return lI._create(r,t)}class Jm extends eh{constructor(e,t,r){super(),this.type=e,this._limit=t,this._limitType=r}static _create(e,t,r){return new Jm(e,t,r)}_apply(e){return new gn(e.firestore,e.converter,bp(e._query,this._limit,this._limitType))}}function A7(n){return LR("limit",n),Jm._create("limit",n,"F")}function C7(n){return LR("limitToLast",n),Jm._create("limitToLast",n,"L")}class Xm extends eh{constructor(e,t,r){super(),this.type=e,this._docOrFields=t,this._inclusive=r}static _create(e,t,r){return new Xm(e,t,r)}_apply(e){const t=ok(e,this.type,this._docOrFields,this._inclusive);return new gn(e.firestore,e.converter,function(s,i){return new ni(s.path,s.collectionGroup,s.explicitOrderBy.slice(),s.filters.slice(),s.limit,s.limitType,i,s.endAt)}(e._query,t))}}function R7(...n){return Xm._create("startAt",n,!0)}function N7(...n){return Xm._create("startAfter",n,!1)}class Zm extends eh{constructor(e,t,r){super(),this.type=e,this._docOrFields=t,this._inclusive=r}static _create(e,t,r){return new Zm(e,t,r)}_apply(e){const t=ok(e,this.type,this._docOrFields,this._inclusive);return new gn(e.firestore,e.converter,function(s,i){return new ni(s.path,s.collectionGroup,s.explicitOrderBy.slice(),s.filters.slice(),s.limit,s.limitType,s.startAt,i)}(e._query,t))}}function P7(...n){return Zm._create("endBefore",n,!1)}function k7(...n){return Zm._create("endAt",n,!0)}function ok(n,e,t,r){if(t[0]=ne(t[0]),t[0]instanceof vd)return function(i,o,a,l,u){if(!l)throw new z(V.NOT_FOUND,`Can't use a DocumentSnapshot that doesn't exist for ${a}().`);const h=[];for(const f of pl(i))if(f.field.isKeyField())h.push(sa(o,l.key));else{const p=l.data.field(f.field);if(km(p))throw new z(V.INVALID_ARGUMENT,'Invalid query. You are trying to start or end a query using a document for which the field "'+f.field+'" is an uncommitted server timestamp. (Since the value of this field is unknown, you cannot start/end a query with it.)');if(p===null){const y=f.field.canonicalString();throw new z(V.INVALID_ARGUMENT,`Invalid query. You are trying to start or end a query using a document for which the field '${y}' (used as the orderBy) does not exist.`)}h.push(p)}return new ro(h,u)}(n._query,n.firestore._databaseId,e,t[0]._document,r);{const s=Aa(n.firestore);return function(o,a,l,u,h,f){const p=o.explicitOrderBy;if(h.length>p.length)throw new z(V.INVALID_ARGUMENT,`Too many arguments provided to ${u}(). The number of arguments must be less than or equal to the number of orderBy() clauses`);const y=[];for(let I=0;I<h.length;I++){const C=h[I];if(p[I].field.isKeyField()){if(typeof C!="string")throw new z(V.INVALID_ARGUMENT,`Invalid query. Expected a string for document ID in ${u}(), but got a ${typeof C}`);if(!yw(o)&&C.indexOf("/")!==-1)throw new z(V.INVALID_ARGUMENT,`Invalid query. When querying a collection and ordering by documentId(), the value passed to ${u}() must be a plain document ID, but '${C}' contains a slash.`);const P=o.path.child(Ve.fromString(C));if(!X.isDocumentKey(P))throw new z(V.INVALID_ARGUMENT,`Invalid query. When querying a collection group and ordering by documentId(), the value passed to ${u}() must result in a valid document path, but '${P}' is not because it contains an odd number of segments.`);const A=new X(P);y.push(sa(a,A))}else{const P=tk(l,u,C);y.push(P)}}return new ro(y,f)}(n._query,n.firestore._databaseId,s,e,t,r)}}function jS(n,e,t){if(typeof(t=ne(t))=="string"){if(t==="")throw new z(V.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!yw(e)&&t.indexOf("/")!==-1)throw new z(V.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${t}' contains a '/' character.`);const r=e.path.child(Ve.fromString(t));if(!X.isDocumentKey(r))throw new z(V.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${r}' is not because it has an odd number of segments (${r.length}).`);return sa(n,new X(r))}if(t instanceof ut)return sa(n,t._key);throw new z(V.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${Am(t)}.`)}function US(n,e){if(!Array.isArray(n)||n.length===0)throw new z(V.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${e.toString()}' filters.`)}function ak(n,e){const t=function(s,i){for(const o of s)for(const a of o.getFlattenedFilters())if(i.indexOf(a.op)>=0)return a.op;return null}(n.filters,function(s){switch(s){case"!=":return["!=","not-in"];case"array-contains-any":case"in":return["not-in"];case"not-in":return["array-contains-any","in","not-in","!="];default:return[]}}(e.op));if(t!==null)throw t===e.op?new z(V.INVALID_ARGUMENT,`Invalid query. You cannot use more than one '${e.op.toString()}' filter.`):new z(V.INVALID_ARGUMENT,`Invalid query. You cannot use '${e.op.toString()}' filters with '${t.toString()}' filters.`)}function lk(n,e){if(!(e instanceof th||e instanceof yc))throw new z(V.INVALID_ARGUMENT,`Function ${n}() requires AppliableConstraints created with a call to 'where(...)', 'or(...)', or 'and(...)'.`)}class ck{convertValue(e,t="none"){switch(to(e)){case 0:return null;case 1:return e.booleanValue;case 2:return Rt(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,t);case 5:return e.stringValue;case 6:return this.convertBytes(Ys(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,t);case 11:return this.convertObject(e.mapValue,t);case 10:return this.convertVectorValue(e.mapValue);default:throw se(62114,{value:e})}}convertObject(e,t){return this.convertObjectMap(e.fields,t)}convertObjectMap(e,t="none"){const r={};return po(e,(s,i)=>{r[s]=this.convertValue(i,t)}),r}convertVectorValue(e){var r,s,i;const t=(i=(s=(r=e.fields)==null?void 0:r[$l].arrayValue)==null?void 0:s.values)==null?void 0:i.map(o=>Rt(o.doubleValue));return new Xr(t)}convertGeoPoint(e){return new Es(Rt(e.latitude),Rt(e.longitude))}convertArray(e,t){return(e.values||[]).map(r=>this.convertValue(r,t))}convertServerTimestamp(e,t){switch(t){case"previous":const r=Dm(e);return r==null?null:this.convertValue(r,t);case"estimate":return this.convertTimestamp(ud(e));default:return null}}convertTimestamp(e){const t=Qs(e);return new rt(t.seconds,t.nanos)}convertDocumentKey(e,t){const r=Ve.fromString(e);ae(YN(r),9688,{name:e});const s=new ra(r.get(1),r.get(3)),i=new X(r.popFirst(5));return s.isEqual(t)||Gt(`Document ${i} contains a document reference within a different database (${s.projectId}/${s.database}) which is not supported. It will be treated as a reference in the current database (${t.projectId}/${t.database}) instead.`),i}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function eg(n,e,t){let r;return r=n?t&&(t.merge||t.mergeFields)?n.toFirestore(e,t):n.toFirestore(e):e,r}class cI extends ck{constructor(e){super(),this.firestore=e}convertBytes(e){return new pr(e)}convertReference(e){const t=this.convertDocumentKey(e,this.firestore._databaseId);return new ut(this.firestore,null,t)}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function D7(n){return new yd("sum",_d("sum",n))}function O7(n){return new yd("avg",_d("average",n))}function nU(){return new yd("count")}function M7(n,e){var t,r;return n instanceof yd&&e instanceof yd&&n.aggregateType===e.aggregateType&&((t=n._internalFieldPath)==null?void 0:t.canonicalString())===((r=e._internalFieldPath)==null?void 0:r.canonicalString())}function L7(n,e){return QP(n.query,e.query)&&Ir(n.data(),e.data())}/**
 * @license
 * Copyright 2025 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const uk="NOT SUPPORTED";class Ri{constructor(e,t){this.hasPendingWrites=e,this.fromCache=t}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}}class yr extends vd{constructor(e,t,r,s,i,o){super(e,t,r,s,o),this._firestore=e,this._firestoreImpl=e,this.metadata=i}exists(){return super.exists()}data(e={}){if(this._document){if(this._converter){const t=new Af(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(t,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}get(e,t={}){if(this._document){const r=this._document.data.field(Ym("DocumentSnapshot.get",e));if(r!==null)return this._userDataWriter.convertValue(r,t.serverTimestamps)}}toJSON(){if(this.metadata.hasPendingWrites)throw new z(V.FAILED_PRECONDITION,"DocumentSnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");const e=this._document,t={};return t.type=yr._jsonSchemaVersion,t.bundle="",t.bundleSource="DocumentSnapshot",t.bundleName=this._key.toString(),!e||!e.isValidDocument()||!e.isFoundDocument()?t:(this._userDataWriter.convertObjectMap(e.data.value.mapValue.fields,"previous"),t.bundle=(this._firestore,this.ref.path,"NOT SUPPORTED"),t)}}function V7(n,e,t){if(xa(e,yr._jsonSchema)){if(e.bundle===uk)throw new z(V.INVALID_ARGUMENT,"The provided JSON object was created in a client environment, which is not supported.");const r=Ta(n._databaseId),s=GP(e.bundle,r),i=s.Wu(),o=new qw(s.getMetadata(),r);for(const h of i)o.Ga(h);const a=o.documents;if(a.length!==1)throw new z(V.INVALID_ARGUMENT,`Expected bundle data to contain 1 document, but it contains ${a.length} documents.`);const l=Vm(r,a[0].document),u=new X(Ve.fromString(e.bundleName));return new yr(n,new cI(n),u,l,new Ri(!1,!1),t||null)}}yr._jsonSchemaVersion="firestore/documentSnapshot/1.0",yr._jsonSchema={type:Jt("string",yr._jsonSchemaVersion),bundleSource:Jt("string","DocumentSnapshot"),bundleName:Jt("string"),bundle:Jt("string")};class Af extends yr{data(e={}){return super.data(e)}}class _r{constructor(e,t,r,s){this._firestore=e,this._userDataWriter=t,this._snapshot=s,this.metadata=new Ri(s.hasPendingWrites,s.fromCache),this.query=r}get docs(){const e=[];return this.forEach(t=>e.push(t)),e}get size(){return this._snapshot.docs.size}get empty(){return this.size===0}forEach(e,t){this._snapshot.docs.forEach(r=>{e.call(t,new Af(this._firestore,this._userDataWriter,r.key,r,new Ri(this._snapshot.mutatedKeys.has(r.key),this._snapshot.fromCache),this.query.converter))})}docChanges(e={}){const t=!!e.includeMetadataChanges;if(t&&this._snapshot.excludesMetadataChanges)throw new z(V.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===t||(this._cachedChanges=function(s,i){if(s._snapshot.oldDocs.isEmpty()){let o=0;return s._snapshot.docChanges.map(a=>{const l=new Af(s._firestore,s._userDataWriter,a.doc.key,a.doc,new Ri(s._snapshot.mutatedKeys.has(a.doc.key),s._snapshot.fromCache),s.query.converter);return a.doc,{type:"added",doc:l,oldIndex:-1,newIndex:o++}})}{let o=s._snapshot.oldDocs;return s._snapshot.docChanges.filter(a=>i||a.type!==3).map(a=>{const l=new Af(s._firestore,s._userDataWriter,a.doc.key,a.doc,new Ri(s._snapshot.mutatedKeys.has(a.doc.key),s._snapshot.fromCache),s.query.converter);let u=-1,h=-1;return a.type!==0&&(u=o.indexOf(a.doc.key),o=o.delete(a.doc.key)),a.type!==1&&(o=o.add(a.doc),h=o.indexOf(a.doc.key)),{type:rU(a.type),doc:l,oldIndex:u,newIndex:h}})}}(this,t),this._cachedChangesIncludeMetadataChanges=t),this._cachedChanges}toJSON(){if(this.metadata.hasPendingWrites)throw new z(V.FAILED_PRECONDITION,"QuerySnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");const e={};e.type=_r._jsonSchemaVersion,e.bundleSource="QuerySnapshot",e.bundleName=ow.newId(),this._firestore._databaseId.database,this._firestore._databaseId.projectId;const t=[],r=[],s=[];return this.docs.forEach(i=>{i._document!==null&&(t.push(i._document),r.push(this._userDataWriter.convertObjectMap(i._document.data.value.mapValue.fields,"previous")),s.push(i.ref.path))}),e.bundle=(this._firestore,this.query._query,e.bundleName,"NOT SUPPORTED"),e}}function F7(n,e,t){if(xa(e,_r._jsonSchema)){if(e.bundle===uk)throw new z(V.INVALID_ARGUMENT,"The provided JSON object was created in a client environment, which is not supported.");const r=Ta(n._databaseId),s=GP(e.bundle,r),i=s.Wu(),o=new qw(s.getMetadata(),r);for(const p of i)o.Ga(p);if(o.queries.length!==1)throw new z(V.INVALID_ARGUMENT,`Snapshot data expected 1 query but found ${o.queries.length} queries.`);const a=jm(o.queries[0].bundledQuery),l=o.documents;let u=new Wo;l.map(p=>{const y=Vm(r,p.document);u=u.add(y)});const h=ha.fromInitialDocuments(a,u,be(),!1,!1),f=new gn(n,t||null,a);return new _r(n,new cI(n),f,h)}}function rU(n){switch(n){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return se(61501,{type:n})}}function j7(n,e){return n instanceof yr&&e instanceof yr?n._firestore===e._firestore&&n._key.isEqual(e._key)&&(n._document===null?e._document===null:n._document.isEqual(e._document))&&n._converter===e._converter:n instanceof _r&&e instanceof _r&&n._firestore===e._firestore&&QP(n.query,e.query)&&n.metadata.isEqual(e.metadata)&&n._snapshot.isEqual(e._snapshot)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function sU(n){n=je(n,ut);const e=je(n.firestore,gt);return qP(jt(e),n._key).then(t=>uI(e,n,t))}_r._jsonSchemaVersion="firestore/querySnapshot/1.0",_r._jsonSchema={type:Jt("string",_r._jsonSchemaVersion),bundleSource:Jt("string","QuerySnapshot"),bundleName:Jt("string"),bundle:Jt("string")};class yo extends ck{constructor(e){super(),this.firestore=e}convertBytes(e){return new pr(e)}convertReference(e){const t=this.convertDocumentKey(e,this.firestore._databaseId);return new ut(this.firestore,null,t)}}function U7(n){n=je(n,ut);const e=je(n.firestore,gt),t=jt(e),r=new yo(e);return V5(t,n._key).then(s=>new yr(e,r,n._key,s,new Ri(s!==null&&s.hasLocalMutations,!0),n.converter))}function B7(n){n=je(n,ut);const e=je(n.firestore,gt);return qP(jt(e),n._key,{source:"server"}).then(t=>uI(e,n,t))}function iU(n){n=je(n,gn);const e=je(n.firestore,gt),t=jt(e),r=new yo(e);return ik(n._query),WP(t,n._query).then(s=>new _r(e,r,n,s))}function $7(n){n=je(n,gn);const e=je(n.firestore,gt),t=jt(e),r=new yo(e);return F5(t,n._query).then(s=>new _r(e,r,n,s))}function z7(n){n=je(n,gn);const e=je(n.firestore,gt),t=jt(e),r=new yo(e);return WP(t,n._query,{source:"server"}).then(s=>new _r(e,r,n,s))}function BS(n,e,t){n=je(n,ut);const r=je(n.firestore,gt),s=eg(n.converter,e,t);return nh(r,[Km(Aa(r),"setDoc",n._key,s,n.converter!==null,t).toMutation(n._key,Ot.none())])}function q7(n,e,t,...r){n=je(n,ut);const s=je(n.firestore,gt),i=Aa(s);let o;return o=typeof(e=ne(e))=="string"||e instanceof Sa?iI(i,"updateDoc",n._key,e,t,r):sI(i,"updateDoc",n._key,e),nh(s,[o.toMutation(n._key,Ot.exists(!0))])}function $S(n){return nh(je(n.firestore,gt),[new dc(n._key,Ot.none())])}function oU(n,e){const t=je(n.firestore,gt),r=su(n),s=eg(n.converter,e);return nh(t,[Km(Aa(n.firestore),"addDoc",r._key,s,n.converter!==null,{}).toMutation(r._key,Ot.exists(!1))]).then(()=>r)}function zS(n,...e){var l,u,h;n=ne(n);let t={includeMetadataChanges:!1,source:"default"},r=0;typeof e[r]!="object"||ml(e[r])||(t=e[r++]);const s={includeMetadataChanges:t.includeMetadataChanges,source:t.source};if(ml(e[r])){const f=e[r];e[r]=(l=f.next)==null?void 0:l.bind(f),e[r+1]=(u=f.error)==null?void 0:u.bind(f),e[r+2]=(h=f.complete)==null?void 0:h.bind(f)}let i,o,a;if(n instanceof ut)o=je(n.firestore,gt),a=cc(n._key.path),i={next:f=>{e[r]&&e[r](uI(o,n,f))},error:e[r+1],complete:e[r+2]};else{const f=je(n,gn);o=je(f.firestore,gt),a=f._query;const p=new yo(o);i={next:y=>{e[r]&&e[r](new _r(o,p,f,y))},error:e[r+1],complete:e[r+2]},ik(n._query)}return function(p,y,I,C){const P=new Wm(C),A=new zw(y,P,I);return p.asyncQueue.enqueueAndForget(async()=>Uw(await Zl(p),A)),()=>{P.Nu(),p.asyncQueue.enqueueAndForget(async()=>Bw(await Zl(p),A))}}(jt(o),a,s,i)}function W7(n,e,...t){const r=ne(n),s=function(l){const u={bundle:"",bundleName:"",bundleSource:""},h=["bundle","bundleName","bundleSource"];for(const f of h){if(!(f in l)){u.error=`snapshotJson missing required field: ${f}`;break}const p=l[f];if(typeof p!="string"){u.error=`snapshotJson field '${f}' must be a string.`;break}if(p.length===0){u.error=`snapshotJson field '${f}' cannot be an empty string.`;break}f==="bundle"?u.bundle=p:f==="bundleName"?u.bundleName=p:f==="bundleSource"&&(u.bundleSource=p)}return u}(e);if(s.error)throw new z(V.INVALID_ARGUMENT,s.error);let i,o=0;if(typeof t[o]!="object"||ml(t[o])||(i=t[o++]),s.bundleSource==="QuerySnapshot"){let a=null;if(typeof t[o]=="object"&&ml(t[o])){const l=t[o++];a={next:l.next,error:l.error,complete:l.complete}}else a={next:t[o++],error:t[o++],complete:t[o++]};return function(u,h,f,p,y){let I,C=!1;return FS(u,h.bundle).then(()=>Q5(u,h.bundleName)).then(A=>{A&&!C&&(y&&A.withConverter(y),I=zS(A,f||{},p))}).catch(A=>(p.error&&p.error(A),()=>{})),()=>{C||(C=!0,I&&I())}}(r,s,i,a,t[o])}if(s.bundleSource==="DocumentSnapshot"){let a=null;if(typeof t[o]=="object"&&ml(t[o])){const l=t[o++];a={next:l.next,error:l.error,complete:l.complete}}else a={next:t[o++],error:t[o++],complete:t[o++]};return function(u,h,f,p,y){let I,C=!1;return FS(u,h.bundle).then(()=>{if(!C){const A=new ut(u,y||null,X.fromPath(h.bundleName));I=zS(A,f||{},p)}}).catch(A=>(p.error&&p.error(A),()=>{})),()=>{C||(C=!0,I&&I())}}(r,s,i,a,t[o])}throw new z(V.INVALID_ARGUMENT,`unsupported bundle source: ${s.bundleSource}`)}function G7(n,e){return U5(jt(n=je(n,gt)),ml(e)?e:{next:e})}function nh(n,e){return function(r,s){const i=new fn;return r.asyncQueue.enqueueAndForget(async()=>p5(await Zw(r),s,i)),i.promise}(jt(n),e)}function uI(n,e,t){const r=t.docs.get(e._key),s=new yo(n);return new yr(n,s,e._key,r,new Ri(t.hasPendingWrites,t.fromCache),e.converter)}function H7(n){return aU(n,{count:nU()})}function aU(n,e){const t=je(n.firestore,gt),r=jt(t),s=ZR(e,(i,o)=>new ON(o,i.aggregateType,i._internalFieldPath));return j5(r,n._query,s).then(i=>function(a,l,u){const h=new yo(a);return new Y5(l,h,u)}(t,n,i))}class lU{constructor(e){this.kind="memory",this._onlineComponentProvider=io.provider,this._offlineComponentProvider=e!=null&&e.garbageCollector?e.garbageCollector._offlineComponentProvider:{build:()=>new Yw(void 0)}}toJSON(){return{kind:this.kind}}}class cU{constructor(e){let t;this.kind="persistent",e!=null&&e.tabManager?(e.tabManager._initialize(e),t=e.tabManager):(t=pU(void 0),t._initialize(e)),this._onlineComponentProvider=t._onlineComponentProvider,this._offlineComponentProvider=t._offlineComponentProvider}toJSON(){return{kind:this.kind}}}class uU{constructor(){this.kind="memoryEager",this._offlineComponentProvider=Xl.provider}toJSON(){return{kind:this.kind}}}class dU{constructor(e){this.kind="memoryLru",this._offlineComponentProvider={build:()=>new Yw(e)}}toJSON(){return{kind:this.kind}}}function K7(){return new uU}function Q7(n){return new dU(n==null?void 0:n.cacheSizeBytes)}function Y7(n){return new lU(n)}function J7(n){return new cU(n)}class hU{constructor(e){this.forceOwnership=e,this.kind="persistentSingleTab"}toJSON(){return{kind:this.kind}}_initialize(e){this._onlineComponentProvider=io.provider,this._offlineComponentProvider={build:t=>new Jw(t,e==null?void 0:e.cacheSizeBytes,this.forceOwnership)}}}class fU{constructor(){this.kind="PersistentMultipleTab"}toJSON(){return{kind:this.kind}}_initialize(e){this._onlineComponentProvider=io.provider,this._offlineComponentProvider={build:t=>new UP(t,e==null?void 0:e.cacheSizeBytes)}}}function pU(n){return new hU(n==null?void 0:n.forceOwnership)}function X7(){return new fU}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const mU={maxAttempts:5};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class gU{constructor(e,t){this._firestore=e,this._commitHandler=t,this._mutations=[],this._committed=!1,this._dataReader=Aa(e)}set(e,t,r){this._verifyNotCommitted();const s=Ni(e,this._firestore),i=eg(s.converter,t,r),o=Km(this._dataReader,"WriteBatch.set",s._key,i,s.converter!==null,r);return this._mutations.push(o.toMutation(s._key,Ot.none())),this}update(e,t,r,...s){this._verifyNotCommitted();const i=Ni(e,this._firestore);let o;return o=typeof(t=ne(t))=="string"||t instanceof Sa?iI(this._dataReader,"WriteBatch.update",i._key,t,r,s):sI(this._dataReader,"WriteBatch.update",i._key,t),this._mutations.push(o.toMutation(i._key,Ot.exists(!0))),this}delete(e){this._verifyNotCommitted();const t=Ni(e,this._firestore);return this._mutations=this._mutations.concat(new dc(t._key,Ot.none())),this}commit(){return this._verifyNotCommitted(),this._committed=!0,this._mutations.length>0?this._commitHandler(this._mutations):Promise.resolve()}_verifyNotCommitted(){if(this._committed)throw new z(V.FAILED_PRECONDITION,"A write batch can no longer be used after commit() has been called.")}}function Ni(n,e){if((n=ne(n)).firestore!==e)throw new z(V.INVALID_ARGUMENT,"Provided document reference is from a different Firestore instance.");return n}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class yU{constructor(e,t){this._firestore=e,this._transaction=t,this._dataReader=Aa(e)}get(e){const t=Ni(e,this._firestore),r=new cI(this._firestore);return this._transaction.lookup([t._key]).then(s=>{if(!s||s.length!==1)return se(24041);const i=s[0];if(i.isFoundDocument())return new vd(this._firestore,r,i.key,i,t.converter);if(i.isNoDocument())return new vd(this._firestore,r,t._key,null,t.converter);throw se(18433,{doc:i})})}set(e,t,r){const s=Ni(e,this._firestore),i=eg(s.converter,t,r),o=Km(this._dataReader,"Transaction.set",s._key,i,s.converter!==null,r);return this._transaction.set(s._key,o),this}update(e,t,r,...s){const i=Ni(e,this._firestore);let o;return o=typeof(t=ne(t))=="string"||t instanceof Sa?iI(this._dataReader,"Transaction.update",i._key,t,r,s):sI(this._dataReader,"Transaction.update",i._key,t),this._transaction.update(i._key,o),this}delete(e){const t=Ni(e,this._firestore);return this._transaction.delete(t._key),this}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class _U extends yU{constructor(e,t){super(e,t),this._firestore=e}get(e){const t=Ni(e,this._firestore),r=new yo(this._firestore);return super.get(e).then(s=>new yr(this._firestore,r,t._key,s._document,new Ri(!1,!1),t.converter))}}function Z7(n,e,t){n=je(n,gt);const r={...mU,...t};return function(i){if(i.maxAttempts<1)throw new z(V.INVALID_ARGUMENT,"Max attempts must be at least 1")}(r),function(i,o,a){const l=new fn;return i.asyncQueue.enqueueAndForget(async()=>{const u=await zP(i);new D5(i.asyncQueue,u,a,o,l).ju()}),l.promise}(jt(n),s=>e(new _U(n,s)),r)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function eq(){return new Zd("deleteField")}function Yh(){return new eI("serverTimestamp")}function tq(...n){return new tI("arrayUnion",n)}function nq(...n){return new nI("arrayRemove",n)}function rq(n){return new rI("increment",n)}function sq(n){return new Xr(n)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function iq(n){return jt(n=je(n,gt)),new gU(n,e=>nh(n,e))}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function oq(n,e){const t=jt(n=je(n,gt));if(!t._uninitializedComponentsProvider||t._uninitializedComponentsProvider._offline.kind==="memory")return Vr("Cannot enable indexes when persistence is disabled"),Promise.resolve();const r=function(i){const o=typeof i=="string"?function(u){try{return JSON.parse(u)}catch(h){throw new z(V.INVALID_ARGUMENT,"Failed to parse JSON: "+(h==null?void 0:h.message))}}(i):i,a=[];if(Array.isArray(o.indexes))for(const l of o.indexes){const u=qS(l,"collectionGroup"),h=[];if(Array.isArray(l.fields))for(const f of l.fields){const p=Qm("setIndexConfiguration",qS(f,"fieldPath"));f.arrayConfig==="CONTAINS"?h.push(new zo(p,2)):f.order==="ASCENDING"?h.push(new zo(p,0)):f.order==="DESCENDING"&&h.push(new zo(p,1))}a.push(new Ll(Ll.UNKNOWN_ID,u,h,Vl.empty()))}return a}(e);return z5(t,r)}function qS(n,e){if(typeof n[e]!="string")throw new z(V.INVALID_ARGUMENT,"Missing string value for: "+e);return n[e]}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class vU{constructor(e){this._firestore=e,this.type="PersistentCacheIndexManager"}}function aq(n){var s;n=je(n,gt);const e=WS.get(n);if(e)return e;if(((s=jt(n)._uninitializedComponentsProvider)==null?void 0:s._offline.kind)!=="persistent")return null;const r=new vU(n);return WS.set(n,r),r}function lq(n){dk(n,!0)}function cq(n){dk(n,!1)}function uq(n){W5(jt(n._firestore)).then(e=>q("deleting all persistent cache indexes succeeded")).catch(e=>Vr("deleting all persistent cache indexes failed",e))}function dk(n,e){q5(jt(n._firestore),e).then(t=>q(`setting persistent cache index auto creation isEnabled=${e} succeeded`)).catch(t=>Vr(`setting persistent cache index auto creation isEnabled=${e} failed`,t))}const WS=new WeakMap;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function dq(n){var r;const e=jt(je(n.firestore,gt)),t=(r=e._onlineComponents)==null?void 0:r.datastore.serializer;return t===void 0?null:Fm(t,Mn(n._query)).ft}function hq(n,e){var i;const t=ZR(e,(o,a)=>new ON(a,o.aggregateType,o._internalFieldPath)),r=jt(je(n.firestore,gt)),s=(i=r._onlineComponents)==null?void 0:i.datastore.serializer;return s===void 0?null:GN(s,_N(n._query),t,!0).request}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class fq{constructor(){throw new Error("instances of this class should not be created")}static onExistenceFilterMismatch(e){return dI.instance.onExistenceFilterMismatch(e)}}class dI{constructor(){this.Mc=new Map}static get instance(){return Jh||(Jh=new dI,function(t){if(Au)throw new Error("a TestingHooksSpi instance is already set");Au=t}(Jh)),Jh}lt(e){this.Mc.forEach(t=>t(e))}onExistenceFilterMismatch(e){const t=Symbol(),r=this.Mc;return r.set(t,e),()=>r.delete(t)}}let Jh=null;(function(e,t=!0){(function(s){lc=s})(va),es(new sr("firestore",(r,{instanceIdentifier:s,options:i})=>{const o=r.getProvider("app").getImmediate(),a=new gt(new N4(r.getProvider("auth-internal")),new D4(o,r.getProvider("app-check-internal")),function(u,h){if(!Object.prototype.hasOwnProperty.apply(u.options,["projectId"]))throw new z(V.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new ra(u.options.projectId,h)}(o,s),o);return i={useFetchStreams:t,...i},a._setSettings(i),a},"PUBLIC").setMultipleInstances(!0)),nr(vT,wT,e),nr(vT,wT,"esm2020")})();/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const pq={PHONE:"phone",TOTP:"totp"},mq={FACEBOOK:"facebook.com",GITHUB:"github.com",GOOGLE:"google.com",PASSWORD:"password",PHONE:"phone",TWITTER:"twitter.com"},gq={EMAIL_LINK:"emailLink",EMAIL_PASSWORD:"password",FACEBOOK:"facebook.com",GITHUB:"github.com",GOOGLE:"google.com",PHONE:"phone",TWITTER:"twitter.com"},yq={LINK:"link",REAUTHENTICATE:"reauthenticate",SIGN_IN:"signIn"},_q={EMAIL_SIGNIN:"EMAIL_SIGNIN",PASSWORD_RESET:"PASSWORD_RESET",RECOVER_EMAIL:"RECOVER_EMAIL",REVERT_SECOND_FACTOR_ADDITION:"REVERT_SECOND_FACTOR_ADDITION",VERIFY_AND_CHANGE_EMAIL:"VERIFY_AND_CHANGE_EMAIL",VERIFY_EMAIL:"VERIFY_EMAIL"};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function wU(){return{"admin-restricted-operation":"This operation is restricted to administrators only.","argument-error":"","app-not-authorized":"This app, identified by the domain where it's hosted, is not authorized to use Firebase Authentication with the provided API key. Review your key configuration in the Google API console.","app-not-installed":"The requested mobile application corresponding to the identifier (Android package name or iOS bundle ID) provided is not installed on this device.","captcha-check-failed":"The reCAPTCHA response token provided is either invalid, expired, already used or the domain associated with it does not match the list of whitelisted domains.","code-expired":"The SMS code has expired. Please re-send the verification code to try again.","cordova-not-ready":"Cordova framework is not ready.","cors-unsupported":"This browser is not supported.","credential-already-in-use":"This credential is already associated with a different user account.","custom-token-mismatch":"The custom token corresponds to a different audience.","requires-recent-login":"This operation is sensitive and requires recent authentication. Log in again before retrying this request.","dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK.","dynamic-link-not-activated":"Please activate Dynamic Links in the Firebase Console and agree to the terms and conditions.","email-change-needs-verification":"Multi-factor users must always have a verified email.","email-already-in-use":"The email address is already in use by another account.","emulator-config-failed":'Auth instance has already been used to make a network call. Auth can no longer be configured to use the emulator. Try calling "connectAuthEmulator()" sooner.',"expired-action-code":"The action code has expired.","cancelled-popup-request":"This operation has been cancelled due to another conflicting popup being opened.","internal-error":"An internal AuthError has occurred.","invalid-app-credential":"The phone verification request contains an invalid application verifier. The reCAPTCHA token response is either invalid or expired.","invalid-app-id":"The mobile app identifier is not registered for the current project.","invalid-user-token":"This user's credential isn't valid for this project. This can happen if the user's token has been tampered with, or if the user isn't for the project associated with this API key.","invalid-auth-event":"An internal AuthError has occurred.","invalid-verification-code":"The SMS verification code used to create the phone auth credential is invalid. Please resend the verification code sms and be sure to use the verification code provided by the user.","invalid-continue-uri":"The continue URL provided in the request is invalid.","invalid-cordova-configuration":"The following Cordova plugins must be installed to enable OAuth sign-in: cordova-plugin-buildinfo, cordova-universal-links-plugin, cordova-plugin-browsertab, cordova-plugin-inappbrowser and cordova-plugin-customurlscheme.","invalid-custom-token":"The custom token format is incorrect. Please check the documentation.","invalid-dynamic-link-domain":"The provided dynamic link domain is not configured or authorized for the current project.","invalid-email":"The email address is badly formatted.","invalid-emulator-scheme":"Emulator URL must start with a valid scheme (http:// or https://).","invalid-api-key":"Your API key is invalid, please check you have copied it correctly.","invalid-cert-hash":"The SHA-1 certificate hash provided is invalid.","invalid-credential":"The supplied auth credential is incorrect, malformed or has expired.","invalid-message-payload":"The email template corresponding to this action contains invalid characters in its message. Please fix by going to the Auth email templates section in the Firebase Console.","invalid-multi-factor-session":"The request does not contain a valid proof of first factor successful sign-in.","invalid-oauth-provider":"EmailAuthProvider is not supported for this operation. This operation only supports OAuth providers.","invalid-oauth-client-id":"The OAuth client ID provided is either invalid or does not match the specified API key.","unauthorized-domain":"This domain is not authorized for OAuth operations for your Firebase project. Edit the list of authorized domains from the Firebase console.","invalid-action-code":"The action code is invalid. This can happen if the code is malformed, expired, or has already been used.","wrong-password":"The password is invalid or the user does not have a password.","invalid-persistence-type":"The specified persistence type is invalid. It can only be local, session or none.","invalid-phone-number":"The format of the phone number provided is incorrect. Please enter the phone number in a format that can be parsed into E.164 format. E.164 phone numbers are written in the format [+][country code][subscriber number including area code].","invalid-provider-id":"The specified provider ID is invalid.","invalid-recipient-email":"The email corresponding to this action failed to send as the provided recipient email address is invalid.","invalid-sender":"The email template corresponding to this action contains an invalid sender email or name. Please fix by going to the Auth email templates section in the Firebase Console.","invalid-verification-id":"The verification ID used to create the phone auth credential is invalid.","invalid-tenant-id":"The Auth instance's tenant ID is invalid.","login-blocked":"Login blocked by user-provided method: {$originalMessage}","missing-android-pkg-name":"An Android Package Name must be provided if the Android App is required to be installed.","auth-domain-config-required":"Be sure to include authDomain when calling firebase.initializeApp(), by following the instructions in the Firebase console.","missing-app-credential":"The phone verification request is missing an application verifier assertion. A reCAPTCHA response token needs to be provided.","missing-verification-code":"The phone auth credential was created with an empty SMS verification code.","missing-continue-uri":"A continue URL must be provided in the request.","missing-iframe-start":"An internal AuthError has occurred.","missing-ios-bundle-id":"An iOS Bundle ID must be provided if an App Store ID is provided.","missing-or-invalid-nonce":"The request does not contain a valid nonce. This can occur if the SHA-256 hash of the provided raw nonce does not match the hashed nonce in the ID token payload.","missing-password":"A non-empty password must be provided","missing-multi-factor-info":"No second factor identifier is provided.","missing-multi-factor-session":"The request is missing proof of first factor successful sign-in.","missing-phone-number":"To send verification codes, provide a phone number for the recipient.","missing-verification-id":"The phone auth credential was created with an empty verification ID.","app-deleted":"This instance of FirebaseApp has been deleted.","multi-factor-info-not-found":"The user does not have a second factor matching the identifier provided.","multi-factor-auth-required":"Proof of ownership of a second factor is required to complete sign-in.","account-exists-with-different-credential":"An account already exists with the same email address but different sign-in credentials. Sign in using a provider associated with this email address.","network-request-failed":"A network AuthError (such as timeout, interrupted connection or unreachable host) has occurred.","no-auth-event":"An internal AuthError has occurred.","no-such-provider":"User was not linked to an account with the given provider.","null-user":"A null user object was provided as the argument for an operation which requires a non-null user object.","operation-not-allowed":"The given sign-in provider is disabled for this Firebase project. Enable it in the Firebase console, under the sign-in method tab of the Auth section.","operation-not-supported-in-this-environment":'This operation is not supported in the environment this application is running on. "location.protocol" must be http, https or chrome-extension and web storage must be enabled.',"popup-blocked":"Unable to establish a connection with the popup. It may have been blocked by the browser.","popup-closed-by-user":"The popup has been closed by the user before finalizing the operation.","provider-already-linked":"User can only be linked to one identity for the given provider.","quota-exceeded":"The project's quota for this operation has been exceeded.","redirect-cancelled-by-user":"The redirect operation has been cancelled by the user before finalizing.","redirect-operation-pending":"A redirect sign-in operation is already pending.","rejected-credential":"The request contains malformed or mismatching credentials.","second-factor-already-in-use":"The second factor is already enrolled on this account.","maximum-second-factor-count-exceeded":"The maximum allowed number of second factors on a user has been exceeded.","tenant-id-mismatch":"The provided tenant ID does not match the Auth instance's tenant ID",timeout:"The operation has timed out.","user-token-expired":"The user's credential is no longer valid. The user must sign in again.","too-many-requests":"We have blocked all requests from this device due to unusual activity. Try again later.","unauthorized-continue-uri":"The domain of the continue URL is not whitelisted.  Please whitelist the domain in the Firebase console.","unsupported-first-factor":"Enrolling a second factor or signing in with a multi-factor account requires sign-in with a supported first factor.","unsupported-persistence-type":"The current environment does not support the specified persistence type.","unsupported-tenant-operation":"This operation is not supported in a multi-tenant context.","unverified-email":"The operation requires a verified email.","user-cancelled":"The user did not grant your application the permissions it requested.","user-not-found":"There is no user record corresponding to this identifier. The user may have been deleted.","user-disabled":"The user account has been disabled by an administrator.","user-mismatch":"The supplied credentials do not correspond to the previously signed in user.","user-signed-out":"","weak-password":"The password must be 6 characters long or more.","web-storage-unsupported":"This browser is not supported or 3rd party cookies and data may be disabled.","already-initialized":"initializeAuth() has already been called with different options. To avoid this error, call initializeAuth() with the same options as when it was originally called, or call getAuth() to return the already initialized instance.","missing-recaptcha-token":"The reCAPTCHA token is missing when sending request to the backend.","invalid-recaptcha-token":"The reCAPTCHA token is invalid when sending request to the backend.","invalid-recaptcha-action":"The reCAPTCHA action is invalid when sending request to the backend.","recaptcha-not-enabled":"reCAPTCHA Enterprise integration is not enabled for this project.","missing-client-type":"The reCAPTCHA client type is missing when sending request to the backend.","missing-recaptcha-version":"The reCAPTCHA version is missing when sending request to the backend.","invalid-req-type":"Invalid request parameters.","invalid-recaptcha-version":"The reCAPTCHA version is invalid when sending request to the backend.","unsupported-password-policy-schema-version":"The password policy received from the backend uses a schema version that is not supported by this version of the Firebase SDK.","password-does-not-meet-requirements":"The password does not meet the requirements.","invalid-hosting-link-domain":"The provided Hosting link domain is not configured in Firebase Hosting or is not owned by the current project. This cannot be a default Hosting domain (`web.app` or `firebaseapp.com`)."}}function hk(){return{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}}const vq=wU,IU=hk,fk=new ya("auth","Firebase",hk()),wq={ADMIN_ONLY_OPERATION:"auth/admin-restricted-operation",ARGUMENT_ERROR:"auth/argument-error",APP_NOT_AUTHORIZED:"auth/app-not-authorized",APP_NOT_INSTALLED:"auth/app-not-installed",CAPTCHA_CHECK_FAILED:"auth/captcha-check-failed",CODE_EXPIRED:"auth/code-expired",CORDOVA_NOT_READY:"auth/cordova-not-ready",CORS_UNSUPPORTED:"auth/cors-unsupported",CREDENTIAL_ALREADY_IN_USE:"auth/credential-already-in-use",CREDENTIAL_MISMATCH:"auth/custom-token-mismatch",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"auth/requires-recent-login",DEPENDENT_SDK_INIT_BEFORE_AUTH:"auth/dependent-sdk-initialized-before-auth",DYNAMIC_LINK_NOT_ACTIVATED:"auth/dynamic-link-not-activated",EMAIL_CHANGE_NEEDS_VERIFICATION:"auth/email-change-needs-verification",EMAIL_EXISTS:"auth/email-already-in-use",EMULATOR_CONFIG_FAILED:"auth/emulator-config-failed",EXPIRED_OOB_CODE:"auth/expired-action-code",EXPIRED_POPUP_REQUEST:"auth/cancelled-popup-request",INTERNAL_ERROR:"auth/internal-error",INVALID_API_KEY:"auth/invalid-api-key",INVALID_APP_CREDENTIAL:"auth/invalid-app-credential",INVALID_APP_ID:"auth/invalid-app-id",INVALID_AUTH:"auth/invalid-user-token",INVALID_AUTH_EVENT:"auth/invalid-auth-event",INVALID_CERT_HASH:"auth/invalid-cert-hash",INVALID_CODE:"auth/invalid-verification-code",INVALID_CONTINUE_URI:"auth/invalid-continue-uri",INVALID_CORDOVA_CONFIGURATION:"auth/invalid-cordova-configuration",INVALID_CUSTOM_TOKEN:"auth/invalid-custom-token",INVALID_DYNAMIC_LINK_DOMAIN:"auth/invalid-dynamic-link-domain",INVALID_EMAIL:"auth/invalid-email",INVALID_EMULATOR_SCHEME:"auth/invalid-emulator-scheme",INVALID_IDP_RESPONSE:"auth/invalid-credential",INVALID_LOGIN_CREDENTIALS:"auth/invalid-credential",INVALID_MESSAGE_PAYLOAD:"auth/invalid-message-payload",INVALID_MFA_SESSION:"auth/invalid-multi-factor-session",INVALID_OAUTH_CLIENT_ID:"auth/invalid-oauth-client-id",INVALID_OAUTH_PROVIDER:"auth/invalid-oauth-provider",INVALID_OOB_CODE:"auth/invalid-action-code",INVALID_ORIGIN:"auth/unauthorized-domain",INVALID_PASSWORD:"auth/wrong-password",INVALID_PERSISTENCE:"auth/invalid-persistence-type",INVALID_PHONE_NUMBER:"auth/invalid-phone-number",INVALID_PROVIDER_ID:"auth/invalid-provider-id",INVALID_RECIPIENT_EMAIL:"auth/invalid-recipient-email",INVALID_SENDER:"auth/invalid-sender",INVALID_SESSION_INFO:"auth/invalid-verification-id",INVALID_TENANT_ID:"auth/invalid-tenant-id",MFA_INFO_NOT_FOUND:"auth/multi-factor-info-not-found",MFA_REQUIRED:"auth/multi-factor-auth-required",MISSING_ANDROID_PACKAGE_NAME:"auth/missing-android-pkg-name",MISSING_APP_CREDENTIAL:"auth/missing-app-credential",MISSING_AUTH_DOMAIN:"auth/auth-domain-config-required",MISSING_CODE:"auth/missing-verification-code",MISSING_CONTINUE_URI:"auth/missing-continue-uri",MISSING_IFRAME_START:"auth/missing-iframe-start",MISSING_IOS_BUNDLE_ID:"auth/missing-ios-bundle-id",MISSING_OR_INVALID_NONCE:"auth/missing-or-invalid-nonce",MISSING_MFA_INFO:"auth/missing-multi-factor-info",MISSING_MFA_SESSION:"auth/missing-multi-factor-session",MISSING_PHONE_NUMBER:"auth/missing-phone-number",MISSING_SESSION_INFO:"auth/missing-verification-id",MODULE_DESTROYED:"auth/app-deleted",NEED_CONFIRMATION:"auth/account-exists-with-different-credential",NETWORK_REQUEST_FAILED:"auth/network-request-failed",NULL_USER:"auth/null-user",NO_AUTH_EVENT:"auth/no-auth-event",NO_SUCH_PROVIDER:"auth/no-such-provider",OPERATION_NOT_ALLOWED:"auth/operation-not-allowed",OPERATION_NOT_SUPPORTED:"auth/operation-not-supported-in-this-environment",POPUP_BLOCKED:"auth/popup-blocked",POPUP_CLOSED_BY_USER:"auth/popup-closed-by-user",PROVIDER_ALREADY_LINKED:"auth/provider-already-linked",QUOTA_EXCEEDED:"auth/quota-exceeded",REDIRECT_CANCELLED_BY_USER:"auth/redirect-cancelled-by-user",REDIRECT_OPERATION_PENDING:"auth/redirect-operation-pending",REJECTED_CREDENTIAL:"auth/rejected-credential",SECOND_FACTOR_ALREADY_ENROLLED:"auth/second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"auth/maximum-second-factor-count-exceeded",TENANT_ID_MISMATCH:"auth/tenant-id-mismatch",TIMEOUT:"auth/timeout",TOKEN_EXPIRED:"auth/user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"auth/too-many-requests",UNAUTHORIZED_DOMAIN:"auth/unauthorized-continue-uri",UNSUPPORTED_FIRST_FACTOR:"auth/unsupported-first-factor",UNSUPPORTED_PERSISTENCE:"auth/unsupported-persistence-type",UNSUPPORTED_TENANT_OPERATION:"auth/unsupported-tenant-operation",UNVERIFIED_EMAIL:"auth/unverified-email",USER_CANCELLED:"auth/user-cancelled",USER_DELETED:"auth/user-not-found",USER_DISABLED:"auth/user-disabled",USER_MISMATCH:"auth/user-mismatch",USER_SIGNED_OUT:"auth/user-signed-out",WEAK_PASSWORD:"auth/weak-password",WEB_STORAGE_UNSUPPORTED:"auth/web-storage-unsupported",ALREADY_INITIALIZED:"auth/already-initialized",RECAPTCHA_NOT_ENABLED:"auth/recaptcha-not-enabled",MISSING_RECAPTCHA_TOKEN:"auth/missing-recaptcha-token",INVALID_RECAPTCHA_TOKEN:"auth/invalid-recaptcha-token",INVALID_RECAPTCHA_ACTION:"auth/invalid-recaptcha-action",MISSING_CLIENT_TYPE:"auth/missing-client-type",MISSING_RECAPTCHA_VERSION:"auth/missing-recaptcha-version",INVALID_RECAPTCHA_VERSION:"auth/invalid-recaptcha-version",INVALID_REQ_TYPE:"auth/invalid-req-type",INVALID_HOSTING_LINK_DOMAIN:"auth/invalid-hosting-link-domain"};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Lp=new Pd("@firebase/auth");function EU(n,...e){Lp.logLevel<=Fe.WARN&&Lp.warn(`Auth (${va}): ${n}`,...e)}function Cf(n,...e){Lp.logLevel<=Fe.ERROR&&Lp.error(`Auth (${va}): ${n}`,...e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ir(n,...e){throw fI(n,...e)}function $n(n,...e){return fI(n,...e)}function hI(n,e,t){const r={...IU(),[e]:t};return new ya("auth","Firebase",r).create(e,{appName:n.name})}function pn(n){return hI(n,"operation-not-supported-in-this-environment","Operations that alter the current user are not supported in conjunction with FirebaseServerApp")}function _c(n,e,t){const r=t;if(!(e instanceof r))throw r.name!==e.constructor.name&&ir(n,"argument-error"),hI(n,"argument-error",`Type of ${e.constructor.name} does not match expected instance.Did you pass a reference from a different Auth SDK?`)}function fI(n,...e){if(typeof n!="string"){const t=e[0],r=[...e.slice(1)];return r[0]&&(r[0].appName=n.name),n._errorFactory.create(t,...r)}return fk.create(n,...e)}function K(n,e,...t){if(!n)throw fI(e,...t)}function ms(n){const e="INTERNAL ASSERTION FAILED: "+n;throw Cf(e),new Error(e)}function Js(n,e){n||ms(e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function wd(){var n;return typeof self<"u"&&((n=self.location)==null?void 0:n.href)||""}function pI(){return GS()==="http:"||GS()==="https:"}function GS(){var n;return typeof self<"u"&&((n=self.location)==null?void 0:n.protocol)||null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function xU(){return typeof navigator<"u"&&navigator&&"onLine"in navigator&&typeof navigator.onLine=="boolean"&&(pI()||w0()||"connection"in navigator)?navigator.onLine:!0}function TU(){if(typeof navigator>"u")return null;const n=navigator;return n.languages&&n.languages[0]||n.language||null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class rh{constructor(e,t){this.shortDelay=e,this.longDelay=t,Js(t>e,"Short delay should be less than long delay!"),this.isMobile=v0()||KA()}get(){return xU()?this.isMobile?this.longDelay:this.shortDelay:Math.min(5e3,this.shortDelay)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function mI(n,e){Js(n.emulator,"Emulator should always be set here");const{url:t}=n.emulator;return e?`${t}${e.startsWith("/")?e.slice(1):e}`:t}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class pk{static initialize(e,t,r){this.fetchImpl=e,t&&(this.headersImpl=t),r&&(this.responseImpl=r)}static fetch(){if(this.fetchImpl)return this.fetchImpl;if(typeof self<"u"&&"fetch"in self)return self.fetch;if(typeof globalThis<"u"&&globalThis.fetch)return globalThis.fetch;if(typeof fetch<"u")return fetch;ms("Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static headers(){if(this.headersImpl)return this.headersImpl;if(typeof self<"u"&&"Headers"in self)return self.Headers;if(typeof globalThis<"u"&&globalThis.Headers)return globalThis.Headers;if(typeof Headers<"u")return Headers;ms("Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static response(){if(this.responseImpl)return this.responseImpl;if(typeof self<"u"&&"Response"in self)return self.Response;if(typeof globalThis<"u"&&globalThis.Response)return globalThis.Response;if(typeof Response<"u")return Response;ms("Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const SU={CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_PASSWORD:"wrong-password",MISSING_PASSWORD:"missing-password",INVALID_LOGIN_CREDENTIALS:"invalid-credential",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_REQ_TYPE:"internal-error",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",PASSWORD_DOES_NOT_MEET_REQUIREMENTS:"password-does-not-meet-requirements",INVALID_CODE:"invalid-verification-code",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_SESSION_INFO:"missing-verification-id",SESSION_EXPIRED:"code-expired",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",ADMIN_ONLY_OPERATION:"admin-restricted-operation",INVALID_MFA_PENDING_CREDENTIAL:"invalid-multi-factor-session",MFA_ENROLLMENT_NOT_FOUND:"multi-factor-info-not-found",MISSING_MFA_ENROLLMENT_ID:"missing-multi-factor-info",MISSING_MFA_PENDING_CREDENTIAL:"missing-multi-factor-session",SECOND_FACTOR_EXISTS:"second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"maximum-second-factor-count-exceeded",BLOCKING_FUNCTION_ERROR_RESPONSE:"internal-error",RECAPTCHA_NOT_ENABLED:"recaptcha-not-enabled",MISSING_RECAPTCHA_TOKEN:"missing-recaptcha-token",INVALID_RECAPTCHA_TOKEN:"invalid-recaptcha-token",INVALID_RECAPTCHA_ACTION:"invalid-recaptcha-action",MISSING_CLIENT_TYPE:"missing-client-type",MISSING_RECAPTCHA_VERSION:"missing-recaptcha-version",INVALID_RECAPTCHA_VERSION:"invalid-recaptcha-version",INVALID_REQ_TYPE:"invalid-req-type"};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const bU=["/v1/accounts:signInWithCustomToken","/v1/accounts:signInWithEmailLink","/v1/accounts:signInWithIdp","/v1/accounts:signInWithPassword","/v1/accounts:signInWithPhoneNumber","/v1/token"],AU=new rh(3e4,6e4);function St(n,e){return n.tenantId&&!e.tenantId?{...e,tenantId:n.tenantId}:e}async function bt(n,e,t,r,s={}){return mk(n,s,async()=>{let i={},o={};r&&(e==="GET"?o=r:i={body:JSON.stringify(r)});const a=_a({key:n.config.apiKey,...o}).slice(1),l=await n._getAdditionalHeaders();l["Content-Type"]="application/json",n.languageCode&&(l["X-Firebase-Locale"]=n.languageCode);const u={method:e,headers:l,...i};return jM()||(u.referrerPolicy="no-referrer"),n.emulatorConfig&&ti(n.emulatorConfig.host)&&(u.credentials="include"),pk.fetch()(await gk(n,n.config.apiHost,t,a),u)})}async function mk(n,e,t){n._canInitEmulator=!1;const r={...SU,...e};try{const s=new RU(n),i=await Promise.race([t(),s.promise]);s.clearNetworkTimeout();const o=await i.json();if("needConfirmation"in o)throw iu(n,"account-exists-with-different-credential",o);if(i.ok&&!("errorMessage"in o))return o;{const a=i.ok?o.errorMessage:o.error.message,[l,u]=a.split(" : ");if(l==="FEDERATED_USER_ID_ALREADY_LINKED")throw iu(n,"credential-already-in-use",o);if(l==="EMAIL_EXISTS")throw iu(n,"email-already-in-use",o);if(l==="USER_DISABLED")throw iu(n,"user-disabled",o);const h=r[l]||l.toLowerCase().replace(/[_\s]+/g,"-");if(u)throw hI(n,h,u);ir(n,h)}}catch(s){if(s instanceof ts)throw s;ir(n,"network-request-failed",{message:String(s)})}}async function oi(n,e,t,r,s={}){const i=await bt(n,e,t,r,s);return"mfaPendingCredential"in i&&ir(n,"multi-factor-auth-required",{_serverResponse:i}),i}async function gk(n,e,t,r){const s=`${e}${t}?${r}`,i=n,o=i.config.emulator?mI(n.config,s):`${n.config.apiScheme}://${s}`;return bU.includes(t)&&(await i._persistenceManagerAvailable,i._getPersistenceType()==="COOKIE")?i._getPersistence()._getFinalTarget(o).toString():o}function CU(n){switch(n){case"ENFORCE":return"ENFORCE";case"AUDIT":return"AUDIT";case"OFF":return"OFF";default:return"ENFORCEMENT_STATE_UNSPECIFIED"}}class RU{clearNetworkTimeout(){clearTimeout(this.timer)}constructor(e){this.auth=e,this.timer=null,this.promise=new Promise((t,r)=>{this.timer=setTimeout(()=>r($n(this.auth,"network-request-failed")),AU.get())})}}function iu(n,e,t){const r={appName:n.name};t.email&&(r.email=t.email),t.phoneNumber&&(r.phoneNumber=t.phoneNumber);const s=$n(n,e,r);return s.customData._tokenResponse=t,s}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function HS(n){return n!==void 0&&n.getResponse!==void 0}function KS(n){return n!==void 0&&n.enterprise!==void 0}class yk{constructor(e){if(this.siteKey="",this.recaptchaEnforcementState=[],e.recaptchaKey===void 0)throw new Error("recaptchaKey undefined");this.siteKey=e.recaptchaKey.split("/")[3],this.recaptchaEnforcementState=e.recaptchaEnforcementState}getProviderEnforcementState(e){if(!this.recaptchaEnforcementState||this.recaptchaEnforcementState.length===0)return null;for(const t of this.recaptchaEnforcementState)if(t.provider&&t.provider===e)return CU(t.enforcementState);return null}isProviderEnabled(e){return this.getProviderEnforcementState(e)==="ENFORCE"||this.getProviderEnforcementState(e)==="AUDIT"}isAnyProviderEnabled(){return this.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")||this.isProviderEnabled("PHONE_PROVIDER")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function NU(n){return(await bt(n,"GET","/v1/recaptchaParams")).recaptchaSiteKey||""}async function _k(n,e){return bt(n,"GET","/v2/recaptchaConfig",St(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function PU(n,e){return bt(n,"POST","/v1/accounts:delete",e)}async function kU(n,e){return bt(n,"POST","/v1/accounts:update",e)}async function Vp(n,e){return bt(n,"POST","/v1/accounts:lookup",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ru(n){if(n)try{const e=new Date(Number(n));if(!isNaN(e.getTime()))return e.toUTCString()}catch{}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Iq(n,e=!1){return ne(n).getIdToken(e)}async function DU(n,e=!1){const t=ne(n),r=await t.getIdToken(e),s=tg(r);K(s&&s.exp&&s.auth_time&&s.iat,t.auth,"internal-error");const i=typeof s.firebase=="object"?s.firebase:void 0,o=i==null?void 0:i.sign_in_provider;return{claims:s,token:r,authTime:Ru(wy(s.auth_time)),issuedAtTime:Ru(wy(s.iat)),expirationTime:Ru(wy(s.exp)),signInProvider:o||null,signInSecondFactor:(i==null?void 0:i.sign_in_second_factor)||null}}function wy(n){return Number(n)*1e3}function tg(n){const[e,t,r]=n.split(".");if(e===void 0||t===void 0||r===void 0)return Cf("JWT malformed, contained fewer than 3 sections"),null;try{const s=sp(t);return s?JSON.parse(s):(Cf("Failed to decode base64 JWT payload"),null)}catch(s){return Cf("Caught error parsing JWT payload as JSON",s==null?void 0:s.toString()),null}}function QS(n){const e=tg(n);return K(e,"internal-error"),K(typeof e.exp<"u","internal-error"),K(typeof e.iat<"u","internal-error"),Number(e.exp)-Number(e.iat)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Xs(n,e,t=!1){if(t)return e;try{return await e}catch(r){throw r instanceof ts&&OU(r)&&n.auth.currentUser===n&&await n.auth.signOut(),r}}function OU({code:n}){return n==="auth/user-disabled"||n==="auth/user-token-expired"}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class MU{constructor(e){this.user=e,this.isRunning=!1,this.timerId=null,this.errorBackoff=3e4}_start(){this.isRunning||(this.isRunning=!0,this.schedule())}_stop(){this.isRunning&&(this.isRunning=!1,this.timerId!==null&&clearTimeout(this.timerId))}getInterval(e){if(e){const t=this.errorBackoff;return this.errorBackoff=Math.min(this.errorBackoff*2,96e4),t}else{this.errorBackoff=3e4;const r=(this.user.stsTokenManager.expirationTime??0)-Date.now()-3e5;return Math.max(0,r)}}schedule(e=!1){if(!this.isRunning)return;const t=this.getInterval(e);this.timerId=setTimeout(async()=>{await this.iteration()},t)}async iteration(){try{await this.user.getIdToken(!0)}catch(e){(e==null?void 0:e.code)==="auth/network-request-failed"&&this.schedule(!0);return}this.schedule()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class vv{constructor(e,t){this.createdAt=e,this.lastLoginAt=t,this._initializeTime()}_initializeTime(){this.lastSignInTime=Ru(this.lastLoginAt),this.creationTime=Ru(this.createdAt)}_copy(e){this.createdAt=e.createdAt,this.lastLoginAt=e.lastLoginAt,this._initializeTime()}toJSON(){return{createdAt:this.createdAt,lastLoginAt:this.lastLoginAt}}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Id(n){var f;const e=n.auth,t=await n.getIdToken(),r=await Xs(n,Vp(e,{idToken:t}));K(r==null?void 0:r.users.length,e,"internal-error");const s=r.users[0];n._notifyReloadListener(s);const i=(f=s.providerUserInfo)!=null&&f.length?vk(s.providerUserInfo):[],o=VU(n.providerData,i),a=n.isAnonymous,l=!(n.email&&s.passwordHash)&&!(o!=null&&o.length),u=a?l:!1,h={uid:s.localId,displayName:s.displayName||null,photoURL:s.photoUrl||null,email:s.email||null,emailVerified:s.emailVerified||!1,phoneNumber:s.phoneNumber||null,tenantId:s.tenantId||null,providerData:o,metadata:new vv(s.createdAt,s.lastLoginAt),isAnonymous:u};Object.assign(n,h)}async function LU(n){const e=ne(n);await Id(e),await e.auth._persistUserIfCurrent(e),e.auth._notifyListenersIfCurrent(e)}function VU(n,e){return[...n.filter(r=>!e.some(s=>s.providerId===r.providerId)),...e]}function vk(n){return n.map(({providerId:e,...t})=>({providerId:e,uid:t.rawId||"",displayName:t.displayName||null,email:t.email||null,phoneNumber:t.phoneNumber||null,photoURL:t.photoUrl||null}))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function FU(n,e){const t=await mk(n,{},async()=>{const r=_a({grant_type:"refresh_token",refresh_token:e}).slice(1),{tokenApiHost:s,apiKey:i}=n.config,o=await gk(n,s,"/v1/token",`key=${i}`),a=await n._getAdditionalHeaders();a["Content-Type"]="application/x-www-form-urlencoded";const l={method:"POST",headers:a,body:r};return n.emulatorConfig&&ti(n.emulatorConfig.host)&&(l.credentials="include"),pk.fetch()(o,l)});return{accessToken:t.access_token,expiresIn:t.expires_in,refreshToken:t.refresh_token}}async function jU(n,e){return bt(n,"POST","/v2/accounts:revokeToken",St(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class gl{constructor(){this.refreshToken=null,this.accessToken=null,this.expirationTime=null}get isExpired(){return!this.expirationTime||Date.now()>this.expirationTime-3e4}updateFromServerResponse(e){K(e.idToken,"internal-error"),K(typeof e.idToken<"u","internal-error"),K(typeof e.refreshToken<"u","internal-error");const t="expiresIn"in e&&typeof e.expiresIn<"u"?Number(e.expiresIn):QS(e.idToken);this.updateTokensAndExpiration(e.idToken,e.refreshToken,t)}updateFromIdToken(e){K(e.length!==0,"internal-error");const t=QS(e);this.updateTokensAndExpiration(e,null,t)}async getToken(e,t=!1){return!t&&this.accessToken&&!this.isExpired?this.accessToken:(K(this.refreshToken,e,"user-token-expired"),this.refreshToken?(await this.refresh(e,this.refreshToken),this.accessToken):null)}clearRefreshToken(){this.refreshToken=null}async refresh(e,t){const{accessToken:r,refreshToken:s,expiresIn:i}=await FU(e,t);this.updateTokensAndExpiration(r,s,Number(i))}updateTokensAndExpiration(e,t,r){this.refreshToken=t||null,this.accessToken=e||null,this.expirationTime=Date.now()+r*1e3}static fromJSON(e,t){const{refreshToken:r,accessToken:s,expirationTime:i}=t,o=new gl;return r&&(K(typeof r=="string","internal-error",{appName:e}),o.refreshToken=r),s&&(K(typeof s=="string","internal-error",{appName:e}),o.accessToken=s),i&&(K(typeof i=="number","internal-error",{appName:e}),o.expirationTime=i),o}toJSON(){return{refreshToken:this.refreshToken,accessToken:this.accessToken,expirationTime:this.expirationTime}}_assign(e){this.accessToken=e.accessToken,this.refreshToken=e.refreshToken,this.expirationTime=e.expirationTime}_clone(){return Object.assign(new gl,this.toJSON())}_performRefresh(){return ms("not implemented")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function pi(n,e){K(typeof n=="string"||typeof n>"u","internal-error",{appName:e})}class Kr{constructor({uid:e,auth:t,stsTokenManager:r,...s}){this.providerId="firebase",this.proactiveRefresh=new MU(this),this.reloadUserInfo=null,this.reloadListener=null,this.uid=e,this.auth=t,this.stsTokenManager=r,this.accessToken=r.accessToken,this.displayName=s.displayName||null,this.email=s.email||null,this.emailVerified=s.emailVerified||!1,this.phoneNumber=s.phoneNumber||null,this.photoURL=s.photoURL||null,this.isAnonymous=s.isAnonymous||!1,this.tenantId=s.tenantId||null,this.providerData=s.providerData?[...s.providerData]:[],this.metadata=new vv(s.createdAt||void 0,s.lastLoginAt||void 0)}async getIdToken(e){const t=await Xs(this,this.stsTokenManager.getToken(this.auth,e));return K(t,this.auth,"internal-error"),this.accessToken!==t&&(this.accessToken=t,await this.auth._persistUserIfCurrent(this),this.auth._notifyListenersIfCurrent(this)),t}getIdTokenResult(e){return DU(this,e)}reload(){return LU(this)}_assign(e){this!==e&&(K(this.uid===e.uid,this.auth,"internal-error"),this.displayName=e.displayName,this.photoURL=e.photoURL,this.email=e.email,this.emailVerified=e.emailVerified,this.phoneNumber=e.phoneNumber,this.isAnonymous=e.isAnonymous,this.tenantId=e.tenantId,this.providerData=e.providerData.map(t=>({...t})),this.metadata._copy(e.metadata),this.stsTokenManager._assign(e.stsTokenManager))}_clone(e){const t=new Kr({...this,auth:e,stsTokenManager:this.stsTokenManager._clone()});return t.metadata._copy(this.metadata),t}_onReload(e){K(!this.reloadListener,this.auth,"internal-error"),this.reloadListener=e,this.reloadUserInfo&&(this._notifyReloadListener(this.reloadUserInfo),this.reloadUserInfo=null)}_notifyReloadListener(e){this.reloadListener?this.reloadListener(e):this.reloadUserInfo=e}_startProactiveRefresh(){this.proactiveRefresh._start()}_stopProactiveRefresh(){this.proactiveRefresh._stop()}async _updateTokensIfNecessary(e,t=!1){let r=!1;e.idToken&&e.idToken!==this.stsTokenManager.accessToken&&(this.stsTokenManager.updateFromServerResponse(e),r=!0),t&&await Id(this),await this.auth._persistUserIfCurrent(this),r&&this.auth._notifyListenersIfCurrent(this)}async delete(){if(Pt(this.auth.app))return Promise.reject(pn(this.auth));const e=await this.getIdToken();return await Xs(this,PU(this.auth,{idToken:e})),this.stsTokenManager.clearRefreshToken(),this.auth.signOut()}toJSON(){return{uid:this.uid,email:this.email||void 0,emailVerified:this.emailVerified,displayName:this.displayName||void 0,isAnonymous:this.isAnonymous,photoURL:this.photoURL||void 0,phoneNumber:this.phoneNumber||void 0,tenantId:this.tenantId||void 0,providerData:this.providerData.map(e=>({...e})),stsTokenManager:this.stsTokenManager.toJSON(),_redirectEventId:this._redirectEventId,...this.metadata.toJSON(),apiKey:this.auth.config.apiKey,appName:this.auth.name}}get refreshToken(){return this.stsTokenManager.refreshToken||""}static _fromJSON(e,t){const r=t.displayName??void 0,s=t.email??void 0,i=t.phoneNumber??void 0,o=t.photoURL??void 0,a=t.tenantId??void 0,l=t._redirectEventId??void 0,u=t.createdAt??void 0,h=t.lastLoginAt??void 0,{uid:f,emailVerified:p,isAnonymous:y,providerData:I,stsTokenManager:C}=t;K(f&&C,e,"internal-error");const P=gl.fromJSON(this.name,C);K(typeof f=="string",e,"internal-error"),pi(r,e.name),pi(s,e.name),K(typeof p=="boolean",e,"internal-error"),K(typeof y=="boolean",e,"internal-error"),pi(i,e.name),pi(o,e.name),pi(a,e.name),pi(l,e.name),pi(u,e.name),pi(h,e.name);const A=new Kr({uid:f,auth:e,email:s,emailVerified:p,displayName:r,isAnonymous:y,photoURL:o,phoneNumber:i,tenantId:a,stsTokenManager:P,createdAt:u,lastLoginAt:h});return I&&Array.isArray(I)&&(A.providerData=I.map(T=>({...T}))),l&&(A._redirectEventId=l),A}static async _fromIdTokenResponse(e,t,r=!1){const s=new gl;s.updateFromServerResponse(t);const i=new Kr({uid:t.localId,auth:e,stsTokenManager:s,isAnonymous:r});return await Id(i),i}static async _fromGetAccountInfoResponse(e,t,r){const s=t.users[0];K(s.localId!==void 0,"internal-error");const i=s.providerUserInfo!==void 0?vk(s.providerUserInfo):[],o=!(s.email&&s.passwordHash)&&!(i!=null&&i.length),a=new gl;a.updateFromIdToken(r);const l=new Kr({uid:s.localId,auth:e,stsTokenManager:a,isAnonymous:o}),u={uid:s.localId,displayName:s.displayName||null,photoURL:s.photoUrl||null,email:s.email||null,emailVerified:s.emailVerified||!1,phoneNumber:s.phoneNumber||null,tenantId:s.tenantId||null,providerData:i,metadata:new vv(s.createdAt,s.lastLoginAt),isAnonymous:!(s.email&&s.passwordHash)&&!(i!=null&&i.length)};return Object.assign(l,u),l}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const YS=new Map;function js(n){Js(n instanceof Function,"Expected a class definition");let e=YS.get(n);return e?(Js(e instanceof n,"Instance stored in cache mismatched with class"),e):(e=new n,YS.set(n,e),e)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class wk{constructor(){this.type="NONE",this.storage={}}async _isAvailable(){return!0}async _set(e,t){this.storage[e]=t}async _get(e){const t=this.storage[e];return t===void 0?null:t}async _remove(e){delete this.storage[e]}_addListener(e,t){}_removeListener(e,t){}}wk.type="NONE";const JS=wk;/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Rf(n,e,t){return`firebase:${n}:${e}:${t}`}class yl{constructor(e,t,r){this.persistence=e,this.auth=t,this.userKey=r;const{config:s,name:i}=this.auth;this.fullUserKey=Rf(this.userKey,s.apiKey,i),this.fullPersistenceKey=Rf("persistence",s.apiKey,i),this.boundEventHandler=t._onStorageEvent.bind(t),this.persistence._addListener(this.fullUserKey,this.boundEventHandler)}setCurrentUser(e){return this.persistence._set(this.fullUserKey,e.toJSON())}async getCurrentUser(){const e=await this.persistence._get(this.fullUserKey);if(!e)return null;if(typeof e=="string"){const t=await Vp(this.auth,{idToken:e}).catch(()=>{});return t?Kr._fromGetAccountInfoResponse(this.auth,t,e):null}return Kr._fromJSON(this.auth,e)}removeCurrentUser(){return this.persistence._remove(this.fullUserKey)}savePersistenceForRedirect(){return this.persistence._set(this.fullPersistenceKey,this.persistence.type)}async setPersistence(e){if(this.persistence===e)return;const t=await this.getCurrentUser();if(await this.removeCurrentUser(),this.persistence=e,t)return this.setCurrentUser(t)}delete(){this.persistence._removeListener(this.fullUserKey,this.boundEventHandler)}static async create(e,t,r="authUser"){if(!t.length)return new yl(js(JS),e,r);const s=(await Promise.all(t.map(async u=>{if(await u._isAvailable())return u}))).filter(u=>u);let i=s[0]||js(JS);const o=Rf(r,e.config.apiKey,e.name);let a=null;for(const u of t)try{const h=await u._get(o);if(h){let f;if(typeof h=="string"){const p=await Vp(e,{idToken:h}).catch(()=>{});if(!p)break;f=await Kr._fromGetAccountInfoResponse(e,p,h)}else f=Kr._fromJSON(e,h);u!==i&&(a=f),i=u;break}}catch{}const l=s.filter(u=>u._shouldAllowMigration);return!i._shouldAllowMigration||!l.length?new yl(i,e,r):(i=l[0],a&&await i._set(o,a.toJSON()),await Promise.all(t.map(async u=>{if(u!==i)try{await u._remove(o)}catch{}})),new yl(i,e,r))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function XS(n){const e=n.toLowerCase();if(e.includes("opera/")||e.includes("opr/")||e.includes("opios/"))return"Opera";if(Tk(e))return"IEMobile";if(e.includes("msie")||e.includes("trident/"))return"IE";if(e.includes("edge/"))return"Edge";if(Ik(e))return"Firefox";if(e.includes("silk/"))return"Silk";if(bk(e))return"Blackberry";if(Ak(e))return"Webos";if(Ek(e))return"Safari";if((e.includes("chrome/")||xk(e))&&!e.includes("edge/"))return"Chrome";if(Sk(e))return"Android";{const t=/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/,r=n.match(t);if((r==null?void 0:r.length)===2)return r[1]}return"Other"}function Ik(n=nn()){return/firefox\//i.test(n)}function Ek(n=nn()){const e=n.toLowerCase();return e.includes("safari/")&&!e.includes("chrome/")&&!e.includes("crios/")&&!e.includes("android")}function xk(n=nn()){return/crios\//i.test(n)}function Tk(n=nn()){return/iemobile/i.test(n)}function Sk(n=nn()){return/android/i.test(n)}function bk(n=nn()){return/blackberry/i.test(n)}function Ak(n=nn()){return/webos/i.test(n)}function gI(n=nn()){return/iphone|ipad|ipod/i.test(n)||/macintosh/i.test(n)&&/mobile/i.test(n)}function UU(n=nn()){var e;return gI(n)&&!!((e=window.navigator)!=null&&e.standalone)}function BU(){return UM()&&document.documentMode===10}function Ck(n=nn()){return gI(n)||Sk(n)||Ak(n)||bk(n)||/windows phone/i.test(n)||Tk(n)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Rk(n,e=[]){let t;switch(n){case"Browser":t=XS(nn());break;case"Worker":t=`${XS(nn())}-${n}`;break;default:t=n}const r=e.length?e.join(","):"FirebaseCore-web";return`${t}/JsCore/${va}/${r}`}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class $U{constructor(e){this.auth=e,this.queue=[]}pushCallback(e,t){const r=i=>new Promise((o,a)=>{try{const l=e(i);o(l)}catch(l){a(l)}});r.onAbort=t,this.queue.push(r);const s=this.queue.length-1;return()=>{this.queue[s]=()=>Promise.resolve()}}async runMiddleware(e){if(this.auth.currentUser===e)return;const t=[];try{for(const r of this.queue)await r(e),r.onAbort&&t.push(r.onAbort)}catch(r){t.reverse();for(const s of t)try{s()}catch{}throw this.auth._errorFactory.create("login-blocked",{originalMessage:r==null?void 0:r.message})}}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function zU(n,e={}){return bt(n,"GET","/v2/passwordPolicy",St(n,e))}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const qU=6;class WU{constructor(e){var r;const t=e.customStrengthOptions;this.customStrengthOptions={},this.customStrengthOptions.minPasswordLength=t.minPasswordLength??qU,t.maxPasswordLength&&(this.customStrengthOptions.maxPasswordLength=t.maxPasswordLength),t.containsLowercaseCharacter!==void 0&&(this.customStrengthOptions.containsLowercaseLetter=t.containsLowercaseCharacter),t.containsUppercaseCharacter!==void 0&&(this.customStrengthOptions.containsUppercaseLetter=t.containsUppercaseCharacter),t.containsNumericCharacter!==void 0&&(this.customStrengthOptions.containsNumericCharacter=t.containsNumericCharacter),t.containsNonAlphanumericCharacter!==void 0&&(this.customStrengthOptions.containsNonAlphanumericCharacter=t.containsNonAlphanumericCharacter),this.enforcementState=e.enforcementState,this.enforcementState==="ENFORCEMENT_STATE_UNSPECIFIED"&&(this.enforcementState="OFF"),this.allowedNonAlphanumericCharacters=((r=e.allowedNonAlphanumericCharacters)==null?void 0:r.join(""))??"",this.forceUpgradeOnSignin=e.forceUpgradeOnSignin??!1,this.schemaVersion=e.schemaVersion}validatePassword(e){const t={isValid:!0,passwordPolicy:this};return this.validatePasswordLengthOptions(e,t),this.validatePasswordCharacterOptions(e,t),t.isValid&&(t.isValid=t.meetsMinPasswordLength??!0),t.isValid&&(t.isValid=t.meetsMaxPasswordLength??!0),t.isValid&&(t.isValid=t.containsLowercaseLetter??!0),t.isValid&&(t.isValid=t.containsUppercaseLetter??!0),t.isValid&&(t.isValid=t.containsNumericCharacter??!0),t.isValid&&(t.isValid=t.containsNonAlphanumericCharacter??!0),t}validatePasswordLengthOptions(e,t){const r=this.customStrengthOptions.minPasswordLength,s=this.customStrengthOptions.maxPasswordLength;r&&(t.meetsMinPasswordLength=e.length>=r),s&&(t.meetsMaxPasswordLength=e.length<=s)}validatePasswordCharacterOptions(e,t){this.updatePasswordCharacterOptionsStatuses(t,!1,!1,!1,!1);let r;for(let s=0;s<e.length;s++)r=e.charAt(s),this.updatePasswordCharacterOptionsStatuses(t,r>="a"&&r<="z",r>="A"&&r<="Z",r>="0"&&r<="9",this.allowedNonAlphanumericCharacters.includes(r))}updatePasswordCharacterOptionsStatuses(e,t,r,s,i){this.customStrengthOptions.containsLowercaseLetter&&(e.containsLowercaseLetter||(e.containsLowercaseLetter=t)),this.customStrengthOptions.containsUppercaseLetter&&(e.containsUppercaseLetter||(e.containsUppercaseLetter=r)),this.customStrengthOptions.containsNumericCharacter&&(e.containsNumericCharacter||(e.containsNumericCharacter=s)),this.customStrengthOptions.containsNonAlphanumericCharacter&&(e.containsNonAlphanumericCharacter||(e.containsNonAlphanumericCharacter=i))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class GU{constructor(e,t,r,s){this.app=e,this.heartbeatServiceProvider=t,this.appCheckServiceProvider=r,this.config=s,this.currentUser=null,this.emulatorConfig=null,this.operations=Promise.resolve(),this.authStateSubscription=new ZS(this),this.idTokenSubscription=new ZS(this),this.beforeStateQueue=new $U(this),this.redirectUser=null,this.isProactiveRefreshEnabled=!1,this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION=1,this._canInitEmulator=!0,this._isInitialized=!1,this._deleted=!1,this._initializationPromise=null,this._popupRedirectResolver=null,this._errorFactory=fk,this._agentRecaptchaConfig=null,this._tenantRecaptchaConfigs={},this._projectPasswordPolicy=null,this._tenantPasswordPolicies={},this._resolvePersistenceManagerAvailable=void 0,this.lastNotifiedUid=void 0,this.languageCode=null,this.tenantId=null,this.settings={appVerificationDisabledForTesting:!1},this.frameworks=[],this.name=e.name,this.clientVersion=s.sdkClientVersion,this._persistenceManagerAvailable=new Promise(i=>this._resolvePersistenceManagerAvailable=i)}_initializeWithPersistence(e,t){return t&&(this._popupRedirectResolver=js(t)),this._initializationPromise=this.queue(async()=>{var r,s,i;if(!this._deleted&&(this.persistenceManager=await yl.create(this,e),(r=this._resolvePersistenceManagerAvailable)==null||r.call(this),!this._deleted)){if((s=this._popupRedirectResolver)!=null&&s._shouldInitProactively)try{await this._popupRedirectResolver._initialize(this)}catch{}await this.initializeCurrentUser(t),this.lastNotifiedUid=((i=this.currentUser)==null?void 0:i.uid)||null,!this._deleted&&(this._isInitialized=!0)}}),this._initializationPromise}async _onStorageEvent(){if(this._deleted)return;const e=await this.assertedPersistence.getCurrentUser();if(!(!this.currentUser&&!e)){if(this.currentUser&&e&&this.currentUser.uid===e.uid){this._currentUser._assign(e),await this.currentUser.getIdToken();return}await this._updateCurrentUser(e,!0)}}async initializeCurrentUserFromIdToken(e){try{const t=await Vp(this,{idToken:e}),r=await Kr._fromGetAccountInfoResponse(this,t,e);await this.directlySetCurrentUser(r)}catch(t){console.warn("FirebaseServerApp could not login user with provided authIdToken: ",t),await this.directlySetCurrentUser(null)}}async initializeCurrentUser(e){var i;if(Pt(this.app)){const o=this.app.settings.authIdToken;return o?new Promise(a=>{setTimeout(()=>this.initializeCurrentUserFromIdToken(o).then(a,a))}):this.directlySetCurrentUser(null)}const t=await this.assertedPersistence.getCurrentUser();let r=t,s=!1;if(e&&this.config.authDomain){await this.getOrInitRedirectPersistenceManager();const o=(i=this.redirectUser)==null?void 0:i._redirectEventId,a=r==null?void 0:r._redirectEventId,l=await this.tryRedirectSignIn(e);(!o||o===a)&&(l!=null&&l.user)&&(r=l.user,s=!0)}if(!r)return this.directlySetCurrentUser(null);if(!r._redirectEventId){if(s)try{await this.beforeStateQueue.runMiddleware(r)}catch(o){r=t,this._popupRedirectResolver._overrideRedirectResult(this,()=>Promise.reject(o))}return r?this.reloadAndSetCurrentUserOrClear(r):this.directlySetCurrentUser(null)}return K(this._popupRedirectResolver,this,"argument-error"),await this.getOrInitRedirectPersistenceManager(),this.redirectUser&&this.redirectUser._redirectEventId===r._redirectEventId?this.directlySetCurrentUser(r):this.reloadAndSetCurrentUserOrClear(r)}async tryRedirectSignIn(e){let t=null;try{t=await this._popupRedirectResolver._completeRedirectFn(this,e,!0)}catch{await this._setRedirectUser(null)}return t}async reloadAndSetCurrentUserOrClear(e){try{await Id(e)}catch(t){if((t==null?void 0:t.code)!=="auth/network-request-failed")return this.directlySetCurrentUser(null)}return this.directlySetCurrentUser(e)}useDeviceLanguage(){this.languageCode=TU()}async _delete(){this._deleted=!0}async updateCurrentUser(e){if(Pt(this.app))return Promise.reject(pn(this));const t=e?ne(e):null;return t&&K(t.auth.config.apiKey===this.config.apiKey,this,"invalid-user-token"),this._updateCurrentUser(t&&t._clone(this))}async _updateCurrentUser(e,t=!1){if(!this._deleted)return e&&K(this.tenantId===e.tenantId,this,"tenant-id-mismatch"),t||await this.beforeStateQueue.runMiddleware(e),this.queue(async()=>{await this.directlySetCurrentUser(e),this.notifyAuthListeners()})}async signOut(){return Pt(this.app)?Promise.reject(pn(this)):(await this.beforeStateQueue.runMiddleware(null),(this.redirectPersistenceManager||this._popupRedirectResolver)&&await this._setRedirectUser(null),this._updateCurrentUser(null,!0))}setPersistence(e){return Pt(this.app)?Promise.reject(pn(this)):this.queue(async()=>{await this.assertedPersistence.setPersistence(js(e))})}_getRecaptchaConfig(){return this.tenantId==null?this._agentRecaptchaConfig:this._tenantRecaptchaConfigs[this.tenantId]}async validatePassword(e){this._getPasswordPolicyInternal()||await this._updatePasswordPolicy();const t=this._getPasswordPolicyInternal();return t.schemaVersion!==this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION?Promise.reject(this._errorFactory.create("unsupported-password-policy-schema-version",{})):t.validatePassword(e)}_getPasswordPolicyInternal(){return this.tenantId===null?this._projectPasswordPolicy:this._tenantPasswordPolicies[this.tenantId]}async _updatePasswordPolicy(){const e=await zU(this),t=new WU(e);this.tenantId===null?this._projectPasswordPolicy=t:this._tenantPasswordPolicies[this.tenantId]=t}_getPersistenceType(){return this.assertedPersistence.persistence.type}_getPersistence(){return this.assertedPersistence.persistence}_updateErrorMap(e){this._errorFactory=new ya("auth","Firebase",e())}onAuthStateChanged(e,t,r){return this.registerStateListener(this.authStateSubscription,e,t,r)}beforeAuthStateChanged(e,t){return this.beforeStateQueue.pushCallback(e,t)}onIdTokenChanged(e,t,r){return this.registerStateListener(this.idTokenSubscription,e,t,r)}authStateReady(){return new Promise((e,t)=>{if(this.currentUser)e();else{const r=this.onAuthStateChanged(()=>{r(),e()},t)}})}async revokeAccessToken(e){if(this.currentUser){const t=await this.currentUser.getIdToken(),r={providerId:"apple.com",tokenType:"ACCESS_TOKEN",token:e,idToken:t};this.tenantId!=null&&(r.tenantId=this.tenantId),await jU(this,r)}}toJSON(){var e;return{apiKey:this.config.apiKey,authDomain:this.config.authDomain,appName:this.name,currentUser:(e=this._currentUser)==null?void 0:e.toJSON()}}async _setRedirectUser(e,t){const r=await this.getOrInitRedirectPersistenceManager(t);return e===null?r.removeCurrentUser():r.setCurrentUser(e)}async getOrInitRedirectPersistenceManager(e){if(!this.redirectPersistenceManager){const t=e&&js(e)||this._popupRedirectResolver;K(t,this,"argument-error"),this.redirectPersistenceManager=await yl.create(this,[js(t._redirectPersistence)],"redirectUser"),this.redirectUser=await this.redirectPersistenceManager.getCurrentUser()}return this.redirectPersistenceManager}async _redirectUserForId(e){var t,r;return this._isInitialized&&await this.queue(async()=>{}),((t=this._currentUser)==null?void 0:t._redirectEventId)===e?this._currentUser:((r=this.redirectUser)==null?void 0:r._redirectEventId)===e?this.redirectUser:null}async _persistUserIfCurrent(e){if(e===this.currentUser)return this.queue(async()=>this.directlySetCurrentUser(e))}_notifyListenersIfCurrent(e){e===this.currentUser&&this.notifyAuthListeners()}_key(){return`${this.config.authDomain}:${this.config.apiKey}:${this.name}`}_startProactiveRefresh(){this.isProactiveRefreshEnabled=!0,this.currentUser&&this._currentUser._startProactiveRefresh()}_stopProactiveRefresh(){this.isProactiveRefreshEnabled=!1,this.currentUser&&this._currentUser._stopProactiveRefresh()}get _currentUser(){return this.currentUser}notifyAuthListeners(){var t;if(!this._isInitialized)return;this.idTokenSubscription.next(this.currentUser);const e=((t=this.currentUser)==null?void 0:t.uid)??null;this.lastNotifiedUid!==e&&(this.lastNotifiedUid=e,this.authStateSubscription.next(this.currentUser))}registerStateListener(e,t,r,s){if(this._deleted)return()=>{};const i=typeof t=="function"?t:t.next.bind(t);let o=!1;const a=this._isInitialized?Promise.resolve():this._initializationPromise;if(K(a,this,"internal-error"),a.then(()=>{o||i(this.currentUser)}),typeof t=="function"){const l=e.addObserver(t,r,s);return()=>{o=!0,l()}}else{const l=e.addObserver(t);return()=>{o=!0,l()}}}async directlySetCurrentUser(e){this.currentUser&&this.currentUser!==e&&this._currentUser._stopProactiveRefresh(),e&&this.isProactiveRefreshEnabled&&e._startProactiveRefresh(),this.currentUser=e,e?await this.assertedPersistence.setCurrentUser(e):await this.assertedPersistence.removeCurrentUser()}queue(e){return this.operations=this.operations.then(e,e),this.operations}get assertedPersistence(){return K(this.persistenceManager,this,"internal-error"),this.persistenceManager}_logFramework(e){!e||this.frameworks.includes(e)||(this.frameworks.push(e),this.frameworks.sort(),this.clientVersion=Rk(this.config.clientPlatform,this._getFrameworks()))}_getFrameworks(){return this.frameworks}async _getAdditionalHeaders(){var s;const e={"X-Client-Version":this.clientVersion};this.app.options.appId&&(e["X-Firebase-gmpid"]=this.app.options.appId);const t=await((s=this.heartbeatServiceProvider.getImmediate({optional:!0}))==null?void 0:s.getHeartbeatsHeader());t&&(e["X-Firebase-Client"]=t);const r=await this._getAppCheckToken();return r&&(e["X-Firebase-AppCheck"]=r),e}async _getAppCheckToken(){var t;if(Pt(this.app)&&this.app.settings.appCheckToken)return this.app.settings.appCheckToken;const e=await((t=this.appCheckServiceProvider.getImmediate({optional:!0}))==null?void 0:t.getToken());return e!=null&&e.error&&EU(`Error while retrieving App Check token: ${e.error}`),e==null?void 0:e.token}}function zt(n){return ne(n)}class ZS{constructor(e){this.auth=e,this.observer=null,this.addObserver=HM(t=>this.observer=t)}get next(){return K(this.observer,this.auth,"internal-error"),this.observer.next.bind(this.observer)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let sh={async loadJS(){throw new Error("Unable to load external scripts")},recaptchaV2Script:"",recaptchaEnterpriseScript:"",gapiScript:""};function HU(n){sh=n}function yI(n){return sh.loadJS(n)}function KU(){return sh.recaptchaV2Script}function QU(){return sh.recaptchaEnterpriseScript}function YU(){return sh.gapiScript}function Nk(n){return`__${n}${Math.floor(Math.random()*1e6)}`}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const JU=500,XU=6e4,Xh=1e12;class ZU{constructor(e){this.auth=e,this.counter=Xh,this._widgets=new Map}render(e,t){const r=this.counter;return this._widgets.set(r,new nB(e,this.auth.name,t||{})),this.counter++,r}reset(e){var r;const t=e||Xh;(r=this._widgets.get(t))==null||r.delete(),this._widgets.delete(t)}getResponse(e){var r;const t=e||Xh;return((r=this._widgets.get(t))==null?void 0:r.getResponse())||""}async execute(e){var r;const t=e||Xh;return(r=this._widgets.get(t))==null||r.execute(),""}}class eB{constructor(){this.enterprise=new tB}ready(e){e()}execute(e,t){return Promise.resolve("token")}render(e,t){return""}}class tB{ready(e){e()}execute(e,t){return Promise.resolve("token")}render(e,t){return""}}class nB{constructor(e,t,r){this.params=r,this.timerId=null,this.deleted=!1,this.responseToken=null,this.clickHandler=()=>{this.execute()};const s=typeof e=="string"?document.getElementById(e):e;K(s,"argument-error",{appName:t}),this.container=s,this.isVisible=this.params.size!=="invisible",this.isVisible?this.execute():this.container.addEventListener("click",this.clickHandler)}getResponse(){return this.checkIfDeleted(),this.responseToken}delete(){this.checkIfDeleted(),this.deleted=!0,this.timerId&&(clearTimeout(this.timerId),this.timerId=null),this.container.removeEventListener("click",this.clickHandler)}execute(){this.checkIfDeleted(),!this.timerId&&(this.timerId=window.setTimeout(()=>{this.responseToken=rB(50);const{callback:e,"expired-callback":t}=this.params;if(e)try{e(this.responseToken)}catch{}this.timerId=window.setTimeout(()=>{if(this.timerId=null,this.responseToken=null,t)try{t()}catch{}this.isVisible&&this.execute()},XU)},JU))}checkIfDeleted(){if(this.deleted)throw new Error("reCAPTCHA mock was already deleted!")}}function rB(n){const e=[],t="1234567890abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ";for(let r=0;r<n;r++)e.push(t.charAt(Math.floor(Math.random()*t.length)));return e.join("")}const sB="recaptcha-enterprise",Nu="NO_RECAPTCHA";class Pk{constructor(e){this.type=sB,this.auth=zt(e)}async verify(e="verify",t=!1){async function r(i){if(!t){if(i.tenantId==null&&i._agentRecaptchaConfig!=null)return i._agentRecaptchaConfig.siteKey;if(i.tenantId!=null&&i._tenantRecaptchaConfigs[i.tenantId]!==void 0)return i._tenantRecaptchaConfigs[i.tenantId].siteKey}return new Promise(async(o,a)=>{_k(i,{clientType:"CLIENT_TYPE_WEB",version:"RECAPTCHA_ENTERPRISE"}).then(l=>{if(l.recaptchaKey===void 0)a(new Error("recaptcha Enterprise site key undefined"));else{const u=new yk(l);return i.tenantId==null?i._agentRecaptchaConfig=u:i._tenantRecaptchaConfigs[i.tenantId]=u,o(u.siteKey)}}).catch(l=>{a(l)})})}function s(i,o,a){const l=window.grecaptcha;KS(l)?l.enterprise.ready(()=>{l.enterprise.execute(i,{action:e}).then(u=>{o(u)}).catch(()=>{o(Nu)})}):a(Error("No reCAPTCHA enterprise script loaded."))}return this.auth.settings.appVerificationDisabledForTesting?new eB().execute("siteKey",{action:"verify"}):new Promise((i,o)=>{r(this.auth).then(a=>{if(!t&&KS(window.grecaptcha))s(a,i,o);else{if(typeof window>"u"){o(new Error("RecaptchaVerifier is only supported in browser"));return}let l=QU();l.length!==0&&(l+=a),yI(l).then(()=>{s(a,i,o)}).catch(u=>{o(u)})}}).catch(a=>{o(a)})})}}async function Gc(n,e,t,r=!1,s=!1){const i=new Pk(n);let o;if(s)o=Nu;else try{o=await i.verify(t)}catch{o=await i.verify(t,!0)}const a={...e};if(t==="mfaSmsEnrollment"||t==="mfaSmsSignIn"){if("phoneEnrollmentInfo"in a){const l=a.phoneEnrollmentInfo.phoneNumber,u=a.phoneEnrollmentInfo.recaptchaToken;Object.assign(a,{phoneEnrollmentInfo:{phoneNumber:l,recaptchaToken:u,captchaResponse:o,clientType:"CLIENT_TYPE_WEB",recaptchaVersion:"RECAPTCHA_ENTERPRISE"}})}else if("phoneSignInInfo"in a){const l=a.phoneSignInInfo.recaptchaToken;Object.assign(a,{phoneSignInInfo:{recaptchaToken:l,captchaResponse:o,clientType:"CLIENT_TYPE_WEB",recaptchaVersion:"RECAPTCHA_ENTERPRISE"}})}return a}return r?Object.assign(a,{captchaResp:o}):Object.assign(a,{captchaResponse:o}),Object.assign(a,{clientType:"CLIENT_TYPE_WEB"}),Object.assign(a,{recaptchaVersion:"RECAPTCHA_ENTERPRISE"}),a}async function Gi(n,e,t,r,s){var i,o;if(s==="EMAIL_PASSWORD_PROVIDER")if((i=n._getRecaptchaConfig())!=null&&i.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")){const a=await Gc(n,e,t,t==="getOobCode");return r(n,a)}else return r(n,e).catch(async a=>{if(a.code==="auth/missing-recaptcha-token"){console.log(`${t} is protected by reCAPTCHA Enterprise for this project. Automatically triggering the reCAPTCHA flow and restarting the flow.`);const l=await Gc(n,e,t,t==="getOobCode");return r(n,l)}else return Promise.reject(a)});else if(s==="PHONE_PROVIDER")if((o=n._getRecaptchaConfig())!=null&&o.isProviderEnabled("PHONE_PROVIDER")){const a=await Gc(n,e,t);return r(n,a).catch(async l=>{var u;if(((u=n._getRecaptchaConfig())==null?void 0:u.getProviderEnforcementState("PHONE_PROVIDER"))==="AUDIT"&&(l.code==="auth/missing-recaptcha-token"||l.code==="auth/invalid-app-credential")){console.log(`Failed to verify with reCAPTCHA Enterprise. Automatically triggering the reCAPTCHA v2 flow to complete the ${t} flow.`);const h=await Gc(n,e,t,!1,!0);return r(n,h)}return Promise.reject(l)})}else{const a=await Gc(n,e,t,!1,!0);return r(n,a)}else return Promise.reject(s+" provider is not supported.")}async function kk(n){const e=zt(n),t=await _k(e,{clientType:"CLIENT_TYPE_WEB",version:"RECAPTCHA_ENTERPRISE"}),r=new yk(t);e.tenantId==null?e._agentRecaptchaConfig=r:e._tenantRecaptchaConfigs[e.tenantId]=r,r.isAnyProviderEnabled()&&new Pk(e).verify()}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function iB(n,e){const t=bs(n,"auth");if(t.isInitialized()){const s=t.getImmediate(),i=t.getOptions();if(Ir(i,e??{}))return s;ir(s,"already-initialized")}return t.initialize({options:e})}function oB(n,e){const t=(e==null?void 0:e.persistence)||[],r=(Array.isArray(t)?t:[t]).map(js);e!=null&&e.errorMap&&n._updateErrorMap(e.errorMap),n._initializeWithPersistence(r,e==null?void 0:e.popupRedirectResolver)}function aB(n,e,t){const r=zt(n);K(/^https?:\/\//.test(e),r,"invalid-emulator-scheme");const s=!!(t!=null&&t.disableWarnings),i=Dk(e),{host:o,port:a}=lB(e),l=a===null?"":`:${a}`,u={url:`${i}//${o}${l}/`},h=Object.freeze({host:o,port:a,protocol:i.replace(":",""),options:Object.freeze({disableWarnings:s})});if(!r._canInitEmulator){K(r.config.emulator&&r.emulatorConfig,r,"emulator-config-failed"),K(Ir(u,r.config.emulator)&&Ir(h,r.emulatorConfig),r,"emulator-config-failed");return}r.config.emulator=u,r.emulatorConfig=h,r.settings.appVerificationDisabledForTesting=!0,ti(o)?(om(`${i}//${o}${l}`),_0("Auth",!0)):s||cB()}function Dk(n){const e=n.indexOf(":");return e<0?"":n.substr(0,e+1)}function lB(n){const e=Dk(n),t=/(\/\/)?([^?#/]+)/.exec(n.substr(e.length));if(!t)return{host:"",port:null};const r=t[2].split("@").pop()||"",s=/^(\[[^\]]+\])(:|$)/.exec(r);if(s){const i=s[1];return{host:i,port:eb(r.substr(i.length+1))}}else{const[i,o]=r.split(":");return{host:i,port:eb(o)}}}function eb(n){if(!n)return null;const e=Number(n);return isNaN(e)?null:e}function cB(){function n(){const e=document.createElement("p"),t=e.style;e.innerText="Running in emulator mode. Do not use with production credentials.",t.position="fixed",t.width="100%",t.backgroundColor="#ffffff",t.border=".1em solid #000000",t.color="#b50000",t.bottom="0px",t.left="0px",t.margin="0px",t.zIndex="10000",t.textAlign="center",e.classList.add("firebase-emulator-warning"),document.body.appendChild(e)}typeof console<"u"&&typeof console.info=="function"&&console.info("WARNING: You are using the Auth Emulator, which is intended for local testing only.  Do not use with production credentials."),typeof window<"u"&&typeof document<"u"&&(document.readyState==="loading"?window.addEventListener("DOMContentLoaded",n):n())}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ih{constructor(e,t){this.providerId=e,this.signInMethod=t}toJSON(){return ms("not implemented")}_getIdTokenResponse(e){return ms("not implemented")}_linkToIdToken(e,t){return ms("not implemented")}_getReauthenticationResolver(e){return ms("not implemented")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Ok(n,e){return bt(n,"POST","/v1/accounts:resetPassword",St(n,e))}async function uB(n,e){return bt(n,"POST","/v1/accounts:update",e)}async function dB(n,e){return bt(n,"POST","/v1/accounts:signUp",e)}async function hB(n,e){return bt(n,"POST","/v1/accounts:update",St(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function fB(n,e){return oi(n,"POST","/v1/accounts:signInWithPassword",St(n,e))}async function ng(n,e){return bt(n,"POST","/v1/accounts:sendOobCode",St(n,e))}async function pB(n,e){return ng(n,e)}async function mB(n,e){return ng(n,e)}async function gB(n,e){return ng(n,e)}async function yB(n,e){return ng(n,e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function _B(n,e){return oi(n,"POST","/v1/accounts:signInWithEmailLink",St(n,e))}async function vB(n,e){return oi(n,"POST","/v1/accounts:signInWithEmailLink",St(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ed extends ih{constructor(e,t,r,s=null){super("password",r),this._email=e,this._password=t,this._tenantId=s}static _fromEmailAndPassword(e,t){return new Ed(e,t,"password")}static _fromEmailAndCode(e,t,r=null){return new Ed(e,t,"emailLink",r)}toJSON(){return{email:this._email,password:this._password,signInMethod:this.signInMethod,tenantId:this._tenantId}}static fromJSON(e){const t=typeof e=="string"?JSON.parse(e):e;if(t!=null&&t.email&&(t!=null&&t.password)){if(t.signInMethod==="password")return this._fromEmailAndPassword(t.email,t.password);if(t.signInMethod==="emailLink")return this._fromEmailAndCode(t.email,t.password,t.tenantId)}return null}async _getIdTokenResponse(e){switch(this.signInMethod){case"password":const t={returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"};return Gi(e,t,"signInWithPassword",fB,"EMAIL_PASSWORD_PROVIDER");case"emailLink":return _B(e,{email:this._email,oobCode:this._password});default:ir(e,"internal-error")}}async _linkToIdToken(e,t){switch(this.signInMethod){case"password":const r={idToken:t,returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"};return Gi(e,r,"signUpPassword",dB,"EMAIL_PASSWORD_PROVIDER");case"emailLink":return vB(e,{idToken:t,email:this._email,oobCode:this._password});default:ir(e,"internal-error")}}_getReauthenticationResolver(e){return this._getIdTokenResponse(e)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function $s(n,e){return oi(n,"POST","/v1/accounts:signInWithIdp",St(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const wB="http://localhost";class Zs extends ih{constructor(){super(...arguments),this.pendingToken=null}static _fromParams(e){const t=new Zs(e.providerId,e.signInMethod);return e.idToken||e.accessToken?(e.idToken&&(t.idToken=e.idToken),e.accessToken&&(t.accessToken=e.accessToken),e.nonce&&!e.pendingToken&&(t.nonce=e.nonce),e.pendingToken&&(t.pendingToken=e.pendingToken)):e.oauthToken&&e.oauthTokenSecret?(t.accessToken=e.oauthToken,t.secret=e.oauthTokenSecret):ir("argument-error"),t}toJSON(){return{idToken:this.idToken,accessToken:this.accessToken,secret:this.secret,nonce:this.nonce,pendingToken:this.pendingToken,providerId:this.providerId,signInMethod:this.signInMethod}}static fromJSON(e){const t=typeof e=="string"?JSON.parse(e):e,{providerId:r,signInMethod:s,...i}=t;if(!r||!s)return null;const o=new Zs(r,s);return o.idToken=i.idToken||void 0,o.accessToken=i.accessToken||void 0,o.secret=i.secret,o.nonce=i.nonce,o.pendingToken=i.pendingToken||null,o}_getIdTokenResponse(e){const t=this.buildRequest();return $s(e,t)}_linkToIdToken(e,t){const r=this.buildRequest();return r.idToken=t,$s(e,r)}_getReauthenticationResolver(e){const t=this.buildRequest();return t.autoCreate=!1,$s(e,t)}buildRequest(){const e={requestUri:wB,returnSecureToken:!0};if(this.pendingToken)e.pendingToken=this.pendingToken;else{const t={};this.idToken&&(t.id_token=this.idToken),this.accessToken&&(t.access_token=this.accessToken),this.secret&&(t.oauth_token_secret=this.secret),t.providerId=this.providerId,this.nonce&&!this.pendingToken&&(t.nonce=this.nonce),e.postBody=_a(t)}return e}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function tb(n,e){return bt(n,"POST","/v1/accounts:sendVerificationCode",St(n,e))}async function IB(n,e){return oi(n,"POST","/v1/accounts:signInWithPhoneNumber",St(n,e))}async function EB(n,e){const t=await oi(n,"POST","/v1/accounts:signInWithPhoneNumber",St(n,e));if(t.temporaryProof)throw iu(n,"account-exists-with-different-credential",t);return t}const xB={USER_NOT_FOUND:"user-not-found"};async function TB(n,e){const t={...e,operation:"REAUTH"};return oi(n,"POST","/v1/accounts:signInWithPhoneNumber",St(n,t),xB)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Go extends ih{constructor(e){super("phone","phone"),this.params=e}static _fromVerification(e,t){return new Go({verificationId:e,verificationCode:t})}static _fromTokenResponse(e,t){return new Go({phoneNumber:e,temporaryProof:t})}_getIdTokenResponse(e){return IB(e,this._makeVerificationRequest())}_linkToIdToken(e,t){return EB(e,{idToken:t,...this._makeVerificationRequest()})}_getReauthenticationResolver(e){return TB(e,this._makeVerificationRequest())}_makeVerificationRequest(){const{temporaryProof:e,phoneNumber:t,verificationId:r,verificationCode:s}=this.params;return e&&t?{temporaryProof:e,phoneNumber:t}:{sessionInfo:r,code:s}}toJSON(){const e={providerId:this.providerId};return this.params.phoneNumber&&(e.phoneNumber=this.params.phoneNumber),this.params.temporaryProof&&(e.temporaryProof=this.params.temporaryProof),this.params.verificationCode&&(e.verificationCode=this.params.verificationCode),this.params.verificationId&&(e.verificationId=this.params.verificationId),e}static fromJSON(e){typeof e=="string"&&(e=JSON.parse(e));const{verificationId:t,verificationCode:r,phoneNumber:s,temporaryProof:i}=e;return!r&&!t&&!s&&!i?null:new Go({verificationId:t,verificationCode:r,phoneNumber:s,temporaryProof:i})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function SB(n){switch(n){case"recoverEmail":return"RECOVER_EMAIL";case"resetPassword":return"PASSWORD_RESET";case"signIn":return"EMAIL_SIGNIN";case"verifyEmail":return"VERIFY_EMAIL";case"verifyAndChangeEmail":return"VERIFY_AND_CHANGE_EMAIL";case"revertSecondFactorAddition":return"REVERT_SECOND_FACTOR_ADDITION";default:return null}}function bB(n){const e=Jc(Xc(n)).link,t=e?Jc(Xc(e)).deep_link_id:null,r=Jc(Xc(n)).deep_link_id;return(r?Jc(Xc(r)).link:null)||r||t||e||n}class oh{constructor(e){const t=Jc(Xc(e)),r=t.apiKey??null,s=t.oobCode??null,i=SB(t.mode??null);K(r&&s&&i,"argument-error"),this.apiKey=r,this.operation=i,this.code=s,this.continueUrl=t.continueUrl??null,this.languageCode=t.lang??null,this.tenantId=t.tenantId??null}static parseLink(e){const t=bB(e);try{return new oh(t)}catch{return null}}}function Eq(n){return oh.parseLink(n)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ra{constructor(){this.providerId=Ra.PROVIDER_ID}static credential(e,t){return Ed._fromEmailAndPassword(e,t)}static credentialWithLink(e,t){const r=oh.parseLink(t);return K(r,"argument-error"),Ed._fromEmailAndCode(e,r.code,r.tenantId)}}Ra.PROVIDER_ID="password";Ra.EMAIL_PASSWORD_SIGN_IN_METHOD="password";Ra.EMAIL_LINK_SIGN_IN_METHOD="emailLink";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ai{constructor(e){this.providerId=e,this.defaultLanguageCode=null,this.customParameters={}}setDefaultLanguage(e){this.defaultLanguageCode=e}setCustomParameters(e){return this.customParameters=e,this}getCustomParameters(){return this.customParameters}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class vc extends ai{constructor(){super(...arguments),this.scopes=[]}addScope(e){return this.scopes.includes(e)||this.scopes.push(e),this}getScopes(){return[...this.scopes]}}class Nf extends vc{static credentialFromJSON(e){const t=typeof e=="string"?JSON.parse(e):e;return K("providerId"in t&&"signInMethod"in t,"argument-error"),Zs._fromParams(t)}credential(e){return this._credential({...e,nonce:e.rawNonce})}_credential(e){return K(e.idToken||e.accessToken,"argument-error"),Zs._fromParams({...e,providerId:this.providerId,signInMethod:this.providerId})}static credentialFromResult(e){return Nf.oauthCredentialFromTaggedObject(e)}static credentialFromError(e){return Nf.oauthCredentialFromTaggedObject(e.customData||{})}static oauthCredentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthIdToken:t,oauthAccessToken:r,oauthTokenSecret:s,pendingToken:i,nonce:o,providerId:a}=e;if(!r&&!s&&!t&&!i||!a)return null;try{return new Nf(a)._credential({idToken:t,accessToken:r,nonce:o,pendingToken:i})}catch{return null}}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ii extends vc{constructor(){super("facebook.com")}static credential(e){return Zs._fromParams({providerId:Ii.PROVIDER_ID,signInMethod:Ii.FACEBOOK_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return Ii.credentialFromTaggedObject(e)}static credentialFromError(e){return Ii.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return Ii.credential(e.oauthAccessToken)}catch{return null}}}Ii.FACEBOOK_SIGN_IN_METHOD="facebook.com";Ii.PROVIDER_ID="facebook.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Os extends vc{constructor(){super("google.com"),this.addScope("profile")}static credential(e,t){return Zs._fromParams({providerId:Os.PROVIDER_ID,signInMethod:Os.GOOGLE_SIGN_IN_METHOD,idToken:e,accessToken:t})}static credentialFromResult(e){return Os.credentialFromTaggedObject(e)}static credentialFromError(e){return Os.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthIdToken:t,oauthAccessToken:r}=e;if(!t&&!r)return null;try{return Os.credential(t,r)}catch{return null}}}Os.GOOGLE_SIGN_IN_METHOD="google.com";Os.PROVIDER_ID="google.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ei extends vc{constructor(){super("github.com")}static credential(e){return Zs._fromParams({providerId:Ei.PROVIDER_ID,signInMethod:Ei.GITHUB_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return Ei.credentialFromTaggedObject(e)}static credentialFromError(e){return Ei.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return Ei.credential(e.oauthAccessToken)}catch{return null}}}Ei.GITHUB_SIGN_IN_METHOD="github.com";Ei.PROVIDER_ID="github.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const AB="http://localhost";class xd extends ih{constructor(e,t){super(e,e),this.pendingToken=t}_getIdTokenResponse(e){const t=this.buildRequest();return $s(e,t)}_linkToIdToken(e,t){const r=this.buildRequest();return r.idToken=t,$s(e,r)}_getReauthenticationResolver(e){const t=this.buildRequest();return t.autoCreate=!1,$s(e,t)}toJSON(){return{signInMethod:this.signInMethod,providerId:this.providerId,pendingToken:this.pendingToken}}static fromJSON(e){const t=typeof e=="string"?JSON.parse(e):e,{providerId:r,signInMethod:s,pendingToken:i}=t;return!r||!s||!i||r!==s?null:new xd(r,i)}static _create(e,t){return new xd(e,t)}buildRequest(){return{requestUri:AB,returnSecureToken:!0,pendingToken:this.pendingToken}}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const CB="saml.";class wv extends ai{constructor(e){K(e.startsWith(CB),"argument-error"),super(e)}static credentialFromResult(e){return wv.samlCredentialFromTaggedObject(e)}static credentialFromError(e){return wv.samlCredentialFromTaggedObject(e.customData||{})}static credentialFromJSON(e){const t=xd.fromJSON(e);return K(t,"argument-error"),t}static samlCredentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{pendingToken:t,providerId:r}=e;if(!t||!r)return null;try{return xd._create(r,t)}catch{return null}}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class xi extends vc{constructor(){super("twitter.com")}static credential(e,t){return Zs._fromParams({providerId:xi.PROVIDER_ID,signInMethod:xi.TWITTER_SIGN_IN_METHOD,oauthToken:e,oauthTokenSecret:t})}static credentialFromResult(e){return xi.credentialFromTaggedObject(e)}static credentialFromError(e){return xi.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthAccessToken:t,oauthTokenSecret:r}=e;if(!t||!r)return null;try{return xi.credential(t,r)}catch{return null}}}xi.TWITTER_SIGN_IN_METHOD="twitter.com";xi.PROVIDER_ID="twitter.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Mk(n,e){return oi(n,"POST","/v1/accounts:signUp",St(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Fr{constructor(e){this.user=e.user,this.providerId=e.providerId,this._tokenResponse=e._tokenResponse,this.operationType=e.operationType}static async _fromIdTokenResponse(e,t,r,s=!1){const i=await Kr._fromIdTokenResponse(e,r,s),o=nb(r);return new Fr({user:i,providerId:o,_tokenResponse:r,operationType:t})}static async _forOperation(e,t,r){await e._updateTokensIfNecessary(r,!0);const s=nb(r);return new Fr({user:e,providerId:s,_tokenResponse:r,operationType:t})}}function nb(n){return n.providerId?n.providerId:"phoneNumber"in n?"phone":null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function xq(n){var s;if(Pt(n.app))return Promise.reject(pn(n));const e=zt(n);if(await e._initializationPromise,(s=e.currentUser)!=null&&s.isAnonymous)return new Fr({user:e.currentUser,providerId:null,operationType:"signIn"});const t=await Mk(e,{returnSecureToken:!0}),r=await Fr._fromIdTokenResponse(e,"signIn",t,!0);return await e._updateCurrentUser(r.user),r}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Fp extends ts{constructor(e,t,r,s){super(t.code,t.message),this.operationType=r,this.user=s,Object.setPrototypeOf(this,Fp.prototype),this.customData={appName:e.name,tenantId:e.tenantId??void 0,_serverResponse:t.customData._serverResponse,operationType:r}}static _fromErrorAndOperation(e,t,r,s){return new Fp(e,t,r,s)}}function Lk(n,e,t,r){return(e==="reauthenticate"?t._getReauthenticationResolver(n):t._getIdTokenResponse(n)).catch(i=>{throw i.code==="auth/multi-factor-auth-required"?Fp._fromErrorAndOperation(n,i,e,r):i})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Vk(n){return new Set(n.map(({providerId:e})=>e).filter(e=>!!e))}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Tq(n,e){const t=ne(n);await rg(!0,t,e);const{providerUserInfo:r}=await kU(t.auth,{idToken:await t.getIdToken(),deleteProvider:[e]}),s=Vk(r||[]);return t.providerData=t.providerData.filter(i=>s.has(i.providerId)),s.has("phone")||(t.phoneNumber=null),await t.auth._persistUserIfCurrent(t),t}async function _I(n,e,t=!1){const r=await Xs(n,e._linkToIdToken(n.auth,await n.getIdToken()),t);return Fr._forOperation(n,"link",r)}async function rg(n,e,t){await Id(e);const r=Vk(e.providerData),s=n===!1?"provider-already-linked":"no-such-provider";K(r.has(t)===n,e.auth,s)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Fk(n,e,t=!1){const{auth:r}=n;if(Pt(r.app))return Promise.reject(pn(r));const s="reauthenticate";try{const i=await Xs(n,Lk(r,s,e,n),t);K(i.idToken,r,"internal-error");const o=tg(i.idToken);K(o,r,"internal-error");const{sub:a}=o;return K(n.uid===a,r,"user-mismatch"),Fr._forOperation(n,s,i)}catch(i){throw(i==null?void 0:i.code)==="auth/user-not-found"&&ir(r,"user-mismatch"),i}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function jk(n,e,t=!1){if(Pt(n.app))return Promise.reject(pn(n));const r="signIn",s=await Lk(n,r,e),i=await Fr._fromIdTokenResponse(n,r,s);return t||await n._updateCurrentUser(i.user),i}async function vI(n,e){return jk(zt(n),e)}async function RB(n,e){const t=ne(n);return await rg(!1,t,e.providerId),_I(t,e)}async function NB(n,e){return Fk(ne(n),e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function PB(n,e){return oi(n,"POST","/v1/accounts:signInWithCustomToken",St(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Sq(n,e){if(Pt(n.app))return Promise.reject(pn(n));const t=zt(n),r=await PB(t,{token:e,returnSecureToken:!0}),s=await Fr._fromIdTokenResponse(t,"signIn",r);return await t._updateCurrentUser(s.user),s}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ah{constructor(e,t){this.factorId=e,this.uid=t.mfaEnrollmentId,this.enrollmentTime=new Date(t.enrolledAt).toUTCString(),this.displayName=t.displayName}static _fromServerResponse(e,t){return"phoneInfo"in t?wI._fromServerResponse(e,t):"totpInfo"in t?II._fromServerResponse(e,t):ir(e,"internal-error")}}class wI extends ah{constructor(e){super("phone",e),this.phoneNumber=e.phoneInfo}static _fromServerResponse(e,t){return new wI(t)}}class II extends ah{constructor(e){super("totp",e)}static _fromServerResponse(e,t){return new II(t)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function sg(n,e,t){var r;K(((r=t.url)==null?void 0:r.length)>0,n,"invalid-continue-uri"),K(typeof t.dynamicLinkDomain>"u"||t.dynamicLinkDomain.length>0,n,"invalid-dynamic-link-domain"),K(typeof t.linkDomain>"u"||t.linkDomain.length>0,n,"invalid-hosting-link-domain"),e.continueUrl=t.url,e.dynamicLinkDomain=t.dynamicLinkDomain,e.linkDomain=t.linkDomain,e.canHandleCodeInApp=t.handleCodeInApp,t.iOS&&(K(t.iOS.bundleId.length>0,n,"missing-ios-bundle-id"),e.iOSBundleId=t.iOS.bundleId),t.android&&(K(t.android.packageName.length>0,n,"missing-android-pkg-name"),e.androidInstallApp=t.android.installApp,e.androidMinimumVersionCode=t.android.minimumVersion,e.androidPackageName=t.android.packageName)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function EI(n){const e=zt(n);e._getPasswordPolicyInternal()&&await e._updatePasswordPolicy()}async function kB(n,e,t){const r=zt(n),s={requestType:"PASSWORD_RESET",email:e,clientType:"CLIENT_TYPE_WEB"};t&&sg(r,s,t),await Gi(r,s,"getOobCode",mB,"EMAIL_PASSWORD_PROVIDER")}async function bq(n,e,t){await Ok(ne(n),{oobCode:e,newPassword:t}).catch(async r=>{throw r.code==="auth/password-does-not-meet-requirements"&&EI(n),r})}async function Aq(n,e){await hB(ne(n),{oobCode:e})}async function DB(n,e){const t=ne(n),r=await Ok(t,{oobCode:e}),s=r.requestType;switch(K(s,t,"internal-error"),s){case"EMAIL_SIGNIN":break;case"VERIFY_AND_CHANGE_EMAIL":K(r.newEmail,t,"internal-error");break;case"REVERT_SECOND_FACTOR_ADDITION":K(r.mfaInfo,t,"internal-error");default:K(r.email,t,"internal-error")}let i=null;return r.mfaInfo&&(i=ah._fromServerResponse(zt(t),r.mfaInfo)),{data:{email:(r.requestType==="VERIFY_AND_CHANGE_EMAIL"?r.newEmail:r.email)||null,previousEmail:(r.requestType==="VERIFY_AND_CHANGE_EMAIL"?r.email:r.newEmail)||null,multiFactorInfo:i},operation:s}}async function Cq(n,e){const{data:t}=await DB(ne(n),e);return t.email}async function OB(n,e,t){if(Pt(n.app))return Promise.reject(pn(n));const r=zt(n),o=await Gi(r,{returnSecureToken:!0,email:e,password:t,clientType:"CLIENT_TYPE_WEB"},"signUpPassword",Mk,"EMAIL_PASSWORD_PROVIDER").catch(l=>{throw l.code==="auth/password-does-not-meet-requirements"&&EI(n),l}),a=await Fr._fromIdTokenResponse(r,"signIn",o);return await r._updateCurrentUser(a.user),a}function MB(n,e,t){return Pt(n.app)?Promise.reject(pn(n)):vI(ne(n),Ra.credential(e,t)).catch(async r=>{throw r.code==="auth/password-does-not-meet-requirements"&&EI(n),r})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Rq(n,e,t){const r=zt(n),s={requestType:"EMAIL_SIGNIN",email:e,clientType:"CLIENT_TYPE_WEB"};function i(o,a){K(a.handleCodeInApp,r,"argument-error"),a&&sg(r,o,a)}i(s,t),await Gi(r,s,"getOobCode",gB,"EMAIL_PASSWORD_PROVIDER")}function Nq(n,e){const t=oh.parseLink(e);return(t==null?void 0:t.operation)==="EMAIL_SIGNIN"}async function Pq(n,e,t){if(Pt(n.app))return Promise.reject(pn(n));const r=ne(n),s=Ra.credentialWithLink(e,t||wd());return K(s._tenantId===(r.tenantId||null),r,"tenant-id-mismatch"),vI(r,s)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function LB(n,e){return bt(n,"POST","/v1/accounts:createAuthUri",St(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function kq(n,e){const t=pI()?wd():"http://localhost",r={identifier:e,continueUri:t},{signinMethods:s}=await LB(ne(n),r);return s||[]}async function VB(n,e){const t=ne(n),s={requestType:"VERIFY_EMAIL",idToken:await n.getIdToken()};e&&sg(t.auth,s,e);const{email:i}=await pB(t.auth,s);i!==n.email&&await n.reload()}async function Dq(n,e,t){const r=ne(n),i={requestType:"VERIFY_AND_CHANGE_EMAIL",idToken:await n.getIdToken(),newEmail:e};t&&sg(r.auth,i,t);const{email:o}=await yB(r.auth,i);o!==n.email&&await n.reload()}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function FB(n,e){return bt(n,"POST","/v1/accounts:update",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Oq(n,{displayName:e,photoURL:t}){if(e===void 0&&t===void 0)return;const r=ne(n),i={idToken:await r.getIdToken(),displayName:e,photoUrl:t,returnSecureToken:!0},o=await Xs(r,FB(r.auth,i));r.displayName=o.displayName||null,r.photoURL=o.photoUrl||null;const a=r.providerData.find(({providerId:l})=>l==="password");a&&(a.displayName=r.displayName,a.photoURL=r.photoURL),await r._updateTokensIfNecessary(o)}function Mq(n,e){const t=ne(n);return Pt(t.auth.app)?Promise.reject(pn(t.auth)):Uk(t,e,null)}function Lq(n,e){return Uk(ne(n),null,e)}async function Uk(n,e,t){const{auth:r}=n,i={idToken:await n.getIdToken(),returnSecureToken:!0};e&&(i.email=e),t&&(i.password=t);const o=await Xs(n,uB(r,i));await n._updateTokensIfNecessary(o,!0)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function jB(n){var s,i;if(!n)return null;const{providerId:e}=n,t=n.rawUserInfo?JSON.parse(n.rawUserInfo):{},r=n.isNewUser||n.kind==="identitytoolkit#SignupNewUserResponse";if(!e&&(n!=null&&n.idToken)){const o=(i=(s=tg(n.idToken))==null?void 0:s.firebase)==null?void 0:i.sign_in_provider;if(o){const a=o!=="anonymous"&&o!=="custom"?o:null;return new _l(r,a)}}if(!e)return null;switch(e){case"facebook.com":return new UB(r,t);case"github.com":return new BB(r,t);case"google.com":return new $B(r,t);case"twitter.com":return new zB(r,t,n.screenName||null);case"custom":case"anonymous":return new _l(r,null);default:return new _l(r,e,t)}}class _l{constructor(e,t,r={}){this.isNewUser=e,this.providerId=t,this.profile=r}}class Bk extends _l{constructor(e,t,r,s){super(e,t,r),this.username=s}}class UB extends _l{constructor(e,t){super(e,"facebook.com",t)}}class BB extends Bk{constructor(e,t){super(e,"github.com",t,typeof(t==null?void 0:t.login)=="string"?t==null?void 0:t.login:null)}}class $B extends _l{constructor(e,t){super(e,"google.com",t)}}class zB extends Bk{constructor(e,t,r){super(e,"twitter.com",t,r)}}function Vq(n){const{user:e,_tokenResponse:t}=n;return e.isAnonymous&&!t?{providerId:null,isNewUser:!1,profile:null}:jB(t)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function qB(n,e){return ne(n).setPersistence(e)}function Fq(n){return kk(n)}async function jq(n,e){return zt(n).validatePassword(e)}function WB(n,e,t,r){return ne(n).onIdTokenChanged(e,t,r)}function GB(n,e,t){return ne(n).beforeAuthStateChanged(e,t)}function Uq(n,e,t,r){return ne(n).onAuthStateChanged(e,t,r)}function Bq(n){ne(n).useDeviceLanguage()}function $q(n,e){return ne(n).updateCurrentUser(e)}function zq(n){return ne(n).signOut()}function qq(n,e){return zt(n).revokeAccessToken(e)}async function Wq(n){return ne(n).delete()}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Fo{constructor(e,t,r){this.type=e,this.credential=t,this.user=r}static _fromIdtoken(e,t){return new Fo("enroll",e,t)}static _fromMfaPendingCredential(e){return new Fo("signin",e)}toJSON(){return{multiFactorSession:{[this.type==="enroll"?"idToken":"pendingCredential"]:this.credential}}}static fromJSON(e){var t,r;if(e!=null&&e.multiFactorSession){if((t=e.multiFactorSession)!=null&&t.pendingCredential)return Fo._fromMfaPendingCredential(e.multiFactorSession.pendingCredential);if((r=e.multiFactorSession)!=null&&r.idToken)return Fo._fromIdtoken(e.multiFactorSession.idToken)}return null}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class xI{constructor(e,t,r){this.session=e,this.hints=t,this.signInResolver=r}static _fromError(e,t){const r=zt(e),s=t.customData._serverResponse,i=(s.mfaInfo||[]).map(a=>ah._fromServerResponse(r,a));K(s.mfaPendingCredential,r,"internal-error");const o=Fo._fromMfaPendingCredential(s.mfaPendingCredential);return new xI(o,i,async a=>{const l=await a._process(r,o);delete s.mfaInfo,delete s.mfaPendingCredential;const u={...s,idToken:l.idToken,refreshToken:l.refreshToken};switch(t.operationType){case"signIn":const h=await Fr._fromIdTokenResponse(r,t.operationType,u);return await r._updateCurrentUser(h.user),h;case"reauthenticate":return K(t.user,r,"internal-error"),Fr._forOperation(t.user,t.operationType,u);default:ir(r,"internal-error")}})}async resolveSignIn(e){const t=e;return this.signInResolver(t)}}function Gq(n,e){var s;const t=ne(n),r=e;return K(e.customData.operationType,t,"argument-error"),K((s=r.customData._serverResponse)==null?void 0:s.mfaPendingCredential,t,"argument-error"),xI._fromError(t,r)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function rb(n,e){return bt(n,"POST","/v2/accounts/mfaEnrollment:start",St(n,e))}function HB(n,e){return bt(n,"POST","/v2/accounts/mfaEnrollment:finalize",St(n,e))}function KB(n,e){return bt(n,"POST","/v2/accounts/mfaEnrollment:start",St(n,e))}function QB(n,e){return bt(n,"POST","/v2/accounts/mfaEnrollment:finalize",St(n,e))}function YB(n,e){return bt(n,"POST","/v2/accounts/mfaEnrollment:withdraw",St(n,e))}class TI{constructor(e){this.user=e,this.enrolledFactors=[],e._onReload(t=>{t.mfaInfo&&(this.enrolledFactors=t.mfaInfo.map(r=>ah._fromServerResponse(e.auth,r)))})}static _fromUser(e){return new TI(e)}async getSession(){return Fo._fromIdtoken(await this.user.getIdToken(),this.user)}async enroll(e,t){const r=e,s=await this.getSession(),i=await Xs(this.user,r._process(this.user.auth,s,t));return await this.user._updateTokensIfNecessary(i),this.user.reload()}async unenroll(e){const t=typeof e=="string"?e:e.uid,r=await this.user.getIdToken();try{const s=await Xs(this.user,YB(this.user.auth,{idToken:r,mfaEnrollmentId:t}));this.enrolledFactors=this.enrolledFactors.filter(({uid:i})=>i!==t),await this.user._updateTokensIfNecessary(s),await this.user.reload()}catch(s){throw s}}}const Iy=new WeakMap;function Hq(n){const e=ne(n);return Iy.has(e)||Iy.set(e,TI._fromUser(e)),Iy.get(e)}const jp="__sak";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class $k{constructor(e,t){this.storageRetriever=e,this.type=t}_isAvailable(){try{return this.storage?(this.storage.setItem(jp,"1"),this.storage.removeItem(jp),Promise.resolve(!0)):Promise.resolve(!1)}catch{return Promise.resolve(!1)}}_set(e,t){return this.storage.setItem(e,JSON.stringify(t)),Promise.resolve()}_get(e){const t=this.storage.getItem(e);return Promise.resolve(t?JSON.parse(t):null)}_remove(e){return this.storage.removeItem(e),Promise.resolve()}get storage(){return this.storageRetriever()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const JB=1e3,XB=10;class zk extends $k{constructor(){super(()=>window.localStorage,"LOCAL"),this.boundEventHandler=(e,t)=>this.onStorageEvent(e,t),this.listeners={},this.localCache={},this.pollTimer=null,this.fallbackToPolling=Ck(),this._shouldAllowMigration=!0}forAllChangedKeys(e){for(const t of Object.keys(this.listeners)){const r=this.storage.getItem(t),s=this.localCache[t];r!==s&&e(t,s,r)}}onStorageEvent(e,t=!1){if(!e.key){this.forAllChangedKeys((o,a,l)=>{this.notifyListeners(o,l)});return}const r=e.key;t?this.detachListener():this.stopPolling();const s=()=>{const o=this.storage.getItem(r);!t&&this.localCache[r]===o||this.notifyListeners(r,o)},i=this.storage.getItem(r);BU()&&i!==e.newValue&&e.newValue!==e.oldValue?setTimeout(s,XB):s()}notifyListeners(e,t){this.localCache[e]=t;const r=this.listeners[e];if(r)for(const s of Array.from(r))s(t&&JSON.parse(t))}startPolling(){this.stopPolling(),this.pollTimer=setInterval(()=>{this.forAllChangedKeys((e,t,r)=>{this.onStorageEvent(new StorageEvent("storage",{key:e,oldValue:t,newValue:r}),!0)})},JB)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}attachListener(){window.addEventListener("storage",this.boundEventHandler)}detachListener(){window.removeEventListener("storage",this.boundEventHandler)}_addListener(e,t){Object.keys(this.listeners).length===0&&(this.fallbackToPolling?this.startPolling():this.attachListener()),this.listeners[e]||(this.listeners[e]=new Set,this.localCache[e]=this.storage.getItem(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),this.listeners[e].size===0&&delete this.listeners[e]),Object.keys(this.listeners).length===0&&(this.detachListener(),this.stopPolling())}async _set(e,t){await super._set(e,t),this.localCache[e]=JSON.stringify(t)}async _get(e){const t=await super._get(e);return this.localCache[e]=JSON.stringify(t),t}async _remove(e){await super._remove(e),delete this.localCache[e]}}zk.type="LOCAL";const qk=zk;/**
 * @license
 * Copyright 2025 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ZB=1e3;function Ey(n){var r;const e=n.replace(/[\\^$.*+?()[\]{}|]/g,"\\$&"),t=RegExp(`${e}=([^;]+)`);return((r=document.cookie.match(t))==null?void 0:r[1])??null}function xy(n){return`${window.location.protocol==="http:"?"__dev_":"__HOST-"}FIREBASE_${n.split(":")[3]}`}class Wk{constructor(){this.type="COOKIE",this.listenerUnsubscribes=new Map}_getFinalTarget(e){if(typeof window===void 0)return e;const t=new URL(`${window.location.origin}/__cookies__`);return t.searchParams.set("finalTarget",e),t}async _isAvailable(){return typeof isSecureContext=="boolean"&&!isSecureContext||typeof navigator>"u"||typeof document>"u"?!1:navigator.cookieEnabled??!0}async _set(e,t){}async _get(e){if(!this._isAvailable())return null;const t=xy(e);if(window.cookieStore){const r=await window.cookieStore.get(t);return r==null?void 0:r.value}return Ey(t)}async _remove(e){if(!this._isAvailable()||!await this._get(e))return;const r=xy(e);document.cookie=`${r}=;Max-Age=34560000;Partitioned;Secure;SameSite=Strict;Path=/;Priority=High`,await fetch("/__cookies__",{method:"DELETE"}).catch(()=>{})}_addListener(e,t){if(!this._isAvailable())return;const r=xy(e);if(window.cookieStore){const a=u=>{const h=u.changed.find(p=>p.name===r);h&&t(h.value),u.deleted.find(p=>p.name===r)&&t(null)},l=()=>window.cookieStore.removeEventListener("change",a);return this.listenerUnsubscribes.set(t,l),window.cookieStore.addEventListener("change",a)}let s=Ey(r);const i=setInterval(()=>{const a=Ey(r);a!==s&&(t(a),s=a)},ZB),o=()=>clearInterval(i);this.listenerUnsubscribes.set(t,o)}_removeListener(e,t){const r=this.listenerUnsubscribes.get(t);r&&(r(),this.listenerUnsubscribes.delete(t))}}Wk.type="COOKIE";const Kq=Wk;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Gk extends $k{constructor(){super(()=>window.sessionStorage,"SESSION")}_addListener(e,t){}_removeListener(e,t){}}Gk.type="SESSION";const Hk=Gk;/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function e$(n){return Promise.all(n.map(async e=>{try{return{fulfilled:!0,value:await e}}catch(t){return{fulfilled:!1,reason:t}}}))}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ig{constructor(e){this.eventTarget=e,this.handlersMap={},this.boundEventHandler=this.handleEvent.bind(this)}static _getInstance(e){const t=this.receivers.find(s=>s.isListeningto(e));if(t)return t;const r=new ig(e);return this.receivers.push(r),r}isListeningto(e){return this.eventTarget===e}async handleEvent(e){const t=e,{eventId:r,eventType:s,data:i}=t.data,o=this.handlersMap[s];if(!(o!=null&&o.size))return;t.ports[0].postMessage({status:"ack",eventId:r,eventType:s});const a=Array.from(o).map(async u=>u(t.origin,i)),l=await e$(a);t.ports[0].postMessage({status:"done",eventId:r,eventType:s,response:l})}_subscribe(e,t){Object.keys(this.handlersMap).length===0&&this.eventTarget.addEventListener("message",this.boundEventHandler),this.handlersMap[e]||(this.handlersMap[e]=new Set),this.handlersMap[e].add(t)}_unsubscribe(e,t){this.handlersMap[e]&&t&&this.handlersMap[e].delete(t),(!t||this.handlersMap[e].size===0)&&delete this.handlersMap[e],Object.keys(this.handlersMap).length===0&&this.eventTarget.removeEventListener("message",this.boundEventHandler)}}ig.receivers=[];/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function og(n="",e=10){let t="";for(let r=0;r<e;r++)t+=Math.floor(Math.random()*10);return n+t}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class t${constructor(e){this.target=e,this.handlers=new Set}removeMessageHandler(e){e.messageChannel&&(e.messageChannel.port1.removeEventListener("message",e.onMessage),e.messageChannel.port1.close()),this.handlers.delete(e)}async _send(e,t,r=50){const s=typeof MessageChannel<"u"?new MessageChannel:null;if(!s)throw new Error("connection_unavailable");let i,o;return new Promise((a,l)=>{const u=og("",20);s.port1.start();const h=setTimeout(()=>{l(new Error("unsupported_event"))},r);o={messageChannel:s,onMessage(f){const p=f;if(p.data.eventId===u)switch(p.data.status){case"ack":clearTimeout(h),i=setTimeout(()=>{l(new Error("timeout"))},3e3);break;case"done":clearTimeout(i),a(p.data.response);break;default:clearTimeout(h),clearTimeout(i),l(new Error("invalid_response"));break}}},this.handlers.add(o),s.port1.addEventListener("message",o.onMessage),this.target.postMessage({eventType:e,eventId:u,data:t},[s.port2])}).finally(()=>{o&&this.removeMessageHandler(o)})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Qt(){return window}function n$(n){Qt().location.href=n}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function SI(){return typeof Qt().WorkerGlobalScope<"u"&&typeof Qt().importScripts=="function"}async function r$(){if(!(navigator!=null&&navigator.serviceWorker))return null;try{return(await navigator.serviceWorker.ready).active}catch{return null}}function s$(){var n;return((n=navigator==null?void 0:navigator.serviceWorker)==null?void 0:n.controller)||null}function i$(){return SI()?self:null}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Kk="firebaseLocalStorageDb",o$=1,Up="firebaseLocalStorage",Qk="fbase_key";class lh{constructor(e){this.request=e}toPromise(){return new Promise((e,t)=>{this.request.addEventListener("success",()=>{e(this.request.result)}),this.request.addEventListener("error",()=>{t(this.request.error)})})}}function ag(n,e){return n.transaction([Up],e?"readwrite":"readonly").objectStore(Up)}function a$(){const n=indexedDB.deleteDatabase(Kk);return new lh(n).toPromise()}function Iv(){const n=indexedDB.open(Kk,o$);return new Promise((e,t)=>{n.addEventListener("error",()=>{t(n.error)}),n.addEventListener("upgradeneeded",()=>{const r=n.result;try{r.createObjectStore(Up,{keyPath:Qk})}catch(s){t(s)}}),n.addEventListener("success",async()=>{const r=n.result;r.objectStoreNames.contains(Up)?e(r):(r.close(),await a$(),e(await Iv()))})})}async function sb(n,e,t){const r=ag(n,!0).put({[Qk]:e,value:t});return new lh(r).toPromise()}async function l$(n,e){const t=ag(n,!1).get(e),r=await new lh(t).toPromise();return r===void 0?null:r.value}function ib(n,e){const t=ag(n,!0).delete(e);return new lh(t).toPromise()}const c$=800,u$=3;class Yk{constructor(){this.type="LOCAL",this._shouldAllowMigration=!0,this.listeners={},this.localCache={},this.pollTimer=null,this.pendingWrites=0,this.receiver=null,this.sender=null,this.serviceWorkerReceiverAvailable=!1,this.activeServiceWorker=null,this._workerInitializationPromise=this.initializeServiceWorkerMessaging().then(()=>{},()=>{})}async _openDb(){return this.db?this.db:(this.db=await Iv(),this.db)}async _withRetries(e){let t=0;for(;;)try{const r=await this._openDb();return await e(r)}catch(r){if(t++>u$)throw r;this.db&&(this.db.close(),this.db=void 0)}}async initializeServiceWorkerMessaging(){return SI()?this.initializeReceiver():this.initializeSender()}async initializeReceiver(){this.receiver=ig._getInstance(i$()),this.receiver._subscribe("keyChanged",async(e,t)=>({keyProcessed:(await this._poll()).includes(t.key)})),this.receiver._subscribe("ping",async(e,t)=>["keyChanged"])}async initializeSender(){var t,r;if(this.activeServiceWorker=await r$(),!this.activeServiceWorker)return;this.sender=new t$(this.activeServiceWorker);const e=await this.sender._send("ping",{},800);e&&(t=e[0])!=null&&t.fulfilled&&(r=e[0])!=null&&r.value.includes("keyChanged")&&(this.serviceWorkerReceiverAvailable=!0)}async notifyServiceWorker(e){if(!(!this.sender||!this.activeServiceWorker||s$()!==this.activeServiceWorker))try{await this.sender._send("keyChanged",{key:e},this.serviceWorkerReceiverAvailable?800:50)}catch{}}async _isAvailable(){try{if(!indexedDB)return!1;const e=await Iv();return await sb(e,jp,"1"),await ib(e,jp),!0}catch{}return!1}async _withPendingWrite(e){this.pendingWrites++;try{await e()}finally{this.pendingWrites--}}async _set(e,t){return this._withPendingWrite(async()=>(await this._withRetries(r=>sb(r,e,t)),this.localCache[e]=t,this.notifyServiceWorker(e)))}async _get(e){const t=await this._withRetries(r=>l$(r,e));return this.localCache[e]=t,t}async _remove(e){return this._withPendingWrite(async()=>(await this._withRetries(t=>ib(t,e)),delete this.localCache[e],this.notifyServiceWorker(e)))}async _poll(){const e=await this._withRetries(s=>{const i=ag(s,!1).getAll();return new lh(i).toPromise()});if(!e)return[];if(this.pendingWrites!==0)return[];const t=[],r=new Set;if(e.length!==0)for(const{fbase_key:s,value:i}of e)r.add(s),JSON.stringify(this.localCache[s])!==JSON.stringify(i)&&(this.notifyListeners(s,i),t.push(s));for(const s of Object.keys(this.localCache))this.localCache[s]&&!r.has(s)&&(this.notifyListeners(s,null),t.push(s));return t}notifyListeners(e,t){this.localCache[e]=t;const r=this.listeners[e];if(r)for(const s of Array.from(r))s(t)}startPolling(){this.stopPolling(),this.pollTimer=setInterval(async()=>this._poll(),c$)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}_addListener(e,t){Object.keys(this.listeners).length===0&&this.startPolling(),this.listeners[e]||(this.listeners[e]=new Set,this._get(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),this.listeners[e].size===0&&delete this.listeners[e]),Object.keys(this.listeners).length===0&&this.stopPolling()}}Yk.type="LOCAL";const d$=Yk;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ob(n,e){return bt(n,"POST","/v2/accounts/mfaSignIn:start",St(n,e))}function h$(n,e){return bt(n,"POST","/v2/accounts/mfaSignIn:finalize",St(n,e))}function f$(n,e){return bt(n,"POST","/v2/accounts/mfaSignIn:finalize",St(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ty=Nk("rcb"),p$=new rh(3e4,6e4);class m${constructor(){var e;this.hostLanguage="",this.counter=0,this.librarySeparatelyLoaded=!!((e=Qt().grecaptcha)!=null&&e.render)}load(e,t=""){return K(g$(t),e,"argument-error"),this.shouldResolveImmediately(t)&&HS(Qt().grecaptcha)?Promise.resolve(Qt().grecaptcha):new Promise((r,s)=>{const i=Qt().setTimeout(()=>{s($n(e,"network-request-failed"))},p$.get());Qt()[Ty]=()=>{Qt().clearTimeout(i),delete Qt()[Ty];const a=Qt().grecaptcha;if(!a||!HS(a)){s($n(e,"internal-error"));return}const l=a.render;a.render=(u,h)=>{const f=l(u,h);return this.counter++,f},this.hostLanguage=t,r(a)};const o=`${KU()}?${_a({onload:Ty,render:"explicit",hl:t})}`;yI(o).catch(()=>{clearTimeout(i),s($n(e,"internal-error"))})})}clearedOneInstance(){this.counter--}shouldResolveImmediately(e){var t;return!!((t=Qt().grecaptcha)!=null&&t.render)&&(e===this.hostLanguage||this.counter>0||this.librarySeparatelyLoaded)}}function g$(n){return n.length<=6&&/^\s*[a-zA-Z0-9\-]*\s*$/.test(n)}class y${async load(e){return new ZU(e)}clearedOneInstance(){}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Pu="recaptcha",_$={theme:"light",type:"image"};class Qq{constructor(e,t,r={..._$}){this.parameters=r,this.type=Pu,this.destroyed=!1,this.widgetId=null,this.tokenChangeListeners=new Set,this.renderPromise=null,this.recaptcha=null,this.auth=zt(e),this.isInvisible=this.parameters.size==="invisible",K(typeof document<"u",this.auth,"operation-not-supported-in-this-environment");const s=typeof t=="string"?document.getElementById(t):t;K(s,this.auth,"argument-error"),this.container=s,this.parameters.callback=this.makeTokenCallback(this.parameters.callback),this._recaptchaLoader=this.auth.settings.appVerificationDisabledForTesting?new y$:new m$,this.validateStartingState()}async verify(){this.assertNotDestroyed();const e=await this.render(),t=this.getAssertedRecaptcha(),r=t.getResponse(e);return r||new Promise(s=>{const i=o=>{o&&(this.tokenChangeListeners.delete(i),s(o))};this.tokenChangeListeners.add(i),this.isInvisible&&t.execute(e)})}render(){try{this.assertNotDestroyed()}catch(e){return Promise.reject(e)}return this.renderPromise?this.renderPromise:(this.renderPromise=this.makeRenderPromise().catch(e=>{throw this.renderPromise=null,e}),this.renderPromise)}_reset(){this.assertNotDestroyed(),this.widgetId!==null&&this.getAssertedRecaptcha().reset(this.widgetId)}clear(){this.assertNotDestroyed(),this.destroyed=!0,this._recaptchaLoader.clearedOneInstance(),this.isInvisible||this.container.childNodes.forEach(e=>{this.container.removeChild(e)})}validateStartingState(){K(!this.parameters.sitekey,this.auth,"argument-error"),K(this.isInvisible||!this.container.hasChildNodes(),this.auth,"argument-error"),K(typeof document<"u",this.auth,"operation-not-supported-in-this-environment")}makeTokenCallback(e){return t=>{if(this.tokenChangeListeners.forEach(r=>r(t)),typeof e=="function")e(t);else if(typeof e=="string"){const r=Qt()[e];typeof r=="function"&&r(t)}}}assertNotDestroyed(){K(!this.destroyed,this.auth,"internal-error")}async makeRenderPromise(){if(await this.init(),!this.widgetId){let e=this.container;if(!this.isInvisible){const t=document.createElement("div");e.appendChild(t),e=t}this.widgetId=this.getAssertedRecaptcha().render(e,this.parameters)}return this.widgetId}async init(){K(pI()&&!SI(),this.auth,"internal-error"),await v$(),this.recaptcha=await this._recaptchaLoader.load(this.auth,this.auth.languageCode||void 0);const e=await NU(this.auth);K(e,this.auth,"internal-error"),this.parameters.sitekey=e}getAssertedRecaptcha(){return K(this.recaptcha,this.auth,"internal-error"),this.recaptcha}}function v$(){let n=null;return new Promise(e=>{if(document.readyState==="complete"){e();return}n=()=>e(),window.addEventListener("load",n)}).catch(e=>{throw n&&window.removeEventListener("load",n),e})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class bI{constructor(e,t){this.verificationId=e,this.onConfirmation=t}confirm(e){const t=Go._fromVerification(this.verificationId,e);return this.onConfirmation(t)}}async function Yq(n,e,t){if(Pt(n.app))return Promise.reject(pn(n));const r=zt(n),s=await lg(r,e,ne(t));return new bI(s,i=>vI(r,i))}async function Jq(n,e,t){const r=ne(n);await rg(!1,r,"phone");const s=await lg(r.auth,e,ne(t));return new bI(s,i=>RB(r,i))}async function Xq(n,e,t){const r=ne(n);if(Pt(r.auth.app))return Promise.reject(pn(r.auth));const s=await lg(r.auth,e,ne(t));return new bI(s,i=>NB(r,i))}async function lg(n,e,t){var r;if(!n._getRecaptchaConfig())try{await kk(n)}catch{console.log("Failed to initialize reCAPTCHA Enterprise config. Triggering the reCAPTCHA v2 verification.")}try{let s;if(typeof e=="string"?s={phoneNumber:e}:s=e,"session"in s){const i=s.session;if("phoneNumber"in s){K(i.type==="enroll",n,"internal-error");const o={idToken:i.credential,phoneEnrollmentInfo:{phoneNumber:s.phoneNumber,clientType:"CLIENT_TYPE_WEB"}};return(await Gi(n,o,"mfaSmsEnrollment",async(h,f)=>{if(f.phoneEnrollmentInfo.captchaResponse===Nu){K((t==null?void 0:t.type)===Pu,h,"argument-error");const p=await Sy(h,f,t);return rb(h,p)}return rb(h,f)},"PHONE_PROVIDER").catch(h=>Promise.reject(h))).phoneSessionInfo.sessionInfo}else{K(i.type==="signin",n,"internal-error");const o=((r=s.multiFactorHint)==null?void 0:r.uid)||s.multiFactorUid;K(o,n,"missing-multi-factor-info");const a={mfaPendingCredential:i.credential,mfaEnrollmentId:o,phoneSignInInfo:{clientType:"CLIENT_TYPE_WEB"}};return(await Gi(n,a,"mfaSmsSignIn",async(f,p)=>{if(p.phoneSignInInfo.captchaResponse===Nu){K((t==null?void 0:t.type)===Pu,f,"argument-error");const y=await Sy(f,p,t);return ob(f,y)}return ob(f,p)},"PHONE_PROVIDER").catch(f=>Promise.reject(f))).phoneResponseInfo.sessionInfo}}else{const i={phoneNumber:s.phoneNumber,clientType:"CLIENT_TYPE_WEB"};return(await Gi(n,i,"sendVerificationCode",async(u,h)=>{if(h.captchaResponse===Nu){K((t==null?void 0:t.type)===Pu,u,"argument-error");const f=await Sy(u,h,t);return tb(u,f)}return tb(u,h)},"PHONE_PROVIDER").catch(u=>Promise.reject(u))).sessionInfo}}finally{t==null||t._reset()}}async function Zq(n,e){const t=ne(n);if(Pt(t.auth.app))return Promise.reject(pn(t.auth));await _I(t,e)}async function Sy(n,e,t){K(t.type===Pu,n,"argument-error");const r=await t.verify();K(typeof r=="string",n,"argument-error");const s={...e};if("phoneEnrollmentInfo"in s){const i=s.phoneEnrollmentInfo.phoneNumber,o=s.phoneEnrollmentInfo.captchaResponse,a=s.phoneEnrollmentInfo.clientType,l=s.phoneEnrollmentInfo.recaptchaVersion;return Object.assign(s,{phoneEnrollmentInfo:{phoneNumber:i,recaptchaToken:r,captchaResponse:o,clientType:a,recaptchaVersion:l}}),s}else if("phoneSignInInfo"in s){const i=s.phoneSignInInfo.captchaResponse,o=s.phoneSignInInfo.clientType,a=s.phoneSignInInfo.recaptchaVersion;return Object.assign(s,{phoneSignInInfo:{recaptchaToken:r,captchaResponse:i,clientType:o,recaptchaVersion:a}}),s}else return Object.assign(s,{recaptchaToken:r}),s}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class vl{constructor(e){this.providerId=vl.PROVIDER_ID,this.auth=zt(e)}verifyPhoneNumber(e,t){return lg(this.auth,e,ne(t))}static credential(e,t){return Go._fromVerification(e,t)}static credentialFromResult(e){const t=e;return vl.credentialFromTaggedObject(t)}static credentialFromError(e){return vl.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{phoneNumber:t,temporaryProof:r}=e;return t&&r?Go._fromTokenResponse(t,r):null}}vl.PROVIDER_ID="phone";vl.PHONE_SIGN_IN_METHOD="phone";/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Na(n,e){return e?js(e):(K(n._popupRedirectResolver,n,"argument-error"),n._popupRedirectResolver)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class AI extends ih{constructor(e){super("custom","custom"),this.params=e}_getIdTokenResponse(e){return $s(e,this._buildIdpRequest())}_linkToIdToken(e,t){return $s(e,this._buildIdpRequest(t))}_getReauthenticationResolver(e){return $s(e,this._buildIdpRequest())}_buildIdpRequest(e){const t={requestUri:this.params.requestUri,sessionId:this.params.sessionId,postBody:this.params.postBody,tenantId:this.params.tenantId,pendingToken:this.params.pendingToken,returnSecureToken:!0,returnIdpCredential:!0};return e&&(t.idToken=e),t}}function w$(n){return jk(n.auth,new AI(n),n.bypassAuthState)}function I$(n){const{auth:e,user:t}=n;return K(t,e,"internal-error"),Fk(t,new AI(n),n.bypassAuthState)}async function E$(n){const{auth:e,user:t}=n;return K(t,e,"internal-error"),_I(t,new AI(n),n.bypassAuthState)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Jk{constructor(e,t,r,s,i=!1){this.auth=e,this.resolver=r,this.user=s,this.bypassAuthState=i,this.pendingPromise=null,this.eventManager=null,this.filter=Array.isArray(t)?t:[t]}execute(){return new Promise(async(e,t)=>{this.pendingPromise={resolve:e,reject:t};try{this.eventManager=await this.resolver._initialize(this.auth),await this.onExecution(),this.eventManager.registerConsumer(this)}catch(r){this.reject(r)}})}async onAuthEvent(e){const{urlResponse:t,sessionId:r,postBody:s,tenantId:i,error:o,type:a}=e;if(o){this.reject(o);return}const l={auth:this.auth,requestUri:t,sessionId:r,tenantId:i||void 0,postBody:s||void 0,user:this.user,bypassAuthState:this.bypassAuthState};try{this.resolve(await this.getIdpTask(a)(l))}catch(u){this.reject(u)}}onError(e){this.reject(e)}getIdpTask(e){switch(e){case"signInViaPopup":case"signInViaRedirect":return w$;case"linkViaPopup":case"linkViaRedirect":return E$;case"reauthViaPopup":case"reauthViaRedirect":return I$;default:ir(this.auth,"internal-error")}}resolve(e){Js(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.resolve(e),this.unregisterAndCleanUp()}reject(e){Js(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.reject(e),this.unregisterAndCleanUp()}unregisterAndCleanUp(){this.eventManager&&this.eventManager.unregisterConsumer(this),this.pendingPromise=null,this.cleanUp()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const x$=new rh(2e3,1e4);async function T$(n,e,t){if(Pt(n.app))return Promise.reject($n(n,"operation-not-supported-in-this-environment"));const r=zt(n);_c(n,e,ai);const s=Na(r,t);return new Us(r,"signInViaPopup",e,s).executeNotNull()}async function eW(n,e,t){const r=ne(n);if(Pt(r.auth.app))return Promise.reject($n(r.auth,"operation-not-supported-in-this-environment"));_c(r.auth,e,ai);const s=Na(r.auth,t);return new Us(r.auth,"reauthViaPopup",e,s,r).executeNotNull()}async function tW(n,e,t){const r=ne(n);_c(r.auth,e,ai);const s=Na(r.auth,t);return new Us(r.auth,"linkViaPopup",e,s,r).executeNotNull()}class Us extends Jk{constructor(e,t,r,s,i){super(e,t,s,i),this.provider=r,this.authWindow=null,this.pollId=null,Us.currentPopupAction&&Us.currentPopupAction.cancel(),Us.currentPopupAction=this}async executeNotNull(){const e=await this.execute();return K(e,this.auth,"internal-error"),e}async onExecution(){Js(this.filter.length===1,"Popup operations only handle one event");const e=og();this.authWindow=await this.resolver._openPopup(this.auth,this.provider,this.filter[0],e),this.authWindow.associatedEvent=e,this.resolver._originValidation(this.auth).catch(t=>{this.reject(t)}),this.resolver._isIframeWebStorageSupported(this.auth,t=>{t||this.reject($n(this.auth,"web-storage-unsupported"))}),this.pollUserCancellation()}get eventId(){var e;return((e=this.authWindow)==null?void 0:e.associatedEvent)||null}cancel(){this.reject($n(this.auth,"cancelled-popup-request"))}cleanUp(){this.authWindow&&this.authWindow.close(),this.pollId&&window.clearTimeout(this.pollId),this.authWindow=null,this.pollId=null,Us.currentPopupAction=null}pollUserCancellation(){const e=()=>{var t,r;if((r=(t=this.authWindow)==null?void 0:t.window)!=null&&r.closed){this.pollId=window.setTimeout(()=>{this.pollId=null,this.reject($n(this.auth,"popup-closed-by-user"))},8e3);return}this.pollId=window.setTimeout(e,x$.get())};e()}}Us.currentPopupAction=null;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const S$="pendingRedirect",Pf=new Map;class b$ extends Jk{constructor(e,t,r=!1){super(e,["signInViaRedirect","linkViaRedirect","reauthViaRedirect","unknown"],t,void 0,r),this.eventId=null}async execute(){let e=Pf.get(this.auth._key());if(!e){try{const r=await A$(this.resolver,this.auth)?await super.execute():null;e=()=>Promise.resolve(r)}catch(t){e=()=>Promise.reject(t)}Pf.set(this.auth._key(),e)}return this.bypassAuthState||Pf.set(this.auth._key(),()=>Promise.resolve(null)),e()}async onAuthEvent(e){if(e.type==="signInViaRedirect")return super.onAuthEvent(e);if(e.type==="unknown"){this.resolve(null);return}if(e.eventId){const t=await this.auth._redirectUserForId(e.eventId);if(t)return this.user=t,super.onAuthEvent(e);this.resolve(null)}}async onExecution(){}cleanUp(){}}async function A$(n,e){const t=Zk(e),r=Xk(n);if(!await r._isAvailable())return!1;const s=await r._get(t)==="true";return await r._remove(t),s}async function CI(n,e){return Xk(n)._set(Zk(e),"true")}function C$(n,e){Pf.set(n._key(),e)}function Xk(n){return js(n._redirectPersistence)}function Zk(n){return Rf(S$,n.config.apiKey,n.name)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function nW(n,e,t){return R$(n,e,t)}async function R$(n,e,t){if(Pt(n.app))return Promise.reject(pn(n));const r=zt(n);_c(n,e,ai),await r._initializationPromise;const s=Na(r,t);return await CI(s,r),s._openRedirect(r,e,"signInViaRedirect")}function rW(n,e,t){return N$(n,e,t)}async function N$(n,e,t){const r=ne(n);if(_c(r.auth,e,ai),Pt(r.auth.app))return Promise.reject(pn(r.auth));await r.auth._initializationPromise;const s=Na(r.auth,t);await CI(s,r.auth);const i=await tD(r);return s._openRedirect(r.auth,e,"reauthViaRedirect",i)}function sW(n,e,t){return P$(n,e,t)}async function P$(n,e,t){const r=ne(n);_c(r.auth,e,ai),await r.auth._initializationPromise;const s=Na(r.auth,t);await rg(!1,r,e.providerId),await CI(s,r.auth);const i=await tD(r);return s._openRedirect(r.auth,e,"linkViaRedirect",i)}async function iW(n,e){return await zt(n)._initializationPromise,eD(n,e,!1)}async function eD(n,e,t=!1){if(Pt(n.app))return Promise.reject(pn(n));const r=zt(n),s=Na(r,e),o=await new b$(r,s,t).execute();return o&&!t&&(delete o.user._redirectEventId,await r._persistUserIfCurrent(o.user),await r._setRedirectUser(null,e)),o}async function tD(n){const e=og(`${n.uid}:::`);return n._redirectEventId=e,await n.auth._setRedirectUser(n),await n.auth._persistUserIfCurrent(n),e}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const k$=10*60*1e3;class D${constructor(e){this.auth=e,this.cachedEventUids=new Set,this.consumers=new Set,this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1,this.lastProcessedEventTime=Date.now()}registerConsumer(e){this.consumers.add(e),this.queuedRedirectEvent&&this.isEventForConsumer(this.queuedRedirectEvent,e)&&(this.sendToConsumer(this.queuedRedirectEvent,e),this.saveEventToCache(this.queuedRedirectEvent),this.queuedRedirectEvent=null)}unregisterConsumer(e){this.consumers.delete(e)}onEvent(e){if(this.hasEventBeenHandled(e))return!1;let t=!1;return this.consumers.forEach(r=>{this.isEventForConsumer(e,r)&&(t=!0,this.sendToConsumer(e,r),this.saveEventToCache(e))}),this.hasHandledPotentialRedirect||!O$(e)||(this.hasHandledPotentialRedirect=!0,t||(this.queuedRedirectEvent=e,t=!0)),t}sendToConsumer(e,t){var r;if(e.error&&!nD(e)){const s=((r=e.error.code)==null?void 0:r.split("auth/")[1])||"internal-error";t.onError($n(this.auth,s))}else t.onAuthEvent(e)}isEventForConsumer(e,t){const r=t.eventId===null||!!e.eventId&&e.eventId===t.eventId;return t.filter.includes(e.type)&&r}hasEventBeenHandled(e){return Date.now()-this.lastProcessedEventTime>=k$&&this.cachedEventUids.clear(),this.cachedEventUids.has(ab(e))}saveEventToCache(e){this.cachedEventUids.add(ab(e)),this.lastProcessedEventTime=Date.now()}}function ab(n){return[n.type,n.eventId,n.sessionId,n.tenantId].filter(e=>e).join("-")}function nD({type:n,error:e}){return n==="unknown"&&(e==null?void 0:e.code)==="auth/no-auth-event"}function O$(n){switch(n.type){case"signInViaRedirect":case"linkViaRedirect":case"reauthViaRedirect":return!0;case"unknown":return nD(n);default:return!1}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function M$(n,e={}){return bt(n,"GET","/v1/projects",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const L$=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,V$=/^https?/;async function F$(n){if(n.config.emulator)return;const{authorizedDomains:e}=await M$(n);for(const t of e)try{if(j$(t))return}catch{}ir(n,"unauthorized-domain")}function j$(n){const e=wd(),{protocol:t,hostname:r}=new URL(e);if(n.startsWith("chrome-extension://")){const o=new URL(n);return o.hostname===""&&r===""?t==="chrome-extension:"&&n.replace("chrome-extension://","")===e.replace("chrome-extension://",""):t==="chrome-extension:"&&o.hostname===r}if(!V$.test(t))return!1;if(L$.test(n))return r===n;const s=n.replace(/\./g,"\\.");return new RegExp("^(.+\\."+s+"|"+s+")$","i").test(r)}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const U$=new rh(3e4,6e4);function lb(){const n=Qt().___jsl;if(n!=null&&n.H){for(const e of Object.keys(n.H))if(n.H[e].r=n.H[e].r||[],n.H[e].L=n.H[e].L||[],n.H[e].r=[...n.H[e].L],n.CP)for(let t=0;t<n.CP.length;t++)n.CP[t]=null}}function B$(n){return new Promise((e,t)=>{var s,i,o;function r(){lb(),gapi.load("gapi.iframes",{callback:()=>{e(gapi.iframes.getContext())},ontimeout:()=>{lb(),t($n(n,"network-request-failed"))},timeout:U$.get()})}if((i=(s=Qt().gapi)==null?void 0:s.iframes)!=null&&i.Iframe)e(gapi.iframes.getContext());else if((o=Qt().gapi)!=null&&o.load)r();else{const a=Nk("iframefcb");return Qt()[a]=()=>{gapi.load?r():t($n(n,"network-request-failed"))},yI(`${YU()}?onload=${a}`).catch(l=>t(l))}}).catch(e=>{throw kf=null,e})}let kf=null;function $$(n){return kf=kf||B$(n),kf}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const z$=new rh(5e3,15e3),q$="__/auth/iframe",W$="emulator/auth/iframe",G$={style:{position:"absolute",top:"-100px",width:"1px",height:"1px"},"aria-hidden":"true",tabindex:"-1"},H$=new Map([["identitytoolkit.googleapis.com","p"],["staging-identitytoolkit.sandbox.googleapis.com","s"],["test-identitytoolkit.sandbox.googleapis.com","t"]]);function K$(n){const e=n.config;K(e.authDomain,n,"auth-domain-config-required");const t=e.emulator?mI(e,W$):`https://${n.config.authDomain}/${q$}`,r={apiKey:e.apiKey,appName:n.name,v:va},s=H$.get(n.config.apiHost);s&&(r.eid=s);const i=n._getFrameworks();return i.length&&(r.fw=i.join(",")),`${t}?${_a(r).slice(1)}`}async function Q$(n){const e=await $$(n),t=Qt().gapi;return K(t,n,"internal-error"),e.open({where:document.body,url:K$(n),messageHandlersFilter:t.iframes.CROSS_ORIGIN_IFRAMES_FILTER,attributes:G$,dontclear:!0},r=>new Promise(async(s,i)=>{await r.restyle({setHideOnLeave:!1});const o=$n(n,"network-request-failed"),a=Qt().setTimeout(()=>{i(o)},z$.get());function l(){Qt().clearTimeout(a),s(r)}r.ping(l).then(l,()=>{i(o)})}))}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Y$={location:"yes",resizable:"yes",statusbar:"yes",toolbar:"no"},J$=500,X$=600,Z$="_blank",e9="http://localhost";class cb{constructor(e){this.window=e,this.associatedEvent=null}close(){if(this.window)try{this.window.close()}catch{}}}function t9(n,e,t,r=J$,s=X$){const i=Math.max((window.screen.availHeight-s)/2,0).toString(),o=Math.max((window.screen.availWidth-r)/2,0).toString();let a="";const l={...Y$,width:r.toString(),height:s.toString(),top:i,left:o},u=nn().toLowerCase();t&&(a=xk(u)?Z$:t),Ik(u)&&(e=e||e9,l.scrollbars="yes");const h=Object.entries(l).reduce((p,[y,I])=>`${p}${y}=${I},`,"");if(UU(u)&&a!=="_self")return n9(e||"",a),new cb(null);const f=window.open(e||"",a,h);K(f,n,"popup-blocked");try{f.focus()}catch{}return new cb(f)}function n9(n,e){const t=document.createElement("a");t.href=n,t.target=e;const r=document.createEvent("MouseEvent");r.initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,1,null),t.dispatchEvent(r)}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const r9="__/auth/handler",s9="emulator/auth/handler",i9=encodeURIComponent("fac");async function ub(n,e,t,r,s,i){K(n.config.authDomain,n,"auth-domain-config-required"),K(n.config.apiKey,n,"invalid-api-key");const o={apiKey:n.config.apiKey,appName:n.name,authType:t,redirectUrl:r,v:va,eventId:s};if(e instanceof ai){e.setDefaultLanguage(n.languageCode),o.providerId=e.providerId||"",ip(e.getCustomParameters())||(o.customParameters=JSON.stringify(e.getCustomParameters()));for(const[h,f]of Object.entries(i||{}))o[h]=f}if(e instanceof vc){const h=e.getScopes().filter(f=>f!=="");h.length>0&&(o.scopes=h.join(","))}n.tenantId&&(o.tid=n.tenantId);const a=o;for(const h of Object.keys(a))a[h]===void 0&&delete a[h];const l=await n._getAppCheckToken(),u=l?`#${i9}=${encodeURIComponent(l)}`:"";return`${o9(n)}?${_a(a).slice(1)}${u}`}function o9({config:n}){return n.emulator?mI(n,s9):`https://${n.authDomain}/${r9}`}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const by="webStorageSupport";class a9{constructor(){this.eventManagers={},this.iframes={},this.originValidationPromises={},this._redirectPersistence=Hk,this._completeRedirectFn=eD,this._overrideRedirectResult=C$}async _openPopup(e,t,r,s){var o;Js((o=this.eventManagers[e._key()])==null?void 0:o.manager,"_initialize() not called before _openPopup()");const i=await ub(e,t,r,wd(),s);return t9(e,i,og())}async _openRedirect(e,t,r,s){await this._originValidation(e);const i=await ub(e,t,r,wd(),s);return n$(i),new Promise(()=>{})}_initialize(e){const t=e._key();if(this.eventManagers[t]){const{manager:s,promise:i}=this.eventManagers[t];return s?Promise.resolve(s):(Js(i,"If manager is not set, promise should be"),i)}const r=this.initAndGetManager(e);return this.eventManagers[t]={promise:r},r.catch(()=>{delete this.eventManagers[t]}),r}async initAndGetManager(e){const t=await Q$(e),r=new D$(e);return t.register("authEvent",s=>(K(s==null?void 0:s.authEvent,e,"invalid-auth-event"),{status:r.onEvent(s.authEvent)?"ACK":"ERROR"}),gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER),this.eventManagers[e._key()]={manager:r},this.iframes[e._key()]=t,r}_isIframeWebStorageSupported(e,t){this.iframes[e._key()].send(by,{type:by},s=>{var o;const i=(o=s==null?void 0:s[0])==null?void 0:o[by];i!==void 0&&t(!!i),ir(e,"internal-error")},gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER)}_originValidation(e){const t=e._key();return this.originValidationPromises[t]||(this.originValidationPromises[t]=F$(e)),this.originValidationPromises[t]}get _shouldInitProactively(){return Ck()||Ek()||gI()}}const l9=a9;class rD{constructor(e){this.factorId=e}_process(e,t,r){switch(t.type){case"enroll":return this._finalizeEnroll(e,t.credential,r);case"signin":return this._finalizeSignIn(e,t.credential);default:return ms("unexpected MultiFactorSessionType")}}}class RI extends rD{constructor(e){super("phone"),this.credential=e}static _fromCredential(e){return new RI(e)}_finalizeEnroll(e,t,r){return HB(e,{idToken:t,displayName:r,phoneVerificationInfo:this.credential._makeVerificationRequest()})}_finalizeSignIn(e,t){return h$(e,{mfaPendingCredential:t,phoneVerificationInfo:this.credential._makeVerificationRequest()})}}class c9{constructor(){}static assertion(e){return RI._fromCredential(e)}}c9.FACTOR_ID="phone";class u9{static assertionForEnrollment(e,t){return Td._fromSecret(e,t)}static assertionForSignIn(e,t){return Td._fromEnrollmentId(e,t)}static async generateSecret(e){var s;const t=e;K(typeof((s=t.user)==null?void 0:s.auth)<"u","internal-error");const r=await KB(t.user.auth,{idToken:t.credential,totpEnrollmentInfo:{}});return NI._fromStartTotpMfaEnrollmentResponse(r,t.user.auth)}}u9.FACTOR_ID="totp";class Td extends rD{constructor(e,t,r){super("totp"),this.otp=e,this.enrollmentId=t,this.secret=r}static _fromSecret(e,t){return new Td(t,void 0,e)}static _fromEnrollmentId(e,t){return new Td(t,e)}async _finalizeEnroll(e,t,r){return K(typeof this.secret<"u",e,"argument-error"),QB(e,{idToken:t,displayName:r,totpVerificationInfo:this.secret._makeTotpVerificationInfo(this.otp)})}async _finalizeSignIn(e,t){K(this.enrollmentId!==void 0&&this.otp!==void 0,e,"argument-error");const r={verificationCode:this.otp};return f$(e,{mfaPendingCredential:t,mfaEnrollmentId:this.enrollmentId,totpVerificationInfo:r})}}class NI{constructor(e,t,r,s,i,o,a){this.sessionInfo=o,this.auth=a,this.secretKey=e,this.hashingAlgorithm=t,this.codeLength=r,this.codeIntervalSeconds=s,this.enrollmentCompletionDeadline=i}static _fromStartTotpMfaEnrollmentResponse(e,t){return new NI(e.totpSessionInfo.sharedSecretKey,e.totpSessionInfo.hashingAlgorithm,e.totpSessionInfo.verificationCodeLength,e.totpSessionInfo.periodSec,new Date(e.totpSessionInfo.finalizeEnrollmentTime).toUTCString(),e.totpSessionInfo.sessionInfo,t)}_makeTotpVerificationInfo(e){return{sessionInfo:this.sessionInfo,verificationCode:e}}generateQrCodeUrl(e,t){var s;let r=!1;return(Zh(e)||Zh(t))&&(r=!0),r&&(Zh(e)&&(e=((s=this.auth.currentUser)==null?void 0:s.email)||"unknownuser"),Zh(t)&&(t=this.auth.name)),`otpauth://totp/${t}:${e}?secret=${this.secretKey}&issuer=${t}&algorithm=${this.hashingAlgorithm}&digits=${this.codeLength}`}}function Zh(n){return typeof n>"u"||(n==null?void 0:n.length)===0}var db="@firebase/auth",hb="1.11.0";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class d9{constructor(e){this.auth=e,this.internalListeners=new Map}getUid(){var e;return this.assertAuthConfigured(),((e=this.auth.currentUser)==null?void 0:e.uid)||null}async getToken(e){return this.assertAuthConfigured(),await this.auth._initializationPromise,this.auth.currentUser?{accessToken:await this.auth.currentUser.getIdToken(e)}:null}addAuthTokenListener(e){if(this.assertAuthConfigured(),this.internalListeners.has(e))return;const t=this.auth.onIdTokenChanged(r=>{e((r==null?void 0:r.stsTokenManager.accessToken)||null)});this.internalListeners.set(e,t),this.updateProactiveRefresh()}removeAuthTokenListener(e){this.assertAuthConfigured();const t=this.internalListeners.get(e);t&&(this.internalListeners.delete(e),t(),this.updateProactiveRefresh())}assertAuthConfigured(){K(this.auth._initializationPromise,"dependent-sdk-initialized-before-auth")}updateProactiveRefresh(){this.internalListeners.size>0?this.auth._startProactiveRefresh():this.auth._stopProactiveRefresh()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function h9(n){switch(n){case"Node":return"node";case"ReactNative":return"rn";case"Worker":return"webworker";case"Cordova":return"cordova";case"WebExtension":return"web-extension";default:return}}function f9(n){es(new sr("auth",(e,{options:t})=>{const r=e.getProvider("app").getImmediate(),s=e.getProvider("heartbeat"),i=e.getProvider("app-check-internal"),{apiKey:o,authDomain:a}=r.options;K(o&&!o.includes(":"),"invalid-api-key",{appName:r.name});const l={apiKey:o,authDomain:a,clientPlatform:n,apiHost:"identitytoolkit.googleapis.com",tokenApiHost:"securetoken.googleapis.com",apiScheme:"https",sdkClientVersion:Rk(n)},u=new GU(r,s,i,l);return oB(u,t),u},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((e,t,r)=>{e.getProvider("auth-internal").initialize()})),es(new sr("auth-internal",e=>{const t=zt(e.getProvider("auth").getImmediate());return(r=>new d9(r))(t)},"PRIVATE").setInstantiationMode("EXPLICIT")),nr(db,hb,h9(n)),nr(db,hb,"esm2020")}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const p9=5*60,m9=WA("authIdTokenMaxAge")||p9;let fb=null;const g9=n=>async e=>{const t=e&&await e.getIdTokenResult(),r=t&&(new Date().getTime()-Date.parse(t.issuedAtTime))/1e3;if(r&&r>m9)return;const s=t==null?void 0:t.token;fb!==s&&(fb=s,await fetch(n,{method:s?"POST":"DELETE",headers:s?{Authorization:`Bearer ${s}`}:{}}))};function y9(n=kd()){const e=bs(n,"auth");if(e.isInitialized())return e.getImmediate();const t=iB(n,{popupRedirectResolver:l9,persistence:[d$,qk,Hk]}),r=WA("authTokenSyncURL");if(r&&typeof isSecureContext=="boolean"&&isSecureContext){const i=new URL(r,location.origin);if(location.origin===i.origin){const o=g9(i.toString());GB(t,o,()=>o(t.currentUser)),WB(t,a=>o(a))}}const s=$A("auth");return s&&aB(t,`http://${s}`),t}function _9(){var n;return((n=document.getElementsByTagName("head"))==null?void 0:n[0])??document}HU({loadJS(n){return new Promise((e,t)=>{const r=document.createElement("script");r.setAttribute("src",n),r.onload=e,r.onerror=s=>{const i=$n("internal-error");i.customData=s,t(i)},r.type="text/javascript",r.charset="UTF-8",_9().appendChild(r)})},gapiScript:"https://apis.google.com/js/api.js",recaptchaV2Script:"https://www.google.com/recaptcha/api.js",recaptchaEnterpriseScript:"https://www.google.com/recaptcha/enterprise.js?render="});f9("Browser");const sD="@firebase/installations",PI="0.6.19";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const iD=1e4,oD=`w:${PI}`,aD="FIS_v2",v9="https://firebaseinstallations.googleapis.com/v1",w9=60*60*1e3,I9="installations",E9="Installations";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const x9={"missing-app-config-values":'Missing App configuration value: "{$valueName}"',"not-registered":"Firebase Installation is not registered.","installation-not-found":"Firebase Installation not found.","request-failed":'{$requestName} request failed with error "{$serverCode} {$serverStatus}: {$serverMessage}"',"app-offline":"Could not process request. Application offline.","delete-pending-registration":"Can't delete installation while there is a pending registration request."},fa=new ya(I9,E9,x9);function lD(n){return n instanceof ts&&n.code.includes("request-failed")}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function cD({projectId:n}){return`${v9}/projects/${n}/installations`}function uD(n){return{token:n.token,requestStatus:2,expiresIn:S9(n.expiresIn),creationTime:Date.now()}}async function dD(n,e){const r=(await e.json()).error;return fa.create("request-failed",{requestName:n,serverCode:r.code,serverMessage:r.message,serverStatus:r.status})}function hD({apiKey:n}){return new Headers({"Content-Type":"application/json",Accept:"application/json","x-goog-api-key":n})}function T9(n,{refreshToken:e}){const t=hD(n);return t.append("Authorization",b9(e)),t}async function fD(n){const e=await n();return e.status>=500&&e.status<600?n():e}function S9(n){return Number(n.replace("s","000"))}function b9(n){return`${aD} ${n}`}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function A9({appConfig:n,heartbeatServiceProvider:e},{fid:t}){const r=cD(n),s=hD(n),i=e.getImmediate({optional:!0});if(i){const u=await i.getHeartbeatsHeader();u&&s.append("x-firebase-client",u)}const o={fid:t,authVersion:aD,appId:n.appId,sdkVersion:oD},a={method:"POST",headers:s,body:JSON.stringify(o)},l=await fD(()=>fetch(r,a));if(l.ok){const u=await l.json();return{fid:u.fid||t,registrationStatus:2,refreshToken:u.refreshToken,authToken:uD(u.authToken)}}else throw await dD("Create Installation",l)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function pD(n){return new Promise(e=>{setTimeout(e,n)})}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function C9(n){return btoa(String.fromCharCode(...n)).replace(/\+/g,"-").replace(/\//g,"_")}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const R9=/^[cdef][\w-]{21}$/,Ev="";function N9(){try{const n=new Uint8Array(17);(self.crypto||self.msCrypto).getRandomValues(n),n[0]=112+n[0]%16;const t=P9(n);return R9.test(t)?t:Ev}catch{return Ev}}function P9(n){return C9(n).substr(0,22)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function cg(n){return`${n.appName}!${n.appId}`}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const mD=new Map;function gD(n,e){const t=cg(n);yD(t,e),k9(t,e)}function yD(n,e){const t=mD.get(n);if(t)for(const r of t)r(e)}function k9(n,e){const t=D9();t&&t.postMessage({key:n,fid:e}),O9()}let jo=null;function D9(){return!jo&&"BroadcastChannel"in self&&(jo=new BroadcastChannel("[Firebase] FID Change"),jo.onmessage=n=>{yD(n.data.key,n.data.fid)}),jo}function O9(){mD.size===0&&jo&&(jo.close(),jo=null)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const M9="firebase-installations-database",L9=1,pa="firebase-installations-store";let Ay=null;function kI(){return Ay||(Ay=rC(M9,L9,{upgrade:(n,e)=>{switch(e){case 0:n.createObjectStore(pa)}}})),Ay}async function Bp(n,e){const t=cg(n),s=(await kI()).transaction(pa,"readwrite"),i=s.objectStore(pa),o=await i.get(t);return await i.put(e,t),await s.done,(!o||o.fid!==e.fid)&&gD(n,e.fid),e}async function _D(n){const e=cg(n),r=(await kI()).transaction(pa,"readwrite");await r.objectStore(pa).delete(e),await r.done}async function ug(n,e){const t=cg(n),s=(await kI()).transaction(pa,"readwrite"),i=s.objectStore(pa),o=await i.get(t),a=e(o);return a===void 0?await i.delete(t):await i.put(a,t),await s.done,a&&(!o||o.fid!==a.fid)&&gD(n,a.fid),a}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function DI(n){let e;const t=await ug(n.appConfig,r=>{const s=V9(r),i=F9(n,s);return e=i.registrationPromise,i.installationEntry});return t.fid===Ev?{installationEntry:await e}:{installationEntry:t,registrationPromise:e}}function V9(n){const e=n||{fid:N9(),registrationStatus:0};return vD(e)}function F9(n,e){if(e.registrationStatus===0){if(!navigator.onLine){const s=Promise.reject(fa.create("app-offline"));return{installationEntry:e,registrationPromise:s}}const t={fid:e.fid,registrationStatus:1,registrationTime:Date.now()},r=j9(n,t);return{installationEntry:t,registrationPromise:r}}else return e.registrationStatus===1?{installationEntry:e,registrationPromise:U9(n)}:{installationEntry:e}}async function j9(n,e){try{const t=await A9(n,e);return Bp(n.appConfig,t)}catch(t){throw lD(t)&&t.customData.serverCode===409?await _D(n.appConfig):await Bp(n.appConfig,{fid:e.fid,registrationStatus:0}),t}}async function U9(n){let e=await pb(n.appConfig);for(;e.registrationStatus===1;)await pD(100),e=await pb(n.appConfig);if(e.registrationStatus===0){const{installationEntry:t,registrationPromise:r}=await DI(n);return r||t}return e}function pb(n){return ug(n,e=>{if(!e)throw fa.create("installation-not-found");return vD(e)})}function vD(n){return B9(n)?{fid:n.fid,registrationStatus:0}:n}function B9(n){return n.registrationStatus===1&&n.registrationTime+iD<Date.now()}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function $9({appConfig:n,heartbeatServiceProvider:e},t){const r=z9(n,t),s=T9(n,t),i=e.getImmediate({optional:!0});if(i){const u=await i.getHeartbeatsHeader();u&&s.append("x-firebase-client",u)}const o={installation:{sdkVersion:oD,appId:n.appId}},a={method:"POST",headers:s,body:JSON.stringify(o)},l=await fD(()=>fetch(r,a));if(l.ok){const u=await l.json();return uD(u)}else throw await dD("Generate Auth Token",l)}function z9(n,{fid:e}){return`${cD(n)}/${e}/authTokens:generate`}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function OI(n,e=!1){let t;const r=await ug(n.appConfig,i=>{if(!wD(i))throw fa.create("not-registered");const o=i.authToken;if(!e&&G9(o))return i;if(o.requestStatus===1)return t=q9(n,e),i;{if(!navigator.onLine)throw fa.create("app-offline");const a=K9(i);return t=W9(n,a),a}});return t?await t:r.authToken}async function q9(n,e){let t=await mb(n.appConfig);for(;t.authToken.requestStatus===1;)await pD(100),t=await mb(n.appConfig);const r=t.authToken;return r.requestStatus===0?OI(n,e):r}function mb(n){return ug(n,e=>{if(!wD(e))throw fa.create("not-registered");const t=e.authToken;return Q9(t)?{...e,authToken:{requestStatus:0}}:e})}async function W9(n,e){try{const t=await $9(n,e),r={...e,authToken:t};return await Bp(n.appConfig,r),t}catch(t){if(lD(t)&&(t.customData.serverCode===401||t.customData.serverCode===404))await _D(n.appConfig);else{const r={...e,authToken:{requestStatus:0}};await Bp(n.appConfig,r)}throw t}}function wD(n){return n!==void 0&&n.registrationStatus===2}function G9(n){return n.requestStatus===2&&!H9(n)}function H9(n){const e=Date.now();return e<n.creationTime||n.creationTime+n.expiresIn<e+w9}function K9(n){const e={requestStatus:1,requestTime:Date.now()};return{...n,authToken:e}}function Q9(n){return n.requestStatus===1&&n.requestTime+iD<Date.now()}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Y9(n){const e=n,{installationEntry:t,registrationPromise:r}=await DI(e);return r?r.catch(console.error):OI(e).catch(console.error),t.fid}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function J9(n,e=!1){const t=n;return await X9(t),(await OI(t,e)).token}async function X9(n){const{registrationPromise:e}=await DI(n);e&&await e}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Z9(n){if(!n||!n.options)throw Cy("App Configuration");if(!n.name)throw Cy("App Name");const e=["projectId","apiKey","appId"];for(const t of e)if(!n.options[t])throw Cy(t);return{appName:n.name,projectId:n.options.projectId,apiKey:n.options.apiKey,appId:n.options.appId}}function Cy(n){return fa.create("missing-app-config-values",{valueName:n})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ID="installations",ez="installations-internal",tz=n=>{const e=n.getProvider("app").getImmediate(),t=Z9(e),r=bs(e,"heartbeat");return{app:e,appConfig:t,heartbeatServiceProvider:r,_delete:()=>Promise.resolve()}},nz=n=>{const e=n.getProvider("app").getImmediate(),t=bs(e,ID).getImmediate();return{getId:()=>Y9(t),getToken:s=>J9(t,s)}};function rz(){es(new sr(ID,tz,"PUBLIC")),es(new sr(ez,nz,"PRIVATE"))}rz();nr(sD,PI);nr(sD,PI,"esm2020");/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const $p="analytics",sz="firebase_id",iz="origin",oz=60*1e3,az="https://firebase.googleapis.com/v1alpha/projects/-/apps/{app-id}/webConfig",MI="https://www.googletagmanager.com/gtag/js";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const rr=new Pd("@firebase/analytics");/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const lz={"already-exists":"A Firebase Analytics instance with the appId {$id}  already exists. Only one Firebase Analytics instance can be created for each appId.","already-initialized":"initializeAnalytics() cannot be called again with different options than those it was initially called with. It can be called again with the same options to return the existing instance, or getAnalytics() can be used to get a reference to the already-initialized instance.","already-initialized-settings":"Firebase Analytics has already been initialized.settings() must be called before initializing any Analytics instanceor it will have no effect.","interop-component-reg-failed":"Firebase Analytics Interop Component failed to instantiate: {$reason}","invalid-analytics-context":"Firebase Analytics is not supported in this environment. Wrap initialization of analytics in analytics.isSupported() to prevent initialization in unsupported environments. Details: {$errorInfo}","indexeddb-unavailable":"IndexedDB unavailable or restricted in this environment. Wrap initialization of analytics in analytics.isSupported() to prevent initialization in unsupported environments. Details: {$errorInfo}","fetch-throttle":"The config fetch request timed out while in an exponential backoff state. Unix timestamp in milliseconds when fetch request throttling ends: {$throttleEndTimeMillis}.","config-fetch-failed":"Dynamic config fetch failed: [{$httpStatus}] {$responseMessage}","no-api-key":'The "apiKey" field is empty in the local Firebase config. Firebase Analytics requires this field tocontain a valid API key.',"no-app-id":'The "appId" field is empty in the local Firebase config. Firebase Analytics requires this field tocontain a valid app ID.',"no-client-id":'The "client_id" field is empty.',"invalid-gtag-resource":"Trusted Types detected an invalid gtag resource: {$gtagURL}."},vr=new ya("analytics","Analytics",lz);/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function cz(n){if(!n.startsWith(MI)){const e=vr.create("invalid-gtag-resource",{gtagURL:n});return rr.warn(e.message),""}return n}function ED(n){return Promise.all(n.map(e=>e.catch(t=>t)))}function uz(n,e){let t;return window.trustedTypes&&(t=window.trustedTypes.createPolicy(n,e)),t}function dz(n,e){const t=uz("firebase-js-sdk-policy",{createScriptURL:cz}),r=document.createElement("script"),s=`${MI}?l=${n}&id=${e}`;r.src=t?t==null?void 0:t.createScriptURL(s):s,r.async=!0,document.head.appendChild(r)}function hz(n){let e=[];return Array.isArray(window[n])?e=window[n]:window[n]=e,e}async function fz(n,e,t,r,s,i){const o=r[s];try{if(o)await e[o];else{const l=(await ED(t)).find(u=>u.measurementId===s);l&&await e[l.appId]}}catch(a){rr.error(a)}n("config",s,i)}async function pz(n,e,t,r,s){try{let i=[];if(s&&s.send_to){let o=s.send_to;Array.isArray(o)||(o=[o]);const a=await ED(t);for(const l of o){const u=a.find(f=>f.measurementId===l),h=u&&e[u.appId];if(h)i.push(h);else{i=[];break}}}i.length===0&&(i=Object.values(e)),await Promise.all(i),n("event",r,s||{})}catch(i){rr.error(i)}}function mz(n,e,t,r){async function s(i,...o){try{if(i==="event"){const[a,l]=o;await pz(n,e,t,a,l)}else if(i==="config"){const[a,l]=o;await fz(n,e,t,r,a,l)}else if(i==="consent"){const[a,l]=o;n("consent",a,l)}else if(i==="get"){const[a,l,u]=o;n("get",a,l,u)}else if(i==="set"){const[a]=o;n("set",a)}else n(i,...o)}catch(a){rr.error(a)}}return s}function gz(n,e,t,r,s){let i=function(...o){window[r].push(arguments)};return window[s]&&typeof window[s]=="function"&&(i=window[s]),window[s]=mz(i,n,e,t),{gtagCore:i,wrappedGtag:window[s]}}function yz(n){const e=window.document.getElementsByTagName("script");for(const t of Object.values(e))if(t.src&&t.src.includes(MI)&&t.src.includes(n))return t;return null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const _z=30,vz=1e3;class wz{constructor(e={},t=vz){this.throttleMetadata=e,this.intervalMillis=t}getThrottleMetadata(e){return this.throttleMetadata[e]}setThrottleMetadata(e,t){this.throttleMetadata[e]=t}deleteThrottleMetadata(e){delete this.throttleMetadata[e]}}const xD=new wz;function Iz(n){return new Headers({Accept:"application/json","x-goog-api-key":n})}async function Ez(n){var o;const{appId:e,apiKey:t}=n,r={method:"GET",headers:Iz(t)},s=az.replace("{app-id}",e),i=await fetch(s,r);if(i.status!==200&&i.status!==304){let a="";try{const l=await i.json();(o=l.error)!=null&&o.message&&(a=l.error.message)}catch{}throw vr.create("config-fetch-failed",{httpStatus:i.status,responseMessage:a})}return i.json()}async function xz(n,e=xD,t){const{appId:r,apiKey:s,measurementId:i}=n.options;if(!r)throw vr.create("no-app-id");if(!s){if(i)return{measurementId:i,appId:r};throw vr.create("no-api-key")}const o=e.getThrottleMetadata(r)||{backoffCount:0,throttleEndTimeMillis:Date.now()},a=new bz;return setTimeout(async()=>{a.abort()},t!==void 0?t:oz),TD({appId:r,apiKey:s,measurementId:i},o,a,e)}async function TD(n,{throttleEndTimeMillis:e,backoffCount:t},r,s=xD){var a;const{appId:i,measurementId:o}=n;try{await Tz(r,e)}catch(l){if(o)return rr.warn(`Timed out fetching this Firebase app's measurement ID from the server. Falling back to the measurement ID ${o} provided in the "measurementId" field in the local Firebase config. [${l==null?void 0:l.message}]`),{appId:i,measurementId:o};throw l}try{const l=await Ez(n);return s.deleteThrottleMetadata(i),l}catch(l){const u=l;if(!Sz(u)){if(s.deleteThrottleMetadata(i),o)return rr.warn(`Failed to fetch this Firebase app's measurement ID from the server. Falling back to the measurement ID ${o} provided in the "measurementId" field in the local Firebase config. [${u==null?void 0:u.message}]`),{appId:i,measurementId:o};throw l}const h=Number((a=u==null?void 0:u.customData)==null?void 0:a.httpStatus)===503?Nx(t,s.intervalMillis,_z):Nx(t,s.intervalMillis),f={throttleEndTimeMillis:Date.now()+h,backoffCount:t+1};return s.setThrottleMetadata(i,f),rr.debug(`Calling attemptFetch again in ${h} millis`),TD(n,f,r,s)}}function Tz(n,e){return new Promise((t,r)=>{const s=Math.max(e-Date.now(),0),i=setTimeout(t,s);n.addEventListener(()=>{clearTimeout(i),r(vr.create("fetch-throttle",{throttleEndTimeMillis:e}))})})}function Sz(n){if(!(n instanceof ts)||!n.customData)return!1;const e=Number(n.customData.httpStatus);return e===429||e===500||e===503||e===504}class bz{constructor(){this.listeners=[]}addEventListener(e){this.listeners.push(e)}abort(){this.listeners.forEach(e=>e())}}async function Az(n,e,t,r,s){if(s&&s.global){n("event",t,r);return}else{const i=await e,o={...r,send_to:i};n("event",t,o)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Cz(){if(am())try{await I0()}catch(n){return rr.warn(vr.create("indexeddb-unavailable",{errorInfo:n==null?void 0:n.toString()}).message),!1}else return rr.warn(vr.create("indexeddb-unavailable",{errorInfo:"IndexedDB is not available in this environment."}).message),!1;return!0}async function Rz(n,e,t,r,s,i,o){const a=xz(n);a.then(p=>{t[p.measurementId]=p.appId,n.options.measurementId&&p.measurementId!==n.options.measurementId&&rr.warn(`The measurement ID in the local Firebase config (${n.options.measurementId}) does not match the measurement ID fetched from the server (${p.measurementId}). To ensure analytics events are always sent to the correct Analytics property, update the measurement ID field in the local config or remove it from the local config.`)}).catch(p=>rr.error(p)),e.push(a);const l=Cz().then(p=>{if(p)return r.getId()}),[u,h]=await Promise.all([a,l]);yz(i)||dz(i,u.measurementId),s("js",new Date);const f=(o==null?void 0:o.config)??{};return f[iz]="firebase",f.update=!0,h!=null&&(f[sz]=h),s("config",u.measurementId,f),u.measurementId}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Nz{constructor(e){this.app=e}_delete(){return delete ku[this.app.options.appId],Promise.resolve()}}let ku={},gb=[];const yb={};let Ry="dataLayer",Pz="gtag",_b,SD,vb=!1;function kz(){const n=[];if(w0()&&n.push("This is a browser extension environment."),XA()||n.push("Cookies are not available."),n.length>0){const e=n.map((r,s)=>`(${s+1}) ${r}`).join(" "),t=vr.create("invalid-analytics-context",{errorInfo:e});rr.warn(t.message)}}function Dz(n,e,t){kz();const r=n.options.appId;if(!r)throw vr.create("no-app-id");if(!n.options.apiKey)if(n.options.measurementId)rr.warn(`The "apiKey" field is empty in the local Firebase config. This is needed to fetch the latest measurement ID for this Firebase app. Falling back to the measurement ID ${n.options.measurementId} provided in the "measurementId" field in the local Firebase config.`);else throw vr.create("no-api-key");if(ku[r]!=null)throw vr.create("already-exists",{id:r});if(!vb){hz(Ry);const{wrappedGtag:i,gtagCore:o}=gz(ku,gb,yb,Ry,Pz);SD=i,_b=o,vb=!0}return ku[r]=Rz(n,gb,yb,e,_b,Ry,t),new Nz(n)}function Oz(n=kd()){n=ne(n);const e=bs(n,$p);return e.isInitialized()?e.getImmediate():Mz(n)}function Mz(n,e={}){const t=bs(n,$p);if(t.isInitialized()){const s=t.getImmediate();if(Ir(e,t.getOptions()))return s;throw vr.create("already-initialized")}return t.initialize({options:e})}async function Lz(){if(w0()||!XA()||!am())return!1;try{return await I0()}catch{return!1}}function Vz(n,e,t,r){n=ne(n),Az(SD,ku[n.app.options.appId],e,t,r).catch(s=>rr.error(s))}const wb="@firebase/analytics",Ib="0.10.18";function Fz(){es(new sr($p,(e,{options:t})=>{const r=e.getProvider("app").getImmediate(),s=e.getProvider("installations-internal").getImmediate();return Dz(r,s,t)},"PUBLIC")),es(new sr("analytics-internal",n,"PRIVATE")),nr(wb,Ib),nr(wb,Ib,"esm2020");function n(e){try{const t=e.getProvider($p).getImmediate();return{logEvent:(r,s,i)=>Vz(t,r,s,i)}}catch(t){throw vr.create("interop-component-reg-failed",{reason:t})}}}Fz();const bD={apiKey:"AIzaSyAdJ3lRxhgZWhnqH8SNQsT1bTFB8E0-cDg",authDomain:"quitarena-a97de.firebaseapp.com",databaseURL:"https://quitarena-a97de-default-rtdb.europe-west1.firebasedatabase.app",projectId:"quitarena-a97de",storageBucket:"quitarena-a97de.firebasestorage.app",messagingSenderId:"693525963288",appId:"1:693525963288:web:a175e9a8bd56fffb35596d",measurementId:"G-H2CCRXYY74"},dg=JL().length?kd():sC(bD),te=x4(dg,bD.databaseURL),Ha=K5(dg),Pi=y9(dg);console.log("✅ Firebase services initialized:",{db:!!te,firestore:!!Ha,auth:!!Pi});qB(Pi,qk).then(()=>{console.log("Firebase Auth persistence configured for 30 days")}).catch(n=>{console.error("Error setting auth persistence:",n)});let jz=null;(async()=>{try{await Lz()&&(jz=Oz(dg))}catch(n){console.debug("Analytics not initialized:",n==null?void 0:n.message)}})();class hg{constructor(e,t){this.db=e,this.userUID=t,this.userRef=tt(e,`users/${t}`),this.statsRef=tt(e,`users/${t}/stats`),this.profileRef=tt(e,`users/${t}/profile`),this.behaviorLogRef=tt(e,`users/${t}/behaviorLog`)}async updateStat(e,t,r=""){try{const s=await on(this.statsRef);if(!s.exists())return!1;const i=s.val(),o=i[e]||0,a=Math.max(0,Math.min(100,o+t));return await Hn(this.statsRef,{...i,[e]:a}),await this.logBehavior(e,t,r),this.showStatNotification(e,t,r),console.log(`${e}: ${t>0?"+":""}${t} (${r})`),!0}catch(s){return console.error(`Error updating ${e}:`,s),!1}}async updateAddictionFromCleanTime(){try{const e=await on(tt(this.db,`users/${this.userUID}/profile/relapseDate`)),t=await on(this.userRef);if(!t.exists())return;const r=t.val(),s=e.exists()?new Date(e.val()):new Date(r.quitDate||Date.now()),o=Math.floor((new Date-s)/(1e3*60*60*24*7));if(o>=1){const a=o*2;await this.updateStat("addictionLevel",-a,`Clean time: ${o} week(s)`),o>=1&&await this.resetRelapsePenaltyLevel()}}catch(e){console.error("Error updating addiction from clean time:",e)}}async handleRelapse(){try{const e=new Date,t=await on(tt(this.db,`users/${this.userUID}/profile/relapseDate`));let r=1;if(t.exists()){const i=new Date(t.val()),o=Math.floor((e-i)/(1e3*60*60*24));o<=3?r=3:o<=7?r=2:r=1}let s=0;switch(r){case 1:s=4;break;case 2:s=6;break;case 3:s=8;break}return await Promise.all([this.updateStat("addictionLevel",s,`Relapse penalty level ${r}`),this.updateStat("mentalStrength",-3,"Relapse setback"),this.updateStat("triggerDefense",-3,"Relapse to known trigger")]),await Hn(tt(this.db,`users/${this.userUID}/profile/relapseDate`),e.toISOString()),await this.logBehavior("relapse",r,`Penalty level ${r} - ${s} addiction, -3 mental, -3 trigger defense`),!0}catch(e){return console.error("Error handling relapse:",e),!1}}async resetRelapsePenaltyLevel(){try{await Hn(tt(this.db,`users/${this.userUID}/profile/relapsePenaltyLevel`),1),console.log("Relapse penalty level reset")}catch(e){console.error("Error resetting relapse penalty level:",e)}}async handleCravingResistance(){try{return await Promise.all([this.updateStat("mentalStrength",1,"Successful craving resistance"),this.updateStat("triggerDefense",3,"Surviving trigger situation")]),await this.trackAppUsageDuringCravings(),!0}catch(e){return console.error("Error handling craving resistance:",e),!1}}async handleCravingLogged(){try{return await Promise.all([this.updateStat("motivation",.25,"Craving awareness and tracking"),this.updateStat("triggerDefense",.25,"Craving awareness and tracking")]),!0}catch(e){return console.error("Error handling craving logged:",e),!1}}async handleBreathingExercise(){try{const e=new Date().toDateString();return await Hn(tt(this.db,`users/${this.userUID}/profile/daily/${e}/breathing`),!0),await this.checkBreathingStreak()>=3&&await this.updateStat("mentalStrength",1,"3-day breathing exercise streak"),!0}catch(e){return console.error("Error handling breathing exercise:",e),!1}}async handleHydrationUpdate(e){try{const t=new Date().toDateString();return await Hn(tt(this.db,`users/${this.userUID}/profile/daily/${t}/water`),e),await this.checkHydrationStreak()>=3&&await this.updateStat("mentalStrength",1,"3-day hydration streak"),!0}catch(t){return console.error("Error handling hydration update:",t),!1}}async checkMilestoneBonuses(){try{const e=await on(tt(this.db,`users/${this.userUID}/profile/relapseDate`)),t=await on(this.userRef);if(!t.exists())return;const r=t.val(),s=e.exists()?new Date(e.val()):new Date(r.quitDate||Date.now()),o=Math.floor((new Date-s)/(1e3*60*60*24)),a=[{days:7,bonus:5,name:"First week"},{days:30,bonus:10,name:"First month"},{days:90,bonus:15,name:"Three months"}];for(const l of a)if(o>=l.days){const u=`milestone_${l.days}`;(await on(tt(this.db,`users/${this.userUID}/profile/${u}`))).exists()||await Promise.all([this.updateStat("mentalStrength",l.bonus,`${l.name} milestone bonus`),Hn(tt(this.db,`users/${this.userUID}/profile/${u}`),!0)])}}catch(e){console.error("Error checking milestone bonuses:",e)}}async trackLoggingActivity(){try{const e=new Date().toDateString(),t=new Date;return await Hn(tt(this.db,`users/${this.userUID}/profile/daily/${e}/logged`),!0),await Hn(tt(this.db,`users/${this.userUID}/profile/lastActivity`),t.toISOString()),await this.checkWeeklyLoggingFrequency()>=3&&await this.updateStat("motivation",2,"Regular logging (3+ days this week)"),!0}catch(e){return console.error("Error tracking logging activity:",e),!1}}async handleAchievementShare(){try{return await this.updateStat("motivation",3,"Sharing achievement"),!0}catch(e){return console.error("Error handling achievement share:",e),!1}}async handleTriggerPlanning(){try{return await this.updateStat("triggerDefense",1,"Pre-planning for known triggers"),!0}catch(e){return console.error("Error handling trigger planning:",e),!1}}async handleTriggerListUpdate(){try{return await this.updateStat("triggerDefense",1,"Updating trigger list"),!0}catch(e){return console.error("Error handling trigger list update:",e),!1}}async handleUnpreparedTrigger(){try{return await this.updateStat("triggerDefense",-1,"Entering trigger situation unprepared"),!0}catch(e){return console.error("Error handling unprepared trigger:",e),!1}}async checkBreathingStreak(){try{let e=0;for(let t=0;t<7;t++){const r=new Date;r.setDate(r.getDate()-t);const s=r.toDateString(),i=await on(tt(this.db,`users/${this.userUID}/profile/daily/${s}/breathing`));if(i.exists()&&i.val())e++;else break}return e}catch(e){return console.error("Error checking breathing streak:",e),0}}async checkHydrationStreak(){try{let e=0;for(let t=0;t<7;t++){const r=new Date;r.setDate(r.getDate()-t);const s=r.toDateString(),i=await on(tt(this.db,`users/${this.userUID}/profile/daily/${s}/water`));if(i.exists()&&i.val()>0)e++;else break}return e}catch(e){return console.error("Error checking hydration streak:",e),0}}async checkWeeklyLoggingFrequency(){try{let e=0;for(let t=0;t<7;t++){const r=new Date;r.setDate(r.getDate()-t);const s=r.toDateString(),i=await on(tt(this.db,`users/${this.userUID}/profile/daily/${s}/logged`));i.exists()&&i.val()&&e++}return e}catch(e){return console.error("Error checking weekly logging frequency:",e),0}}async checkInactivityPenalty(){try{const e=await on(this.userRef);if(!e.exists())return;const t=e.val(),r=new Date,s=t.createdAt?new Date(t.createdAt):t.quitStartDate?new Date(t.quitStartDate):r,i=Math.floor((r-s)/(1e3*60*60*24));if(i<7){console.log(`User registered ${i} days ago - grace period active, no inactivity penalty`);return}const o=await on(tt(this.db,`users/${this.userUID}/profile/lastActivity`));if(o.exists()){const u=new Date(o.val()),h=Math.floor((r-u)/(1e3*60*60*24));if(h>=7&&i>=7){await this.updateStat("motivation",-3,"Long period inactive (7+ days)"),console.log(`Inactivity penalty applied: ${h} days since last activity`);return}}let a=null,l=null;for(let u=0;u<10;u++){const h=new Date;h.setDate(h.getDate()-u);const f=h.toDateString(),p=await on(tt(this.db,`users/${this.userUID}/profile/daily/${f}/logged`));if(p.exists()&&p.val()){a=u,l=h;break}}if(a===null||a>=7)if(l){const u=Math.floor((r-l)/864e5);u>=7&&i>=7&&(await this.updateStat("motivation",-3,"Long period inactive (7+ days)"),console.log(`Inactivity penalty applied: ${u} days since last activity`))}else i>=7&&(await this.updateStat("motivation",-3,"Long period inactive (7+ days)"),console.log(`Inactivity penalty applied: ${i} days since registration with no activity`))}catch(e){console.error("Error checking inactivity penalty:",e)}}async trackAppUsageDuringCravings(){try{const t=`appUsage_${new Date().toDateString()}`,r=await on(tt(this.db,`users/${this.userUID}/profile/${t}`));let s=r.exists()?r.val():0;s++,await Hn(tt(this.db,`users/${this.userUID}/profile/${t}`),s),s===3&&await this.updateStat("mentalStrength",1,"Using app during cravings (3 times, no relapse)")}catch(e){console.error("Error tracking app usage during cravings:",e)}}async logBehavior(e,t,r){try{const s={timestamp:Date.now(),statName:e,change:t,reason:r,date:new Date().toISOString()};await o4(tt(this.db,`users/${this.userUID}/behaviorLog`),s)}catch(s){console.error("Error logging behavior:",s)}}showStatNotification(e,t,r){const s=document.createElement("div");s.className=`fixed top-20 right-4 z-50 p-4 rounded-lg shadow-lg transition-all duration-500 transform translate-x-full ${t>0?"bg-green-500 text-white":"bg-red-500 text-white"}`,s.innerHTML=`
      <div class="flex items-center gap-2">
        <span class="text-lg">${t>0?"↗":"↘"}</span>
        <span class="font-bold">${e}</span>
        <span class="text-xl">${t>0?"+":""}${t}</span>
      </div>
      <div class="text-sm opacity-90">${r}</div>
    `,document.body.appendChild(s),setTimeout(()=>{s.classList.remove("translate-x-full")},100),setTimeout(()=>{s.classList.add("translate-x-full"),setTimeout(()=>{s.parentNode&&s.parentNode.removeChild(s)},500)},3e3)}async runDailyUpdates(){try{const e=await on(this.userRef);if(!e.exists())return;const t=e.val(),r=new Date,s=t.createdAt?new Date(t.createdAt):t.quitStartDate?new Date(t.quitStartDate):r,i=Math.floor((r-s)/(1e3*60*60*24));if(i<1){console.log(`User registered ${i} days ago - skipping daily updates for new user`);return}await Promise.all([this.updateAddictionFromCleanTime(),this.checkMilestoneBonuses(),this.checkInactivityPenalty()])}catch(e){console.error("Error running daily updates:",e)}}async initialize(){try{await this.ensureActivityTrackingInitialized(),setInterval(()=>{this.runDailyUpdates()},24*60*60*1e3),await this.runDailyUpdates(),console.log("StatManager initialized successfully")}catch(e){console.error("Error initializing StatManager:",e)}}async ensureActivityTrackingInitialized(){try{const e=await on(tt(this.db,`users/${this.userUID}/profile/lastActivity`)),t=await on(tt(this.db,`users/${this.userUID}/createdAt`));if(!e.exists()){const i=new Date;await Hn(tt(this.db,`users/${this.userUID}/profile/lastActivity`),i.toISOString()),console.log("Initialized lastActivity timestamp for new user")}if(!t.exists()){const i=new Date;await Hn(tt(this.db,`users/${this.userUID}/createdAt`),i.toISOString()),console.log("Initialized createdAt timestamp for new user")}const r=new Date().toDateString();(await on(tt(this.db,`users/${this.userUID}/profile/daily/${r}/logged`))).exists()||(await Hn(tt(this.db,`users/${this.userUID}/profile/daily/${r}/logged`),!0),console.log("Initialized today's activity tracking for new user"))}catch(e){console.error("Error ensuring activity tracking initialization:",e)}}}const Uz=Object.freeze(Object.defineProperty({__proto__:null,default:hg},Symbol.toStringTag,{value:"Module"}));class wl{constructor(e){if(!e)throw new Error("Firestore instance is required for FirestoreBuddyService");this.firestore=e,this.matchingPoolCollection=vy(e,"matchingPool"),this.buddyPairsCollection=vy(e,"buddyPairs"),console.log("🚀 FirestoreBuddyService initialized with Firestore instance:",!!e),console.log("📁 Collections configured:",{matchingPool:this.matchingPoolCollection.path,buddyPairs:this.buddyPairsCollection.path})}async addToMatchingPool(e,t){try{console.log("🔄 Firestore: Adding user to matching pool:",e);const r={userId:e,...t,createdAt:Yh(),lastActive:Yh(),status:"waiting"};return await BS(su(this.matchingPoolCollection,e),r),console.log("✅ Firestore: User successfully added to matching pool:",e),!0}catch(r){return console.error("❌ Firestore: Failed to add user to matching pool:",r),console.error("❌ Error details:",{code:r.code,message:r.message,userId:e,userData:Object.keys(t||{})}),!1}}async removeFromMatchingPool(e){try{return console.log("🔄 Firestore: Removing user from matching pool:",e),await $S(su(this.matchingPoolCollection,e)),console.log("✅ Firestore: User successfully removed from matching pool:",e),!0}catch(t){return console.error("❌ Firestore: Failed to remove user from matching pool:",t),console.error("❌ Error details:",{code:t.code,message:t.message,userId:e}),!1}}async createBuddyPair(e,t,r={}){try{console.log("🔄 Firestore: Creating buddy pair:",{user1Id:e,user2Id:t});const s={user1Id:e,user2Id:t,createdAt:Yh(),status:"active",...r},i=await oU(this.buddyPairsCollection,s);return console.log("✅ Firestore: Buddy pair created successfully:",i.id),i.id}catch(s){return console.error("❌ Firestore: Failed to create buddy pair:",s),console.error("❌ Error details:",{code:s.code,message:s.message,user1Id:e,user2Id:t}),null}}async getAllMatchingPoolUsers(){try{console.log("🔄 Firestore: Fetching all matching pool users");const e=await iU(this.matchingPoolCollection),t=[];return e.forEach(r=>{t.push({id:r.id,...r.data()})}),console.log("✅ Firestore: Retrieved",t.length,"users from matching pool"),t}catch(e){return console.error("❌ Firestore: Failed to fetch matching pool users:",e),console.error("❌ Error details:",{code:e.code,message:e.message}),[]}}async getMatchingPoolUser(e){try{console.log("🔄 Firestore: Fetching user from matching pool:",e);const t=su(this.matchingPoolCollection,e),r=await sU(t);if(r.exists()){const s={id:r.id,...r.data()};return console.log("✅ Firestore: User found in matching pool:",e),s}else return console.log("ℹ️ Firestore: User not found in matching pool:",e),null}catch(t){return console.error("❌ Firestore: Failed to fetch user from matching pool:",t),console.error("❌ Error details:",{code:t.code,message:t.message,userId:e}),null}}async testConnectivity(){try{console.log("🧪 Firestore: Testing connectivity...");const e=vy(this.firestore,"connectionTest"),t=su(e,"test-"+Date.now()),r={test:!0,timestamp:Yh(),message:"Firestore connectivity test",service:"FirestoreBuddyService"};return await BS(t,r),console.log("✅ Firestore: Connectivity test successful"),await $S(t),console.log("🧹 Firestore: Test document cleaned up"),!0}catch(e){return console.error("❌ Firestore: Connectivity test failed:",e),console.error("❌ Error details:",{code:e.code,message:e.message}),!1}}getServiceStatus(){var e,t;return{firestore:!!this.firestore,matchingPoolCollection:((e=this.matchingPoolCollection)==null?void 0:e.path)||"not configured",buddyPairsCollection:((t=this.buddyPairsCollection)==null?void 0:t.path)||"not configured",timestamp:new Date().toISOString()}}}const Bz=({onAuthSuccess:n,isNewUser:e})=>{const[t,r]=L.useState("signin"),[s,i]=L.useState(""),[o,a]=L.useState(""),[l,u]=L.useState(""),[h,f]=L.useState(!1),[p,y]=L.useState(!1),[I,C]=L.useState(""),[P,A]=L.useState(""),[T,R]=L.useState(!1);L.useEffect(()=>()=>{p&&y(!1)},[p]);const D=new Os;D.addScope("email"),D.addScope("profile"),D.setCustomParameters({prompt:"select_account",access_type:"offline",include_granted_scopes:"true"});const F=()=>{i(""),a(""),u(""),C(""),A("")},k=async()=>{f(!0),y(!0),C("");try{console.log("Starting Google sign-in process..."),console.log("Opening Google authentication popup..."),console.log("Google provider configuration:",{scopes:D.scopes,customParameters:D.customParameters});const S=T$(Pi,D),N=new Promise((B,Ee)=>{setTimeout(()=>Ee(new Error("Popup timeout - please try again")),6e4)}),w=await Promise.race([S,N]);if(w&&w.user){const B=w.user;console.log("Google sign-in successful for:",B.email,"UID:",B.uid),console.log("User display name:",B.displayName),console.log("User photo URL:",B.photoURL),await new Promise(Ee=>setTimeout(Ee,800)),n(B)}else throw new Error("No user data received from Google authentication")}catch(S){console.error("Google sign-in error:",S),S.code==="auth/popup-closed-by-user"?C("Google sign-in was cancelled. Please try again and complete the account selection in the popup window."):S.code==="auth/popup-blocked"?C("Google sign-in popup was blocked by your browser. Please allow popups for this site and try again."):S.code==="auth/cancelled-popup-request"?C("Google sign-in was cancelled. Please try again and complete the authentication process."):S.code==="auth/account-exists-with-different-credential"?C("An account already exists with this email using a different sign-in method. Please use email/password instead."):S.message==="Popup timeout - please try again"?C("Google sign-in popup timed out. Please try again and complete the account selection quickly."):S.code==="auth/network-request-failed"?C("Network error during Google sign-in. Please check your internet connection and try again."):S.code==="auth/operation-not-allowed"?C("Google sign-in is not enabled for this app. Please contact support."):C(v(S.code))}finally{f(!1),y(!1)}},E=async S=>{S.preventDefault(),f(!0),C("");try{const w=(await MB(Pi,s,o)).user;console.log("Email sign-in successful for:",w.email),n(w)}catch(N){console.error("Email sign-in error:",N),C(v(N.code))}finally{f(!1)}},_=async S=>{if(S.preventDefault(),f(!0),C(""),o!==l){C("Passwords do not match"),f(!1);return}if(o.length<6){C("Password must be at least 6 characters long"),f(!1);return}try{const w=(await OB(Pi,s,o)).user;console.log("Email sign-up successful for:",w.email),await VB(w),n(w)}catch(N){console.error("Email sign-up error:",N),C(v(N.code))}finally{f(!1)}},b=async S=>{if(S.preventDefault(),!s){C("Please enter your email address");return}f(!0),C("");try{await kB(Pi,s),A("Password reset email sent! Check your inbox.")}catch(N){console.error("Password reset error:",N),C(v(N.code))}finally{f(!1)}},v=S=>{switch(S){case"auth/user-not-found":return"No account found with this email address";case"auth/wrong-password":return"Incorrect password";case"auth/email-already-in-use":return"An account with this email already exists";case"auth/weak-password":return"Password is too weak. Use at least 6 characters";case"auth/invalid-email":return"Invalid email address";case"auth/popup-closed-by-user":return"Google sign-in was cancelled. Please try again and complete the account selection.";case"auth/popup-blocked":return"Google sign-in popup was blocked. Please allow popups for this site and try again.";case"auth/cancelled-popup-request":return"Google sign-in was cancelled. Please try again.";case"auth/account-exists-with-different-credential":return"An account already exists with this email using a different sign-in method.";case"auth/network-request-failed":return"Network error. Please check your connection";case"auth/operation-not-allowed":return"Google sign-in is not enabled. Please contact support.";case"auth/too-many-requests":return"Too many sign-in attempts. Please try again later.";default:return"Authentication failed. Please try again"}};return T?d.jsx("div",{className:"min-h-screen bg-gray-900 flex items-center justify-center px-4",children:d.jsxs("div",{className:"max-w-md w-full space-y-8",children:[d.jsxs("div",{className:"text-center",children:[d.jsx("h2",{className:"text-3xl font-bold text-white",children:"Reset Password"}),d.jsx("p",{className:"mt-2 text-gray-400",children:"Enter your email to receive a reset link"})]}),d.jsxs("form",{onSubmit:b,className:"space-y-6",children:[d.jsxs("div",{children:[d.jsx("label",{htmlFor:"email",className:"block text-sm font-medium text-gray-300",children:"Email Address"}),d.jsx("input",{id:"email",type:"email",value:s,onChange:S=>i(S.target.value),required:!0,autoComplete:"email",className:"mt-1 block w-full px-3 py-2 bg-gray-800 border border-gray-600 rounded-md text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"Enter your email"})]}),I&&d.jsx("div",{className:"text-red-400 text-sm",children:I}),P&&d.jsx("div",{className:"text-green-400 text-sm",children:P}),d.jsxs("div",{className:"flex space-x-3",children:[d.jsx("button",{type:"button",onClick:()=>{R(!1),C(""),A("")},className:"flex-1 px-4 py-2 border border-gray-600 rounded-md text-gray-300 hover:bg-gray-700 focus:outline-none focus:ring-2 focus:ring-gray-500",children:"Back to Login"}),d.jsx("button",{type:"submit",disabled:h,className:"flex-1 px-4 py-2 bg-blue-600 border border-transparent rounded-md text-white hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 disabled:opacity-50",children:h?"Sending...":"Send Reset Link"})]})]})]})}):d.jsx("div",{className:"min-h-screen bg-gray-900 flex items-center justify-center px-4",children:d.jsxs("div",{className:"max-w-md w-full space-y-8",children:[d.jsxs("div",{className:"text-center",children:[d.jsx("h1",{className:"text-4xl font-bold text-white mb-2",children:"QuitCard Arena"}),d.jsx("p",{className:"text-gray-400",children:"Your journey to quit starts here"})]}),d.jsxs("div",{children:[p&&d.jsx("div",{className:"mb-3 p-3 bg-blue-900/20 border border-blue-500/30 rounded-lg",children:d.jsxs("div",{className:"flex items-center justify-center text-blue-300 text-sm",children:[d.jsx("div",{className:"animate-pulse mr-2",children:"🔐"}),"Google popup is open - please complete your account selection"]})}),d.jsx("button",{onClick:k,disabled:h,className:"w-full flex items-center justify-center px-4 py-3 border border-gray-600 rounded-md text-white bg-gray-800 hover:bg-gray-700 focus:outline-none focus:ring-2 focus:ring-blue-500 disabled:opacity-50",children:h?d.jsxs(d.Fragment,{children:[d.jsx("div",{className:"animate-spin rounded-full h-5 w-5 border-b-2 border-white mr-3"}),"Opening Google Sign-in..."]}):d.jsxs(d.Fragment,{children:[d.jsxs("svg",{className:"w-5 h-5 mr-3",viewBox:"0 0 24 24",children:[d.jsx("path",{fill:"currentColor",d:"M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z"}),d.jsx("path",{fill:"currentColor",d:"M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z"}),d.jsx("path",{fill:"currentColor",d:"M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z"}),d.jsx("path",{fill:"currentColor",d:"M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z"})]}),"Continue with Google"]})}),d.jsx("p",{className:"text-xs text-gray-500 mt-2 text-center",children:p?d.jsx("span",{className:"text-blue-400 font-medium",children:"🔐 Google popup is open - please complete account selection"}):"Click to open Google account selection popup"}),!1,I&&d.jsxs("div",{className:"mt-3 p-3 bg-red-900/20 border border-red-500/30 rounded-lg",children:[d.jsx("div",{className:"text-red-300 text-sm mb-2",children:I}),I.includes("Google sign-in")&&!p&&d.jsx("button",{onClick:k,disabled:h,className:"w-full px-3 py-2 bg-red-600 hover:bg-red-700 text-white text-sm rounded-md transition-colors disabled:opacity-50",children:h?"Retrying...":"Try Google Sign-in Again"})]})]}),d.jsxs("div",{className:"relative",children:[d.jsx("div",{className:"absolute inset-0 flex items-center",children:d.jsx("div",{className:"w-full border-t border-gray-600"})}),d.jsx("div",{className:"relative flex justify-center text-sm",children:d.jsx("span",{className:"px-2 bg-gray-900 text-gray-400",children:"Or continue with email"})})]}),d.jsxs("div",{className:"flex space-x-1 bg-gray-800 p-1 rounded-lg",children:[d.jsx("button",{onClick:()=>{r("signin"),F()},className:`flex-1 py-2 px-4 rounded-md text-sm font-medium transition-colors ${t==="signin"?"bg-blue-600 text-white":"text-gray-400 hover:text-white"}`,children:"Sign In"}),d.jsx("button",{onClick:()=>{r("signup"),F()},className:`flex-1 py-2 px-4 rounded-md text-sm font-medium transition-colors ${t==="signup"?"bg-blue-600 text-white":"text-gray-400 hover:text-white"}`,children:"Sign Up"})]}),t==="signin"&&d.jsxs("form",{onSubmit:E,className:"space-y-6",children:[d.jsxs("div",{children:[d.jsx("label",{htmlFor:"signin-email",className:"block text-sm font-medium text-gray-300",children:"Email Address"}),d.jsx("input",{id:"signin-email",type:"email",value:s,onChange:S=>i(S.target.value),required:!0,className:"mt-1 block w-full px-3 py-2 bg-gray-800 border border-gray-600 rounded-md text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"Enter your email"})]}),d.jsxs("div",{children:[d.jsx("label",{htmlFor:"signin-password",className:"block text-sm font-medium text-gray-300",children:"Password"}),d.jsx("input",{id:"signin-password",type:"password",value:o,onChange:S=>a(S.target.value),required:!0,autoComplete:"current-password",className:"mt-1 block w-full px-3 py-2 bg-gray-800 border border-gray-600 rounded-md text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"Enter your password"})]}),d.jsx("div",{className:"flex items-center justify-between",children:d.jsx("button",{type:"button",onClick:()=>R(!0),className:"text-sm text-blue-400 hover:text-blue-300",children:"Forgot your password?"})}),I&&d.jsx("div",{className:"text-red-400 text-sm",children:I}),d.jsx("button",{type:"submit",disabled:h,className:"w-full flex justify-center py-2 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 disabled:opacity-50",children:h?"Signing in...":"Sign In"})]}),t==="signup"&&d.jsxs("form",{onSubmit:_,className:"space-y-6",children:[d.jsxs("div",{children:[d.jsx("label",{htmlFor:"signup-email",className:"block text-sm font-medium text-gray-300",children:"Email Address"}),d.jsx("input",{id:"signup-email",type:"email",value:s,onChange:S=>i(S.target.value),required:!0,autoComplete:"email",className:"mt-1 block w-full px-3 py-2 bg-gray-800 border border-gray-600 rounded-md text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"Enter your email"})]}),d.jsxs("div",{children:[d.jsx("label",{htmlFor:"signup-password",className:"block text-sm font-medium text-gray-300",children:"Password"}),d.jsx("input",{id:"signup-password",type:"password",value:o,onChange:S=>a(S.target.value),required:!0,autoComplete:"new-password",className:"mt-1 block w-full px-3 py-2 bg-gray-800 border border-gray-600 rounded-md text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"Create a password (min 6 characters)"})]}),d.jsxs("div",{children:[d.jsx("label",{htmlFor:"confirm-password",className:"block text-sm font-medium text-gray-300",children:"Confirm Password"}),d.jsx("input",{id:"confirm-password",type:"password",value:l,onChange:S=>u(S.target.value),required:!0,autoComplete:"new-password",className:"mt-1 block w-full px-3 py-2 bg-gray-800 border border-gray-600 rounded-md text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"Confirm your password"})]}),I&&d.jsx("div",{className:"text-red-400 text-sm",children:I}),P&&d.jsx("div",{className:"text-green-400 text-sm",children:P}),d.jsx("button",{type:"submit",disabled:h,className:"w-full flex justify-center py-2 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 disabled:opacity-50",children:h?"Creating account...":"Create Account"})]})]})})},$z=()=>{const[n,e]=L.useState(navigator.onLine),[t,r]=L.useState(!1);return L.useEffect(()=>{const s=()=>{e(!0),r(!1),console.log("🌐 Connection restored")},i=()=>{e(!1),r(!0),console.log("📡 Connection lost")};return window.addEventListener("online",s),window.addEventListener("offline",i),e(navigator.onLine),()=>{window.removeEventListener("online",s),window.removeEventListener("offline",i)}},[]),n?null:d.jsxs("div",{className:"fixed top-0 left-0 right-0 z-50 bg-yellow-600 text-white p-3 text-center shadow-lg",children:[d.jsxs("div",{className:"flex items-center justify-center space-x-2",children:[d.jsx("svg",{className:"w-5 h-5 animate-pulse",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:d.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L3.732 16.5c-.77.833.192 2.5 1.732 2.5z"})}),d.jsx("span",{className:"font-medium",children:"You're offline. Some features may be limited."}),d.jsx("button",{onClick:()=>r(!1),className:"ml-2 text-white hover:text-yellow-200 transition-colors",children:d.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:d.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),t&&d.jsxs("div",{className:"mt-2 text-sm bg-yellow-700 p-2 rounded",children:[d.jsx("p",{className:"mb-2",children:"While offline, you can:"}),d.jsxs("ul",{className:"text-left space-y-1 ml-4",children:[d.jsx("li",{children:"• View your current stats and progress"}),d.jsx("li",{children:"• Track habits and cravings"}),d.jsx("li",{children:"• Play distraction games"}),d.jsx("li",{children:"• View your profile information"})]}),d.jsx("p",{className:"mt-2 text-yellow-200",children:"Changes will sync when you're back online."})]})]})},zz=({selectedRate:n,duration:e,onRateSelect:t,onDurationSelect:r,onStartExercise:s})=>d.jsxs("div",{className:"p-8",children:[d.jsxs("div",{className:"text-center mb-8",children:[d.jsx("h2",{className:"text-2xl font-bold text-white mb-2",children:"Breathing Exercise"}),d.jsx("p",{className:"text-slate-400",children:"Configure your breathing session"})]}),d.jsx("div",{onClick:t,className:"bg-slate-800/50 hover:bg-slate-700/50 rounded-2xl p-6 mb-6 border border-slate-600/30 cursor-pointer transition-all duration-300 hover:scale-[1.02] group",children:d.jsxs("div",{className:"flex items-center justify-between",children:[d.jsxs("div",{className:"flex items-center space-x-4",children:[d.jsx("div",{className:"w-12 h-12 bg-slate-700/50 rounded-xl flex items-center justify-center group-hover:bg-slate-600/50 transition-colors",children:d.jsx("span",{className:"text-2xl",children:"🫁"})}),d.jsxs("div",{className:"text-left",children:[d.jsx("div",{className:"text-white font-semibold text-lg",children:"BREATHING RATE"}),d.jsxs("div",{className:"text-slate-400 text-sm",children:[n.inhale,"s | ",n.exhale,"s"]})]})]}),d.jsxs("div",{className:"text-right",children:[d.jsx("div",{className:"text-white font-bold text-lg",children:n.name}),d.jsxs("div",{className:"text-slate-400 text-sm",children:[n.inhale,"s | ",n.exhale,"s"]})]})]})}),d.jsx("div",{onClick:r,className:"bg-slate-800/50 hover:bg-slate-700/50 rounded-2xl p-6 mb-8 border border-slate-600/30 cursor-pointer transition-all duration-300 hover:scale-[1.02] group",children:d.jsxs("div",{className:"flex items-center justify-between",children:[d.jsxs("div",{className:"flex items-center space-x-4",children:[d.jsx("div",{className:"w-12 h-12 bg-slate-700/50 rounded-xl flex items-center justify-center group-hover:bg-slate-600/50 transition-colors",children:d.jsx("span",{className:"text-2xl",children:"⏱️"})}),d.jsxs("div",{className:"text-left",children:[d.jsx("div",{className:"text-white font-semibold text-lg",children:"DURATION"}),d.jsx("div",{className:"text-slate-400 text-sm",children:"Session length"})]})]}),d.jsxs("div",{className:"text-right",children:[d.jsxs("div",{className:"text-white font-bold text-lg",children:[e,"min."]}),d.jsx("div",{className:"text-slate-400 text-sm",children:"Total time"})]})]})}),d.jsx("button",{onClick:s,className:"w-full bg-gradient-to-r from-blue-600 to-purple-600 hover:from-blue-700 hover:to-purple-700 text-white font-bold text-lg py-4 px-6 rounded-2xl transition-all duration-300 hover:scale-105 shadow-lg hover:shadow-xl",children:"START EXERCISE"}),d.jsx("div",{className:"mt-6 text-center",children:d.jsx("p",{className:"text-slate-400 text-sm",children:"Find a comfortable position and prepare to relax"})})]}),qz=({selectedRate:n,onSelect:e,onBack:t})=>{const r=[{name:"INTRO",inhale:3,exhale:6},{name:"BASIC",inhale:5,exhale:10},{name:"INTERMEDIATE",inhale:10,exhale:20},{name:"ADVANCED",inhale:20,exhale:40},{name:"ELITE",inhale:30,exhale:60}];return d.jsxs("div",{className:"p-8",children:[d.jsxs("div",{className:"text-center mb-8",children:[d.jsx("h2",{className:"text-2xl font-bold text-white mb-2",children:"BREATHING RATE"}),d.jsx("p",{className:"text-slate-400",children:"Choose your breathing pattern"})]}),d.jsx("div",{className:"space-y-4 mb-8",children:r.map(s=>d.jsx("div",{onClick:()=>e(s),className:`rounded-2xl p-6 border transition-all duration-300 cursor-pointer hover:scale-[1.02] ${n.name===s.name?"bg-white text-slate-900 border-white shadow-lg":"bg-slate-800/50 text-white border-slate-600/30 hover:bg-slate-700/50"}`,children:d.jsxs("div",{className:"flex items-center justify-between",children:[d.jsxs("div",{className:"text-left",children:[d.jsx("div",{className:`font-bold text-lg ${n.name===s.name?"text-slate-900":"text-white"}`,children:s.name}),d.jsxs("div",{className:`text-sm ${n.name===s.name?"text-slate-600":"text-slate-400"}`,children:[s.inhale,"s inhale | ",s.exhale,"s exhale"]})]}),n.name===s.name&&d.jsx("div",{className:"w-6 h-6 bg-slate-900 rounded-full flex items-center justify-center",children:d.jsx("svg",{className:"w-4 h-4 text-white",fill:"currentColor",viewBox:"0 0 20 20",children:d.jsx("path",{fillRule:"evenodd",d:"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z",clipRule:"evenodd"})})})]})},s.name))}),d.jsx("button",{onClick:t,className:"w-full bg-slate-700/50 hover:bg-slate-600/50 text-white font-medium py-3 px-6 rounded-2xl transition-all duration-300 border border-slate-600/30",children:"Back to Setup"})]})},Wz=({selectedDuration:n,onSelect:e,onBack:t})=>{const[r,s]=L.useState(n),[i,o]=L.useState(!1),[a,l]=L.useState(0),[u,h]=L.useState(0),[f,p]=L.useState(0),[y,I]=L.useState(0),[C,P]=L.useState(0),A=L.useRef(null),T=L.useRef(null),R=L.useRef(0),D=L.useRef(0),F=Array.from({length:9},($,G)=>G+2),k=80;L.useEffect(()=>{if(s(n),A.current){const G=F.indexOf(n)*k;A.current.scrollTop=G,R.current=G}},[n,F]);const E=L.useCallback($=>{let G=$,J=A.current.scrollTop;const he=()=>{if(Math.abs(G)<.1){_();return}G*=.95,J+=G,A.current&&(A.current.scrollTop=J,R.current=J),T.current=requestAnimationFrame(he)};T.current=requestAnimationFrame(he)},[]),_=L.useCallback(()=>{if(!A.current)return;const $=A.current.scrollTop,G=Math.round($/k),J=Math.max(0,Math.min(G,F.length-1)),he=F[J],pe=J*k;s(he),A.current.scrollTo({top:pe,behavior:"smooth"}),R.current=pe},[F]),b=L.useCallback($=>{$.preventDefault(),T.current&&(cancelAnimationFrame(T.current),T.current=null),o(!0),l($.touches[0].clientY),h(A.current.scrollTop),p(0),I(Date.now()),P($.touches[0].clientY),D.current=Date.now()},[]),v=L.useCallback($=>{if(!i)return;$.preventDefault();const G=$.touches[0].clientY,J=a-G,he=u+J;A.current&&(A.current.scrollTop=he,R.current=he);const pe=Date.now(),Te=pe-y;if(Te>0){const dt=(C-G)/Te;p(dt)}I(pe),P(G)},[i,a,u,y,C]),S=L.useCallback(()=>{i&&(o(!1),Math.abs(f)>.5?E(f*16):_())},[i,f,E,_]),N=L.useCallback($=>{$.preventDefault(),T.current&&(cancelAnimationFrame(T.current),T.current=null),o(!0),l($.clientY),h(A.current.scrollTop),p(0),I(Date.now()),P($.clientY),D.current=Date.now(),document.addEventListener("mousemove",w),document.addEventListener("mouseup",B)},[]),w=L.useCallback($=>{if(!i)return;const G=$.clientY,J=a-G,he=u+J;A.current&&(A.current.scrollTop=he,R.current=he);const pe=Date.now(),Te=pe-y;if(Te>0){const dt=(C-G)/Te;p(dt)}I(pe),P(G)},[i,a,u,y,C]),B=L.useCallback(()=>{i&&(o(!1),document.removeEventListener("mousemove",w),document.removeEventListener("mouseup",B),Math.abs(f)>.5?E(f*16):_())},[i,f,E,_]),Ee=L.useCallback($=>{$.preventDefault(),T.current&&(cancelAnimationFrame(T.current),T.current=null);const G=$.deltaY,J=A.current.scrollTop+G;A.current&&(A.current.scrollTop=J,R.current=J),setTimeout(()=>{_()},150)},[_]);L.useEffect(()=>()=>{T.current&&cancelAnimationFrame(T.current)},[]);const le=$=>{if(s($),A.current){const J=F.indexOf($)*k;A.current.scrollTo({top:J,behavior:"smooth"}),R.current=J}navigator.vibrate&&navigator.vibrate(50)},Be=()=>{e(r)};return d.jsxs("div",{className:"p-8",children:[d.jsxs("div",{className:"text-center mb-8",children:[d.jsx("h2",{className:"text-2xl font-bold text-white mb-2",children:"DURATION"}),d.jsx("p",{className:"text-slate-400",children:"Choose your session length"})]}),d.jsxs("div",{className:"relative mb-8",children:[d.jsx("div",{className:"absolute left-1/2 top-1/2 transform -translate-x-1/2 -translate-y-1/2 w-48 h-20 bg-gradient-to-r from-blue-500/20 to-purple-500/20 rounded-xl border-2 border-blue-400/50 pointer-events-none z-10 shadow-lg"}),d.jsxs("div",{ref:A,className:"h-60 overflow-hidden relative select-none",onTouchStart:b,onTouchMove:v,onTouchEnd:S,onMouseDown:N,onWheel:Ee,children:[d.jsx("div",{className:"h-20"}),d.jsx("div",{className:"space-y-0",children:F.map($=>d.jsx("div",{onClick:()=>le($),className:`h-20 flex items-center justify-center text-4xl font-bold cursor-pointer transition-all duration-300 select-none ${r===$?"text-white scale-110 font-extrabold drop-shadow-lg":"text-slate-400 hover:text-slate-300"}`,children:$},$))}),d.jsx("div",{className:"h-20"})]}),d.jsx("div",{className:"text-center mt-4",children:d.jsx("p",{className:"text-slate-500 text-sm",children:i?"Release to snap":"Drag to scroll • Click to select"})})]}),d.jsx("button",{onClick:Be,className:"w-full bg-gradient-to-r from-green-600 to-green-700 hover:from-green-700 hover:to-green-800 text-white font-bold text-lg py-4 px-6 rounded-2xl transition-all duration-300 hover:scale-105 shadow-lg transform active:scale-95",children:"SAVE"}),d.jsx("button",{onClick:t,className:"w-full mt-4 bg-slate-700/50 hover:bg-slate-600/50 text-white font-medium py-3 px-6 rounded-2xl transition-all duration-300 border border-slate-600/30 hover:border-slate-500/50",children:"Back to Setup"})]})},Gz=({rate:n,duration:e,onComplete:t,onClose:r})=>{const[s,i]=L.useState(e*60),[o,a]=L.useState("inhale"),[l,u]=L.useState(0),[h,f]=L.useState(!1),[p,y]=L.useState(0),I=L.useRef(null),C=L.useRef(null),P=L.useRef(null);L.useEffect(()=>(f(!0),T(),A(),()=>{I.current&&cancelAnimationFrame(I.current),C.current&&clearInterval(C.current),P.current&&clearInterval(P.current)}),[]);const A=()=>{C.current=setInterval(()=>{i(_=>_<=1?(clearInterval(C.current),t(),0):_-1)},1e3)},T=()=>{const _=n.inhale+n.exhale;let b=0;const v=()=>{b+=16,b>=_*1e3&&(b=0);const S=b%(n.inhale*1e3)/(n.inhale*1e3);b<n.inhale*1e3?(o!=="inhale"&&(a("inhale"),u(0)),y(.3+S*.7)):(o!=="exhale"&&(a("exhale"),u(0)),y(1-S*.7)),I.current=requestAnimationFrame(v)};v()},R=()=>{P.current=setInterval(()=>{u(_=>_+1)},1e3)};L.useEffect(()=>(h&&R(),()=>{P.current&&clearInterval(P.current)}),[h,o]);const D=_=>{const b=Math.floor(_/60),v=_%60;return`${b.toString().padStart(2,"0")}:${v.toString().padStart(2,"0")}`},F=()=>o==="inhale"?"from-orange-400 to-red-500":"from-blue-400 to-cyan-500",k=()=>o==="inhale"?"Inhale through the nose":"Exhale slowly through the mouth and empty your lungs",E=()=>{const _=o==="inhale"?n.inhale:n.exhale;return Math.min(l,_)};return d.jsxs("div",{className:"h-screen bg-slate-900 flex flex-col",children:[d.jsxs("div",{className:"flex items-center justify-between p-6",children:[d.jsx("button",{onClick:r,className:"w-8 h-8 flex items-center justify-center text-white hover:text-slate-300 transition-colors",children:d.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:d.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})}),d.jsxs("div",{className:"text-center",children:[d.jsx("h1",{className:"text-white font-bold text-lg",children:"INCREASE RELAXATION"}),d.jsx("div",{className:"text-white text-2xl font-mono",children:D(s)})]}),d.jsx("div",{className:"w-8"})," "]}),d.jsxs("div",{className:"flex-1 flex items-center justify-center relative",children:[d.jsx("div",{className:"absolute w-80 h-80 border-2 border-dashed border-white/30 rounded-full"}),d.jsx("div",{className:"absolute w-64 h-64 border-2 border-dashed border-white/20 rounded-full"}),d.jsx("div",{className:`w-20 h-20 bg-gradient-to-br ${F()} rounded-full transition-all duration-300 ease-in-out shadow-2xl`,style:{transform:`scale(${p})`,boxShadow:`0 0 ${p*50}px ${p*20}px ${o==="inhale"?"rgba(251, 146, 60, 0.5)":"rgba(59, 130, 246, 0.5)"}`}})]}),d.jsxs("div",{className:"p-6 text-center",children:[d.jsxs("div",{className:"flex items-center justify-center space-x-3 mb-4",children:[d.jsx("div",{className:`w-3 h-3 rounded-full ${o==="inhale"?"bg-orange-400":"bg-blue-400"}`}),d.jsx("span",{className:"text-white text-lg",children:k()})]}),d.jsxs("div",{className:"text-slate-400 text-sm",children:[E(),"/",o==="inhale"?n.inhale:n.exhale,"s"]})]}),d.jsx("div",{className:"px-6 pb-6",children:d.jsx("div",{className:"w-full bg-slate-700/30 rounded-full h-1",children:d.jsx("div",{className:"bg-gradient-to-r from-blue-500 to-purple-500 h-1 rounded-full transition-all duration-1000 ease-out",style:{width:`${(e*60-s)/(e*60)*100}%`}})})})]})},Hz=({isOpen:n,onClose:e})=>{const[t,r]=L.useState("setup"),[s,i]=L.useState({name:"INTERMEDIATE",inhale:10,exhale:20}),[o,a]=L.useState(4),[l,u]=L.useState(!1);L.useEffect(()=>{n&&(r("setup"),u(!1))},[n]);const h=C=>{i(C),r("setup")},f=C=>{a(C),r("setup")},p=()=>{u(!0),r("exercise")},y=()=>{u(!1),r("setup"),e()},I=()=>{t==="exercise"&&l||e()};return n?d.jsxs("div",{className:"fixed inset-0 z-50 flex items-center justify-center",children:[d.jsx("div",{className:"absolute inset-0 bg-black/80 backdrop-blur-sm",onClick:I}),d.jsxs("div",{className:"relative w-full max-w-md mx-4 bg-slate-900 rounded-3xl shadow-2xl border border-slate-700/50 overflow-hidden",children:[d.jsx("button",{onClick:I,className:"absolute top-4 left-4 z-10 w-8 h-8 flex items-center justify-center text-white hover:text-slate-300 transition-colors",children:d.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:d.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})}),t==="setup"&&d.jsx(zz,{selectedRate:s,duration:o,onRateSelect:()=>r("rate"),onDurationSelect:()=>r("duration"),onStartExercise:p}),t==="rate"&&d.jsx(qz,{selectedRate:s,onSelect:h,onBack:()=>r("setup")}),t==="duration"&&d.jsx(Wz,{selectedDuration:o,onSelect:f,onBack:()=>r("setup")}),t==="exercise"&&d.jsx(Gz,{rate:s,duration:o,onComplete:y,onClose:I})]})]}):null};var Kz={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};const Qz=n=>n.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase(),Yz=(n,e)=>{const t=L.forwardRef(({color:r="currentColor",size:s=24,strokeWidth:i=2,absoluteStrokeWidth:o,children:a,...l},u)=>L.createElement("svg",{ref:u,...Kz,width:s,height:s,stroke:r,strokeWidth:o?Number(i)*24/Number(s):i,className:`lucide lucide-${Qz(n)}`,...l},[...e.map(([h,f])=>L.createElement(h,f)),...(Array.isArray(a)?a:[a])||[]]));return t.displayName=`${n}`,t};var or=Yz;const Jz=or("ArrowRight",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"m12 5 7 7-7 7",key:"xquz4c"}]]),Xz=or("Calendar",[["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",ry:"2",key:"eu3xkr"}],["line",{x1:"16",x2:"16",y1:"2",y2:"6",key:"m3sa8f"}],["line",{x1:"8",x2:"8",y1:"2",y2:"6",key:"18kwsl"}],["line",{x1:"3",x2:"21",y1:"10",y2:"10",key:"xt86sb"}]]),AD=or("DollarSign",[["line",{x1:"12",x2:"12",y1:"2",y2:"22",key:"7eqyqh"}],["path",{d:"M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6",key:"1b0p4s"}]]),CD=or("Heart",[["path",{d:"M19 14c1.49-1.46 3-3.21 3-5.5A5.5 5.5 0 0 0 16.5 3c-1.76 0-3 .5-4.5 2-1.5-1.5-2.74-2-4.5-2A5.5 5.5 0 0 0 2 8.5c0 2.3 1.5 4.05 3 5.5l7 7Z",key:"c3ymky"}]]),Zz=or("Home",[["path",{d:"m3 9 9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z",key:"y5dka4"}],["polyline",{points:"9 22 9 12 15 12 15 22",key:"e2us08"}]]),ef=or("RefreshCw",[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]]),RD=or("Settings",[["path",{d:"M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.5a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z",key:"1qme2f"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]),Sd=or("Shield",[["path",{d:"M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z",key:"3xmgem"}]]),e8=or("Sparkles",[["path",{d:"m12 3-1.912 5.813a2 2 0 0 1-1.275 1.275L3 12l5.813 1.912a2 2 0 0 1 1.275 1.275L12 21l1.912-5.813a2 2 0 0 1 1.275-1.275L21 12l-5.813-1.912a2 2 0 0 1-1.275-1.275L12 3Z",key:"17u4zn"}],["path",{d:"M5 3v4",key:"bklmnn"}],["path",{d:"M19 17v4",key:"iiml17"}],["path",{d:"M3 5h4",key:"nem4j1"}],["path",{d:"M17 19h4",key:"lbex7p"}]]),ND=or("Star",[["polygon",{points:"12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2",key:"8f66p6"}]]),t8=or("Sword",[["polyline",{points:"14.5 17.5 3 6 3 3 6 3 17.5 14.5",key:"1hfsw2"}],["line",{x1:"13",x2:"19",y1:"19",y2:"13",key:"1vrmhu"}],["line",{x1:"16",x2:"20",y1:"16",y2:"20",key:"1bron3"}],["line",{x1:"19",x2:"21",y1:"21",y2:"19",key:"13pww6"}]]),PD=or("Trophy",[["path",{d:"M6 9H4.5a2.5 2.5 0 0 1 0-5H6",key:"17hqa7"}],["path",{d:"M18 9h1.5a2.5 2.5 0 0 0 0-5H18",key:"lmptdp"}],["path",{d:"M4 22h16",key:"57wxv0"}],["path",{d:"M10 14.66V17c0 .55-.47.98-.97 1.21C7.85 18.75 7 20.24 7 22",key:"1nw9bq"}],["path",{d:"M14 14.66V17c0 .55.47.98.97 1.21C16.15 18.75 17 20.24 17 22",key:"1np0yb"}],["path",{d:"M18 2H6v7a6 6 0 0 0 12 0V2Z",key:"u46fv3"}]]),kD=or("User",[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]]),DD=or("Users",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["path",{d:"M22 21v-2a4 4 0 0 0-3-3.87",key:"kshegd"}],["path",{d:"M16 3.13a4 4 0 0 1 0 7.75",key:"1da9ce"}]]);console.log("🧪 FirestoreBuddyService import check:",!!wl);console.log("🧪 FirestoreBuddyService type:",typeof wl);console.log("🧪 FirestoreBuddyService constructor:",wl==null?void 0:wl.name);const ks=(n,e="adventurer")=>{const t="https://api.dicebear.com/7.x",r={seed:n||Math.random().toString(36).substring(7),backgroundColor:["b6e3f4","c0aede","ffdfbf","ffd5dc"],radius:50,size:200},s=new URLSearchParams(r).toString();return`${t}/${e}/svg?${s}`},tf=n=>{const e=["#3B82F6","#10B981","#F59E0B","#EF4444","#8B5CF6","#EC4899"],t=e[n.charCodeAt(0)%e.length],r=n.substring(0,2).toUpperCase();return`data:image/svg+xml,${encodeURIComponent(`
    <svg width="200" height="200" xmlns="http://www.w3.org/2000/svg">
      <rect width="200" height="200" fill="${t}"/>
      <text x="100" y="120" font-family="Arial, sans-serif" font-size="80" font-weight="bold" text-anchor="middle" fill="white">${r}</text>
    </svg>
  `)}`},n8=({onComplete:n,authUser:e})=>{const[t,r]=L.useState(1),[s,i]=L.useState({heroName:"",archetype:"",avatar:null,avatarSeed:Math.random().toString(36).substring(7),triggers:[],dailyPatterns:[],copingStrategies:[],vapePodsPerWeek:0,nicotineStrength:"",quitAttempts:"",confidence:5}),[o,a]=L.useState(!1),[l,u]=L.useState(!1),[h,f]=L.useState(null),[p,y]=L.useState(null),I=[{id:"DETERMINED",name:"The Determined",description:"Unstoppable willpower and determination",color:"bg-red-500",icon:Sd},{id:"SOCIAL_FIGHTER",name:"The Social Fighter",description:"Thrives on community support",color:"bg-blue-500",icon:DD},{id:"HEALTH_WARRIOR",name:"The Health Warrior",description:"Focused on physical and mental wellness",color:"bg-green-500",icon:CD},{id:"MONEY_SAVER",name:"The Money Saver",description:"Motivated by financial freedom",color:"bg-yellow-500",icon:AD}],C=["Stress/anxiety","Social situations","Boredom","After meals","Drinking alcohol","Work breaks","Driving"],P=["Morning routine","Work breaks","After meals","Evening wind-down","Social events","Throughout the day"],A=["Breathing exercises","Nicotine replacement therapy","Exercise/physical activity","Distraction techniques","Nothing - this is new to me"],T=()=>{console.log("Calculating stats with userData:",s);let v=40;s.vapePodsPerWeek<=1?v+=5:s.vapePodsPerWeek<=3?v+=15:s.vapePodsPerWeek<=5?v+=25:s.vapePodsPerWeek<=7?v+=35:v+=40;const S=s.nicotineStrength||"",N=parseInt(S.replace("mg",""))||0;N<=5?v+=0:N<=11?v+=10:N<=20?v+=20:v+=25,s.dailyPatterns.includes("Throughout the day")?v+=20:s.dailyPatterns.length>2?v+=10:v+=0,v=Math.min(v,100);let w=25;s.confidence>=9?w+=35:s.confidence>=7?w+=25:s.confidence>=4?w+=15:w+=0,s.quitAttempts==="first"?w+=15:parseInt(s.quitAttempts)<=3?w+=10:w+=5,s.copingStrategies.length>=3?w+=15:s.copingStrategies.length>=1?w+=10:w+=0,w=Math.min(w,80);let B=35;B+={DETERMINED:20,HEALTH_WARRIOR:15,SOCIAL_FIGHTER:15,MONEY_SAVER:10}[s.archetype]||0,s.confidence>=8?B+=25:s.confidence>=5?B+=15:B+=0,s.quitAttempts==="first"?B+=10:parseInt(s.quitAttempts)<=3?B+=5:B+=15,B=Math.min(B,90);let le=15;s.triggers.length<=2?le+=15:s.triggers.length<=4?le+=10:le+=5;const Be=s.triggers.includes("Drinking alcohol"),$=s.triggers.includes("Social situations");return Be&&$?le+=0:s.triggers.length>3?le+=5:le+=10,s.copingStrategies.length>=3?le+=25:s.copingStrategies.length>=1?le+=15:le+=0,s.dailyPatterns.includes("Throughout the day")?le+=0:s.dailyPatterns.length>2?le+=5:le+=10,le=Math.min(le,60),{addictionLevel:v,mentalStrength:w,motivation:B,triggerDefense:le}},R=v=>{const S=v.target.files[0];if(S){f(S);const N=new FileReader;N.onload=w=>y(w.target.result),N.readAsDataURL(S)}},D=async()=>{if(h){u(!0);try{const v=document.createElement("canvas"),S=v.getContext("2d"),N=new Image;N.onload=()=>{v.width=200,v.height=200,S.filter="contrast(1.2) saturate(1.3) brightness(1.1)",S.drawImage(N,0,0,200,200),S.globalCompositeOperation="overlay",S.fillStyle="rgba(255, 200, 200, 0.1)",S.fillRect(0,0,200,200);const w=v.toDataURL("image/png"),B={...s,avatar:w};i(B),b(B,3),u(!1)},N.src=p}catch(v){console.error("Photo processing failed:",v);const S=tf(s.avatarSeed);i(N=>({...N,avatar:S})),u(!1)}}},F=()=>{a(!0);const v=Math.random().toString(36).substring(7);(async()=>{try{const N=ks(v),w={...s,avatarSeed:v,avatar:N};i(w),b(w,3)}catch{const w=tf(v),B={...s,avatarSeed:v,avatar:w};i(B),b(B,3)}})(),setTimeout(()=>a(!1),500)},k=async()=>{if(t<10)await b(s,t),r(t+1);else try{console.log("Completing onboarding with userData:",s);const v=T();console.log("Calculated stats:",v);const S={...s,stats:{...v,streakDays:0,experiencePoints:0},achievements:[],quitDate:new Date};await b(S,10),console.log("Final user data:",S),n(S)}catch(v){console.error("Error completing onboarding:",v);const N={...s,stats:{...{addictionLevel:50,mentalStrength:50,motivation:50,triggerDefense:30},streakDays:0,experiencePoints:0},achievements:[],quitDate:new Date};try{await b(N,10)}catch(w){console.error("Failed to save fallback data to Firebase:",w)}console.log("Using fallback stats:",N),n(N)}},E=()=>{t>1&&r(t-1)},_=()=>{switch(t){case 1:return s.heroName.trim().length>0;case 2:return s.archetype!=="";case 3:return s.avatar!==null;case 4:return s.triggers.length>0;case 5:return s.dailyPatterns.length>0;case 6:return s.copingStrategies.length>0;case 7:return s.vapePodsPerWeek>0;case 8:return s.nicotineStrength!=="";case 9:return s.quitAttempts!=="";case 10:return s.confidence>0;default:return!1}},b=async(v,S)=>{if(e)try{const{ref:N,set:w}=await Re(()=>import("./index.esm-d8b59866.js"),[]),B=N(te,`users/${e.uid}/onboarding`);await w(N(te,`users/${e.uid}/onboarding/step${S}`),{...v,stepNumber:S,timestamp:Date.now()}),await w(N(te,`users/${e.uid}/onboarding/progress`),{currentStep:S,completedSteps:Array.from({length:S},(Ee,le)=>le+1),lastUpdated:Date.now()}),console.log(`Step ${S} saved to Firebase successfully`)}catch(N){console.error(`Error saving step ${S} to Firebase:`,N)}};return L.useEffect(()=>{if(!s.avatar){const v=ks(s.avatarSeed);i(S=>({...S,avatar:v}))}},[]),d.jsx("div",{className:"min-h-screen bg-gradient-to-br from-slate-900 via-blue-900 to-slate-900 flex items-center justify-center p-4",children:d.jsxs("div",{className:"bg-slate-800/80 backdrop-blur-sm rounded-2xl p-8 max-w-md w-full shadow-2xl border border-slate-700",children:[d.jsx("div",{className:"flex justify-between items-center mb-8 overflow-x-auto",children:[1,2,3,4,5,6,7,8,9,10].map(v=>d.jsxs("div",{className:"flex items-center flex-shrink-0",children:[d.jsx("div",{className:`w-6 h-6 rounded-full flex items-center justify-center text-xs font-bold ${v<=t?"bg-blue-500 text-white":"bg-slate-600 text-gray-400"}`,children:v<t?"✓":v}),v<10&&d.jsx("div",{className:`w-4 h-1 mx-1 ${v<t?"bg-blue-500":"bg-slate-600"}`})]},v))}),t===1&&d.jsxs("div",{className:"text-center",children:[d.jsx("div",{className:"w-20 h-20 bg-gradient-to-br from-blue-400 to-blue-600 rounded-full flex items-center justify-center mx-auto mb-6",children:d.jsx(e8,{className:"w-10 h-10 text-white"})}),d.jsx("h1",{className:"text-2xl font-bold text-white mb-4",children:"Welcome to QuitCard Arena"}),d.jsx("p",{className:"text-gray-300 mb-6",children:"Your journey to freedom starts here. Let's create your hero identity."}),d.jsxs("div",{className:"mb-6",children:[d.jsx("label",{className:"block text-left text-white text-sm font-medium mb-2",children:"What's your hero name?"}),d.jsx("input",{type:"text",value:s.heroName,onChange:v=>{const S={...s,heroName:v.target.value};i(S),v.target.value.trim().length>0&&b(S,1)},placeholder:"e.g., FreedomSeeker, HealthGuardian",className:"w-full px-4 py-3 bg-slate-700 border border-slate-600 rounded-lg text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]})]}),t===2&&d.jsxs("div",{className:"text-center",children:[d.jsx("div",{className:"w-20 h-20 bg-gradient-to-br from-green-400 to-green-600 rounded-full flex items-center justify-center mx-auto mb-6",children:d.jsx(Sd,{className:"w-10 h-10 text-white"})}),d.jsx("h1",{className:"text-2xl font-bold text-white mb-4",children:"Choose Your Archetype"}),d.jsx("p",{className:"text-gray-300 mb-6",children:"Select the warrior type that resonates with your journey."}),d.jsx("div",{className:"space-y-3 mb-6",children:I.map(v=>{const S=v.icon;return d.jsx("button",{onClick:()=>{const N={...s,archetype:v.id};i(N),b(N,2)},className:`w-full p-4 rounded-lg border-2 transition-all duration-300 text-left ${s.archetype===v.id?"border-blue-500 bg-blue-500/20":"border-slate-600 bg-slate-700 hover:border-slate-500"}`,children:d.jsxs("div",{className:"flex items-center gap-3",children:[d.jsx("div",{className:`w-10 h-10 ${v.color} rounded-lg flex items-center justify-center`,children:d.jsx(S,{className:"w-5 h-5 text-white"})}),d.jsxs("div",{children:[d.jsx("h3",{className:"text-white font-semibold",children:v.name}),d.jsx("p",{className:"text-gray-400 text-sm",children:v.description})]})]})},v.id)})})]}),t===3&&d.jsxs("div",{className:"text-center",children:[d.jsx("div",{className:"w-20 h-20 bg-gradient-to-br from-purple-400 to-purple-600 rounded-full flex items-center justify-center mx-auto mb-6",children:d.jsx(kD,{className:"w-10 h-10 text-white"})}),d.jsx("h1",{className:"text-2xl font-bold text-white mb-4",children:"Create Your Avatar"}),d.jsx("p",{className:"text-gray-300 mb-6",children:"Choose your battle card identity in the arena."}),d.jsxs("div",{className:"mb-6",children:[d.jsx("div",{className:"w-32 h-32 mx-auto mb-4 rounded-full overflow-hidden border-4 border-slate-600 bg-slate-700",children:s.avatar?d.jsx("img",{src:s.avatar,alt:"Avatar",className:"w-full h-full object-cover",onError:()=>{i(v=>({...v,avatar:tf(v.avatarSeed)}))}}):d.jsx("div",{className:"w-full h-full flex items-center justify-center",children:d.jsx(ef,{className:"w-8 h-8 text-gray-400 animate-spin"})})}),d.jsxs("div",{className:"space-y-3",children:[d.jsxs("div",{className:"mb-4",children:[d.jsx("label",{className:"block text-white text-sm font-medium mb-2",children:"Upload Your Photo"}),d.jsx("input",{type:"file",accept:"image/*",onChange:R,className:"hidden",id:"photo-upload"}),d.jsx("label",{htmlFor:"photo-upload",className:"w-full px-6 py-3 bg-green-600 hover:bg-green-700 text-white rounded-lg transition-colors flex items-center gap-2 justify-center cursor-pointer",children:"📷 Upload Photo"})]}),p&&d.jsx("div",{className:"mb-4",children:d.jsx("button",{onClick:D,disabled:l,className:"w-full px-6 py-3 bg-purple-600 hover:bg-purple-700 disabled:bg-purple-800 text-white rounded-lg transition-colors flex items-center gap-2 justify-center",children:l?d.jsxs(d.Fragment,{children:[d.jsx(ef,{className:"w-4 h-4 animate-spin"}),"Converting to Anime..."]}):d.jsx(d.Fragment,{children:"✨ Convert to Anime"})})}),d.jsx("div",{className:"text-gray-400 text-sm",children:"- OR -"}),d.jsx("button",{onClick:F,disabled:o,className:"w-full px-6 py-3 bg-slate-600 hover:bg-slate-500 disabled:bg-slate-700 text-white rounded-lg transition-colors flex items-center gap-2 justify-center",children:o?d.jsxs(d.Fragment,{children:[d.jsx(ef,{className:"w-4 h-4 animate-spin"}),"Generate Random Avatar"]}):d.jsxs(d.Fragment,{children:[d.jsx(ef,{className:"w-4 h-4"}),"Generate Random Avatar"]})}),d.jsx("button",{onClick:()=>{const v=tf(s.avatarSeed),S={...s,avatar:v};i(S),b(S,3)},className:"w-full px-6 py-3 bg-blue-600 hover:bg-blue-700 text-white rounded-lg transition-colors",children:"Use Fallback Avatar"})]})]})]}),t===4&&d.jsxs("div",{className:"text-center",children:[d.jsx("div",{className:"w-20 h-20 bg-gradient-to-br from-orange-400 to-orange-600 rounded-full flex items-center justify-center mx-auto mb-6",children:d.jsx("span",{className:"text-2xl",children:"🎯"})}),d.jsx("h1",{className:"text-2xl font-bold text-white mb-4",children:"Trigger Identification"}),d.jsx("p",{className:"text-gray-300 mb-6",children:"What usually makes you want to vape? (Select all that apply)"}),d.jsx("div",{className:"space-y-3 mb-6",children:C.map(v=>d.jsx("button",{onClick:()=>{const S={...s,triggers:s.triggers.includes(v)?s.triggers.filter(N=>N!==v):[...s.triggers,v]};i(S),b(S,4)},className:`w-full p-4 rounded-lg border-2 transition-all duration-300 text-left ${s.triggers.includes(v)?"border-blue-500 bg-blue-500/20":"border-slate-600 bg-slate-700 hover:border-slate-500"}`,children:d.jsxs("div",{className:"flex items-center gap-3",children:[d.jsx("div",{className:`w-6 h-6 rounded border-2 flex items-center justify-center ${s.triggers.includes(v)?"bg-blue-500 border-blue-500":"border-gray-400"}`,children:s.triggers.includes(v)&&d.jsx("span",{className:"text-white text-sm",children:"✓"})}),d.jsx("span",{className:"text-white font-semibold",children:v})]})},v))})]}),t===5&&d.jsxs("div",{className:"text-center",children:[d.jsx("div",{className:"w-20 h-20 bg-gradient-to-br from-indigo-400 to-indigo-600 rounded-full flex items-center justify-center mx-auto mb-6",children:d.jsx("span",{className:"text-2xl",children:"📅"})}),d.jsx("h1",{className:"text-2xl font-bold text-white mb-4",children:"Daily Routine"}),d.jsx("p",{className:"text-gray-300 mb-6",children:"When do you vape most? (Select all that apply)"}),d.jsx("div",{className:"space-y-3 mb-6",children:P.map(v=>d.jsx("button",{onClick:()=>{const S={...s,dailyPatterns:s.dailyPatterns.includes(v)?s.dailyPatterns.filter(N=>N!==v):[...s.dailyPatterns,v]};i(S),b(S,5)},className:`w-full p-4 rounded-lg border-2 transition-all duration-300 text-left ${s.dailyPatterns.includes(v)?"border-blue-500 bg-blue-500/20":"border-slate-600 bg-slate-700 hover:border-slate-500"}`,children:d.jsxs("div",{className:"flex items-center gap-3",children:[d.jsx("div",{className:`w-6 h-6 rounded border-2 flex items-center justify-center ${s.dailyPatterns.includes(v)?"bg-blue-500 border-blue-500":"border-gray-400"}`,children:s.dailyPatterns.includes(v)&&d.jsx("span",{className:"text-white text-sm",children:"✓"})}),d.jsx("span",{className:"text-white font-semibold",children:v})]})},v))})]}),t===6&&d.jsxs("div",{className:"text-center",children:[d.jsx("div",{className:"w-20 h-20 bg-gradient-to-br from-teal-400 to-teal-600 rounded-full flex items-center justify-center mx-auto mb-6",children:d.jsx("span",{className:"text-2xl",children:"🛡️"})}),d.jsx("h1",{className:"text-2xl font-bold text-white mb-4",children:"Coping Experience"}),d.jsx("p",{className:"text-gray-300 mb-6",children:"Have you tried any of these strategies before? (Select all that apply)"}),d.jsx("div",{className:"space-y-3 mb-6",children:A.map(v=>d.jsx("button",{onClick:()=>{const S={...s,copingStrategies:s.copingStrategies.includes(v)?s.copingStrategies.filter(N=>N!==v):[...s.copingStrategies,v]};i(S),b(S,6)},className:`w-full p-4 rounded-lg border-2 transition-all duration-300 text-left ${s.copingStrategies.includes(v)?"border-blue-500 bg-blue-500/20":"border-slate-600 bg-slate-700 hover:border-slate-500"}`,children:d.jsxs("div",{className:"flex items-center gap-3",children:[d.jsx("div",{className:`w-6 h-6 rounded border-2 flex items-center justify-center ${s.copingStrategies.includes(v)?"bg-blue-500 border-blue-500":"border-gray-400"}`,children:s.copingStrategies.includes(v)&&d.jsx("span",{className:"text-white text-sm",children:"✓"})}),d.jsx("span",{className:"text-white font-semibold",children:v})]})},v))})]}),t===7&&d.jsxs("div",{className:"text-center",children:[d.jsx("div",{className:"w-20 h-20 bg-gradient-to-br from-red-400 to-red-600 rounded-full flex items-center justify-center mx-auto mb-6",children:d.jsx("span",{className:"text-2xl",children:"🚬"})}),d.jsx("h1",{className:"text-2xl font-bold text-white mb-4",children:"Vape Usage"}),d.jsx("p",{className:"text-gray-300 mb-6",children:"How many vape pods do you typically use per week?"}),d.jsx("div",{className:"mb-6",children:d.jsxs("select",{value:s.vapePodsPerWeek,onChange:v=>{const S={...s,vapePodsPerWeek:parseFloat(v.target.value)||0};i(S),S.vapePodsPerWeek>0&&b(S,7)},className:"w-full px-4 py-3 bg-slate-700 border border-slate-600 rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-red-500 focus:border-transparent",children:[d.jsx("option",{value:"",children:"Select pods per week"}),d.jsx("option",{value:"0.5",children:"0.5 pods"}),d.jsx("option",{value:"1",children:"1 pod"}),d.jsx("option",{value:"2",children:"2 pods"}),d.jsx("option",{value:"3",children:"3 pods"}),d.jsx("option",{value:"4",children:"4 pods"}),d.jsx("option",{value:"5",children:"5 pods"}),d.jsx("option",{value:"6",children:"6 pods"}),d.jsx("option",{value:"7",children:"7 pods"}),d.jsx("option",{value:"8",children:"8+ pods"})]})})]}),t===8&&d.jsxs("div",{className:"text-center",children:[d.jsx("div",{className:"w-20 h-20 bg-gradient-to-br from-orange-400 to-orange-600 rounded-full flex items-center justify-center mx-auto mb-6",children:d.jsx("span",{className:"text-2xl",children:"⚡"})}),d.jsx("h1",{className:"text-2xl font-bold text-white mb-4",children:"Nicotine Strength"}),d.jsx("p",{className:"text-gray-300 mb-6",children:"What nicotine strength do you typically use?"}),d.jsx("div",{className:"mb-6",children:d.jsxs("select",{value:s.nicotineStrength,onChange:v=>{const S={...s,nicotineStrength:v.target.value};i(S),S.nicotineStrength&&b(S,8)},className:"w-full px-4 py-3 bg-slate-700 border border-slate-600 rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-orange-500 focus:border-transparent",children:[d.jsx("option",{value:"",children:"Select nicotine strength"}),d.jsx("option",{value:"3mg",children:"3mg"}),d.jsx("option",{value:"6mg",children:"6mg"}),d.jsx("option",{value:"12mg",children:"12mg"}),d.jsx("option",{value:"18mg",children:"18mg"}),d.jsx("option",{value:"20mg",children:"20mg"}),d.jsx("option",{value:"50mg",children:"50mg"})]})})]}),t===9&&d.jsxs("div",{className:"text-center",children:[d.jsx("div",{className:"w-20 h-20 bg-gradient-to-br from-blue-400 to-blue-600 rounded-full flex items-center justify-center mx-auto mb-6",children:d.jsx("span",{className:"text-2xl",children:"📚"})}),d.jsx("h1",{className:"text-2xl font-bold text-white mb-4",children:"Previous Attempts"}),d.jsx("p",{className:"text-gray-300 mb-6",children:"How many times have you tried to quit before?"}),d.jsx("div",{className:"mb-6",children:d.jsxs("select",{value:s.quitAttempts,onChange:v=>{const S={...s,quitAttempts:v.target.value};i(S),S.quitAttempts&&b(S,9)},className:"w-full px-4 py-3 bg-slate-700 border border-slate-600 rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[d.jsx("option",{value:"",children:"Select option"}),d.jsx("option",{value:"first",children:"This is my first attempt"}),d.jsx("option",{value:"1",children:"Once before"}),d.jsx("option",{value:"2",children:"Twice before"}),d.jsx("option",{value:"3",children:"3-5 times"}),d.jsx("option",{value:"5",children:"More than 5 times"})]})})]}),t===10&&d.jsxs("div",{className:"text-center",children:[d.jsx("div",{className:"w-20 h-20 bg-gradient-to-br from-green-400 to-green-600 rounded-full flex items-center justify-center mx-auto mb-6",children:d.jsx("span",{className:"text-2xl",children:"🎯"})}),d.jsx("h1",{className:"text-2xl font-bold text-white mb-4",children:"Confidence Level"}),d.jsx("p",{className:"text-gray-300 mb-6",children:"How confident are you this time? (1-10 scale)"}),d.jsxs("div",{className:"mb-6",children:[d.jsxs("div",{className:"flex items-center gap-4",children:[d.jsx("span",{className:"text-gray-400 text-sm",children:"1"}),d.jsx("input",{type:"range",min:"1",max:"10",value:s.confidence,onChange:v=>{const S={...s,confidence:parseInt(v.target.value)};i(S),b(S,10)},className:"flex-1 h-2 bg-slate-600 rounded-lg appearance-none cursor-pointer slider"}),d.jsx("span",{className:"text-gray-400 text-sm",children:"10"})]}),d.jsxs("div",{className:"text-center mt-2",children:[d.jsx("span",{className:"text-white font-bold text-lg",children:s.confidence}),d.jsx("span",{className:"text-gray-400 text-sm ml-2",children:"/ 10"})]})]})]}),d.jsxs("div",{className:"flex justify-between",children:[t>1&&d.jsx("button",{onClick:E,className:"px-6 py-3 bg-slate-600 hover:bg-slate-500 text-white rounded-lg transition-colors",children:"Back"}),d.jsxs("button",{onClick:k,disabled:!_(),className:`ml-auto px-6 py-3 rounded-lg transition-colors flex items-center gap-2 ${_()?"bg-blue-600 hover:bg-blue-700 text-white":"bg-slate-700 text-gray-400 cursor-not-allowed"}`,children:[t===10?"Start Journey":"Next",d.jsx(Jz,{className:"w-4 h-4"})]})]})]})})},Eb={DETERMINED:{name:"The Determined",color:"bg-red-500",icon:Sd},SOCIAL_FIGHTER:{name:"The Social Fighter",color:"bg-blue-500",icon:DD},HEALTH_WARRIOR:{name:"The Health Warrior",color:"bg-green-500",icon:CD},MONEY_SAVER:{name:"The Money Saver",color:"bg-yellow-500",icon:AD}},r8={COMMON:{name:"Common",color:"border-gray-400",glow:"",days:0},UNCOMMON:{name:"Uncommon",color:"border-gray-300",glow:"shadow-lg",days:7},RARE:{name:"Rare",color:"border-yellow-400",glow:"shadow-yellow-400/50 shadow-lg",days:14},EPIC:{name:"Epic",color:"border-purple-400",glow:"shadow-purple-400/50 shadow-xl",days:30},LEGENDARY:{name:"Legendary",color:"border-orange-400",glow:"shadow-orange-400/50 shadow-2xl animate-pulse",days:90}},xb={WEEK_WARRIOR:{name:"Week Warrior",icon:Xz,description:"7 days clean"},MONTH_MASTER:{name:"Month Master",icon:PD,description:"30 days clean"},LEGEND:{name:"Legend",icon:ND,description:"90 days clean"}},s8=n=>n>=90?"LEGENDARY":n>=30?"EPIC":n>=14?"RARE":n>=7?"UNCOMMON":"COMMON",i8=({isOpen:n,onClose:e,statType:t})=>{if(!n)return null;const s={addiction:{title:"Addiction",description:"Time since last vape - decreases as your body heals",impacts:["What decreases it:","• Clean time: -2 points per week (standard recovery)","• Cold turkey approach: -3 points per week (faster healing)","• Tapering approach: -1.5 points per week (gentler decline)","","What increases it:","• First relapse (after clean period): +4 points","• Second relapse (within 7 days): +6 additional points","• Third relapse and on (within 3 days): +8 additional points","• Reset: Penalty level resets after 7 clean days"]},mentalStrength:{title:"Mental Strength",description:"Your ability to resist urges and stay strong",impacts:["What increases it:","• Successful craving resistance: +1 point","• Using app during cravings every 3 times with no relapse: +1 point","• Completing breathing exercises 3 days straight: +1 point","• Staying hydrated for 3 days straight: +1 point","• Milestone bonuses: First 7 days +5 points, 30 days +10 points, 90 days +15 points","","What decreases it:","• Giving in to cravings: -3 points","• Each relapse: -3 points"]},motivation:{title:"Motivation",description:"Your drive to quit - boosted by staying engaged",impacts:["What increases it:","• Regular logging (3+ days per week): +2 points (weekly)","• Sharing achievements: +3 points per share (weekly)","","What decreases it:","• Long periods inactive (7+ days no logging): -3 points"]},triggerDefense:{title:"Trigger Defense",description:"Protection against your personal vaping triggers",impacts:["What increases it:","• Surviving trigger situations without vaping: +3 points","• Pre-planning for known triggers: +1 point","• Updating your trigger list: +1 point","","What decreases it:","• Relapsing to known triggers: -3 points","• Entering trigger situations unprepared: -1 point"]}}[t];return s?d.jsx("div",{className:"fixed inset-0 bg-black/80 backdrop-blur-sm flex items-center justify-center z-50 p-4",children:d.jsxs("div",{className:"bg-slate-800 rounded-2xl p-6 max-w-md w-full shadow-2xl border border-slate-700",children:[d.jsxs("div",{className:"text-center mb-4",children:[d.jsx("h3",{className:"text-xl font-bold text-white mb-2",children:s.title}),d.jsx("p",{className:"text-gray-300 text-sm",children:s.description})]}),d.jsxs("div",{className:"mb-6",children:[d.jsx("h4",{className:"text-white font-semibold mb-3 text-left",children:"What impacts it:"}),d.jsx("ul",{className:"space-y-2 text-left",children:s.impacts.map((i,o)=>d.jsxs("li",{className:"text-gray-300 text-sm flex items-start",children:[d.jsx("span",{className:"text-blue-400 mr-2",children:"•"}),i]},o))})]}),d.jsx("button",{onClick:e,className:"w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 rounded-lg transition-all duration-300",children:"Got it"})]})}):null},nf=({label:n,value:e,max:t,color:r,statType:s,onInfoClick:i})=>{const o=Math.min(e,t);return d.jsxs("div",{className:"mb-2",children:[d.jsxs("div",{className:"flex justify-between text-white text-xs mb-1",children:[d.jsxs("div",{className:"flex items-center gap-1",children:[d.jsx("span",{children:n}),s&&i&&d.jsx("button",{onClick:()=>i(s),className:"w-4 h-4 bg-blue-600 hover:bg-blue-700 rounded-full flex items-center justify-center text-white text-xs font-bold transition-colors",title:`Learn about ${n}`,children:"i"})]}),d.jsxs("span",{children:[o,"/",t]})]}),d.jsx("div",{className:"w-full bg-gray-700 rounded-full h-2",children:d.jsx("div",{className:`${r} h-2 rounded-full transition-all duration-500`,style:{width:`${o/t*100}%`}})})]})},Tb=({user:n,isNemesis:e=!1,showComparison:t=!1,nemesisUser:r=null,onInfoClick:s})=>{const[i,o]=L.useState(!1),[a,l]=L.useState(null),[u,h]=L.useState([]),[f,p]=L.useState({});if(L.useEffect(()=>{let k=!1;return(async()=>{try{if(console.log("🔄 TradingCard: Loading Special Features for user:",n==null?void 0:n.heroName,"uid:",n==null?void 0:n.uid),console.log("🔄 TradingCard: User has specialFeatures:",!!(n!=null&&n.specialFeatures)),console.log("🔄 TradingCard: User has triggers:",n==null?void 0:n.triggers),console.log("🔄 TradingCard: User has dailyPatterns:",n==null?void 0:n.dailyPatterns),console.log("🔄 TradingCard: User has copingStrategies:",n==null?void 0:n.copingStrategies),n&&n.uid)if(n.specialFeatures)console.log("✅ TradingCard: Using pre-loaded Special Features"),k||(Array.isArray(n.specialFeatures)?(h(n.specialFeatures),p({})):n.specialFeatures&&n.specialFeatures.features?(h(n.specialFeatures.features),p(n.specialFeatures.categories||{})):(h([]),p({})));else{console.log("🔄 TradingCard: Generating new Special Features");const _=await P(n);console.log("✅ TradingCard: Generated features:",_),k||(Array.isArray(_)?(h(_),p({})):_&&_.features?(h(_.features),p(_.categories||{})):(h([]),p({})))}else console.log("⚠️ TradingCard: No user or uid, setting empty features"),k||(h([]),p({}))}catch(_){console.error("❌ TradingCard: Error loading Special Features:",_),k||(h([]),p({}))}})(),()=>{k=!0}},[n==null?void 0:n.uid,n==null?void 0:n.specialFeatures,n==null?void 0:n.triggers,n==null?void 0:n.dailyPatterns,n==null?void 0:n.copingStrategies]),n.isEmpty)return d.jsx("div",{className:"w-80 h-[520px] bg-slate-800 rounded-xl border-2 border-slate-600 p-4 text-white text-center mx-auto flex items-center justify-center",children:d.jsxs("div",{className:"text-center",children:[d.jsx("div",{className:"w-24 h-24 bg-slate-700 rounded-full flex items-center justify-center mx-auto mb-4",children:d.jsx("span",{className:"text-4xl text-slate-400",children:"🔍"})}),d.jsx("h3",{className:"text-slate-300 text-lg font-semibold mb-2",children:"Looking for a buddy"}),d.jsx("p",{className:"text-slate-400 text-sm leading-relaxed",children:"We'll find you a match soon"})]})});if(!n||!n.archetype||!n.stats)return d.jsx("div",{className:"w-80 h-[520px] bg-slate-800 rounded-xl border-2 border-gray-400 p-4 text-white text-center mx-auto flex items-center justify-center",children:d.jsx("div",{className:"animate-pulse",children:"Loading Card..."})});const y=Eb[n.archetype];if(!y)return console.error("Invalid archetype:",n.archetype,"Available:",Object.keys(Eb)),d.jsx("div",{className:"w-80 h-[520px] bg-slate-800 rounded-xl border-2 border-red-400 p-4 text-white text-center mx-auto flex items-center justify-center",children:d.jsxs("div",{children:[d.jsx("h3",{className:"text-red-400 mb-2",children:"Invalid Archetype"}),d.jsx("p",{className:"text-gray-300 text-sm",children:n.archetype})]})});const I=r8[s8(n.stats.streakDays)],C=y.icon,P=async k=>{let E=null;if(k.uid)try{const{ref:w,get:B}=await Re(()=>import("./index.esm-d8b59866.js"),[]),Ee=w(te,`users/${k.uid}/specialFeatures`),le=await B(Ee);le.exists()&&(E=le.val())}catch(w){console.error("Error fetching special features from Firebase:",w)}if(!E){const w=`specialFeatures_${k.heroName||k.id||"default"}`,B=localStorage.getItem(w);B&&(E=JSON.parse(B))}if(E){if(Array.isArray(E))return E;if(E&&E.features)return E}const _=[],b={};for(k.triggers&&k.triggers.length>0&&k.triggers.forEach(w=>{let B="";switch(w){case"Stress/anxiety":B="Stress Vaper";break;case"Social situations":B="Social Vaper";break;case"Boredom":B="Boredom Fighter";break;case"After meals":B="Habit Former";break;case"Drinking alcohol":B="Party Animal";break;case"Work breaks":B="Work Breaker";break;case"Driving":B="Driving Vaper";break;default:B="Trigger Aware"}B&&!_.includes(B)&&(_.push(B),b[B]="triggers")}),k.dailyPatterns&&k.dailyPatterns.length>0&&k.dailyPatterns.forEach(w=>{let B="";switch(w){case"Morning routine":B="Morning Struggler";break;case"Evening wind-down":B="Night Owl";break;case"Throughout the day":B="All-Day Warrior";break;default:B="Routine Builder"}B&&!_.includes(B)&&(_.push(B),b[B]="dailyPatterns")}),k.copingStrategies&&k.copingStrategies.length>0&&(k.copingStrategies.includes("Nothing - this is new to me")?(_.push("First Timer"),b["First Timer"]="copingStrategies"):k.copingStrategies.length>2?(_.push("Veteran Quitter"),b["Veteran Quitter"]="copingStrategies"):(_.push("Cold Turkey"),b["Cold Turkey"]="copingStrategies"));_.length<4;){const w=[{name:"Nicotine Fighter",category:"copingStrategies"},{name:"Health Seeker",category:"copingStrategies"},{name:"Freedom Chaser",category:"copingStrategies"},{name:"Willpower Warrior",category:"copingStrategies"}],B=w[Math.floor(Math.random()*w.length)];_.includes(B.name)||(_.push(B.name),b[B.name]=B.category)}const v=_.slice(0,4),S={};v.forEach(w=>{S[w]=b[w]||"copingStrategies"});const N={features:v,categories:S};if(k.uid)try{const{ref:w,set:B}=await Re(()=>import("./index.esm-d8b59866.js"),[]),Ee=w(te,`users/${k.uid}/specialFeatures`);await B(Ee,N),console.log("Special features with categories saved to Firebase successfully")}catch(w){console.error("Error saving special features to Firebase:",w);const B=`specialFeatures_${k.heroName||k.id||"default"}`;localStorage.setItem(B,JSON.stringify(N))}else{const w=`specialFeatures_${k.heroName||k.id||"default"}`;localStorage.setItem(w,JSON.stringify(v))}return v},A=n.stats.addictionLevel||50,T=n.stats.mentalStrength||50,R=n.stats.motivation||50,D=n.stats.triggerDefense||30;n.stats.nemesisVictories||(Math.floor(Math.random()*8)+1,Math.floor(Math.random()*5)+1);const F=k=>{l(k),o(!0)};return d.jsxs(d.Fragment,{children:[d.jsxs("div",{className:`relative w-80 h-[520px] rounded-xl ${I.color} border-4 ${I.glow} bg-gradient-to-br from-slate-800 to-slate-900 p-4 transform transition-all duration-300 hover:scale-105 mx-auto overflow-hidden`,children:[d.jsxs("div",{className:"text-center mb-3",children:[d.jsx("h3",{className:"text-white font-bold text-lg leading-tight break-words px-1",children:n.heroName}),d.jsx("p",{className:"text-gray-300 text-base",children:y.name})]}),d.jsx("div",{className:"w-24 h-24 mx-auto mb-4 rounded-full overflow-hidden bg-slate-700 flex items-center justify-center ring-2 ring-blue-400/50",children:n.avatar?d.jsx("img",{src:n.avatar,alt:"Avatar",className:"w-full h-full object-cover",onError:()=>{console.log("Avatar failed to load, using fallback")}}):d.jsx("div",{className:`w-full h-full ${y.color} flex items-center justify-center`,children:d.jsx(C,{className:"w-12 h-12 text-white"})})}),d.jsxs("div",{className:"space-y-2 mb-4",children:[d.jsx(nf,{label:"Addiction",value:A,max:100,color:"bg-red-500",statType:e?null:"addiction",onInfoClick:e?null:F}),d.jsx(nf,{label:"Mental Strength",value:T,max:100,color:"bg-blue-500",statType:e?null:"mentalStrength",onInfoClick:e?null:F}),d.jsx(nf,{label:"Motivation",value:R,max:100,color:"bg-green-500",statType:e?null:"motivation",onInfoClick:e?null:F}),d.jsx(nf,{label:"Trigger Defense",value:D,max:100,color:"bg-orange-500",statType:e?null:"triggerDefense",onInfoClick:e?null:F})]}),d.jsxs("div",{className:"mb-4",children:[d.jsx("h4",{className:"text-white text-xs font-semibold mb-2 text-center",children:"Special Features"}),d.jsx("div",{className:"flex flex-wrap gap-1 justify-center",children:u.map((k,E)=>{const _=f[k]||"copingStrategies",b=v=>{switch(v){case"triggers":return"bg-yellow-500/80";case"dailyPatterns":return"bg-orange-500/80";case"copingStrategies":default:return"bg-blue-600/80"}};return d.jsx("div",{className:`px-2 py-1 ${b(_)} text-white text-xs rounded-full font-medium`,title:`${k} (${_})`,children:k},E)})})]}),d.jsxs("div",{className:"bg-black/30 rounded-lg p-3 space-y-2 mb-3 backdrop-blur-sm",children:[d.jsxs("div",{className:"flex justify-between text-white text-sm",children:[d.jsx("span",{className:"text-gray-300",children:"Streak:"}),d.jsxs("span",{className:"font-bold text-green-400 flex items-center gap-1",children:[n.stats.streakDays," days",n.stats.streakDays>0&&d.jsx("span",{className:"text-xs",children:"🔥"})]})]}),d.jsxs("div",{className:"flex justify-between text-white text-sm",children:[d.jsx("span",{className:"text-gray-300",children:"Cravings Resisted:"}),d.jsxs("span",{className:"font-bold text-blue-400 flex items-center gap-1",children:[n.stats.cravingsResisted||0,d.jsx("span",{className:"text-xs",children:"💪"})]})]})]}),n.achievements&&n.achievements.length>0&&d.jsxs("div",{className:"flex flex-wrap gap-1 justify-center",children:[n.achievements.slice(0,4).map((k,E)=>{var b,v;const _=((b=xb[k])==null?void 0:b.icon)||ND;return d.jsx("div",{className:"w-6 h-6 bg-yellow-500 rounded-full flex items-center justify-center shadow-lg",title:(v=xb[k])==null?void 0:v.description,children:d.jsx(_,{className:"w-3 h-3 text-white"})},E)}),n.achievements.length>4&&d.jsxs("div",{className:"w-6 h-6 bg-gray-500 rounded-full flex items-center justify-center text-white text-xs font-bold",children:["+",n.achievements.length-4]})]})]}),d.jsx(i8,{isOpen:i,onClose:()=>o(!1),statType:a})]})},o8=({activeTab:n,onTabChange:e,dataLoadingState:t,onRefreshData:r,offlineManager:s})=>{const i=[{id:"arena",label:"Arena",icon:Zz},{id:"craving-support",label:"Craving Support",icon:Sd},{id:"profile",label:"Profile",icon:kD},{id:"settings",label:"Explore",icon:RD}];return d.jsx(d.Fragment,{children:d.jsx("div",{className:"fixed bottom-0 left-0 right-0 bg-slate-800 border-t border-slate-700 px-4 py-2 z-40",children:d.jsx("div",{className:"flex justify-around max-w-md mx-auto",children:i.map(o=>{const a=o.icon,l=n===o.id;return d.jsxs("button",{onClick:()=>e(o.id),className:`flex flex-col items-center transition-colors ${l?"text-blue-400":"text-gray-400 hover:text-blue-300"}`,children:[d.jsx(a,{className:"w-5 h-5"}),d.jsx("span",{className:"text-xs",children:o.label})]},o.id)})})})})},a8=({user:n,nemesis:e,onBackToLogin:t,onResetForTesting:r,buddyLoading:s,buddyError:i,realBuddy:o})=>{const a={heroName:"Looking for a buddy",stats:null,achievements:[],archetype:"",avatar:null,isEmpty:!0,message:"We are looking for a suitable buddy for you"};if(!n)return console.warn("ArenaView: user prop is undefined"),d.jsx("div",{className:"min-h-screen bg-gradient-to-br from-slate-900 via-blue-900 to-slate-900 py-8 pb-20",children:d.jsx("div",{className:"max-w-7xl mx-auto px-4",children:d.jsxs("div",{className:"text-center text-white",children:[d.jsx("h1",{className:"text-2xl font-bold mb-4",children:"Loading User Data..."}),d.jsx("p",{children:"Please wait while we load your profile information."})]})})});if(!e)return console.warn("ArenaView: nemesis prop is undefined"),d.jsx("div",{className:"min-h-screen bg-gradient-to-br from-slate-900 via-blue-900 to-slate-900 py-8 pb-20",children:d.jsx("div",{className:"max-w-7xl mx-auto px-4",children:d.jsxs("div",{className:"text-center text-white",children:[d.jsx("h1",{className:"text-2xl font-bold mb-4",children:"Loading Nemesis Data..."}),d.jsx("p",{children:"Please wait while we load your nemesis information."})]})})});const[l,u]=L.useState(!1),[h,f]=L.useState(null),p=async()=>{h&&await h.handleAchievementShare()},y=async w=>{const B={...w.stats};if(!(w!=null&&w.uid)){const Ee=localStorage.getItem("quitCoachRelapseDate");if(Ee){const $=new Date(Ee),J=new Date().getTime()-$.getTime(),he=Math.floor(J/(1e3*3600*24));B.streakDays=he}else{const $=w.quitDate?new Date(w.quitDate):new Date,J=new Date().getTime()-$.getTime();B.streakDays=Math.floor(J/(1e3*3600*24))}const le=parseInt(localStorage.getItem("cravingWins")||0);B.cravingsResisted=le,new Date().toDateString();let Be=0;for(let $=0;$<7;$++){const G=new Date;G.setDate(G.getDate()-$);const J=G.toDateString(),he=localStorage.getItem(`water_${w.uid}_${J}`);if(he&&parseInt(he)>0)Be++;else break}return Be>=3&&(B.mentalStrength=Math.min(80,(B.mentalStrength||50)+1)),B}try{const{ref:Ee,get:le}=await Re(()=>import("./index.esm-d8b59866.js"),[]),Be=Ee(te,`users/${w.uid}/profile/relapseDate`),$=await le(Be);if($.exists()){const Te=new Date($.val()),At=new Date().getTime()-Te.getTime(),xe=Math.floor(At/(1e3*3600*24));B.streakDays=xe}else{const Te=w.quitDate?new Date(w.quitDate):new Date,At=new Date().getTime()-Te.getTime();B.streakDays=Math.floor(At/(1e3*3600*24))}const G=Ee(te,`users/${w.uid}/profile/cravingsResisted`),J=await le(G);B.cravingsResisted=J.exists()?J.val():0;const he=new Date().toDateString();let pe=0;for(let Te=0;Te<7;Te++){const dt=new Date;dt.setDate(dt.getDate()-Te);const At=dt.toDateString(),xe=Ee(te,`users/${w.uid}/profile/daily/${At}/water`),Ke=await le(xe);if(Ke.exists()&&Ke.val()>0)pe++;else break}pe>=3&&(B.mentalStrength=Math.min(80,(B.mentalStrength||50)+1))}catch(Ee){console.error("Error fetching profile data from Firebase:",Ee);const le=localStorage.getItem("quitCoachRelapseDate");if(le){const G=new Date(le),he=new Date().getTime()-G.getTime(),pe=Math.floor(he/(1e3*3600*24));B.streakDays=pe}else{const G=w.quitDate?new Date(w.quitDate):new Date,he=new Date().getTime()-G.getTime();B.streakDays=Math.floor(he/(1e3*3600*24))}const Be=parseInt(localStorage.getItem("cravingWins")||0);B.cravingsResisted=Be,new Date().toDateString();let $=0;for(let G=0;G<7;G++){const J=new Date;J.setDate(J.getDate()-G);const he=J.toDateString(),pe=localStorage.getItem(`water_${w.uid}_${he}`);if(pe&&parseInt(pe)>0)$++;else break}$>=3&&(B.mentalStrength=Math.min(80,(B.mentalStrength||50)+1))}return B},[I,C]=L.useState(()=>{const w={mentalStrength:50,motivation:50,triggerDefense:30,addictionLevel:50};return n!=null&&n.stats?{...w,...n.stats}:w}),[P,A]=L.useState(()=>{const w={mentalStrength:50,motivation:50,triggerDefense:30,addictionLevel:50};return e!=null&&e.stats?{...w,...e.stats}:w});L.useEffect(()=>{if(!(n!=null&&n.uid))return;(async()=>{await(async()=>{try{const le=new hg(te,n.uid);await le.initialize(),f(le)}catch(le){console.error("Error initializing StatManager:",le)}})(),await(async()=>{if(n){const le=await y(n);C(le)}if(e){const le=await y(e);A(le)}})()})()},[n,e]),L.useEffect(()=>{const w=()=>{console.log("🌐 Internet connection restored")},B=()=>{console.log("📡 Internet connection lost")};return window.addEventListener("online",w),window.addEventListener("offline",B),()=>{window.removeEventListener("online",w),window.removeEventListener("offline",B)}},[]);const T=w=>{if(!w||!w.stats)return console.warn("Player or player stats not available for battle score calculation"),0;const B=w.stats.mentalStrength||50,Ee=w.stats.motivation||50,le=w.stats.triggerDefense||30,Be=w.stats.addictionLevel||50;return B*1.5+Ee*1+le*1.2-Be*1},R=T({...n,stats:I}),D=T({...e,stats:P}),F=typeof R=="number"&&!isNaN(R)?R:0,k=typeof D=="number"&&!isNaN(D)?D:0,E=F>k?"WINNING":F===k?"TIED":"LOSING",_=()=>{if(E==="WINNING")return null;if(!I||!P)return console.warn("Stats not available for recommendations calculation"),[];const w=k-F+1,B=[],Ee=(I==null?void 0:I.mentalStrength)||50,le=(I==null?void 0:I.motivation)||50,Be=(I==null?void 0:I.triggerDefense)||30,$=(I==null?void 0:I.addictionLevel)||50,G=(P==null?void 0:P.mentalStrength)||50,J=(P==null?void 0:P.motivation)||50;P!=null&&P.triggerDefense;const he=(P==null?void 0:P.addictionLevel)||50,pe=G-Ee,Te=J-le,dt=$-he,At=[{name:"Mental Strength",multiplier:1.5,gap:pe,current:Ee,max:100},{name:"Trigger Defense",multiplier:1.2,gap:Te,current:Be,max:100},{name:"Motivation",multiplier:1,gap:Te,current:le,max:100},{name:"Addiction",multiplier:1,gap:dt,current:$,min:0,isReduction:!0}];if(At.sort((xe,Ke)=>xe.multiplier!==Ke.multiplier?Ke.multiplier-xe.multiplier:Math.abs(Ke.gap)-Math.abs(xe.gap)),At.forEach(xe=>{if(xe.isReduction){const Ke=Math.min(xe.current-xe.min,50),Se=Ke*xe.multiplier;Se>0&&B.push({stat:xe.name,change:Ke,action:b(Ke),priority:Se,canWin:Se>=w,isReduction:!0,efficiency:xe.multiplier,gap:xe.gap})}else{const Ke=Math.min(xe.max-xe.current,50),Se=Ke*xe.multiplier;Se>0&&B.push({stat:xe.name,change:Ke,action:v(xe.name,Ke),priority:Se,canWin:Se>=w,efficiency:xe.multiplier,gap:xe.gap})}}),B.sort((xe,Ke)=>Ke.priority-xe.priority),B.length>0&&!B.some(xe=>xe.canWin)){const xe=S(B,w);xe&&B.unshift(xe)}return B.slice(0,3)},b=w=>w>=30?"Stay completely clean, avoid all triggers, use nicotine replacement therapy":w>=20?"Reduce nicotine intake significantly, avoid high-risk situations":w>=10?"Cut back on vaping frequency, identify and avoid main triggers":"Small reduction in nicotine intake, practice trigger avoidance",v=(w,B)=>{switch(w){case"Mental Strength":return B>=30?"Complete daily breathing exercises, stay hydrated for 3+ days, practice meditation":B>=20?"Complete breathing exercises 3 days straight, stay hydrated, use stress management":"Complete breathing exercises, stay hydrated for 3 days straight";case"Motivation":return B>=30?"Log progress daily, share achievements weekly":B>=20?"Log progress 5+ days per week, share achievements, track progress":"Regular logging (3+ days per week), share achievements, reach milestones";case"Trigger Defense":return B>=30?"Survive multiple trigger situations, pre-plan for all triggers, update trigger list":B>=20?"Survive trigger situations, pre-plan for known triggers, practice coping":"Survive trigger situations without vaping, pre-plan for known triggers";default:return"Focus on improving this stat through consistent practice"}},S=(w,B)=>{let Ee=0;const le=[];for(const Be of w){if(Ee>=B)break;const $=B-Ee,G=Math.min(Be.priority,$);G>0&&(le.push({stat:Be.stat,change:Math.ceil(G/Be.efficiency),contribution:G}),Ee+=G)}return le.length>0?{stat:"Combination Strategy",change:Math.ceil(B),action:`Focus on: ${le.map(Be=>`${Be.stat} (+${Be.change})`).join(", ")}`,priority:Ee,canWin:Ee>=B,isCombination:!0,strategy:le}:null},N=_()||[];return d.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-slate-900 via-blue-900 to-slate-900 py-8 pb-20",children:[d.jsxs("div",{className:"max-w-7xl mx-auto px-4",children:[d.jsx("div",{className:"text-center mb-6",children:d.jsxs("div",{className:"inline-flex items-center gap-4",children:[d.jsxs("div",{className:`inline-flex items-center px-6 py-3 rounded-full font-bold text-lg shadow-xl ${E==="WINNING"?"bg-green-600":E==="TIED"?"bg-yellow-600":"bg-red-600"} text-white`,children:[E==="WINNING"?d.jsx(PD,{className:"w-5 h-5 mr-2"}):E==="TIED"?d.jsx(Sd,{className:"w-5 h-5 mr-2"}):d.jsx("span",{className:"mr-2",children:"📉"}),"You are ",E]}),d.jsx("button",{onClick:()=>u(!0),className:"w-10 h-10 bg-blue-600 hover:bg-blue-700 text-white rounded-full flex items-center justify-center transition-colors shadow-lg",title:"Battle Algorithm Info",children:d.jsx("span",{className:"text-lg font-bold",children:"i"})})]})}),d.jsxs("div",{className:"flex flex-row items-start justify-center gap-12 mb-8 w-full max-w-7xl mx-auto",children:[d.jsx("div",{className:"flex flex-col items-center space-y-4 flex-shrink-0",children:d.jsx(Tb,{user:{...n,stats:I},showComparison:!1,nemesisUser:e})}),d.jsxs("div",{className:"flex flex-col items-center space-y-4 flex-shrink-0",children:[d.jsx("div",{className:"w-24 h-24 bg-gradient-to-br from-red-500 to-purple-600 rounded-full flex items-center justify-center shadow-xl animate-pulse",children:d.jsx(t8,{className:"w-12 h-12 text-white"})}),d.jsx("div",{className:"bg-red-600 px-8 py-3 rounded-full",children:d.jsx("p",{className:"text-white font-bold text-2xl",children:"VS"})})]}),d.jsx("div",{className:"flex flex-col items-center space-y-4 flex-shrink-0",children:d.jsx(Tb,{user:o||a,isNemesis:!0,showComparison:!1,nemesisUser:n})})]}),E==="LOSING"&&N&&N.length>0&&d.jsxs("div",{className:"max-w-4xl mx-auto bg-slate-800/50 rounded-xl p-6 border border-slate-700",children:[d.jsx("h3",{className:"text-xl font-bold text-white mb-4 text-center",children:"🎯 Quick Win Strategy"}),d.jsx("div",{className:"space-y-4",children:N.slice(0,3).map((w,B)=>d.jsx("div",{className:"bg-slate-700/50 rounded-lg p-4 border-l-4 border-blue-500",children:d.jsxs("div",{className:"flex items-center justify-between",children:[d.jsxs("div",{className:"flex-1",children:[d.jsx("h4",{className:"text-white font-semibold mb-2",children:w.isReduction?d.jsxs(d.Fragment,{children:["🎯 Reduce your ",w.stat," by ",w.change," points!"]}):w.isCombination?d.jsxs(d.Fragment,{children:["🎯 Best Strategy: Improve multiple stats by ",w.change," total points!"]}):w.isMajor?d.jsxs(d.Fragment,{children:["🎯 Major improvement needed: ",w.change," total points!"]}):d.jsxs(d.Fragment,{children:["🎯 Increase your ",w.stat," by ",w.change," points!"]})}),d.jsxs("p",{className:"text-gray-300 text-sm",children:["💡 ",w.action]})]}),d.jsxs("div",{className:`font-bold text-2xl ml-4 ${w.isReduction?"text-green-400":w.isCombination?"text-purple-400":w.isMajor?"text-orange-400":"text-blue-400"}`,children:[w.isReduction?"-":"+",w.change]})]})},B))}),d.jsx("div",{className:"text-center mt-4",children:d.jsx("p",{className:"text-gray-400 text-sm",children:"Focus on the top recommendation for the fastest path to victory!"})})]})]}),l&&d.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:d.jsxs("div",{className:"bg-slate-800 rounded-xl p-6 max-w-md w-full border border-slate-600",children:[d.jsxs("div",{className:"flex justify-between items-center mb-4",children:[d.jsx("h3",{className:"text-xl font-bold text-white",children:"Battle Algorithm"}),d.jsxs("div",{className:"flex items-center gap-2",children:[d.jsx("button",{onClick:p,className:"bg-blue-600 hover:bg-blue-700 text-white px-3 py-1 rounded-lg text-sm transition-colors",title:"Share achievement for Motivation bonus",children:"📤 Share"}),d.jsx("button",{onClick:()=>u(!1),className:"text-gray-400 hover:text-white text-2xl",children:"×"})]})]}),d.jsxs("div",{className:"space-y-4 text-sm",children:[d.jsxs("div",{children:[d.jsx("h4",{className:"text-white font-semibold mb-2",children:"Formula:"}),d.jsx("p",{className:"text-gray-300 font-mono",children:"(Mental Strength × 1.5) + (Motivation × 1.0) + (Trigger Defense × 1.2) - (Addiction × 1.0)"})]}),d.jsxs("div",{children:[d.jsx("h4",{className:"text-white font-semibold mb-2",children:"Your Score:"}),d.jsxs("p",{className:"text-green-400 font-mono",children:["(",I.mentalStrength||50," × 1.5) + (",I.motivation||50," × 1.0) + (",I.triggerDefense||30," × 1.2) - (",I.addictionLevel||50," × 1.0) = ",R.toFixed(1)]})]}),d.jsxs("div",{children:[d.jsx("h4",{className:"text-white font-semibold mb-2",children:"Nemesis Score:"}),d.jsxs("p",{className:"text-red-400 font-mono",children:["(",P.mentalStrength||50," × 1.5) + (",P.motivation||50," × 1.0) + (",P.triggerDefense||30," × 1.2) - (",P.addictionLevel||50," × 1.0) = ",D.toFixed(1)]})]}),d.jsx("div",{className:"bg-slate-700/50 rounded-lg p-3",children:d.jsxs("p",{className:"text-gray-300 text-xs",children:[d.jsx("strong",{children:"Mental Strength (×1.5):"})," Your resilience and coping ability",d.jsx("br",{}),d.jsx("strong",{children:"Motivation (×1.0):"})," Your drive to quit",d.jsx("br",{}),d.jsx("strong",{children:"Trigger Defense (×1.2):"})," Your ability to resist triggers",d.jsx("br",{}),d.jsx("strong",{children:"Addiction (×1.0):"})," Your nicotine dependence level"]})})]})]})})]})},l8=({isOpen:n,onClose:e,title:t,message:r,type:s="info"})=>{if(!n)return null;const i=()=>{switch(s){case"success":return"🎉";case"warning":return"⚠️";case"info":return"ℹ️";default:return"💡"}},o=()=>{switch(s){case"success":return"from-green-600 to-green-700";case"warning":return"from-yellow-600 to-yellow-700";case"info":return"from-blue-600 to-blue-700";default:return"from-slate-600 to-slate-700"}};return d.jsx("div",{className:"fixed inset-0 bg-black/60 backdrop-blur-sm flex items-center justify-center z-50 p-4",children:d.jsx("div",{className:"bg-slate-800 rounded-2xl p-6 max-w-md w-full border border-slate-600 shadow-2xl animate-in slide-in-from-bottom-4 duration-300",children:d.jsxs("div",{className:"text-center",children:[d.jsx("div",{className:"w-16 h-16 bg-gradient-to-br from-slate-600 to-slate-700 rounded-full flex items-center justify-center mx-auto mb-4",children:d.jsx("span",{className:"text-3xl",children:i()})}),d.jsx("h3",{className:"text-xl font-bold text-white mb-3",children:t}),d.jsx("div",{className:"text-gray-300 mb-6 whitespace-pre-line text-sm leading-relaxed",children:r}),d.jsx("button",{onClick:e,className:`w-full bg-gradient-to-r ${o()} hover:from-slate-700 hover:to-slate-800 text-white font-bold py-3 px-6 rounded-xl transition-all duration-300 transform hover:scale-105`,children:"Got it"})]})})})},c8=({gameType:n,onClose:e})=>{L.useState(0);const t=()=>{const s=L.useRef(null),[i,o]=L.useState([{x:12,y:12}]),[a,l]=L.useState({x:1,y:0}),[u,h]=L.useState({x:1,y:0}),[f,p]=L.useState({x:15,y:15}),[y,I]=L.useState(!1),[C,P]=L.useState(0),[A,T]=L.useState(1),R={1:128,2:Math.round(128/1.25),3:Math.round(128/1.25/1.25)},D={1:5,2:5,3:10};return L.useEffect(()=>{const F=k=>{if(y){k.preventDefault(),o([{x:12,y:12}]),l({x:1,y:0}),h({x:1,y:0}),p({x:15,y:15}),I(!1),P(0),T(1);return}switch(k.key){case"ArrowUp":k.preventDefault(),a.y!==1&&h({x:0,y:-1});break;case"ArrowDown":k.preventDefault(),a.y!==-1&&h({x:0,y:1});break;case"ArrowLeft":k.preventDefault(),a.x!==1&&h({x:-1,y:0});break;case"ArrowRight":k.preventDefault(),a.x!==-1&&h({x:1,y:0});break}};return window.addEventListener("keydown",F),()=>window.removeEventListener("keydown",F)},[a,y]),L.useEffect(()=>{if(y)return;const F=setInterval(()=>{o(k=>{const E={x:k[0].x+a.x,y:k[0].y+a.y};if(E.x<0&&(E.x=24),E.x>=25&&(E.x=0),E.y<0&&(E.y=24),E.y>=25&&(E.y=0),k.slice(0,-1).some(S=>S.x===E.x&&S.y===E.y))return I(!0),k;const b=E.x===f.x&&E.y===f.y;let v;return b?(P(S=>S+D[A]),p({x:Math.floor(Math.random()*25),y:Math.floor(Math.random()*25)}),v=[E,...k]):v=[E,...k.slice(0,-1)],(u.x!==a.x||u.y!==a.y)&&setTimeout(()=>{l(u)},0),v})},R[A]);return()=>clearInterval(F)},[a,u,f,y]),L.useEffect(()=>{const F=s.current;if(!F)return;const k=F.getContext("2d"),E=15,_=25;k.fillStyle="#1f2937",k.fillRect(0,0,375,375),k.strokeStyle="#374151",k.lineWidth=1;for(let b=0;b<=_;b++)k.beginPath(),k.moveTo(b*E,0),k.lineTo(b*E,375),k.stroke(),k.beginPath(),k.moveTo(0,b*E),k.lineTo(375,b*E),k.stroke();i.forEach((b,v)=>{v===0?k.fillStyle="#fbbf24":k.fillStyle="#10b981",k.fillRect(b.x*E+1,b.y*E+1,E-2,E-2)}),k.fillStyle="#ef4444",k.fillRect(f.x*E+2,f.y*E+2,E-4,E-4)},[i,f]),d.jsxs("div",{className:"text-center",children:[d.jsx("div",{className:"mb-4",children:d.jsxs("div",{className:"flex justify-center gap-2 mb-3",children:[d.jsx("span",{className:"text-white mr-2 text-sm",children:"Level:"}),[1,2,3].map(F=>d.jsxs("button",{onClick:()=>T(F),className:`
                  px-4 py-2 text-sm font-mono border-2 border-green-500 transition-all
                  ${A===F?"bg-green-500 text-black":"bg-green-900 text-green-400"}
                  hover:bg-green-600 cursor-pointer
                `,style:{minWidth:"80px"},children:[d.jsxs("div",{children:["Level ",F]}),d.jsxs("div",{className:"text-xs mt-1",children:[F===1&&"Normal",F===2&&"Fast",F===3&&"Insane"]})]},F))]})}),d.jsx("canvas",{ref:s,width:"375",height:"375",className:"border-2 border-gray-300 mx-auto",style:{imageRendering:"pixelated"}}),d.jsxs("div",{className:"mt-4",children:[d.jsxs("p",{className:"text-lg font-bold text-gray-800",children:["Score: ",C," | Level: ",A]}),y&&d.jsxs("div",{className:"mt-2",children:[d.jsx("p",{className:"text-red-600 font-bold mb-2",children:"Game Over!"}),d.jsx("button",{onClick:()=>{o([{x:12,y:12}]),l({x:1,y:0}),h({x:1,y:0}),p({x:15,y:15}),I(!1),P(0),T(1)},className:"bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded text-sm",children:"Restart Game"})]})]})]})},r=()=>{try{return n==="snake"?d.jsx(t,{}):d.jsx("div",{className:"text-center text-red-600",children:"Game not found"})}catch(s){return console.error("Error rendering game:",s),d.jsxs("div",{className:"text-center text-red-600",children:[d.jsx("p",{className:"text-lg font-bold mb-2",children:"⚠️ Game Error"}),d.jsx("p",{className:"text-sm",children:"Something went wrong loading the game."}),d.jsx("button",{onClick:()=>window.location.reload(),className:"mt-2 bg-red-600 hover:bg-red-700 text-white px-4 py-2 rounded text-sm",children:"Reload Game"})]})}};return d.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:d.jsxs("div",{className:"bg-white rounded-2xl p-6 max-w-4xl w-full max-h-[90vh] overflow-y-auto",children:[d.jsxs("div",{className:"flex justify-between items-center mb-4",children:[d.jsx("h3",{className:"text-xl font-bold text-gray-800",children:"🐍 Snake Game"}),d.jsx("div",{className:"flex items-center gap-4",children:d.jsx("button",{onClick:e,className:"text-gray-500 hover:text-gray-700 text-2xl",children:"×"})})]}),d.jsx("div",{className:"bg-gray-100 rounded-lg p-4 min-h-[500px] flex items-center justify-center relative",children:r()})]})})},u8=({user:n,nemesis:e,onBackToLogin:t,onResetForTesting:r,onBreathingComplete:s})=>{const[i,o]=L.useState(!1),[a,l]=L.useState(null),[u,h]=L.useState(!1),[f,p]=L.useState({title:"",message:"",type:"info"}),[y,I]=L.useState(null),[C,P]=L.useState(!1),[A,T]=L.useState(0),[R,D]=L.useState(!1),[F,k]=L.useState(!1),[E,_]=L.useState(1),[b,v]=L.useState({strength:5,mood:"",context:"",outcome:""}),[S,N]=L.useState({resisted:0,relapses:0}),[w,B]=L.useState(0),[Ee,le]=L.useState(!1),[Be,$]=L.useState("");L.useEffect(()=>n!=null&&n.uid?(T(0),(async()=>{try{const fe=new hg(te,n.uid);await fe.initialize(),I(fe)}catch(fe){console.error("Error initializing StatManager:",fe)}})(),(async()=>{try{const fe=new Date().toDateString(),{ref:Ce,get:Qe}=await Re(()=>import("./index.esm-d8b59866.js"),[]);try{const ht=Ce(te,`users/${n.uid}/profile/dailyCravingLogs/${fe}`),Ne=await Qe(ht);if(Ne.exists()){const _e=Ne.val();B(_e.count||0)}else B(0)}catch{const Ne=`cravingLogs_${n.uid}_${fe}`,_e=localStorage.getItem(Ne);if(_e){const Oe=JSON.parse(_e);B(Oe.count||0)}else B(0)}}catch(fe){console.error("Error loading daily craving logs:",fe),B(0)}})(),(async()=>{try{const{ref:fe,get:Ce,onValue:Qe,query:ht,orderByChild:Ne,startAt:_e,endAt:Oe,set:at}=await Re(()=>import("./index.esm-d8b59866.js"),[]),Vn=new Date,ar=new Date(Vn.getTime()-7*24*60*60*1e3),jr=ar.toDateString(),Wn=Vn.toDateString();try{const Sn=fe(te,`users/${n.uid}/profile/cravingStats`),lr=await Ce(Sn);if(lr.exists()){const Ur=lr.val();if(Ur.lastUpdated&&new Date(Ur.lastUpdated)>ar){N(Ur);return}}}catch{console.log("Firebase stats not available, calculating from cravings data")}const Ar=fe(te,`users/${n.uid}/cravings`),is=ht(Ar,Ne("date"),_e(jr),Oe(Wn));try{const Sn=await Ce(is);let lr=0,Ur=0;Sn.exists()&&Sn.forEach(Gn=>{const As=Gn.val();As.outcome==="resisted"?lr++:As.outcome==="relapsed"&&Ur++});const _o={resisted:lr,relapses:Ur,lastUpdated:Vn.toISOString()};N(_o);try{const Gn=fe(te,`users/${n.uid}/profile/cravingStats`);await at(Gn,_o)}catch{console.log("Could not save weekly stats to Firebase, using localStorage")}localStorage.setItem(`cravingStats_${n.uid}`,JSON.stringify(_o))}catch{console.log("Could not query cravings, using localStorage fallback");const lr=JSON.parse(localStorage.getItem(`cravingStats_${n.uid}`)||'{"resisted": 0, "relapses": 0}');N(lr)}const Je=fe(te,`users/${n.uid}/profile/cravingStats`);return Qe(Je,Sn=>{Sn.exists()&&N(Sn.val())})}catch(fe){console.error("Error loading weekly stats:",fe);const Ce=JSON.parse(localStorage.getItem(`cravingStats_${n.uid}`)||'{"resisted": 0, "relapses": 0}');N(Ce)}})(),(async()=>{try{const{ref:fe,get:Ce,onValue:Qe}=await Re(()=>import("./index.esm-d8b59866.js"),[]),ht=new Date().toDateString(),Ne=fe(te,`users/${n.uid}/profile/daily/${ht}/water`),_e=await Ce(Ne);if(_e.exists())T(_e.val()||0);else{const at=parseInt(localStorage.getItem(`water_${n.uid}_${ht}`)||0);T(at)}return Qe(Ne,at=>{at.exists()&&T(at.val()||0)})}catch(fe){console.error("Error loading daily water from Firebase:",fe);const Ce=new Date().toDateString(),Qe=parseInt(localStorage.getItem(`water_${n.uid}_${Ce}`)||0);T(Qe)}})(),()=>{T(0),P(!1),N({resisted:0,relapses:0}),k(!1),_(1),v({strength:5,mood:"",context:"",outcome:""}),B(0),le(!1),$("")}):void 0,[n==null?void 0:n.uid]);const G=()=>{l("snake"),o(!0)},J=()=>{l(null),o(!1)},he=(ie,we)=>{p({title:ie,message:we,type:"info"}),h(!0)},pe=async()=>{if(!(n!=null&&n.uid)){console.warn("Cannot log water: No authenticated user");return}try{const ie=Math.min(A+1,6);T(ie);const we=new Date().toDateString();y&&(await y.handleHydrationUpdate(ie),ie===6&&A===5&&await y.checkHydrationStreak()>=3&&(await y.updateStat("mentalStrength",1,"3-day hydration streak"),console.log("Mental Strength +1 for 3-day hydration streak!")));const{ref:de,set:Ae}=await Re(()=>import("./index.esm-d8b59866.js"),[]),fe=de(te,`users/${n.uid}/profile/daily/${we}/water`);await Ae(fe,ie),localStorage.setItem(`water_${n.uid}_${we}`,ie.toString()),console.log("Water intake updated:",ie)}catch(ie){console.error("Error updating water intake:",ie);const we=Math.min(A+1,6);T(we);const de=new Date().toDateString();localStorage.setItem(`water_${n.uid}_${de}`,we.toString())}},Te=()=>{v({strength:5,mood:"",context:"",outcome:""}),_(1),k(!0)},dt=()=>{E<4&&_(E+1)},At=()=>{E>1&&_(E-1)},xe=async ie=>{try{const we=new Date().toISOString(),de=new Date().toDateString(),Ae={...b,outcome:ie,timestamp:we,date:de},fe=new Date().toDateString(),Ce=w+1;B(Ce);let Qe={resisted:S.resisted,relapses:S.relapses,lastUpdated:we},ht=!1;if(Ce<=2&&y&&(await y.handleCravingLogged(),ht=!0),n&&n.uid){const{ref:_e,set:Oe,push:at}=await Re(()=>import("./index.esm-d8b59866.js"),[]);try{const Wn=_e(te,`users/${n.uid}/profile/dailyCravingLogs/${fe}`);await Oe(Wn,{count:Ce,lastUpdated:we})}catch{const Ar=`cravingLogs_${n.uid}_${fe}`;localStorage.setItem(Ar,JSON.stringify({count:Ce,lastUpdated:we}))}const Vn=_e(te,`users/${n.uid}/cravings`),ar=at(Vn);await Oe(ar,Ae);const jr=_e(te,`users/${n.uid}/profile/cravingStats`);ie==="resisted"?(Qe.resisted=S.resisted+1,y&&await y.handleCravingResistance()):ie==="relapsed"&&(Qe.relapses=S.relapses+1,y&&await y.handleRelapse()),await Oe(jr,Qe),N(Qe),console.log("Craving assessment saved:",Ae)}const Ne=JSON.parse(localStorage.getItem(`cravings_${n.uid}`)||"[]");Ne.push(Ae),localStorage.setItem(`cravings_${n.uid}`,JSON.stringify(Ne)),localStorage.setItem(`cravingStats_${n.uid}`,JSON.stringify(Qe)),p(ie==="resisted"?{title:"🎉 Great Job!",message:`You successfully resisted that craving!

Your Mental Strength and Trigger Defense have increased significantly.

Plus, you earned awareness bonuses for tracking your craving!`,type:"success"}:ie==="resistance_practices"?{title:"🛡️ Stay Strong!",message:`Stay strong! Use distraction or wellbeing practices to resist.

You earned awareness bonuses for tracking your craving!`,type:"info"}:ie==="relapsed"?{title:"💪 Don't Give Up",message:`Relapses happen to everyone. The important thing is that you're here and trying again.

You still earned awareness bonuses for tracking your craving!`,type:"info"}:ie==="logged"?ht?{title:"📝 Craving Logged",message:`Great job tracking your craving!

You earned awareness bonuses for your self-awareness.

This helps build your Motivation and Trigger Defense.`,type:"info"}:{title:"📝 Daily Limit Reached",message:"Daily craving logging limit reached. Additional logs are recorded but won't award stat points until tomorrow.",type:"info"}:{title:"📝 Progress Recorded",message:`Your craving has been logged successfully.

You earned awareness bonuses for tracking your craving!`,type:"info"}),h(!0),k(!1),_(1)}catch(we){console.error("Error saving craving assessment:",we),p({title:"Progress Recorded",message:`Your progress has been recorded locally.

Keep up the great work!`,type:"info"}),h(!0),k(!1),_(1)}},Ke=async()=>{try{const ie=new Date().toISOString(),we=new Date().toDateString();if(n&&n.uid){const{ref:fe,set:Ce,push:Qe}=await Re(()=>import("./index.esm-d8b59866.js"),[]),ht=fe(te,`users/${n.uid}/cravings`),Ne=Qe(ht);await Ce(Ne,{strength:0,mood:"quick",context:"quick_action",outcome:"resisted",timestamp:ie,date:we});const _e=fe(te,`users/${n.uid}/profile/cravingStats`),Oe={resisted:S.resisted+1,relapses:S.relapses,lastUpdated:ie};await Ce(_e,Oe),N(Oe),y&&await y.handleCravingResistance()}const de=JSON.parse(localStorage.getItem(`cravings_${n.uid}`)||"[]");de.push({strength:0,mood:"quick",context:"quick_action",outcome:"resisted",timestamp:ie,date:we}),localStorage.setItem(`cravings_${n.uid}`,JSON.stringify(de));const Ae={resisted:S.resisted+1,relapses:S.relapses,lastUpdated:ie};localStorage.setItem(`cravingStats_${n.uid}`,JSON.stringify(Ae)),N(Ae),p({title:"🎉 Quick Win!",message:`Great job resisting that craving!

Your Mental Strength and Trigger Defense have increased.`,type:"success"}),h(!0)}catch(ie){console.error("Error recording quick resistance:",ie),p({title:"Progress Recorded",message:"Your progress has been recorded locally.",type:"info"}),h(!0)}},Se=async()=>{try{const ie=new Date().toISOString(),we=new Date().toDateString();if(n&&n.uid){const{ref:fe,set:Ce,push:Qe}=await Re(()=>import("./index.esm-d8b59866.js"),[]),ht=fe(te,`users/${n.uid}/cravings`),Ne=Qe(ht);await Ce(Ne,{strength:0,mood:"quick",context:"quick_action",outcome:"relapsed",timestamp:ie,date:we});const _e=fe(te,`users/${n.uid}/profile/cravingStats`),Oe={resisted:S.resisted,relapses:S.relapses+1,lastUpdated:ie};await Ce(_e,Oe),N(Oe),y&&await y.handleRelapse()}const de=JSON.parse(localStorage.getItem(`cravings_${n.uid}`)||"[]");de.push({strength:0,mood:"quick",context:"quick_action",outcome:"relapsed",timestamp:ie,date:we}),localStorage.setItem(`cravings_${n.uid}`,JSON.stringify(de));const Ae={resisted:S.resisted,relapses:S.relapses+1,lastUpdated:ie};localStorage.setItem(`cravingStats_${n.uid}`,JSON.stringify(Ae)),N(Ae),p({title:"💪 Stay Strong",message:`Thank you for being honest. Relapses happen to everyone.

Let's learn from this and move forward stronger.`,type:"info"}),h(!0)}catch(ie){console.error("Error recording quick relapse:",ie),p({title:"Progress Recorded",message:"Your progress has been recorded locally.",type:"info"}),h(!0)}};return d.jsx("div",{className:"min-h-screen bg-gradient-to-br from-slate-900 via-blue-900 to-slate-900 py-8 pb-20",children:d.jsxs("div",{className:"max-w-2xl mx-auto px-4",children:[d.jsx("div",{className:"mb-8",children:d.jsxs("div",{className:"flex justify-start gap-3",children:[d.jsx("button",{onClick:t,className:"px-6 py-3 bg-slate-600 hover:bg-slate-500 text-white rounded-lg transition-colors flex items-center gap-2",children:"← Back to Login"}),!1]})}),d.jsxs("div",{className:"bg-slate-800/30 rounded-2xl p-8 mb-8 border border-slate-600/30 shadow-xl",children:[d.jsx("div",{className:"mb-8",children:d.jsx("button",{onClick:Te,className:"w-full bg-gradient-to-r from-orange-400 via-amber-500 to-orange-500 hover:from-orange-500 hover:via-amber-600 hover:to-orange-600 text-white font-semibold py-5 px-6 rounded-2xl text-lg transition-all duration-300 transform hover:scale-102 shadow-2xl border border-orange-300/30 hover:border-orange-300/50",children:d.jsxs("div",{className:"flex items-center justify-center gap-3",children:[d.jsx("span",{className:"text-xl",children:"⚠️"}),d.jsx("span",{children:"I feel like vaping"})]})})}),d.jsxs("div",{className:"grid grid-cols-2 gap-6",children:[d.jsx("button",{onClick:Ke,className:"bg-slate-700/50 hover:bg-slate-600/50 text-slate-200 font-medium py-3 px-5 rounded-full transition-all duration-300 transform hover:scale-105 shadow-lg border border-slate-500/30 hover:border-slate-400/50",children:d.jsxs("div",{className:"flex items-center justify-center gap-2",children:[d.jsx("span",{className:"text-green-400",children:"✅"}),d.jsx("span",{children:"I resisted craving"})]})}),d.jsx("button",{onClick:Se,className:"bg-slate-700/50 hover:bg-slate-600/50 text-slate-200 font-medium py-3 px-5 rounded-full transition-all duration-300 transform hover:scale-105 shadow-lg border border-slate-500/30 hover:border-slate-400/50",children:d.jsxs("div",{className:"flex items-center justify-center gap-2",children:[d.jsx("span",{className:"text-red-400",children:"❌"}),d.jsx("span",{children:"I relapsed"})]})})]})]}),d.jsxs("div",{className:"bg-slate-800/30 rounded-2xl p-6 mb-8 border border-slate-600/30 shadow-lg",children:[d.jsx("h2",{className:"text-lg font-medium text-slate-200 mb-6 text-center",children:"📊 This Week"}),d.jsxs("div",{className:"grid grid-cols-2 gap-6",children:[d.jsxs("div",{className:"text-center p-5 bg-slate-700/30 rounded-xl border border-slate-500/20 hover:border-slate-400/40 transition-all duration-300",children:[d.jsx("div",{className:"text-2xl mb-3 text-green-400",children:"🎯"}),d.jsx("p",{className:"text-2xl font-semibold text-white mb-1",children:S.resisted}),d.jsx("p",{className:"text-sm text-slate-300",children:"Cravings Resisted"})]}),d.jsxs("div",{className:"text-center p-5 bg-slate-700/30 rounded-xl border border-slate-500/20 hover:border-slate-400/40 transition-all duration-300",children:[d.jsx("div",{className:"text-2xl mb-3 text-red-400",children:"💔"}),d.jsx("p",{className:"text-2xl font-semibold text-white mb-1",children:S.relapses}),d.jsx("p",{className:"text-sm text-slate-300",children:"Relapses"})]})]})]}),d.jsx("div",{className:"bg-slate-800/30 rounded-2xl p-6 mb-8 border border-slate-600/30 shadow-lg",children:d.jsxs("div",{className:"text-center",children:[d.jsx("h2",{className:"text-lg font-medium text-slate-200 mb-6",children:"🎮 Distract Yourself"}),d.jsx("div",{className:"flex justify-center",children:d.jsx("button",{onClick:G,className:"w-full max-w-xs bg-slate-700/30 hover:bg-slate-600/40 text-slate-200 font-medium py-4 px-6 rounded-xl text-lg transition-all duration-300 transform hover:scale-105 border border-slate-500/20 hover:border-slate-400/40 shadow-lg",children:"🐍 Play Snake"})})]})}),d.jsxs("div",{className:"bg-slate-800/30 rounded-2xl p-6 border border-slate-600/30 shadow-lg",children:[d.jsx("h2",{className:"text-lg font-medium text-slate-200 mb-6 text-center",children:"⚡ Quick Actions"}),d.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[d.jsx("button",{onClick:()=>P(!0),className:"bg-slate-700/30 hover:bg-slate-600/40 text-slate-200 font-medium py-4 px-4 rounded-xl transition-all duration-300 border border-slate-500/20 hover:border-slate-400/40 hover:scale-105 shadow-lg",children:"💧 Hydration"}),d.jsx("button",{onClick:()=>D(!0),className:"bg-slate-700/30 hover:bg-slate-600/40 text-slate-200 font-medium py-4 px-4 rounded-xl transition-all duration-300 border border-slate-500/20 hover:border-slate-400/40 hover:scale-105 shadow-lg",children:"🫁 Breathe"}),d.jsx("button",{onClick:()=>he("🚶‍♂️ Walk",`Take a 5-minute walk:

Physical activity releases endorphins that can help reduce cravings.

Walk around your room or step outside if possible.`),className:"bg-slate-700/30 hover:bg-slate-600/40 text-slate-200 font-medium py-4 px-4 rounded-xl transition-all duration-300 border border-slate-500/20 hover:border-slate-400/40 hover:scale-105 shadow-lg",children:"🚶‍♂️ Walk"}),d.jsx("button",{onClick:()=>he("🧘‍♀️ Meditate",`Quick Meditation:

1. Close your eyes
2. Focus on your breath
3. Count to 10 slowly
4. Repeat 3 times

This helps calm your mind and reduce stress.`),className:"bg-slate-700/30 hover:bg-slate-600/40 text-slate-200 font-medium py-4 px-4 rounded-xl transition-all duration-300 border border-slate-500/20 hover:border-slate-400/40 hover:scale-105 shadow-lg",children:"🧘‍♀️ Meditate"})]})]}),i&&a&&d.jsx(c8,{gameType:a,onClose:J}),d.jsx(l8,{isOpen:u,onClose:()=>h(!1),title:f.title,message:f.message,type:f.type}),C&&d.jsx(h8,{isOpen:C,onClose:()=>P(!1),onLogWater:pe,currentWater:A,userId:n.uid}),R&&d.jsx(Hz,{isOpen:R,onClose:()=>D(!1),onComplete:s}),F&&d.jsx(d8,{isOpen:F,onClose:()=>k(!1),step:E,cravingData:b,setCravingData:v,onNext:dt,onPrev:At,onComplete:xe,dailyCravingLogs:w})]})})},d8=({isOpen:n,onClose:e,step:t,cravingData:r,setCravingData:s,onNext:i,onPrev:o,onComplete:a,dailyCravingLogs:l})=>{const u=y=>y<=3?{text:"text-green-400",slider:"#4ade80",shadow:"rgba(74, 222, 128, 0.5)",label:"Low",effect:"craving-low",thumbClass:"slider-thumb-green"}:y<=7?{text:"text-orange-400",slider:"#f97316",shadow:"rgba(249, 115, 22, 0.5)",label:"Medium",effect:"craving-medium",thumbClass:"slider-thumb-orange"}:{text:"text-red-400",slider:"#ef4444",shadow:"rgba(239, 68, 68, 0.5)",label:"High",effect:"craving-high",thumbClass:"slider-thumb-red"},h=[{id:"stressed",icon:"😰",label:"Stressed"},{id:"lonely",icon:"😔",label:"Lonely"},{id:"happy",icon:"😊",label:"Happy"},{id:"bored",icon:"😐",label:"Bored"},{id:"excited",icon:"🤩",label:"Excited"},{id:"down",icon:"😞",label:"Down"},{id:"angry",icon:"😠",label:"Angry"},{id:"anxious",icon:"😰",label:"Anxious"}],f=[{id:"break",icon:"☕",label:"I'm taking a break"},{id:"partying",icon:"🎉",label:"I'm partying"},{id:"drinking",icon:"🍺",label:"I'm drinking alcohol"},{id:"car",icon:"🚗",label:"I'm in a car"},{id:"coffee",icon:"☕",label:"I'm drinking coffee"},{id:"eating",icon:"🍽️",label:"I've just finished eating"},{id:"intimate",icon:"💕",label:"I've made love"},{id:"tv",icon:"📺",label:"I'm watching TV"},{id:"wake",icon:"🌅",label:"I've just woken up"}],p=()=>{switch(t){case 1:return d.jsx("div",{className:"text-center",children:d.jsx("div",{className:"mb-8",children:(()=>{const y=u(r.strength);return d.jsxs(d.Fragment,{children:[d.jsx("div",{className:`text-6xl font-bold mb-2 ${y.text} ${y.effect}`,children:r.strength}),d.jsxs("div",{className:`text-lg font-medium mb-6 ${y.text}`,children:[y.label," Craving"]}),d.jsx("input",{type:"range",min:"0",max:"10",value:r.strength,onChange:I=>s({...r,strength:parseInt(I.target.value)}),style:{background:`linear-gradient(to right, ${y.slider} 0%, ${y.slider} ${r.strength/10*100}%, #475569 ${r.strength/10*100}%, #475569 100%)`},className:`w-full h-4 rounded-lg appearance-none cursor-pointer slider mb-4 ${y.thumbClass}`}),d.jsxs("div",{className:"flex justify-between text-sm text-gray-400",children:[d.jsx("span",{children:"Not at all"}),d.jsx("span",{children:"Extremely"})]})]})})()})});case 2:return d.jsx("div",{className:"text-center",children:d.jsx("div",{className:"grid grid-cols-4 gap-3",children:h.map(y=>d.jsxs("button",{onClick:()=>s({...r,mood:y.id}),className:`p-4 rounded-xl border-2 transition-all duration-300 ${r.mood===y.id?"border-blue-400 bg-blue-500/20":"border-slate-600 bg-slate-700/50 hover:border-slate-500"}`,children:[d.jsx("div",{className:"text-3xl mb-2",children:y.icon}),d.jsx("div",{className:"text-xs text-gray-300",children:y.label})]},y.id))})});case 3:return d.jsx("div",{className:"text-center",children:d.jsx("div",{className:"grid grid-cols-3 gap-3",children:f.map(y=>d.jsxs("button",{onClick:()=>s({...r,context:y.id}),className:`p-4 rounded-xl border-2 transition-all duration-300 ${r.context===y.id?"border-blue-400 bg-blue-500/20":"border-slate-600 bg-slate-700/50 hover:border-slate-500"}`,children:[d.jsx("div",{className:"text-2xl mb-2",children:y.icon}),d.jsx("div",{className:"text-xs text-gray-300 text-center",children:y.label})]},y.id))})});case 4:return d.jsx("div",{className:"text-center",children:d.jsxs("div",{className:"space-y-4",children:[d.jsx("button",{onClick:()=>a("resisted"),className:"w-full bg-gradient-to-r from-green-500 to-green-600 hover:from-green-600 hover:to-green-700 text-white font-bold py-4 px-6 rounded-xl transition-all duration-300 transform hover:scale-105 shadow-lg",children:"💪 I successfully resisted"}),d.jsx("button",{onClick:()=>a("resistance_practices"),className:"w-full bg-gradient-to-r from-purple-500 to-purple-600 hover:from-purple-600 hover:to-purple-700 text-white font-bold py-4 px-6 rounded-xl transition-all duration-300 transform hover:scale-105 shadow-lg",children:"🛡️ Use resistance practices"}),d.jsx("button",{onClick:()=>a("logged"),className:"w-full bg-gradient-to-r from-blue-500 to-blue-600 hover:from-blue-600 hover:to-blue-700 text-white font-bold py-4 px-6 rounded-xl transition-all duration-300 transform hover:scale-105 shadow-lg",children:"📝 Just log this craving"}),d.jsx("button",{onClick:()=>a("relapsed"),className:"w-full bg-gradient-to-r from-red-500 to-red-600 hover:from-red-600 hover:to-red-700 text-white font-bold py-4 px-6 rounded-xl transition-all duration-300 transform hover:scale-105 shadow-lg",children:"💔 I had a relapse"})]})});default:return null}};return n?d.jsx("div",{className:"fixed inset-0 bg-black/80 backdrop-blur-sm flex items-center justify-center z-50 p-4",children:d.jsxs("div",{className:"bg-gradient-to-br from-slate-800 via-slate-700 to-slate-800 rounded-3xl p-8 max-w-lg w-full shadow-2xl border border-slate-600/50 relative overflow-hidden",children:[d.jsx("div",{className:"absolute inset-0 bg-orange-500/5 pointer-events-none"}),d.jsxs("div",{className:"relative z-10",children:[d.jsxs("div",{className:"text-center mb-6",children:[d.jsx("div",{className:"flex justify-center space-x-2 mb-3",children:[1,2,3,4].map(y=>d.jsx("div",{className:`w-3 h-3 rounded-full ${y<=t?"bg-orange-400":"bg-slate-600"}`},y))}),d.jsxs("p",{className:"text-gray-400 text-sm",children:["Step ",t," of 4"]}),d.jsxs("div",{className:"mt-2 text-xs text-gray-500",children:["Daily logs: ",l,"/2"]})]}),d.jsx("div",{className:"mb-8",children:p()}),d.jsxs("div",{className:"flex justify-between",children:[t>1&&d.jsx("button",{onClick:o,className:"px-6 py-3 bg-slate-600 hover:bg-slate-500 text-white rounded-xl transition-colors",children:"← Back"}),t<4&&d.jsx("button",{onClick:i,disabled:t===1&&r.strength===void 0||t===2&&!r.mood||t===3&&!r.context,className:"px-6 py-3 bg-orange-500 hover:bg-orange-600 disabled:bg-slate-600 disabled:cursor-not-allowed text-white rounded-xl transition-colors ml-auto",children:"Next →"})]}),d.jsx("button",{onClick:e,className:"absolute top-4 right-4 text-gray-400 hover:text-white text-2xl",children:"×"})]})]})}):null},h8=({isOpen:n,onClose:e,onLogWater:t,currentWater:r,userId:s})=>{const[i,o]=L.useState(!1),[a,l]=L.useState(0),[u,h]=L.useState(0),[f,p]=L.useState(!1),[y,I]=L.useState(!1);L.useEffect(()=>{n&&s&&C()},[n,s,r]);const C=async()=>{try{const{ref:D,get:F}=await Re(()=>import("./index.esm-d8b59866.js"),[]),k=await P();l(k);const E=await A();h(E)}catch(D){console.error("Error loading hydration data:",D)}},P=async()=>{try{const{ref:D,get:F}=await Re(()=>import("./index.esm-d8b59866.js"),[]);let k=0;for(let E=0;E<7;E++){const _=new Date;_.setDate(_.getDate()-E);const b=_.toDateString(),v=await F(D(te,`users/${s}/profile/daily/${b}/water`));if(v.exists()&&v.val()>0)k++;else break}return k}catch(D){return console.error("Error checking hydration streak:",D),0}},A=async()=>{try{const{ref:D,get:F}=await Re(()=>import("./index.esm-d8b59866.js"),[]);let k=0;for(let E=0;E<7;E++){const _=new Date;_.setDate(_.getDate()-E);const b=_.toDateString(),v=await F(D(te,`users/${s}/profile/daily/${b}/water`));v.exists()&&v.val()>=6&&k++}return Math.min(k,3)}catch(D){return console.error("Error checking mental strength progress:",D),0}},T=()=>d.jsx("div",{className:"grid grid-cols-3 gap-4",children:[...Array(6)].map((D,F)=>{const k=F<r,E=F===r-1&&f;return d.jsxs("div",{className:"relative w-16 h-20",children:[d.jsxs("div",{className:"absolute inset-0 border-2 border-blue-400 rounded-lg overflow-hidden",children:[k&&d.jsx("div",{className:`w-full bg-gradient-to-b from-blue-400 to-blue-600 ${E?"water-fill":""}`,style:{height:"100%",background:"linear-gradient(to bottom, #60a5fa, #2563eb)"}}),k&&d.jsx("div",{className:`absolute top-0 left-0 right-0 h-1 bg-blue-300 opacity-60 rounded-t-lg ${E?"water-ripple":""}`}),E&&d.jsx("div",{className:"absolute inset-0 bg-gradient-to-b from-blue-300/50 to-transparent water-pour"})]}),d.jsx("div",{className:"absolute top-0 left-0 right-0 h-1 bg-blue-200/40 rounded-t-lg"}),E&&d.jsx("div",{className:"absolute -top-2 left-1/2 transform -translate-x-1/2",children:d.jsx("div",{className:"w-2 h-3 bg-blue-400 rounded-full water-pour opacity-80"})})]},F)})}),R=async()=>{!s||f||r>=6||(p(!0),t(),setTimeout(async()=>{p(!1),await C(),r+1>=6&&(o(!0),setTimeout(()=>o(!1),3e3))},1e3))};return!n||!s?null:d.jsx("div",{className:"fixed inset-0 bg-black/80 backdrop-blur-sm flex items-center justify-center z-50 p-4",children:d.jsxs("div",{className:"bg-gradient-to-br from-slate-800 via-slate-700 to-slate-800 rounded-3xl p-8 max-w-lg w-full shadow-2xl border border-slate-600/50 relative overflow-hidden",children:[i&&d.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-blue-500/10 via-purple-500/10 to-blue-500/10 pointer-events-none animate-pulse"}),d.jsx("div",{className:"absolute inset-0 bg-blue-500/5 pointer-events-none"}),d.jsxs("div",{className:"relative z-10",children:[d.jsxs("div",{className:"flex items-center justify-center mb-6 relative",children:[T(),i&&d.jsxs(d.Fragment,{children:[d.jsx("div",{className:"absolute -top-4 -left-4 text-2xl animate-bounce",children:"✨"}),d.jsx("div",{className:"absolute -top-2 -right-2 text-xl animate-bounce",style:{animationDelay:"0.2s"},children:"🌟"}),d.jsx("div",{className:"absolute -bottom-2 -left-2 text-lg animate-bounce",style:{animationDelay:"0.4s"},children:"💫"}),d.jsx("div",{className:"absolute -bottom-4 -right-4 text-xl animate-bounce",style:{animationDelay:"0.6s"},children:"⭐"})]})]}),d.jsx("div",{className:"text-center mb-6",children:d.jsxs("div",{className:"bg-gradient-to-r from-blue-500/20 to-blue-600/20 border border-blue-500/30 rounded-2xl p-6",children:[d.jsx("p",{className:"text-gray-300 text-lg mb-3",children:"Glasses today"}),d.jsxs("p",{className:"text-6xl font-black text-blue-400 mb-2",children:[r,"/6"]}),d.jsx("p",{className:"text-blue-200 text-sm font-medium",children:r===6?"🎉 You are a legend of hydration!":`${r} of 6 glasses completed`})]})}),d.jsx("div",{"aria-live":"polite",className:"sr-only",children:r===6?"You are a legend of hydration for today":`${r} of 6 glasses completed today`}),d.jsxs("div",{className:"grid grid-cols-2 gap-4 mb-8",children:[d.jsx("div",{className:"text-center",children:d.jsxs("div",{className:"bg-gradient-to-r from-orange-500/20 to-red-500/20 border border-orange-500/30 rounded-2xl px-4 py-3 h-24 flex flex-col justify-center",children:[d.jsx("span",{className:"text-xl mb-1",children:"🔥"}),d.jsxs("div",{children:[d.jsx("p",{className:"text-orange-200 text-xs font-medium",children:"Hydration Streak"}),d.jsxs("p",{className:"text-lg font-bold text-orange-300",children:[a," days"]})]})]})}),d.jsx("div",{className:"text-center",children:d.jsxs("div",{className:"bg-gradient-to-r from-purple-500/20 to-purple-600/20 border border-purple-500/30 rounded-2xl px-4 py-3 h-24 flex flex-col justify-center",children:[d.jsxs("div",{className:"flex items-center justify-center gap-2 mb-1",children:[d.jsx("p",{className:"text-purple-200 text-xs font-medium",children:"Mental Strength"}),d.jsx("button",{onClick:()=>I(!y),className:"text-purple-300 hover:text-purple-200 transition-colors",title:"Learn more about Mental Strength",children:"ℹ️"})]}),y&&d.jsx("div",{className:"bg-slate-700/90 border border-purple-400/30 rounded-lg p-2 mb-2 text-xs text-purple-100",children:"Staying hydrated for 3 days straight adds 1 point to Mental Strength stat"}),d.jsx("div",{className:"flex justify-center items-center gap-1 mb-1",children:[...Array(3)].map((D,F)=>d.jsx("div",{className:`w-2 h-2 rounded-full transition-all duration-300 ${F<u?"bg-purple-400 shadow-lg shadow-purple-400/50":"bg-slate-600 border border-slate-500"}`},F))}),d.jsxs("p",{className:"text-purple-200 text-xs",children:[u,"/3 days"]})]})})]}),d.jsxs("div",{className:"flex flex-col gap-4",children:[d.jsx("button",{onClick:R,disabled:r>=6||f,className:"w-full py-4 px-6 rounded-2xl font-bold text-lg bg-blue-500 hover:bg-blue-600 text-white transition-all duration-300 disabled:bg-gray-600 disabled:cursor-not-allowed",children:r>=6?"🎉 You are a legend of hydration!":f?"💧 Logging...":"💧 Log Water"}),d.jsx("button",{onClick:e,className:"bg-slate-600/50 hover:bg-slate-600 text-gray-300 hover:text-white font-medium py-3 px-6 rounded-xl transition-all duration-300",children:"Done"})]})]})]})})},f8=({user:n,onNavigate:e})=>{const[t,r]=L.useState(null),[s,i]=L.useState(!1),[o,a]=L.useState(!1),[l,u]=L.useState(!1),[h,f]=L.useState(!1),[p,y]=L.useState(null),[I,C]=L.useState(0),[P,A]=L.useState(null),[T,R]=L.useState(!1),[D,F]=L.useState([]),[k,E]=L.useState(null);L.useEffect(()=>{if(!(n!=null&&n.uid))return;(async()=>{try{const de=new hg(te,n.uid);await de.initialize(),E(de)}catch(de){console.error("Error initializing StatManager:",de)}})();const ie=async()=>{try{const{ref:de,get:Ae,onValue:fe}=await Re(()=>import("./index.esm-d8b59866.js"),[]),Ce=de(te,`users/${n.uid}/profile/relapseDate`),Qe=await Ae(Ce);Qe.exists()&&r(new Date(Qe.val()));const ht=de(te,`users/${n.uid}/profile/scheduledTriggers`),Ne=await Ae(ht);Ne.exists()&&F(Ne.val());const _e=new Date().toDateString(),Oe=de(te,`users/${n.uid}/profile/daily/${_e}/water`),at=fe(Oe,Je=>{Je.exists()&&C(Je.val()||0)}),Vn=de(te,`users/${n.uid}/profile/daily/${_e}/mood`),ar=fe(Vn,Je=>{Je.exists()&&A(Je.val())}),jr=de(te,`users/${n.uid}/profile/daily/${_e}/breathing`),Wn=fe(jr,Je=>{Je.exists()&&R(Je.val()||!1)}),Ar=de(te,`users/${n.uid}/profile/scheduledTriggers`),is=fe(Ar,Je=>{Je.exists()&&F(Je.val()||[])});return()=>{at(),ar(),Wn(),is()}}catch(de){console.error("Error loading profile data from Firebase:",de),we()}},we=()=>{const de=localStorage.getItem("quitCoachRelapseDate");de&&r(new Date(de));const Ae=new Date().toDateString(),fe=localStorage.getItem(`water_${n.uid}_${Ae}`),Ce=localStorage.getItem(`mood_${n.uid}_${Ae}`),Qe=localStorage.getItem(`breathing_${n.uid}_${Ae}`);fe&&C(parseInt(fe)),Ce&&A(JSON.parse(Ce)),Qe&&R(Qe==="true");const ht=localStorage.getItem("scheduledTriggers");ht&&F(JSON.parse(ht))};ie()},[n==null?void 0:n.uid]),L.useEffect(()=>{k&&k.trackLoggingActivity()},[k]),L.useEffect(()=>{if(!(n!=null&&n.uid))return;(async()=>{try{const{ref:ie,get:we,set:de}=await Re(()=>import("./index.esm-d8b59866.js"),[]),Ae=ie(te,`users/${n.uid}/profile`),fe=await we(Ae);if(!fe.exists()||Object.keys(fe.val()).length===0){console.log("Migrating localStorage data to Firebase...");const Ce=localStorage.getItem("quitCoachRelapseDate");Ce&&(await de(ie(te,`users/${n.uid}/profile/relapseDate`),Ce),r(new Date(Ce)));const Qe=parseInt(localStorage.getItem("cravingWins")||0);Qe>0&&await de(ie(te,`users/${n.uid}/profile/cravingsResisted`),Qe);for(let Ne=0;Ne<7;Ne++){const _e=new Date;_e.setDate(_e.getDate()-Ne);const Oe=_e.toDateString(),at=localStorage.getItem(`water_${n.uid}_${Oe}`);at&&await de(ie(te,`users/${n.uid}/profile/daily/${Oe}/water`),parseInt(at))}for(let Ne=0;Ne<7;Ne++){const _e=new Date;_e.setDate(_e.getDate()-Ne);const Oe=_e.toDateString(),at=localStorage.getItem(`mood_${n.uid}_${Oe}`);at&&await de(ie(te,`users/${n.uid}/profile/daily/${Oe}/mood`),JSON.parse(at))}for(let Ne=0;Ne<7;Ne++){const _e=new Date;_e.setDate(_e.getDate()-Ne);const Oe=_e.toDateString(),at=localStorage.getItem(`breathing_${n.uid}_${Oe}`);at&&await de(ie(te,`users/${n.uid}/profile/daily/${Oe}/breathing`),at==="true")}const ht=localStorage.getItem("scheduledTriggers");if(ht){const Ne=JSON.parse(ht);await de(ie(te,`users/${n.uid}/profile/scheduledTriggers`),Ne),F(Ne)}console.log("localStorage data migration to Firebase completed")}}catch(ie){console.error("Error migrating localStorage data to Firebase:",ie)}})()},[n==null?void 0:n.uid]);const _=()=>t&&t>((n==null?void 0:n.quitDate)||new Date(0))?t:(n==null?void 0:n.quitDate)||new Date,b=()=>{const Se=new Date,ie=new Date(Se);ie.setHours(24,0,0,0);const we=ie-Se,de=Math.floor(we/(1e3*60*60)),Ae=Math.floor(we%(1e3*60*60)/(1e3*60)),fe=Math.floor(we%(1e3*60)/1e3);return{hours:de,minutes:Ae,seconds:fe}},[v,S]=L.useState(b()),[N,w]=L.useState(0),[B,Ee]=L.useState(0),[le,Be]=L.useState(0),[$,G]=L.useState(0);L.useEffect(()=>{const Se=setInterval(()=>{S(b());const ie=_(),de=new Date-ie,Ae=Math.floor(de/(1e3*60*60*24)),fe=Math.floor(de%(1e3*60*60*24)/(1e3*60*60)),Ce=Math.floor(de%(1e3*60*60)/(1e3*60)),Qe=Math.floor(de%(1e3*60)/1e3);w(Ae),Ee(fe),Be(Ce),G(Qe)},1e3);return()=>clearInterval(Se)},[t,n==null?void 0:n.quitDate]);const J=async(Se,ie)=>{if(!(n!=null&&n.uid))return!1;try{const{ref:we,set:de}=await Re(()=>import("./index.esm-d8b59866.js"),[]),Ae=we(te,`users/${n.uid}/profile/${Se}`);return await de(Ae,ie),!0}catch(we){return console.error("Error saving to Firebase:",we),!1}},he=async()=>{const Se=new Date;r(Se),k&&await k.handleRelapse(),await J("relapseDate",Se.toISOString())||localStorage.setItem("quitCoachRelapseDate",Se.toISOString())},Te=(()=>{const Se=new Date,ie=Se.getDay(),we=ie===0?6:ie-1,de=[{name:"Mon",color:"bg-slate-700"},{name:"Tue",color:"bg-slate-700"},{name:"Wed",color:"bg-slate-700"},{name:"Thu",color:"bg-slate-700"},{name:"Fri",color:"bg-slate-700"},{name:"Sat",color:"bg-slate-700"},{name:"Sun",color:"bg-slate-700"}];for(let Ae=0;Ae<=we;Ae++)de[Ae].color="bg-green-500";return t&&t.toDateString()===Se.toDateString()&&(de[we].color="bg-red-500"),de})(),dt=async Se=>{C(Se);const ie=new Date().toDateString();k&&await k.handleHydrationUpdate(Se),await J(`daily/${ie}/water`,Se)||localStorage.setItem(`water_${ie}`,Se.toString()),i(!1)},At=async Se=>{A(Se);const ie=new Date().toDateString();await J(`daily/${ie}/mood`,Se)||localStorage.setItem(`mood_${ie}`,JSON.stringify(Se)),a(!1)},xe=async(Se,ie,we)=>{const de={day:Se,triggerType:ie,time:we,id:Date.now()},Ae=[...D,de];F(Ae),k&&await k.handleTriggerPlanning(),await J("scheduledTriggers",Ae)||localStorage.setItem("scheduledTriggers",JSON.stringify(Ae)),u(!1)},Ke=async()=>{k&&await k.handleTriggerListUpdate()};return d.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-slate-900 via-blue-900 to-slate-900 pb-20",children:[d.jsxs("div",{className:"flex items-center justify-between p-4 pt-16",children:[d.jsxs("div",{className:"flex items-center gap-3",children:[d.jsx("div",{className:"w-12 h-12 bg-gradient-to-br from-blue-400 to-blue-600 rounded-full flex items-center justify-center",children:n!=null&&n.avatar?d.jsx("img",{src:n.avatar,alt:"Avatar",className:"w-full h-full object-cover rounded-full"}):d.jsx("span",{className:"text-white font-bold text-lg",children:n!=null&&n.heroName?n.heroName.charAt(0).toUpperCase():"H"})}),d.jsxs("div",{children:[d.jsx("p",{className:"text-white text-lg",children:"Hello,"}),d.jsx("p",{className:"text-white text-2xl font-bold",children:(n==null?void 0:n.heroName)||"Hero"})]})]}),d.jsx("div",{className:"bg-yellow-500 px-3 py-1 rounded-full",children:d.jsx("span",{className:"font-bold text-slate-900",children:N})})]}),d.jsxs("div",{className:"px-4 space-y-6",children:[d.jsx("div",{className:"mb-6",children:d.jsxs("button",{onClick:he,className:"w-full bg-gradient-to-r from-red-600 to-orange-600 hover:from-red-700 hover:to-orange-700 text-white font-bold py-4 px-6 rounded-xl transition-all duration-300 shadow-lg hover:shadow-xl transform hover:scale-105",children:[d.jsxs("div",{className:"flex items-center justify-center gap-3",children:[d.jsx("span",{className:"text-2xl",children:"⚠️"}),d.jsx("span",{className:"text-lg",children:"RELAPSE"}),d.jsx("span",{className:"text-2xl",children:"⚠️"})]}),d.jsx("p",{className:"text-sm opacity-90 mt-1",children:"Reset progress and start over"})]})}),d.jsxs("div",{className:"bg-slate-800/50 rounded-xl p-4",children:[d.jsxs("div",{className:"flex items-center justify-between mb-4",children:[d.jsx("h2",{className:"text-white text-xl font-bold",children:"My week"}),d.jsxs("div",{className:"bg-green-500 px-3 py-1 rounded-full flex items-center gap-1",children:[d.jsx("span",{className:"text-white text-sm",children:"✓"}),d.jsx("span",{className:"text-white font-bold",children:"0"})]})]}),d.jsx("div",{className:"flex justify-between items-center mb-4",children:Te.map((Se,ie)=>d.jsxs("div",{className:"text-center",children:[d.jsx("div",{className:`w-8 h-8 rounded-full mb-1 ${Se.color}`}),d.jsx("p",{className:"text-gray-400 text-xs",children:Se.name})]},Se.name))})]}),d.jsxs("div",{className:"bg-slate-800/50 rounded-xl p-4",children:[d.jsx("h3",{className:"text-white text-lg font-semibold mb-2",children:"Remaining time for Today"}),d.jsxs("div",{className:"text-center",children:[d.jsxs("div",{className:"text-white text-3xl font-bold",children:[v.hours.toString().padStart(2,"0"),":",v.minutes.toString().padStart(2,"0"),":",v.seconds.toString().padStart(2,"0")]}),d.jsx("p",{className:"text-gray-400 text-sm",children:"Countdown to midnight"})]})]}),d.jsxs("div",{children:[d.jsx("h2",{className:"text-white text-2xl font-bold mb-4",children:"My progress"}),d.jsxs("div",{className:"bg-slate-800/50 rounded-xl p-4 mb-4",children:[d.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[d.jsx("span",{className:"text-yellow-400 text-lg",children:"⏰"}),d.jsx("span",{className:"text-gray-300",children:"Clean for"})]}),d.jsxs("div",{className:"flex items-baseline gap-4",children:[d.jsxs("div",{className:"text-center",children:[d.jsx("div",{className:"text-white text-3xl font-bold",children:N.toString().padStart(2,"0")}),d.jsx("div",{className:"text-gray-400 text-sm",children:"days"})]}),d.jsxs("div",{className:"text-center",children:[d.jsx("div",{className:"text-white text-3xl font-bold",children:B.toString().padStart(2,"0")}),d.jsx("div",{className:"text-gray-400 text-sm",children:"hours"})]}),d.jsxs("div",{className:"text-center",children:[d.jsx("div",{className:"text-white text-3xl font-bold",children:le.toString().padStart(2,"0")}),d.jsx("div",{className:"text-gray-400 text-sm",children:"minutes"})]}),d.jsxs("div",{className:"text-center",children:[d.jsx("div",{className:"text-white text-2xl font-bold animate-pulse",children:$.toString().padStart(2,"0")}),d.jsx("div",{className:"text-gray-400 text-sm",children:"seconds"})]})]}),t&&d.jsx("div",{className:"mt-3 text-center",children:d.jsxs("p",{className:"text-red-400 text-sm",children:["Last relapse: ",t.toLocaleDateString()," at ",t.toLocaleTimeString()]})})]})]}),d.jsxs("div",{children:[d.jsx("h2",{className:"text-white text-2xl font-bold mb-4",children:"Habit Tracking"}),d.jsxs("div",{className:"space-y-4",children:[d.jsx("button",{onClick:()=>i(!0),className:"w-full bg-gradient-to-r from-blue-500/20 to-blue-600/20 bg-slate-800/50 rounded-xl p-4 text-left hover:scale-105 transition-all duration-300",children:d.jsxs("div",{className:"flex items-center gap-4",children:[d.jsx("div",{className:"w-12 h-12 bg-white rounded-lg flex items-center justify-center text-xl",children:"💧"}),d.jsxs("div",{className:"flex-1",children:[d.jsx("h3",{className:"text-white font-bold text-lg",children:"Stay hydrated"}),d.jsx("p",{className:"text-gray-300 text-sm",children:I>0?`${I} glasses today`:"Tap to log water intake"})]}),d.jsx("div",{className:"text-blue-400 text-2xl",children:"→"})]})}),d.jsx("button",{onClick:()=>a(!0),className:"w-full bg-gradient-to-r from-green-500/20 to-green-600/20 bg-slate-800/50 rounded-xl p-4 text-left hover:scale-105 transition-all duration-300",children:d.jsxs("div",{className:"flex items-center gap-4",children:[d.jsx("div",{className:"w-12 h-12 bg-white rounded-lg flex items-center justify-center text-xl",children:"🌤️"}),d.jsxs("div",{className:"flex-1",children:[d.jsx("h3",{className:"text-white font-bold text-lg",children:"Mood tracking"}),d.jsx("p",{className:"text-gray-300 text-sm",children:P?`You feel ${P.name.toLowerCase()}`:"How do you feel today?"})]}),d.jsx("div",{className:"text-green-400 text-2xl",children:"→"})]})})]})]}),d.jsxs("div",{children:[d.jsx("h2",{className:"text-white text-2xl font-bold mb-4",children:"This Week's Battle Plan"}),d.jsxs("div",{className:"space-y-3",children:[d.jsx("button",{onClick:()=>u(!0),className:"w-full bg-gradient-to-r from-orange-500/20 to-orange-600/20 bg-slate-800/50 rounded-xl p-4 text-left hover:scale-105 transition-all duration-300",children:d.jsxs("div",{className:"flex items-center gap-4",children:[d.jsx("div",{className:"w-12 h-12 bg-white rounded-lg flex items-center justify-center text-xl",children:"🛡️"}),d.jsxs("div",{className:"flex-1",children:[d.jsx("h3",{className:"text-white font-bold text-lg",children:"Trigger defense planning"}),d.jsx("p",{className:"text-gray-300 text-sm",children:D.length>0?`${D.length} triggers planned`:"Plan your trigger defense strategy"})]}),d.jsx("div",{className:"text-orange-400 text-2xl",children:"→"})]})}),d.jsx("button",{onClick:Ke,className:"w-full bg-gradient-to-r from-purple-500/20 to-purple-600/20 bg-slate-800/50 rounded-xl p-4 text-left hover:scale-105 transition-all duration-300",children:d.jsxs("div",{className:"flex items-center gap-4",children:[d.jsx("div",{className:"w-12 h-12 bg-white rounded-lg flex items-center justify-center text-xl",children:"📝"}),d.jsxs("div",{className:"flex-1",children:[d.jsx("h3",{className:"text-white font-bold text-lg",children:"Update trigger list"}),d.jsx("p",{className:"text-gray-300 text-sm",children:"Review and update your personal triggers for +1 Trigger Defense"})]}),d.jsx("div",{className:"text-purple-400 text-2xl",children:"→"})]})})]})]}),d.jsx("div",{children:d.jsx("h2",{className:"text-white text-2xl font-bold mb-4",children:"Benefits Monitor"})}),d.jsxs("div",{children:[d.jsx("h2",{className:"text-white text-2xl font-bold mb-4",children:"Diary"}),d.jsx("button",{onClick:()=>f(!0),className:"w-full bg-gradient-to-r from-indigo-500/20 to-indigo-600/20 bg-slate-800/50 rounded-xl p-4 text-left hover:scale-105 transition-all duration-300",children:d.jsxs("div",{className:"flex items-center gap-4",children:[d.jsx("div",{className:"w-12 h-12 bg-white rounded-lg flex items-center justify-center text-xl",children:"📅"}),d.jsxs("div",{className:"flex-1",children:[d.jsx("h3",{className:"text-white font-bold text-lg",children:"Monthly overview"}),d.jsx("p",{className:"text-gray-300 text-sm",children:"View your progress and daily activities"})]}),d.jsx("div",{className:"text-indigo-400 text-2xl",children:"→"})]})})]})]}),d.jsx(p8,{isOpen:s,onClose:()=>i(!1),onConfirm:dt,currentWater:I}),d.jsx(m8,{isOpen:o,onClose:()=>a(!1),onSelect:At,selectedMood:P}),d.jsx(g8,{isOpen:l,onClose:()=>u(!1),onSchedule:xe,scheduledTriggers:D}),d.jsx(y8,{isOpen:h,onClose:()=>f(!1),selectedDate:p,onDateSelect:y,dailyData:{water:I,mood:P,breathing:T,relapseDate:t}})]})},p8=({isOpen:n,onClose:e,onConfirm:t,currentWater:r})=>{const[s,i]=L.useState(r);return n?d.jsx("div",{className:"fixed inset-0 bg-black/80 backdrop-blur-sm flex items-center justify-center z-50 p-4",children:d.jsxs("div",{className:"bg-slate-800 rounded-2xl p-6 max-w-md w-full shadow-2xl border border-slate-700",children:[d.jsxs("div",{className:"text-center mb-6",children:[d.jsx("h3",{className:"text-xl font-bold text-white mb-2",children:"💧 Water Intake"}),d.jsx("p",{className:"text-gray-300 text-sm",children:"How many glasses of water today?"})]}),d.jsxs("div",{className:"mb-6",children:[d.jsx("input",{type:"number",min:"0",max:"20",value:s,onChange:o=>i(parseInt(o.target.value)||0),className:"w-full bg-slate-700 text-white text-center text-2xl font-bold py-4 rounded-lg border border-slate-600 focus:border-blue-500 focus:outline-none",placeholder:"0"}),d.jsx("p",{className:"text-gray-400 text-sm text-center mt-2",children:"0-20 glasses"})]}),d.jsxs("div",{className:"flex gap-3",children:[d.jsx("button",{onClick:e,className:"flex-1 bg-slate-600 hover:bg-slate-700 text-white font-bold py-3 rounded-lg transition-colors",children:"Cancel"}),d.jsx("button",{onClick:()=>t(s),className:"flex-1 bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 rounded-lg transition-colors",children:"Confirm"})]})]})}):null},m8=({isOpen:n,onClose:e,onSelect:t,selectedMood:r})=>{const s=[{name:"Anger",icon:"😠",color:"bg-red-500"},{name:"Disgust",icon:"🤢",color:"bg-orange-500"},{name:"Enjoyment",icon:"😊",color:"bg-yellow-500"},{name:"Calm",icon:"😌",color:"bg-blue-500"},{name:"Fear",icon:"😨",color:"bg-purple-500"},{name:"Sadness",icon:"😢",color:"bg-indigo-500"},{name:"Indifferent",icon:"😐",color:"bg-gray-500"}];return n?d.jsx("div",{className:"fixed inset-0 bg-black/80 backdrop-blur-sm flex items-center justify-center z-50 p-4",children:d.jsxs("div",{className:"bg-slate-800 rounded-2xl p-6 max-w-md w-full shadow-2xl border border-slate-700",children:[d.jsxs("div",{className:"text-center mb-6",children:[d.jsx("h3",{className:"text-xl font-bold text-white mb-2",children:"🌤️ How do you feel?"}),d.jsx("p",{className:"text-gray-300 text-sm",children:"Select your current mood"})]}),d.jsx("div",{className:"grid grid-cols-2 gap-3 mb-6",children:s.map(i=>d.jsxs("button",{onClick:()=>t(i),className:`p-4 rounded-xl text-center transition-all duration-300 hover:scale-105 ${(r==null?void 0:r.name)===i.name?"ring-2 ring-blue-400":"bg-slate-700 hover:bg-slate-600"}`,children:[d.jsx("div",{className:`w-12 h-12 ${i.color} rounded-full flex items-center justify-center text-2xl mx-auto mb-2`,children:i.icon}),d.jsx("p",{className:"text-white font-semibold",children:i.name})]},i.name))}),d.jsx("button",{onClick:e,className:"w-full bg-slate-600 hover:bg-slate-700 text-white font-bold py-3 rounded-lg transition-colors",children:"Cancel"})]})}):null},g8=({isOpen:n,onClose:e,onSchedule:t,scheduledTriggers:r})=>{const[s,i]=L.useState(""),[o,a]=L.useState(""),[l,u]=L.useState("12:00"),h=["Social event","Drinks","High-stress event","Social pressure"],f=["Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday"];return n?d.jsx("div",{className:"fixed inset-0 bg-black/80 backdrop-blur-sm flex items-center justify-center z-50 p-4",children:d.jsxs("div",{className:"bg-slate-800 rounded-2xl p-6 max-w-md w-full shadow-2xl border border-slate-700",children:[d.jsxs("div",{className:"text-center mb-6",children:[d.jsx("h3",{className:"text-xl font-bold text-white mb-2",children:"🛡️ Trigger Defense Planning"}),d.jsx("p",{className:"text-gray-300 text-sm",children:"Schedule your trigger defense strategy"})]}),d.jsxs("div",{className:"space-y-4 mb-6",children:[d.jsxs("div",{children:[d.jsx("label",{className:"block text-white text-sm font-semibold mb-2",children:"Day of the week"}),d.jsxs("select",{value:s,onChange:p=>i(p.target.value),className:"w-full bg-slate-700 text-white p-3 rounded-lg border border-slate-600 focus:border-blue-500 focus:outline-none",children:[d.jsx("option",{value:"",children:"Select a day"}),f.map(p=>d.jsx("option",{value:p,children:p},p))]})]}),d.jsxs("div",{children:[d.jsx("label",{className:"block text-white text-sm font-semibold mb-2",children:"Trigger type"}),d.jsxs("select",{value:o,onChange:p=>a(p.target.value),className:"w-full bg-slate-700 text-white p-3 rounded-lg border border-slate-600 focus:border-blue-500 focus:outline-none",children:[d.jsx("option",{value:"",children:"Select trigger type"}),h.map(p=>d.jsx("option",{value:p,children:p},p))]})]}),d.jsxs("div",{children:[d.jsx("label",{className:"block text-white text-sm font-semibold mb-2",children:"Time"}),d.jsx("input",{type:"time",value:l,onChange:p=>u(p.target.value),className:"w-full bg-slate-700 text-white p-3 rounded-lg border border-slate-600 focus:border-blue-500 focus:outline-none"})]})]}),d.jsxs("div",{className:"flex gap-3",children:[d.jsx("button",{onClick:e,className:"flex-1 bg-slate-600 hover:bg-slate-700 text-white font-bold py-3 rounded-lg transition-colors",children:"Cancel"}),d.jsx("button",{onClick:()=>{s&&o&&l&&t(s,o,l)},disabled:!s||!o||!l,className:"flex-1 bg-orange-600 hover:bg-orange-700 disabled:bg-slate-600 text-white font-bold py-3 rounded-lg transition-colors disabled:cursor-not-allowed",children:"Schedule"})]})]})}):null},y8=({isOpen:n,onClose:e,selectedDate:t,onDateSelect:r,dailyData:s})=>n?d.jsx("div",{className:"fixed inset-0 bg-black/80 backdrop-blur-sm flex items-center justify-center z-50 p-4",children:d.jsxs("div",{className:"bg-slate-800 rounded-2xl p-6 max-w-md w-full shadow-2xl border border-slate-700",children:[d.jsxs("div",{className:"text-center mb-6",children:[d.jsx("h3",{className:"text-xl font-bold text-white mb-2",children:"📅 Daily Summary"}),d.jsx("p",{className:"text-gray-300 text-sm",children:"Your activities and progress"})]}),d.jsxs("div",{className:"space-y-4 mb-6",children:[d.jsxs("div",{className:"bg-slate-700 rounded-lg p-4",children:[d.jsx("h4",{className:"text-white font-semibold mb-2",children:"💧 Water Intake"}),d.jsxs("p",{className:"text-gray-300",children:[s.water," glasses"]})]}),d.jsxs("div",{className:"bg-slate-700 rounded-lg p-4",children:[d.jsx("h4",{className:"text-white font-semibold mb-2",children:"🌤️ Mood"}),d.jsx("p",{className:"text-gray-300",children:s.mood?s.mood.name:"Not logged"})]}),d.jsxs("div",{className:"bg-slate-700 rounded-lg p-4",children:[d.jsx("h4",{className:"text-white font-semibold mb-2",children:"🫁 Breathing Exercise"}),d.jsx("p",{className:"text-gray-300",children:s.breathing?"✓ Completed":"✗ Not completed"})]}),s.relapseDate&&d.jsxs("div",{className:"bg-red-900/50 rounded-lg p-4 border border-red-500",children:[d.jsx("h4",{className:"text-red-300 font-semibold mb-2",children:"⚠️ Relapse"}),d.jsxs("p",{className:"text-red-300",children:[s.relapseDate.toLocaleDateString()," at ",s.relapseDate.toLocaleTimeString()]})]})]}),d.jsx("button",{onClick:e,className:"w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 rounded-lg transition-colors",children:"Close"})]})}):null,_8=({onResetApp:n,onBackToLogin:e,onResetForTesting:t,firestoreBuddyService:r,firestoreBuddyServiceRef:s,initializeFirestoreBuddyService:i})=>d.jsx("div",{className:"min-h-screen bg-gradient-to-br from-slate-900 via-blue-900 to-slate-900 pb-20",children:d.jsxs("div",{className:"max-w-md mx-auto px-4 pt-16",children:[d.jsxs("div",{className:"text-center mb-8",children:[d.jsx(RD,{className:"w-16 h-16 mx-auto mb-4 text-blue-400"}),d.jsx("h2",{className:"text-2xl font-bold text-white mb-2",children:"Settings"}),d.jsx("p",{className:"text-gray-300",children:"Manage your app preferences"})]}),d.jsxs("div",{className:"space-y-4",children:[d.jsxs("div",{className:"bg-slate-800/50 rounded-xl p-4",children:[d.jsx("h3",{className:"text-white font-semibold mb-2",children:"Session"}),d.jsx("p",{className:"text-gray-400 text-sm mb-4",children:"Manage your current session"}),d.jsx("button",{onClick:e,className:"w-full bg-slate-600 hover:bg-slate-500 text-white py-3 rounded-lg transition-colors mb-3",children:"← Back to Login"})]}),d.jsxs("div",{className:"bg-slate-800/50 rounded-xl p-4",children:[d.jsx("h3",{className:"text-white font-semibold mb-2",children:"App Data"}),d.jsx("p",{className:"text-gray-400 text-sm mb-4",children:"Reset your progress and start over"}),d.jsx("button",{onClick:n,className:"w-full bg-red-600 hover:bg-red-700 text-white py-3 rounded-lg transition-colors",children:"Reset App & Start Over"})]}),!1,d.jsxs("div",{className:"bg-slate-800/50 rounded-xl p-4",children:[d.jsx("h3",{className:"text-white font-semibold mb-2",children:"About"}),d.jsx("p",{className:"text-gray-400 text-sm",children:"QuitCard Arena v1.0.0"}),d.jsx("p",{className:"text-gray-400 text-sm",children:"Your journey to freedom starts here"})]})]})]})}),v8=()=>{const[n,e]=L.useState("arena"),[t,r]=L.useState("auth"),[s,i]=L.useState(null),[o,a]=L.useState(null),[l,u]=L.useState(!1),[h,f]=L.useState(null),[p,y]=L.useState(!0),[I,C]=L.useState({isLoading:!1,progress:0,currentStep:"",error:null,isComplete:!1}),[P,A]=L.useState([]);L.useState(null);const[T,R]=L.useState(null),D=L.useRef(null),[F,k]=L.useState(null),E=async()=>{try{if(!Ha){console.error("❌ Firestore instance is not available");return}const j=new wl(Ha);await j.testConnectivity()?(R(j),D.current=j,console.log("✅ FirestoreBuddyService initialized successfully")):console.warn("⚠️ Firestore connectivity test failed - service not initialized")}catch(j){console.error("❌ Error initializing FirestoreBuddyService:",j)}},_=()=>({mentalStrength:50,motivation:50,triggerDefense:30,addictionLevel:50}),b=()=>({dailyWater:0,dailyMood:null,dailyBreathing:!1,scheduledTriggers:[],relapseDate:null,cravingsResisted:0}),v=j=>{j.relapseDate&&dt(new Date(j.relapseDate)),j.dailyWater!==void 0&&xe(j.dailyWater),j.dailyMood!==void 0&&Se(j.dailyMood),j.dailyBreathing!==void 0&&we(j.dailyBreathing),j.scheduledTriggers&&Ae(j.scheduledTriggers)},S=async()=>{const j=new Date().toDateString();try{const{ref:Q,set:W}=await Re(()=>import("./index.esm-d8b59866.js"),[]),re=Q(te,`users/${h==null?void 0:h.uid}/profile/daily/${j}/breathing`);await W(re,!0)}catch(Q){console.error("Error saving breathing exercise to Firebase:",Q),localStorage.setItem(`breathing_${h==null?void 0:h.uid}_${j}`,"true")}F&&await F.handleBreathingExercise()},N=(j,Q)=>{const W=document.createElement("div");W.className="fixed top-20 right-4 z-50 p-4 rounded-lg shadow-lg bg-red-500 text-white max-w-sm",W.innerHTML=`
      <div class="font-bold">${j}</div>
      <div class="text-sm opacity-90">${Q}</div>
      <button class="mt-2 text-sm underline" onclick="this.parentElement.remove()">Dismiss</button>
    `,document.body.appendChild(W),setTimeout(()=>{W.parentNode&&W.parentNode.removeChild(W)},1e4)},w=async j=>{if(!j)return!1;C({isLoading:!0,progress:0,currentStep:"Initializing...",error:null,isComplete:!1});try{const{ref:Q,get:W,onValue:re}=await Re(()=>import("./index.esm-d8b59866.js"),[]);C(Me=>({...Me,currentStep:"Loading profile data...",progress:20}));const ge=Q(te,`users/${j}`),Ie=await W(ge);if(!Ie.exists())throw new Error("User profile not found");const Pe=Ie.val(),We=B(Pe);C(Me=>({...Me,currentStep:"Loading battle stats...",progress:40}));const $e=Q(te,`users/${j}/stats`),Ge=await W($e),lt=Ge.exists()?Ee(Ge.val()):_();C(Me=>({...Me,currentStep:"Loading habits and progress...",progress:60}));const Ct=Q(te,`users/${j}/profile`),ce=await W(Ct),me=ce.exists()?le(ce.val()):b();C(Me=>({...Me,currentStep:"Loading achievements...",progress:80}));const ze=Q(te,`users/${j}/profile/cravingsResisted`),ft=await W(ze),yn=ft.exists()?Math.max(0,parseInt(ft.val())||0):0;C(Me=>({...Me,currentStep:"Setting up live sync...",progress:90}));const _n=re($e,Me=>{if(Me.exists()){const sn=Ee(Me.val());if(ht(sn),t==="arena"&&o){const Cs={...o,stats:sn};calculateRealTimeStats(Cs).then(setRealTimeUserStats)}}}),ct=re(Ct,Me=>{if(Me.exists()){const sn=le(Me.val());t==="profile"&&v(sn)}}),et=re(ze,Me=>{if(Me.exists()){const sn=Math.max(0,parseInt(Me.val())||0);t==="craving-support"&&Ce(sn)}});return A([_n,ct,et]),C(Me=>({...Me,currentStep:"Finalizing...",progress:100})),a(Me=>({...Me,...We,stats:lt})),v(me),Ce(yn),We.onboardingCompleted&&u(!0),C({isLoading:!1,progress:100,currentStep:"Data loaded successfully!",error:null,isComplete:!0}),console.log("✅ All user data loaded successfully:",{profile:We,stats:lt,profileData:me,cravingsResisted:yn}),!0}catch(Q){return console.error("❌ Error loading user data:",Q),C({isLoading:!1,progress:0,currentStep:"Failed to load data",error:Q.message,isComplete:!1}),N("Failed to load user data",Q.message),!1}},B=j=>j?{uid:j.uid||"",email:j.email||"",heroName:j.heroName||"Hero",archetype:j.archetype||"The Determined",avatar:j.avatar||ks("default"),quitDate:j.quitDate||new Date().toISOString(),onboardingCompleted:!!j.onboardingCompleted,updatedAt:j.updatedAt||Date.now(),...j}:Be(),Ee=j=>j?{mentalStrength:Math.max(0,Math.min(100,parseInt(j.mentalStrength)||50)),motivation:Math.max(0,Math.min(100,parseInt(j.motivation)||50)),triggerDefense:Math.max(0,Math.min(100,parseInt(j.triggerDefense)||30)),addictionLevel:Math.max(0,Math.min(100,parseInt(j.addictionLevel)||50)),...j}:_(),le=j=>j?{dailyWater:Math.max(0,parseInt(j.dailyWater)||0),dailyMood:j.dailyMood||null,dailyBreathing:!!j.dailyBreathing,scheduledTriggers:Array.isArray(j.scheduledTriggers)?j.scheduledTriggers:[],relapseDate:j.relapseDate?new Date(j.relapseDate).toISOString():null,cravingsResisted:Math.max(0,parseInt(j.cravingsResisted)||0),...j}:b(),Be=()=>({uid:"",email:"",heroName:"Hero",archetype:"The Determined",avatar:ks("default"),quitDate:new Date().toISOString(),onboardingCompleted:!1,updatedAt:Date.now()});L.useEffect(()=>()=>{P.forEach(j=>{typeof j=="function"&&j()})},[P]);const[$,G]=L.useState(null);L.useEffect(()=>{(async()=>{try{const Q=(await Re(()=>import("./offlineManager-b69b33d7.js"),[])).default,W=new Q;G(W),window.refreshUserData=pe,console.log("✅ Offline manager initialized")}catch(Q){console.error("Error initializing offline manager:",Q)}})()},[]);const J=async j=>{if(!j)return!1;const Q=await w(j);if(Q&&$&&(await $.cacheUserData(o),await $.cacheProfileData({dailyWater:At,dailyMood:Ke,dailyBreathing:ie,scheduledTriggers:de,relapseDate:Te,cravingsResisted:fe})),!Q&&$){console.log("📱 Loading offline data...");const W=await $.getCachedUserData(),re=await $.getCachedProfileData();if(W)return console.log("📱 Using offline user data"),a(W),u(W.onboardingCompleted),re&&v(re),!0}return Q},he=async()=>h!=null&&h.uid?(console.log("🔄 Refreshing user data with offline support..."),await J(h.uid)):!1,pe=async()=>{if(!(h!=null&&h.uid)){N("Cannot Refresh","No authenticated user found");return}if(console.log("🔄 Manually refreshing user data..."),await he()){const Q=document.createElement("div");Q.className="fixed top-20 right-4 z-50 p-4 rounded-lg shadow-lg bg-green-500 text-white max-w-sm",Q.innerHTML=`
        <div class="font-bold">✅ Data Refreshed!</div>
        <div class="text-sm opacity-90">Your data has been synced across all devices</div>
        <button class="mt-2 text-sm underline" onclick="this.parentElement.remove()">Dismiss</button>
      `,document.body.appendChild(Q),setTimeout(()=>{Q.parentNode&&Q.parentNode.removeChild(Q)},5e3)}else N("Refresh Failed","Could not refresh data. Please try again.")},[Te,dt]=L.useState(null),[At,xe]=L.useState(0),[Ke,Se]=L.useState(null),[ie,we]=L.useState(!1),[de,Ae]=L.useState([]),[fe,Ce]=L.useState(0),[Qe,ht]=L.useState(_());L.useEffect(()=>{const j=W=>{if(W.message&&W.message.includes("content_script")){console.warn("Browser extension error (ignored):",W.message);return}if(W.message&&(W.message.includes("FrameDoesNotExistError")||W.message.includes("background.js"))){console.warn("Background frame error (ignored):",W.message);return}console.error("Global error caught:",W)},Q=W=>{if(W.reason&&W.reason.message&&W.reason.message.includes("content_script")){console.warn("Browser extension promise rejection (ignored):",W.reason.message);return}if(W.reason&&W.reason.message&&(W.reason.message.includes("FrameDoesNotExistError")||W.reason.message.includes("background.js"))){console.warn("Background frame promise rejection (ignored):",W.reason.message);return}console.error("Unhandled promise rejection:",W.reason)};return window.addEventListener("error",j),window.addEventListener("unhandledrejection",Q),()=>{window.removeEventListener("error",j),window.removeEventListener("unhandledrejection",Q)}},[]),L.useEffect(()=>{const j=async(Q=0)=>{try{const{ref:W,set:re,get:ge,child:Ie}=await Re(()=>import("./index.esm-d8b59866.js"),[]),Pe=W(te),We=Ie(Pe,"healthchecks/vite_dev");await re(We,{lastRun:Date.now()});const $e=await ge(We);console.log("🔥 Firebase RTDB connected. Healthcheck exists:",$e.exists())}catch(W){if(console.error("Firebase connectivity test failed:",(W==null?void 0:W.message)||W),Q<3){const re=Math.pow(2,Q)*1e3;console.log(`Retrying Firebase connection in ${re}ms... (attempt ${Q+1}/3)`),setTimeout(()=>j(Q+1),re)}else console.error("Firebase connection failed after 3 retries. Check your internet connection and Firebase configuration.")}};j()},[]),L.useEffect(()=>{let j=!0,Q=null;return(async()=>{try{console.log("Initializing authentication state..."),y(!0);const{onAuthStateChanged:re}=await Re(()=>import("./index.esm-89b7d354.js"),[]);Q=re(Pi,async Ie=>{if(j)if(console.log("Auth state changed:",Ie?`User: ${Ie.uid}`:"No user"),Ie){f(Ie),console.log("User authenticated, checking database for user data...");try{const{ref:Pe,get:We}=await Re(()=>import("./index.esm-d8b59866.js"),[]),$e=Pe(te,`users/${Ie.uid}`),Ge=await We($e);if(Ge.exists()){const lt=Ge.val();console.log("Existing user data found - auto-login successful"),(()=>{const ce=[];for(let me=0;me<localStorage.length;me++){const ze=localStorage.key(me);ze&&(ze.startsWith("water_")||ze.startsWith("mood_")||ze.startsWith("breathing_"))&&ce.push(ze)}ce.forEach(me=>localStorage.removeItem(me)),console.log("Cleared previous user data from localStorage")})(),a(lt),u(!0),r("arena");try{const ce=await Re(()=>Promise.resolve().then(()=>Uz),void 0),me=new ce.default(te,Ie.uid);await me.initialize(),k(me),console.log("✅ StatManager initialized successfully")}catch(ce){console.error("Error initializing StatManager:",ce)}console.log("User auto-logged in and redirected to Arena")}else console.log("No user data found - new user needs onboarding"),r("onboarding")}catch(Pe){console.error("Error fetching user data during auto-login:",Pe),r("onboarding")}}else console.log("No authenticated user - showing login screen"),f(null),a(null),u(!1),r("auth"),(()=>{const We=[];for(let $e=0;$e<localStorage.length;$e++){const Ge=localStorage.key($e);Ge&&(Ge.startsWith("water_")||Ge.startsWith("mood_")||Ge.startsWith("breathing_"))&&We.push(Ge)}We.forEach($e=>localStorage.removeItem($e)),console.log("Cleared user-specific data from localStorage")})()});const ge=setTimeout(()=>{j&&(console.warn("Auth initialization timeout - forcing to auth screen"),y(!1),r("auth"))},1e4);Q&&clearTimeout(ge)}catch(re){console.error("Error initializing authentication:",re),j&&(y(!1),r("auth"))}finally{j&&y(!1)}})(),E(),()=>{j=!1,Q&&Q()}},[]);const Ne=async j=>{console.log("Authentication successful, checking for existing user data...",{uid:j==null?void 0:j.uid,email:j==null?void 0:j.email});try{const{ref:Q,get:W}=await Re(()=>import("./index.esm-d8b59866.js"),[]);console.log("Checking database for existing user data...");const re=Q(te,`users/${j.uid}`),ge=await W(re);if(ge.exists()){const Ie=ge.val();if(console.log("Existing user data found - loading all user data..."),await J(j.uid))console.log("✅ All user data loaded successfully, going to Arena"),r("arena");else{console.log("⚠️ Data loading failed, but proceeding to Arena with basic data"),a(Ie);const We=!!Ie.onboardingCompleted;u(We),r("arena")}}else console.log("No user data found - starting onboarding"),r("onboarding")}catch(Q){console.error("Database check failed:",Q),r("onboarding")}},[_e,Oe]=L.useState(null),[at,Vn]=L.useState(!1),[ar,jr]=L.useState(null),Wn=async()=>{var j,Q,W,re,ge,Ie,Pe,We,$e,Ge;if(!(!(o!=null&&o.uid)||at)){Vn(!0),jr(null);try{if(console.log("🔄 Starting loadRealBuddy function..."),console.log("🔄 FirestoreBuddyService available:",!!T),console.log("🔄 FirestoreBuddyService type:",typeof T),!(D.current||T)){console.log("⚠️ FirestoreBuddyService not available, falling back to Realtime Database"),await Ar();return}console.log("✅ Using Firestore for buddy loading"),console.log("🔄 Firestore: Loading real buddy data...");const{collection:Ct,query:ce,where:me,getDocs:ze}=await Re(()=>import("./index.esm-cc909c8a.js"),[]),ft=Ct(Ha,"buddyPairs"),yn=ce(ft,me("user1Id","==",o.uid)),_n=await ze(yn);let ct=null,et=null;if(_n.empty){const Me=ce(ft,me("user2Id","==",o.uid)),sn=await ze(Me);if(!sn.empty){const Cs=sn.docs[0];ct={id:Cs.id,...Cs.data()},et=ct.user1Id}}else{const Me=_n.docs[0];ct={id:Me.id,...Me.data()},et=ct.user2Id}if(ct&&et){console.log("✅ Firestore: Found buddy pair:",ct.id);const{ref:Me,get:sn}=await Re(()=>import("./index.esm-d8b59866.js"),[]),Cs=Me(te,`users/${et}`),Pa=await sn(Cs);if(!Pa.exists()){console.log("⚠️ Firestore: Cleaning up orphaned buddy pair:",ct.id);const{deleteDoc:uh,doc:dh}=await Re(()=>import("./index.esm-cc909c8a.js"),[]);await uh(dh(Ha,"buddyPairs",ct.id)),Oe(null);return}const qt=Pa.val(),Fn={heroName:qt.heroName||"Buddy",stats:{streakDays:((j=qt.stats)==null?void 0:j.streakDays)||0,addictionLevel:((Q=qt.stats)==null?void 0:Q.addictionLevel)||50,willpower:((W=qt.stats)==null?void 0:W.mentalStrength)||50,motivation:((re=qt.stats)==null?void 0:re.mentalStrength)||50,cravingResistance:((ge=qt.stats)==null?void 0:ge.mentalStrength)||50,triggerDefense:((Ie=qt.stats)==null?void 0:Ie.triggerDefense)||30,experiencePoints:((Pe=qt.stats)==null?void 0:Pe.experiencePoints)||0},achievements:qt.achievements||[],archetype:qt.archetype||"The Determined",avatar:qt.avatar||ks(qt.heroName||"buddy","adventurer"),uid:et,userId:et,isRealBuddy:!0,pairId:ct.id,triggers:qt.triggers||[],dailyPatterns:qt.dailyPatterns||[],copingStrategies:qt.copingStrategies||[],specialFeatures:qt.specialFeatures||null};Oe(Fn),console.log("✅ Firestore: Buddy data loaded successfully"),console.log("🔍 Firestore: Buddy Special Features data:",{hasSpecialFeatures:!!Fn.specialFeatures,hasTriggers:!!((We=Fn.triggers)!=null&&We.length),hasDailyPatterns:!!(($e=Fn.dailyPatterns)!=null&&$e.length),hasCopingStrategies:!!((Ge=Fn.copingStrategies)!=null&&Ge.length),uid:Fn.uid}),await is(o.uid,et)}else console.log("ℹ️ Firestore: No buddy pair found for user"),Oe(null)}catch(lt){console.error("❌ Firestore: Error loading buddy:",lt),console.log("🔄 Falling back to Realtime Database buddy loading..."),await Ar()}finally{Vn(!1)}}},Ar=async()=>{var j,Q,W,re,ge,Ie,Pe,We,$e,Ge;try{console.log("🔄 Realtime Database: Loading buddy data...");const{ref:lt,get:Ct}=await Re(()=>import("./index.esm-d8b59866.js"),[]),ce=lt(te,"buddyPairs"),me=await Ct(ce);if(!me.exists()){Oe(null);return}const ze=me.val();let ft=null,yn=null;for(const[_n,ct]of Object.entries(ze))if(ct.users&&Array.isArray(ct.users)&&ct.users.includes(o.uid)){ft={...ct,pairId:_n},yn=ct.users.find(et=>et!==o.uid);break}if(ft&&yn){const _n=lt(te,`users/${yn}`),ct=await Ct(_n);if(!ct.exists()){const{remove:sn}=await Re(()=>import("./index.esm-d8b59866.js"),[]);await sn(lt(te,`buddyPairs/${ft.pairId}`)),Oe(null);return}const et=ct.val(),Me={heroName:et.heroName||"Buddy",stats:{streakDays:((j=et.stats)==null?void 0:j.streakDays)||0,addictionLevel:((Q=et.stats)==null?void 0:Q.addictionLevel)||50,willpower:((W=et.stats)==null?void 0:W.mentalStrength)||50,motivation:((re=et.stats)==null?void 0:re.mentalStrength)||50,cravingResistance:((ge=et.stats)==null?void 0:ge.mentalStrength)||50,triggerDefense:((Ie=et.stats)==null?void 0:Ie.triggerDefense)||30,experiencePoints:((Pe=et.stats)==null?void 0:Pe.experiencePoints)||0},achievements:et.achievements||[],archetype:et.archetype||"The Determined",avatar:et.avatar||ks(et.heroName||"buddy","adventurer"),uid:yn,userId:yn,isRealBuddy:!0,pairId:ft.pairId,triggers:et.triggers||[],dailyPatterns:et.dailyPatterns||[],copingStrategies:et.copingStrategies||[],specialFeatures:et.specialFeatures||null};Oe(Me),console.log("🔍 RealtimeDB: Buddy Special Features data:",{hasSpecialFeatures:!!Me.specialFeatures,hasTriggers:!!((We=Me.triggers)!=null&&We.length),hasDailyPatterns:!!(($e=Me.dailyPatterns)!=null&&$e.length),hasCopingStrategies:!!((Ge=Me.copingStrategies)!=null&&Ge.length),uid:Me.uid}),await is(o.uid,yn)}else Oe(null)}catch(lt){console.error("Error loading buddy from Realtime Database:",lt),jr("Failed to load buddy data"),Oe(null)}},is=async(j,Q)=>{try{const W=D.current||T;if(W&&(_e!=null&&_e.pairId)){console.log("🔄 Firestore: Removing users from matching pool"),await W.removeFromMatchingPool(j),await W.removeFromMatchingPool(Q);const{doc:re,updateDoc:ge}=await Re(()=>import("./index.esm-cc909c8a.js"),[]),Ie=re(Ha,"buddyPairs",_e.pairId);await ge(Ie,{user1RemovedFromPool:!0,user2RemovedFromPool:!0}),console.log("✅ Firestore: Users removed from matching pool and pair updated")}else{console.log("🔄 Realtime Database: Removing users from matching pool");const{ref:re,remove:ge,set:Ie}=await Re(()=>import("./index.esm-d8b59866.js"),[]);await ge(re(te,`matchingPool/${j}`)),await ge(re(te,`matchingPool/${Q}`)),_e!=null&&_e.pairId&&(await Ie(re(te,`buddyPairs/${_e.pairId}/user1RemovedFromPool`),!0),await Ie(re(te,`buddyPairs/${_e.pairId}/user2RemovedFromPool`),!0)),console.log("✅ Realtime Database: Users removed from matching pool and pair updated")}}catch(W){console.error("❌ Error removing users from matching pool:",W)}};L.useEffect(()=>{o!=null&&o.uid&&!_e&&!at&&Wn()},[o==null?void 0:o.uid,_e,at]),L.useEffect(()=>{T&&console.log("✅ FirestoreBuddyService is now available")},[T]);const Je=async()=>{try{const j=D.current||T;if(!j){console.log("⚠️ FirestoreBuddyService not available, falling back to Realtime Database"),await Xt();return}console.log("✅ Using Firestore for auto-matching"),console.log("🔄 Firestore: Starting NEW CHAIN PAIRING algorithm...");const Q=await j.getAllMatchingPoolUsers();if(Q.length<2){console.log("ℹ️ Firestore: Not enough users in matching pool for pairing (need 2, have",Q.length,")");return}console.log(`🔄 Firestore: Found ${Q.length} users in matching pool`);const W=[];for(const re of Q)try{const{ref:ge,get:Ie}=await Re(()=>import("./index.esm-d8b59866.js"),[]),Pe=ge(te,`users/${re.userId}`);(await Ie(Pe)).exists()?W.push(re):(console.log(`⚠️ Firestore: Removing invalid user from matching pool: ${re.userId}`),await j.removeFromMatchingPool(re.userId))}catch(ge){console.error("❌ Firestore: Error validating user:",ge)}if(W.length<2){console.log("ℹ️ Firestore: Not enough valid users for pairing after validation");return}if(W.sort((re,ge)=>{const Ie=re.joinedAt?new Date(re.joinedAt).getTime():0,Pe=ge.joinedAt?new Date(ge.joinedAt).getTime():0;return Ie-Pe}),console.log("🔄 Firestore: Sorted users by join time (oldest first):",W.map(re=>({userId:re.userId,joinedAt:re.joinedAt}))),W.length>=2){const re=W[0],ge=W[W.length-1];if(re.userId!==ge.userId)try{console.log(`🔄 Firestore: CHAIN PAIRING: ${ge.userId} (arriving) pairs with ${re.userId} (waiting)`);const Ie={matchedAt:new Date().toISOString(),compatibilityScore:.85,matchReasons:["Chain pairing algorithm","Arriving user paired with waiting user"],status:"active",lastMessageAt:new Date().toISOString(),user1RemovedFromPool:!1,user2RemovedFromPool:!1},Pe=await j.createBuddyPair(ge.userId,re.userId,Ie);if(Pe){const{ref:We,set:$e}=await Re(()=>import("./index.esm-d8b59866.js"),[]);if(await $e(We(te,`users/${re.userId}/buddyInfo`),{hasBuddy:!0,buddyId:ge.userId,pairId:Pe,matchedAt:Ie.matchedAt}),await $e(We(te,`users/${ge.userId}/buddyInfo`),{hasBuddy:!0,buddyId:re.userId,pairId:Pe,matchedAt:Ie.matchedAt}),await j.removeFromMatchingPool(re.userId),console.log(`✅ Firestore: CHAIN PAIRING: Created buddy pair ${Pe}`),console.log(`✅ Firestore: CHAIN PAIRING: Removed ${re.userId} (waiting) from matching pool`),console.log(`✅ Firestore: CHAIN PAIRING: Kept ${ge.userId} (arriving) in matching pool for next pairing`),o!=null&&o.uid&&[ge.userId,re.userId].includes(o.uid))try{await Wn()}catch(lt){console.error("Error reloading buddy data:",lt)}}else console.error(`❌ Firestore: Failed to create buddy pair between ${ge.userId} and ${re.userId}`)}catch(Ie){console.error(`❌ Firestore: Failed to create buddy pair between ${ge.userId} and ${re.userId}:`,Ie)}else console.log("ℹ️ Firestore: Same user in pool, cannot pair")}else console.log("ℹ️ Firestore: Not enough users in pool for pairing (need 2, have",W.length,")")}catch(j){console.error("❌ Firestore: Auto-matching failed:",j),console.log("🔄 Falling back to Realtime Database auto-matching..."),await Xt()}},Xt=async()=>{var j;try{console.log("🔄 Realtime Database: Starting fallback auto-matching...");const{ref:Q,get:W,set:re,push:ge,remove:Ie}=await Re(()=>import("./index.esm-d8b59866.js"),[]),Pe=Q(te,"matchingPool"),We=await W(Pe);if(!We.exists()){console.log("ℹ️ Realtime Database: No users in matching pool");return}const $e=We.val(),Ge=[];if(Object.entries($e).forEach(([ce,me])=>{typeof me=="string"?Ge.push(me):me&&typeof me=="object"?me.uid?Ge.push(me.uid):me.userId?Ge.push(me.userId):Ge.push(ce):Ge.push(ce)}),console.log(`🔄 Realtime Database: Found ${Ge.length} users in matching pool`),Ge.length<2){console.log("ℹ️ Realtime Database: Not enough users for pairing (need 2, have",Ge.length,")");return}const lt=[];for(const ce of Ge)try{const me=Q(te,`users/${ce}`);(await W(me)).exists()?lt.push(ce):(console.log(`⚠️ Realtime Database: Removing invalid user from matching pool: ${ce}`),await Ie(Q(te,`matchingPool/${ce}`)))}catch(me){console.error("❌ Realtime Database: Error validating user:",me)}if(lt.length<2){console.log("ℹ️ Realtime Database: Not enough valid users for pairing after validation");return}console.log(`🔄 Realtime Database: Valid users for pairing: ${lt.join(", ")}`);const Ct=[];for(const ce of lt)try{const me=Q(te,`users/${ce}`),ze=await W(me);if(ze.exists()){const ft=ze.val();Ct.push({userId:ce,joinedAt:ft.joinedAt||((j=ft.matchingPoolData)==null?void 0:j.joinedAt)||new Date().toISOString()})}}catch(me){console.error("Error getting user data for timestamp:",me)}if(Ct.sort((ce,me)=>{const ze=ce.joinedAt?new Date(ce.joinedAt).getTime():0,ft=me.joinedAt?new Date(me.joinedAt).getTime():0;return ze-ft}),console.log("🔄 Realtime Database: Sorted users by join time (oldest first):",Ct.map(ce=>({userId:ce.userId,joinedAt:ce.joinedAt}))),Ct.length>=2){const ce=Ct[0],me=Ct[Ct.length-1];if(ce&&me&&ce.userId!==me.userId){console.log(`🔄 Realtime Database: CHAIN PAIRING: ${me.userId} (arriving) pairs with ${ce.userId} (waiting)`);try{const ze=ge(Q(te,"buddyPairs")).key,ft={pairId:ze,users:[me.userId,ce.userId],matchedAt:new Date().toISOString(),compatibilityScore:.85,matchReasons:["Chain pairing algorithm","Arriving user paired with waiting user"],status:"active",lastMessageAt:new Date().toISOString(),user1RemovedFromPool:!1,user2RemovedFromPool:!1};await re(Q(te,`buddyPairs/${ze}`),ft),await re(Q(te,`users/${ce.userId}/buddyInfo`),{hasBuddy:!0,buddyId:me.userId,pairId:ze,matchedAt:ft.matchedAt}),await re(Q(te,`users/${me.userId}/buddyInfo`),{hasBuddy:!0,buddyId:ce.userId,pairId:ze,matchedAt:ft.matchedAt}),Object.keys($e).forEach(async yn=>{const _n=$e[yn];((_n==null?void 0:_n.uid)||(_n==null?void 0:_n.userId)||yn)===ce.userId&&(await Ie(Q(te,`matchingPool/${yn}`)),console.log(`✅ Realtime Database: Removed ${ce.userId} (waiting) from matching pool`))}),await re(Q(te,`buddyPairs/${ze}/user1RemovedFromPool`),!0),await re(Q(te,`buddyPairs/${ze}/user2RemovedFromPool`),!1),console.log(`✅ Realtime Database: CHAIN PAIRING: Created buddy pair ${ze}`),console.log(`✅ Realtime Database: CHAIN PAIRING: Kept ${me.userId} (arriving) in matching pool for next pairing`)}catch(ze){console.error("Error creating buddy pair:",ze)}}else console.log("ℹ️ Realtime Database: Same user in pool, cannot pair")}else console.log("ℹ️ Realtime Database: Not enough users in pool for pairing (need 2, have",Ct.length,")");if(o!=null&&o.uid&&Ct.length>=2){const ce=Ct[0],me=Ct[Ct.length-1];if([me==null?void 0:me.userId,ce==null?void 0:ce.userId].includes(o.uid))try{await Wn()}catch(ft){console.error("Error reloading buddy data:",ft)}}}catch(Q){console.error("Error in Realtime Database auto-matching:",Q)}},Sn={heroName:"",stats:null,achievements:[],archetype:"",avatar:null,isEmpty:!0,message:"We are looking for a suitable buddy for you"},lr=()=>at?{heroName:"Loading Buddy...",stats:{streakDays:0,addictionLevel:50,willpower:50,motivation:50,cravingResistance:50,triggerDefense:30,experiencePoints:0},achievements:[],archetype:"DETERMINED",avatar:ks("loading","adventurer"),isLoading:!0}:ar?{heroName:"Error Loading Buddy",stats:{streakDays:0,addictionLevel:50,willpower:50,motivation:50,cravingResistance:50,triggerDefense:30,experiencePoints:0},achievements:[],archetype:"DETERMINED",avatar:ks("error","adventurer"),isError:!0,errorMessage:ar}:_e||Sn,Ur=async j=>{console.log("Onboarding completed with user data:",j);try{if(!j||!j.heroName||!j.stats)throw new Error("Invalid user data received from onboarding");if(!h)throw new Error("No authenticated user found");const Q=new Date,W={...j,uid:h.uid,email:h.email,displayName:h.displayName||j.heroName,photoURL:h.photoURL,onboardingCompleted:!0,createdAt:Q.toISOString(),updatedAt:Q.getTime(),lastActivity:Q.toISOString(),daily:{[Q.toDateString()]:{logged:!0,onboarding:!0}}};console.log("Saving user data to Firebase:",W);const{ref:re,set:ge}=await Re(()=>import("./index.esm-d8b59866.js"),[]),Ie=re(te,`users/${h.uid}`);await ge(Ie,W),console.log("Firebase save successful, updating app state..."),a(W),u(!0);try{const We=D.current||T;if(We){console.log("✅ Using Firestore for matching pool");const $e={quitStartDate:W.quitDate||new Date().toISOString(),addictionLevel:W.stats.addictionLevel||50,triggers:W.triggers||[],timezone:Intl.DateTimeFormat().resolvedOptions().timeZone,quitExperience:W.quitAttempts||"first",availableForMatching:!0,lastActive:new Date,userId:h.uid,heroName:W.heroName,archetype:W.archetype,joinedAt:new Date().toISOString()};if(await We.addToMatchingPool(h.uid,$e))console.log("✅ User successfully added to Firestore matching pool");else throw new Error("Failed to add user to Firestore matching pool")}else{console.log("⚠️ FirestoreBuddyService not available, falling back to Realtime Database");const{ref:$e,set:Ge}=await Re(()=>import("./index.esm-d8b59866.js"),[]),lt={quitStartDate:W.quitDate||new Date().toISOString(),addictionLevel:W.stats.addictionLevel||50,triggers:W.triggers||[],timezone:Intl.DateTimeFormat().resolvedOptions().timeZone,quitExperience:W.quitAttempts||"first",availableForMatching:!0,lastActive:Date.now(),userId:h.uid,heroName:W.heroName,archetype:W.archetype,joinedAt:new Date().toISOString()};await Ge($e(te,`matchingPool/${h.uid}`),lt),console.log("✅ User added to Realtime Database matching pool (fallback)")}try{await Je()}catch($e){console.error("Automatic matching failed:",$e)}}catch(We){console.error("⚠️ Failed to add user to buddy matching pool:",We)}const Pe=await J(h.uid);r("arena")}catch(Q){console.error("Error in handleOnboardingComplete:",Q);const W=new Date,re={heroName:(j==null?void 0:j.heroName)||"Hero",archetype:(j==null?void 0:j.archetype)||"The Determined",avatar:(j==null?void 0:j.avatar)||ks("fallback"),stats:{addictionLevel:50,mentalStrength:50,motivation:50,triggerDefense:30,streakDays:0,experiencePoints:0},achievements:[],quitDate:W,createdAt:W.toISOString(),lastActivity:W.toISOString(),uid:h==null?void 0:h.uid,email:h==null?void 0:h.email,onboardingCompleted:!0};if(h)try{const{ref:ge,set:Ie}=await Re(()=>import("./index.esm-d8b59866.js"),[]),Pe=ge(te,`users/${h.uid}`);await Ie(Pe,re)}catch(ge){console.error("Failed to save fallback data to Firebase:",ge)}a(re),u(!0),r("arena")}},_o=()=>{a(null),u(!1),r("onboarding"),e("arena"),i(null),localStorage.removeItem("quitCoachUser")},Gn=async()=>{try{console.log("Logging out user...");const{signOut:j}=await Re(()=>import("./index.esm-89b7d354.js"),[]);await j(Pi),a(null),f(null),u(!1),r("auth"),localStorage.removeItem("cravingWins"),localStorage.removeItem("specialFeatures"),console.log("User successfully logged out and redirected to login screen")}catch(j){console.error("Error during logout:",j),a(null),f(null),u(!1),r("auth")}},As=async()=>{if(!h){console.error("No authenticated user to reset");return}try{console.log("Resetting ALL user data for testing...");const{ref:j,set:Q,remove:W}=await Re(()=>import("./index.esm-d8b59866.js"),[]),re=j(te,`users/${h.uid}`);await Q(re,null);const ge=j(te,"users");await Q(ge,null);const Ie=j(te,"buddyPairs");await Q(Ie,null);const Pe=j(te,"matchingPool");await Q(Pe,null),console.log("All user data and buddy matching data cleared from database"),a(null),u(!1),r("onboarding"),Oe(null),Vn(!1),jr(null),console.log("Account reset successful - ready for fresh onboarding")}catch(j){console.error("Error resetting account for testing:",j)}},ch=j=>{console.log("Tab changed to:",j),e(j),r(j)},wc=j=>{r(j==="mood-selector"?"mood-selector":"profile")},fg=j=>{i(j),r("profile")},pg=()=>{r("profile")};return p?d.jsx("div",{className:"min-h-screen bg-gradient-to-br from-slate-900 via-blue-900 to-slate-900 flex items-center justify-center",children:d.jsxs("div",{className:"text-center text-white",children:[d.jsx("div",{className:"animate-spin rounded-full h-16 w-16 border-b-2 border-white mx-auto mb-6"}),d.jsx("h2",{className:"text-3xl font-bold mb-4",children:"🔐 Restoring Session..."}),d.jsx("p",{className:"text-xl text-gray-300 mb-4",children:"Checking authentication state"}),d.jsx("div",{className:"bg-slate-800/50 rounded-lg p-4 max-w-md mx-auto",children:d.jsxs("div",{className:"text-sm text-gray-400 space-y-2",children:[d.jsxs("div",{className:"flex items-center gap-2",children:[d.jsx("span",{className:"text-blue-400",children:"✓"}),"Checking Firebase Auth persistence"]}),d.jsxs("div",{className:"flex items-center gap-2",children:[d.jsx("span",{className:"text-blue-400",children:"✓"}),"Verifying user session (30 days)"]}),d.jsxs("div",{className:"flex items-center gap-2",children:[d.jsx("span",{className:"text-blue-400",children:"✓"}),"Loading user data from database"]})]})}),d.jsx("p",{className:"text-gray-400 text-sm mt-4",children:"This should take only a few seconds"})]})}):t==="auth"?d.jsx(Bz,{onAuthSuccess:Ne}):I.isLoading?d.jsx("div",{className:"min-h-screen bg-gradient-to-br from-slate-900 via-blue-900 to-slate-900 flex items-center justify-center",children:d.jsxs("div",{className:"text-center text-white",children:[d.jsx("div",{className:"animate-spin rounded-full h-16 w-16 border-b-2 border-white mx-auto mb-6"}),d.jsx("h2",{className:"text-3xl font-bold mb-4",children:"📊 Loading Your Data..."}),d.jsx("p",{className:"text-xl text-gray-300 mb-4",children:I.currentStep}),d.jsxs("div",{className:"bg-slate-800/50 rounded-lg p-4 max-w-md mx-auto mb-6",children:[d.jsx("div",{className:"w-full bg-slate-700 rounded-full h-3 mb-3",children:d.jsx("div",{className:"bg-blue-500 h-3 rounded-full transition-all duration-500 ease-out",style:{width:`${I.progress}%`}})}),d.jsxs("div",{className:"text-sm text-gray-400",children:[I.progress,"% Complete"]})]}),d.jsx("div",{className:"bg-slate-800/50 rounded-lg p-4 max-w-md mx-auto",children:d.jsxs("div",{className:"text-sm text-gray-400 space-y-2",children:[d.jsxs("div",{className:"flex items-center gap-2",children:[d.jsx("span",{className:"text-blue-400",children:"✓"}),"Profile and onboarding data"]}),d.jsxs("div",{className:"flex items-center gap-2",children:[d.jsx("span",{className:"text-blue-400",children:"✓"}),"Battle stats and progress"]}),d.jsxs("div",{className:"flex items-center gap-2",children:[d.jsx("span",{className:"text-blue-400",children:"✓"}),"Habits and achievements"]}),d.jsxs("div",{className:"flex items-center gap-2",children:[d.jsx("span",{className:"text-blue-400",children:"✓"}),"Setting up live sync"]})]})}),I.error&&d.jsxs("div",{className:"mt-4 p-3 bg-red-600/20 border border-red-500/30 rounded-lg max-w-md mx-auto",children:[d.jsxs("p",{className:"text-red-300 text-sm",children:[d.jsx("span",{className:"font-semibold",children:"Error:"})," ",I.error]}),d.jsx("p",{className:"text-red-400 text-xs mt-1",children:"Don't worry, you can still use the app with basic functionality"})]}),d.jsx("p",{className:"text-gray-400 text-sm mt-4",children:"Syncing your data across all devices..."})]})}):d.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-slate-900 via-blue-900 to-slate-900",children:[d.jsx($z,{}),t==="onboarding"&&d.jsx("div",{children:d.jsx(n8,{onComplete:Ur,authUser:h})}),l&&o?d.jsxs(d.Fragment,{children:[t==="arena"&&d.jsx("div",{children:(()=>{try{const j=lr();return d.jsx(a8,{user:o,nemesis:j,onBackToLogin:Gn,onResetForTesting:As,buddyLoading:at,buddyError:ar,realBuddy:_e})}catch(j){return console.error("Error rendering ArenaView:",j),d.jsxs("div",{className:"text-white text-center p-8",children:[d.jsx("h2",{className:"text-2xl font-bold mb-4",children:"Error Loading Arena"}),d.jsx("p",{className:"text-gray-300 mb-4",children:j.message}),d.jsx("button",{onClick:()=>window.location.reload(),className:"bg-blue-600 px-4 py-2 rounded hover:bg-blue-700",children:"Reload App"})]})}})()}),t==="craving-support"&&d.jsx("div",{children:d.jsx(u8,{user:o,nemesis:lr(),onBackToLogin:Gn,onResetForTesting:As,onBreathingComplete:S})}),t==="profile"&&d.jsx("div",{children:d.jsx(f8,{user:o,onNavigate:wc})}),t==="mood-selector"&&d.jsx(MoodSelector,{onMoodSelect:fg,onBack:pg}),t==="settings"&&d.jsx(_8,{onResetApp:_o,onBackToLogin:Gn,onResetForTesting:As,firestoreBuddyService:T,firestoreBuddyServiceRef:D,initializeFirestoreBuddyService:E}),d.jsx(o8,{activeTab:n,onTabChange:ch,dataLoadingState:I,onRefreshData:pe,offlineManager:$})]}):d.jsx("div",{className:"flex items-center justify-center min-h-screen text-white",children:d.jsxs("div",{className:"text-center",children:[d.jsx("h2",{className:"text-2xl font-bold mb-4",children:"Loading..."}),d.jsx("p",{className:"text-gray-300",children:l?"User data missing":"Onboarding not completed"}),d.jsxs("p",{className:"text-gray-300",children:["Current view: ",t]}),d.jsxs("p",{className:"text-gray-300",children:["User data: ",o?JSON.stringify(o,null,2):"None"]}),d.jsx("button",{onClick:()=>{console.log("Debug button clicked"),console.log("Current state:",{hasCompletedOnboarding:l,user:o,currentView:t}),console.log("User data:",o)},className:"mt-4 px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700",children:"Debug State"})]})})]})};Ny.createRoot(document.getElementById("root")).render(d.jsx(m2.StrictMode,{children:d.jsx(v8,{})}));export{b8 as $,C8 as A,R8 as B,N8 as C,na as D,E8 as E,a4 as F,B8 as G,$8 as H,z8 as I,q8 as J,o4 as K,G8 as L,tt as M,I8 as N,i4 as O,x8 as P,ss as Q,rs as R,e7 as S,A4 as T,X8 as U,Hn as V,T8 as W,S8 as X,F8 as Y,V8 as Z,r7 as _,E4 as a,kB as a$,_q as a0,oh as a1,ih as a2,wq as a3,Ed as a4,Ra as a5,Ii as a6,pq as a7,Ei as a8,Os as a9,Vq as aA,y9 as aB,Iq as aC,DU as aD,Gq as aE,iW as aF,JS as aG,d$ as aH,iB as aI,Fq as aJ,Nq as aK,RB as aL,Jq as aM,tW as aN,sW as aO,Hq as aP,Uq as aQ,WB as aR,Eq as aS,IU as aT,NB as aU,Xq as aV,eW as aW,rW as aX,LU as aY,qq as aZ,VB as a_,Zs as aa,Nf as ab,yq as ac,Go as ad,vl as ae,c9 as af,mq as ag,Qq as ah,wv as ai,gq as aj,u9 as ak,NI as al,xi as am,Aq as an,GB as ao,Kq as ap,qk as aq,l9 as ar,Hk as as,DB as at,bq as au,aB as av,OB as aw,vq as ax,Wq as ay,kq as az,br as b,c7 as b$,Rq as b0,qB as b1,xq as b2,vI as b3,Sq as b4,MB as b5,Pq as b6,Yq as b7,T$ as b8,nW as b9,gn as bA,yc as bB,eh as bC,Af as bD,Zm as bE,th as bF,Jm as bG,lI as bH,_r as bI,Xm as bJ,Ri as bK,rt as bL,_U as bM,Xr as bN,gU as bO,ow as bP,$t as bQ,ra as bR,X as bS,a7 as bT,C4 as bU,Dt as bV,fq as bW,je as bX,o7 as bY,hq as bZ,dq as b_,zq as ba,Tq as bb,$q as bc,Mq as bd,Lq as be,Zq as bf,Oq as bg,Bq as bh,jq as bi,Dq as bj,Cq as bk,ck as bl,yd as bm,Y5 as bn,pr as bo,h7 as bp,Is as bq,ut as br,yr as bs,Sa as bt,ba as bu,gt as bv,z as bw,Es as bx,H5 as by,vU as bz,O0 as c,BS as c$,Vr as c0,F4 as c1,oU as c2,M7 as c3,L7 as c4,S7 as c5,nq as c6,tq as c7,O7 as c8,g7 as c9,$7 as cA,z7 as cB,K5 as cC,aq as cD,rq as cE,f7 as cF,A7 as cG,C7 as cH,FS as cI,K7 as cJ,Y7 as cK,Q7 as cL,Q5 as cM,zS as cN,W7 as cO,G7 as cP,T7 as cQ,b7 as cR,J7 as cS,X7 as cT,pU as cU,E7 as cV,QP as cW,F7 as cX,d7 as cY,Z7 as cZ,Yh as c_,vy as ca,u7 as cb,G5 as cc,nU as cd,uq as ce,$S as cf,eq as cg,v7 as ch,cq as ci,su as cj,I7 as ck,V7 as cl,p7 as cm,m7 as cn,_7 as co,lq as cp,k7 as cq,P7 as cr,jt as cs,nh as ct,aU as cu,H7 as cv,sU as cw,U7 as cx,B7 as cy,iU as cz,hs as d,oq as d0,i7 as d1,j7 as d2,N7 as d3,R7 as d4,D7 as d5,w7 as d6,q7 as d7,sq as d8,y7 as d9,x7 as da,iq as db,Re as dc,Dl as e,n7 as f,T4 as g,t7 as h,J8 as i,O8 as j,M8 as k,W8 as l,K8 as m,H8 as n,on as o,x4 as p,Q8 as q,TR as r,lC as s,Y8 as t,Z8 as u,Z0 as v,j8 as w,U8 as x,P8 as y,A8 as z};
