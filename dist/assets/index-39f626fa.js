(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))r(s);new MutationObserver(s=>{for(const i of s)if(i.type==="childList")for(const o of i.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&r(o)}).observe(document,{childList:!0,subtree:!0});function t(s){const i={};return s.integrity&&(i.integrity=s.integrity),s.referrerPolicy&&(i.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?i.credentials="include":s.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function r(s){if(s.ep)return;s.ep=!0;const i=t(s);fetch(s.href,i)}})();function o2(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}var Pb={exports:{}},hp={},Db={exports:{}},tt={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Xd=Symbol.for("react.element"),a2=Symbol.for("react.portal"),l2=Symbol.for("react.fragment"),c2=Symbol.for("react.strict_mode"),u2=Symbol.for("react.profiler"),d2=Symbol.for("react.provider"),h2=Symbol.for("react.context"),f2=Symbol.for("react.forward_ref"),g2=Symbol.for("react.suspense"),p2=Symbol.for("react.memo"),m2=Symbol.for("react.lazy"),bI=Symbol.iterator;function y2(n){return n===null||typeof n!="object"?null:(n=bI&&n[bI]||n["@@iterator"],typeof n=="function"?n:null)}var Mb={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},Lb=Object.assign,Ob={};function Cc(n,e,t){this.props=n,this.context=e,this.refs=Ob,this.updater=t||Mb}Cc.prototype.isReactComponent={};Cc.prototype.setState=function(n,e){if(typeof n!="object"&&typeof n!="function"&&n!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,n,e,"setState")};Cc.prototype.forceUpdate=function(n){this.updater.enqueueForceUpdate(this,n,"forceUpdate")};function Vb(){}Vb.prototype=Cc.prototype;function Vv(n,e,t){this.props=n,this.context=e,this.refs=Ob,this.updater=t||Mb}var Fv=Vv.prototype=new Vb;Fv.constructor=Vv;Lb(Fv,Cc.prototype);Fv.isPureReactComponent=!0;var AI=Array.isArray,Fb=Object.prototype.hasOwnProperty,jv={current:null},jb={key:!0,ref:!0,__self:!0,__source:!0};function Ub(n,e,t){var r,s={},i=null,o=null;if(e!=null)for(r in e.ref!==void 0&&(o=e.ref),e.key!==void 0&&(i=""+e.key),e)Fb.call(e,r)&&!jb.hasOwnProperty(r)&&(s[r]=e[r]);var a=arguments.length-2;if(a===1)s.children=t;else if(1<a){for(var l=Array(a),u=0;u<a;u++)l[u]=arguments[u+2];s.children=l}if(n&&n.defaultProps)for(r in a=n.defaultProps,a)s[r]===void 0&&(s[r]=a[r]);return{$$typeof:Xd,type:n,key:i,ref:o,props:s,_owner:jv.current}}function _2(n,e){return{$$typeof:Xd,type:n.type,key:e,ref:n.ref,props:n.props,_owner:n._owner}}function Uv(n){return typeof n=="object"&&n!==null&&n.$$typeof===Xd}function v2(n){var e={"=":"=0",":":"=2"};return"$"+n.replace(/[=:]/g,function(t){return e[t]})}var CI=/\/+/g;function $m(n,e){return typeof n=="object"&&n!==null&&n.key!=null?v2(""+n.key):e.toString(36)}function bf(n,e,t,r,s){var i=typeof n;(i==="undefined"||i==="boolean")&&(n=null);var o=!1;if(n===null)o=!0;else switch(i){case"string":case"number":o=!0;break;case"object":switch(n.$$typeof){case Xd:case a2:o=!0}}if(o)return o=n,s=s(o),n=r===""?"."+$m(o,0):r,AI(s)?(t="",n!=null&&(t=n.replace(CI,"$&/")+"/"),bf(s,e,t,"",function(u){return u})):s!=null&&(Uv(s)&&(s=_2(s,t+(!s.key||o&&o.key===s.key?"":(""+s.key).replace(CI,"$&/")+"/")+n)),e.push(s)),1;if(o=0,r=r===""?".":r+":",AI(n))for(var a=0;a<n.length;a++){i=n[a];var l=r+$m(i,a);o+=bf(i,e,t,l,s)}else if(l=y2(n),typeof l=="function")for(n=l.call(n),a=0;!(i=n.next()).done;)i=i.value,l=r+$m(i,a++),o+=bf(i,e,t,l,s);else if(i==="object")throw e=String(n),Error("Objects are not valid as a React child (found: "+(e==="[object Object]"?"object with keys {"+Object.keys(n).join(", ")+"}":e)+"). If you meant to render a collection of children, use an array instead.");return o}function Gh(n,e,t){if(n==null)return n;var r=[],s=0;return bf(n,r,"","",function(i){return e.call(t,i,s++)}),r}function w2(n){if(n._status===-1){var e=n._result;e=e(),e.then(function(t){(n._status===0||n._status===-1)&&(n._status=1,n._result=t)},function(t){(n._status===0||n._status===-1)&&(n._status=2,n._result=t)}),n._status===-1&&(n._status=0,n._result=e)}if(n._status===1)return n._result.default;throw n._result}var cr={current:null},Af={transition:null},x2={ReactCurrentDispatcher:cr,ReactCurrentBatchConfig:Af,ReactCurrentOwner:jv};function $b(){throw Error("act(...) is not supported in production builds of React.")}tt.Children={map:Gh,forEach:function(n,e,t){Gh(n,function(){e.apply(this,arguments)},t)},count:function(n){var e=0;return Gh(n,function(){e++}),e},toArray:function(n){return Gh(n,function(e){return e})||[]},only:function(n){if(!Uv(n))throw Error("React.Children.only expected to receive a single React element child.");return n}};tt.Component=Cc;tt.Fragment=l2;tt.Profiler=u2;tt.PureComponent=Vv;tt.StrictMode=c2;tt.Suspense=g2;tt.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=x2;tt.act=$b;tt.cloneElement=function(n,e,t){if(n==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+n+".");var r=Lb({},n.props),s=n.key,i=n.ref,o=n._owner;if(e!=null){if(e.ref!==void 0&&(i=e.ref,o=jv.current),e.key!==void 0&&(s=""+e.key),n.type&&n.type.defaultProps)var a=n.type.defaultProps;for(l in e)Fb.call(e,l)&&!jb.hasOwnProperty(l)&&(r[l]=e[l]===void 0&&a!==void 0?a[l]:e[l])}var l=arguments.length-2;if(l===1)r.children=t;else if(1<l){a=Array(l);for(var u=0;u<l;u++)a[u]=arguments[u+2];r.children=a}return{$$typeof:Xd,type:n.type,key:s,ref:i,props:r,_owner:o}};tt.createContext=function(n){return n={$$typeof:h2,_currentValue:n,_currentValue2:n,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},n.Provider={$$typeof:d2,_context:n},n.Consumer=n};tt.createElement=Ub;tt.createFactory=function(n){var e=Ub.bind(null,n);return e.type=n,e};tt.createRef=function(){return{current:null}};tt.forwardRef=function(n){return{$$typeof:f2,render:n}};tt.isValidElement=Uv;tt.lazy=function(n){return{$$typeof:m2,_payload:{_status:-1,_result:n},_init:w2}};tt.memo=function(n,e){return{$$typeof:p2,type:n,compare:e===void 0?null:e}};tt.startTransition=function(n){var e=Af.transition;Af.transition={};try{n()}finally{Af.transition=e}};tt.unstable_act=$b;tt.useCallback=function(n,e){return cr.current.useCallback(n,e)};tt.useContext=function(n){return cr.current.useContext(n)};tt.useDebugValue=function(){};tt.useDeferredValue=function(n){return cr.current.useDeferredValue(n)};tt.useEffect=function(n,e){return cr.current.useEffect(n,e)};tt.useId=function(){return cr.current.useId()};tt.useImperativeHandle=function(n,e,t){return cr.current.useImperativeHandle(n,e,t)};tt.useInsertionEffect=function(n,e){return cr.current.useInsertionEffect(n,e)};tt.useLayoutEffect=function(n,e){return cr.current.useLayoutEffect(n,e)};tt.useMemo=function(n,e){return cr.current.useMemo(n,e)};tt.useReducer=function(n,e,t){return cr.current.useReducer(n,e,t)};tt.useRef=function(n){return cr.current.useRef(n)};tt.useState=function(n){return cr.current.useState(n)};tt.useSyncExternalStore=function(n,e,t){return cr.current.useSyncExternalStore(n,e,t)};tt.useTransition=function(){return cr.current.useTransition()};tt.version="18.3.1";Db.exports=tt;var j=Db.exports;const I2=o2(j);/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var E2=j,S2=Symbol.for("react.element"),T2=Symbol.for("react.fragment"),b2=Object.prototype.hasOwnProperty,A2=E2.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,C2={key:!0,ref:!0,__self:!0,__source:!0};function Bb(n,e,t){var r,s={},i=null,o=null;t!==void 0&&(i=""+t),e.key!==void 0&&(i=""+e.key),e.ref!==void 0&&(o=e.ref);for(r in e)b2.call(e,r)&&!C2.hasOwnProperty(r)&&(s[r]=e[r]);if(n&&n.defaultProps)for(r in e=n.defaultProps,e)s[r]===void 0&&(s[r]=e[r]);return{$$typeof:S2,type:n,key:i,ref:o,props:s,_owner:A2.current}}hp.Fragment=T2;hp.jsx=Bb;hp.jsxs=Bb;Pb.exports=hp;var d=Pb.exports,qy={},zb={exports:{}},zr={},qb={exports:{}},Wb={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(n){function e(k,$){var Q=k.length;k.push($);e:for(;0<Q;){var ee=Q-1>>>1,ie=k[ee];if(0<s(ie,$))k[ee]=$,k[Q]=ie,Q=ee;else break e}}function t(k){return k.length===0?null:k[0]}function r(k){if(k.length===0)return null;var $=k[0],Q=k.pop();if(Q!==$){k[0]=Q;e:for(var ee=0,ie=k.length,le=ie>>>1;ee<le;){var ce=2*(ee+1)-1,Ae=k[ce],$e=ce+1,xe=k[$e];if(0>s(Ae,Q))$e<ie&&0>s(xe,Ae)?(k[ee]=xe,k[$e]=Q,ee=$e):(k[ee]=Ae,k[ce]=Q,ee=ce);else if($e<ie&&0>s(xe,Q))k[ee]=xe,k[$e]=Q,ee=$e;else break e}}return $}function s(k,$){var Q=k.sortIndex-$.sortIndex;return Q!==0?Q:k.id-$.id}if(typeof performance=="object"&&typeof performance.now=="function"){var i=performance;n.unstable_now=function(){return i.now()}}else{var o=Date,a=o.now();n.unstable_now=function(){return o.now()-a}}var l=[],u=[],h=1,f=null,g=3,y=!1,w=!1,C=!1,M=typeof setTimeout=="function"?setTimeout:null,A=typeof clearTimeout=="function"?clearTimeout:null,I=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function R(k){for(var $=t(u);$!==null;){if($.callback===null)r(u);else if($.startTime<=k)r(u),$.sortIndex=$.expirationTime,e(l,$);else break;$=t(u)}}function D(k){if(C=!1,R(k),!w)if(t(l)!==null)w=!0,Me(V);else{var $=t(u);$!==null&&qt(D,$.startTime-k)}}function V(k,$){w=!1,C&&(C=!1,A(v),v=-1),y=!0;var Q=g;try{for(R($),f=t(l);f!==null&&(!(f.expirationTime>$)||k&&!E());){var ee=f.callback;if(typeof ee=="function"){f.callback=null,g=f.priorityLevel;var ie=ee(f.expirationTime<=$);$=n.unstable_now(),typeof ie=="function"?f.callback=ie:f===t(l)&&r(l),R($)}else r(l);f=t(l)}if(f!==null)var le=!0;else{var ce=t(u);ce!==null&&qt(D,ce.startTime-$),le=!1}return le}finally{f=null,g=Q,y=!1}}var P=!1,S=null,v=-1,b=5,_=-1;function E(){return!(n.unstable_now()-_<b)}function N(){if(S!==null){var k=n.unstable_now();_=k;var $=!0;try{$=S(!0,k)}finally{$?T():(P=!1,S=null)}}else P=!1}var T;if(typeof I=="function")T=function(){I(N)};else if(typeof MessageChannel<"u"){var K=new MessageChannel,mt=K.port2;K.port1.onmessage=N,T=function(){mt.postMessage(null)}}else T=function(){M(N,0)};function Me(k){S=k,P||(P=!0,T())}function qt(k,$){v=M(function(){k(n.unstable_now())},$)}n.unstable_IdlePriority=5,n.unstable_ImmediatePriority=1,n.unstable_LowPriority=4,n.unstable_NormalPriority=3,n.unstable_Profiling=null,n.unstable_UserBlockingPriority=2,n.unstable_cancelCallback=function(k){k.callback=null},n.unstable_continueExecution=function(){w||y||(w=!0,Me(V))},n.unstable_forceFrameRate=function(k){0>k||125<k?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):b=0<k?Math.floor(1e3/k):5},n.unstable_getCurrentPriorityLevel=function(){return g},n.unstable_getFirstCallbackNode=function(){return t(l)},n.unstable_next=function(k){switch(g){case 1:case 2:case 3:var $=3;break;default:$=g}var Q=g;g=$;try{return k()}finally{g=Q}},n.unstable_pauseExecution=function(){},n.unstable_requestPaint=function(){},n.unstable_runWithPriority=function(k,$){switch(k){case 1:case 2:case 3:case 4:case 5:break;default:k=3}var Q=g;g=k;try{return $()}finally{g=Q}},n.unstable_scheduleCallback=function(k,$,Q){var ee=n.unstable_now();switch(typeof Q=="object"&&Q!==null?(Q=Q.delay,Q=typeof Q=="number"&&0<Q?ee+Q:ee):Q=ee,k){case 1:var ie=-1;break;case 2:ie=250;break;case 5:ie=1073741823;break;case 4:ie=1e4;break;default:ie=5e3}return ie=Q+ie,k={id:h++,callback:$,priorityLevel:k,startTime:Q,expirationTime:ie,sortIndex:-1},Q>ee?(k.sortIndex=Q,e(u,k),t(l)===null&&k===t(u)&&(C?(A(v),v=-1):C=!0,qt(D,Q-ee))):(k.sortIndex=ie,e(l,k),w||y||(w=!0,Me(V))),k},n.unstable_shouldYield=E,n.unstable_wrapCallback=function(k){var $=g;return function(){var Q=g;g=$;try{return k.apply(this,arguments)}finally{g=Q}}}})(Wb);qb.exports=Wb;var R2=qb.exports;/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var N2=j,jr=R2;function J(n){for(var e="https://reactjs.org/docs/error-decoder.html?invariant="+n,t=1;t<arguments.length;t++)e+="&args[]="+encodeURIComponent(arguments[t]);return"Minified React error #"+n+"; visit "+e+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var Gb=new Set,id={};function Ba(n,e){Ql(n,e),Ql(n+"Capture",e)}function Ql(n,e){for(id[n]=e,n=0;n<e.length;n++)Gb.add(e[n])}var gi=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),Wy=Object.prototype.hasOwnProperty,k2=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,RI={},NI={};function P2(n){return Wy.call(NI,n)?!0:Wy.call(RI,n)?!1:k2.test(n)?NI[n]=!0:(RI[n]=!0,!1)}function D2(n,e,t,r){if(t!==null&&t.type===0)return!1;switch(typeof e){case"function":case"symbol":return!0;case"boolean":return r?!1:t!==null?!t.acceptsBooleans:(n=n.toLowerCase().slice(0,5),n!=="data-"&&n!=="aria-");default:return!1}}function M2(n,e,t,r){if(e===null||typeof e>"u"||D2(n,e,t,r))return!0;if(r)return!1;if(t!==null)switch(t.type){case 3:return!e;case 4:return e===!1;case 5:return isNaN(e);case 6:return isNaN(e)||1>e}return!1}function ur(n,e,t,r,s,i,o){this.acceptsBooleans=e===2||e===3||e===4,this.attributeName=r,this.attributeNamespace=s,this.mustUseProperty=t,this.propertyName=n,this.type=e,this.sanitizeURL=i,this.removeEmptyString=o}var zn={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(n){zn[n]=new ur(n,0,!1,n,null,!1,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(n){var e=n[0];zn[e]=new ur(e,1,!1,n[1],null,!1,!1)});["contentEditable","draggable","spellCheck","value"].forEach(function(n){zn[n]=new ur(n,2,!1,n.toLowerCase(),null,!1,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(n){zn[n]=new ur(n,2,!1,n,null,!1,!1)});"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(n){zn[n]=new ur(n,3,!1,n.toLowerCase(),null,!1,!1)});["checked","multiple","muted","selected"].forEach(function(n){zn[n]=new ur(n,3,!0,n,null,!1,!1)});["capture","download"].forEach(function(n){zn[n]=new ur(n,4,!1,n,null,!1,!1)});["cols","rows","size","span"].forEach(function(n){zn[n]=new ur(n,6,!1,n,null,!1,!1)});["rowSpan","start"].forEach(function(n){zn[n]=new ur(n,5,!1,n.toLowerCase(),null,!1,!1)});var $v=/[\-:]([a-z])/g;function Bv(n){return n[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(n){var e=n.replace($v,Bv);zn[e]=new ur(e,1,!1,n,null,!1,!1)});"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(n){var e=n.replace($v,Bv);zn[e]=new ur(e,1,!1,n,"http://www.w3.org/1999/xlink",!1,!1)});["xml:base","xml:lang","xml:space"].forEach(function(n){var e=n.replace($v,Bv);zn[e]=new ur(e,1,!1,n,"http://www.w3.org/XML/1998/namespace",!1,!1)});["tabIndex","crossOrigin"].forEach(function(n){zn[n]=new ur(n,1,!1,n.toLowerCase(),null,!1,!1)});zn.xlinkHref=new ur("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1);["src","href","action","formAction"].forEach(function(n){zn[n]=new ur(n,1,!1,n.toLowerCase(),null,!0,!0)});function zv(n,e,t,r){var s=zn.hasOwnProperty(e)?zn[e]:null;(s!==null?s.type!==0:r||!(2<e.length)||e[0]!=="o"&&e[0]!=="O"||e[1]!=="n"&&e[1]!=="N")&&(M2(e,t,s,r)&&(t=null),r||s===null?P2(e)&&(t===null?n.removeAttribute(e):n.setAttribute(e,""+t)):s.mustUseProperty?n[s.propertyName]=t===null?s.type===3?!1:"":t:(e=s.attributeName,r=s.attributeNamespace,t===null?n.removeAttribute(e):(s=s.type,t=s===3||s===4&&t===!0?"":""+t,r?n.setAttributeNS(r,e,t):n.setAttribute(e,t))))}var Ti=N2.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,Hh=Symbol.for("react.element"),wl=Symbol.for("react.portal"),xl=Symbol.for("react.fragment"),qv=Symbol.for("react.strict_mode"),Gy=Symbol.for("react.profiler"),Hb=Symbol.for("react.provider"),Kb=Symbol.for("react.context"),Wv=Symbol.for("react.forward_ref"),Hy=Symbol.for("react.suspense"),Ky=Symbol.for("react.suspense_list"),Gv=Symbol.for("react.memo"),Bi=Symbol.for("react.lazy"),Qb=Symbol.for("react.offscreen"),kI=Symbol.iterator;function tu(n){return n===null||typeof n!="object"?null:(n=kI&&n[kI]||n["@@iterator"],typeof n=="function"?n:null)}var tn=Object.assign,Bm;function vu(n){if(Bm===void 0)try{throw Error()}catch(t){var e=t.stack.trim().match(/\n( *(at )?)/);Bm=e&&e[1]||""}return`
`+Bm+n}var zm=!1;function qm(n,e){if(!n||zm)return"";zm=!0;var t=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(e)if(e=function(){throw Error()},Object.defineProperty(e.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(e,[])}catch(u){var r=u}Reflect.construct(n,[],e)}else{try{e.call()}catch(u){r=u}n.call(e.prototype)}else{try{throw Error()}catch(u){r=u}n()}}catch(u){if(u&&r&&typeof u.stack=="string"){for(var s=u.stack.split(`
`),i=r.stack.split(`
`),o=s.length-1,a=i.length-1;1<=o&&0<=a&&s[o]!==i[a];)a--;for(;1<=o&&0<=a;o--,a--)if(s[o]!==i[a]){if(o!==1||a!==1)do if(o--,a--,0>a||s[o]!==i[a]){var l=`
`+s[o].replace(" at new "," at ");return n.displayName&&l.includes("<anonymous>")&&(l=l.replace("<anonymous>",n.displayName)),l}while(1<=o&&0<=a);break}}}finally{zm=!1,Error.prepareStackTrace=t}return(n=n?n.displayName||n.name:"")?vu(n):""}function L2(n){switch(n.tag){case 5:return vu(n.type);case 16:return vu("Lazy");case 13:return vu("Suspense");case 19:return vu("SuspenseList");case 0:case 2:case 15:return n=qm(n.type,!1),n;case 11:return n=qm(n.type.render,!1),n;case 1:return n=qm(n.type,!0),n;default:return""}}function Qy(n){if(n==null)return null;if(typeof n=="function")return n.displayName||n.name||null;if(typeof n=="string")return n;switch(n){case xl:return"Fragment";case wl:return"Portal";case Gy:return"Profiler";case qv:return"StrictMode";case Hy:return"Suspense";case Ky:return"SuspenseList"}if(typeof n=="object")switch(n.$$typeof){case Kb:return(n.displayName||"Context")+".Consumer";case Hb:return(n._context.displayName||"Context")+".Provider";case Wv:var e=n.render;return n=n.displayName,n||(n=e.displayName||e.name||"",n=n!==""?"ForwardRef("+n+")":"ForwardRef"),n;case Gv:return e=n.displayName||null,e!==null?e:Qy(n.type)||"Memo";case Bi:e=n._payload,n=n._init;try{return Qy(n(e))}catch{}}return null}function O2(n){var e=n.type;switch(n.tag){case 24:return"Cache";case 9:return(e.displayName||"Context")+".Consumer";case 10:return(e._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return n=e.render,n=n.displayName||n.name||"",e.displayName||(n!==""?"ForwardRef("+n+")":"ForwardRef");case 7:return"Fragment";case 5:return e;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return Qy(e);case 8:return e===qv?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof e=="function")return e.displayName||e.name||null;if(typeof e=="string")return e}return null}function xo(n){switch(typeof n){case"boolean":case"number":case"string":case"undefined":return n;case"object":return n;default:return""}}function Yb(n){var e=n.type;return(n=n.nodeName)&&n.toLowerCase()==="input"&&(e==="checkbox"||e==="radio")}function V2(n){var e=Yb(n)?"checked":"value",t=Object.getOwnPropertyDescriptor(n.constructor.prototype,e),r=""+n[e];if(!n.hasOwnProperty(e)&&typeof t<"u"&&typeof t.get=="function"&&typeof t.set=="function"){var s=t.get,i=t.set;return Object.defineProperty(n,e,{configurable:!0,get:function(){return s.call(this)},set:function(o){r=""+o,i.call(this,o)}}),Object.defineProperty(n,e,{enumerable:t.enumerable}),{getValue:function(){return r},setValue:function(o){r=""+o},stopTracking:function(){n._valueTracker=null,delete n[e]}}}}function Kh(n){n._valueTracker||(n._valueTracker=V2(n))}function Jb(n){if(!n)return!1;var e=n._valueTracker;if(!e)return!0;var t=e.getValue(),r="";return n&&(r=Yb(n)?n.checked?"true":"false":n.value),n=r,n!==t?(e.setValue(n),!0):!1}function ng(n){if(n=n||(typeof document<"u"?document:void 0),typeof n>"u")return null;try{return n.activeElement||n.body}catch{return n.body}}function Yy(n,e){var t=e.checked;return tn({},e,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:t??n._wrapperState.initialChecked})}function PI(n,e){var t=e.defaultValue==null?"":e.defaultValue,r=e.checked!=null?e.checked:e.defaultChecked;t=xo(e.value!=null?e.value:t),n._wrapperState={initialChecked:r,initialValue:t,controlled:e.type==="checkbox"||e.type==="radio"?e.checked!=null:e.value!=null}}function Xb(n,e){e=e.checked,e!=null&&zv(n,"checked",e,!1)}function Jy(n,e){Xb(n,e);var t=xo(e.value),r=e.type;if(t!=null)r==="number"?(t===0&&n.value===""||n.value!=t)&&(n.value=""+t):n.value!==""+t&&(n.value=""+t);else if(r==="submit"||r==="reset"){n.removeAttribute("value");return}e.hasOwnProperty("value")?Xy(n,e.type,t):e.hasOwnProperty("defaultValue")&&Xy(n,e.type,xo(e.defaultValue)),e.checked==null&&e.defaultChecked!=null&&(n.defaultChecked=!!e.defaultChecked)}function DI(n,e,t){if(e.hasOwnProperty("value")||e.hasOwnProperty("defaultValue")){var r=e.type;if(!(r!=="submit"&&r!=="reset"||e.value!==void 0&&e.value!==null))return;e=""+n._wrapperState.initialValue,t||e===n.value||(n.value=e),n.defaultValue=e}t=n.name,t!==""&&(n.name=""),n.defaultChecked=!!n._wrapperState.initialChecked,t!==""&&(n.name=t)}function Xy(n,e,t){(e!=="number"||ng(n.ownerDocument)!==n)&&(t==null?n.defaultValue=""+n._wrapperState.initialValue:n.defaultValue!==""+t&&(n.defaultValue=""+t))}var wu=Array.isArray;function Ml(n,e,t,r){if(n=n.options,e){e={};for(var s=0;s<t.length;s++)e["$"+t[s]]=!0;for(t=0;t<n.length;t++)s=e.hasOwnProperty("$"+n[t].value),n[t].selected!==s&&(n[t].selected=s),s&&r&&(n[t].defaultSelected=!0)}else{for(t=""+xo(t),e=null,s=0;s<n.length;s++){if(n[s].value===t){n[s].selected=!0,r&&(n[s].defaultSelected=!0);return}e!==null||n[s].disabled||(e=n[s])}e!==null&&(e.selected=!0)}}function Zy(n,e){if(e.dangerouslySetInnerHTML!=null)throw Error(J(91));return tn({},e,{value:void 0,defaultValue:void 0,children:""+n._wrapperState.initialValue})}function MI(n,e){var t=e.value;if(t==null){if(t=e.children,e=e.defaultValue,t!=null){if(e!=null)throw Error(J(92));if(wu(t)){if(1<t.length)throw Error(J(93));t=t[0]}e=t}e==null&&(e=""),t=e}n._wrapperState={initialValue:xo(t)}}function Zb(n,e){var t=xo(e.value),r=xo(e.defaultValue);t!=null&&(t=""+t,t!==n.value&&(n.value=t),e.defaultValue==null&&n.defaultValue!==t&&(n.defaultValue=t)),r!=null&&(n.defaultValue=""+r)}function LI(n){var e=n.textContent;e===n._wrapperState.initialValue&&e!==""&&e!==null&&(n.value=e)}function eA(n){switch(n){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function e_(n,e){return n==null||n==="http://www.w3.org/1999/xhtml"?eA(e):n==="http://www.w3.org/2000/svg"&&e==="foreignObject"?"http://www.w3.org/1999/xhtml":n}var Qh,tA=function(n){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(e,t,r,s){MSApp.execUnsafeLocalFunction(function(){return n(e,t,r,s)})}:n}(function(n,e){if(n.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in n)n.innerHTML=e;else{for(Qh=Qh||document.createElement("div"),Qh.innerHTML="<svg>"+e.valueOf().toString()+"</svg>",e=Qh.firstChild;n.firstChild;)n.removeChild(n.firstChild);for(;e.firstChild;)n.appendChild(e.firstChild)}});function od(n,e){if(e){var t=n.firstChild;if(t&&t===n.lastChild&&t.nodeType===3){t.nodeValue=e;return}}n.textContent=e}var ku={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},F2=["Webkit","ms","Moz","O"];Object.keys(ku).forEach(function(n){F2.forEach(function(e){e=e+n.charAt(0).toUpperCase()+n.substring(1),ku[e]=ku[n]})});function nA(n,e,t){return e==null||typeof e=="boolean"||e===""?"":t||typeof e!="number"||e===0||ku.hasOwnProperty(n)&&ku[n]?(""+e).trim():e+"px"}function rA(n,e){n=n.style;for(var t in e)if(e.hasOwnProperty(t)){var r=t.indexOf("--")===0,s=nA(t,e[t],r);t==="float"&&(t="cssFloat"),r?n.setProperty(t,s):n[t]=s}}var j2=tn({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function t_(n,e){if(e){if(j2[n]&&(e.children!=null||e.dangerouslySetInnerHTML!=null))throw Error(J(137,n));if(e.dangerouslySetInnerHTML!=null){if(e.children!=null)throw Error(J(60));if(typeof e.dangerouslySetInnerHTML!="object"||!("__html"in e.dangerouslySetInnerHTML))throw Error(J(61))}if(e.style!=null&&typeof e.style!="object")throw Error(J(62))}}function n_(n,e){if(n.indexOf("-")===-1)return typeof e.is=="string";switch(n){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var r_=null;function Hv(n){return n=n.target||n.srcElement||window,n.correspondingUseElement&&(n=n.correspondingUseElement),n.nodeType===3?n.parentNode:n}var s_=null,Ll=null,Ol=null;function OI(n){if(n=th(n)){if(typeof s_!="function")throw Error(J(280));var e=n.stateNode;e&&(e=yp(e),s_(n.stateNode,n.type,e))}}function sA(n){Ll?Ol?Ol.push(n):Ol=[n]:Ll=n}function iA(){if(Ll){var n=Ll,e=Ol;if(Ol=Ll=null,OI(n),e)for(n=0;n<e.length;n++)OI(e[n])}}function oA(n,e){return n(e)}function aA(){}var Wm=!1;function lA(n,e,t){if(Wm)return n(e,t);Wm=!0;try{return oA(n,e,t)}finally{Wm=!1,(Ll!==null||Ol!==null)&&(aA(),iA())}}function ad(n,e){var t=n.stateNode;if(t===null)return null;var r=yp(t);if(r===null)return null;t=r[e];e:switch(e){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(r=!r.disabled)||(n=n.type,r=!(n==="button"||n==="input"||n==="select"||n==="textarea")),n=!r;break e;default:n=!1}if(n)return null;if(t&&typeof t!="function")throw Error(J(231,e,typeof t));return t}var i_=!1;if(gi)try{var nu={};Object.defineProperty(nu,"passive",{get:function(){i_=!0}}),window.addEventListener("test",nu,nu),window.removeEventListener("test",nu,nu)}catch{i_=!1}function U2(n,e,t,r,s,i,o,a,l){var u=Array.prototype.slice.call(arguments,3);try{e.apply(t,u)}catch(h){this.onError(h)}}var Pu=!1,rg=null,sg=!1,o_=null,$2={onError:function(n){Pu=!0,rg=n}};function B2(n,e,t,r,s,i,o,a,l){Pu=!1,rg=null,U2.apply($2,arguments)}function z2(n,e,t,r,s,i,o,a,l){if(B2.apply(this,arguments),Pu){if(Pu){var u=rg;Pu=!1,rg=null}else throw Error(J(198));sg||(sg=!0,o_=u)}}function za(n){var e=n,t=n;if(n.alternate)for(;e.return;)e=e.return;else{n=e;do e=n,e.flags&4098&&(t=e.return),n=e.return;while(n)}return e.tag===3?t:null}function cA(n){if(n.tag===13){var e=n.memoizedState;if(e===null&&(n=n.alternate,n!==null&&(e=n.memoizedState)),e!==null)return e.dehydrated}return null}function VI(n){if(za(n)!==n)throw Error(J(188))}function q2(n){var e=n.alternate;if(!e){if(e=za(n),e===null)throw Error(J(188));return e!==n?null:n}for(var t=n,r=e;;){var s=t.return;if(s===null)break;var i=s.alternate;if(i===null){if(r=s.return,r!==null){t=r;continue}break}if(s.child===i.child){for(i=s.child;i;){if(i===t)return VI(s),n;if(i===r)return VI(s),e;i=i.sibling}throw Error(J(188))}if(t.return!==r.return)t=s,r=i;else{for(var o=!1,a=s.child;a;){if(a===t){o=!0,t=s,r=i;break}if(a===r){o=!0,r=s,t=i;break}a=a.sibling}if(!o){for(a=i.child;a;){if(a===t){o=!0,t=i,r=s;break}if(a===r){o=!0,r=i,t=s;break}a=a.sibling}if(!o)throw Error(J(189))}}if(t.alternate!==r)throw Error(J(190))}if(t.tag!==3)throw Error(J(188));return t.stateNode.current===t?n:e}function uA(n){return n=q2(n),n!==null?dA(n):null}function dA(n){if(n.tag===5||n.tag===6)return n;for(n=n.child;n!==null;){var e=dA(n);if(e!==null)return e;n=n.sibling}return null}var hA=jr.unstable_scheduleCallback,FI=jr.unstable_cancelCallback,W2=jr.unstable_shouldYield,G2=jr.unstable_requestPaint,un=jr.unstable_now,H2=jr.unstable_getCurrentPriorityLevel,Kv=jr.unstable_ImmediatePriority,fA=jr.unstable_UserBlockingPriority,ig=jr.unstable_NormalPriority,K2=jr.unstable_LowPriority,gA=jr.unstable_IdlePriority,fp=null,js=null;function Q2(n){if(js&&typeof js.onCommitFiberRoot=="function")try{js.onCommitFiberRoot(fp,n,void 0,(n.current.flags&128)===128)}catch{}}var ps=Math.clz32?Math.clz32:X2,Y2=Math.log,J2=Math.LN2;function X2(n){return n>>>=0,n===0?32:31-(Y2(n)/J2|0)|0}var Yh=64,Jh=4194304;function xu(n){switch(n&-n){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return n&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return n&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return n}}function og(n,e){var t=n.pendingLanes;if(t===0)return 0;var r=0,s=n.suspendedLanes,i=n.pingedLanes,o=t&268435455;if(o!==0){var a=o&~s;a!==0?r=xu(a):(i&=o,i!==0&&(r=xu(i)))}else o=t&~s,o!==0?r=xu(o):i!==0&&(r=xu(i));if(r===0)return 0;if(e!==0&&e!==r&&!(e&s)&&(s=r&-r,i=e&-e,s>=i||s===16&&(i&4194240)!==0))return e;if(r&4&&(r|=t&16),e=n.entangledLanes,e!==0)for(n=n.entanglements,e&=r;0<e;)t=31-ps(e),s=1<<t,r|=n[t],e&=~s;return r}function Z2(n,e){switch(n){case 1:case 2:case 4:return e+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return e+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function eM(n,e){for(var t=n.suspendedLanes,r=n.pingedLanes,s=n.expirationTimes,i=n.pendingLanes;0<i;){var o=31-ps(i),a=1<<o,l=s[o];l===-1?(!(a&t)||a&r)&&(s[o]=Z2(a,e)):l<=e&&(n.expiredLanes|=a),i&=~a}}function a_(n){return n=n.pendingLanes&-1073741825,n!==0?n:n&1073741824?1073741824:0}function pA(){var n=Yh;return Yh<<=1,!(Yh&4194240)&&(Yh=64),n}function Gm(n){for(var e=[],t=0;31>t;t++)e.push(n);return e}function Zd(n,e,t){n.pendingLanes|=e,e!==536870912&&(n.suspendedLanes=0,n.pingedLanes=0),n=n.eventTimes,e=31-ps(e),n[e]=t}function tM(n,e){var t=n.pendingLanes&~e;n.pendingLanes=e,n.suspendedLanes=0,n.pingedLanes=0,n.expiredLanes&=e,n.mutableReadLanes&=e,n.entangledLanes&=e,e=n.entanglements;var r=n.eventTimes;for(n=n.expirationTimes;0<t;){var s=31-ps(t),i=1<<s;e[s]=0,r[s]=-1,n[s]=-1,t&=~i}}function Qv(n,e){var t=n.entangledLanes|=e;for(n=n.entanglements;t;){var r=31-ps(t),s=1<<r;s&e|n[r]&e&&(n[r]|=e),t&=~s}}var Et=0;function mA(n){return n&=-n,1<n?4<n?n&268435455?16:536870912:4:1}var yA,Yv,_A,vA,wA,l_=!1,Xh=[],io=null,oo=null,ao=null,ld=new Map,cd=new Map,qi=[],nM="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function jI(n,e){switch(n){case"focusin":case"focusout":io=null;break;case"dragenter":case"dragleave":oo=null;break;case"mouseover":case"mouseout":ao=null;break;case"pointerover":case"pointerout":ld.delete(e.pointerId);break;case"gotpointercapture":case"lostpointercapture":cd.delete(e.pointerId)}}function ru(n,e,t,r,s,i){return n===null||n.nativeEvent!==i?(n={blockedOn:e,domEventName:t,eventSystemFlags:r,nativeEvent:i,targetContainers:[s]},e!==null&&(e=th(e),e!==null&&Yv(e)),n):(n.eventSystemFlags|=r,e=n.targetContainers,s!==null&&e.indexOf(s)===-1&&e.push(s),n)}function rM(n,e,t,r,s){switch(e){case"focusin":return io=ru(io,n,e,t,r,s),!0;case"dragenter":return oo=ru(oo,n,e,t,r,s),!0;case"mouseover":return ao=ru(ao,n,e,t,r,s),!0;case"pointerover":var i=s.pointerId;return ld.set(i,ru(ld.get(i)||null,n,e,t,r,s)),!0;case"gotpointercapture":return i=s.pointerId,cd.set(i,ru(cd.get(i)||null,n,e,t,r,s)),!0}return!1}function xA(n){var e=oa(n.target);if(e!==null){var t=za(e);if(t!==null){if(e=t.tag,e===13){if(e=cA(t),e!==null){n.blockedOn=e,wA(n.priority,function(){_A(t)});return}}else if(e===3&&t.stateNode.current.memoizedState.isDehydrated){n.blockedOn=t.tag===3?t.stateNode.containerInfo:null;return}}}n.blockedOn=null}function Cf(n){if(n.blockedOn!==null)return!1;for(var e=n.targetContainers;0<e.length;){var t=c_(n.domEventName,n.eventSystemFlags,e[0],n.nativeEvent);if(t===null){t=n.nativeEvent;var r=new t.constructor(t.type,t);r_=r,t.target.dispatchEvent(r),r_=null}else return e=th(t),e!==null&&Yv(e),n.blockedOn=t,!1;e.shift()}return!0}function UI(n,e,t){Cf(n)&&t.delete(e)}function sM(){l_=!1,io!==null&&Cf(io)&&(io=null),oo!==null&&Cf(oo)&&(oo=null),ao!==null&&Cf(ao)&&(ao=null),ld.forEach(UI),cd.forEach(UI)}function su(n,e){n.blockedOn===e&&(n.blockedOn=null,l_||(l_=!0,jr.unstable_scheduleCallback(jr.unstable_NormalPriority,sM)))}function ud(n){function e(s){return su(s,n)}if(0<Xh.length){su(Xh[0],n);for(var t=1;t<Xh.length;t++){var r=Xh[t];r.blockedOn===n&&(r.blockedOn=null)}}for(io!==null&&su(io,n),oo!==null&&su(oo,n),ao!==null&&su(ao,n),ld.forEach(e),cd.forEach(e),t=0;t<qi.length;t++)r=qi[t],r.blockedOn===n&&(r.blockedOn=null);for(;0<qi.length&&(t=qi[0],t.blockedOn===null);)xA(t),t.blockedOn===null&&qi.shift()}var Vl=Ti.ReactCurrentBatchConfig,ag=!0;function iM(n,e,t,r){var s=Et,i=Vl.transition;Vl.transition=null;try{Et=1,Jv(n,e,t,r)}finally{Et=s,Vl.transition=i}}function oM(n,e,t,r){var s=Et,i=Vl.transition;Vl.transition=null;try{Et=4,Jv(n,e,t,r)}finally{Et=s,Vl.transition=i}}function Jv(n,e,t,r){if(ag){var s=c_(n,e,t,r);if(s===null)ny(n,e,r,lg,t),jI(n,r);else if(rM(s,n,e,t,r))r.stopPropagation();else if(jI(n,r),e&4&&-1<nM.indexOf(n)){for(;s!==null;){var i=th(s);if(i!==null&&yA(i),i=c_(n,e,t,r),i===null&&ny(n,e,r,lg,t),i===s)break;s=i}s!==null&&r.stopPropagation()}else ny(n,e,r,null,t)}}var lg=null;function c_(n,e,t,r){if(lg=null,n=Hv(r),n=oa(n),n!==null)if(e=za(n),e===null)n=null;else if(t=e.tag,t===13){if(n=cA(e),n!==null)return n;n=null}else if(t===3){if(e.stateNode.current.memoizedState.isDehydrated)return e.tag===3?e.stateNode.containerInfo:null;n=null}else e!==n&&(n=null);return lg=n,null}function IA(n){switch(n){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(H2()){case Kv:return 1;case fA:return 4;case ig:case K2:return 16;case gA:return 536870912;default:return 16}default:return 16}}var Ji=null,Xv=null,Rf=null;function EA(){if(Rf)return Rf;var n,e=Xv,t=e.length,r,s="value"in Ji?Ji.value:Ji.textContent,i=s.length;for(n=0;n<t&&e[n]===s[n];n++);var o=t-n;for(r=1;r<=o&&e[t-r]===s[i-r];r++);return Rf=s.slice(n,1<r?1-r:void 0)}function Nf(n){var e=n.keyCode;return"charCode"in n?(n=n.charCode,n===0&&e===13&&(n=13)):n=e,n===10&&(n=13),32<=n||n===13?n:0}function Zh(){return!0}function $I(){return!1}function qr(n){function e(t,r,s,i,o){this._reactName=t,this._targetInst=s,this.type=r,this.nativeEvent=i,this.target=o,this.currentTarget=null;for(var a in n)n.hasOwnProperty(a)&&(t=n[a],this[a]=t?t(i):i[a]);return this.isDefaultPrevented=(i.defaultPrevented!=null?i.defaultPrevented:i.returnValue===!1)?Zh:$I,this.isPropagationStopped=$I,this}return tn(e.prototype,{preventDefault:function(){this.defaultPrevented=!0;var t=this.nativeEvent;t&&(t.preventDefault?t.preventDefault():typeof t.returnValue!="unknown"&&(t.returnValue=!1),this.isDefaultPrevented=Zh)},stopPropagation:function(){var t=this.nativeEvent;t&&(t.stopPropagation?t.stopPropagation():typeof t.cancelBubble!="unknown"&&(t.cancelBubble=!0),this.isPropagationStopped=Zh)},persist:function(){},isPersistent:Zh}),e}var Rc={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(n){return n.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},Zv=qr(Rc),eh=tn({},Rc,{view:0,detail:0}),aM=qr(eh),Hm,Km,iu,gp=tn({},eh,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:e0,button:0,buttons:0,relatedTarget:function(n){return n.relatedTarget===void 0?n.fromElement===n.srcElement?n.toElement:n.fromElement:n.relatedTarget},movementX:function(n){return"movementX"in n?n.movementX:(n!==iu&&(iu&&n.type==="mousemove"?(Hm=n.screenX-iu.screenX,Km=n.screenY-iu.screenY):Km=Hm=0,iu=n),Hm)},movementY:function(n){return"movementY"in n?n.movementY:Km}}),BI=qr(gp),lM=tn({},gp,{dataTransfer:0}),cM=qr(lM),uM=tn({},eh,{relatedTarget:0}),Qm=qr(uM),dM=tn({},Rc,{animationName:0,elapsedTime:0,pseudoElement:0}),hM=qr(dM),fM=tn({},Rc,{clipboardData:function(n){return"clipboardData"in n?n.clipboardData:window.clipboardData}}),gM=qr(fM),pM=tn({},Rc,{data:0}),zI=qr(pM),mM={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},yM={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},_M={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function vM(n){var e=this.nativeEvent;return e.getModifierState?e.getModifierState(n):(n=_M[n])?!!e[n]:!1}function e0(){return vM}var wM=tn({},eh,{key:function(n){if(n.key){var e=mM[n.key]||n.key;if(e!=="Unidentified")return e}return n.type==="keypress"?(n=Nf(n),n===13?"Enter":String.fromCharCode(n)):n.type==="keydown"||n.type==="keyup"?yM[n.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:e0,charCode:function(n){return n.type==="keypress"?Nf(n):0},keyCode:function(n){return n.type==="keydown"||n.type==="keyup"?n.keyCode:0},which:function(n){return n.type==="keypress"?Nf(n):n.type==="keydown"||n.type==="keyup"?n.keyCode:0}}),xM=qr(wM),IM=tn({},gp,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),qI=qr(IM),EM=tn({},eh,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:e0}),SM=qr(EM),TM=tn({},Rc,{propertyName:0,elapsedTime:0,pseudoElement:0}),bM=qr(TM),AM=tn({},gp,{deltaX:function(n){return"deltaX"in n?n.deltaX:"wheelDeltaX"in n?-n.wheelDeltaX:0},deltaY:function(n){return"deltaY"in n?n.deltaY:"wheelDeltaY"in n?-n.wheelDeltaY:"wheelDelta"in n?-n.wheelDelta:0},deltaZ:0,deltaMode:0}),CM=qr(AM),RM=[9,13,27,32],t0=gi&&"CompositionEvent"in window,Du=null;gi&&"documentMode"in document&&(Du=document.documentMode);var NM=gi&&"TextEvent"in window&&!Du,SA=gi&&(!t0||Du&&8<Du&&11>=Du),WI=String.fromCharCode(32),GI=!1;function TA(n,e){switch(n){case"keyup":return RM.indexOf(e.keyCode)!==-1;case"keydown":return e.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function bA(n){return n=n.detail,typeof n=="object"&&"data"in n?n.data:null}var Il=!1;function kM(n,e){switch(n){case"compositionend":return bA(e);case"keypress":return e.which!==32?null:(GI=!0,WI);case"textInput":return n=e.data,n===WI&&GI?null:n;default:return null}}function PM(n,e){if(Il)return n==="compositionend"||!t0&&TA(n,e)?(n=EA(),Rf=Xv=Ji=null,Il=!1,n):null;switch(n){case"paste":return null;case"keypress":if(!(e.ctrlKey||e.altKey||e.metaKey)||e.ctrlKey&&e.altKey){if(e.char&&1<e.char.length)return e.char;if(e.which)return String.fromCharCode(e.which)}return null;case"compositionend":return SA&&e.locale!=="ko"?null:e.data;default:return null}}var DM={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function HI(n){var e=n&&n.nodeName&&n.nodeName.toLowerCase();return e==="input"?!!DM[n.type]:e==="textarea"}function AA(n,e,t,r){sA(r),e=cg(e,"onChange"),0<e.length&&(t=new Zv("onChange","change",null,t,r),n.push({event:t,listeners:e}))}var Mu=null,dd=null;function MM(n){FA(n,0)}function pp(n){var e=Tl(n);if(Jb(e))return n}function LM(n,e){if(n==="change")return e}var CA=!1;if(gi){var Ym;if(gi){var Jm="oninput"in document;if(!Jm){var KI=document.createElement("div");KI.setAttribute("oninput","return;"),Jm=typeof KI.oninput=="function"}Ym=Jm}else Ym=!1;CA=Ym&&(!document.documentMode||9<document.documentMode)}function QI(){Mu&&(Mu.detachEvent("onpropertychange",RA),dd=Mu=null)}function RA(n){if(n.propertyName==="value"&&pp(dd)){var e=[];AA(e,dd,n,Hv(n)),lA(MM,e)}}function OM(n,e,t){n==="focusin"?(QI(),Mu=e,dd=t,Mu.attachEvent("onpropertychange",RA)):n==="focusout"&&QI()}function VM(n){if(n==="selectionchange"||n==="keyup"||n==="keydown")return pp(dd)}function FM(n,e){if(n==="click")return pp(e)}function jM(n,e){if(n==="input"||n==="change")return pp(e)}function UM(n,e){return n===e&&(n!==0||1/n===1/e)||n!==n&&e!==e}var vs=typeof Object.is=="function"?Object.is:UM;function hd(n,e){if(vs(n,e))return!0;if(typeof n!="object"||n===null||typeof e!="object"||e===null)return!1;var t=Object.keys(n),r=Object.keys(e);if(t.length!==r.length)return!1;for(r=0;r<t.length;r++){var s=t[r];if(!Wy.call(e,s)||!vs(n[s],e[s]))return!1}return!0}function YI(n){for(;n&&n.firstChild;)n=n.firstChild;return n}function JI(n,e){var t=YI(n);n=0;for(var r;t;){if(t.nodeType===3){if(r=n+t.textContent.length,n<=e&&r>=e)return{node:t,offset:e-n};n=r}e:{for(;t;){if(t.nextSibling){t=t.nextSibling;break e}t=t.parentNode}t=void 0}t=YI(t)}}function NA(n,e){return n&&e?n===e?!0:n&&n.nodeType===3?!1:e&&e.nodeType===3?NA(n,e.parentNode):"contains"in n?n.contains(e):n.compareDocumentPosition?!!(n.compareDocumentPosition(e)&16):!1:!1}function kA(){for(var n=window,e=ng();e instanceof n.HTMLIFrameElement;){try{var t=typeof e.contentWindow.location.href=="string"}catch{t=!1}if(t)n=e.contentWindow;else break;e=ng(n.document)}return e}function n0(n){var e=n&&n.nodeName&&n.nodeName.toLowerCase();return e&&(e==="input"&&(n.type==="text"||n.type==="search"||n.type==="tel"||n.type==="url"||n.type==="password")||e==="textarea"||n.contentEditable==="true")}function $M(n){var e=kA(),t=n.focusedElem,r=n.selectionRange;if(e!==t&&t&&t.ownerDocument&&NA(t.ownerDocument.documentElement,t)){if(r!==null&&n0(t)){if(e=r.start,n=r.end,n===void 0&&(n=e),"selectionStart"in t)t.selectionStart=e,t.selectionEnd=Math.min(n,t.value.length);else if(n=(e=t.ownerDocument||document)&&e.defaultView||window,n.getSelection){n=n.getSelection();var s=t.textContent.length,i=Math.min(r.start,s);r=r.end===void 0?i:Math.min(r.end,s),!n.extend&&i>r&&(s=r,r=i,i=s),s=JI(t,i);var o=JI(t,r);s&&o&&(n.rangeCount!==1||n.anchorNode!==s.node||n.anchorOffset!==s.offset||n.focusNode!==o.node||n.focusOffset!==o.offset)&&(e=e.createRange(),e.setStart(s.node,s.offset),n.removeAllRanges(),i>r?(n.addRange(e),n.extend(o.node,o.offset)):(e.setEnd(o.node,o.offset),n.addRange(e)))}}for(e=[],n=t;n=n.parentNode;)n.nodeType===1&&e.push({element:n,left:n.scrollLeft,top:n.scrollTop});for(typeof t.focus=="function"&&t.focus(),t=0;t<e.length;t++)n=e[t],n.element.scrollLeft=n.left,n.element.scrollTop=n.top}}var BM=gi&&"documentMode"in document&&11>=document.documentMode,El=null,u_=null,Lu=null,d_=!1;function XI(n,e,t){var r=t.window===t?t.document:t.nodeType===9?t:t.ownerDocument;d_||El==null||El!==ng(r)||(r=El,"selectionStart"in r&&n0(r)?r={start:r.selectionStart,end:r.selectionEnd}:(r=(r.ownerDocument&&r.ownerDocument.defaultView||window).getSelection(),r={anchorNode:r.anchorNode,anchorOffset:r.anchorOffset,focusNode:r.focusNode,focusOffset:r.focusOffset}),Lu&&hd(Lu,r)||(Lu=r,r=cg(u_,"onSelect"),0<r.length&&(e=new Zv("onSelect","select",null,e,t),n.push({event:e,listeners:r}),e.target=El)))}function ef(n,e){var t={};return t[n.toLowerCase()]=e.toLowerCase(),t["Webkit"+n]="webkit"+e,t["Moz"+n]="moz"+e,t}var Sl={animationend:ef("Animation","AnimationEnd"),animationiteration:ef("Animation","AnimationIteration"),animationstart:ef("Animation","AnimationStart"),transitionend:ef("Transition","TransitionEnd")},Xm={},PA={};gi&&(PA=document.createElement("div").style,"AnimationEvent"in window||(delete Sl.animationend.animation,delete Sl.animationiteration.animation,delete Sl.animationstart.animation),"TransitionEvent"in window||delete Sl.transitionend.transition);function mp(n){if(Xm[n])return Xm[n];if(!Sl[n])return n;var e=Sl[n],t;for(t in e)if(e.hasOwnProperty(t)&&t in PA)return Xm[n]=e[t];return n}var DA=mp("animationend"),MA=mp("animationiteration"),LA=mp("animationstart"),OA=mp("transitionend"),VA=new Map,ZI="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function Lo(n,e){VA.set(n,e),Ba(e,[n])}for(var Zm=0;Zm<ZI.length;Zm++){var ey=ZI[Zm],zM=ey.toLowerCase(),qM=ey[0].toUpperCase()+ey.slice(1);Lo(zM,"on"+qM)}Lo(DA,"onAnimationEnd");Lo(MA,"onAnimationIteration");Lo(LA,"onAnimationStart");Lo("dblclick","onDoubleClick");Lo("focusin","onFocus");Lo("focusout","onBlur");Lo(OA,"onTransitionEnd");Ql("onMouseEnter",["mouseout","mouseover"]);Ql("onMouseLeave",["mouseout","mouseover"]);Ql("onPointerEnter",["pointerout","pointerover"]);Ql("onPointerLeave",["pointerout","pointerover"]);Ba("onChange","change click focusin focusout input keydown keyup selectionchange".split(" "));Ba("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" "));Ba("onBeforeInput",["compositionend","keypress","textInput","paste"]);Ba("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" "));Ba("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" "));Ba("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Iu="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),WM=new Set("cancel close invalid load scroll toggle".split(" ").concat(Iu));function eE(n,e,t){var r=n.type||"unknown-event";n.currentTarget=t,z2(r,e,void 0,n),n.currentTarget=null}function FA(n,e){e=(e&4)!==0;for(var t=0;t<n.length;t++){var r=n[t],s=r.event;r=r.listeners;e:{var i=void 0;if(e)for(var o=r.length-1;0<=o;o--){var a=r[o],l=a.instance,u=a.currentTarget;if(a=a.listener,l!==i&&s.isPropagationStopped())break e;eE(s,a,u),i=l}else for(o=0;o<r.length;o++){if(a=r[o],l=a.instance,u=a.currentTarget,a=a.listener,l!==i&&s.isPropagationStopped())break e;eE(s,a,u),i=l}}}if(sg)throw n=o_,sg=!1,o_=null,n}function jt(n,e){var t=e[m_];t===void 0&&(t=e[m_]=new Set);var r=n+"__bubble";t.has(r)||(jA(e,n,2,!1),t.add(r))}function ty(n,e,t){var r=0;e&&(r|=4),jA(t,n,r,e)}var tf="_reactListening"+Math.random().toString(36).slice(2);function fd(n){if(!n[tf]){n[tf]=!0,Gb.forEach(function(t){t!=="selectionchange"&&(WM.has(t)||ty(t,!1,n),ty(t,!0,n))});var e=n.nodeType===9?n:n.ownerDocument;e===null||e[tf]||(e[tf]=!0,ty("selectionchange",!1,e))}}function jA(n,e,t,r){switch(IA(e)){case 1:var s=iM;break;case 4:s=oM;break;default:s=Jv}t=s.bind(null,e,t,n),s=void 0,!i_||e!=="touchstart"&&e!=="touchmove"&&e!=="wheel"||(s=!0),r?s!==void 0?n.addEventListener(e,t,{capture:!0,passive:s}):n.addEventListener(e,t,!0):s!==void 0?n.addEventListener(e,t,{passive:s}):n.addEventListener(e,t,!1)}function ny(n,e,t,r,s){var i=r;if(!(e&1)&&!(e&2)&&r!==null)e:for(;;){if(r===null)return;var o=r.tag;if(o===3||o===4){var a=r.stateNode.containerInfo;if(a===s||a.nodeType===8&&a.parentNode===s)break;if(o===4)for(o=r.return;o!==null;){var l=o.tag;if((l===3||l===4)&&(l=o.stateNode.containerInfo,l===s||l.nodeType===8&&l.parentNode===s))return;o=o.return}for(;a!==null;){if(o=oa(a),o===null)return;if(l=o.tag,l===5||l===6){r=i=o;continue e}a=a.parentNode}}r=r.return}lA(function(){var u=i,h=Hv(t),f=[];e:{var g=VA.get(n);if(g!==void 0){var y=Zv,w=n;switch(n){case"keypress":if(Nf(t)===0)break e;case"keydown":case"keyup":y=xM;break;case"focusin":w="focus",y=Qm;break;case"focusout":w="blur",y=Qm;break;case"beforeblur":case"afterblur":y=Qm;break;case"click":if(t.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":y=BI;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":y=cM;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":y=SM;break;case DA:case MA:case LA:y=hM;break;case OA:y=bM;break;case"scroll":y=aM;break;case"wheel":y=CM;break;case"copy":case"cut":case"paste":y=gM;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":y=qI}var C=(e&4)!==0,M=!C&&n==="scroll",A=C?g!==null?g+"Capture":null:g;C=[];for(var I=u,R;I!==null;){R=I;var D=R.stateNode;if(R.tag===5&&D!==null&&(R=D,A!==null&&(D=ad(I,A),D!=null&&C.push(gd(I,D,R)))),M)break;I=I.return}0<C.length&&(g=new y(g,w,null,t,h),f.push({event:g,listeners:C}))}}if(!(e&7)){e:{if(g=n==="mouseover"||n==="pointerover",y=n==="mouseout"||n==="pointerout",g&&t!==r_&&(w=t.relatedTarget||t.fromElement)&&(oa(w)||w[pi]))break e;if((y||g)&&(g=h.window===h?h:(g=h.ownerDocument)?g.defaultView||g.parentWindow:window,y?(w=t.relatedTarget||t.toElement,y=u,w=w?oa(w):null,w!==null&&(M=za(w),w!==M||w.tag!==5&&w.tag!==6)&&(w=null)):(y=null,w=u),y!==w)){if(C=BI,D="onMouseLeave",A="onMouseEnter",I="mouse",(n==="pointerout"||n==="pointerover")&&(C=qI,D="onPointerLeave",A="onPointerEnter",I="pointer"),M=y==null?g:Tl(y),R=w==null?g:Tl(w),g=new C(D,I+"leave",y,t,h),g.target=M,g.relatedTarget=R,D=null,oa(h)===u&&(C=new C(A,I+"enter",w,t,h),C.target=R,C.relatedTarget=M,D=C),M=D,y&&w)t:{for(C=y,A=w,I=0,R=C;R;R=al(R))I++;for(R=0,D=A;D;D=al(D))R++;for(;0<I-R;)C=al(C),I--;for(;0<R-I;)A=al(A),R--;for(;I--;){if(C===A||A!==null&&C===A.alternate)break t;C=al(C),A=al(A)}C=null}else C=null;y!==null&&tE(f,g,y,C,!1),w!==null&&M!==null&&tE(f,M,w,C,!0)}}e:{if(g=u?Tl(u):window,y=g.nodeName&&g.nodeName.toLowerCase(),y==="select"||y==="input"&&g.type==="file")var V=LM;else if(HI(g))if(CA)V=jM;else{V=VM;var P=OM}else(y=g.nodeName)&&y.toLowerCase()==="input"&&(g.type==="checkbox"||g.type==="radio")&&(V=FM);if(V&&(V=V(n,u))){AA(f,V,t,h);break e}P&&P(n,g,u),n==="focusout"&&(P=g._wrapperState)&&P.controlled&&g.type==="number"&&Xy(g,"number",g.value)}switch(P=u?Tl(u):window,n){case"focusin":(HI(P)||P.contentEditable==="true")&&(El=P,u_=u,Lu=null);break;case"focusout":Lu=u_=El=null;break;case"mousedown":d_=!0;break;case"contextmenu":case"mouseup":case"dragend":d_=!1,XI(f,t,h);break;case"selectionchange":if(BM)break;case"keydown":case"keyup":XI(f,t,h)}var S;if(t0)e:{switch(n){case"compositionstart":var v="onCompositionStart";break e;case"compositionend":v="onCompositionEnd";break e;case"compositionupdate":v="onCompositionUpdate";break e}v=void 0}else Il?TA(n,t)&&(v="onCompositionEnd"):n==="keydown"&&t.keyCode===229&&(v="onCompositionStart");v&&(SA&&t.locale!=="ko"&&(Il||v!=="onCompositionStart"?v==="onCompositionEnd"&&Il&&(S=EA()):(Ji=h,Xv="value"in Ji?Ji.value:Ji.textContent,Il=!0)),P=cg(u,v),0<P.length&&(v=new zI(v,n,null,t,h),f.push({event:v,listeners:P}),S?v.data=S:(S=bA(t),S!==null&&(v.data=S)))),(S=NM?kM(n,t):PM(n,t))&&(u=cg(u,"onBeforeInput"),0<u.length&&(h=new zI("onBeforeInput","beforeinput",null,t,h),f.push({event:h,listeners:u}),h.data=S))}FA(f,e)})}function gd(n,e,t){return{instance:n,listener:e,currentTarget:t}}function cg(n,e){for(var t=e+"Capture",r=[];n!==null;){var s=n,i=s.stateNode;s.tag===5&&i!==null&&(s=i,i=ad(n,t),i!=null&&r.unshift(gd(n,i,s)),i=ad(n,e),i!=null&&r.push(gd(n,i,s))),n=n.return}return r}function al(n){if(n===null)return null;do n=n.return;while(n&&n.tag!==5);return n||null}function tE(n,e,t,r,s){for(var i=e._reactName,o=[];t!==null&&t!==r;){var a=t,l=a.alternate,u=a.stateNode;if(l!==null&&l===r)break;a.tag===5&&u!==null&&(a=u,s?(l=ad(t,i),l!=null&&o.unshift(gd(t,l,a))):s||(l=ad(t,i),l!=null&&o.push(gd(t,l,a)))),t=t.return}o.length!==0&&n.push({event:e,listeners:o})}var GM=/\r\n?/g,HM=/\u0000|\uFFFD/g;function nE(n){return(typeof n=="string"?n:""+n).replace(GM,`
`).replace(HM,"")}function nf(n,e,t){if(e=nE(e),nE(n)!==e&&t)throw Error(J(425))}function ug(){}var h_=null,f_=null;function g_(n,e){return n==="textarea"||n==="noscript"||typeof e.children=="string"||typeof e.children=="number"||typeof e.dangerouslySetInnerHTML=="object"&&e.dangerouslySetInnerHTML!==null&&e.dangerouslySetInnerHTML.__html!=null}var p_=typeof setTimeout=="function"?setTimeout:void 0,KM=typeof clearTimeout=="function"?clearTimeout:void 0,rE=typeof Promise=="function"?Promise:void 0,QM=typeof queueMicrotask=="function"?queueMicrotask:typeof rE<"u"?function(n){return rE.resolve(null).then(n).catch(YM)}:p_;function YM(n){setTimeout(function(){throw n})}function ry(n,e){var t=e,r=0;do{var s=t.nextSibling;if(n.removeChild(t),s&&s.nodeType===8)if(t=s.data,t==="/$"){if(r===0){n.removeChild(s),ud(e);return}r--}else t!=="$"&&t!=="$?"&&t!=="$!"||r++;t=s}while(t);ud(e)}function lo(n){for(;n!=null;n=n.nextSibling){var e=n.nodeType;if(e===1||e===3)break;if(e===8){if(e=n.data,e==="$"||e==="$!"||e==="$?")break;if(e==="/$")return null}}return n}function sE(n){n=n.previousSibling;for(var e=0;n;){if(n.nodeType===8){var t=n.data;if(t==="$"||t==="$!"||t==="$?"){if(e===0)return n;e--}else t==="/$"&&e++}n=n.previousSibling}return null}var Nc=Math.random().toString(36).slice(2),Ds="__reactFiber$"+Nc,pd="__reactProps$"+Nc,pi="__reactContainer$"+Nc,m_="__reactEvents$"+Nc,JM="__reactListeners$"+Nc,XM="__reactHandles$"+Nc;function oa(n){var e=n[Ds];if(e)return e;for(var t=n.parentNode;t;){if(e=t[pi]||t[Ds]){if(t=e.alternate,e.child!==null||t!==null&&t.child!==null)for(n=sE(n);n!==null;){if(t=n[Ds])return t;n=sE(n)}return e}n=t,t=n.parentNode}return null}function th(n){return n=n[Ds]||n[pi],!n||n.tag!==5&&n.tag!==6&&n.tag!==13&&n.tag!==3?null:n}function Tl(n){if(n.tag===5||n.tag===6)return n.stateNode;throw Error(J(33))}function yp(n){return n[pd]||null}var y_=[],bl=-1;function Oo(n){return{current:n}}function $t(n){0>bl||(n.current=y_[bl],y_[bl]=null,bl--)}function Mt(n,e){bl++,y_[bl]=n.current,n.current=e}var Io={},rr=Oo(Io),vr=Oo(!1),wa=Io;function Yl(n,e){var t=n.type.contextTypes;if(!t)return Io;var r=n.stateNode;if(r&&r.__reactInternalMemoizedUnmaskedChildContext===e)return r.__reactInternalMemoizedMaskedChildContext;var s={},i;for(i in t)s[i]=e[i];return r&&(n=n.stateNode,n.__reactInternalMemoizedUnmaskedChildContext=e,n.__reactInternalMemoizedMaskedChildContext=s),s}function wr(n){return n=n.childContextTypes,n!=null}function dg(){$t(vr),$t(rr)}function iE(n,e,t){if(rr.current!==Io)throw Error(J(168));Mt(rr,e),Mt(vr,t)}function UA(n,e,t){var r=n.stateNode;if(e=e.childContextTypes,typeof r.getChildContext!="function")return t;r=r.getChildContext();for(var s in r)if(!(s in e))throw Error(J(108,O2(n)||"Unknown",s));return tn({},t,r)}function hg(n){return n=(n=n.stateNode)&&n.__reactInternalMemoizedMergedChildContext||Io,wa=rr.current,Mt(rr,n),Mt(vr,vr.current),!0}function oE(n,e,t){var r=n.stateNode;if(!r)throw Error(J(169));t?(n=UA(n,e,wa),r.__reactInternalMemoizedMergedChildContext=n,$t(vr),$t(rr),Mt(rr,n)):$t(vr),Mt(vr,t)}var ri=null,_p=!1,sy=!1;function $A(n){ri===null?ri=[n]:ri.push(n)}function ZM(n){_p=!0,$A(n)}function Vo(){if(!sy&&ri!==null){sy=!0;var n=0,e=Et;try{var t=ri;for(Et=1;n<t.length;n++){var r=t[n];do r=r(!0);while(r!==null)}ri=null,_p=!1}catch(s){throw ri!==null&&(ri=ri.slice(n+1)),hA(Kv,Vo),s}finally{Et=e,sy=!1}}return null}var Al=[],Cl=0,fg=null,gg=0,Kr=[],Qr=0,xa=null,oi=1,ai="";function Yo(n,e){Al[Cl++]=gg,Al[Cl++]=fg,fg=n,gg=e}function BA(n,e,t){Kr[Qr++]=oi,Kr[Qr++]=ai,Kr[Qr++]=xa,xa=n;var r=oi;n=ai;var s=32-ps(r)-1;r&=~(1<<s),t+=1;var i=32-ps(e)+s;if(30<i){var o=s-s%5;i=(r&(1<<o)-1).toString(32),r>>=o,s-=o,oi=1<<32-ps(e)+s|t<<s|r,ai=i+n}else oi=1<<i|t<<s|r,ai=n}function r0(n){n.return!==null&&(Yo(n,1),BA(n,1,0))}function s0(n){for(;n===fg;)fg=Al[--Cl],Al[Cl]=null,gg=Al[--Cl],Al[Cl]=null;for(;n===xa;)xa=Kr[--Qr],Kr[Qr]=null,ai=Kr[--Qr],Kr[Qr]=null,oi=Kr[--Qr],Kr[Qr]=null}var Lr=null,Mr=null,Ht=!1,hs=null;function zA(n,e){var t=Jr(5,null,null,0);t.elementType="DELETED",t.stateNode=e,t.return=n,e=n.deletions,e===null?(n.deletions=[t],n.flags|=16):e.push(t)}function aE(n,e){switch(n.tag){case 5:var t=n.type;return e=e.nodeType!==1||t.toLowerCase()!==e.nodeName.toLowerCase()?null:e,e!==null?(n.stateNode=e,Lr=n,Mr=lo(e.firstChild),!0):!1;case 6:return e=n.pendingProps===""||e.nodeType!==3?null:e,e!==null?(n.stateNode=e,Lr=n,Mr=null,!0):!1;case 13:return e=e.nodeType!==8?null:e,e!==null?(t=xa!==null?{id:oi,overflow:ai}:null,n.memoizedState={dehydrated:e,treeContext:t,retryLane:1073741824},t=Jr(18,null,null,0),t.stateNode=e,t.return=n,n.child=t,Lr=n,Mr=null,!0):!1;default:return!1}}function __(n){return(n.mode&1)!==0&&(n.flags&128)===0}function v_(n){if(Ht){var e=Mr;if(e){var t=e;if(!aE(n,e)){if(__(n))throw Error(J(418));e=lo(t.nextSibling);var r=Lr;e&&aE(n,e)?zA(r,t):(n.flags=n.flags&-4097|2,Ht=!1,Lr=n)}}else{if(__(n))throw Error(J(418));n.flags=n.flags&-4097|2,Ht=!1,Lr=n}}}function lE(n){for(n=n.return;n!==null&&n.tag!==5&&n.tag!==3&&n.tag!==13;)n=n.return;Lr=n}function rf(n){if(n!==Lr)return!1;if(!Ht)return lE(n),Ht=!0,!1;var e;if((e=n.tag!==3)&&!(e=n.tag!==5)&&(e=n.type,e=e!=="head"&&e!=="body"&&!g_(n.type,n.memoizedProps)),e&&(e=Mr)){if(__(n))throw qA(),Error(J(418));for(;e;)zA(n,e),e=lo(e.nextSibling)}if(lE(n),n.tag===13){if(n=n.memoizedState,n=n!==null?n.dehydrated:null,!n)throw Error(J(317));e:{for(n=n.nextSibling,e=0;n;){if(n.nodeType===8){var t=n.data;if(t==="/$"){if(e===0){Mr=lo(n.nextSibling);break e}e--}else t!=="$"&&t!=="$!"&&t!=="$?"||e++}n=n.nextSibling}Mr=null}}else Mr=Lr?lo(n.stateNode.nextSibling):null;return!0}function qA(){for(var n=Mr;n;)n=lo(n.nextSibling)}function Jl(){Mr=Lr=null,Ht=!1}function i0(n){hs===null?hs=[n]:hs.push(n)}var eL=Ti.ReactCurrentBatchConfig;function ou(n,e,t){if(n=t.ref,n!==null&&typeof n!="function"&&typeof n!="object"){if(t._owner){if(t=t._owner,t){if(t.tag!==1)throw Error(J(309));var r=t.stateNode}if(!r)throw Error(J(147,n));var s=r,i=""+n;return e!==null&&e.ref!==null&&typeof e.ref=="function"&&e.ref._stringRef===i?e.ref:(e=function(o){var a=s.refs;o===null?delete a[i]:a[i]=o},e._stringRef=i,e)}if(typeof n!="string")throw Error(J(284));if(!t._owner)throw Error(J(290,n))}return n}function sf(n,e){throw n=Object.prototype.toString.call(e),Error(J(31,n==="[object Object]"?"object with keys {"+Object.keys(e).join(", ")+"}":n))}function cE(n){var e=n._init;return e(n._payload)}function WA(n){function e(A,I){if(n){var R=A.deletions;R===null?(A.deletions=[I],A.flags|=16):R.push(I)}}function t(A,I){if(!n)return null;for(;I!==null;)e(A,I),I=I.sibling;return null}function r(A,I){for(A=new Map;I!==null;)I.key!==null?A.set(I.key,I):A.set(I.index,I),I=I.sibling;return A}function s(A,I){return A=fo(A,I),A.index=0,A.sibling=null,A}function i(A,I,R){return A.index=R,n?(R=A.alternate,R!==null?(R=R.index,R<I?(A.flags|=2,I):R):(A.flags|=2,I)):(A.flags|=1048576,I)}function o(A){return n&&A.alternate===null&&(A.flags|=2),A}function a(A,I,R,D){return I===null||I.tag!==6?(I=dy(R,A.mode,D),I.return=A,I):(I=s(I,R),I.return=A,I)}function l(A,I,R,D){var V=R.type;return V===xl?h(A,I,R.props.children,D,R.key):I!==null&&(I.elementType===V||typeof V=="object"&&V!==null&&V.$$typeof===Bi&&cE(V)===I.type)?(D=s(I,R.props),D.ref=ou(A,I,R),D.return=A,D):(D=Vf(R.type,R.key,R.props,null,A.mode,D),D.ref=ou(A,I,R),D.return=A,D)}function u(A,I,R,D){return I===null||I.tag!==4||I.stateNode.containerInfo!==R.containerInfo||I.stateNode.implementation!==R.implementation?(I=hy(R,A.mode,D),I.return=A,I):(I=s(I,R.children||[]),I.return=A,I)}function h(A,I,R,D,V){return I===null||I.tag!==7?(I=ga(R,A.mode,D,V),I.return=A,I):(I=s(I,R),I.return=A,I)}function f(A,I,R){if(typeof I=="string"&&I!==""||typeof I=="number")return I=dy(""+I,A.mode,R),I.return=A,I;if(typeof I=="object"&&I!==null){switch(I.$$typeof){case Hh:return R=Vf(I.type,I.key,I.props,null,A.mode,R),R.ref=ou(A,null,I),R.return=A,R;case wl:return I=hy(I,A.mode,R),I.return=A,I;case Bi:var D=I._init;return f(A,D(I._payload),R)}if(wu(I)||tu(I))return I=ga(I,A.mode,R,null),I.return=A,I;sf(A,I)}return null}function g(A,I,R,D){var V=I!==null?I.key:null;if(typeof R=="string"&&R!==""||typeof R=="number")return V!==null?null:a(A,I,""+R,D);if(typeof R=="object"&&R!==null){switch(R.$$typeof){case Hh:return R.key===V?l(A,I,R,D):null;case wl:return R.key===V?u(A,I,R,D):null;case Bi:return V=R._init,g(A,I,V(R._payload),D)}if(wu(R)||tu(R))return V!==null?null:h(A,I,R,D,null);sf(A,R)}return null}function y(A,I,R,D,V){if(typeof D=="string"&&D!==""||typeof D=="number")return A=A.get(R)||null,a(I,A,""+D,V);if(typeof D=="object"&&D!==null){switch(D.$$typeof){case Hh:return A=A.get(D.key===null?R:D.key)||null,l(I,A,D,V);case wl:return A=A.get(D.key===null?R:D.key)||null,u(I,A,D,V);case Bi:var P=D._init;return y(A,I,R,P(D._payload),V)}if(wu(D)||tu(D))return A=A.get(R)||null,h(I,A,D,V,null);sf(I,D)}return null}function w(A,I,R,D){for(var V=null,P=null,S=I,v=I=0,b=null;S!==null&&v<R.length;v++){S.index>v?(b=S,S=null):b=S.sibling;var _=g(A,S,R[v],D);if(_===null){S===null&&(S=b);break}n&&S&&_.alternate===null&&e(A,S),I=i(_,I,v),P===null?V=_:P.sibling=_,P=_,S=b}if(v===R.length)return t(A,S),Ht&&Yo(A,v),V;if(S===null){for(;v<R.length;v++)S=f(A,R[v],D),S!==null&&(I=i(S,I,v),P===null?V=S:P.sibling=S,P=S);return Ht&&Yo(A,v),V}for(S=r(A,S);v<R.length;v++)b=y(S,A,v,R[v],D),b!==null&&(n&&b.alternate!==null&&S.delete(b.key===null?v:b.key),I=i(b,I,v),P===null?V=b:P.sibling=b,P=b);return n&&S.forEach(function(E){return e(A,E)}),Ht&&Yo(A,v),V}function C(A,I,R,D){var V=tu(R);if(typeof V!="function")throw Error(J(150));if(R=V.call(R),R==null)throw Error(J(151));for(var P=V=null,S=I,v=I=0,b=null,_=R.next();S!==null&&!_.done;v++,_=R.next()){S.index>v?(b=S,S=null):b=S.sibling;var E=g(A,S,_.value,D);if(E===null){S===null&&(S=b);break}n&&S&&E.alternate===null&&e(A,S),I=i(E,I,v),P===null?V=E:P.sibling=E,P=E,S=b}if(_.done)return t(A,S),Ht&&Yo(A,v),V;if(S===null){for(;!_.done;v++,_=R.next())_=f(A,_.value,D),_!==null&&(I=i(_,I,v),P===null?V=_:P.sibling=_,P=_);return Ht&&Yo(A,v),V}for(S=r(A,S);!_.done;v++,_=R.next())_=y(S,A,v,_.value,D),_!==null&&(n&&_.alternate!==null&&S.delete(_.key===null?v:_.key),I=i(_,I,v),P===null?V=_:P.sibling=_,P=_);return n&&S.forEach(function(N){return e(A,N)}),Ht&&Yo(A,v),V}function M(A,I,R,D){if(typeof R=="object"&&R!==null&&R.type===xl&&R.key===null&&(R=R.props.children),typeof R=="object"&&R!==null){switch(R.$$typeof){case Hh:e:{for(var V=R.key,P=I;P!==null;){if(P.key===V){if(V=R.type,V===xl){if(P.tag===7){t(A,P.sibling),I=s(P,R.props.children),I.return=A,A=I;break e}}else if(P.elementType===V||typeof V=="object"&&V!==null&&V.$$typeof===Bi&&cE(V)===P.type){t(A,P.sibling),I=s(P,R.props),I.ref=ou(A,P,R),I.return=A,A=I;break e}t(A,P);break}else e(A,P);P=P.sibling}R.type===xl?(I=ga(R.props.children,A.mode,D,R.key),I.return=A,A=I):(D=Vf(R.type,R.key,R.props,null,A.mode,D),D.ref=ou(A,I,R),D.return=A,A=D)}return o(A);case wl:e:{for(P=R.key;I!==null;){if(I.key===P)if(I.tag===4&&I.stateNode.containerInfo===R.containerInfo&&I.stateNode.implementation===R.implementation){t(A,I.sibling),I=s(I,R.children||[]),I.return=A,A=I;break e}else{t(A,I);break}else e(A,I);I=I.sibling}I=hy(R,A.mode,D),I.return=A,A=I}return o(A);case Bi:return P=R._init,M(A,I,P(R._payload),D)}if(wu(R))return w(A,I,R,D);if(tu(R))return C(A,I,R,D);sf(A,R)}return typeof R=="string"&&R!==""||typeof R=="number"?(R=""+R,I!==null&&I.tag===6?(t(A,I.sibling),I=s(I,R),I.return=A,A=I):(t(A,I),I=dy(R,A.mode,D),I.return=A,A=I),o(A)):t(A,I)}return M}var Xl=WA(!0),GA=WA(!1),pg=Oo(null),mg=null,Rl=null,o0=null;function a0(){o0=Rl=mg=null}function l0(n){var e=pg.current;$t(pg),n._currentValue=e}function w_(n,e,t){for(;n!==null;){var r=n.alternate;if((n.childLanes&e)!==e?(n.childLanes|=e,r!==null&&(r.childLanes|=e)):r!==null&&(r.childLanes&e)!==e&&(r.childLanes|=e),n===t)break;n=n.return}}function Fl(n,e){mg=n,o0=Rl=null,n=n.dependencies,n!==null&&n.firstContext!==null&&(n.lanes&e&&(pr=!0),n.firstContext=null)}function ts(n){var e=n._currentValue;if(o0!==n)if(n={context:n,memoizedValue:e,next:null},Rl===null){if(mg===null)throw Error(J(308));Rl=n,mg.dependencies={lanes:0,firstContext:n}}else Rl=Rl.next=n;return e}var aa=null;function c0(n){aa===null?aa=[n]:aa.push(n)}function HA(n,e,t,r){var s=e.interleaved;return s===null?(t.next=t,c0(e)):(t.next=s.next,s.next=t),e.interleaved=t,mi(n,r)}function mi(n,e){n.lanes|=e;var t=n.alternate;for(t!==null&&(t.lanes|=e),t=n,n=n.return;n!==null;)n.childLanes|=e,t=n.alternate,t!==null&&(t.childLanes|=e),t=n,n=n.return;return t.tag===3?t.stateNode:null}var zi=!1;function u0(n){n.updateQueue={baseState:n.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function KA(n,e){n=n.updateQueue,e.updateQueue===n&&(e.updateQueue={baseState:n.baseState,firstBaseUpdate:n.firstBaseUpdate,lastBaseUpdate:n.lastBaseUpdate,shared:n.shared,effects:n.effects})}function hi(n,e){return{eventTime:n,lane:e,tag:0,payload:null,callback:null,next:null}}function co(n,e,t){var r=n.updateQueue;if(r===null)return null;if(r=r.shared,ut&2){var s=r.pending;return s===null?e.next=e:(e.next=s.next,s.next=e),r.pending=e,mi(n,t)}return s=r.interleaved,s===null?(e.next=e,c0(r)):(e.next=s.next,s.next=e),r.interleaved=e,mi(n,t)}function kf(n,e,t){if(e=e.updateQueue,e!==null&&(e=e.shared,(t&4194240)!==0)){var r=e.lanes;r&=n.pendingLanes,t|=r,e.lanes=t,Qv(n,t)}}function uE(n,e){var t=n.updateQueue,r=n.alternate;if(r!==null&&(r=r.updateQueue,t===r)){var s=null,i=null;if(t=t.firstBaseUpdate,t!==null){do{var o={eventTime:t.eventTime,lane:t.lane,tag:t.tag,payload:t.payload,callback:t.callback,next:null};i===null?s=i=o:i=i.next=o,t=t.next}while(t!==null);i===null?s=i=e:i=i.next=e}else s=i=e;t={baseState:r.baseState,firstBaseUpdate:s,lastBaseUpdate:i,shared:r.shared,effects:r.effects},n.updateQueue=t;return}n=t.lastBaseUpdate,n===null?t.firstBaseUpdate=e:n.next=e,t.lastBaseUpdate=e}function yg(n,e,t,r){var s=n.updateQueue;zi=!1;var i=s.firstBaseUpdate,o=s.lastBaseUpdate,a=s.shared.pending;if(a!==null){s.shared.pending=null;var l=a,u=l.next;l.next=null,o===null?i=u:o.next=u,o=l;var h=n.alternate;h!==null&&(h=h.updateQueue,a=h.lastBaseUpdate,a!==o&&(a===null?h.firstBaseUpdate=u:a.next=u,h.lastBaseUpdate=l))}if(i!==null){var f=s.baseState;o=0,h=u=l=null,a=i;do{var g=a.lane,y=a.eventTime;if((r&g)===g){h!==null&&(h=h.next={eventTime:y,lane:0,tag:a.tag,payload:a.payload,callback:a.callback,next:null});e:{var w=n,C=a;switch(g=e,y=t,C.tag){case 1:if(w=C.payload,typeof w=="function"){f=w.call(y,f,g);break e}f=w;break e;case 3:w.flags=w.flags&-65537|128;case 0:if(w=C.payload,g=typeof w=="function"?w.call(y,f,g):w,g==null)break e;f=tn({},f,g);break e;case 2:zi=!0}}a.callback!==null&&a.lane!==0&&(n.flags|=64,g=s.effects,g===null?s.effects=[a]:g.push(a))}else y={eventTime:y,lane:g,tag:a.tag,payload:a.payload,callback:a.callback,next:null},h===null?(u=h=y,l=f):h=h.next=y,o|=g;if(a=a.next,a===null){if(a=s.shared.pending,a===null)break;g=a,a=g.next,g.next=null,s.lastBaseUpdate=g,s.shared.pending=null}}while(1);if(h===null&&(l=f),s.baseState=l,s.firstBaseUpdate=u,s.lastBaseUpdate=h,e=s.shared.interleaved,e!==null){s=e;do o|=s.lane,s=s.next;while(s!==e)}else i===null&&(s.shared.lanes=0);Ea|=o,n.lanes=o,n.memoizedState=f}}function dE(n,e,t){if(n=e.effects,e.effects=null,n!==null)for(e=0;e<n.length;e++){var r=n[e],s=r.callback;if(s!==null){if(r.callback=null,r=t,typeof s!="function")throw Error(J(191,s));s.call(r)}}}var nh={},Us=Oo(nh),md=Oo(nh),yd=Oo(nh);function la(n){if(n===nh)throw Error(J(174));return n}function d0(n,e){switch(Mt(yd,e),Mt(md,n),Mt(Us,nh),n=e.nodeType,n){case 9:case 11:e=(e=e.documentElement)?e.namespaceURI:e_(null,"");break;default:n=n===8?e.parentNode:e,e=n.namespaceURI||null,n=n.tagName,e=e_(e,n)}$t(Us),Mt(Us,e)}function Zl(){$t(Us),$t(md),$t(yd)}function QA(n){la(yd.current);var e=la(Us.current),t=e_(e,n.type);e!==t&&(Mt(md,n),Mt(Us,t))}function h0(n){md.current===n&&($t(Us),$t(md))}var Xt=Oo(0);function _g(n){for(var e=n;e!==null;){if(e.tag===13){var t=e.memoizedState;if(t!==null&&(t=t.dehydrated,t===null||t.data==="$?"||t.data==="$!"))return e}else if(e.tag===19&&e.memoizedProps.revealOrder!==void 0){if(e.flags&128)return e}else if(e.child!==null){e.child.return=e,e=e.child;continue}if(e===n)break;for(;e.sibling===null;){if(e.return===null||e.return===n)return null;e=e.return}e.sibling.return=e.return,e=e.sibling}return null}var iy=[];function f0(){for(var n=0;n<iy.length;n++)iy[n]._workInProgressVersionPrimary=null;iy.length=0}var Pf=Ti.ReactCurrentDispatcher,oy=Ti.ReactCurrentBatchConfig,Ia=0,en=null,vn=null,Cn=null,vg=!1,Ou=!1,_d=0,tL=0;function Qn(){throw Error(J(321))}function g0(n,e){if(e===null)return!1;for(var t=0;t<e.length&&t<n.length;t++)if(!vs(n[t],e[t]))return!1;return!0}function p0(n,e,t,r,s,i){if(Ia=i,en=e,e.memoizedState=null,e.updateQueue=null,e.lanes=0,Pf.current=n===null||n.memoizedState===null?iL:oL,n=t(r,s),Ou){i=0;do{if(Ou=!1,_d=0,25<=i)throw Error(J(301));i+=1,Cn=vn=null,e.updateQueue=null,Pf.current=aL,n=t(r,s)}while(Ou)}if(Pf.current=wg,e=vn!==null&&vn.next!==null,Ia=0,Cn=vn=en=null,vg=!1,e)throw Error(J(300));return n}function m0(){var n=_d!==0;return _d=0,n}function Rs(){var n={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return Cn===null?en.memoizedState=Cn=n:Cn=Cn.next=n,Cn}function ns(){if(vn===null){var n=en.alternate;n=n!==null?n.memoizedState:null}else n=vn.next;var e=Cn===null?en.memoizedState:Cn.next;if(e!==null)Cn=e,vn=n;else{if(n===null)throw Error(J(310));vn=n,n={memoizedState:vn.memoizedState,baseState:vn.baseState,baseQueue:vn.baseQueue,queue:vn.queue,next:null},Cn===null?en.memoizedState=Cn=n:Cn=Cn.next=n}return Cn}function vd(n,e){return typeof e=="function"?e(n):e}function ay(n){var e=ns(),t=e.queue;if(t===null)throw Error(J(311));t.lastRenderedReducer=n;var r=vn,s=r.baseQueue,i=t.pending;if(i!==null){if(s!==null){var o=s.next;s.next=i.next,i.next=o}r.baseQueue=s=i,t.pending=null}if(s!==null){i=s.next,r=r.baseState;var a=o=null,l=null,u=i;do{var h=u.lane;if((Ia&h)===h)l!==null&&(l=l.next={lane:0,action:u.action,hasEagerState:u.hasEagerState,eagerState:u.eagerState,next:null}),r=u.hasEagerState?u.eagerState:n(r,u.action);else{var f={lane:h,action:u.action,hasEagerState:u.hasEagerState,eagerState:u.eagerState,next:null};l===null?(a=l=f,o=r):l=l.next=f,en.lanes|=h,Ea|=h}u=u.next}while(u!==null&&u!==i);l===null?o=r:l.next=a,vs(r,e.memoizedState)||(pr=!0),e.memoizedState=r,e.baseState=o,e.baseQueue=l,t.lastRenderedState=r}if(n=t.interleaved,n!==null){s=n;do i=s.lane,en.lanes|=i,Ea|=i,s=s.next;while(s!==n)}else s===null&&(t.lanes=0);return[e.memoizedState,t.dispatch]}function ly(n){var e=ns(),t=e.queue;if(t===null)throw Error(J(311));t.lastRenderedReducer=n;var r=t.dispatch,s=t.pending,i=e.memoizedState;if(s!==null){t.pending=null;var o=s=s.next;do i=n(i,o.action),o=o.next;while(o!==s);vs(i,e.memoizedState)||(pr=!0),e.memoizedState=i,e.baseQueue===null&&(e.baseState=i),t.lastRenderedState=i}return[i,r]}function YA(){}function JA(n,e){var t=en,r=ns(),s=e(),i=!vs(r.memoizedState,s);if(i&&(r.memoizedState=s,pr=!0),r=r.queue,y0(e1.bind(null,t,r,n),[n]),r.getSnapshot!==e||i||Cn!==null&&Cn.memoizedState.tag&1){if(t.flags|=2048,wd(9,ZA.bind(null,t,r,s,e),void 0,null),kn===null)throw Error(J(349));Ia&30||XA(t,e,s)}return s}function XA(n,e,t){n.flags|=16384,n={getSnapshot:e,value:t},e=en.updateQueue,e===null?(e={lastEffect:null,stores:null},en.updateQueue=e,e.stores=[n]):(t=e.stores,t===null?e.stores=[n]:t.push(n))}function ZA(n,e,t,r){e.value=t,e.getSnapshot=r,t1(e)&&n1(n)}function e1(n,e,t){return t(function(){t1(e)&&n1(n)})}function t1(n){var e=n.getSnapshot;n=n.value;try{var t=e();return!vs(n,t)}catch{return!0}}function n1(n){var e=mi(n,1);e!==null&&ms(e,n,1,-1)}function hE(n){var e=Rs();return typeof n=="function"&&(n=n()),e.memoizedState=e.baseState=n,n={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:vd,lastRenderedState:n},e.queue=n,n=n.dispatch=sL.bind(null,en,n),[e.memoizedState,n]}function wd(n,e,t,r){return n={tag:n,create:e,destroy:t,deps:r,next:null},e=en.updateQueue,e===null?(e={lastEffect:null,stores:null},en.updateQueue=e,e.lastEffect=n.next=n):(t=e.lastEffect,t===null?e.lastEffect=n.next=n:(r=t.next,t.next=n,n.next=r,e.lastEffect=n)),n}function r1(){return ns().memoizedState}function Df(n,e,t,r){var s=Rs();en.flags|=n,s.memoizedState=wd(1|e,t,void 0,r===void 0?null:r)}function vp(n,e,t,r){var s=ns();r=r===void 0?null:r;var i=void 0;if(vn!==null){var o=vn.memoizedState;if(i=o.destroy,r!==null&&g0(r,o.deps)){s.memoizedState=wd(e,t,i,r);return}}en.flags|=n,s.memoizedState=wd(1|e,t,i,r)}function fE(n,e){return Df(8390656,8,n,e)}function y0(n,e){return vp(2048,8,n,e)}function s1(n,e){return vp(4,2,n,e)}function i1(n,e){return vp(4,4,n,e)}function o1(n,e){if(typeof e=="function")return n=n(),e(n),function(){e(null)};if(e!=null)return n=n(),e.current=n,function(){e.current=null}}function a1(n,e,t){return t=t!=null?t.concat([n]):null,vp(4,4,o1.bind(null,e,n),t)}function _0(){}function l1(n,e){var t=ns();e=e===void 0?null:e;var r=t.memoizedState;return r!==null&&e!==null&&g0(e,r[1])?r[0]:(t.memoizedState=[n,e],n)}function c1(n,e){var t=ns();e=e===void 0?null:e;var r=t.memoizedState;return r!==null&&e!==null&&g0(e,r[1])?r[0]:(n=n(),t.memoizedState=[n,e],n)}function u1(n,e,t){return Ia&21?(vs(t,e)||(t=pA(),en.lanes|=t,Ea|=t,n.baseState=!0),e):(n.baseState&&(n.baseState=!1,pr=!0),n.memoizedState=t)}function nL(n,e){var t=Et;Et=t!==0&&4>t?t:4,n(!0);var r=oy.transition;oy.transition={};try{n(!1),e()}finally{Et=t,oy.transition=r}}function d1(){return ns().memoizedState}function rL(n,e,t){var r=ho(n);if(t={lane:r,action:t,hasEagerState:!1,eagerState:null,next:null},h1(n))f1(e,t);else if(t=HA(n,e,t,r),t!==null){var s=ar();ms(t,n,r,s),g1(t,e,r)}}function sL(n,e,t){var r=ho(n),s={lane:r,action:t,hasEagerState:!1,eagerState:null,next:null};if(h1(n))f1(e,s);else{var i=n.alternate;if(n.lanes===0&&(i===null||i.lanes===0)&&(i=e.lastRenderedReducer,i!==null))try{var o=e.lastRenderedState,a=i(o,t);if(s.hasEagerState=!0,s.eagerState=a,vs(a,o)){var l=e.interleaved;l===null?(s.next=s,c0(e)):(s.next=l.next,l.next=s),e.interleaved=s;return}}catch{}finally{}t=HA(n,e,s,r),t!==null&&(s=ar(),ms(t,n,r,s),g1(t,e,r))}}function h1(n){var e=n.alternate;return n===en||e!==null&&e===en}function f1(n,e){Ou=vg=!0;var t=n.pending;t===null?e.next=e:(e.next=t.next,t.next=e),n.pending=e}function g1(n,e,t){if(t&4194240){var r=e.lanes;r&=n.pendingLanes,t|=r,e.lanes=t,Qv(n,t)}}var wg={readContext:ts,useCallback:Qn,useContext:Qn,useEffect:Qn,useImperativeHandle:Qn,useInsertionEffect:Qn,useLayoutEffect:Qn,useMemo:Qn,useReducer:Qn,useRef:Qn,useState:Qn,useDebugValue:Qn,useDeferredValue:Qn,useTransition:Qn,useMutableSource:Qn,useSyncExternalStore:Qn,useId:Qn,unstable_isNewReconciler:!1},iL={readContext:ts,useCallback:function(n,e){return Rs().memoizedState=[n,e===void 0?null:e],n},useContext:ts,useEffect:fE,useImperativeHandle:function(n,e,t){return t=t!=null?t.concat([n]):null,Df(4194308,4,o1.bind(null,e,n),t)},useLayoutEffect:function(n,e){return Df(4194308,4,n,e)},useInsertionEffect:function(n,e){return Df(4,2,n,e)},useMemo:function(n,e){var t=Rs();return e=e===void 0?null:e,n=n(),t.memoizedState=[n,e],n},useReducer:function(n,e,t){var r=Rs();return e=t!==void 0?t(e):e,r.memoizedState=r.baseState=e,n={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:n,lastRenderedState:e},r.queue=n,n=n.dispatch=rL.bind(null,en,n),[r.memoizedState,n]},useRef:function(n){var e=Rs();return n={current:n},e.memoizedState=n},useState:hE,useDebugValue:_0,useDeferredValue:function(n){return Rs().memoizedState=n},useTransition:function(){var n=hE(!1),e=n[0];return n=nL.bind(null,n[1]),Rs().memoizedState=n,[e,n]},useMutableSource:function(){},useSyncExternalStore:function(n,e,t){var r=en,s=Rs();if(Ht){if(t===void 0)throw Error(J(407));t=t()}else{if(t=e(),kn===null)throw Error(J(349));Ia&30||XA(r,e,t)}s.memoizedState=t;var i={value:t,getSnapshot:e};return s.queue=i,fE(e1.bind(null,r,i,n),[n]),r.flags|=2048,wd(9,ZA.bind(null,r,i,t,e),void 0,null),t},useId:function(){var n=Rs(),e=kn.identifierPrefix;if(Ht){var t=ai,r=oi;t=(r&~(1<<32-ps(r)-1)).toString(32)+t,e=":"+e+"R"+t,t=_d++,0<t&&(e+="H"+t.toString(32)),e+=":"}else t=tL++,e=":"+e+"r"+t.toString(32)+":";return n.memoizedState=e},unstable_isNewReconciler:!1},oL={readContext:ts,useCallback:l1,useContext:ts,useEffect:y0,useImperativeHandle:a1,useInsertionEffect:s1,useLayoutEffect:i1,useMemo:c1,useReducer:ay,useRef:r1,useState:function(){return ay(vd)},useDebugValue:_0,useDeferredValue:function(n){var e=ns();return u1(e,vn.memoizedState,n)},useTransition:function(){var n=ay(vd)[0],e=ns().memoizedState;return[n,e]},useMutableSource:YA,useSyncExternalStore:JA,useId:d1,unstable_isNewReconciler:!1},aL={readContext:ts,useCallback:l1,useContext:ts,useEffect:y0,useImperativeHandle:a1,useInsertionEffect:s1,useLayoutEffect:i1,useMemo:c1,useReducer:ly,useRef:r1,useState:function(){return ly(vd)},useDebugValue:_0,useDeferredValue:function(n){var e=ns();return vn===null?e.memoizedState=n:u1(e,vn.memoizedState,n)},useTransition:function(){var n=ly(vd)[0],e=ns().memoizedState;return[n,e]},useMutableSource:YA,useSyncExternalStore:JA,useId:d1,unstable_isNewReconciler:!1};function ls(n,e){if(n&&n.defaultProps){e=tn({},e),n=n.defaultProps;for(var t in n)e[t]===void 0&&(e[t]=n[t]);return e}return e}function x_(n,e,t,r){e=n.memoizedState,t=t(r,e),t=t==null?e:tn({},e,t),n.memoizedState=t,n.lanes===0&&(n.updateQueue.baseState=t)}var wp={isMounted:function(n){return(n=n._reactInternals)?za(n)===n:!1},enqueueSetState:function(n,e,t){n=n._reactInternals;var r=ar(),s=ho(n),i=hi(r,s);i.payload=e,t!=null&&(i.callback=t),e=co(n,i,s),e!==null&&(ms(e,n,s,r),kf(e,n,s))},enqueueReplaceState:function(n,e,t){n=n._reactInternals;var r=ar(),s=ho(n),i=hi(r,s);i.tag=1,i.payload=e,t!=null&&(i.callback=t),e=co(n,i,s),e!==null&&(ms(e,n,s,r),kf(e,n,s))},enqueueForceUpdate:function(n,e){n=n._reactInternals;var t=ar(),r=ho(n),s=hi(t,r);s.tag=2,e!=null&&(s.callback=e),e=co(n,s,r),e!==null&&(ms(e,n,r,t),kf(e,n,r))}};function gE(n,e,t,r,s,i,o){return n=n.stateNode,typeof n.shouldComponentUpdate=="function"?n.shouldComponentUpdate(r,i,o):e.prototype&&e.prototype.isPureReactComponent?!hd(t,r)||!hd(s,i):!0}function p1(n,e,t){var r=!1,s=Io,i=e.contextType;return typeof i=="object"&&i!==null?i=ts(i):(s=wr(e)?wa:rr.current,r=e.contextTypes,i=(r=r!=null)?Yl(n,s):Io),e=new e(t,i),n.memoizedState=e.state!==null&&e.state!==void 0?e.state:null,e.updater=wp,n.stateNode=e,e._reactInternals=n,r&&(n=n.stateNode,n.__reactInternalMemoizedUnmaskedChildContext=s,n.__reactInternalMemoizedMaskedChildContext=i),e}function pE(n,e,t,r){n=e.state,typeof e.componentWillReceiveProps=="function"&&e.componentWillReceiveProps(t,r),typeof e.UNSAFE_componentWillReceiveProps=="function"&&e.UNSAFE_componentWillReceiveProps(t,r),e.state!==n&&wp.enqueueReplaceState(e,e.state,null)}function I_(n,e,t,r){var s=n.stateNode;s.props=t,s.state=n.memoizedState,s.refs={},u0(n);var i=e.contextType;typeof i=="object"&&i!==null?s.context=ts(i):(i=wr(e)?wa:rr.current,s.context=Yl(n,i)),s.state=n.memoizedState,i=e.getDerivedStateFromProps,typeof i=="function"&&(x_(n,e,i,t),s.state=n.memoizedState),typeof e.getDerivedStateFromProps=="function"||typeof s.getSnapshotBeforeUpdate=="function"||typeof s.UNSAFE_componentWillMount!="function"&&typeof s.componentWillMount!="function"||(e=s.state,typeof s.componentWillMount=="function"&&s.componentWillMount(),typeof s.UNSAFE_componentWillMount=="function"&&s.UNSAFE_componentWillMount(),e!==s.state&&wp.enqueueReplaceState(s,s.state,null),yg(n,t,s,r),s.state=n.memoizedState),typeof s.componentDidMount=="function"&&(n.flags|=4194308)}function ec(n,e){try{var t="",r=e;do t+=L2(r),r=r.return;while(r);var s=t}catch(i){s=`
Error generating stack: `+i.message+`
`+i.stack}return{value:n,source:e,stack:s,digest:null}}function cy(n,e,t){return{value:n,source:null,stack:t??null,digest:e??null}}function E_(n,e){try{console.error(e.value)}catch(t){setTimeout(function(){throw t})}}var lL=typeof WeakMap=="function"?WeakMap:Map;function m1(n,e,t){t=hi(-1,t),t.tag=3,t.payload={element:null};var r=e.value;return t.callback=function(){Ig||(Ig=!0,D_=r),E_(n,e)},t}function y1(n,e,t){t=hi(-1,t),t.tag=3;var r=n.type.getDerivedStateFromError;if(typeof r=="function"){var s=e.value;t.payload=function(){return r(s)},t.callback=function(){E_(n,e)}}var i=n.stateNode;return i!==null&&typeof i.componentDidCatch=="function"&&(t.callback=function(){E_(n,e),typeof r!="function"&&(uo===null?uo=new Set([this]):uo.add(this));var o=e.stack;this.componentDidCatch(e.value,{componentStack:o!==null?o:""})}),t}function mE(n,e,t){var r=n.pingCache;if(r===null){r=n.pingCache=new lL;var s=new Set;r.set(e,s)}else s=r.get(e),s===void 0&&(s=new Set,r.set(e,s));s.has(t)||(s.add(t),n=IL.bind(null,n,e,t),e.then(n,n))}function yE(n){do{var e;if((e=n.tag===13)&&(e=n.memoizedState,e=e!==null?e.dehydrated!==null:!0),e)return n;n=n.return}while(n!==null);return null}function _E(n,e,t,r,s){return n.mode&1?(n.flags|=65536,n.lanes=s,n):(n===e?n.flags|=65536:(n.flags|=128,t.flags|=131072,t.flags&=-52805,t.tag===1&&(t.alternate===null?t.tag=17:(e=hi(-1,1),e.tag=2,co(t,e,1))),t.lanes|=1),n)}var cL=Ti.ReactCurrentOwner,pr=!1;function ir(n,e,t,r){e.child=n===null?GA(e,null,t,r):Xl(e,n.child,t,r)}function vE(n,e,t,r,s){t=t.render;var i=e.ref;return Fl(e,s),r=p0(n,e,t,r,i,s),t=m0(),n!==null&&!pr?(e.updateQueue=n.updateQueue,e.flags&=-2053,n.lanes&=~s,yi(n,e,s)):(Ht&&t&&r0(e),e.flags|=1,ir(n,e,r,s),e.child)}function wE(n,e,t,r,s){if(n===null){var i=t.type;return typeof i=="function"&&!b0(i)&&i.defaultProps===void 0&&t.compare===null&&t.defaultProps===void 0?(e.tag=15,e.type=i,_1(n,e,i,r,s)):(n=Vf(t.type,null,r,e,e.mode,s),n.ref=e.ref,n.return=e,e.child=n)}if(i=n.child,!(n.lanes&s)){var o=i.memoizedProps;if(t=t.compare,t=t!==null?t:hd,t(o,r)&&n.ref===e.ref)return yi(n,e,s)}return e.flags|=1,n=fo(i,r),n.ref=e.ref,n.return=e,e.child=n}function _1(n,e,t,r,s){if(n!==null){var i=n.memoizedProps;if(hd(i,r)&&n.ref===e.ref)if(pr=!1,e.pendingProps=r=i,(n.lanes&s)!==0)n.flags&131072&&(pr=!0);else return e.lanes=n.lanes,yi(n,e,s)}return S_(n,e,t,r,s)}function v1(n,e,t){var r=e.pendingProps,s=r.children,i=n!==null?n.memoizedState:null;if(r.mode==="hidden")if(!(e.mode&1))e.memoizedState={baseLanes:0,cachePool:null,transitions:null},Mt(kl,Rr),Rr|=t;else{if(!(t&1073741824))return n=i!==null?i.baseLanes|t:t,e.lanes=e.childLanes=1073741824,e.memoizedState={baseLanes:n,cachePool:null,transitions:null},e.updateQueue=null,Mt(kl,Rr),Rr|=n,null;e.memoizedState={baseLanes:0,cachePool:null,transitions:null},r=i!==null?i.baseLanes:t,Mt(kl,Rr),Rr|=r}else i!==null?(r=i.baseLanes|t,e.memoizedState=null):r=t,Mt(kl,Rr),Rr|=r;return ir(n,e,s,t),e.child}function w1(n,e){var t=e.ref;(n===null&&t!==null||n!==null&&n.ref!==t)&&(e.flags|=512,e.flags|=2097152)}function S_(n,e,t,r,s){var i=wr(t)?wa:rr.current;return i=Yl(e,i),Fl(e,s),t=p0(n,e,t,r,i,s),r=m0(),n!==null&&!pr?(e.updateQueue=n.updateQueue,e.flags&=-2053,n.lanes&=~s,yi(n,e,s)):(Ht&&r&&r0(e),e.flags|=1,ir(n,e,t,s),e.child)}function xE(n,e,t,r,s){if(wr(t)){var i=!0;hg(e)}else i=!1;if(Fl(e,s),e.stateNode===null)Mf(n,e),p1(e,t,r),I_(e,t,r,s),r=!0;else if(n===null){var o=e.stateNode,a=e.memoizedProps;o.props=a;var l=o.context,u=t.contextType;typeof u=="object"&&u!==null?u=ts(u):(u=wr(t)?wa:rr.current,u=Yl(e,u));var h=t.getDerivedStateFromProps,f=typeof h=="function"||typeof o.getSnapshotBeforeUpdate=="function";f||typeof o.UNSAFE_componentWillReceiveProps!="function"&&typeof o.componentWillReceiveProps!="function"||(a!==r||l!==u)&&pE(e,o,r,u),zi=!1;var g=e.memoizedState;o.state=g,yg(e,r,o,s),l=e.memoizedState,a!==r||g!==l||vr.current||zi?(typeof h=="function"&&(x_(e,t,h,r),l=e.memoizedState),(a=zi||gE(e,t,a,r,g,l,u))?(f||typeof o.UNSAFE_componentWillMount!="function"&&typeof o.componentWillMount!="function"||(typeof o.componentWillMount=="function"&&o.componentWillMount(),typeof o.UNSAFE_componentWillMount=="function"&&o.UNSAFE_componentWillMount()),typeof o.componentDidMount=="function"&&(e.flags|=4194308)):(typeof o.componentDidMount=="function"&&(e.flags|=4194308),e.memoizedProps=r,e.memoizedState=l),o.props=r,o.state=l,o.context=u,r=a):(typeof o.componentDidMount=="function"&&(e.flags|=4194308),r=!1)}else{o=e.stateNode,KA(n,e),a=e.memoizedProps,u=e.type===e.elementType?a:ls(e.type,a),o.props=u,f=e.pendingProps,g=o.context,l=t.contextType,typeof l=="object"&&l!==null?l=ts(l):(l=wr(t)?wa:rr.current,l=Yl(e,l));var y=t.getDerivedStateFromProps;(h=typeof y=="function"||typeof o.getSnapshotBeforeUpdate=="function")||typeof o.UNSAFE_componentWillReceiveProps!="function"&&typeof o.componentWillReceiveProps!="function"||(a!==f||g!==l)&&pE(e,o,r,l),zi=!1,g=e.memoizedState,o.state=g,yg(e,r,o,s);var w=e.memoizedState;a!==f||g!==w||vr.current||zi?(typeof y=="function"&&(x_(e,t,y,r),w=e.memoizedState),(u=zi||gE(e,t,u,r,g,w,l)||!1)?(h||typeof o.UNSAFE_componentWillUpdate!="function"&&typeof o.componentWillUpdate!="function"||(typeof o.componentWillUpdate=="function"&&o.componentWillUpdate(r,w,l),typeof o.UNSAFE_componentWillUpdate=="function"&&o.UNSAFE_componentWillUpdate(r,w,l)),typeof o.componentDidUpdate=="function"&&(e.flags|=4),typeof o.getSnapshotBeforeUpdate=="function"&&(e.flags|=1024)):(typeof o.componentDidUpdate!="function"||a===n.memoizedProps&&g===n.memoizedState||(e.flags|=4),typeof o.getSnapshotBeforeUpdate!="function"||a===n.memoizedProps&&g===n.memoizedState||(e.flags|=1024),e.memoizedProps=r,e.memoizedState=w),o.props=r,o.state=w,o.context=l,r=u):(typeof o.componentDidUpdate!="function"||a===n.memoizedProps&&g===n.memoizedState||(e.flags|=4),typeof o.getSnapshotBeforeUpdate!="function"||a===n.memoizedProps&&g===n.memoizedState||(e.flags|=1024),r=!1)}return T_(n,e,t,r,i,s)}function T_(n,e,t,r,s,i){w1(n,e);var o=(e.flags&128)!==0;if(!r&&!o)return s&&oE(e,t,!1),yi(n,e,i);r=e.stateNode,cL.current=e;var a=o&&typeof t.getDerivedStateFromError!="function"?null:r.render();return e.flags|=1,n!==null&&o?(e.child=Xl(e,n.child,null,i),e.child=Xl(e,null,a,i)):ir(n,e,a,i),e.memoizedState=r.state,s&&oE(e,t,!0),e.child}function x1(n){var e=n.stateNode;e.pendingContext?iE(n,e.pendingContext,e.pendingContext!==e.context):e.context&&iE(n,e.context,!1),d0(n,e.containerInfo)}function IE(n,e,t,r,s){return Jl(),i0(s),e.flags|=256,ir(n,e,t,r),e.child}var b_={dehydrated:null,treeContext:null,retryLane:0};function A_(n){return{baseLanes:n,cachePool:null,transitions:null}}function I1(n,e,t){var r=e.pendingProps,s=Xt.current,i=!1,o=(e.flags&128)!==0,a;if((a=o)||(a=n!==null&&n.memoizedState===null?!1:(s&2)!==0),a?(i=!0,e.flags&=-129):(n===null||n.memoizedState!==null)&&(s|=1),Mt(Xt,s&1),n===null)return v_(e),n=e.memoizedState,n!==null&&(n=n.dehydrated,n!==null)?(e.mode&1?n.data==="$!"?e.lanes=8:e.lanes=1073741824:e.lanes=1,null):(o=r.children,n=r.fallback,i?(r=e.mode,i=e.child,o={mode:"hidden",children:o},!(r&1)&&i!==null?(i.childLanes=0,i.pendingProps=o):i=Ep(o,r,0,null),n=ga(n,r,t,null),i.return=e,n.return=e,i.sibling=n,e.child=i,e.child.memoizedState=A_(t),e.memoizedState=b_,n):v0(e,o));if(s=n.memoizedState,s!==null&&(a=s.dehydrated,a!==null))return uL(n,e,o,r,a,s,t);if(i){i=r.fallback,o=e.mode,s=n.child,a=s.sibling;var l={mode:"hidden",children:r.children};return!(o&1)&&e.child!==s?(r=e.child,r.childLanes=0,r.pendingProps=l,e.deletions=null):(r=fo(s,l),r.subtreeFlags=s.subtreeFlags&14680064),a!==null?i=fo(a,i):(i=ga(i,o,t,null),i.flags|=2),i.return=e,r.return=e,r.sibling=i,e.child=r,r=i,i=e.child,o=n.child.memoizedState,o=o===null?A_(t):{baseLanes:o.baseLanes|t,cachePool:null,transitions:o.transitions},i.memoizedState=o,i.childLanes=n.childLanes&~t,e.memoizedState=b_,r}return i=n.child,n=i.sibling,r=fo(i,{mode:"visible",children:r.children}),!(e.mode&1)&&(r.lanes=t),r.return=e,r.sibling=null,n!==null&&(t=e.deletions,t===null?(e.deletions=[n],e.flags|=16):t.push(n)),e.child=r,e.memoizedState=null,r}function v0(n,e){return e=Ep({mode:"visible",children:e},n.mode,0,null),e.return=n,n.child=e}function of(n,e,t,r){return r!==null&&i0(r),Xl(e,n.child,null,t),n=v0(e,e.pendingProps.children),n.flags|=2,e.memoizedState=null,n}function uL(n,e,t,r,s,i,o){if(t)return e.flags&256?(e.flags&=-257,r=cy(Error(J(422))),of(n,e,o,r)):e.memoizedState!==null?(e.child=n.child,e.flags|=128,null):(i=r.fallback,s=e.mode,r=Ep({mode:"visible",children:r.children},s,0,null),i=ga(i,s,o,null),i.flags|=2,r.return=e,i.return=e,r.sibling=i,e.child=r,e.mode&1&&Xl(e,n.child,null,o),e.child.memoizedState=A_(o),e.memoizedState=b_,i);if(!(e.mode&1))return of(n,e,o,null);if(s.data==="$!"){if(r=s.nextSibling&&s.nextSibling.dataset,r)var a=r.dgst;return r=a,i=Error(J(419)),r=cy(i,r,void 0),of(n,e,o,r)}if(a=(o&n.childLanes)!==0,pr||a){if(r=kn,r!==null){switch(o&-o){case 4:s=2;break;case 16:s=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:s=32;break;case 536870912:s=268435456;break;default:s=0}s=s&(r.suspendedLanes|o)?0:s,s!==0&&s!==i.retryLane&&(i.retryLane=s,mi(n,s),ms(r,n,s,-1))}return T0(),r=cy(Error(J(421))),of(n,e,o,r)}return s.data==="$?"?(e.flags|=128,e.child=n.child,e=EL.bind(null,n),s._reactRetry=e,null):(n=i.treeContext,Mr=lo(s.nextSibling),Lr=e,Ht=!0,hs=null,n!==null&&(Kr[Qr++]=oi,Kr[Qr++]=ai,Kr[Qr++]=xa,oi=n.id,ai=n.overflow,xa=e),e=v0(e,r.children),e.flags|=4096,e)}function EE(n,e,t){n.lanes|=e;var r=n.alternate;r!==null&&(r.lanes|=e),w_(n.return,e,t)}function uy(n,e,t,r,s){var i=n.memoizedState;i===null?n.memoizedState={isBackwards:e,rendering:null,renderingStartTime:0,last:r,tail:t,tailMode:s}:(i.isBackwards=e,i.rendering=null,i.renderingStartTime=0,i.last=r,i.tail=t,i.tailMode=s)}function E1(n,e,t){var r=e.pendingProps,s=r.revealOrder,i=r.tail;if(ir(n,e,r.children,t),r=Xt.current,r&2)r=r&1|2,e.flags|=128;else{if(n!==null&&n.flags&128)e:for(n=e.child;n!==null;){if(n.tag===13)n.memoizedState!==null&&EE(n,t,e);else if(n.tag===19)EE(n,t,e);else if(n.child!==null){n.child.return=n,n=n.child;continue}if(n===e)break e;for(;n.sibling===null;){if(n.return===null||n.return===e)break e;n=n.return}n.sibling.return=n.return,n=n.sibling}r&=1}if(Mt(Xt,r),!(e.mode&1))e.memoizedState=null;else switch(s){case"forwards":for(t=e.child,s=null;t!==null;)n=t.alternate,n!==null&&_g(n)===null&&(s=t),t=t.sibling;t=s,t===null?(s=e.child,e.child=null):(s=t.sibling,t.sibling=null),uy(e,!1,s,t,i);break;case"backwards":for(t=null,s=e.child,e.child=null;s!==null;){if(n=s.alternate,n!==null&&_g(n)===null){e.child=s;break}n=s.sibling,s.sibling=t,t=s,s=n}uy(e,!0,t,null,i);break;case"together":uy(e,!1,null,null,void 0);break;default:e.memoizedState=null}return e.child}function Mf(n,e){!(e.mode&1)&&n!==null&&(n.alternate=null,e.alternate=null,e.flags|=2)}function yi(n,e,t){if(n!==null&&(e.dependencies=n.dependencies),Ea|=e.lanes,!(t&e.childLanes))return null;if(n!==null&&e.child!==n.child)throw Error(J(153));if(e.child!==null){for(n=e.child,t=fo(n,n.pendingProps),e.child=t,t.return=e;n.sibling!==null;)n=n.sibling,t=t.sibling=fo(n,n.pendingProps),t.return=e;t.sibling=null}return e.child}function dL(n,e,t){switch(e.tag){case 3:x1(e),Jl();break;case 5:QA(e);break;case 1:wr(e.type)&&hg(e);break;case 4:d0(e,e.stateNode.containerInfo);break;case 10:var r=e.type._context,s=e.memoizedProps.value;Mt(pg,r._currentValue),r._currentValue=s;break;case 13:if(r=e.memoizedState,r!==null)return r.dehydrated!==null?(Mt(Xt,Xt.current&1),e.flags|=128,null):t&e.child.childLanes?I1(n,e,t):(Mt(Xt,Xt.current&1),n=yi(n,e,t),n!==null?n.sibling:null);Mt(Xt,Xt.current&1);break;case 19:if(r=(t&e.childLanes)!==0,n.flags&128){if(r)return E1(n,e,t);e.flags|=128}if(s=e.memoizedState,s!==null&&(s.rendering=null,s.tail=null,s.lastEffect=null),Mt(Xt,Xt.current),r)break;return null;case 22:case 23:return e.lanes=0,v1(n,e,t)}return yi(n,e,t)}var S1,C_,T1,b1;S1=function(n,e){for(var t=e.child;t!==null;){if(t.tag===5||t.tag===6)n.appendChild(t.stateNode);else if(t.tag!==4&&t.child!==null){t.child.return=t,t=t.child;continue}if(t===e)break;for(;t.sibling===null;){if(t.return===null||t.return===e)return;t=t.return}t.sibling.return=t.return,t=t.sibling}};C_=function(){};T1=function(n,e,t,r){var s=n.memoizedProps;if(s!==r){n=e.stateNode,la(Us.current);var i=null;switch(t){case"input":s=Yy(n,s),r=Yy(n,r),i=[];break;case"select":s=tn({},s,{value:void 0}),r=tn({},r,{value:void 0}),i=[];break;case"textarea":s=Zy(n,s),r=Zy(n,r),i=[];break;default:typeof s.onClick!="function"&&typeof r.onClick=="function"&&(n.onclick=ug)}t_(t,r);var o;t=null;for(u in s)if(!r.hasOwnProperty(u)&&s.hasOwnProperty(u)&&s[u]!=null)if(u==="style"){var a=s[u];for(o in a)a.hasOwnProperty(o)&&(t||(t={}),t[o]="")}else u!=="dangerouslySetInnerHTML"&&u!=="children"&&u!=="suppressContentEditableWarning"&&u!=="suppressHydrationWarning"&&u!=="autoFocus"&&(id.hasOwnProperty(u)?i||(i=[]):(i=i||[]).push(u,null));for(u in r){var l=r[u];if(a=s!=null?s[u]:void 0,r.hasOwnProperty(u)&&l!==a&&(l!=null||a!=null))if(u==="style")if(a){for(o in a)!a.hasOwnProperty(o)||l&&l.hasOwnProperty(o)||(t||(t={}),t[o]="");for(o in l)l.hasOwnProperty(o)&&a[o]!==l[o]&&(t||(t={}),t[o]=l[o])}else t||(i||(i=[]),i.push(u,t)),t=l;else u==="dangerouslySetInnerHTML"?(l=l?l.__html:void 0,a=a?a.__html:void 0,l!=null&&a!==l&&(i=i||[]).push(u,l)):u==="children"?typeof l!="string"&&typeof l!="number"||(i=i||[]).push(u,""+l):u!=="suppressContentEditableWarning"&&u!=="suppressHydrationWarning"&&(id.hasOwnProperty(u)?(l!=null&&u==="onScroll"&&jt("scroll",n),i||a===l||(i=[])):(i=i||[]).push(u,l))}t&&(i=i||[]).push("style",t);var u=i;(e.updateQueue=u)&&(e.flags|=4)}};b1=function(n,e,t,r){t!==r&&(e.flags|=4)};function au(n,e){if(!Ht)switch(n.tailMode){case"hidden":e=n.tail;for(var t=null;e!==null;)e.alternate!==null&&(t=e),e=e.sibling;t===null?n.tail=null:t.sibling=null;break;case"collapsed":t=n.tail;for(var r=null;t!==null;)t.alternate!==null&&(r=t),t=t.sibling;r===null?e||n.tail===null?n.tail=null:n.tail.sibling=null:r.sibling=null}}function Yn(n){var e=n.alternate!==null&&n.alternate.child===n.child,t=0,r=0;if(e)for(var s=n.child;s!==null;)t|=s.lanes|s.childLanes,r|=s.subtreeFlags&14680064,r|=s.flags&14680064,s.return=n,s=s.sibling;else for(s=n.child;s!==null;)t|=s.lanes|s.childLanes,r|=s.subtreeFlags,r|=s.flags,s.return=n,s=s.sibling;return n.subtreeFlags|=r,n.childLanes=t,e}function hL(n,e,t){var r=e.pendingProps;switch(s0(e),e.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Yn(e),null;case 1:return wr(e.type)&&dg(),Yn(e),null;case 3:return r=e.stateNode,Zl(),$t(vr),$t(rr),f0(),r.pendingContext&&(r.context=r.pendingContext,r.pendingContext=null),(n===null||n.child===null)&&(rf(e)?e.flags|=4:n===null||n.memoizedState.isDehydrated&&!(e.flags&256)||(e.flags|=1024,hs!==null&&(O_(hs),hs=null))),C_(n,e),Yn(e),null;case 5:h0(e);var s=la(yd.current);if(t=e.type,n!==null&&e.stateNode!=null)T1(n,e,t,r,s),n.ref!==e.ref&&(e.flags|=512,e.flags|=2097152);else{if(!r){if(e.stateNode===null)throw Error(J(166));return Yn(e),null}if(n=la(Us.current),rf(e)){r=e.stateNode,t=e.type;var i=e.memoizedProps;switch(r[Ds]=e,r[pd]=i,n=(e.mode&1)!==0,t){case"dialog":jt("cancel",r),jt("close",r);break;case"iframe":case"object":case"embed":jt("load",r);break;case"video":case"audio":for(s=0;s<Iu.length;s++)jt(Iu[s],r);break;case"source":jt("error",r);break;case"img":case"image":case"link":jt("error",r),jt("load",r);break;case"details":jt("toggle",r);break;case"input":PI(r,i),jt("invalid",r);break;case"select":r._wrapperState={wasMultiple:!!i.multiple},jt("invalid",r);break;case"textarea":MI(r,i),jt("invalid",r)}t_(t,i),s=null;for(var o in i)if(i.hasOwnProperty(o)){var a=i[o];o==="children"?typeof a=="string"?r.textContent!==a&&(i.suppressHydrationWarning!==!0&&nf(r.textContent,a,n),s=["children",a]):typeof a=="number"&&r.textContent!==""+a&&(i.suppressHydrationWarning!==!0&&nf(r.textContent,a,n),s=["children",""+a]):id.hasOwnProperty(o)&&a!=null&&o==="onScroll"&&jt("scroll",r)}switch(t){case"input":Kh(r),DI(r,i,!0);break;case"textarea":Kh(r),LI(r);break;case"select":case"option":break;default:typeof i.onClick=="function"&&(r.onclick=ug)}r=s,e.updateQueue=r,r!==null&&(e.flags|=4)}else{o=s.nodeType===9?s:s.ownerDocument,n==="http://www.w3.org/1999/xhtml"&&(n=eA(t)),n==="http://www.w3.org/1999/xhtml"?t==="script"?(n=o.createElement("div"),n.innerHTML="<script><\/script>",n=n.removeChild(n.firstChild)):typeof r.is=="string"?n=o.createElement(t,{is:r.is}):(n=o.createElement(t),t==="select"&&(o=n,r.multiple?o.multiple=!0:r.size&&(o.size=r.size))):n=o.createElementNS(n,t),n[Ds]=e,n[pd]=r,S1(n,e,!1,!1),e.stateNode=n;e:{switch(o=n_(t,r),t){case"dialog":jt("cancel",n),jt("close",n),s=r;break;case"iframe":case"object":case"embed":jt("load",n),s=r;break;case"video":case"audio":for(s=0;s<Iu.length;s++)jt(Iu[s],n);s=r;break;case"source":jt("error",n),s=r;break;case"img":case"image":case"link":jt("error",n),jt("load",n),s=r;break;case"details":jt("toggle",n),s=r;break;case"input":PI(n,r),s=Yy(n,r),jt("invalid",n);break;case"option":s=r;break;case"select":n._wrapperState={wasMultiple:!!r.multiple},s=tn({},r,{value:void 0}),jt("invalid",n);break;case"textarea":MI(n,r),s=Zy(n,r),jt("invalid",n);break;default:s=r}t_(t,s),a=s;for(i in a)if(a.hasOwnProperty(i)){var l=a[i];i==="style"?rA(n,l):i==="dangerouslySetInnerHTML"?(l=l?l.__html:void 0,l!=null&&tA(n,l)):i==="children"?typeof l=="string"?(t!=="textarea"||l!=="")&&od(n,l):typeof l=="number"&&od(n,""+l):i!=="suppressContentEditableWarning"&&i!=="suppressHydrationWarning"&&i!=="autoFocus"&&(id.hasOwnProperty(i)?l!=null&&i==="onScroll"&&jt("scroll",n):l!=null&&zv(n,i,l,o))}switch(t){case"input":Kh(n),DI(n,r,!1);break;case"textarea":Kh(n),LI(n);break;case"option":r.value!=null&&n.setAttribute("value",""+xo(r.value));break;case"select":n.multiple=!!r.multiple,i=r.value,i!=null?Ml(n,!!r.multiple,i,!1):r.defaultValue!=null&&Ml(n,!!r.multiple,r.defaultValue,!0);break;default:typeof s.onClick=="function"&&(n.onclick=ug)}switch(t){case"button":case"input":case"select":case"textarea":r=!!r.autoFocus;break e;case"img":r=!0;break e;default:r=!1}}r&&(e.flags|=4)}e.ref!==null&&(e.flags|=512,e.flags|=2097152)}return Yn(e),null;case 6:if(n&&e.stateNode!=null)b1(n,e,n.memoizedProps,r);else{if(typeof r!="string"&&e.stateNode===null)throw Error(J(166));if(t=la(yd.current),la(Us.current),rf(e)){if(r=e.stateNode,t=e.memoizedProps,r[Ds]=e,(i=r.nodeValue!==t)&&(n=Lr,n!==null))switch(n.tag){case 3:nf(r.nodeValue,t,(n.mode&1)!==0);break;case 5:n.memoizedProps.suppressHydrationWarning!==!0&&nf(r.nodeValue,t,(n.mode&1)!==0)}i&&(e.flags|=4)}else r=(t.nodeType===9?t:t.ownerDocument).createTextNode(r),r[Ds]=e,e.stateNode=r}return Yn(e),null;case 13:if($t(Xt),r=e.memoizedState,n===null||n.memoizedState!==null&&n.memoizedState.dehydrated!==null){if(Ht&&Mr!==null&&e.mode&1&&!(e.flags&128))qA(),Jl(),e.flags|=98560,i=!1;else if(i=rf(e),r!==null&&r.dehydrated!==null){if(n===null){if(!i)throw Error(J(318));if(i=e.memoizedState,i=i!==null?i.dehydrated:null,!i)throw Error(J(317));i[Ds]=e}else Jl(),!(e.flags&128)&&(e.memoizedState=null),e.flags|=4;Yn(e),i=!1}else hs!==null&&(O_(hs),hs=null),i=!0;if(!i)return e.flags&65536?e:null}return e.flags&128?(e.lanes=t,e):(r=r!==null,r!==(n!==null&&n.memoizedState!==null)&&r&&(e.child.flags|=8192,e.mode&1&&(n===null||Xt.current&1?xn===0&&(xn=3):T0())),e.updateQueue!==null&&(e.flags|=4),Yn(e),null);case 4:return Zl(),C_(n,e),n===null&&fd(e.stateNode.containerInfo),Yn(e),null;case 10:return l0(e.type._context),Yn(e),null;case 17:return wr(e.type)&&dg(),Yn(e),null;case 19:if($t(Xt),i=e.memoizedState,i===null)return Yn(e),null;if(r=(e.flags&128)!==0,o=i.rendering,o===null)if(r)au(i,!1);else{if(xn!==0||n!==null&&n.flags&128)for(n=e.child;n!==null;){if(o=_g(n),o!==null){for(e.flags|=128,au(i,!1),r=o.updateQueue,r!==null&&(e.updateQueue=r,e.flags|=4),e.subtreeFlags=0,r=t,t=e.child;t!==null;)i=t,n=r,i.flags&=14680066,o=i.alternate,o===null?(i.childLanes=0,i.lanes=n,i.child=null,i.subtreeFlags=0,i.memoizedProps=null,i.memoizedState=null,i.updateQueue=null,i.dependencies=null,i.stateNode=null):(i.childLanes=o.childLanes,i.lanes=o.lanes,i.child=o.child,i.subtreeFlags=0,i.deletions=null,i.memoizedProps=o.memoizedProps,i.memoizedState=o.memoizedState,i.updateQueue=o.updateQueue,i.type=o.type,n=o.dependencies,i.dependencies=n===null?null:{lanes:n.lanes,firstContext:n.firstContext}),t=t.sibling;return Mt(Xt,Xt.current&1|2),e.child}n=n.sibling}i.tail!==null&&un()>tc&&(e.flags|=128,r=!0,au(i,!1),e.lanes=4194304)}else{if(!r)if(n=_g(o),n!==null){if(e.flags|=128,r=!0,t=n.updateQueue,t!==null&&(e.updateQueue=t,e.flags|=4),au(i,!0),i.tail===null&&i.tailMode==="hidden"&&!o.alternate&&!Ht)return Yn(e),null}else 2*un()-i.renderingStartTime>tc&&t!==1073741824&&(e.flags|=128,r=!0,au(i,!1),e.lanes=4194304);i.isBackwards?(o.sibling=e.child,e.child=o):(t=i.last,t!==null?t.sibling=o:e.child=o,i.last=o)}return i.tail!==null?(e=i.tail,i.rendering=e,i.tail=e.sibling,i.renderingStartTime=un(),e.sibling=null,t=Xt.current,Mt(Xt,r?t&1|2:t&1),e):(Yn(e),null);case 22:case 23:return S0(),r=e.memoizedState!==null,n!==null&&n.memoizedState!==null!==r&&(e.flags|=8192),r&&e.mode&1?Rr&1073741824&&(Yn(e),e.subtreeFlags&6&&(e.flags|=8192)):Yn(e),null;case 24:return null;case 25:return null}throw Error(J(156,e.tag))}function fL(n,e){switch(s0(e),e.tag){case 1:return wr(e.type)&&dg(),n=e.flags,n&65536?(e.flags=n&-65537|128,e):null;case 3:return Zl(),$t(vr),$t(rr),f0(),n=e.flags,n&65536&&!(n&128)?(e.flags=n&-65537|128,e):null;case 5:return h0(e),null;case 13:if($t(Xt),n=e.memoizedState,n!==null&&n.dehydrated!==null){if(e.alternate===null)throw Error(J(340));Jl()}return n=e.flags,n&65536?(e.flags=n&-65537|128,e):null;case 19:return $t(Xt),null;case 4:return Zl(),null;case 10:return l0(e.type._context),null;case 22:case 23:return S0(),null;case 24:return null;default:return null}}var af=!1,Zn=!1,gL=typeof WeakSet=="function"?WeakSet:Set,pe=null;function Nl(n,e){var t=n.ref;if(t!==null)if(typeof t=="function")try{t(null)}catch(r){on(n,e,r)}else t.current=null}function R_(n,e,t){try{t()}catch(r){on(n,e,r)}}var SE=!1;function pL(n,e){if(h_=ag,n=kA(),n0(n)){if("selectionStart"in n)var t={start:n.selectionStart,end:n.selectionEnd};else e:{t=(t=n.ownerDocument)&&t.defaultView||window;var r=t.getSelection&&t.getSelection();if(r&&r.rangeCount!==0){t=r.anchorNode;var s=r.anchorOffset,i=r.focusNode;r=r.focusOffset;try{t.nodeType,i.nodeType}catch{t=null;break e}var o=0,a=-1,l=-1,u=0,h=0,f=n,g=null;t:for(;;){for(var y;f!==t||s!==0&&f.nodeType!==3||(a=o+s),f!==i||r!==0&&f.nodeType!==3||(l=o+r),f.nodeType===3&&(o+=f.nodeValue.length),(y=f.firstChild)!==null;)g=f,f=y;for(;;){if(f===n)break t;if(g===t&&++u===s&&(a=o),g===i&&++h===r&&(l=o),(y=f.nextSibling)!==null)break;f=g,g=f.parentNode}f=y}t=a===-1||l===-1?null:{start:a,end:l}}else t=null}t=t||{start:0,end:0}}else t=null;for(f_={focusedElem:n,selectionRange:t},ag=!1,pe=e;pe!==null;)if(e=pe,n=e.child,(e.subtreeFlags&1028)!==0&&n!==null)n.return=e,pe=n;else for(;pe!==null;){e=pe;try{var w=e.alternate;if(e.flags&1024)switch(e.tag){case 0:case 11:case 15:break;case 1:if(w!==null){var C=w.memoizedProps,M=w.memoizedState,A=e.stateNode,I=A.getSnapshotBeforeUpdate(e.elementType===e.type?C:ls(e.type,C),M);A.__reactInternalSnapshotBeforeUpdate=I}break;case 3:var R=e.stateNode.containerInfo;R.nodeType===1?R.textContent="":R.nodeType===9&&R.documentElement&&R.removeChild(R.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(J(163))}}catch(D){on(e,e.return,D)}if(n=e.sibling,n!==null){n.return=e.return,pe=n;break}pe=e.return}return w=SE,SE=!1,w}function Vu(n,e,t){var r=e.updateQueue;if(r=r!==null?r.lastEffect:null,r!==null){var s=r=r.next;do{if((s.tag&n)===n){var i=s.destroy;s.destroy=void 0,i!==void 0&&R_(e,t,i)}s=s.next}while(s!==r)}}function xp(n,e){if(e=e.updateQueue,e=e!==null?e.lastEffect:null,e!==null){var t=e=e.next;do{if((t.tag&n)===n){var r=t.create;t.destroy=r()}t=t.next}while(t!==e)}}function N_(n){var e=n.ref;if(e!==null){var t=n.stateNode;switch(n.tag){case 5:n=t;break;default:n=t}typeof e=="function"?e(n):e.current=n}}function A1(n){var e=n.alternate;e!==null&&(n.alternate=null,A1(e)),n.child=null,n.deletions=null,n.sibling=null,n.tag===5&&(e=n.stateNode,e!==null&&(delete e[Ds],delete e[pd],delete e[m_],delete e[JM],delete e[XM])),n.stateNode=null,n.return=null,n.dependencies=null,n.memoizedProps=null,n.memoizedState=null,n.pendingProps=null,n.stateNode=null,n.updateQueue=null}function C1(n){return n.tag===5||n.tag===3||n.tag===4}function TE(n){e:for(;;){for(;n.sibling===null;){if(n.return===null||C1(n.return))return null;n=n.return}for(n.sibling.return=n.return,n=n.sibling;n.tag!==5&&n.tag!==6&&n.tag!==18;){if(n.flags&2||n.child===null||n.tag===4)continue e;n.child.return=n,n=n.child}if(!(n.flags&2))return n.stateNode}}function k_(n,e,t){var r=n.tag;if(r===5||r===6)n=n.stateNode,e?t.nodeType===8?t.parentNode.insertBefore(n,e):t.insertBefore(n,e):(t.nodeType===8?(e=t.parentNode,e.insertBefore(n,t)):(e=t,e.appendChild(n)),t=t._reactRootContainer,t!=null||e.onclick!==null||(e.onclick=ug));else if(r!==4&&(n=n.child,n!==null))for(k_(n,e,t),n=n.sibling;n!==null;)k_(n,e,t),n=n.sibling}function P_(n,e,t){var r=n.tag;if(r===5||r===6)n=n.stateNode,e?t.insertBefore(n,e):t.appendChild(n);else if(r!==4&&(n=n.child,n!==null))for(P_(n,e,t),n=n.sibling;n!==null;)P_(n,e,t),n=n.sibling}var jn=null,us=!1;function Vi(n,e,t){for(t=t.child;t!==null;)R1(n,e,t),t=t.sibling}function R1(n,e,t){if(js&&typeof js.onCommitFiberUnmount=="function")try{js.onCommitFiberUnmount(fp,t)}catch{}switch(t.tag){case 5:Zn||Nl(t,e);case 6:var r=jn,s=us;jn=null,Vi(n,e,t),jn=r,us=s,jn!==null&&(us?(n=jn,t=t.stateNode,n.nodeType===8?n.parentNode.removeChild(t):n.removeChild(t)):jn.removeChild(t.stateNode));break;case 18:jn!==null&&(us?(n=jn,t=t.stateNode,n.nodeType===8?ry(n.parentNode,t):n.nodeType===1&&ry(n,t),ud(n)):ry(jn,t.stateNode));break;case 4:r=jn,s=us,jn=t.stateNode.containerInfo,us=!0,Vi(n,e,t),jn=r,us=s;break;case 0:case 11:case 14:case 15:if(!Zn&&(r=t.updateQueue,r!==null&&(r=r.lastEffect,r!==null))){s=r=r.next;do{var i=s,o=i.destroy;i=i.tag,o!==void 0&&(i&2||i&4)&&R_(t,e,o),s=s.next}while(s!==r)}Vi(n,e,t);break;case 1:if(!Zn&&(Nl(t,e),r=t.stateNode,typeof r.componentWillUnmount=="function"))try{r.props=t.memoizedProps,r.state=t.memoizedState,r.componentWillUnmount()}catch(a){on(t,e,a)}Vi(n,e,t);break;case 21:Vi(n,e,t);break;case 22:t.mode&1?(Zn=(r=Zn)||t.memoizedState!==null,Vi(n,e,t),Zn=r):Vi(n,e,t);break;default:Vi(n,e,t)}}function bE(n){var e=n.updateQueue;if(e!==null){n.updateQueue=null;var t=n.stateNode;t===null&&(t=n.stateNode=new gL),e.forEach(function(r){var s=SL.bind(null,n,r);t.has(r)||(t.add(r),r.then(s,s))})}}function as(n,e){var t=e.deletions;if(t!==null)for(var r=0;r<t.length;r++){var s=t[r];try{var i=n,o=e,a=o;e:for(;a!==null;){switch(a.tag){case 5:jn=a.stateNode,us=!1;break e;case 3:jn=a.stateNode.containerInfo,us=!0;break e;case 4:jn=a.stateNode.containerInfo,us=!0;break e}a=a.return}if(jn===null)throw Error(J(160));R1(i,o,s),jn=null,us=!1;var l=s.alternate;l!==null&&(l.return=null),s.return=null}catch(u){on(s,e,u)}}if(e.subtreeFlags&12854)for(e=e.child;e!==null;)N1(e,n),e=e.sibling}function N1(n,e){var t=n.alternate,r=n.flags;switch(n.tag){case 0:case 11:case 14:case 15:if(as(e,n),Cs(n),r&4){try{Vu(3,n,n.return),xp(3,n)}catch(C){on(n,n.return,C)}try{Vu(5,n,n.return)}catch(C){on(n,n.return,C)}}break;case 1:as(e,n),Cs(n),r&512&&t!==null&&Nl(t,t.return);break;case 5:if(as(e,n),Cs(n),r&512&&t!==null&&Nl(t,t.return),n.flags&32){var s=n.stateNode;try{od(s,"")}catch(C){on(n,n.return,C)}}if(r&4&&(s=n.stateNode,s!=null)){var i=n.memoizedProps,o=t!==null?t.memoizedProps:i,a=n.type,l=n.updateQueue;if(n.updateQueue=null,l!==null)try{a==="input"&&i.type==="radio"&&i.name!=null&&Xb(s,i),n_(a,o);var u=n_(a,i);for(o=0;o<l.length;o+=2){var h=l[o],f=l[o+1];h==="style"?rA(s,f):h==="dangerouslySetInnerHTML"?tA(s,f):h==="children"?od(s,f):zv(s,h,f,u)}switch(a){case"input":Jy(s,i);break;case"textarea":Zb(s,i);break;case"select":var g=s._wrapperState.wasMultiple;s._wrapperState.wasMultiple=!!i.multiple;var y=i.value;y!=null?Ml(s,!!i.multiple,y,!1):g!==!!i.multiple&&(i.defaultValue!=null?Ml(s,!!i.multiple,i.defaultValue,!0):Ml(s,!!i.multiple,i.multiple?[]:"",!1))}s[pd]=i}catch(C){on(n,n.return,C)}}break;case 6:if(as(e,n),Cs(n),r&4){if(n.stateNode===null)throw Error(J(162));s=n.stateNode,i=n.memoizedProps;try{s.nodeValue=i}catch(C){on(n,n.return,C)}}break;case 3:if(as(e,n),Cs(n),r&4&&t!==null&&t.memoizedState.isDehydrated)try{ud(e.containerInfo)}catch(C){on(n,n.return,C)}break;case 4:as(e,n),Cs(n);break;case 13:as(e,n),Cs(n),s=n.child,s.flags&8192&&(i=s.memoizedState!==null,s.stateNode.isHidden=i,!i||s.alternate!==null&&s.alternate.memoizedState!==null||(I0=un())),r&4&&bE(n);break;case 22:if(h=t!==null&&t.memoizedState!==null,n.mode&1?(Zn=(u=Zn)||h,as(e,n),Zn=u):as(e,n),Cs(n),r&8192){if(u=n.memoizedState!==null,(n.stateNode.isHidden=u)&&!h&&n.mode&1)for(pe=n,h=n.child;h!==null;){for(f=pe=h;pe!==null;){switch(g=pe,y=g.child,g.tag){case 0:case 11:case 14:case 15:Vu(4,g,g.return);break;case 1:Nl(g,g.return);var w=g.stateNode;if(typeof w.componentWillUnmount=="function"){r=g,t=g.return;try{e=r,w.props=e.memoizedProps,w.state=e.memoizedState,w.componentWillUnmount()}catch(C){on(r,t,C)}}break;case 5:Nl(g,g.return);break;case 22:if(g.memoizedState!==null){CE(f);continue}}y!==null?(y.return=g,pe=y):CE(f)}h=h.sibling}e:for(h=null,f=n;;){if(f.tag===5){if(h===null){h=f;try{s=f.stateNode,u?(i=s.style,typeof i.setProperty=="function"?i.setProperty("display","none","important"):i.display="none"):(a=f.stateNode,l=f.memoizedProps.style,o=l!=null&&l.hasOwnProperty("display")?l.display:null,a.style.display=nA("display",o))}catch(C){on(n,n.return,C)}}}else if(f.tag===6){if(h===null)try{f.stateNode.nodeValue=u?"":f.memoizedProps}catch(C){on(n,n.return,C)}}else if((f.tag!==22&&f.tag!==23||f.memoizedState===null||f===n)&&f.child!==null){f.child.return=f,f=f.child;continue}if(f===n)break e;for(;f.sibling===null;){if(f.return===null||f.return===n)break e;h===f&&(h=null),f=f.return}h===f&&(h=null),f.sibling.return=f.return,f=f.sibling}}break;case 19:as(e,n),Cs(n),r&4&&bE(n);break;case 21:break;default:as(e,n),Cs(n)}}function Cs(n){var e=n.flags;if(e&2){try{e:{for(var t=n.return;t!==null;){if(C1(t)){var r=t;break e}t=t.return}throw Error(J(160))}switch(r.tag){case 5:var s=r.stateNode;r.flags&32&&(od(s,""),r.flags&=-33);var i=TE(n);P_(n,i,s);break;case 3:case 4:var o=r.stateNode.containerInfo,a=TE(n);k_(n,a,o);break;default:throw Error(J(161))}}catch(l){on(n,n.return,l)}n.flags&=-3}e&4096&&(n.flags&=-4097)}function mL(n,e,t){pe=n,k1(n)}function k1(n,e,t){for(var r=(n.mode&1)!==0;pe!==null;){var s=pe,i=s.child;if(s.tag===22&&r){var o=s.memoizedState!==null||af;if(!o){var a=s.alternate,l=a!==null&&a.memoizedState!==null||Zn;a=af;var u=Zn;if(af=o,(Zn=l)&&!u)for(pe=s;pe!==null;)o=pe,l=o.child,o.tag===22&&o.memoizedState!==null?RE(s):l!==null?(l.return=o,pe=l):RE(s);for(;i!==null;)pe=i,k1(i),i=i.sibling;pe=s,af=a,Zn=u}AE(n)}else s.subtreeFlags&8772&&i!==null?(i.return=s,pe=i):AE(n)}}function AE(n){for(;pe!==null;){var e=pe;if(e.flags&8772){var t=e.alternate;try{if(e.flags&8772)switch(e.tag){case 0:case 11:case 15:Zn||xp(5,e);break;case 1:var r=e.stateNode;if(e.flags&4&&!Zn)if(t===null)r.componentDidMount();else{var s=e.elementType===e.type?t.memoizedProps:ls(e.type,t.memoizedProps);r.componentDidUpdate(s,t.memoizedState,r.__reactInternalSnapshotBeforeUpdate)}var i=e.updateQueue;i!==null&&dE(e,i,r);break;case 3:var o=e.updateQueue;if(o!==null){if(t=null,e.child!==null)switch(e.child.tag){case 5:t=e.child.stateNode;break;case 1:t=e.child.stateNode}dE(e,o,t)}break;case 5:var a=e.stateNode;if(t===null&&e.flags&4){t=a;var l=e.memoizedProps;switch(e.type){case"button":case"input":case"select":case"textarea":l.autoFocus&&t.focus();break;case"img":l.src&&(t.src=l.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(e.memoizedState===null){var u=e.alternate;if(u!==null){var h=u.memoizedState;if(h!==null){var f=h.dehydrated;f!==null&&ud(f)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(J(163))}Zn||e.flags&512&&N_(e)}catch(g){on(e,e.return,g)}}if(e===n){pe=null;break}if(t=e.sibling,t!==null){t.return=e.return,pe=t;break}pe=e.return}}function CE(n){for(;pe!==null;){var e=pe;if(e===n){pe=null;break}var t=e.sibling;if(t!==null){t.return=e.return,pe=t;break}pe=e.return}}function RE(n){for(;pe!==null;){var e=pe;try{switch(e.tag){case 0:case 11:case 15:var t=e.return;try{xp(4,e)}catch(l){on(e,t,l)}break;case 1:var r=e.stateNode;if(typeof r.componentDidMount=="function"){var s=e.return;try{r.componentDidMount()}catch(l){on(e,s,l)}}var i=e.return;try{N_(e)}catch(l){on(e,i,l)}break;case 5:var o=e.return;try{N_(e)}catch(l){on(e,o,l)}}}catch(l){on(e,e.return,l)}if(e===n){pe=null;break}var a=e.sibling;if(a!==null){a.return=e.return,pe=a;break}pe=e.return}}var yL=Math.ceil,xg=Ti.ReactCurrentDispatcher,w0=Ti.ReactCurrentOwner,Zr=Ti.ReactCurrentBatchConfig,ut=0,kn=null,mn=null,Bn=0,Rr=0,kl=Oo(0),xn=0,xd=null,Ea=0,Ip=0,x0=0,Fu=null,gr=null,I0=0,tc=1/0,ni=null,Ig=!1,D_=null,uo=null,lf=!1,Xi=null,Eg=0,ju=0,M_=null,Lf=-1,Of=0;function ar(){return ut&6?un():Lf!==-1?Lf:Lf=un()}function ho(n){return n.mode&1?ut&2&&Bn!==0?Bn&-Bn:eL.transition!==null?(Of===0&&(Of=pA()),Of):(n=Et,n!==0||(n=window.event,n=n===void 0?16:IA(n.type)),n):1}function ms(n,e,t,r){if(50<ju)throw ju=0,M_=null,Error(J(185));Zd(n,t,r),(!(ut&2)||n!==kn)&&(n===kn&&(!(ut&2)&&(Ip|=t),xn===4&&Wi(n,Bn)),xr(n,r),t===1&&ut===0&&!(e.mode&1)&&(tc=un()+500,_p&&Vo()))}function xr(n,e){var t=n.callbackNode;eM(n,e);var r=og(n,n===kn?Bn:0);if(r===0)t!==null&&FI(t),n.callbackNode=null,n.callbackPriority=0;else if(e=r&-r,n.callbackPriority!==e){if(t!=null&&FI(t),e===1)n.tag===0?ZM(NE.bind(null,n)):$A(NE.bind(null,n)),QM(function(){!(ut&6)&&Vo()}),t=null;else{switch(mA(r)){case 1:t=Kv;break;case 4:t=fA;break;case 16:t=ig;break;case 536870912:t=gA;break;default:t=ig}t=j1(t,P1.bind(null,n))}n.callbackPriority=e,n.callbackNode=t}}function P1(n,e){if(Lf=-1,Of=0,ut&6)throw Error(J(327));var t=n.callbackNode;if(jl()&&n.callbackNode!==t)return null;var r=og(n,n===kn?Bn:0);if(r===0)return null;if(r&30||r&n.expiredLanes||e)e=Sg(n,r);else{e=r;var s=ut;ut|=2;var i=M1();(kn!==n||Bn!==e)&&(ni=null,tc=un()+500,fa(n,e));do try{wL();break}catch(a){D1(n,a)}while(1);a0(),xg.current=i,ut=s,mn!==null?e=0:(kn=null,Bn=0,e=xn)}if(e!==0){if(e===2&&(s=a_(n),s!==0&&(r=s,e=L_(n,s))),e===1)throw t=xd,fa(n,0),Wi(n,r),xr(n,un()),t;if(e===6)Wi(n,r);else{if(s=n.current.alternate,!(r&30)&&!_L(s)&&(e=Sg(n,r),e===2&&(i=a_(n),i!==0&&(r=i,e=L_(n,i))),e===1))throw t=xd,fa(n,0),Wi(n,r),xr(n,un()),t;switch(n.finishedWork=s,n.finishedLanes=r,e){case 0:case 1:throw Error(J(345));case 2:Jo(n,gr,ni);break;case 3:if(Wi(n,r),(r&130023424)===r&&(e=I0+500-un(),10<e)){if(og(n,0)!==0)break;if(s=n.suspendedLanes,(s&r)!==r){ar(),n.pingedLanes|=n.suspendedLanes&s;break}n.timeoutHandle=p_(Jo.bind(null,n,gr,ni),e);break}Jo(n,gr,ni);break;case 4:if(Wi(n,r),(r&4194240)===r)break;for(e=n.eventTimes,s=-1;0<r;){var o=31-ps(r);i=1<<o,o=e[o],o>s&&(s=o),r&=~i}if(r=s,r=un()-r,r=(120>r?120:480>r?480:1080>r?1080:1920>r?1920:3e3>r?3e3:4320>r?4320:1960*yL(r/1960))-r,10<r){n.timeoutHandle=p_(Jo.bind(null,n,gr,ni),r);break}Jo(n,gr,ni);break;case 5:Jo(n,gr,ni);break;default:throw Error(J(329))}}}return xr(n,un()),n.callbackNode===t?P1.bind(null,n):null}function L_(n,e){var t=Fu;return n.current.memoizedState.isDehydrated&&(fa(n,e).flags|=256),n=Sg(n,e),n!==2&&(e=gr,gr=t,e!==null&&O_(e)),n}function O_(n){gr===null?gr=n:gr.push.apply(gr,n)}function _L(n){for(var e=n;;){if(e.flags&16384){var t=e.updateQueue;if(t!==null&&(t=t.stores,t!==null))for(var r=0;r<t.length;r++){var s=t[r],i=s.getSnapshot;s=s.value;try{if(!vs(i(),s))return!1}catch{return!1}}}if(t=e.child,e.subtreeFlags&16384&&t!==null)t.return=e,e=t;else{if(e===n)break;for(;e.sibling===null;){if(e.return===null||e.return===n)return!0;e=e.return}e.sibling.return=e.return,e=e.sibling}}return!0}function Wi(n,e){for(e&=~x0,e&=~Ip,n.suspendedLanes|=e,n.pingedLanes&=~e,n=n.expirationTimes;0<e;){var t=31-ps(e),r=1<<t;n[t]=-1,e&=~r}}function NE(n){if(ut&6)throw Error(J(327));jl();var e=og(n,0);if(!(e&1))return xr(n,un()),null;var t=Sg(n,e);if(n.tag!==0&&t===2){var r=a_(n);r!==0&&(e=r,t=L_(n,r))}if(t===1)throw t=xd,fa(n,0),Wi(n,e),xr(n,un()),t;if(t===6)throw Error(J(345));return n.finishedWork=n.current.alternate,n.finishedLanes=e,Jo(n,gr,ni),xr(n,un()),null}function E0(n,e){var t=ut;ut|=1;try{return n(e)}finally{ut=t,ut===0&&(tc=un()+500,_p&&Vo())}}function Sa(n){Xi!==null&&Xi.tag===0&&!(ut&6)&&jl();var e=ut;ut|=1;var t=Zr.transition,r=Et;try{if(Zr.transition=null,Et=1,n)return n()}finally{Et=r,Zr.transition=t,ut=e,!(ut&6)&&Vo()}}function S0(){Rr=kl.current,$t(kl)}function fa(n,e){n.finishedWork=null,n.finishedLanes=0;var t=n.timeoutHandle;if(t!==-1&&(n.timeoutHandle=-1,KM(t)),mn!==null)for(t=mn.return;t!==null;){var r=t;switch(s0(r),r.tag){case 1:r=r.type.childContextTypes,r!=null&&dg();break;case 3:Zl(),$t(vr),$t(rr),f0();break;case 5:h0(r);break;case 4:Zl();break;case 13:$t(Xt);break;case 19:$t(Xt);break;case 10:l0(r.type._context);break;case 22:case 23:S0()}t=t.return}if(kn=n,mn=n=fo(n.current,null),Bn=Rr=e,xn=0,xd=null,x0=Ip=Ea=0,gr=Fu=null,aa!==null){for(e=0;e<aa.length;e++)if(t=aa[e],r=t.interleaved,r!==null){t.interleaved=null;var s=r.next,i=t.pending;if(i!==null){var o=i.next;i.next=s,r.next=o}t.pending=r}aa=null}return n}function D1(n,e){do{var t=mn;try{if(a0(),Pf.current=wg,vg){for(var r=en.memoizedState;r!==null;){var s=r.queue;s!==null&&(s.pending=null),r=r.next}vg=!1}if(Ia=0,Cn=vn=en=null,Ou=!1,_d=0,w0.current=null,t===null||t.return===null){xn=1,xd=e,mn=null;break}e:{var i=n,o=t.return,a=t,l=e;if(e=Bn,a.flags|=32768,l!==null&&typeof l=="object"&&typeof l.then=="function"){var u=l,h=a,f=h.tag;if(!(h.mode&1)&&(f===0||f===11||f===15)){var g=h.alternate;g?(h.updateQueue=g.updateQueue,h.memoizedState=g.memoizedState,h.lanes=g.lanes):(h.updateQueue=null,h.memoizedState=null)}var y=yE(o);if(y!==null){y.flags&=-257,_E(y,o,a,i,e),y.mode&1&&mE(i,u,e),e=y,l=u;var w=e.updateQueue;if(w===null){var C=new Set;C.add(l),e.updateQueue=C}else w.add(l);break e}else{if(!(e&1)){mE(i,u,e),T0();break e}l=Error(J(426))}}else if(Ht&&a.mode&1){var M=yE(o);if(M!==null){!(M.flags&65536)&&(M.flags|=256),_E(M,o,a,i,e),i0(ec(l,a));break e}}i=l=ec(l,a),xn!==4&&(xn=2),Fu===null?Fu=[i]:Fu.push(i),i=o;do{switch(i.tag){case 3:i.flags|=65536,e&=-e,i.lanes|=e;var A=m1(i,l,e);uE(i,A);break e;case 1:a=l;var I=i.type,R=i.stateNode;if(!(i.flags&128)&&(typeof I.getDerivedStateFromError=="function"||R!==null&&typeof R.componentDidCatch=="function"&&(uo===null||!uo.has(R)))){i.flags|=65536,e&=-e,i.lanes|=e;var D=y1(i,a,e);uE(i,D);break e}}i=i.return}while(i!==null)}O1(t)}catch(V){e=V,mn===t&&t!==null&&(mn=t=t.return);continue}break}while(1)}function M1(){var n=xg.current;return xg.current=wg,n===null?wg:n}function T0(){(xn===0||xn===3||xn===2)&&(xn=4),kn===null||!(Ea&268435455)&&!(Ip&268435455)||Wi(kn,Bn)}function Sg(n,e){var t=ut;ut|=2;var r=M1();(kn!==n||Bn!==e)&&(ni=null,fa(n,e));do try{vL();break}catch(s){D1(n,s)}while(1);if(a0(),ut=t,xg.current=r,mn!==null)throw Error(J(261));return kn=null,Bn=0,xn}function vL(){for(;mn!==null;)L1(mn)}function wL(){for(;mn!==null&&!W2();)L1(mn)}function L1(n){var e=F1(n.alternate,n,Rr);n.memoizedProps=n.pendingProps,e===null?O1(n):mn=e,w0.current=null}function O1(n){var e=n;do{var t=e.alternate;if(n=e.return,e.flags&32768){if(t=fL(t,e),t!==null){t.flags&=32767,mn=t;return}if(n!==null)n.flags|=32768,n.subtreeFlags=0,n.deletions=null;else{xn=6,mn=null;return}}else if(t=hL(t,e,Rr),t!==null){mn=t;return}if(e=e.sibling,e!==null){mn=e;return}mn=e=n}while(e!==null);xn===0&&(xn=5)}function Jo(n,e,t){var r=Et,s=Zr.transition;try{Zr.transition=null,Et=1,xL(n,e,t,r)}finally{Zr.transition=s,Et=r}return null}function xL(n,e,t,r){do jl();while(Xi!==null);if(ut&6)throw Error(J(327));t=n.finishedWork;var s=n.finishedLanes;if(t===null)return null;if(n.finishedWork=null,n.finishedLanes=0,t===n.current)throw Error(J(177));n.callbackNode=null,n.callbackPriority=0;var i=t.lanes|t.childLanes;if(tM(n,i),n===kn&&(mn=kn=null,Bn=0),!(t.subtreeFlags&2064)&&!(t.flags&2064)||lf||(lf=!0,j1(ig,function(){return jl(),null})),i=(t.flags&15990)!==0,t.subtreeFlags&15990||i){i=Zr.transition,Zr.transition=null;var o=Et;Et=1;var a=ut;ut|=4,w0.current=null,pL(n,t),N1(t,n),$M(f_),ag=!!h_,f_=h_=null,n.current=t,mL(t),G2(),ut=a,Et=o,Zr.transition=i}else n.current=t;if(lf&&(lf=!1,Xi=n,Eg=s),i=n.pendingLanes,i===0&&(uo=null),Q2(t.stateNode),xr(n,un()),e!==null)for(r=n.onRecoverableError,t=0;t<e.length;t++)s=e[t],r(s.value,{componentStack:s.stack,digest:s.digest});if(Ig)throw Ig=!1,n=D_,D_=null,n;return Eg&1&&n.tag!==0&&jl(),i=n.pendingLanes,i&1?n===M_?ju++:(ju=0,M_=n):ju=0,Vo(),null}function jl(){if(Xi!==null){var n=mA(Eg),e=Zr.transition,t=Et;try{if(Zr.transition=null,Et=16>n?16:n,Xi===null)var r=!1;else{if(n=Xi,Xi=null,Eg=0,ut&6)throw Error(J(331));var s=ut;for(ut|=4,pe=n.current;pe!==null;){var i=pe,o=i.child;if(pe.flags&16){var a=i.deletions;if(a!==null){for(var l=0;l<a.length;l++){var u=a[l];for(pe=u;pe!==null;){var h=pe;switch(h.tag){case 0:case 11:case 15:Vu(8,h,i)}var f=h.child;if(f!==null)f.return=h,pe=f;else for(;pe!==null;){h=pe;var g=h.sibling,y=h.return;if(A1(h),h===u){pe=null;break}if(g!==null){g.return=y,pe=g;break}pe=y}}}var w=i.alternate;if(w!==null){var C=w.child;if(C!==null){w.child=null;do{var M=C.sibling;C.sibling=null,C=M}while(C!==null)}}pe=i}}if(i.subtreeFlags&2064&&o!==null)o.return=i,pe=o;else e:for(;pe!==null;){if(i=pe,i.flags&2048)switch(i.tag){case 0:case 11:case 15:Vu(9,i,i.return)}var A=i.sibling;if(A!==null){A.return=i.return,pe=A;break e}pe=i.return}}var I=n.current;for(pe=I;pe!==null;){o=pe;var R=o.child;if(o.subtreeFlags&2064&&R!==null)R.return=o,pe=R;else e:for(o=I;pe!==null;){if(a=pe,a.flags&2048)try{switch(a.tag){case 0:case 11:case 15:xp(9,a)}}catch(V){on(a,a.return,V)}if(a===o){pe=null;break e}var D=a.sibling;if(D!==null){D.return=a.return,pe=D;break e}pe=a.return}}if(ut=s,Vo(),js&&typeof js.onPostCommitFiberRoot=="function")try{js.onPostCommitFiberRoot(fp,n)}catch{}r=!0}return r}finally{Et=t,Zr.transition=e}}return!1}function kE(n,e,t){e=ec(t,e),e=m1(n,e,1),n=co(n,e,1),e=ar(),n!==null&&(Zd(n,1,e),xr(n,e))}function on(n,e,t){if(n.tag===3)kE(n,n,t);else for(;e!==null;){if(e.tag===3){kE(e,n,t);break}else if(e.tag===1){var r=e.stateNode;if(typeof e.type.getDerivedStateFromError=="function"||typeof r.componentDidCatch=="function"&&(uo===null||!uo.has(r))){n=ec(t,n),n=y1(e,n,1),e=co(e,n,1),n=ar(),e!==null&&(Zd(e,1,n),xr(e,n));break}}e=e.return}}function IL(n,e,t){var r=n.pingCache;r!==null&&r.delete(e),e=ar(),n.pingedLanes|=n.suspendedLanes&t,kn===n&&(Bn&t)===t&&(xn===4||xn===3&&(Bn&130023424)===Bn&&500>un()-I0?fa(n,0):x0|=t),xr(n,e)}function V1(n,e){e===0&&(n.mode&1?(e=Jh,Jh<<=1,!(Jh&130023424)&&(Jh=4194304)):e=1);var t=ar();n=mi(n,e),n!==null&&(Zd(n,e,t),xr(n,t))}function EL(n){var e=n.memoizedState,t=0;e!==null&&(t=e.retryLane),V1(n,t)}function SL(n,e){var t=0;switch(n.tag){case 13:var r=n.stateNode,s=n.memoizedState;s!==null&&(t=s.retryLane);break;case 19:r=n.stateNode;break;default:throw Error(J(314))}r!==null&&r.delete(e),V1(n,t)}var F1;F1=function(n,e,t){if(n!==null)if(n.memoizedProps!==e.pendingProps||vr.current)pr=!0;else{if(!(n.lanes&t)&&!(e.flags&128))return pr=!1,dL(n,e,t);pr=!!(n.flags&131072)}else pr=!1,Ht&&e.flags&1048576&&BA(e,gg,e.index);switch(e.lanes=0,e.tag){case 2:var r=e.type;Mf(n,e),n=e.pendingProps;var s=Yl(e,rr.current);Fl(e,t),s=p0(null,e,r,n,s,t);var i=m0();return e.flags|=1,typeof s=="object"&&s!==null&&typeof s.render=="function"&&s.$$typeof===void 0?(e.tag=1,e.memoizedState=null,e.updateQueue=null,wr(r)?(i=!0,hg(e)):i=!1,e.memoizedState=s.state!==null&&s.state!==void 0?s.state:null,u0(e),s.updater=wp,e.stateNode=s,s._reactInternals=e,I_(e,r,n,t),e=T_(null,e,r,!0,i,t)):(e.tag=0,Ht&&i&&r0(e),ir(null,e,s,t),e=e.child),e;case 16:r=e.elementType;e:{switch(Mf(n,e),n=e.pendingProps,s=r._init,r=s(r._payload),e.type=r,s=e.tag=bL(r),n=ls(r,n),s){case 0:e=S_(null,e,r,n,t);break e;case 1:e=xE(null,e,r,n,t);break e;case 11:e=vE(null,e,r,n,t);break e;case 14:e=wE(null,e,r,ls(r.type,n),t);break e}throw Error(J(306,r,""))}return e;case 0:return r=e.type,s=e.pendingProps,s=e.elementType===r?s:ls(r,s),S_(n,e,r,s,t);case 1:return r=e.type,s=e.pendingProps,s=e.elementType===r?s:ls(r,s),xE(n,e,r,s,t);case 3:e:{if(x1(e),n===null)throw Error(J(387));r=e.pendingProps,i=e.memoizedState,s=i.element,KA(n,e),yg(e,r,null,t);var o=e.memoizedState;if(r=o.element,i.isDehydrated)if(i={element:r,isDehydrated:!1,cache:o.cache,pendingSuspenseBoundaries:o.pendingSuspenseBoundaries,transitions:o.transitions},e.updateQueue.baseState=i,e.memoizedState=i,e.flags&256){s=ec(Error(J(423)),e),e=IE(n,e,r,t,s);break e}else if(r!==s){s=ec(Error(J(424)),e),e=IE(n,e,r,t,s);break e}else for(Mr=lo(e.stateNode.containerInfo.firstChild),Lr=e,Ht=!0,hs=null,t=GA(e,null,r,t),e.child=t;t;)t.flags=t.flags&-3|4096,t=t.sibling;else{if(Jl(),r===s){e=yi(n,e,t);break e}ir(n,e,r,t)}e=e.child}return e;case 5:return QA(e),n===null&&v_(e),r=e.type,s=e.pendingProps,i=n!==null?n.memoizedProps:null,o=s.children,g_(r,s)?o=null:i!==null&&g_(r,i)&&(e.flags|=32),w1(n,e),ir(n,e,o,t),e.child;case 6:return n===null&&v_(e),null;case 13:return I1(n,e,t);case 4:return d0(e,e.stateNode.containerInfo),r=e.pendingProps,n===null?e.child=Xl(e,null,r,t):ir(n,e,r,t),e.child;case 11:return r=e.type,s=e.pendingProps,s=e.elementType===r?s:ls(r,s),vE(n,e,r,s,t);case 7:return ir(n,e,e.pendingProps,t),e.child;case 8:return ir(n,e,e.pendingProps.children,t),e.child;case 12:return ir(n,e,e.pendingProps.children,t),e.child;case 10:e:{if(r=e.type._context,s=e.pendingProps,i=e.memoizedProps,o=s.value,Mt(pg,r._currentValue),r._currentValue=o,i!==null)if(vs(i.value,o)){if(i.children===s.children&&!vr.current){e=yi(n,e,t);break e}}else for(i=e.child,i!==null&&(i.return=e);i!==null;){var a=i.dependencies;if(a!==null){o=i.child;for(var l=a.firstContext;l!==null;){if(l.context===r){if(i.tag===1){l=hi(-1,t&-t),l.tag=2;var u=i.updateQueue;if(u!==null){u=u.shared;var h=u.pending;h===null?l.next=l:(l.next=h.next,h.next=l),u.pending=l}}i.lanes|=t,l=i.alternate,l!==null&&(l.lanes|=t),w_(i.return,t,e),a.lanes|=t;break}l=l.next}}else if(i.tag===10)o=i.type===e.type?null:i.child;else if(i.tag===18){if(o=i.return,o===null)throw Error(J(341));o.lanes|=t,a=o.alternate,a!==null&&(a.lanes|=t),w_(o,t,e),o=i.sibling}else o=i.child;if(o!==null)o.return=i;else for(o=i;o!==null;){if(o===e){o=null;break}if(i=o.sibling,i!==null){i.return=o.return,o=i;break}o=o.return}i=o}ir(n,e,s.children,t),e=e.child}return e;case 9:return s=e.type,r=e.pendingProps.children,Fl(e,t),s=ts(s),r=r(s),e.flags|=1,ir(n,e,r,t),e.child;case 14:return r=e.type,s=ls(r,e.pendingProps),s=ls(r.type,s),wE(n,e,r,s,t);case 15:return _1(n,e,e.type,e.pendingProps,t);case 17:return r=e.type,s=e.pendingProps,s=e.elementType===r?s:ls(r,s),Mf(n,e),e.tag=1,wr(r)?(n=!0,hg(e)):n=!1,Fl(e,t),p1(e,r,s),I_(e,r,s,t),T_(null,e,r,!0,n,t);case 19:return E1(n,e,t);case 22:return v1(n,e,t)}throw Error(J(156,e.tag))};function j1(n,e){return hA(n,e)}function TL(n,e,t,r){this.tag=n,this.key=t,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=e,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=r,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Jr(n,e,t,r){return new TL(n,e,t,r)}function b0(n){return n=n.prototype,!(!n||!n.isReactComponent)}function bL(n){if(typeof n=="function")return b0(n)?1:0;if(n!=null){if(n=n.$$typeof,n===Wv)return 11;if(n===Gv)return 14}return 2}function fo(n,e){var t=n.alternate;return t===null?(t=Jr(n.tag,e,n.key,n.mode),t.elementType=n.elementType,t.type=n.type,t.stateNode=n.stateNode,t.alternate=n,n.alternate=t):(t.pendingProps=e,t.type=n.type,t.flags=0,t.subtreeFlags=0,t.deletions=null),t.flags=n.flags&14680064,t.childLanes=n.childLanes,t.lanes=n.lanes,t.child=n.child,t.memoizedProps=n.memoizedProps,t.memoizedState=n.memoizedState,t.updateQueue=n.updateQueue,e=n.dependencies,t.dependencies=e===null?null:{lanes:e.lanes,firstContext:e.firstContext},t.sibling=n.sibling,t.index=n.index,t.ref=n.ref,t}function Vf(n,e,t,r,s,i){var o=2;if(r=n,typeof n=="function")b0(n)&&(o=1);else if(typeof n=="string")o=5;else e:switch(n){case xl:return ga(t.children,s,i,e);case qv:o=8,s|=8;break;case Gy:return n=Jr(12,t,e,s|2),n.elementType=Gy,n.lanes=i,n;case Hy:return n=Jr(13,t,e,s),n.elementType=Hy,n.lanes=i,n;case Ky:return n=Jr(19,t,e,s),n.elementType=Ky,n.lanes=i,n;case Qb:return Ep(t,s,i,e);default:if(typeof n=="object"&&n!==null)switch(n.$$typeof){case Hb:o=10;break e;case Kb:o=9;break e;case Wv:o=11;break e;case Gv:o=14;break e;case Bi:o=16,r=null;break e}throw Error(J(130,n==null?n:typeof n,""))}return e=Jr(o,t,e,s),e.elementType=n,e.type=r,e.lanes=i,e}function ga(n,e,t,r){return n=Jr(7,n,r,e),n.lanes=t,n}function Ep(n,e,t,r){return n=Jr(22,n,r,e),n.elementType=Qb,n.lanes=t,n.stateNode={isHidden:!1},n}function dy(n,e,t){return n=Jr(6,n,null,e),n.lanes=t,n}function hy(n,e,t){return e=Jr(4,n.children!==null?n.children:[],n.key,e),e.lanes=t,e.stateNode={containerInfo:n.containerInfo,pendingChildren:null,implementation:n.implementation},e}function AL(n,e,t,r,s){this.tag=e,this.containerInfo=n,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=Gm(0),this.expirationTimes=Gm(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=Gm(0),this.identifierPrefix=r,this.onRecoverableError=s,this.mutableSourceEagerHydrationData=null}function A0(n,e,t,r,s,i,o,a,l){return n=new AL(n,e,t,a,l),e===1?(e=1,i===!0&&(e|=8)):e=0,i=Jr(3,null,null,e),n.current=i,i.stateNode=n,i.memoizedState={element:r,isDehydrated:t,cache:null,transitions:null,pendingSuspenseBoundaries:null},u0(i),n}function CL(n,e,t){var r=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:wl,key:r==null?null:""+r,children:n,containerInfo:e,implementation:t}}function U1(n){if(!n)return Io;n=n._reactInternals;e:{if(za(n)!==n||n.tag!==1)throw Error(J(170));var e=n;do{switch(e.tag){case 3:e=e.stateNode.context;break e;case 1:if(wr(e.type)){e=e.stateNode.__reactInternalMemoizedMergedChildContext;break e}}e=e.return}while(e!==null);throw Error(J(171))}if(n.tag===1){var t=n.type;if(wr(t))return UA(n,t,e)}return e}function $1(n,e,t,r,s,i,o,a,l){return n=A0(t,r,!0,n,s,i,o,a,l),n.context=U1(null),t=n.current,r=ar(),s=ho(t),i=hi(r,s),i.callback=e??null,co(t,i,s),n.current.lanes=s,Zd(n,s,r),xr(n,r),n}function Sp(n,e,t,r){var s=e.current,i=ar(),o=ho(s);return t=U1(t),e.context===null?e.context=t:e.pendingContext=t,e=hi(i,o),e.payload={element:n},r=r===void 0?null:r,r!==null&&(e.callback=r),n=co(s,e,o),n!==null&&(ms(n,s,o,i),kf(n,s,o)),o}function Tg(n){if(n=n.current,!n.child)return null;switch(n.child.tag){case 5:return n.child.stateNode;default:return n.child.stateNode}}function PE(n,e){if(n=n.memoizedState,n!==null&&n.dehydrated!==null){var t=n.retryLane;n.retryLane=t!==0&&t<e?t:e}}function C0(n,e){PE(n,e),(n=n.alternate)&&PE(n,e)}function RL(){return null}var B1=typeof reportError=="function"?reportError:function(n){console.error(n)};function R0(n){this._internalRoot=n}Tp.prototype.render=R0.prototype.render=function(n){var e=this._internalRoot;if(e===null)throw Error(J(409));Sp(n,e,null,null)};Tp.prototype.unmount=R0.prototype.unmount=function(){var n=this._internalRoot;if(n!==null){this._internalRoot=null;var e=n.containerInfo;Sa(function(){Sp(null,n,null,null)}),e[pi]=null}};function Tp(n){this._internalRoot=n}Tp.prototype.unstable_scheduleHydration=function(n){if(n){var e=vA();n={blockedOn:null,target:n,priority:e};for(var t=0;t<qi.length&&e!==0&&e<qi[t].priority;t++);qi.splice(t,0,n),t===0&&xA(n)}};function N0(n){return!(!n||n.nodeType!==1&&n.nodeType!==9&&n.nodeType!==11)}function bp(n){return!(!n||n.nodeType!==1&&n.nodeType!==9&&n.nodeType!==11&&(n.nodeType!==8||n.nodeValue!==" react-mount-point-unstable "))}function DE(){}function NL(n,e,t,r,s){if(s){if(typeof r=="function"){var i=r;r=function(){var u=Tg(o);i.call(u)}}var o=$1(e,r,n,0,null,!1,!1,"",DE);return n._reactRootContainer=o,n[pi]=o.current,fd(n.nodeType===8?n.parentNode:n),Sa(),o}for(;s=n.lastChild;)n.removeChild(s);if(typeof r=="function"){var a=r;r=function(){var u=Tg(l);a.call(u)}}var l=A0(n,0,!1,null,null,!1,!1,"",DE);return n._reactRootContainer=l,n[pi]=l.current,fd(n.nodeType===8?n.parentNode:n),Sa(function(){Sp(e,l,t,r)}),l}function Ap(n,e,t,r,s){var i=t._reactRootContainer;if(i){var o=i;if(typeof s=="function"){var a=s;s=function(){var l=Tg(o);a.call(l)}}Sp(e,o,n,s)}else o=NL(t,e,n,s,r);return Tg(o)}yA=function(n){switch(n.tag){case 3:var e=n.stateNode;if(e.current.memoizedState.isDehydrated){var t=xu(e.pendingLanes);t!==0&&(Qv(e,t|1),xr(e,un()),!(ut&6)&&(tc=un()+500,Vo()))}break;case 13:Sa(function(){var r=mi(n,1);if(r!==null){var s=ar();ms(r,n,1,s)}}),C0(n,1)}};Yv=function(n){if(n.tag===13){var e=mi(n,134217728);if(e!==null){var t=ar();ms(e,n,134217728,t)}C0(n,134217728)}};_A=function(n){if(n.tag===13){var e=ho(n),t=mi(n,e);if(t!==null){var r=ar();ms(t,n,e,r)}C0(n,e)}};vA=function(){return Et};wA=function(n,e){var t=Et;try{return Et=n,e()}finally{Et=t}};s_=function(n,e,t){switch(e){case"input":if(Jy(n,t),e=t.name,t.type==="radio"&&e!=null){for(t=n;t.parentNode;)t=t.parentNode;for(t=t.querySelectorAll("input[name="+JSON.stringify(""+e)+'][type="radio"]'),e=0;e<t.length;e++){var r=t[e];if(r!==n&&r.form===n.form){var s=yp(r);if(!s)throw Error(J(90));Jb(r),Jy(r,s)}}}break;case"textarea":Zb(n,t);break;case"select":e=t.value,e!=null&&Ml(n,!!t.multiple,e,!1)}};oA=E0;aA=Sa;var kL={usingClientEntryPoint:!1,Events:[th,Tl,yp,sA,iA,E0]},lu={findFiberByHostInstance:oa,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},PL={bundleType:lu.bundleType,version:lu.version,rendererPackageName:lu.rendererPackageName,rendererConfig:lu.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:Ti.ReactCurrentDispatcher,findHostInstanceByFiber:function(n){return n=uA(n),n===null?null:n.stateNode},findFiberByHostInstance:lu.findFiberByHostInstance||RL,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var cf=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!cf.isDisabled&&cf.supportsFiber)try{fp=cf.inject(PL),js=cf}catch{}}zr.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=kL;zr.createPortal=function(n,e){var t=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!N0(e))throw Error(J(200));return CL(n,e,null,t)};zr.createRoot=function(n,e){if(!N0(n))throw Error(J(299));var t=!1,r="",s=B1;return e!=null&&(e.unstable_strictMode===!0&&(t=!0),e.identifierPrefix!==void 0&&(r=e.identifierPrefix),e.onRecoverableError!==void 0&&(s=e.onRecoverableError)),e=A0(n,1,!1,null,null,t,!1,r,s),n[pi]=e.current,fd(n.nodeType===8?n.parentNode:n),new R0(e)};zr.findDOMNode=function(n){if(n==null)return null;if(n.nodeType===1)return n;var e=n._reactInternals;if(e===void 0)throw typeof n.render=="function"?Error(J(188)):(n=Object.keys(n).join(","),Error(J(268,n)));return n=uA(e),n=n===null?null:n.stateNode,n};zr.flushSync=function(n){return Sa(n)};zr.hydrate=function(n,e,t){if(!bp(e))throw Error(J(200));return Ap(null,n,e,!0,t)};zr.hydrateRoot=function(n,e,t){if(!N0(n))throw Error(J(405));var r=t!=null&&t.hydratedSources||null,s=!1,i="",o=B1;if(t!=null&&(t.unstable_strictMode===!0&&(s=!0),t.identifierPrefix!==void 0&&(i=t.identifierPrefix),t.onRecoverableError!==void 0&&(o=t.onRecoverableError)),e=$1(e,null,n,1,t??null,s,!1,i,o),n[pi]=e.current,fd(n),r)for(n=0;n<r.length;n++)t=r[n],s=t._getVersion,s=s(t._source),e.mutableSourceEagerHydrationData==null?e.mutableSourceEagerHydrationData=[t,s]:e.mutableSourceEagerHydrationData.push(t,s);return new Tp(e)};zr.render=function(n,e,t){if(!bp(e))throw Error(J(200));return Ap(null,n,e,!1,t)};zr.unmountComponentAtNode=function(n){if(!bp(n))throw Error(J(40));return n._reactRootContainer?(Sa(function(){Ap(null,null,n,!1,function(){n._reactRootContainer=null,n[pi]=null})}),!0):!1};zr.unstable_batchedUpdates=E0;zr.unstable_renderSubtreeIntoContainer=function(n,e,t,r){if(!bp(t))throw Error(J(200));if(n==null||n._reactInternals===void 0)throw Error(J(38));return Ap(n,e,t,!1,r)};zr.version="18.3.1-next-f1338f8080-20240426";function z1(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(z1)}catch(n){console.error(n)}}z1(),zb.exports=zr;var DL=zb.exports,ME=DL;qy.createRoot=ME.createRoot,qy.hydrateRoot=ME.hydrateRoot;const ML="modulepreload",LL=function(n){return"/"+n},LE={},be=function(e,t,r){if(!t||t.length===0)return e();const s=document.getElementsByTagName("link");return Promise.all(t.map(i=>{if(i=LL(i),i in LE)return;LE[i]=!0;const o=i.endsWith(".css"),a=o?'[rel="stylesheet"]':"";if(!!r)for(let h=s.length-1;h>=0;h--){const f=s[h];if(f.href===i&&(!o||f.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${i}"]${a}`))return;const u=document.createElement("link");if(u.rel=o?"stylesheet":ML,o||(u.as="script",u.crossOrigin=""),u.href=i,document.head.appendChild(u),o)return new Promise((h,f)=>{u.addEventListener("load",h),u.addEventListener("error",()=>f(new Error(`Unable to preload CSS for ${i}`)))})})).then(()=>e()).catch(i=>{const o=new Event("vite:preloadError",{cancelable:!0});if(o.payload=i,window.dispatchEvent(o),!o.defaultPrevented)throw i})},OL=()=>{};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const q1={NODE_CLIENT:!1,NODE_ADMIN:!1,SDK_VERSION:"${JSCORE_VERSION}"};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Z=function(n,e){if(!n)throw kc(e)},kc=function(n){return new Error("Firebase Database ("+q1.SDK_VERSION+") INTERNAL ASSERT FAILED: "+n)};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const W1=function(n){const e=[];let t=0;for(let r=0;r<n.length;r++){let s=n.charCodeAt(r);s<128?e[t++]=s:s<2048?(e[t++]=s>>6|192,e[t++]=s&63|128):(s&64512)===55296&&r+1<n.length&&(n.charCodeAt(r+1)&64512)===56320?(s=65536+((s&1023)<<10)+(n.charCodeAt(++r)&1023),e[t++]=s>>18|240,e[t++]=s>>12&63|128,e[t++]=s>>6&63|128,e[t++]=s&63|128):(e[t++]=s>>12|224,e[t++]=s>>6&63|128,e[t++]=s&63|128)}return e},VL=function(n){const e=[];let t=0,r=0;for(;t<n.length;){const s=n[t++];if(s<128)e[r++]=String.fromCharCode(s);else if(s>191&&s<224){const i=n[t++];e[r++]=String.fromCharCode((s&31)<<6|i&63)}else if(s>239&&s<365){const i=n[t++],o=n[t++],a=n[t++],l=((s&7)<<18|(i&63)<<12|(o&63)<<6|a&63)-65536;e[r++]=String.fromCharCode(55296+(l>>10)),e[r++]=String.fromCharCode(56320+(l&1023))}else{const i=n[t++],o=n[t++];e[r++]=String.fromCharCode((s&15)<<12|(i&63)<<6|o&63)}}return e.join("")},k0={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:typeof atob=="function",encodeByteArray(n,e){if(!Array.isArray(n))throw Error("encodeByteArray takes an array as a parameter");this.init_();const t=e?this.byteToCharMapWebSafe_:this.byteToCharMap_,r=[];for(let s=0;s<n.length;s+=3){const i=n[s],o=s+1<n.length,a=o?n[s+1]:0,l=s+2<n.length,u=l?n[s+2]:0,h=i>>2,f=(i&3)<<4|a>>4;let g=(a&15)<<2|u>>6,y=u&63;l||(y=64,o||(g=64)),r.push(t[h],t[f],t[g],t[y])}return r.join("")},encodeString(n,e){return this.HAS_NATIVE_SUPPORT&&!e?btoa(n):this.encodeByteArray(W1(n),e)},decodeString(n,e){return this.HAS_NATIVE_SUPPORT&&!e?atob(n):VL(this.decodeStringToByteArray(n,e))},decodeStringToByteArray(n,e){this.init_();const t=e?this.charToByteMapWebSafe_:this.charToByteMap_,r=[];for(let s=0;s<n.length;){const i=t[n.charAt(s++)],a=s<n.length?t[n.charAt(s)]:0;++s;const u=s<n.length?t[n.charAt(s)]:64;++s;const f=s<n.length?t[n.charAt(s)]:64;if(++s,i==null||a==null||u==null||f==null)throw new FL;const g=i<<2|a>>4;if(r.push(g),u!==64){const y=a<<4&240|u>>2;if(r.push(y),f!==64){const w=u<<6&192|f;r.push(w)}}}return r},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let n=0;n<this.ENCODED_VALS.length;n++)this.byteToCharMap_[n]=this.ENCODED_VALS.charAt(n),this.charToByteMap_[this.byteToCharMap_[n]]=n,this.byteToCharMapWebSafe_[n]=this.ENCODED_VALS_WEBSAFE.charAt(n),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[n]]=n,n>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(n)]=n,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(n)]=n)}}};class FL extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}const G1=function(n){const e=W1(n);return k0.encodeByteArray(e,!0)},bg=function(n){return G1(n).replace(/\./g,"")},Ag=function(n){try{return k0.decodeString(n,!0)}catch(e){console.error("base64Decode failed: ",e)}return null};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function jL(n){return H1(void 0,n)}function H1(n,e){if(!(e instanceof Object))return e;switch(e.constructor){case Date:const t=e;return new Date(t.getTime());case Object:n===void 0&&(n={});break;case Array:n=[];break;default:return e}for(const t in e)!e.hasOwnProperty(t)||!UL(t)||(n[t]=H1(n[t],e[t]));return n}function UL(n){return n!=="__proto__"}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function K1(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("Unable to locate global object.")}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const $L=()=>K1().__FIREBASE_DEFAULTS__,BL=()=>{if(typeof process>"u"||typeof process.env>"u")return;const n={}.__FIREBASE_DEFAULTS__;if(n)return JSON.parse(n)},zL=()=>{if(typeof document>"u")return;let n;try{n=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch{return}const e=n&&Ag(n[1]);return e&&JSON.parse(e)},Cp=()=>{try{return OL()||$L()||BL()||zL()}catch(n){console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${n}`);return}},Q1=n=>{var e,t;return(t=(e=Cp())==null?void 0:e.emulatorHosts)==null?void 0:t[n]},Y1=n=>{const e=Q1(n);if(!e)return;const t=e.lastIndexOf(":");if(t<=0||t+1===e.length)throw new Error(`Invalid host ${e} with no separate hostname and port!`);const r=parseInt(e.substring(t+1),10);return e[0]==="["?[e.substring(1,t-1),r]:[e.substring(0,t),r]},J1=()=>{var n;return(n=Cp())==null?void 0:n.config},X1=n=>{var e;return(e=Cp())==null?void 0:e[`_${n}`]};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Pr{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}wrapCallback(e){return(t,r)=>{t?this.reject(t):this.resolve(r),typeof e=="function"&&(this.promise.catch(()=>{}),e.length===1?e(t):e(t,r))}}}/**
 * @license
 * Copyright 2025 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function bi(n){try{return(n.startsWith("http://")||n.startsWith("https://")?new URL(n).hostname:n).endsWith(".cloudworkstations.dev")}catch{return!1}}async function Rp(n){return(await fetch(n,{credentials:"include"})).ok}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Z1(n,e){if(n.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');const t={alg:"none",type:"JWT"},r=e||"demo-project",s=n.iat||0,i=n.sub||n.user_id;if(!i)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");const o={iss:`https://securetoken.google.com/${r}`,aud:r,iat:s,exp:s+3600,auth_time:s,sub:i,user_id:i,firebase:{sign_in_provider:"custom",identities:{}},...n},a="";return[bg(JSON.stringify(t)),bg(JSON.stringify(o)),a].join(".")}const Uu={};function qL(){const n={prod:[],emulator:[]};for(const e of Object.keys(Uu))Uu[e]?n.emulator.push(e):n.prod.push(e);return n}function WL(n){let e=document.getElementById(n),t=!1;return e||(e=document.createElement("div"),e.setAttribute("id",n),t=!0),{created:t,element:e}}let OE=!1;function P0(n,e){if(typeof window>"u"||typeof document>"u"||!bi(window.location.host)||Uu[n]===e||Uu[n]||OE)return;Uu[n]=e;function t(g){return`__firebase__banner__${g}`}const r="__firebase__banner",i=qL().prod.length>0;function o(){const g=document.getElementById(r);g&&g.remove()}function a(g){g.style.display="flex",g.style.background="#7faaf0",g.style.position="fixed",g.style.bottom="5px",g.style.left="5px",g.style.padding=".5em",g.style.borderRadius="5px",g.style.alignItems="center"}function l(g,y){g.setAttribute("width","24"),g.setAttribute("id",y),g.setAttribute("height","24"),g.setAttribute("viewBox","0 0 24 24"),g.setAttribute("fill","none"),g.style.marginLeft="-6px"}function u(){const g=document.createElement("span");return g.style.cursor="pointer",g.style.marginLeft="16px",g.style.fontSize="24px",g.innerHTML=" &times;",g.onclick=()=>{OE=!0,o()},g}function h(g,y){g.setAttribute("id",y),g.innerText="Learn more",g.href="https://firebase.google.com/docs/studio/preview-apps#preview-backend",g.setAttribute("target","__blank"),g.style.paddingLeft="5px",g.style.textDecoration="underline"}function f(){const g=WL(r),y=t("text"),w=document.getElementById(y)||document.createElement("span"),C=t("learnmore"),M=document.getElementById(C)||document.createElement("a"),A=t("preprendIcon"),I=document.getElementById(A)||document.createElementNS("http://www.w3.org/2000/svg","svg");if(g.created){const R=g.element;a(R),h(M,C);const D=u();l(I,A),R.append(I,w,M,D),document.body.appendChild(R)}i?(w.innerText="Preview backend disconnected.",I.innerHTML=`<g clip-path="url(#clip0_6013_33858)">
<path d="M4.8 17.6L12 5.6L19.2 17.6H4.8ZM6.91667 16.4H17.0833L12 7.93333L6.91667 16.4ZM12 15.6C12.1667 15.6 12.3056 15.5444 12.4167 15.4333C12.5389 15.3111 12.6 15.1667 12.6 15C12.6 14.8333 12.5389 14.6944 12.4167 14.5833C12.3056 14.4611 12.1667 14.4 12 14.4C11.8333 14.4 11.6889 14.4611 11.5667 14.5833C11.4556 14.6944 11.4 14.8333 11.4 15C11.4 15.1667 11.4556 15.3111 11.5667 15.4333C11.6889 15.5444 11.8333 15.6 12 15.6ZM11.4 13.6H12.6V10.4H11.4V13.6Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6013_33858">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`):(I.innerHTML=`<g clip-path="url(#clip0_6083_34804)">
<path d="M11.4 15.2H12.6V11.2H11.4V15.2ZM12 10C12.1667 10 12.3056 9.94444 12.4167 9.83333C12.5389 9.71111 12.6 9.56667 12.6 9.4C12.6 9.23333 12.5389 9.09444 12.4167 8.98333C12.3056 8.86111 12.1667 8.8 12 8.8C11.8333 8.8 11.6889 8.86111 11.5667 8.98333C11.4556 9.09444 11.4 9.23333 11.4 9.4C11.4 9.56667 11.4556 9.71111 11.5667 9.83333C11.6889 9.94444 11.8333 10 12 10ZM12 18.4C11.1222 18.4 10.2944 18.2333 9.51667 17.9C8.73889 17.5667 8.05556 17.1111 7.46667 16.5333C6.88889 15.9444 6.43333 15.2611 6.1 14.4833C5.76667 13.7056 5.6 12.8778 5.6 12C5.6 11.1111 5.76667 10.2833 6.1 9.51667C6.43333 8.73889 6.88889 8.06111 7.46667 7.48333C8.05556 6.89444 8.73889 6.43333 9.51667 6.1C10.2944 5.76667 11.1222 5.6 12 5.6C12.8889 5.6 13.7167 5.76667 14.4833 6.1C15.2611 6.43333 15.9389 6.89444 16.5167 7.48333C17.1056 8.06111 17.5667 8.73889 17.9 9.51667C18.2333 10.2833 18.4 11.1111 18.4 12C18.4 12.8778 18.2333 13.7056 17.9 14.4833C17.5667 15.2611 17.1056 15.9444 16.5167 16.5333C15.9389 17.1111 15.2611 17.5667 14.4833 17.9C13.7167 18.2333 12.8889 18.4 12 18.4ZM12 17.2C13.4444 17.2 14.6722 16.6944 15.6833 15.6833C16.6944 14.6722 17.2 13.4444 17.2 12C17.2 10.5556 16.6944 9.32778 15.6833 8.31667C14.6722 7.30555 13.4444 6.8 12 6.8C10.5556 6.8 9.32778 7.30555 8.31667 8.31667C7.30556 9.32778 6.8 10.5556 6.8 12C6.8 13.4444 7.30556 14.6722 8.31667 15.6833C9.32778 16.6944 10.5556 17.2 12 17.2Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6083_34804">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`,w.innerText="Preview backend running in this workspace."),w.setAttribute("id",y)}document.readyState==="loading"?window.addEventListener("DOMContentLoaded",f):f()}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function In(){return typeof navigator<"u"&&typeof navigator.userAgent=="string"?navigator.userAgent:""}function D0(){return typeof window<"u"&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(In())}function eC(){var e;const n=(e=Cp())==null?void 0:e.forceEnvironment;if(n==="node")return!0;if(n==="browser")return!1;try{return Object.prototype.toString.call(global.process)==="[object process]"}catch{return!1}}function GL(){return typeof navigator<"u"&&navigator.userAgent==="Cloudflare-Workers"}function M0(){const n=typeof chrome=="object"?chrome.runtime:typeof browser=="object"?browser.runtime:void 0;return typeof n=="object"&&n.id!==void 0}function tC(){return typeof navigator=="object"&&navigator.product==="ReactNative"}function HL(){const n=In();return n.indexOf("MSIE ")>=0||n.indexOf("Trident/")>=0}function nC(){return q1.NODE_ADMIN===!0}function rC(){return!eC()&&!!navigator.userAgent&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")}function sC(){return!eC()&&!!navigator.userAgent&&(navigator.userAgent.includes("Safari")||navigator.userAgent.includes("WebKit"))&&!navigator.userAgent.includes("Chrome")}function Np(){try{return typeof indexedDB=="object"}catch{return!1}}function L0(){return new Promise((n,e)=>{try{let t=!0;const r="validate-browser-context-for-indexeddb-analytics-module",s=self.indexedDB.open(r);s.onsuccess=()=>{s.result.close(),t||self.indexedDB.deleteDatabase(r),n(!0)},s.onupgradeneeded=()=>{t=!1},s.onerror=()=>{var i;e(((i=s.error)==null?void 0:i.message)||"")}}catch(t){e(t)}})}function iC(){return!(typeof navigator>"u"||!navigator.cookieEnabled)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const KL="FirebaseError";class xs extends Error{constructor(e,t,r){super(t),this.code=e,this.customData=r,this.name=KL,Object.setPrototypeOf(this,xs.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,qa.prototype.create)}}class qa{constructor(e,t,r){this.service=e,this.serviceName=t,this.errors=r}create(e,...t){const r=t[0]||{},s=`${this.service}/${e}`,i=this.errors[e],o=i?QL(i,r):"Error",a=`${this.serviceName}: ${o} (${s}).`;return new xs(s,a,r)}}function QL(n,e){return n.replace(YL,(t,r)=>{const s=e[r];return s!=null?String(s):`<${r}?>`})}const YL=/\{\$([^}]+)}/g;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Id(n){return JSON.parse(n)}function wn(n){return JSON.stringify(n)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const oC=function(n){let e={},t={},r={},s="";try{const i=n.split(".");e=Id(Ag(i[0])||""),t=Id(Ag(i[1])||""),s=i[2],r=t.d||{},delete t.d}catch{}return{header:e,claims:t,data:r,signature:s}},JL=function(n){const e=oC(n),t=e.claims;return!!t&&typeof t=="object"&&t.hasOwnProperty("iat")},XL=function(n){const e=oC(n).claims;return typeof e=="object"&&e.admin===!0};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Is(n,e){return Object.prototype.hasOwnProperty.call(n,e)}function Ta(n,e){if(Object.prototype.hasOwnProperty.call(n,e))return n[e]}function Cg(n){for(const e in n)if(Object.prototype.hasOwnProperty.call(n,e))return!1;return!0}function Rg(n,e,t){const r={};for(const s in n)Object.prototype.hasOwnProperty.call(n,s)&&(r[s]=e.call(t,n[s],s,n));return r}function Ur(n,e){if(n===e)return!0;const t=Object.keys(n),r=Object.keys(e);for(const s of t){if(!r.includes(s))return!1;const i=n[s],o=e[s];if(VE(i)&&VE(o)){if(!Ur(i,o))return!1}else if(i!==o)return!1}for(const s of r)if(!t.includes(s))return!1;return!0}function VE(n){return n!==null&&typeof n=="object"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Wa(n){const e=[];for(const[t,r]of Object.entries(n))Array.isArray(r)?r.forEach(s=>{e.push(encodeURIComponent(t)+"="+encodeURIComponent(s))}):e.push(encodeURIComponent(t)+"="+encodeURIComponent(r));return e.length?"&"+e.join("&"):""}function Eu(n){const e={};return n.replace(/^\?/,"").split("&").forEach(r=>{if(r){const[s,i]=r.split("=");e[decodeURIComponent(s)]=decodeURIComponent(i)}}),e}function Su(n){const e=n.indexOf("?");if(!e)return"";const t=n.indexOf("#",e);return n.substring(e,t>0?t:void 0)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ZL{constructor(){this.chain_=[],this.buf_=[],this.W_=[],this.pad_=[],this.inbuf_=0,this.total_=0,this.blockSize=512/8,this.pad_[0]=128;for(let e=1;e<this.blockSize;++e)this.pad_[e]=0;this.reset()}reset(){this.chain_[0]=1732584193,this.chain_[1]=4023233417,this.chain_[2]=2562383102,this.chain_[3]=271733878,this.chain_[4]=3285377520,this.inbuf_=0,this.total_=0}compress_(e,t){t||(t=0);const r=this.W_;if(typeof e=="string")for(let f=0;f<16;f++)r[f]=e.charCodeAt(t)<<24|e.charCodeAt(t+1)<<16|e.charCodeAt(t+2)<<8|e.charCodeAt(t+3),t+=4;else for(let f=0;f<16;f++)r[f]=e[t]<<24|e[t+1]<<16|e[t+2]<<8|e[t+3],t+=4;for(let f=16;f<80;f++){const g=r[f-3]^r[f-8]^r[f-14]^r[f-16];r[f]=(g<<1|g>>>31)&4294967295}let s=this.chain_[0],i=this.chain_[1],o=this.chain_[2],a=this.chain_[3],l=this.chain_[4],u,h;for(let f=0;f<80;f++){f<40?f<20?(u=a^i&(o^a),h=1518500249):(u=i^o^a,h=1859775393):f<60?(u=i&o|a&(i|o),h=2400959708):(u=i^o^a,h=3395469782);const g=(s<<5|s>>>27)+u+l+h+r[f]&4294967295;l=a,a=o,o=(i<<30|i>>>2)&4294967295,i=s,s=g}this.chain_[0]=this.chain_[0]+s&4294967295,this.chain_[1]=this.chain_[1]+i&4294967295,this.chain_[2]=this.chain_[2]+o&4294967295,this.chain_[3]=this.chain_[3]+a&4294967295,this.chain_[4]=this.chain_[4]+l&4294967295}update(e,t){if(e==null)return;t===void 0&&(t=e.length);const r=t-this.blockSize;let s=0;const i=this.buf_;let o=this.inbuf_;for(;s<t;){if(o===0)for(;s<=r;)this.compress_(e,s),s+=this.blockSize;if(typeof e=="string"){for(;s<t;)if(i[o]=e.charCodeAt(s),++o,++s,o===this.blockSize){this.compress_(i),o=0;break}}else for(;s<t;)if(i[o]=e[s],++o,++s,o===this.blockSize){this.compress_(i),o=0;break}}this.inbuf_=o,this.total_+=t}digest(){const e=[];let t=this.total_*8;this.inbuf_<56?this.update(this.pad_,56-this.inbuf_):this.update(this.pad_,this.blockSize-(this.inbuf_-56));for(let s=this.blockSize-1;s>=56;s--)this.buf_[s]=t&255,t/=256;this.compress_(this.buf_);let r=0;for(let s=0;s<5;s++)for(let i=24;i>=0;i-=8)e[r]=this.chain_[s]>>i&255,++r;return e}}function eO(n,e){const t=new tO(n,e);return t.subscribe.bind(t)}class tO{constructor(e,t){this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=t,this.task.then(()=>{e(this)}).catch(r=>{this.error(r)})}next(e){this.forEachObserver(t=>{t.next(e)})}error(e){this.forEachObserver(t=>{t.error(e)}),this.close(e)}complete(){this.forEachObserver(e=>{e.complete()}),this.close()}subscribe(e,t,r){let s;if(e===void 0&&t===void 0&&r===void 0)throw new Error("Missing Observer.");nO(e,["next","error","complete"])?s=e:s={next:e,error:t,complete:r},s.next===void 0&&(s.next=fy),s.error===void 0&&(s.error=fy),s.complete===void 0&&(s.complete=fy);const i=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then(()=>{try{this.finalError?s.error(this.finalError):s.complete()}catch{}}),this.observers.push(s),i}unsubscribeOne(e){this.observers===void 0||this.observers[e]===void 0||(delete this.observers[e],this.observerCount-=1,this.observerCount===0&&this.onNoObservers!==void 0&&this.onNoObservers(this))}forEachObserver(e){if(!this.finalized)for(let t=0;t<this.observers.length;t++)this.sendOne(t,e)}sendOne(e,t){this.task.then(()=>{if(this.observers!==void 0&&this.observers[e]!==void 0)try{t(this.observers[e])}catch(r){typeof console<"u"&&console.error&&console.error(r)}})}close(e){this.finalized||(this.finalized=!0,e!==void 0&&(this.finalError=e),this.task.then(()=>{this.observers=void 0,this.onNoObservers=void 0}))}}function nO(n,e){if(typeof n!="object"||n===null)return!1;for(const t of e)if(t in n&&typeof n[t]=="function")return!0;return!1}function fy(){}function ba(n,e){return`${n} failed: ${e} argument `}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const rO=function(n){const e=[];let t=0;for(let r=0;r<n.length;r++){let s=n.charCodeAt(r);if(s>=55296&&s<=56319){const i=s-55296;r++,Z(r<n.length,"Surrogate pair missing trail surrogate.");const o=n.charCodeAt(r)-56320;s=65536+(i<<10)+o}s<128?e[t++]=s:s<2048?(e[t++]=s>>6|192,e[t++]=s&63|128):s<65536?(e[t++]=s>>12|224,e[t++]=s>>6&63|128,e[t++]=s&63|128):(e[t++]=s>>18|240,e[t++]=s>>12&63|128,e[t++]=s>>6&63|128,e[t++]=s&63|128)}return e},kp=function(n){let e=0;for(let t=0;t<n.length;t++){const r=n.charCodeAt(t);r<128?e++:r<2048?e+=2:r>=55296&&r<=56319?(e+=4,t++):e+=3}return e};/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const sO=1e3,iO=2,oO=4*60*60*1e3,aO=.5;function FE(n,e=sO,t=iO){const r=e*Math.pow(t,n),s=Math.round(aO*r*(Math.random()-.5)*2);return Math.min(oO,r+s)}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ae(n){return n&&n._delegate?n._delegate:n}class Sr{constructor(e,t,r){this.name=e,this.instanceFactory=t,this.type=r,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Xo="[DEFAULT]";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class V_{constructor(e,t){this.name=e,this.container=t,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(e){const t=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(t)){const r=new Pr;if(this.instancesDeferred.set(t,r),this.isInitialized(t)||this.shouldAutoInitialize())try{const s=this.getOrInitializeService({instanceIdentifier:t});s&&r.resolve(s)}catch{}}return this.instancesDeferred.get(t).promise}getImmediate(e){const t=this.normalizeInstanceIdentifier(e==null?void 0:e.identifier),r=(e==null?void 0:e.optional)??!1;if(this.isInitialized(t)||this.shouldAutoInitialize())try{return this.getOrInitializeService({instanceIdentifier:t})}catch(s){if(r)return null;throw s}else{if(r)return null;throw Error(`Service ${this.name} is not available`)}}getComponent(){return this.component}setComponent(e){if(e.name!==this.name)throw Error(`Mismatching Component ${e.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=e,!!this.shouldAutoInitialize()){if(cO(e))try{this.getOrInitializeService({instanceIdentifier:Xo})}catch{}for(const[t,r]of this.instancesDeferred.entries()){const s=this.normalizeInstanceIdentifier(t);try{const i=this.getOrInitializeService({instanceIdentifier:s});r.resolve(i)}catch{}}}}clearInstance(e=Xo){this.instancesDeferred.delete(e),this.instancesOptions.delete(e),this.instances.delete(e)}async delete(){const e=Array.from(this.instances.values());await Promise.all([...e.filter(t=>"INTERNAL"in t).map(t=>t.INTERNAL.delete()),...e.filter(t=>"_delete"in t).map(t=>t._delete())])}isComponentSet(){return this.component!=null}isInitialized(e=Xo){return this.instances.has(e)}getOptions(e=Xo){return this.instancesOptions.get(e)||{}}initialize(e={}){const{options:t={}}=e,r=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(r))throw Error(`${this.name}(${r}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const s=this.getOrInitializeService({instanceIdentifier:r,options:t});for(const[i,o]of this.instancesDeferred.entries()){const a=this.normalizeInstanceIdentifier(i);r===a&&o.resolve(s)}return s}onInit(e,t){const r=this.normalizeInstanceIdentifier(t),s=this.onInitCallbacks.get(r)??new Set;s.add(e),this.onInitCallbacks.set(r,s);const i=this.instances.get(r);return i&&e(i,r),()=>{s.delete(e)}}invokeOnInitCallbacks(e,t){const r=this.onInitCallbacks.get(t);if(r)for(const s of r)try{s(e,t)}catch{}}getOrInitializeService({instanceIdentifier:e,options:t={}}){let r=this.instances.get(e);if(!r&&this.component&&(r=this.component.instanceFactory(this.container,{instanceIdentifier:lO(e),options:t}),this.instances.set(e,r),this.instancesOptions.set(e,t),this.invokeOnInitCallbacks(r,e),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,e,r)}catch{}return r||null}normalizeInstanceIdentifier(e=Xo){return this.component?this.component.multipleInstances?e:Xo:e}shouldAutoInitialize(){return!!this.component&&this.component.instantiationMode!=="EXPLICIT"}}function lO(n){return n===Xo?void 0:n}function cO(n){return n.instantiationMode==="EAGER"}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class aC{constructor(e){this.name=e,this.providers=new Map}addComponent(e){const t=this.getProvider(e.name);if(t.isComponentSet())throw new Error(`Component ${e.name} has already been registered with ${this.name}`);t.setComponent(e)}addOrOverwriteComponent(e){this.getProvider(e.name).isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)}getProvider(e){if(this.providers.has(e))return this.providers.get(e);const t=new V_(e,this);return this.providers.set(e,t),t}getProviders(){return Array.from(this.providers.values())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Ze;(function(n){n[n.DEBUG=0]="DEBUG",n[n.VERBOSE=1]="VERBOSE",n[n.INFO=2]="INFO",n[n.WARN=3]="WARN",n[n.ERROR=4]="ERROR",n[n.SILENT=5]="SILENT"})(Ze||(Ze={}));const uO={debug:Ze.DEBUG,verbose:Ze.VERBOSE,info:Ze.INFO,warn:Ze.WARN,error:Ze.ERROR,silent:Ze.SILENT},dO=Ze.INFO,hO={[Ze.DEBUG]:"log",[Ze.VERBOSE]:"log",[Ze.INFO]:"info",[Ze.WARN]:"warn",[Ze.ERROR]:"error"},fO=(n,e,...t)=>{if(e<n.logLevel)return;const r=new Date().toISOString(),s=hO[e];if(s)console[s](`[${r}]  ${n.name}:`,...t);else throw new Error(`Attempted to log a message with an invalid logType (value: ${e})`)};class rh{constructor(e){this.name=e,this._logLevel=dO,this._logHandler=fO,this._userLogHandler=null}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in Ze))throw new TypeError(`Invalid value "${e}" assigned to \`logLevel\``);this._logLevel=e}setLogLevel(e){this._logLevel=typeof e=="string"?uO[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if(typeof e!="function")throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(...e){this._userLogHandler&&this._userLogHandler(this,Ze.DEBUG,...e),this._logHandler(this,Ze.DEBUG,...e)}log(...e){this._userLogHandler&&this._userLogHandler(this,Ze.VERBOSE,...e),this._logHandler(this,Ze.VERBOSE,...e)}info(...e){this._userLogHandler&&this._userLogHandler(this,Ze.INFO,...e),this._logHandler(this,Ze.INFO,...e)}warn(...e){this._userLogHandler&&this._userLogHandler(this,Ze.WARN,...e),this._logHandler(this,Ze.WARN,...e)}error(...e){this._userLogHandler&&this._userLogHandler(this,Ze.ERROR,...e),this._logHandler(this,Ze.ERROR,...e)}}const gO=(n,e)=>e.some(t=>n instanceof t);let jE,UE;function pO(){return jE||(jE=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function mO(){return UE||(UE=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const lC=new WeakMap,F_=new WeakMap,cC=new WeakMap,gy=new WeakMap,O0=new WeakMap;function yO(n){const e=new Promise((t,r)=>{const s=()=>{n.removeEventListener("success",i),n.removeEventListener("error",o)},i=()=>{t(go(n.result)),s()},o=()=>{r(n.error),s()};n.addEventListener("success",i),n.addEventListener("error",o)});return e.then(t=>{t instanceof IDBCursor&&lC.set(t,n)}).catch(()=>{}),O0.set(e,n),e}function _O(n){if(F_.has(n))return;const e=new Promise((t,r)=>{const s=()=>{n.removeEventListener("complete",i),n.removeEventListener("error",o),n.removeEventListener("abort",o)},i=()=>{t(),s()},o=()=>{r(n.error||new DOMException("AbortError","AbortError")),s()};n.addEventListener("complete",i),n.addEventListener("error",o),n.addEventListener("abort",o)});F_.set(n,e)}let j_={get(n,e,t){if(n instanceof IDBTransaction){if(e==="done")return F_.get(n);if(e==="objectStoreNames")return n.objectStoreNames||cC.get(n);if(e==="store")return t.objectStoreNames[1]?void 0:t.objectStore(t.objectStoreNames[0])}return go(n[e])},set(n,e,t){return n[e]=t,!0},has(n,e){return n instanceof IDBTransaction&&(e==="done"||e==="store")?!0:e in n}};function vO(n){j_=n(j_)}function wO(n){return n===IDBDatabase.prototype.transaction&&!("objectStoreNames"in IDBTransaction.prototype)?function(e,...t){const r=n.call(py(this),e,...t);return cC.set(r,e.sort?e.sort():[e]),go(r)}:mO().includes(n)?function(...e){return n.apply(py(this),e),go(lC.get(this))}:function(...e){return go(n.apply(py(this),e))}}function xO(n){return typeof n=="function"?wO(n):(n instanceof IDBTransaction&&_O(n),gO(n,pO())?new Proxy(n,j_):n)}function go(n){if(n instanceof IDBRequest)return yO(n);if(gy.has(n))return gy.get(n);const e=xO(n);return e!==n&&(gy.set(n,e),O0.set(e,n)),e}const py=n=>O0.get(n);function uC(n,e,{blocked:t,upgrade:r,blocking:s,terminated:i}={}){const o=indexedDB.open(n,e),a=go(o);return r&&o.addEventListener("upgradeneeded",l=>{r(go(o.result),l.oldVersion,l.newVersion,go(o.transaction),l)}),t&&o.addEventListener("blocked",l=>t(l.oldVersion,l.newVersion,l)),a.then(l=>{i&&l.addEventListener("close",()=>i()),s&&l.addEventListener("versionchange",u=>s(u.oldVersion,u.newVersion,u))}).catch(()=>{}),a}const IO=["get","getKey","getAll","getAllKeys","count"],EO=["put","add","delete","clear"],my=new Map;function $E(n,e){if(!(n instanceof IDBDatabase&&!(e in n)&&typeof e=="string"))return;if(my.get(e))return my.get(e);const t=e.replace(/FromIndex$/,""),r=e!==t,s=EO.includes(t);if(!(t in(r?IDBIndex:IDBObjectStore).prototype)||!(s||IO.includes(t)))return;const i=async function(o,...a){const l=this.transaction(o,s?"readwrite":"readonly");let u=l.store;return r&&(u=u.index(a.shift())),(await Promise.all([u[t](...a),s&&l.done]))[0]};return my.set(e,i),i}vO(n=>({...n,get:(e,t,r)=>$E(e,t)||n.get(e,t,r),has:(e,t)=>!!$E(e,t)||n.has(e,t)}));/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class SO{constructor(e){this.container=e}getPlatformInfoString(){return this.container.getProviders().map(t=>{if(TO(t)){const r=t.getImmediate();return`${r.library}/${r.version}`}else return null}).filter(t=>t).join(" ")}}function TO(n){const e=n.getComponent();return(e==null?void 0:e.type)==="VERSION"}const U_="@firebase/app",BE="0.14.1";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const _i=new rh("@firebase/app"),bO="@firebase/app-compat",AO="@firebase/analytics-compat",CO="@firebase/analytics",RO="@firebase/app-check-compat",NO="@firebase/app-check",kO="@firebase/auth",PO="@firebase/auth-compat",DO="@firebase/database",MO="@firebase/data-connect",LO="@firebase/database-compat",OO="@firebase/functions",VO="@firebase/functions-compat",FO="@firebase/installations",jO="@firebase/installations-compat",UO="@firebase/messaging",$O="@firebase/messaging-compat",BO="@firebase/performance",zO="@firebase/performance-compat",qO="@firebase/remote-config",WO="@firebase/remote-config-compat",GO="@firebase/storage",HO="@firebase/storage-compat",KO="@firebase/firestore",QO="@firebase/ai",YO="@firebase/firestore-compat",JO="firebase",XO="12.1.0";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ng="[DEFAULT]",ZO={[U_]:"fire-core",[bO]:"fire-core-compat",[CO]:"fire-analytics",[AO]:"fire-analytics-compat",[NO]:"fire-app-check",[RO]:"fire-app-check-compat",[kO]:"fire-auth",[PO]:"fire-auth-compat",[DO]:"fire-rtdb",[MO]:"fire-data-connect",[LO]:"fire-rtdb-compat",[OO]:"fire-fn",[VO]:"fire-fn-compat",[FO]:"fire-iid",[jO]:"fire-iid-compat",[UO]:"fire-fcm",[$O]:"fire-fcm-compat",[BO]:"fire-perf",[zO]:"fire-perf-compat",[qO]:"fire-rc",[WO]:"fire-rc-compat",[GO]:"fire-gcs",[HO]:"fire-gcs-compat",[KO]:"fire-fst",[YO]:"fire-fst-compat",[QO]:"fire-vertex","fire-js":"fire-js",[JO]:"fire-js-all"};/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ed=new Map,eV=new Map,$_=new Map;function zE(n,e){try{n.container.addComponent(e)}catch(t){_i.debug(`Component ${e.name} failed to register with FirebaseApp ${n.name}`,t)}}function ws(n){const e=n.name;if($_.has(e))return _i.debug(`There were multiple attempts to register component ${e}.`),!1;$_.set(e,n);for(const t of Ed.values())zE(t,n);for(const t of eV.values())zE(t,n);return!0}function Qs(n,e){const t=n.container.getProvider("heartbeat").getImmediate({optional:!0});return t&&t.triggerHeartbeat(),n.container.getProvider(e)}function tV(n,e,t=Ng){Qs(n,e).clearInstance(t)}function Kt(n){return n==null?!1:n.settings!==void 0}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const nV={"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."},po=new qa("app","Firebase",nV);/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class rV{constructor(e,t,r){this._isDeleted=!1,this._options={...e},this._config={...t},this._name=t.name,this._automaticDataCollectionEnabled=t.automaticDataCollectionEnabled,this._container=r,this.container.addComponent(new Sr("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this.checkDestroyed(),this._automaticDataCollectionEnabled=e}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(e){this._isDeleted=e}checkDestroyed(){if(this.isDeleted)throw po.create("app-deleted",{appName:this._name})}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ga=XO;function dC(n,e={}){let t=n;typeof e!="object"&&(e={name:e});const r={name:Ng,automaticDataCollectionEnabled:!0,...e},s=r.name;if(typeof s!="string"||!s)throw po.create("bad-app-name",{appName:String(s)});if(t||(t=J1()),!t)throw po.create("no-options");const i=Ed.get(s);if(i){if(Ur(t,i.options)&&Ur(r,i.config))return i;throw po.create("duplicate-app",{appName:s})}const o=new aC(s);for(const l of $_.values())o.addComponent(l);const a=new rV(t,r,o);return Ed.set(s,a),a}function sh(n=Ng){const e=Ed.get(n);if(!e&&n===Ng&&J1())return dC();if(!e)throw po.create("no-app",{appName:n});return e}function sV(){return Array.from(Ed.values())}function Ir(n,e,t){let r=ZO[n]??n;t&&(r+=`-${t}`);const s=r.match(/\s|\//),i=e.match(/\s|\//);if(s||i){const o=[`Unable to register library "${r}" with version "${e}":`];s&&o.push(`library name "${r}" contains illegal characters (whitespace or "/")`),s&&i&&o.push("and"),i&&o.push(`version name "${e}" contains illegal characters (whitespace or "/")`),_i.warn(o.join(" "));return}ws(new Sr(`${r}-version`,()=>({library:r,version:e}),"VERSION"))}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const iV="firebase-heartbeat-database",oV=1,Sd="firebase-heartbeat-store";let yy=null;function hC(){return yy||(yy=uC(iV,oV,{upgrade:(n,e)=>{switch(e){case 0:try{n.createObjectStore(Sd)}catch(t){console.warn(t)}}}}).catch(n=>{throw po.create("idb-open",{originalErrorMessage:n.message})})),yy}async function aV(n){try{const t=(await hC()).transaction(Sd),r=await t.objectStore(Sd).get(fC(n));return await t.done,r}catch(e){if(e instanceof xs)_i.warn(e.message);else{const t=po.create("idb-get",{originalErrorMessage:e==null?void 0:e.message});_i.warn(t.message)}}}async function qE(n,e){try{const r=(await hC()).transaction(Sd,"readwrite");await r.objectStore(Sd).put(e,fC(n)),await r.done}catch(t){if(t instanceof xs)_i.warn(t.message);else{const r=po.create("idb-set",{originalErrorMessage:t==null?void 0:t.message});_i.warn(r.message)}}}function fC(n){return`${n.name}!${n.options.appId}`}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const lV=1024,cV=30;class uV{constructor(e){this.container=e,this._heartbeatsCache=null;const t=this.container.getProvider("app").getImmediate();this._storage=new hV(t),this._heartbeatsCachePromise=this._storage.read().then(r=>(this._heartbeatsCache=r,r))}async triggerHeartbeat(){var e,t;try{const s=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),i=WE();if(((e=this._heartbeatsCache)==null?void 0:e.heartbeats)==null&&(this._heartbeatsCache=await this._heartbeatsCachePromise,((t=this._heartbeatsCache)==null?void 0:t.heartbeats)==null)||this._heartbeatsCache.lastSentHeartbeatDate===i||this._heartbeatsCache.heartbeats.some(o=>o.date===i))return;if(this._heartbeatsCache.heartbeats.push({date:i,agent:s}),this._heartbeatsCache.heartbeats.length>cV){const o=fV(this._heartbeatsCache.heartbeats);this._heartbeatsCache.heartbeats.splice(o,1)}return this._storage.overwrite(this._heartbeatsCache)}catch(r){_i.warn(r)}}async getHeartbeatsHeader(){var e;try{if(this._heartbeatsCache===null&&await this._heartbeatsCachePromise,((e=this._heartbeatsCache)==null?void 0:e.heartbeats)==null||this._heartbeatsCache.heartbeats.length===0)return"";const t=WE(),{heartbeatsToSend:r,unsentEntries:s}=dV(this._heartbeatsCache.heartbeats),i=bg(JSON.stringify({version:2,heartbeats:r}));return this._heartbeatsCache.lastSentHeartbeatDate=t,s.length>0?(this._heartbeatsCache.heartbeats=s,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),i}catch(t){return _i.warn(t),""}}}function WE(){return new Date().toISOString().substring(0,10)}function dV(n,e=lV){const t=[];let r=n.slice();for(const s of n){const i=t.find(o=>o.agent===s.agent);if(i){if(i.dates.push(s.date),GE(t)>e){i.dates.pop();break}}else if(t.push({agent:s.agent,dates:[s.date]}),GE(t)>e){t.pop();break}r=r.slice(1)}return{heartbeatsToSend:t,unsentEntries:r}}class hV{constructor(e){this.app=e,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return Np()?L0().then(()=>!0).catch(()=>!1):!1}async read(){if(await this._canUseIndexedDBPromise){const t=await aV(this.app);return t!=null&&t.heartbeats?t:{heartbeats:[]}}else return{heartbeats:[]}}async overwrite(e){if(await this._canUseIndexedDBPromise){const r=await this.read();return qE(this.app,{lastSentHeartbeatDate:e.lastSentHeartbeatDate??r.lastSentHeartbeatDate,heartbeats:e.heartbeats})}else return}async add(e){if(await this._canUseIndexedDBPromise){const r=await this.read();return qE(this.app,{lastSentHeartbeatDate:e.lastSentHeartbeatDate??r.lastSentHeartbeatDate,heartbeats:[...r.heartbeats,...e.heartbeats]})}else return}}function GE(n){return bg(JSON.stringify({version:2,heartbeats:n})).length}function fV(n){if(n.length===0)return-1;let e=0,t=n[0].date;for(let r=1;r<n.length;r++)n[r].date<t&&(t=n[r].date,e=r);return e}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function gV(n){ws(new Sr("platform-logger",e=>new SO(e),"PRIVATE")),ws(new Sr("heartbeat",e=>new uV(e),"PRIVATE")),Ir(U_,BE,n),Ir(U_,BE,"esm2020"),Ir("fire-js","")}gV("");var pV="firebase",mV="12.1.0";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */Ir(pV,mV,"app");const HE="@firebase/database",KE="1.1.0";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let gC="";function pC(n){gC=n}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class yV{constructor(e){this.domStorage_=e,this.prefix_="firebase:"}set(e,t){t==null?this.domStorage_.removeItem(this.prefixedName_(e)):this.domStorage_.setItem(this.prefixedName_(e),wn(t))}get(e){const t=this.domStorage_.getItem(this.prefixedName_(e));return t==null?null:Id(t)}remove(e){this.domStorage_.removeItem(this.prefixedName_(e))}prefixedName_(e){return this.prefix_+e}toString(){return this.domStorage_.toString()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class _V{constructor(){this.cache_={},this.isInMemoryStorage=!0}set(e,t){t==null?delete this.cache_[e]:this.cache_[e]=t}get(e){return Is(this.cache_,e)?this.cache_[e]:null}remove(e){delete this.cache_[e]}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const mC=function(n){try{if(typeof window<"u"&&typeof window[n]<"u"){const e=window[n];return e.setItem("firebase:sentinel","cache"),e.removeItem("firebase:sentinel"),new yV(e)}}catch{}return new _V},ca=mC("localStorage"),B_=mC("sessionStorage");/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ul=new rh("@firebase/database"),yC=function(){let n=1;return function(){return n++}}(),_C=function(n){const e=rO(n),t=new ZL;t.update(e);const r=t.digest();return k0.encodeByteArray(r)},ih=function(...n){let e="";for(let t=0;t<n.length;t++){const r=n[t];Array.isArray(r)||r&&typeof r=="object"&&typeof r.length=="number"?e+=ih.apply(null,r):typeof r=="object"?e+=wn(r):e+=r,e+=" "}return e};let pa=null,QE=!0;const vC=function(n,e){Z(!e||n===!0||n===!1,"Can't turn on custom loggers persistently."),n===!0?(Ul.logLevel=Ze.VERBOSE,pa=Ul.log.bind(Ul),e&&B_.set("logging_enabled",!0)):typeof n=="function"?pa=n:(pa=null,B_.remove("logging_enabled"))},Nn=function(...n){if(QE===!0&&(QE=!1,pa===null&&B_.get("logging_enabled")===!0&&vC(!0)),pa){const e=ih.apply(null,n);pa(e)}},oh=function(n){return function(...e){Nn(n,...e)}},z_=function(...n){const e="FIREBASE INTERNAL ERROR: "+ih(...n);Ul.error(e)},Gs=function(...n){const e=`FIREBASE FATAL ERROR: ${ih(...n)}`;throw Ul.error(e),new Error(e)},er=function(...n){const e="FIREBASE WARNING: "+ih(...n);Ul.warn(e)},vV=function(){typeof window<"u"&&window.location&&window.location.protocol&&window.location.protocol.indexOf("https:")!==-1&&er("Insecure Firebase access from a secure page. Please use https in calls to new Firebase().")},Pp=function(n){return typeof n=="number"&&(n!==n||n===Number.POSITIVE_INFINITY||n===Number.NEGATIVE_INFINITY)},wV=function(n){if(document.readyState==="complete")n();else{let e=!1;const t=function(){if(!document.body){setTimeout(t,Math.floor(10));return}e||(e=!0,n())};document.addEventListener?(document.addEventListener("DOMContentLoaded",t,!1),window.addEventListener("load",t,!1)):document.attachEvent&&(document.attachEvent("onreadystatechange",()=>{document.readyState==="complete"&&t()}),window.attachEvent("onload",t))}},Eo="[MIN_NAME]",vi="[MAX_NAME]",Ha=function(n,e){if(n===e)return 0;if(n===Eo||e===vi)return-1;if(e===Eo||n===vi)return 1;{const t=YE(n),r=YE(e);return t!==null?r!==null?t-r===0?n.length-e.length:t-r:-1:r!==null?1:n<e?-1:1}},xV=function(n,e){return n===e?0:n<e?-1:1},cu=function(n,e){if(e&&n in e)return e[n];throw new Error("Missing required key ("+n+") in object: "+wn(e))},V0=function(n){if(typeof n!="object"||n===null)return wn(n);const e=[];for(const r in n)e.push(r);e.sort();let t="{";for(let r=0;r<e.length;r++)r!==0&&(t+=","),t+=wn(e[r]),t+=":",t+=V0(n[e[r]]);return t+="}",t},wC=function(n,e){const t=n.length;if(t<=e)return[n];const r=[];for(let s=0;s<t;s+=e)s+e>t?r.push(n.substring(s,t)):r.push(n.substring(s,s+e));return r};function Mn(n,e){for(const t in n)n.hasOwnProperty(t)&&e(t,n[t])}const xC=function(n){Z(!Pp(n),"Invalid JSON number");const e=11,t=52,r=(1<<e-1)-1;let s,i,o,a,l;n===0?(i=0,o=0,s=1/n===-1/0?1:0):(s=n<0,n=Math.abs(n),n>=Math.pow(2,1-r)?(a=Math.min(Math.floor(Math.log(n)/Math.LN2),r),i=a+r,o=Math.round(n*Math.pow(2,t-a)-Math.pow(2,t))):(i=0,o=Math.round(n/Math.pow(2,1-r-t))));const u=[];for(l=t;l;l-=1)u.push(o%2?1:0),o=Math.floor(o/2);for(l=e;l;l-=1)u.push(i%2?1:0),i=Math.floor(i/2);u.push(s?1:0),u.reverse();const h=u.join("");let f="";for(l=0;l<64;l+=8){let g=parseInt(h.substr(l,8),2).toString(16);g.length===1&&(g="0"+g),f=f+g}return f.toLowerCase()},IV=function(){return!!(typeof window=="object"&&window.chrome&&window.chrome.extension&&!/^chrome/.test(window.location.href))},EV=function(){return typeof Windows=="object"&&typeof Windows.UI=="object"};function SV(n,e){let t="Unknown Error";n==="too_big"?t="The data requested exceeds the maximum size that can be accessed with a single request.":n==="permission_denied"?t="Client doesn't have permission to access the desired data.":n==="unavailable"&&(t="The service is unavailable");const r=new Error(n+" at "+e._path.toString()+": "+t);return r.code=n.toUpperCase(),r}const TV=new RegExp("^-?(0*)\\d{1,10}$"),bV=-2147483648,AV=2147483647,YE=function(n){if(TV.test(n)){const e=Number(n);if(e>=bV&&e<=AV)return e}return null},Pc=function(n){try{n()}catch(e){setTimeout(()=>{const t=e.stack||"";throw er("Exception was thrown by user callback.",t),e},Math.floor(0))}},CV=function(){return(typeof window=="object"&&window.navigator&&window.navigator.userAgent||"").search(/googlebot|google webmaster tools|bingbot|yahoo! slurp|baiduspider|yandexbot|duckduckbot/i)>=0},$u=function(n,e){const t=setTimeout(n,e);return typeof t=="number"&&typeof Deno<"u"&&Deno.unrefTimer?Deno.unrefTimer(t):typeof t=="object"&&t.unref&&t.unref(),t};/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class RV{constructor(e,t){this.appCheckProvider=t,this.appName=e.name,Kt(e)&&e.settings.appCheckToken&&(this.serverAppAppCheckToken=e.settings.appCheckToken),this.appCheck=t==null?void 0:t.getImmediate({optional:!0}),this.appCheck||t==null||t.get().then(r=>this.appCheck=r)}getToken(e){if(this.serverAppAppCheckToken){if(e)throw new Error("Attempted reuse of `FirebaseServerApp.appCheckToken` after previous usage failed.");return Promise.resolve({token:this.serverAppAppCheckToken})}return this.appCheck?this.appCheck.getToken(e):new Promise((t,r)=>{setTimeout(()=>{this.appCheck?this.getToken(e).then(t,r):t(null)},0)})}addTokenChangeListener(e){var t;(t=this.appCheckProvider)==null||t.get().then(r=>r.addTokenListener(e))}notifyForInvalidToken(){er(`Provided AppCheck credentials for the app named "${this.appName}" are invalid. This usually indicates your app was not initialized correctly.`)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class NV{constructor(e,t,r){this.appName_=e,this.firebaseOptions_=t,this.authProvider_=r,this.auth_=null,this.auth_=r.getImmediate({optional:!0}),this.auth_||r.onInit(s=>this.auth_=s)}getToken(e){return this.auth_?this.auth_.getToken(e).catch(t=>t&&t.code==="auth/token-not-initialized"?(Nn("Got auth/token-not-initialized error.  Treating as null token."),null):Promise.reject(t)):new Promise((t,r)=>{setTimeout(()=>{this.auth_?this.getToken(e).then(t,r):t(null)},0)})}addTokenChangeListener(e){this.auth_?this.auth_.addAuthTokenListener(e):this.authProvider_.get().then(t=>t.addAuthTokenListener(e))}removeTokenChangeListener(e){this.authProvider_.get().then(t=>t.removeAuthTokenListener(e))}notifyForInvalidToken(){let e='Provided authentication credentials for the app named "'+this.appName_+'" are invalid. This usually indicates your app was not initialized correctly. ';"credential"in this.firebaseOptions_?e+='Make sure the "credential" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':"serviceAccount"in this.firebaseOptions_?e+='Make sure the "serviceAccount" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':e+='Make sure the "apiKey" and "databaseURL" properties provided to initializeApp() match the values provided for your app at https://console.firebase.google.com/.',er(e)}}class $l{constructor(e){this.accessToken=e}getToken(e){return Promise.resolve({accessToken:this.accessToken})}addTokenChangeListener(e){e(this.accessToken)}removeTokenChangeListener(e){}notifyForInvalidToken(){}}$l.OWNER="owner";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const F0="5",IC="v",EC="s",SC="r",TC="f",bC=/(console\.firebase|firebase-console-\w+\.corp|firebase\.corp)\.google\.com/,AC="ls",CC="p",q_="ac",RC="websocket",NC="long_polling";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class kC{constructor(e,t,r,s,i=!1,o="",a=!1,l=!1,u=null){this.secure=t,this.namespace=r,this.webSocketOnly=s,this.nodeAdmin=i,this.persistenceKey=o,this.includeNamespaceInQueryParams=a,this.isUsingEmulator=l,this.emulatorOptions=u,this._host=e.toLowerCase(),this._domain=this._host.substr(this._host.indexOf(".")+1),this.internalHost=ca.get("host:"+e)||this._host}isCacheableHost(){return this.internalHost.substr(0,2)==="s-"}isCustomHost(){return this._domain!=="firebaseio.com"&&this._domain!=="firebaseio-demo.com"}get host(){return this._host}set host(e){e!==this.internalHost&&(this.internalHost=e,this.isCacheableHost()&&ca.set("host:"+this._host,this.internalHost))}toString(){let e=this.toURLString();return this.persistenceKey&&(e+="<"+this.persistenceKey+">"),e}toURLString(){const e=this.secure?"https://":"http://",t=this.includeNamespaceInQueryParams?`?ns=${this.namespace}`:"";return`${e}${this.host}/${t}`}}function kV(n){return n.host!==n.internalHost||n.isCustomHost()||n.includeNamespaceInQueryParams}function PC(n,e,t){Z(typeof e=="string","typeof type must == string"),Z(typeof t=="object","typeof params must == object");let r;if(e===RC)r=(n.secure?"wss://":"ws://")+n.internalHost+"/.ws?";else if(e===NC)r=(n.secure?"https://":"http://")+n.internalHost+"/.lp?";else throw new Error("Unknown connection type: "+e);kV(n)&&(t.ns=n.namespace);const s=[];return Mn(t,(i,o)=>{s.push(i+"="+o)}),r+s.join("&")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class PV{constructor(){this.counters_={}}incrementCounter(e,t=1){Is(this.counters_,e)||(this.counters_[e]=0),this.counters_[e]+=t}get(){return jL(this.counters_)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const _y={},vy={};function j0(n){const e=n.toString();return _y[e]||(_y[e]=new PV),_y[e]}function DV(n,e){const t=n.toString();return vy[t]||(vy[t]=e()),vy[t]}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class MV{constructor(e){this.onMessage_=e,this.pendingResponses=[],this.currentResponseNum=0,this.closeAfterResponse=-1,this.onClose=null}closeAfter(e,t){this.closeAfterResponse=e,this.onClose=t,this.closeAfterResponse<this.currentResponseNum&&(this.onClose(),this.onClose=null)}handleResponse(e,t){for(this.pendingResponses[e]=t;this.pendingResponses[this.currentResponseNum];){const r=this.pendingResponses[this.currentResponseNum];delete this.pendingResponses[this.currentResponseNum];for(let s=0;s<r.length;++s)r[s]&&Pc(()=>{this.onMessage_(r[s])});if(this.currentResponseNum===this.closeAfterResponse){this.onClose&&(this.onClose(),this.onClose=null);break}this.currentResponseNum++}}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const JE="start",LV="close",OV="pLPCommand",VV="pRTLPCB",DC="id",MC="pw",LC="ser",FV="cb",jV="seg",UV="ts",$V="d",BV="dframe",OC=1870,VC=30,zV=OC-VC,qV=25e3,WV=3e4;class Zi{constructor(e,t,r,s,i,o,a){this.connId=e,this.repoInfo=t,this.applicationId=r,this.appCheckToken=s,this.authToken=i,this.transportSessionId=o,this.lastSessionId=a,this.bytesSent=0,this.bytesReceived=0,this.everConnected_=!1,this.log_=oh(e),this.stats_=j0(t),this.urlFn=l=>(this.appCheckToken&&(l[q_]=this.appCheckToken),PC(t,NC,l))}open(e,t){this.curSegmentNum=0,this.onDisconnect_=t,this.myPacketOrderer=new MV(e),this.isClosed_=!1,this.connectTimeoutTimer_=setTimeout(()=>{this.log_("Timed out trying to connect."),this.onClosed_(),this.connectTimeoutTimer_=null},Math.floor(WV)),wV(()=>{if(this.isClosed_)return;this.scriptTagHolder=new U0((...i)=>{const[o,a,l,u,h]=i;if(this.incrementIncomingBytes_(i),!!this.scriptTagHolder)if(this.connectTimeoutTimer_&&(clearTimeout(this.connectTimeoutTimer_),this.connectTimeoutTimer_=null),this.everConnected_=!0,o===JE)this.id=a,this.password=l;else if(o===LV)a?(this.scriptTagHolder.sendNewPolls=!1,this.myPacketOrderer.closeAfter(a,()=>{this.onClosed_()})):this.onClosed_();else throw new Error("Unrecognized command received: "+o)},(...i)=>{const[o,a]=i;this.incrementIncomingBytes_(i),this.myPacketOrderer.handleResponse(o,a)},()=>{this.onClosed_()},this.urlFn);const r={};r[JE]="t",r[LC]=Math.floor(Math.random()*1e8),this.scriptTagHolder.uniqueCallbackIdentifier&&(r[FV]=this.scriptTagHolder.uniqueCallbackIdentifier),r[IC]=F0,this.transportSessionId&&(r[EC]=this.transportSessionId),this.lastSessionId&&(r[AC]=this.lastSessionId),this.applicationId&&(r[CC]=this.applicationId),this.appCheckToken&&(r[q_]=this.appCheckToken),typeof location<"u"&&location.hostname&&bC.test(location.hostname)&&(r[SC]=TC);const s=this.urlFn(r);this.log_("Connecting via long-poll to "+s),this.scriptTagHolder.addTag(s,()=>{})})}start(){this.scriptTagHolder.startLongPoll(this.id,this.password),this.addDisconnectPingFrame(this.id,this.password)}static forceAllow(){Zi.forceAllow_=!0}static forceDisallow(){Zi.forceDisallow_=!0}static isAvailable(){return Zi.forceAllow_?!0:!Zi.forceDisallow_&&typeof document<"u"&&document.createElement!=null&&!IV()&&!EV()}markConnectionHealthy(){}shutdown_(){this.isClosed_=!0,this.scriptTagHolder&&(this.scriptTagHolder.close(),this.scriptTagHolder=null),this.myDisconnFrame&&(document.body.removeChild(this.myDisconnFrame),this.myDisconnFrame=null),this.connectTimeoutTimer_&&(clearTimeout(this.connectTimeoutTimer_),this.connectTimeoutTimer_=null)}onClosed_(){this.isClosed_||(this.log_("Longpoll is closing itself"),this.shutdown_(),this.onDisconnect_&&(this.onDisconnect_(this.everConnected_),this.onDisconnect_=null))}close(){this.isClosed_||(this.log_("Longpoll is being closed."),this.shutdown_())}send(e){const t=wn(e);this.bytesSent+=t.length,this.stats_.incrementCounter("bytes_sent",t.length);const r=G1(t),s=wC(r,zV);for(let i=0;i<s.length;i++)this.scriptTagHolder.enqueueSegment(this.curSegmentNum,s.length,s[i]),this.curSegmentNum++}addDisconnectPingFrame(e,t){this.myDisconnFrame=document.createElement("iframe");const r={};r[BV]="t",r[DC]=e,r[MC]=t,this.myDisconnFrame.src=this.urlFn(r),this.myDisconnFrame.style.display="none",document.body.appendChild(this.myDisconnFrame)}incrementIncomingBytes_(e){const t=wn(e).length;this.bytesReceived+=t,this.stats_.incrementCounter("bytes_received",t)}}class U0{constructor(e,t,r,s){this.onDisconnect=r,this.urlFn=s,this.outstandingRequests=new Set,this.pendingSegs=[],this.currentSerial=Math.floor(Math.random()*1e8),this.sendNewPolls=!0;{this.uniqueCallbackIdentifier=yC(),window[OV+this.uniqueCallbackIdentifier]=e,window[VV+this.uniqueCallbackIdentifier]=t,this.myIFrame=U0.createIFrame_();let i="";this.myIFrame.src&&this.myIFrame.src.substr(0,11)==="javascript:"&&(i='<script>document.domain="'+document.domain+'";<\/script>');const o="<html><body>"+i+"</body></html>";try{this.myIFrame.doc.open(),this.myIFrame.doc.write(o),this.myIFrame.doc.close()}catch(a){Nn("frame writing exception"),a.stack&&Nn(a.stack),Nn(a)}}}static createIFrame_(){const e=document.createElement("iframe");if(e.style.display="none",document.body){document.body.appendChild(e);try{e.contentWindow.document||Nn("No IE domain setting required")}catch{const r=document.domain;e.src="javascript:void((function(){document.open();document.domain='"+r+"';document.close();})())"}}else throw"Document body has not initialized. Wait to initialize Firebase until after the document is ready.";return e.contentDocument?e.doc=e.contentDocument:e.contentWindow?e.doc=e.contentWindow.document:e.document&&(e.doc=e.document),e}close(){this.alive=!1,this.myIFrame&&(this.myIFrame.doc.body.textContent="",setTimeout(()=>{this.myIFrame!==null&&(document.body.removeChild(this.myIFrame),this.myIFrame=null)},Math.floor(0)));const e=this.onDisconnect;e&&(this.onDisconnect=null,e())}startLongPoll(e,t){for(this.myID=e,this.myPW=t,this.alive=!0;this.newRequest_(););}newRequest_(){if(this.alive&&this.sendNewPolls&&this.outstandingRequests.size<(this.pendingSegs.length>0?2:1)){this.currentSerial++;const e={};e[DC]=this.myID,e[MC]=this.myPW,e[LC]=this.currentSerial;let t=this.urlFn(e),r="",s=0;for(;this.pendingSegs.length>0&&this.pendingSegs[0].d.length+VC+r.length<=OC;){const o=this.pendingSegs.shift();r=r+"&"+jV+s+"="+o.seg+"&"+UV+s+"="+o.ts+"&"+$V+s+"="+o.d,s++}return t=t+r,this.addLongPollTag_(t,this.currentSerial),!0}else return!1}enqueueSegment(e,t,r){this.pendingSegs.push({seg:e,ts:t,d:r}),this.alive&&this.newRequest_()}addLongPollTag_(e,t){this.outstandingRequests.add(t);const r=()=>{this.outstandingRequests.delete(t),this.newRequest_()},s=setTimeout(r,Math.floor(qV)),i=()=>{clearTimeout(s),r()};this.addTag(e,i)}addTag(e,t){setTimeout(()=>{try{if(!this.sendNewPolls)return;const r=this.myIFrame.doc.createElement("script");r.type="text/javascript",r.async=!0,r.src=e,r.onload=r.onreadystatechange=function(){const s=r.readyState;(!s||s==="loaded"||s==="complete")&&(r.onload=r.onreadystatechange=null,r.parentNode&&r.parentNode.removeChild(r),t())},r.onerror=()=>{Nn("Long-poll script failed to load: "+e),this.sendNewPolls=!1,this.close()},this.myIFrame.doc.body.appendChild(r)}catch{}},Math.floor(1))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const GV=16384,HV=45e3;let kg=null;typeof MozWebSocket<"u"?kg=MozWebSocket:typeof WebSocket<"u"&&(kg=WebSocket);class Yr{constructor(e,t,r,s,i,o,a){this.connId=e,this.applicationId=r,this.appCheckToken=s,this.authToken=i,this.keepaliveTimer=null,this.frames=null,this.totalFrames=0,this.bytesSent=0,this.bytesReceived=0,this.log_=oh(this.connId),this.stats_=j0(t),this.connURL=Yr.connectionURL_(t,o,a,s,r),this.nodeAdmin=t.nodeAdmin}static connectionURL_(e,t,r,s,i){const o={};return o[IC]=F0,typeof location<"u"&&location.hostname&&bC.test(location.hostname)&&(o[SC]=TC),t&&(o[EC]=t),r&&(o[AC]=r),s&&(o[q_]=s),i&&(o[CC]=i),PC(e,RC,o)}open(e,t){this.onDisconnect=t,this.onMessage=e,this.log_("Websocket connecting to "+this.connURL),this.everConnected_=!1,ca.set("previous_websocket_failure",!0);try{let r;nC(),this.mySock=new kg(this.connURL,[],r)}catch(r){this.log_("Error instantiating WebSocket.");const s=r.message||r.data;s&&this.log_(s),this.onClosed_();return}this.mySock.onopen=()=>{this.log_("Websocket connected."),this.everConnected_=!0},this.mySock.onclose=()=>{this.log_("Websocket connection was disconnected."),this.mySock=null,this.onClosed_()},this.mySock.onmessage=r=>{this.handleIncomingFrame(r)},this.mySock.onerror=r=>{this.log_("WebSocket error.  Closing connection.");const s=r.message||r.data;s&&this.log_(s),this.onClosed_()}}start(){}static forceDisallow(){Yr.forceDisallow_=!0}static isAvailable(){let e=!1;if(typeof navigator<"u"&&navigator.userAgent){const t=/Android ([0-9]{0,}\.[0-9]{0,})/,r=navigator.userAgent.match(t);r&&r.length>1&&parseFloat(r[1])<4.4&&(e=!0)}return!e&&kg!==null&&!Yr.forceDisallow_}static previouslyFailed(){return ca.isInMemoryStorage||ca.get("previous_websocket_failure")===!0}markConnectionHealthy(){ca.remove("previous_websocket_failure")}appendFrame_(e){if(this.frames.push(e),this.frames.length===this.totalFrames){const t=this.frames.join("");this.frames=null;const r=Id(t);this.onMessage(r)}}handleNewFrameCount_(e){this.totalFrames=e,this.frames=[]}extractFrameCount_(e){if(Z(this.frames===null,"We already have a frame buffer"),e.length<=6){const t=Number(e);if(!isNaN(t))return this.handleNewFrameCount_(t),null}return this.handleNewFrameCount_(1),e}handleIncomingFrame(e){if(this.mySock===null)return;const t=e.data;if(this.bytesReceived+=t.length,this.stats_.incrementCounter("bytes_received",t.length),this.resetKeepAlive(),this.frames!==null)this.appendFrame_(t);else{const r=this.extractFrameCount_(t);r!==null&&this.appendFrame_(r)}}send(e){this.resetKeepAlive();const t=wn(e);this.bytesSent+=t.length,this.stats_.incrementCounter("bytes_sent",t.length);const r=wC(t,GV);r.length>1&&this.sendString_(String(r.length));for(let s=0;s<r.length;s++)this.sendString_(r[s])}shutdown_(){this.isClosed_=!0,this.keepaliveTimer&&(clearInterval(this.keepaliveTimer),this.keepaliveTimer=null),this.mySock&&(this.mySock.close(),this.mySock=null)}onClosed_(){this.isClosed_||(this.log_("WebSocket is closing itself"),this.shutdown_(),this.onDisconnect&&(this.onDisconnect(this.everConnected_),this.onDisconnect=null))}close(){this.isClosed_||(this.log_("WebSocket is being closed"),this.shutdown_())}resetKeepAlive(){clearInterval(this.keepaliveTimer),this.keepaliveTimer=setInterval(()=>{this.mySock&&this.sendString_("0"),this.resetKeepAlive()},Math.floor(HV))}sendString_(e){try{this.mySock.send(e)}catch(t){this.log_("Exception thrown from WebSocket.send():",t.message||t.data,"Closing connection."),setTimeout(this.onClosed_.bind(this),0)}}}Yr.responsesRequiredToBeHealthy=2;Yr.healthyTimeout=3e4;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class nc{static get ALL_TRANSPORTS(){return[Zi,Yr]}static get IS_TRANSPORT_INITIALIZED(){return this.globalTransportInitialized_}constructor(e){this.initTransports_(e)}initTransports_(e){const t=Yr&&Yr.isAvailable();let r=t&&!Yr.previouslyFailed();if(e.webSocketOnly&&(t||er("wss:// URL used, but browser isn't known to support websockets.  Trying anyway."),r=!0),r)this.transports_=[Yr];else{const s=this.transports_=[];for(const i of nc.ALL_TRANSPORTS)i&&i.isAvailable()&&s.push(i);nc.globalTransportInitialized_=!0}}initialTransport(){if(this.transports_.length>0)return this.transports_[0];throw new Error("No transports available")}upgradeTransport(){return this.transports_.length>1?this.transports_[1]:null}}nc.globalTransportInitialized_=!1;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const KV=6e4,QV=5e3,YV=10*1024,JV=100*1024,wy="t",XE="d",XV="s",ZE="r",ZV="e",eS="o",tS="a",nS="n",rS="p",eF="h";class tF{constructor(e,t,r,s,i,o,a,l,u,h){this.id=e,this.repoInfo_=t,this.applicationId_=r,this.appCheckToken_=s,this.authToken_=i,this.onMessage_=o,this.onReady_=a,this.onDisconnect_=l,this.onKill_=u,this.lastSessionId=h,this.connectionCount=0,this.pendingDataMessages=[],this.state_=0,this.log_=oh("c:"+this.id+":"),this.transportManager_=new nc(t),this.log_("Connection created"),this.start_()}start_(){const e=this.transportManager_.initialTransport();this.conn_=new e(this.nextTransportId_(),this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,null,this.lastSessionId),this.primaryResponsesRequired_=e.responsesRequiredToBeHealthy||0;const t=this.connReceiver_(this.conn_),r=this.disconnReceiver_(this.conn_);this.tx_=this.conn_,this.rx_=this.conn_,this.secondaryConn_=null,this.isHealthy_=!1,setTimeout(()=>{this.conn_&&this.conn_.open(t,r)},Math.floor(0));const s=e.healthyTimeout||0;s>0&&(this.healthyTimeout_=$u(()=>{this.healthyTimeout_=null,this.isHealthy_||(this.conn_&&this.conn_.bytesReceived>JV?(this.log_("Connection exceeded healthy timeout but has received "+this.conn_.bytesReceived+" bytes.  Marking connection healthy."),this.isHealthy_=!0,this.conn_.markConnectionHealthy()):this.conn_&&this.conn_.bytesSent>YV?this.log_("Connection exceeded healthy timeout but has sent "+this.conn_.bytesSent+" bytes.  Leaving connection alive."):(this.log_("Closing unhealthy connection after timeout."),this.close()))},Math.floor(s)))}nextTransportId_(){return"c:"+this.id+":"+this.connectionCount++}disconnReceiver_(e){return t=>{e===this.conn_?this.onConnectionLost_(t):e===this.secondaryConn_?(this.log_("Secondary connection lost."),this.onSecondaryConnectionLost_()):this.log_("closing an old connection")}}connReceiver_(e){return t=>{this.state_!==2&&(e===this.rx_?this.onPrimaryMessageReceived_(t):e===this.secondaryConn_?this.onSecondaryMessageReceived_(t):this.log_("message on old connection"))}}sendRequest(e){const t={t:"d",d:e};this.sendData_(t)}tryCleanupConnection(){this.tx_===this.secondaryConn_&&this.rx_===this.secondaryConn_&&(this.log_("cleaning up and promoting a connection: "+this.secondaryConn_.connId),this.conn_=this.secondaryConn_,this.secondaryConn_=null)}onSecondaryControl_(e){if(wy in e){const t=e[wy];t===tS?this.upgradeIfSecondaryHealthy_():t===ZE?(this.log_("Got a reset on secondary, closing it"),this.secondaryConn_.close(),(this.tx_===this.secondaryConn_||this.rx_===this.secondaryConn_)&&this.close()):t===eS&&(this.log_("got pong on secondary."),this.secondaryResponsesRequired_--,this.upgradeIfSecondaryHealthy_())}}onSecondaryMessageReceived_(e){const t=cu("t",e),r=cu("d",e);if(t==="c")this.onSecondaryControl_(r);else if(t==="d")this.pendingDataMessages.push(r);else throw new Error("Unknown protocol layer: "+t)}upgradeIfSecondaryHealthy_(){this.secondaryResponsesRequired_<=0?(this.log_("Secondary connection is healthy."),this.isHealthy_=!0,this.secondaryConn_.markConnectionHealthy(),this.proceedWithUpgrade_()):(this.log_("sending ping on secondary."),this.secondaryConn_.send({t:"c",d:{t:rS,d:{}}}))}proceedWithUpgrade_(){this.secondaryConn_.start(),this.log_("sending client ack on secondary"),this.secondaryConn_.send({t:"c",d:{t:tS,d:{}}}),this.log_("Ending transmission on primary"),this.conn_.send({t:"c",d:{t:nS,d:{}}}),this.tx_=this.secondaryConn_,this.tryCleanupConnection()}onPrimaryMessageReceived_(e){const t=cu("t",e),r=cu("d",e);t==="c"?this.onControl_(r):t==="d"&&this.onDataMessage_(r)}onDataMessage_(e){this.onPrimaryResponse_(),this.onMessage_(e)}onPrimaryResponse_(){this.isHealthy_||(this.primaryResponsesRequired_--,this.primaryResponsesRequired_<=0&&(this.log_("Primary connection is healthy."),this.isHealthy_=!0,this.conn_.markConnectionHealthy()))}onControl_(e){const t=cu(wy,e);if(XE in e){const r=e[XE];if(t===eF){const s={...r};this.repoInfo_.isUsingEmulator&&(s.h=this.repoInfo_.host),this.onHandshake_(s)}else if(t===nS){this.log_("recvd end transmission on primary"),this.rx_=this.secondaryConn_;for(let s=0;s<this.pendingDataMessages.length;++s)this.onDataMessage_(this.pendingDataMessages[s]);this.pendingDataMessages=[],this.tryCleanupConnection()}else t===XV?this.onConnectionShutdown_(r):t===ZE?this.onReset_(r):t===ZV?z_("Server Error: "+r):t===eS?(this.log_("got pong on primary."),this.onPrimaryResponse_(),this.sendPingOnPrimaryIfNecessary_()):z_("Unknown control packet command: "+t)}}onHandshake_(e){const t=e.ts,r=e.v,s=e.h;this.sessionId=e.s,this.repoInfo_.host=s,this.state_===0&&(this.conn_.start(),this.onConnectionEstablished_(this.conn_,t),F0!==r&&er("Protocol version mismatch detected"),this.tryStartUpgrade_())}tryStartUpgrade_(){const e=this.transportManager_.upgradeTransport();e&&this.startUpgrade_(e)}startUpgrade_(e){this.secondaryConn_=new e(this.nextTransportId_(),this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,this.sessionId),this.secondaryResponsesRequired_=e.responsesRequiredToBeHealthy||0;const t=this.connReceiver_(this.secondaryConn_),r=this.disconnReceiver_(this.secondaryConn_);this.secondaryConn_.open(t,r),$u(()=>{this.secondaryConn_&&(this.log_("Timed out trying to upgrade."),this.secondaryConn_.close())},Math.floor(KV))}onReset_(e){this.log_("Reset packet received.  New host: "+e),this.repoInfo_.host=e,this.state_===1?this.close():(this.closeConnections_(),this.start_())}onConnectionEstablished_(e,t){this.log_("Realtime connection established."),this.conn_=e,this.state_=1,this.onReady_&&(this.onReady_(t,this.sessionId),this.onReady_=null),this.primaryResponsesRequired_===0?(this.log_("Primary connection is healthy."),this.isHealthy_=!0):$u(()=>{this.sendPingOnPrimaryIfNecessary_()},Math.floor(QV))}sendPingOnPrimaryIfNecessary_(){!this.isHealthy_&&this.state_===1&&(this.log_("sending ping on primary."),this.sendData_({t:"c",d:{t:rS,d:{}}}))}onSecondaryConnectionLost_(){const e=this.secondaryConn_;this.secondaryConn_=null,(this.tx_===e||this.rx_===e)&&this.close()}onConnectionLost_(e){this.conn_=null,!e&&this.state_===0?(this.log_("Realtime connection failed."),this.repoInfo_.isCacheableHost()&&(ca.remove("host:"+this.repoInfo_.host),this.repoInfo_.internalHost=this.repoInfo_.host)):this.state_===1&&this.log_("Realtime connection lost."),this.close()}onConnectionShutdown_(e){this.log_("Connection shutdown command received. Shutting down..."),this.onKill_&&(this.onKill_(e),this.onKill_=null),this.onDisconnect_=null,this.close()}sendData_(e){if(this.state_!==1)throw"Connection is not connected";this.tx_.send(e)}close(){this.state_!==2&&(this.log_("Closing realtime connection."),this.state_=2,this.closeConnections_(),this.onDisconnect_&&(this.onDisconnect_(),this.onDisconnect_=null))}closeConnections_(){this.log_("Shutting down all connections"),this.conn_&&(this.conn_.close(),this.conn_=null),this.secondaryConn_&&(this.secondaryConn_.close(),this.secondaryConn_=null),this.healthyTimeout_&&(clearTimeout(this.healthyTimeout_),this.healthyTimeout_=null)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class FC{put(e,t,r,s){}merge(e,t,r,s){}refreshAuthToken(e){}refreshAppCheckToken(e){}onDisconnectPut(e,t,r){}onDisconnectMerge(e,t,r){}onDisconnectCancel(e,t){}reportStats(e){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class jC{constructor(e){this.allowedEvents_=e,this.listeners_={},Z(Array.isArray(e)&&e.length>0,"Requires a non-empty array")}trigger(e,...t){if(Array.isArray(this.listeners_[e])){const r=[...this.listeners_[e]];for(let s=0;s<r.length;s++)r[s].callback.apply(r[s].context,t)}}on(e,t,r){this.validateEventType_(e),this.listeners_[e]=this.listeners_[e]||[],this.listeners_[e].push({callback:t,context:r});const s=this.getInitialEvent(e);s&&t.apply(r,s)}off(e,t,r){this.validateEventType_(e);const s=this.listeners_[e]||[];for(let i=0;i<s.length;i++)if(s[i].callback===t&&(!r||r===s[i].context)){s.splice(i,1);return}}validateEventType_(e){Z(this.allowedEvents_.find(t=>t===e),"Unknown event: "+e)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Pg extends jC{static getInstance(){return new Pg}constructor(){super(["online"]),this.online_=!0,typeof window<"u"&&typeof window.addEventListener<"u"&&!D0()&&(window.addEventListener("online",()=>{this.online_||(this.online_=!0,this.trigger("online",!0))},!1),window.addEventListener("offline",()=>{this.online_&&(this.online_=!1,this.trigger("online",!1))},!1))}getInitialEvent(e){return Z(e==="online","Unknown event type: "+e),[this.online_]}currentlyOnline(){return this.online_}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const sS=32,iS=768;class xt{constructor(e,t){if(t===void 0){this.pieces_=e.split("/");let r=0;for(let s=0;s<this.pieces_.length;s++)this.pieces_[s].length>0&&(this.pieces_[r]=this.pieces_[s],r++);this.pieces_.length=r,this.pieceNum_=0}else this.pieces_=e,this.pieceNum_=t}toString(){let e="";for(let t=this.pieceNum_;t<this.pieces_.length;t++)this.pieces_[t]!==""&&(e+="/"+this.pieces_[t]);return e||"/"}}function pt(){return new xt("")}function We(n){return n.pieceNum_>=n.pieces_.length?null:n.pieces_[n.pieceNum_]}function So(n){return n.pieces_.length-n.pieceNum_}function Nt(n){let e=n.pieceNum_;return e<n.pieces_.length&&e++,new xt(n.pieces_,e)}function $0(n){return n.pieceNum_<n.pieces_.length?n.pieces_[n.pieces_.length-1]:null}function nF(n){let e="";for(let t=n.pieceNum_;t<n.pieces_.length;t++)n.pieces_[t]!==""&&(e+="/"+encodeURIComponent(String(n.pieces_[t])));return e||"/"}function Td(n,e=0){return n.pieces_.slice(n.pieceNum_+e)}function UC(n){if(n.pieceNum_>=n.pieces_.length)return null;const e=[];for(let t=n.pieceNum_;t<n.pieces_.length-1;t++)e.push(n.pieces_[t]);return new xt(e,0)}function Qt(n,e){const t=[];for(let r=n.pieceNum_;r<n.pieces_.length;r++)t.push(n.pieces_[r]);if(e instanceof xt)for(let r=e.pieceNum_;r<e.pieces_.length;r++)t.push(e.pieces_[r]);else{const r=e.split("/");for(let s=0;s<r.length;s++)r[s].length>0&&t.push(r[s])}return new xt(t,0)}function Ge(n){return n.pieceNum_>=n.pieces_.length}function or(n,e){const t=We(n),r=We(e);if(t===null)return e;if(t===r)return or(Nt(n),Nt(e));throw new Error("INTERNAL ERROR: innerPath ("+e+") is not within outerPath ("+n+")")}function rF(n,e){const t=Td(n,0),r=Td(e,0);for(let s=0;s<t.length&&s<r.length;s++){const i=Ha(t[s],r[s]);if(i!==0)return i}return t.length===r.length?0:t.length<r.length?-1:1}function B0(n,e){if(So(n)!==So(e))return!1;for(let t=n.pieceNum_,r=e.pieceNum_;t<=n.pieces_.length;t++,r++)if(n.pieces_[t]!==e.pieces_[r])return!1;return!0}function Xr(n,e){let t=n.pieceNum_,r=e.pieceNum_;if(So(n)>So(e))return!1;for(;t<n.pieces_.length;){if(n.pieces_[t]!==e.pieces_[r])return!1;++t,++r}return!0}class sF{constructor(e,t){this.errorPrefix_=t,this.parts_=Td(e,0),this.byteLength_=Math.max(1,this.parts_.length);for(let r=0;r<this.parts_.length;r++)this.byteLength_+=kp(this.parts_[r]);$C(this)}}function iF(n,e){n.parts_.length>0&&(n.byteLength_+=1),n.parts_.push(e),n.byteLength_+=kp(e),$C(n)}function oF(n){const e=n.parts_.pop();n.byteLength_-=kp(e),n.parts_.length>0&&(n.byteLength_-=1)}function $C(n){if(n.byteLength_>iS)throw new Error(n.errorPrefix_+"has a key path longer than "+iS+" bytes ("+n.byteLength_+").");if(n.parts_.length>sS)throw new Error(n.errorPrefix_+"path specified exceeds the maximum depth that can be written ("+sS+") or object contains a cycle "+Zo(n))}function Zo(n){return n.parts_.length===0?"":"in property '"+n.parts_.join(".")+"'"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class z0 extends jC{static getInstance(){return new z0}constructor(){super(["visible"]);let e,t;typeof document<"u"&&typeof document.addEventListener<"u"&&(typeof document.hidden<"u"?(t="visibilitychange",e="hidden"):typeof document.mozHidden<"u"?(t="mozvisibilitychange",e="mozHidden"):typeof document.msHidden<"u"?(t="msvisibilitychange",e="msHidden"):typeof document.webkitHidden<"u"&&(t="webkitvisibilitychange",e="webkitHidden")),this.visible_=!0,t&&document.addEventListener(t,()=>{const r=!document[e];r!==this.visible_&&(this.visible_=r,this.trigger("visible",r))},!1)}getInitialEvent(e){return Z(e==="visible","Unknown event type: "+e),[this.visible_]}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const uu=1e3,aF=60*5*1e3,oS=30*1e3,lF=1.3,cF=3e4,uF="server_kill",aS=3;class es extends FC{constructor(e,t,r,s,i,o,a,l){if(super(),this.repoInfo_=e,this.applicationId_=t,this.onDataUpdate_=r,this.onConnectStatus_=s,this.onServerInfoUpdate_=i,this.authTokenProvider_=o,this.appCheckTokenProvider_=a,this.authOverride_=l,this.id=es.nextPersistentConnectionId_++,this.log_=oh("p:"+this.id+":"),this.interruptReasons_={},this.listens=new Map,this.outstandingPuts_=[],this.outstandingGets_=[],this.outstandingPutCount_=0,this.outstandingGetCount_=0,this.onDisconnectRequestQueue_=[],this.connected_=!1,this.reconnectDelay_=uu,this.maxReconnectDelay_=aF,this.securityDebugCallback_=null,this.lastSessionId=null,this.establishConnectionTimer_=null,this.visible_=!1,this.requestCBHash_={},this.requestNumber_=0,this.realtime_=null,this.authToken_=null,this.appCheckToken_=null,this.forceTokenRefresh_=!1,this.invalidAuthTokenCount_=0,this.invalidAppCheckTokenCount_=0,this.firstConnection_=!0,this.lastConnectionAttemptTime_=null,this.lastConnectionEstablishedTime_=null,l&&!nC())throw new Error("Auth override specified in options, but not supported on non Node.js platforms");z0.getInstance().on("visible",this.onVisible_,this),e.host.indexOf("fblocal")===-1&&Pg.getInstance().on("online",this.onOnline_,this)}sendRequest(e,t,r){const s=++this.requestNumber_,i={r:s,a:e,b:t};this.log_(wn(i)),Z(this.connected_,"sendRequest call when we're not connected not allowed."),this.realtime_.sendRequest(i),r&&(this.requestCBHash_[s]=r)}get(e){this.initConnection_();const t=new Pr,s={action:"g",request:{p:e._path.toString(),q:e._queryObject},onComplete:o=>{const a=o.d;o.s==="ok"?t.resolve(a):t.reject(a)}};this.outstandingGets_.push(s),this.outstandingGetCount_++;const i=this.outstandingGets_.length-1;return this.connected_&&this.sendGet_(i),t.promise}listen(e,t,r,s){this.initConnection_();const i=e._queryIdentifier,o=e._path.toString();this.log_("Listen called for "+o+" "+i),this.listens.has(o)||this.listens.set(o,new Map),Z(e._queryParams.isDefault()||!e._queryParams.loadsAllData(),"listen() called for non-default but complete query"),Z(!this.listens.get(o).has(i),"listen() called twice for same path/queryId.");const a={onComplete:s,hashFn:t,query:e,tag:r};this.listens.get(o).set(i,a),this.connected_&&this.sendListen_(a)}sendGet_(e){const t=this.outstandingGets_[e];this.sendRequest("g",t.request,r=>{delete this.outstandingGets_[e],this.outstandingGetCount_--,this.outstandingGetCount_===0&&(this.outstandingGets_=[]),t.onComplete&&t.onComplete(r)})}sendListen_(e){const t=e.query,r=t._path.toString(),s=t._queryIdentifier;this.log_("Listen on "+r+" for "+s);const i={p:r},o="q";e.tag&&(i.q=t._queryObject,i.t=e.tag),i.h=e.hashFn(),this.sendRequest(o,i,a=>{const l=a.d,u=a.s;es.warnOnListenWarnings_(l,t),(this.listens.get(r)&&this.listens.get(r).get(s))===e&&(this.log_("listen response",a),u!=="ok"&&this.removeListen_(r,s),e.onComplete&&e.onComplete(u,l))})}static warnOnListenWarnings_(e,t){if(e&&typeof e=="object"&&Is(e,"w")){const r=Ta(e,"w");if(Array.isArray(r)&&~r.indexOf("no_index")){const s='".indexOn": "'+t._queryParams.getIndex().toString()+'"',i=t._path.toString();er(`Using an unspecified index. Your data will be downloaded and filtered on the client. Consider adding ${s} at ${i} to your security rules for better performance.`)}}}refreshAuthToken(e){this.authToken_=e,this.log_("Auth token refreshed"),this.authToken_?this.tryAuth():this.connected_&&this.sendRequest("unauth",{},()=>{}),this.reduceReconnectDelayIfAdminCredential_(e)}reduceReconnectDelayIfAdminCredential_(e){(e&&e.length===40||XL(e))&&(this.log_("Admin auth credential detected.  Reducing max reconnect time."),this.maxReconnectDelay_=oS)}refreshAppCheckToken(e){this.appCheckToken_=e,this.log_("App check token refreshed"),this.appCheckToken_?this.tryAppCheck():this.connected_&&this.sendRequest("unappeck",{},()=>{})}tryAuth(){if(this.connected_&&this.authToken_){const e=this.authToken_,t=JL(e)?"auth":"gauth",r={cred:e};this.authOverride_===null?r.noauth=!0:typeof this.authOverride_=="object"&&(r.authvar=this.authOverride_),this.sendRequest(t,r,s=>{const i=s.s,o=s.d||"error";this.authToken_===e&&(i==="ok"?this.invalidAuthTokenCount_=0:this.onAuthRevoked_(i,o))})}}tryAppCheck(){this.connected_&&this.appCheckToken_&&this.sendRequest("appcheck",{token:this.appCheckToken_},e=>{const t=e.s,r=e.d||"error";t==="ok"?this.invalidAppCheckTokenCount_=0:this.onAppCheckRevoked_(t,r)})}unlisten(e,t){const r=e._path.toString(),s=e._queryIdentifier;this.log_("Unlisten called for "+r+" "+s),Z(e._queryParams.isDefault()||!e._queryParams.loadsAllData(),"unlisten() called for non-default but complete query"),this.removeListen_(r,s)&&this.connected_&&this.sendUnlisten_(r,s,e._queryObject,t)}sendUnlisten_(e,t,r,s){this.log_("Unlisten on "+e+" for "+t);const i={p:e},o="n";s&&(i.q=r,i.t=s),this.sendRequest(o,i)}onDisconnectPut(e,t,r){this.initConnection_(),this.connected_?this.sendOnDisconnect_("o",e,t,r):this.onDisconnectRequestQueue_.push({pathString:e,action:"o",data:t,onComplete:r})}onDisconnectMerge(e,t,r){this.initConnection_(),this.connected_?this.sendOnDisconnect_("om",e,t,r):this.onDisconnectRequestQueue_.push({pathString:e,action:"om",data:t,onComplete:r})}onDisconnectCancel(e,t){this.initConnection_(),this.connected_?this.sendOnDisconnect_("oc",e,null,t):this.onDisconnectRequestQueue_.push({pathString:e,action:"oc",data:null,onComplete:t})}sendOnDisconnect_(e,t,r,s){const i={p:t,d:r};this.log_("onDisconnect "+e,i),this.sendRequest(e,i,o=>{s&&setTimeout(()=>{s(o.s,o.d)},Math.floor(0))})}put(e,t,r,s){this.putInternal("p",e,t,r,s)}merge(e,t,r,s){this.putInternal("m",e,t,r,s)}putInternal(e,t,r,s,i){this.initConnection_();const o={p:t,d:r};i!==void 0&&(o.h=i),this.outstandingPuts_.push({action:e,request:o,onComplete:s}),this.outstandingPutCount_++;const a=this.outstandingPuts_.length-1;this.connected_?this.sendPut_(a):this.log_("Buffering put: "+t)}sendPut_(e){const t=this.outstandingPuts_[e].action,r=this.outstandingPuts_[e].request,s=this.outstandingPuts_[e].onComplete;this.outstandingPuts_[e].queued=this.connected_,this.sendRequest(t,r,i=>{this.log_(t+" response",i),delete this.outstandingPuts_[e],this.outstandingPutCount_--,this.outstandingPutCount_===0&&(this.outstandingPuts_=[]),s&&s(i.s,i.d)})}reportStats(e){if(this.connected_){const t={c:e};this.log_("reportStats",t),this.sendRequest("s",t,r=>{if(r.s!=="ok"){const i=r.d;this.log_("reportStats","Error sending stats: "+i)}})}}onDataMessage_(e){if("r"in e){this.log_("from server: "+wn(e));const t=e.r,r=this.requestCBHash_[t];r&&(delete this.requestCBHash_[t],r(e.b))}else{if("error"in e)throw"A server-side error has occurred: "+e.error;"a"in e&&this.onDataPush_(e.a,e.b)}}onDataPush_(e,t){this.log_("handleServerMessage",e,t),e==="d"?this.onDataUpdate_(t.p,t.d,!1,t.t):e==="m"?this.onDataUpdate_(t.p,t.d,!0,t.t):e==="c"?this.onListenRevoked_(t.p,t.q):e==="ac"?this.onAuthRevoked_(t.s,t.d):e==="apc"?this.onAppCheckRevoked_(t.s,t.d):e==="sd"?this.onSecurityDebugPacket_(t):z_("Unrecognized action received from server: "+wn(e)+`
Are you using the latest client?`)}onReady_(e,t){this.log_("connection ready"),this.connected_=!0,this.lastConnectionEstablishedTime_=new Date().getTime(),this.handleTimestamp_(e),this.lastSessionId=t,this.firstConnection_&&this.sendConnectStats_(),this.restoreState_(),this.firstConnection_=!1,this.onConnectStatus_(!0)}scheduleConnect_(e){Z(!this.realtime_,"Scheduling a connect when we're already connected/ing?"),this.establishConnectionTimer_&&clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=setTimeout(()=>{this.establishConnectionTimer_=null,this.establishConnection_()},Math.floor(e))}initConnection_(){!this.realtime_&&this.firstConnection_&&this.scheduleConnect_(0)}onVisible_(e){e&&!this.visible_&&this.reconnectDelay_===this.maxReconnectDelay_&&(this.log_("Window became visible.  Reducing delay."),this.reconnectDelay_=uu,this.realtime_||this.scheduleConnect_(0)),this.visible_=e}onOnline_(e){e?(this.log_("Browser went online."),this.reconnectDelay_=uu,this.realtime_||this.scheduleConnect_(0)):(this.log_("Browser went offline.  Killing connection."),this.realtime_&&this.realtime_.close())}onRealtimeDisconnect_(){if(this.log_("data client disconnected"),this.connected_=!1,this.realtime_=null,this.cancelSentTransactions_(),this.requestCBHash_={},this.shouldReconnect_()){this.visible_?this.lastConnectionEstablishedTime_&&(new Date().getTime()-this.lastConnectionEstablishedTime_>cF&&(this.reconnectDelay_=uu),this.lastConnectionEstablishedTime_=null):(this.log_("Window isn't visible.  Delaying reconnect."),this.reconnectDelay_=this.maxReconnectDelay_,this.lastConnectionAttemptTime_=new Date().getTime());const e=Math.max(0,new Date().getTime()-this.lastConnectionAttemptTime_);let t=Math.max(0,this.reconnectDelay_-e);t=Math.random()*t,this.log_("Trying to reconnect in "+t+"ms"),this.scheduleConnect_(t),this.reconnectDelay_=Math.min(this.maxReconnectDelay_,this.reconnectDelay_*lF)}this.onConnectStatus_(!1)}async establishConnection_(){if(this.shouldReconnect_()){this.log_("Making a connection attempt"),this.lastConnectionAttemptTime_=new Date().getTime(),this.lastConnectionEstablishedTime_=null;const e=this.onDataMessage_.bind(this),t=this.onReady_.bind(this),r=this.onRealtimeDisconnect_.bind(this),s=this.id+":"+es.nextConnectionId_++,i=this.lastSessionId;let o=!1,a=null;const l=function(){a?a.close():(o=!0,r())},u=function(f){Z(a,"sendRequest call when we're not connected not allowed."),a.sendRequest(f)};this.realtime_={close:l,sendRequest:u};const h=this.forceTokenRefresh_;this.forceTokenRefresh_=!1;try{const[f,g]=await Promise.all([this.authTokenProvider_.getToken(h),this.appCheckTokenProvider_.getToken(h)]);o?Nn("getToken() completed but was canceled"):(Nn("getToken() completed. Creating connection."),this.authToken_=f&&f.accessToken,this.appCheckToken_=g&&g.token,a=new tF(s,this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,e,t,r,y=>{er(y+" ("+this.repoInfo_.toString()+")"),this.interrupt(uF)},i))}catch(f){this.log_("Failed to get token: "+f),o||(this.repoInfo_.nodeAdmin&&er(f),l())}}}interrupt(e){Nn("Interrupting connection for reason: "+e),this.interruptReasons_[e]=!0,this.realtime_?this.realtime_.close():(this.establishConnectionTimer_&&(clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=null),this.connected_&&this.onRealtimeDisconnect_())}resume(e){Nn("Resuming connection for reason: "+e),delete this.interruptReasons_[e],Cg(this.interruptReasons_)&&(this.reconnectDelay_=uu,this.realtime_||this.scheduleConnect_(0))}handleTimestamp_(e){const t=e-new Date().getTime();this.onServerInfoUpdate_({serverTimeOffset:t})}cancelSentTransactions_(){for(let e=0;e<this.outstandingPuts_.length;e++){const t=this.outstandingPuts_[e];t&&"h"in t.request&&t.queued&&(t.onComplete&&t.onComplete("disconnect"),delete this.outstandingPuts_[e],this.outstandingPutCount_--)}this.outstandingPutCount_===0&&(this.outstandingPuts_=[])}onListenRevoked_(e,t){let r;t?r=t.map(i=>V0(i)).join("$"):r="default";const s=this.removeListen_(e,r);s&&s.onComplete&&s.onComplete("permission_denied")}removeListen_(e,t){const r=new xt(e).toString();let s;if(this.listens.has(r)){const i=this.listens.get(r);s=i.get(t),i.delete(t),i.size===0&&this.listens.delete(r)}else s=void 0;return s}onAuthRevoked_(e,t){Nn("Auth token revoked: "+e+"/"+t),this.authToken_=null,this.forceTokenRefresh_=!0,this.realtime_.close(),(e==="invalid_token"||e==="permission_denied")&&(this.invalidAuthTokenCount_++,this.invalidAuthTokenCount_>=aS&&(this.reconnectDelay_=oS,this.authTokenProvider_.notifyForInvalidToken()))}onAppCheckRevoked_(e,t){Nn("App check token revoked: "+e+"/"+t),this.appCheckToken_=null,this.forceTokenRefresh_=!0,(e==="invalid_token"||e==="permission_denied")&&(this.invalidAppCheckTokenCount_++,this.invalidAppCheckTokenCount_>=aS&&this.appCheckTokenProvider_.notifyForInvalidToken())}onSecurityDebugPacket_(e){this.securityDebugCallback_?this.securityDebugCallback_(e):"msg"in e&&console.log("FIREBASE: "+e.msg.replace(`
`,`
FIREBASE: `))}restoreState_(){this.tryAuth(),this.tryAppCheck();for(const e of this.listens.values())for(const t of e.values())this.sendListen_(t);for(let e=0;e<this.outstandingPuts_.length;e++)this.outstandingPuts_[e]&&this.sendPut_(e);for(;this.onDisconnectRequestQueue_.length;){const e=this.onDisconnectRequestQueue_.shift();this.sendOnDisconnect_(e.action,e.pathString,e.data,e.onComplete)}for(let e=0;e<this.outstandingGets_.length;e++)this.outstandingGets_[e]&&this.sendGet_(e)}sendConnectStats_(){const e={};let t="js";e["sdk."+t+"."+gC.replace(/\./g,"-")]=1,D0()?e["framework.cordova"]=1:tC()&&(e["framework.reactnative"]=1),this.reportStats(e)}shouldReconnect_(){const e=Pg.getInstance().currentlyOnline();return Cg(this.interruptReasons_)&&e}}es.nextPersistentConnectionId_=0;es.nextConnectionId_=0;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ye{constructor(e,t){this.name=e,this.node=t}static Wrap(e,t){return new Ye(e,t)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Dp{getCompare(){return this.compare.bind(this)}indexedValueChanged(e,t){const r=new Ye(Eo,e),s=new Ye(Eo,t);return this.compare(r,s)!==0}minPost(){return Ye.MIN}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let uf;class BC extends Dp{static get __EMPTY_NODE(){return uf}static set __EMPTY_NODE(e){uf=e}compare(e,t){return Ha(e.name,t.name)}isDefinedOn(e){throw kc("KeyIndex.isDefinedOn not expected to be called.")}indexedValueChanged(e,t){return!1}minPost(){return Ye.MIN}maxPost(){return new Ye(vi,uf)}makePost(e,t){return Z(typeof e=="string","KeyIndex indexValue must always be a string."),new Ye(e,uf)}toString(){return".key"}}const $s=new BC;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let df=class{constructor(e,t,r,s,i=null){this.isReverse_=s,this.resultGenerator_=i,this.nodeStack_=[];let o=1;for(;!e.isEmpty();)if(e=e,o=t?r(e.key,t):1,s&&(o*=-1),o<0)this.isReverse_?e=e.left:e=e.right;else if(o===0){this.nodeStack_.push(e);break}else this.nodeStack_.push(e),this.isReverse_?e=e.right:e=e.left}getNext(){if(this.nodeStack_.length===0)return null;let e=this.nodeStack_.pop(),t;if(this.resultGenerator_?t=this.resultGenerator_(e.key,e.value):t={key:e.key,value:e.value},this.isReverse_)for(e=e.left;!e.isEmpty();)this.nodeStack_.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack_.push(e),e=e.left;return t}hasNext(){return this.nodeStack_.length>0}peek(){if(this.nodeStack_.length===0)return null;const e=this.nodeStack_[this.nodeStack_.length-1];return this.resultGenerator_?this.resultGenerator_(e.key,e.value):{key:e.key,value:e.value}}},Nr=class Tu{constructor(e,t,r,s,i){this.key=e,this.value=t,this.color=r??Tu.RED,this.left=s??Ms.EMPTY_NODE,this.right=i??Ms.EMPTY_NODE}copy(e,t,r,s,i){return new Tu(e??this.key,t??this.value,r??this.color,s??this.left,i??this.right)}count(){return this.left.count()+1+this.right.count()}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||!!e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min_(){return this.left.isEmpty()?this:this.left.min_()}minKey(){return this.min_().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,r){let s=this;const i=r(e,s.key);return i<0?s=s.copy(null,null,null,s.left.insert(e,t,r),null):i===0?s=s.copy(null,t,null,null,null):s=s.copy(null,null,null,null,s.right.insert(e,t,r)),s.fixUp_()}removeMin_(){if(this.left.isEmpty())return Ms.EMPTY_NODE;let e=this;return!e.left.isRed_()&&!e.left.left.isRed_()&&(e=e.moveRedLeft_()),e=e.copy(null,null,null,e.left.removeMin_(),null),e.fixUp_()}remove(e,t){let r,s;if(r=this,t(e,r.key)<0)!r.left.isEmpty()&&!r.left.isRed_()&&!r.left.left.isRed_()&&(r=r.moveRedLeft_()),r=r.copy(null,null,null,r.left.remove(e,t),null);else{if(r.left.isRed_()&&(r=r.rotateRight_()),!r.right.isEmpty()&&!r.right.isRed_()&&!r.right.left.isRed_()&&(r=r.moveRedRight_()),t(e,r.key)===0){if(r.right.isEmpty())return Ms.EMPTY_NODE;s=r.right.min_(),r=r.copy(s.key,s.value,null,null,r.right.removeMin_())}r=r.copy(null,null,null,null,r.right.remove(e,t))}return r.fixUp_()}isRed_(){return this.color}fixUp_(){let e=this;return e.right.isRed_()&&!e.left.isRed_()&&(e=e.rotateLeft_()),e.left.isRed_()&&e.left.left.isRed_()&&(e=e.rotateRight_()),e.left.isRed_()&&e.right.isRed_()&&(e=e.colorFlip_()),e}moveRedLeft_(){let e=this.colorFlip_();return e.right.left.isRed_()&&(e=e.copy(null,null,null,null,e.right.rotateRight_()),e=e.rotateLeft_(),e=e.colorFlip_()),e}moveRedRight_(){let e=this.colorFlip_();return e.left.left.isRed_()&&(e=e.rotateRight_(),e=e.colorFlip_()),e}rotateLeft_(){const e=this.copy(null,null,Tu.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight_(){const e=this.copy(null,null,Tu.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip_(){const e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth_(){const e=this.check_();return Math.pow(2,e)<=this.count()+1}check_(){if(this.isRed_()&&this.left.isRed_())throw new Error("Red node has red child("+this.key+","+this.value+")");if(this.right.isRed_())throw new Error("Right child of ("+this.key+","+this.value+") is red");const e=this.left.check_();if(e!==this.right.check_())throw new Error("Black depths differ");return e+(this.isRed_()?0:1)}};Nr.RED=!0;Nr.BLACK=!1;class dF{copy(e,t,r,s,i){return this}insert(e,t,r){return new Nr(e,t,null)}remove(e,t){return this}count(){return 0}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}check_(){return 0}isRed_(){return!1}}let Ms=class Ff{constructor(e,t=Ff.EMPTY_NODE){this.comparator_=e,this.root_=t}insert(e,t){return new Ff(this.comparator_,this.root_.insert(e,t,this.comparator_).copy(null,null,Nr.BLACK,null,null))}remove(e){return new Ff(this.comparator_,this.root_.remove(e,this.comparator_).copy(null,null,Nr.BLACK,null,null))}get(e){let t,r=this.root_;for(;!r.isEmpty();){if(t=this.comparator_(e,r.key),t===0)return r.value;t<0?r=r.left:t>0&&(r=r.right)}return null}getPredecessorKey(e){let t,r=this.root_,s=null;for(;!r.isEmpty();)if(t=this.comparator_(e,r.key),t===0){if(r.left.isEmpty())return s?s.key:null;for(r=r.left;!r.right.isEmpty();)r=r.right;return r.key}else t<0?r=r.left:t>0&&(s=r,r=r.right);throw new Error("Attempted to find predecessor key for a nonexistent key.  What gives?")}isEmpty(){return this.root_.isEmpty()}count(){return this.root_.count()}minKey(){return this.root_.minKey()}maxKey(){return this.root_.maxKey()}inorderTraversal(e){return this.root_.inorderTraversal(e)}reverseTraversal(e){return this.root_.reverseTraversal(e)}getIterator(e){return new df(this.root_,null,this.comparator_,!1,e)}getIteratorFrom(e,t){return new df(this.root_,e,this.comparator_,!1,t)}getReverseIteratorFrom(e,t){return new df(this.root_,e,this.comparator_,!0,t)}getReverseIterator(e){return new df(this.root_,null,this.comparator_,!0,e)}};Ms.EMPTY_NODE=new dF;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function hF(n,e){return Ha(n.name,e.name)}function q0(n,e){return Ha(n,e)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let W_;function fF(n){W_=n}const zC=function(n){return typeof n=="number"?"number:"+xC(n):"string:"+n},qC=function(n){if(n.isLeafNode()){const e=n.val();Z(typeof e=="string"||typeof e=="number"||typeof e=="object"&&Is(e,".sv"),"Priority must be a string or number.")}else Z(n===W_||n.isEmpty(),"priority of unexpected type.");Z(n===W_||n.getPriority().isEmpty(),"Priority nodes can't have a priority of their own.")};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let lS;class bn{static set __childrenNodeConstructor(e){lS=e}static get __childrenNodeConstructor(){return lS}constructor(e,t=bn.__childrenNodeConstructor.EMPTY_NODE){this.value_=e,this.priorityNode_=t,this.lazyHash_=null,Z(this.value_!==void 0&&this.value_!==null,"LeafNode shouldn't be created with null/undefined value."),qC(this.priorityNode_)}isLeafNode(){return!0}getPriority(){return this.priorityNode_}updatePriority(e){return new bn(this.value_,e)}getImmediateChild(e){return e===".priority"?this.priorityNode_:bn.__childrenNodeConstructor.EMPTY_NODE}getChild(e){return Ge(e)?this:We(e)===".priority"?this.priorityNode_:bn.__childrenNodeConstructor.EMPTY_NODE}hasChild(){return!1}getPredecessorChildName(e,t){return null}updateImmediateChild(e,t){return e===".priority"?this.updatePriority(t):t.isEmpty()&&e!==".priority"?this:bn.__childrenNodeConstructor.EMPTY_NODE.updateImmediateChild(e,t).updatePriority(this.priorityNode_)}updateChild(e,t){const r=We(e);return r===null?t:t.isEmpty()&&r!==".priority"?this:(Z(r!==".priority"||So(e)===1,".priority must be the last token in a path"),this.updateImmediateChild(r,bn.__childrenNodeConstructor.EMPTY_NODE.updateChild(Nt(e),t)))}isEmpty(){return!1}numChildren(){return 0}forEachChild(e,t){return!1}val(e){return e&&!this.getPriority().isEmpty()?{".value":this.getValue(),".priority":this.getPriority().val()}:this.getValue()}hash(){if(this.lazyHash_===null){let e="";this.priorityNode_.isEmpty()||(e+="priority:"+zC(this.priorityNode_.val())+":");const t=typeof this.value_;e+=t+":",t==="number"?e+=xC(this.value_):e+=this.value_,this.lazyHash_=_C(e)}return this.lazyHash_}getValue(){return this.value_}compareTo(e){return e===bn.__childrenNodeConstructor.EMPTY_NODE?1:e instanceof bn.__childrenNodeConstructor?-1:(Z(e.isLeafNode(),"Unknown node type"),this.compareToLeafNode_(e))}compareToLeafNode_(e){const t=typeof e.value_,r=typeof this.value_,s=bn.VALUE_TYPE_ORDER.indexOf(t),i=bn.VALUE_TYPE_ORDER.indexOf(r);return Z(s>=0,"Unknown leaf type: "+t),Z(i>=0,"Unknown leaf type: "+r),s===i?r==="object"?0:this.value_<e.value_?-1:this.value_===e.value_?0:1:i-s}withIndex(){return this}isIndexed(){return!0}equals(e){if(e===this)return!0;if(e.isLeafNode()){const t=e;return this.value_===t.value_&&this.priorityNode_.equals(t.priorityNode_)}else return!1}}bn.VALUE_TYPE_ORDER=["object","boolean","number","string"];/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let WC,GC;function gF(n){WC=n}function pF(n){GC=n}class mF extends Dp{compare(e,t){const r=e.node.getPriority(),s=t.node.getPriority(),i=r.compareTo(s);return i===0?Ha(e.name,t.name):i}isDefinedOn(e){return!e.getPriority().isEmpty()}indexedValueChanged(e,t){return!e.getPriority().equals(t.getPriority())}minPost(){return Ye.MIN}maxPost(){return new Ye(vi,new bn("[PRIORITY-POST]",GC))}makePost(e,t){const r=WC(e);return new Ye(t,new bn("[PRIORITY-POST]",r))}toString(){return".priority"}}const Lt=new mF;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const yF=Math.log(2);class _F{constructor(e){const t=i=>parseInt(Math.log(i)/yF,10),r=i=>parseInt(Array(i+1).join("1"),2);this.count=t(e+1),this.current_=this.count-1;const s=r(this.count);this.bits_=e+1&s}nextBitIsOne(){const e=!(this.bits_&1<<this.current_);return this.current_--,e}}const Dg=function(n,e,t,r){n.sort(e);const s=function(l,u){const h=u-l;let f,g;if(h===0)return null;if(h===1)return f=n[l],g=t?t(f):f,new Nr(g,f.node,Nr.BLACK,null,null);{const y=parseInt(h/2,10)+l,w=s(l,y),C=s(y+1,u);return f=n[y],g=t?t(f):f,new Nr(g,f.node,Nr.BLACK,w,C)}},i=function(l){let u=null,h=null,f=n.length;const g=function(w,C){const M=f-w,A=f;f-=w;const I=s(M+1,A),R=n[M],D=t?t(R):R;y(new Nr(D,R.node,C,null,I))},y=function(w){u?(u.left=w,u=w):(h=w,u=w)};for(let w=0;w<l.count;++w){const C=l.nextBitIsOne(),M=Math.pow(2,l.count-(w+1));C?g(M,Nr.BLACK):(g(M,Nr.BLACK),g(M,Nr.RED))}return h},o=new _F(n.length),a=i(o);return new Ms(r||e,a)};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let xy;const ll={};class li{static get Default(){return Z(ll&&Lt,"ChildrenNode.ts has not been loaded"),xy=xy||new li({".priority":ll},{".priority":Lt}),xy}constructor(e,t){this.indexes_=e,this.indexSet_=t}get(e){const t=Ta(this.indexes_,e);if(!t)throw new Error("No index defined for "+e);return t instanceof Ms?t:null}hasIndex(e){return Is(this.indexSet_,e.toString())}addIndex(e,t){Z(e!==$s,"KeyIndex always exists and isn't meant to be added to the IndexMap.");const r=[];let s=!1;const i=t.getIterator(Ye.Wrap);let o=i.getNext();for(;o;)s=s||e.isDefinedOn(o.node),r.push(o),o=i.getNext();let a;s?a=Dg(r,e.getCompare()):a=ll;const l=e.toString(),u={...this.indexSet_};u[l]=e;const h={...this.indexes_};return h[l]=a,new li(h,u)}addToIndexes(e,t){const r=Rg(this.indexes_,(s,i)=>{const o=Ta(this.indexSet_,i);if(Z(o,"Missing index implementation for "+i),s===ll)if(o.isDefinedOn(e.node)){const a=[],l=t.getIterator(Ye.Wrap);let u=l.getNext();for(;u;)u.name!==e.name&&a.push(u),u=l.getNext();return a.push(e),Dg(a,o.getCompare())}else return ll;else{const a=t.get(e.name);let l=s;return a&&(l=l.remove(new Ye(e.name,a))),l.insert(e,e.node)}});return new li(r,this.indexSet_)}removeFromIndexes(e,t){const r=Rg(this.indexes_,s=>{if(s===ll)return s;{const i=t.get(e.name);return i?s.remove(new Ye(e.name,i)):s}});return new li(r,this.indexSet_)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let du;class Ne{static get EMPTY_NODE(){return du||(du=new Ne(new Ms(q0),null,li.Default))}constructor(e,t,r){this.children_=e,this.priorityNode_=t,this.indexMap_=r,this.lazyHash_=null,this.priorityNode_&&qC(this.priorityNode_),this.children_.isEmpty()&&Z(!this.priorityNode_||this.priorityNode_.isEmpty(),"An empty node cannot have a priority")}isLeafNode(){return!1}getPriority(){return this.priorityNode_||du}updatePriority(e){return this.children_.isEmpty()?this:new Ne(this.children_,e,this.indexMap_)}getImmediateChild(e){if(e===".priority")return this.getPriority();{const t=this.children_.get(e);return t===null?du:t}}getChild(e){const t=We(e);return t===null?this:this.getImmediateChild(t).getChild(Nt(e))}hasChild(e){return this.children_.get(e)!==null}updateImmediateChild(e,t){if(Z(t,"We should always be passing snapshot nodes"),e===".priority")return this.updatePriority(t);{const r=new Ye(e,t);let s,i;t.isEmpty()?(s=this.children_.remove(e),i=this.indexMap_.removeFromIndexes(r,this.children_)):(s=this.children_.insert(e,t),i=this.indexMap_.addToIndexes(r,this.children_));const o=s.isEmpty()?du:this.priorityNode_;return new Ne(s,o,i)}}updateChild(e,t){const r=We(e);if(r===null)return t;{Z(We(e)!==".priority"||So(e)===1,".priority must be the last token in a path");const s=this.getImmediateChild(r).updateChild(Nt(e),t);return this.updateImmediateChild(r,s)}}isEmpty(){return this.children_.isEmpty()}numChildren(){return this.children_.count()}val(e){if(this.isEmpty())return null;const t={};let r=0,s=0,i=!0;if(this.forEachChild(Lt,(o,a)=>{t[o]=a.val(e),r++,i&&Ne.INTEGER_REGEXP_.test(o)?s=Math.max(s,Number(o)):i=!1}),!e&&i&&s<2*r){const o=[];for(const a in t)o[a]=t[a];return o}else return e&&!this.getPriority().isEmpty()&&(t[".priority"]=this.getPriority().val()),t}hash(){if(this.lazyHash_===null){let e="";this.getPriority().isEmpty()||(e+="priority:"+zC(this.getPriority().val())+":"),this.forEachChild(Lt,(t,r)=>{const s=r.hash();s!==""&&(e+=":"+t+":"+s)}),this.lazyHash_=e===""?"":_C(e)}return this.lazyHash_}getPredecessorChildName(e,t,r){const s=this.resolveIndex_(r);if(s){const i=s.getPredecessorKey(new Ye(e,t));return i?i.name:null}else return this.children_.getPredecessorKey(e)}getFirstChildName(e){const t=this.resolveIndex_(e);if(t){const r=t.minKey();return r&&r.name}else return this.children_.minKey()}getFirstChild(e){const t=this.getFirstChildName(e);return t?new Ye(t,this.children_.get(t)):null}getLastChildName(e){const t=this.resolveIndex_(e);if(t){const r=t.maxKey();return r&&r.name}else return this.children_.maxKey()}getLastChild(e){const t=this.getLastChildName(e);return t?new Ye(t,this.children_.get(t)):null}forEachChild(e,t){const r=this.resolveIndex_(e);return r?r.inorderTraversal(s=>t(s.name,s.node)):this.children_.inorderTraversal(t)}getIterator(e){return this.getIteratorFrom(e.minPost(),e)}getIteratorFrom(e,t){const r=this.resolveIndex_(t);if(r)return r.getIteratorFrom(e,s=>s);{const s=this.children_.getIteratorFrom(e.name,Ye.Wrap);let i=s.peek();for(;i!=null&&t.compare(i,e)<0;)s.getNext(),i=s.peek();return s}}getReverseIterator(e){return this.getReverseIteratorFrom(e.maxPost(),e)}getReverseIteratorFrom(e,t){const r=this.resolveIndex_(t);if(r)return r.getReverseIteratorFrom(e,s=>s);{const s=this.children_.getReverseIteratorFrom(e.name,Ye.Wrap);let i=s.peek();for(;i!=null&&t.compare(i,e)>0;)s.getNext(),i=s.peek();return s}}compareTo(e){return this.isEmpty()?e.isEmpty()?0:-1:e.isLeafNode()||e.isEmpty()?1:e===ah?-1:0}withIndex(e){if(e===$s||this.indexMap_.hasIndex(e))return this;{const t=this.indexMap_.addIndex(e,this.children_);return new Ne(this.children_,this.priorityNode_,t)}}isIndexed(e){return e===$s||this.indexMap_.hasIndex(e)}equals(e){if(e===this)return!0;if(e.isLeafNode())return!1;{const t=e;if(this.getPriority().equals(t.getPriority()))if(this.children_.count()===t.children_.count()){const r=this.getIterator(Lt),s=t.getIterator(Lt);let i=r.getNext(),o=s.getNext();for(;i&&o;){if(i.name!==o.name||!i.node.equals(o.node))return!1;i=r.getNext(),o=s.getNext()}return i===null&&o===null}else return!1;else return!1}}resolveIndex_(e){return e===$s?null:this.indexMap_.get(e.toString())}}Ne.INTEGER_REGEXP_=/^(0|[1-9]\d*)$/;class vF extends Ne{constructor(){super(new Ms(q0),Ne.EMPTY_NODE,li.Default)}compareTo(e){return e===this?0:1}equals(e){return e===this}getPriority(){return this}getImmediateChild(e){return Ne.EMPTY_NODE}isEmpty(){return!1}}const ah=new vF;Object.defineProperties(Ye,{MIN:{value:new Ye(Eo,Ne.EMPTY_NODE)},MAX:{value:new Ye(vi,ah)}});BC.__EMPTY_NODE=Ne.EMPTY_NODE;bn.__childrenNodeConstructor=Ne;fF(ah);pF(ah);/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const wF=!0;function Zt(n,e=null){if(n===null)return Ne.EMPTY_NODE;if(typeof n=="object"&&".priority"in n&&(e=n[".priority"]),Z(e===null||typeof e=="string"||typeof e=="number"||typeof e=="object"&&".sv"in e,"Invalid priority type found: "+typeof e),typeof n=="object"&&".value"in n&&n[".value"]!==null&&(n=n[".value"]),typeof n!="object"||".sv"in n){const t=n;return new bn(t,Zt(e))}if(!(n instanceof Array)&&wF){const t=[];let r=!1;if(Mn(n,(o,a)=>{if(o.substring(0,1)!=="."){const l=Zt(a);l.isEmpty()||(r=r||!l.getPriority().isEmpty(),t.push(new Ye(o,l)))}}),t.length===0)return Ne.EMPTY_NODE;const i=Dg(t,hF,o=>o.name,q0);if(r){const o=Dg(t,Lt.getCompare());return new Ne(i,Zt(e),new li({".priority":o},{".priority":Lt}))}else return new Ne(i,Zt(e),li.Default)}else{let t=Ne.EMPTY_NODE;return Mn(n,(r,s)=>{if(Is(n,r)&&r.substring(0,1)!=="."){const i=Zt(s);(i.isLeafNode()||!i.isEmpty())&&(t=t.updateImmediateChild(r,i))}}),t.updatePriority(Zt(e))}}gF(Zt);/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class W0 extends Dp{constructor(e){super(),this.indexPath_=e,Z(!Ge(e)&&We(e)!==".priority","Can't create PathIndex with empty path or .priority key")}extractChild(e){return e.getChild(this.indexPath_)}isDefinedOn(e){return!e.getChild(this.indexPath_).isEmpty()}compare(e,t){const r=this.extractChild(e.node),s=this.extractChild(t.node),i=r.compareTo(s);return i===0?Ha(e.name,t.name):i}makePost(e,t){const r=Zt(e),s=Ne.EMPTY_NODE.updateChild(this.indexPath_,r);return new Ye(t,s)}maxPost(){const e=Ne.EMPTY_NODE.updateChild(this.indexPath_,ah);return new Ye(vi,e)}toString(){return Td(this.indexPath_,0).join("/")}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class xF extends Dp{compare(e,t){const r=e.node.compareTo(t.node);return r===0?Ha(e.name,t.name):r}isDefinedOn(e){return!0}indexedValueChanged(e,t){return!e.equals(t)}minPost(){return Ye.MIN}maxPost(){return Ye.MAX}makePost(e,t){const r=Zt(e);return new Ye(t,r)}toString(){return".value"}}const G0=new xF;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function HC(n){return{type:"value",snapshotNode:n}}function rc(n,e){return{type:"child_added",snapshotNode:e,childName:n}}function bd(n,e){return{type:"child_removed",snapshotNode:e,childName:n}}function Ad(n,e,t){return{type:"child_changed",snapshotNode:e,childName:n,oldSnap:t}}function IF(n,e){return{type:"child_moved",snapshotNode:e,childName:n}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class H0{constructor(e){this.index_=e}updateChild(e,t,r,s,i,o){Z(e.isIndexed(this.index_),"A node must be indexed if only a child is updated");const a=e.getImmediateChild(t);return a.getChild(s).equals(r.getChild(s))&&a.isEmpty()===r.isEmpty()||(o!=null&&(r.isEmpty()?e.hasChild(t)?o.trackChildChange(bd(t,a)):Z(e.isLeafNode(),"A child remove without an old child only makes sense on a leaf node"):a.isEmpty()?o.trackChildChange(rc(t,r)):o.trackChildChange(Ad(t,r,a))),e.isLeafNode()&&r.isEmpty())?e:e.updateImmediateChild(t,r).withIndex(this.index_)}updateFullNode(e,t,r){return r!=null&&(e.isLeafNode()||e.forEachChild(Lt,(s,i)=>{t.hasChild(s)||r.trackChildChange(bd(s,i))}),t.isLeafNode()||t.forEachChild(Lt,(s,i)=>{if(e.hasChild(s)){const o=e.getImmediateChild(s);o.equals(i)||r.trackChildChange(Ad(s,i,o))}else r.trackChildChange(rc(s,i))})),t.withIndex(this.index_)}updatePriority(e,t){return e.isEmpty()?Ne.EMPTY_NODE:e.updatePriority(t)}filtersNodes(){return!1}getIndexedFilter(){return this}getIndex(){return this.index_}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Cd{constructor(e){this.indexedFilter_=new H0(e.getIndex()),this.index_=e.getIndex(),this.startPost_=Cd.getStartPost_(e),this.endPost_=Cd.getEndPost_(e),this.startIsInclusive_=!e.startAfterSet_,this.endIsInclusive_=!e.endBeforeSet_}getStartPost(){return this.startPost_}getEndPost(){return this.endPost_}matches(e){const t=this.startIsInclusive_?this.index_.compare(this.getStartPost(),e)<=0:this.index_.compare(this.getStartPost(),e)<0,r=this.endIsInclusive_?this.index_.compare(e,this.getEndPost())<=0:this.index_.compare(e,this.getEndPost())<0;return t&&r}updateChild(e,t,r,s,i,o){return this.matches(new Ye(t,r))||(r=Ne.EMPTY_NODE),this.indexedFilter_.updateChild(e,t,r,s,i,o)}updateFullNode(e,t,r){t.isLeafNode()&&(t=Ne.EMPTY_NODE);let s=t.withIndex(this.index_);s=s.updatePriority(Ne.EMPTY_NODE);const i=this;return t.forEachChild(Lt,(o,a)=>{i.matches(new Ye(o,a))||(s=s.updateImmediateChild(o,Ne.EMPTY_NODE))}),this.indexedFilter_.updateFullNode(e,s,r)}updatePriority(e,t){return e}filtersNodes(){return!0}getIndexedFilter(){return this.indexedFilter_}getIndex(){return this.index_}static getStartPost_(e){if(e.hasStart()){const t=e.getIndexStartName();return e.getIndex().makePost(e.getIndexStartValue(),t)}else return e.getIndex().minPost()}static getEndPost_(e){if(e.hasEnd()){const t=e.getIndexEndName();return e.getIndex().makePost(e.getIndexEndValue(),t)}else return e.getIndex().maxPost()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class EF{constructor(e){this.withinDirectionalStart=t=>this.reverse_?this.withinEndPost(t):this.withinStartPost(t),this.withinDirectionalEnd=t=>this.reverse_?this.withinStartPost(t):this.withinEndPost(t),this.withinStartPost=t=>{const r=this.index_.compare(this.rangedFilter_.getStartPost(),t);return this.startIsInclusive_?r<=0:r<0},this.withinEndPost=t=>{const r=this.index_.compare(t,this.rangedFilter_.getEndPost());return this.endIsInclusive_?r<=0:r<0},this.rangedFilter_=new Cd(e),this.index_=e.getIndex(),this.limit_=e.getLimit(),this.reverse_=!e.isViewFromLeft(),this.startIsInclusive_=!e.startAfterSet_,this.endIsInclusive_=!e.endBeforeSet_}updateChild(e,t,r,s,i,o){return this.rangedFilter_.matches(new Ye(t,r))||(r=Ne.EMPTY_NODE),e.getImmediateChild(t).equals(r)?e:e.numChildren()<this.limit_?this.rangedFilter_.getIndexedFilter().updateChild(e,t,r,s,i,o):this.fullLimitUpdateChild_(e,t,r,i,o)}updateFullNode(e,t,r){let s;if(t.isLeafNode()||t.isEmpty())s=Ne.EMPTY_NODE.withIndex(this.index_);else if(this.limit_*2<t.numChildren()&&t.isIndexed(this.index_)){s=Ne.EMPTY_NODE.withIndex(this.index_);let i;this.reverse_?i=t.getReverseIteratorFrom(this.rangedFilter_.getEndPost(),this.index_):i=t.getIteratorFrom(this.rangedFilter_.getStartPost(),this.index_);let o=0;for(;i.hasNext()&&o<this.limit_;){const a=i.getNext();if(this.withinDirectionalStart(a))if(this.withinDirectionalEnd(a))s=s.updateImmediateChild(a.name,a.node),o++;else break;else continue}}else{s=t.withIndex(this.index_),s=s.updatePriority(Ne.EMPTY_NODE);let i;this.reverse_?i=s.getReverseIterator(this.index_):i=s.getIterator(this.index_);let o=0;for(;i.hasNext();){const a=i.getNext();o<this.limit_&&this.withinDirectionalStart(a)&&this.withinDirectionalEnd(a)?o++:s=s.updateImmediateChild(a.name,Ne.EMPTY_NODE)}}return this.rangedFilter_.getIndexedFilter().updateFullNode(e,s,r)}updatePriority(e,t){return e}filtersNodes(){return!0}getIndexedFilter(){return this.rangedFilter_.getIndexedFilter()}getIndex(){return this.index_}fullLimitUpdateChild_(e,t,r,s,i){let o;if(this.reverse_){const f=this.index_.getCompare();o=(g,y)=>f(y,g)}else o=this.index_.getCompare();const a=e;Z(a.numChildren()===this.limit_,"");const l=new Ye(t,r),u=this.reverse_?a.getFirstChild(this.index_):a.getLastChild(this.index_),h=this.rangedFilter_.matches(l);if(a.hasChild(t)){const f=a.getImmediateChild(t);let g=s.getChildAfterChild(this.index_,u,this.reverse_);for(;g!=null&&(g.name===t||a.hasChild(g.name));)g=s.getChildAfterChild(this.index_,g,this.reverse_);const y=g==null?1:o(g,l);if(h&&!r.isEmpty()&&y>=0)return i!=null&&i.trackChildChange(Ad(t,r,f)),a.updateImmediateChild(t,r);{i!=null&&i.trackChildChange(bd(t,f));const C=a.updateImmediateChild(t,Ne.EMPTY_NODE);return g!=null&&this.rangedFilter_.matches(g)?(i!=null&&i.trackChildChange(rc(g.name,g.node)),C.updateImmediateChild(g.name,g.node)):C}}else return r.isEmpty()?e:h&&o(u,l)>=0?(i!=null&&(i.trackChildChange(bd(u.name,u.node)),i.trackChildChange(rc(t,r))),a.updateImmediateChild(t,r).updateImmediateChild(u.name,Ne.EMPTY_NODE)):e}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class K0{constructor(){this.limitSet_=!1,this.startSet_=!1,this.startNameSet_=!1,this.startAfterSet_=!1,this.endSet_=!1,this.endNameSet_=!1,this.endBeforeSet_=!1,this.limit_=0,this.viewFrom_="",this.indexStartValue_=null,this.indexStartName_="",this.indexEndValue_=null,this.indexEndName_="",this.index_=Lt}hasStart(){return this.startSet_}isViewFromLeft(){return this.viewFrom_===""?this.startSet_:this.viewFrom_==="l"}getIndexStartValue(){return Z(this.startSet_,"Only valid if start has been set"),this.indexStartValue_}getIndexStartName(){return Z(this.startSet_,"Only valid if start has been set"),this.startNameSet_?this.indexStartName_:Eo}hasEnd(){return this.endSet_}getIndexEndValue(){return Z(this.endSet_,"Only valid if end has been set"),this.indexEndValue_}getIndexEndName(){return Z(this.endSet_,"Only valid if end has been set"),this.endNameSet_?this.indexEndName_:vi}hasLimit(){return this.limitSet_}hasAnchoredLimit(){return this.limitSet_&&this.viewFrom_!==""}getLimit(){return Z(this.limitSet_,"Only valid if limit has been set"),this.limit_}getIndex(){return this.index_}loadsAllData(){return!(this.startSet_||this.endSet_||this.limitSet_)}isDefault(){return this.loadsAllData()&&this.index_===Lt}copy(){const e=new K0;return e.limitSet_=this.limitSet_,e.limit_=this.limit_,e.startSet_=this.startSet_,e.startAfterSet_=this.startAfterSet_,e.indexStartValue_=this.indexStartValue_,e.startNameSet_=this.startNameSet_,e.indexStartName_=this.indexStartName_,e.endSet_=this.endSet_,e.endBeforeSet_=this.endBeforeSet_,e.indexEndValue_=this.indexEndValue_,e.endNameSet_=this.endNameSet_,e.indexEndName_=this.indexEndName_,e.index_=this.index_,e.viewFrom_=this.viewFrom_,e}}function SF(n){return n.loadsAllData()?new H0(n.getIndex()):n.hasLimit()?new EF(n):new Cd(n)}function TF(n,e){const t=n.copy();return t.limitSet_=!0,t.limit_=e,t.viewFrom_="l",t}function bF(n,e){const t=n.copy();return t.limitSet_=!0,t.limit_=e,t.viewFrom_="r",t}function G_(n,e,t){const r=n.copy();return r.startSet_=!0,e===void 0&&(e=null),r.indexStartValue_=e,t!=null?(r.startNameSet_=!0,r.indexStartName_=t):(r.startNameSet_=!1,r.indexStartName_=""),r}function AF(n,e,t){let r;return n.index_===$s||t?r=G_(n,e,t):r=G_(n,e,vi),r.startAfterSet_=!0,r}function H_(n,e,t){const r=n.copy();return r.endSet_=!0,e===void 0&&(e=null),r.indexEndValue_=e,t!==void 0?(r.endNameSet_=!0,r.indexEndName_=t):(r.endNameSet_=!1,r.indexEndName_=""),r}function CF(n,e,t){let r;return n.index_===$s||t?r=H_(n,e,t):r=H_(n,e,Eo),r.endBeforeSet_=!0,r}function Mp(n,e){const t=n.copy();return t.index_=e,t}function cS(n){const e={};if(n.isDefault())return e;let t;if(n.index_===Lt?t="$priority":n.index_===G0?t="$value":n.index_===$s?t="$key":(Z(n.index_ instanceof W0,"Unrecognized index type!"),t=n.index_.toString()),e.orderBy=wn(t),n.startSet_){const r=n.startAfterSet_?"startAfter":"startAt";e[r]=wn(n.indexStartValue_),n.startNameSet_&&(e[r]+=","+wn(n.indexStartName_))}if(n.endSet_){const r=n.endBeforeSet_?"endBefore":"endAt";e[r]=wn(n.indexEndValue_),n.endNameSet_&&(e[r]+=","+wn(n.indexEndName_))}return n.limitSet_&&(n.isViewFromLeft()?e.limitToFirst=n.limit_:e.limitToLast=n.limit_),e}function uS(n){const e={};if(n.startSet_&&(e.sp=n.indexStartValue_,n.startNameSet_&&(e.sn=n.indexStartName_),e.sin=!n.startAfterSet_),n.endSet_&&(e.ep=n.indexEndValue_,n.endNameSet_&&(e.en=n.indexEndName_),e.ein=!n.endBeforeSet_),n.limitSet_){e.l=n.limit_;let t=n.viewFrom_;t===""&&(n.isViewFromLeft()?t="l":t="r"),e.vf=t}return n.index_!==Lt&&(e.i=n.index_.toString()),e}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Mg extends FC{reportStats(e){throw new Error("Method not implemented.")}static getListenId_(e,t){return t!==void 0?"tag$"+t:(Z(e._queryParams.isDefault(),"should have a tag if it's not a default query."),e._path.toString())}constructor(e,t,r,s){super(),this.repoInfo_=e,this.onDataUpdate_=t,this.authTokenProvider_=r,this.appCheckTokenProvider_=s,this.log_=oh("p:rest:"),this.listens_={}}listen(e,t,r,s){const i=e._path.toString();this.log_("Listen called for "+i+" "+e._queryIdentifier);const o=Mg.getListenId_(e,r),a={};this.listens_[o]=a;const l=cS(e._queryParams);this.restRequest_(i+".json",l,(u,h)=>{let f=h;if(u===404&&(f=null,u=null),u===null&&this.onDataUpdate_(i,f,!1,r),Ta(this.listens_,o)===a){let g;u?u===401?g="permission_denied":g="rest_error:"+u:g="ok",s(g,null)}})}unlisten(e,t){const r=Mg.getListenId_(e,t);delete this.listens_[r]}get(e){const t=cS(e._queryParams),r=e._path.toString(),s=new Pr;return this.restRequest_(r+".json",t,(i,o)=>{let a=o;i===404&&(a=null,i=null),i===null?(this.onDataUpdate_(r,a,!1,null),s.resolve(a)):s.reject(new Error(a))}),s.promise}refreshAuthToken(e){}restRequest_(e,t={},r){return t.format="export",Promise.all([this.authTokenProvider_.getToken(!1),this.appCheckTokenProvider_.getToken(!1)]).then(([s,i])=>{s&&s.accessToken&&(t.auth=s.accessToken),i&&i.token&&(t.ac=i.token);const o=(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host+e+"?ns="+this.repoInfo_.namespace+Wa(t);this.log_("Sending REST request for "+o);const a=new XMLHttpRequest;a.onreadystatechange=()=>{if(r&&a.readyState===4){this.log_("REST Response for "+o+" received. status:",a.status,"response:",a.responseText);let l=null;if(a.status>=200&&a.status<300){try{l=Id(a.responseText)}catch{er("Failed to parse JSON response for "+o+": "+a.responseText)}r(null,l)}else a.status!==401&&a.status!==404&&er("Got unsuccessful REST response for "+o+" Status: "+a.status),r(a.status);r=null}},a.open("GET",o,!0),a.send()})}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class RF{constructor(){this.rootNode_=Ne.EMPTY_NODE}getNode(e){return this.rootNode_.getChild(e)}updateSnapshot(e,t){this.rootNode_=this.rootNode_.updateChild(e,t)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Lg(){return{value:null,children:new Map}}function Dc(n,e,t){if(Ge(e))n.value=t,n.children.clear();else if(n.value!==null)n.value=n.value.updateChild(e,t);else{const r=We(e);n.children.has(r)||n.children.set(r,Lg());const s=n.children.get(r);e=Nt(e),Dc(s,e,t)}}function K_(n,e){if(Ge(e))return n.value=null,n.children.clear(),!0;if(n.value!==null){if(n.value.isLeafNode())return!1;{const t=n.value;return n.value=null,t.forEachChild(Lt,(r,s)=>{Dc(n,new xt(r),s)}),K_(n,e)}}else if(n.children.size>0){const t=We(e);return e=Nt(e),n.children.has(t)&&K_(n.children.get(t),e)&&n.children.delete(t),n.children.size===0}else return!0}function Q_(n,e,t){n.value!==null?t(e,n.value):NF(n,(r,s)=>{const i=new xt(e.toString()+"/"+r);Q_(s,i,t)})}function NF(n,e){n.children.forEach((t,r)=>{e(r,t)})}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class kF{constructor(e){this.collection_=e,this.last_=null}get(){const e=this.collection_.get(),t={...e};return this.last_&&Mn(this.last_,(r,s)=>{t[r]=t[r]-s}),this.last_=e,t}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const dS=10*1e3,PF=30*1e3,DF=5*60*1e3;class MF{constructor(e,t){this.server_=t,this.statsToReport_={},this.statsListener_=new kF(e);const r=dS+(PF-dS)*Math.random();$u(this.reportStats_.bind(this),Math.floor(r))}reportStats_(){const e=this.statsListener_.get(),t={};let r=!1;Mn(e,(s,i)=>{i>0&&Is(this.statsToReport_,s)&&(t[s]=i,r=!0)}),r&&this.server_.reportStats(t),$u(this.reportStats_.bind(this),Math.floor(Math.random()*2*DF))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var fs;(function(n){n[n.OVERWRITE=0]="OVERWRITE",n[n.MERGE=1]="MERGE",n[n.ACK_USER_WRITE=2]="ACK_USER_WRITE",n[n.LISTEN_COMPLETE=3]="LISTEN_COMPLETE"})(fs||(fs={}));function Q0(){return{fromUser:!0,fromServer:!1,queryId:null,tagged:!1}}function Y0(){return{fromUser:!1,fromServer:!0,queryId:null,tagged:!1}}function J0(n){return{fromUser:!1,fromServer:!0,queryId:n,tagged:!0}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Og{constructor(e,t,r){this.path=e,this.affectedTree=t,this.revert=r,this.type=fs.ACK_USER_WRITE,this.source=Q0()}operationForChild(e){if(Ge(this.path)){if(this.affectedTree.value!=null)return Z(this.affectedTree.children.isEmpty(),"affectedTree should not have overlapping affected paths."),this;{const t=this.affectedTree.subtree(new xt(e));return new Og(pt(),t,this.revert)}}else return Z(We(this.path)===e,"operationForChild called for unrelated child."),new Og(Nt(this.path),this.affectedTree,this.revert)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Rd{constructor(e,t){this.source=e,this.path=t,this.type=fs.LISTEN_COMPLETE}operationForChild(e){return Ge(this.path)?new Rd(this.source,pt()):new Rd(this.source,Nt(this.path))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Aa{constructor(e,t,r){this.source=e,this.path=t,this.snap=r,this.type=fs.OVERWRITE}operationForChild(e){return Ge(this.path)?new Aa(this.source,pt(),this.snap.getImmediateChild(e)):new Aa(this.source,Nt(this.path),this.snap)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class sc{constructor(e,t,r){this.source=e,this.path=t,this.children=r,this.type=fs.MERGE}operationForChild(e){if(Ge(this.path)){const t=this.children.subtree(new xt(e));return t.isEmpty()?null:t.value?new Aa(this.source,pt(),t.value):new sc(this.source,pt(),t)}else return Z(We(this.path)===e,"Can't get a merge for a child not on the path of the operation"),new sc(this.source,Nt(this.path),this.children)}toString(){return"Operation("+this.path+": "+this.source.toString()+" merge: "+this.children.toString()+")"}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class To{constructor(e,t,r){this.node_=e,this.fullyInitialized_=t,this.filtered_=r}isFullyInitialized(){return this.fullyInitialized_}isFiltered(){return this.filtered_}isCompleteForPath(e){if(Ge(e))return this.isFullyInitialized()&&!this.filtered_;const t=We(e);return this.isCompleteForChild(t)}isCompleteForChild(e){return this.isFullyInitialized()&&!this.filtered_||this.node_.hasChild(e)}getNode(){return this.node_}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class LF{constructor(e){this.query_=e,this.index_=this.query_._queryParams.getIndex()}}function OF(n,e,t,r){const s=[],i=[];return e.forEach(o=>{o.type==="child_changed"&&n.index_.indexedValueChanged(o.oldSnap,o.snapshotNode)&&i.push(IF(o.childName,o.snapshotNode))}),hu(n,s,"child_removed",e,r,t),hu(n,s,"child_added",e,r,t),hu(n,s,"child_moved",i,r,t),hu(n,s,"child_changed",e,r,t),hu(n,s,"value",e,r,t),s}function hu(n,e,t,r,s,i){const o=r.filter(a=>a.type===t);o.sort((a,l)=>FF(n,a,l)),o.forEach(a=>{const l=VF(n,a,i);s.forEach(u=>{u.respondsTo(a.type)&&e.push(u.createEvent(l,n.query_))})})}function VF(n,e,t){return e.type==="value"||e.type==="child_removed"||(e.prevName=t.getPredecessorChildName(e.childName,e.snapshotNode,n.index_)),e}function FF(n,e,t){if(e.childName==null||t.childName==null)throw kc("Should only compare child_ events.");const r=new Ye(e.childName,e.snapshotNode),s=new Ye(t.childName,t.snapshotNode);return n.index_.compare(r,s)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Lp(n,e){return{eventCache:n,serverCache:e}}function Bu(n,e,t,r){return Lp(new To(e,t,r),n.serverCache)}function KC(n,e,t,r){return Lp(n.eventCache,new To(e,t,r))}function Vg(n){return n.eventCache.isFullyInitialized()?n.eventCache.getNode():null}function Ca(n){return n.serverCache.isFullyInitialized()?n.serverCache.getNode():null}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Iy;const jF=()=>(Iy||(Iy=new Ms(xV)),Iy);class Dt{static fromObject(e){let t=new Dt(null);return Mn(e,(r,s)=>{t=t.set(new xt(r),s)}),t}constructor(e,t=jF()){this.value=e,this.children=t}isEmpty(){return this.value===null&&this.children.isEmpty()}findRootMostMatchingPathAndValue(e,t){if(this.value!=null&&t(this.value))return{path:pt(),value:this.value};if(Ge(e))return null;{const r=We(e),s=this.children.get(r);if(s!==null){const i=s.findRootMostMatchingPathAndValue(Nt(e),t);return i!=null?{path:Qt(new xt(r),i.path),value:i.value}:null}else return null}}findRootMostValueAndPath(e){return this.findRootMostMatchingPathAndValue(e,()=>!0)}subtree(e){if(Ge(e))return this;{const t=We(e),r=this.children.get(t);return r!==null?r.subtree(Nt(e)):new Dt(null)}}set(e,t){if(Ge(e))return new Dt(t,this.children);{const r=We(e),i=(this.children.get(r)||new Dt(null)).set(Nt(e),t),o=this.children.insert(r,i);return new Dt(this.value,o)}}remove(e){if(Ge(e))return this.children.isEmpty()?new Dt(null):new Dt(null,this.children);{const t=We(e),r=this.children.get(t);if(r){const s=r.remove(Nt(e));let i;return s.isEmpty()?i=this.children.remove(t):i=this.children.insert(t,s),this.value===null&&i.isEmpty()?new Dt(null):new Dt(this.value,i)}else return this}}get(e){if(Ge(e))return this.value;{const t=We(e),r=this.children.get(t);return r?r.get(Nt(e)):null}}setTree(e,t){if(Ge(e))return t;{const r=We(e),i=(this.children.get(r)||new Dt(null)).setTree(Nt(e),t);let o;return i.isEmpty()?o=this.children.remove(r):o=this.children.insert(r,i),new Dt(this.value,o)}}fold(e){return this.fold_(pt(),e)}fold_(e,t){const r={};return this.children.inorderTraversal((s,i)=>{r[s]=i.fold_(Qt(e,s),t)}),t(e,this.value,r)}findOnPath(e,t){return this.findOnPath_(e,pt(),t)}findOnPath_(e,t,r){const s=this.value?r(t,this.value):!1;if(s)return s;if(Ge(e))return null;{const i=We(e),o=this.children.get(i);return o?o.findOnPath_(Nt(e),Qt(t,i),r):null}}foreachOnPath(e,t){return this.foreachOnPath_(e,pt(),t)}foreachOnPath_(e,t,r){if(Ge(e))return this;{this.value&&r(t,this.value);const s=We(e),i=this.children.get(s);return i?i.foreachOnPath_(Nt(e),Qt(t,s),r):new Dt(null)}}foreach(e){this.foreach_(pt(),e)}foreach_(e,t){this.children.inorderTraversal((r,s)=>{s.foreach_(Qt(e,r),t)}),this.value&&t(e,this.value)}foreachChild(e){this.children.inorderTraversal((t,r)=>{r.value&&e(t,r.value)})}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ys{constructor(e){this.writeTree_=e}static empty(){return new ys(new Dt(null))}}function zu(n,e,t){if(Ge(e))return new ys(new Dt(t));{const r=n.writeTree_.findRootMostValueAndPath(e);if(r!=null){const s=r.path;let i=r.value;const o=or(s,e);return i=i.updateChild(o,t),new ys(n.writeTree_.set(s,i))}else{const s=new Dt(t),i=n.writeTree_.setTree(e,s);return new ys(i)}}}function Y_(n,e,t){let r=n;return Mn(t,(s,i)=>{r=zu(r,Qt(e,s),i)}),r}function hS(n,e){if(Ge(e))return ys.empty();{const t=n.writeTree_.setTree(e,new Dt(null));return new ys(t)}}function J_(n,e){return Ka(n,e)!=null}function Ka(n,e){const t=n.writeTree_.findRootMostValueAndPath(e);return t!=null?n.writeTree_.get(t.path).getChild(or(t.path,e)):null}function fS(n){const e=[],t=n.writeTree_.value;return t!=null?t.isLeafNode()||t.forEachChild(Lt,(r,s)=>{e.push(new Ye(r,s))}):n.writeTree_.children.inorderTraversal((r,s)=>{s.value!=null&&e.push(new Ye(r,s.value))}),e}function mo(n,e){if(Ge(e))return n;{const t=Ka(n,e);return t!=null?new ys(new Dt(t)):new ys(n.writeTree_.subtree(e))}}function X_(n){return n.writeTree_.isEmpty()}function ic(n,e){return QC(pt(),n.writeTree_,e)}function QC(n,e,t){if(e.value!=null)return t.updateChild(n,e.value);{let r=null;return e.children.inorderTraversal((s,i)=>{s===".priority"?(Z(i.value!==null,"Priority writes must always be leaf nodes"),r=i.value):t=QC(Qt(n,s),i,t)}),!t.getChild(n).isEmpty()&&r!==null&&(t=t.updateChild(Qt(n,".priority"),r)),t}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Op(n,e){return ZC(e,n)}function UF(n,e,t,r,s){Z(r>n.lastWriteId,"Stacking an older write on top of newer ones"),s===void 0&&(s=!0),n.allWrites.push({path:e,snap:t,writeId:r,visible:s}),s&&(n.visibleWrites=zu(n.visibleWrites,e,t)),n.lastWriteId=r}function $F(n,e,t,r){Z(r>n.lastWriteId,"Stacking an older merge on top of newer ones"),n.allWrites.push({path:e,children:t,writeId:r,visible:!0}),n.visibleWrites=Y_(n.visibleWrites,e,t),n.lastWriteId=r}function BF(n,e){for(let t=0;t<n.allWrites.length;t++){const r=n.allWrites[t];if(r.writeId===e)return r}return null}function zF(n,e){const t=n.allWrites.findIndex(a=>a.writeId===e);Z(t>=0,"removeWrite called with nonexistent writeId.");const r=n.allWrites[t];n.allWrites.splice(t,1);let s=r.visible,i=!1,o=n.allWrites.length-1;for(;s&&o>=0;){const a=n.allWrites[o];a.visible&&(o>=t&&qF(a,r.path)?s=!1:Xr(r.path,a.path)&&(i=!0)),o--}if(s){if(i)return WF(n),!0;if(r.snap)n.visibleWrites=hS(n.visibleWrites,r.path);else{const a=r.children;Mn(a,l=>{n.visibleWrites=hS(n.visibleWrites,Qt(r.path,l))})}return!0}else return!1}function qF(n,e){if(n.snap)return Xr(n.path,e);for(const t in n.children)if(n.children.hasOwnProperty(t)&&Xr(Qt(n.path,t),e))return!0;return!1}function WF(n){n.visibleWrites=YC(n.allWrites,GF,pt()),n.allWrites.length>0?n.lastWriteId=n.allWrites[n.allWrites.length-1].writeId:n.lastWriteId=-1}function GF(n){return n.visible}function YC(n,e,t){let r=ys.empty();for(let s=0;s<n.length;++s){const i=n[s];if(e(i)){const o=i.path;let a;if(i.snap)Xr(t,o)?(a=or(t,o),r=zu(r,a,i.snap)):Xr(o,t)&&(a=or(o,t),r=zu(r,pt(),i.snap.getChild(a)));else if(i.children){if(Xr(t,o))a=or(t,o),r=Y_(r,a,i.children);else if(Xr(o,t))if(a=or(o,t),Ge(a))r=Y_(r,pt(),i.children);else{const l=Ta(i.children,We(a));if(l){const u=l.getChild(Nt(a));r=zu(r,pt(),u)}}}else throw kc("WriteRecord should have .snap or .children")}}return r}function JC(n,e,t,r,s){if(!r&&!s){const i=Ka(n.visibleWrites,e);if(i!=null)return i;{const o=mo(n.visibleWrites,e);if(X_(o))return t;if(t==null&&!J_(o,pt()))return null;{const a=t||Ne.EMPTY_NODE;return ic(o,a)}}}else{const i=mo(n.visibleWrites,e);if(!s&&X_(i))return t;if(!s&&t==null&&!J_(i,pt()))return null;{const o=function(u){return(u.visible||s)&&(!r||!~r.indexOf(u.writeId))&&(Xr(u.path,e)||Xr(e,u.path))},a=YC(n.allWrites,o,e),l=t||Ne.EMPTY_NODE;return ic(a,l)}}}function HF(n,e,t){let r=Ne.EMPTY_NODE;const s=Ka(n.visibleWrites,e);if(s)return s.isLeafNode()||s.forEachChild(Lt,(i,o)=>{r=r.updateImmediateChild(i,o)}),r;if(t){const i=mo(n.visibleWrites,e);return t.forEachChild(Lt,(o,a)=>{const l=ic(mo(i,new xt(o)),a);r=r.updateImmediateChild(o,l)}),fS(i).forEach(o=>{r=r.updateImmediateChild(o.name,o.node)}),r}else{const i=mo(n.visibleWrites,e);return fS(i).forEach(o=>{r=r.updateImmediateChild(o.name,o.node)}),r}}function KF(n,e,t,r,s){Z(r||s,"Either existingEventSnap or existingServerSnap must exist");const i=Qt(e,t);if(J_(n.visibleWrites,i))return null;{const o=mo(n.visibleWrites,i);return X_(o)?s.getChild(t):ic(o,s.getChild(t))}}function QF(n,e,t,r){const s=Qt(e,t),i=Ka(n.visibleWrites,s);if(i!=null)return i;if(r.isCompleteForChild(t)){const o=mo(n.visibleWrites,s);return ic(o,r.getNode().getImmediateChild(t))}else return null}function YF(n,e){return Ka(n.visibleWrites,e)}function JF(n,e,t,r,s,i,o){let a;const l=mo(n.visibleWrites,e),u=Ka(l,pt());if(u!=null)a=u;else if(t!=null)a=ic(l,t);else return[];if(a=a.withIndex(o),!a.isEmpty()&&!a.isLeafNode()){const h=[],f=o.getCompare(),g=i?a.getReverseIteratorFrom(r,o):a.getIteratorFrom(r,o);let y=g.getNext();for(;y&&h.length<s;)f(y,r)!==0&&h.push(y),y=g.getNext();return h}else return[]}function XF(){return{visibleWrites:ys.empty(),allWrites:[],lastWriteId:-1}}function Fg(n,e,t,r){return JC(n.writeTree,n.treePath,e,t,r)}function X0(n,e){return HF(n.writeTree,n.treePath,e)}function gS(n,e,t,r){return KF(n.writeTree,n.treePath,e,t,r)}function jg(n,e){return YF(n.writeTree,Qt(n.treePath,e))}function ZF(n,e,t,r,s,i){return JF(n.writeTree,n.treePath,e,t,r,s,i)}function Z0(n,e,t){return QF(n.writeTree,n.treePath,e,t)}function XC(n,e){return ZC(Qt(n.treePath,e),n.writeTree)}function ZC(n,e){return{treePath:n,writeTree:e}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ej{constructor(){this.changeMap=new Map}trackChildChange(e){const t=e.type,r=e.childName;Z(t==="child_added"||t==="child_changed"||t==="child_removed","Only child changes supported for tracking"),Z(r!==".priority","Only non-priority child changes can be tracked.");const s=this.changeMap.get(r);if(s){const i=s.type;if(t==="child_added"&&i==="child_removed")this.changeMap.set(r,Ad(r,e.snapshotNode,s.snapshotNode));else if(t==="child_removed"&&i==="child_added")this.changeMap.delete(r);else if(t==="child_removed"&&i==="child_changed")this.changeMap.set(r,bd(r,s.oldSnap));else if(t==="child_changed"&&i==="child_added")this.changeMap.set(r,rc(r,e.snapshotNode));else if(t==="child_changed"&&i==="child_changed")this.changeMap.set(r,Ad(r,e.snapshotNode,s.oldSnap));else throw kc("Illegal combination of changes: "+e+" occurred after "+s)}else this.changeMap.set(r,e)}getChanges(){return Array.from(this.changeMap.values())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class tj{getCompleteChild(e){return null}getChildAfterChild(e,t,r){return null}}const eR=new tj;class ew{constructor(e,t,r=null){this.writes_=e,this.viewCache_=t,this.optCompleteServerCache_=r}getCompleteChild(e){const t=this.viewCache_.eventCache;if(t.isCompleteForChild(e))return t.getNode().getImmediateChild(e);{const r=this.optCompleteServerCache_!=null?new To(this.optCompleteServerCache_,!0,!1):this.viewCache_.serverCache;return Z0(this.writes_,e,r)}}getChildAfterChild(e,t,r){const s=this.optCompleteServerCache_!=null?this.optCompleteServerCache_:Ca(this.viewCache_),i=ZF(this.writes_,s,t,1,r,e);return i.length===0?null:i[0]}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function nj(n){return{filter:n}}function rj(n,e){Z(e.eventCache.getNode().isIndexed(n.filter.getIndex()),"Event snap not indexed"),Z(e.serverCache.getNode().isIndexed(n.filter.getIndex()),"Server snap not indexed")}function sj(n,e,t,r,s){const i=new ej;let o,a;if(t.type===fs.OVERWRITE){const u=t;u.source.fromUser?o=Z_(n,e,u.path,u.snap,r,s,i):(Z(u.source.fromServer,"Unknown source."),a=u.source.tagged||e.serverCache.isFiltered()&&!Ge(u.path),o=Ug(n,e,u.path,u.snap,r,s,a,i))}else if(t.type===fs.MERGE){const u=t;u.source.fromUser?o=oj(n,e,u.path,u.children,r,s,i):(Z(u.source.fromServer,"Unknown source."),a=u.source.tagged||e.serverCache.isFiltered(),o=ev(n,e,u.path,u.children,r,s,a,i))}else if(t.type===fs.ACK_USER_WRITE){const u=t;u.revert?o=cj(n,e,u.path,r,s,i):o=aj(n,e,u.path,u.affectedTree,r,s,i)}else if(t.type===fs.LISTEN_COMPLETE)o=lj(n,e,t.path,r,i);else throw kc("Unknown operation type: "+t.type);const l=i.getChanges();return ij(e,o,l),{viewCache:o,changes:l}}function ij(n,e,t){const r=e.eventCache;if(r.isFullyInitialized()){const s=r.getNode().isLeafNode()||r.getNode().isEmpty(),i=Vg(n);(t.length>0||!n.eventCache.isFullyInitialized()||s&&!r.getNode().equals(i)||!r.getNode().getPriority().equals(i.getPriority()))&&t.push(HC(Vg(e)))}}function tR(n,e,t,r,s,i){const o=e.eventCache;if(jg(r,t)!=null)return e;{let a,l;if(Ge(t))if(Z(e.serverCache.isFullyInitialized(),"If change path is empty, we must have complete server data"),e.serverCache.isFiltered()){const u=Ca(e),h=u instanceof Ne?u:Ne.EMPTY_NODE,f=X0(r,h);a=n.filter.updateFullNode(e.eventCache.getNode(),f,i)}else{const u=Fg(r,Ca(e));a=n.filter.updateFullNode(e.eventCache.getNode(),u,i)}else{const u=We(t);if(u===".priority"){Z(So(t)===1,"Can't have a priority with additional path components");const h=o.getNode();l=e.serverCache.getNode();const f=gS(r,t,h,l);f!=null?a=n.filter.updatePriority(h,f):a=o.getNode()}else{const h=Nt(t);let f;if(o.isCompleteForChild(u)){l=e.serverCache.getNode();const g=gS(r,t,o.getNode(),l);g!=null?f=o.getNode().getImmediateChild(u).updateChild(h,g):f=o.getNode().getImmediateChild(u)}else f=Z0(r,u,e.serverCache);f!=null?a=n.filter.updateChild(o.getNode(),u,f,h,s,i):a=o.getNode()}}return Bu(e,a,o.isFullyInitialized()||Ge(t),n.filter.filtersNodes())}}function Ug(n,e,t,r,s,i,o,a){const l=e.serverCache;let u;const h=o?n.filter:n.filter.getIndexedFilter();if(Ge(t))u=h.updateFullNode(l.getNode(),r,null);else if(h.filtersNodes()&&!l.isFiltered()){const y=l.getNode().updateChild(t,r);u=h.updateFullNode(l.getNode(),y,null)}else{const y=We(t);if(!l.isCompleteForPath(t)&&So(t)>1)return e;const w=Nt(t),M=l.getNode().getImmediateChild(y).updateChild(w,r);y===".priority"?u=h.updatePriority(l.getNode(),M):u=h.updateChild(l.getNode(),y,M,w,eR,null)}const f=KC(e,u,l.isFullyInitialized()||Ge(t),h.filtersNodes()),g=new ew(s,f,i);return tR(n,f,t,s,g,a)}function Z_(n,e,t,r,s,i,o){const a=e.eventCache;let l,u;const h=new ew(s,e,i);if(Ge(t))u=n.filter.updateFullNode(e.eventCache.getNode(),r,o),l=Bu(e,u,!0,n.filter.filtersNodes());else{const f=We(t);if(f===".priority")u=n.filter.updatePriority(e.eventCache.getNode(),r),l=Bu(e,u,a.isFullyInitialized(),a.isFiltered());else{const g=Nt(t),y=a.getNode().getImmediateChild(f);let w;if(Ge(g))w=r;else{const C=h.getCompleteChild(f);C!=null?$0(g)===".priority"&&C.getChild(UC(g)).isEmpty()?w=C:w=C.updateChild(g,r):w=Ne.EMPTY_NODE}if(y.equals(w))l=e;else{const C=n.filter.updateChild(a.getNode(),f,w,g,h,o);l=Bu(e,C,a.isFullyInitialized(),n.filter.filtersNodes())}}}return l}function pS(n,e){return n.eventCache.isCompleteForChild(e)}function oj(n,e,t,r,s,i,o){let a=e;return r.foreach((l,u)=>{const h=Qt(t,l);pS(e,We(h))&&(a=Z_(n,a,h,u,s,i,o))}),r.foreach((l,u)=>{const h=Qt(t,l);pS(e,We(h))||(a=Z_(n,a,h,u,s,i,o))}),a}function mS(n,e,t){return t.foreach((r,s)=>{e=e.updateChild(r,s)}),e}function ev(n,e,t,r,s,i,o,a){if(e.serverCache.getNode().isEmpty()&&!e.serverCache.isFullyInitialized())return e;let l=e,u;Ge(t)?u=r:u=new Dt(null).setTree(t,r);const h=e.serverCache.getNode();return u.children.inorderTraversal((f,g)=>{if(h.hasChild(f)){const y=e.serverCache.getNode().getImmediateChild(f),w=mS(n,y,g);l=Ug(n,l,new xt(f),w,s,i,o,a)}}),u.children.inorderTraversal((f,g)=>{const y=!e.serverCache.isCompleteForChild(f)&&g.value===null;if(!h.hasChild(f)&&!y){const w=e.serverCache.getNode().getImmediateChild(f),C=mS(n,w,g);l=Ug(n,l,new xt(f),C,s,i,o,a)}}),l}function aj(n,e,t,r,s,i,o){if(jg(s,t)!=null)return e;const a=e.serverCache.isFiltered(),l=e.serverCache;if(r.value!=null){if(Ge(t)&&l.isFullyInitialized()||l.isCompleteForPath(t))return Ug(n,e,t,l.getNode().getChild(t),s,i,a,o);if(Ge(t)){let u=new Dt(null);return l.getNode().forEachChild($s,(h,f)=>{u=u.set(new xt(h),f)}),ev(n,e,t,u,s,i,a,o)}else return e}else{let u=new Dt(null);return r.foreach((h,f)=>{const g=Qt(t,h);l.isCompleteForPath(g)&&(u=u.set(h,l.getNode().getChild(g)))}),ev(n,e,t,u,s,i,a,o)}}function lj(n,e,t,r,s){const i=e.serverCache,o=KC(e,i.getNode(),i.isFullyInitialized()||Ge(t),i.isFiltered());return tR(n,o,t,r,eR,s)}function cj(n,e,t,r,s,i){let o;if(jg(r,t)!=null)return e;{const a=new ew(r,e,s),l=e.eventCache.getNode();let u;if(Ge(t)||We(t)===".priority"){let h;if(e.serverCache.isFullyInitialized())h=Fg(r,Ca(e));else{const f=e.serverCache.getNode();Z(f instanceof Ne,"serverChildren would be complete if leaf node"),h=X0(r,f)}h=h,u=n.filter.updateFullNode(l,h,i)}else{const h=We(t);let f=Z0(r,h,e.serverCache);f==null&&e.serverCache.isCompleteForChild(h)&&(f=l.getImmediateChild(h)),f!=null?u=n.filter.updateChild(l,h,f,Nt(t),a,i):e.eventCache.getNode().hasChild(h)?u=n.filter.updateChild(l,h,Ne.EMPTY_NODE,Nt(t),a,i):u=l,u.isEmpty()&&e.serverCache.isFullyInitialized()&&(o=Fg(r,Ca(e)),o.isLeafNode()&&(u=n.filter.updateFullNode(u,o,i)))}return o=e.serverCache.isFullyInitialized()||jg(r,pt())!=null,Bu(e,u,o,n.filter.filtersNodes())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class uj{constructor(e,t){this.query_=e,this.eventRegistrations_=[];const r=this.query_._queryParams,s=new H0(r.getIndex()),i=SF(r);this.processor_=nj(i);const o=t.serverCache,a=t.eventCache,l=s.updateFullNode(Ne.EMPTY_NODE,o.getNode(),null),u=i.updateFullNode(Ne.EMPTY_NODE,a.getNode(),null),h=new To(l,o.isFullyInitialized(),s.filtersNodes()),f=new To(u,a.isFullyInitialized(),i.filtersNodes());this.viewCache_=Lp(f,h),this.eventGenerator_=new LF(this.query_)}get query(){return this.query_}}function dj(n){return n.viewCache_.serverCache.getNode()}function hj(n){return Vg(n.viewCache_)}function fj(n,e){const t=Ca(n.viewCache_);return t&&(n.query._queryParams.loadsAllData()||!Ge(e)&&!t.getImmediateChild(We(e)).isEmpty())?t.getChild(e):null}function yS(n){return n.eventRegistrations_.length===0}function gj(n,e){n.eventRegistrations_.push(e)}function _S(n,e,t){const r=[];if(t){Z(e==null,"A cancel should cancel all event registrations.");const s=n.query._path;n.eventRegistrations_.forEach(i=>{const o=i.createCancelEvent(t,s);o&&r.push(o)})}if(e){let s=[];for(let i=0;i<n.eventRegistrations_.length;++i){const o=n.eventRegistrations_[i];if(!o.matches(e))s.push(o);else if(e.hasAnyCallback()){s=s.concat(n.eventRegistrations_.slice(i+1));break}}n.eventRegistrations_=s}else n.eventRegistrations_=[];return r}function vS(n,e,t,r){e.type===fs.MERGE&&e.source.queryId!==null&&(Z(Ca(n.viewCache_),"We should always have a full cache before handling merges"),Z(Vg(n.viewCache_),"Missing event cache, even though we have a server cache"));const s=n.viewCache_,i=sj(n.processor_,s,e,t,r);return rj(n.processor_,i.viewCache),Z(i.viewCache.serverCache.isFullyInitialized()||!s.serverCache.isFullyInitialized(),"Once a server snap is complete, it should never go back"),n.viewCache_=i.viewCache,nR(n,i.changes,i.viewCache.eventCache.getNode(),null)}function pj(n,e){const t=n.viewCache_.eventCache,r=[];return t.getNode().isLeafNode()||t.getNode().forEachChild(Lt,(i,o)=>{r.push(rc(i,o))}),t.isFullyInitialized()&&r.push(HC(t.getNode())),nR(n,r,t.getNode(),e)}function nR(n,e,t,r){const s=r?[r]:n.eventRegistrations_;return OF(n.eventGenerator_,e,t,s)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let $g;class rR{constructor(){this.views=new Map}}function mj(n){Z(!$g,"__referenceConstructor has already been defined"),$g=n}function yj(){return Z($g,"Reference.ts has not been loaded"),$g}function _j(n){return n.views.size===0}function tw(n,e,t,r){const s=e.source.queryId;if(s!==null){const i=n.views.get(s);return Z(i!=null,"SyncTree gave us an op for an invalid query."),vS(i,e,t,r)}else{let i=[];for(const o of n.views.values())i=i.concat(vS(o,e,t,r));return i}}function sR(n,e,t,r,s){const i=e._queryIdentifier,o=n.views.get(i);if(!o){let a=Fg(t,s?r:null),l=!1;a?l=!0:r instanceof Ne?(a=X0(t,r),l=!1):(a=Ne.EMPTY_NODE,l=!1);const u=Lp(new To(a,l,!1),new To(r,s,!1));return new uj(e,u)}return o}function vj(n,e,t,r,s,i){const o=sR(n,e,r,s,i);return n.views.has(e._queryIdentifier)||n.views.set(e._queryIdentifier,o),gj(o,t),pj(o,t)}function wj(n,e,t,r){const s=e._queryIdentifier,i=[];let o=[];const a=bo(n);if(s==="default")for(const[l,u]of n.views.entries())o=o.concat(_S(u,t,r)),yS(u)&&(n.views.delete(l),u.query._queryParams.loadsAllData()||i.push(u.query));else{const l=n.views.get(s);l&&(o=o.concat(_S(l,t,r)),yS(l)&&(n.views.delete(s),l.query._queryParams.loadsAllData()||i.push(l.query)))}return a&&!bo(n)&&i.push(new(yj())(e._repo,e._path)),{removed:i,events:o}}function iR(n){const e=[];for(const t of n.views.values())t.query._queryParams.loadsAllData()||e.push(t);return e}function yo(n,e){let t=null;for(const r of n.views.values())t=t||fj(r,e);return t}function oR(n,e){if(e._queryParams.loadsAllData())return Vp(n);{const r=e._queryIdentifier;return n.views.get(r)}}function aR(n,e){return oR(n,e)!=null}function bo(n){return Vp(n)!=null}function Vp(n){for(const e of n.views.values())if(e.query._queryParams.loadsAllData())return e;return null}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Bg;function xj(n){Z(!Bg,"__referenceConstructor has already been defined"),Bg=n}function Ij(){return Z(Bg,"Reference.ts has not been loaded"),Bg}let Ej=1;class wS{constructor(e){this.listenProvider_=e,this.syncPointTree_=new Dt(null),this.pendingWriteTree_=XF(),this.tagToQueryMap=new Map,this.queryToTagMap=new Map}}function nw(n,e,t,r,s){return UF(n.pendingWriteTree_,e,t,r,s),s?Mc(n,new Aa(Q0(),e,t)):[]}function Sj(n,e,t,r){$F(n.pendingWriteTree_,e,t,r);const s=Dt.fromObject(t);return Mc(n,new sc(Q0(),e,s))}function eo(n,e,t=!1){const r=BF(n.pendingWriteTree_,e);if(zF(n.pendingWriteTree_,e)){let i=new Dt(null);return r.snap!=null?i=i.set(pt(),!0):Mn(r.children,o=>{i=i.set(new xt(o),!0)}),Mc(n,new Og(r.path,i,t))}else return[]}function lh(n,e,t){return Mc(n,new Aa(Y0(),e,t))}function Tj(n,e,t){const r=Dt.fromObject(t);return Mc(n,new sc(Y0(),e,r))}function bj(n,e){return Mc(n,new Rd(Y0(),e))}function Aj(n,e,t){const r=rw(n,t);if(r){const s=sw(r),i=s.path,o=s.queryId,a=or(i,e),l=new Rd(J0(o),a);return iw(n,i,l)}else return[]}function zg(n,e,t,r,s=!1){const i=e._path,o=n.syncPointTree_.get(i);let a=[];if(o&&(e._queryIdentifier==="default"||aR(o,e))){const l=wj(o,e,t,r);_j(o)&&(n.syncPointTree_=n.syncPointTree_.remove(i));const u=l.removed;if(a=l.events,!s){const h=u.findIndex(g=>g._queryParams.loadsAllData())!==-1,f=n.syncPointTree_.findOnPath(i,(g,y)=>bo(y));if(h&&!f){const g=n.syncPointTree_.subtree(i);if(!g.isEmpty()){const y=Nj(g);for(let w=0;w<y.length;++w){const C=y[w],M=C.query,A=dR(n,C);n.listenProvider_.startListening(qu(M),Nd(n,M),A.hashFn,A.onComplete)}}}!f&&u.length>0&&!r&&(h?n.listenProvider_.stopListening(qu(e),null):u.forEach(g=>{const y=n.queryToTagMap.get(jp(g));n.listenProvider_.stopListening(qu(g),y)}))}kj(n,u)}return a}function lR(n,e,t,r){const s=rw(n,r);if(s!=null){const i=sw(s),o=i.path,a=i.queryId,l=or(o,e),u=new Aa(J0(a),l,t);return iw(n,o,u)}else return[]}function Cj(n,e,t,r){const s=rw(n,r);if(s){const i=sw(s),o=i.path,a=i.queryId,l=or(o,e),u=Dt.fromObject(t),h=new sc(J0(a),l,u);return iw(n,o,h)}else return[]}function tv(n,e,t,r=!1){const s=e._path;let i=null,o=!1;n.syncPointTree_.foreachOnPath(s,(g,y)=>{const w=or(g,s);i=i||yo(y,w),o=o||bo(y)});let a=n.syncPointTree_.get(s);a?(o=o||bo(a),i=i||yo(a,pt())):(a=new rR,n.syncPointTree_=n.syncPointTree_.set(s,a));let l;i!=null?l=!0:(l=!1,i=Ne.EMPTY_NODE,n.syncPointTree_.subtree(s).foreachChild((y,w)=>{const C=yo(w,pt());C&&(i=i.updateImmediateChild(y,C))}));const u=aR(a,e);if(!u&&!e._queryParams.loadsAllData()){const g=jp(e);Z(!n.queryToTagMap.has(g),"View does not exist, but we have a tag");const y=Pj();n.queryToTagMap.set(g,y),n.tagToQueryMap.set(y,g)}const h=Op(n.pendingWriteTree_,s);let f=vj(a,e,t,h,i,l);if(!u&&!o&&!r){const g=oR(a,e);f=f.concat(Dj(n,e,g))}return f}function Fp(n,e,t){const s=n.pendingWriteTree_,i=n.syncPointTree_.findOnPath(e,(o,a)=>{const l=or(o,e),u=yo(a,l);if(u)return u});return JC(s,e,i,t,!0)}function Rj(n,e){const t=e._path;let r=null;n.syncPointTree_.foreachOnPath(t,(u,h)=>{const f=or(u,t);r=r||yo(h,f)});let s=n.syncPointTree_.get(t);s?r=r||yo(s,pt()):(s=new rR,n.syncPointTree_=n.syncPointTree_.set(t,s));const i=r!=null,o=i?new To(r,!0,!1):null,a=Op(n.pendingWriteTree_,e._path),l=sR(s,e,a,i?o.getNode():Ne.EMPTY_NODE,i);return hj(l)}function Mc(n,e){return cR(e,n.syncPointTree_,null,Op(n.pendingWriteTree_,pt()))}function cR(n,e,t,r){if(Ge(n.path))return uR(n,e,t,r);{const s=e.get(pt());t==null&&s!=null&&(t=yo(s,pt()));let i=[];const o=We(n.path),a=n.operationForChild(o),l=e.children.get(o);if(l&&a){const u=t?t.getImmediateChild(o):null,h=XC(r,o);i=i.concat(cR(a,l,u,h))}return s&&(i=i.concat(tw(s,n,r,t))),i}}function uR(n,e,t,r){const s=e.get(pt());t==null&&s!=null&&(t=yo(s,pt()));let i=[];return e.children.inorderTraversal((o,a)=>{const l=t?t.getImmediateChild(o):null,u=XC(r,o),h=n.operationForChild(o);h&&(i=i.concat(uR(h,a,l,u)))}),s&&(i=i.concat(tw(s,n,r,t))),i}function dR(n,e){const t=e.query,r=Nd(n,t);return{hashFn:()=>(dj(e)||Ne.EMPTY_NODE).hash(),onComplete:s=>{if(s==="ok")return r?Aj(n,t._path,r):bj(n,t._path);{const i=SV(s,t);return zg(n,t,null,i)}}}}function Nd(n,e){const t=jp(e);return n.queryToTagMap.get(t)}function jp(n){return n._path.toString()+"$"+n._queryIdentifier}function rw(n,e){return n.tagToQueryMap.get(e)}function sw(n){const e=n.indexOf("$");return Z(e!==-1&&e<n.length-1,"Bad queryKey."),{queryId:n.substr(e+1),path:new xt(n.substr(0,e))}}function iw(n,e,t){const r=n.syncPointTree_.get(e);Z(r,"Missing sync point for query tag that we're tracking");const s=Op(n.pendingWriteTree_,e);return tw(r,t,s,null)}function Nj(n){return n.fold((e,t,r)=>{if(t&&bo(t))return[Vp(t)];{let s=[];return t&&(s=iR(t)),Mn(r,(i,o)=>{s=s.concat(o)}),s}})}function qu(n){return n._queryParams.loadsAllData()&&!n._queryParams.isDefault()?new(Ij())(n._repo,n._path):n}function kj(n,e){for(let t=0;t<e.length;++t){const r=e[t];if(!r._queryParams.loadsAllData()){const s=jp(r),i=n.queryToTagMap.get(s);n.queryToTagMap.delete(s),n.tagToQueryMap.delete(i)}}}function Pj(){return Ej++}function Dj(n,e,t){const r=e._path,s=Nd(n,e),i=dR(n,t),o=n.listenProvider_.startListening(qu(e),s,i.hashFn,i.onComplete),a=n.syncPointTree_.subtree(r);if(s)Z(!bo(a.value),"If we're adding a query, it shouldn't be shadowed");else{const l=a.fold((u,h,f)=>{if(!Ge(u)&&h&&bo(h))return[Vp(h).query];{let g=[];return h&&(g=g.concat(iR(h).map(y=>y.query))),Mn(f,(y,w)=>{g=g.concat(w)}),g}});for(let u=0;u<l.length;++u){const h=l[u];n.listenProvider_.stopListening(qu(h),Nd(n,h))}}return o}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ow{constructor(e){this.node_=e}getImmediateChild(e){const t=this.node_.getImmediateChild(e);return new ow(t)}node(){return this.node_}}class aw{constructor(e,t){this.syncTree_=e,this.path_=t}getImmediateChild(e){const t=Qt(this.path_,e);return new aw(this.syncTree_,t)}node(){return Fp(this.syncTree_,this.path_)}}const Mj=function(n){return n=n||{},n.timestamp=n.timestamp||new Date().getTime(),n},xS=function(n,e,t){if(!n||typeof n!="object")return n;if(Z(".sv"in n,"Unexpected leaf node or priority contents"),typeof n[".sv"]=="string")return Lj(n[".sv"],e,t);if(typeof n[".sv"]=="object")return Oj(n[".sv"],e);Z(!1,"Unexpected server value: "+JSON.stringify(n,null,2))},Lj=function(n,e,t){switch(n){case"timestamp":return t.timestamp;default:Z(!1,"Unexpected server value: "+n)}},Oj=function(n,e,t){n.hasOwnProperty("increment")||Z(!1,"Unexpected server value: "+JSON.stringify(n,null,2));const r=n.increment;typeof r!="number"&&Z(!1,"Unexpected increment value: "+r);const s=e.node();if(Z(s!==null&&typeof s<"u","Expected ChildrenNode.EMPTY_NODE for nulls"),!s.isLeafNode())return r;const o=s.getValue();return typeof o!="number"?r:o+r},hR=function(n,e,t,r){return cw(e,new aw(t,n),r)},lw=function(n,e,t){return cw(n,new ow(e),t)};function cw(n,e,t){const r=n.getPriority().val(),s=xS(r,e.getImmediateChild(".priority"),t);let i;if(n.isLeafNode()){const o=n,a=xS(o.getValue(),e,t);return a!==o.getValue()||s!==o.getPriority().val()?new bn(a,Zt(s)):n}else{const o=n;return i=o,s!==o.getPriority().val()&&(i=i.updatePriority(new bn(s))),o.forEachChild(Lt,(a,l)=>{const u=cw(l,e.getImmediateChild(a),t);u!==l&&(i=i.updateImmediateChild(a,u))}),i}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class uw{constructor(e="",t=null,r={children:{},childCount:0}){this.name=e,this.parent=t,this.node=r}}function Up(n,e){let t=e instanceof xt?e:new xt(e),r=n,s=We(t);for(;s!==null;){const i=Ta(r.node.children,s)||{children:{},childCount:0};r=new uw(s,r,i),t=Nt(t),s=We(t)}return r}function Qa(n){return n.node.value}function dw(n,e){n.node.value=e,nv(n)}function fR(n){return n.node.childCount>0}function Vj(n){return Qa(n)===void 0&&!fR(n)}function $p(n,e){Mn(n.node.children,(t,r)=>{e(new uw(t,n,r))})}function gR(n,e,t,r){t&&!r&&e(n),$p(n,s=>{gR(s,e,!0,r)}),t&&r&&e(n)}function Fj(n,e,t){let r=t?n:n.parent;for(;r!==null;){if(e(r))return!0;r=r.parent}return!1}function ch(n){return new xt(n.parent===null?n.name:ch(n.parent)+"/"+n.name)}function nv(n){n.parent!==null&&jj(n.parent,n.name,n)}function jj(n,e,t){const r=Vj(t),s=Is(n.node.children,e);r&&s?(delete n.node.children[e],n.node.childCount--,nv(n)):!r&&!s&&(n.node.children[e]=t.node,n.node.childCount++,nv(n))}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Uj=/[\[\].#$\/\u0000-\u001F\u007F]/,$j=/[\[\].#$\u0000-\u001F\u007F]/,Ey=10*1024*1024,Bp=function(n){return typeof n=="string"&&n.length!==0&&!Uj.test(n)},pR=function(n){return typeof n=="string"&&n.length!==0&&!$j.test(n)},Bj=function(n){return n&&(n=n.replace(/^\/*\.info(\/|$)/,"/")),pR(n)},kd=function(n){return n===null||typeof n=="string"||typeof n=="number"&&!Pp(n)||n&&typeof n=="object"&&Is(n,".sv")},Hs=function(n,e,t,r){r&&e===void 0||uh(ba(n,"value"),e,t)},uh=function(n,e,t){const r=t instanceof xt?new sF(t,n):t;if(e===void 0)throw new Error(n+"contains undefined "+Zo(r));if(typeof e=="function")throw new Error(n+"contains a function "+Zo(r)+" with contents = "+e.toString());if(Pp(e))throw new Error(n+"contains "+e.toString()+" "+Zo(r));if(typeof e=="string"&&e.length>Ey/3&&kp(e)>Ey)throw new Error(n+"contains a string greater than "+Ey+" utf8 bytes "+Zo(r)+" ('"+e.substring(0,50)+"...')");if(e&&typeof e=="object"){let s=!1,i=!1;if(Mn(e,(o,a)=>{if(o===".value")s=!0;else if(o!==".priority"&&o!==".sv"&&(i=!0,!Bp(o)))throw new Error(n+" contains an invalid key ("+o+") "+Zo(r)+`.  Keys must be non-empty strings and can't contain ".", "#", "$", "/", "[", or "]"`);iF(r,o),uh(n,a,r),oF(r)}),s&&i)throw new Error(n+' contains ".value" child '+Zo(r)+" in addition to actual children.")}},zj=function(n,e){let t,r;for(t=0;t<e.length;t++){r=e[t];const i=Td(r);for(let o=0;o<i.length;o++)if(!(i[o]===".priority"&&o===i.length-1)){if(!Bp(i[o]))throw new Error(n+"contains an invalid key ("+i[o]+") in path "+r.toString()+`. Keys must be non-empty strings and can't contain ".", "#", "$", "/", "[", or "]"`)}}e.sort(rF);let s=null;for(t=0;t<e.length;t++){if(r=e[t],s!==null&&Xr(s,r))throw new Error(n+"contains a path "+s.toString()+" that is ancestor of another path "+r.toString());s=r}},mR=function(n,e,t,r){if(r&&e===void 0)return;const s=ba(n,"values");if(!(e&&typeof e=="object")||Array.isArray(e))throw new Error(s+" must be an object containing the children to replace.");const i=[];Mn(e,(o,a)=>{const l=new xt(o);if(uh(s,a,Qt(t,l)),$0(l)===".priority"&&!kd(a))throw new Error(s+"contains an invalid value for '"+l.toString()+"', which must be a valid Firebase priority (a string, finite number, server value, or null).");i.push(l)}),zj(s,i)},hw=function(n,e,t){if(!(t&&e===void 0)){if(Pp(e))throw new Error(ba(n,"priority")+"is "+e.toString()+", but must be a valid Firebase priority (a string, finite number, server value, or null).");if(!kd(e))throw new Error(ba(n,"priority")+"must be a valid Firebase priority (a string, finite number, server value, or null).")}},dh=function(n,e,t,r){if(!(r&&t===void 0)&&!Bp(t))throw new Error(ba(n,e)+'was an invalid key = "'+t+`".  Firebase keys must be non-empty strings and can't contain ".", "#", "$", "/", "[", or "]").`)},fw=function(n,e,t,r){if(!(r&&t===void 0)&&!pR(t))throw new Error(ba(n,e)+'was an invalid path = "'+t+`". Paths must be non-empty strings and can't contain ".", "#", "$", "[", or "]"`)},qj=function(n,e,t,r){t&&(t=t.replace(/^\/*\.info(\/|$)/,"/")),fw(n,e,t,r)},Ls=function(n,e){if(We(e)===".info")throw new Error(n+" failed = Can't modify data under /.info/")},yR=function(n,e){const t=e.path.toString();if(typeof e.repoInfo.host!="string"||e.repoInfo.host.length===0||!Bp(e.repoInfo.namespace)&&e.repoInfo.host.split(":")[0]!=="localhost"||t.length!==0&&!Bj(t))throw new Error(ba(n,"url")+`must be a valid firebase URL and the path can't contain ".", "#", "$", "[", or "]".`)};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Wj{constructor(){this.eventLists_=[],this.recursionDepth_=0}}function zp(n,e){let t=null;for(let r=0;r<e.length;r++){const s=e[r],i=s.getPath();t!==null&&!B0(i,t.path)&&(n.eventLists_.push(t),t=null),t===null&&(t={events:[],path:i}),t.events.push(s)}t&&n.eventLists_.push(t)}function _R(n,e,t){zp(n,t),vR(n,r=>B0(r,e))}function $r(n,e,t){zp(n,t),vR(n,r=>Xr(r,e)||Xr(e,r))}function vR(n,e){n.recursionDepth_++;let t=!0;for(let r=0;r<n.eventLists_.length;r++){const s=n.eventLists_[r];if(s){const i=s.path;e(i)?(Gj(n.eventLists_[r]),n.eventLists_[r]=null):t=!1}}t&&(n.eventLists_=[]),n.recursionDepth_--}function Gj(n){for(let e=0;e<n.events.length;e++){const t=n.events[e];if(t!==null){n.events[e]=null;const r=t.getEventRunner();pa&&Nn("event: "+t.toString()),Pc(r)}}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const wR="repo_interrupt",Hj=25;class Kj{constructor(e,t,r,s){this.repoInfo_=e,this.forceRestClient_=t,this.authTokenProvider_=r,this.appCheckProvider_=s,this.dataUpdateCount=0,this.statsListener_=null,this.eventQueue_=new Wj,this.nextWriteId_=1,this.interceptServerDataCallback_=null,this.onDisconnect_=Lg(),this.transactionQueueTree_=new uw,this.persistentConnection_=null,this.key=this.repoInfo_.toURLString()}toString(){return(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host}}function Qj(n,e,t){if(n.stats_=j0(n.repoInfo_),n.forceRestClient_||CV())n.server_=new Mg(n.repoInfo_,(r,s,i,o)=>{IS(n,r,s,i,o)},n.authTokenProvider_,n.appCheckProvider_),setTimeout(()=>ES(n,!0),0);else{if(typeof t<"u"&&t!==null){if(typeof t!="object")throw new Error("Only objects are supported for option databaseAuthVariableOverride");try{wn(t)}catch(r){throw new Error("Invalid authOverride provided: "+r)}}n.persistentConnection_=new es(n.repoInfo_,e,(r,s,i,o)=>{IS(n,r,s,i,o)},r=>{ES(n,r)},r=>{Yj(n,r)},n.authTokenProvider_,n.appCheckProvider_,t),n.server_=n.persistentConnection_}n.authTokenProvider_.addTokenChangeListener(r=>{n.server_.refreshAuthToken(r)}),n.appCheckProvider_.addTokenChangeListener(r=>{n.server_.refreshAppCheckToken(r.token)}),n.statsReporter_=DV(n.repoInfo_,()=>new MF(n.stats_,n.server_)),n.infoData_=new RF,n.infoSyncTree_=new wS({startListening:(r,s,i,o)=>{let a=[];const l=n.infoData_.getNode(r._path);return l.isEmpty()||(a=lh(n.infoSyncTree_,r._path,l),setTimeout(()=>{o("ok")},0)),a},stopListening:()=>{}}),gw(n,"connected",!1),n.serverSyncTree_=new wS({startListening:(r,s,i,o)=>(n.server_.listen(r,i,s,(a,l)=>{const u=o(a,l);$r(n.eventQueue_,r._path,u)}),[]),stopListening:(r,s)=>{n.server_.unlisten(r,s)}})}function xR(n){const t=n.infoData_.getNode(new xt(".info/serverTimeOffset")).val()||0;return new Date().getTime()+t}function hh(n){return Mj({timestamp:xR(n)})}function IS(n,e,t,r,s){n.dataUpdateCount++;const i=new xt(e);t=n.interceptServerDataCallback_?n.interceptServerDataCallback_(e,t):t;let o=[];if(s)if(r){const l=Rg(t,u=>Zt(u));o=Cj(n.serverSyncTree_,i,l,s)}else{const l=Zt(t);o=lR(n.serverSyncTree_,i,l,s)}else if(r){const l=Rg(t,u=>Zt(u));o=Tj(n.serverSyncTree_,i,l)}else{const l=Zt(t);o=lh(n.serverSyncTree_,i,l)}let a=i;o.length>0&&(a=oc(n,i)),$r(n.eventQueue_,a,o)}function ES(n,e){gw(n,"connected",e),e===!1&&Zj(n)}function Yj(n,e){Mn(e,(t,r)=>{gw(n,t,r)})}function gw(n,e,t){const r=new xt("/.info/"+e),s=Zt(t);n.infoData_.updateSnapshot(r,s);const i=lh(n.infoSyncTree_,r,s);$r(n.eventQueue_,r,i)}function qp(n){return n.nextWriteId_++}function Jj(n,e,t){const r=Rj(n.serverSyncTree_,e);return r!=null?Promise.resolve(r):n.server_.get(e).then(s=>{const i=Zt(s).withIndex(e._queryParams.getIndex());tv(n.serverSyncTree_,e,t,!0);let o;if(e._queryParams.loadsAllData())o=lh(n.serverSyncTree_,e._path,i);else{const a=Nd(n.serverSyncTree_,e);o=lR(n.serverSyncTree_,e._path,i,a)}return $r(n.eventQueue_,e._path,o),zg(n.serverSyncTree_,e,t,null,!0),i},s=>(Lc(n,"get for query "+wn(e)+" failed: "+s),Promise.reject(new Error(s))))}function pw(n,e,t,r,s){Lc(n,"set",{path:e.toString(),value:t,priority:r});const i=hh(n),o=Zt(t,r),a=Fp(n.serverSyncTree_,e),l=lw(o,a,i),u=qp(n),h=nw(n.serverSyncTree_,e,l,u,!0);zp(n.eventQueue_,h),n.server_.put(e.toString(),o.val(!0),(g,y)=>{const w=g==="ok";w||er("set at "+e+" failed: "+g);const C=eo(n.serverSyncTree_,u,!w);$r(n.eventQueue_,e,C),Ao(n,s,g,y)});const f=yw(n,e);oc(n,f),$r(n.eventQueue_,f,[])}function Xj(n,e,t,r){Lc(n,"update",{path:e.toString(),value:t});let s=!0;const i=hh(n),o={};if(Mn(t,(a,l)=>{s=!1,o[a]=hR(Qt(e,a),Zt(l),n.serverSyncTree_,i)}),s)Nn("update() called with empty data.  Don't do anything."),Ao(n,r,"ok",void 0);else{const a=qp(n),l=Sj(n.serverSyncTree_,e,o,a);zp(n.eventQueue_,l),n.server_.merge(e.toString(),t,(u,h)=>{const f=u==="ok";f||er("update at "+e+" failed: "+u);const g=eo(n.serverSyncTree_,a,!f),y=g.length>0?oc(n,e):e;$r(n.eventQueue_,y,g),Ao(n,r,u,h)}),Mn(t,u=>{const h=yw(n,Qt(e,u));oc(n,h)}),$r(n.eventQueue_,e,[])}}function Zj(n){Lc(n,"onDisconnectEvents");const e=hh(n),t=Lg();Q_(n.onDisconnect_,pt(),(s,i)=>{const o=hR(s,i,n.serverSyncTree_,e);Dc(t,s,o)});let r=[];Q_(t,pt(),(s,i)=>{r=r.concat(lh(n.serverSyncTree_,s,i));const o=yw(n,s);oc(n,o)}),n.onDisconnect_=Lg(),$r(n.eventQueue_,pt(),r)}function e4(n,e,t){n.server_.onDisconnectCancel(e.toString(),(r,s)=>{r==="ok"&&K_(n.onDisconnect_,e),Ao(n,t,r,s)})}function SS(n,e,t,r){const s=Zt(t);n.server_.onDisconnectPut(e.toString(),s.val(!0),(i,o)=>{i==="ok"&&Dc(n.onDisconnect_,e,s),Ao(n,r,i,o)})}function t4(n,e,t,r,s){const i=Zt(t,r);n.server_.onDisconnectPut(e.toString(),i.val(!0),(o,a)=>{o==="ok"&&Dc(n.onDisconnect_,e,i),Ao(n,s,o,a)})}function n4(n,e,t,r){if(Cg(t)){Nn("onDisconnect().update() called with empty data.  Don't do anything."),Ao(n,r,"ok",void 0);return}n.server_.onDisconnectMerge(e.toString(),t,(s,i)=>{s==="ok"&&Mn(t,(o,a)=>{const l=Zt(a);Dc(n.onDisconnect_,Qt(e,o),l)}),Ao(n,r,s,i)})}function r4(n,e,t){let r;We(e._path)===".info"?r=tv(n.infoSyncTree_,e,t):r=tv(n.serverSyncTree_,e,t),_R(n.eventQueue_,e._path,r)}function rv(n,e,t){let r;We(e._path)===".info"?r=zg(n.infoSyncTree_,e,t):r=zg(n.serverSyncTree_,e,t),_R(n.eventQueue_,e._path,r)}function IR(n){n.persistentConnection_&&n.persistentConnection_.interrupt(wR)}function s4(n){n.persistentConnection_&&n.persistentConnection_.resume(wR)}function Lc(n,...e){let t="";n.persistentConnection_&&(t=n.persistentConnection_.id+":"),Nn(t,...e)}function Ao(n,e,t,r){e&&Pc(()=>{if(t==="ok")e(null);else{const s=(t||"error").toUpperCase();let i=s;r&&(i+=": "+r);const o=new Error(i);o.code=s,e(o)}})}function i4(n,e,t,r,s,i){Lc(n,"transaction on "+e);const o={path:e,update:t,onComplete:r,status:null,order:yC(),applyLocally:i,retryCount:0,unwatcher:s,abortReason:null,currentWriteId:null,currentInputSnapshot:null,currentOutputSnapshotRaw:null,currentOutputSnapshotResolved:null},a=mw(n,e,void 0);o.currentInputSnapshot=a;const l=o.update(a.val());if(l===void 0)o.unwatcher(),o.currentOutputSnapshotRaw=null,o.currentOutputSnapshotResolved=null,o.onComplete&&o.onComplete(null,!1,o.currentInputSnapshot);else{uh("transaction failed: Data returned ",l,o.path),o.status=0;const u=Up(n.transactionQueueTree_,e),h=Qa(u)||[];h.push(o),dw(u,h);let f;typeof l=="object"&&l!==null&&Is(l,".priority")?(f=Ta(l,".priority"),Z(kd(f),"Invalid priority returned by transaction. Priority must be a valid string, finite number, server value, or null.")):f=(Fp(n.serverSyncTree_,e)||Ne.EMPTY_NODE).getPriority().val();const g=hh(n),y=Zt(l,f),w=lw(y,a,g);o.currentOutputSnapshotRaw=y,o.currentOutputSnapshotResolved=w,o.currentWriteId=qp(n);const C=nw(n.serverSyncTree_,e,w,o.currentWriteId,o.applyLocally);$r(n.eventQueue_,e,C),Wp(n,n.transactionQueueTree_)}}function mw(n,e,t){return Fp(n.serverSyncTree_,e,t)||Ne.EMPTY_NODE}function Wp(n,e=n.transactionQueueTree_){if(e||Gp(n,e),Qa(e)){const t=SR(n,e);Z(t.length>0,"Sending zero length transaction queue"),t.every(s=>s.status===0)&&o4(n,ch(e),t)}else fR(e)&&$p(e,t=>{Wp(n,t)})}function o4(n,e,t){const r=t.map(u=>u.currentWriteId),s=mw(n,e,r);let i=s;const o=s.hash();for(let u=0;u<t.length;u++){const h=t[u];Z(h.status===0,"tryToSendTransactionQueue_: items in queue should all be run."),h.status=1,h.retryCount++;const f=or(e,h.path);i=i.updateChild(f,h.currentOutputSnapshotRaw)}const a=i.val(!0),l=e;n.server_.put(l.toString(),a,u=>{Lc(n,"transaction put response",{path:l.toString(),status:u});let h=[];if(u==="ok"){const f=[];for(let g=0;g<t.length;g++)t[g].status=2,h=h.concat(eo(n.serverSyncTree_,t[g].currentWriteId)),t[g].onComplete&&f.push(()=>t[g].onComplete(null,!0,t[g].currentOutputSnapshotResolved)),t[g].unwatcher();Gp(n,Up(n.transactionQueueTree_,e)),Wp(n,n.transactionQueueTree_),$r(n.eventQueue_,e,h);for(let g=0;g<f.length;g++)Pc(f[g])}else{if(u==="datastale")for(let f=0;f<t.length;f++)t[f].status===3?t[f].status=4:t[f].status=0;else{er("transaction at "+l.toString()+" failed: "+u);for(let f=0;f<t.length;f++)t[f].status=4,t[f].abortReason=u}oc(n,e)}},o)}function oc(n,e){const t=ER(n,e),r=ch(t),s=SR(n,t);return a4(n,s,r),r}function a4(n,e,t){if(e.length===0)return;const r=[];let s=[];const o=e.filter(a=>a.status===0).map(a=>a.currentWriteId);for(let a=0;a<e.length;a++){const l=e[a],u=or(t,l.path);let h=!1,f;if(Z(u!==null,"rerunTransactionsUnderNode_: relativePath should not be null."),l.status===4)h=!0,f=l.abortReason,s=s.concat(eo(n.serverSyncTree_,l.currentWriteId,!0));else if(l.status===0)if(l.retryCount>=Hj)h=!0,f="maxretry",s=s.concat(eo(n.serverSyncTree_,l.currentWriteId,!0));else{const g=mw(n,l.path,o);l.currentInputSnapshot=g;const y=e[a].update(g.val());if(y!==void 0){uh("transaction failed: Data returned ",y,l.path);let w=Zt(y);typeof y=="object"&&y!=null&&Is(y,".priority")||(w=w.updatePriority(g.getPriority()));const M=l.currentWriteId,A=hh(n),I=lw(w,g,A);l.currentOutputSnapshotRaw=w,l.currentOutputSnapshotResolved=I,l.currentWriteId=qp(n),o.splice(o.indexOf(M),1),s=s.concat(nw(n.serverSyncTree_,l.path,I,l.currentWriteId,l.applyLocally)),s=s.concat(eo(n.serverSyncTree_,M,!0))}else h=!0,f="nodata",s=s.concat(eo(n.serverSyncTree_,l.currentWriteId,!0))}$r(n.eventQueue_,t,s),s=[],h&&(e[a].status=2,function(g){setTimeout(g,Math.floor(0))}(e[a].unwatcher),e[a].onComplete&&(f==="nodata"?r.push(()=>e[a].onComplete(null,!1,e[a].currentInputSnapshot)):r.push(()=>e[a].onComplete(new Error(f),!1,null))))}Gp(n,n.transactionQueueTree_);for(let a=0;a<r.length;a++)Pc(r[a]);Wp(n,n.transactionQueueTree_)}function ER(n,e){let t,r=n.transactionQueueTree_;for(t=We(e);t!==null&&Qa(r)===void 0;)r=Up(r,t),e=Nt(e),t=We(e);return r}function SR(n,e){const t=[];return TR(n,e,t),t.sort((r,s)=>r.order-s.order),t}function TR(n,e,t){const r=Qa(e);if(r)for(let s=0;s<r.length;s++)t.push(r[s]);$p(e,s=>{TR(n,s,t)})}function Gp(n,e){const t=Qa(e);if(t){let r=0;for(let s=0;s<t.length;s++)t[s].status!==2&&(t[r]=t[s],r++);t.length=r,dw(e,t.length>0?t:void 0)}$p(e,r=>{Gp(n,r)})}function yw(n,e){const t=ch(ER(n,e)),r=Up(n.transactionQueueTree_,e);return Fj(r,s=>{Sy(n,s)}),Sy(n,r),gR(r,s=>{Sy(n,s)}),t}function Sy(n,e){const t=Qa(e);if(t){const r=[];let s=[],i=-1;for(let o=0;o<t.length;o++)t[o].status===3||(t[o].status===1?(Z(i===o-1,"All SENT items should be at beginning of queue."),i=o,t[o].status=3,t[o].abortReason="set"):(Z(t[o].status===0,"Unexpected transaction status in abort"),t[o].unwatcher(),s=s.concat(eo(n.serverSyncTree_,t[o].currentWriteId,!0)),t[o].onComplete&&r.push(t[o].onComplete.bind(null,new Error("set"),!1,null))));i===-1?dw(e,void 0):t.length=i+1,$r(n.eventQueue_,ch(e),s);for(let o=0;o<r.length;o++)Pc(r[o])}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function l4(n){let e="";const t=n.split("/");for(let r=0;r<t.length;r++)if(t[r].length>0){let s=t[r];try{s=decodeURIComponent(s.replace(/\+/g," "))}catch{}e+="/"+s}return e}function c4(n){const e={};n.charAt(0)==="?"&&(n=n.substring(1));for(const t of n.split("&")){if(t.length===0)continue;const r=t.split("=");r.length===2?e[decodeURIComponent(r[0])]=decodeURIComponent(r[1]):er(`Invalid query segment '${t}' in query '${n}'`)}return e}const sv=function(n,e){const t=u4(n),r=t.namespace;t.domain==="firebase.com"&&Gs(t.host+" is no longer supported. Please use <YOUR FIREBASE>.firebaseio.com instead"),(!r||r==="undefined")&&t.domain!=="localhost"&&Gs("Cannot parse Firebase url. Please use https://<YOUR FIREBASE>.firebaseio.com"),t.secure||vV();const s=t.scheme==="ws"||t.scheme==="wss";return{repoInfo:new kC(t.host,t.secure,r,s,e,"",r!==t.subdomain),path:new xt(t.pathString)}},u4=function(n){let e="",t="",r="",s="",i="",o=!0,a="https",l=443;if(typeof n=="string"){let u=n.indexOf("//");u>=0&&(a=n.substring(0,u-1),n=n.substring(u+2));let h=n.indexOf("/");h===-1&&(h=n.length);let f=n.indexOf("?");f===-1&&(f=n.length),e=n.substring(0,Math.min(h,f)),h<f&&(s=l4(n.substring(h,f)));const g=c4(n.substring(Math.min(n.length,f)));u=e.indexOf(":"),u>=0?(o=a==="https"||a==="wss",l=parseInt(e.substring(u+1),10)):u=e.length;const y=e.slice(0,u);if(y.toLowerCase()==="localhost")t="localhost";else if(y.split(".").length<=2)t=y;else{const w=e.indexOf(".");r=e.substring(0,w).toLowerCase(),t=e.substring(w+1),i=r}"ns"in g&&(i=g.ns)}return{host:e,port:l,domain:t,subdomain:r,secure:o,scheme:a,pathString:s,namespace:i}};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const TS="-0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ_abcdefghijklmnopqrstuvwxyz",d4=function(){let n=0;const e=[];return function(t){const r=t===n;n=t;let s;const i=new Array(8);for(s=7;s>=0;s--)i[s]=TS.charAt(t%64),t=Math.floor(t/64);Z(t===0,"Cannot push at time == 0");let o=i.join("");if(r){for(s=11;s>=0&&e[s]===63;s--)e[s]=0;e[s]++}else for(s=0;s<12;s++)e[s]=Math.floor(Math.random()*64);for(s=0;s<12;s++)o+=TS.charAt(e[s]);return Z(o.length===20,"nextPushId: Length should be 20."),o}}();/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class bR{constructor(e,t,r,s){this.eventType=e,this.eventRegistration=t,this.snapshot=r,this.prevName=s}getPath(){const e=this.snapshot.ref;return this.eventType==="value"?e._path:e.parent._path}getEventType(){return this.eventType}getEventRunner(){return this.eventRegistration.getEventRunner(this)}toString(){return this.getPath().toString()+":"+this.eventType+":"+wn(this.snapshot.exportVal())}}class AR{constructor(e,t,r){this.eventRegistration=e,this.error=t,this.path=r}getPath(){return this.path}getEventType(){return"cancel"}getEventRunner(){return this.eventRegistration.getEventRunner(this)}toString(){return this.path.toString()+":cancel"}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class _w{constructor(e,t){this.snapshotCallback=e,this.cancelCallback=t}onValue(e,t){this.snapshotCallback.call(null,e,t)}onCancel(e){return Z(this.hasCancelCallback,"Raising a cancel event on a listener with no cancel callback"),this.cancelCallback.call(null,e)}get hasCancelCallback(){return!!this.cancelCallback}matches(e){return this.snapshotCallback===e.snapshotCallback||this.snapshotCallback.userCallback!==void 0&&this.snapshotCallback.userCallback===e.snapshotCallback.userCallback&&this.snapshotCallback.context===e.snapshotCallback.context}}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class h4{constructor(e,t){this._repo=e,this._path=t}cancel(){const e=new Pr;return e4(this._repo,this._path,e.wrapCallback(()=>{})),e.promise}remove(){Ls("OnDisconnect.remove",this._path);const e=new Pr;return SS(this._repo,this._path,null,e.wrapCallback(()=>{})),e.promise}set(e){Ls("OnDisconnect.set",this._path),Hs("OnDisconnect.set",e,this._path,!1);const t=new Pr;return SS(this._repo,this._path,e,t.wrapCallback(()=>{})),t.promise}setWithPriority(e,t){Ls("OnDisconnect.setWithPriority",this._path),Hs("OnDisconnect.setWithPriority",e,this._path,!1),hw("OnDisconnect.setWithPriority",t,!1);const r=new Pr;return t4(this._repo,this._path,e,t,r.wrapCallback(()=>{})),r.promise}update(e){Ls("OnDisconnect.update",this._path),mR("OnDisconnect.update",e,this._path,!1);const t=new Pr;return n4(this._repo,this._path,e,t.wrapCallback(()=>{})),t.promise}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Wr{constructor(e,t,r,s){this._repo=e,this._path=t,this._queryParams=r,this._orderByCalled=s}get key(){return Ge(this._path)?null:$0(this._path)}get ref(){return new Es(this._repo,this._path)}get _queryIdentifier(){const e=uS(this._queryParams),t=V0(e);return t==="{}"?"default":t}get _queryObject(){return uS(this._queryParams)}isEqual(e){if(e=ae(e),!(e instanceof Wr))return!1;const t=this._repo===e._repo,r=B0(this._path,e._path),s=this._queryIdentifier===e._queryIdentifier;return t&&r&&s}toJSON(){return this.toString()}toString(){return this._repo.toString()+nF(this._path)}}function Hp(n,e){if(n._orderByCalled===!0)throw new Error(e+": You can't combine multiple orderBy calls.")}function Fo(n){let e=null,t=null;if(n.hasStart()&&(e=n.getIndexStartValue()),n.hasEnd()&&(t=n.getIndexEndValue()),n.getIndex()===$s){const r="Query: When ordering by key, you may only pass one argument to startAt(), endAt(), or equalTo().",s="Query: When ordering by key, the argument passed to startAt(), startAfter(), endAt(), endBefore(), or equalTo() must be a string.";if(n.hasStart()){if(n.getIndexStartName()!==Eo)throw new Error(r);if(typeof e!="string")throw new Error(s)}if(n.hasEnd()){if(n.getIndexEndName()!==vi)throw new Error(r);if(typeof t!="string")throw new Error(s)}}else if(n.getIndex()===Lt){if(e!=null&&!kd(e)||t!=null&&!kd(t))throw new Error("Query: When ordering by priority, the first argument passed to startAt(), startAfter() endAt(), endBefore(), or equalTo() must be a valid priority value (null, a number, or a string).")}else if(Z(n.getIndex()instanceof W0||n.getIndex()===G0,"unknown index type."),e!=null&&typeof e=="object"||t!=null&&typeof t=="object")throw new Error("Query: First argument passed to startAt(), startAfter(), endAt(), endBefore(), or equalTo() cannot be an object.")}function Kp(n){if(n.hasStart()&&n.hasEnd()&&n.hasLimit()&&!n.hasAnchoredLimit())throw new Error("Query: Can't combine startAt(), startAfter(), endAt(), endBefore(), and limit(). Use limitToFirst() or limitToLast() instead.")}class Es extends Wr{constructor(e,t){super(e,t,new K0,!1)}get parent(){const e=UC(this._path);return e===null?null:new Es(this._repo,e)}get root(){let e=this;for(;e.parent!==null;)e=e.parent;return e}}class Ra{constructor(e,t,r){this._node=e,this.ref=t,this._index=r}get priority(){return this._node.getPriority().val()}get key(){return this.ref.key}get size(){return this._node.numChildren()}child(e){const t=new xt(e),r=ac(this.ref,e);return new Ra(this._node.getChild(t),r,Lt)}exists(){return!this._node.isEmpty()}exportVal(){return this._node.val(!0)}forEach(e){return this._node.isLeafNode()?!1:!!this._node.forEachChild(this._index,(r,s)=>e(new Ra(s,ac(this.ref,r),Lt)))}hasChild(e){const t=new xt(e);return!this._node.getChild(t).isEmpty()}hasChildren(){return this._node.isLeafNode()?!1:!this._node.isEmpty()}toJSON(){return this.exportVal()}val(){return this._node.val()}}function ge(n,e){return n=ae(n),n._checkNotDeleted("ref"),e!==void 0?ac(n._root,e):n._root}function P8(n,e){n=ae(n),n._checkNotDeleted("refFromURL");const t=sv(e,n._repo.repoInfo_.nodeAdmin);yR("refFromURL",t);const r=t.repoInfo;return!n._repo.repoInfo_.isCustomHost()&&r.host!==n._repo.repoInfo_.host&&Gs("refFromURL: Host name does not match the current database: (found "+r.host+" but expected "+n._repo.repoInfo_.host+")"),ge(n,t.path.toString())}function ac(n,e){return n=ae(n),We(n._path)===null?qj("child","path",e,!1):fw("child","path",e,!1),new Es(n._repo,Qt(n._path,e))}function D8(n){return n=ae(n),new h4(n._repo,n._path)}function f4(n,e){n=ae(n),Ls("push",n._path),Hs("push",e,n._path,!0);const t=xR(n._repo),r=d4(t),s=ac(n,r),i=ac(n,r);let o;return e!=null?o=ct(i,e).then(()=>i):o=Promise.resolve(i),s.then=o.then.bind(o),s.catch=o.then.bind(o,void 0),s}function M8(n){return Ls("remove",n._path),ct(n,null)}function ct(n,e){n=ae(n),Ls("set",n._path),Hs("set",e,n._path,!1);const t=new Pr;return pw(n._repo,n._path,e,null,t.wrapCallback(()=>{})),t.promise}function L8(n,e){n=ae(n),Ls("setPriority",n._path),hw("setPriority",e,!1);const t=new Pr;return pw(n._repo,Qt(n._path,".priority"),e,null,t.wrapCallback(()=>{})),t.promise}function O8(n,e,t){if(Ls("setWithPriority",n._path),Hs("setWithPriority",e,n._path,!1),hw("setWithPriority",t,!1),n.key===".length"||n.key===".keys")throw"setWithPriority failed: "+n.key+" is a read-only object.";const r=new Pr;return pw(n._repo,n._path,e,t,r.wrapCallback(()=>{})),r.promise}function V8(n,e){mR("update",e,n._path,!1);const t=new Pr;return Xj(n._repo,n._path,e,t.wrapCallback(()=>{})),t.promise}function Fe(n){n=ae(n);const e=new _w(()=>{}),t=new fh(e);return Jj(n._repo,n,t).then(r=>new Ra(r,new Es(n._repo,n._path),n._queryParams.getIndex()))}class fh{constructor(e){this.callbackContext=e}respondsTo(e){return e==="value"}createEvent(e,t){const r=t._queryParams.getIndex();return new bR("value",this,new Ra(e.snapshotNode,new Es(t._repo,t._path),r))}getEventRunner(e){return e.getEventType()==="cancel"?()=>this.callbackContext.onCancel(e.error):()=>this.callbackContext.onValue(e.snapshot,null)}createCancelEvent(e,t){return this.callbackContext.hasCancelCallback?new AR(this,e,t):null}matches(e){return e instanceof fh?!e.callbackContext||!this.callbackContext?!0:e.callbackContext.matches(this.callbackContext):!1}hasAnyCallback(){return this.callbackContext!==null}}class Qp{constructor(e,t){this.eventType=e,this.callbackContext=t}respondsTo(e){let t=e==="children_added"?"child_added":e;return t=t==="children_removed"?"child_removed":t,this.eventType===t}createCancelEvent(e,t){return this.callbackContext.hasCancelCallback?new AR(this,e,t):null}createEvent(e,t){Z(e.childName!=null,"Child events should have a childName.");const r=ac(new Es(t._repo,t._path),e.childName),s=t._queryParams.getIndex();return new bR(e.type,this,new Ra(e.snapshotNode,r,s),e.prevName)}getEventRunner(e){return e.getEventType()==="cancel"?()=>this.callbackContext.onCancel(e.error):()=>this.callbackContext.onValue(e.snapshot,e.prevName)}matches(e){return e instanceof Qp?this.eventType===e.eventType&&(!this.callbackContext||!e.callbackContext||this.callbackContext.matches(e.callbackContext)):!1}hasAnyCallback(){return!!this.callbackContext}}function gh(n,e,t,r,s){let i;if(typeof r=="object"&&(i=void 0,s=r),typeof r=="function"&&(i=r),s&&s.onlyOnce){const l=t,u=(h,f)=>{rv(n._repo,n,a),l(h,f)};u.userCallback=t.userCallback,u.context=t.context,t=u}const o=new _w(t,i||void 0),a=e==="value"?new fh(o):new Qp(e,o);return r4(n._repo,n,a),()=>rv(n._repo,n,a)}function CR(n,e,t,r){return gh(n,"value",e,t,r)}function F8(n,e,t,r){return gh(n,"child_added",e,t,r)}function j8(n,e,t,r){return gh(n,"child_changed",e,t,r)}function U8(n,e,t,r){return gh(n,"child_moved",e,t,r)}function $8(n,e,t,r){return gh(n,"child_removed",e,t,r)}function B8(n,e,t){let r=null;const s=t?new _w(t):null;e==="value"?r=new fh(s):e&&(r=new Qp(e,s)),rv(n._repo,n,r)}let Ss=class{},RR=class extends Ss{constructor(e,t){super(),this._value=e,this._key=t,this.type="endAt"}_apply(e){Hs("endAt",this._value,e._path,!0);const t=H_(e._queryParams,this._value,this._key);if(Kp(t),Fo(t),e._queryParams.hasEnd())throw new Error("endAt: Starting point was already set (by another call to endAt, endBefore or equalTo).");return new Wr(e._repo,e._path,t,e._orderByCalled)}};function W8(n,e){return dh("endAt","key",e,!0),new RR(n,e)}class g4 extends Ss{constructor(e,t){super(),this._value=e,this._key=t,this.type="endBefore"}_apply(e){Hs("endBefore",this._value,e._path,!1);const t=CF(e._queryParams,this._value,this._key);if(Kp(t),Fo(t),e._queryParams.hasEnd())throw new Error("endBefore: Starting point was already set (by another call to endAt, endBefore or equalTo).");return new Wr(e._repo,e._path,t,e._orderByCalled)}}function G8(n,e){return dh("endBefore","key",e,!0),new g4(n,e)}let NR=class extends Ss{constructor(e,t){super(),this._value=e,this._key=t,this.type="startAt"}_apply(e){Hs("startAt",this._value,e._path,!0);const t=G_(e._queryParams,this._value,this._key);if(Kp(t),Fo(t),e._queryParams.hasStart())throw new Error("startAt: Starting point was already set (by another call to startAt, startBefore or equalTo).");return new Wr(e._repo,e._path,t,e._orderByCalled)}};function K8(n=null,e){return dh("startAt","key",e,!0),new NR(n,e)}class p4 extends Ss{constructor(e,t){super(),this._value=e,this._key=t,this.type="startAfter"}_apply(e){Hs("startAfter",this._value,e._path,!1);const t=AF(e._queryParams,this._value,this._key);if(Kp(t),Fo(t),e._queryParams.hasStart())throw new Error("startAfter: Starting point was already set (by another call to startAt, startAfter, or equalTo).");return new Wr(e._repo,e._path,t,e._orderByCalled)}}function Q8(n,e){return dh("startAfter","key",e,!0),new p4(n,e)}class m4 extends Ss{constructor(e){super(),this._limit=e,this.type="limitToFirst"}_apply(e){if(e._queryParams.hasLimit())throw new Error("limitToFirst: Limit was already set (by another call to limitToFirst or limitToLast).");return new Wr(e._repo,e._path,TF(e._queryParams,this._limit),e._orderByCalled)}}function Y8(n){if(typeof n!="number"||Math.floor(n)!==n||n<=0)throw new Error("limitToFirst: First argument must be a positive integer.");return new m4(n)}class y4 extends Ss{constructor(e){super(),this._limit=e,this.type="limitToLast"}_apply(e){if(e._queryParams.hasLimit())throw new Error("limitToLast: Limit was already set (by another call to limitToFirst or limitToLast).");return new Wr(e._repo,e._path,bF(e._queryParams,this._limit),e._orderByCalled)}}function J8(n){if(typeof n!="number"||Math.floor(n)!==n||n<=0)throw new Error("limitToLast: First argument must be a positive integer.");return new y4(n)}class _4 extends Ss{constructor(e){super(),this._path=e,this.type="orderByChild"}_apply(e){Hp(e,"orderByChild");const t=new xt(this._path);if(Ge(t))throw new Error("orderByChild: cannot pass in empty path. Use orderByValue() instead.");const r=new W0(t),s=Mp(e._queryParams,r);return Fo(s),new Wr(e._repo,e._path,s,!0)}}function X8(n){if(n==="$key")throw new Error('orderByChild: "$key" is invalid.  Use orderByKey() instead.');if(n==="$priority")throw new Error('orderByChild: "$priority" is invalid.  Use orderByPriority() instead.');if(n==="$value")throw new Error('orderByChild: "$value" is invalid.  Use orderByValue() instead.');return fw("orderByChild","path",n,!1),new _4(n)}class v4 extends Ss{constructor(){super(...arguments),this.type="orderByKey"}_apply(e){Hp(e,"orderByKey");const t=Mp(e._queryParams,$s);return Fo(t),new Wr(e._repo,e._path,t,!0)}}function Z8(){return new v4}class w4 extends Ss{constructor(){super(...arguments),this.type="orderByPriority"}_apply(e){Hp(e,"orderByPriority");const t=Mp(e._queryParams,Lt);return Fo(t),new Wr(e._repo,e._path,t,!0)}}function eq(){return new w4}class x4 extends Ss{constructor(){super(...arguments),this.type="orderByValue"}_apply(e){Hp(e,"orderByValue");const t=Mp(e._queryParams,G0);return Fo(t),new Wr(e._repo,e._path,t,!0)}}function tq(){return new x4}class I4 extends Ss{constructor(e,t){super(),this._value=e,this._key=t,this.type="equalTo"}_apply(e){if(Hs("equalTo",this._value,e._path,!1),e._queryParams.hasStart())throw new Error("equalTo: Starting point was already set (by another call to startAt/startAfter or equalTo).");if(e._queryParams.hasEnd())throw new Error("equalTo: Ending point was already set (by another call to endAt/endBefore or equalTo).");return new RR(this._value,this._key)._apply(new NR(this._value,this._key)._apply(e))}}function nq(n,e){return dh("equalTo","key",e,!0),new I4(n,e)}function rq(n,...e){let t=ae(n);for(const r of e)t=r._apply(t);return t}mj(Es);xj(Es);/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const E4="FIREBASE_DATABASE_EMULATOR_HOST",iv={};let kR=!1;function S4(n,e,t,r){const s=e.lastIndexOf(":"),i=e.substring(0,s),o=bi(i);n.repoInfo_=new kC(e,o,n.repoInfo_.namespace,n.repoInfo_.webSocketOnly,n.repoInfo_.nodeAdmin,n.repoInfo_.persistenceKey,n.repoInfo_.includeNamespaceInQueryParams,!0,t),r&&(n.authTokenProvider_=r)}function PR(n,e,t,r,s){let i=r||n.options.databaseURL;i===void 0&&(n.options.projectId||Gs("Can't determine Firebase Database URL. Be sure to include  a Project ID when calling firebase.initializeApp()."),Nn("Using default host for project ",n.options.projectId),i=`${n.options.projectId}-default-rtdb.firebaseio.com`);let o=sv(i,s),a=o.repoInfo,l,u;typeof process<"u"&&process.env&&(u=process.env[E4]),u?(l=!0,i=`http://${u}?ns=${a.namespace}`,o=sv(i,s),a=o.repoInfo):l=!o.repoInfo.secure;const h=s&&l?new $l($l.OWNER):new NV(n.name,n.options,e);yR("Invalid Firebase Database URL",o),Ge(o.path)||Gs("Database URL must point to the root of a Firebase Database (not including a child path).");const f=b4(a,n,h,new RV(n,t));return new C4(f,n)}function T4(n,e){const t=iv[e];(!t||t[n.key]!==n)&&Gs(`Database ${e}(${n.repoInfo_}) has already been deleted.`),IR(n),delete t[n.key]}function b4(n,e,t,r){let s=iv[e.name];s||(s={},iv[e.name]=s);let i=s[n.toURLString()];return i&&Gs("Database initialized multiple times. Please make sure the format of the database URL matches with each database() call."),i=new Kj(n,kR,t,r),s[n.toURLString()]=i,i}function A4(n){kR=n}class C4{constructor(e,t){this._repoInternal=e,this.app=t,this.type="database",this._instanceStarted=!1}get _repo(){return this._instanceStarted||(Qj(this._repoInternal,this.app.options.appId,this.app.options.databaseAuthVariableOverride),this._instanceStarted=!0),this._repoInternal}get _root(){return this._rootInternal||(this._rootInternal=new Es(this._repo,pt())),this._rootInternal}_delete(){return this._rootInternal!==null&&(T4(this._repo,this.app.name),this._repoInternal=null,this._rootInternal=null),Promise.resolve()}_checkNotDeleted(e){this._rootInternal===null&&Gs("Cannot call "+e+" on a deleted database.")}}function DR(){nc.IS_TRANSPORT_INITIALIZED&&er("Transport has already been initialized. Please call this function before calling ref or setting up a listener")}function sq(){DR(),Zi.forceDisallow()}function iq(){DR(),Yr.forceDisallow(),Zi.forceAllow()}function R4(n=sh(),e){const t=Qs(n,"database").getImmediate({identifier:e});if(!t._instanceStarted){const r=Y1("database");r&&N4(t,...r)}return t}function N4(n,e,t,r={}){n=ae(n),n._checkNotDeleted("useEmulator");const s=`${e}:${t}`,i=n._repoInternal;if(n._instanceStarted){if(s===n._repoInternal.repoInfo_.host&&Ur(r,i.repoInfo_.emulatorOptions))return;Gs("connectDatabaseEmulator() cannot initialize or alter the emulator configuration after the database instance has started.")}let o;if(i.repoInfo_.nodeAdmin)r.mockUserToken&&Gs('mockUserToken is not supported by the Admin SDK. For client access with mock users, please use the "firebase" package instead of "firebase-admin".'),o=new $l($l.OWNER);else if(r.mockUserToken){const a=typeof r.mockUserToken=="string"?r.mockUserToken:Z1(r.mockUserToken,n.app.options.projectId);o=new $l(a)}bi(e)&&(Rp(e),P0("Database",!0)),S4(i,s,r,o)}function oq(n){n=ae(n),n._checkNotDeleted("goOffline"),IR(n._repo)}function aq(n){n=ae(n),n._checkNotDeleted("goOnline"),s4(n._repo)}function lq(n,e){vC(n,e)}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function k4(n){pC(Ga),ws(new Sr("database",(e,{instanceIdentifier:t})=>{const r=e.getProvider("app").getImmediate(),s=e.getProvider("auth-internal"),i=e.getProvider("app-check-internal");return PR(r,s,i,t)},"PUBLIC").setMultipleInstances(!0)),Ir(HE,KE,n),Ir(HE,KE,"esm2020")}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const P4={".sv":"timestamp"};function cq(){return P4}function uq(n){return{".sv":{increment:n}}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class D4{constructor(e,t){this.committed=e,this.snapshot=t}toJSON(){return{committed:this.committed,snapshot:this.snapshot.toJSON()}}}function dq(n,e,t){if(n=ae(n),Ls("Reference.transaction",n._path),n.key===".length"||n.key===".keys")throw"Reference.transaction failed: "+n.key+" is a read-only object.";const r=(t==null?void 0:t.applyLocally)??!0,s=new Pr,i=(a,l,u)=>{let h=null;a?s.reject(a):(h=new Ra(u,new Es(n._repo,n._path),Lt),s.resolve(new D4(l,h)))},o=CR(n,()=>{});return i4(n._repo,n._path,e,i,o,r),s.promise}es.prototype.simpleListen=function(n,e){this.sendRequest("q",{p:n},e)};es.prototype.echo=function(n,e){this.sendRequest("echo",{d:n},e)};const hq=function(n){const e=es.prototype.put;return es.prototype.put=function(t,r,s,i){i!==void 0&&(i=n()),e.call(this,t,r,s,i)},function(){es.prototype.put=e}},fq=function(n){A4(n)};/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function gq({app:n,url:e,version:t,customAuthImpl:r,customAppCheckImpl:s,nodeAdmin:i=!1}){pC(t);const o=new aC("database-standalone"),a=new V_("auth-internal",o);let l;return s&&(l=new V_("app-check-internal",o),l.setComponent(new Sr("app-check-internal",()=>s,"PRIVATE"))),a.setComponent(new Sr("auth-internal",()=>r,"PRIVATE")),PR(n,a,l,e,i)}k4();var bS=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};/** @license
Copyright The Closure Library Authors.
SPDX-License-Identifier: Apache-2.0
*/var _o,MR;(function(){var n;/** @license

 Copyright The Closure Library Authors.
 SPDX-License-Identifier: Apache-2.0
*/function e(S,v){function b(){}b.prototype=v.prototype,S.D=v.prototype,S.prototype=new b,S.prototype.constructor=S,S.C=function(_,E,N){for(var T=Array(arguments.length-2),K=2;K<arguments.length;K++)T[K-2]=arguments[K];return v.prototype[E].apply(_,T)}}function t(){this.blockSize=-1}function r(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.B=Array(this.blockSize),this.o=this.h=0,this.s()}e(r,t),r.prototype.s=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.o=this.h=0};function s(S,v,b){b||(b=0);var _=Array(16);if(typeof v=="string")for(var E=0;16>E;++E)_[E]=v.charCodeAt(b++)|v.charCodeAt(b++)<<8|v.charCodeAt(b++)<<16|v.charCodeAt(b++)<<24;else for(E=0;16>E;++E)_[E]=v[b++]|v[b++]<<8|v[b++]<<16|v[b++]<<24;v=S.g[0],b=S.g[1],E=S.g[2];var N=S.g[3],T=v+(N^b&(E^N))+_[0]+3614090360&4294967295;v=b+(T<<7&4294967295|T>>>25),T=N+(E^v&(b^E))+_[1]+3905402710&4294967295,N=v+(T<<12&4294967295|T>>>20),T=E+(b^N&(v^b))+_[2]+606105819&4294967295,E=N+(T<<17&4294967295|T>>>15),T=b+(v^E&(N^v))+_[3]+3250441966&4294967295,b=E+(T<<22&4294967295|T>>>10),T=v+(N^b&(E^N))+_[4]+4118548399&4294967295,v=b+(T<<7&4294967295|T>>>25),T=N+(E^v&(b^E))+_[5]+1200080426&4294967295,N=v+(T<<12&4294967295|T>>>20),T=E+(b^N&(v^b))+_[6]+2821735955&4294967295,E=N+(T<<17&4294967295|T>>>15),T=b+(v^E&(N^v))+_[7]+4249261313&4294967295,b=E+(T<<22&4294967295|T>>>10),T=v+(N^b&(E^N))+_[8]+1770035416&4294967295,v=b+(T<<7&4294967295|T>>>25),T=N+(E^v&(b^E))+_[9]+2336552879&4294967295,N=v+(T<<12&4294967295|T>>>20),T=E+(b^N&(v^b))+_[10]+4294925233&4294967295,E=N+(T<<17&4294967295|T>>>15),T=b+(v^E&(N^v))+_[11]+2304563134&4294967295,b=E+(T<<22&4294967295|T>>>10),T=v+(N^b&(E^N))+_[12]+1804603682&4294967295,v=b+(T<<7&4294967295|T>>>25),T=N+(E^v&(b^E))+_[13]+4254626195&4294967295,N=v+(T<<12&4294967295|T>>>20),T=E+(b^N&(v^b))+_[14]+2792965006&4294967295,E=N+(T<<17&4294967295|T>>>15),T=b+(v^E&(N^v))+_[15]+1236535329&4294967295,b=E+(T<<22&4294967295|T>>>10),T=v+(E^N&(b^E))+_[1]+4129170786&4294967295,v=b+(T<<5&4294967295|T>>>27),T=N+(b^E&(v^b))+_[6]+3225465664&4294967295,N=v+(T<<9&4294967295|T>>>23),T=E+(v^b&(N^v))+_[11]+643717713&4294967295,E=N+(T<<14&4294967295|T>>>18),T=b+(N^v&(E^N))+_[0]+3921069994&4294967295,b=E+(T<<20&4294967295|T>>>12),T=v+(E^N&(b^E))+_[5]+3593408605&4294967295,v=b+(T<<5&4294967295|T>>>27),T=N+(b^E&(v^b))+_[10]+38016083&4294967295,N=v+(T<<9&4294967295|T>>>23),T=E+(v^b&(N^v))+_[15]+3634488961&4294967295,E=N+(T<<14&4294967295|T>>>18),T=b+(N^v&(E^N))+_[4]+3889429448&4294967295,b=E+(T<<20&4294967295|T>>>12),T=v+(E^N&(b^E))+_[9]+568446438&4294967295,v=b+(T<<5&4294967295|T>>>27),T=N+(b^E&(v^b))+_[14]+3275163606&4294967295,N=v+(T<<9&4294967295|T>>>23),T=E+(v^b&(N^v))+_[3]+4107603335&4294967295,E=N+(T<<14&4294967295|T>>>18),T=b+(N^v&(E^N))+_[8]+1163531501&4294967295,b=E+(T<<20&4294967295|T>>>12),T=v+(E^N&(b^E))+_[13]+2850285829&4294967295,v=b+(T<<5&4294967295|T>>>27),T=N+(b^E&(v^b))+_[2]+4243563512&4294967295,N=v+(T<<9&4294967295|T>>>23),T=E+(v^b&(N^v))+_[7]+1735328473&4294967295,E=N+(T<<14&4294967295|T>>>18),T=b+(N^v&(E^N))+_[12]+2368359562&4294967295,b=E+(T<<20&4294967295|T>>>12),T=v+(b^E^N)+_[5]+4294588738&4294967295,v=b+(T<<4&4294967295|T>>>28),T=N+(v^b^E)+_[8]+2272392833&4294967295,N=v+(T<<11&4294967295|T>>>21),T=E+(N^v^b)+_[11]+1839030562&4294967295,E=N+(T<<16&4294967295|T>>>16),T=b+(E^N^v)+_[14]+4259657740&4294967295,b=E+(T<<23&4294967295|T>>>9),T=v+(b^E^N)+_[1]+2763975236&4294967295,v=b+(T<<4&4294967295|T>>>28),T=N+(v^b^E)+_[4]+1272893353&4294967295,N=v+(T<<11&4294967295|T>>>21),T=E+(N^v^b)+_[7]+4139469664&4294967295,E=N+(T<<16&4294967295|T>>>16),T=b+(E^N^v)+_[10]+3200236656&4294967295,b=E+(T<<23&4294967295|T>>>9),T=v+(b^E^N)+_[13]+681279174&4294967295,v=b+(T<<4&4294967295|T>>>28),T=N+(v^b^E)+_[0]+3936430074&4294967295,N=v+(T<<11&4294967295|T>>>21),T=E+(N^v^b)+_[3]+3572445317&4294967295,E=N+(T<<16&4294967295|T>>>16),T=b+(E^N^v)+_[6]+76029189&4294967295,b=E+(T<<23&4294967295|T>>>9),T=v+(b^E^N)+_[9]+3654602809&4294967295,v=b+(T<<4&4294967295|T>>>28),T=N+(v^b^E)+_[12]+3873151461&4294967295,N=v+(T<<11&4294967295|T>>>21),T=E+(N^v^b)+_[15]+530742520&4294967295,E=N+(T<<16&4294967295|T>>>16),T=b+(E^N^v)+_[2]+3299628645&4294967295,b=E+(T<<23&4294967295|T>>>9),T=v+(E^(b|~N))+_[0]+4096336452&4294967295,v=b+(T<<6&4294967295|T>>>26),T=N+(b^(v|~E))+_[7]+1126891415&4294967295,N=v+(T<<10&4294967295|T>>>22),T=E+(v^(N|~b))+_[14]+2878612391&4294967295,E=N+(T<<15&4294967295|T>>>17),T=b+(N^(E|~v))+_[5]+4237533241&4294967295,b=E+(T<<21&4294967295|T>>>11),T=v+(E^(b|~N))+_[12]+1700485571&4294967295,v=b+(T<<6&4294967295|T>>>26),T=N+(b^(v|~E))+_[3]+2399980690&4294967295,N=v+(T<<10&4294967295|T>>>22),T=E+(v^(N|~b))+_[10]+4293915773&4294967295,E=N+(T<<15&4294967295|T>>>17),T=b+(N^(E|~v))+_[1]+2240044497&4294967295,b=E+(T<<21&4294967295|T>>>11),T=v+(E^(b|~N))+_[8]+1873313359&4294967295,v=b+(T<<6&4294967295|T>>>26),T=N+(b^(v|~E))+_[15]+4264355552&4294967295,N=v+(T<<10&4294967295|T>>>22),T=E+(v^(N|~b))+_[6]+2734768916&4294967295,E=N+(T<<15&4294967295|T>>>17),T=b+(N^(E|~v))+_[13]+1309151649&4294967295,b=E+(T<<21&4294967295|T>>>11),T=v+(E^(b|~N))+_[4]+4149444226&4294967295,v=b+(T<<6&4294967295|T>>>26),T=N+(b^(v|~E))+_[11]+3174756917&4294967295,N=v+(T<<10&4294967295|T>>>22),T=E+(v^(N|~b))+_[2]+718787259&4294967295,E=N+(T<<15&4294967295|T>>>17),T=b+(N^(E|~v))+_[9]+3951481745&4294967295,S.g[0]=S.g[0]+v&4294967295,S.g[1]=S.g[1]+(E+(T<<21&4294967295|T>>>11))&4294967295,S.g[2]=S.g[2]+E&4294967295,S.g[3]=S.g[3]+N&4294967295}r.prototype.u=function(S,v){v===void 0&&(v=S.length);for(var b=v-this.blockSize,_=this.B,E=this.h,N=0;N<v;){if(E==0)for(;N<=b;)s(this,S,N),N+=this.blockSize;if(typeof S=="string"){for(;N<v;)if(_[E++]=S.charCodeAt(N++),E==this.blockSize){s(this,_),E=0;break}}else for(;N<v;)if(_[E++]=S[N++],E==this.blockSize){s(this,_),E=0;break}}this.h=E,this.o+=v},r.prototype.v=function(){var S=Array((56>this.h?this.blockSize:2*this.blockSize)-this.h);S[0]=128;for(var v=1;v<S.length-8;++v)S[v]=0;var b=8*this.o;for(v=S.length-8;v<S.length;++v)S[v]=b&255,b/=256;for(this.u(S),S=Array(16),v=b=0;4>v;++v)for(var _=0;32>_;_+=8)S[b++]=this.g[v]>>>_&255;return S};function i(S,v){var b=a;return Object.prototype.hasOwnProperty.call(b,S)?b[S]:b[S]=v(S)}function o(S,v){this.h=v;for(var b=[],_=!0,E=S.length-1;0<=E;E--){var N=S[E]|0;_&&N==v||(b[E]=N,_=!1)}this.g=b}var a={};function l(S){return-128<=S&&128>S?i(S,function(v){return new o([v|0],0>v?-1:0)}):new o([S|0],0>S?-1:0)}function u(S){if(isNaN(S)||!isFinite(S))return f;if(0>S)return M(u(-S));for(var v=[],b=1,_=0;S>=b;_++)v[_]=S/b|0,b*=4294967296;return new o(v,0)}function h(S,v){if(S.length==0)throw Error("number format error: empty string");if(v=v||10,2>v||36<v)throw Error("radix out of range: "+v);if(S.charAt(0)=="-")return M(h(S.substring(1),v));if(0<=S.indexOf("-"))throw Error('number format error: interior "-" character');for(var b=u(Math.pow(v,8)),_=f,E=0;E<S.length;E+=8){var N=Math.min(8,S.length-E),T=parseInt(S.substring(E,E+N),v);8>N?(N=u(Math.pow(v,N)),_=_.j(N).add(u(T))):(_=_.j(b),_=_.add(u(T)))}return _}var f=l(0),g=l(1),y=l(16777216);n=o.prototype,n.m=function(){if(C(this))return-M(this).m();for(var S=0,v=1,b=0;b<this.g.length;b++){var _=this.i(b);S+=(0<=_?_:4294967296+_)*v,v*=4294967296}return S},n.toString=function(S){if(S=S||10,2>S||36<S)throw Error("radix out of range: "+S);if(w(this))return"0";if(C(this))return"-"+M(this).toString(S);for(var v=u(Math.pow(S,6)),b=this,_="";;){var E=D(b,v).g;b=A(b,E.j(v));var N=((0<b.g.length?b.g[0]:b.h)>>>0).toString(S);if(b=E,w(b))return N+_;for(;6>N.length;)N="0"+N;_=N+_}},n.i=function(S){return 0>S?0:S<this.g.length?this.g[S]:this.h};function w(S){if(S.h!=0)return!1;for(var v=0;v<S.g.length;v++)if(S.g[v]!=0)return!1;return!0}function C(S){return S.h==-1}n.l=function(S){return S=A(this,S),C(S)?-1:w(S)?0:1};function M(S){for(var v=S.g.length,b=[],_=0;_<v;_++)b[_]=~S.g[_];return new o(b,~S.h).add(g)}n.abs=function(){return C(this)?M(this):this},n.add=function(S){for(var v=Math.max(this.g.length,S.g.length),b=[],_=0,E=0;E<=v;E++){var N=_+(this.i(E)&65535)+(S.i(E)&65535),T=(N>>>16)+(this.i(E)>>>16)+(S.i(E)>>>16);_=T>>>16,N&=65535,T&=65535,b[E]=T<<16|N}return new o(b,b[b.length-1]&-2147483648?-1:0)};function A(S,v){return S.add(M(v))}n.j=function(S){if(w(this)||w(S))return f;if(C(this))return C(S)?M(this).j(M(S)):M(M(this).j(S));if(C(S))return M(this.j(M(S)));if(0>this.l(y)&&0>S.l(y))return u(this.m()*S.m());for(var v=this.g.length+S.g.length,b=[],_=0;_<2*v;_++)b[_]=0;for(_=0;_<this.g.length;_++)for(var E=0;E<S.g.length;E++){var N=this.i(_)>>>16,T=this.i(_)&65535,K=S.i(E)>>>16,mt=S.i(E)&65535;b[2*_+2*E]+=T*mt,I(b,2*_+2*E),b[2*_+2*E+1]+=N*mt,I(b,2*_+2*E+1),b[2*_+2*E+1]+=T*K,I(b,2*_+2*E+1),b[2*_+2*E+2]+=N*K,I(b,2*_+2*E+2)}for(_=0;_<v;_++)b[_]=b[2*_+1]<<16|b[2*_];for(_=v;_<2*v;_++)b[_]=0;return new o(b,0)};function I(S,v){for(;(S[v]&65535)!=S[v];)S[v+1]+=S[v]>>>16,S[v]&=65535,v++}function R(S,v){this.g=S,this.h=v}function D(S,v){if(w(v))throw Error("division by zero");if(w(S))return new R(f,f);if(C(S))return v=D(M(S),v),new R(M(v.g),M(v.h));if(C(v))return v=D(S,M(v)),new R(M(v.g),v.h);if(30<S.g.length){if(C(S)||C(v))throw Error("slowDivide_ only works with positive integers.");for(var b=g,_=v;0>=_.l(S);)b=V(b),_=V(_);var E=P(b,1),N=P(_,1);for(_=P(_,2),b=P(b,2);!w(_);){var T=N.add(_);0>=T.l(S)&&(E=E.add(b),N=T),_=P(_,1),b=P(b,1)}return v=A(S,E.j(v)),new R(E,v)}for(E=f;0<=S.l(v);){for(b=Math.max(1,Math.floor(S.m()/v.m())),_=Math.ceil(Math.log(b)/Math.LN2),_=48>=_?1:Math.pow(2,_-48),N=u(b),T=N.j(v);C(T)||0<T.l(S);)b-=_,N=u(b),T=N.j(v);w(N)&&(N=g),E=E.add(N),S=A(S,T)}return new R(E,S)}n.A=function(S){return D(this,S).h},n.and=function(S){for(var v=Math.max(this.g.length,S.g.length),b=[],_=0;_<v;_++)b[_]=this.i(_)&S.i(_);return new o(b,this.h&S.h)},n.or=function(S){for(var v=Math.max(this.g.length,S.g.length),b=[],_=0;_<v;_++)b[_]=this.i(_)|S.i(_);return new o(b,this.h|S.h)},n.xor=function(S){for(var v=Math.max(this.g.length,S.g.length),b=[],_=0;_<v;_++)b[_]=this.i(_)^S.i(_);return new o(b,this.h^S.h)};function V(S){for(var v=S.g.length+1,b=[],_=0;_<v;_++)b[_]=S.i(_)<<1|S.i(_-1)>>>31;return new o(b,S.h)}function P(S,v){var b=v>>5;v%=32;for(var _=S.g.length-b,E=[],N=0;N<_;N++)E[N]=0<v?S.i(N+b)>>>v|S.i(N+b+1)<<32-v:S.i(N+b);return new o(E,S.h)}r.prototype.digest=r.prototype.v,r.prototype.reset=r.prototype.s,r.prototype.update=r.prototype.u,MR=r,o.prototype.add=o.prototype.add,o.prototype.multiply=o.prototype.j,o.prototype.modulo=o.prototype.A,o.prototype.compare=o.prototype.l,o.prototype.toNumber=o.prototype.m,o.prototype.toString=o.prototype.toString,o.prototype.getBits=o.prototype.i,o.fromNumber=u,o.fromString=h,_o=o}).apply(typeof bS<"u"?bS:typeof self<"u"?self:typeof window<"u"?window:{});var hf=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};/** @license
Copyright The Closure Library Authors.
SPDX-License-Identifier: Apache-2.0
*/var LR,bu,OR,jf,ov,VR,FR,jR;(function(){var n,e=typeof Object.defineProperties=="function"?Object.defineProperty:function(c,p,m){return c==Array.prototype||c==Object.prototype||(c[p]=m.value),c};function t(c){c=[typeof globalThis=="object"&&globalThis,c,typeof window=="object"&&window,typeof self=="object"&&self,typeof hf=="object"&&hf];for(var p=0;p<c.length;++p){var m=c[p];if(m&&m.Math==Math)return m}throw Error("Cannot find global object")}var r=t(this);function s(c,p){if(p)e:{var m=r;c=c.split(".");for(var x=0;x<c.length-1;x++){var L=c[x];if(!(L in m))break e;m=m[L]}c=c[c.length-1],x=m[c],p=p(x),p!=x&&p!=null&&e(m,c,{configurable:!0,writable:!0,value:p})}}function i(c,p){c instanceof String&&(c+="");var m=0,x=!1,L={next:function(){if(!x&&m<c.length){var B=m++;return{value:p(B,c[B]),done:!1}}return x=!0,{done:!0,value:void 0}}};return L[Symbol.iterator]=function(){return L},L}s("Array.prototype.values",function(c){return c||function(){return i(this,function(p,m){return m})}});/** @license

 Copyright The Closure Library Authors.
 SPDX-License-Identifier: Apache-2.0
*/var o=o||{},a=this||self;function l(c){var p=typeof c;return p=p!="object"?p:c?Array.isArray(c)?"array":p:"null",p=="array"||p=="object"&&typeof c.length=="number"}function u(c){var p=typeof c;return p=="object"&&c!=null||p=="function"}function h(c,p,m){return c.call.apply(c.bind,arguments)}function f(c,p,m){if(!c)throw Error();if(2<arguments.length){var x=Array.prototype.slice.call(arguments,2);return function(){var L=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(L,x),c.apply(p,L)}}return function(){return c.apply(p,arguments)}}function g(c,p,m){return g=Function.prototype.bind&&Function.prototype.bind.toString().indexOf("native code")!=-1?h:f,g.apply(null,arguments)}function y(c,p){var m=Array.prototype.slice.call(arguments,1);return function(){var x=m.slice();return x.push.apply(x,arguments),c.apply(this,x)}}function w(c,p){function m(){}m.prototype=p.prototype,c.aa=p.prototype,c.prototype=new m,c.prototype.constructor=c,c.Qb=function(x,L,B){for(var se=Array(arguments.length-2),Rt=2;Rt<arguments.length;Rt++)se[Rt-2]=arguments[Rt];return p.prototype[L].apply(x,se)}}function C(c){const p=c.length;if(0<p){const m=Array(p);for(let x=0;x<p;x++)m[x]=c[x];return m}return[]}function M(c,p){for(let m=1;m<arguments.length;m++){const x=arguments[m];if(l(x)){const L=c.length||0,B=x.length||0;c.length=L+B;for(let se=0;se<B;se++)c[L+se]=x[se]}else c.push(x)}}class A{constructor(p,m){this.i=p,this.j=m,this.h=0,this.g=null}get(){let p;return 0<this.h?(this.h--,p=this.g,this.g=p.next,p.next=null):p=this.i(),p}}function I(c){return/^[\s\xa0]*$/.test(c)}function R(){var c=a.navigator;return c&&(c=c.userAgent)?c:""}function D(c){return D[" "](c),c}D[" "]=function(){};var V=R().indexOf("Gecko")!=-1&&!(R().toLowerCase().indexOf("webkit")!=-1&&R().indexOf("Edge")==-1)&&!(R().indexOf("Trident")!=-1||R().indexOf("MSIE")!=-1)&&R().indexOf("Edge")==-1;function P(c,p,m){for(const x in c)p.call(m,c[x],x,c)}function S(c,p){for(const m in c)p.call(void 0,c[m],m,c)}function v(c){const p={};for(const m in c)p[m]=c[m];return p}const b="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function _(c,p){let m,x;for(let L=1;L<arguments.length;L++){x=arguments[L];for(m in x)c[m]=x[m];for(let B=0;B<b.length;B++)m=b[B],Object.prototype.hasOwnProperty.call(x,m)&&(c[m]=x[m])}}function E(c){var p=1;c=c.split(":");const m=[];for(;0<p&&c.length;)m.push(c.shift()),p--;return c.length&&m.push(c.join(":")),m}function N(c){a.setTimeout(()=>{throw c},0)}function T(){var c=$;let p=null;return c.g&&(p=c.g,c.g=c.g.next,c.g||(c.h=null),p.next=null),p}class K{constructor(){this.h=this.g=null}add(p,m){const x=mt.get();x.set(p,m),this.h?this.h.next=x:this.g=x,this.h=x}}var mt=new A(()=>new Me,c=>c.reset());class Me{constructor(){this.next=this.g=this.h=null}set(p,m){this.h=p,this.g=m,this.next=null}reset(){this.next=this.g=this.h=null}}let qt,k=!1,$=new K,Q=()=>{const c=a.Promise.resolve(void 0);qt=()=>{c.then(ee)}};var ee=()=>{for(var c;c=T();){try{c.h.call(c.g)}catch(m){N(m)}var p=mt;p.j(c),100>p.h&&(p.h++,c.next=p.g,p.g=c)}k=!1};function ie(){this.s=this.s,this.C=this.C}ie.prototype.s=!1,ie.prototype.ma=function(){this.s||(this.s=!0,this.N())},ie.prototype.N=function(){if(this.C)for(;this.C.length;)this.C.shift()()};function le(c,p){this.type=c,this.g=this.target=p,this.defaultPrevented=!1}le.prototype.h=function(){this.defaultPrevented=!0};var ce=function(){if(!a.addEventListener||!Object.defineProperty)return!1;var c=!1,p=Object.defineProperty({},"passive",{get:function(){c=!0}});try{const m=()=>{};a.addEventListener("test",m,p),a.removeEventListener("test",m,p)}catch{}return c}();function Ae(c,p){if(le.call(this,c?c.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,c){var m=this.type=c.type,x=c.changedTouches&&c.changedTouches.length?c.changedTouches[0]:null;if(this.target=c.target||c.srcElement,this.g=p,p=c.relatedTarget){if(V){e:{try{D(p.nodeName);var L=!0;break e}catch{}L=!1}L||(p=null)}}else m=="mouseover"?p=c.fromElement:m=="mouseout"&&(p=c.toElement);this.relatedTarget=p,x?(this.clientX=x.clientX!==void 0?x.clientX:x.pageX,this.clientY=x.clientY!==void 0?x.clientY:x.pageY,this.screenX=x.screenX||0,this.screenY=x.screenY||0):(this.clientX=c.clientX!==void 0?c.clientX:c.pageX,this.clientY=c.clientY!==void 0?c.clientY:c.pageY,this.screenX=c.screenX||0,this.screenY=c.screenY||0),this.button=c.button,this.key=c.key||"",this.ctrlKey=c.ctrlKey,this.altKey=c.altKey,this.shiftKey=c.shiftKey,this.metaKey=c.metaKey,this.pointerId=c.pointerId||0,this.pointerType=typeof c.pointerType=="string"?c.pointerType:$e[c.pointerType]||"",this.state=c.state,this.i=c,c.defaultPrevented&&Ae.aa.h.call(this)}}w(Ae,le);var $e={2:"touch",3:"pen",4:"mouse"};Ae.prototype.h=function(){Ae.aa.h.call(this);var c=this.i;c.preventDefault?c.preventDefault():c.returnValue=!1};var xe="closure_listenable_"+(1e6*Math.random()|0),te=0;function de(c,p,m,x,L){this.listener=c,this.proxy=null,this.src=p,this.type=m,this.capture=!!x,this.ha=L,this.key=++te,this.da=this.fa=!1}function Ee(c){c.da=!0,c.listener=null,c.proxy=null,c.src=null,c.ha=null}function H(c){this.src=c,this.g={},this.h=0}H.prototype.add=function(c,p,m,x,L){var B=c.toString();c=this.g[B],c||(c=this.g[B]=[],this.h++);var se=He(c,p,x,L);return-1<se?(p=c[se],m||(p.fa=!1)):(p=new de(p,this.src,B,!!x,L),p.fa=m,c.push(p)),p};function ve(c,p){var m=p.type;if(m in c.g){var x=c.g[m],L=Array.prototype.indexOf.call(x,p,void 0),B;(B=0<=L)&&Array.prototype.splice.call(x,L,1),B&&(Ee(p),c.g[m].length==0&&(delete c.g[m],c.h--))}}function He(c,p,m,x){for(var L=0;L<c.length;++L){var B=c[L];if(!B.da&&B.listener==p&&B.capture==!!m&&B.ha==x)return L}return-1}var oe="closure_lm_"+(1e6*Math.random()|0),Ce={};function qe(c,p,m,x,L){if(x&&x.once)return De(c,p,m,x,L);if(Array.isArray(p)){for(var B=0;B<p.length;B++)qe(c,p[B],m,x,L);return null}return m=nt(m),c&&c[xe]?c.K(p,m,u(x)?!!x.capture:!!x,L):Oe(c,p,m,!1,x,L)}function Oe(c,p,m,x,L,B){if(!p)throw Error("Invalid event type");var se=u(L)?!!L.capture:!!L,Rt=Be(c);if(Rt||(c[oe]=Rt=new H(c)),m=Rt.add(p,m,x,se,B),m.proxy)return m;if(x=he(),m.proxy=x,x.src=c,x.listener=m,c.addEventListener)ce||(L=se),L===void 0&&(L=!1),c.addEventListener(p.toString(),x,L);else if(c.attachEvent)c.attachEvent(yt(p.toString()),x);else if(c.addListener&&c.removeListener)c.addListener(x);else throw Error("addEventListener and attachEvent are unavailable.");return m}function he(){function c(m){return p.call(c.src,c.listener,m)}const p=vt;return c}function De(c,p,m,x,L){if(Array.isArray(p)){for(var B=0;B<p.length;B++)De(c,p[B],m,x,L);return null}return m=nt(m),c&&c[xe]?c.L(p,m,u(x)?!!x.capture:!!x,L):Oe(c,p,m,!0,x,L)}function Ke(c,p,m,x,L){if(Array.isArray(p))for(var B=0;B<p.length;B++)Ke(c,p[B],m,x,L);else x=u(x)?!!x.capture:!!x,m=nt(m),c&&c[xe]?(c=c.i,p=String(p).toString(),p in c.g&&(B=c.g[p],m=He(B,m,x,L),-1<m&&(Ee(B[m]),Array.prototype.splice.call(B,m,1),B.length==0&&(delete c.g[p],c.h--)))):c&&(c=Be(c))&&(p=c.g[p.toString()],c=-1,p&&(c=He(p,m,x,L)),(m=-1<c?p[c]:null)&&Tt(m))}function Tt(c){if(typeof c!="number"&&c&&!c.da){var p=c.src;if(p&&p[xe])ve(p.i,c);else{var m=c.type,x=c.proxy;p.removeEventListener?p.removeEventListener(m,x,c.capture):p.detachEvent?p.detachEvent(yt(m),x):p.addListener&&p.removeListener&&p.removeListener(x),(m=Be(p))?(ve(m,c),m.h==0&&(m.src=null,p[oe]=null)):Ee(c)}}}function yt(c){return c in Ce?Ce[c]:Ce[c]="on"+c}function vt(c,p){if(c.da)c=!0;else{p=new Ae(p,this);var m=c.listener,x=c.ha||c.src;c.fa&&Tt(c),c=m.call(x,p)}return c}function Be(c){return c=c[oe],c instanceof H?c:null}var _t="__closure_events_fn_"+(1e9*Math.random()>>>0);function nt(c){return typeof c=="function"?c:(c[_t]||(c[_t]=function(p){return c.handleEvent(p)}),c[_t])}function Te(){ie.call(this),this.i=new H(this),this.M=this,this.F=null}w(Te,ie),Te.prototype[xe]=!0,Te.prototype.removeEventListener=function(c,p,m,x){Ke(this,c,p,m,x)};function rt(c,p){var m,x=c.F;if(x)for(m=[];x;x=x.F)m.push(x);if(c=c.M,x=p.type||p,typeof p=="string")p=new le(p,c);else if(p instanceof le)p.target=p.target||c;else{var L=p;p=new le(x,c),_(p,L)}if(L=!0,m)for(var B=m.length-1;0<=B;B--){var se=p.g=m[B];L=Wt(se,x,!0,p)&&L}if(se=p.g=c,L=Wt(se,x,!0,p)&&L,L=Wt(se,x,!1,p)&&L,m)for(B=0;B<m.length;B++)se=p.g=m[B],L=Wt(se,x,!1,p)&&L}Te.prototype.N=function(){if(Te.aa.N.call(this),this.i){var c=this.i,p;for(p in c.g){for(var m=c.g[p],x=0;x<m.length;x++)Ee(m[x]);delete c.g[p],c.h--}}this.F=null},Te.prototype.K=function(c,p,m,x){return this.i.add(String(c),p,!1,m,x)},Te.prototype.L=function(c,p,m,x){return this.i.add(String(c),p,!0,m,x)};function Wt(c,p,m,x){if(p=c.i.g[String(p)],!p)return!0;p=p.concat();for(var L=!0,B=0;B<p.length;++B){var se=p[B];if(se&&!se.da&&se.capture==m){var Rt=se.listener,Fn=se.ha||se.src;se.fa&&ve(c.i,se),L=Rt.call(Fn,x)!==!1&&L}}return L&&!x.defaultPrevented}function rn(c,p,m){if(typeof c=="function")m&&(c=g(c,m));else if(c&&typeof c.handleEvent=="function")c=g(c.handleEvent,c);else throw Error("Invalid listener argument");return 2147483647<Number(p)?-1:a.setTimeout(c,p||0)}function Sn(c){c.g=rn(()=>{c.g=null,c.i&&(c.i=!1,Sn(c))},c.l);const p=c.h;c.h=null,c.m.apply(null,p)}class dr extends ie{constructor(p,m){super(),this.m=p,this.l=m,this.h=null,this.i=!1,this.g=null}j(p){this.h=arguments,this.g?this.i=!0:Sn(this)}N(){super.N(),this.g&&(a.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function Wn(c){ie.call(this),this.h=c,this.g={}}w(Wn,ie);var it=[];function Vt(c){P(c.g,function(p,m){this.g.hasOwnProperty(m)&&Tt(p)},c),c.g={}}Wn.prototype.N=function(){Wn.aa.N.call(this),Vt(this)},Wn.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var br=a.JSON.stringify,Wo=a.JSON.parse,Gr=class{stringify(c){return a.JSON.stringify(c,void 0)}parse(c){return a.JSON.parse(c,void 0)}};function at(){}at.prototype.h=null;function lt(c){return c.h||(c.h=c.i())}function Tn(){}var On={OPEN:"a",kb:"b",Ja:"c",wb:"d"};function Ys(){le.call(this,"d")}w(Ys,le);function Ts(){le.call(this,"c")}w(Ts,le);var is={},Di=null;function F(){return Di=Di||new Te}is.La="serverreachability";function Y(c){le.call(this,is.La,c)}w(Y,le);function G(c){const p=F();rt(p,new Y(p))}is.STAT_EVENT="statevent";function fe(c,p){le.call(this,is.STAT_EVENT,c),this.stat=p}w(fe,le);function _e(c){const p=F();rt(p,new fe(p,c))}is.Ma="timingevent";function ze(c,p){le.call(this,is.Ma,c),this.size=p}w(ze,le);function Se(c,p){if(typeof c!="function")throw Error("Fn must not be null and must be a function");return a.setTimeout(function(){c()},p)}function Re(){this.g=!0}Re.prototype.xa=function(){this.g=!1};function Ve(c,p,m,x,L,B){c.info(function(){if(c.g)if(B)for(var se="",Rt=B.split("&"),Fn=0;Fn<Rt.length;Fn++){var ft=Rt[Fn].split("=");if(1<ft.length){var Hn=ft[0];ft=ft[1];var Kn=Hn.split("_");se=2<=Kn.length&&Kn[1]=="type"?se+(Hn+"="+ft+"&"):se+(Hn+"=redacted&")}}else se=null;else se=B;return"XMLHTTP REQ ("+x+") [attempt "+L+"]: "+p+`
`+m+`
`+se})}function bt(c,p,m,x,L,B,se){c.info(function(){return"XMLHTTP RESP ("+x+") [ attempt "+L+"]: "+p+`
`+m+`
`+B+" "+se})}function Le(c,p,m,x){c.info(function(){return"XMLHTTP TEXT ("+p+"): "+Qe(c,m)+(x?" "+x:"")})}function Ue(c,p){c.info(function(){return"TIMEOUT: "+p})}Re.prototype.info=function(){};function Qe(c,p){if(!c.g)return p;if(!p)return null;try{var m=JSON.parse(p);if(m){for(c=0;c<m.length;c++)if(Array.isArray(m[c])){var x=m[c];if(!(2>x.length)){var L=x[1];if(Array.isArray(L)&&!(1>L.length)){var B=L[0];if(B!="noop"&&B!="stop"&&B!="close")for(var se=1;se<L.length;se++)L[se]=""}}}}return br(m)}catch{return p}}var me={NO_ERROR:0,gb:1,tb:2,sb:3,nb:4,rb:5,ub:6,Ia:7,TIMEOUT:8,xb:9},we={lb:"complete",Hb:"success",Ja:"error",Ia:"abort",zb:"ready",Ab:"readystatechange",TIMEOUT:"timeout",vb:"incrementaldata",yb:"progress",ob:"downloadprogress",Pb:"uploadprogress"},ke;function dt(){}w(dt,at),dt.prototype.g=function(){return new XMLHttpRequest},dt.prototype.i=function(){return{}},ke=new dt;function ht(c,p,m,x){this.j=c,this.i=p,this.l=m,this.R=x||1,this.U=new Wn(this),this.I=45e3,this.H=null,this.o=!1,this.m=this.A=this.v=this.L=this.F=this.S=this.B=null,this.D=[],this.g=null,this.C=0,this.s=this.u=null,this.X=-1,this.J=!1,this.O=0,this.M=null,this.W=this.K=this.T=this.P=!1,this.h=new _n}function _n(){this.i=null,this.g="",this.h=!1}var Ct={},Xe={};function Gn(c,p,m){c.L=1,c.v=Vh(Zs(p)),c.m=m,c.P=!0,bs(c,null)}function bs(c,p){c.F=Date.now(),Pt(c),c.A=Zs(c.v);var m=c.A,x=c.R;Array.isArray(x)||(x=[String(x)]),sI(m.i,"t",x),c.C=0,m=c.j.J,c.h=new _n,c.g=II(c.j,m?p:null,!c.m),0<c.O&&(c.M=new dr(g(c.Y,c,c.g),c.O)),p=c.U,m=c.g,x=c.ca;var L="readystatechange";Array.isArray(L)||(L&&(it[0]=L.toString()),L=it);for(var B=0;B<L.length;B++){var se=qe(m,L[B],x||p.handleEvent,!1,p.h||p);if(!se)break;p.g[se.key]=se}p=c.H?v(c.H):{},c.m?(c.u||(c.u="POST"),p["Content-Type"]="application/x-www-form-urlencoded",c.g.ea(c.A,c.u,c.m,p)):(c.u="GET",c.g.ea(c.A,c.u,null,p)),G(),Ve(c.i,c.u,c.A,c.l,c.R,c.m)}ht.prototype.ca=function(c){c=c.target;const p=this.M;p&&ei(c)==3?p.j():this.Y(c)},ht.prototype.Y=function(c){try{if(c==this.g)e:{const Kn=ei(this.g);var p=this.g.Ba();const ol=this.g.Z();if(!(3>Kn)&&(Kn!=3||this.g&&(this.h.h||this.g.oa()||dI(this.g)))){this.J||Kn!=4||p==7||(p==8||0>=ol?G(3):G(2)),cn(this);var m=this.g.Z();this.X=m;t:if(Vn(this)){var x=dI(this.g);c="";var L=x.length,B=ei(this.g)==4;if(!this.h.i){if(typeof TextDecoder>"u"){Ar(this),sr(this);var se="";break t}this.h.i=new a.TextDecoder}for(p=0;p<L;p++)this.h.h=!0,c+=this.h.i.decode(x[p],{stream:!(B&&p==L-1)});x.length=0,this.h.g+=c,this.C=0,se=this.h.g}else se=this.g.oa();if(this.o=m==200,bt(this.i,this.u,this.A,this.l,this.R,Kn,m),this.o){if(this.T&&!this.K){t:{if(this.g){var Rt,Fn=this.g;if((Rt=Fn.g?Fn.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!I(Rt)){var ft=Rt;break t}}ft=null}if(m=ft)Le(this.i,this.l,m,"Initial handshake response via X-HTTP-Initial-Response"),this.K=!0,As(this,m);else{this.o=!1,this.s=3,_e(12),Ar(this),sr(this);break e}}if(this.P){m=!0;let os;for(;!this.J&&this.C<se.length;)if(os=wt(this,se),os==Xe){Kn==4&&(this.s=4,_e(14),m=!1),Le(this.i,this.l,null,"[Incomplete Response]");break}else if(os==Ct){this.s=4,_e(15),Le(this.i,this.l,se,"[Invalid Chunk]"),m=!1;break}else Le(this.i,this.l,os,null),As(this,os);if(Vn(this)&&this.C!=0&&(this.h.g=this.h.g.slice(this.C),this.C=0),Kn!=4||se.length!=0||this.h.h||(this.s=1,_e(16),m=!1),this.o=this.o&&m,!m)Le(this.i,this.l,se,"[Invalid Chunked Response]"),Ar(this),sr(this);else if(0<se.length&&!this.W){this.W=!0;var Hn=this.j;Hn.g==this&&Hn.ba&&!Hn.M&&(Hn.j.info("Great, no buffering proxy detected. Bytes received: "+se.length),jm(Hn),Hn.M=!0,_e(11))}}else Le(this.i,this.l,se,null),As(this,se);Kn==4&&Ar(this),this.o&&!this.J&&(Kn==4?_I(this.j,this):(this.o=!1,Pt(this)))}else s2(this.g),m==400&&0<se.indexOf("Unknown SID")?(this.s=3,_e(12)):(this.s=0,_e(13)),Ar(this),sr(this)}}}catch{}finally{}};function Vn(c){return c.g?c.u=="GET"&&c.L!=2&&c.j.Ca:!1}function wt(c,p){var m=c.C,x=p.indexOf(`
`,m);return x==-1?Xe:(m=Number(p.substring(m,x)),isNaN(m)?Ct:(x+=1,x+m>p.length?Xe:(p=p.slice(x,x+m),c.C=x+m,p)))}ht.prototype.cancel=function(){this.J=!0,Ar(this)};function Pt(c){c.S=Date.now()+c.I,hr(c,c.I)}function hr(c,p){if(c.B!=null)throw Error("WatchDog timer not null");c.B=Se(g(c.ba,c),p)}function cn(c){c.B&&(a.clearTimeout(c.B),c.B=null)}ht.prototype.ba=function(){this.B=null;const c=Date.now();0<=c-this.S?(Ue(this.i,this.A),this.L!=2&&(G(),_e(17)),Ar(this),this.s=2,sr(this)):hr(this,this.S-c)};function sr(c){c.j.G==0||c.J||_I(c.j,c)}function Ar(c){cn(c);var p=c.M;p&&typeof p.ma=="function"&&p.ma(),c.M=null,Vt(c.U),c.g&&(p=c.g,c.g=null,p.abort(),p.ma())}function As(c,p){try{var m=c.j;if(m.G!=0&&(m.g==c||Go(m.h,c))){if(!c.K&&Go(m.h,c)&&m.G==3){try{var x=m.Da.g.parse(p)}catch{x=null}if(Array.isArray(x)&&x.length==3){var L=x;if(L[0]==0){e:if(!m.u){if(m.g)if(m.g.F+3e3<c.F)zh(m),$h(m);else break e;Fm(m),_e(18)}}else m.za=L[1],0<m.za-m.T&&37500>L[2]&&m.F&&m.v==0&&!m.C&&(m.C=Se(g(m.Za,m),6e3));if(1>=Js(m.h)&&m.ca){try{m.ca()}catch{}m.ca=void 0}}else Ko(m,11)}else if((c.K||m.g==c)&&zh(m),!I(p))for(L=m.Da.g.parse(p),p=0;p<L.length;p++){let ft=L[p];if(m.T=ft[0],ft=ft[1],m.G==2)if(ft[0]=="c"){m.K=ft[1],m.ia=ft[2];const Hn=ft[3];Hn!=null&&(m.la=Hn,m.j.info("VER="+m.la));const Kn=ft[4];Kn!=null&&(m.Aa=Kn,m.j.info("SVER="+m.Aa));const ol=ft[5];ol!=null&&typeof ol=="number"&&0<ol&&(x=1.5*ol,m.L=x,m.j.info("backChannelRequestTimeoutMs_="+x)),x=m;const os=c.g;if(os){const Wh=os.g?os.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(Wh){var B=x.h;B.g||Wh.indexOf("spdy")==-1&&Wh.indexOf("quic")==-1&&Wh.indexOf("h2")==-1||(B.j=B.l,B.g=new Set,B.h&&(Xs(B,B.h),B.h=null))}if(x.D){const Um=os.g?os.g.getResponseHeader("X-HTTP-Session-Id"):null;Um&&(x.ya=Um,Ft(x.I,x.D,Um))}}m.G=3,m.l&&m.l.ua(),m.ba&&(m.R=Date.now()-c.F,m.j.info("Handshake RTT: "+m.R+"ms")),x=m;var se=c;if(x.qa=xI(x,x.J?x.ia:null,x.W),se.K){Yx(x.h,se);var Rt=se,Fn=x.L;Fn&&(Rt.I=Fn),Rt.B&&(cn(Rt),Pt(Rt)),x.g=se}else mI(x);0<m.i.length&&Bh(m)}else ft[0]!="stop"&&ft[0]!="close"||Ko(m,7);else m.G==3&&(ft[0]=="stop"||ft[0]=="close"?ft[0]=="stop"?Ko(m,7):Vm(m):ft[0]!="noop"&&m.l&&m.l.ta(ft),m.v=0)}}G(4)}catch{}}var Mi=class{constructor(c,p){this.g=c,this.map=p}};function fr(c){this.l=c||10,a.PerformanceNavigationTiming?(c=a.performance.getEntriesByType("navigation"),c=0<c.length&&(c[0].nextHopProtocol=="hq"||c[0].nextHopProtocol=="h2")):c=!!(a.chrome&&a.chrome.loadTimes&&a.chrome.loadTimes()&&a.chrome.loadTimes().wasFetchedViaSpdy),this.j=c?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}function fn(c){return c.h?!0:c.g?c.g.size>=c.j:!1}function Js(c){return c.h?1:c.g?c.g.size:0}function Go(c,p){return c.h?c.h==p:c.g?c.g.has(p):!1}function Xs(c,p){c.g?c.g.add(p):c.h=p}function Yx(c,p){c.h&&c.h==p?c.h=null:c.g&&c.g.has(p)&&c.g.delete(p)}fr.prototype.cancel=function(){if(this.i=Jx(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&this.g.size!==0){for(const c of this.g.values())c.cancel();this.g.clear()}};function Jx(c){if(c.h!=null)return c.i.concat(c.h.D);if(c.g!=null&&c.g.size!==0){let p=c.i;for(const m of c.g.values())p=p.concat(m.D);return p}return C(c.i)}function zD(c){if(c.V&&typeof c.V=="function")return c.V();if(typeof Map<"u"&&c instanceof Map||typeof Set<"u"&&c instanceof Set)return Array.from(c.values());if(typeof c=="string")return c.split("");if(l(c)){for(var p=[],m=c.length,x=0;x<m;x++)p.push(c[x]);return p}p=[],m=0;for(x in c)p[m++]=c[x];return p}function qD(c){if(c.na&&typeof c.na=="function")return c.na();if(!c.V||typeof c.V!="function"){if(typeof Map<"u"&&c instanceof Map)return Array.from(c.keys());if(!(typeof Set<"u"&&c instanceof Set)){if(l(c)||typeof c=="string"){var p=[];c=c.length;for(var m=0;m<c;m++)p.push(m);return p}p=[],m=0;for(const x in c)p[m++]=x;return p}}}function Xx(c,p){if(c.forEach&&typeof c.forEach=="function")c.forEach(p,void 0);else if(l(c)||typeof c=="string")Array.prototype.forEach.call(c,p,void 0);else for(var m=qD(c),x=zD(c),L=x.length,B=0;B<L;B++)p.call(void 0,x[B],m&&m[B],c)}var Zx=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function WD(c,p){if(c){c=c.split("&");for(var m=0;m<c.length;m++){var x=c[m].indexOf("="),L=null;if(0<=x){var B=c[m].substring(0,x);L=c[m].substring(x+1)}else B=c[m];p(B,L?decodeURIComponent(L.replace(/\+/g," ")):"")}}}function Ho(c){if(this.g=this.o=this.j="",this.s=null,this.m=this.l="",this.h=!1,c instanceof Ho){this.h=c.h,Lh(this,c.j),this.o=c.o,this.g=c.g,Oh(this,c.s),this.l=c.l;var p=c.i,m=new Yc;m.i=p.i,p.g&&(m.g=new Map(p.g),m.h=p.h),eI(this,m),this.m=c.m}else c&&(p=String(c).match(Zx))?(this.h=!1,Lh(this,p[1]||"",!0),this.o=Kc(p[2]||""),this.g=Kc(p[3]||"",!0),Oh(this,p[4]),this.l=Kc(p[5]||"",!0),eI(this,p[6]||"",!0),this.m=Kc(p[7]||"")):(this.h=!1,this.i=new Yc(null,this.h))}Ho.prototype.toString=function(){var c=[],p=this.j;p&&c.push(Qc(p,tI,!0),":");var m=this.g;return(m||p=="file")&&(c.push("//"),(p=this.o)&&c.push(Qc(p,tI,!0),"@"),c.push(encodeURIComponent(String(m)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),m=this.s,m!=null&&c.push(":",String(m))),(m=this.l)&&(this.g&&m.charAt(0)!="/"&&c.push("/"),c.push(Qc(m,m.charAt(0)=="/"?KD:HD,!0))),(m=this.i.toString())&&c.push("?",m),(m=this.m)&&c.push("#",Qc(m,YD)),c.join("")};function Zs(c){return new Ho(c)}function Lh(c,p,m){c.j=m?Kc(p,!0):p,c.j&&(c.j=c.j.replace(/:$/,""))}function Oh(c,p){if(p){if(p=Number(p),isNaN(p)||0>p)throw Error("Bad port number "+p);c.s=p}else c.s=null}function eI(c,p,m){p instanceof Yc?(c.i=p,JD(c.i,c.h)):(m||(p=Qc(p,QD)),c.i=new Yc(p,c.h))}function Ft(c,p,m){c.i.set(p,m)}function Vh(c){return Ft(c,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),c}function Kc(c,p){return c?p?decodeURI(c.replace(/%25/g,"%2525")):decodeURIComponent(c):""}function Qc(c,p,m){return typeof c=="string"?(c=encodeURI(c).replace(p,GD),m&&(c=c.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),c):null}function GD(c){return c=c.charCodeAt(0),"%"+(c>>4&15).toString(16)+(c&15).toString(16)}var tI=/[#\/\?@]/g,HD=/[#\?:]/g,KD=/[#\?]/g,QD=/[#\?@]/g,YD=/#/g;function Yc(c,p){this.h=this.g=null,this.i=c||null,this.j=!!p}function Li(c){c.g||(c.g=new Map,c.h=0,c.i&&WD(c.i,function(p,m){c.add(decodeURIComponent(p.replace(/\+/g," ")),m)}))}n=Yc.prototype,n.add=function(c,p){Li(this),this.i=null,c=sl(this,c);var m=this.g.get(c);return m||this.g.set(c,m=[]),m.push(p),this.h+=1,this};function nI(c,p){Li(c),p=sl(c,p),c.g.has(p)&&(c.i=null,c.h-=c.g.get(p).length,c.g.delete(p))}function rI(c,p){return Li(c),p=sl(c,p),c.g.has(p)}n.forEach=function(c,p){Li(this),this.g.forEach(function(m,x){m.forEach(function(L){c.call(p,L,x,this)},this)},this)},n.na=function(){Li(this);const c=Array.from(this.g.values()),p=Array.from(this.g.keys()),m=[];for(let x=0;x<p.length;x++){const L=c[x];for(let B=0;B<L.length;B++)m.push(p[x])}return m},n.V=function(c){Li(this);let p=[];if(typeof c=="string")rI(this,c)&&(p=p.concat(this.g.get(sl(this,c))));else{c=Array.from(this.g.values());for(let m=0;m<c.length;m++)p=p.concat(c[m])}return p},n.set=function(c,p){return Li(this),this.i=null,c=sl(this,c),rI(this,c)&&(this.h-=this.g.get(c).length),this.g.set(c,[p]),this.h+=1,this},n.get=function(c,p){return c?(c=this.V(c),0<c.length?String(c[0]):p):p};function sI(c,p,m){nI(c,p),0<m.length&&(c.i=null,c.g.set(sl(c,p),C(m)),c.h+=m.length)}n.toString=function(){if(this.i)return this.i;if(!this.g)return"";const c=[],p=Array.from(this.g.keys());for(var m=0;m<p.length;m++){var x=p[m];const B=encodeURIComponent(String(x)),se=this.V(x);for(x=0;x<se.length;x++){var L=B;se[x]!==""&&(L+="="+encodeURIComponent(String(se[x]))),c.push(L)}}return this.i=c.join("&")};function sl(c,p){return p=String(p),c.j&&(p=p.toLowerCase()),p}function JD(c,p){p&&!c.j&&(Li(c),c.i=null,c.g.forEach(function(m,x){var L=x.toLowerCase();x!=L&&(nI(this,x),sI(this,L,m))},c)),c.j=p}function XD(c,p){const m=new Re;if(a.Image){const x=new Image;x.onload=y(Oi,m,"TestLoadImage: loaded",!0,p,x),x.onerror=y(Oi,m,"TestLoadImage: error",!1,p,x),x.onabort=y(Oi,m,"TestLoadImage: abort",!1,p,x),x.ontimeout=y(Oi,m,"TestLoadImage: timeout",!1,p,x),a.setTimeout(function(){x.ontimeout&&x.ontimeout()},1e4),x.src=c}else p(!1)}function ZD(c,p){const m=new Re,x=new AbortController,L=setTimeout(()=>{x.abort(),Oi(m,"TestPingServer: timeout",!1,p)},1e4);fetch(c,{signal:x.signal}).then(B=>{clearTimeout(L),B.ok?Oi(m,"TestPingServer: ok",!0,p):Oi(m,"TestPingServer: server error",!1,p)}).catch(()=>{clearTimeout(L),Oi(m,"TestPingServer: error",!1,p)})}function Oi(c,p,m,x,L){try{L&&(L.onload=null,L.onerror=null,L.onabort=null,L.ontimeout=null),x(m)}catch{}}function e2(){this.g=new Gr}function t2(c,p,m){const x=m||"";try{Xx(c,function(L,B){let se=L;u(L)&&(se=br(L)),p.push(x+B+"="+encodeURIComponent(se))})}catch(L){throw p.push(x+"type="+encodeURIComponent("_badmap")),L}}function Fh(c){this.l=c.Ub||null,this.j=c.eb||!1}w(Fh,at),Fh.prototype.g=function(){return new jh(this.l,this.j)},Fh.prototype.i=function(c){return function(){return c}}({});function jh(c,p){Te.call(this),this.D=c,this.o=p,this.m=void 0,this.status=this.readyState=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.u=new Headers,this.h=null,this.B="GET",this.A="",this.g=!1,this.v=this.j=this.l=null}w(jh,Te),n=jh.prototype,n.open=function(c,p){if(this.readyState!=0)throw this.abort(),Error("Error reopening a connection");this.B=c,this.A=p,this.readyState=1,Xc(this)},n.send=function(c){if(this.readyState!=1)throw this.abort(),Error("need to call open() first. ");this.g=!0;const p={headers:this.u,method:this.B,credentials:this.m,cache:void 0};c&&(p.body=c),(this.D||a).fetch(new Request(this.A,p)).then(this.Sa.bind(this),this.ga.bind(this))},n.abort=function(){this.response=this.responseText="",this.u=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),1<=this.readyState&&this.g&&this.readyState!=4&&(this.g=!1,Jc(this)),this.readyState=0},n.Sa=function(c){if(this.g&&(this.l=c,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=c.headers,this.readyState=2,Xc(this)),this.g&&(this.readyState=3,Xc(this),this.g)))if(this.responseType==="arraybuffer")c.arrayBuffer().then(this.Qa.bind(this),this.ga.bind(this));else if(typeof a.ReadableStream<"u"&&"body"in c){if(this.j=c.body.getReader(),this.o){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.v=new TextDecoder;iI(this)}else c.text().then(this.Ra.bind(this),this.ga.bind(this))};function iI(c){c.j.read().then(c.Pa.bind(c)).catch(c.ga.bind(c))}n.Pa=function(c){if(this.g){if(this.o&&c.value)this.response.push(c.value);else if(!this.o){var p=c.value?c.value:new Uint8Array(0);(p=this.v.decode(p,{stream:!c.done}))&&(this.response=this.responseText+=p)}c.done?Jc(this):Xc(this),this.readyState==3&&iI(this)}},n.Ra=function(c){this.g&&(this.response=this.responseText=c,Jc(this))},n.Qa=function(c){this.g&&(this.response=c,Jc(this))},n.ga=function(){this.g&&Jc(this)};function Jc(c){c.readyState=4,c.l=null,c.j=null,c.v=null,Xc(c)}n.setRequestHeader=function(c,p){this.u.append(c,p)},n.getResponseHeader=function(c){return this.h&&this.h.get(c.toLowerCase())||""},n.getAllResponseHeaders=function(){if(!this.h)return"";const c=[],p=this.h.entries();for(var m=p.next();!m.done;)m=m.value,c.push(m[0]+": "+m[1]),m=p.next();return c.join(`\r
`)};function Xc(c){c.onreadystatechange&&c.onreadystatechange.call(c)}Object.defineProperty(jh.prototype,"withCredentials",{get:function(){return this.m==="include"},set:function(c){this.m=c?"include":"same-origin"}});function oI(c){let p="";return P(c,function(m,x){p+=x,p+=":",p+=m,p+=`\r
`}),p}function Om(c,p,m){e:{for(x in m){var x=!1;break e}x=!0}x||(m=oI(m),typeof c=="string"?m!=null&&encodeURIComponent(String(m)):Ft(c,p,m))}function sn(c){Te.call(this),this.headers=new Map,this.o=c||null,this.h=!1,this.v=this.g=null,this.D="",this.m=0,this.l="",this.j=this.B=this.u=this.A=!1,this.I=null,this.H="",this.J=!1}w(sn,Te);var n2=/^https?$/i,r2=["POST","PUT"];n=sn.prototype,n.Ha=function(c){this.J=c},n.ea=function(c,p,m,x){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.D+"; newUri="+c);p=p?p.toUpperCase():"GET",this.D=c,this.l="",this.m=0,this.A=!1,this.h=!0,this.g=this.o?this.o.g():ke.g(),this.v=this.o?lt(this.o):lt(ke),this.g.onreadystatechange=g(this.Ea,this);try{this.B=!0,this.g.open(p,String(c),!0),this.B=!1}catch(B){aI(this,B);return}if(c=m||"",m=new Map(this.headers),x)if(Object.getPrototypeOf(x)===Object.prototype)for(var L in x)m.set(L,x[L]);else if(typeof x.keys=="function"&&typeof x.get=="function")for(const B of x.keys())m.set(B,x.get(B));else throw Error("Unknown input type for opt_headers: "+String(x));x=Array.from(m.keys()).find(B=>B.toLowerCase()=="content-type"),L=a.FormData&&c instanceof a.FormData,!(0<=Array.prototype.indexOf.call(r2,p,void 0))||x||L||m.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(const[B,se]of m)this.g.setRequestHeader(B,se);this.H&&(this.g.responseType=this.H),"withCredentials"in this.g&&this.g.withCredentials!==this.J&&(this.g.withCredentials=this.J);try{uI(this),this.u=!0,this.g.send(c),this.u=!1}catch(B){aI(this,B)}};function aI(c,p){c.h=!1,c.g&&(c.j=!0,c.g.abort(),c.j=!1),c.l=p,c.m=5,lI(c),Uh(c)}function lI(c){c.A||(c.A=!0,rt(c,"complete"),rt(c,"error"))}n.abort=function(c){this.g&&this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1,this.m=c||7,rt(this,"complete"),rt(this,"abort"),Uh(this))},n.N=function(){this.g&&(this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1),Uh(this,!0)),sn.aa.N.call(this)},n.Ea=function(){this.s||(this.B||this.u||this.j?cI(this):this.bb())},n.bb=function(){cI(this)};function cI(c){if(c.h&&typeof o<"u"&&(!c.v[1]||ei(c)!=4||c.Z()!=2)){if(c.u&&ei(c)==4)rn(c.Ea,0,c);else if(rt(c,"readystatechange"),ei(c)==4){c.h=!1;try{const se=c.Z();e:switch(se){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var p=!0;break e;default:p=!1}var m;if(!(m=p)){var x;if(x=se===0){var L=String(c.D).match(Zx)[1]||null;!L&&a.self&&a.self.location&&(L=a.self.location.protocol.slice(0,-1)),x=!n2.test(L?L.toLowerCase():"")}m=x}if(m)rt(c,"complete"),rt(c,"success");else{c.m=6;try{var B=2<ei(c)?c.g.statusText:""}catch{B=""}c.l=B+" ["+c.Z()+"]",lI(c)}}finally{Uh(c)}}}}function Uh(c,p){if(c.g){uI(c);const m=c.g,x=c.v[0]?()=>{}:null;c.g=null,c.v=null,p||rt(c,"ready");try{m.onreadystatechange=x}catch{}}}function uI(c){c.I&&(a.clearTimeout(c.I),c.I=null)}n.isActive=function(){return!!this.g};function ei(c){return c.g?c.g.readyState:0}n.Z=function(){try{return 2<ei(this)?this.g.status:-1}catch{return-1}},n.oa=function(){try{return this.g?this.g.responseText:""}catch{return""}},n.Oa=function(c){if(this.g){var p=this.g.responseText;return c&&p.indexOf(c)==0&&(p=p.substring(c.length)),Wo(p)}};function dI(c){try{if(!c.g)return null;if("response"in c.g)return c.g.response;switch(c.H){case"":case"text":return c.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in c.g)return c.g.mozResponseArrayBuffer}return null}catch{return null}}function s2(c){const p={};c=(c.g&&2<=ei(c)&&c.g.getAllResponseHeaders()||"").split(`\r
`);for(let x=0;x<c.length;x++){if(I(c[x]))continue;var m=E(c[x]);const L=m[0];if(m=m[1],typeof m!="string")continue;m=m.trim();const B=p[L]||[];p[L]=B,B.push(m)}S(p,function(x){return x.join(", ")})}n.Ba=function(){return this.m},n.Ka=function(){return typeof this.l=="string"?this.l:String(this.l)};function Zc(c,p,m){return m&&m.internalChannelParams&&m.internalChannelParams[c]||p}function hI(c){this.Aa=0,this.i=[],this.j=new Re,this.ia=this.qa=this.I=this.W=this.g=this.ya=this.D=this.H=this.m=this.S=this.o=null,this.Ya=this.U=0,this.Va=Zc("failFast",!1,c),this.F=this.C=this.u=this.s=this.l=null,this.X=!0,this.za=this.T=-1,this.Y=this.v=this.B=0,this.Ta=Zc("baseRetryDelayMs",5e3,c),this.cb=Zc("retryDelaySeedMs",1e4,c),this.Wa=Zc("forwardChannelMaxRetries",2,c),this.wa=Zc("forwardChannelRequestTimeoutMs",2e4,c),this.pa=c&&c.xmlHttpFactory||void 0,this.Xa=c&&c.Tb||void 0,this.Ca=c&&c.useFetchStreams||!1,this.L=void 0,this.J=c&&c.supportsCrossDomainXhr||!1,this.K="",this.h=new fr(c&&c.concurrentRequestLimit),this.Da=new e2,this.P=c&&c.fastHandshake||!1,this.O=c&&c.encodeInitMessageHeaders||!1,this.P&&this.O&&(this.O=!1),this.Ua=c&&c.Rb||!1,c&&c.xa&&this.j.xa(),c&&c.forceLongPolling&&(this.X=!1),this.ba=!this.P&&this.X&&c&&c.detectBufferingProxy||!1,this.ja=void 0,c&&c.longPollingTimeout&&0<c.longPollingTimeout&&(this.ja=c.longPollingTimeout),this.ca=void 0,this.R=0,this.M=!1,this.ka=this.A=null}n=hI.prototype,n.la=8,n.G=1,n.connect=function(c,p,m,x){_e(0),this.W=c,this.H=p||{},m&&x!==void 0&&(this.H.OSID=m,this.H.OAID=x),this.F=this.X,this.I=xI(this,null,this.W),Bh(this)};function Vm(c){if(fI(c),c.G==3){var p=c.U++,m=Zs(c.I);if(Ft(m,"SID",c.K),Ft(m,"RID",p),Ft(m,"TYPE","terminate"),eu(c,m),p=new ht(c,c.j,p),p.L=2,p.v=Vh(Zs(m)),m=!1,a.navigator&&a.navigator.sendBeacon)try{m=a.navigator.sendBeacon(p.v.toString(),"")}catch{}!m&&a.Image&&(new Image().src=p.v,m=!0),m||(p.g=II(p.j,null),p.g.ea(p.v)),p.F=Date.now(),Pt(p)}wI(c)}function $h(c){c.g&&(jm(c),c.g.cancel(),c.g=null)}function fI(c){$h(c),c.u&&(a.clearTimeout(c.u),c.u=null),zh(c),c.h.cancel(),c.s&&(typeof c.s=="number"&&a.clearTimeout(c.s),c.s=null)}function Bh(c){if(!fn(c.h)&&!c.s){c.s=!0;var p=c.Ga;qt||Q(),k||(qt(),k=!0),$.add(p,c),c.B=0}}function i2(c,p){return Js(c.h)>=c.h.j-(c.s?1:0)?!1:c.s?(c.i=p.D.concat(c.i),!0):c.G==1||c.G==2||c.B>=(c.Va?0:c.Wa)?!1:(c.s=Se(g(c.Ga,c,p),vI(c,c.B)),c.B++,!0)}n.Ga=function(c){if(this.s)if(this.s=null,this.G==1){if(!c){this.U=Math.floor(1e5*Math.random()),c=this.U++;const L=new ht(this,this.j,c);let B=this.o;if(this.S&&(B?(B=v(B),_(B,this.S)):B=this.S),this.m!==null||this.O||(L.H=B,B=null),this.P)e:{for(var p=0,m=0;m<this.i.length;m++){t:{var x=this.i[m];if("__data__"in x.map&&(x=x.map.__data__,typeof x=="string")){x=x.length;break t}x=void 0}if(x===void 0)break;if(p+=x,4096<p){p=m;break e}if(p===4096||m===this.i.length-1){p=m+1;break e}}p=1e3}else p=1e3;p=pI(this,L,p),m=Zs(this.I),Ft(m,"RID",c),Ft(m,"CVER",22),this.D&&Ft(m,"X-HTTP-Session-Id",this.D),eu(this,m),B&&(this.O?p="headers="+encodeURIComponent(String(oI(B)))+"&"+p:this.m&&Om(m,this.m,B)),Xs(this.h,L),this.Ua&&Ft(m,"TYPE","init"),this.P?(Ft(m,"$req",p),Ft(m,"SID","null"),L.T=!0,Gn(L,m,null)):Gn(L,m,p),this.G=2}}else this.G==3&&(c?gI(this,c):this.i.length==0||fn(this.h)||gI(this))};function gI(c,p){var m;p?m=p.l:m=c.U++;const x=Zs(c.I);Ft(x,"SID",c.K),Ft(x,"RID",m),Ft(x,"AID",c.T),eu(c,x),c.m&&c.o&&Om(x,c.m,c.o),m=new ht(c,c.j,m,c.B+1),c.m===null&&(m.H=c.o),p&&(c.i=p.D.concat(c.i)),p=pI(c,m,1e3),m.I=Math.round(.5*c.wa)+Math.round(.5*c.wa*Math.random()),Xs(c.h,m),Gn(m,x,p)}function eu(c,p){c.H&&P(c.H,function(m,x){Ft(p,x,m)}),c.l&&Xx({},function(m,x){Ft(p,x,m)})}function pI(c,p,m){m=Math.min(c.i.length,m);var x=c.l?g(c.l.Na,c.l,c):null;e:{var L=c.i;let B=-1;for(;;){const se=["count="+m];B==-1?0<m?(B=L[0].g,se.push("ofs="+B)):B=0:se.push("ofs="+B);let Rt=!0;for(let Fn=0;Fn<m;Fn++){let ft=L[Fn].g;const Hn=L[Fn].map;if(ft-=B,0>ft)B=Math.max(0,L[Fn].g-100),Rt=!1;else try{t2(Hn,se,"req"+ft+"_")}catch{x&&x(Hn)}}if(Rt){x=se.join("&");break e}}}return c=c.i.splice(0,m),p.D=c,x}function mI(c){if(!c.g&&!c.u){c.Y=1;var p=c.Fa;qt||Q(),k||(qt(),k=!0),$.add(p,c),c.v=0}}function Fm(c){return c.g||c.u||3<=c.v?!1:(c.Y++,c.u=Se(g(c.Fa,c),vI(c,c.v)),c.v++,!0)}n.Fa=function(){if(this.u=null,yI(this),this.ba&&!(this.M||this.g==null||0>=this.R)){var c=2*this.R;this.j.info("BP detection timer enabled: "+c),this.A=Se(g(this.ab,this),c)}},n.ab=function(){this.A&&(this.A=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.F=!1,this.M=!0,_e(10),$h(this),yI(this))};function jm(c){c.A!=null&&(a.clearTimeout(c.A),c.A=null)}function yI(c){c.g=new ht(c,c.j,"rpc",c.Y),c.m===null&&(c.g.H=c.o),c.g.O=0;var p=Zs(c.qa);Ft(p,"RID","rpc"),Ft(p,"SID",c.K),Ft(p,"AID",c.T),Ft(p,"CI",c.F?"0":"1"),!c.F&&c.ja&&Ft(p,"TO",c.ja),Ft(p,"TYPE","xmlhttp"),eu(c,p),c.m&&c.o&&Om(p,c.m,c.o),c.L&&(c.g.I=c.L);var m=c.g;c=c.ia,m.L=1,m.v=Vh(Zs(p)),m.m=null,m.P=!0,bs(m,c)}n.Za=function(){this.C!=null&&(this.C=null,$h(this),Fm(this),_e(19))};function zh(c){c.C!=null&&(a.clearTimeout(c.C),c.C=null)}function _I(c,p){var m=null;if(c.g==p){zh(c),jm(c),c.g=null;var x=2}else if(Go(c.h,p))m=p.D,Yx(c.h,p),x=1;else return;if(c.G!=0){if(p.o)if(x==1){m=p.m?p.m.length:0,p=Date.now()-p.F;var L=c.B;x=F(),rt(x,new ze(x,m)),Bh(c)}else mI(c);else if(L=p.s,L==3||L==0&&0<p.X||!(x==1&&i2(c,p)||x==2&&Fm(c)))switch(m&&0<m.length&&(p=c.h,p.i=p.i.concat(m)),L){case 1:Ko(c,5);break;case 4:Ko(c,10);break;case 3:Ko(c,6);break;default:Ko(c,2)}}}function vI(c,p){let m=c.Ta+Math.floor(Math.random()*c.cb);return c.isActive()||(m*=2),m*p}function Ko(c,p){if(c.j.info("Error code "+p),p==2){var m=g(c.fb,c),x=c.Xa;const L=!x;x=new Ho(x||"//www.google.com/images/cleardot.gif"),a.location&&a.location.protocol=="http"||Lh(x,"https"),Vh(x),L?XD(x.toString(),m):ZD(x.toString(),m)}else _e(2);c.G=0,c.l&&c.l.sa(p),wI(c),fI(c)}n.fb=function(c){c?(this.j.info("Successfully pinged google.com"),_e(2)):(this.j.info("Failed to ping google.com"),_e(1))};function wI(c){if(c.G=0,c.ka=[],c.l){const p=Jx(c.h);(p.length!=0||c.i.length!=0)&&(M(c.ka,p),M(c.ka,c.i),c.h.i.length=0,C(c.i),c.i.length=0),c.l.ra()}}function xI(c,p,m){var x=m instanceof Ho?Zs(m):new Ho(m);if(x.g!="")p&&(x.g=p+"."+x.g),Oh(x,x.s);else{var L=a.location;x=L.protocol,p=p?p+"."+L.hostname:L.hostname,L=+L.port;var B=new Ho(null);x&&Lh(B,x),p&&(B.g=p),L&&Oh(B,L),m&&(B.l=m),x=B}return m=c.D,p=c.ya,m&&p&&Ft(x,m,p),Ft(x,"VER",c.la),eu(c,x),x}function II(c,p,m){if(p&&!c.J)throw Error("Can't create secondary domain capable XhrIo object.");return p=c.Ca&&!c.pa?new sn(new Fh({eb:m})):new sn(c.pa),p.Ha(c.J),p}n.isActive=function(){return!!this.l&&this.l.isActive(this)};function EI(){}n=EI.prototype,n.ua=function(){},n.ta=function(){},n.sa=function(){},n.ra=function(){},n.isActive=function(){return!0},n.Na=function(){};function qh(){}qh.prototype.g=function(c,p){return new Cr(c,p)};function Cr(c,p){Te.call(this),this.g=new hI(p),this.l=c,this.h=p&&p.messageUrlParams||null,c=p&&p.messageHeaders||null,p&&p.clientProtocolHeaderRequired&&(c?c["X-Client-Protocol"]="webchannel":c={"X-Client-Protocol":"webchannel"}),this.g.o=c,c=p&&p.initMessageHeaders||null,p&&p.messageContentType&&(c?c["X-WebChannel-Content-Type"]=p.messageContentType:c={"X-WebChannel-Content-Type":p.messageContentType}),p&&p.va&&(c?c["X-WebChannel-Client-Profile"]=p.va:c={"X-WebChannel-Client-Profile":p.va}),this.g.S=c,(c=p&&p.Sb)&&!I(c)&&(this.g.m=c),this.v=p&&p.supportsCrossDomainXhr||!1,this.u=p&&p.sendRawJson||!1,(p=p&&p.httpSessionIdParam)&&!I(p)&&(this.g.D=p,c=this.h,c!==null&&p in c&&(c=this.h,p in c&&delete c[p])),this.j=new il(this)}w(Cr,Te),Cr.prototype.m=function(){this.g.l=this.j,this.v&&(this.g.J=!0),this.g.connect(this.l,this.h||void 0)},Cr.prototype.close=function(){Vm(this.g)},Cr.prototype.o=function(c){var p=this.g;if(typeof c=="string"){var m={};m.__data__=c,c=m}else this.u&&(m={},m.__data__=br(c),c=m);p.i.push(new Mi(p.Ya++,c)),p.G==3&&Bh(p)},Cr.prototype.N=function(){this.g.l=null,delete this.j,Vm(this.g),delete this.g,Cr.aa.N.call(this)};function SI(c){Ys.call(this),c.__headers__&&(this.headers=c.__headers__,this.statusCode=c.__status__,delete c.__headers__,delete c.__status__);var p=c.__sm__;if(p){e:{for(const m in p){c=m;break e}c=void 0}(this.i=c)&&(c=this.i,p=p!==null&&c in p?p[c]:void 0),this.data=p}else this.data=c}w(SI,Ys);function TI(){Ts.call(this),this.status=1}w(TI,Ts);function il(c){this.g=c}w(il,EI),il.prototype.ua=function(){rt(this.g,"a")},il.prototype.ta=function(c){rt(this.g,new SI(c))},il.prototype.sa=function(c){rt(this.g,new TI)},il.prototype.ra=function(){rt(this.g,"b")},qh.prototype.createWebChannel=qh.prototype.g,Cr.prototype.send=Cr.prototype.o,Cr.prototype.open=Cr.prototype.m,Cr.prototype.close=Cr.prototype.close,jR=function(){return new qh},FR=function(){return F()},VR=is,ov={mb:0,pb:1,qb:2,Jb:3,Ob:4,Lb:5,Mb:6,Kb:7,Ib:8,Nb:9,PROXY:10,NOPROXY:11,Gb:12,Cb:13,Db:14,Bb:15,Eb:16,Fb:17,ib:18,hb:19,jb:20},me.NO_ERROR=0,me.TIMEOUT=8,me.HTTP_ERROR=6,jf=me,we.COMPLETE="complete",OR=we,Tn.EventType=On,On.OPEN="a",On.CLOSE="b",On.ERROR="c",On.MESSAGE="d",Te.prototype.listen=Te.prototype.K,bu=Tn,sn.prototype.listenOnce=sn.prototype.L,sn.prototype.getLastError=sn.prototype.Ka,sn.prototype.getLastErrorCode=sn.prototype.Ba,sn.prototype.getStatus=sn.prototype.Z,sn.prototype.getResponseJson=sn.prototype.Oa,sn.prototype.getResponseText=sn.prototype.oa,sn.prototype.send=sn.prototype.ea,sn.prototype.setWithCredentials=sn.prototype.Ha,LR=sn}).apply(typeof hf<"u"?hf:typeof self<"u"?self:typeof window<"u"?window:{});const AS="@firebase/firestore",CS="4.9.0";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Rn=class{constructor(e){this.uid=e}isAuthenticated(){return this.uid!=null}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}};Rn.UNAUTHENTICATED=new Rn(null),Rn.GOOGLE_CREDENTIALS=new Rn("google-credentials-uid"),Rn.FIRST_PARTY=new Rn("first-party-uid"),Rn.MOCK_USER=new Rn("mock-user");/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Oc="12.0.0";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Co=new rh("@firebase/firestore");function ml(){return Co.logLevel}function mq(n){Co.setLogLevel(n)}function W(n,...e){if(Co.logLevel<=Ze.DEBUG){const t=e.map(vw);Co.debug(`Firestore (${Oc}): ${n}`,...t)}}function dn(n,...e){if(Co.logLevel<=Ze.ERROR){const t=e.map(vw);Co.error(`Firestore (${Oc}): ${n}`,...t)}}function rs(n,...e){if(Co.logLevel<=Ze.WARN){const t=e.map(vw);Co.warn(`Firestore (${Oc}): ${n}`,...t)}}function vw(n){if(typeof n=="string")return n;try{/**
* @license
* Copyright 2020 Google LLC
*
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
*   http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
*/return function(t){return JSON.stringify(t)}(n)}catch{return n}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ue(n,e,t){let r="Unexpected state";typeof e=="string"?r=e:t=e,UR(n,r,t)}function UR(n,e,t){let r=`FIRESTORE (${Oc}) INTERNAL ASSERTION FAILED: ${e} (ID: ${n.toString(16)})`;if(t!==void 0)try{r+=" CONTEXT: "+JSON.stringify(t)}catch{r+=" CONTEXT: "+t}throw dn(r),new Error(r)}function ye(n,e,t,r){let s="Unexpected state";typeof t=="string"?s=t:r=t,n||UR(e,s,r)}function yq(n,e){n||ue(57014,e)}function re(n,e){return n}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const U={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class z extends xs{constructor(e,t){super(e,t),this.code=e,this.message=t,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Pn{constructor(){this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class $R{constructor(e,t){this.user=t,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}}class M4{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,t){e.enqueueRetryable(()=>t(Rn.UNAUTHENTICATED))}shutdown(){}}class L4{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,t){this.changeListener=t,e.enqueueRetryable(()=>t(this.token.user))}shutdown(){this.changeListener=null}}class O4{constructor(e){this.t=e,this.currentUser=Rn.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(e,t){ye(this.o===void 0,42304);let r=this.i;const s=l=>this.i!==r?(r=this.i,t(l)):Promise.resolve();let i=new Pn;this.o=()=>{this.i++,this.currentUser=this.u(),i.resolve(),i=new Pn,e.enqueueRetryable(()=>s(this.currentUser))};const o=()=>{const l=i;e.enqueueRetryable(async()=>{await l.promise,await s(this.currentUser)})},a=l=>{W("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=l,this.o&&(this.auth.addAuthTokenListener(this.o),o())};this.t.onInit(l=>a(l)),setTimeout(()=>{if(!this.auth){const l=this.t.getImmediate({optional:!0});l?a(l):(W("FirebaseAuthCredentialsProvider","Auth not yet detected"),i.resolve(),i=new Pn)}},0),o()}getToken(){const e=this.i,t=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(t).then(r=>this.i!==e?(W("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):r?(ye(typeof r.accessToken=="string",31837,{l:r}),new $R(r.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.o&&this.auth.removeAuthTokenListener(this.o),this.o=void 0}u(){const e=this.auth&&this.auth.getUid();return ye(e===null||typeof e=="string",2055,{h:e}),new Rn(e)}}class V4{constructor(e,t,r){this.P=e,this.T=t,this.I=r,this.type="FirstParty",this.user=Rn.FIRST_PARTY,this.A=new Map}R(){return this.I?this.I():null}get headers(){this.A.set("X-Goog-AuthUser",this.P);const e=this.R();return e&&this.A.set("Authorization",e),this.T&&this.A.set("X-Goog-Iam-Authorization-Token",this.T),this.A}}class F4{constructor(e,t,r){this.P=e,this.T=t,this.I=r}getToken(){return Promise.resolve(new V4(this.P,this.T,this.I))}start(e,t){e.enqueueRetryable(()=>t(Rn.FIRST_PARTY))}shutdown(){}invalidateToken(){}}class av{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class j4{constructor(e,t){this.V=t,this.forceRefresh=!1,this.appCheck=null,this.m=null,this.p=null,Kt(e)&&e.settings.appCheckToken&&(this.p=e.settings.appCheckToken)}start(e,t){ye(this.o===void 0,3512);const r=i=>{i.error!=null&&W("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${i.error.message}`);const o=i.token!==this.m;return this.m=i.token,W("FirebaseAppCheckTokenProvider",`Received ${o?"new":"existing"} token.`),o?t(i.token):Promise.resolve()};this.o=i=>{e.enqueueRetryable(()=>r(i))};const s=i=>{W("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=i,this.o&&this.appCheck.addTokenListener(this.o)};this.V.onInit(i=>s(i)),setTimeout(()=>{if(!this.appCheck){const i=this.V.getImmediate({optional:!0});i?s(i):W("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}},0)}getToken(){if(this.p)return Promise.resolve(new av(this.p));const e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then(t=>t?(ye(typeof t.token=="string",44558,{tokenResult:t}),this.m=t.token,new av(t.token)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.o&&this.appCheck.removeTokenListener(this.o),this.o=void 0}}class _q{getToken(){return Promise.resolve(new av(""))}invalidateToken(){}start(e,t){}shutdown(){}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function U4(n){const e=typeof self<"u"&&(self.crypto||self.msCrypto),t=new Uint8Array(n);if(e&&typeof e.getRandomValues=="function")e.getRandomValues(t);else for(let r=0;r<n;r++)t[r]=Math.floor(256*Math.random());return t}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ww{static newId(){const e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",t=62*Math.floor(4.129032258064516);let r="";for(;r.length<20;){const s=U4(40);for(let i=0;i<s.length;++i)r.length<20&&s[i]<t&&(r+=e.charAt(s[i]%62))}return r}}function Pe(n,e){return n<e?-1:n>e?1:0}function lv(n,e){const t=Math.min(n.length,e.length);for(let r=0;r<t;r++){const s=n.charAt(r),i=e.charAt(r);if(s!==i)return Ty(s)===Ty(i)?Pe(s,i):Ty(s)?1:-1}return Pe(n.length,e.length)}const $4=55296,B4=57343;function Ty(n){const e=n.charCodeAt(0);return e>=$4&&e<=B4}function lc(n,e,t){return n.length===e.length&&n.every((r,s)=>t(r,e[s]))}function BR(n){return n+"\0"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const cv="__name__";class ks{constructor(e,t,r){t===void 0?t=0:t>e.length&&ue(637,{offset:t,range:e.length}),r===void 0?r=e.length-t:r>e.length-t&&ue(1746,{length:r,range:e.length-t}),this.segments=e,this.offset=t,this.len=r}get length(){return this.len}isEqual(e){return ks.comparator(this,e)===0}child(e){const t=this.segments.slice(this.offset,this.limit());return e instanceof ks?e.forEach(r=>{t.push(r)}):t.push(e),this.construct(t)}limit(){return this.offset+this.length}popFirst(e){return e=e===void 0?1:e,this.construct(this.segments,this.offset+e,this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return this.length===0}isPrefixOf(e){if(e.length<this.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}forEach(e){for(let t=this.offset,r=this.limit();t<r;t++)e(this.segments[t])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,t){const r=Math.min(e.length,t.length);for(let s=0;s<r;s++){const i=ks.compareSegments(e.get(s),t.get(s));if(i!==0)return i}return Pe(e.length,t.length)}static compareSegments(e,t){const r=ks.isNumericId(e),s=ks.isNumericId(t);return r&&!s?-1:!r&&s?1:r&&s?ks.extractNumericId(e).compare(ks.extractNumericId(t)):lv(e,t)}static isNumericId(e){return e.startsWith("__id")&&e.endsWith("__")}static extractNumericId(e){return _o.fromString(e.substring(4,e.length-2))}}class Je extends ks{construct(e,t,r){return new Je(e,t,r)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...e){const t=[];for(const r of e){if(r.indexOf("//")>=0)throw new z(U.INVALID_ARGUMENT,`Invalid segment (${r}). Paths must not contain // in them.`);t.push(...r.split("/").filter(s=>s.length>0))}return new Je(t)}static emptyPath(){return new Je([])}}const z4=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class Yt extends ks{construct(e,t,r){return new Yt(e,t,r)}static isValidIdentifier(e){return z4.test(e)}canonicalString(){return this.toArray().map(e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),Yt.isValidIdentifier(e)||(e="`"+e+"`"),e)).join(".")}toString(){return this.canonicalString()}isKeyField(){return this.length===1&&this.get(0)===cv}static keyField(){return new Yt([cv])}static fromServerFormat(e){const t=[];let r="",s=0;const i=()=>{if(r.length===0)throw new z(U.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);t.push(r),r=""};let o=!1;for(;s<e.length;){const a=e[s];if(a==="\\"){if(s+1===e.length)throw new z(U.INVALID_ARGUMENT,"Path has trailing escape character: "+e);const l=e[s+1];if(l!=="\\"&&l!=="."&&l!=="`")throw new z(U.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);r+=l,s+=2}else a==="`"?(o=!o,s++):a!=="."||o?(r+=a,s++):(i(),s++)}if(i(),o)throw new z(U.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new Yt(t)}static emptyPath(){return new Yt([])}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ne{constructor(e){this.path=e}static fromPath(e){return new ne(Je.fromString(e))}static fromName(e){return new ne(Je.fromString(e).popFirst(5))}static empty(){return new ne(Je.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return e!==null&&Je.comparator(this.path,e.path)===0}toString(){return this.path.toString()}static comparator(e,t){return Je.comparator(e.path,t.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new ne(new Je(e.slice()))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function xw(n,e,t){if(!t)throw new z(U.INVALID_ARGUMENT,`Function ${n}() cannot be called with an empty ${e}.`)}function q4(n,e,t,r){if(e===!0&&r===!0)throw new z(U.INVALID_ARGUMENT,`${n} and ${t} cannot be used together.`)}function RS(n){if(!ne.isDocumentKey(n))throw new z(U.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${n} has ${n.length}.`)}function NS(n){if(ne.isDocumentKey(n))throw new z(U.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${n} has ${n.length}.`)}function zR(n){return typeof n=="object"&&n!==null&&(Object.getPrototypeOf(n)===Object.prototype||Object.getPrototypeOf(n)===null)}function Yp(n){if(n===void 0)return"undefined";if(n===null)return"null";if(typeof n=="string")return n.length>20&&(n=`${n.substring(0,20)}...`),JSON.stringify(n);if(typeof n=="number"||typeof n=="boolean")return""+n;if(typeof n=="object"){if(n instanceof Array)return"an array";{const e=function(r){return r.constructor?r.constructor.name:null}(n);return e?`a custom ${e} object`:"an object"}}return typeof n=="function"?"a function":ue(12329,{type:typeof n})}function et(n,e){if("_delegate"in n&&(n=n._delegate),!(n instanceof e)){if(e.name===n.constructor.name)throw new z(U.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{const t=Yp(n);throw new z(U.INVALID_ARGUMENT,`Expected type '${e.name}', but it was: ${t}`)}}return n}function qR(n,e){if(e<=0)throw new z(U.INVALID_ARGUMENT,`Function ${n}() requires a positive number, but it was: ${e}.`)}/**
 * @license
 * Copyright 2025 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function yn(n,e){const t={typeString:n};return e&&(t.value=e),t}function Ya(n,e){if(!zR(n))throw new z(U.INVALID_ARGUMENT,"JSON must be an object");let t;for(const r in e)if(e[r]){const s=e[r].typeString,i="value"in e[r]?{value:e[r].value}:void 0;if(!(r in n)){t=`JSON missing required field: '${r}'`;break}const o=n[r];if(s&&typeof o!==s){t=`JSON field '${r}' must be a ${s}.`;break}if(i!==void 0&&o!==i.value){t=`Expected '${r}' field to equal '${i.value}'`;break}}if(t)throw new z(U.INVALID_ARGUMENT,t);return!0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const kS=-62135596800,PS=1e6;class gt{static now(){return gt.fromMillis(Date.now())}static fromDate(e){return gt.fromMillis(e.getTime())}static fromMillis(e){const t=Math.floor(e/1e3),r=Math.floor((e-1e3*t)*PS);return new gt(t,r)}constructor(e,t){if(this.seconds=e,this.nanoseconds=t,t<0)throw new z(U.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(t>=1e9)throw new z(U.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(e<kS)throw new z(U.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e);if(e>=253402300800)throw new z(U.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/PS}_compareTo(e){return this.seconds===e.seconds?Pe(this.nanoseconds,e.nanoseconds):Pe(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{type:gt._jsonSchemaVersion,seconds:this.seconds,nanoseconds:this.nanoseconds}}static fromJSON(e){if(Ya(e,gt._jsonSchema))return new gt(e.seconds,e.nanoseconds)}valueOf(){const e=this.seconds-kS;return String(e).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}gt._jsonSchemaVersion="firestore/timestamp/1.0",gt._jsonSchema={type:yn("string",gt._jsonSchemaVersion),seconds:yn("number"),nanoseconds:yn("number")};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ie{static fromTimestamp(e){return new Ie(e)}static min(){return new Ie(new gt(0,0))}static max(){return new Ie(new gt(253402300799,999999999))}constructor(e){this.timestamp=e}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const cc=-1;class uc{constructor(e,t,r,s){this.indexId=e,this.collectionGroup=t,this.fields=r,this.indexState=s}}function uv(n){return n.fields.find(e=>e.kind===2)}function ea(n){return n.fields.filter(e=>e.kind!==2)}function W4(n,e){let t=Pe(n.collectionGroup,e.collectionGroup);if(t!==0)return t;for(let r=0;r<Math.min(n.fields.length,e.fields.length);++r)if(t=G4(n.fields[r],e.fields[r]),t!==0)return t;return Pe(n.fields.length,e.fields.length)}uc.UNKNOWN_ID=-1;class ma{constructor(e,t){this.fieldPath=e,this.kind=t}}function G4(n,e){const t=Yt.comparator(n.fieldPath,e.fieldPath);return t!==0?t:Pe(n.kind,e.kind)}class dc{constructor(e,t){this.sequenceNumber=e,this.offset=t}static empty(){return new dc(0,Br.min())}}function WR(n,e){const t=n.toTimestamp().seconds,r=n.toTimestamp().nanoseconds+1,s=Ie.fromTimestamp(r===1e9?new gt(t+1,0):new gt(t,r));return new Br(s,ne.empty(),e)}function GR(n){return new Br(n.readTime,n.key,cc)}class Br{constructor(e,t,r){this.readTime=e,this.documentKey=t,this.largestBatchId=r}static min(){return new Br(Ie.min(),ne.empty(),cc)}static max(){return new Br(Ie.max(),ne.empty(),cc)}}function Iw(n,e){let t=n.readTime.compareTo(e.readTime);return t!==0?t:(t=ne.comparator(n.documentKey,e.documentKey),t!==0?t:Pe(n.largestBatchId,e.largestBatchId))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const HR="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class KR{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach(e=>e())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function jo(n){if(n.code!==U.FAILED_PRECONDITION||n.message!==HR)throw n;W("LocalStore","Unexpectedly lost primary lease")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class O{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e(t=>{this.isDone=!0,this.result=t,this.nextCallback&&this.nextCallback(t)},t=>{this.isDone=!0,this.error=t,this.catchCallback&&this.catchCallback(t)})}catch(e){return this.next(void 0,e)}next(e,t){return this.callbackAttached&&ue(59440),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(t,this.error):this.wrapSuccess(e,this.result):new O((r,s)=>{this.nextCallback=i=>{this.wrapSuccess(e,i).next(r,s)},this.catchCallback=i=>{this.wrapFailure(t,i).next(r,s)}})}toPromise(){return new Promise((e,t)=>{this.next(e,t)})}wrapUserFunction(e){try{const t=e();return t instanceof O?t:O.resolve(t)}catch(t){return O.reject(t)}}wrapSuccess(e,t){return e?this.wrapUserFunction(()=>e(t)):O.resolve(t)}wrapFailure(e,t){return e?this.wrapUserFunction(()=>e(t)):O.reject(t)}static resolve(e){return new O((t,r)=>{t(e)})}static reject(e){return new O((t,r)=>{r(e)})}static waitFor(e){return new O((t,r)=>{let s=0,i=0,o=!1;e.forEach(a=>{++s,a.next(()=>{++i,o&&i===s&&t()},l=>r(l))}),o=!0,i===s&&t()})}static or(e){let t=O.resolve(!1);for(const r of e)t=t.next(s=>s?O.resolve(s):r());return t}static forEach(e,t){const r=[];return e.forEach((s,i)=>{r.push(t.call(this,s,i))}),this.waitFor(r)}static mapArray(e,t){return new O((r,s)=>{const i=e.length,o=new Array(i);let a=0;for(let l=0;l<i;l++){const u=l;t(e[u]).next(h=>{o[u]=h,++a,a===i&&r(o)},h=>s(h))}})}static doWhile(e,t){return new O((r,s)=>{const i=()=>{e()===!0?t().next(()=>{i()},s):r()};i()})}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const kr="SimpleDb";class Jp{static open(e,t,r,s){try{return new Jp(t,e.transaction(s,r))}catch(i){throw new Wu(t,i)}}constructor(e,t){this.action=e,this.transaction=t,this.aborted=!1,this.S=new Pn,this.transaction.oncomplete=()=>{this.S.resolve()},this.transaction.onabort=()=>{t.error?this.S.reject(new Wu(e,t.error)):this.S.resolve()},this.transaction.onerror=r=>{const s=Ew(r.target.error);this.S.reject(new Wu(e,s))}}get D(){return this.S.promise}abort(e){e&&this.S.reject(e),this.aborted||(W(kr,"Aborting transaction:",e?e.message:"Client-initiated abort"),this.aborted=!0,this.transaction.abort())}C(){const e=this.transaction;this.aborted||typeof e.commit!="function"||e.commit()}store(e){const t=this.transaction.objectStore(e);return new K4(t)}}class Bs{static delete(e){return W(kr,"Removing database:",e),na(K1().indexedDB.deleteDatabase(e)).toPromise()}static v(){if(!Np())return!1;if(Bs.F())return!0;const e=In(),t=Bs.M(e),r=0<t&&t<10,s=QR(e),i=0<s&&s<4.5;return!(e.indexOf("MSIE ")>0||e.indexOf("Trident/")>0||e.indexOf("Edge/")>0||r||i)}static F(){var e;return typeof process<"u"&&((e=process.__PRIVATE_env)==null?void 0:e.__PRIVATE_USE_MOCK_PERSISTENCE)==="YES"}static O(e,t){return e.store(t)}static M(e){const t=e.match(/i(?:phone|pad|pod) os ([\d_]+)/i),r=t?t[1].split("_").slice(0,2).join("."):"-1";return Number(r)}constructor(e,t,r){this.name=e,this.version=t,this.N=r,this.B=null,Bs.M(In())===12.2&&dn("Firestore persistence suffers from a bug in iOS 12.2 Safari that may cause your app to stop working. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.")}async L(e){return this.db||(W(kr,"Opening database:",this.name),this.db=await new Promise((t,r)=>{const s=indexedDB.open(this.name,this.version);s.onsuccess=i=>{const o=i.target.result;t(o)},s.onblocked=()=>{r(new Wu(e,"Cannot upgrade IndexedDB schema while another tab is open. Close all tabs that access Firestore and reload this page to proceed."))},s.onerror=i=>{const o=i.target.error;o.name==="VersionError"?r(new z(U.FAILED_PRECONDITION,"A newer version of the Firestore SDK was previously used and so the persisted data is not compatible with the version of the SDK you are now using. The SDK will operate with persistence disabled. If you need persistence, please re-upgrade to a newer version of the SDK or else clear the persisted IndexedDB data for your app to start fresh.")):o.name==="InvalidStateError"?r(new z(U.FAILED_PRECONDITION,"Unable to open an IndexedDB connection. This could be due to running in a private browsing session on a browser whose private browsing sessions do not support IndexedDB: "+o)):r(new Wu(e,o))},s.onupgradeneeded=i=>{W(kr,'Database "'+this.name+'" requires upgrade from version:',i.oldVersion);const o=i.target.result;this.N.k(o,s.transaction,i.oldVersion,this.version).next(()=>{W(kr,"Database upgrade to version "+this.version+" complete")})}})),this.q&&(this.db.onversionchange=t=>this.q(t)),this.db}$(e){this.q=e,this.db&&(this.db.onversionchange=t=>e(t))}async runTransaction(e,t,r,s){const i=t==="readonly";let o=0;for(;;){++o;try{this.db=await this.L(e);const a=Jp.open(this.db,e,i?"readonly":"readwrite",r),l=s(a).next(u=>(a.C(),u)).catch(u=>(a.abort(u),O.reject(u))).toPromise();return l.catch(()=>{}),await a.D,l}catch(a){const l=a,u=l.name!=="FirebaseError"&&o<3;if(W(kr,"Transaction failed with error:",l.message,"Retrying:",u),this.close(),!u)return Promise.reject(l)}}}close(){this.db&&this.db.close(),this.db=void 0}}function QR(n){const e=n.match(/Android ([\d.]+)/i),t=e?e[1].split(".").slice(0,2).join("."):"-1";return Number(t)}class H4{constructor(e){this.U=e,this.K=!1,this.W=null}get isDone(){return this.K}get G(){return this.W}set cursor(e){this.U=e}done(){this.K=!0}j(e){this.W=e}delete(){return na(this.U.delete())}}class Wu extends z{constructor(e,t){super(U.UNAVAILABLE,`IndexedDB transaction '${e}' failed: ${t}`),this.name="IndexedDbTransactionError"}}function Uo(n){return n.name==="IndexedDbTransactionError"}class K4{constructor(e){this.store=e}put(e,t){let r;return t!==void 0?(W(kr,"PUT",this.store.name,e,t),r=this.store.put(t,e)):(W(kr,"PUT",this.store.name,"<auto-key>",e),r=this.store.put(e)),na(r)}add(e){return W(kr,"ADD",this.store.name,e,e),na(this.store.add(e))}get(e){return na(this.store.get(e)).next(t=>(t===void 0&&(t=null),W(kr,"GET",this.store.name,e,t),t))}delete(e){return W(kr,"DELETE",this.store.name,e),na(this.store.delete(e))}count(){return W(kr,"COUNT",this.store.name),na(this.store.count())}J(e,t){const r=this.options(e,t),s=r.index?this.store.index(r.index):this.store;if(typeof s.getAll=="function"){const i=s.getAll(r.range);return new O((o,a)=>{i.onerror=l=>{a(l.target.error)},i.onsuccess=l=>{o(l.target.result)}})}{const i=this.cursor(r),o=[];return this.H(i,(a,l)=>{o.push(l)}).next(()=>o)}}Y(e,t){const r=this.store.getAll(e,t===null?void 0:t);return new O((s,i)=>{r.onerror=o=>{i(o.target.error)},r.onsuccess=o=>{s(o.target.result)}})}Z(e,t){W(kr,"DELETE ALL",this.store.name);const r=this.options(e,t);r.X=!1;const s=this.cursor(r);return this.H(s,(i,o,a)=>a.delete())}ee(e,t){let r;t?r=e:(r={},t=e);const s=this.cursor(r);return this.H(s,t)}te(e){const t=this.cursor({});return new O((r,s)=>{t.onerror=i=>{const o=Ew(i.target.error);s(o)},t.onsuccess=i=>{const o=i.target.result;o?e(o.primaryKey,o.value).next(a=>{a?o.continue():r()}):r()}})}H(e,t){const r=[];return new O((s,i)=>{e.onerror=o=>{i(o.target.error)},e.onsuccess=o=>{const a=o.target.result;if(!a)return void s();const l=new H4(a),u=t(a.primaryKey,a.value,l);if(u instanceof O){const h=u.catch(f=>(l.done(),O.reject(f)));r.push(h)}l.isDone?s():l.G===null?a.continue():a.continue(l.G)}}).next(()=>O.waitFor(r))}options(e,t){let r;return e!==void 0&&(typeof e=="string"?r=e:t=e),{index:r,range:t}}cursor(e){let t="next";if(e.reverse&&(t="prev"),e.index){const r=this.store.index(e.index);return e.X?r.openKeyCursor(e.range,t):r.openCursor(e.range,t)}return this.store.openCursor(e.range,t)}}function na(n){return new O((e,t)=>{n.onsuccess=r=>{const s=r.target.result;e(s)},n.onerror=r=>{const s=Ew(r.target.error);t(s)}})}let DS=!1;function Ew(n){const e=Bs.M(In());if(e>=12.2&&e<13){const t="An internal error was encountered in the Indexed Database server";if(n.message.indexOf(t)>=0){const r=new z("internal",`IOS_INDEXEDDB_BUG1: IndexedDb has thrown '${t}'. This is likely due to an unavoidable bug in iOS. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.`);return DS||(DS=!0,setTimeout(()=>{throw r},0)),r}}return n}const Gu="IndexBackfiller";class Q4{constructor(e,t){this.asyncQueue=e,this.ne=t,this.task=null}start(){this.re(15e3)}stop(){this.task&&(this.task.cancel(),this.task=null)}get started(){return this.task!==null}re(e){W(Gu,`Scheduled in ${e}ms`),this.task=this.asyncQueue.enqueueAfterDelay("index_backfill",e,async()=>{this.task=null;try{const t=await this.ne.ie();W(Gu,`Documents written: ${t}`)}catch(t){Uo(t)?W(Gu,"Ignoring IndexedDB error during index backfill: ",t):await jo(t)}await this.re(6e4)})}}class Y4{constructor(e,t){this.localStore=e,this.persistence=t}async ie(e=50){return this.persistence.runTransaction("Backfill Indexes","readwrite-primary",t=>this.se(t,e))}se(e,t){const r=new Set;let s=t,i=!0;return O.doWhile(()=>i===!0&&s>0,()=>this.localStore.indexManager.getNextCollectionGroupToUpdate(e).next(o=>{if(o!==null&&!r.has(o))return W(Gu,`Processing collection: ${o}`),this.oe(e,o,s).next(a=>{s-=a,r.add(o)});i=!1})).next(()=>t-s)}oe(e,t,r){return this.localStore.indexManager.getMinOffsetFromCollectionGroup(e,t).next(s=>this.localStore.localDocuments.getNextDocuments(e,t,s,r).next(i=>{const o=i.changes;return this.localStore.indexManager.updateIndexEntries(e,o).next(()=>this._e(s,i)).next(a=>(W(Gu,`Updating offset: ${a}`),this.localStore.indexManager.updateCollectionGroup(e,t,a))).next(()=>o.size)}))}_e(e,t){let r=e;return t.changes.forEach((s,i)=>{const o=GR(i);Iw(o,r)>0&&(r=o)}),new Br(r.readTime,r.documentKey,Math.max(t.batchId,e.largestBatchId))}}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class mr{constructor(e,t){this.previousValue=e,t&&(t.sequenceNumberHandler=r=>this.ae(r),this.ue=r=>t.writeSequenceNumber(r))}ae(e){return this.previousValue=Math.max(e,this.previousValue),this.previousValue}next(){const e=++this.previousValue;return this.ue&&this.ue(e),e}}mr.ce=-1;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const vo=-1;function ph(n){return n==null}function Pd(n){return n===0&&1/n==-1/0}function YR(n){return typeof n=="number"&&Number.isInteger(n)&&!Pd(n)&&n<=Number.MAX_SAFE_INTEGER&&n>=Number.MIN_SAFE_INTEGER}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const qg="";function tr(n){let e="";for(let t=0;t<n.length;t++)e.length>0&&(e=MS(e)),e=J4(n.get(t),e);return MS(e)}function J4(n,e){let t=e;const r=n.length;for(let s=0;s<r;s++){const i=n.charAt(s);switch(i){case"\0":t+="";break;case qg:t+="";break;default:t+=i}}return t}function MS(n){return n+qg+""}function Os(n){const e=n.length;if(ye(e>=2,64408,{path:n}),e===2)return ye(n.charAt(0)===qg&&n.charAt(1)==="",56145,{path:n}),Je.emptyPath();const t=e-2,r=[];let s="";for(let i=0;i<e;){const o=n.indexOf(qg,i);switch((o<0||o>t)&&ue(50515,{path:n}),n.charAt(o+1)){case"":const a=n.substring(i,o);let l;s.length===0?l=a:(s+=a,l=s,s=""),r.push(l);break;case"":s+=n.substring(i,o),s+="\0";break;case"":s+=n.substring(i,o+1);break;default:ue(61167,{path:n})}i=o+2}return new Je(r)}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ta="remoteDocuments",mh="owner",cl="owner",Dd="mutationQueues",X4="userId",ds="mutations",LS="batchId",ua="userMutationsIndex",OS=["userId","batchId"];/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Uf(n,e){return[n,tr(e)]}function JR(n,e,t){return[n,tr(e),t]}const Z4={},hc="documentMutations",Wg="remoteDocumentsV14",e3=["prefixPath","collectionGroup","readTime","documentId"],$f="documentKeyIndex",t3=["prefixPath","collectionGroup","documentId"],XR="collectionGroupIndex",n3=["collectionGroup","readTime","prefixPath","documentId"],Md="remoteDocumentGlobal",dv="remoteDocumentGlobalKey",fc="targets",ZR="queryTargetsIndex",r3=["canonicalId","targetId"],gc="targetDocuments",s3=["targetId","path"],Sw="documentTargetsIndex",i3=["path","targetId"],Gg="targetGlobalKey",ya="targetGlobal",Ld="collectionParents",o3=["collectionId","parent"],pc="clientMetadata",a3="clientId",Xp="bundles",l3="bundleId",Zp="namedQueries",c3="name",Tw="indexConfiguration",u3="indexId",hv="collectionGroupIndex",d3="collectionGroup",Hu="indexState",h3=["indexId","uid"],eN="sequenceNumberIndex",f3=["uid","sequenceNumber"],Ku="indexEntries",g3=["indexId","uid","arrayValue","directionalValue","orderedDocumentKey","documentKey"],tN="documentKeyIndex",p3=["indexId","uid","orderedDocumentKey"],em="documentOverlays",m3=["userId","collectionPath","documentId"],fv="collectionPathOverlayIndex",y3=["userId","collectionPath","largestBatchId"],nN="collectionGroupOverlayIndex",_3=["userId","collectionGroup","largestBatchId"],bw="globals",v3="name",rN=[Dd,ds,hc,ta,fc,mh,ya,gc,pc,Md,Ld,Xp,Zp],w3=[...rN,em],sN=[Dd,ds,hc,Wg,fc,mh,ya,gc,pc,Md,Ld,Xp,Zp,em],iN=sN,Aw=[...iN,Tw,Hu,Ku],x3=Aw,oN=[...Aw,bw],I3=oN;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class gv extends KR{constructor(e,t){super(),this.le=e,this.currentSequenceNumber=t}}function En(n,e){const t=re(n);return Bs.O(t.le,e)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function VS(n){let e=0;for(const t in n)Object.prototype.hasOwnProperty.call(n,t)&&e++;return e}function $o(n,e){for(const t in n)Object.prototype.hasOwnProperty.call(n,t)&&e(t,n[t])}function aN(n,e){const t=[];for(const r in n)Object.prototype.hasOwnProperty.call(n,r)&&t.push(e(n[r],r,n));return t}function lN(n){for(const e in n)if(Object.prototype.hasOwnProperty.call(n,e))return!1;return!0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ot{constructor(e,t){this.comparator=e,this.root=t||Un.EMPTY}insert(e,t){return new Ot(this.comparator,this.root.insert(e,t,this.comparator).copy(null,null,Un.BLACK,null,null))}remove(e){return new Ot(this.comparator,this.root.remove(e,this.comparator).copy(null,null,Un.BLACK,null,null))}get(e){let t=this.root;for(;!t.isEmpty();){const r=this.comparator(e,t.key);if(r===0)return t.value;r<0?t=t.left:r>0&&(t=t.right)}return null}indexOf(e){let t=0,r=this.root;for(;!r.isEmpty();){const s=this.comparator(e,r.key);if(s===0)return t+r.left.size;s<0?r=r.left:(t+=r.left.size+1,r=r.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal((t,r)=>(e(t,r),!1))}toString(){const e=[];return this.inorderTraversal((t,r)=>(e.push(`${t}:${r}`),!1)),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new ff(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new ff(this.root,e,this.comparator,!1)}getReverseIterator(){return new ff(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new ff(this.root,e,this.comparator,!0)}}class ff{constructor(e,t,r,s){this.isReverse=s,this.nodeStack=[];let i=1;for(;!e.isEmpty();)if(i=t?r(e.key,t):1,t&&s&&(i*=-1),i<0)e=this.isReverse?e.left:e.right;else{if(i===0){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop();const t={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return t}hasNext(){return this.nodeStack.length>0}peek(){if(this.nodeStack.length===0)return null;const e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}}class Un{constructor(e,t,r,s,i){this.key=e,this.value=t,this.color=r??Un.RED,this.left=s??Un.EMPTY,this.right=i??Un.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,t,r,s,i){return new Un(e??this.key,t??this.value,r??this.color,s??this.left,i??this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,r){let s=this;const i=r(e,s.key);return s=i<0?s.copy(null,null,null,s.left.insert(e,t,r),null):i===0?s.copy(null,t,null,null,null):s.copy(null,null,null,null,s.right.insert(e,t,r)),s.fixUp()}removeMin(){if(this.left.isEmpty())return Un.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),e=e.copy(null,null,null,e.left.removeMin(),null),e.fixUp()}remove(e,t){let r,s=this;if(t(e,s.key)<0)s.left.isEmpty()||s.left.isRed()||s.left.left.isRed()||(s=s.moveRedLeft()),s=s.copy(null,null,null,s.left.remove(e,t),null);else{if(s.left.isRed()&&(s=s.rotateRight()),s.right.isEmpty()||s.right.isRed()||s.right.left.isRed()||(s=s.moveRedRight()),t(e,s.key)===0){if(s.right.isEmpty())return Un.EMPTY;r=s.right.min(),s=s.copy(r.key,r.value,null,null,s.right.removeMin())}s=s.copy(null,null,null,null,s.right.remove(e,t))}return s.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=e.copy(null,null,null,null,e.right.rotateRight()),e=e.rotateLeft(),e=e.colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=e.rotateRight(),e=e.colorFlip()),e}rotateLeft(){const e=this.copy(null,null,Un.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){const e=this.copy(null,null,Un.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){const e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth(){const e=this.check();return Math.pow(2,e)<=this.size+1}check(){if(this.isRed()&&this.left.isRed())throw ue(43730,{key:this.key,value:this.value});if(this.right.isRed())throw ue(14113,{key:this.key,value:this.value});const e=this.left.check();if(e!==this.right.check())throw ue(27949);return e+(this.isRed()?0:1)}}Un.EMPTY=null,Un.RED=!0,Un.BLACK=!1;Un.EMPTY=new class{constructor(){this.size=0}get key(){throw ue(57766)}get value(){throw ue(16141)}get color(){throw ue(16727)}get left(){throw ue(29726)}get right(){throw ue(36894)}copy(e,t,r,s,i){return this}insert(e,t,r){return new Un(e,t)}remove(e,t){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class St{constructor(e){this.comparator=e,this.data=new Ot(this.comparator)}has(e){return this.data.get(e)!==null}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal((t,r)=>(e(t),!1))}forEachInRange(e,t){const r=this.data.getIteratorFrom(e[0]);for(;r.hasNext();){const s=r.getNext();if(this.comparator(s.key,e[1])>=0)return;t(s.key)}}forEachWhile(e,t){let r;for(r=t!==void 0?this.data.getIteratorFrom(t):this.data.getIterator();r.hasNext();)if(!e(r.getNext().key))return}firstAfterOrEqual(e){const t=this.data.getIteratorFrom(e);return t.hasNext()?t.getNext().key:null}getIterator(){return new FS(this.data.getIterator())}getIteratorFrom(e){return new FS(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let t=this;return t.size<e.size&&(t=e,e=this),e.forEach(r=>{t=t.add(r)}),t}isEqual(e){if(!(e instanceof St)||this.size!==e.size)return!1;const t=this.data.getIterator(),r=e.data.getIterator();for(;t.hasNext();){const s=t.getNext().key,i=r.getNext().key;if(this.comparator(s,i)!==0)return!1}return!0}toArray(){const e=[];return this.forEach(t=>{e.push(t)}),e}toString(){const e=[];return this.forEach(t=>e.push(t)),"SortedSet("+e.toString()+")"}copy(e){const t=new St(this.comparator);return t.data=e,t}}class FS{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}function ul(n){return n.hasNext()?n.getNext():void 0}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class yr{constructor(e){this.fields=e,e.sort(Yt.comparator)}static empty(){return new yr([])}unionWith(e){let t=new St(Yt.comparator);for(const r of this.fields)t=t.add(r);for(const r of e)t=t.add(r);return new yr(t.toArray())}covers(e){for(const t of this.fields)if(t.isPrefixOf(e))return!0;return!1}isEqual(e){return lc(this.fields,e.fields,(t,r)=>t.isEqual(r))}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class cN extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function wq(){return typeof atob<"u"}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class an{constructor(e){this.binaryString=e}static fromBase64String(e){const t=function(s){try{return atob(s)}catch(i){throw typeof DOMException<"u"&&i instanceof DOMException?new cN("Invalid base64 string: "+i):i}}(e);return new an(t)}static fromUint8Array(e){const t=function(s){let i="";for(let o=0;o<s.length;++o)i+=String.fromCharCode(s[o]);return i}(e);return new an(t)}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return function(t){return btoa(t)}(this.binaryString)}toUint8Array(){return function(t){const r=new Uint8Array(t.length);for(let s=0;s<t.length;s++)r[s]=t.charCodeAt(s);return r}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return Pe(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}}an.EMPTY_BYTE_STRING=new an("");const E3=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function wi(n){if(ye(!!n,39018),typeof n=="string"){let e=0;const t=E3.exec(n);if(ye(!!t,46558,{timestamp:n}),t[1]){let s=t[1];s=(s+"000000000").substr(0,9),e=Number(s)}const r=new Date(n);return{seconds:Math.floor(r.getTime()/1e3),nanos:e}}return{seconds:Gt(n.seconds),nanos:Gt(n.nanos)}}function Gt(n){return typeof n=="number"?n:typeof n=="string"?Number(n):0}function xi(n){return typeof n=="string"?an.fromBase64String(n):an.fromUint8Array(n)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const uN="server_timestamp",dN="__type__",hN="__previous_value__",fN="__local_write_time__";function tm(n){var t,r;return((r=(((t=n==null?void 0:n.mapValue)==null?void 0:t.fields)||{})[dN])==null?void 0:r.stringValue)===uN}function nm(n){const e=n.mapValue.fields[hN];return tm(e)?nm(e):e}function Od(n){const e=wi(n.mapValue.fields[fN].timestampValue);return new gt(e.seconds,e.nanos)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class S3{constructor(e,t,r,s,i,o,a,l,u,h){this.databaseId=e,this.appId=t,this.persistenceKey=r,this.host=s,this.ssl=i,this.forceLongPolling=o,this.autoDetectLongPolling=a,this.longPollingOptions=l,this.useFetchStreams=u,this.isUsingEmulator=h}}const Vd="(default)";class Na{constructor(e,t){this.projectId=e,this.database=t||Vd}static empty(){return new Na("","")}get isDefaultDatabase(){return this.database===Vd}isEqual(e){return e instanceof Na&&e.projectId===this.projectId&&e.database===this.database}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Cw="__type__",gN="__max__",to={mapValue:{fields:{__type__:{stringValue:gN}}}},Rw="__vector__",mc="value",Bf={nullValue:"NULL_VALUE"};function Ro(n){return"nullValue"in n?0:"booleanValue"in n?1:"integerValue"in n||"doubleValue"in n?2:"timestampValue"in n?3:"stringValue"in n?5:"bytesValue"in n?6:"referenceValue"in n?7:"geoPointValue"in n?8:"arrayValue"in n?9:"mapValue"in n?tm(n)?4:pN(n)?9007199254740991:rm(n)?10:11:ue(28295,{value:n})}function Ks(n,e){if(n===e)return!0;const t=Ro(n);if(t!==Ro(e))return!1;switch(t){case 0:case 9007199254740991:return!0;case 1:return n.booleanValue===e.booleanValue;case 4:return Od(n).isEqual(Od(e));case 3:return function(s,i){if(typeof s.timestampValue=="string"&&typeof i.timestampValue=="string"&&s.timestampValue.length===i.timestampValue.length)return s.timestampValue===i.timestampValue;const o=wi(s.timestampValue),a=wi(i.timestampValue);return o.seconds===a.seconds&&o.nanos===a.nanos}(n,e);case 5:return n.stringValue===e.stringValue;case 6:return function(s,i){return xi(s.bytesValue).isEqual(xi(i.bytesValue))}(n,e);case 7:return n.referenceValue===e.referenceValue;case 8:return function(s,i){return Gt(s.geoPointValue.latitude)===Gt(i.geoPointValue.latitude)&&Gt(s.geoPointValue.longitude)===Gt(i.geoPointValue.longitude)}(n,e);case 2:return function(s,i){if("integerValue"in s&&"integerValue"in i)return Gt(s.integerValue)===Gt(i.integerValue);if("doubleValue"in s&&"doubleValue"in i){const o=Gt(s.doubleValue),a=Gt(i.doubleValue);return o===a?Pd(o)===Pd(a):isNaN(o)&&isNaN(a)}return!1}(n,e);case 9:return lc(n.arrayValue.values||[],e.arrayValue.values||[],Ks);case 10:case 11:return function(s,i){const o=s.mapValue.fields||{},a=i.mapValue.fields||{};if(VS(o)!==VS(a))return!1;for(const l in o)if(o.hasOwnProperty(l)&&(a[l]===void 0||!Ks(o[l],a[l])))return!1;return!0}(n,e);default:return ue(52216,{left:n})}}function Fd(n,e){return(n.values||[]).find(t=>Ks(t,e))!==void 0}function No(n,e){if(n===e)return 0;const t=Ro(n),r=Ro(e);if(t!==r)return Pe(t,r);switch(t){case 0:case 9007199254740991:return 0;case 1:return Pe(n.booleanValue,e.booleanValue);case 2:return function(i,o){const a=Gt(i.integerValue||i.doubleValue),l=Gt(o.integerValue||o.doubleValue);return a<l?-1:a>l?1:a===l?0:isNaN(a)?isNaN(l)?0:-1:1}(n,e);case 3:return jS(n.timestampValue,e.timestampValue);case 4:return jS(Od(n),Od(e));case 5:return lv(n.stringValue,e.stringValue);case 6:return function(i,o){const a=xi(i),l=xi(o);return a.compareTo(l)}(n.bytesValue,e.bytesValue);case 7:return function(i,o){const a=i.split("/"),l=o.split("/");for(let u=0;u<a.length&&u<l.length;u++){const h=Pe(a[u],l[u]);if(h!==0)return h}return Pe(a.length,l.length)}(n.referenceValue,e.referenceValue);case 8:return function(i,o){const a=Pe(Gt(i.latitude),Gt(o.latitude));return a!==0?a:Pe(Gt(i.longitude),Gt(o.longitude))}(n.geoPointValue,e.geoPointValue);case 9:return US(n.arrayValue,e.arrayValue);case 10:return function(i,o){var g,y,w,C;const a=i.fields||{},l=o.fields||{},u=(g=a[mc])==null?void 0:g.arrayValue,h=(y=l[mc])==null?void 0:y.arrayValue,f=Pe(((w=u==null?void 0:u.values)==null?void 0:w.length)||0,((C=h==null?void 0:h.values)==null?void 0:C.length)||0);return f!==0?f:US(u,h)}(n.mapValue,e.mapValue);case 11:return function(i,o){if(i===to.mapValue&&o===to.mapValue)return 0;if(i===to.mapValue)return 1;if(o===to.mapValue)return-1;const a=i.fields||{},l=Object.keys(a),u=o.fields||{},h=Object.keys(u);l.sort(),h.sort();for(let f=0;f<l.length&&f<h.length;++f){const g=lv(l[f],h[f]);if(g!==0)return g;const y=No(a[l[f]],u[h[f]]);if(y!==0)return y}return Pe(l.length,h.length)}(n.mapValue,e.mapValue);default:throw ue(23264,{he:t})}}function jS(n,e){if(typeof n=="string"&&typeof e=="string"&&n.length===e.length)return Pe(n,e);const t=wi(n),r=wi(e),s=Pe(t.seconds,r.seconds);return s!==0?s:Pe(t.nanos,r.nanos)}function US(n,e){const t=n.values||[],r=e.values||[];for(let s=0;s<t.length&&s<r.length;++s){const i=No(t[s],r[s]);if(i)return i}return Pe(t.length,r.length)}function yc(n){return pv(n)}function pv(n){return"nullValue"in n?"null":"booleanValue"in n?""+n.booleanValue:"integerValue"in n?""+n.integerValue:"doubleValue"in n?""+n.doubleValue:"timestampValue"in n?function(t){const r=wi(t);return`time(${r.seconds},${r.nanos})`}(n.timestampValue):"stringValue"in n?n.stringValue:"bytesValue"in n?function(t){return xi(t).toBase64()}(n.bytesValue):"referenceValue"in n?function(t){return ne.fromName(t).toString()}(n.referenceValue):"geoPointValue"in n?function(t){return`geo(${t.latitude},${t.longitude})`}(n.geoPointValue):"arrayValue"in n?function(t){let r="[",s=!0;for(const i of t.values||[])s?s=!1:r+=",",r+=pv(i);return r+"]"}(n.arrayValue):"mapValue"in n?function(t){const r=Object.keys(t.fields||{}).sort();let s="{",i=!0;for(const o of r)i?i=!1:s+=",",s+=`${o}:${pv(t.fields[o])}`;return s+"}"}(n.mapValue):ue(61005,{value:n})}function zf(n){switch(Ro(n)){case 0:case 1:return 4;case 2:return 8;case 3:case 8:return 16;case 4:const e=nm(n);return e?16+zf(e):16;case 5:return 2*n.stringValue.length;case 6:return xi(n.bytesValue).approximateByteSize();case 7:return n.referenceValue.length;case 9:return function(r){return(r.values||[]).reduce((s,i)=>s+zf(i),0)}(n.arrayValue);case 10:case 11:return function(r){let s=0;return $o(r.fields,(i,o)=>{s+=i.length+zf(o)}),s}(n.mapValue);default:throw ue(13486,{value:n})}}function ka(n,e){return{referenceValue:`projects/${n.projectId}/databases/${n.database}/documents/${e.path.canonicalString()}`}}function mv(n){return!!n&&"integerValue"in n}function jd(n){return!!n&&"arrayValue"in n}function $S(n){return!!n&&"nullValue"in n}function BS(n){return!!n&&"doubleValue"in n&&isNaN(Number(n.doubleValue))}function qf(n){return!!n&&"mapValue"in n}function rm(n){var t,r;return((r=(((t=n==null?void 0:n.mapValue)==null?void 0:t.fields)||{})[Cw])==null?void 0:r.stringValue)===Rw}function Qu(n){if(n.geoPointValue)return{geoPointValue:{...n.geoPointValue}};if(n.timestampValue&&typeof n.timestampValue=="object")return{timestampValue:{...n.timestampValue}};if(n.mapValue){const e={mapValue:{fields:{}}};return $o(n.mapValue.fields,(t,r)=>e.mapValue.fields[t]=Qu(r)),e}if(n.arrayValue){const e={arrayValue:{values:[]}};for(let t=0;t<(n.arrayValue.values||[]).length;++t)e.arrayValue.values[t]=Qu(n.arrayValue.values[t]);return e}return{...n}}function pN(n){return(((n.mapValue||{}).fields||{}).__type__||{}).stringValue===gN}const mN={mapValue:{fields:{[Cw]:{stringValue:Rw},[mc]:{arrayValue:{}}}}};function T3(n){return"nullValue"in n?Bf:"booleanValue"in n?{booleanValue:!1}:"integerValue"in n||"doubleValue"in n?{doubleValue:NaN}:"timestampValue"in n?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"stringValue"in n?{stringValue:""}:"bytesValue"in n?{bytesValue:""}:"referenceValue"in n?ka(Na.empty(),ne.empty()):"geoPointValue"in n?{geoPointValue:{latitude:-90,longitude:-180}}:"arrayValue"in n?{arrayValue:{}}:"mapValue"in n?rm(n)?mN:{mapValue:{}}:ue(35942,{value:n})}function b3(n){return"nullValue"in n?{booleanValue:!1}:"booleanValue"in n?{doubleValue:NaN}:"integerValue"in n||"doubleValue"in n?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"timestampValue"in n?{stringValue:""}:"stringValue"in n?{bytesValue:""}:"bytesValue"in n?ka(Na.empty(),ne.empty()):"referenceValue"in n?{geoPointValue:{latitude:-90,longitude:-180}}:"geoPointValue"in n?{arrayValue:{}}:"arrayValue"in n?mN:"mapValue"in n?rm(n)?{mapValue:{}}:to:ue(61959,{value:n})}function zS(n,e){const t=No(n.value,e.value);return t!==0?t:n.inclusive&&!e.inclusive?-1:!n.inclusive&&e.inclusive?1:0}function qS(n,e){const t=No(n.value,e.value);return t!==0?t:n.inclusive&&!e.inclusive?1:!n.inclusive&&e.inclusive?-1:0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class $n{constructor(e){this.value=e}static empty(){return new $n({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let t=this.value;for(let r=0;r<e.length-1;++r)if(t=(t.mapValue.fields||{})[e.get(r)],!qf(t))return null;return t=(t.mapValue.fields||{})[e.lastSegment()],t||null}}set(e,t){this.getFieldsMap(e.popLast())[e.lastSegment()]=Qu(t)}setAll(e){let t=Yt.emptyPath(),r={},s=[];e.forEach((o,a)=>{if(!t.isImmediateParentOf(a)){const l=this.getFieldsMap(t);this.applyChanges(l,r,s),r={},s=[],t=a.popLast()}o?r[a.lastSegment()]=Qu(o):s.push(a.lastSegment())});const i=this.getFieldsMap(t);this.applyChanges(i,r,s)}delete(e){const t=this.field(e.popLast());qf(t)&&t.mapValue.fields&&delete t.mapValue.fields[e.lastSegment()]}isEqual(e){return Ks(this.value,e.value)}getFieldsMap(e){let t=this.value;t.mapValue.fields||(t.mapValue={fields:{}});for(let r=0;r<e.length;++r){let s=t.mapValue.fields[e.get(r)];qf(s)&&s.mapValue.fields||(s={mapValue:{fields:{}}},t.mapValue.fields[e.get(r)]=s),t=s}return t.mapValue.fields}applyChanges(e,t,r){$o(t,(s,i)=>e[s]=i);for(const s of r)delete e[s]}clone(){return new $n(Qu(this.value))}}function yN(n){const e=[];return $o(n.fields,(t,r)=>{const s=new Yt([t]);if(qf(r)){const i=yN(r.mapValue).fields;if(i.length===0)e.push(s);else for(const o of i)e.push(s.child(o))}else e.push(s)}),new yr(e)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ut{constructor(e,t,r,s,i,o,a){this.key=e,this.documentType=t,this.version=r,this.readTime=s,this.createTime=i,this.data=o,this.documentState=a}static newInvalidDocument(e){return new Ut(e,0,Ie.min(),Ie.min(),Ie.min(),$n.empty(),0)}static newFoundDocument(e,t,r,s){return new Ut(e,1,t,Ie.min(),r,s,0)}static newNoDocument(e,t){return new Ut(e,2,t,Ie.min(),Ie.min(),$n.empty(),0)}static newUnknownDocument(e,t){return new Ut(e,3,t,Ie.min(),Ie.min(),$n.empty(),2)}convertToFoundDocument(e,t){return!this.createTime.isEqual(Ie.min())||this.documentType!==2&&this.documentType!==0||(this.createTime=e),this.version=e,this.documentType=1,this.data=t,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=$n.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=$n.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=Ie.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return this.documentState===1}get hasCommittedMutations(){return this.documentState===2}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return this.documentType!==0}isFoundDocument(){return this.documentType===1}isNoDocument(){return this.documentType===2}isUnknownDocument(){return this.documentType===3}isEqual(e){return e instanceof Ut&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new Ut(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ko{constructor(e,t){this.position=e,this.inclusive=t}}function WS(n,e,t){let r=0;for(let s=0;s<n.position.length;s++){const i=e[s],o=n.position[s];if(i.field.isKeyField()?r=ne.comparator(ne.fromName(o.referenceValue),t.key):r=No(o,t.data.field(i.field)),i.dir==="desc"&&(r*=-1),r!==0)break}return r}function GS(n,e){if(n===null)return e===null;if(e===null||n.inclusive!==e.inclusive||n.position.length!==e.position.length)return!1;for(let t=0;t<n.position.length;t++)if(!Ks(n.position[t],e.position[t]))return!1;return!0}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ud{constructor(e,t="asc"){this.field=e,this.dir=t}}function A3(n,e){return n.dir===e.dir&&n.field.isEqual(e.field)}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class _N{}class st extends _N{constructor(e,t,r){super(),this.field=e,this.op=t,this.value=r}static create(e,t,r){return e.isKeyField()?t==="in"||t==="not-in"?this.createKeyFieldInFilter(e,t,r):new C3(e,t,r):t==="array-contains"?new k3(e,r):t==="in"?new SN(e,r):t==="not-in"?new P3(e,r):t==="array-contains-any"?new D3(e,r):new st(e,t,r)}static createKeyFieldInFilter(e,t,r){return t==="in"?new R3(e,r):new N3(e,r)}matches(e){const t=e.data.field(this.field);return this.op==="!="?t!==null&&t.nullValue===void 0&&this.matchesComparison(No(t,this.value)):t!==null&&Ro(this.value)===Ro(t)&&this.matchesComparison(No(t,this.value))}matchesComparison(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return e===0;case"!=":return e!==0;case">":return e>0;case">=":return e>=0;default:return ue(47266,{operator:this.op})}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}}class It extends _N{constructor(e,t){super(),this.filters=e,this.op=t,this.Pe=null}static create(e,t){return new It(e,t)}matches(e){return _c(this)?this.filters.find(t=>!t.matches(e))===void 0:this.filters.find(t=>t.matches(e))!==void 0}getFlattenedFilters(){return this.Pe!==null||(this.Pe=this.filters.reduce((e,t)=>e.concat(t.getFlattenedFilters()),[])),this.Pe}getFilters(){return Object.assign([],this.filters)}}function _c(n){return n.op==="and"}function yv(n){return n.op==="or"}function Nw(n){return vN(n)&&_c(n)}function vN(n){for(const e of n.filters)if(e instanceof It)return!1;return!0}function _v(n){if(n instanceof st)return n.field.canonicalString()+n.op.toString()+yc(n.value);if(Nw(n))return n.filters.map(e=>_v(e)).join(",");{const e=n.filters.map(t=>_v(t)).join(",");return`${n.op}(${e})`}}function wN(n,e){return n instanceof st?function(r,s){return s instanceof st&&r.op===s.op&&r.field.isEqual(s.field)&&Ks(r.value,s.value)}(n,e):n instanceof It?function(r,s){return s instanceof It&&r.op===s.op&&r.filters.length===s.filters.length?r.filters.reduce((i,o,a)=>i&&wN(o,s.filters[a]),!0):!1}(n,e):void ue(19439)}function xN(n,e){const t=n.filters.concat(e);return It.create(t,n.op)}function IN(n){return n instanceof st?function(t){return`${t.field.canonicalString()} ${t.op} ${yc(t.value)}`}(n):n instanceof It?function(t){return t.op.toString()+" {"+t.getFilters().map(IN).join(" ,")+"}"}(n):"Filter"}class C3 extends st{constructor(e,t,r){super(e,t,r),this.key=ne.fromName(r.referenceValue)}matches(e){const t=ne.comparator(e.key,this.key);return this.matchesComparison(t)}}class R3 extends st{constructor(e,t){super(e,"in",t),this.keys=EN("in",t)}matches(e){return this.keys.some(t=>t.isEqual(e.key))}}class N3 extends st{constructor(e,t){super(e,"not-in",t),this.keys=EN("not-in",t)}matches(e){return!this.keys.some(t=>t.isEqual(e.key))}}function EN(n,e){var t;return(((t=e.arrayValue)==null?void 0:t.values)||[]).map(r=>ne.fromName(r.referenceValue))}class k3 extends st{constructor(e,t){super(e,"array-contains",t)}matches(e){const t=e.data.field(this.field);return jd(t)&&Fd(t.arrayValue,this.value)}}class SN extends st{constructor(e,t){super(e,"in",t)}matches(e){const t=e.data.field(this.field);return t!==null&&Fd(this.value.arrayValue,t)}}class P3 extends st{constructor(e,t){super(e,"not-in",t)}matches(e){if(Fd(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;const t=e.data.field(this.field);return t!==null&&t.nullValue===void 0&&!Fd(this.value.arrayValue,t)}}class D3 extends st{constructor(e,t){super(e,"array-contains-any",t)}matches(e){const t=e.data.field(this.field);return!(!jd(t)||!t.arrayValue.values)&&t.arrayValue.values.some(r=>Fd(this.value.arrayValue,r))}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class M3{constructor(e,t=null,r=[],s=[],i=null,o=null,a=null){this.path=e,this.collectionGroup=t,this.orderBy=r,this.filters=s,this.limit=i,this.startAt=o,this.endAt=a,this.Te=null}}function vv(n,e=null,t=[],r=[],s=null,i=null,o=null){return new M3(n,e,t,r,s,i,o)}function Pa(n){const e=re(n);if(e.Te===null){let t=e.path.canonicalString();e.collectionGroup!==null&&(t+="|cg:"+e.collectionGroup),t+="|f:",t+=e.filters.map(r=>_v(r)).join(","),t+="|ob:",t+=e.orderBy.map(r=>function(i){return i.field.canonicalString()+i.dir}(r)).join(","),ph(e.limit)||(t+="|l:",t+=e.limit),e.startAt&&(t+="|lb:",t+=e.startAt.inclusive?"b:":"a:",t+=e.startAt.position.map(r=>yc(r)).join(",")),e.endAt&&(t+="|ub:",t+=e.endAt.inclusive?"a:":"b:",t+=e.endAt.position.map(r=>yc(r)).join(",")),e.Te=t}return e.Te}function yh(n,e){if(n.limit!==e.limit||n.orderBy.length!==e.orderBy.length)return!1;for(let t=0;t<n.orderBy.length;t++)if(!A3(n.orderBy[t],e.orderBy[t]))return!1;if(n.filters.length!==e.filters.length)return!1;for(let t=0;t<n.filters.length;t++)if(!wN(n.filters[t],e.filters[t]))return!1;return n.collectionGroup===e.collectionGroup&&!!n.path.isEqual(e.path)&&!!GS(n.startAt,e.startAt)&&GS(n.endAt,e.endAt)}function Hg(n){return ne.isDocumentKey(n.path)&&n.collectionGroup===null&&n.filters.length===0}function Kg(n,e){return n.filters.filter(t=>t instanceof st&&t.field.isEqual(e))}function HS(n,e,t){let r=Bf,s=!0;for(const i of Kg(n,e)){let o=Bf,a=!0;switch(i.op){case"<":case"<=":o=T3(i.value);break;case"==":case"in":case">=":o=i.value;break;case">":o=i.value,a=!1;break;case"!=":case"not-in":o=Bf}zS({value:r,inclusive:s},{value:o,inclusive:a})<0&&(r=o,s=a)}if(t!==null){for(let i=0;i<n.orderBy.length;++i)if(n.orderBy[i].field.isEqual(e)){const o=t.position[i];zS({value:r,inclusive:s},{value:o,inclusive:t.inclusive})<0&&(r=o,s=t.inclusive);break}}return{value:r,inclusive:s}}function KS(n,e,t){let r=to,s=!0;for(const i of Kg(n,e)){let o=to,a=!0;switch(i.op){case">=":case">":o=b3(i.value),a=!1;break;case"==":case"in":case"<=":o=i.value;break;case"<":o=i.value,a=!1;break;case"!=":case"not-in":o=to}qS({value:r,inclusive:s},{value:o,inclusive:a})>0&&(r=o,s=a)}if(t!==null){for(let i=0;i<n.orderBy.length;++i)if(n.orderBy[i].field.isEqual(e)){const o=t.position[i];qS({value:r,inclusive:s},{value:o,inclusive:t.inclusive})>0&&(r=o,s=t.inclusive);break}}return{value:r,inclusive:s}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ai{constructor(e,t=null,r=[],s=[],i=null,o="F",a=null,l=null){this.path=e,this.collectionGroup=t,this.explicitOrderBy=r,this.filters=s,this.limit=i,this.limitType=o,this.startAt=a,this.endAt=l,this.Ie=null,this.Ee=null,this.de=null,this.startAt,this.endAt}}function TN(n,e,t,r,s,i,o,a){return new Ai(n,e,t,r,s,i,o,a)}function Vc(n){return new Ai(n)}function QS(n){return n.filters.length===0&&n.limit===null&&n.startAt==null&&n.endAt==null&&(n.explicitOrderBy.length===0||n.explicitOrderBy.length===1&&n.explicitOrderBy[0].field.isKeyField())}function kw(n){return n.collectionGroup!==null}function Bl(n){const e=re(n);if(e.Ie===null){e.Ie=[];const t=new Set;for(const i of e.explicitOrderBy)e.Ie.push(i),t.add(i.field.canonicalString());const r=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc";(function(o){let a=new St(Yt.comparator);return o.filters.forEach(l=>{l.getFlattenedFilters().forEach(u=>{u.isInequality()&&(a=a.add(u.field))})}),a})(e).forEach(i=>{t.has(i.canonicalString())||i.isKeyField()||e.Ie.push(new Ud(i,r))}),t.has(Yt.keyField().canonicalString())||e.Ie.push(new Ud(Yt.keyField(),r))}return e.Ie}function nr(n){const e=re(n);return e.Ee||(e.Ee=AN(e,Bl(n))),e.Ee}function bN(n){const e=re(n);return e.de||(e.de=AN(e,n.explicitOrderBy)),e.de}function AN(n,e){if(n.limitType==="F")return vv(n.path,n.collectionGroup,e,n.filters,n.limit,n.startAt,n.endAt);{e=e.map(s=>{const i=s.dir==="desc"?"asc":"desc";return new Ud(s.field,i)});const t=n.endAt?new ko(n.endAt.position,n.endAt.inclusive):null,r=n.startAt?new ko(n.startAt.position,n.startAt.inclusive):null;return vv(n.path,n.collectionGroup,e,n.filters,n.limit,t,r)}}function wv(n,e){const t=n.filters.concat([e]);return new Ai(n.path,n.collectionGroup,n.explicitOrderBy.slice(),t,n.limit,n.limitType,n.startAt,n.endAt)}function Qg(n,e,t){return new Ai(n.path,n.collectionGroup,n.explicitOrderBy.slice(),n.filters.slice(),e,t,n.startAt,n.endAt)}function _h(n,e){return yh(nr(n),nr(e))&&n.limitType===e.limitType}function CN(n){return`${Pa(nr(n))}|lt:${n.limitType}`}function yl(n){return`Query(target=${function(t){let r=t.path.canonicalString();return t.collectionGroup!==null&&(r+=" collectionGroup="+t.collectionGroup),t.filters.length>0&&(r+=`, filters: [${t.filters.map(s=>IN(s)).join(", ")}]`),ph(t.limit)||(r+=", limit: "+t.limit),t.orderBy.length>0&&(r+=`, orderBy: [${t.orderBy.map(s=>function(o){return`${o.field.canonicalString()} (${o.dir})`}(s)).join(", ")}]`),t.startAt&&(r+=", startAt: ",r+=t.startAt.inclusive?"b:":"a:",r+=t.startAt.position.map(s=>yc(s)).join(",")),t.endAt&&(r+=", endAt: ",r+=t.endAt.inclusive?"a:":"b:",r+=t.endAt.position.map(s=>yc(s)).join(",")),`Target(${r})`}(nr(n))}; limitType=${n.limitType})`}function vh(n,e){return e.isFoundDocument()&&function(r,s){const i=s.key.path;return r.collectionGroup!==null?s.key.hasCollectionId(r.collectionGroup)&&r.path.isPrefixOf(i):ne.isDocumentKey(r.path)?r.path.isEqual(i):r.path.isImmediateParentOf(i)}(n,e)&&function(r,s){for(const i of Bl(r))if(!i.field.isKeyField()&&s.data.field(i.field)===null)return!1;return!0}(n,e)&&function(r,s){for(const i of r.filters)if(!i.matches(s))return!1;return!0}(n,e)&&function(r,s){return!(r.startAt&&!function(o,a,l){const u=WS(o,a,l);return o.inclusive?u<=0:u<0}(r.startAt,Bl(r),s)||r.endAt&&!function(o,a,l){const u=WS(o,a,l);return o.inclusive?u>=0:u>0}(r.endAt,Bl(r),s))}(n,e)}function RN(n){return n.collectionGroup||(n.path.length%2==1?n.path.lastSegment():n.path.get(n.path.length-2))}function NN(n){return(e,t)=>{let r=!1;for(const s of Bl(n)){const i=L3(s,e,t);if(i!==0)return i;r=r||s.field.isKeyField()}return 0}}function L3(n,e,t){const r=n.field.isKeyField()?ne.comparator(e.key,t.key):function(i,o,a){const l=o.data.field(i),u=a.data.field(i);return l!==null&&u!==null?No(l,u):ue(42886)}(n.field,e,t);switch(n.dir){case"asc":return r;case"desc":return-1*r;default:return ue(19790,{direction:n.dir})}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ci{constructor(e,t){this.mapKeyFn=e,this.equalsFn=t,this.inner={},this.innerSize=0}get(e){const t=this.mapKeyFn(e),r=this.inner[t];if(r!==void 0){for(const[s,i]of r)if(this.equalsFn(s,e))return i}}has(e){return this.get(e)!==void 0}set(e,t){const r=this.mapKeyFn(e),s=this.inner[r];if(s===void 0)return this.inner[r]=[[e,t]],void this.innerSize++;for(let i=0;i<s.length;i++)if(this.equalsFn(s[i][0],e))return void(s[i]=[e,t]);s.push([e,t]),this.innerSize++}delete(e){const t=this.mapKeyFn(e),r=this.inner[t];if(r===void 0)return!1;for(let s=0;s<r.length;s++)if(this.equalsFn(r[s][0],e))return r.length===1?delete this.inner[t]:r.splice(s,1),this.innerSize--,!0;return!1}forEach(e){$o(this.inner,(t,r)=>{for(const[s,i]of r)e(s,i)})}isEmpty(){return lN(this.inner)}size(){return this.innerSize}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const O3=new Ot(ne.comparator);function _r(){return O3}const kN=new Ot(ne.comparator);function Au(...n){let e=kN;for(const t of n)e=e.insert(t.key,t);return e}function PN(n){let e=kN;return n.forEach((t,r)=>e=e.insert(t,r.overlayedDocument)),e}function Vs(){return Yu()}function DN(){return Yu()}function Yu(){return new Ci(n=>n.toString(),(n,e)=>n.isEqual(e))}const V3=new Ot(ne.comparator),F3=new St(ne.comparator);function je(...n){let e=F3;for(const t of n)e=e.add(t);return e}const j3=new St(Pe);function Pw(){return j3}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Dw(n,e){if(n.useProto3Json){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:Pd(e)?"-0":e}}function MN(n){return{integerValue:""+n}}function LN(n,e){return YR(e)?MN(e):Dw(n,e)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class sm{constructor(){this._=void 0}}function U3(n,e,t){return n instanceof vc?function(s,i){const o={fields:{[dN]:{stringValue:uN},[fN]:{timestampValue:{seconds:s.seconds,nanos:s.nanoseconds}}}};return i&&tm(i)&&(i=nm(i)),i&&(o.fields[hN]=i),{mapValue:o}}(t,e):n instanceof Da?VN(n,e):n instanceof Ma?FN(n,e):function(s,i){const o=ON(s,i),a=YS(o)+YS(s.Ae);return mv(o)&&mv(s.Ae)?MN(a):Dw(s.serializer,a)}(n,e)}function $3(n,e,t){return n instanceof Da?VN(n,e):n instanceof Ma?FN(n,e):t}function ON(n,e){return n instanceof wc?function(r){return mv(r)||function(i){return!!i&&"doubleValue"in i}(r)}(e)?e:{integerValue:0}:null}class vc extends sm{}class Da extends sm{constructor(e){super(),this.elements=e}}function VN(n,e){const t=jN(e);for(const r of n.elements)t.some(s=>Ks(s,r))||t.push(r);return{arrayValue:{values:t}}}class Ma extends sm{constructor(e){super(),this.elements=e}}function FN(n,e){let t=jN(e);for(const r of n.elements)t=t.filter(s=>!Ks(s,r));return{arrayValue:{values:t}}}class wc extends sm{constructor(e,t){super(),this.serializer=e,this.Ae=t}}function YS(n){return Gt(n.integerValue||n.doubleValue)}function jN(n){return jd(n)&&n.arrayValue.values?n.arrayValue.values.slice():[]}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class wh{constructor(e,t){this.field=e,this.transform=t}}function B3(n,e){return n.field.isEqual(e.field)&&function(r,s){return r instanceof Da&&s instanceof Da||r instanceof Ma&&s instanceof Ma?lc(r.elements,s.elements,Ks):r instanceof wc&&s instanceof wc?Ks(r.Ae,s.Ae):r instanceof vc&&s instanceof vc}(n.transform,e.transform)}class z3{constructor(e,t){this.version=e,this.transformResults=t}}class Jt{constructor(e,t){this.updateTime=e,this.exists=t}static none(){return new Jt}static exists(e){return new Jt(void 0,e)}static updateTime(e){return new Jt(e)}get isNone(){return this.updateTime===void 0&&this.exists===void 0}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}}function Wf(n,e){return n.updateTime!==void 0?e.isFoundDocument()&&e.version.isEqual(n.updateTime):n.exists===void 0||n.exists===e.isFoundDocument()}class im{}function UN(n,e){if(!n.hasLocalMutations||e&&e.fields.length===0)return null;if(e===null)return n.isNoDocument()?new jc(n.key,Jt.none()):new Fc(n.key,n.data,Jt.none());{const t=n.data,r=$n.empty();let s=new St(Yt.comparator);for(let i of e.fields)if(!s.has(i)){let o=t.field(i);o===null&&i.length>1&&(i=i.popLast(),o=t.field(i)),o===null?r.delete(i):r.set(i,o),s=s.add(i)}return new Ri(n.key,r,new yr(s.toArray()),Jt.none())}}function q3(n,e,t){n instanceof Fc?function(s,i,o){const a=s.value.clone(),l=XS(s.fieldTransforms,i,o.transformResults);a.setAll(l),i.convertToFoundDocument(o.version,a).setHasCommittedMutations()}(n,e,t):n instanceof Ri?function(s,i,o){if(!Wf(s.precondition,i))return void i.convertToUnknownDocument(o.version);const a=XS(s.fieldTransforms,i,o.transformResults),l=i.data;l.setAll($N(s)),l.setAll(a),i.convertToFoundDocument(o.version,l).setHasCommittedMutations()}(n,e,t):function(s,i,o){i.convertToNoDocument(o.version).setHasCommittedMutations()}(0,e,t)}function Ju(n,e,t,r){return n instanceof Fc?function(i,o,a,l){if(!Wf(i.precondition,o))return a;const u=i.value.clone(),h=ZS(i.fieldTransforms,l,o);return u.setAll(h),o.convertToFoundDocument(o.version,u).setHasLocalMutations(),null}(n,e,t,r):n instanceof Ri?function(i,o,a,l){if(!Wf(i.precondition,o))return a;const u=ZS(i.fieldTransforms,l,o),h=o.data;return h.setAll($N(i)),h.setAll(u),o.convertToFoundDocument(o.version,h).setHasLocalMutations(),a===null?null:a.unionWith(i.fieldMask.fields).unionWith(i.fieldTransforms.map(f=>f.field))}(n,e,t,r):function(i,o,a){return Wf(i.precondition,o)?(o.convertToNoDocument(o.version).setHasLocalMutations(),null):a}(n,e,t)}function W3(n,e){let t=null;for(const r of n.fieldTransforms){const s=e.data.field(r.field),i=ON(r.transform,s||null);i!=null&&(t===null&&(t=$n.empty()),t.set(r.field,i))}return t||null}function JS(n,e){return n.type===e.type&&!!n.key.isEqual(e.key)&&!!n.precondition.isEqual(e.precondition)&&!!function(r,s){return r===void 0&&s===void 0||!(!r||!s)&&lc(r,s,(i,o)=>B3(i,o))}(n.fieldTransforms,e.fieldTransforms)&&(n.type===0?n.value.isEqual(e.value):n.type!==1||n.data.isEqual(e.data)&&n.fieldMask.isEqual(e.fieldMask))}class Fc extends im{constructor(e,t,r,s=[]){super(),this.key=e,this.value=t,this.precondition=r,this.fieldTransforms=s,this.type=0}getFieldMask(){return null}}class Ri extends im{constructor(e,t,r,s,i=[]){super(),this.key=e,this.data=t,this.fieldMask=r,this.precondition=s,this.fieldTransforms=i,this.type=1}getFieldMask(){return this.fieldMask}}function $N(n){const e=new Map;return n.fieldMask.fields.forEach(t=>{if(!t.isEmpty()){const r=n.data.field(t);e.set(t,r)}}),e}function XS(n,e,t){const r=new Map;ye(n.length===t.length,32656,{Re:t.length,Ve:n.length});for(let s=0;s<t.length;s++){const i=n[s],o=i.transform,a=e.data.field(i.field);r.set(i.field,$3(o,a,t[s]))}return r}function ZS(n,e,t){const r=new Map;for(const s of n){const i=s.transform,o=t.data.field(s.field);r.set(s.field,U3(i,o,e))}return r}class jc extends im{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class Mw extends im{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Lw{constructor(e,t,r,s){this.batchId=e,this.localWriteTime=t,this.baseMutations=r,this.mutations=s}applyToRemoteDocument(e,t){const r=t.mutationResults;for(let s=0;s<this.mutations.length;s++){const i=this.mutations[s];i.key.isEqual(e.key)&&q3(i,e,r[s])}}applyToLocalView(e,t){for(const r of this.baseMutations)r.key.isEqual(e.key)&&(t=Ju(r,e,t,this.localWriteTime));for(const r of this.mutations)r.key.isEqual(e.key)&&(t=Ju(r,e,t,this.localWriteTime));return t}applyToLocalDocumentSet(e,t){const r=DN();return this.mutations.forEach(s=>{const i=e.get(s.key),o=i.overlayedDocument;let a=this.applyToLocalView(o,i.mutatedFields);a=t.has(s.key)?null:a;const l=UN(o,a);l!==null&&r.set(s.key,l),o.isValidDocument()||o.convertToNoDocument(Ie.min())}),r}keys(){return this.mutations.reduce((e,t)=>e.add(t.key),je())}isEqual(e){return this.batchId===e.batchId&&lc(this.mutations,e.mutations,(t,r)=>JS(t,r))&&lc(this.baseMutations,e.baseMutations,(t,r)=>JS(t,r))}}class Ow{constructor(e,t,r,s){this.batch=e,this.commitVersion=t,this.mutationResults=r,this.docVersions=s}static from(e,t,r){ye(e.mutations.length===r.length,58842,{me:e.mutations.length,fe:r.length});let s=function(){return V3}();const i=e.mutations;for(let o=0;o<i.length;o++)s=s.insert(i[o].key,r[o].version);return new Ow(e,t,r,s)}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Vw{constructor(e,t){this.largestBatchId=e,this.mutation=t}getKey(){return this.mutation.key}isEqual(e){return e!==null&&this.mutation===e.mutation}toString(){return`Overlay{
      largestBatchId: ${this.largestBatchId},
      mutation: ${this.mutation.toString()}
    }`}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class BN{constructor(e,t,r){this.alias=e,this.aggregateType=t,this.fieldPath=r}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class G3{constructor(e,t){this.count=e,this.unchangedNames=t}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var gn,ot;function zN(n){switch(n){case U.OK:return ue(64938);case U.CANCELLED:case U.UNKNOWN:case U.DEADLINE_EXCEEDED:case U.RESOURCE_EXHAUSTED:case U.INTERNAL:case U.UNAVAILABLE:case U.UNAUTHENTICATED:return!1;case U.INVALID_ARGUMENT:case U.NOT_FOUND:case U.ALREADY_EXISTS:case U.PERMISSION_DENIED:case U.FAILED_PRECONDITION:case U.ABORTED:case U.OUT_OF_RANGE:case U.UNIMPLEMENTED:case U.DATA_LOSS:return!0;default:return ue(15467,{code:n})}}function qN(n){if(n===void 0)return dn("GRPC error has no .code"),U.UNKNOWN;switch(n){case gn.OK:return U.OK;case gn.CANCELLED:return U.CANCELLED;case gn.UNKNOWN:return U.UNKNOWN;case gn.DEADLINE_EXCEEDED:return U.DEADLINE_EXCEEDED;case gn.RESOURCE_EXHAUSTED:return U.RESOURCE_EXHAUSTED;case gn.INTERNAL:return U.INTERNAL;case gn.UNAVAILABLE:return U.UNAVAILABLE;case gn.UNAUTHENTICATED:return U.UNAUTHENTICATED;case gn.INVALID_ARGUMENT:return U.INVALID_ARGUMENT;case gn.NOT_FOUND:return U.NOT_FOUND;case gn.ALREADY_EXISTS:return U.ALREADY_EXISTS;case gn.PERMISSION_DENIED:return U.PERMISSION_DENIED;case gn.FAILED_PRECONDITION:return U.FAILED_PRECONDITION;case gn.ABORTED:return U.ABORTED;case gn.OUT_OF_RANGE:return U.OUT_OF_RANGE;case gn.UNIMPLEMENTED:return U.UNIMPLEMENTED;case gn.DATA_LOSS:return U.DATA_LOSS;default:return ue(39323,{code:n})}}(ot=gn||(gn={}))[ot.OK=0]="OK",ot[ot.CANCELLED=1]="CANCELLED",ot[ot.UNKNOWN=2]="UNKNOWN",ot[ot.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",ot[ot.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",ot[ot.NOT_FOUND=5]="NOT_FOUND",ot[ot.ALREADY_EXISTS=6]="ALREADY_EXISTS",ot[ot.PERMISSION_DENIED=7]="PERMISSION_DENIED",ot[ot.UNAUTHENTICATED=16]="UNAUTHENTICATED",ot[ot.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",ot[ot.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",ot[ot.ABORTED=10]="ABORTED",ot[ot.OUT_OF_RANGE=11]="OUT_OF_RANGE",ot[ot.UNIMPLEMENTED=12]="UNIMPLEMENTED",ot[ot.INTERNAL=13]="INTERNAL",ot[ot.UNAVAILABLE=14]="UNAVAILABLE",ot[ot.DATA_LOSS=15]="DATA_LOSS";/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Xu=null;/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function WN(){return new TextEncoder}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const H3=new _o([4294967295,4294967295],0);function eT(n){const e=WN().encode(n),t=new MR;return t.update(e),new Uint8Array(t.digest())}function tT(n){const e=new DataView(n.buffer),t=e.getUint32(0,!0),r=e.getUint32(4,!0),s=e.getUint32(8,!0),i=e.getUint32(12,!0);return[new _o([t,r],0),new _o([s,i],0)]}class Fw{constructor(e,t,r){if(this.bitmap=e,this.padding=t,this.hashCount=r,t<0||t>=8)throw new Cu(`Invalid padding: ${t}`);if(r<0)throw new Cu(`Invalid hash count: ${r}`);if(e.length>0&&this.hashCount===0)throw new Cu(`Invalid hash count: ${r}`);if(e.length===0&&t!==0)throw new Cu(`Invalid padding when bitmap length is 0: ${t}`);this.ge=8*e.length-t,this.pe=_o.fromNumber(this.ge)}ye(e,t,r){let s=e.add(t.multiply(_o.fromNumber(r)));return s.compare(H3)===1&&(s=new _o([s.getBits(0),s.getBits(1)],0)),s.modulo(this.pe).toNumber()}we(e){return!!(this.bitmap[Math.floor(e/8)]&1<<e%8)}mightContain(e){if(this.ge===0)return!1;const t=eT(e),[r,s]=tT(t);for(let i=0;i<this.hashCount;i++){const o=this.ye(r,s,i);if(!this.we(o))return!1}return!0}static create(e,t,r){const s=e%8==0?0:8-e%8,i=new Uint8Array(Math.ceil(e/8)),o=new Fw(i,s,t);return r.forEach(a=>o.insert(a)),o}insert(e){if(this.ge===0)return;const t=eT(e),[r,s]=tT(t);for(let i=0;i<this.hashCount;i++){const o=this.ye(r,s,i);this.Se(o)}}Se(e){const t=Math.floor(e/8),r=e%8;this.bitmap[t]|=1<<r}}class Cu extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class xh{constructor(e,t,r,s,i){this.snapshotVersion=e,this.targetChanges=t,this.targetMismatches=r,this.documentUpdates=s,this.resolvedLimboDocuments=i}static createSynthesizedRemoteEventForCurrentChange(e,t,r){const s=new Map;return s.set(e,Ih.createSynthesizedTargetChangeForCurrentChange(e,t,r)),new xh(Ie.min(),s,new Ot(Pe),_r(),je())}}class Ih{constructor(e,t,r,s,i){this.resumeToken=e,this.current=t,this.addedDocuments=r,this.modifiedDocuments=s,this.removedDocuments=i}static createSynthesizedTargetChangeForCurrentChange(e,t,r){return new Ih(r,t,je(),je(),je())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Gf{constructor(e,t,r,s){this.be=e,this.removedTargetIds=t,this.key=r,this.De=s}}class GN{constructor(e,t){this.targetId=e,this.Ce=t}}class HN{constructor(e,t,r=an.EMPTY_BYTE_STRING,s=null){this.state=e,this.targetIds=t,this.resumeToken=r,this.cause=s}}class nT{constructor(){this.ve=0,this.Fe=rT(),this.Me=an.EMPTY_BYTE_STRING,this.xe=!1,this.Oe=!0}get current(){return this.xe}get resumeToken(){return this.Me}get Ne(){return this.ve!==0}get Be(){return this.Oe}Le(e){e.approximateByteSize()>0&&(this.Oe=!0,this.Me=e)}ke(){let e=je(),t=je(),r=je();return this.Fe.forEach((s,i)=>{switch(i){case 0:e=e.add(s);break;case 2:t=t.add(s);break;case 1:r=r.add(s);break;default:ue(38017,{changeType:i})}}),new Ih(this.Me,this.xe,e,t,r)}qe(){this.Oe=!1,this.Fe=rT()}Qe(e,t){this.Oe=!0,this.Fe=this.Fe.insert(e,t)}$e(e){this.Oe=!0,this.Fe=this.Fe.remove(e)}Ue(){this.ve+=1}Ke(){this.ve-=1,ye(this.ve>=0,3241,{ve:this.ve})}We(){this.Oe=!0,this.xe=!0}}class K3{constructor(e){this.Ge=e,this.ze=new Map,this.je=_r(),this.Je=gf(),this.He=gf(),this.Ye=new Ot(Pe)}Ze(e){for(const t of e.be)e.De&&e.De.isFoundDocument()?this.Xe(t,e.De):this.et(t,e.key,e.De);for(const t of e.removedTargetIds)this.et(t,e.key,e.De)}tt(e){this.forEachTarget(e,t=>{const r=this.nt(t);switch(e.state){case 0:this.rt(t)&&r.Le(e.resumeToken);break;case 1:r.Ke(),r.Ne||r.qe(),r.Le(e.resumeToken);break;case 2:r.Ke(),r.Ne||this.removeTarget(t);break;case 3:this.rt(t)&&(r.We(),r.Le(e.resumeToken));break;case 4:this.rt(t)&&(this.it(t),r.Le(e.resumeToken));break;default:ue(56790,{state:e.state})}})}forEachTarget(e,t){e.targetIds.length>0?e.targetIds.forEach(t):this.ze.forEach((r,s)=>{this.rt(s)&&t(s)})}st(e){const t=e.targetId,r=e.Ce.count,s=this.ot(t);if(s){const i=s.target;if(Hg(i))if(r===0){const o=new ne(i.path);this.et(t,o,Ut.newNoDocument(o,Ie.min()))}else ye(r===1,20013,{expectedCount:r});else{const o=this._t(t);if(o!==r){const a=this.ut(e),l=a?this.ct(a,e,o):1;if(l!==0){this.it(t);const u=l===2?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.Ye=this.Ye.insert(t,u)}Xu==null||Xu.lt(function(h,f,g,y,w){var A,I,R;const C={localCacheCount:h,existenceFilterCount:f.count,databaseId:g.database,projectId:g.projectId},M=f.unchangedNames;return M&&(C.bloomFilter={applied:w===0,hashCount:(M==null?void 0:M.hashCount)??0,bitmapLength:((I=(A=M==null?void 0:M.bits)==null?void 0:A.bitmap)==null?void 0:I.length)??0,padding:((R=M==null?void 0:M.bits)==null?void 0:R.padding)??0,mightContain:D=>(y==null?void 0:y.mightContain(D))??!1}),C}(o,e.Ce,this.Ge.ht(),a,l))}}}}ut(e){const t=e.Ce.unchangedNames;if(!t||!t.bits)return null;const{bits:{bitmap:r="",padding:s=0},hashCount:i=0}=t;let o,a;try{o=xi(r).toUint8Array()}catch(l){if(l instanceof cN)return rs("Decoding the base64 bloom filter in existence filter failed ("+l.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw l}try{a=new Fw(o,s,i)}catch(l){return rs(l instanceof Cu?"BloomFilter error: ":"Applying bloom filter failed: ",l),null}return a.ge===0?null:a}ct(e,t,r){return t.Ce.count===r-this.Pt(e,t.targetId)?0:2}Pt(e,t){const r=this.Ge.getRemoteKeysForTarget(t);let s=0;return r.forEach(i=>{const o=this.Ge.ht(),a=`projects/${o.projectId}/databases/${o.database}/documents/${i.path.canonicalString()}`;e.mightContain(a)||(this.et(t,i,null),s++)}),s}Tt(e){const t=new Map;this.ze.forEach((i,o)=>{const a=this.ot(o);if(a){if(i.current&&Hg(a.target)){const l=new ne(a.target.path);this.It(l).has(o)||this.Et(o,l)||this.et(o,l,Ut.newNoDocument(l,e))}i.Be&&(t.set(o,i.ke()),i.qe())}});let r=je();this.He.forEach((i,o)=>{let a=!0;o.forEachWhile(l=>{const u=this.ot(l);return!u||u.purpose==="TargetPurposeLimboResolution"||(a=!1,!1)}),a&&(r=r.add(i))}),this.je.forEach((i,o)=>o.setReadTime(e));const s=new xh(e,t,this.Ye,this.je,r);return this.je=_r(),this.Je=gf(),this.He=gf(),this.Ye=new Ot(Pe),s}Xe(e,t){if(!this.rt(e))return;const r=this.Et(e,t.key)?2:0;this.nt(e).Qe(t.key,r),this.je=this.je.insert(t.key,t),this.Je=this.Je.insert(t.key,this.It(t.key).add(e)),this.He=this.He.insert(t.key,this.dt(t.key).add(e))}et(e,t,r){if(!this.rt(e))return;const s=this.nt(e);this.Et(e,t)?s.Qe(t,1):s.$e(t),this.He=this.He.insert(t,this.dt(t).delete(e)),this.He=this.He.insert(t,this.dt(t).add(e)),r&&(this.je=this.je.insert(t,r))}removeTarget(e){this.ze.delete(e)}_t(e){const t=this.nt(e).ke();return this.Ge.getRemoteKeysForTarget(e).size+t.addedDocuments.size-t.removedDocuments.size}Ue(e){this.nt(e).Ue()}nt(e){let t=this.ze.get(e);return t||(t=new nT,this.ze.set(e,t)),t}dt(e){let t=this.He.get(e);return t||(t=new St(Pe),this.He=this.He.insert(e,t)),t}It(e){let t=this.Je.get(e);return t||(t=new St(Pe),this.Je=this.Je.insert(e,t)),t}rt(e){const t=this.ot(e)!==null;return t||W("WatchChangeAggregator","Detected inactive target",e),t}ot(e){const t=this.ze.get(e);return t&&t.Ne?null:this.Ge.At(e)}it(e){this.ze.set(e,new nT),this.Ge.getRemoteKeysForTarget(e).forEach(t=>{this.et(e,t,null)})}Et(e,t){return this.Ge.getRemoteKeysForTarget(e).has(t)}}function gf(){return new Ot(ne.comparator)}function rT(){return new Ot(ne.comparator)}const Q3=(()=>({asc:"ASCENDING",desc:"DESCENDING"}))(),Y3=(()=>({"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"}))(),J3=(()=>({and:"AND",or:"OR"}))();class X3{constructor(e,t){this.databaseId=e,this.useProto3Json=t}}function xv(n,e){return n.useProto3Json||ph(e)?e:{value:e}}function xc(n,e){return n.useProto3Json?`${new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+e.nanoseconds).slice(-9)}Z`:{seconds:""+e.seconds,nanos:e.nanoseconds}}function KN(n,e){return n.useProto3Json?e.toBase64():e.toUint8Array()}function Z3(n,e){return xc(n,e.toTimestamp())}function hn(n){return ye(!!n,49232),Ie.fromTimestamp(function(t){const r=wi(t);return new gt(r.seconds,r.nanos)}(n))}function jw(n,e){return Iv(n,e).canonicalString()}function Iv(n,e){const t=function(s){return new Je(["projects",s.projectId,"databases",s.database])}(n).child("documents");return e===void 0?t:t.child(e)}function QN(n){const e=Je.fromString(n);return ye(sk(e),10190,{key:e.toString()}),e}function $d(n,e){return jw(n.databaseId,e.path)}function zs(n,e){const t=QN(e);if(t.get(1)!==n.databaseId.projectId)throw new z(U.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+t.get(1)+" vs "+n.databaseId.projectId);if(t.get(3)!==n.databaseId.database)throw new z(U.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+t.get(3)+" vs "+n.databaseId.database);return new ne(XN(t))}function YN(n,e){return jw(n.databaseId,e)}function JN(n){const e=QN(n);return e.length===4?Je.emptyPath():XN(e)}function Ev(n){return new Je(["projects",n.databaseId.projectId,"databases",n.databaseId.database]).canonicalString()}function XN(n){return ye(n.length>4&&n.get(4)==="documents",29091,{key:n.toString()}),n.popFirst(5)}function sT(n,e,t){return{name:$d(n,e),fields:t.value.mapValue.fields}}function om(n,e,t){const r=zs(n,e.name),s=hn(e.updateTime),i=e.createTime?hn(e.createTime):Ie.min(),o=new $n({mapValue:{fields:e.fields}}),a=Ut.newFoundDocument(r,s,i,o);return t&&a.setHasCommittedMutations(),t?a.setHasCommittedMutations():a}function e5(n,e){return"found"in e?function(r,s){ye(!!s.found,43571),s.found.name,s.found.updateTime;const i=zs(r,s.found.name),o=hn(s.found.updateTime),a=s.found.createTime?hn(s.found.createTime):Ie.min(),l=new $n({mapValue:{fields:s.found.fields}});return Ut.newFoundDocument(i,o,a,l)}(n,e):"missing"in e?function(r,s){ye(!!s.missing,3894),ye(!!s.readTime,22933);const i=zs(r,s.missing),o=hn(s.readTime);return Ut.newNoDocument(i,o)}(n,e):ue(7234,{result:e})}function t5(n,e){let t;if("targetChange"in e){e.targetChange;const r=function(u){return u==="NO_CHANGE"?0:u==="ADD"?1:u==="REMOVE"?2:u==="CURRENT"?3:u==="RESET"?4:ue(39313,{state:u})}(e.targetChange.targetChangeType||"NO_CHANGE"),s=e.targetChange.targetIds||[],i=function(u,h){return u.useProto3Json?(ye(h===void 0||typeof h=="string",58123),an.fromBase64String(h||"")):(ye(h===void 0||h instanceof Buffer||h instanceof Uint8Array,16193),an.fromUint8Array(h||new Uint8Array))}(n,e.targetChange.resumeToken),o=e.targetChange.cause,a=o&&function(u){const h=u.code===void 0?U.UNKNOWN:qN(u.code);return new z(h,u.message||"")}(o);t=new HN(r,s,i,a||null)}else if("documentChange"in e){e.documentChange;const r=e.documentChange;r.document,r.document.name,r.document.updateTime;const s=zs(n,r.document.name),i=hn(r.document.updateTime),o=r.document.createTime?hn(r.document.createTime):Ie.min(),a=new $n({mapValue:{fields:r.document.fields}}),l=Ut.newFoundDocument(s,i,o,a),u=r.targetIds||[],h=r.removedTargetIds||[];t=new Gf(u,h,l.key,l)}else if("documentDelete"in e){e.documentDelete;const r=e.documentDelete;r.document;const s=zs(n,r.document),i=r.readTime?hn(r.readTime):Ie.min(),o=Ut.newNoDocument(s,i),a=r.removedTargetIds||[];t=new Gf([],a,o.key,o)}else if("documentRemove"in e){e.documentRemove;const r=e.documentRemove;r.document;const s=zs(n,r.document),i=r.removedTargetIds||[];t=new Gf([],i,s,null)}else{if(!("filter"in e))return ue(11601,{Rt:e});{e.filter;const r=e.filter;r.targetId;const{count:s=0,unchangedNames:i}=r,o=new G3(s,i),a=r.targetId;t=new GN(a,o)}}return t}function Bd(n,e){let t;if(e instanceof Fc)t={update:sT(n,e.key,e.value)};else if(e instanceof jc)t={delete:$d(n,e.key)};else if(e instanceof Ri)t={update:sT(n,e.key,e.data),updateMask:a5(e.fieldMask)};else{if(!(e instanceof Mw))return ue(16599,{Vt:e.type});t={verify:$d(n,e.key)}}return e.fieldTransforms.length>0&&(t.updateTransforms=e.fieldTransforms.map(r=>function(i,o){const a=o.transform;if(a instanceof vc)return{fieldPath:o.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(a instanceof Da)return{fieldPath:o.field.canonicalString(),appendMissingElements:{values:a.elements}};if(a instanceof Ma)return{fieldPath:o.field.canonicalString(),removeAllFromArray:{values:a.elements}};if(a instanceof wc)return{fieldPath:o.field.canonicalString(),increment:a.Ae};throw ue(20930,{transform:o.transform})}(0,r))),e.precondition.isNone||(t.currentDocument=function(s,i){return i.updateTime!==void 0?{updateTime:Z3(s,i.updateTime)}:i.exists!==void 0?{exists:i.exists}:ue(27497)}(n,e.precondition)),t}function Sv(n,e){const t=e.currentDocument?function(i){return i.updateTime!==void 0?Jt.updateTime(hn(i.updateTime)):i.exists!==void 0?Jt.exists(i.exists):Jt.none()}(e.currentDocument):Jt.none(),r=e.updateTransforms?e.updateTransforms.map(s=>function(o,a){let l=null;if("setToServerValue"in a)ye(a.setToServerValue==="REQUEST_TIME",16630,{proto:a}),l=new vc;else if("appendMissingElements"in a){const h=a.appendMissingElements.values||[];l=new Da(h)}else if("removeAllFromArray"in a){const h=a.removeAllFromArray.values||[];l=new Ma(h)}else"increment"in a?l=new wc(o,a.increment):ue(16584,{proto:a});const u=Yt.fromServerFormat(a.fieldPath);return new wh(u,l)}(n,s)):[];if(e.update){e.update.name;const s=zs(n,e.update.name),i=new $n({mapValue:{fields:e.update.fields}});if(e.updateMask){const o=function(l){const u=l.fieldPaths||[];return new yr(u.map(h=>Yt.fromServerFormat(h)))}(e.updateMask);return new Ri(s,i,o,t,r)}return new Fc(s,i,t,r)}if(e.delete){const s=zs(n,e.delete);return new jc(s,t)}if(e.verify){const s=zs(n,e.verify);return new Mw(s,t)}return ue(1463,{proto:e})}function n5(n,e){return n&&n.length>0?(ye(e!==void 0,14353),n.map(t=>function(s,i){let o=s.updateTime?hn(s.updateTime):hn(i);return o.isEqual(Ie.min())&&(o=hn(i)),new z3(o,s.transformResults||[])}(t,e))):[]}function ZN(n,e){return{documents:[YN(n,e.path)]}}function am(n,e){const t={structuredQuery:{}},r=e.path;let s;e.collectionGroup!==null?(s=r,t.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(s=r.popLast(),t.structuredQuery.from=[{collectionId:r.lastSegment()}]),t.parent=YN(n,s);const i=function(u){if(u.length!==0)return rk(It.create(u,"and"))}(e.filters);i&&(t.structuredQuery.where=i);const o=function(u){if(u.length!==0)return u.map(h=>function(g){return{field:Gi(g.field),direction:s5(g.dir)}}(h))}(e.orderBy);o&&(t.structuredQuery.orderBy=o);const a=xv(n,e.limit);return a!==null&&(t.structuredQuery.limit=a),e.startAt&&(t.structuredQuery.startAt=function(u){return{before:u.inclusive,values:u.position}}(e.startAt)),e.endAt&&(t.structuredQuery.endAt=function(u){return{before:!u.inclusive,values:u.position}}(e.endAt)),{ft:t,parent:s}}function ek(n,e,t,r){const{ft:s,parent:i}=am(n,e),o={},a=[];let l=0;return t.forEach(u=>{const h=r?u.alias:"aggregate_"+l++;o[h]=u.alias,u.aggregateType==="count"?a.push({alias:h,count:{}}):u.aggregateType==="avg"?a.push({alias:h,avg:{field:Gi(u.fieldPath)}}):u.aggregateType==="sum"&&a.push({alias:h,sum:{field:Gi(u.fieldPath)}})}),{request:{structuredAggregationQuery:{aggregations:a,structuredQuery:s.structuredQuery},parent:s.parent},gt:o,parent:i}}function tk(n){let e=JN(n.parent);const t=n.structuredQuery,r=t.from?t.from.length:0;let s=null;if(r>0){ye(r===1,65062);const h=t.from[0];h.allDescendants?s=h.collectionId:e=e.child(h.collectionId)}let i=[];t.where&&(i=function(f){const g=nk(f);return g instanceof It&&Nw(g)?g.getFilters():[g]}(t.where));let o=[];t.orderBy&&(o=function(f){return f.map(g=>function(w){return new Ud(_l(w.field),function(M){switch(M){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(w.direction))}(g))}(t.orderBy));let a=null;t.limit&&(a=function(f){let g;return g=typeof f=="object"?f.value:f,ph(g)?null:g}(t.limit));let l=null;t.startAt&&(l=function(f){const g=!!f.before,y=f.values||[];return new ko(y,g)}(t.startAt));let u=null;return t.endAt&&(u=function(f){const g=!f.before,y=f.values||[];return new ko(y,g)}(t.endAt)),TN(e,s,o,i,a,"F",l,u)}function r5(n,e){const t=function(s){switch(s){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return ue(28987,{purpose:s})}}(e.purpose);return t==null?null:{"goog-listen-tags":t}}function nk(n){return n.unaryFilter!==void 0?function(t){switch(t.unaryFilter.op){case"IS_NAN":const r=_l(t.unaryFilter.field);return st.create(r,"==",{doubleValue:NaN});case"IS_NULL":const s=_l(t.unaryFilter.field);return st.create(s,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const i=_l(t.unaryFilter.field);return st.create(i,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const o=_l(t.unaryFilter.field);return st.create(o,"!=",{nullValue:"NULL_VALUE"});case"OPERATOR_UNSPECIFIED":return ue(61313);default:return ue(60726)}}(n):n.fieldFilter!==void 0?function(t){return st.create(_l(t.fieldFilter.field),function(s){switch(s){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";case"OPERATOR_UNSPECIFIED":return ue(58110);default:return ue(50506)}}(t.fieldFilter.op),t.fieldFilter.value)}(n):n.compositeFilter!==void 0?function(t){return It.create(t.compositeFilter.filters.map(r=>nk(r)),function(s){switch(s){case"AND":return"and";case"OR":return"or";default:return ue(1026)}}(t.compositeFilter.op))}(n):ue(30097,{filter:n})}function s5(n){return Q3[n]}function i5(n){return Y3[n]}function o5(n){return J3[n]}function Gi(n){return{fieldPath:n.canonicalString()}}function _l(n){return Yt.fromServerFormat(n.fieldPath)}function rk(n){return n instanceof st?function(t){if(t.op==="=="){if(BS(t.value))return{unaryFilter:{field:Gi(t.field),op:"IS_NAN"}};if($S(t.value))return{unaryFilter:{field:Gi(t.field),op:"IS_NULL"}}}else if(t.op==="!="){if(BS(t.value))return{unaryFilter:{field:Gi(t.field),op:"IS_NOT_NAN"}};if($S(t.value))return{unaryFilter:{field:Gi(t.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:Gi(t.field),op:i5(t.op),value:t.value}}}(n):n instanceof It?function(t){const r=t.getFilters().map(s=>rk(s));return r.length===1?r[0]:{compositeFilter:{op:o5(t.op),filters:r}}}(n):ue(54877,{filter:n})}function a5(n){const e=[];return n.fields.forEach(t=>e.push(t.canonicalString())),{fieldPaths:e}}function sk(n){return n.length>=4&&n.get(0)==="projects"&&n.get(2)==="databases"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ci{constructor(e,t,r,s,i=Ie.min(),o=Ie.min(),a=an.EMPTY_BYTE_STRING,l=null){this.target=e,this.targetId=t,this.purpose=r,this.sequenceNumber=s,this.snapshotVersion=i,this.lastLimboFreeSnapshotVersion=o,this.resumeToken=a,this.expectedCount=l}withSequenceNumber(e){return new ci(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(e,t){return new ci(this.target,this.targetId,this.purpose,this.sequenceNumber,t,this.lastLimboFreeSnapshotVersion,e,null)}withExpectedCount(e){return new ci(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,e)}withLastLimboFreeSnapshotVersion(e){return new ci(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken,this.expectedCount)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ik{constructor(e){this.yt=e}}function l5(n,e){let t;if(e.document)t=om(n.yt,e.document,!!e.hasCommittedMutations);else if(e.noDocument){const r=ne.fromSegments(e.noDocument.path),s=Oa(e.noDocument.readTime);t=Ut.newNoDocument(r,s),e.hasCommittedMutations&&t.setHasCommittedMutations()}else{if(!e.unknownDocument)return ue(56709);{const r=ne.fromSegments(e.unknownDocument.path),s=Oa(e.unknownDocument.version);t=Ut.newUnknownDocument(r,s)}}return e.readTime&&t.setReadTime(function(s){const i=new gt(s[0],s[1]);return Ie.fromTimestamp(i)}(e.readTime)),t}function iT(n,e){const t=e.key,r={prefixPath:t.getCollectionPath().popLast().toArray(),collectionGroup:t.collectionGroup,documentId:t.path.lastSegment(),readTime:Yg(e.readTime),hasCommittedMutations:e.hasCommittedMutations};if(e.isFoundDocument())r.document=function(i,o){return{name:$d(i,o.key),fields:o.data.value.mapValue.fields,updateTime:xc(i,o.version.toTimestamp()),createTime:xc(i,o.createTime.toTimestamp())}}(n.yt,e);else if(e.isNoDocument())r.noDocument={path:t.path.toArray(),readTime:La(e.version)};else{if(!e.isUnknownDocument())return ue(57904,{document:e});r.unknownDocument={path:t.path.toArray(),version:La(e.version)}}return r}function Yg(n){const e=n.toTimestamp();return[e.seconds,e.nanoseconds]}function La(n){const e=n.toTimestamp();return{seconds:e.seconds,nanoseconds:e.nanoseconds}}function Oa(n){const e=new gt(n.seconds,n.nanoseconds);return Ie.fromTimestamp(e)}function ra(n,e){const t=(e.baseMutations||[]).map(i=>Sv(n.yt,i));for(let i=0;i<e.mutations.length-1;++i){const o=e.mutations[i];if(i+1<e.mutations.length&&e.mutations[i+1].transform!==void 0){const a=e.mutations[i+1];o.updateTransforms=a.transform.fieldTransforms,e.mutations.splice(i+1,1),++i}}const r=e.mutations.map(i=>Sv(n.yt,i)),s=gt.fromMillis(e.localWriteTimeMs);return new Lw(e.batchId,s,t,r)}function Ru(n){const e=Oa(n.readTime),t=n.lastLimboFreeSnapshotVersion!==void 0?Oa(n.lastLimboFreeSnapshotVersion):Ie.min();let r;return r=function(i){return i.documents!==void 0}(n.query)?function(i){const o=i.documents.length;return ye(o===1,1966,{count:o}),nr(Vc(JN(i.documents[0])))}(n.query):function(i){return nr(tk(i))}(n.query),new ci(r,n.targetId,"TargetPurposeListen",n.lastListenSequenceNumber,e,t,an.fromBase64String(n.resumeToken))}function ok(n,e){const t=La(e.snapshotVersion),r=La(e.lastLimboFreeSnapshotVersion);let s;s=Hg(e.target)?ZN(n.yt,e.target):am(n.yt,e.target).ft;const i=e.resumeToken.toBase64();return{targetId:e.targetId,canonicalId:Pa(e.target),readTime:t,resumeToken:i,lastListenSequenceNumber:e.sequenceNumber,lastLimboFreeSnapshotVersion:r,query:s}}function lm(n){const e=tk({parent:n.parent,structuredQuery:n.structuredQuery});return n.limitType==="LAST"?Qg(e,e.limit,"L"):e}function by(n,e){return new Vw(e.largestBatchId,Sv(n.yt,e.overlayMutation))}function oT(n,e){const t=e.path.lastSegment();return[n,tr(e.path.popLast()),t]}function aT(n,e,t,r){return{indexId:n,uid:e,sequenceNumber:t,readTime:La(r.readTime),documentKey:tr(r.documentKey.path),largestBatchId:r.largestBatchId}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class c5{getBundleMetadata(e,t){return lT(e).get(t).next(r=>{if(r)return function(i){return{id:i.bundleId,createTime:Oa(i.createTime),version:i.version}}(r)})}saveBundleMetadata(e,t){return lT(e).put(function(s){return{bundleId:s.id,createTime:La(hn(s.createTime)),version:s.version}}(t))}getNamedQuery(e,t){return cT(e).get(t).next(r=>{if(r)return function(i){return{name:i.name,query:lm(i.bundledQuery),readTime:Oa(i.readTime)}}(r)})}saveNamedQuery(e,t){return cT(e).put(function(s){return{name:s.name,readTime:La(hn(s.readTime)),bundledQuery:s.bundledQuery}}(t))}}function lT(n){return En(n,Xp)}function cT(n){return En(n,Zp)}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class cm{constructor(e,t){this.serializer=e,this.userId=t}static wt(e,t){const r=t.uid||"";return new cm(e,r)}getOverlay(e,t){return fu(e).get(oT(this.userId,t)).next(r=>r?by(this.serializer,r):null)}getOverlays(e,t){const r=Vs();return O.forEach(t,s=>this.getOverlay(e,s).next(i=>{i!==null&&r.set(s,i)})).next(()=>r)}saveOverlays(e,t,r){const s=[];return r.forEach((i,o)=>{const a=new Vw(t,o);s.push(this.St(e,a))}),O.waitFor(s)}removeOverlaysForBatchId(e,t,r){const s=new Set;t.forEach(o=>s.add(tr(o.getCollectionPath())));const i=[];return s.forEach(o=>{const a=IDBKeyRange.bound([this.userId,o,r],[this.userId,o,r+1],!1,!0);i.push(fu(e).Z(fv,a))}),O.waitFor(i)}getOverlaysForCollection(e,t,r){const s=Vs(),i=tr(t),o=IDBKeyRange.bound([this.userId,i,r],[this.userId,i,Number.POSITIVE_INFINITY],!0);return fu(e).J(fv,o).next(a=>{for(const l of a){const u=by(this.serializer,l);s.set(u.getKey(),u)}return s})}getOverlaysForCollectionGroup(e,t,r,s){const i=Vs();let o;const a=IDBKeyRange.bound([this.userId,t,r],[this.userId,t,Number.POSITIVE_INFINITY],!0);return fu(e).ee({index:nN,range:a},(l,u,h)=>{const f=by(this.serializer,u);i.size()<s||f.largestBatchId===o?(i.set(f.getKey(),f),o=f.largestBatchId):h.done()}).next(()=>i)}St(e,t){return fu(e).put(function(s,i,o){const[a,l,u]=oT(i,o.mutation.key);return{userId:i,collectionPath:l,documentId:u,collectionGroup:o.mutation.key.getCollectionGroup(),largestBatchId:o.largestBatchId,overlayMutation:Bd(s.yt,o.mutation)}}(this.serializer,this.userId,t))}}function fu(n){return En(n,em)}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class u5{bt(e){return En(e,bw)}getSessionToken(e){return this.bt(e).get("sessionToken").next(t=>{const r=t==null?void 0:t.value;return r?an.fromUint8Array(r):an.EMPTY_BYTE_STRING})}setSessionToken(e,t){return this.bt(e).put({name:"sessionToken",value:t.toUint8Array()})}}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class sa{constructor(){}Dt(e,t){this.Ct(e,t),t.vt()}Ct(e,t){if("nullValue"in e)this.Ft(t,5);else if("booleanValue"in e)this.Ft(t,10),t.Mt(e.booleanValue?1:0);else if("integerValue"in e)this.Ft(t,15),t.Mt(Gt(e.integerValue));else if("doubleValue"in e){const r=Gt(e.doubleValue);isNaN(r)?this.Ft(t,13):(this.Ft(t,15),Pd(r)?t.Mt(0):t.Mt(r))}else if("timestampValue"in e){let r=e.timestampValue;this.Ft(t,20),typeof r=="string"&&(r=wi(r)),t.xt(`${r.seconds||""}`),t.Mt(r.nanos||0)}else if("stringValue"in e)this.Ot(e.stringValue,t),this.Nt(t);else if("bytesValue"in e)this.Ft(t,30),t.Bt(xi(e.bytesValue)),this.Nt(t);else if("referenceValue"in e)this.Lt(e.referenceValue,t);else if("geoPointValue"in e){const r=e.geoPointValue;this.Ft(t,45),t.Mt(r.latitude||0),t.Mt(r.longitude||0)}else"mapValue"in e?pN(e)?this.Ft(t,Number.MAX_SAFE_INTEGER):rm(e)?this.kt(e.mapValue,t):(this.qt(e.mapValue,t),this.Nt(t)):"arrayValue"in e?(this.Qt(e.arrayValue,t),this.Nt(t)):ue(19022,{$t:e})}Ot(e,t){this.Ft(t,25),this.Ut(e,t)}Ut(e,t){t.xt(e)}qt(e,t){const r=e.fields||{};this.Ft(t,55);for(const s of Object.keys(r))this.Ot(s,t),this.Ct(r[s],t)}kt(e,t){var o,a;const r=e.fields||{};this.Ft(t,53);const s=mc,i=((a=(o=r[s].arrayValue)==null?void 0:o.values)==null?void 0:a.length)||0;this.Ft(t,15),t.Mt(Gt(i)),this.Ot(s,t),this.Ct(r[s],t)}Qt(e,t){const r=e.values||[];this.Ft(t,50);for(const s of r)this.Ct(s,t)}Lt(e,t){this.Ft(t,37),ne.fromName(e).path.forEach(r=>{this.Ft(t,60),this.Ut(r,t)})}Ft(e,t){e.Mt(t)}Nt(e){e.Mt(2)}}sa.Kt=new sa;/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law | agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES | CONDITIONS OF ANY KIND, either express | implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const dl=255;function d5(n){if(n===0)return 8;let e=0;return n>>4||(e+=4,n<<=4),n>>6||(e+=2,n<<=2),n>>7||(e+=1),e}function uT(n){const e=64-function(r){let s=0;for(let i=0;i<8;++i){const o=d5(255&r[i]);if(s+=o,o!==8)break}return s}(n);return Math.ceil(e/8)}class h5{constructor(){this.buffer=new Uint8Array(1024),this.position=0}Wt(e){const t=e[Symbol.iterator]();let r=t.next();for(;!r.done;)this.Gt(r.value),r=t.next();this.zt()}jt(e){const t=e[Symbol.iterator]();let r=t.next();for(;!r.done;)this.Jt(r.value),r=t.next();this.Ht()}Yt(e){for(const t of e){const r=t.charCodeAt(0);if(r<128)this.Gt(r);else if(r<2048)this.Gt(960|r>>>6),this.Gt(128|63&r);else if(t<"\uD800"||"\uDBFF"<t)this.Gt(480|r>>>12),this.Gt(128|63&r>>>6),this.Gt(128|63&r);else{const s=t.codePointAt(0);this.Gt(240|s>>>18),this.Gt(128|63&s>>>12),this.Gt(128|63&s>>>6),this.Gt(128|63&s)}}this.zt()}Zt(e){for(const t of e){const r=t.charCodeAt(0);if(r<128)this.Jt(r);else if(r<2048)this.Jt(960|r>>>6),this.Jt(128|63&r);else if(t<"\uD800"||"\uDBFF"<t)this.Jt(480|r>>>12),this.Jt(128|63&r>>>6),this.Jt(128|63&r);else{const s=t.codePointAt(0);this.Jt(240|s>>>18),this.Jt(128|63&s>>>12),this.Jt(128|63&s>>>6),this.Jt(128|63&s)}}this.Ht()}Xt(e){const t=this.en(e),r=uT(t);this.tn(1+r),this.buffer[this.position++]=255&r;for(let s=t.length-r;s<t.length;++s)this.buffer[this.position++]=255&t[s]}nn(e){const t=this.en(e),r=uT(t);this.tn(1+r),this.buffer[this.position++]=~(255&r);for(let s=t.length-r;s<t.length;++s)this.buffer[this.position++]=~(255&t[s])}rn(){this.sn(dl),this.sn(255)}_n(){this.an(dl),this.an(255)}reset(){this.position=0}seed(e){this.tn(e.length),this.buffer.set(e,this.position),this.position+=e.length}un(){return this.buffer.slice(0,this.position)}en(e){const t=function(i){const o=new DataView(new ArrayBuffer(8));return o.setFloat64(0,i,!1),new Uint8Array(o.buffer)}(e),r=!!(128&t[0]);t[0]^=r?255:128;for(let s=1;s<t.length;++s)t[s]^=r?255:0;return t}Gt(e){const t=255&e;t===0?(this.sn(0),this.sn(255)):t===dl?(this.sn(dl),this.sn(0)):this.sn(t)}Jt(e){const t=255&e;t===0?(this.an(0),this.an(255)):t===dl?(this.an(dl),this.an(0)):this.an(e)}zt(){this.sn(0),this.sn(1)}Ht(){this.an(0),this.an(1)}sn(e){this.tn(1),this.buffer[this.position++]=e}an(e){this.tn(1),this.buffer[this.position++]=~e}tn(e){const t=e+this.position;if(t<=this.buffer.length)return;let r=2*this.buffer.length;r<t&&(r=t);const s=new Uint8Array(r);s.set(this.buffer),this.buffer=s}}class f5{constructor(e){this.cn=e}Bt(e){this.cn.Wt(e)}xt(e){this.cn.Yt(e)}Mt(e){this.cn.Xt(e)}vt(){this.cn.rn()}}class g5{constructor(e){this.cn=e}Bt(e){this.cn.jt(e)}xt(e){this.cn.Zt(e)}Mt(e){this.cn.nn(e)}vt(){this.cn._n()}}class gu{constructor(){this.cn=new h5,this.ln=new f5(this.cn),this.hn=new g5(this.cn)}seed(e){this.cn.seed(e)}Pn(e){return e===0?this.ln:this.hn}un(){return this.cn.un()}reset(){this.cn.reset()}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ia{constructor(e,t,r,s){this.Tn=e,this.In=t,this.En=r,this.dn=s}An(){const e=this.dn.length,t=e===0||this.dn[e-1]===255?e+1:e,r=new Uint8Array(t);return r.set(this.dn,0),t!==e?r.set([0],this.dn.length):++r[r.length-1],new ia(this.Tn,this.In,this.En,r)}Rn(e,t,r){return{indexId:this.Tn,uid:e,arrayValue:Hf(this.En),directionalValue:Hf(this.dn),orderedDocumentKey:Hf(t),documentKey:r.path.toArray()}}Vn(e,t,r){const s=this.Rn(e,t,r);return[s.indexId,s.uid,s.arrayValue,s.directionalValue,s.orderedDocumentKey,s.documentKey]}}function Fi(n,e){let t=n.Tn-e.Tn;return t!==0?t:(t=dT(n.En,e.En),t!==0?t:(t=dT(n.dn,e.dn),t!==0?t:ne.comparator(n.In,e.In)))}function dT(n,e){for(let t=0;t<n.length&&t<e.length;++t){const r=n[t]-e[t];if(r!==0)return r}return n.length-e.length}function Hf(n){return sC()?function(t){let r="";for(let s=0;s<t.length;s++)r+=String.fromCharCode(t[s]);return r}(n):n}function hT(n){return typeof n!="string"?n:function(t){const r=new Uint8Array(t.length);for(let s=0;s<t.length;s++)r[s]=t.charCodeAt(s);return r}(n)}class fT{constructor(e){this.mn=new St((t,r)=>Yt.comparator(t.field,r.field)),this.collectionId=e.collectionGroup!=null?e.collectionGroup:e.path.lastSegment(),this.fn=e.orderBy,this.gn=[];for(const t of e.filters){const r=t;r.isInequality()?this.mn=this.mn.add(r):this.gn.push(r)}}get pn(){return this.mn.size>1}yn(e){if(ye(e.collectionGroup===this.collectionId,49279),this.pn)return!1;const t=uv(e);if(t!==void 0&&!this.wn(t))return!1;const r=ea(e);let s=new Set,i=0,o=0;for(;i<r.length&&this.wn(r[i]);++i)s=s.add(r[i].fieldPath.canonicalString());if(i===r.length)return!0;if(this.mn.size>0){const a=this.mn.getIterator().getNext();if(!s.has(a.field.canonicalString())){const l=r[i];if(!this.Sn(a,l)||!this.bn(this.fn[o++],l))return!1}++i}for(;i<r.length;++i){const a=r[i];if(o>=this.fn.length||!this.bn(this.fn[o++],a))return!1}return!0}Dn(){if(this.pn)return null;let e=new St(Yt.comparator);const t=[];for(const r of this.gn)if(!r.field.isKeyField())if(r.op==="array-contains"||r.op==="array-contains-any")t.push(new ma(r.field,2));else{if(e.has(r.field))continue;e=e.add(r.field),t.push(new ma(r.field,0))}for(const r of this.fn)r.field.isKeyField()||e.has(r.field)||(e=e.add(r.field),t.push(new ma(r.field,r.dir==="asc"?0:1)));return new uc(uc.UNKNOWN_ID,this.collectionId,t,dc.empty())}wn(e){for(const t of this.gn)if(this.Sn(t,e))return!0;return!1}Sn(e,t){if(e===void 0||!e.field.isEqual(t.fieldPath))return!1;const r=e.op==="array-contains"||e.op==="array-contains-any";return t.kind===2===r}bn(e,t){return!!e.field.isEqual(t.fieldPath)&&(t.kind===0&&e.dir==="asc"||t.kind===1&&e.dir==="desc")}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ak(n){var t,r;if(ye(n instanceof st||n instanceof It,20012),n instanceof st){if(n instanceof SN){const s=((r=(t=n.value.arrayValue)==null?void 0:t.values)==null?void 0:r.map(i=>st.create(n.field,"==",i)))||[];return It.create(s,"or")}return n}const e=n.filters.map(s=>ak(s));return It.create(e,n.op)}function p5(n){if(n.getFilters().length===0)return[];const e=Av(ak(n));return ye(lk(e),7391),Tv(e)||bv(e)?[e]:e.getFilters()}function Tv(n){return n instanceof st}function bv(n){return n instanceof It&&Nw(n)}function lk(n){return Tv(n)||bv(n)||function(t){if(t instanceof It&&yv(t)){for(const r of t.getFilters())if(!Tv(r)&&!bv(r))return!1;return!0}return!1}(n)}function Av(n){if(ye(n instanceof st||n instanceof It,34018),n instanceof st)return n;if(n.filters.length===1)return Av(n.filters[0]);const e=n.filters.map(r=>Av(r));let t=It.create(e,n.op);return t=Jg(t),lk(t)?t:(ye(t instanceof It,64498),ye(_c(t),40251),ye(t.filters.length>1,57927),t.filters.reduce((r,s)=>Uw(r,s)))}function Uw(n,e){let t;return ye(n instanceof st||n instanceof It,38388),ye(e instanceof st||e instanceof It,25473),t=n instanceof st?e instanceof st?function(s,i){return It.create([s,i],"and")}(n,e):gT(n,e):e instanceof st?gT(e,n):function(s,i){if(ye(s.filters.length>0&&i.filters.length>0,48005),_c(s)&&_c(i))return xN(s,i.getFilters());const o=yv(s)?s:i,a=yv(s)?i:s,l=o.filters.map(u=>Uw(u,a));return It.create(l,"or")}(n,e),Jg(t)}function gT(n,e){if(_c(e))return xN(e,n.getFilters());{const t=e.filters.map(r=>Uw(n,r));return It.create(t,"or")}}function Jg(n){if(ye(n instanceof st||n instanceof It,11850),n instanceof st)return n;const e=n.getFilters();if(e.length===1)return Jg(e[0]);if(vN(n))return n;const t=e.map(s=>Jg(s)),r=[];return t.forEach(s=>{s instanceof st?r.push(s):s instanceof It&&(s.op===n.op?r.push(...s.filters):r.push(s))}),r.length===1?r[0]:It.create(r,n.op)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class m5{constructor(){this.Cn=new $w}addToCollectionParentIndex(e,t){return this.Cn.add(t),O.resolve()}getCollectionParents(e,t){return O.resolve(this.Cn.getEntries(t))}addFieldIndex(e,t){return O.resolve()}deleteFieldIndex(e,t){return O.resolve()}deleteAllFieldIndexes(e){return O.resolve()}createTargetIndexes(e,t){return O.resolve()}getDocumentsMatchingTarget(e,t){return O.resolve(null)}getIndexType(e,t){return O.resolve(0)}getFieldIndexes(e,t){return O.resolve([])}getNextCollectionGroupToUpdate(e){return O.resolve(null)}getMinOffset(e,t){return O.resolve(Br.min())}getMinOffsetFromCollectionGroup(e,t){return O.resolve(Br.min())}updateCollectionGroup(e,t,r){return O.resolve()}updateIndexEntries(e,t){return O.resolve()}}class $w{constructor(){this.index={}}add(e){const t=e.lastSegment(),r=e.popLast(),s=this.index[t]||new St(Je.comparator),i=!s.has(r);return this.index[t]=s.add(r),i}has(e){const t=e.lastSegment(),r=e.popLast(),s=this.index[t];return s&&s.has(r)}getEntries(e){return(this.index[e]||new St(Je.comparator)).toArray()}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const pT="IndexedDbIndexManager",pf=new Uint8Array(0);class y5{constructor(e,t){this.databaseId=t,this.vn=new $w,this.Fn=new Ci(r=>Pa(r),(r,s)=>yh(r,s)),this.uid=e.uid||""}addToCollectionParentIndex(e,t){if(!this.vn.has(t)){const r=t.lastSegment(),s=t.popLast();e.addOnCommittedListener(()=>{this.vn.add(t)});const i={collectionId:r,parent:tr(s)};return mT(e).put(i)}return O.resolve()}getCollectionParents(e,t){const r=[],s=IDBKeyRange.bound([t,""],[BR(t),""],!1,!0);return mT(e).J(s).next(i=>{for(const o of i){if(o.collectionId!==t)break;r.push(Os(o.parent))}return r})}addFieldIndex(e,t){const r=pu(e),s=function(a){return{indexId:a.indexId,collectionGroup:a.collectionGroup,fields:a.fields.map(l=>[l.fieldPath.canonicalString(),l.kind])}}(t);delete s.indexId;const i=r.add(s);if(t.indexState){const o=fl(e);return i.next(a=>{o.put(aT(a,this.uid,t.indexState.sequenceNumber,t.indexState.offset))})}return i.next()}deleteFieldIndex(e,t){const r=pu(e),s=fl(e),i=hl(e);return r.delete(t.indexId).next(()=>s.delete(IDBKeyRange.bound([t.indexId],[t.indexId+1],!1,!0))).next(()=>i.delete(IDBKeyRange.bound([t.indexId],[t.indexId+1],!1,!0)))}deleteAllFieldIndexes(e){const t=pu(e),r=hl(e),s=fl(e);return t.Z().next(()=>r.Z()).next(()=>s.Z())}createTargetIndexes(e,t){return O.forEach(this.Mn(t),r=>this.getIndexType(e,r).next(s=>{if(s===0||s===1){const i=new fT(r).Dn();if(i!=null)return this.addFieldIndex(e,i)}}))}getDocumentsMatchingTarget(e,t){const r=hl(e);let s=!0;const i=new Map;return O.forEach(this.Mn(t),o=>this.xn(e,o).next(a=>{s&&(s=!!a),i.set(o,a)})).next(()=>{if(s){let o=je();const a=[];return O.forEach(i,(l,u)=>{W(pT,`Using index ${function(R){return`id=${R.indexId}|cg=${R.collectionGroup}|f=${R.fields.map(D=>`${D.fieldPath}:${D.kind}`).join(",")}`}(l)} to execute ${Pa(t)}`);const h=function(R,D){const V=uv(D);if(V===void 0)return null;for(const P of Kg(R,V.fieldPath))switch(P.op){case"array-contains-any":return P.value.arrayValue.values||[];case"array-contains":return[P.value]}return null}(u,l),f=function(R,D){const V=new Map;for(const P of ea(D))for(const S of Kg(R,P.fieldPath))switch(S.op){case"==":case"in":V.set(P.fieldPath.canonicalString(),S.value);break;case"not-in":case"!=":return V.set(P.fieldPath.canonicalString(),S.value),Array.from(V.values())}return null}(u,l),g=function(R,D){const V=[];let P=!0;for(const S of ea(D)){const v=S.kind===0?HS(R,S.fieldPath,R.startAt):KS(R,S.fieldPath,R.startAt);V.push(v.value),P&&(P=v.inclusive)}return new ko(V,P)}(u,l),y=function(R,D){const V=[];let P=!0;for(const S of ea(D)){const v=S.kind===0?KS(R,S.fieldPath,R.endAt):HS(R,S.fieldPath,R.endAt);V.push(v.value),P&&(P=v.inclusive)}return new ko(V,P)}(u,l),w=this.On(l,u,g),C=this.On(l,u,y),M=this.Nn(l,u,f),A=this.Bn(l.indexId,h,w,g.inclusive,C,y.inclusive,M);return O.forEach(A,I=>r.Y(I,t.limit).next(R=>{R.forEach(D=>{const V=ne.fromSegments(D.documentKey);o.has(V)||(o=o.add(V),a.push(V))})}))}).next(()=>a)}return O.resolve(null)})}Mn(e){let t=this.Fn.get(e);return t||(e.filters.length===0?t=[e]:t=p5(It.create(e.filters,"and")).map(r=>vv(e.path,e.collectionGroup,e.orderBy,r.getFilters(),e.limit,e.startAt,e.endAt)),this.Fn.set(e,t),t)}Bn(e,t,r,s,i,o,a){const l=(t!=null?t.length:1)*Math.max(r.length,i.length),u=l/(t!=null?t.length:1),h=[];for(let f=0;f<l;++f){const g=t?this.Ln(t[f/u]):pf,y=this.kn(e,g,r[f%u],s),w=this.qn(e,g,i[f%u],o),C=a.map(M=>this.kn(e,g,M,!0));h.push(...this.createRange(y,w,C))}return h}kn(e,t,r,s){const i=new ia(e,ne.empty(),t,r);return s?i:i.An()}qn(e,t,r,s){const i=new ia(e,ne.empty(),t,r);return s?i.An():i}xn(e,t){const r=new fT(t),s=t.collectionGroup!=null?t.collectionGroup:t.path.lastSegment();return this.getFieldIndexes(e,s).next(i=>{let o=null;for(const a of i)r.yn(a)&&(!o||a.fields.length>o.fields.length)&&(o=a);return o})}getIndexType(e,t){let r=2;const s=this.Mn(t);return O.forEach(s,i=>this.xn(e,i).next(o=>{o?r!==0&&o.fields.length<function(l){let u=new St(Yt.comparator),h=!1;for(const f of l.filters)for(const g of f.getFlattenedFilters())g.field.isKeyField()||(g.op==="array-contains"||g.op==="array-contains-any"?h=!0:u=u.add(g.field));for(const f of l.orderBy)f.field.isKeyField()||(u=u.add(f.field));return u.size+(h?1:0)}(i)&&(r=1):r=0})).next(()=>function(o){return o.limit!==null}(t)&&s.length>1&&r===2?1:r)}Qn(e,t){const r=new gu;for(const s of ea(e)){const i=t.data.field(s.fieldPath);if(i==null)return null;const o=r.Pn(s.kind);sa.Kt.Dt(i,o)}return r.un()}Ln(e){const t=new gu;return sa.Kt.Dt(e,t.Pn(0)),t.un()}$n(e,t){const r=new gu;return sa.Kt.Dt(ka(this.databaseId,t),r.Pn(function(i){const o=ea(i);return o.length===0?0:o[o.length-1].kind}(e))),r.un()}Nn(e,t,r){if(r===null)return[];let s=[];s.push(new gu);let i=0;for(const o of ea(e)){const a=r[i++];for(const l of s)if(this.Un(t,o.fieldPath)&&jd(a))s=this.Kn(s,o,a);else{const u=l.Pn(o.kind);sa.Kt.Dt(a,u)}}return this.Wn(s)}On(e,t,r){return this.Nn(e,t,r.position)}Wn(e){const t=[];for(let r=0;r<e.length;++r)t[r]=e[r].un();return t}Kn(e,t,r){const s=[...e],i=[];for(const o of r.arrayValue.values||[])for(const a of s){const l=new gu;l.seed(a.un()),sa.Kt.Dt(o,l.Pn(t.kind)),i.push(l)}return i}Un(e,t){return!!e.filters.find(r=>r instanceof st&&r.field.isEqual(t)&&(r.op==="in"||r.op==="not-in"))}getFieldIndexes(e,t){const r=pu(e),s=fl(e);return(t?r.J(hv,IDBKeyRange.bound(t,t)):r.J()).next(i=>{const o=[];return O.forEach(i,a=>s.get([a.indexId,this.uid]).next(l=>{o.push(function(h,f){const g=f?new dc(f.sequenceNumber,new Br(Oa(f.readTime),new ne(Os(f.documentKey)),f.largestBatchId)):dc.empty(),y=h.fields.map(([w,C])=>new ma(Yt.fromServerFormat(w),C));return new uc(h.indexId,h.collectionGroup,y,g)}(a,l))})).next(()=>o)})}getNextCollectionGroupToUpdate(e){return this.getFieldIndexes(e).next(t=>t.length===0?null:(t.sort((r,s)=>{const i=r.indexState.sequenceNumber-s.indexState.sequenceNumber;return i!==0?i:Pe(r.collectionGroup,s.collectionGroup)}),t[0].collectionGroup))}updateCollectionGroup(e,t,r){const s=pu(e),i=fl(e);return this.Gn(e).next(o=>s.J(hv,IDBKeyRange.bound(t,t)).next(a=>O.forEach(a,l=>i.put(aT(l.indexId,this.uid,o,r)))))}updateIndexEntries(e,t){const r=new Map;return O.forEach(t,(s,i)=>{const o=r.get(s.collectionGroup);return(o?O.resolve(o):this.getFieldIndexes(e,s.collectionGroup)).next(a=>(r.set(s.collectionGroup,a),O.forEach(a,l=>this.zn(e,s,l).next(u=>{const h=this.jn(i,l);return u.isEqual(h)?O.resolve():this.Jn(e,i,l,u,h)}))))})}Hn(e,t,r,s){return hl(e).put(s.Rn(this.uid,this.$n(r,t.key),t.key))}Yn(e,t,r,s){return hl(e).delete(s.Vn(this.uid,this.$n(r,t.key),t.key))}zn(e,t,r){const s=hl(e);let i=new St(Fi);return s.ee({index:tN,range:IDBKeyRange.only([r.indexId,this.uid,Hf(this.$n(r,t))])},(o,a)=>{i=i.add(new ia(r.indexId,t,hT(a.arrayValue),hT(a.directionalValue)))}).next(()=>i)}jn(e,t){let r=new St(Fi);const s=this.Qn(t,e);if(s==null)return r;const i=uv(t);if(i!=null){const o=e.data.field(i.fieldPath);if(jd(o))for(const a of o.arrayValue.values||[])r=r.add(new ia(t.indexId,e.key,this.Ln(a),s))}else r=r.add(new ia(t.indexId,e.key,pf,s));return r}Jn(e,t,r,s,i){W(pT,"Updating index entries for document '%s'",t.key);const o=[];return function(l,u,h,f,g){const y=l.getIterator(),w=u.getIterator();let C=ul(y),M=ul(w);for(;C||M;){let A=!1,I=!1;if(C&&M){const R=h(C,M);R<0?I=!0:R>0&&(A=!0)}else C!=null?I=!0:A=!0;A?(f(M),M=ul(w)):I?(g(C),C=ul(y)):(C=ul(y),M=ul(w))}}(s,i,Fi,a=>{o.push(this.Hn(e,t,r,a))},a=>{o.push(this.Yn(e,t,r,a))}),O.waitFor(o)}Gn(e){let t=1;return fl(e).ee({index:eN,reverse:!0,range:IDBKeyRange.upperBound([this.uid,Number.MAX_SAFE_INTEGER])},(r,s,i)=>{i.done(),t=s.sequenceNumber+1}).next(()=>t)}createRange(e,t,r){r=r.sort((o,a)=>Fi(o,a)).filter((o,a,l)=>!a||Fi(o,l[a-1])!==0);const s=[];s.push(e);for(const o of r){const a=Fi(o,e),l=Fi(o,t);if(a===0)s[0]=e.An();else if(a>0&&l<0)s.push(o),s.push(o.An());else if(l>0)break}s.push(t);const i=[];for(let o=0;o<s.length;o+=2){if(this.Zn(s[o],s[o+1]))return[];const a=s[o].Vn(this.uid,pf,ne.empty()),l=s[o+1].Vn(this.uid,pf,ne.empty());i.push(IDBKeyRange.bound(a,l))}return i}Zn(e,t){return Fi(e,t)>0}getMinOffsetFromCollectionGroup(e,t){return this.getFieldIndexes(e,t).next(yT)}getMinOffset(e,t){return O.mapArray(this.Mn(t),r=>this.xn(e,r).next(s=>s||ue(44426))).next(yT)}}function mT(n){return En(n,Ld)}function hl(n){return En(n,Ku)}function pu(n){return En(n,Tw)}function fl(n){return En(n,Hu)}function yT(n){ye(n.length!==0,28825);let e=n[0].indexState.offset,t=e.largestBatchId;for(let r=1;r<n.length;r++){const s=n[r].indexState.offset;Iw(s,e)<0&&(e=s),t<s.largestBatchId&&(t=s.largestBatchId)}return new Br(e.readTime,e.documentKey,t)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const _T={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0},ck=41943040;class Xn{static withCacheSize(e){return new Xn(e,Xn.DEFAULT_COLLECTION_PERCENTILE,Xn.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}constructor(e,t,r){this.cacheSizeCollectionThreshold=e,this.percentileToCollect=t,this.maximumSequenceNumbersToCollect=r}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function uk(n,e,t){const r=n.store(ds),s=n.store(hc),i=[],o=IDBKeyRange.only(t.batchId);let a=0;const l=r.ee({range:o},(h,f,g)=>(a++,g.delete()));i.push(l.next(()=>{ye(a===1,47070,{batchId:t.batchId})}));const u=[];for(const h of t.mutations){const f=JR(e,h.key.path,t.batchId);i.push(s.delete(f)),u.push(h.key)}return O.waitFor(i).next(()=>u)}function Xg(n){if(!n)return 0;let e;if(n.document)e=n.document;else if(n.unknownDocument)e=n.unknownDocument;else{if(!n.noDocument)throw ue(14731);e=n.noDocument}return JSON.stringify(e).length}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */Xn.DEFAULT_COLLECTION_PERCENTILE=10,Xn.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,Xn.DEFAULT=new Xn(ck,Xn.DEFAULT_COLLECTION_PERCENTILE,Xn.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),Xn.DISABLED=new Xn(-1,0,0);class um{constructor(e,t,r,s){this.userId=e,this.serializer=t,this.indexManager=r,this.referenceDelegate=s,this.Xn={}}static wt(e,t,r,s){ye(e.uid!=="",64387);const i=e.isAuthenticated()?e.uid:"";return new um(i,t,r,s)}checkEmpty(e){let t=!0;const r=IDBKeyRange.bound([this.userId,Number.NEGATIVE_INFINITY],[this.userId,Number.POSITIVE_INFINITY]);return ji(e).ee({index:ua,range:r},(s,i,o)=>{t=!1,o.done()}).next(()=>t)}addMutationBatch(e,t,r,s){const i=vl(e),o=ji(e);return o.add({}).next(a=>{ye(typeof a=="number",49019);const l=new Lw(a,t,r,s),u=function(y,w,C){const M=C.baseMutations.map(I=>Bd(y.yt,I)),A=C.mutations.map(I=>Bd(y.yt,I));return{userId:w,batchId:C.batchId,localWriteTimeMs:C.localWriteTime.toMillis(),baseMutations:M,mutations:A}}(this.serializer,this.userId,l),h=[];let f=new St((g,y)=>Pe(g.canonicalString(),y.canonicalString()));for(const g of s){const y=JR(this.userId,g.key.path,a);f=f.add(g.key.path.popLast()),h.push(o.put(u)),h.push(i.put(y,Z4))}return f.forEach(g=>{h.push(this.indexManager.addToCollectionParentIndex(e,g))}),e.addOnCommittedListener(()=>{this.Xn[a]=l.keys()}),O.waitFor(h).next(()=>l)})}lookupMutationBatch(e,t){return ji(e).get(t).next(r=>r?(ye(r.userId===this.userId,48,"Unexpected user for mutation batch",{userId:r.userId,batchId:t}),ra(this.serializer,r)):null)}er(e,t){return this.Xn[t]?O.resolve(this.Xn[t]):this.lookupMutationBatch(e,t).next(r=>{if(r){const s=r.keys();return this.Xn[t]=s,s}return null})}getNextMutationBatchAfterBatchId(e,t){const r=t+1,s=IDBKeyRange.lowerBound([this.userId,r]);let i=null;return ji(e).ee({index:ua,range:s},(o,a,l)=>{a.userId===this.userId&&(ye(a.batchId>=r,47524,{tr:r}),i=ra(this.serializer,a)),l.done()}).next(()=>i)}getHighestUnacknowledgedBatchId(e){const t=IDBKeyRange.upperBound([this.userId,Number.POSITIVE_INFINITY]);let r=vo;return ji(e).ee({index:ua,range:t,reverse:!0},(s,i,o)=>{r=i.batchId,o.done()}).next(()=>r)}getAllMutationBatches(e){const t=IDBKeyRange.bound([this.userId,vo],[this.userId,Number.POSITIVE_INFINITY]);return ji(e).J(ua,t).next(r=>r.map(s=>ra(this.serializer,s)))}getAllMutationBatchesAffectingDocumentKey(e,t){const r=Uf(this.userId,t.path),s=IDBKeyRange.lowerBound(r),i=[];return vl(e).ee({range:s},(o,a,l)=>{const[u,h,f]=o,g=Os(h);if(u===this.userId&&t.path.isEqual(g))return ji(e).get(f).next(y=>{if(!y)throw ue(61480,{nr:o,batchId:f});ye(y.userId===this.userId,10503,"Unexpected user for mutation batch",{userId:y.userId,batchId:f}),i.push(ra(this.serializer,y))});l.done()}).next(()=>i)}getAllMutationBatchesAffectingDocumentKeys(e,t){let r=new St(Pe);const s=[];return t.forEach(i=>{const o=Uf(this.userId,i.path),a=IDBKeyRange.lowerBound(o),l=vl(e).ee({range:a},(u,h,f)=>{const[g,y,w]=u,C=Os(y);g===this.userId&&i.path.isEqual(C)?r=r.add(w):f.done()});s.push(l)}),O.waitFor(s).next(()=>this.rr(e,r))}getAllMutationBatchesAffectingQuery(e,t){const r=t.path,s=r.length+1,i=Uf(this.userId,r),o=IDBKeyRange.lowerBound(i);let a=new St(Pe);return vl(e).ee({range:o},(l,u,h)=>{const[f,g,y]=l,w=Os(g);f===this.userId&&r.isPrefixOf(w)?w.length===s&&(a=a.add(y)):h.done()}).next(()=>this.rr(e,a))}rr(e,t){const r=[],s=[];return t.forEach(i=>{s.push(ji(e).get(i).next(o=>{if(o===null)throw ue(35274,{batchId:i});ye(o.userId===this.userId,9748,"Unexpected user for mutation batch",{userId:o.userId,batchId:i}),r.push(ra(this.serializer,o))}))}),O.waitFor(s).next(()=>r)}removeMutationBatch(e,t){return uk(e.le,this.userId,t).next(r=>(e.addOnCommittedListener(()=>{this.ir(t.batchId)}),O.forEach(r,s=>this.referenceDelegate.markPotentiallyOrphaned(e,s))))}ir(e){delete this.Xn[e]}performConsistencyCheck(e){return this.checkEmpty(e).next(t=>{if(!t)return O.resolve();const r=IDBKeyRange.lowerBound(function(o){return[o]}(this.userId)),s=[];return vl(e).ee({range:r},(i,o,a)=>{if(i[0]===this.userId){const l=Os(i[1]);s.push(l)}else a.done()}).next(()=>{ye(s.length===0,56720,{sr:s.map(i=>i.canonicalString())})})})}containsKey(e,t){return dk(e,this.userId,t)}_r(e){return hk(e).get(this.userId).next(t=>t||{userId:this.userId,lastAcknowledgedBatchId:vo,lastStreamToken:""})}}function dk(n,e,t){const r=Uf(e,t.path),s=r[1],i=IDBKeyRange.lowerBound(r);let o=!1;return vl(n).ee({range:i,X:!0},(a,l,u)=>{const[h,f,g]=a;h===e&&f===s&&(o=!0),u.done()}).next(()=>o)}function ji(n){return En(n,ds)}function vl(n){return En(n,hc)}function hk(n){return En(n,Dd)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Va{constructor(e){this.ar=e}next(){return this.ar+=2,this.ar}static ur(){return new Va(0)}static cr(){return new Va(-1)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class _5{constructor(e,t){this.referenceDelegate=e,this.serializer=t}allocateTargetId(e){return this.lr(e).next(t=>{const r=new Va(t.highestTargetId);return t.highestTargetId=r.next(),this.hr(e,t).next(()=>t.highestTargetId)})}getLastRemoteSnapshotVersion(e){return this.lr(e).next(t=>Ie.fromTimestamp(new gt(t.lastRemoteSnapshotVersion.seconds,t.lastRemoteSnapshotVersion.nanoseconds)))}getHighestSequenceNumber(e){return this.lr(e).next(t=>t.highestListenSequenceNumber)}setTargetsMetadata(e,t,r){return this.lr(e).next(s=>(s.highestListenSequenceNumber=t,r&&(s.lastRemoteSnapshotVersion=r.toTimestamp()),t>s.highestListenSequenceNumber&&(s.highestListenSequenceNumber=t),this.hr(e,s)))}addTargetData(e,t){return this.Pr(e,t).next(()=>this.lr(e).next(r=>(r.targetCount+=1,this.Tr(t,r),this.hr(e,r))))}updateTargetData(e,t){return this.Pr(e,t)}removeTargetData(e,t){return this.removeMatchingKeysForTargetId(e,t.targetId).next(()=>gl(e).delete(t.targetId)).next(()=>this.lr(e)).next(r=>(ye(r.targetCount>0,8065),r.targetCount-=1,this.hr(e,r)))}removeTargets(e,t,r){let s=0;const i=[];return gl(e).ee((o,a)=>{const l=Ru(a);l.sequenceNumber<=t&&r.get(l.targetId)===null&&(s++,i.push(this.removeTargetData(e,l)))}).next(()=>O.waitFor(i)).next(()=>s)}forEachTarget(e,t){return gl(e).ee((r,s)=>{const i=Ru(s);t(i)})}lr(e){return vT(e).get(Gg).next(t=>(ye(t!==null,2888),t))}hr(e,t){return vT(e).put(Gg,t)}Pr(e,t){return gl(e).put(ok(this.serializer,t))}Tr(e,t){let r=!1;return e.targetId>t.highestTargetId&&(t.highestTargetId=e.targetId,r=!0),e.sequenceNumber>t.highestListenSequenceNumber&&(t.highestListenSequenceNumber=e.sequenceNumber,r=!0),r}getTargetCount(e){return this.lr(e).next(t=>t.targetCount)}getTargetData(e,t){const r=Pa(t),s=IDBKeyRange.bound([r,Number.NEGATIVE_INFINITY],[r,Number.POSITIVE_INFINITY]);let i=null;return gl(e).ee({range:s,index:ZR},(o,a,l)=>{const u=Ru(a);yh(t,u.target)&&(i=u,l.done())}).next(()=>i)}addMatchingKeys(e,t,r){const s=[],i=Hi(e);return t.forEach(o=>{const a=tr(o.path);s.push(i.put({targetId:r,path:a})),s.push(this.referenceDelegate.addReference(e,r,o))}),O.waitFor(s)}removeMatchingKeys(e,t,r){const s=Hi(e);return O.forEach(t,i=>{const o=tr(i.path);return O.waitFor([s.delete([r,o]),this.referenceDelegate.removeReference(e,r,i)])})}removeMatchingKeysForTargetId(e,t){const r=Hi(e),s=IDBKeyRange.bound([t],[t+1],!1,!0);return r.delete(s)}getMatchingKeysForTargetId(e,t){const r=IDBKeyRange.bound([t],[t+1],!1,!0),s=Hi(e);let i=je();return s.ee({range:r,X:!0},(o,a,l)=>{const u=Os(o[1]),h=new ne(u);i=i.add(h)}).next(()=>i)}containsKey(e,t){const r=tr(t.path),s=IDBKeyRange.bound([r],[BR(r)],!1,!0);let i=0;return Hi(e).ee({index:Sw,X:!0,range:s},([o,a],l,u)=>{o!==0&&(i++,u.done())}).next(()=>i>0)}At(e,t){return gl(e).get(t).next(r=>r?Ru(r):null)}}function gl(n){return En(n,fc)}function vT(n){return En(n,ya)}function Hi(n){return En(n,gc)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const wT="LruGarbageCollector",fk=1048576;function xT([n,e],[t,r]){const s=Pe(n,t);return s===0?Pe(e,r):s}class v5{constructor(e){this.Ir=e,this.buffer=new St(xT),this.Er=0}dr(){return++this.Er}Ar(e){const t=[e,this.dr()];if(this.buffer.size<this.Ir)this.buffer=this.buffer.add(t);else{const r=this.buffer.last();xT(t,r)<0&&(this.buffer=this.buffer.delete(r).add(t))}}get maxValue(){return this.buffer.last()[0]}}class gk{constructor(e,t,r){this.garbageCollector=e,this.asyncQueue=t,this.localStore=r,this.Rr=null}start(){this.garbageCollector.params.cacheSizeCollectionThreshold!==-1&&this.Vr(6e4)}stop(){this.Rr&&(this.Rr.cancel(),this.Rr=null)}get started(){return this.Rr!==null}Vr(e){W(wT,`Garbage collection scheduled in ${e}ms`),this.Rr=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",e,async()=>{this.Rr=null;try{await this.localStore.collectGarbage(this.garbageCollector)}catch(t){Uo(t)?W(wT,"Ignoring IndexedDB error during garbage collection: ",t):await jo(t)}await this.Vr(3e5)})}}class w5{constructor(e,t){this.mr=e,this.params=t}calculateTargetCount(e,t){return this.mr.gr(e).next(r=>Math.floor(t/100*r))}nthSequenceNumber(e,t){if(t===0)return O.resolve(mr.ce);const r=new v5(t);return this.mr.forEachTarget(e,s=>r.Ar(s.sequenceNumber)).next(()=>this.mr.pr(e,s=>r.Ar(s))).next(()=>r.maxValue)}removeTargets(e,t,r){return this.mr.removeTargets(e,t,r)}removeOrphanedDocuments(e,t){return this.mr.removeOrphanedDocuments(e,t)}collect(e,t){return this.params.cacheSizeCollectionThreshold===-1?(W("LruGarbageCollector","Garbage collection skipped; disabled"),O.resolve(_T)):this.getCacheSize(e).next(r=>r<this.params.cacheSizeCollectionThreshold?(W("LruGarbageCollector",`Garbage collection skipped; Cache size ${r} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),_T):this.yr(e,t))}getCacheSize(e){return this.mr.getCacheSize(e)}yr(e,t){let r,s,i,o,a,l,u;const h=Date.now();return this.calculateTargetCount(e,this.params.percentileToCollect).next(f=>(f>this.params.maximumSequenceNumbersToCollect?(W("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${f}`),s=this.params.maximumSequenceNumbersToCollect):s=f,o=Date.now(),this.nthSequenceNumber(e,s))).next(f=>(r=f,a=Date.now(),this.removeTargets(e,r,t))).next(f=>(i=f,l=Date.now(),this.removeOrphanedDocuments(e,r))).next(f=>(u=Date.now(),ml()<=Ze.DEBUG&&W("LruGarbageCollector",`LRU Garbage Collection
	Counted targets in ${o-h}ms
	Determined least recently used ${s} in `+(a-o)+`ms
	Removed ${i} targets in `+(l-a)+`ms
	Removed ${f} documents in `+(u-l)+`ms
Total Duration: ${u-h}ms`),O.resolve({didRun:!0,sequenceNumbersCollected:s,targetsRemoved:i,documentsRemoved:f})))}}function pk(n,e){return new w5(n,e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class x5{constructor(e,t){this.db=e,this.garbageCollector=pk(this,t)}gr(e){const t=this.wr(e);return this.db.getTargetCache().getTargetCount(e).next(r=>t.next(s=>r+s))}wr(e){let t=0;return this.pr(e,r=>{t++}).next(()=>t)}forEachTarget(e,t){return this.db.getTargetCache().forEachTarget(e,t)}pr(e,t){return this.Sr(e,(r,s)=>t(s))}addReference(e,t,r){return mf(e,r)}removeReference(e,t,r){return mf(e,r)}removeTargets(e,t,r){return this.db.getTargetCache().removeTargets(e,t,r)}markPotentiallyOrphaned(e,t){return mf(e,t)}br(e,t){return function(s,i){let o=!1;return hk(s).te(a=>dk(s,a,i).next(l=>(l&&(o=!0),O.resolve(!l)))).next(()=>o)}(e,t)}removeOrphanedDocuments(e,t){const r=this.db.getRemoteDocumentCache().newChangeBuffer(),s=[];let i=0;return this.Sr(e,(o,a)=>{if(a<=t){const l=this.br(e,o).next(u=>{if(!u)return i++,r.getEntry(e,o).next(()=>(r.removeEntry(o,Ie.min()),Hi(e).delete(function(f){return[0,tr(f.path)]}(o))))});s.push(l)}}).next(()=>O.waitFor(s)).next(()=>r.apply(e)).next(()=>i)}removeTarget(e,t){const r=t.withSequenceNumber(e.currentSequenceNumber);return this.db.getTargetCache().updateTargetData(e,r)}updateLimboDocument(e,t){return mf(e,t)}Sr(e,t){const r=Hi(e);let s,i=mr.ce;return r.ee({index:Sw},([o,a],{path:l,sequenceNumber:u})=>{o===0?(i!==mr.ce&&t(new ne(Os(s)),i),i=u,s=l):i=mr.ce}).next(()=>{i!==mr.ce&&t(new ne(Os(s)),i)})}getCacheSize(e){return this.db.getRemoteDocumentCache().getSize(e)}}function mf(n,e){return Hi(n).put(function(r,s){return{targetId:0,path:tr(r.path),sequenceNumber:s}}(e,n.currentSequenceNumber))}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class mk{constructor(){this.changes=new Ci(e=>e.toString(),(e,t)=>e.isEqual(t)),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,t){this.assertNotApplied(),this.changes.set(e,Ut.newInvalidDocument(e).setReadTime(t))}getEntry(e,t){this.assertNotApplied();const r=this.changes.get(t);return r!==void 0?O.resolve(r):this.getFromCache(e,t)}getEntries(e,t){return this.getAllFromCache(e,t)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class I5{constructor(e){this.serializer=e}setIndexManager(e){this.indexManager=e}addEntry(e,t,r){return Qo(e).put(r)}removeEntry(e,t,r){return Qo(e).delete(function(i,o){const a=i.path.toArray();return[a.slice(0,a.length-2),a[a.length-2],Yg(o),a[a.length-1]]}(t,r))}updateMetadata(e,t){return this.getMetadata(e).next(r=>(r.byteSize+=t,this.Dr(e,r)))}getEntry(e,t){let r=Ut.newInvalidDocument(t);return Qo(e).ee({index:$f,range:IDBKeyRange.only(mu(t))},(s,i)=>{r=this.Cr(t,i)}).next(()=>r)}vr(e,t){let r={size:0,document:Ut.newInvalidDocument(t)};return Qo(e).ee({index:$f,range:IDBKeyRange.only(mu(t))},(s,i)=>{r={document:this.Cr(t,i),size:Xg(i)}}).next(()=>r)}getEntries(e,t){let r=_r();return this.Fr(e,t,(s,i)=>{const o=this.Cr(s,i);r=r.insert(s,o)}).next(()=>r)}Mr(e,t){let r=_r(),s=new Ot(ne.comparator);return this.Fr(e,t,(i,o)=>{const a=this.Cr(i,o);r=r.insert(i,a),s=s.insert(i,Xg(o))}).next(()=>({documents:r,Or:s}))}Fr(e,t,r){if(t.isEmpty())return O.resolve();let s=new St(ST);t.forEach(l=>s=s.add(l));const i=IDBKeyRange.bound(mu(s.first()),mu(s.last())),o=s.getIterator();let a=o.getNext();return Qo(e).ee({index:$f,range:i},(l,u,h)=>{const f=ne.fromSegments([...u.prefixPath,u.collectionGroup,u.documentId]);for(;a&&ST(a,f)<0;)r(a,null),a=o.getNext();a&&a.isEqual(f)&&(r(a,u),a=o.hasNext()?o.getNext():null),a?h.j(mu(a)):h.done()}).next(()=>{for(;a;)r(a,null),a=o.hasNext()?o.getNext():null})}getDocumentsMatchingQuery(e,t,r,s,i){const o=t.path,a=[o.popLast().toArray(),o.lastSegment(),Yg(r.readTime),r.documentKey.path.isEmpty()?"":r.documentKey.path.lastSegment()],l=[o.popLast().toArray(),o.lastSegment(),[Number.MAX_SAFE_INTEGER,Number.MAX_SAFE_INTEGER],""];return Qo(e).J(IDBKeyRange.bound(a,l,!0)).next(u=>{i==null||i.incrementDocumentReadCount(u.length);let h=_r();for(const f of u){const g=this.Cr(ne.fromSegments(f.prefixPath.concat(f.collectionGroup,f.documentId)),f);g.isFoundDocument()&&(vh(t,g)||s.has(g.key))&&(h=h.insert(g.key,g))}return h})}getAllFromCollectionGroup(e,t,r,s){let i=_r();const o=ET(t,r),a=ET(t,Br.max());return Qo(e).ee({index:XR,range:IDBKeyRange.bound(o,a,!0)},(l,u,h)=>{const f=this.Cr(ne.fromSegments(u.prefixPath.concat(u.collectionGroup,u.documentId)),u);i=i.insert(f.key,f),i.size===s&&h.done()}).next(()=>i)}newChangeBuffer(e){return new E5(this,!!e&&e.trackRemovals)}getSize(e){return this.getMetadata(e).next(t=>t.byteSize)}getMetadata(e){return IT(e).get(dv).next(t=>(ye(!!t,20021),t))}Dr(e,t){return IT(e).put(dv,t)}Cr(e,t){if(t){const r=l5(this.serializer,t);if(!(r.isNoDocument()&&r.version.isEqual(Ie.min())))return r}return Ut.newInvalidDocument(e)}}function yk(n){return new I5(n)}class E5 extends mk{constructor(e,t){super(),this.Nr=e,this.trackRemovals=t,this.Br=new Ci(r=>r.toString(),(r,s)=>r.isEqual(s))}applyChanges(e){const t=[];let r=0,s=new St((i,o)=>Pe(i.canonicalString(),o.canonicalString()));return this.changes.forEach((i,o)=>{const a=this.Br.get(i);if(t.push(this.Nr.removeEntry(e,i,a.readTime)),o.isValidDocument()){const l=iT(this.Nr.serializer,o);s=s.add(i.path.popLast());const u=Xg(l);r+=u-a.size,t.push(this.Nr.addEntry(e,i,l))}else if(r-=a.size,this.trackRemovals){const l=iT(this.Nr.serializer,o.convertToNoDocument(Ie.min()));t.push(this.Nr.addEntry(e,i,l))}}),s.forEach(i=>{t.push(this.Nr.indexManager.addToCollectionParentIndex(e,i))}),t.push(this.Nr.updateMetadata(e,r)),O.waitFor(t)}getFromCache(e,t){return this.Nr.vr(e,t).next(r=>(this.Br.set(t,{size:r.size,readTime:r.document.readTime}),r.document))}getAllFromCache(e,t){return this.Nr.Mr(e,t).next(({documents:r,Or:s})=>(s.forEach((i,o)=>{this.Br.set(i,{size:o,readTime:r.get(i).readTime})}),r))}}function IT(n){return En(n,Md)}function Qo(n){return En(n,Wg)}function mu(n){const e=n.path.toArray();return[e.slice(0,e.length-2),e[e.length-2],e[e.length-1]]}function ET(n,e){const t=e.documentKey.path.toArray();return[n,Yg(e.readTime),t.slice(0,t.length-2),t.length>0?t[t.length-1]:""]}function ST(n,e){const t=n.path.toArray(),r=e.path.toArray();let s=0;for(let i=0;i<t.length-2&&i<r.length-2;++i)if(s=Pe(t[i],r[i]),s)return s;return s=Pe(t.length,r.length),s||(s=Pe(t[t.length-2],r[r.length-2]),s||Pe(t[t.length-1],r[r.length-1]))}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class S5{constructor(e,t){this.overlayedDocument=e,this.mutatedFields=t}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class _k{constructor(e,t,r,s){this.remoteDocumentCache=e,this.mutationQueue=t,this.documentOverlayCache=r,this.indexManager=s}getDocument(e,t){let r=null;return this.documentOverlayCache.getOverlay(e,t).next(s=>(r=s,this.remoteDocumentCache.getEntry(e,t))).next(s=>(r!==null&&Ju(r.mutation,s,yr.empty(),gt.now()),s))}getDocuments(e,t){return this.remoteDocumentCache.getEntries(e,t).next(r=>this.getLocalViewOfDocuments(e,r,je()).next(()=>r))}getLocalViewOfDocuments(e,t,r=je()){const s=Vs();return this.populateOverlays(e,s,t).next(()=>this.computeViews(e,t,s,r).next(i=>{let o=Au();return i.forEach((a,l)=>{o=o.insert(a,l.overlayedDocument)}),o}))}getOverlayedDocuments(e,t){const r=Vs();return this.populateOverlays(e,r,t).next(()=>this.computeViews(e,t,r,je()))}populateOverlays(e,t,r){const s=[];return r.forEach(i=>{t.has(i)||s.push(i)}),this.documentOverlayCache.getOverlays(e,s).next(i=>{i.forEach((o,a)=>{t.set(o,a)})})}computeViews(e,t,r,s){let i=_r();const o=Yu(),a=function(){return Yu()}();return t.forEach((l,u)=>{const h=r.get(u.key);s.has(u.key)&&(h===void 0||h.mutation instanceof Ri)?i=i.insert(u.key,u):h!==void 0?(o.set(u.key,h.mutation.getFieldMask()),Ju(h.mutation,u,h.mutation.getFieldMask(),gt.now())):o.set(u.key,yr.empty())}),this.recalculateAndSaveOverlays(e,i).next(l=>(l.forEach((u,h)=>o.set(u,h)),t.forEach((u,h)=>a.set(u,new S5(h,o.get(u)??null))),a))}recalculateAndSaveOverlays(e,t){const r=Yu();let s=new Ot((o,a)=>o-a),i=je();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,t).next(o=>{for(const a of o)a.keys().forEach(l=>{const u=t.get(l);if(u===null)return;let h=r.get(l)||yr.empty();h=a.applyToLocalView(u,h),r.set(l,h);const f=(s.get(a.batchId)||je()).add(l);s=s.insert(a.batchId,f)})}).next(()=>{const o=[],a=s.getReverseIterator();for(;a.hasNext();){const l=a.getNext(),u=l.key,h=l.value,f=DN();h.forEach(g=>{if(!i.has(g)){const y=UN(t.get(g),r.get(g));y!==null&&f.set(g,y),i=i.add(g)}}),o.push(this.documentOverlayCache.saveOverlays(e,u,f))}return O.waitFor(o)}).next(()=>r)}recalculateAndSaveOverlaysForDocumentKeys(e,t){return this.remoteDocumentCache.getEntries(e,t).next(r=>this.recalculateAndSaveOverlays(e,r))}getDocumentsMatchingQuery(e,t,r,s){return function(o){return ne.isDocumentKey(o.path)&&o.collectionGroup===null&&o.filters.length===0}(t)?this.getDocumentsMatchingDocumentQuery(e,t.path):kw(t)?this.getDocumentsMatchingCollectionGroupQuery(e,t,r,s):this.getDocumentsMatchingCollectionQuery(e,t,r,s)}getNextDocuments(e,t,r,s){return this.remoteDocumentCache.getAllFromCollectionGroup(e,t,r,s).next(i=>{const o=s-i.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(e,t,r.largestBatchId,s-i.size):O.resolve(Vs());let a=cc,l=i;return o.next(u=>O.forEach(u,(h,f)=>(a<f.largestBatchId&&(a=f.largestBatchId),i.get(h)?O.resolve():this.remoteDocumentCache.getEntry(e,h).next(g=>{l=l.insert(h,g)}))).next(()=>this.populateOverlays(e,u,i)).next(()=>this.computeViews(e,l,u,je())).next(h=>({batchId:a,changes:PN(h)})))})}getDocumentsMatchingDocumentQuery(e,t){return this.getDocument(e,new ne(t)).next(r=>{let s=Au();return r.isFoundDocument()&&(s=s.insert(r.key,r)),s})}getDocumentsMatchingCollectionGroupQuery(e,t,r,s){const i=t.collectionGroup;let o=Au();return this.indexManager.getCollectionParents(e,i).next(a=>O.forEach(a,l=>{const u=function(f,g){return new Ai(g,null,f.explicitOrderBy.slice(),f.filters.slice(),f.limit,f.limitType,f.startAt,f.endAt)}(t,l.child(i));return this.getDocumentsMatchingCollectionQuery(e,u,r,s).next(h=>{h.forEach((f,g)=>{o=o.insert(f,g)})})}).next(()=>o))}getDocumentsMatchingCollectionQuery(e,t,r,s){let i;return this.documentOverlayCache.getOverlaysForCollection(e,t.path,r.largestBatchId).next(o=>(i=o,this.remoteDocumentCache.getDocumentsMatchingQuery(e,t,r,i,s))).next(o=>{i.forEach((l,u)=>{const h=u.getKey();o.get(h)===null&&(o=o.insert(h,Ut.newInvalidDocument(h)))});let a=Au();return o.forEach((l,u)=>{const h=i.get(l);h!==void 0&&Ju(h.mutation,u,yr.empty(),gt.now()),vh(t,u)&&(a=a.insert(l,u))}),a})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class T5{constructor(e){this.serializer=e,this.Lr=new Map,this.kr=new Map}getBundleMetadata(e,t){return O.resolve(this.Lr.get(t))}saveBundleMetadata(e,t){return this.Lr.set(t.id,function(s){return{id:s.id,version:s.version,createTime:hn(s.createTime)}}(t)),O.resolve()}getNamedQuery(e,t){return O.resolve(this.kr.get(t))}saveNamedQuery(e,t){return this.kr.set(t.name,function(s){return{name:s.name,query:lm(s.bundledQuery),readTime:hn(s.readTime)}}(t)),O.resolve()}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class b5{constructor(){this.overlays=new Ot(ne.comparator),this.qr=new Map}getOverlay(e,t){return O.resolve(this.overlays.get(t))}getOverlays(e,t){const r=Vs();return O.forEach(t,s=>this.getOverlay(e,s).next(i=>{i!==null&&r.set(s,i)})).next(()=>r)}saveOverlays(e,t,r){return r.forEach((s,i)=>{this.St(e,t,i)}),O.resolve()}removeOverlaysForBatchId(e,t,r){const s=this.qr.get(r);return s!==void 0&&(s.forEach(i=>this.overlays=this.overlays.remove(i)),this.qr.delete(r)),O.resolve()}getOverlaysForCollection(e,t,r){const s=Vs(),i=t.length+1,o=new ne(t.child("")),a=this.overlays.getIteratorFrom(o);for(;a.hasNext();){const l=a.getNext().value,u=l.getKey();if(!t.isPrefixOf(u.path))break;u.path.length===i&&l.largestBatchId>r&&s.set(l.getKey(),l)}return O.resolve(s)}getOverlaysForCollectionGroup(e,t,r,s){let i=new Ot((u,h)=>u-h);const o=this.overlays.getIterator();for(;o.hasNext();){const u=o.getNext().value;if(u.getKey().getCollectionGroup()===t&&u.largestBatchId>r){let h=i.get(u.largestBatchId);h===null&&(h=Vs(),i=i.insert(u.largestBatchId,h)),h.set(u.getKey(),u)}}const a=Vs(),l=i.getIterator();for(;l.hasNext()&&(l.getNext().value.forEach((u,h)=>a.set(u,h)),!(a.size()>=s)););return O.resolve(a)}St(e,t,r){const s=this.overlays.get(r.key);if(s!==null){const o=this.qr.get(s.largestBatchId).delete(r.key);this.qr.set(s.largestBatchId,o)}this.overlays=this.overlays.insert(r.key,new Vw(t,r));let i=this.qr.get(t);i===void 0&&(i=je(),this.qr.set(t,i)),this.qr.set(t,i.add(r.key))}}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class A5{constructor(){this.sessionToken=an.EMPTY_BYTE_STRING}getSessionToken(e){return O.resolve(this.sessionToken)}setSessionToken(e,t){return this.sessionToken=t,O.resolve()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Bw{constructor(){this.Qr=new St(An.$r),this.Ur=new St(An.Kr)}isEmpty(){return this.Qr.isEmpty()}addReference(e,t){const r=new An(e,t);this.Qr=this.Qr.add(r),this.Ur=this.Ur.add(r)}Wr(e,t){e.forEach(r=>this.addReference(r,t))}removeReference(e,t){this.Gr(new An(e,t))}zr(e,t){e.forEach(r=>this.removeReference(r,t))}jr(e){const t=new ne(new Je([])),r=new An(t,e),s=new An(t,e+1),i=[];return this.Ur.forEachInRange([r,s],o=>{this.Gr(o),i.push(o.key)}),i}Jr(){this.Qr.forEach(e=>this.Gr(e))}Gr(e){this.Qr=this.Qr.delete(e),this.Ur=this.Ur.delete(e)}Hr(e){const t=new ne(new Je([])),r=new An(t,e),s=new An(t,e+1);let i=je();return this.Ur.forEachInRange([r,s],o=>{i=i.add(o.key)}),i}containsKey(e){const t=new An(e,0),r=this.Qr.firstAfterOrEqual(t);return r!==null&&e.isEqual(r.key)}}class An{constructor(e,t){this.key=e,this.Yr=t}static $r(e,t){return ne.comparator(e.key,t.key)||Pe(e.Yr,t.Yr)}static Kr(e,t){return Pe(e.Yr,t.Yr)||ne.comparator(e.key,t.key)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class C5{constructor(e,t){this.indexManager=e,this.referenceDelegate=t,this.mutationQueue=[],this.tr=1,this.Zr=new St(An.$r)}checkEmpty(e){return O.resolve(this.mutationQueue.length===0)}addMutationBatch(e,t,r,s){const i=this.tr;this.tr++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];const o=new Lw(i,t,r,s);this.mutationQueue.push(o);for(const a of s)this.Zr=this.Zr.add(new An(a.key,i)),this.indexManager.addToCollectionParentIndex(e,a.key.path.popLast());return O.resolve(o)}lookupMutationBatch(e,t){return O.resolve(this.Xr(t))}getNextMutationBatchAfterBatchId(e,t){const r=t+1,s=this.ei(r),i=s<0?0:s;return O.resolve(this.mutationQueue.length>i?this.mutationQueue[i]:null)}getHighestUnacknowledgedBatchId(){return O.resolve(this.mutationQueue.length===0?vo:this.tr-1)}getAllMutationBatches(e){return O.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,t){const r=new An(t,0),s=new An(t,Number.POSITIVE_INFINITY),i=[];return this.Zr.forEachInRange([r,s],o=>{const a=this.Xr(o.Yr);i.push(a)}),O.resolve(i)}getAllMutationBatchesAffectingDocumentKeys(e,t){let r=new St(Pe);return t.forEach(s=>{const i=new An(s,0),o=new An(s,Number.POSITIVE_INFINITY);this.Zr.forEachInRange([i,o],a=>{r=r.add(a.Yr)})}),O.resolve(this.ti(r))}getAllMutationBatchesAffectingQuery(e,t){const r=t.path,s=r.length+1;let i=r;ne.isDocumentKey(i)||(i=i.child(""));const o=new An(new ne(i),0);let a=new St(Pe);return this.Zr.forEachWhile(l=>{const u=l.key.path;return!!r.isPrefixOf(u)&&(u.length===s&&(a=a.add(l.Yr)),!0)},o),O.resolve(this.ti(a))}ti(e){const t=[];return e.forEach(r=>{const s=this.Xr(r);s!==null&&t.push(s)}),t}removeMutationBatch(e,t){ye(this.ni(t.batchId,"removed")===0,55003),this.mutationQueue.shift();let r=this.Zr;return O.forEach(t.mutations,s=>{const i=new An(s.key,t.batchId);return r=r.delete(i),this.referenceDelegate.markPotentiallyOrphaned(e,s.key)}).next(()=>{this.Zr=r})}ir(e){}containsKey(e,t){const r=new An(t,0),s=this.Zr.firstAfterOrEqual(r);return O.resolve(t.isEqual(s&&s.key))}performConsistencyCheck(e){return this.mutationQueue.length,O.resolve()}ni(e,t){return this.ei(e)}ei(e){return this.mutationQueue.length===0?0:e-this.mutationQueue[0].batchId}Xr(e){const t=this.ei(e);return t<0||t>=this.mutationQueue.length?null:this.mutationQueue[t]}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class R5{constructor(e){this.ri=e,this.docs=function(){return new Ot(ne.comparator)}(),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,t){const r=t.key,s=this.docs.get(r),i=s?s.size:0,o=this.ri(t);return this.docs=this.docs.insert(r,{document:t.mutableCopy(),size:o}),this.size+=o-i,this.indexManager.addToCollectionParentIndex(e,r.path.popLast())}removeEntry(e){const t=this.docs.get(e);t&&(this.docs=this.docs.remove(e),this.size-=t.size)}getEntry(e,t){const r=this.docs.get(t);return O.resolve(r?r.document.mutableCopy():Ut.newInvalidDocument(t))}getEntries(e,t){let r=_r();return t.forEach(s=>{const i=this.docs.get(s);r=r.insert(s,i?i.document.mutableCopy():Ut.newInvalidDocument(s))}),O.resolve(r)}getDocumentsMatchingQuery(e,t,r,s){let i=_r();const o=t.path,a=new ne(o.child("__id-9223372036854775808__")),l=this.docs.getIteratorFrom(a);for(;l.hasNext();){const{key:u,value:{document:h}}=l.getNext();if(!o.isPrefixOf(u.path))break;u.path.length>o.length+1||Iw(GR(h),r)<=0||(s.has(h.key)||vh(t,h))&&(i=i.insert(h.key,h.mutableCopy()))}return O.resolve(i)}getAllFromCollectionGroup(e,t,r,s){ue(9500)}ii(e,t){return O.forEach(this.docs,r=>t(r))}newChangeBuffer(e){return new N5(this)}getSize(e){return O.resolve(this.size)}}class N5 extends mk{constructor(e){super(),this.Nr=e}applyChanges(e){const t=[];return this.changes.forEach((r,s)=>{s.isValidDocument()?t.push(this.Nr.addEntry(e,s)):this.Nr.removeEntry(r)}),O.waitFor(t)}getFromCache(e,t){return this.Nr.getEntry(e,t)}getAllFromCache(e,t){return this.Nr.getEntries(e,t)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class k5{constructor(e){this.persistence=e,this.si=new Ci(t=>Pa(t),yh),this.lastRemoteSnapshotVersion=Ie.min(),this.highestTargetId=0,this.oi=0,this._i=new Bw,this.targetCount=0,this.ai=Va.ur()}forEachTarget(e,t){return this.si.forEach((r,s)=>t(s)),O.resolve()}getLastRemoteSnapshotVersion(e){return O.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return O.resolve(this.oi)}allocateTargetId(e){return this.highestTargetId=this.ai.next(),O.resolve(this.highestTargetId)}setTargetsMetadata(e,t,r){return r&&(this.lastRemoteSnapshotVersion=r),t>this.oi&&(this.oi=t),O.resolve()}Pr(e){this.si.set(e.target,e);const t=e.targetId;t>this.highestTargetId&&(this.ai=new Va(t),this.highestTargetId=t),e.sequenceNumber>this.oi&&(this.oi=e.sequenceNumber)}addTargetData(e,t){return this.Pr(t),this.targetCount+=1,O.resolve()}updateTargetData(e,t){return this.Pr(t),O.resolve()}removeTargetData(e,t){return this.si.delete(t.target),this._i.jr(t.targetId),this.targetCount-=1,O.resolve()}removeTargets(e,t,r){let s=0;const i=[];return this.si.forEach((o,a)=>{a.sequenceNumber<=t&&r.get(a.targetId)===null&&(this.si.delete(o),i.push(this.removeMatchingKeysForTargetId(e,a.targetId)),s++)}),O.waitFor(i).next(()=>s)}getTargetCount(e){return O.resolve(this.targetCount)}getTargetData(e,t){const r=this.si.get(t)||null;return O.resolve(r)}addMatchingKeys(e,t,r){return this._i.Wr(t,r),O.resolve()}removeMatchingKeys(e,t,r){this._i.zr(t,r);const s=this.persistence.referenceDelegate,i=[];return s&&t.forEach(o=>{i.push(s.markPotentiallyOrphaned(e,o))}),O.waitFor(i)}removeMatchingKeysForTargetId(e,t){return this._i.jr(t),O.resolve()}getMatchingKeysForTargetId(e,t){const r=this._i.Hr(t);return O.resolve(r)}containsKey(e,t){return O.resolve(this._i.containsKey(t))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class zw{constructor(e,t){this.ui={},this.overlays={},this.ci=new mr(0),this.li=!1,this.li=!0,this.hi=new A5,this.referenceDelegate=e(this),this.Pi=new k5(this),this.indexManager=new m5,this.remoteDocumentCache=function(s){return new R5(s)}(r=>this.referenceDelegate.Ti(r)),this.serializer=new ik(t),this.Ii=new T5(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.li=!1,Promise.resolve()}get started(){return this.li}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let t=this.overlays[e.toKey()];return t||(t=new b5,this.overlays[e.toKey()]=t),t}getMutationQueue(e,t){let r=this.ui[e.toKey()];return r||(r=new C5(t,this.referenceDelegate),this.ui[e.toKey()]=r),r}getGlobalsCache(){return this.hi}getTargetCache(){return this.Pi}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.Ii}runTransaction(e,t,r){W("MemoryPersistence","Starting transaction:",e);const s=new P5(this.ci.next());return this.referenceDelegate.Ei(),r(s).next(i=>this.referenceDelegate.di(s).next(()=>i)).toPromise().then(i=>(s.raiseOnCommittedEvent(),i))}Ai(e,t){return O.or(Object.values(this.ui).map(r=>()=>r.containsKey(e,t)))}}class P5 extends KR{constructor(e){super(),this.currentSequenceNumber=e}}class dm{constructor(e){this.persistence=e,this.Ri=new Bw,this.Vi=null}static mi(e){return new dm(e)}get fi(){if(this.Vi)return this.Vi;throw ue(60996)}addReference(e,t,r){return this.Ri.addReference(r,t),this.fi.delete(r.toString()),O.resolve()}removeReference(e,t,r){return this.Ri.removeReference(r,t),this.fi.add(r.toString()),O.resolve()}markPotentiallyOrphaned(e,t){return this.fi.add(t.toString()),O.resolve()}removeTarget(e,t){this.Ri.jr(t.targetId).forEach(s=>this.fi.add(s.toString()));const r=this.persistence.getTargetCache();return r.getMatchingKeysForTargetId(e,t.targetId).next(s=>{s.forEach(i=>this.fi.add(i.toString()))}).next(()=>r.removeTargetData(e,t))}Ei(){this.Vi=new Set}di(e){const t=this.persistence.getRemoteDocumentCache().newChangeBuffer();return O.forEach(this.fi,r=>{const s=ne.fromPath(r);return this.gi(e,s).next(i=>{i||t.removeEntry(s,Ie.min())})}).next(()=>(this.Vi=null,t.apply(e)))}updateLimboDocument(e,t){return this.gi(e,t).next(r=>{r?this.fi.delete(t.toString()):this.fi.add(t.toString())})}Ti(e){return 0}gi(e,t){return O.or([()=>O.resolve(this.Ri.containsKey(t)),()=>this.persistence.getTargetCache().containsKey(e,t),()=>this.persistence.Ai(e,t)])}}class Zg{constructor(e,t){this.persistence=e,this.pi=new Ci(r=>tr(r.path),(r,s)=>r.isEqual(s)),this.garbageCollector=pk(this,t)}static mi(e,t){return new Zg(e,t)}Ei(){}di(e){return O.resolve()}forEachTarget(e,t){return this.persistence.getTargetCache().forEachTarget(e,t)}gr(e){const t=this.wr(e);return this.persistence.getTargetCache().getTargetCount(e).next(r=>t.next(s=>r+s))}wr(e){let t=0;return this.pr(e,r=>{t++}).next(()=>t)}pr(e,t){return O.forEach(this.pi,(r,s)=>this.br(e,r,s).next(i=>i?O.resolve():t(s)))}removeTargets(e,t,r){return this.persistence.getTargetCache().removeTargets(e,t,r)}removeOrphanedDocuments(e,t){let r=0;const s=this.persistence.getRemoteDocumentCache(),i=s.newChangeBuffer();return s.ii(e,o=>this.br(e,o,t).next(a=>{a||(r++,i.removeEntry(o,Ie.min()))})).next(()=>i.apply(e)).next(()=>r)}markPotentiallyOrphaned(e,t){return this.pi.set(t,e.currentSequenceNumber),O.resolve()}removeTarget(e,t){const r=t.withSequenceNumber(e.currentSequenceNumber);return this.persistence.getTargetCache().updateTargetData(e,r)}addReference(e,t,r){return this.pi.set(r,e.currentSequenceNumber),O.resolve()}removeReference(e,t,r){return this.pi.set(r,e.currentSequenceNumber),O.resolve()}updateLimboDocument(e,t){return this.pi.set(t,e.currentSequenceNumber),O.resolve()}Ti(e){let t=e.key.toString().length;return e.isFoundDocument()&&(t+=zf(e.data.value)),t}br(e,t,r){return O.or([()=>this.persistence.Ai(e,t),()=>this.persistence.getTargetCache().containsKey(e,t),()=>{const s=this.pi.get(t);return O.resolve(s!==void 0&&s>r)}])}getCacheSize(e){return this.persistence.getRemoteDocumentCache().getSize(e)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class D5{constructor(e){this.serializer=e}k(e,t,r,s){const i=new Jp("createOrUpgrade",t);r<1&&s>=1&&(function(l){l.createObjectStore(mh)}(e),function(l){l.createObjectStore(Dd,{keyPath:X4}),l.createObjectStore(ds,{keyPath:LS,autoIncrement:!0}).createIndex(ua,OS,{unique:!0}),l.createObjectStore(hc)}(e),TT(e),function(l){l.createObjectStore(ta)}(e));let o=O.resolve();return r<3&&s>=3&&(r!==0&&(function(l){l.deleteObjectStore(gc),l.deleteObjectStore(fc),l.deleteObjectStore(ya)}(e),TT(e)),o=o.next(()=>function(l){const u=l.store(ya),h={highestTargetId:0,highestListenSequenceNumber:0,lastRemoteSnapshotVersion:Ie.min().toTimestamp(),targetCount:0};return u.put(Gg,h)}(i))),r<4&&s>=4&&(r!==0&&(o=o.next(()=>function(l,u){return u.store(ds).J().next(f=>{l.deleteObjectStore(ds),l.createObjectStore(ds,{keyPath:LS,autoIncrement:!0}).createIndex(ua,OS,{unique:!0});const g=u.store(ds),y=f.map(w=>g.put(w));return O.waitFor(y)})}(e,i))),o=o.next(()=>{(function(l){l.createObjectStore(pc,{keyPath:a3})})(e)})),r<5&&s>=5&&(o=o.next(()=>this.yi(i))),r<6&&s>=6&&(o=o.next(()=>(function(l){l.createObjectStore(Md)}(e),this.wi(i)))),r<7&&s>=7&&(o=o.next(()=>this.Si(i))),r<8&&s>=8&&(o=o.next(()=>this.bi(e,i))),r<9&&s>=9&&(o=o.next(()=>{(function(l){l.objectStoreNames.contains("remoteDocumentChanges")&&l.deleteObjectStore("remoteDocumentChanges")})(e)})),r<10&&s>=10&&(o=o.next(()=>this.Di(i))),r<11&&s>=11&&(o=o.next(()=>{(function(l){l.createObjectStore(Xp,{keyPath:l3})})(e),function(l){l.createObjectStore(Zp,{keyPath:c3})}(e)})),r<12&&s>=12&&(o=o.next(()=>{(function(l){const u=l.createObjectStore(em,{keyPath:m3});u.createIndex(fv,y3,{unique:!1}),u.createIndex(nN,_3,{unique:!1})})(e)})),r<13&&s>=13&&(o=o.next(()=>function(l){const u=l.createObjectStore(Wg,{keyPath:e3});u.createIndex($f,t3),u.createIndex(XR,n3)}(e)).next(()=>this.Ci(e,i)).next(()=>e.deleteObjectStore(ta))),r<14&&s>=14&&(o=o.next(()=>this.Fi(e,i))),r<15&&s>=15&&(o=o.next(()=>function(l){l.createObjectStore(Tw,{keyPath:u3,autoIncrement:!0}).createIndex(hv,d3,{unique:!1}),l.createObjectStore(Hu,{keyPath:h3}).createIndex(eN,f3,{unique:!1}),l.createObjectStore(Ku,{keyPath:g3}).createIndex(tN,p3,{unique:!1})}(e))),r<16&&s>=16&&(o=o.next(()=>{t.objectStore(Hu).clear()}).next(()=>{t.objectStore(Ku).clear()})),r<17&&s>=17&&(o=o.next(()=>{(function(l){l.createObjectStore(bw,{keyPath:v3})})(e)})),r<18&&s>=18&&sC()&&(o=o.next(()=>{t.objectStore(Hu).clear()}).next(()=>{t.objectStore(Ku).clear()})),o}wi(e){let t=0;return e.store(ta).ee((r,s)=>{t+=Xg(s)}).next(()=>{const r={byteSize:t};return e.store(Md).put(dv,r)})}yi(e){const t=e.store(Dd),r=e.store(ds);return t.J().next(s=>O.forEach(s,i=>{const o=IDBKeyRange.bound([i.userId,vo],[i.userId,i.lastAcknowledgedBatchId]);return r.J(ua,o).next(a=>O.forEach(a,l=>{ye(l.userId===i.userId,18650,"Cannot process batch from unexpected user",{batchId:l.batchId});const u=ra(this.serializer,l);return uk(e,i.userId,u).next(()=>{})}))}))}Si(e){const t=e.store(gc),r=e.store(ta);return e.store(ya).get(Gg).next(s=>{const i=[];return r.ee((o,a)=>{const l=new Je(o),u=function(f){return[0,tr(f)]}(l);i.push(t.get(u).next(h=>h?O.resolve():(f=>t.put({targetId:0,path:tr(f),sequenceNumber:s.highestListenSequenceNumber}))(l)))}).next(()=>O.waitFor(i))})}bi(e,t){e.createObjectStore(Ld,{keyPath:o3});const r=t.store(Ld),s=new $w,i=o=>{if(s.add(o)){const a=o.lastSegment(),l=o.popLast();return r.put({collectionId:a,parent:tr(l)})}};return t.store(ta).ee({X:!0},(o,a)=>{const l=new Je(o);return i(l.popLast())}).next(()=>t.store(hc).ee({X:!0},([o,a,l],u)=>{const h=Os(a);return i(h.popLast())}))}Di(e){const t=e.store(fc);return t.ee((r,s)=>{const i=Ru(s),o=ok(this.serializer,i);return t.put(o)})}Ci(e,t){const r=t.store(ta),s=[];return r.ee((i,o)=>{const a=t.store(Wg),l=function(f){return f.document?new ne(Je.fromString(f.document.name).popFirst(5)):f.noDocument?ne.fromSegments(f.noDocument.path):f.unknownDocument?ne.fromSegments(f.unknownDocument.path):ue(36783)}(o).path.toArray(),u={prefixPath:l.slice(0,l.length-2),collectionGroup:l[l.length-2],documentId:l[l.length-1],readTime:o.readTime||[0,0],unknownDocument:o.unknownDocument,noDocument:o.noDocument,document:o.document,hasCommittedMutations:!!o.hasCommittedMutations};s.push(a.put(u))}).next(()=>O.waitFor(s))}Fi(e,t){const r=t.store(ds),s=yk(this.serializer),i=new zw(dm.mi,this.serializer.yt);return r.J().next(o=>{const a=new Map;return o.forEach(l=>{let u=a.get(l.userId)??je();ra(this.serializer,l).keys().forEach(h=>u=u.add(h)),a.set(l.userId,u)}),O.forEach(a,(l,u)=>{const h=new Rn(u),f=cm.wt(this.serializer,h),g=i.getIndexManager(h),y=um.wt(h,this.serializer,g,i.referenceDelegate);return new _k(s,y,f,g).recalculateAndSaveOverlaysForDocumentKeys(new gv(t,mr.ce),l).next()})})}}function TT(n){n.createObjectStore(gc,{keyPath:s3}).createIndex(Sw,i3,{unique:!0}),n.createObjectStore(fc,{keyPath:"targetId"}).createIndex(ZR,r3,{unique:!0}),n.createObjectStore(ya)}const Ui="IndexedDbPersistence",Ay=18e5,Cy=5e3,Ry="Failed to obtain exclusive access to the persistence layer. To allow shared access, multi-tab synchronization has to be enabled in all tabs. If you are using `experimentalForceOwningTab:true`, make sure that only one tab has persistence enabled at any given time.",vk="main";class qw{constructor(e,t,r,s,i,o,a,l,u,h,f=18){if(this.allowTabSynchronization=e,this.persistenceKey=t,this.clientId=r,this.Mi=i,this.window=o,this.document=a,this.xi=u,this.Oi=h,this.Ni=f,this.ci=null,this.li=!1,this.isPrimary=!1,this.networkEnabled=!0,this.Bi=null,this.inForeground=!1,this.Li=null,this.ki=null,this.qi=Number.NEGATIVE_INFINITY,this.Qi=g=>Promise.resolve(),!qw.v())throw new z(U.UNIMPLEMENTED,"This platform is either missing IndexedDB or is known to have an incomplete implementation. Offline persistence has been disabled.");this.referenceDelegate=new x5(this,s),this.$i=t+vk,this.serializer=new ik(l),this.Ui=new Bs(this.$i,this.Ni,new D5(this.serializer)),this.hi=new u5,this.Pi=new _5(this.referenceDelegate,this.serializer),this.remoteDocumentCache=yk(this.serializer),this.Ii=new c5,this.window&&this.window.localStorage?this.Ki=this.window.localStorage:(this.Ki=null,h===!1&&dn(Ui,"LocalStorage is unavailable. As a result, persistence may not work reliably. In particular enablePersistence() could fail immediately after refreshing the page."))}start(){return this.Wi().then(()=>{if(!this.isPrimary&&!this.allowTabSynchronization)throw new z(U.FAILED_PRECONDITION,Ry);return this.Gi(),this.zi(),this.ji(),this.runTransaction("getHighestListenSequenceNumber","readonly",e=>this.Pi.getHighestSequenceNumber(e))}).then(e=>{this.ci=new mr(e,this.xi)}).then(()=>{this.li=!0}).catch(e=>(this.Ui&&this.Ui.close(),Promise.reject(e)))}Ji(e){return this.Qi=async t=>{if(this.started)return e(t)},e(this.isPrimary)}setDatabaseDeletedListener(e){this.Ui.$(async t=>{t.newVersion===null&&await e()})}setNetworkEnabled(e){this.networkEnabled!==e&&(this.networkEnabled=e,this.Mi.enqueueAndForget(async()=>{this.started&&await this.Wi()}))}Wi(){return this.runTransaction("updateClientMetadataAndTryBecomePrimary","readwrite",e=>yf(e).put({clientId:this.clientId,updateTimeMs:Date.now(),networkEnabled:this.networkEnabled,inForeground:this.inForeground}).next(()=>{if(this.isPrimary)return this.Hi(e).next(t=>{t||(this.isPrimary=!1,this.Mi.enqueueRetryable(()=>this.Qi(!1)))})}).next(()=>this.Yi(e)).next(t=>this.isPrimary&&!t?this.Zi(e).next(()=>!1):!!t&&this.Xi(e).next(()=>!0))).catch(e=>{if(Uo(e))return W(Ui,"Failed to extend owner lease: ",e),this.isPrimary;if(!this.allowTabSynchronization)throw e;return W(Ui,"Releasing owner lease after error during lease refresh",e),!1}).then(e=>{this.isPrimary!==e&&this.Mi.enqueueRetryable(()=>this.Qi(e)),this.isPrimary=e})}Hi(e){return yu(e).get(cl).next(t=>O.resolve(this.es(t)))}ts(e){return yf(e).delete(this.clientId)}async ns(){if(this.isPrimary&&!this.rs(this.qi,Ay)){this.qi=Date.now();const e=await this.runTransaction("maybeGarbageCollectMultiClientState","readwrite-primary",t=>{const r=En(t,pc);return r.J().next(s=>{const i=this.ss(s,Ay),o=s.filter(a=>i.indexOf(a)===-1);return O.forEach(o,a=>r.delete(a.clientId)).next(()=>o)})}).catch(()=>[]);if(this.Ki)for(const t of e)this.Ki.removeItem(this._s(t.clientId))}}ji(){this.ki=this.Mi.enqueueAfterDelay("client_metadata_refresh",4e3,()=>this.Wi().then(()=>this.ns()).then(()=>this.ji()))}es(e){return!!e&&e.ownerId===this.clientId}Yi(e){return this.Oi?O.resolve(!0):yu(e).get(cl).next(t=>{if(t!==null&&this.rs(t.leaseTimestampMs,Cy)&&!this.us(t.ownerId)){if(this.es(t)&&this.networkEnabled)return!0;if(!this.es(t)){if(!t.allowTabSynchronization)throw new z(U.FAILED_PRECONDITION,Ry);return!1}}return!(!this.networkEnabled||!this.inForeground)||yf(e).J().next(r=>this.ss(r,Cy).find(s=>{if(this.clientId!==s.clientId){const i=!this.networkEnabled&&s.networkEnabled,o=!this.inForeground&&s.inForeground,a=this.networkEnabled===s.networkEnabled;if(i||o&&a)return!0}return!1})===void 0)}).next(t=>(this.isPrimary!==t&&W(Ui,`Client ${t?"is":"is not"} eligible for a primary lease.`),t))}async shutdown(){this.li=!1,this.cs(),this.ki&&(this.ki.cancel(),this.ki=null),this.ls(),this.hs(),await this.Ui.runTransaction("shutdown","readwrite",[mh,pc],e=>{const t=new gv(e,mr.ce);return this.Zi(t).next(()=>this.ts(t))}),this.Ui.close(),this.Ps()}ss(e,t){return e.filter(r=>this.rs(r.updateTimeMs,t)&&!this.us(r.clientId))}Ts(){return this.runTransaction("getActiveClients","readonly",e=>yf(e).J().next(t=>this.ss(t,Ay).map(r=>r.clientId)))}get started(){return this.li}getGlobalsCache(){return this.hi}getMutationQueue(e,t){return um.wt(e,this.serializer,t,this.referenceDelegate)}getTargetCache(){return this.Pi}getRemoteDocumentCache(){return this.remoteDocumentCache}getIndexManager(e){return new y5(e,this.serializer.yt.databaseId)}getDocumentOverlayCache(e){return cm.wt(this.serializer,e)}getBundleCache(){return this.Ii}runTransaction(e,t,r){W(Ui,"Starting transaction:",e);const s=t==="readonly"?"readonly":"readwrite",i=function(l){return l===18?I3:l===17?oN:l===16?x3:l===15?Aw:l===14?iN:l===13?sN:l===12?w3:l===11?rN:void ue(60245)}(this.Ni);let o;return this.Ui.runTransaction(e,s,i,a=>(o=new gv(a,this.ci?this.ci.next():mr.ce),t==="readwrite-primary"?this.Hi(o).next(l=>!!l||this.Yi(o)).next(l=>{if(!l)throw dn(`Failed to obtain primary lease for action '${e}'.`),this.isPrimary=!1,this.Mi.enqueueRetryable(()=>this.Qi(!1)),new z(U.FAILED_PRECONDITION,HR);return r(o)}).next(l=>this.Xi(o).next(()=>l)):this.Is(o).next(()=>r(o)))).then(a=>(o.raiseOnCommittedEvent(),a))}Is(e){return yu(e).get(cl).next(t=>{if(t!==null&&this.rs(t.leaseTimestampMs,Cy)&&!this.us(t.ownerId)&&!this.es(t)&&!(this.Oi||this.allowTabSynchronization&&t.allowTabSynchronization))throw new z(U.FAILED_PRECONDITION,Ry)})}Xi(e){const t={ownerId:this.clientId,allowTabSynchronization:this.allowTabSynchronization,leaseTimestampMs:Date.now()};return yu(e).put(cl,t)}static v(){return Bs.v()}Zi(e){const t=yu(e);return t.get(cl).next(r=>this.es(r)?(W(Ui,"Releasing primary lease."),t.delete(cl)):O.resolve())}rs(e,t){const r=Date.now();return!(e<r-t)&&(!(e>r)||(dn(`Detected an update time that is in the future: ${e} > ${r}`),!1))}Gi(){this.document!==null&&typeof this.document.addEventListener=="function"&&(this.Li=()=>{this.Mi.enqueueAndForget(()=>(this.inForeground=this.document.visibilityState==="visible",this.Wi()))},this.document.addEventListener("visibilitychange",this.Li),this.inForeground=this.document.visibilityState==="visible")}ls(){this.Li&&(this.document.removeEventListener("visibilitychange",this.Li),this.Li=null)}zi(){var e;typeof((e=this.window)==null?void 0:e.addEventListener)=="function"&&(this.Bi=()=>{this.cs();const t=/(?:Version|Mobile)\/1[456]/;rC()&&(navigator.appVersion.match(t)||navigator.userAgent.match(t))&&this.Mi.enterRestrictedMode(!0),this.Mi.enqueueAndForget(()=>this.shutdown())},this.window.addEventListener("pagehide",this.Bi))}hs(){this.Bi&&(this.window.removeEventListener("pagehide",this.Bi),this.Bi=null)}us(e){var t;try{const r=((t=this.Ki)==null?void 0:t.getItem(this._s(e)))!==null;return W(Ui,`Client '${e}' ${r?"is":"is not"} zombied in LocalStorage`),r}catch(r){return dn(Ui,"Failed to get zombied client id.",r),!1}}cs(){if(this.Ki)try{this.Ki.setItem(this._s(this.clientId),String(Date.now()))}catch(e){dn("Failed to set zombie client id.",e)}}Ps(){if(this.Ki)try{this.Ki.removeItem(this._s(this.clientId))}catch{}}_s(e){return`firestore_zombie_${this.persistenceKey}_${e}`}}function yu(n){return En(n,mh)}function yf(n){return En(n,pc)}function Ww(n,e){let t=n.projectId;return n.isDefaultDatabase||(t+="."+n.database),"firestore/"+e+"/"+t+"/"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Gw{constructor(e,t,r,s){this.targetId=e,this.fromCache=t,this.Es=r,this.ds=s}static As(e,t){let r=je(),s=je();for(const i of t.docChanges)switch(i.type){case 0:r=r.add(i.doc.key);break;case 1:s=s.add(i.doc.key)}return new Gw(e,t.fromCache,r,s)}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class M5{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(e){this._documentReadCount+=e}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class wk{constructor(){this.Rs=!1,this.Vs=!1,this.fs=100,this.gs=function(){return rC()?8:QR(In())>0?6:4}()}initialize(e,t){this.ps=e,this.indexManager=t,this.Rs=!0}getDocumentsMatchingQuery(e,t,r,s){const i={result:null};return this.ys(e,t).next(o=>{i.result=o}).next(()=>{if(!i.result)return this.ws(e,t,s,r).next(o=>{i.result=o})}).next(()=>{if(i.result)return;const o=new M5;return this.Ss(e,t,o).next(a=>{if(i.result=a,this.Vs)return this.bs(e,t,o,a.size)})}).next(()=>i.result)}bs(e,t,r,s){return r.documentReadCount<this.fs?(ml()<=Ze.DEBUG&&W("QueryEngine","SDK will not create cache indexes for query:",yl(t),"since it only creates cache indexes for collection contains","more than or equal to",this.fs,"documents"),O.resolve()):(ml()<=Ze.DEBUG&&W("QueryEngine","Query:",yl(t),"scans",r.documentReadCount,"local documents and returns",s,"documents as results."),r.documentReadCount>this.gs*s?(ml()<=Ze.DEBUG&&W("QueryEngine","The SDK decides to create cache indexes for query:",yl(t),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(e,nr(t))):O.resolve())}ys(e,t){if(QS(t))return O.resolve(null);let r=nr(t);return this.indexManager.getIndexType(e,r).next(s=>s===0?null:(t.limit!==null&&s===1&&(t=Qg(t,null,"F"),r=nr(t)),this.indexManager.getDocumentsMatchingTarget(e,r).next(i=>{const o=je(...i);return this.ps.getDocuments(e,o).next(a=>this.indexManager.getMinOffset(e,r).next(l=>{const u=this.Ds(t,a);return this.Cs(t,u,o,l.readTime)?this.ys(e,Qg(t,null,"F")):this.vs(e,u,t,l)}))})))}ws(e,t,r,s){return QS(t)||s.isEqual(Ie.min())?O.resolve(null):this.ps.getDocuments(e,r).next(i=>{const o=this.Ds(t,i);return this.Cs(t,o,r,s)?O.resolve(null):(ml()<=Ze.DEBUG&&W("QueryEngine","Re-using previous result from %s to execute query: %s",s.toString(),yl(t)),this.vs(e,o,t,WR(s,cc)).next(a=>a))})}Ds(e,t){let r=new St(NN(e));return t.forEach((s,i)=>{vh(e,i)&&(r=r.add(i))}),r}Cs(e,t,r,s){if(e.limit===null)return!1;if(r.size!==t.size)return!0;const i=e.limitType==="F"?t.last():t.first();return!!i&&(i.hasPendingWrites||i.version.compareTo(s)>0)}Ss(e,t,r){return ml()<=Ze.DEBUG&&W("QueryEngine","Using full collection scan to execute query:",yl(t)),this.ps.getDocumentsMatchingQuery(e,t,Br.min(),r)}vs(e,t,r,s){return this.ps.getDocumentsMatchingQuery(e,r,s).next(i=>(t.forEach(o=>{i=i.insert(o.key,o)}),i))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Hw="LocalStore",L5=3e8;class O5{constructor(e,t,r,s){this.persistence=e,this.Fs=t,this.serializer=s,this.Ms=new Ot(Pe),this.xs=new Ci(i=>Pa(i),yh),this.Os=new Map,this.Ns=e.getRemoteDocumentCache(),this.Pi=e.getTargetCache(),this.Ii=e.getBundleCache(),this.Bs(r)}Bs(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new _k(this.Ns,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.Ns.setIndexManager(this.indexManager),this.Fs.initialize(this.localDocuments,this.indexManager)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",t=>e.collect(t,this.Ms))}}function xk(n,e,t,r){return new O5(n,e,t,r)}async function Ik(n,e){const t=re(n);return await t.persistence.runTransaction("Handle user change","readonly",r=>{let s;return t.mutationQueue.getAllMutationBatches(r).next(i=>(s=i,t.Bs(e),t.mutationQueue.getAllMutationBatches(r))).next(i=>{const o=[],a=[];let l=je();for(const u of s){o.push(u.batchId);for(const h of u.mutations)l=l.add(h.key)}for(const u of i){a.push(u.batchId);for(const h of u.mutations)l=l.add(h.key)}return t.localDocuments.getDocuments(r,l).next(u=>({Ls:u,removedBatchIds:o,addedBatchIds:a}))})})}function V5(n,e){const t=re(n);return t.persistence.runTransaction("Acknowledge batch","readwrite-primary",r=>{const s=e.batch.keys(),i=t.Ns.newChangeBuffer({trackRemovals:!0});return function(a,l,u,h){const f=u.batch,g=f.keys();let y=O.resolve();return g.forEach(w=>{y=y.next(()=>h.getEntry(l,w)).next(C=>{const M=u.docVersions.get(w);ye(M!==null,48541),C.version.compareTo(M)<0&&(f.applyToRemoteDocument(C,u),C.isValidDocument()&&(C.setReadTime(u.commitVersion),h.addEntry(C)))})}),y.next(()=>a.mutationQueue.removeMutationBatch(l,f))}(t,r,e,i).next(()=>i.apply(r)).next(()=>t.mutationQueue.performConsistencyCheck(r)).next(()=>t.documentOverlayCache.removeOverlaysForBatchId(r,s,e.batch.batchId)).next(()=>t.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(r,function(a){let l=je();for(let u=0;u<a.mutationResults.length;++u)a.mutationResults[u].transformResults.length>0&&(l=l.add(a.batch.mutations[u].key));return l}(e))).next(()=>t.localDocuments.getDocuments(r,s))})}function Ek(n){const e=re(n);return e.persistence.runTransaction("Get last remote snapshot version","readonly",t=>e.Pi.getLastRemoteSnapshotVersion(t))}function F5(n,e){const t=re(n),r=e.snapshotVersion;let s=t.Ms;return t.persistence.runTransaction("Apply remote event","readwrite-primary",i=>{const o=t.Ns.newChangeBuffer({trackRemovals:!0});s=t.Ms;const a=[];e.targetChanges.forEach((h,f)=>{const g=s.get(f);if(!g)return;a.push(t.Pi.removeMatchingKeys(i,h.removedDocuments,f).next(()=>t.Pi.addMatchingKeys(i,h.addedDocuments,f)));let y=g.withSequenceNumber(i.currentSequenceNumber);e.targetMismatches.get(f)!==null?y=y.withResumeToken(an.EMPTY_BYTE_STRING,Ie.min()).withLastLimboFreeSnapshotVersion(Ie.min()):h.resumeToken.approximateByteSize()>0&&(y=y.withResumeToken(h.resumeToken,r)),s=s.insert(f,y),function(C,M,A){return C.resumeToken.approximateByteSize()===0||M.snapshotVersion.toMicroseconds()-C.snapshotVersion.toMicroseconds()>=L5?!0:A.addedDocuments.size+A.modifiedDocuments.size+A.removedDocuments.size>0}(g,y,h)&&a.push(t.Pi.updateTargetData(i,y))});let l=_r(),u=je();if(e.documentUpdates.forEach(h=>{e.resolvedLimboDocuments.has(h)&&a.push(t.persistence.referenceDelegate.updateLimboDocument(i,h))}),a.push(Sk(i,o,e.documentUpdates).next(h=>{l=h.ks,u=h.qs})),!r.isEqual(Ie.min())){const h=t.Pi.getLastRemoteSnapshotVersion(i).next(f=>t.Pi.setTargetsMetadata(i,i.currentSequenceNumber,r));a.push(h)}return O.waitFor(a).next(()=>o.apply(i)).next(()=>t.localDocuments.getLocalViewOfDocuments(i,l,u)).next(()=>l)}).then(i=>(t.Ms=s,i))}function Sk(n,e,t){let r=je(),s=je();return t.forEach(i=>r=r.add(i)),e.getEntries(n,r).next(i=>{let o=_r();return t.forEach((a,l)=>{const u=i.get(a);l.isFoundDocument()!==u.isFoundDocument()&&(s=s.add(a)),l.isNoDocument()&&l.version.isEqual(Ie.min())?(e.removeEntry(a,l.readTime),o=o.insert(a,l)):!u.isValidDocument()||l.version.compareTo(u.version)>0||l.version.compareTo(u.version)===0&&u.hasPendingWrites?(e.addEntry(l),o=o.insert(a,l)):W(Hw,"Ignoring outdated watch update for ",a,". Current version:",u.version," Watch version:",l.version)}),{ks:o,qs:s}})}function j5(n,e){const t=re(n);return t.persistence.runTransaction("Get next mutation batch","readonly",r=>(e===void 0&&(e=vo),t.mutationQueue.getNextMutationBatchAfterBatchId(r,e)))}function Ic(n,e){const t=re(n);return t.persistence.runTransaction("Allocate target","readwrite",r=>{let s;return t.Pi.getTargetData(r,e).next(i=>i?(s=i,O.resolve(s)):t.Pi.allocateTargetId(r).next(o=>(s=new ci(e,o,"TargetPurposeListen",r.currentSequenceNumber),t.Pi.addTargetData(r,s).next(()=>s))))}).then(r=>{const s=t.Ms.get(r.targetId);return(s===null||r.snapshotVersion.compareTo(s.snapshotVersion)>0)&&(t.Ms=t.Ms.insert(r.targetId,r),t.xs.set(e,r.targetId)),r})}async function Ec(n,e,t){const r=re(n),s=r.Ms.get(e),i=t?"readwrite":"readwrite-primary";try{t||await r.persistence.runTransaction("Release target",i,o=>r.persistence.referenceDelegate.removeTarget(o,s))}catch(o){if(!Uo(o))throw o;W(Hw,`Failed to update sequence numbers for target ${e}: ${o}`)}r.Ms=r.Ms.remove(e),r.xs.delete(s.target)}function ep(n,e,t){const r=re(n);let s=Ie.min(),i=je();return r.persistence.runTransaction("Execute query","readwrite",o=>function(l,u,h){const f=re(l),g=f.xs.get(h);return g!==void 0?O.resolve(f.Ms.get(g)):f.Pi.getTargetData(u,h)}(r,o,nr(e)).next(a=>{if(a)return s=a.lastLimboFreeSnapshotVersion,r.Pi.getMatchingKeysForTargetId(o,a.targetId).next(l=>{i=l})}).next(()=>r.Fs.getDocumentsMatchingQuery(o,e,t?s:Ie.min(),t?i:je())).next(a=>(Ak(r,RN(e),a),{documents:a,Qs:i})))}function Tk(n,e){const t=re(n),r=re(t.Pi),s=t.Ms.get(e);return s?Promise.resolve(s.target):t.persistence.runTransaction("Get target data","readonly",i=>r.At(i,e).next(o=>o?o.target:null))}function bk(n,e){const t=re(n),r=t.Os.get(e)||Ie.min();return t.persistence.runTransaction("Get new document changes","readonly",s=>t.Ns.getAllFromCollectionGroup(s,e,WR(r,cc),Number.MAX_SAFE_INTEGER)).then(s=>(Ak(t,e,s),s))}function Ak(n,e,t){let r=n.Os.get(e)||Ie.min();t.forEach((s,i)=>{i.readTime.compareTo(r)>0&&(r=i.readTime)}),n.Os.set(e,r)}async function U5(n,e,t,r){const s=re(n);let i=je(),o=_r();for(const u of t){const h=e.$s(u.metadata.name);u.document&&(i=i.add(h));const f=e.Us(u);f.setReadTime(e.Ks(u.metadata.readTime)),o=o.insert(h,f)}const a=s.Ns.newChangeBuffer({trackRemovals:!0}),l=await Ic(s,function(h){return nr(Vc(Je.fromString(`__bundle__/docs/${h}`)))}(r));return s.persistence.runTransaction("Apply bundle documents","readwrite",u=>Sk(u,a,o).next(h=>(a.apply(u),h)).next(h=>s.Pi.removeMatchingKeysForTargetId(u,l.targetId).next(()=>s.Pi.addMatchingKeys(u,i,l.targetId)).next(()=>s.localDocuments.getLocalViewOfDocuments(u,h.ks,h.qs)).next(()=>h.ks)))}async function $5(n,e,t=je()){const r=await Ic(n,nr(lm(e.bundledQuery))),s=re(n);return s.persistence.runTransaction("Save named query","readwrite",i=>{const o=hn(e.readTime);if(r.snapshotVersion.compareTo(o)>=0)return s.Ii.saveNamedQuery(i,e);const a=r.withResumeToken(an.EMPTY_BYTE_STRING,o);return s.Ms=s.Ms.insert(a.targetId,a),s.Pi.updateTargetData(i,a).next(()=>s.Pi.removeMatchingKeysForTargetId(i,r.targetId)).next(()=>s.Pi.addMatchingKeys(i,t,r.targetId)).next(()=>s.Ii.saveNamedQuery(i,e))})}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ck="firestore_clients";function bT(n,e){return`${Ck}_${n}_${e}`}const Rk="firestore_mutations";function AT(n,e,t){let r=`${Rk}_${n}_${t}`;return e.isAuthenticated()&&(r+=`_${e.uid}`),r}const Nk="firestore_targets";function Ny(n,e){return`${Nk}_${n}_${e}`}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ps="SharedClientState";class tp{constructor(e,t,r,s){this.user=e,this.batchId=t,this.state=r,this.error=s}static Ws(e,t,r){const s=JSON.parse(r);let i,o=typeof s=="object"&&["pending","acknowledged","rejected"].indexOf(s.state)!==-1&&(s.error===void 0||typeof s.error=="object");return o&&s.error&&(o=typeof s.error.message=="string"&&typeof s.error.code=="string",o&&(i=new z(s.error.code,s.error.message))),o?new tp(e,t,s.state,i):(dn(Ps,`Failed to parse mutation state for ID '${t}': ${r}`),null)}Gs(){const e={state:this.state,updateTimeMs:Date.now()};return this.error&&(e.error={code:this.error.code,message:this.error.message}),JSON.stringify(e)}}class Zu{constructor(e,t,r){this.targetId=e,this.state=t,this.error=r}static Ws(e,t){const r=JSON.parse(t);let s,i=typeof r=="object"&&["not-current","current","rejected"].indexOf(r.state)!==-1&&(r.error===void 0||typeof r.error=="object");return i&&r.error&&(i=typeof r.error.message=="string"&&typeof r.error.code=="string",i&&(s=new z(r.error.code,r.error.message))),i?new Zu(e,r.state,s):(dn(Ps,`Failed to parse target state for ID '${e}': ${t}`),null)}Gs(){const e={state:this.state,updateTimeMs:Date.now()};return this.error&&(e.error={code:this.error.code,message:this.error.message}),JSON.stringify(e)}}class np{constructor(e,t){this.clientId=e,this.activeTargetIds=t}static Ws(e,t){const r=JSON.parse(t);let s=typeof r=="object"&&r.activeTargetIds instanceof Array,i=Pw();for(let o=0;s&&o<r.activeTargetIds.length;++o)s=YR(r.activeTargetIds[o]),i=i.add(r.activeTargetIds[o]);return s?new np(e,i):(dn(Ps,`Failed to parse client data for instance '${e}': ${t}`),null)}}class Kw{constructor(e,t){this.clientId=e,this.onlineState=t}static Ws(e){const t=JSON.parse(e);return typeof t=="object"&&["Unknown","Online","Offline"].indexOf(t.onlineState)!==-1&&typeof t.clientId=="string"?new Kw(t.clientId,t.onlineState):(dn(Ps,`Failed to parse online state: ${e}`),null)}}class Cv{constructor(){this.activeTargetIds=Pw()}zs(e){this.activeTargetIds=this.activeTargetIds.add(e)}js(e){this.activeTargetIds=this.activeTargetIds.delete(e)}Gs(){const e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}}class ky{constructor(e,t,r,s,i){this.window=e,this.Mi=t,this.persistenceKey=r,this.Js=s,this.syncEngine=null,this.onlineStateHandler=null,this.sequenceNumberHandler=null,this.Hs=this.Ys.bind(this),this.Zs=new Ot(Pe),this.started=!1,this.Xs=[];const o=r.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");this.storage=this.window.localStorage,this.currentUser=i,this.eo=bT(this.persistenceKey,this.Js),this.no=function(l){return`firestore_sequence_number_${l}`}(this.persistenceKey),this.Zs=this.Zs.insert(this.Js,new Cv),this.ro=new RegExp(`^${Ck}_${o}_([^_]*)$`),this.io=new RegExp(`^${Rk}_${o}_(\\d+)(?:_(.*))?$`),this.so=new RegExp(`^${Nk}_${o}_(\\d+)$`),this.oo=function(l){return`firestore_online_state_${l}`}(this.persistenceKey),this._o=function(l){return`firestore_bundle_loaded_v2_${l}`}(this.persistenceKey),this.window.addEventListener("storage",this.Hs)}static v(e){return!(!e||!e.localStorage)}async start(){const e=await this.syncEngine.Ts();for(const r of e){if(r===this.Js)continue;const s=this.getItem(bT(this.persistenceKey,r));if(s){const i=np.Ws(r,s);i&&(this.Zs=this.Zs.insert(i.clientId,i))}}this.ao();const t=this.storage.getItem(this.oo);if(t){const r=this.uo(t);r&&this.co(r)}for(const r of this.Xs)this.Ys(r);this.Xs=[],this.window.addEventListener("pagehide",()=>this.shutdown()),this.started=!0}writeSequenceNumber(e){this.setItem(this.no,JSON.stringify(e))}getAllActiveQueryTargets(){return this.lo(this.Zs)}isActiveQueryTarget(e){let t=!1;return this.Zs.forEach((r,s)=>{s.activeTargetIds.has(e)&&(t=!0)}),t}addPendingMutation(e){this.ho(e,"pending")}updateMutationState(e,t,r){this.ho(e,t,r),this.Po(e)}addLocalQueryTarget(e,t=!0){let r="not-current";if(this.isActiveQueryTarget(e)){const s=this.storage.getItem(Ny(this.persistenceKey,e));if(s){const i=Zu.Ws(e,s);i&&(r=i.state)}}return t&&this.To.zs(e),this.ao(),r}removeLocalQueryTarget(e){this.To.js(e),this.ao()}isLocalQueryTarget(e){return this.To.activeTargetIds.has(e)}clearQueryState(e){this.removeItem(Ny(this.persistenceKey,e))}updateQueryState(e,t,r){this.Io(e,t,r)}handleUserChange(e,t,r){t.forEach(s=>{this.Po(s)}),this.currentUser=e,r.forEach(s=>{this.addPendingMutation(s)})}setOnlineState(e){this.Eo(e)}notifyBundleLoaded(e){this.Ao(e)}shutdown(){this.started&&(this.window.removeEventListener("storage",this.Hs),this.removeItem(this.eo),this.started=!1)}getItem(e){const t=this.storage.getItem(e);return W(Ps,"READ",e,t),t}setItem(e,t){W(Ps,"SET",e,t),this.storage.setItem(e,t)}removeItem(e){W(Ps,"REMOVE",e),this.storage.removeItem(e)}Ys(e){const t=e;if(t.storageArea===this.storage){if(W(Ps,"EVENT",t.key,t.newValue),t.key===this.eo)return void dn("Received WebStorage notification for local change. Another client might have garbage-collected our state");this.Mi.enqueueRetryable(async()=>{if(this.started){if(t.key!==null){if(this.ro.test(t.key)){if(t.newValue==null){const r=this.Ro(t.key);return this.Vo(r,null)}{const r=this.mo(t.key,t.newValue);if(r)return this.Vo(r.clientId,r)}}else if(this.io.test(t.key)){if(t.newValue!==null){const r=this.fo(t.key,t.newValue);if(r)return this.po(r)}}else if(this.so.test(t.key)){if(t.newValue!==null){const r=this.yo(t.key,t.newValue);if(r)return this.wo(r)}}else if(t.key===this.oo){if(t.newValue!==null){const r=this.uo(t.newValue);if(r)return this.co(r)}}else if(t.key===this.no){const r=function(i){let o=mr.ce;if(i!=null)try{const a=JSON.parse(i);ye(typeof a=="number",30636,{So:i}),o=a}catch(a){dn(Ps,"Failed to read sequence number from WebStorage",a)}return o}(t.newValue);r!==mr.ce&&this.sequenceNumberHandler(r)}else if(t.key===this._o){const r=this.bo(t.newValue);await Promise.all(r.map(s=>this.syncEngine.Do(s)))}}}else this.Xs.push(t)})}}get To(){return this.Zs.get(this.Js)}ao(){this.setItem(this.eo,this.To.Gs())}ho(e,t,r){const s=new tp(this.currentUser,e,t,r),i=AT(this.persistenceKey,this.currentUser,e);this.setItem(i,s.Gs())}Po(e){const t=AT(this.persistenceKey,this.currentUser,e);this.removeItem(t)}Eo(e){const t={clientId:this.Js,onlineState:e};this.storage.setItem(this.oo,JSON.stringify(t))}Io(e,t,r){const s=Ny(this.persistenceKey,e),i=new Zu(e,t,r);this.setItem(s,i.Gs())}Ao(e){const t=JSON.stringify(Array.from(e));this.setItem(this._o,t)}Ro(e){const t=this.ro.exec(e);return t?t[1]:null}mo(e,t){const r=this.Ro(e);return np.Ws(r,t)}fo(e,t){const r=this.io.exec(e),s=Number(r[1]),i=r[2]!==void 0?r[2]:null;return tp.Ws(new Rn(i),s,t)}yo(e,t){const r=this.so.exec(e),s=Number(r[1]);return Zu.Ws(s,t)}uo(e){return Kw.Ws(e)}bo(e){return JSON.parse(e)}async po(e){if(e.user.uid===this.currentUser.uid)return this.syncEngine.Co(e.batchId,e.state,e.error);W(Ps,`Ignoring mutation for non-active user ${e.user.uid}`)}wo(e){return this.syncEngine.vo(e.targetId,e.state,e.error)}Vo(e,t){const r=t?this.Zs.insert(e,t):this.Zs.remove(e),s=this.lo(this.Zs),i=this.lo(r),o=[],a=[];return i.forEach(l=>{s.has(l)||o.push(l)}),s.forEach(l=>{i.has(l)||a.push(l)}),this.syncEngine.Fo(o,a).then(()=>{this.Zs=r})}co(e){this.Zs.get(e.clientId)&&this.onlineStateHandler(e.onlineState)}lo(e){let t=Pw();return e.forEach((r,s)=>{t=t.unionWith(s.activeTargetIds)}),t}}class kk{constructor(){this.Mo=new Cv,this.xo={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,t,r){}addLocalQueryTarget(e,t=!0){return t&&this.Mo.zs(e),this.xo[e]||"not-current"}updateQueryState(e,t,r){this.xo[e]=t}removeLocalQueryTarget(e){this.Mo.js(e)}isLocalQueryTarget(e){return this.Mo.activeTargetIds.has(e)}clearQueryState(e){delete this.xo[e]}getAllActiveQueryTargets(){return this.Mo.activeTargetIds}isActiveQueryTarget(e){return this.Mo.activeTargetIds.has(e)}start(){return this.Mo=new Cv,Promise.resolve()}handleUserChange(e,t,r){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class B5{Oo(e){}shutdown(){}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const CT="ConnectivityMonitor";class RT{constructor(){this.No=()=>this.Bo(),this.Lo=()=>this.ko(),this.qo=[],this.Qo()}Oo(e){this.qo.push(e)}shutdown(){window.removeEventListener("online",this.No),window.removeEventListener("offline",this.Lo)}Qo(){window.addEventListener("online",this.No),window.addEventListener("offline",this.Lo)}Bo(){W(CT,"Network connectivity changed: AVAILABLE");for(const e of this.qo)e(0)}ko(){W(CT,"Network connectivity changed: UNAVAILABLE");for(const e of this.qo)e(1)}static v(){return typeof window<"u"&&window.addEventListener!==void 0&&window.removeEventListener!==void 0}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let _f=null;function Rv(){return _f===null?_f=function(){return 268435456+Math.round(2147483648*Math.random())}():_f++,"0x"+_f.toString(16)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Py="RestConnection",z5={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};class q5{get $o(){return!1}constructor(e){this.databaseInfo=e,this.databaseId=e.databaseId;const t=e.ssl?"https":"http",r=encodeURIComponent(this.databaseId.projectId),s=encodeURIComponent(this.databaseId.database);this.Uo=t+"://"+e.host,this.Ko=`projects/${r}/databases/${s}`,this.Wo=this.databaseId.database===Vd?`project_id=${r}`:`project_id=${r}&database_id=${s}`}Go(e,t,r,s,i){const o=Rv(),a=this.zo(e,t.toUriEncodedString());W(Py,`Sending RPC '${e}' ${o}:`,a,r);const l={"google-cloud-resource-prefix":this.Ko,"x-goog-request-params":this.Wo};this.jo(l,s,i);const{host:u}=new URL(a),h=bi(u);return this.Jo(e,a,l,r,h).then(f=>(W(Py,`Received RPC '${e}' ${o}: `,f),f),f=>{throw rs(Py,`RPC '${e}' ${o} failed with error: `,f,"url: ",a,"request:",r),f})}Ho(e,t,r,s,i,o){return this.Go(e,t,r,s,i)}jo(e,t,r){e["X-Goog-Api-Client"]=function(){return"gl-js/ fire/"+Oc}(),e["Content-Type"]="text/plain",this.databaseInfo.appId&&(e["X-Firebase-GMPID"]=this.databaseInfo.appId),t&&t.headers.forEach((s,i)=>e[i]=s),r&&r.headers.forEach((s,i)=>e[i]=s)}zo(e,t){const r=z5[e];return`${this.Uo}/v1/${t}:${r}`}terminate(){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class W5{constructor(e){this.Yo=e.Yo,this.Zo=e.Zo}Xo(e){this.e_=e}t_(e){this.n_=e}r_(e){this.i_=e}onMessage(e){this.s_=e}close(){this.Zo()}send(e){this.Yo(e)}o_(){this.e_()}__(){this.n_()}a_(e){this.i_(e)}u_(e){this.s_(e)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Jn="WebChannelConnection";class G5 extends q5{constructor(e){super(e),this.c_=[],this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams,this.longPollingOptions=e.longPollingOptions}Jo(e,t,r,s,i){const o=Rv();return new Promise((a,l)=>{const u=new LR;u.setWithCredentials(!0),u.listenOnce(OR.COMPLETE,()=>{try{switch(u.getLastErrorCode()){case jf.NO_ERROR:const f=u.getResponseJson();W(Jn,`XHR for RPC '${e}' ${o} received:`,JSON.stringify(f)),a(f);break;case jf.TIMEOUT:W(Jn,`RPC '${e}' ${o} timed out`),l(new z(U.DEADLINE_EXCEEDED,"Request time out"));break;case jf.HTTP_ERROR:const g=u.getStatus();if(W(Jn,`RPC '${e}' ${o} failed with status:`,g,"response text:",u.getResponseText()),g>0){let y=u.getResponseJson();Array.isArray(y)&&(y=y[0]);const w=y==null?void 0:y.error;if(w&&w.status&&w.message){const C=function(A){const I=A.toLowerCase().replace(/_/g,"-");return Object.values(U).indexOf(I)>=0?I:U.UNKNOWN}(w.status);l(new z(C,w.message))}else l(new z(U.UNKNOWN,"Server responded with status "+u.getStatus()))}else l(new z(U.UNAVAILABLE,"Connection failed."));break;default:ue(9055,{l_:e,streamId:o,h_:u.getLastErrorCode(),P_:u.getLastError()})}}finally{W(Jn,`RPC '${e}' ${o} completed.`)}});const h=JSON.stringify(s);W(Jn,`RPC '${e}' ${o} sending request:`,s),u.send(t,"POST",h,r,15)})}T_(e,t,r){const s=Rv(),i=[this.Uo,"/","google.firestore.v1.Firestore","/",e,"/channel"],o=jR(),a=FR(),l={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},u=this.longPollingOptions.timeoutSeconds;u!==void 0&&(l.longPollingTimeout=Math.round(1e3*u)),this.useFetchStreams&&(l.useFetchStreams=!0),this.jo(l.initMessageHeaders,t,r),l.encodeInitMessageHeaders=!0;const h=i.join("");W(Jn,`Creating RPC '${e}' stream ${s}: ${h}`,l);const f=o.createWebChannel(h,l);this.I_(f);let g=!1,y=!1;const w=new W5({Yo:M=>{y?W(Jn,`Not sending because RPC '${e}' stream ${s} is closed:`,M):(g||(W(Jn,`Opening RPC '${e}' stream ${s} transport.`),f.open(),g=!0),W(Jn,`RPC '${e}' stream ${s} sending:`,M),f.send(M))},Zo:()=>f.close()}),C=(M,A,I)=>{M.listen(A,R=>{try{I(R)}catch(D){setTimeout(()=>{throw D},0)}})};return C(f,bu.EventType.OPEN,()=>{y||(W(Jn,`RPC '${e}' stream ${s} transport opened.`),w.o_())}),C(f,bu.EventType.CLOSE,()=>{y||(y=!0,W(Jn,`RPC '${e}' stream ${s} transport closed`),w.a_(),this.E_(f))}),C(f,bu.EventType.ERROR,M=>{y||(y=!0,rs(Jn,`RPC '${e}' stream ${s} transport errored. Name:`,M.name,"Message:",M.message),w.a_(new z(U.UNAVAILABLE,"The operation could not be completed")))}),C(f,bu.EventType.MESSAGE,M=>{var A;if(!y){const I=M.data[0];ye(!!I,16349);const R=I,D=(R==null?void 0:R.error)||((A=R[0])==null?void 0:A.error);if(D){W(Jn,`RPC '${e}' stream ${s} received error:`,D);const V=D.status;let P=function(b){const _=gn[b];if(_!==void 0)return qN(_)}(V),S=D.message;P===void 0&&(P=U.INTERNAL,S="Unknown error status: "+V+" with message "+D.message),y=!0,w.a_(new z(P,S)),f.close()}else W(Jn,`RPC '${e}' stream ${s} received:`,I),w.u_(I)}}),C(a,VR.STAT_EVENT,M=>{M.stat===ov.PROXY?W(Jn,`RPC '${e}' stream ${s} detected buffering proxy`):M.stat===ov.NOPROXY&&W(Jn,`RPC '${e}' stream ${s} detected no buffering proxy`)}),setTimeout(()=>{w.__()},0),w}terminate(){this.c_.forEach(e=>e.close()),this.c_=[]}I_(e){this.c_.push(e)}E_(e){this.c_=this.c_.filter(t=>t===e)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Pk(){return typeof window<"u"?window:null}function Kf(){return typeof document<"u"?document:null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ja(n){return new X3(n,!0)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Qw{constructor(e,t,r=1e3,s=1.5,i=6e4){this.Mi=e,this.timerId=t,this.d_=r,this.A_=s,this.R_=i,this.V_=0,this.m_=null,this.f_=Date.now(),this.reset()}reset(){this.V_=0}g_(){this.V_=this.R_}p_(e){this.cancel();const t=Math.floor(this.V_+this.y_()),r=Math.max(0,Date.now()-this.f_),s=Math.max(0,t-r);s>0&&W("ExponentialBackoff",`Backing off for ${s} ms (base delay: ${this.V_} ms, delay with jitter: ${t} ms, last attempt: ${r} ms ago)`),this.m_=this.Mi.enqueueAfterDelay(this.timerId,s,()=>(this.f_=Date.now(),e())),this.V_*=this.A_,this.V_<this.d_&&(this.V_=this.d_),this.V_>this.R_&&(this.V_=this.R_)}w_(){this.m_!==null&&(this.m_.skipDelay(),this.m_=null)}cancel(){this.m_!==null&&(this.m_.cancel(),this.m_=null)}y_(){return(Math.random()-.5)*this.V_}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const NT="PersistentStream";class Dk{constructor(e,t,r,s,i,o,a,l){this.Mi=e,this.S_=r,this.b_=s,this.connection=i,this.authCredentialsProvider=o,this.appCheckCredentialsProvider=a,this.listener=l,this.state=0,this.D_=0,this.C_=null,this.v_=null,this.stream=null,this.F_=0,this.M_=new Qw(e,t)}x_(){return this.state===1||this.state===5||this.O_()}O_(){return this.state===2||this.state===3}start(){this.F_=0,this.state!==4?this.auth():this.N_()}async stop(){this.x_()&&await this.close(0)}B_(){this.state=0,this.M_.reset()}L_(){this.O_()&&this.C_===null&&(this.C_=this.Mi.enqueueAfterDelay(this.S_,6e4,()=>this.k_()))}q_(e){this.Q_(),this.stream.send(e)}async k_(){if(this.O_())return this.close(0)}Q_(){this.C_&&(this.C_.cancel(),this.C_=null)}U_(){this.v_&&(this.v_.cancel(),this.v_=null)}async close(e,t){this.Q_(),this.U_(),this.M_.cancel(),this.D_++,e!==4?this.M_.reset():t&&t.code===U.RESOURCE_EXHAUSTED?(dn(t.toString()),dn("Using maximum backoff delay to prevent overloading the backend."),this.M_.g_()):t&&t.code===U.UNAUTHENTICATED&&this.state!==3&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),this.stream!==null&&(this.K_(),this.stream.close(),this.stream=null),this.state=e,await this.listener.r_(t)}K_(){}auth(){this.state=1;const e=this.W_(this.D_),t=this.D_;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then(([r,s])=>{this.D_===t&&this.G_(r,s)},r=>{e(()=>{const s=new z(U.UNKNOWN,"Fetching auth token failed: "+r.message);return this.z_(s)})})}G_(e,t){const r=this.W_(this.D_);this.stream=this.j_(e,t),this.stream.Xo(()=>{r(()=>this.listener.Xo())}),this.stream.t_(()=>{r(()=>(this.state=2,this.v_=this.Mi.enqueueAfterDelay(this.b_,1e4,()=>(this.O_()&&(this.state=3),Promise.resolve())),this.listener.t_()))}),this.stream.r_(s=>{r(()=>this.z_(s))}),this.stream.onMessage(s=>{r(()=>++this.F_==1?this.J_(s):this.onNext(s))})}N_(){this.state=5,this.M_.p_(async()=>{this.state=0,this.start()})}z_(e){return W(NT,`close with error: ${e}`),this.stream=null,this.close(4,e)}W_(e){return t=>{this.Mi.enqueueAndForget(()=>this.D_===e?t():(W(NT,"stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve()))}}}class H5 extends Dk{constructor(e,t,r,s,i,o){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",t,r,s,o),this.serializer=i}j_(e,t){return this.connection.T_("Listen",e,t)}J_(e){return this.onNext(e)}onNext(e){this.M_.reset();const t=t5(this.serializer,e),r=function(i){if(!("targetChange"in i))return Ie.min();const o=i.targetChange;return o.targetIds&&o.targetIds.length?Ie.min():o.readTime?hn(o.readTime):Ie.min()}(e);return this.listener.H_(t,r)}Y_(e){const t={};t.database=Ev(this.serializer),t.addTarget=function(i,o){let a;const l=o.target;if(a=Hg(l)?{documents:ZN(i,l)}:{query:am(i,l).ft},a.targetId=o.targetId,o.resumeToken.approximateByteSize()>0){a.resumeToken=KN(i,o.resumeToken);const u=xv(i,o.expectedCount);u!==null&&(a.expectedCount=u)}else if(o.snapshotVersion.compareTo(Ie.min())>0){a.readTime=xc(i,o.snapshotVersion.toTimestamp());const u=xv(i,o.expectedCount);u!==null&&(a.expectedCount=u)}return a}(this.serializer,e);const r=r5(this.serializer,e);r&&(t.labels=r),this.q_(t)}Z_(e){const t={};t.database=Ev(this.serializer),t.removeTarget=e,this.q_(t)}}class K5 extends Dk{constructor(e,t,r,s,i,o){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",t,r,s,o),this.serializer=i}get X_(){return this.F_>0}start(){this.lastStreamToken=void 0,super.start()}K_(){this.X_&&this.ea([])}j_(e,t){return this.connection.T_("Write",e,t)}J_(e){return ye(!!e.streamToken,31322),this.lastStreamToken=e.streamToken,ye(!e.writeResults||e.writeResults.length===0,55816),this.listener.ta()}onNext(e){ye(!!e.streamToken,12678),this.lastStreamToken=e.streamToken,this.M_.reset();const t=n5(e.writeResults,e.commitTime),r=hn(e.commitTime);return this.listener.na(r,t)}ra(){const e={};e.database=Ev(this.serializer),this.q_(e)}ea(e){const t={streamToken:this.lastStreamToken,writes:e.map(r=>Bd(this.serializer,r))};this.q_(t)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Q5{}class Y5 extends Q5{constructor(e,t,r,s){super(),this.authCredentials=e,this.appCheckCredentials=t,this.connection=r,this.serializer=s,this.ia=!1}sa(){if(this.ia)throw new z(U.FAILED_PRECONDITION,"The client has already been terminated.")}Go(e,t,r,s){return this.sa(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([i,o])=>this.connection.Go(e,Iv(t,r),s,i,o)).catch(i=>{throw i.name==="FirebaseError"?(i.code===U.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),i):new z(U.UNKNOWN,i.toString())})}Ho(e,t,r,s,i){return this.sa(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([o,a])=>this.connection.Ho(e,Iv(t,r),s,o,a,i)).catch(o=>{throw o.name==="FirebaseError"?(o.code===U.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),o):new z(U.UNKNOWN,o.toString())})}terminate(){this.ia=!0,this.connection.terminate()}}class J5{constructor(e,t){this.asyncQueue=e,this.onlineStateHandler=t,this.state="Unknown",this.oa=0,this._a=null,this.aa=!0}ua(){this.oa===0&&(this.ca("Unknown"),this._a=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,()=>(this._a=null,this.la("Backend didn't respond within 10 seconds."),this.ca("Offline"),Promise.resolve())))}ha(e){this.state==="Online"?this.ca("Unknown"):(this.oa++,this.oa>=1&&(this.Pa(),this.la(`Connection failed 1 times. Most recent error: ${e.toString()}`),this.ca("Offline")))}set(e){this.Pa(),this.oa=0,e==="Online"&&(this.aa=!1),this.ca(e)}ca(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}la(e){const t=`Could not reach Cloud Firestore backend. ${e}
This typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.aa?(dn(t),this.aa=!1):W("OnlineStateTracker",t)}Pa(){this._a!==null&&(this._a.cancel(),this._a=null)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Fa="RemoteStore";class X5{constructor(e,t,r,s,i){this.localStore=e,this.datastore=t,this.asyncQueue=r,this.remoteSyncer={},this.Ta=[],this.Ia=new Map,this.Ea=new Set,this.da=[],this.Aa=i,this.Aa.Oo(o=>{r.enqueueAndForget(async()=>{Bo(this)&&(W(Fa,"Restarting streams for network reachability change."),await async function(l){const u=re(l);u.Ea.add(4),await Uc(u),u.Ra.set("Unknown"),u.Ea.delete(4),await Eh(u)}(this))})}),this.Ra=new J5(r,s)}}async function Eh(n){if(Bo(n))for(const e of n.da)await e(!0)}async function Uc(n){for(const e of n.da)await e(!1)}function hm(n,e){const t=re(n);t.Ia.has(e.targetId)||(t.Ia.set(e.targetId,e),Xw(t)?Jw(t):Bc(t).O_()&&Yw(t,e))}function Sc(n,e){const t=re(n),r=Bc(t);t.Ia.delete(e),r.O_()&&Mk(t,e),t.Ia.size===0&&(r.O_()?r.L_():Bo(t)&&t.Ra.set("Unknown"))}function Yw(n,e){if(n.Va.Ue(e.targetId),e.resumeToken.approximateByteSize()>0||e.snapshotVersion.compareTo(Ie.min())>0){const t=n.remoteSyncer.getRemoteKeysForTarget(e.targetId).size;e=e.withExpectedCount(t)}Bc(n).Y_(e)}function Mk(n,e){n.Va.Ue(e),Bc(n).Z_(e)}function Jw(n){n.Va=new K3({getRemoteKeysForTarget:e=>n.remoteSyncer.getRemoteKeysForTarget(e),At:e=>n.Ia.get(e)||null,ht:()=>n.datastore.serializer.databaseId}),Bc(n).start(),n.Ra.ua()}function Xw(n){return Bo(n)&&!Bc(n).x_()&&n.Ia.size>0}function Bo(n){return re(n).Ea.size===0}function Lk(n){n.Va=void 0}async function Z5(n){n.Ra.set("Online")}async function e6(n){n.Ia.forEach((e,t)=>{Yw(n,e)})}async function t6(n,e){Lk(n),Xw(n)?(n.Ra.ha(e),Jw(n)):n.Ra.set("Unknown")}async function n6(n,e,t){if(n.Ra.set("Online"),e instanceof HN&&e.state===2&&e.cause)try{await async function(s,i){const o=i.cause;for(const a of i.targetIds)s.Ia.has(a)&&(await s.remoteSyncer.rejectListen(a,o),s.Ia.delete(a),s.Va.removeTarget(a))}(n,e)}catch(r){W(Fa,"Failed to remove targets %s: %s ",e.targetIds.join(","),r),await rp(n,r)}else if(e instanceof Gf?n.Va.Ze(e):e instanceof GN?n.Va.st(e):n.Va.tt(e),!t.isEqual(Ie.min()))try{const r=await Ek(n.localStore);t.compareTo(r)>=0&&await function(i,o){const a=i.Va.Tt(o);return a.targetChanges.forEach((l,u)=>{if(l.resumeToken.approximateByteSize()>0){const h=i.Ia.get(u);h&&i.Ia.set(u,h.withResumeToken(l.resumeToken,o))}}),a.targetMismatches.forEach((l,u)=>{const h=i.Ia.get(l);if(!h)return;i.Ia.set(l,h.withResumeToken(an.EMPTY_BYTE_STRING,h.snapshotVersion)),Mk(i,l);const f=new ci(h.target,l,u,h.sequenceNumber);Yw(i,f)}),i.remoteSyncer.applyRemoteEvent(a)}(n,t)}catch(r){W(Fa,"Failed to raise snapshot:",r),await rp(n,r)}}async function rp(n,e,t){if(!Uo(e))throw e;n.Ea.add(1),await Uc(n),n.Ra.set("Offline"),t||(t=()=>Ek(n.localStore)),n.asyncQueue.enqueueRetryable(async()=>{W(Fa,"Retrying IndexedDB access"),await t(),n.Ea.delete(1),await Eh(n)})}function Ok(n,e){return e().catch(t=>rp(n,t,e))}async function $c(n){const e=re(n),t=Po(e);let r=e.Ta.length>0?e.Ta[e.Ta.length-1].batchId:vo;for(;r6(e);)try{const s=await j5(e.localStore,r);if(s===null){e.Ta.length===0&&t.L_();break}r=s.batchId,s6(e,s)}catch(s){await rp(e,s)}Vk(e)&&Fk(e)}function r6(n){return Bo(n)&&n.Ta.length<10}function s6(n,e){n.Ta.push(e);const t=Po(n);t.O_()&&t.X_&&t.ea(e.mutations)}function Vk(n){return Bo(n)&&!Po(n).x_()&&n.Ta.length>0}function Fk(n){Po(n).start()}async function i6(n){Po(n).ra()}async function o6(n){const e=Po(n);for(const t of n.Ta)e.ea(t.mutations)}async function a6(n,e,t){const r=n.Ta.shift(),s=Ow.from(r,e,t);await Ok(n,()=>n.remoteSyncer.applySuccessfulWrite(s)),await $c(n)}async function l6(n,e){e&&Po(n).X_&&await async function(r,s){if(function(o){return zN(o)&&o!==U.ABORTED}(s.code)){const i=r.Ta.shift();Po(r).B_(),await Ok(r,()=>r.remoteSyncer.rejectFailedWrite(i.batchId,s)),await $c(r)}}(n,e),Vk(n)&&Fk(n)}async function kT(n,e){const t=re(n);t.asyncQueue.verifyOperationInProgress(),W(Fa,"RemoteStore received new credentials");const r=Bo(t);t.Ea.add(3),await Uc(t),r&&t.Ra.set("Unknown"),await t.remoteSyncer.handleCredentialChange(e),t.Ea.delete(3),await Eh(t)}async function Nv(n,e){const t=re(n);e?(t.Ea.delete(2),await Eh(t)):e||(t.Ea.add(2),await Uc(t),t.Ra.set("Unknown"))}function Bc(n){return n.ma||(n.ma=function(t,r,s){const i=re(t);return i.sa(),new H5(r,i.connection,i.authCredentials,i.appCheckCredentials,i.serializer,s)}(n.datastore,n.asyncQueue,{Xo:Z5.bind(null,n),t_:e6.bind(null,n),r_:t6.bind(null,n),H_:n6.bind(null,n)}),n.da.push(async e=>{e?(n.ma.B_(),Xw(n)?Jw(n):n.Ra.set("Unknown")):(await n.ma.stop(),Lk(n))})),n.ma}function Po(n){return n.fa||(n.fa=function(t,r,s){const i=re(t);return i.sa(),new K5(r,i.connection,i.authCredentials,i.appCheckCredentials,i.serializer,s)}(n.datastore,n.asyncQueue,{Xo:()=>Promise.resolve(),t_:i6.bind(null,n),r_:l6.bind(null,n),ta:o6.bind(null,n),na:a6.bind(null,n)}),n.da.push(async e=>{e?(n.fa.B_(),await $c(n)):(await n.fa.stop(),n.Ta.length>0&&(W(Fa,`Stopping write stream with ${n.Ta.length} pending writes`),n.Ta=[]))})),n.fa}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Zw{constructor(e,t,r,s,i){this.asyncQueue=e,this.timerId=t,this.targetTimeMs=r,this.op=s,this.removalCallback=i,this.deferred=new Pn,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(o=>{})}get promise(){return this.deferred.promise}static createAndSchedule(e,t,r,s,i){const o=Date.now()+r,a=new Zw(e,t,o,s,i);return a.start(r),a}start(e){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){this.timerHandle!==null&&(this.clearTimeout(),this.deferred.reject(new z(U.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>this.timerHandle!==null?(this.clearTimeout(),this.op().then(e=>this.deferred.resolve(e))):Promise.resolve())}clearTimeout(){this.timerHandle!==null&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function zc(n,e){if(dn("AsyncQueue",`${e}: ${n}`),Uo(n))return new z(U.UNAVAILABLE,`${e}: ${n}`);throw n}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class _a{static emptySet(e){return new _a(e.comparator)}constructor(e){this.comparator=e?(t,r)=>e(t,r)||ne.comparator(t.key,r.key):(t,r)=>ne.comparator(t.key,r.key),this.keyedMap=Au(),this.sortedSet=new Ot(this.comparator)}has(e){return this.keyedMap.get(e)!=null}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){const t=this.keyedMap.get(e);return t?this.sortedSet.indexOf(t):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal((t,r)=>(e(t),!1))}add(e){const t=this.delete(e.key);return t.copy(t.keyedMap.insert(e.key,e),t.sortedSet.insert(e,null))}delete(e){const t=this.get(e);return t?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(t)):this}isEqual(e){if(!(e instanceof _a)||this.size!==e.size)return!1;const t=this.sortedSet.getIterator(),r=e.sortedSet.getIterator();for(;t.hasNext();){const s=t.getNext().key,i=r.getNext().key;if(!s.isEqual(i))return!1}return!0}toString(){const e=[];return this.forEach(t=>{e.push(t.toString())}),e.length===0?"DocumentSet ()":`DocumentSet (
  `+e.join(`  
`)+`
)`}copy(e,t){const r=new _a;return r.comparator=this.comparator,r.keyedMap=e,r.sortedSet=t,r}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class PT{constructor(){this.ga=new Ot(ne.comparator)}track(e){const t=e.doc.key,r=this.ga.get(t);r?e.type!==0&&r.type===3?this.ga=this.ga.insert(t,e):e.type===3&&r.type!==1?this.ga=this.ga.insert(t,{type:r.type,doc:e.doc}):e.type===2&&r.type===2?this.ga=this.ga.insert(t,{type:2,doc:e.doc}):e.type===2&&r.type===0?this.ga=this.ga.insert(t,{type:0,doc:e.doc}):e.type===1&&r.type===0?this.ga=this.ga.remove(t):e.type===1&&r.type===2?this.ga=this.ga.insert(t,{type:1,doc:r.doc}):e.type===0&&r.type===1?this.ga=this.ga.insert(t,{type:2,doc:e.doc}):ue(63341,{Rt:e,pa:r}):this.ga=this.ga.insert(t,e)}ya(){const e=[];return this.ga.inorderTraversal((t,r)=>{e.push(r)}),e}}class ja{constructor(e,t,r,s,i,o,a,l,u){this.query=e,this.docs=t,this.oldDocs=r,this.docChanges=s,this.mutatedKeys=i,this.fromCache=o,this.syncStateChanged=a,this.excludesMetadataChanges=l,this.hasCachedResults=u}static fromInitialDocuments(e,t,r,s,i){const o=[];return t.forEach(a=>{o.push({type:0,doc:a})}),new ja(e,t,_a.emptySet(t),o,r,s,!0,!1,i)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(!(this.fromCache===e.fromCache&&this.hasCachedResults===e.hasCachedResults&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&_h(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;const t=this.docChanges,r=e.docChanges;if(t.length!==r.length)return!1;for(let s=0;s<t.length;s++)if(t[s].type!==r[s].type||!t[s].doc.isEqual(r[s].doc))return!1;return!0}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class c6{constructor(){this.wa=void 0,this.Sa=[]}ba(){return this.Sa.some(e=>e.Da())}}class u6{constructor(){this.queries=DT(),this.onlineState="Unknown",this.Ca=new Set}terminate(){(function(t,r){const s=re(t),i=s.queries;s.queries=DT(),i.forEach((o,a)=>{for(const l of a.Sa)l.onError(r)})})(this,new z(U.ABORTED,"Firestore shutting down"))}}function DT(){return new Ci(n=>CN(n),_h)}async function ex(n,e){const t=re(n);let r=3;const s=e.query;let i=t.queries.get(s);i?!i.ba()&&e.Da()&&(r=2):(i=new c6,r=e.Da()?0:1);try{switch(r){case 0:i.wa=await t.onListen(s,!0);break;case 1:i.wa=await t.onListen(s,!1);break;case 2:await t.onFirstRemoteStoreListen(s)}}catch(o){const a=zc(o,`Initialization of query '${yl(e.query)}' failed`);return void e.onError(a)}t.queries.set(s,i),i.Sa.push(e),e.va(t.onlineState),i.wa&&e.Fa(i.wa)&&nx(t)}async function tx(n,e){const t=re(n),r=e.query;let s=3;const i=t.queries.get(r);if(i){const o=i.Sa.indexOf(e);o>=0&&(i.Sa.splice(o,1),i.Sa.length===0?s=e.Da()?0:1:!i.ba()&&e.Da()&&(s=2))}switch(s){case 0:return t.queries.delete(r),t.onUnlisten(r,!0);case 1:return t.queries.delete(r),t.onUnlisten(r,!1);case 2:return t.onLastRemoteStoreUnlisten(r);default:return}}function d6(n,e){const t=re(n);let r=!1;for(const s of e){const i=s.query,o=t.queries.get(i);if(o){for(const a of o.Sa)a.Fa(s)&&(r=!0);o.wa=s}}r&&nx(t)}function h6(n,e,t){const r=re(n),s=r.queries.get(e);if(s)for(const i of s.Sa)i.onError(t);r.queries.delete(e)}function nx(n){n.Ca.forEach(e=>{e.next()})}var kv,MT;(MT=kv||(kv={})).Ma="default",MT.Cache="cache";class rx{constructor(e,t,r){this.query=e,this.xa=t,this.Oa=!1,this.Na=null,this.onlineState="Unknown",this.options=r||{}}Fa(e){if(!this.options.includeMetadataChanges){const r=[];for(const s of e.docChanges)s.type!==3&&r.push(s);e=new ja(e.query,e.docs,e.oldDocs,r,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0,e.hasCachedResults)}let t=!1;return this.Oa?this.Ba(e)&&(this.xa.next(e),t=!0):this.La(e,this.onlineState)&&(this.ka(e),t=!0),this.Na=e,t}onError(e){this.xa.error(e)}va(e){this.onlineState=e;let t=!1;return this.Na&&!this.Oa&&this.La(this.Na,e)&&(this.ka(this.Na),t=!0),t}La(e,t){if(!e.fromCache||!this.Da())return!0;const r=t!=="Offline";return(!this.options.qa||!r)&&(!e.docs.isEmpty()||e.hasCachedResults||t==="Offline")}Ba(e){if(e.docChanges.length>0)return!0;const t=this.Na&&this.Na.hasPendingWrites!==e.hasPendingWrites;return!(!e.syncStateChanged&&!t)&&this.options.includeMetadataChanges===!0}ka(e){e=ja.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache,e.hasCachedResults),this.Oa=!0,this.xa.next(e)}Da(){return this.options.source!==kv.Cache}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class jk{constructor(e,t){this.Qa=e,this.byteLength=t}$a(){return"metadata"in this.Qa}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class LT{constructor(e){this.serializer=e}$s(e){return zs(this.serializer,e)}Us(e){return e.metadata.exists?om(this.serializer,e.document,!1):Ut.newNoDocument(this.$s(e.metadata.name),this.Ks(e.metadata.readTime))}Ks(e){return hn(e)}}class sx{constructor(e,t){this.Ua=e,this.serializer=t,this.Ka=[],this.Wa=[],this.collectionGroups=new Set,this.progress=Uk(e)}get queries(){return this.Ka}get documents(){return this.Wa}Ga(e){this.progress.bytesLoaded+=e.byteLength;let t=this.progress.documentsLoaded;if(e.Qa.namedQuery)this.Ka.push(e.Qa.namedQuery);else if(e.Qa.documentMetadata){this.Wa.push({metadata:e.Qa.documentMetadata}),e.Qa.documentMetadata.exists||++t;const r=Je.fromString(e.Qa.documentMetadata.name);this.collectionGroups.add(r.get(r.length-2))}else e.Qa.document&&(this.Wa[this.Wa.length-1].document=e.Qa.document,++t);return t!==this.progress.documentsLoaded?(this.progress.documentsLoaded=t,{...this.progress}):null}za(e){const t=new Map,r=new LT(this.serializer);for(const s of e)if(s.metadata.queries){const i=r.$s(s.metadata.name);for(const o of s.metadata.queries){const a=(t.get(o)||je()).add(i);t.set(o,a)}}return t}async ja(e){const t=await U5(e,new LT(this.serializer),this.Wa,this.Ua.id),r=this.za(this.documents);for(const s of this.Ka)await $5(e,s,r.get(s.name));return this.progress.taskState="Success",{progress:this.progress,Ja:this.collectionGroups,Ha:t}}}function Uk(n){return{taskState:"Running",documentsLoaded:0,bytesLoaded:0,totalDocuments:n.totalDocuments,totalBytes:n.totalBytes}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class $k{constructor(e){this.key=e}}class Bk{constructor(e){this.key=e}}class zk{constructor(e,t){this.query=e,this.Ya=t,this.Za=null,this.hasCachedResults=!1,this.current=!1,this.Xa=je(),this.mutatedKeys=je(),this.eu=NN(e),this.tu=new _a(this.eu)}get nu(){return this.Ya}ru(e,t){const r=t?t.iu:new PT,s=t?t.tu:this.tu;let i=t?t.mutatedKeys:this.mutatedKeys,o=s,a=!1;const l=this.query.limitType==="F"&&s.size===this.query.limit?s.last():null,u=this.query.limitType==="L"&&s.size===this.query.limit?s.first():null;if(e.inorderTraversal((h,f)=>{const g=s.get(h),y=vh(this.query,f)?f:null,w=!!g&&this.mutatedKeys.has(g.key),C=!!y&&(y.hasLocalMutations||this.mutatedKeys.has(y.key)&&y.hasCommittedMutations);let M=!1;g&&y?g.data.isEqual(y.data)?w!==C&&(r.track({type:3,doc:y}),M=!0):this.su(g,y)||(r.track({type:2,doc:y}),M=!0,(l&&this.eu(y,l)>0||u&&this.eu(y,u)<0)&&(a=!0)):!g&&y?(r.track({type:0,doc:y}),M=!0):g&&!y&&(r.track({type:1,doc:g}),M=!0,(l||u)&&(a=!0)),M&&(y?(o=o.add(y),i=C?i.add(h):i.delete(h)):(o=o.delete(h),i=i.delete(h)))}),this.query.limit!==null)for(;o.size>this.query.limit;){const h=this.query.limitType==="F"?o.last():o.first();o=o.delete(h.key),i=i.delete(h.key),r.track({type:1,doc:h})}return{tu:o,iu:r,Cs:a,mutatedKeys:i}}su(e,t){return e.hasLocalMutations&&t.hasCommittedMutations&&!t.hasLocalMutations}applyChanges(e,t,r,s){const i=this.tu;this.tu=e.tu,this.mutatedKeys=e.mutatedKeys;const o=e.iu.ya();o.sort((h,f)=>function(y,w){const C=M=>{switch(M){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return ue(20277,{Rt:M})}};return C(y)-C(w)}(h.type,f.type)||this.eu(h.doc,f.doc)),this.ou(r),s=s??!1;const a=t&&!s?this._u():[],l=this.Xa.size===0&&this.current&&!s?1:0,u=l!==this.Za;return this.Za=l,o.length!==0||u?{snapshot:new ja(this.query,e.tu,i,o,e.mutatedKeys,l===0,u,!1,!!r&&r.resumeToken.approximateByteSize()>0),au:a}:{au:a}}va(e){return this.current&&e==="Offline"?(this.current=!1,this.applyChanges({tu:this.tu,iu:new PT,mutatedKeys:this.mutatedKeys,Cs:!1},!1)):{au:[]}}uu(e){return!this.Ya.has(e)&&!!this.tu.has(e)&&!this.tu.get(e).hasLocalMutations}ou(e){e&&(e.addedDocuments.forEach(t=>this.Ya=this.Ya.add(t)),e.modifiedDocuments.forEach(t=>{}),e.removedDocuments.forEach(t=>this.Ya=this.Ya.delete(t)),this.current=e.current)}_u(){if(!this.current)return[];const e=this.Xa;this.Xa=je(),this.tu.forEach(r=>{this.uu(r.key)&&(this.Xa=this.Xa.add(r.key))});const t=[];return e.forEach(r=>{this.Xa.has(r)||t.push(new Bk(r))}),this.Xa.forEach(r=>{e.has(r)||t.push(new $k(r))}),t}cu(e){this.Ya=e.Qs,this.Xa=je();const t=this.ru(e.documents);return this.applyChanges(t,!0)}lu(){return ja.fromInitialDocuments(this.query,this.tu,this.mutatedKeys,this.Za===0,this.hasCachedResults)}}const zo="SyncEngine";class f6{constructor(e,t,r){this.query=e,this.targetId=t,this.view=r}}class g6{constructor(e){this.key=e,this.hu=!1}}class p6{constructor(e,t,r,s,i,o){this.localStore=e,this.remoteStore=t,this.eventManager=r,this.sharedClientState=s,this.currentUser=i,this.maxConcurrentLimboResolutions=o,this.Pu={},this.Tu=new Ci(a=>CN(a),_h),this.Iu=new Map,this.Eu=new Set,this.du=new Ot(ne.comparator),this.Au=new Map,this.Ru=new Bw,this.Vu={},this.mu=new Map,this.fu=Va.cr(),this.onlineState="Unknown",this.gu=void 0}get isPrimaryClient(){return this.gu===!0}}async function m6(n,e,t=!0){const r=fm(n);let s;const i=r.Tu.get(e);return i?(r.sharedClientState.addLocalQueryTarget(i.targetId),s=i.view.lu()):s=await qk(r,e,t,!0),s}async function y6(n,e){const t=fm(n);await qk(t,e,!0,!1)}async function qk(n,e,t,r){const s=await Ic(n.localStore,nr(e)),i=s.targetId,o=n.sharedClientState.addLocalQueryTarget(i,t);let a;return r&&(a=await ix(n,e,i,o==="current",s.resumeToken)),n.isPrimaryClient&&t&&hm(n.remoteStore,s),a}async function ix(n,e,t,r,s){n.pu=(f,g,y)=>async function(C,M,A,I){let R=M.view.ru(A);R.Cs&&(R=await ep(C.localStore,M.query,!1).then(({documents:S})=>M.view.ru(S,R)));const D=I&&I.targetChanges.get(M.targetId),V=I&&I.targetMismatches.get(M.targetId)!=null,P=M.view.applyChanges(R,C.isPrimaryClient,D,V);return Pv(C,M.targetId,P.au),P.snapshot}(n,f,g,y);const i=await ep(n.localStore,e,!0),o=new zk(e,i.Qs),a=o.ru(i.documents),l=Ih.createSynthesizedTargetChangeForCurrentChange(t,r&&n.onlineState!=="Offline",s),u=o.applyChanges(a,n.isPrimaryClient,l);Pv(n,t,u.au);const h=new f6(e,t,o);return n.Tu.set(e,h),n.Iu.has(t)?n.Iu.get(t).push(e):n.Iu.set(t,[e]),u.snapshot}async function _6(n,e,t){const r=re(n),s=r.Tu.get(e),i=r.Iu.get(s.targetId);if(i.length>1)return r.Iu.set(s.targetId,i.filter(o=>!_h(o,e))),void r.Tu.delete(e);r.isPrimaryClient?(r.sharedClientState.removeLocalQueryTarget(s.targetId),r.sharedClientState.isActiveQueryTarget(s.targetId)||await Ec(r.localStore,s.targetId,!1).then(()=>{r.sharedClientState.clearQueryState(s.targetId),t&&Sc(r.remoteStore,s.targetId),Tc(r,s.targetId)}).catch(jo)):(Tc(r,s.targetId),await Ec(r.localStore,s.targetId,!0))}async function v6(n,e){const t=re(n),r=t.Tu.get(e),s=t.Iu.get(r.targetId);t.isPrimaryClient&&s.length===1&&(t.sharedClientState.removeLocalQueryTarget(r.targetId),Sc(t.remoteStore,r.targetId))}async function w6(n,e,t){const r=cx(n);try{const s=await function(o,a){const l=re(o),u=gt.now(),h=a.reduce((y,w)=>y.add(w.key),je());let f,g;return l.persistence.runTransaction("Locally write mutations","readwrite",y=>{let w=_r(),C=je();return l.Ns.getEntries(y,h).next(M=>{w=M,w.forEach((A,I)=>{I.isValidDocument()||(C=C.add(A))})}).next(()=>l.localDocuments.getOverlayedDocuments(y,w)).next(M=>{f=M;const A=[];for(const I of a){const R=W3(I,f.get(I.key).overlayedDocument);R!=null&&A.push(new Ri(I.key,R,yN(R.value.mapValue),Jt.exists(!0)))}return l.mutationQueue.addMutationBatch(y,u,A,a)}).next(M=>{g=M;const A=M.applyToLocalDocumentSet(f,C);return l.documentOverlayCache.saveOverlays(y,M.batchId,A)})}).then(()=>({batchId:g.batchId,changes:PN(f)}))}(r.localStore,e);r.sharedClientState.addPendingMutation(s.batchId),function(o,a,l){let u=o.Vu[o.currentUser.toKey()];u||(u=new Ot(Pe)),u=u.insert(a,l),o.Vu[o.currentUser.toKey()]=u}(r,s.batchId,t),await Ni(r,s.changes),await $c(r.remoteStore)}catch(s){const i=zc(s,"Failed to persist write");t.reject(i)}}async function Wk(n,e){const t=re(n);try{const r=await F5(t.localStore,e);e.targetChanges.forEach((s,i)=>{const o=t.Au.get(i);o&&(ye(s.addedDocuments.size+s.modifiedDocuments.size+s.removedDocuments.size<=1,22616),s.addedDocuments.size>0?o.hu=!0:s.modifiedDocuments.size>0?ye(o.hu,14607):s.removedDocuments.size>0&&(ye(o.hu,42227),o.hu=!1))}),await Ni(t,r,e)}catch(r){await jo(r)}}function OT(n,e,t){const r=re(n);if(r.isPrimaryClient&&t===0||!r.isPrimaryClient&&t===1){const s=[];r.Tu.forEach((i,o)=>{const a=o.view.va(e);a.snapshot&&s.push(a.snapshot)}),function(o,a){const l=re(o);l.onlineState=a;let u=!1;l.queries.forEach((h,f)=>{for(const g of f.Sa)g.va(a)&&(u=!0)}),u&&nx(l)}(r.eventManager,e),s.length&&r.Pu.H_(s),r.onlineState=e,r.isPrimaryClient&&r.sharedClientState.setOnlineState(e)}}async function x6(n,e,t){const r=re(n);r.sharedClientState.updateQueryState(e,"rejected",t);const s=r.Au.get(e),i=s&&s.key;if(i){let o=new Ot(ne.comparator);o=o.insert(i,Ut.newNoDocument(i,Ie.min()));const a=je().add(i),l=new xh(Ie.min(),new Map,new Ot(Pe),o,a);await Wk(r,l),r.du=r.du.remove(i),r.Au.delete(e),lx(r)}else await Ec(r.localStore,e,!1).then(()=>Tc(r,e,t)).catch(jo)}async function I6(n,e){const t=re(n),r=e.batch.batchId;try{const s=await V5(t.localStore,e);ax(t,r,null),ox(t,r),t.sharedClientState.updateMutationState(r,"acknowledged"),await Ni(t,s)}catch(s){await jo(s)}}async function E6(n,e,t){const r=re(n);try{const s=await function(o,a){const l=re(o);return l.persistence.runTransaction("Reject batch","readwrite-primary",u=>{let h;return l.mutationQueue.lookupMutationBatch(u,a).next(f=>(ye(f!==null,37113),h=f.keys(),l.mutationQueue.removeMutationBatch(u,f))).next(()=>l.mutationQueue.performConsistencyCheck(u)).next(()=>l.documentOverlayCache.removeOverlaysForBatchId(u,h,a)).next(()=>l.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(u,h)).next(()=>l.localDocuments.getDocuments(u,h))})}(r.localStore,e);ax(r,e,t),ox(r,e),r.sharedClientState.updateMutationState(e,"rejected",t),await Ni(r,s)}catch(s){await jo(s)}}async function S6(n,e){const t=re(n);Bo(t.remoteStore)||W(zo,"The network is disabled. The task returned by 'awaitPendingWrites()' will not complete until the network is enabled.");try{const r=await function(o){const a=re(o);return a.persistence.runTransaction("Get highest unacknowledged batch id","readonly",l=>a.mutationQueue.getHighestUnacknowledgedBatchId(l))}(t.localStore);if(r===vo)return void e.resolve();const s=t.mu.get(r)||[];s.push(e),t.mu.set(r,s)}catch(r){const s=zc(r,"Initialization of waitForPendingWrites() operation failed");e.reject(s)}}function ox(n,e){(n.mu.get(e)||[]).forEach(t=>{t.resolve()}),n.mu.delete(e)}function ax(n,e,t){const r=re(n);let s=r.Vu[r.currentUser.toKey()];if(s){const i=s.get(e);i&&(t?i.reject(t):i.resolve(),s=s.remove(e)),r.Vu[r.currentUser.toKey()]=s}}function Tc(n,e,t=null){n.sharedClientState.removeLocalQueryTarget(e);for(const r of n.Iu.get(e))n.Tu.delete(r),t&&n.Pu.yu(r,t);n.Iu.delete(e),n.isPrimaryClient&&n.Ru.jr(e).forEach(r=>{n.Ru.containsKey(r)||Gk(n,r)})}function Gk(n,e){n.Eu.delete(e.path.canonicalString());const t=n.du.get(e);t!==null&&(Sc(n.remoteStore,t),n.du=n.du.remove(e),n.Au.delete(t),lx(n))}function Pv(n,e,t){for(const r of t)r instanceof $k?(n.Ru.addReference(r.key,e),T6(n,r)):r instanceof Bk?(W(zo,"Document no longer in limbo: "+r.key),n.Ru.removeReference(r.key,e),n.Ru.containsKey(r.key)||Gk(n,r.key)):ue(19791,{wu:r})}function T6(n,e){const t=e.key,r=t.path.canonicalString();n.du.get(t)||n.Eu.has(r)||(W(zo,"New document in limbo: "+t),n.Eu.add(r),lx(n))}function lx(n){for(;n.Eu.size>0&&n.du.size<n.maxConcurrentLimboResolutions;){const e=n.Eu.values().next().value;n.Eu.delete(e);const t=new ne(Je.fromString(e)),r=n.fu.next();n.Au.set(r,new g6(t)),n.du=n.du.insert(t,r),hm(n.remoteStore,new ci(nr(Vc(t.path)),r,"TargetPurposeLimboResolution",mr.ce))}}async function Ni(n,e,t){const r=re(n),s=[],i=[],o=[];r.Tu.isEmpty()||(r.Tu.forEach((a,l)=>{o.push(r.pu(l,e,t).then(u=>{var h;if((u||t)&&r.isPrimaryClient){const f=u?!u.fromCache:(h=t==null?void 0:t.targetChanges.get(l.targetId))==null?void 0:h.current;r.sharedClientState.updateQueryState(l.targetId,f?"current":"not-current")}if(u){s.push(u);const f=Gw.As(l.targetId,u);i.push(f)}}))}),await Promise.all(o),r.Pu.H_(s),await async function(l,u){const h=re(l);try{await h.persistence.runTransaction("notifyLocalViewChanges","readwrite",f=>O.forEach(u,g=>O.forEach(g.Es,y=>h.persistence.referenceDelegate.addReference(f,g.targetId,y)).next(()=>O.forEach(g.ds,y=>h.persistence.referenceDelegate.removeReference(f,g.targetId,y)))))}catch(f){if(!Uo(f))throw f;W(Hw,"Failed to update sequence numbers: "+f)}for(const f of u){const g=f.targetId;if(!f.fromCache){const y=h.Ms.get(g),w=y.snapshotVersion,C=y.withLastLimboFreeSnapshotVersion(w);h.Ms=h.Ms.insert(g,C)}}}(r.localStore,i))}async function b6(n,e){const t=re(n);if(!t.currentUser.isEqual(e)){W(zo,"User change. New user:",e.toKey());const r=await Ik(t.localStore,e);t.currentUser=e,function(i,o){i.mu.forEach(a=>{a.forEach(l=>{l.reject(new z(U.CANCELLED,o))})}),i.mu.clear()}(t,"'waitForPendingWrites' promise is rejected due to a user change."),t.sharedClientState.handleUserChange(e,r.removedBatchIds,r.addedBatchIds),await Ni(t,r.Ls)}}function A6(n,e){const t=re(n),r=t.Au.get(e);if(r&&r.hu)return je().add(r.key);{let s=je();const i=t.Iu.get(e);if(!i)return s;for(const o of i){const a=t.Tu.get(o);s=s.unionWith(a.view.nu)}return s}}async function C6(n,e){const t=re(n),r=await ep(t.localStore,e.query,!0),s=e.view.cu(r);return t.isPrimaryClient&&Pv(t,e.targetId,s.au),s}async function R6(n,e){const t=re(n);return bk(t.localStore,e).then(r=>Ni(t,r))}async function N6(n,e,t,r){const s=re(n),i=await function(a,l){const u=re(a),h=re(u.mutationQueue);return u.persistence.runTransaction("Lookup mutation documents","readonly",f=>h.er(f,l).next(g=>g?u.localDocuments.getDocuments(f,g):O.resolve(null)))}(s.localStore,e);i!==null?(t==="pending"?await $c(s.remoteStore):t==="acknowledged"||t==="rejected"?(ax(s,e,r||null),ox(s,e),function(a,l){re(re(a).mutationQueue).ir(l)}(s.localStore,e)):ue(6720,"Unknown batchState",{Su:t}),await Ni(s,i)):W(zo,"Cannot apply mutation batch with id: "+e)}async function k6(n,e){const t=re(n);if(fm(t),cx(t),e===!0&&t.gu!==!0){const r=t.sharedClientState.getAllActiveQueryTargets(),s=await VT(t,r.toArray());t.gu=!0,await Nv(t.remoteStore,!0);for(const i of s)hm(t.remoteStore,i)}else if(e===!1&&t.gu!==!1){const r=[];let s=Promise.resolve();t.Iu.forEach((i,o)=>{t.sharedClientState.isLocalQueryTarget(o)?r.push(o):s=s.then(()=>(Tc(t,o),Ec(t.localStore,o,!0))),Sc(t.remoteStore,o)}),await s,await VT(t,r),function(o){const a=re(o);a.Au.forEach((l,u)=>{Sc(a.remoteStore,u)}),a.Ru.Jr(),a.Au=new Map,a.du=new Ot(ne.comparator)}(t),t.gu=!1,await Nv(t.remoteStore,!1)}}async function VT(n,e,t){const r=re(n),s=[],i=[];for(const o of e){let a;const l=r.Iu.get(o);if(l&&l.length!==0){a=await Ic(r.localStore,nr(l[0]));for(const u of l){const h=r.Tu.get(u),f=await C6(r,h);f.snapshot&&i.push(f.snapshot)}}else{const u=await Tk(r.localStore,o);a=await Ic(r.localStore,u),await ix(r,Hk(u),o,!1,a.resumeToken)}s.push(a)}return r.Pu.H_(i),s}function Hk(n){return TN(n.path,n.collectionGroup,n.orderBy,n.filters,n.limit,"F",n.startAt,n.endAt)}function P6(n){return function(t){return re(re(t).persistence).Ts()}(re(n).localStore)}async function D6(n,e,t,r){const s=re(n);if(s.gu)return void W(zo,"Ignoring unexpected query state notification.");const i=s.Iu.get(e);if(i&&i.length>0)switch(t){case"current":case"not-current":{const o=await bk(s.localStore,RN(i[0])),a=xh.createSynthesizedRemoteEventForCurrentChange(e,t==="current",an.EMPTY_BYTE_STRING);await Ni(s,o,a);break}case"rejected":await Ec(s.localStore,e,!0),Tc(s,e,r);break;default:ue(64155,t)}}async function M6(n,e,t){const r=fm(n);if(r.gu){for(const s of e){if(r.Iu.has(s)&&r.sharedClientState.isActiveQueryTarget(s)){W(zo,"Adding an already active target "+s);continue}const i=await Tk(r.localStore,s),o=await Ic(r.localStore,i);await ix(r,Hk(i),o.targetId,!1,o.resumeToken),hm(r.remoteStore,o)}for(const s of t)r.Iu.has(s)&&await Ec(r.localStore,s,!1).then(()=>{Sc(r.remoteStore,s),Tc(r,s)}).catch(jo)}}function fm(n){const e=re(n);return e.remoteStore.remoteSyncer.applyRemoteEvent=Wk.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=A6.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=x6.bind(null,e),e.Pu.H_=d6.bind(null,e.eventManager),e.Pu.yu=h6.bind(null,e.eventManager),e}function cx(n){const e=re(n);return e.remoteStore.remoteSyncer.applySuccessfulWrite=I6.bind(null,e),e.remoteStore.remoteSyncer.rejectFailedWrite=E6.bind(null,e),e}function L6(n,e,t){const r=re(n);(async function(i,o,a){try{const l=await o.getMetadata();if(await function(y,w){const C=re(y),M=hn(w.createTime);return C.persistence.runTransaction("hasNewerBundle","readonly",A=>C.Ii.getBundleMetadata(A,w.id)).then(A=>!!A&&A.createTime.compareTo(M)>=0)}(i.localStore,l))return await o.close(),a._completeWith(function(y){return{taskState:"Success",documentsLoaded:y.totalDocuments,bytesLoaded:y.totalBytes,totalDocuments:y.totalDocuments,totalBytes:y.totalBytes}}(l)),Promise.resolve(new Set);a._updateProgress(Uk(l));const u=new sx(l,o.serializer);let h=await o.bu();for(;h;){const g=await u.Ga(h);g&&a._updateProgress(g),h=await o.bu()}const f=await u.ja(i.localStore);return await Ni(i,f.Ha,void 0),await function(y,w){const C=re(y);return C.persistence.runTransaction("Save bundle","readwrite",M=>C.Ii.saveBundleMetadata(M,w))}(i.localStore,l),a._completeWith(f.progress),Promise.resolve(f.Ja)}catch(l){return rs(zo,`Loading bundle failed with ${l}`),a._failWith(l),Promise.resolve(new Set)}})(r,e,t).then(s=>{r.sharedClientState.notifyBundleLoaded(s)})}class bc{constructor(){this.kind="memory",this.synchronizeTabs=!1}async initialize(e){this.serializer=Ja(e.databaseInfo.databaseId),this.sharedClientState=this.Du(e),this.persistence=this.Cu(e),await this.persistence.start(),this.localStore=this.vu(e),this.gcScheduler=this.Fu(e,this.localStore),this.indexBackfillerScheduler=this.Mu(e,this.localStore)}Fu(e,t){return null}Mu(e,t){return null}vu(e){return xk(this.persistence,new wk,e.initialUser,this.serializer)}Cu(e){return new zw(dm.mi,this.serializer)}Du(e){return new kk}async terminate(){var e,t;(e=this.gcScheduler)==null||e.stop(),(t=this.indexBackfillerScheduler)==null||t.stop(),this.sharedClientState.shutdown(),await this.persistence.shutdown()}}bc.provider={build:()=>new bc};class ux extends bc{constructor(e){super(),this.cacheSizeBytes=e}Fu(e,t){ye(this.persistence.referenceDelegate instanceof Zg,46915);const r=this.persistence.referenceDelegate.garbageCollector;return new gk(r,e.asyncQueue,t)}Cu(e){const t=this.cacheSizeBytes!==void 0?Xn.withCacheSize(this.cacheSizeBytes):Xn.DEFAULT;return new zw(r=>Zg.mi(r,t),this.serializer)}}class dx extends bc{constructor(e,t,r){super(),this.xu=e,this.cacheSizeBytes=t,this.forceOwnership=r,this.kind="persistent",this.synchronizeTabs=!1}async initialize(e){await super.initialize(e),await this.xu.initialize(this,e),await cx(this.xu.syncEngine),await $c(this.xu.remoteStore),await this.persistence.Ji(()=>(this.gcScheduler&&!this.gcScheduler.started&&this.gcScheduler.start(),this.indexBackfillerScheduler&&!this.indexBackfillerScheduler.started&&this.indexBackfillerScheduler.start(),Promise.resolve()))}vu(e){return xk(this.persistence,new wk,e.initialUser,this.serializer)}Fu(e,t){const r=this.persistence.referenceDelegate.garbageCollector;return new gk(r,e.asyncQueue,t)}Mu(e,t){const r=new Y4(t,this.persistence);return new Q4(e.asyncQueue,r)}Cu(e){const t=Ww(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey),r=this.cacheSizeBytes!==void 0?Xn.withCacheSize(this.cacheSizeBytes):Xn.DEFAULT;return new qw(this.synchronizeTabs,t,e.clientId,r,e.asyncQueue,Pk(),Kf(),this.serializer,this.sharedClientState,!!this.forceOwnership)}Du(e){return new kk}}class Kk extends dx{constructor(e,t){super(e,t,!1),this.xu=e,this.cacheSizeBytes=t,this.synchronizeTabs=!0}async initialize(e){await super.initialize(e);const t=this.xu.syncEngine;this.sharedClientState instanceof ky&&(this.sharedClientState.syncEngine={Co:N6.bind(null,t),vo:D6.bind(null,t),Fo:M6.bind(null,t),Ts:P6.bind(null,t),Do:R6.bind(null,t)},await this.sharedClientState.start()),await this.persistence.Ji(async r=>{await k6(this.xu.syncEngine,r),this.gcScheduler&&(r&&!this.gcScheduler.started?this.gcScheduler.start():r||this.gcScheduler.stop()),this.indexBackfillerScheduler&&(r&&!this.indexBackfillerScheduler.started?this.indexBackfillerScheduler.start():r||this.indexBackfillerScheduler.stop())})}Du(e){const t=Pk();if(!ky.v(t))throw new z(U.UNIMPLEMENTED,"IndexedDB persistence is only available on platforms that support LocalStorage.");const r=Ww(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey);return new ky(t,e.asyncQueue,r,e.clientId,e.initialUser)}}class Do{async initialize(e,t){this.localStore||(this.localStore=e.localStore,this.sharedClientState=e.sharedClientState,this.datastore=this.createDatastore(t),this.remoteStore=this.createRemoteStore(t),this.eventManager=this.createEventManager(t),this.syncEngine=this.createSyncEngine(t,!e.synchronizeTabs),this.sharedClientState.onlineStateHandler=r=>OT(this.syncEngine,r,1),this.remoteStore.remoteSyncer.handleCredentialChange=b6.bind(null,this.syncEngine),await Nv(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(e){return function(){return new u6}()}createDatastore(e){const t=Ja(e.databaseInfo.databaseId),r=function(i){return new G5(i)}(e.databaseInfo);return function(i,o,a,l){return new Y5(i,o,a,l)}(e.authCredentials,e.appCheckCredentials,r,t)}createRemoteStore(e){return function(r,s,i,o,a){return new X5(r,s,i,o,a)}(this.localStore,this.datastore,e.asyncQueue,t=>OT(this.syncEngine,t,0),function(){return RT.v()?new RT:new B5}())}createSyncEngine(e,t){return function(s,i,o,a,l,u,h){const f=new p6(s,i,o,a,l,u);return h&&(f.gu=!0),f}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,e.initialUser,e.maxConcurrentLimboResolutions,t)}async terminate(){var e,t;await async function(s){const i=re(s);W(Fa,"RemoteStore shutting down."),i.Ea.add(5),await Uc(i),i.Aa.shutdown(),i.Ra.set("Unknown")}(this.remoteStore),(e=this.datastore)==null||e.terminate(),(t=this.eventManager)==null||t.terminate()}}Do.provider={build:()=>new Do};function FT(n,e=10240){let t=0;return{async read(){if(t<n.byteLength){const r={value:n.slice(t,t+e),done:!1};return t+=e,r}return{done:!0}},async cancel(){},releaseLock(){},closed:Promise.resolve()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class gm{constructor(e){this.observer=e,this.muted=!1}next(e){this.muted||this.observer.next&&this.Ou(this.observer.next,e)}error(e){this.muted||(this.observer.error?this.Ou(this.observer.error,e):dn("Uncaught Error in snapshot listener:",e.toString()))}Nu(){this.muted=!0}Ou(e,t){setTimeout(()=>{this.muted||e(t)},0)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class O6{constructor(e,t){this.Bu=e,this.serializer=t,this.metadata=new Pn,this.buffer=new Uint8Array,this.Lu=function(){return new TextDecoder("utf-8")}(),this.ku().then(r=>{r&&r.$a()?this.metadata.resolve(r.Qa.metadata):this.metadata.reject(new Error(`The first element of the bundle is not a metadata, it is
             ${JSON.stringify(r==null?void 0:r.Qa)}`))},r=>this.metadata.reject(r))}close(){return this.Bu.cancel()}async getMetadata(){return this.metadata.promise}async bu(){return await this.getMetadata(),this.ku()}async ku(){const e=await this.qu();if(e===null)return null;const t=this.Lu.decode(e),r=Number(t);isNaN(r)&&this.Qu(`length string (${t}) is not valid number`);const s=await this.$u(r);return new jk(JSON.parse(s),e.length+r)}Uu(){return this.buffer.findIndex(e=>e==="{".charCodeAt(0))}async qu(){for(;this.Uu()<0&&!await this.Ku(););if(this.buffer.length===0)return null;const e=this.Uu();e<0&&this.Qu("Reached the end of bundle when a length string is expected.");const t=this.buffer.slice(0,e);return this.buffer=this.buffer.slice(e),t}async $u(e){for(;this.buffer.length<e;)await this.Ku()&&this.Qu("Reached the end of bundle when more is expected.");const t=this.Lu.decode(this.buffer.slice(0,e));return this.buffer=this.buffer.slice(e),t}Qu(e){throw this.Bu.cancel(),new Error(`Invalid bundle format: ${e}`)}async Ku(){const e=await this.Bu.read();if(!e.done){const t=new Uint8Array(this.buffer.length+e.value.length);t.set(this.buffer),t.set(e.value,this.buffer.length),this.buffer=t}return e.done}}/**
 * @license
 * Copyright 2025 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class V6{constructor(e,t){this.bundleData=e,this.serializer=t,this.cursor=0,this.elements=[];let r=this.bu();if(!r||!r.$a())throw new Error(`The first element of the bundle is not a metadata object, it is
         ${JSON.stringify(r==null?void 0:r.Qa)}`);this.metadata=r;do r=this.bu(),r!==null&&this.elements.push(r);while(r!==null)}getMetadata(){return this.metadata}Wu(){return this.elements}bu(){if(this.cursor===this.bundleData.length)return null;const e=this.qu(),t=this.$u(e);return new jk(JSON.parse(t),e)}$u(e){if(this.cursor+e>this.bundleData.length)throw new z(U.INTERNAL,"Reached the end of bundle when more is expected.");return this.bundleData.slice(this.cursor,this.cursor+=e)}qu(){const e=this.cursor;let t=this.cursor;for(;t<this.bundleData.length;){if(this.bundleData[t]==="{"){if(t===e)throw new Error("First character is a bracket and not a number");return this.cursor=t,Number(this.bundleData.slice(e,t))}t++}throw new Error("Reached the end of bundle when more is expected.")}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class F6{constructor(e){this.datastore=e,this.readVersions=new Map,this.mutations=[],this.committed=!1,this.lastTransactionError=null,this.writtenDocs=new Set}async lookup(e){if(this.ensureCommitNotCalled(),this.mutations.length>0)throw this.lastTransactionError=new z(U.INVALID_ARGUMENT,"Firestore transactions require all reads to be executed before all writes."),this.lastTransactionError;const t=await async function(s,i){const o=re(s),a={documents:i.map(f=>$d(o.serializer,f))},l=await o.Ho("BatchGetDocuments",o.serializer.databaseId,Je.emptyPath(),a,i.length),u=new Map;l.forEach(f=>{const g=e5(o.serializer,f);u.set(g.key.toString(),g)});const h=[];return i.forEach(f=>{const g=u.get(f.toString());ye(!!g,55234,{key:f}),h.push(g)}),h}(this.datastore,e);return t.forEach(r=>this.recordVersion(r)),t}set(e,t){this.write(t.toMutation(e,this.precondition(e))),this.writtenDocs.add(e.toString())}update(e,t){try{this.write(t.toMutation(e,this.preconditionForUpdate(e)))}catch(r){this.lastTransactionError=r}this.writtenDocs.add(e.toString())}delete(e){this.write(new jc(e,this.precondition(e))),this.writtenDocs.add(e.toString())}async commit(){if(this.ensureCommitNotCalled(),this.lastTransactionError)throw this.lastTransactionError;const e=this.readVersions;this.mutations.forEach(t=>{e.delete(t.key.toString())}),e.forEach((t,r)=>{const s=ne.fromPath(r);this.mutations.push(new Mw(s,this.precondition(s)))}),await async function(r,s){const i=re(r),o={writes:s.map(a=>Bd(i.serializer,a))};await i.Go("Commit",i.serializer.databaseId,Je.emptyPath(),o)}(this.datastore,this.mutations),this.committed=!0}recordVersion(e){let t;if(e.isFoundDocument())t=e.version;else{if(!e.isNoDocument())throw ue(50498,{Gu:e.constructor.name});t=Ie.min()}const r=this.readVersions.get(e.key.toString());if(r){if(!t.isEqual(r))throw new z(U.ABORTED,"Document version changed between two reads.")}else this.readVersions.set(e.key.toString(),t)}precondition(e){const t=this.readVersions.get(e.toString());return!this.writtenDocs.has(e.toString())&&t?t.isEqual(Ie.min())?Jt.exists(!1):Jt.updateTime(t):Jt.none()}preconditionForUpdate(e){const t=this.readVersions.get(e.toString());if(!this.writtenDocs.has(e.toString())&&t){if(t.isEqual(Ie.min()))throw new z(U.INVALID_ARGUMENT,"Can't update a document that doesn't exist.");return Jt.updateTime(t)}return Jt.exists(!0)}write(e){this.ensureCommitNotCalled(),this.mutations.push(e)}ensureCommitNotCalled(){}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class j6{constructor(e,t,r,s,i){this.asyncQueue=e,this.datastore=t,this.options=r,this.updateFunction=s,this.deferred=i,this.zu=r.maxAttempts,this.M_=new Qw(this.asyncQueue,"transaction_retry")}ju(){this.zu-=1,this.Ju()}Ju(){this.M_.p_(async()=>{const e=new F6(this.datastore),t=this.Hu(e);t&&t.then(r=>{this.asyncQueue.enqueueAndForget(()=>e.commit().then(()=>{this.deferred.resolve(r)}).catch(s=>{this.Yu(s)}))}).catch(r=>{this.Yu(r)})})}Hu(e){try{const t=this.updateFunction(e);return!ph(t)&&t.catch&&t.then?t:(this.deferred.reject(Error("Transaction callback must return a Promise")),null)}catch(t){return this.deferred.reject(t),null}}Yu(e){this.zu>0&&this.Zu(e)?(this.zu-=1,this.asyncQueue.enqueueAndForget(()=>(this.Ju(),Promise.resolve()))):this.deferred.reject(e)}Zu(e){if(e.name==="FirebaseError"){const t=e.code;return t==="aborted"||t==="failed-precondition"||t==="already-exists"||!zN(t)}return!1}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Mo="FirestoreClient";class U6{constructor(e,t,r,s,i){this.authCredentials=e,this.appCheckCredentials=t,this.asyncQueue=r,this.databaseInfo=s,this.user=Rn.UNAUTHENTICATED,this.clientId=ww.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this._uninitializedComponentsProvider=i,this.authCredentials.start(r,async o=>{W(Mo,"Received user=",o.uid),await this.authCredentialListener(o),this.user=o}),this.appCheckCredentials.start(r,o=>(W(Mo,"Received new app check token=",o),this.appCheckCredentialListener(o,this.user)))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}terminate(){this.asyncQueue.enterRestrictedMode();const e=new Pn;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted(async()=>{try{this._onlineComponents&&await this._onlineComponents.terminate(),this._offlineComponents&&await this._offlineComponents.terminate(),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),e.resolve()}catch(t){const r=zc(t,"Failed to shutdown persistence");e.reject(r)}}),e.promise}}async function Dy(n,e){n.asyncQueue.verifyOperationInProgress(),W(Mo,"Initializing OfflineComponentProvider");const t=n.configuration;await e.initialize(t);let r=t.initialUser;n.setCredentialChangeListener(async s=>{r.isEqual(s)||(await Ik(e.localStore,s),r=s)}),e.persistence.setDatabaseDeletedListener(()=>n.terminate()),n._offlineComponents=e}async function jT(n,e){n.asyncQueue.verifyOperationInProgress();const t=await hx(n);W(Mo,"Initializing OnlineComponentProvider"),await e.initialize(t,n.configuration),n.setCredentialChangeListener(r=>kT(e.remoteStore,r)),n.setAppCheckTokenChangeListener((r,s)=>kT(e.remoteStore,s)),n._onlineComponents=e}async function hx(n){if(!n._offlineComponents)if(n._uninitializedComponentsProvider){W(Mo,"Using user provided OfflineComponentProvider");try{await Dy(n,n._uninitializedComponentsProvider._offline)}catch(e){const t=e;if(!function(s){return s.name==="FirebaseError"?s.code===U.FAILED_PRECONDITION||s.code===U.UNIMPLEMENTED:!(typeof DOMException<"u"&&s instanceof DOMException)||s.code===22||s.code===20||s.code===11}(t))throw t;rs("Error using user provided cache. Falling back to memory cache: "+t),await Dy(n,new bc)}}else W(Mo,"Using default OfflineComponentProvider"),await Dy(n,new ux(void 0));return n._offlineComponents}async function pm(n){return n._onlineComponents||(n._uninitializedComponentsProvider?(W(Mo,"Using user provided OnlineComponentProvider"),await jT(n,n._uninitializedComponentsProvider._online)):(W(Mo,"Using default OnlineComponentProvider"),await jT(n,new Do))),n._onlineComponents}function Qk(n){return hx(n).then(e=>e.persistence)}function qc(n){return hx(n).then(e=>e.localStore)}function Yk(n){return pm(n).then(e=>e.remoteStore)}function fx(n){return pm(n).then(e=>e.syncEngine)}function Jk(n){return pm(n).then(e=>e.datastore)}async function Ac(n){const e=await pm(n),t=e.eventManager;return t.onListen=m6.bind(null,e.syncEngine),t.onUnlisten=_6.bind(null,e.syncEngine),t.onFirstRemoteStoreListen=y6.bind(null,e.syncEngine),t.onLastRemoteStoreUnlisten=v6.bind(null,e.syncEngine),t}function $6(n){return n.asyncQueue.enqueue(async()=>{const e=await Qk(n),t=await Yk(n);return e.setNetworkEnabled(!0),function(s){const i=re(s);return i.Ea.delete(0),Eh(i)}(t)})}function B6(n){return n.asyncQueue.enqueue(async()=>{const e=await Qk(n),t=await Yk(n);return e.setNetworkEnabled(!1),async function(s){const i=re(s);i.Ea.add(0),await Uc(i),i.Ra.set("Offline")}(t)})}function z6(n,e){const t=new Pn;return n.asyncQueue.enqueueAndForget(async()=>async function(s,i,o){try{const a=await function(u,h){const f=re(u);return f.persistence.runTransaction("read document","readonly",g=>f.localDocuments.getDocument(g,h))}(s,i);a.isFoundDocument()?o.resolve(a):a.isNoDocument()?o.resolve(null):o.reject(new z(U.UNAVAILABLE,"Failed to get document from cache. (However, this document may exist on the server. Run again without setting 'source' in the GetOptions to attempt to retrieve the document from the server.)"))}catch(a){const l=zc(a,`Failed to get document '${i} from cache`);o.reject(l)}}(await qc(n),e,t)),t.promise}function Xk(n,e,t={}){const r=new Pn;return n.asyncQueue.enqueueAndForget(async()=>function(i,o,a,l,u){const h=new gm({next:g=>{h.Nu(),o.enqueueAndForget(()=>tx(i,f));const y=g.docs.has(a);!y&&g.fromCache?u.reject(new z(U.UNAVAILABLE,"Failed to get document because the client is offline.")):y&&g.fromCache&&l&&l.source==="server"?u.reject(new z(U.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):u.resolve(g)},error:g=>u.reject(g)}),f=new rx(Vc(a.path),h,{includeMetadataChanges:!0,qa:!0});return ex(i,f)}(await Ac(n),n.asyncQueue,e,t,r)),r.promise}function q6(n,e){const t=new Pn;return n.asyncQueue.enqueueAndForget(async()=>async function(s,i,o){try{const a=await ep(s,i,!0),l=new zk(i,a.Qs),u=l.ru(a.documents),h=l.applyChanges(u,!1);o.resolve(h.snapshot)}catch(a){const l=zc(a,`Failed to execute query '${i} against cache`);o.reject(l)}}(await qc(n),e,t)),t.promise}function Zk(n,e,t={}){const r=new Pn;return n.asyncQueue.enqueueAndForget(async()=>function(i,o,a,l,u){const h=new gm({next:g=>{h.Nu(),o.enqueueAndForget(()=>tx(i,f)),g.fromCache&&l.source==="server"?u.reject(new z(U.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):u.resolve(g)},error:g=>u.reject(g)}),f=new rx(a,h,{includeMetadataChanges:!0,qa:!0});return ex(i,f)}(await Ac(n),n.asyncQueue,e,t,r)),r.promise}function W6(n,e,t){const r=new Pn;return n.asyncQueue.enqueueAndForget(async()=>{try{const s=await Jk(n);r.resolve(async function(o,a,l){var C;const u=re(o),{request:h,gt:f,parent:g}=ek(u.serializer,bN(a),l);u.connection.$o||delete h.parent;const y=(await u.Ho("RunAggregationQuery",u.serializer.databaseId,g,h,1)).filter(M=>!!M.result);ye(y.length===1,64727);const w=(C=y[0].result)==null?void 0:C.aggregateFields;return Object.keys(w).reduce((M,A)=>(M[f[A]]=w[A],M),{})}(s,e,t))}catch(s){r.reject(s)}}),r.promise}function G6(n,e){const t=new gm(e);return n.asyncQueue.enqueueAndForget(async()=>function(s,i){re(s).Ca.add(i),i.next()}(await Ac(n),t)),()=>{t.Nu(),n.asyncQueue.enqueueAndForget(async()=>function(s,i){re(s).Ca.delete(i)}(await Ac(n),t))}}function H6(n,e,t,r){const s=function(o,a){let l;return l=typeof o=="string"?WN().encode(o):o,function(h,f){return new O6(h,f)}(function(h,f){if(h instanceof Uint8Array)return FT(h,f);if(h instanceof ArrayBuffer)return FT(new Uint8Array(h),f);if(h instanceof ReadableStream)return h.getReader();throw new Error("Source of `toByteStreamReader` has to be a ArrayBuffer or ReadableStream")}(l),a)}(t,Ja(e));n.asyncQueue.enqueueAndForget(async()=>{L6(await fx(n),s,r)})}function K6(n,e){return n.asyncQueue.enqueue(async()=>function(r,s){const i=re(r);return i.persistence.runTransaction("Get named query","readonly",o=>i.Ii.getNamedQuery(o,s))}(await qc(n),e))}function eP(n,e){return function(r,s){return new V6(r,s)}(n,e)}function Q6(n,e){return n.asyncQueue.enqueue(async()=>async function(r,s){const i=re(r),o=i.indexManager,a=[];return i.persistence.runTransaction("Configure indexes","readwrite",l=>o.getFieldIndexes(l).next(u=>function(f,g,y,w,C){f=[...f],g=[...g],f.sort(y),g.sort(y);const M=f.length,A=g.length;let I=0,R=0;for(;I<A&&R<M;){const D=y(f[R],g[I]);D<0?C(f[R++]):D>0?w(g[I++]):(I++,R++)}for(;I<A;)w(g[I++]);for(;R<M;)C(f[R++])}(u,s,W4,h=>{a.push(o.addFieldIndex(l,h))},h=>{a.push(o.deleteFieldIndex(l,h))})).next(()=>O.waitFor(a)))}(await qc(n),e))}function Y6(n,e){return n.asyncQueue.enqueue(async()=>function(r,s){re(r).Fs.Vs=s}(await qc(n),e))}function J6(n){return n.asyncQueue.enqueue(async()=>function(t){const r=re(t),s=r.indexManager;return r.persistence.runTransaction("Delete All Indexes","readwrite",i=>s.deleteAllFieldIndexes(i))}(await qc(n)))}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function tP(n){const e={};return n.timeoutSeconds!==void 0&&(e.timeoutSeconds=n.timeoutSeconds),e}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const UT=new Map;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const nP="firestore.googleapis.com",$T=!0;class BT{constructor(e){if(e.host===void 0){if(e.ssl!==void 0)throw new z(U.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host=nP,this.ssl=$T}else this.host=e.host,this.ssl=e.ssl??$T;if(this.isUsingEmulator=e.emulatorOptions!==void 0,this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,this.localCache=e.localCache,e.cacheSizeBytes===void 0)this.cacheSizeBytes=ck;else{if(e.cacheSizeBytes!==-1&&e.cacheSizeBytes<fk)throw new z(U.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}q4("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:e.experimentalAutoDetectLongPolling===void 0?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=tP(e.experimentalLongPollingOptions??{}),function(r){if(r.timeoutSeconds!==void 0){if(isNaN(r.timeoutSeconds))throw new z(U.INVALID_ARGUMENT,`invalid long polling timeout: ${r.timeoutSeconds} (must not be NaN)`);if(r.timeoutSeconds<5)throw new z(U.INVALID_ARGUMENT,`invalid long polling timeout: ${r.timeoutSeconds} (minimum allowed value is 5)`);if(r.timeoutSeconds>30)throw new z(U.INVALID_ARGUMENT,`invalid long polling timeout: ${r.timeoutSeconds} (maximum allowed value is 30)`)}}(this.experimentalLongPollingOptions),this.useFetchStreams=!!e.useFetchStreams}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&function(r,s){return r.timeoutSeconds===s.timeoutSeconds}(this.experimentalLongPollingOptions,e.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}}class Sh{constructor(e,t,r,s){this._authCredentials=e,this._appCheckCredentials=t,this._databaseId=r,this._app=s,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new BT({}),this._settingsFrozen=!1,this._emulatorOptions={},this._terminateTask="notTerminated"}get app(){if(!this._app)throw new z(U.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return this._terminateTask!=="notTerminated"}_setSettings(e){if(this._settingsFrozen)throw new z(U.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new BT(e),this._emulatorOptions=e.emulatorOptions||{},e.credentials!==void 0&&(this._authCredentials=function(r){if(!r)return new M4;switch(r.type){case"firstParty":return new F4(r.sessionIndex||"0",r.iamToken||null,r.authTokenFactory||null);case"provider":return r.client;default:throw new z(U.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(e.credentials))}_getSettings(){return this._settings}_getEmulatorOptions(){return this._emulatorOptions}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask==="notTerminated"&&(this._terminateTask=this._terminate()),this._terminateTask}async _restart(){this._terminateTask==="notTerminated"?await this._terminate():this._terminateTask="notTerminated"}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(t){const r=UT.get(t);r&&(W("ComponentProvider","Removing Datastore"),UT.delete(t),r.terminate())}(this),Promise.resolve()}}function X6(n,e,t,r={}){var u;n=et(n,Sh);const s=bi(e),i=n._getSettings(),o={...i,emulatorOptions:n._getEmulatorOptions()},a=`${e}:${t}`;s&&(Rp(`https://${a}`),P0("Firestore",!0)),i.host!==nP&&i.host!==a&&rs("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used.");const l={...i,host:a,ssl:s,emulatorOptions:r};if(!Ur(l,o)&&(n._setSettings(l),r.mockUserToken)){let h,f;if(typeof r.mockUserToken=="string")h=r.mockUserToken,f=Rn.MOCK_USER;else{h=Z1(r.mockUserToken,(u=n._app)==null?void 0:u.options.projectId);const g=r.mockUserToken.sub||r.mockUserToken.user_id;if(!g)throw new z(U.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");f=new Rn(g)}n._authCredentials=new L4(new $R(h,f))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ln{constructor(e,t,r){this.converter=t,this._query=r,this.type="query",this.firestore=e}withConverter(e){return new Ln(this.firestore,e,this._query)}}class At{constructor(e,t,r){this.converter=t,this._key=r,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new qs(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new At(this.firestore,e,this._key)}toJSON(){return{type:At._jsonSchemaVersion,referencePath:this._key.toString()}}static fromJSON(e,t,r){if(Ya(t,At._jsonSchema))return new At(e,r||null,new ne(Je.fromString(t.referencePath)))}}At._jsonSchemaVersion="firestore/documentReference/1.0",At._jsonSchema={type:yn("string",At._jsonSchemaVersion),referencePath:yn("string")};class qs extends Ln{constructor(e,t,r){super(e,t,Vc(r)),this._path=r,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const e=this._path.popLast();return e.isEmpty()?null:new At(this.firestore,null,new ne(e))}withConverter(e){return new qs(this.firestore,e,this._path)}}function Hr(n,e,...t){if(n=ae(n),xw("collection","path",e),n instanceof Sh){const r=Je.fromString(e,...t);return NS(r),new qs(n,null,r)}{if(!(n instanceof At||n instanceof qs))throw new z(U.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const r=n._path.child(Je.fromString(e,...t));return NS(r),new qs(n.firestore,null,r)}}function xq(n,e){if(n=et(n,Sh),xw("collectionGroup","collection id",e),e.indexOf("/")>=0)throw new z(U.INVALID_ARGUMENT,`Invalid collection ID '${e}' passed to function collectionGroup(). Collection IDs must not contain '/'.`);return new Ln(n,null,function(r){return new Ai(Je.emptyPath(),r)}(e))}function Qf(n,e,...t){if(n=ae(n),arguments.length===1&&(e=ww.newId()),xw("doc","path",e),n instanceof Sh){const r=Je.fromString(e,...t);return RS(r),new At(n,null,new ne(r))}{if(!(n instanceof At||n instanceof qs))throw new z(U.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const r=n._path.child(Je.fromString(e,...t));return RS(r),new At(n.firestore,n instanceof qs?n.converter:null,new ne(r))}}function Iq(n,e){return n=ae(n),e=ae(e),(n instanceof At||n instanceof qs)&&(e instanceof At||e instanceof qs)&&n.firestore===e.firestore&&n.path===e.path&&n.converter===e.converter}function rP(n,e){return n=ae(n),e=ae(e),n instanceof Ln&&e instanceof Ln&&n.firestore===e.firestore&&_h(n._query,e._query)&&n.converter===e.converter}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const zT="AsyncQueue";class qT{constructor(e=Promise.resolve()){this.Xu=[],this.ec=!1,this.tc=[],this.nc=null,this.rc=!1,this.sc=!1,this.oc=[],this.M_=new Qw(this,"async_queue_retry"),this._c=()=>{const r=Kf();r&&W(zT,"Visibility state changed to "+r.visibilityState),this.M_.w_()},this.ac=e;const t=Kf();t&&typeof t.addEventListener=="function"&&t.addEventListener("visibilitychange",this._c)}get isShuttingDown(){return this.ec}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.uc(),this.cc(e)}enterRestrictedMode(e){if(!this.ec){this.ec=!0,this.sc=e||!1;const t=Kf();t&&typeof t.removeEventListener=="function"&&t.removeEventListener("visibilitychange",this._c)}}enqueue(e){if(this.uc(),this.ec)return new Promise(()=>{});const t=new Pn;return this.cc(()=>this.ec&&this.sc?Promise.resolve():(e().then(t.resolve,t.reject),t.promise)).then(()=>t.promise)}enqueueRetryable(e){this.enqueueAndForget(()=>(this.Xu.push(e),this.lc()))}async lc(){if(this.Xu.length!==0){try{await this.Xu[0](),this.Xu.shift(),this.M_.reset()}catch(e){if(!Uo(e))throw e;W(zT,"Operation failed with retryable error: "+e)}this.Xu.length>0&&this.M_.p_(()=>this.lc())}}cc(e){const t=this.ac.then(()=>(this.rc=!0,e().catch(r=>{throw this.nc=r,this.rc=!1,dn("INTERNAL UNHANDLED ERROR: ",WT(r)),r}).then(r=>(this.rc=!1,r))));return this.ac=t,t}enqueueAfterDelay(e,t,r){this.uc(),this.oc.indexOf(e)>-1&&(t=0);const s=Zw.createAndSchedule(this,e,t,r,i=>this.hc(i));return this.tc.push(s),s}uc(){this.nc&&ue(47125,{Pc:WT(this.nc)})}verifyOperationInProgress(){}async Tc(){let e;do e=this.ac,await e;while(e!==this.ac)}Ic(e){for(const t of this.tc)if(t.timerId===e)return!0;return!1}Ec(e){return this.Tc().then(()=>{this.tc.sort((t,r)=>t.targetTimeMs-r.targetTimeMs);for(const t of this.tc)if(t.skipDelay(),e!=="all"&&t.timerId===e)break;return this.Tc()})}dc(e){this.oc.push(e)}hc(e){const t=this.tc.indexOf(e);this.tc.splice(t,1)}}function WT(n){let e=n.message||"";return n.stack&&(e=n.stack.includes(n.message)?n.stack:n.message+`
`+n.stack),e}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function zl(n){return function(t,r){if(typeof t!="object"||t===null)return!1;const s=t;for(const i of r)if(i in s&&typeof s[i]=="function")return!0;return!1}(n,["next","error","complete"])}class Z6{constructor(){this._progressObserver={},this._taskCompletionResolver=new Pn,this._lastProgress={taskState:"Running",totalBytes:0,totalDocuments:0,bytesLoaded:0,documentsLoaded:0}}onProgress(e,t,r){this._progressObserver={next:e,error:t,complete:r}}catch(e){return this._taskCompletionResolver.promise.catch(e)}then(e,t){return this._taskCompletionResolver.promise.then(e,t)}_completeWith(e){this._updateProgress(e),this._progressObserver.complete&&this._progressObserver.complete(),this._taskCompletionResolver.resolve(e)}_failWith(e){this._lastProgress.taskState="Error",this._progressObserver.next&&this._progressObserver.next(this._lastProgress),this._progressObserver.error&&this._progressObserver.error(e),this._taskCompletionResolver.reject(e)}_updateProgress(e){this._lastProgress=e,this._progressObserver.next&&this._progressObserver.next(e)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Eq=-1;class kt extends Sh{constructor(e,t,r,s){super(e,t,r,s),this.type="firestore",this._queue=new qT,this._persistenceKey=(s==null?void 0:s.name)||"[DEFAULT]"}async _terminate(){if(this._firestoreClient){const e=this._firestoreClient.terminate();this._queue=new qT(e),this._firestoreClient=void 0,await e}}}function Sq(n,e,t){t||(t=Vd);const r=Qs(n,"firestore");if(r.isInitialized(t)){const s=r.getImmediate({identifier:t}),i=r.getOptions(t);if(Ur(i,e))return s;throw new z(U.FAILED_PRECONDITION,"initializeFirestore() has already been called with different options. To avoid this error, call initializeFirestore() with the same options as when it was originally called, or call getFirestore() to return the already initialized instance.")}if(e.cacheSizeBytes!==void 0&&e.localCache!==void 0)throw new z(U.INVALID_ARGUMENT,"cache and cacheSizeBytes cannot be specified at the same time as cacheSizeBytes willbe deprecated. Instead, specify the cache size in the cache object");if(e.cacheSizeBytes!==void 0&&e.cacheSizeBytes!==-1&&e.cacheSizeBytes<fk)throw new z(U.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");return e.host&&bi(e.host)&&Rp(e.host),r.initialize({options:e,instanceIdentifier:t})}function eU(n,e){const t=typeof n=="object"?n:sh(),r=typeof n=="string"?n:e||Vd,s=Qs(t,"firestore").getImmediate({identifier:r});if(!s._initialized){const i=Y1("firestore");i&&X6(s,...i)}return s}function nn(n){if(n._terminated)throw new z(U.FAILED_PRECONDITION,"The client has already been terminated.");return n._firestoreClient||sP(n),n._firestoreClient}function sP(n){var r,s,i;const e=n._freezeSettings(),t=function(a,l,u,h){return new S3(a,l,u,h.host,h.ssl,h.experimentalForceLongPolling,h.experimentalAutoDetectLongPolling,tP(h.experimentalLongPollingOptions),h.useFetchStreams,h.isUsingEmulator)}(n._databaseId,((r=n._app)==null?void 0:r.options.appId)||"",n._persistenceKey,e);n._componentsProvider||(s=e.localCache)!=null&&s._offlineComponentProvider&&((i=e.localCache)!=null&&i._onlineComponentProvider)&&(n._componentsProvider={_offline:e.localCache._offlineComponentProvider,_online:e.localCache._onlineComponentProvider}),n._firestoreClient=new U6(n._authCredentials,n._appCheckCredentials,n._queue,t,n._componentsProvider&&function(a){const l=a==null?void 0:a._online.build();return{_offline:a==null?void 0:a._offline.build(l),_online:l}}(n._componentsProvider))}function Tq(n,e){rs("enableIndexedDbPersistence() will be deprecated in the future, you can use `FirestoreSettings.cache` instead.");const t=n._freezeSettings();return iP(n,Do.provider,{build:r=>new dx(r,t.cacheSizeBytes,e==null?void 0:e.forceOwnership)}),Promise.resolve()}async function bq(n){rs("enableMultiTabIndexedDbPersistence() will be deprecated in the future, you can use `FirestoreSettings.cache` instead.");const e=n._freezeSettings();iP(n,Do.provider,{build:t=>new Kk(t,e.cacheSizeBytes)})}function iP(n,e,t){if((n=et(n,kt))._firestoreClient||n._terminated)throw new z(U.FAILED_PRECONDITION,"Firestore has already been started and persistence can no longer be enabled. You can only enable persistence before calling any other methods on a Firestore object.");if(n._componentsProvider||n._getSettings().localCache)throw new z(U.FAILED_PRECONDITION,"SDK cache is already specified.");n._componentsProvider={_online:e,_offline:t},sP(n)}function Aq(n){if(n._initialized&&!n._terminated)throw new z(U.FAILED_PRECONDITION,"Persistence can only be cleared before a Firestore instance is initialized or after it is terminated.");const e=new Pn;return n._queue.enqueueAndForgetEvenWhileRestricted(async()=>{try{await async function(r){if(!Bs.v())return Promise.resolve();const s=r+vk;await Bs.delete(s)}(Ww(n._databaseId,n._persistenceKey)),e.resolve()}catch(t){e.reject(t)}}),e.promise}function Cq(n){return function(t){const r=new Pn;return t.asyncQueue.enqueueAndForget(async()=>S6(await fx(t),r)),r.promise}(nn(n=et(n,kt)))}function Rq(n){return $6(nn(n=et(n,kt)))}function Nq(n){return B6(nn(n=et(n,kt)))}function kq(n){return tV(n.app,"firestore",n._databaseId.database),n._delete()}function GT(n,e){const t=nn(n=et(n,kt)),r=new Z6;return H6(t,n._databaseId,e,r),r}function tU(n,e){return K6(nn(n=et(n,kt)),e).then(t=>t?new Ln(n,null,t.query):null)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class zd{constructor(e="count",t){this._internalFieldPath=t,this.type="AggregateField",this.aggregateType=e}}class nU{constructor(e,t,r){this._userDataWriter=t,this._data=r,this.type="AggregateQuerySnapshot",this.query=e}data(){return this._userDataWriter.convertObjectMap(this._data)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Dr{constructor(e){this._byteString=e}static fromBase64String(e){try{return new Dr(an.fromBase64String(e))}catch(t){throw new z(U.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+t)}}static fromUint8Array(e){return new Dr(an.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}toJSON(){return{type:Dr._jsonSchemaVersion,bytes:this.toBase64()}}static fromJSON(e){if(Ya(e,Dr._jsonSchema))return Dr.fromBase64String(e.bytes)}}Dr._jsonSchemaVersion="firestore/bytes/1.0",Dr._jsonSchema={type:yn("string",Dr._jsonSchemaVersion),bytes:yn("string")};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Xa{constructor(...e){for(let t=0;t<e.length;++t)if(e[t].length===0)throw new z(U.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new Yt(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}}function Pq(){return new Xa(cv)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Za{constructor(e){this._methodName=e}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ws{constructor(e,t){if(!isFinite(e)||e<-90||e>90)throw new z(U.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(t)||t<-180||t>180)throw new z(U.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+t);this._lat=e,this._long=t}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}_compareTo(e){return Pe(this._lat,e._lat)||Pe(this._long,e._long)}toJSON(){return{latitude:this._lat,longitude:this._long,type:Ws._jsonSchemaVersion}}static fromJSON(e){if(Ya(e,Ws._jsonSchema))return new Ws(e.latitude,e.longitude)}}Ws._jsonSchemaVersion="firestore/geoPoint/1.0",Ws._jsonSchema={type:yn("string",Ws._jsonSchemaVersion),latitude:yn("number"),longitude:yn("number")};/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class _s{constructor(e){this._values=(e||[]).map(t=>t)}toArray(){return this._values.map(e=>e)}isEqual(e){return function(r,s){if(r.length!==s.length)return!1;for(let i=0;i<r.length;++i)if(r[i]!==s[i])return!1;return!0}(this._values,e._values)}toJSON(){return{type:_s._jsonSchemaVersion,vectorValues:this._values}}static fromJSON(e){if(Ya(e,_s._jsonSchema)){if(Array.isArray(e.vectorValues)&&e.vectorValues.every(t=>typeof t=="number"))return new _s(e.vectorValues);throw new z(U.INVALID_ARGUMENT,"Expected 'vectorValues' field to be a number array")}}}_s._jsonSchemaVersion="firestore/vectorValue/1.0",_s._jsonSchema={type:yn("string",_s._jsonSchemaVersion),vectorValues:yn("object")};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const rU=/^__.*__$/;class sU{constructor(e,t,r){this.data=e,this.fieldMask=t,this.fieldTransforms=r}toMutation(e,t){return this.fieldMask!==null?new Ri(e,this.data,this.fieldMask,t,this.fieldTransforms):new Fc(e,this.data,t,this.fieldTransforms)}}class oP{constructor(e,t,r){this.data=e,this.fieldMask=t,this.fieldTransforms=r}toMutation(e,t){return new Ri(e,this.data,this.fieldMask,t,this.fieldTransforms)}}function aP(n){switch(n){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw ue(40011,{Ac:n})}}class mm{constructor(e,t,r,s,i,o){this.settings=e,this.databaseId=t,this.serializer=r,this.ignoreUndefinedProperties=s,i===void 0&&this.Rc(),this.fieldTransforms=i||[],this.fieldMask=o||[]}get path(){return this.settings.path}get Ac(){return this.settings.Ac}Vc(e){return new mm({...this.settings,...e},this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}mc(e){var s;const t=(s=this.path)==null?void 0:s.child(e),r=this.Vc({path:t,fc:!1});return r.gc(e),r}yc(e){var s;const t=(s=this.path)==null?void 0:s.child(e),r=this.Vc({path:t,fc:!1});return r.Rc(),r}wc(e){return this.Vc({path:void 0,fc:!0})}Sc(e){return sp(e,this.settings.methodName,this.settings.bc||!1,this.path,this.settings.Dc)}contains(e){return this.fieldMask.find(t=>e.isPrefixOf(t))!==void 0||this.fieldTransforms.find(t=>e.isPrefixOf(t.field))!==void 0}Rc(){if(this.path)for(let e=0;e<this.path.length;e++)this.gc(this.path.get(e))}gc(e){if(e.length===0)throw this.Sc("Document fields must not be empty");if(aP(this.Ac)&&rU.test(e))throw this.Sc('Document fields cannot begin and end with "__"')}}class iU{constructor(e,t,r){this.databaseId=e,this.ignoreUndefinedProperties=t,this.serializer=r||Ja(e)}Cc(e,t,r,s=!1){return new mm({Ac:e,methodName:t,Dc:r,path:Yt.emptyPath(),fc:!1,bc:s},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}}function el(n){const e=n._freezeSettings(),t=Ja(n._databaseId);return new iU(n._databaseId,!!e.ignoreUndefinedProperties,t)}function ym(n,e,t,r,s,i={}){const o=n.Cc(i.merge||i.mergeFields?2:0,e,t,s);wx("Data must be an object, but it was:",o,r);const a=uP(r,o);let l,u;if(i.merge)l=new yr(o.fieldMask),u=o.fieldTransforms;else if(i.mergeFields){const h=[];for(const f of i.mergeFields){const g=qd(e,f,t);if(!o.contains(g))throw new z(U.INVALID_ARGUMENT,`Field '${g}' is specified in your field mask but missing from your input data.`);hP(h,g)||h.push(g)}l=new yr(h),u=o.fieldTransforms.filter(f=>l.covers(f.field))}else l=null,u=o.fieldTransforms;return new sU(new $n(a),l,u)}class Th extends Za{_toFieldTransform(e){if(e.Ac!==2)throw e.Ac===1?e.Sc(`${this._methodName}() can only appear at the top level of your update data`):e.Sc(`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return e.fieldMask.push(e.path),null}isEqual(e){return e instanceof Th}}function lP(n,e,t){return new mm({Ac:3,Dc:e.settings.Dc,methodName:n._methodName,fc:t},e.databaseId,e.serializer,e.ignoreUndefinedProperties)}class gx extends Za{_toFieldTransform(e){return new wh(e.path,new vc)}isEqual(e){return e instanceof gx}}class px extends Za{constructor(e,t){super(e),this.vc=t}_toFieldTransform(e){const t=lP(this,e,!0),r=this.vc.map(i=>tl(i,t)),s=new Da(r);return new wh(e.path,s)}isEqual(e){return e instanceof px&&Ur(this.vc,e.vc)}}class mx extends Za{constructor(e,t){super(e),this.vc=t}_toFieldTransform(e){const t=lP(this,e,!0),r=this.vc.map(i=>tl(i,t)),s=new Ma(r);return new wh(e.path,s)}isEqual(e){return e instanceof mx&&Ur(this.vc,e.vc)}}class yx extends Za{constructor(e,t){super(e),this.Fc=t}_toFieldTransform(e){const t=new wc(e.serializer,LN(e.serializer,this.Fc));return new wh(e.path,t)}isEqual(e){return e instanceof yx&&this.Fc===e.Fc}}function _x(n,e,t,r){const s=n.Cc(1,e,t);wx("Data must be an object, but it was:",s,r);const i=[],o=$n.empty();$o(r,(l,u)=>{const h=_m(e,l,t);u=ae(u);const f=s.yc(h);if(u instanceof Th)i.push(h);else{const g=tl(u,f);g!=null&&(i.push(h),o.set(h,g))}});const a=new yr(i);return new oP(o,a,s.fieldTransforms)}function vx(n,e,t,r,s,i){const o=n.Cc(1,e,t),a=[qd(e,r,t)],l=[s];if(i.length%2!=0)throw new z(U.INVALID_ARGUMENT,`Function ${e}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let g=0;g<i.length;g+=2)a.push(qd(e,i[g])),l.push(i[g+1]);const u=[],h=$n.empty();for(let g=a.length-1;g>=0;--g)if(!hP(u,a[g])){const y=a[g];let w=l[g];w=ae(w);const C=o.yc(y);if(w instanceof Th)u.push(y);else{const M=tl(w,C);M!=null&&(u.push(y),h.set(y,M))}}const f=new yr(u);return new oP(h,f,o.fieldTransforms)}function cP(n,e,t,r=!1){return tl(t,n.Cc(r?4:3,e))}function tl(n,e){if(dP(n=ae(n)))return wx("Unsupported field value:",e,n),uP(n,e);if(n instanceof Za)return function(r,s){if(!aP(s.Ac))throw s.Sc(`${r._methodName}() can only be used with update() and set()`);if(!s.path)throw s.Sc(`${r._methodName}() is not currently supported inside arrays`);const i=r._toFieldTransform(s);i&&s.fieldTransforms.push(i)}(n,e),null;if(n===void 0&&e.ignoreUndefinedProperties)return null;if(e.path&&e.fieldMask.push(e.path),n instanceof Array){if(e.settings.fc&&e.Ac!==4)throw e.Sc("Nested arrays are not supported");return function(r,s){const i=[];let o=0;for(const a of r){let l=tl(a,s.wc(o));l==null&&(l={nullValue:"NULL_VALUE"}),i.push(l),o++}return{arrayValue:{values:i}}}(n,e)}return function(r,s){if((r=ae(r))===null)return{nullValue:"NULL_VALUE"};if(typeof r=="number")return LN(s.serializer,r);if(typeof r=="boolean")return{booleanValue:r};if(typeof r=="string")return{stringValue:r};if(r instanceof Date){const i=gt.fromDate(r);return{timestampValue:xc(s.serializer,i)}}if(r instanceof gt){const i=new gt(r.seconds,1e3*Math.floor(r.nanoseconds/1e3));return{timestampValue:xc(s.serializer,i)}}if(r instanceof Ws)return{geoPointValue:{latitude:r.latitude,longitude:r.longitude}};if(r instanceof Dr)return{bytesValue:KN(s.serializer,r._byteString)};if(r instanceof At){const i=s.databaseId,o=r.firestore._databaseId;if(!o.isEqual(i))throw s.Sc(`Document reference is for database ${o.projectId}/${o.database} but should be for database ${i.projectId}/${i.database}`);return{referenceValue:jw(r.firestore._databaseId||s.databaseId,r._key.path)}}if(r instanceof _s)return function(o,a){return{mapValue:{fields:{[Cw]:{stringValue:Rw},[mc]:{arrayValue:{values:o.toArray().map(u=>{if(typeof u!="number")throw a.Sc("VectorValues must only contain numeric values.");return Dw(a.serializer,u)})}}}}}}(r,s);throw s.Sc(`Unsupported field value: ${Yp(r)}`)}(n,e)}function uP(n,e){const t={};return lN(n)?e.path&&e.path.length>0&&e.fieldMask.push(e.path):$o(n,(r,s)=>{const i=tl(s,e.mc(r));i!=null&&(t[r]=i)}),{mapValue:{fields:t}}}function dP(n){return!(typeof n!="object"||n===null||n instanceof Array||n instanceof Date||n instanceof gt||n instanceof Ws||n instanceof Dr||n instanceof At||n instanceof Za||n instanceof _s)}function wx(n,e,t){if(!dP(t)||!zR(t)){const r=Yp(t);throw r==="an object"?e.Sc(n+" a custom object"):e.Sc(n+" "+r)}}function qd(n,e,t){if((e=ae(e))instanceof Xa)return e._internalPath;if(typeof e=="string")return _m(n,e);throw sp("Field path arguments must be of type string or ",n,!1,void 0,t)}const oU=new RegExp("[~\\*/\\[\\]]");function _m(n,e,t){if(e.search(oU)>=0)throw sp(`Invalid field path (${e}). Paths must not contain '~', '*', '/', '[', or ']'`,n,!1,void 0,t);try{return new Xa(...e.split("."))._internalPath}catch{throw sp(`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,n,!1,void 0,t)}}function sp(n,e,t,r,s){const i=r&&!r.isEmpty(),o=s!==void 0;let a=`Function ${e}() called with invalid data`;t&&(a+=" (via `toFirestore()`)"),a+=". ";let l="";return(i||o)&&(l+=" (found",i&&(l+=` in field ${r}`),o&&(l+=` in document ${s}`),l+=")"),new z(U.INVALID_ARGUMENT,a+n+l)}function hP(n,e){return n.some(t=>t.isEqual(e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Wd{constructor(e,t,r,s,i){this._firestore=e,this._userDataWriter=t,this._key=r,this._document=s,this._converter=i}get id(){return this._key.path.lastSegment()}get ref(){return new At(this._firestore,this._converter,this._key)}exists(){return this._document!==null}data(){if(this._document){if(this._converter){const e=new aU(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}get(e){if(this._document){const t=this._document.data.field(vm("DocumentSnapshot.get",e));if(t!==null)return this._userDataWriter.convertValue(t)}}}class aU extends Wd{data(){return super.data()}}function vm(n,e){return typeof e=="string"?_m(n,e):e instanceof Xa?e._internalPath:e._delegate._internalPath}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function fP(n){if(n.limitType==="L"&&n.explicitOrderBy.length===0)throw new z(U.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}class xx{}class bh extends xx{}function Pl(n,e,...t){let r=[];e instanceof xx&&r.push(e),r=r.concat(t),function(i){const o=i.filter(l=>l instanceof Wc).length,a=i.filter(l=>l instanceof Ah).length;if(o>1||o>0&&a>0)throw new z(U.INVALID_ARGUMENT,"InvalidQuery. When using composite filters, you cannot use more than one filter at the top level. Consider nesting the multiple filters within an `and(...)` statement. For example: change `query(query, where(...), or(...))` to `query(query, and(where(...), or(...)))`.")}(r);for(const s of r)n=s._apply(n);return n}class Ah extends bh{constructor(e,t,r){super(),this._field=e,this._op=t,this._value=r,this.type="where"}static _create(e,t,r){return new Ah(e,t,r)}_apply(e){const t=this._parse(e);return pP(e._query,t),new Ln(e.firestore,e.converter,wv(e._query,t))}_parse(e){const t=el(e.firestore);return function(i,o,a,l,u,h,f){let g;if(u.isKeyField()){if(h==="array-contains"||h==="array-contains-any")throw new z(U.INVALID_ARGUMENT,`Invalid Query. You can't perform '${h}' queries on documentId().`);if(h==="in"||h==="not-in"){KT(f,h);const w=[];for(const C of f)w.push(HT(l,i,C));g={arrayValue:{values:w}}}else g=HT(l,i,f)}else h!=="in"&&h!=="not-in"&&h!=="array-contains-any"||KT(f,h),g=cP(a,o,f,h==="in"||h==="not-in");return st.create(u,h,g)}(e._query,"where",t,e.firestore._databaseId,this._field,this._op,this._value)}}function Dl(n,e,t){const r=e,s=vm("where",n);return Ah._create(s,r,t)}class Wc extends xx{constructor(e,t){super(),this.type=e,this._queryConstraints=t}static _create(e,t){return new Wc(e,t)}_parse(e){const t=this._queryConstraints.map(r=>r._parse(e)).filter(r=>r.getFilters().length>0);return t.length===1?t[0]:It.create(t,this._getOperator())}_apply(e){const t=this._parse(e);return t.getFilters().length===0?e:(function(s,i){let o=s;const a=i.getFlattenedFilters();for(const l of a)pP(o,l),o=wv(o,l)}(e._query,t),new Ln(e.firestore,e.converter,wv(e._query,t)))}_getQueryConstraints(){return this._queryConstraints}_getOperator(){return this.type==="and"?"and":"or"}}function Dq(...n){return n.forEach(e=>mP("or",e)),Wc._create("or",n)}function Mq(...n){return n.forEach(e=>mP("and",e)),Wc._create("and",n)}class Ix extends bh{constructor(e,t){super(),this._field=e,this._direction=t,this.type="orderBy"}static _create(e,t){return new Ix(e,t)}_apply(e){const t=function(s,i,o){if(s.startAt!==null)throw new z(U.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(s.endAt!==null)throw new z(U.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");return new Ud(i,o)}(e._query,this._field,this._direction);return new Ln(e.firestore,e.converter,function(s,i){const o=s.explicitOrderBy.concat([i]);return new Ai(s.path,s.collectionGroup,o,s.filters.slice(),s.limit,s.limitType,s.startAt,s.endAt)}(e._query,t))}}function lU(n,e="asc"){const t=e,r=vm("orderBy",n);return Ix._create(r,t)}class wm extends bh{constructor(e,t,r){super(),this.type=e,this._limit=t,this._limitType=r}static _create(e,t,r){return new wm(e,t,r)}_apply(e){return new Ln(e.firestore,e.converter,Qg(e._query,this._limit,this._limitType))}}function Lq(n){return qR("limit",n),wm._create("limit",n,"F")}function Oq(n){return qR("limitToLast",n),wm._create("limitToLast",n,"L")}class xm extends bh{constructor(e,t,r){super(),this.type=e,this._docOrFields=t,this._inclusive=r}static _create(e,t,r){return new xm(e,t,r)}_apply(e){const t=gP(e,this.type,this._docOrFields,this._inclusive);return new Ln(e.firestore,e.converter,function(s,i){return new Ai(s.path,s.collectionGroup,s.explicitOrderBy.slice(),s.filters.slice(),s.limit,s.limitType,i,s.endAt)}(e._query,t))}}function Vq(...n){return xm._create("startAt",n,!0)}function Fq(...n){return xm._create("startAfter",n,!1)}class Im extends bh{constructor(e,t,r){super(),this.type=e,this._docOrFields=t,this._inclusive=r}static _create(e,t,r){return new Im(e,t,r)}_apply(e){const t=gP(e,this.type,this._docOrFields,this._inclusive);return new Ln(e.firestore,e.converter,function(s,i){return new Ai(s.path,s.collectionGroup,s.explicitOrderBy.slice(),s.filters.slice(),s.limit,s.limitType,s.startAt,i)}(e._query,t))}}function jq(...n){return Im._create("endBefore",n,!1)}function Uq(...n){return Im._create("endAt",n,!0)}function gP(n,e,t,r){if(t[0]=ae(t[0]),t[0]instanceof Wd)return function(i,o,a,l,u){if(!l)throw new z(U.NOT_FOUND,`Can't use a DocumentSnapshot that doesn't exist for ${a}().`);const h=[];for(const f of Bl(i))if(f.field.isKeyField())h.push(ka(o,l.key));else{const g=l.data.field(f.field);if(tm(g))throw new z(U.INVALID_ARGUMENT,'Invalid query. You are trying to start or end a query using a document for which the field "'+f.field+'" is an uncommitted server timestamp. (Since the value of this field is unknown, you cannot start/end a query with it.)');if(g===null){const y=f.field.canonicalString();throw new z(U.INVALID_ARGUMENT,`Invalid query. You are trying to start or end a query using a document for which the field '${y}' (used as the orderBy) does not exist.`)}h.push(g)}return new ko(h,u)}(n._query,n.firestore._databaseId,e,t[0]._document,r);{const s=el(n.firestore);return function(o,a,l,u,h,f){const g=o.explicitOrderBy;if(h.length>g.length)throw new z(U.INVALID_ARGUMENT,`Too many arguments provided to ${u}(). The number of arguments must be less than or equal to the number of orderBy() clauses`);const y=[];for(let w=0;w<h.length;w++){const C=h[w];if(g[w].field.isKeyField()){if(typeof C!="string")throw new z(U.INVALID_ARGUMENT,`Invalid query. Expected a string for document ID in ${u}(), but got a ${typeof C}`);if(!kw(o)&&C.indexOf("/")!==-1)throw new z(U.INVALID_ARGUMENT,`Invalid query. When querying a collection and ordering by documentId(), the value passed to ${u}() must be a plain document ID, but '${C}' contains a slash.`);const M=o.path.child(Je.fromString(C));if(!ne.isDocumentKey(M))throw new z(U.INVALID_ARGUMENT,`Invalid query. When querying a collection group and ordering by documentId(), the value passed to ${u}() must result in a valid document path, but '${M}' is not because it contains an odd number of segments.`);const A=new ne(M);y.push(ka(a,A))}else{const M=cP(l,u,C);y.push(M)}}return new ko(y,f)}(n._query,n.firestore._databaseId,s,e,t,r)}}function HT(n,e,t){if(typeof(t=ae(t))=="string"){if(t==="")throw new z(U.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!kw(e)&&t.indexOf("/")!==-1)throw new z(U.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${t}' contains a '/' character.`);const r=e.path.child(Je.fromString(t));if(!ne.isDocumentKey(r))throw new z(U.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${r}' is not because it has an odd number of segments (${r.length}).`);return ka(n,new ne(r))}if(t instanceof At)return ka(n,t._key);throw new z(U.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${Yp(t)}.`)}function KT(n,e){if(!Array.isArray(n)||n.length===0)throw new z(U.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${e.toString()}' filters.`)}function pP(n,e){const t=function(s,i){for(const o of s)for(const a of o.getFlattenedFilters())if(i.indexOf(a.op)>=0)return a.op;return null}(n.filters,function(s){switch(s){case"!=":return["!=","not-in"];case"array-contains-any":case"in":return["not-in"];case"not-in":return["array-contains-any","in","not-in","!="];default:return[]}}(e.op));if(t!==null)throw t===e.op?new z(U.INVALID_ARGUMENT,`Invalid query. You cannot use more than one '${e.op.toString()}' filter.`):new z(U.INVALID_ARGUMENT,`Invalid query. You cannot use '${e.op.toString()}' filters with '${t.toString()}' filters.`)}function mP(n,e){if(!(e instanceof Ah||e instanceof Wc))throw new z(U.INVALID_ARGUMENT,`Function ${n}() requires AppliableConstraints created with a call to 'where(...)', 'or(...)', or 'and(...)'.`)}class yP{convertValue(e,t="none"){switch(Ro(e)){case 0:return null;case 1:return e.booleanValue;case 2:return Gt(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,t);case 5:return e.stringValue;case 6:return this.convertBytes(xi(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,t);case 11:return this.convertObject(e.mapValue,t);case 10:return this.convertVectorValue(e.mapValue);default:throw ue(62114,{value:e})}}convertObject(e,t){return this.convertObjectMap(e.fields,t)}convertObjectMap(e,t="none"){const r={};return $o(e,(s,i)=>{r[s]=this.convertValue(i,t)}),r}convertVectorValue(e){var r,s,i;const t=(i=(s=(r=e.fields)==null?void 0:r[mc].arrayValue)==null?void 0:s.values)==null?void 0:i.map(o=>Gt(o.doubleValue));return new _s(t)}convertGeoPoint(e){return new Ws(Gt(e.latitude),Gt(e.longitude))}convertArray(e,t){return(e.values||[]).map(r=>this.convertValue(r,t))}convertServerTimestamp(e,t){switch(t){case"previous":const r=nm(e);return r==null?null:this.convertValue(r,t);case"estimate":return this.convertTimestamp(Od(e));default:return null}}convertTimestamp(e){const t=wi(e);return new gt(t.seconds,t.nanos)}convertDocumentKey(e,t){const r=Je.fromString(e);ye(sk(r),9688,{name:e});const s=new Na(r.get(1),r.get(3)),i=new ne(r.popFirst(5));return s.isEqual(t)||dn(`Document ${i} contains a document reference within a different database (${s.projectId}/${s.database}) which is not supported. It will be treated as a reference in the current database (${t.projectId}/${t.database}) instead.`),i}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Em(n,e,t){let r;return r=n?t&&(t.merge||t.mergeFields)?n.toFirestore(e,t):n.toFirestore(e):e,r}class Ex extends yP{constructor(e){super(),this.firestore=e}convertBytes(e){return new Dr(e)}convertReference(e){const t=this.convertDocumentKey(e,this.firestore._databaseId);return new At(this.firestore,null,t)}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function $q(n){return new zd("sum",qd("sum",n))}function Bq(n){return new zd("avg",qd("average",n))}function cU(){return new zd("count")}function zq(n,e){var t,r;return n instanceof zd&&e instanceof zd&&n.aggregateType===e.aggregateType&&((t=n._internalFieldPath)==null?void 0:t.canonicalString())===((r=e._internalFieldPath)==null?void 0:r.canonicalString())}function qq(n,e){return rP(n.query,e.query)&&Ur(n.data(),e.data())}/**
 * @license
 * Copyright 2025 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const _P="NOT SUPPORTED";class no{constructor(e,t){this.hasPendingWrites=e,this.fromCache=t}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}}class Or extends Wd{constructor(e,t,r,s,i,o){super(e,t,r,s,o),this._firestore=e,this._firestoreImpl=e,this.metadata=i}exists(){return super.exists()}data(e={}){if(this._document){if(this._converter){const t=new Yf(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(t,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}get(e,t={}){if(this._document){const r=this._document.data.field(vm("DocumentSnapshot.get",e));if(r!==null)return this._userDataWriter.convertValue(r,t.serverTimestamps)}}toJSON(){if(this.metadata.hasPendingWrites)throw new z(U.FAILED_PRECONDITION,"DocumentSnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");const e=this._document,t={};return t.type=Or._jsonSchemaVersion,t.bundle="",t.bundleSource="DocumentSnapshot",t.bundleName=this._key.toString(),!e||!e.isValidDocument()||!e.isFoundDocument()?t:(this._userDataWriter.convertObjectMap(e.data.value.mapValue.fields,"previous"),t.bundle=(this._firestore,this.ref.path,"NOT SUPPORTED"),t)}}function Wq(n,e,t){if(Ya(e,Or._jsonSchema)){if(e.bundle===_P)throw new z(U.INVALID_ARGUMENT,"The provided JSON object was created in a client environment, which is not supported.");const r=Ja(n._databaseId),s=eP(e.bundle,r),i=s.Wu(),o=new sx(s.getMetadata(),r);for(const h of i)o.Ga(h);const a=o.documents;if(a.length!==1)throw new z(U.INVALID_ARGUMENT,`Expected bundle data to contain 1 document, but it contains ${a.length} documents.`);const l=om(r,a[0].document),u=new ne(Je.fromString(e.bundleName));return new Or(n,new Ex(n),u,l,new no(!1,!1),t||null)}}Or._jsonSchemaVersion="firestore/documentSnapshot/1.0",Or._jsonSchema={type:yn("string",Or._jsonSchemaVersion),bundleSource:yn("string","DocumentSnapshot"),bundleName:yn("string"),bundle:yn("string")};class Yf extends Or{data(e={}){return super.data(e)}}class Vr{constructor(e,t,r,s){this._firestore=e,this._userDataWriter=t,this._snapshot=s,this.metadata=new no(s.hasPendingWrites,s.fromCache),this.query=r}get docs(){const e=[];return this.forEach(t=>e.push(t)),e}get size(){return this._snapshot.docs.size}get empty(){return this.size===0}forEach(e,t){this._snapshot.docs.forEach(r=>{e.call(t,new Yf(this._firestore,this._userDataWriter,r.key,r,new no(this._snapshot.mutatedKeys.has(r.key),this._snapshot.fromCache),this.query.converter))})}docChanges(e={}){const t=!!e.includeMetadataChanges;if(t&&this._snapshot.excludesMetadataChanges)throw new z(U.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===t||(this._cachedChanges=function(s,i){if(s._snapshot.oldDocs.isEmpty()){let o=0;return s._snapshot.docChanges.map(a=>{const l=new Yf(s._firestore,s._userDataWriter,a.doc.key,a.doc,new no(s._snapshot.mutatedKeys.has(a.doc.key),s._snapshot.fromCache),s.query.converter);return a.doc,{type:"added",doc:l,oldIndex:-1,newIndex:o++}})}{let o=s._snapshot.oldDocs;return s._snapshot.docChanges.filter(a=>i||a.type!==3).map(a=>{const l=new Yf(s._firestore,s._userDataWriter,a.doc.key,a.doc,new no(s._snapshot.mutatedKeys.has(a.doc.key),s._snapshot.fromCache),s.query.converter);let u=-1,h=-1;return a.type!==0&&(u=o.indexOf(a.doc.key),o=o.delete(a.doc.key)),a.type!==1&&(o=o.add(a.doc),h=o.indexOf(a.doc.key)),{type:uU(a.type),doc:l,oldIndex:u,newIndex:h}})}}(this,t),this._cachedChangesIncludeMetadataChanges=t),this._cachedChanges}toJSON(){if(this.metadata.hasPendingWrites)throw new z(U.FAILED_PRECONDITION,"QuerySnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");const e={};e.type=Vr._jsonSchemaVersion,e.bundleSource="QuerySnapshot",e.bundleName=ww.newId(),this._firestore._databaseId.database,this._firestore._databaseId.projectId;const t=[],r=[],s=[];return this.docs.forEach(i=>{i._document!==null&&(t.push(i._document),r.push(this._userDataWriter.convertObjectMap(i._document.data.value.mapValue.fields,"previous")),s.push(i.ref.path))}),e.bundle=(this._firestore,this.query._query,e.bundleName,"NOT SUPPORTED"),e}}function Gq(n,e,t){if(Ya(e,Vr._jsonSchema)){if(e.bundle===_P)throw new z(U.INVALID_ARGUMENT,"The provided JSON object was created in a client environment, which is not supported.");const r=Ja(n._databaseId),s=eP(e.bundle,r),i=s.Wu(),o=new sx(s.getMetadata(),r);for(const g of i)o.Ga(g);if(o.queries.length!==1)throw new z(U.INVALID_ARGUMENT,`Snapshot data expected 1 query but found ${o.queries.length} queries.`);const a=lm(o.queries[0].bundledQuery),l=o.documents;let u=new _a;l.map(g=>{const y=om(r,g.document);u=u.add(y)});const h=ja.fromInitialDocuments(a,u,je(),!1,!1),f=new Ln(n,t||null,a);return new Vr(n,new Ex(n),f,h)}}function uU(n){switch(n){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return ue(61501,{type:n})}}function Hq(n,e){return n instanceof Or&&e instanceof Or?n._firestore===e._firestore&&n._key.isEqual(e._key)&&(n._document===null?e._document===null:n._document.isEqual(e._document))&&n._converter===e._converter:n instanceof Vr&&e instanceof Vr&&n._firestore===e._firestore&&rP(n.query,e.query)&&n.metadata.isEqual(e.metadata)&&n._snapshot.isEqual(e._snapshot)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function dU(n){n=et(n,At);const e=et(n.firestore,kt);return Xk(nn(e),n._key).then(t=>Sx(e,n,t))}Vr._jsonSchemaVersion="firestore/querySnapshot/1.0",Vr._jsonSchema={type:yn("string",Vr._jsonSchemaVersion),bundleSource:yn("string","QuerySnapshot"),bundleName:yn("string"),bundle:yn("string")};class qo extends yP{constructor(e){super(),this.firestore=e}convertBytes(e){return new Dr(e)}convertReference(e){const t=this.convertDocumentKey(e,this.firestore._databaseId);return new At(this.firestore,null,t)}}function Kq(n){n=et(n,At);const e=et(n.firestore,kt),t=nn(e),r=new qo(e);return z6(t,n._key).then(s=>new Or(e,r,n._key,s,new no(s!==null&&s.hasLocalMutations,!0),n.converter))}function Qq(n){n=et(n,At);const e=et(n.firestore,kt);return Xk(nn(e),n._key,{source:"server"}).then(t=>Sx(e,n,t))}function ed(n){n=et(n,Ln);const e=et(n.firestore,kt),t=nn(e),r=new qo(e);return fP(n._query),Zk(t,n._query).then(s=>new Vr(e,r,n,s))}function Yq(n){n=et(n,Ln);const e=et(n.firestore,kt),t=nn(e),r=new qo(e);return q6(t,n._query).then(s=>new Vr(e,r,n,s))}function Jq(n){n=et(n,Ln);const e=et(n.firestore,kt),t=nn(e),r=new qo(e);return Zk(t,n._query,{source:"server"}).then(s=>new Vr(e,r,n,s))}function hU(n,e,t){n=et(n,At);const r=et(n.firestore,kt),s=Em(n.converter,e,t);return Ch(r,[ym(el(r),"setDoc",n._key,s,n.converter!==null,t).toMutation(n._key,Jt.none())])}function Xq(n,e,t,...r){n=et(n,At);const s=et(n.firestore,kt),i=el(s);let o;return o=typeof(e=ae(e))=="string"||e instanceof Xa?vx(i,"updateDoc",n._key,e,t,r):_x(i,"updateDoc",n._key,e),Ch(s,[o.toMutation(n._key,Jt.exists(!0))])}function fU(n){return Ch(et(n.firestore,kt),[new jc(n._key,Jt.none())])}function ti(n,e){const t=et(n.firestore,kt),r=Qf(n),s=Em(n.converter,e);return Ch(t,[ym(el(n.firestore),"addDoc",r._key,s,n.converter!==null,{}).toMutation(r._key,Jt.exists(!1))]).then(()=>r)}function QT(n,...e){var l,u,h;n=ae(n);let t={includeMetadataChanges:!1,source:"default"},r=0;typeof e[r]!="object"||zl(e[r])||(t=e[r++]);const s={includeMetadataChanges:t.includeMetadataChanges,source:t.source};if(zl(e[r])){const f=e[r];e[r]=(l=f.next)==null?void 0:l.bind(f),e[r+1]=(u=f.error)==null?void 0:u.bind(f),e[r+2]=(h=f.complete)==null?void 0:h.bind(f)}let i,o,a;if(n instanceof At)o=et(n.firestore,kt),a=Vc(n._key.path),i={next:f=>{e[r]&&e[r](Sx(o,n,f))},error:e[r+1],complete:e[r+2]};else{const f=et(n,Ln);o=et(f.firestore,kt),a=f._query;const g=new qo(o);i={next:y=>{e[r]&&e[r](new Vr(o,g,f,y))},error:e[r+1],complete:e[r+2]},fP(n._query)}return function(g,y,w,C){const M=new gm(C),A=new rx(y,M,w);return g.asyncQueue.enqueueAndForget(async()=>ex(await Ac(g),A)),()=>{M.Nu(),g.asyncQueue.enqueueAndForget(async()=>tx(await Ac(g),A))}}(nn(o),a,s,i)}function Zq(n,e,...t){const r=ae(n),s=function(l){const u={bundle:"",bundleName:"",bundleSource:""},h=["bundle","bundleName","bundleSource"];for(const f of h){if(!(f in l)){u.error=`snapshotJson missing required field: ${f}`;break}const g=l[f];if(typeof g!="string"){u.error=`snapshotJson field '${f}' must be a string.`;break}if(g.length===0){u.error=`snapshotJson field '${f}' cannot be an empty string.`;break}f==="bundle"?u.bundle=g:f==="bundleName"?u.bundleName=g:f==="bundleSource"&&(u.bundleSource=g)}return u}(e);if(s.error)throw new z(U.INVALID_ARGUMENT,s.error);let i,o=0;if(typeof t[o]!="object"||zl(t[o])||(i=t[o++]),s.bundleSource==="QuerySnapshot"){let a=null;if(typeof t[o]=="object"&&zl(t[o])){const l=t[o++];a={next:l.next,error:l.error,complete:l.complete}}else a={next:t[o++],error:t[o++],complete:t[o++]};return function(u,h,f,g,y){let w,C=!1;return GT(u,h.bundle).then(()=>tU(u,h.bundleName)).then(A=>{A&&!C&&(y&&A.withConverter(y),w=QT(A,f||{},g))}).catch(A=>(g.error&&g.error(A),()=>{})),()=>{C||(C=!0,w&&w())}}(r,s,i,a,t[o])}if(s.bundleSource==="DocumentSnapshot"){let a=null;if(typeof t[o]=="object"&&zl(t[o])){const l=t[o++];a={next:l.next,error:l.error,complete:l.complete}}else a={next:t[o++],error:t[o++],complete:t[o++]};return function(u,h,f,g,y){let w,C=!1;return GT(u,h.bundle).then(()=>{if(!C){const A=new At(u,y||null,ne.fromPath(h.bundleName));w=QT(A,f||{},g)}}).catch(A=>(g.error&&g.error(A),()=>{})),()=>{C||(C=!0,w&&w())}}(r,s,i,a,t[o])}throw new z(U.INVALID_ARGUMENT,`unsupported bundle source: ${s.bundleSource}`)}function e7(n,e){return G6(nn(n=et(n,kt)),zl(e)?e:{next:e})}function Ch(n,e){return function(r,s){const i=new Pn;return r.asyncQueue.enqueueAndForget(async()=>w6(await fx(r),s,i)),i.promise}(nn(n),e)}function Sx(n,e,t){const r=t.docs.get(e._key),s=new qo(n);return new Or(n,s,e._key,r,new no(t.hasPendingWrites,t.fromCache),e.converter)}function t7(n){return gU(n,{count:cU()})}function gU(n,e){const t=et(n.firestore,kt),r=nn(t),s=aN(e,(i,o)=>new BN(o,i.aggregateType,i._internalFieldPath));return W6(r,n._query,s).then(i=>function(a,l,u){const h=new qo(a);return new nU(l,h,u)}(t,n,i))}class pU{constructor(e){this.kind="memory",this._onlineComponentProvider=Do.provider,this._offlineComponentProvider=e!=null&&e.garbageCollector?e.garbageCollector._offlineComponentProvider:{build:()=>new ux(void 0)}}toJSON(){return{kind:this.kind}}}class mU{constructor(e){let t;this.kind="persistent",e!=null&&e.tabManager?(e.tabManager._initialize(e),t=e.tabManager):(t=xU(void 0),t._initialize(e)),this._onlineComponentProvider=t._onlineComponentProvider,this._offlineComponentProvider=t._offlineComponentProvider}toJSON(){return{kind:this.kind}}}class yU{constructor(){this.kind="memoryEager",this._offlineComponentProvider=bc.provider}toJSON(){return{kind:this.kind}}}class _U{constructor(e){this.kind="memoryLru",this._offlineComponentProvider={build:()=>new ux(e)}}toJSON(){return{kind:this.kind}}}function n7(){return new yU}function r7(n){return new _U(n==null?void 0:n.cacheSizeBytes)}function s7(n){return new pU(n)}function i7(n){return new mU(n)}class vU{constructor(e){this.forceOwnership=e,this.kind="persistentSingleTab"}toJSON(){return{kind:this.kind}}_initialize(e){this._onlineComponentProvider=Do.provider,this._offlineComponentProvider={build:t=>new dx(t,e==null?void 0:e.cacheSizeBytes,this.forceOwnership)}}}class wU{constructor(){this.kind="PersistentMultipleTab"}toJSON(){return{kind:this.kind}}_initialize(e){this._onlineComponentProvider=Do.provider,this._offlineComponentProvider={build:t=>new Kk(t,e==null?void 0:e.cacheSizeBytes)}}}function xU(n){return new vU(n==null?void 0:n.forceOwnership)}function o7(){return new wU}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const IU={maxAttempts:5};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class EU{constructor(e,t){this._firestore=e,this._commitHandler=t,this._mutations=[],this._committed=!1,this._dataReader=el(e)}set(e,t,r){this._verifyNotCommitted();const s=ro(e,this._firestore),i=Em(s.converter,t,r),o=ym(this._dataReader,"WriteBatch.set",s._key,i,s.converter!==null,r);return this._mutations.push(o.toMutation(s._key,Jt.none())),this}update(e,t,r,...s){this._verifyNotCommitted();const i=ro(e,this._firestore);let o;return o=typeof(t=ae(t))=="string"||t instanceof Xa?vx(this._dataReader,"WriteBatch.update",i._key,t,r,s):_x(this._dataReader,"WriteBatch.update",i._key,t),this._mutations.push(o.toMutation(i._key,Jt.exists(!0))),this}delete(e){this._verifyNotCommitted();const t=ro(e,this._firestore);return this._mutations=this._mutations.concat(new jc(t._key,Jt.none())),this}commit(){return this._verifyNotCommitted(),this._committed=!0,this._mutations.length>0?this._commitHandler(this._mutations):Promise.resolve()}_verifyNotCommitted(){if(this._committed)throw new z(U.FAILED_PRECONDITION,"A write batch can no longer be used after commit() has been called.")}}function ro(n,e){if((n=ae(n)).firestore!==e)throw new z(U.INVALID_ARGUMENT,"Provided document reference is from a different Firestore instance.");return n}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class SU{constructor(e,t){this._firestore=e,this._transaction=t,this._dataReader=el(e)}get(e){const t=ro(e,this._firestore),r=new Ex(this._firestore);return this._transaction.lookup([t._key]).then(s=>{if(!s||s.length!==1)return ue(24041);const i=s[0];if(i.isFoundDocument())return new Wd(this._firestore,r,i.key,i,t.converter);if(i.isNoDocument())return new Wd(this._firestore,r,t._key,null,t.converter);throw ue(18433,{doc:i})})}set(e,t,r){const s=ro(e,this._firestore),i=Em(s.converter,t,r),o=ym(this._dataReader,"Transaction.set",s._key,i,s.converter!==null,r);return this._transaction.set(s._key,o),this}update(e,t,r,...s){const i=ro(e,this._firestore);let o;return o=typeof(t=ae(t))=="string"||t instanceof Xa?vx(this._dataReader,"Transaction.update",i._key,t,r,s):_x(this._dataReader,"Transaction.update",i._key,t),this._transaction.update(i._key,o),this}delete(e){const t=ro(e,this._firestore);return this._transaction.delete(t._key),this}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class TU extends SU{constructor(e,t){super(e,t),this._firestore=e}get(e){const t=ro(e,this._firestore),r=new qo(this._firestore);return super.get(e).then(s=>new Or(this._firestore,r,t._key,s._document,new no(!1,!1),t.converter))}}function a7(n,e,t){n=et(n,kt);const r={...IU,...t};return function(i){if(i.maxAttempts<1)throw new z(U.INVALID_ARGUMENT,"Max attempts must be at least 1")}(r),function(i,o,a){const l=new Pn;return i.asyncQueue.enqueueAndForget(async()=>{const u=await Jk(i);new j6(i.asyncQueue,u,a,o,l).ju()}),l.promise}(nn(n),s=>e(new TU(n,s)),r)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function l7(){return new Th("deleteField")}function cs(){return new gx("serverTimestamp")}function c7(...n){return new px("arrayUnion",n)}function u7(...n){return new mx("arrayRemove",n)}function d7(n){return new yx("increment",n)}function h7(n){return new _s(n)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function f7(n){return nn(n=et(n,kt)),new EU(n,e=>Ch(n,e))}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function g7(n,e){const t=nn(n=et(n,kt));if(!t._uninitializedComponentsProvider||t._uninitializedComponentsProvider._offline.kind==="memory")return rs("Cannot enable indexes when persistence is disabled"),Promise.resolve();const r=function(i){const o=typeof i=="string"?function(u){try{return JSON.parse(u)}catch(h){throw new z(U.INVALID_ARGUMENT,"Failed to parse JSON: "+(h==null?void 0:h.message))}}(i):i,a=[];if(Array.isArray(o.indexes))for(const l of o.indexes){const u=YT(l,"collectionGroup"),h=[];if(Array.isArray(l.fields))for(const f of l.fields){const g=_m("setIndexConfiguration",YT(f,"fieldPath"));f.arrayConfig==="CONTAINS"?h.push(new ma(g,2)):f.order==="ASCENDING"?h.push(new ma(g,0)):f.order==="DESCENDING"&&h.push(new ma(g,1))}a.push(new uc(uc.UNKNOWN_ID,u,h,dc.empty()))}return a}(e);return Q6(t,r)}function YT(n,e){if(typeof n[e]!="string")throw new z(U.INVALID_ARGUMENT,"Missing string value for: "+e);return n[e]}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class bU{constructor(e){this._firestore=e,this.type="PersistentCacheIndexManager"}}function p7(n){var s;n=et(n,kt);const e=JT.get(n);if(e)return e;if(((s=nn(n)._uninitializedComponentsProvider)==null?void 0:s._offline.kind)!=="persistent")return null;const r=new bU(n);return JT.set(n,r),r}function m7(n){vP(n,!0)}function y7(n){vP(n,!1)}function _7(n){J6(nn(n._firestore)).then(e=>W("deleting all persistent cache indexes succeeded")).catch(e=>rs("deleting all persistent cache indexes failed",e))}function vP(n,e){Y6(nn(n._firestore),e).then(t=>W(`setting persistent cache index auto creation isEnabled=${e} succeeded`)).catch(t=>rs(`setting persistent cache index auto creation isEnabled=${e} failed`,t))}const JT=new WeakMap;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function v7(n){var r;const e=nn(et(n.firestore,kt)),t=(r=e._onlineComponents)==null?void 0:r.datastore.serializer;return t===void 0?null:am(t,nr(n._query)).ft}function w7(n,e){var i;const t=aN(e,(o,a)=>new BN(a,o.aggregateType,o._internalFieldPath)),r=nn(et(n.firestore,kt)),s=(i=r._onlineComponents)==null?void 0:i.datastore.serializer;return s===void 0?null:ek(s,bN(n._query),t,!0).request}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class x7{constructor(){throw new Error("instances of this class should not be created")}static onExistenceFilterMismatch(e){return Tx.instance.onExistenceFilterMismatch(e)}}class Tx{constructor(){this.Mc=new Map}static get instance(){return vf||(vf=new Tx,function(t){if(Xu)throw new Error("a TestingHooksSpi instance is already set");Xu=t}(vf)),vf}lt(e){this.Mc.forEach(t=>t(e))}onExistenceFilterMismatch(e){const t=Symbol(),r=this.Mc;return r.set(t,e),()=>r.delete(t)}}let vf=null;(function(e,t=!0){(function(s){Oc=s})(Ga),ws(new Sr("firestore",(r,{instanceIdentifier:s,options:i})=>{const o=r.getProvider("app").getImmediate(),a=new kt(new O4(r.getProvider("auth-internal")),new j4(o,r.getProvider("app-check-internal")),function(u,h){if(!Object.prototype.hasOwnProperty.apply(u.options,["projectId"]))throw new z(U.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new Na(u.options.projectId,h)}(o,s),o);return i={useFetchStreams:t,...i},a._setSettings(i),a},"PUBLIC").setMultipleInstances(!0)),Ir(AS,CS,e),Ir(AS,CS,"esm2020")})();/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const I7={PHONE:"phone",TOTP:"totp"},E7={FACEBOOK:"facebook.com",GITHUB:"github.com",GOOGLE:"google.com",PASSWORD:"password",PHONE:"phone",TWITTER:"twitter.com"},S7={EMAIL_LINK:"emailLink",EMAIL_PASSWORD:"password",FACEBOOK:"facebook.com",GITHUB:"github.com",GOOGLE:"google.com",PHONE:"phone",TWITTER:"twitter.com"},T7={LINK:"link",REAUTHENTICATE:"reauthenticate",SIGN_IN:"signIn"},b7={EMAIL_SIGNIN:"EMAIL_SIGNIN",PASSWORD_RESET:"PASSWORD_RESET",RECOVER_EMAIL:"RECOVER_EMAIL",REVERT_SECOND_FACTOR_ADDITION:"REVERT_SECOND_FACTOR_ADDITION",VERIFY_AND_CHANGE_EMAIL:"VERIFY_AND_CHANGE_EMAIL",VERIFY_EMAIL:"VERIFY_EMAIL"};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function AU(){return{"admin-restricted-operation":"This operation is restricted to administrators only.","argument-error":"","app-not-authorized":"This app, identified by the domain where it's hosted, is not authorized to use Firebase Authentication with the provided API key. Review your key configuration in the Google API console.","app-not-installed":"The requested mobile application corresponding to the identifier (Android package name or iOS bundle ID) provided is not installed on this device.","captcha-check-failed":"The reCAPTCHA response token provided is either invalid, expired, already used or the domain associated with it does not match the list of whitelisted domains.","code-expired":"The SMS code has expired. Please re-send the verification code to try again.","cordova-not-ready":"Cordova framework is not ready.","cors-unsupported":"This browser is not supported.","credential-already-in-use":"This credential is already associated with a different user account.","custom-token-mismatch":"The custom token corresponds to a different audience.","requires-recent-login":"This operation is sensitive and requires recent authentication. Log in again before retrying this request.","dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK.","dynamic-link-not-activated":"Please activate Dynamic Links in the Firebase Console and agree to the terms and conditions.","email-change-needs-verification":"Multi-factor users must always have a verified email.","email-already-in-use":"The email address is already in use by another account.","emulator-config-failed":'Auth instance has already been used to make a network call. Auth can no longer be configured to use the emulator. Try calling "connectAuthEmulator()" sooner.',"expired-action-code":"The action code has expired.","cancelled-popup-request":"This operation has been cancelled due to another conflicting popup being opened.","internal-error":"An internal AuthError has occurred.","invalid-app-credential":"The phone verification request contains an invalid application verifier. The reCAPTCHA token response is either invalid or expired.","invalid-app-id":"The mobile app identifier is not registered for the current project.","invalid-user-token":"This user's credential isn't valid for this project. This can happen if the user's token has been tampered with, or if the user isn't for the project associated with this API key.","invalid-auth-event":"An internal AuthError has occurred.","invalid-verification-code":"The SMS verification code used to create the phone auth credential is invalid. Please resend the verification code sms and be sure to use the verification code provided by the user.","invalid-continue-uri":"The continue URL provided in the request is invalid.","invalid-cordova-configuration":"The following Cordova plugins must be installed to enable OAuth sign-in: cordova-plugin-buildinfo, cordova-universal-links-plugin, cordova-plugin-browsertab, cordova-plugin-inappbrowser and cordova-plugin-customurlscheme.","invalid-custom-token":"The custom token format is incorrect. Please check the documentation.","invalid-dynamic-link-domain":"The provided dynamic link domain is not configured or authorized for the current project.","invalid-email":"The email address is badly formatted.","invalid-emulator-scheme":"Emulator URL must start with a valid scheme (http:// or https://).","invalid-api-key":"Your API key is invalid, please check you have copied it correctly.","invalid-cert-hash":"The SHA-1 certificate hash provided is invalid.","invalid-credential":"The supplied auth credential is incorrect, malformed or has expired.","invalid-message-payload":"The email template corresponding to this action contains invalid characters in its message. Please fix by going to the Auth email templates section in the Firebase Console.","invalid-multi-factor-session":"The request does not contain a valid proof of first factor successful sign-in.","invalid-oauth-provider":"EmailAuthProvider is not supported for this operation. This operation only supports OAuth providers.","invalid-oauth-client-id":"The OAuth client ID provided is either invalid or does not match the specified API key.","unauthorized-domain":"This domain is not authorized for OAuth operations for your Firebase project. Edit the list of authorized domains from the Firebase console.","invalid-action-code":"The action code is invalid. This can happen if the code is malformed, expired, or has already been used.","wrong-password":"The password is invalid or the user does not have a password.","invalid-persistence-type":"The specified persistence type is invalid. It can only be local, session or none.","invalid-phone-number":"The format of the phone number provided is incorrect. Please enter the phone number in a format that can be parsed into E.164 format. E.164 phone numbers are written in the format [+][country code][subscriber number including area code].","invalid-provider-id":"The specified provider ID is invalid.","invalid-recipient-email":"The email corresponding to this action failed to send as the provided recipient email address is invalid.","invalid-sender":"The email template corresponding to this action contains an invalid sender email or name. Please fix by going to the Auth email templates section in the Firebase Console.","invalid-verification-id":"The verification ID used to create the phone auth credential is invalid.","invalid-tenant-id":"The Auth instance's tenant ID is invalid.","login-blocked":"Login blocked by user-provided method: {$originalMessage}","missing-android-pkg-name":"An Android Package Name must be provided if the Android App is required to be installed.","auth-domain-config-required":"Be sure to include authDomain when calling firebase.initializeApp(), by following the instructions in the Firebase console.","missing-app-credential":"The phone verification request is missing an application verifier assertion. A reCAPTCHA response token needs to be provided.","missing-verification-code":"The phone auth credential was created with an empty SMS verification code.","missing-continue-uri":"A continue URL must be provided in the request.","missing-iframe-start":"An internal AuthError has occurred.","missing-ios-bundle-id":"An iOS Bundle ID must be provided if an App Store ID is provided.","missing-or-invalid-nonce":"The request does not contain a valid nonce. This can occur if the SHA-256 hash of the provided raw nonce does not match the hashed nonce in the ID token payload.","missing-password":"A non-empty password must be provided","missing-multi-factor-info":"No second factor identifier is provided.","missing-multi-factor-session":"The request is missing proof of first factor successful sign-in.","missing-phone-number":"To send verification codes, provide a phone number for the recipient.","missing-verification-id":"The phone auth credential was created with an empty verification ID.","app-deleted":"This instance of FirebaseApp has been deleted.","multi-factor-info-not-found":"The user does not have a second factor matching the identifier provided.","multi-factor-auth-required":"Proof of ownership of a second factor is required to complete sign-in.","account-exists-with-different-credential":"An account already exists with the same email address but different sign-in credentials. Sign in using a provider associated with this email address.","network-request-failed":"A network AuthError (such as timeout, interrupted connection or unreachable host) has occurred.","no-auth-event":"An internal AuthError has occurred.","no-such-provider":"User was not linked to an account with the given provider.","null-user":"A null user object was provided as the argument for an operation which requires a non-null user object.","operation-not-allowed":"The given sign-in provider is disabled for this Firebase project. Enable it in the Firebase console, under the sign-in method tab of the Auth section.","operation-not-supported-in-this-environment":'This operation is not supported in the environment this application is running on. "location.protocol" must be http, https or chrome-extension and web storage must be enabled.',"popup-blocked":"Unable to establish a connection with the popup. It may have been blocked by the browser.","popup-closed-by-user":"The popup has been closed by the user before finalizing the operation.","provider-already-linked":"User can only be linked to one identity for the given provider.","quota-exceeded":"The project's quota for this operation has been exceeded.","redirect-cancelled-by-user":"The redirect operation has been cancelled by the user before finalizing.","redirect-operation-pending":"A redirect sign-in operation is already pending.","rejected-credential":"The request contains malformed or mismatching credentials.","second-factor-already-in-use":"The second factor is already enrolled on this account.","maximum-second-factor-count-exceeded":"The maximum allowed number of second factors on a user has been exceeded.","tenant-id-mismatch":"The provided tenant ID does not match the Auth instance's tenant ID",timeout:"The operation has timed out.","user-token-expired":"The user's credential is no longer valid. The user must sign in again.","too-many-requests":"We have blocked all requests from this device due to unusual activity. Try again later.","unauthorized-continue-uri":"The domain of the continue URL is not whitelisted.  Please whitelist the domain in the Firebase console.","unsupported-first-factor":"Enrolling a second factor or signing in with a multi-factor account requires sign-in with a supported first factor.","unsupported-persistence-type":"The current environment does not support the specified persistence type.","unsupported-tenant-operation":"This operation is not supported in a multi-tenant context.","unverified-email":"The operation requires a verified email.","user-cancelled":"The user did not grant your application the permissions it requested.","user-not-found":"There is no user record corresponding to this identifier. The user may have been deleted.","user-disabled":"The user account has been disabled by an administrator.","user-mismatch":"The supplied credentials do not correspond to the previously signed in user.","user-signed-out":"","weak-password":"The password must be 6 characters long or more.","web-storage-unsupported":"This browser is not supported or 3rd party cookies and data may be disabled.","already-initialized":"initializeAuth() has already been called with different options. To avoid this error, call initializeAuth() with the same options as when it was originally called, or call getAuth() to return the already initialized instance.","missing-recaptcha-token":"The reCAPTCHA token is missing when sending request to the backend.","invalid-recaptcha-token":"The reCAPTCHA token is invalid when sending request to the backend.","invalid-recaptcha-action":"The reCAPTCHA action is invalid when sending request to the backend.","recaptcha-not-enabled":"reCAPTCHA Enterprise integration is not enabled for this project.","missing-client-type":"The reCAPTCHA client type is missing when sending request to the backend.","missing-recaptcha-version":"The reCAPTCHA version is missing when sending request to the backend.","invalid-req-type":"Invalid request parameters.","invalid-recaptcha-version":"The reCAPTCHA version is invalid when sending request to the backend.","unsupported-password-policy-schema-version":"The password policy received from the backend uses a schema version that is not supported by this version of the Firebase SDK.","password-does-not-meet-requirements":"The password does not meet the requirements.","invalid-hosting-link-domain":"The provided Hosting link domain is not configured in Firebase Hosting or is not owned by the current project. This cannot be a default Hosting domain (`web.app` or `firebaseapp.com`)."}}function wP(){return{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}}const A7=AU,CU=wP,xP=new qa("auth","Firebase",wP()),C7={ADMIN_ONLY_OPERATION:"auth/admin-restricted-operation",ARGUMENT_ERROR:"auth/argument-error",APP_NOT_AUTHORIZED:"auth/app-not-authorized",APP_NOT_INSTALLED:"auth/app-not-installed",CAPTCHA_CHECK_FAILED:"auth/captcha-check-failed",CODE_EXPIRED:"auth/code-expired",CORDOVA_NOT_READY:"auth/cordova-not-ready",CORS_UNSUPPORTED:"auth/cors-unsupported",CREDENTIAL_ALREADY_IN_USE:"auth/credential-already-in-use",CREDENTIAL_MISMATCH:"auth/custom-token-mismatch",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"auth/requires-recent-login",DEPENDENT_SDK_INIT_BEFORE_AUTH:"auth/dependent-sdk-initialized-before-auth",DYNAMIC_LINK_NOT_ACTIVATED:"auth/dynamic-link-not-activated",EMAIL_CHANGE_NEEDS_VERIFICATION:"auth/email-change-needs-verification",EMAIL_EXISTS:"auth/email-already-in-use",EMULATOR_CONFIG_FAILED:"auth/emulator-config-failed",EXPIRED_OOB_CODE:"auth/expired-action-code",EXPIRED_POPUP_REQUEST:"auth/cancelled-popup-request",INTERNAL_ERROR:"auth/internal-error",INVALID_API_KEY:"auth/invalid-api-key",INVALID_APP_CREDENTIAL:"auth/invalid-app-credential",INVALID_APP_ID:"auth/invalid-app-id",INVALID_AUTH:"auth/invalid-user-token",INVALID_AUTH_EVENT:"auth/invalid-auth-event",INVALID_CERT_HASH:"auth/invalid-cert-hash",INVALID_CODE:"auth/invalid-verification-code",INVALID_CONTINUE_URI:"auth/invalid-continue-uri",INVALID_CORDOVA_CONFIGURATION:"auth/invalid-cordova-configuration",INVALID_CUSTOM_TOKEN:"auth/invalid-custom-token",INVALID_DYNAMIC_LINK_DOMAIN:"auth/invalid-dynamic-link-domain",INVALID_EMAIL:"auth/invalid-email",INVALID_EMULATOR_SCHEME:"auth/invalid-emulator-scheme",INVALID_IDP_RESPONSE:"auth/invalid-credential",INVALID_LOGIN_CREDENTIALS:"auth/invalid-credential",INVALID_MESSAGE_PAYLOAD:"auth/invalid-message-payload",INVALID_MFA_SESSION:"auth/invalid-multi-factor-session",INVALID_OAUTH_CLIENT_ID:"auth/invalid-oauth-client-id",INVALID_OAUTH_PROVIDER:"auth/invalid-oauth-provider",INVALID_OOB_CODE:"auth/invalid-action-code",INVALID_ORIGIN:"auth/unauthorized-domain",INVALID_PASSWORD:"auth/wrong-password",INVALID_PERSISTENCE:"auth/invalid-persistence-type",INVALID_PHONE_NUMBER:"auth/invalid-phone-number",INVALID_PROVIDER_ID:"auth/invalid-provider-id",INVALID_RECIPIENT_EMAIL:"auth/invalid-recipient-email",INVALID_SENDER:"auth/invalid-sender",INVALID_SESSION_INFO:"auth/invalid-verification-id",INVALID_TENANT_ID:"auth/invalid-tenant-id",MFA_INFO_NOT_FOUND:"auth/multi-factor-info-not-found",MFA_REQUIRED:"auth/multi-factor-auth-required",MISSING_ANDROID_PACKAGE_NAME:"auth/missing-android-pkg-name",MISSING_APP_CREDENTIAL:"auth/missing-app-credential",MISSING_AUTH_DOMAIN:"auth/auth-domain-config-required",MISSING_CODE:"auth/missing-verification-code",MISSING_CONTINUE_URI:"auth/missing-continue-uri",MISSING_IFRAME_START:"auth/missing-iframe-start",MISSING_IOS_BUNDLE_ID:"auth/missing-ios-bundle-id",MISSING_OR_INVALID_NONCE:"auth/missing-or-invalid-nonce",MISSING_MFA_INFO:"auth/missing-multi-factor-info",MISSING_MFA_SESSION:"auth/missing-multi-factor-session",MISSING_PHONE_NUMBER:"auth/missing-phone-number",MISSING_SESSION_INFO:"auth/missing-verification-id",MODULE_DESTROYED:"auth/app-deleted",NEED_CONFIRMATION:"auth/account-exists-with-different-credential",NETWORK_REQUEST_FAILED:"auth/network-request-failed",NULL_USER:"auth/null-user",NO_AUTH_EVENT:"auth/no-auth-event",NO_SUCH_PROVIDER:"auth/no-such-provider",OPERATION_NOT_ALLOWED:"auth/operation-not-allowed",OPERATION_NOT_SUPPORTED:"auth/operation-not-supported-in-this-environment",POPUP_BLOCKED:"auth/popup-blocked",POPUP_CLOSED_BY_USER:"auth/popup-closed-by-user",PROVIDER_ALREADY_LINKED:"auth/provider-already-linked",QUOTA_EXCEEDED:"auth/quota-exceeded",REDIRECT_CANCELLED_BY_USER:"auth/redirect-cancelled-by-user",REDIRECT_OPERATION_PENDING:"auth/redirect-operation-pending",REJECTED_CREDENTIAL:"auth/rejected-credential",SECOND_FACTOR_ALREADY_ENROLLED:"auth/second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"auth/maximum-second-factor-count-exceeded",TENANT_ID_MISMATCH:"auth/tenant-id-mismatch",TIMEOUT:"auth/timeout",TOKEN_EXPIRED:"auth/user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"auth/too-many-requests",UNAUTHORIZED_DOMAIN:"auth/unauthorized-continue-uri",UNSUPPORTED_FIRST_FACTOR:"auth/unsupported-first-factor",UNSUPPORTED_PERSISTENCE:"auth/unsupported-persistence-type",UNSUPPORTED_TENANT_OPERATION:"auth/unsupported-tenant-operation",UNVERIFIED_EMAIL:"auth/unverified-email",USER_CANCELLED:"auth/user-cancelled",USER_DELETED:"auth/user-not-found",USER_DISABLED:"auth/user-disabled",USER_MISMATCH:"auth/user-mismatch",USER_SIGNED_OUT:"auth/user-signed-out",WEAK_PASSWORD:"auth/weak-password",WEB_STORAGE_UNSUPPORTED:"auth/web-storage-unsupported",ALREADY_INITIALIZED:"auth/already-initialized",RECAPTCHA_NOT_ENABLED:"auth/recaptcha-not-enabled",MISSING_RECAPTCHA_TOKEN:"auth/missing-recaptcha-token",INVALID_RECAPTCHA_TOKEN:"auth/invalid-recaptcha-token",INVALID_RECAPTCHA_ACTION:"auth/invalid-recaptcha-action",MISSING_CLIENT_TYPE:"auth/missing-client-type",MISSING_RECAPTCHA_VERSION:"auth/missing-recaptcha-version",INVALID_RECAPTCHA_VERSION:"auth/invalid-recaptcha-version",INVALID_REQ_TYPE:"auth/invalid-req-type",INVALID_HOSTING_LINK_DOMAIN:"auth/invalid-hosting-link-domain"};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ip=new rh("@firebase/auth");function RU(n,...e){ip.logLevel<=Ze.WARN&&ip.warn(`Auth (${Ga}): ${n}`,...e)}function Jf(n,...e){ip.logLevel<=Ze.ERROR&&ip.error(`Auth (${Ga}): ${n}`,...e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Tr(n,...e){throw Ax(n,...e)}function lr(n,...e){return Ax(n,...e)}function bx(n,e,t){const r={...CU(),[e]:t};return new qa("auth","Firebase",r).create(e,{appName:n.name})}function Dn(n){return bx(n,"operation-not-supported-in-this-environment","Operations that alter the current user are not supported in conjunction with FirebaseServerApp")}function Gc(n,e,t){const r=t;if(!(e instanceof r))throw r.name!==e.constructor.name&&Tr(n,"argument-error"),bx(n,"argument-error",`Type of ${e.constructor.name} does not match expected instance.Did you pass a reference from a different Auth SDK?`)}function Ax(n,...e){if(typeof n!="string"){const t=e[0],r=[...e.slice(1)];return r[0]&&(r[0].appName=n.name),n._errorFactory.create(t,...r)}return xP.create(n,...e)}function X(n,e,...t){if(!n)throw Ax(e,...t)}function Fs(n){const e="INTERNAL ASSERTION FAILED: "+n;throw Jf(e),new Error(e)}function Ii(n,e){n||Fs(e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Gd(){var n;return typeof self<"u"&&((n=self.location)==null?void 0:n.href)||""}function Cx(){return XT()==="http:"||XT()==="https:"}function XT(){var n;return typeof self<"u"&&((n=self.location)==null?void 0:n.protocol)||null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function NU(){return typeof navigator<"u"&&navigator&&"onLine"in navigator&&typeof navigator.onLine=="boolean"&&(Cx()||M0()||"connection"in navigator)?navigator.onLine:!0}function kU(){if(typeof navigator>"u")return null;const n=navigator;return n.languages&&n.languages[0]||n.language||null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Rh{constructor(e,t){this.shortDelay=e,this.longDelay=t,Ii(t>e,"Short delay should be less than long delay!"),this.isMobile=D0()||tC()}get(){return NU()?this.isMobile?this.longDelay:this.shortDelay:Math.min(5e3,this.shortDelay)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Rx(n,e){Ii(n.emulator,"Emulator should always be set here");const{url:t}=n.emulator;return e?`${t}${e.startsWith("/")?e.slice(1):e}`:t}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class IP{static initialize(e,t,r){this.fetchImpl=e,t&&(this.headersImpl=t),r&&(this.responseImpl=r)}static fetch(){if(this.fetchImpl)return this.fetchImpl;if(typeof self<"u"&&"fetch"in self)return self.fetch;if(typeof globalThis<"u"&&globalThis.fetch)return globalThis.fetch;if(typeof fetch<"u")return fetch;Fs("Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static headers(){if(this.headersImpl)return this.headersImpl;if(typeof self<"u"&&"Headers"in self)return self.Headers;if(typeof globalThis<"u"&&globalThis.Headers)return globalThis.Headers;if(typeof Headers<"u")return Headers;Fs("Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static response(){if(this.responseImpl)return this.responseImpl;if(typeof self<"u"&&"Response"in self)return self.Response;if(typeof globalThis<"u"&&globalThis.Response)return globalThis.Response;if(typeof Response<"u")return Response;Fs("Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const PU={CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_PASSWORD:"wrong-password",MISSING_PASSWORD:"missing-password",INVALID_LOGIN_CREDENTIALS:"invalid-credential",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_REQ_TYPE:"internal-error",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",PASSWORD_DOES_NOT_MEET_REQUIREMENTS:"password-does-not-meet-requirements",INVALID_CODE:"invalid-verification-code",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_SESSION_INFO:"missing-verification-id",SESSION_EXPIRED:"code-expired",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",ADMIN_ONLY_OPERATION:"admin-restricted-operation",INVALID_MFA_PENDING_CREDENTIAL:"invalid-multi-factor-session",MFA_ENROLLMENT_NOT_FOUND:"multi-factor-info-not-found",MISSING_MFA_ENROLLMENT_ID:"missing-multi-factor-info",MISSING_MFA_PENDING_CREDENTIAL:"missing-multi-factor-session",SECOND_FACTOR_EXISTS:"second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"maximum-second-factor-count-exceeded",BLOCKING_FUNCTION_ERROR_RESPONSE:"internal-error",RECAPTCHA_NOT_ENABLED:"recaptcha-not-enabled",MISSING_RECAPTCHA_TOKEN:"missing-recaptcha-token",INVALID_RECAPTCHA_TOKEN:"invalid-recaptcha-token",INVALID_RECAPTCHA_ACTION:"invalid-recaptcha-action",MISSING_CLIENT_TYPE:"missing-client-type",MISSING_RECAPTCHA_VERSION:"missing-recaptcha-version",INVALID_RECAPTCHA_VERSION:"invalid-recaptcha-version",INVALID_REQ_TYPE:"invalid-req-type"};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const DU=["/v1/accounts:signInWithCustomToken","/v1/accounts:signInWithEmailLink","/v1/accounts:signInWithIdp","/v1/accounts:signInWithPassword","/v1/accounts:signInWithPhoneNumber","/v1/token"],MU=new Rh(3e4,6e4);function Bt(n,e){return n.tenantId&&!e.tenantId?{...e,tenantId:n.tenantId}:e}async function zt(n,e,t,r,s={}){return EP(n,s,async()=>{let i={},o={};r&&(e==="GET"?o=r:i={body:JSON.stringify(r)});const a=Wa({key:n.config.apiKey,...o}).slice(1),l=await n._getAdditionalHeaders();l["Content-Type"]="application/json",n.languageCode&&(l["X-Firebase-Locale"]=n.languageCode);const u={method:e,headers:l,...i};return GL()||(u.referrerPolicy="no-referrer"),n.emulatorConfig&&bi(n.emulatorConfig.host)&&(u.credentials="include"),IP.fetch()(await SP(n,n.config.apiHost,t,a),u)})}async function EP(n,e,t){n._canInitEmulator=!1;const r={...PU,...e};try{const s=new OU(n),i=await Promise.race([t(),s.promise]);s.clearNetworkTimeout();const o=await i.json();if("needConfirmation"in o)throw Nu(n,"account-exists-with-different-credential",o);if(i.ok&&!("errorMessage"in o))return o;{const a=i.ok?o.errorMessage:o.error.message,[l,u]=a.split(" : ");if(l==="FEDERATED_USER_ID_ALREADY_LINKED")throw Nu(n,"credential-already-in-use",o);if(l==="EMAIL_EXISTS")throw Nu(n,"email-already-in-use",o);if(l==="USER_DISABLED")throw Nu(n,"user-disabled",o);const h=r[l]||l.toLowerCase().replace(/[_\s]+/g,"-");if(u)throw bx(n,h,u);Tr(n,h)}}catch(s){if(s instanceof xs)throw s;Tr(n,"network-request-failed",{message:String(s)})}}async function ki(n,e,t,r,s={}){const i=await zt(n,e,t,r,s);return"mfaPendingCredential"in i&&Tr(n,"multi-factor-auth-required",{_serverResponse:i}),i}async function SP(n,e,t,r){const s=`${e}${t}?${r}`,i=n,o=i.config.emulator?Rx(n.config,s):`${n.config.apiScheme}://${s}`;return DU.includes(t)&&(await i._persistenceManagerAvailable,i._getPersistenceType()==="COOKIE")?i._getPersistence()._getFinalTarget(o).toString():o}function LU(n){switch(n){case"ENFORCE":return"ENFORCE";case"AUDIT":return"AUDIT";case"OFF":return"OFF";default:return"ENFORCEMENT_STATE_UNSPECIFIED"}}class OU{clearNetworkTimeout(){clearTimeout(this.timer)}constructor(e){this.auth=e,this.timer=null,this.promise=new Promise((t,r)=>{this.timer=setTimeout(()=>r(lr(this.auth,"network-request-failed")),MU.get())})}}function Nu(n,e,t){const r={appName:n.name};t.email&&(r.email=t.email),t.phoneNumber&&(r.phoneNumber=t.phoneNumber);const s=lr(n,e,r);return s.customData._tokenResponse=t,s}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ZT(n){return n!==void 0&&n.getResponse!==void 0}function eb(n){return n!==void 0&&n.enterprise!==void 0}class TP{constructor(e){if(this.siteKey="",this.recaptchaEnforcementState=[],e.recaptchaKey===void 0)throw new Error("recaptchaKey undefined");this.siteKey=e.recaptchaKey.split("/")[3],this.recaptchaEnforcementState=e.recaptchaEnforcementState}getProviderEnforcementState(e){if(!this.recaptchaEnforcementState||this.recaptchaEnforcementState.length===0)return null;for(const t of this.recaptchaEnforcementState)if(t.provider&&t.provider===e)return LU(t.enforcementState);return null}isProviderEnabled(e){return this.getProviderEnforcementState(e)==="ENFORCE"||this.getProviderEnforcementState(e)==="AUDIT"}isAnyProviderEnabled(){return this.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")||this.isProviderEnabled("PHONE_PROVIDER")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function VU(n){return(await zt(n,"GET","/v1/recaptchaParams")).recaptchaSiteKey||""}async function bP(n,e){return zt(n,"GET","/v2/recaptchaConfig",Bt(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function FU(n,e){return zt(n,"POST","/v1/accounts:delete",e)}async function jU(n,e){return zt(n,"POST","/v1/accounts:update",e)}async function op(n,e){return zt(n,"POST","/v1/accounts:lookup",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function td(n){if(n)try{const e=new Date(Number(n));if(!isNaN(e.getTime()))return e.toUTCString()}catch{}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function R7(n,e=!1){return ae(n).getIdToken(e)}async function UU(n,e=!1){const t=ae(n),r=await t.getIdToken(e),s=Sm(r);X(s&&s.exp&&s.auth_time&&s.iat,t.auth,"internal-error");const i=typeof s.firebase=="object"?s.firebase:void 0,o=i==null?void 0:i.sign_in_provider;return{claims:s,token:r,authTime:td(My(s.auth_time)),issuedAtTime:td(My(s.iat)),expirationTime:td(My(s.exp)),signInProvider:o||null,signInSecondFactor:(i==null?void 0:i.sign_in_second_factor)||null}}function My(n){return Number(n)*1e3}function Sm(n){const[e,t,r]=n.split(".");if(e===void 0||t===void 0||r===void 0)return Jf("JWT malformed, contained fewer than 3 sections"),null;try{const s=Ag(t);return s?JSON.parse(s):(Jf("Failed to decode base64 JWT payload"),null)}catch(s){return Jf("Caught error parsing JWT payload as JSON",s==null?void 0:s.toString()),null}}function tb(n){const e=Sm(n);return X(e,"internal-error"),X(typeof e.exp<"u","internal-error"),X(typeof e.iat<"u","internal-error"),Number(e.exp)-Number(e.iat)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Ei(n,e,t=!1){if(t)return e;try{return await e}catch(r){throw r instanceof xs&&$U(r)&&n.auth.currentUser===n&&await n.auth.signOut(),r}}function $U({code:n}){return n==="auth/user-disabled"||n==="auth/user-token-expired"}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class BU{constructor(e){this.user=e,this.isRunning=!1,this.timerId=null,this.errorBackoff=3e4}_start(){this.isRunning||(this.isRunning=!0,this.schedule())}_stop(){this.isRunning&&(this.isRunning=!1,this.timerId!==null&&clearTimeout(this.timerId))}getInterval(e){if(e){const t=this.errorBackoff;return this.errorBackoff=Math.min(this.errorBackoff*2,96e4),t}else{this.errorBackoff=3e4;const r=(this.user.stsTokenManager.expirationTime??0)-Date.now()-3e5;return Math.max(0,r)}}schedule(e=!1){if(!this.isRunning)return;const t=this.getInterval(e);this.timerId=setTimeout(async()=>{await this.iteration()},t)}async iteration(){try{await this.user.getIdToken(!0)}catch(e){(e==null?void 0:e.code)==="auth/network-request-failed"&&this.schedule(!0);return}this.schedule()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Dv{constructor(e,t){this.createdAt=e,this.lastLoginAt=t,this._initializeTime()}_initializeTime(){this.lastSignInTime=td(this.lastLoginAt),this.creationTime=td(this.createdAt)}_copy(e){this.createdAt=e.createdAt,this.lastLoginAt=e.lastLoginAt,this._initializeTime()}toJSON(){return{createdAt:this.createdAt,lastLoginAt:this.lastLoginAt}}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Hd(n){var f;const e=n.auth,t=await n.getIdToken(),r=await Ei(n,op(e,{idToken:t}));X(r==null?void 0:r.users.length,e,"internal-error");const s=r.users[0];n._notifyReloadListener(s);const i=(f=s.providerUserInfo)!=null&&f.length?AP(s.providerUserInfo):[],o=qU(n.providerData,i),a=n.isAnonymous,l=!(n.email&&s.passwordHash)&&!(o!=null&&o.length),u=a?l:!1,h={uid:s.localId,displayName:s.displayName||null,photoURL:s.photoUrl||null,email:s.email||null,emailVerified:s.emailVerified||!1,phoneNumber:s.phoneNumber||null,tenantId:s.tenantId||null,providerData:o,metadata:new Dv(s.createdAt,s.lastLoginAt),isAnonymous:u};Object.assign(n,h)}async function zU(n){const e=ae(n);await Hd(e),await e.auth._persistUserIfCurrent(e),e.auth._notifyListenersIfCurrent(e)}function qU(n,e){return[...n.filter(r=>!e.some(s=>s.providerId===r.providerId)),...e]}function AP(n){return n.map(({providerId:e,...t})=>({providerId:e,uid:t.rawId||"",displayName:t.displayName||null,email:t.email||null,phoneNumber:t.phoneNumber||null,photoURL:t.photoUrl||null}))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function WU(n,e){const t=await EP(n,{},async()=>{const r=Wa({grant_type:"refresh_token",refresh_token:e}).slice(1),{tokenApiHost:s,apiKey:i}=n.config,o=await SP(n,s,"/v1/token",`key=${i}`),a=await n._getAdditionalHeaders();a["Content-Type"]="application/x-www-form-urlencoded";const l={method:"POST",headers:a,body:r};return n.emulatorConfig&&bi(n.emulatorConfig.host)&&(l.credentials="include"),IP.fetch()(o,l)});return{accessToken:t.access_token,expiresIn:t.expires_in,refreshToken:t.refresh_token}}async function GU(n,e){return zt(n,"POST","/v2/accounts:revokeToken",Bt(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ql{constructor(){this.refreshToken=null,this.accessToken=null,this.expirationTime=null}get isExpired(){return!this.expirationTime||Date.now()>this.expirationTime-3e4}updateFromServerResponse(e){X(e.idToken,"internal-error"),X(typeof e.idToken<"u","internal-error"),X(typeof e.refreshToken<"u","internal-error");const t="expiresIn"in e&&typeof e.expiresIn<"u"?Number(e.expiresIn):tb(e.idToken);this.updateTokensAndExpiration(e.idToken,e.refreshToken,t)}updateFromIdToken(e){X(e.length!==0,"internal-error");const t=tb(e);this.updateTokensAndExpiration(e,null,t)}async getToken(e,t=!1){return!t&&this.accessToken&&!this.isExpired?this.accessToken:(X(this.refreshToken,e,"user-token-expired"),this.refreshToken?(await this.refresh(e,this.refreshToken),this.accessToken):null)}clearRefreshToken(){this.refreshToken=null}async refresh(e,t){const{accessToken:r,refreshToken:s,expiresIn:i}=await WU(e,t);this.updateTokensAndExpiration(r,s,Number(i))}updateTokensAndExpiration(e,t,r){this.refreshToken=t||null,this.accessToken=e||null,this.expirationTime=Date.now()+r*1e3}static fromJSON(e,t){const{refreshToken:r,accessToken:s,expirationTime:i}=t,o=new ql;return r&&(X(typeof r=="string","internal-error",{appName:e}),o.refreshToken=r),s&&(X(typeof s=="string","internal-error",{appName:e}),o.accessToken=s),i&&(X(typeof i=="number","internal-error",{appName:e}),o.expirationTime=i),o}toJSON(){return{refreshToken:this.refreshToken,accessToken:this.accessToken,expirationTime:this.expirationTime}}_assign(e){this.accessToken=e.accessToken,this.refreshToken=e.refreshToken,this.expirationTime=e.expirationTime}_clone(){return Object.assign(new ql,this.toJSON())}_performRefresh(){return Fs("not implemented")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function $i(n,e){X(typeof n=="string"||typeof n>"u","internal-error",{appName:e})}class gs{constructor({uid:e,auth:t,stsTokenManager:r,...s}){this.providerId="firebase",this.proactiveRefresh=new BU(this),this.reloadUserInfo=null,this.reloadListener=null,this.uid=e,this.auth=t,this.stsTokenManager=r,this.accessToken=r.accessToken,this.displayName=s.displayName||null,this.email=s.email||null,this.emailVerified=s.emailVerified||!1,this.phoneNumber=s.phoneNumber||null,this.photoURL=s.photoURL||null,this.isAnonymous=s.isAnonymous||!1,this.tenantId=s.tenantId||null,this.providerData=s.providerData?[...s.providerData]:[],this.metadata=new Dv(s.createdAt||void 0,s.lastLoginAt||void 0)}async getIdToken(e){const t=await Ei(this,this.stsTokenManager.getToken(this.auth,e));return X(t,this.auth,"internal-error"),this.accessToken!==t&&(this.accessToken=t,await this.auth._persistUserIfCurrent(this),this.auth._notifyListenersIfCurrent(this)),t}getIdTokenResult(e){return UU(this,e)}reload(){return zU(this)}_assign(e){this!==e&&(X(this.uid===e.uid,this.auth,"internal-error"),this.displayName=e.displayName,this.photoURL=e.photoURL,this.email=e.email,this.emailVerified=e.emailVerified,this.phoneNumber=e.phoneNumber,this.isAnonymous=e.isAnonymous,this.tenantId=e.tenantId,this.providerData=e.providerData.map(t=>({...t})),this.metadata._copy(e.metadata),this.stsTokenManager._assign(e.stsTokenManager))}_clone(e){const t=new gs({...this,auth:e,stsTokenManager:this.stsTokenManager._clone()});return t.metadata._copy(this.metadata),t}_onReload(e){X(!this.reloadListener,this.auth,"internal-error"),this.reloadListener=e,this.reloadUserInfo&&(this._notifyReloadListener(this.reloadUserInfo),this.reloadUserInfo=null)}_notifyReloadListener(e){this.reloadListener?this.reloadListener(e):this.reloadUserInfo=e}_startProactiveRefresh(){this.proactiveRefresh._start()}_stopProactiveRefresh(){this.proactiveRefresh._stop()}async _updateTokensIfNecessary(e,t=!1){let r=!1;e.idToken&&e.idToken!==this.stsTokenManager.accessToken&&(this.stsTokenManager.updateFromServerResponse(e),r=!0),t&&await Hd(this),await this.auth._persistUserIfCurrent(this),r&&this.auth._notifyListenersIfCurrent(this)}async delete(){if(Kt(this.auth.app))return Promise.reject(Dn(this.auth));const e=await this.getIdToken();return await Ei(this,FU(this.auth,{idToken:e})),this.stsTokenManager.clearRefreshToken(),this.auth.signOut()}toJSON(){return{uid:this.uid,email:this.email||void 0,emailVerified:this.emailVerified,displayName:this.displayName||void 0,isAnonymous:this.isAnonymous,photoURL:this.photoURL||void 0,phoneNumber:this.phoneNumber||void 0,tenantId:this.tenantId||void 0,providerData:this.providerData.map(e=>({...e})),stsTokenManager:this.stsTokenManager.toJSON(),_redirectEventId:this._redirectEventId,...this.metadata.toJSON(),apiKey:this.auth.config.apiKey,appName:this.auth.name}}get refreshToken(){return this.stsTokenManager.refreshToken||""}static _fromJSON(e,t){const r=t.displayName??void 0,s=t.email??void 0,i=t.phoneNumber??void 0,o=t.photoURL??void 0,a=t.tenantId??void 0,l=t._redirectEventId??void 0,u=t.createdAt??void 0,h=t.lastLoginAt??void 0,{uid:f,emailVerified:g,isAnonymous:y,providerData:w,stsTokenManager:C}=t;X(f&&C,e,"internal-error");const M=ql.fromJSON(this.name,C);X(typeof f=="string",e,"internal-error"),$i(r,e.name),$i(s,e.name),X(typeof g=="boolean",e,"internal-error"),X(typeof y=="boolean",e,"internal-error"),$i(i,e.name),$i(o,e.name),$i(a,e.name),$i(l,e.name),$i(u,e.name),$i(h,e.name);const A=new gs({uid:f,auth:e,email:s,emailVerified:g,displayName:r,isAnonymous:y,photoURL:o,phoneNumber:i,tenantId:a,stsTokenManager:M,createdAt:u,lastLoginAt:h});return w&&Array.isArray(w)&&(A.providerData=w.map(I=>({...I}))),l&&(A._redirectEventId=l),A}static async _fromIdTokenResponse(e,t,r=!1){const s=new ql;s.updateFromServerResponse(t);const i=new gs({uid:t.localId,auth:e,stsTokenManager:s,isAnonymous:r});return await Hd(i),i}static async _fromGetAccountInfoResponse(e,t,r){const s=t.users[0];X(s.localId!==void 0,"internal-error");const i=s.providerUserInfo!==void 0?AP(s.providerUserInfo):[],o=!(s.email&&s.passwordHash)&&!(i!=null&&i.length),a=new ql;a.updateFromIdToken(r);const l=new gs({uid:s.localId,auth:e,stsTokenManager:a,isAnonymous:o}),u={uid:s.localId,displayName:s.displayName||null,photoURL:s.photoUrl||null,email:s.email||null,emailVerified:s.emailVerified||!1,phoneNumber:s.phoneNumber||null,tenantId:s.tenantId||null,providerData:i,metadata:new Dv(s.createdAt,s.lastLoginAt),isAnonymous:!(s.email&&s.passwordHash)&&!(i!=null&&i.length)};return Object.assign(l,u),l}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const nb=new Map;function ui(n){Ii(n instanceof Function,"Expected a class definition");let e=nb.get(n);return e?(Ii(e instanceof n,"Instance stored in cache mismatched with class"),e):(e=new n,nb.set(n,e),e)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class CP{constructor(){this.type="NONE",this.storage={}}async _isAvailable(){return!0}async _set(e,t){this.storage[e]=t}async _get(e){const t=this.storage[e];return t===void 0?null:t}async _remove(e){delete this.storage[e]}_addListener(e,t){}_removeListener(e,t){}}CP.type="NONE";const rb=CP;/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Xf(n,e,t){return`firebase:${n}:${e}:${t}`}class Wl{constructor(e,t,r){this.persistence=e,this.auth=t,this.userKey=r;const{config:s,name:i}=this.auth;this.fullUserKey=Xf(this.userKey,s.apiKey,i),this.fullPersistenceKey=Xf("persistence",s.apiKey,i),this.boundEventHandler=t._onStorageEvent.bind(t),this.persistence._addListener(this.fullUserKey,this.boundEventHandler)}setCurrentUser(e){return this.persistence._set(this.fullUserKey,e.toJSON())}async getCurrentUser(){const e=await this.persistence._get(this.fullUserKey);if(!e)return null;if(typeof e=="string"){const t=await op(this.auth,{idToken:e}).catch(()=>{});return t?gs._fromGetAccountInfoResponse(this.auth,t,e):null}return gs._fromJSON(this.auth,e)}removeCurrentUser(){return this.persistence._remove(this.fullUserKey)}savePersistenceForRedirect(){return this.persistence._set(this.fullPersistenceKey,this.persistence.type)}async setPersistence(e){if(this.persistence===e)return;const t=await this.getCurrentUser();if(await this.removeCurrentUser(),this.persistence=e,t)return this.setCurrentUser(t)}delete(){this.persistence._removeListener(this.fullUserKey,this.boundEventHandler)}static async create(e,t,r="authUser"){if(!t.length)return new Wl(ui(rb),e,r);const s=(await Promise.all(t.map(async u=>{if(await u._isAvailable())return u}))).filter(u=>u);let i=s[0]||ui(rb);const o=Xf(r,e.config.apiKey,e.name);let a=null;for(const u of t)try{const h=await u._get(o);if(h){let f;if(typeof h=="string"){const g=await op(e,{idToken:h}).catch(()=>{});if(!g)break;f=await gs._fromGetAccountInfoResponse(e,g,h)}else f=gs._fromJSON(e,h);u!==i&&(a=f),i=u;break}}catch{}const l=s.filter(u=>u._shouldAllowMigration);return!i._shouldAllowMigration||!l.length?new Wl(i,e,r):(i=l[0],a&&await i._set(o,a.toJSON()),await Promise.all(t.map(async u=>{if(u!==i)try{await u._remove(o)}catch{}})),new Wl(i,e,r))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function sb(n){const e=n.toLowerCase();if(e.includes("opera/")||e.includes("opr/")||e.includes("opios/"))return"Opera";if(PP(e))return"IEMobile";if(e.includes("msie")||e.includes("trident/"))return"IE";if(e.includes("edge/"))return"Edge";if(RP(e))return"Firefox";if(e.includes("silk/"))return"Silk";if(MP(e))return"Blackberry";if(LP(e))return"Webos";if(NP(e))return"Safari";if((e.includes("chrome/")||kP(e))&&!e.includes("edge/"))return"Chrome";if(DP(e))return"Android";{const t=/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/,r=n.match(t);if((r==null?void 0:r.length)===2)return r[1]}return"Other"}function RP(n=In()){return/firefox\//i.test(n)}function NP(n=In()){const e=n.toLowerCase();return e.includes("safari/")&&!e.includes("chrome/")&&!e.includes("crios/")&&!e.includes("android")}function kP(n=In()){return/crios\//i.test(n)}function PP(n=In()){return/iemobile/i.test(n)}function DP(n=In()){return/android/i.test(n)}function MP(n=In()){return/blackberry/i.test(n)}function LP(n=In()){return/webos/i.test(n)}function Nx(n=In()){return/iphone|ipad|ipod/i.test(n)||/macintosh/i.test(n)&&/mobile/i.test(n)}function HU(n=In()){var e;return Nx(n)&&!!((e=window.navigator)!=null&&e.standalone)}function KU(){return HL()&&document.documentMode===10}function OP(n=In()){return Nx(n)||DP(n)||LP(n)||MP(n)||/windows phone/i.test(n)||PP(n)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function VP(n,e=[]){let t;switch(n){case"Browser":t=sb(In());break;case"Worker":t=`${sb(In())}-${n}`;break;default:t=n}const r=e.length?e.join(","):"FirebaseCore-web";return`${t}/JsCore/${Ga}/${r}`}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class QU{constructor(e){this.auth=e,this.queue=[]}pushCallback(e,t){const r=i=>new Promise((o,a)=>{try{const l=e(i);o(l)}catch(l){a(l)}});r.onAbort=t,this.queue.push(r);const s=this.queue.length-1;return()=>{this.queue[s]=()=>Promise.resolve()}}async runMiddleware(e){if(this.auth.currentUser===e)return;const t=[];try{for(const r of this.queue)await r(e),r.onAbort&&t.push(r.onAbort)}catch(r){t.reverse();for(const s of t)try{s()}catch{}throw this.auth._errorFactory.create("login-blocked",{originalMessage:r==null?void 0:r.message})}}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function YU(n,e={}){return zt(n,"GET","/v2/passwordPolicy",Bt(n,e))}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const JU=6;class XU{constructor(e){var r;const t=e.customStrengthOptions;this.customStrengthOptions={},this.customStrengthOptions.minPasswordLength=t.minPasswordLength??JU,t.maxPasswordLength&&(this.customStrengthOptions.maxPasswordLength=t.maxPasswordLength),t.containsLowercaseCharacter!==void 0&&(this.customStrengthOptions.containsLowercaseLetter=t.containsLowercaseCharacter),t.containsUppercaseCharacter!==void 0&&(this.customStrengthOptions.containsUppercaseLetter=t.containsUppercaseCharacter),t.containsNumericCharacter!==void 0&&(this.customStrengthOptions.containsNumericCharacter=t.containsNumericCharacter),t.containsNonAlphanumericCharacter!==void 0&&(this.customStrengthOptions.containsNonAlphanumericCharacter=t.containsNonAlphanumericCharacter),this.enforcementState=e.enforcementState,this.enforcementState==="ENFORCEMENT_STATE_UNSPECIFIED"&&(this.enforcementState="OFF"),this.allowedNonAlphanumericCharacters=((r=e.allowedNonAlphanumericCharacters)==null?void 0:r.join(""))??"",this.forceUpgradeOnSignin=e.forceUpgradeOnSignin??!1,this.schemaVersion=e.schemaVersion}validatePassword(e){const t={isValid:!0,passwordPolicy:this};return this.validatePasswordLengthOptions(e,t),this.validatePasswordCharacterOptions(e,t),t.isValid&&(t.isValid=t.meetsMinPasswordLength??!0),t.isValid&&(t.isValid=t.meetsMaxPasswordLength??!0),t.isValid&&(t.isValid=t.containsLowercaseLetter??!0),t.isValid&&(t.isValid=t.containsUppercaseLetter??!0),t.isValid&&(t.isValid=t.containsNumericCharacter??!0),t.isValid&&(t.isValid=t.containsNonAlphanumericCharacter??!0),t}validatePasswordLengthOptions(e,t){const r=this.customStrengthOptions.minPasswordLength,s=this.customStrengthOptions.maxPasswordLength;r&&(t.meetsMinPasswordLength=e.length>=r),s&&(t.meetsMaxPasswordLength=e.length<=s)}validatePasswordCharacterOptions(e,t){this.updatePasswordCharacterOptionsStatuses(t,!1,!1,!1,!1);let r;for(let s=0;s<e.length;s++)r=e.charAt(s),this.updatePasswordCharacterOptionsStatuses(t,r>="a"&&r<="z",r>="A"&&r<="Z",r>="0"&&r<="9",this.allowedNonAlphanumericCharacters.includes(r))}updatePasswordCharacterOptionsStatuses(e,t,r,s,i){this.customStrengthOptions.containsLowercaseLetter&&(e.containsLowercaseLetter||(e.containsLowercaseLetter=t)),this.customStrengthOptions.containsUppercaseLetter&&(e.containsUppercaseLetter||(e.containsUppercaseLetter=r)),this.customStrengthOptions.containsNumericCharacter&&(e.containsNumericCharacter||(e.containsNumericCharacter=s)),this.customStrengthOptions.containsNonAlphanumericCharacter&&(e.containsNonAlphanumericCharacter||(e.containsNonAlphanumericCharacter=i))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ZU{constructor(e,t,r,s){this.app=e,this.heartbeatServiceProvider=t,this.appCheckServiceProvider=r,this.config=s,this.currentUser=null,this.emulatorConfig=null,this.operations=Promise.resolve(),this.authStateSubscription=new ib(this),this.idTokenSubscription=new ib(this),this.beforeStateQueue=new QU(this),this.redirectUser=null,this.isProactiveRefreshEnabled=!1,this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION=1,this._canInitEmulator=!0,this._isInitialized=!1,this._deleted=!1,this._initializationPromise=null,this._popupRedirectResolver=null,this._errorFactory=xP,this._agentRecaptchaConfig=null,this._tenantRecaptchaConfigs={},this._projectPasswordPolicy=null,this._tenantPasswordPolicies={},this._resolvePersistenceManagerAvailable=void 0,this.lastNotifiedUid=void 0,this.languageCode=null,this.tenantId=null,this.settings={appVerificationDisabledForTesting:!1},this.frameworks=[],this.name=e.name,this.clientVersion=s.sdkClientVersion,this._persistenceManagerAvailable=new Promise(i=>this._resolvePersistenceManagerAvailable=i)}_initializeWithPersistence(e,t){return t&&(this._popupRedirectResolver=ui(t)),this._initializationPromise=this.queue(async()=>{var r,s,i;if(!this._deleted&&(this.persistenceManager=await Wl.create(this,e),(r=this._resolvePersistenceManagerAvailable)==null||r.call(this),!this._deleted)){if((s=this._popupRedirectResolver)!=null&&s._shouldInitProactively)try{await this._popupRedirectResolver._initialize(this)}catch{}await this.initializeCurrentUser(t),this.lastNotifiedUid=((i=this.currentUser)==null?void 0:i.uid)||null,!this._deleted&&(this._isInitialized=!0)}}),this._initializationPromise}async _onStorageEvent(){if(this._deleted)return;const e=await this.assertedPersistence.getCurrentUser();if(!(!this.currentUser&&!e)){if(this.currentUser&&e&&this.currentUser.uid===e.uid){this._currentUser._assign(e),await this.currentUser.getIdToken();return}await this._updateCurrentUser(e,!0)}}async initializeCurrentUserFromIdToken(e){try{const t=await op(this,{idToken:e}),r=await gs._fromGetAccountInfoResponse(this,t,e);await this.directlySetCurrentUser(r)}catch(t){console.warn("FirebaseServerApp could not login user with provided authIdToken: ",t),await this.directlySetCurrentUser(null)}}async initializeCurrentUser(e){var i;if(Kt(this.app)){const o=this.app.settings.authIdToken;return o?new Promise(a=>{setTimeout(()=>this.initializeCurrentUserFromIdToken(o).then(a,a))}):this.directlySetCurrentUser(null)}const t=await this.assertedPersistence.getCurrentUser();let r=t,s=!1;if(e&&this.config.authDomain){await this.getOrInitRedirectPersistenceManager();const o=(i=this.redirectUser)==null?void 0:i._redirectEventId,a=r==null?void 0:r._redirectEventId,l=await this.tryRedirectSignIn(e);(!o||o===a)&&(l!=null&&l.user)&&(r=l.user,s=!0)}if(!r)return this.directlySetCurrentUser(null);if(!r._redirectEventId){if(s)try{await this.beforeStateQueue.runMiddleware(r)}catch(o){r=t,this._popupRedirectResolver._overrideRedirectResult(this,()=>Promise.reject(o))}return r?this.reloadAndSetCurrentUserOrClear(r):this.directlySetCurrentUser(null)}return X(this._popupRedirectResolver,this,"argument-error"),await this.getOrInitRedirectPersistenceManager(),this.redirectUser&&this.redirectUser._redirectEventId===r._redirectEventId?this.directlySetCurrentUser(r):this.reloadAndSetCurrentUserOrClear(r)}async tryRedirectSignIn(e){let t=null;try{t=await this._popupRedirectResolver._completeRedirectFn(this,e,!0)}catch{await this._setRedirectUser(null)}return t}async reloadAndSetCurrentUserOrClear(e){try{await Hd(e)}catch(t){if((t==null?void 0:t.code)!=="auth/network-request-failed")return this.directlySetCurrentUser(null)}return this.directlySetCurrentUser(e)}useDeviceLanguage(){this.languageCode=kU()}async _delete(){this._deleted=!0}async updateCurrentUser(e){if(Kt(this.app))return Promise.reject(Dn(this));const t=e?ae(e):null;return t&&X(t.auth.config.apiKey===this.config.apiKey,this,"invalid-user-token"),this._updateCurrentUser(t&&t._clone(this))}async _updateCurrentUser(e,t=!1){if(!this._deleted)return e&&X(this.tenantId===e.tenantId,this,"tenant-id-mismatch"),t||await this.beforeStateQueue.runMiddleware(e),this.queue(async()=>{await this.directlySetCurrentUser(e),this.notifyAuthListeners()})}async signOut(){return Kt(this.app)?Promise.reject(Dn(this)):(await this.beforeStateQueue.runMiddleware(null),(this.redirectPersistenceManager||this._popupRedirectResolver)&&await this._setRedirectUser(null),this._updateCurrentUser(null,!0))}setPersistence(e){return Kt(this.app)?Promise.reject(Dn(this)):this.queue(async()=>{await this.assertedPersistence.setPersistence(ui(e))})}_getRecaptchaConfig(){return this.tenantId==null?this._agentRecaptchaConfig:this._tenantRecaptchaConfigs[this.tenantId]}async validatePassword(e){this._getPasswordPolicyInternal()||await this._updatePasswordPolicy();const t=this._getPasswordPolicyInternal();return t.schemaVersion!==this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION?Promise.reject(this._errorFactory.create("unsupported-password-policy-schema-version",{})):t.validatePassword(e)}_getPasswordPolicyInternal(){return this.tenantId===null?this._projectPasswordPolicy:this._tenantPasswordPolicies[this.tenantId]}async _updatePasswordPolicy(){const e=await YU(this),t=new XU(e);this.tenantId===null?this._projectPasswordPolicy=t:this._tenantPasswordPolicies[this.tenantId]=t}_getPersistenceType(){return this.assertedPersistence.persistence.type}_getPersistence(){return this.assertedPersistence.persistence}_updateErrorMap(e){this._errorFactory=new qa("auth","Firebase",e())}onAuthStateChanged(e,t,r){return this.registerStateListener(this.authStateSubscription,e,t,r)}beforeAuthStateChanged(e,t){return this.beforeStateQueue.pushCallback(e,t)}onIdTokenChanged(e,t,r){return this.registerStateListener(this.idTokenSubscription,e,t,r)}authStateReady(){return new Promise((e,t)=>{if(this.currentUser)e();else{const r=this.onAuthStateChanged(()=>{r(),e()},t)}})}async revokeAccessToken(e){if(this.currentUser){const t=await this.currentUser.getIdToken(),r={providerId:"apple.com",tokenType:"ACCESS_TOKEN",token:e,idToken:t};this.tenantId!=null&&(r.tenantId=this.tenantId),await GU(this,r)}}toJSON(){var e;return{apiKey:this.config.apiKey,authDomain:this.config.authDomain,appName:this.name,currentUser:(e=this._currentUser)==null?void 0:e.toJSON()}}async _setRedirectUser(e,t){const r=await this.getOrInitRedirectPersistenceManager(t);return e===null?r.removeCurrentUser():r.setCurrentUser(e)}async getOrInitRedirectPersistenceManager(e){if(!this.redirectPersistenceManager){const t=e&&ui(e)||this._popupRedirectResolver;X(t,this,"argument-error"),this.redirectPersistenceManager=await Wl.create(this,[ui(t._redirectPersistence)],"redirectUser"),this.redirectUser=await this.redirectPersistenceManager.getCurrentUser()}return this.redirectPersistenceManager}async _redirectUserForId(e){var t,r;return this._isInitialized&&await this.queue(async()=>{}),((t=this._currentUser)==null?void 0:t._redirectEventId)===e?this._currentUser:((r=this.redirectUser)==null?void 0:r._redirectEventId)===e?this.redirectUser:null}async _persistUserIfCurrent(e){if(e===this.currentUser)return this.queue(async()=>this.directlySetCurrentUser(e))}_notifyListenersIfCurrent(e){e===this.currentUser&&this.notifyAuthListeners()}_key(){return`${this.config.authDomain}:${this.config.apiKey}:${this.name}`}_startProactiveRefresh(){this.isProactiveRefreshEnabled=!0,this.currentUser&&this._currentUser._startProactiveRefresh()}_stopProactiveRefresh(){this.isProactiveRefreshEnabled=!1,this.currentUser&&this._currentUser._stopProactiveRefresh()}get _currentUser(){return this.currentUser}notifyAuthListeners(){var t;if(!this._isInitialized)return;this.idTokenSubscription.next(this.currentUser);const e=((t=this.currentUser)==null?void 0:t.uid)??null;this.lastNotifiedUid!==e&&(this.lastNotifiedUid=e,this.authStateSubscription.next(this.currentUser))}registerStateListener(e,t,r,s){if(this._deleted)return()=>{};const i=typeof t=="function"?t:t.next.bind(t);let o=!1;const a=this._isInitialized?Promise.resolve():this._initializationPromise;if(X(a,this,"internal-error"),a.then(()=>{o||i(this.currentUser)}),typeof t=="function"){const l=e.addObserver(t,r,s);return()=>{o=!0,l()}}else{const l=e.addObserver(t);return()=>{o=!0,l()}}}async directlySetCurrentUser(e){this.currentUser&&this.currentUser!==e&&this._currentUser._stopProactiveRefresh(),e&&this.isProactiveRefreshEnabled&&e._startProactiveRefresh(),this.currentUser=e,e?await this.assertedPersistence.setCurrentUser(e):await this.assertedPersistence.removeCurrentUser()}queue(e){return this.operations=this.operations.then(e,e),this.operations}get assertedPersistence(){return X(this.persistenceManager,this,"internal-error"),this.persistenceManager}_logFramework(e){!e||this.frameworks.includes(e)||(this.frameworks.push(e),this.frameworks.sort(),this.clientVersion=VP(this.config.clientPlatform,this._getFrameworks()))}_getFrameworks(){return this.frameworks}async _getAdditionalHeaders(){var s;const e={"X-Client-Version":this.clientVersion};this.app.options.appId&&(e["X-Firebase-gmpid"]=this.app.options.appId);const t=await((s=this.heartbeatServiceProvider.getImmediate({optional:!0}))==null?void 0:s.getHeartbeatsHeader());t&&(e["X-Firebase-Client"]=t);const r=await this._getAppCheckToken();return r&&(e["X-Firebase-AppCheck"]=r),e}async _getAppCheckToken(){var t;if(Kt(this.app)&&this.app.settings.appCheckToken)return this.app.settings.appCheckToken;const e=await((t=this.appCheckServiceProvider.getImmediate({optional:!0}))==null?void 0:t.getToken());return e!=null&&e.error&&RU(`Error while retrieving App Check token: ${e.error}`),e==null?void 0:e.token}}function ln(n){return ae(n)}class ib{constructor(e){this.auth=e,this.observer=null,this.addObserver=eO(t=>this.observer=t)}get next(){return X(this.observer,this.auth,"internal-error"),this.observer.next.bind(this.observer)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Nh={async loadJS(){throw new Error("Unable to load external scripts")},recaptchaV2Script:"",recaptchaEnterpriseScript:"",gapiScript:""};function e$(n){Nh=n}function kx(n){return Nh.loadJS(n)}function t$(){return Nh.recaptchaV2Script}function n$(){return Nh.recaptchaEnterpriseScript}function r$(){return Nh.gapiScript}function FP(n){return`__${n}${Math.floor(Math.random()*1e6)}`}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const s$=500,i$=6e4,wf=1e12;class o${constructor(e){this.auth=e,this.counter=wf,this._widgets=new Map}render(e,t){const r=this.counter;return this._widgets.set(r,new c$(e,this.auth.name,t||{})),this.counter++,r}reset(e){var r;const t=e||wf;(r=this._widgets.get(t))==null||r.delete(),this._widgets.delete(t)}getResponse(e){var r;const t=e||wf;return((r=this._widgets.get(t))==null?void 0:r.getResponse())||""}async execute(e){var r;const t=e||wf;return(r=this._widgets.get(t))==null||r.execute(),""}}class a${constructor(){this.enterprise=new l$}ready(e){e()}execute(e,t){return Promise.resolve("token")}render(e,t){return""}}class l${ready(e){e()}execute(e,t){return Promise.resolve("token")}render(e,t){return""}}class c${constructor(e,t,r){this.params=r,this.timerId=null,this.deleted=!1,this.responseToken=null,this.clickHandler=()=>{this.execute()};const s=typeof e=="string"?document.getElementById(e):e;X(s,"argument-error",{appName:t}),this.container=s,this.isVisible=this.params.size!=="invisible",this.isVisible?this.execute():this.container.addEventListener("click",this.clickHandler)}getResponse(){return this.checkIfDeleted(),this.responseToken}delete(){this.checkIfDeleted(),this.deleted=!0,this.timerId&&(clearTimeout(this.timerId),this.timerId=null),this.container.removeEventListener("click",this.clickHandler)}execute(){this.checkIfDeleted(),!this.timerId&&(this.timerId=window.setTimeout(()=>{this.responseToken=u$(50);const{callback:e,"expired-callback":t}=this.params;if(e)try{e(this.responseToken)}catch{}this.timerId=window.setTimeout(()=>{if(this.timerId=null,this.responseToken=null,t)try{t()}catch{}this.isVisible&&this.execute()},i$)},s$))}checkIfDeleted(){if(this.deleted)throw new Error("reCAPTCHA mock was already deleted!")}}function u$(n){const e=[],t="1234567890abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ";for(let r=0;r<n;r++)e.push(t.charAt(Math.floor(Math.random()*t.length)));return e.join("")}const d$="recaptcha-enterprise",nd="NO_RECAPTCHA";class jP{constructor(e){this.type=d$,this.auth=ln(e)}async verify(e="verify",t=!1){async function r(i){if(!t){if(i.tenantId==null&&i._agentRecaptchaConfig!=null)return i._agentRecaptchaConfig.siteKey;if(i.tenantId!=null&&i._tenantRecaptchaConfigs[i.tenantId]!==void 0)return i._tenantRecaptchaConfigs[i.tenantId].siteKey}return new Promise(async(o,a)=>{bP(i,{clientType:"CLIENT_TYPE_WEB",version:"RECAPTCHA_ENTERPRISE"}).then(l=>{if(l.recaptchaKey===void 0)a(new Error("recaptcha Enterprise site key undefined"));else{const u=new TP(l);return i.tenantId==null?i._agentRecaptchaConfig=u:i._tenantRecaptchaConfigs[i.tenantId]=u,o(u.siteKey)}}).catch(l=>{a(l)})})}function s(i,o,a){const l=window.grecaptcha;eb(l)?l.enterprise.ready(()=>{l.enterprise.execute(i,{action:e}).then(u=>{o(u)}).catch(()=>{o(nd)})}):a(Error("No reCAPTCHA enterprise script loaded."))}return this.auth.settings.appVerificationDisabledForTesting?new a$().execute("siteKey",{action:"verify"}):new Promise((i,o)=>{r(this.auth).then(a=>{if(!t&&eb(window.grecaptcha))s(a,i,o);else{if(typeof window>"u"){o(new Error("RecaptchaVerifier is only supported in browser"));return}let l=n$();l.length!==0&&(l+=a),kx(l).then(()=>{s(a,i,o)}).catch(u=>{o(u)})}}).catch(a=>{o(a)})})}}async function _u(n,e,t,r=!1,s=!1){const i=new jP(n);let o;if(s)o=nd;else try{o=await i.verify(t)}catch{o=await i.verify(t,!0)}const a={...e};if(t==="mfaSmsEnrollment"||t==="mfaSmsSignIn"){if("phoneEnrollmentInfo"in a){const l=a.phoneEnrollmentInfo.phoneNumber,u=a.phoneEnrollmentInfo.recaptchaToken;Object.assign(a,{phoneEnrollmentInfo:{phoneNumber:l,recaptchaToken:u,captchaResponse:o,clientType:"CLIENT_TYPE_WEB",recaptchaVersion:"RECAPTCHA_ENTERPRISE"}})}else if("phoneSignInInfo"in a){const l=a.phoneSignInInfo.recaptchaToken;Object.assign(a,{phoneSignInInfo:{recaptchaToken:l,captchaResponse:o,clientType:"CLIENT_TYPE_WEB",recaptchaVersion:"RECAPTCHA_ENTERPRISE"}})}return a}return r?Object.assign(a,{captchaResp:o}):Object.assign(a,{captchaResponse:o}),Object.assign(a,{clientType:"CLIENT_TYPE_WEB"}),Object.assign(a,{recaptchaVersion:"RECAPTCHA_ENTERPRISE"}),a}async function wo(n,e,t,r,s){var i,o;if(s==="EMAIL_PASSWORD_PROVIDER")if((i=n._getRecaptchaConfig())!=null&&i.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")){const a=await _u(n,e,t,t==="getOobCode");return r(n,a)}else return r(n,e).catch(async a=>{if(a.code==="auth/missing-recaptcha-token"){console.log(`${t} is protected by reCAPTCHA Enterprise for this project. Automatically triggering the reCAPTCHA flow and restarting the flow.`);const l=await _u(n,e,t,t==="getOobCode");return r(n,l)}else return Promise.reject(a)});else if(s==="PHONE_PROVIDER")if((o=n._getRecaptchaConfig())!=null&&o.isProviderEnabled("PHONE_PROVIDER")){const a=await _u(n,e,t);return r(n,a).catch(async l=>{var u;if(((u=n._getRecaptchaConfig())==null?void 0:u.getProviderEnforcementState("PHONE_PROVIDER"))==="AUDIT"&&(l.code==="auth/missing-recaptcha-token"||l.code==="auth/invalid-app-credential")){console.log(`Failed to verify with reCAPTCHA Enterprise. Automatically triggering the reCAPTCHA v2 flow to complete the ${t} flow.`);const h=await _u(n,e,t,!1,!0);return r(n,h)}return Promise.reject(l)})}else{const a=await _u(n,e,t,!1,!0);return r(n,a)}else return Promise.reject(s+" provider is not supported.")}async function UP(n){const e=ln(n),t=await bP(e,{clientType:"CLIENT_TYPE_WEB",version:"RECAPTCHA_ENTERPRISE"}),r=new TP(t);e.tenantId==null?e._agentRecaptchaConfig=r:e._tenantRecaptchaConfigs[e.tenantId]=r,r.isAnyProviderEnabled()&&new jP(e).verify()}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function h$(n,e){const t=Qs(n,"auth");if(t.isInitialized()){const s=t.getImmediate(),i=t.getOptions();if(Ur(i,e??{}))return s;Tr(s,"already-initialized")}return t.initialize({options:e})}function f$(n,e){const t=(e==null?void 0:e.persistence)||[],r=(Array.isArray(t)?t:[t]).map(ui);e!=null&&e.errorMap&&n._updateErrorMap(e.errorMap),n._initializeWithPersistence(r,e==null?void 0:e.popupRedirectResolver)}function g$(n,e,t){const r=ln(n);X(/^https?:\/\//.test(e),r,"invalid-emulator-scheme");const s=!!(t!=null&&t.disableWarnings),i=$P(e),{host:o,port:a}=p$(e),l=a===null?"":`:${a}`,u={url:`${i}//${o}${l}/`},h=Object.freeze({host:o,port:a,protocol:i.replace(":",""),options:Object.freeze({disableWarnings:s})});if(!r._canInitEmulator){X(r.config.emulator&&r.emulatorConfig,r,"emulator-config-failed"),X(Ur(u,r.config.emulator)&&Ur(h,r.emulatorConfig),r,"emulator-config-failed");return}r.config.emulator=u,r.emulatorConfig=h,r.settings.appVerificationDisabledForTesting=!0,bi(o)?(Rp(`${i}//${o}${l}`),P0("Auth",!0)):s||m$()}function $P(n){const e=n.indexOf(":");return e<0?"":n.substr(0,e+1)}function p$(n){const e=$P(n),t=/(\/\/)?([^?#/]+)/.exec(n.substr(e.length));if(!t)return{host:"",port:null};const r=t[2].split("@").pop()||"",s=/^(\[[^\]]+\])(:|$)/.exec(r);if(s){const i=s[1];return{host:i,port:ob(r.substr(i.length+1))}}else{const[i,o]=r.split(":");return{host:i,port:ob(o)}}}function ob(n){if(!n)return null;const e=Number(n);return isNaN(e)?null:e}function m$(){function n(){const e=document.createElement("p"),t=e.style;e.innerText="Running in emulator mode. Do not use with production credentials.",t.position="fixed",t.width="100%",t.backgroundColor="#ffffff",t.border=".1em solid #000000",t.color="#b50000",t.bottom="0px",t.left="0px",t.margin="0px",t.zIndex="10000",t.textAlign="center",e.classList.add("firebase-emulator-warning"),document.body.appendChild(e)}typeof console<"u"&&typeof console.info=="function"&&console.info("WARNING: You are using the Auth Emulator, which is intended for local testing only.  Do not use with production credentials."),typeof window<"u"&&typeof document<"u"&&(document.readyState==="loading"?window.addEventListener("DOMContentLoaded",n):n())}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class kh{constructor(e,t){this.providerId=e,this.signInMethod=t}toJSON(){return Fs("not implemented")}_getIdTokenResponse(e){return Fs("not implemented")}_linkToIdToken(e,t){return Fs("not implemented")}_getReauthenticationResolver(e){return Fs("not implemented")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function BP(n,e){return zt(n,"POST","/v1/accounts:resetPassword",Bt(n,e))}async function y$(n,e){return zt(n,"POST","/v1/accounts:update",e)}async function _$(n,e){return zt(n,"POST","/v1/accounts:signUp",e)}async function v$(n,e){return zt(n,"POST","/v1/accounts:update",Bt(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function w$(n,e){return ki(n,"POST","/v1/accounts:signInWithPassword",Bt(n,e))}async function Tm(n,e){return zt(n,"POST","/v1/accounts:sendOobCode",Bt(n,e))}async function x$(n,e){return Tm(n,e)}async function I$(n,e){return Tm(n,e)}async function E$(n,e){return Tm(n,e)}async function S$(n,e){return Tm(n,e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function T$(n,e){return ki(n,"POST","/v1/accounts:signInWithEmailLink",Bt(n,e))}async function b$(n,e){return ki(n,"POST","/v1/accounts:signInWithEmailLink",Bt(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Kd extends kh{constructor(e,t,r,s=null){super("password",r),this._email=e,this._password=t,this._tenantId=s}static _fromEmailAndPassword(e,t){return new Kd(e,t,"password")}static _fromEmailAndCode(e,t,r=null){return new Kd(e,t,"emailLink",r)}toJSON(){return{email:this._email,password:this._password,signInMethod:this.signInMethod,tenantId:this._tenantId}}static fromJSON(e){const t=typeof e=="string"?JSON.parse(e):e;if(t!=null&&t.email&&(t!=null&&t.password)){if(t.signInMethod==="password")return this._fromEmailAndPassword(t.email,t.password);if(t.signInMethod==="emailLink")return this._fromEmailAndCode(t.email,t.password,t.tenantId)}return null}async _getIdTokenResponse(e){switch(this.signInMethod){case"password":const t={returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"};return wo(e,t,"signInWithPassword",w$,"EMAIL_PASSWORD_PROVIDER");case"emailLink":return T$(e,{email:this._email,oobCode:this._password});default:Tr(e,"internal-error")}}async _linkToIdToken(e,t){switch(this.signInMethod){case"password":const r={idToken:t,returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"};return wo(e,r,"signUpPassword",_$,"EMAIL_PASSWORD_PROVIDER");case"emailLink":return b$(e,{idToken:t,email:this._email,oobCode:this._password});default:Tr(e,"internal-error")}}_getReauthenticationResolver(e){return this._getIdTokenResponse(e)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function fi(n,e){return ki(n,"POST","/v1/accounts:signInWithIdp",Bt(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const A$="http://localhost";class Si extends kh{constructor(){super(...arguments),this.pendingToken=null}static _fromParams(e){const t=new Si(e.providerId,e.signInMethod);return e.idToken||e.accessToken?(e.idToken&&(t.idToken=e.idToken),e.accessToken&&(t.accessToken=e.accessToken),e.nonce&&!e.pendingToken&&(t.nonce=e.nonce),e.pendingToken&&(t.pendingToken=e.pendingToken)):e.oauthToken&&e.oauthTokenSecret?(t.accessToken=e.oauthToken,t.secret=e.oauthTokenSecret):Tr("argument-error"),t}toJSON(){return{idToken:this.idToken,accessToken:this.accessToken,secret:this.secret,nonce:this.nonce,pendingToken:this.pendingToken,providerId:this.providerId,signInMethod:this.signInMethod}}static fromJSON(e){const t=typeof e=="string"?JSON.parse(e):e,{providerId:r,signInMethod:s,...i}=t;if(!r||!s)return null;const o=new Si(r,s);return o.idToken=i.idToken||void 0,o.accessToken=i.accessToken||void 0,o.secret=i.secret,o.nonce=i.nonce,o.pendingToken=i.pendingToken||null,o}_getIdTokenResponse(e){const t=this.buildRequest();return fi(e,t)}_linkToIdToken(e,t){const r=this.buildRequest();return r.idToken=t,fi(e,r)}_getReauthenticationResolver(e){const t=this.buildRequest();return t.autoCreate=!1,fi(e,t)}buildRequest(){const e={requestUri:A$,returnSecureToken:!0};if(this.pendingToken)e.pendingToken=this.pendingToken;else{const t={};this.idToken&&(t.id_token=this.idToken),this.accessToken&&(t.access_token=this.accessToken),this.secret&&(t.oauth_token_secret=this.secret),t.providerId=this.providerId,this.nonce&&!this.pendingToken&&(t.nonce=this.nonce),e.postBody=Wa(t)}return e}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function ab(n,e){return zt(n,"POST","/v1/accounts:sendVerificationCode",Bt(n,e))}async function C$(n,e){return ki(n,"POST","/v1/accounts:signInWithPhoneNumber",Bt(n,e))}async function R$(n,e){const t=await ki(n,"POST","/v1/accounts:signInWithPhoneNumber",Bt(n,e));if(t.temporaryProof)throw Nu(n,"account-exists-with-different-credential",t);return t}const N$={USER_NOT_FOUND:"user-not-found"};async function k$(n,e){const t={...e,operation:"REAUTH"};return ki(n,"POST","/v1/accounts:signInWithPhoneNumber",Bt(n,t),N$)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class va extends kh{constructor(e){super("phone","phone"),this.params=e}static _fromVerification(e,t){return new va({verificationId:e,verificationCode:t})}static _fromTokenResponse(e,t){return new va({phoneNumber:e,temporaryProof:t})}_getIdTokenResponse(e){return C$(e,this._makeVerificationRequest())}_linkToIdToken(e,t){return R$(e,{idToken:t,...this._makeVerificationRequest()})}_getReauthenticationResolver(e){return k$(e,this._makeVerificationRequest())}_makeVerificationRequest(){const{temporaryProof:e,phoneNumber:t,verificationId:r,verificationCode:s}=this.params;return e&&t?{temporaryProof:e,phoneNumber:t}:{sessionInfo:r,code:s}}toJSON(){const e={providerId:this.providerId};return this.params.phoneNumber&&(e.phoneNumber=this.params.phoneNumber),this.params.temporaryProof&&(e.temporaryProof=this.params.temporaryProof),this.params.verificationCode&&(e.verificationCode=this.params.verificationCode),this.params.verificationId&&(e.verificationId=this.params.verificationId),e}static fromJSON(e){typeof e=="string"&&(e=JSON.parse(e));const{verificationId:t,verificationCode:r,phoneNumber:s,temporaryProof:i}=e;return!r&&!t&&!s&&!i?null:new va({verificationId:t,verificationCode:r,phoneNumber:s,temporaryProof:i})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function P$(n){switch(n){case"recoverEmail":return"RECOVER_EMAIL";case"resetPassword":return"PASSWORD_RESET";case"signIn":return"EMAIL_SIGNIN";case"verifyEmail":return"VERIFY_EMAIL";case"verifyAndChangeEmail":return"VERIFY_AND_CHANGE_EMAIL";case"revertSecondFactorAddition":return"REVERT_SECOND_FACTOR_ADDITION";default:return null}}function D$(n){const e=Eu(Su(n)).link,t=e?Eu(Su(e)).deep_link_id:null,r=Eu(Su(n)).deep_link_id;return(r?Eu(Su(r)).link:null)||r||t||e||n}class Ph{constructor(e){const t=Eu(Su(e)),r=t.apiKey??null,s=t.oobCode??null,i=P$(t.mode??null);X(r&&s&&i,"argument-error"),this.apiKey=r,this.operation=i,this.code=s,this.continueUrl=t.continueUrl??null,this.languageCode=t.lang??null,this.tenantId=t.tenantId??null}static parseLink(e){const t=D$(e);try{return new Ph(t)}catch{return null}}}function N7(n){return Ph.parseLink(n)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class nl{constructor(){this.providerId=nl.PROVIDER_ID}static credential(e,t){return Kd._fromEmailAndPassword(e,t)}static credentialWithLink(e,t){const r=Ph.parseLink(t);return X(r,"argument-error"),Kd._fromEmailAndCode(e,r.code,r.tenantId)}}nl.PROVIDER_ID="password";nl.EMAIL_PASSWORD_SIGN_IN_METHOD="password";nl.EMAIL_LINK_SIGN_IN_METHOD="emailLink";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Pi{constructor(e){this.providerId=e,this.defaultLanguageCode=null,this.customParameters={}}setDefaultLanguage(e){this.defaultLanguageCode=e}setCustomParameters(e){return this.customParameters=e,this}getCustomParameters(){return this.customParameters}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Hc extends Pi{constructor(){super(...arguments),this.scopes=[]}addScope(e){return this.scopes.includes(e)||this.scopes.push(e),this}getScopes(){return[...this.scopes]}}class Zf extends Hc{static credentialFromJSON(e){const t=typeof e=="string"?JSON.parse(e):e;return X("providerId"in t&&"signInMethod"in t,"argument-error"),Si._fromParams(t)}credential(e){return this._credential({...e,nonce:e.rawNonce})}_credential(e){return X(e.idToken||e.accessToken,"argument-error"),Si._fromParams({...e,providerId:this.providerId,signInMethod:this.providerId})}static credentialFromResult(e){return Zf.oauthCredentialFromTaggedObject(e)}static credentialFromError(e){return Zf.oauthCredentialFromTaggedObject(e.customData||{})}static oauthCredentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthIdToken:t,oauthAccessToken:r,oauthTokenSecret:s,pendingToken:i,nonce:o,providerId:a}=e;if(!r&&!s&&!t&&!i||!a)return null;try{return new Zf(a)._credential({idToken:t,accessToken:r,nonce:o,pendingToken:i})}catch{return null}}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ki extends Hc{constructor(){super("facebook.com")}static credential(e){return Si._fromParams({providerId:Ki.PROVIDER_ID,signInMethod:Ki.FACEBOOK_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return Ki.credentialFromTaggedObject(e)}static credentialFromError(e){return Ki.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return Ki.credential(e.oauthAccessToken)}catch{return null}}}Ki.FACEBOOK_SIGN_IN_METHOD="facebook.com";Ki.PROVIDER_ID="facebook.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ii extends Hc{constructor(){super("google.com"),this.addScope("profile")}static credential(e,t){return Si._fromParams({providerId:ii.PROVIDER_ID,signInMethod:ii.GOOGLE_SIGN_IN_METHOD,idToken:e,accessToken:t})}static credentialFromResult(e){return ii.credentialFromTaggedObject(e)}static credentialFromError(e){return ii.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthIdToken:t,oauthAccessToken:r}=e;if(!t&&!r)return null;try{return ii.credential(t,r)}catch{return null}}}ii.GOOGLE_SIGN_IN_METHOD="google.com";ii.PROVIDER_ID="google.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Qi extends Hc{constructor(){super("github.com")}static credential(e){return Si._fromParams({providerId:Qi.PROVIDER_ID,signInMethod:Qi.GITHUB_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return Qi.credentialFromTaggedObject(e)}static credentialFromError(e){return Qi.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return Qi.credential(e.oauthAccessToken)}catch{return null}}}Qi.GITHUB_SIGN_IN_METHOD="github.com";Qi.PROVIDER_ID="github.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const M$="http://localhost";class Qd extends kh{constructor(e,t){super(e,e),this.pendingToken=t}_getIdTokenResponse(e){const t=this.buildRequest();return fi(e,t)}_linkToIdToken(e,t){const r=this.buildRequest();return r.idToken=t,fi(e,r)}_getReauthenticationResolver(e){const t=this.buildRequest();return t.autoCreate=!1,fi(e,t)}toJSON(){return{signInMethod:this.signInMethod,providerId:this.providerId,pendingToken:this.pendingToken}}static fromJSON(e){const t=typeof e=="string"?JSON.parse(e):e,{providerId:r,signInMethod:s,pendingToken:i}=t;return!r||!s||!i||r!==s?null:new Qd(r,i)}static _create(e,t){return new Qd(e,t)}buildRequest(){return{requestUri:M$,returnSecureToken:!0,pendingToken:this.pendingToken}}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const L$="saml.";class Mv extends Pi{constructor(e){X(e.startsWith(L$),"argument-error"),super(e)}static credentialFromResult(e){return Mv.samlCredentialFromTaggedObject(e)}static credentialFromError(e){return Mv.samlCredentialFromTaggedObject(e.customData||{})}static credentialFromJSON(e){const t=Qd.fromJSON(e);return X(t,"argument-error"),t}static samlCredentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{pendingToken:t,providerId:r}=e;if(!t||!r)return null;try{return Qd._create(r,t)}catch{return null}}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Yi extends Hc{constructor(){super("twitter.com")}static credential(e,t){return Si._fromParams({providerId:Yi.PROVIDER_ID,signInMethod:Yi.TWITTER_SIGN_IN_METHOD,oauthToken:e,oauthTokenSecret:t})}static credentialFromResult(e){return Yi.credentialFromTaggedObject(e)}static credentialFromError(e){return Yi.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthAccessToken:t,oauthTokenSecret:r}=e;if(!t||!r)return null;try{return Yi.credential(t,r)}catch{return null}}}Yi.TWITTER_SIGN_IN_METHOD="twitter.com";Yi.PROVIDER_ID="twitter.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function zP(n,e){return ki(n,"POST","/v1/accounts:signUp",Bt(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ss{constructor(e){this.user=e.user,this.providerId=e.providerId,this._tokenResponse=e._tokenResponse,this.operationType=e.operationType}static async _fromIdTokenResponse(e,t,r,s=!1){const i=await gs._fromIdTokenResponse(e,r,s),o=lb(r);return new ss({user:i,providerId:o,_tokenResponse:r,operationType:t})}static async _forOperation(e,t,r){await e._updateTokensIfNecessary(r,!0);const s=lb(r);return new ss({user:e,providerId:s,_tokenResponse:r,operationType:t})}}function lb(n){return n.providerId?n.providerId:"phoneNumber"in n?"phone":null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function k7(n){var s;if(Kt(n.app))return Promise.reject(Dn(n));const e=ln(n);if(await e._initializationPromise,(s=e.currentUser)!=null&&s.isAnonymous)return new ss({user:e.currentUser,providerId:null,operationType:"signIn"});const t=await zP(e,{returnSecureToken:!0}),r=await ss._fromIdTokenResponse(e,"signIn",t,!0);return await e._updateCurrentUser(r.user),r}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ap extends xs{constructor(e,t,r,s){super(t.code,t.message),this.operationType=r,this.user=s,Object.setPrototypeOf(this,ap.prototype),this.customData={appName:e.name,tenantId:e.tenantId??void 0,_serverResponse:t.customData._serverResponse,operationType:r}}static _fromErrorAndOperation(e,t,r,s){return new ap(e,t,r,s)}}function qP(n,e,t,r){return(e==="reauthenticate"?t._getReauthenticationResolver(n):t._getIdTokenResponse(n)).catch(i=>{throw i.code==="auth/multi-factor-auth-required"?ap._fromErrorAndOperation(n,i,e,r):i})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function WP(n){return new Set(n.map(({providerId:e})=>e).filter(e=>!!e))}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function P7(n,e){const t=ae(n);await bm(!0,t,e);const{providerUserInfo:r}=await jU(t.auth,{idToken:await t.getIdToken(),deleteProvider:[e]}),s=WP(r||[]);return t.providerData=t.providerData.filter(i=>s.has(i.providerId)),s.has("phone")||(t.phoneNumber=null),await t.auth._persistUserIfCurrent(t),t}async function Px(n,e,t=!1){const r=await Ei(n,e._linkToIdToken(n.auth,await n.getIdToken()),t);return ss._forOperation(n,"link",r)}async function bm(n,e,t){await Hd(e);const r=WP(e.providerData),s=n===!1?"provider-already-linked":"no-such-provider";X(r.has(t)===n,e.auth,s)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function GP(n,e,t=!1){const{auth:r}=n;if(Kt(r.app))return Promise.reject(Dn(r));const s="reauthenticate";try{const i=await Ei(n,qP(r,s,e,n),t);X(i.idToken,r,"internal-error");const o=Sm(i.idToken);X(o,r,"internal-error");const{sub:a}=o;return X(n.uid===a,r,"user-mismatch"),ss._forOperation(n,s,i)}catch(i){throw(i==null?void 0:i.code)==="auth/user-not-found"&&Tr(r,"user-mismatch"),i}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function HP(n,e,t=!1){if(Kt(n.app))return Promise.reject(Dn(n));const r="signIn",s=await qP(n,r,e),i=await ss._fromIdTokenResponse(n,r,s);return t||await n._updateCurrentUser(i.user),i}async function Dx(n,e){return HP(ln(n),e)}async function O$(n,e){const t=ae(n);return await bm(!1,t,e.providerId),Px(t,e)}async function V$(n,e){return GP(ae(n),e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function F$(n,e){return ki(n,"POST","/v1/accounts:signInWithCustomToken",Bt(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function D7(n,e){if(Kt(n.app))return Promise.reject(Dn(n));const t=ln(n),r=await F$(t,{token:e,returnSecureToken:!0}),s=await ss._fromIdTokenResponse(t,"signIn",r);return await t._updateCurrentUser(s.user),s}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Dh{constructor(e,t){this.factorId=e,this.uid=t.mfaEnrollmentId,this.enrollmentTime=new Date(t.enrolledAt).toUTCString(),this.displayName=t.displayName}static _fromServerResponse(e,t){return"phoneInfo"in t?Mx._fromServerResponse(e,t):"totpInfo"in t?Lx._fromServerResponse(e,t):Tr(e,"internal-error")}}class Mx extends Dh{constructor(e){super("phone",e),this.phoneNumber=e.phoneInfo}static _fromServerResponse(e,t){return new Mx(t)}}class Lx extends Dh{constructor(e){super("totp",e)}static _fromServerResponse(e,t){return new Lx(t)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Am(n,e,t){var r;X(((r=t.url)==null?void 0:r.length)>0,n,"invalid-continue-uri"),X(typeof t.dynamicLinkDomain>"u"||t.dynamicLinkDomain.length>0,n,"invalid-dynamic-link-domain"),X(typeof t.linkDomain>"u"||t.linkDomain.length>0,n,"invalid-hosting-link-domain"),e.continueUrl=t.url,e.dynamicLinkDomain=t.dynamicLinkDomain,e.linkDomain=t.linkDomain,e.canHandleCodeInApp=t.handleCodeInApp,t.iOS&&(X(t.iOS.bundleId.length>0,n,"missing-ios-bundle-id"),e.iOSBundleId=t.iOS.bundleId),t.android&&(X(t.android.packageName.length>0,n,"missing-android-pkg-name"),e.androidInstallApp=t.android.installApp,e.androidMinimumVersionCode=t.android.minimumVersion,e.androidPackageName=t.android.packageName)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Ox(n){const e=ln(n);e._getPasswordPolicyInternal()&&await e._updatePasswordPolicy()}async function j$(n,e,t){const r=ln(n),s={requestType:"PASSWORD_RESET",email:e,clientType:"CLIENT_TYPE_WEB"};t&&Am(r,s,t),await wo(r,s,"getOobCode",I$,"EMAIL_PASSWORD_PROVIDER")}async function M7(n,e,t){await BP(ae(n),{oobCode:e,newPassword:t}).catch(async r=>{throw r.code==="auth/password-does-not-meet-requirements"&&Ox(n),r})}async function L7(n,e){await v$(ae(n),{oobCode:e})}async function U$(n,e){const t=ae(n),r=await BP(t,{oobCode:e}),s=r.requestType;switch(X(s,t,"internal-error"),s){case"EMAIL_SIGNIN":break;case"VERIFY_AND_CHANGE_EMAIL":X(r.newEmail,t,"internal-error");break;case"REVERT_SECOND_FACTOR_ADDITION":X(r.mfaInfo,t,"internal-error");default:X(r.email,t,"internal-error")}let i=null;return r.mfaInfo&&(i=Dh._fromServerResponse(ln(t),r.mfaInfo)),{data:{email:(r.requestType==="VERIFY_AND_CHANGE_EMAIL"?r.newEmail:r.email)||null,previousEmail:(r.requestType==="VERIFY_AND_CHANGE_EMAIL"?r.email:r.newEmail)||null,multiFactorInfo:i},operation:s}}async function O7(n,e){const{data:t}=await U$(ae(n),e);return t.email}async function $$(n,e,t){if(Kt(n.app))return Promise.reject(Dn(n));const r=ln(n),o=await wo(r,{returnSecureToken:!0,email:e,password:t,clientType:"CLIENT_TYPE_WEB"},"signUpPassword",zP,"EMAIL_PASSWORD_PROVIDER").catch(l=>{throw l.code==="auth/password-does-not-meet-requirements"&&Ox(n),l}),a=await ss._fromIdTokenResponse(r,"signIn",o);return await r._updateCurrentUser(a.user),a}function B$(n,e,t){return Kt(n.app)?Promise.reject(Dn(n)):Dx(ae(n),nl.credential(e,t)).catch(async r=>{throw r.code==="auth/password-does-not-meet-requirements"&&Ox(n),r})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function V7(n,e,t){const r=ln(n),s={requestType:"EMAIL_SIGNIN",email:e,clientType:"CLIENT_TYPE_WEB"};function i(o,a){X(a.handleCodeInApp,r,"argument-error"),a&&Am(r,o,a)}i(s,t),await wo(r,s,"getOobCode",E$,"EMAIL_PASSWORD_PROVIDER")}function F7(n,e){const t=Ph.parseLink(e);return(t==null?void 0:t.operation)==="EMAIL_SIGNIN"}async function j7(n,e,t){if(Kt(n.app))return Promise.reject(Dn(n));const r=ae(n),s=nl.credentialWithLink(e,t||Gd());return X(s._tenantId===(r.tenantId||null),r,"tenant-id-mismatch"),Dx(r,s)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function z$(n,e){return zt(n,"POST","/v1/accounts:createAuthUri",Bt(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function U7(n,e){const t=Cx()?Gd():"http://localhost",r={identifier:e,continueUri:t},{signinMethods:s}=await z$(ae(n),r);return s||[]}async function q$(n,e){const t=ae(n),s={requestType:"VERIFY_EMAIL",idToken:await n.getIdToken()};e&&Am(t.auth,s,e);const{email:i}=await x$(t.auth,s);i!==n.email&&await n.reload()}async function $7(n,e,t){const r=ae(n),i={requestType:"VERIFY_AND_CHANGE_EMAIL",idToken:await n.getIdToken(),newEmail:e};t&&Am(r.auth,i,t);const{email:o}=await S$(r.auth,i);o!==n.email&&await n.reload()}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function W$(n,e){return zt(n,"POST","/v1/accounts:update",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function B7(n,{displayName:e,photoURL:t}){if(e===void 0&&t===void 0)return;const r=ae(n),i={idToken:await r.getIdToken(),displayName:e,photoUrl:t,returnSecureToken:!0},o=await Ei(r,W$(r.auth,i));r.displayName=o.displayName||null,r.photoURL=o.photoUrl||null;const a=r.providerData.find(({providerId:l})=>l==="password");a&&(a.displayName=r.displayName,a.photoURL=r.photoURL),await r._updateTokensIfNecessary(o)}function z7(n,e){const t=ae(n);return Kt(t.auth.app)?Promise.reject(Dn(t.auth)):KP(t,e,null)}function q7(n,e){return KP(ae(n),null,e)}async function KP(n,e,t){const{auth:r}=n,i={idToken:await n.getIdToken(),returnSecureToken:!0};e&&(i.email=e),t&&(i.password=t);const o=await Ei(n,y$(r,i));await n._updateTokensIfNecessary(o,!0)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function G$(n){var s,i;if(!n)return null;const{providerId:e}=n,t=n.rawUserInfo?JSON.parse(n.rawUserInfo):{},r=n.isNewUser||n.kind==="identitytoolkit#SignupNewUserResponse";if(!e&&(n!=null&&n.idToken)){const o=(i=(s=Sm(n.idToken))==null?void 0:s.firebase)==null?void 0:i.sign_in_provider;if(o){const a=o!=="anonymous"&&o!=="custom"?o:null;return new Gl(r,a)}}if(!e)return null;switch(e){case"facebook.com":return new H$(r,t);case"github.com":return new K$(r,t);case"google.com":return new Q$(r,t);case"twitter.com":return new Y$(r,t,n.screenName||null);case"custom":case"anonymous":return new Gl(r,null);default:return new Gl(r,e,t)}}class Gl{constructor(e,t,r={}){this.isNewUser=e,this.providerId=t,this.profile=r}}class QP extends Gl{constructor(e,t,r,s){super(e,t,r),this.username=s}}class H$ extends Gl{constructor(e,t){super(e,"facebook.com",t)}}class K$ extends QP{constructor(e,t){super(e,"github.com",t,typeof(t==null?void 0:t.login)=="string"?t==null?void 0:t.login:null)}}class Q$ extends Gl{constructor(e,t){super(e,"google.com",t)}}class Y$ extends QP{constructor(e,t,r){super(e,"twitter.com",t,r)}}function W7(n){const{user:e,_tokenResponse:t}=n;return e.isAnonymous&&!t?{providerId:null,isNewUser:!1,profile:null}:G$(t)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function J$(n,e){return ae(n).setPersistence(e)}function G7(n){return UP(n)}async function H7(n,e){return ln(n).validatePassword(e)}function X$(n,e,t,r){return ae(n).onIdTokenChanged(e,t,r)}function Z$(n,e,t){return ae(n).beforeAuthStateChanged(e,t)}function K7(n,e,t,r){return ae(n).onAuthStateChanged(e,t,r)}function Q7(n){ae(n).useDeviceLanguage()}function Y7(n,e){return ae(n).updateCurrentUser(e)}function J7(n){return ae(n).signOut()}function X7(n,e){return ln(n).revokeAccessToken(e)}async function Z7(n){return ae(n).delete()}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class da{constructor(e,t,r){this.type=e,this.credential=t,this.user=r}static _fromIdtoken(e,t){return new da("enroll",e,t)}static _fromMfaPendingCredential(e){return new da("signin",e)}toJSON(){return{multiFactorSession:{[this.type==="enroll"?"idToken":"pendingCredential"]:this.credential}}}static fromJSON(e){var t,r;if(e!=null&&e.multiFactorSession){if((t=e.multiFactorSession)!=null&&t.pendingCredential)return da._fromMfaPendingCredential(e.multiFactorSession.pendingCredential);if((r=e.multiFactorSession)!=null&&r.idToken)return da._fromIdtoken(e.multiFactorSession.idToken)}return null}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Vx{constructor(e,t,r){this.session=e,this.hints=t,this.signInResolver=r}static _fromError(e,t){const r=ln(e),s=t.customData._serverResponse,i=(s.mfaInfo||[]).map(a=>Dh._fromServerResponse(r,a));X(s.mfaPendingCredential,r,"internal-error");const o=da._fromMfaPendingCredential(s.mfaPendingCredential);return new Vx(o,i,async a=>{const l=await a._process(r,o);delete s.mfaInfo,delete s.mfaPendingCredential;const u={...s,idToken:l.idToken,refreshToken:l.refreshToken};switch(t.operationType){case"signIn":const h=await ss._fromIdTokenResponse(r,t.operationType,u);return await r._updateCurrentUser(h.user),h;case"reauthenticate":return X(t.user,r,"internal-error"),ss._forOperation(t.user,t.operationType,u);default:Tr(r,"internal-error")}})}async resolveSignIn(e){const t=e;return this.signInResolver(t)}}function eW(n,e){var s;const t=ae(n),r=e;return X(e.customData.operationType,t,"argument-error"),X((s=r.customData._serverResponse)==null?void 0:s.mfaPendingCredential,t,"argument-error"),Vx._fromError(t,r)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function cb(n,e){return zt(n,"POST","/v2/accounts/mfaEnrollment:start",Bt(n,e))}function eB(n,e){return zt(n,"POST","/v2/accounts/mfaEnrollment:finalize",Bt(n,e))}function tB(n,e){return zt(n,"POST","/v2/accounts/mfaEnrollment:start",Bt(n,e))}function nB(n,e){return zt(n,"POST","/v2/accounts/mfaEnrollment:finalize",Bt(n,e))}function rB(n,e){return zt(n,"POST","/v2/accounts/mfaEnrollment:withdraw",Bt(n,e))}class Fx{constructor(e){this.user=e,this.enrolledFactors=[],e._onReload(t=>{t.mfaInfo&&(this.enrolledFactors=t.mfaInfo.map(r=>Dh._fromServerResponse(e.auth,r)))})}static _fromUser(e){return new Fx(e)}async getSession(){return da._fromIdtoken(await this.user.getIdToken(),this.user)}async enroll(e,t){const r=e,s=await this.getSession(),i=await Ei(this.user,r._process(this.user.auth,s,t));return await this.user._updateTokensIfNecessary(i),this.user.reload()}async unenroll(e){const t=typeof e=="string"?e:e.uid,r=await this.user.getIdToken();try{const s=await Ei(this.user,rB(this.user.auth,{idToken:r,mfaEnrollmentId:t}));this.enrolledFactors=this.enrolledFactors.filter(({uid:i})=>i!==t),await this.user._updateTokensIfNecessary(s),await this.user.reload()}catch(s){throw s}}}const Ly=new WeakMap;function tW(n){const e=ae(n);return Ly.has(e)||Ly.set(e,Fx._fromUser(e)),Ly.get(e)}const lp="__sak";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class YP{constructor(e,t){this.storageRetriever=e,this.type=t}_isAvailable(){try{return this.storage?(this.storage.setItem(lp,"1"),this.storage.removeItem(lp),Promise.resolve(!0)):Promise.resolve(!1)}catch{return Promise.resolve(!1)}}_set(e,t){return this.storage.setItem(e,JSON.stringify(t)),Promise.resolve()}_get(e){const t=this.storage.getItem(e);return Promise.resolve(t?JSON.parse(t):null)}_remove(e){return this.storage.removeItem(e),Promise.resolve()}get storage(){return this.storageRetriever()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const sB=1e3,iB=10;class JP extends YP{constructor(){super(()=>window.localStorage,"LOCAL"),this.boundEventHandler=(e,t)=>this.onStorageEvent(e,t),this.listeners={},this.localCache={},this.pollTimer=null,this.fallbackToPolling=OP(),this._shouldAllowMigration=!0}forAllChangedKeys(e){for(const t of Object.keys(this.listeners)){const r=this.storage.getItem(t),s=this.localCache[t];r!==s&&e(t,s,r)}}onStorageEvent(e,t=!1){if(!e.key){this.forAllChangedKeys((o,a,l)=>{this.notifyListeners(o,l)});return}const r=e.key;t?this.detachListener():this.stopPolling();const s=()=>{const o=this.storage.getItem(r);!t&&this.localCache[r]===o||this.notifyListeners(r,o)},i=this.storage.getItem(r);KU()&&i!==e.newValue&&e.newValue!==e.oldValue?setTimeout(s,iB):s()}notifyListeners(e,t){this.localCache[e]=t;const r=this.listeners[e];if(r)for(const s of Array.from(r))s(t&&JSON.parse(t))}startPolling(){this.stopPolling(),this.pollTimer=setInterval(()=>{this.forAllChangedKeys((e,t,r)=>{this.onStorageEvent(new StorageEvent("storage",{key:e,oldValue:t,newValue:r}),!0)})},sB)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}attachListener(){window.addEventListener("storage",this.boundEventHandler)}detachListener(){window.removeEventListener("storage",this.boundEventHandler)}_addListener(e,t){Object.keys(this.listeners).length===0&&(this.fallbackToPolling?this.startPolling():this.attachListener()),this.listeners[e]||(this.listeners[e]=new Set,this.localCache[e]=this.storage.getItem(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),this.listeners[e].size===0&&delete this.listeners[e]),Object.keys(this.listeners).length===0&&(this.detachListener(),this.stopPolling())}async _set(e,t){await super._set(e,t),this.localCache[e]=JSON.stringify(t)}async _get(e){const t=await super._get(e);return this.localCache[e]=JSON.stringify(t),t}async _remove(e){await super._remove(e),delete this.localCache[e]}}JP.type="LOCAL";const XP=JP;/**
 * @license
 * Copyright 2025 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const oB=1e3;function Oy(n){var r;const e=n.replace(/[\\^$.*+?()[\]{}|]/g,"\\$&"),t=RegExp(`${e}=([^;]+)`);return((r=document.cookie.match(t))==null?void 0:r[1])??null}function Vy(n){return`${window.location.protocol==="http:"?"__dev_":"__HOST-"}FIREBASE_${n.split(":")[3]}`}class ZP{constructor(){this.type="COOKIE",this.listenerUnsubscribes=new Map}_getFinalTarget(e){if(typeof window===void 0)return e;const t=new URL(`${window.location.origin}/__cookies__`);return t.searchParams.set("finalTarget",e),t}async _isAvailable(){return typeof isSecureContext=="boolean"&&!isSecureContext||typeof navigator>"u"||typeof document>"u"?!1:navigator.cookieEnabled??!0}async _set(e,t){}async _get(e){if(!this._isAvailable())return null;const t=Vy(e);if(window.cookieStore){const r=await window.cookieStore.get(t);return r==null?void 0:r.value}return Oy(t)}async _remove(e){if(!this._isAvailable()||!await this._get(e))return;const r=Vy(e);document.cookie=`${r}=;Max-Age=34560000;Partitioned;Secure;SameSite=Strict;Path=/;Priority=High`,await fetch("/__cookies__",{method:"DELETE"}).catch(()=>{})}_addListener(e,t){if(!this._isAvailable())return;const r=Vy(e);if(window.cookieStore){const a=u=>{const h=u.changed.find(g=>g.name===r);h&&t(h.value),u.deleted.find(g=>g.name===r)&&t(null)},l=()=>window.cookieStore.removeEventListener("change",a);return this.listenerUnsubscribes.set(t,l),window.cookieStore.addEventListener("change",a)}let s=Oy(r);const i=setInterval(()=>{const a=Oy(r);a!==s&&(t(a),s=a)},oB),o=()=>clearInterval(i);this.listenerUnsubscribes.set(t,o)}_removeListener(e,t){const r=this.listenerUnsubscribes.get(t);r&&(r(),this.listenerUnsubscribes.delete(t))}}ZP.type="COOKIE";const nW=ZP;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class eD extends YP{constructor(){super(()=>window.sessionStorage,"SESSION")}_addListener(e,t){}_removeListener(e,t){}}eD.type="SESSION";const tD=eD;/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function aB(n){return Promise.all(n.map(async e=>{try{return{fulfilled:!0,value:await e}}catch(t){return{fulfilled:!1,reason:t}}}))}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Cm{constructor(e){this.eventTarget=e,this.handlersMap={},this.boundEventHandler=this.handleEvent.bind(this)}static _getInstance(e){const t=this.receivers.find(s=>s.isListeningto(e));if(t)return t;const r=new Cm(e);return this.receivers.push(r),r}isListeningto(e){return this.eventTarget===e}async handleEvent(e){const t=e,{eventId:r,eventType:s,data:i}=t.data,o=this.handlersMap[s];if(!(o!=null&&o.size))return;t.ports[0].postMessage({status:"ack",eventId:r,eventType:s});const a=Array.from(o).map(async u=>u(t.origin,i)),l=await aB(a);t.ports[0].postMessage({status:"done",eventId:r,eventType:s,response:l})}_subscribe(e,t){Object.keys(this.handlersMap).length===0&&this.eventTarget.addEventListener("message",this.boundEventHandler),this.handlersMap[e]||(this.handlersMap[e]=new Set),this.handlersMap[e].add(t)}_unsubscribe(e,t){this.handlersMap[e]&&t&&this.handlersMap[e].delete(t),(!t||this.handlersMap[e].size===0)&&delete this.handlersMap[e],Object.keys(this.handlersMap).length===0&&this.eventTarget.removeEventListener("message",this.boundEventHandler)}}Cm.receivers=[];/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Rm(n="",e=10){let t="";for(let r=0;r<e;r++)t+=Math.floor(Math.random()*10);return n+t}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class lB{constructor(e){this.target=e,this.handlers=new Set}removeMessageHandler(e){e.messageChannel&&(e.messageChannel.port1.removeEventListener("message",e.onMessage),e.messageChannel.port1.close()),this.handlers.delete(e)}async _send(e,t,r=50){const s=typeof MessageChannel<"u"?new MessageChannel:null;if(!s)throw new Error("connection_unavailable");let i,o;return new Promise((a,l)=>{const u=Rm("",20);s.port1.start();const h=setTimeout(()=>{l(new Error("unsupported_event"))},r);o={messageChannel:s,onMessage(f){const g=f;if(g.data.eventId===u)switch(g.data.status){case"ack":clearTimeout(h),i=setTimeout(()=>{l(new Error("timeout"))},3e3);break;case"done":clearTimeout(i),a(g.data.response);break;default:clearTimeout(h),clearTimeout(i),l(new Error("invalid_response"));break}}},this.handlers.add(o),s.port1.addEventListener("message",o.onMessage),this.target.postMessage({eventType:e,eventId:u,data:t},[s.port2])}).finally(()=>{o&&this.removeMessageHandler(o)})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function pn(){return window}function cB(n){pn().location.href=n}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function jx(){return typeof pn().WorkerGlobalScope<"u"&&typeof pn().importScripts=="function"}async function uB(){if(!(navigator!=null&&navigator.serviceWorker))return null;try{return(await navigator.serviceWorker.ready).active}catch{return null}}function dB(){var n;return((n=navigator==null?void 0:navigator.serviceWorker)==null?void 0:n.controller)||null}function hB(){return jx()?self:null}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const nD="firebaseLocalStorageDb",fB=1,cp="firebaseLocalStorage",rD="fbase_key";class Mh{constructor(e){this.request=e}toPromise(){return new Promise((e,t)=>{this.request.addEventListener("success",()=>{e(this.request.result)}),this.request.addEventListener("error",()=>{t(this.request.error)})})}}function Nm(n,e){return n.transaction([cp],e?"readwrite":"readonly").objectStore(cp)}function gB(){const n=indexedDB.deleteDatabase(nD);return new Mh(n).toPromise()}function Lv(){const n=indexedDB.open(nD,fB);return new Promise((e,t)=>{n.addEventListener("error",()=>{t(n.error)}),n.addEventListener("upgradeneeded",()=>{const r=n.result;try{r.createObjectStore(cp,{keyPath:rD})}catch(s){t(s)}}),n.addEventListener("success",async()=>{const r=n.result;r.objectStoreNames.contains(cp)?e(r):(r.close(),await gB(),e(await Lv()))})})}async function ub(n,e,t){const r=Nm(n,!0).put({[rD]:e,value:t});return new Mh(r).toPromise()}async function pB(n,e){const t=Nm(n,!1).get(e),r=await new Mh(t).toPromise();return r===void 0?null:r.value}function db(n,e){const t=Nm(n,!0).delete(e);return new Mh(t).toPromise()}const mB=800,yB=3;class sD{constructor(){this.type="LOCAL",this._shouldAllowMigration=!0,this.listeners={},this.localCache={},this.pollTimer=null,this.pendingWrites=0,this.receiver=null,this.sender=null,this.serviceWorkerReceiverAvailable=!1,this.activeServiceWorker=null,this._workerInitializationPromise=this.initializeServiceWorkerMessaging().then(()=>{},()=>{})}async _openDb(){return this.db?this.db:(this.db=await Lv(),this.db)}async _withRetries(e){let t=0;for(;;)try{const r=await this._openDb();return await e(r)}catch(r){if(t++>yB)throw r;this.db&&(this.db.close(),this.db=void 0)}}async initializeServiceWorkerMessaging(){return jx()?this.initializeReceiver():this.initializeSender()}async initializeReceiver(){this.receiver=Cm._getInstance(hB()),this.receiver._subscribe("keyChanged",async(e,t)=>({keyProcessed:(await this._poll()).includes(t.key)})),this.receiver._subscribe("ping",async(e,t)=>["keyChanged"])}async initializeSender(){var t,r;if(this.activeServiceWorker=await uB(),!this.activeServiceWorker)return;this.sender=new lB(this.activeServiceWorker);const e=await this.sender._send("ping",{},800);e&&(t=e[0])!=null&&t.fulfilled&&(r=e[0])!=null&&r.value.includes("keyChanged")&&(this.serviceWorkerReceiverAvailable=!0)}async notifyServiceWorker(e){if(!(!this.sender||!this.activeServiceWorker||dB()!==this.activeServiceWorker))try{await this.sender._send("keyChanged",{key:e},this.serviceWorkerReceiverAvailable?800:50)}catch{}}async _isAvailable(){try{if(!indexedDB)return!1;const e=await Lv();return await ub(e,lp,"1"),await db(e,lp),!0}catch{}return!1}async _withPendingWrite(e){this.pendingWrites++;try{await e()}finally{this.pendingWrites--}}async _set(e,t){return this._withPendingWrite(async()=>(await this._withRetries(r=>ub(r,e,t)),this.localCache[e]=t,this.notifyServiceWorker(e)))}async _get(e){const t=await this._withRetries(r=>pB(r,e));return this.localCache[e]=t,t}async _remove(e){return this._withPendingWrite(async()=>(await this._withRetries(t=>db(t,e)),delete this.localCache[e],this.notifyServiceWorker(e)))}async _poll(){const e=await this._withRetries(s=>{const i=Nm(s,!1).getAll();return new Mh(i).toPromise()});if(!e)return[];if(this.pendingWrites!==0)return[];const t=[],r=new Set;if(e.length!==0)for(const{fbase_key:s,value:i}of e)r.add(s),JSON.stringify(this.localCache[s])!==JSON.stringify(i)&&(this.notifyListeners(s,i),t.push(s));for(const s of Object.keys(this.localCache))this.localCache[s]&&!r.has(s)&&(this.notifyListeners(s,null),t.push(s));return t}notifyListeners(e,t){this.localCache[e]=t;const r=this.listeners[e];if(r)for(const s of Array.from(r))s(t)}startPolling(){this.stopPolling(),this.pollTimer=setInterval(async()=>this._poll(),mB)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}_addListener(e,t){Object.keys(this.listeners).length===0&&this.startPolling(),this.listeners[e]||(this.listeners[e]=new Set,this._get(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),this.listeners[e].size===0&&delete this.listeners[e]),Object.keys(this.listeners).length===0&&this.stopPolling()}}sD.type="LOCAL";const _B=sD;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function hb(n,e){return zt(n,"POST","/v2/accounts/mfaSignIn:start",Bt(n,e))}function vB(n,e){return zt(n,"POST","/v2/accounts/mfaSignIn:finalize",Bt(n,e))}function wB(n,e){return zt(n,"POST","/v2/accounts/mfaSignIn:finalize",Bt(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Fy=FP("rcb"),xB=new Rh(3e4,6e4);class IB{constructor(){var e;this.hostLanguage="",this.counter=0,this.librarySeparatelyLoaded=!!((e=pn().grecaptcha)!=null&&e.render)}load(e,t=""){return X(EB(t),e,"argument-error"),this.shouldResolveImmediately(t)&&ZT(pn().grecaptcha)?Promise.resolve(pn().grecaptcha):new Promise((r,s)=>{const i=pn().setTimeout(()=>{s(lr(e,"network-request-failed"))},xB.get());pn()[Fy]=()=>{pn().clearTimeout(i),delete pn()[Fy];const a=pn().grecaptcha;if(!a||!ZT(a)){s(lr(e,"internal-error"));return}const l=a.render;a.render=(u,h)=>{const f=l(u,h);return this.counter++,f},this.hostLanguage=t,r(a)};const o=`${t$()}?${Wa({onload:Fy,render:"explicit",hl:t})}`;kx(o).catch(()=>{clearTimeout(i),s(lr(e,"internal-error"))})})}clearedOneInstance(){this.counter--}shouldResolveImmediately(e){var t;return!!((t=pn().grecaptcha)!=null&&t.render)&&(e===this.hostLanguage||this.counter>0||this.librarySeparatelyLoaded)}}function EB(n){return n.length<=6&&/^\s*[a-zA-Z0-9\-]*\s*$/.test(n)}class SB{async load(e){return new o$(e)}clearedOneInstance(){}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const rd="recaptcha",TB={theme:"light",type:"image"};class rW{constructor(e,t,r={...TB}){this.parameters=r,this.type=rd,this.destroyed=!1,this.widgetId=null,this.tokenChangeListeners=new Set,this.renderPromise=null,this.recaptcha=null,this.auth=ln(e),this.isInvisible=this.parameters.size==="invisible",X(typeof document<"u",this.auth,"operation-not-supported-in-this-environment");const s=typeof t=="string"?document.getElementById(t):t;X(s,this.auth,"argument-error"),this.container=s,this.parameters.callback=this.makeTokenCallback(this.parameters.callback),this._recaptchaLoader=this.auth.settings.appVerificationDisabledForTesting?new SB:new IB,this.validateStartingState()}async verify(){this.assertNotDestroyed();const e=await this.render(),t=this.getAssertedRecaptcha(),r=t.getResponse(e);return r||new Promise(s=>{const i=o=>{o&&(this.tokenChangeListeners.delete(i),s(o))};this.tokenChangeListeners.add(i),this.isInvisible&&t.execute(e)})}render(){try{this.assertNotDestroyed()}catch(e){return Promise.reject(e)}return this.renderPromise?this.renderPromise:(this.renderPromise=this.makeRenderPromise().catch(e=>{throw this.renderPromise=null,e}),this.renderPromise)}_reset(){this.assertNotDestroyed(),this.widgetId!==null&&this.getAssertedRecaptcha().reset(this.widgetId)}clear(){this.assertNotDestroyed(),this.destroyed=!0,this._recaptchaLoader.clearedOneInstance(),this.isInvisible||this.container.childNodes.forEach(e=>{this.container.removeChild(e)})}validateStartingState(){X(!this.parameters.sitekey,this.auth,"argument-error"),X(this.isInvisible||!this.container.hasChildNodes(),this.auth,"argument-error"),X(typeof document<"u",this.auth,"operation-not-supported-in-this-environment")}makeTokenCallback(e){return t=>{if(this.tokenChangeListeners.forEach(r=>r(t)),typeof e=="function")e(t);else if(typeof e=="string"){const r=pn()[e];typeof r=="function"&&r(t)}}}assertNotDestroyed(){X(!this.destroyed,this.auth,"internal-error")}async makeRenderPromise(){if(await this.init(),!this.widgetId){let e=this.container;if(!this.isInvisible){const t=document.createElement("div");e.appendChild(t),e=t}this.widgetId=this.getAssertedRecaptcha().render(e,this.parameters)}return this.widgetId}async init(){X(Cx()&&!jx(),this.auth,"internal-error"),await bB(),this.recaptcha=await this._recaptchaLoader.load(this.auth,this.auth.languageCode||void 0);const e=await VU(this.auth);X(e,this.auth,"internal-error"),this.parameters.sitekey=e}getAssertedRecaptcha(){return X(this.recaptcha,this.auth,"internal-error"),this.recaptcha}}function bB(){let n=null;return new Promise(e=>{if(document.readyState==="complete"){e();return}n=()=>e(),window.addEventListener("load",n)}).catch(e=>{throw n&&window.removeEventListener("load",n),e})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ux{constructor(e,t){this.verificationId=e,this.onConfirmation=t}confirm(e){const t=va._fromVerification(this.verificationId,e);return this.onConfirmation(t)}}async function sW(n,e,t){if(Kt(n.app))return Promise.reject(Dn(n));const r=ln(n),s=await km(r,e,ae(t));return new Ux(s,i=>Dx(r,i))}async function iW(n,e,t){const r=ae(n);await bm(!1,r,"phone");const s=await km(r.auth,e,ae(t));return new Ux(s,i=>O$(r,i))}async function oW(n,e,t){const r=ae(n);if(Kt(r.auth.app))return Promise.reject(Dn(r.auth));const s=await km(r.auth,e,ae(t));return new Ux(s,i=>V$(r,i))}async function km(n,e,t){var r;if(!n._getRecaptchaConfig())try{await UP(n)}catch{console.log("Failed to initialize reCAPTCHA Enterprise config. Triggering the reCAPTCHA v2 verification.")}try{let s;if(typeof e=="string"?s={phoneNumber:e}:s=e,"session"in s){const i=s.session;if("phoneNumber"in s){X(i.type==="enroll",n,"internal-error");const o={idToken:i.credential,phoneEnrollmentInfo:{phoneNumber:s.phoneNumber,clientType:"CLIENT_TYPE_WEB"}};return(await wo(n,o,"mfaSmsEnrollment",async(h,f)=>{if(f.phoneEnrollmentInfo.captchaResponse===nd){X((t==null?void 0:t.type)===rd,h,"argument-error");const g=await jy(h,f,t);return cb(h,g)}return cb(h,f)},"PHONE_PROVIDER").catch(h=>Promise.reject(h))).phoneSessionInfo.sessionInfo}else{X(i.type==="signin",n,"internal-error");const o=((r=s.multiFactorHint)==null?void 0:r.uid)||s.multiFactorUid;X(o,n,"missing-multi-factor-info");const a={mfaPendingCredential:i.credential,mfaEnrollmentId:o,phoneSignInInfo:{clientType:"CLIENT_TYPE_WEB"}};return(await wo(n,a,"mfaSmsSignIn",async(f,g)=>{if(g.phoneSignInInfo.captchaResponse===nd){X((t==null?void 0:t.type)===rd,f,"argument-error");const y=await jy(f,g,t);return hb(f,y)}return hb(f,g)},"PHONE_PROVIDER").catch(f=>Promise.reject(f))).phoneResponseInfo.sessionInfo}}else{const i={phoneNumber:s.phoneNumber,clientType:"CLIENT_TYPE_WEB"};return(await wo(n,i,"sendVerificationCode",async(u,h)=>{if(h.captchaResponse===nd){X((t==null?void 0:t.type)===rd,u,"argument-error");const f=await jy(u,h,t);return ab(u,f)}return ab(u,h)},"PHONE_PROVIDER").catch(u=>Promise.reject(u))).sessionInfo}}finally{t==null||t._reset()}}async function aW(n,e){const t=ae(n);if(Kt(t.auth.app))return Promise.reject(Dn(t.auth));await Px(t,e)}async function jy(n,e,t){X(t.type===rd,n,"argument-error");const r=await t.verify();X(typeof r=="string",n,"argument-error");const s={...e};if("phoneEnrollmentInfo"in s){const i=s.phoneEnrollmentInfo.phoneNumber,o=s.phoneEnrollmentInfo.captchaResponse,a=s.phoneEnrollmentInfo.clientType,l=s.phoneEnrollmentInfo.recaptchaVersion;return Object.assign(s,{phoneEnrollmentInfo:{phoneNumber:i,recaptchaToken:r,captchaResponse:o,clientType:a,recaptchaVersion:l}}),s}else if("phoneSignInInfo"in s){const i=s.phoneSignInInfo.captchaResponse,o=s.phoneSignInInfo.clientType,a=s.phoneSignInInfo.recaptchaVersion;return Object.assign(s,{phoneSignInInfo:{recaptchaToken:r,captchaResponse:i,clientType:o,recaptchaVersion:a}}),s}else return Object.assign(s,{recaptchaToken:r}),s}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Hl{constructor(e){this.providerId=Hl.PROVIDER_ID,this.auth=ln(e)}verifyPhoneNumber(e,t){return km(this.auth,e,ae(t))}static credential(e,t){return va._fromVerification(e,t)}static credentialFromResult(e){const t=e;return Hl.credentialFromTaggedObject(t)}static credentialFromError(e){return Hl.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{phoneNumber:t,temporaryProof:r}=e;return t&&r?va._fromTokenResponse(t,r):null}}Hl.PROVIDER_ID="phone";Hl.PHONE_SIGN_IN_METHOD="phone";/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function rl(n,e){return e?ui(e):(X(n._popupRedirectResolver,n,"argument-error"),n._popupRedirectResolver)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class $x extends kh{constructor(e){super("custom","custom"),this.params=e}_getIdTokenResponse(e){return fi(e,this._buildIdpRequest())}_linkToIdToken(e,t){return fi(e,this._buildIdpRequest(t))}_getReauthenticationResolver(e){return fi(e,this._buildIdpRequest())}_buildIdpRequest(e){const t={requestUri:this.params.requestUri,sessionId:this.params.sessionId,postBody:this.params.postBody,tenantId:this.params.tenantId,pendingToken:this.params.pendingToken,returnSecureToken:!0,returnIdpCredential:!0};return e&&(t.idToken=e),t}}function AB(n){return HP(n.auth,new $x(n),n.bypassAuthState)}function CB(n){const{auth:e,user:t}=n;return X(t,e,"internal-error"),GP(t,new $x(n),n.bypassAuthState)}async function RB(n){const{auth:e,user:t}=n;return X(t,e,"internal-error"),Px(t,new $x(n),n.bypassAuthState)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class iD{constructor(e,t,r,s,i=!1){this.auth=e,this.resolver=r,this.user=s,this.bypassAuthState=i,this.pendingPromise=null,this.eventManager=null,this.filter=Array.isArray(t)?t:[t]}execute(){return new Promise(async(e,t)=>{this.pendingPromise={resolve:e,reject:t};try{this.eventManager=await this.resolver._initialize(this.auth),await this.onExecution(),this.eventManager.registerConsumer(this)}catch(r){this.reject(r)}})}async onAuthEvent(e){const{urlResponse:t,sessionId:r,postBody:s,tenantId:i,error:o,type:a}=e;if(o){this.reject(o);return}const l={auth:this.auth,requestUri:t,sessionId:r,tenantId:i||void 0,postBody:s||void 0,user:this.user,bypassAuthState:this.bypassAuthState};try{this.resolve(await this.getIdpTask(a)(l))}catch(u){this.reject(u)}}onError(e){this.reject(e)}getIdpTask(e){switch(e){case"signInViaPopup":case"signInViaRedirect":return AB;case"linkViaPopup":case"linkViaRedirect":return RB;case"reauthViaPopup":case"reauthViaRedirect":return CB;default:Tr(this.auth,"internal-error")}}resolve(e){Ii(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.resolve(e),this.unregisterAndCleanUp()}reject(e){Ii(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.reject(e),this.unregisterAndCleanUp()}unregisterAndCleanUp(){this.eventManager&&this.eventManager.unregisterConsumer(this),this.pendingPromise=null,this.cleanUp()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const NB=new Rh(2e3,1e4);async function kB(n,e,t){if(Kt(n.app))return Promise.reject(lr(n,"operation-not-supported-in-this-environment"));const r=ln(n);Gc(n,e,Pi);const s=rl(r,t);return new di(r,"signInViaPopup",e,s).executeNotNull()}async function lW(n,e,t){const r=ae(n);if(Kt(r.auth.app))return Promise.reject(lr(r.auth,"operation-not-supported-in-this-environment"));Gc(r.auth,e,Pi);const s=rl(r.auth,t);return new di(r.auth,"reauthViaPopup",e,s,r).executeNotNull()}async function cW(n,e,t){const r=ae(n);Gc(r.auth,e,Pi);const s=rl(r.auth,t);return new di(r.auth,"linkViaPopup",e,s,r).executeNotNull()}class di extends iD{constructor(e,t,r,s,i){super(e,t,s,i),this.provider=r,this.authWindow=null,this.pollId=null,di.currentPopupAction&&di.currentPopupAction.cancel(),di.currentPopupAction=this}async executeNotNull(){const e=await this.execute();return X(e,this.auth,"internal-error"),e}async onExecution(){Ii(this.filter.length===1,"Popup operations only handle one event");const e=Rm();this.authWindow=await this.resolver._openPopup(this.auth,this.provider,this.filter[0],e),this.authWindow.associatedEvent=e,this.resolver._originValidation(this.auth).catch(t=>{this.reject(t)}),this.resolver._isIframeWebStorageSupported(this.auth,t=>{t||this.reject(lr(this.auth,"web-storage-unsupported"))}),this.pollUserCancellation()}get eventId(){var e;return((e=this.authWindow)==null?void 0:e.associatedEvent)||null}cancel(){this.reject(lr(this.auth,"cancelled-popup-request"))}cleanUp(){this.authWindow&&this.authWindow.close(),this.pollId&&window.clearTimeout(this.pollId),this.authWindow=null,this.pollId=null,di.currentPopupAction=null}pollUserCancellation(){const e=()=>{var t,r;if((r=(t=this.authWindow)==null?void 0:t.window)!=null&&r.closed){this.pollId=window.setTimeout(()=>{this.pollId=null,this.reject(lr(this.auth,"popup-closed-by-user"))},8e3);return}this.pollId=window.setTimeout(e,NB.get())};e()}}di.currentPopupAction=null;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const PB="pendingRedirect",eg=new Map;class DB extends iD{constructor(e,t,r=!1){super(e,["signInViaRedirect","linkViaRedirect","reauthViaRedirect","unknown"],t,void 0,r),this.eventId=null}async execute(){let e=eg.get(this.auth._key());if(!e){try{const r=await MB(this.resolver,this.auth)?await super.execute():null;e=()=>Promise.resolve(r)}catch(t){e=()=>Promise.reject(t)}eg.set(this.auth._key(),e)}return this.bypassAuthState||eg.set(this.auth._key(),()=>Promise.resolve(null)),e()}async onAuthEvent(e){if(e.type==="signInViaRedirect")return super.onAuthEvent(e);if(e.type==="unknown"){this.resolve(null);return}if(e.eventId){const t=await this.auth._redirectUserForId(e.eventId);if(t)return this.user=t,super.onAuthEvent(e);this.resolve(null)}}async onExecution(){}cleanUp(){}}async function MB(n,e){const t=aD(e),r=oD(n);if(!await r._isAvailable())return!1;const s=await r._get(t)==="true";return await r._remove(t),s}async function Bx(n,e){return oD(n)._set(aD(e),"true")}function LB(n,e){eg.set(n._key(),e)}function oD(n){return ui(n._redirectPersistence)}function aD(n){return Xf(PB,n.config.apiKey,n.name)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function uW(n,e,t){return OB(n,e,t)}async function OB(n,e,t){if(Kt(n.app))return Promise.reject(Dn(n));const r=ln(n);Gc(n,e,Pi),await r._initializationPromise;const s=rl(r,t);return await Bx(s,r),s._openRedirect(r,e,"signInViaRedirect")}function dW(n,e,t){return VB(n,e,t)}async function VB(n,e,t){const r=ae(n);if(Gc(r.auth,e,Pi),Kt(r.auth.app))return Promise.reject(Dn(r.auth));await r.auth._initializationPromise;const s=rl(r.auth,t);await Bx(s,r.auth);const i=await cD(r);return s._openRedirect(r.auth,e,"reauthViaRedirect",i)}function hW(n,e,t){return FB(n,e,t)}async function FB(n,e,t){const r=ae(n);Gc(r.auth,e,Pi),await r.auth._initializationPromise;const s=rl(r.auth,t);await bm(!1,r,e.providerId),await Bx(s,r.auth);const i=await cD(r);return s._openRedirect(r.auth,e,"linkViaRedirect",i)}async function fW(n,e){return await ln(n)._initializationPromise,lD(n,e,!1)}async function lD(n,e,t=!1){if(Kt(n.app))return Promise.reject(Dn(n));const r=ln(n),s=rl(r,e),o=await new DB(r,s,t).execute();return o&&!t&&(delete o.user._redirectEventId,await r._persistUserIfCurrent(o.user),await r._setRedirectUser(null,e)),o}async function cD(n){const e=Rm(`${n.uid}:::`);return n._redirectEventId=e,await n.auth._setRedirectUser(n),await n.auth._persistUserIfCurrent(n),e}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const jB=10*60*1e3;class UB{constructor(e){this.auth=e,this.cachedEventUids=new Set,this.consumers=new Set,this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1,this.lastProcessedEventTime=Date.now()}registerConsumer(e){this.consumers.add(e),this.queuedRedirectEvent&&this.isEventForConsumer(this.queuedRedirectEvent,e)&&(this.sendToConsumer(this.queuedRedirectEvent,e),this.saveEventToCache(this.queuedRedirectEvent),this.queuedRedirectEvent=null)}unregisterConsumer(e){this.consumers.delete(e)}onEvent(e){if(this.hasEventBeenHandled(e))return!1;let t=!1;return this.consumers.forEach(r=>{this.isEventForConsumer(e,r)&&(t=!0,this.sendToConsumer(e,r),this.saveEventToCache(e))}),this.hasHandledPotentialRedirect||!$B(e)||(this.hasHandledPotentialRedirect=!0,t||(this.queuedRedirectEvent=e,t=!0)),t}sendToConsumer(e,t){var r;if(e.error&&!uD(e)){const s=((r=e.error.code)==null?void 0:r.split("auth/")[1])||"internal-error";t.onError(lr(this.auth,s))}else t.onAuthEvent(e)}isEventForConsumer(e,t){const r=t.eventId===null||!!e.eventId&&e.eventId===t.eventId;return t.filter.includes(e.type)&&r}hasEventBeenHandled(e){return Date.now()-this.lastProcessedEventTime>=jB&&this.cachedEventUids.clear(),this.cachedEventUids.has(fb(e))}saveEventToCache(e){this.cachedEventUids.add(fb(e)),this.lastProcessedEventTime=Date.now()}}function fb(n){return[n.type,n.eventId,n.sessionId,n.tenantId].filter(e=>e).join("-")}function uD({type:n,error:e}){return n==="unknown"&&(e==null?void 0:e.code)==="auth/no-auth-event"}function $B(n){switch(n.type){case"signInViaRedirect":case"linkViaRedirect":case"reauthViaRedirect":return!0;case"unknown":return uD(n);default:return!1}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function BB(n,e={}){return zt(n,"GET","/v1/projects",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const zB=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,qB=/^https?/;async function WB(n){if(n.config.emulator)return;const{authorizedDomains:e}=await BB(n);for(const t of e)try{if(GB(t))return}catch{}Tr(n,"unauthorized-domain")}function GB(n){const e=Gd(),{protocol:t,hostname:r}=new URL(e);if(n.startsWith("chrome-extension://")){const o=new URL(n);return o.hostname===""&&r===""?t==="chrome-extension:"&&n.replace("chrome-extension://","")===e.replace("chrome-extension://",""):t==="chrome-extension:"&&o.hostname===r}if(!qB.test(t))return!1;if(zB.test(n))return r===n;const s=n.replace(/\./g,"\\.");return new RegExp("^(.+\\."+s+"|"+s+")$","i").test(r)}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const HB=new Rh(3e4,6e4);function gb(){const n=pn().___jsl;if(n!=null&&n.H){for(const e of Object.keys(n.H))if(n.H[e].r=n.H[e].r||[],n.H[e].L=n.H[e].L||[],n.H[e].r=[...n.H[e].L],n.CP)for(let t=0;t<n.CP.length;t++)n.CP[t]=null}}function KB(n){return new Promise((e,t)=>{var s,i,o;function r(){gb(),gapi.load("gapi.iframes",{callback:()=>{e(gapi.iframes.getContext())},ontimeout:()=>{gb(),t(lr(n,"network-request-failed"))},timeout:HB.get()})}if((i=(s=pn().gapi)==null?void 0:s.iframes)!=null&&i.Iframe)e(gapi.iframes.getContext());else if((o=pn().gapi)!=null&&o.load)r();else{const a=FP("iframefcb");return pn()[a]=()=>{gapi.load?r():t(lr(n,"network-request-failed"))},kx(`${r$()}?onload=${a}`).catch(l=>t(l))}}).catch(e=>{throw tg=null,e})}let tg=null;function QB(n){return tg=tg||KB(n),tg}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const YB=new Rh(5e3,15e3),JB="__/auth/iframe",XB="emulator/auth/iframe",ZB={style:{position:"absolute",top:"-100px",width:"1px",height:"1px"},"aria-hidden":"true",tabindex:"-1"},ez=new Map([["identitytoolkit.googleapis.com","p"],["staging-identitytoolkit.sandbox.googleapis.com","s"],["test-identitytoolkit.sandbox.googleapis.com","t"]]);function tz(n){const e=n.config;X(e.authDomain,n,"auth-domain-config-required");const t=e.emulator?Rx(e,XB):`https://${n.config.authDomain}/${JB}`,r={apiKey:e.apiKey,appName:n.name,v:Ga},s=ez.get(n.config.apiHost);s&&(r.eid=s);const i=n._getFrameworks();return i.length&&(r.fw=i.join(",")),`${t}?${Wa(r).slice(1)}`}async function nz(n){const e=await QB(n),t=pn().gapi;return X(t,n,"internal-error"),e.open({where:document.body,url:tz(n),messageHandlersFilter:t.iframes.CROSS_ORIGIN_IFRAMES_FILTER,attributes:ZB,dontclear:!0},r=>new Promise(async(s,i)=>{await r.restyle({setHideOnLeave:!1});const o=lr(n,"network-request-failed"),a=pn().setTimeout(()=>{i(o)},YB.get());function l(){pn().clearTimeout(a),s(r)}r.ping(l).then(l,()=>{i(o)})}))}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const rz={location:"yes",resizable:"yes",statusbar:"yes",toolbar:"no"},sz=500,iz=600,oz="_blank",az="http://localhost";class pb{constructor(e){this.window=e,this.associatedEvent=null}close(){if(this.window)try{this.window.close()}catch{}}}function lz(n,e,t,r=sz,s=iz){const i=Math.max((window.screen.availHeight-s)/2,0).toString(),o=Math.max((window.screen.availWidth-r)/2,0).toString();let a="";const l={...rz,width:r.toString(),height:s.toString(),top:i,left:o},u=In().toLowerCase();t&&(a=kP(u)?oz:t),RP(u)&&(e=e||az,l.scrollbars="yes");const h=Object.entries(l).reduce((g,[y,w])=>`${g}${y}=${w},`,"");if(HU(u)&&a!=="_self")return cz(e||"",a),new pb(null);const f=window.open(e||"",a,h);X(f,n,"popup-blocked");try{f.focus()}catch{}return new pb(f)}function cz(n,e){const t=document.createElement("a");t.href=n,t.target=e;const r=document.createEvent("MouseEvent");r.initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,1,null),t.dispatchEvent(r)}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const uz="__/auth/handler",dz="emulator/auth/handler",hz=encodeURIComponent("fac");async function mb(n,e,t,r,s,i){X(n.config.authDomain,n,"auth-domain-config-required"),X(n.config.apiKey,n,"invalid-api-key");const o={apiKey:n.config.apiKey,appName:n.name,authType:t,redirectUrl:r,v:Ga,eventId:s};if(e instanceof Pi){e.setDefaultLanguage(n.languageCode),o.providerId=e.providerId||"",Cg(e.getCustomParameters())||(o.customParameters=JSON.stringify(e.getCustomParameters()));for(const[h,f]of Object.entries(i||{}))o[h]=f}if(e instanceof Hc){const h=e.getScopes().filter(f=>f!=="");h.length>0&&(o.scopes=h.join(","))}n.tenantId&&(o.tid=n.tenantId);const a=o;for(const h of Object.keys(a))a[h]===void 0&&delete a[h];const l=await n._getAppCheckToken(),u=l?`#${hz}=${encodeURIComponent(l)}`:"";return`${fz(n)}?${Wa(a).slice(1)}${u}`}function fz({config:n}){return n.emulator?Rx(n,dz):`https://${n.authDomain}/${uz}`}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Uy="webStorageSupport";class gz{constructor(){this.eventManagers={},this.iframes={},this.originValidationPromises={},this._redirectPersistence=tD,this._completeRedirectFn=lD,this._overrideRedirectResult=LB}async _openPopup(e,t,r,s){var o;Ii((o=this.eventManagers[e._key()])==null?void 0:o.manager,"_initialize() not called before _openPopup()");const i=await mb(e,t,r,Gd(),s);return lz(e,i,Rm())}async _openRedirect(e,t,r,s){await this._originValidation(e);const i=await mb(e,t,r,Gd(),s);return cB(i),new Promise(()=>{})}_initialize(e){const t=e._key();if(this.eventManagers[t]){const{manager:s,promise:i}=this.eventManagers[t];return s?Promise.resolve(s):(Ii(i,"If manager is not set, promise should be"),i)}const r=this.initAndGetManager(e);return this.eventManagers[t]={promise:r},r.catch(()=>{delete this.eventManagers[t]}),r}async initAndGetManager(e){const t=await nz(e),r=new UB(e);return t.register("authEvent",s=>(X(s==null?void 0:s.authEvent,e,"invalid-auth-event"),{status:r.onEvent(s.authEvent)?"ACK":"ERROR"}),gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER),this.eventManagers[e._key()]={manager:r},this.iframes[e._key()]=t,r}_isIframeWebStorageSupported(e,t){this.iframes[e._key()].send(Uy,{type:Uy},s=>{var o;const i=(o=s==null?void 0:s[0])==null?void 0:o[Uy];i!==void 0&&t(!!i),Tr(e,"internal-error")},gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER)}_originValidation(e){const t=e._key();return this.originValidationPromises[t]||(this.originValidationPromises[t]=WB(e)),this.originValidationPromises[t]}get _shouldInitProactively(){return OP()||NP()||Nx()}}const pz=gz;class dD{constructor(e){this.factorId=e}_process(e,t,r){switch(t.type){case"enroll":return this._finalizeEnroll(e,t.credential,r);case"signin":return this._finalizeSignIn(e,t.credential);default:return Fs("unexpected MultiFactorSessionType")}}}class zx extends dD{constructor(e){super("phone"),this.credential=e}static _fromCredential(e){return new zx(e)}_finalizeEnroll(e,t,r){return eB(e,{idToken:t,displayName:r,phoneVerificationInfo:this.credential._makeVerificationRequest()})}_finalizeSignIn(e,t){return vB(e,{mfaPendingCredential:t,phoneVerificationInfo:this.credential._makeVerificationRequest()})}}class mz{constructor(){}static assertion(e){return zx._fromCredential(e)}}mz.FACTOR_ID="phone";class yz{static assertionForEnrollment(e,t){return Yd._fromSecret(e,t)}static assertionForSignIn(e,t){return Yd._fromEnrollmentId(e,t)}static async generateSecret(e){var s;const t=e;X(typeof((s=t.user)==null?void 0:s.auth)<"u","internal-error");const r=await tB(t.user.auth,{idToken:t.credential,totpEnrollmentInfo:{}});return qx._fromStartTotpMfaEnrollmentResponse(r,t.user.auth)}}yz.FACTOR_ID="totp";class Yd extends dD{constructor(e,t,r){super("totp"),this.otp=e,this.enrollmentId=t,this.secret=r}static _fromSecret(e,t){return new Yd(t,void 0,e)}static _fromEnrollmentId(e,t){return new Yd(t,e)}async _finalizeEnroll(e,t,r){return X(typeof this.secret<"u",e,"argument-error"),nB(e,{idToken:t,displayName:r,totpVerificationInfo:this.secret._makeTotpVerificationInfo(this.otp)})}async _finalizeSignIn(e,t){X(this.enrollmentId!==void 0&&this.otp!==void 0,e,"argument-error");const r={verificationCode:this.otp};return wB(e,{mfaPendingCredential:t,mfaEnrollmentId:this.enrollmentId,totpVerificationInfo:r})}}class qx{constructor(e,t,r,s,i,o,a){this.sessionInfo=o,this.auth=a,this.secretKey=e,this.hashingAlgorithm=t,this.codeLength=r,this.codeIntervalSeconds=s,this.enrollmentCompletionDeadline=i}static _fromStartTotpMfaEnrollmentResponse(e,t){return new qx(e.totpSessionInfo.sharedSecretKey,e.totpSessionInfo.hashingAlgorithm,e.totpSessionInfo.verificationCodeLength,e.totpSessionInfo.periodSec,new Date(e.totpSessionInfo.finalizeEnrollmentTime).toUTCString(),e.totpSessionInfo.sessionInfo,t)}_makeTotpVerificationInfo(e){return{sessionInfo:this.sessionInfo,verificationCode:e}}generateQrCodeUrl(e,t){var s;let r=!1;return(xf(e)||xf(t))&&(r=!0),r&&(xf(e)&&(e=((s=this.auth.currentUser)==null?void 0:s.email)||"unknownuser"),xf(t)&&(t=this.auth.name)),`otpauth://totp/${t}:${e}?secret=${this.secretKey}&issuer=${t}&algorithm=${this.hashingAlgorithm}&digits=${this.codeLength}`}}function xf(n){return typeof n>"u"||(n==null?void 0:n.length)===0}var yb="@firebase/auth",_b="1.11.0";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class _z{constructor(e){this.auth=e,this.internalListeners=new Map}getUid(){var e;return this.assertAuthConfigured(),((e=this.auth.currentUser)==null?void 0:e.uid)||null}async getToken(e){return this.assertAuthConfigured(),await this.auth._initializationPromise,this.auth.currentUser?{accessToken:await this.auth.currentUser.getIdToken(e)}:null}addAuthTokenListener(e){if(this.assertAuthConfigured(),this.internalListeners.has(e))return;const t=this.auth.onIdTokenChanged(r=>{e((r==null?void 0:r.stsTokenManager.accessToken)||null)});this.internalListeners.set(e,t),this.updateProactiveRefresh()}removeAuthTokenListener(e){this.assertAuthConfigured();const t=this.internalListeners.get(e);t&&(this.internalListeners.delete(e),t(),this.updateProactiveRefresh())}assertAuthConfigured(){X(this.auth._initializationPromise,"dependent-sdk-initialized-before-auth")}updateProactiveRefresh(){this.internalListeners.size>0?this.auth._startProactiveRefresh():this.auth._stopProactiveRefresh()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function vz(n){switch(n){case"Node":return"node";case"ReactNative":return"rn";case"Worker":return"webworker";case"Cordova":return"cordova";case"WebExtension":return"web-extension";default:return}}function wz(n){ws(new Sr("auth",(e,{options:t})=>{const r=e.getProvider("app").getImmediate(),s=e.getProvider("heartbeat"),i=e.getProvider("app-check-internal"),{apiKey:o,authDomain:a}=r.options;X(o&&!o.includes(":"),"invalid-api-key",{appName:r.name});const l={apiKey:o,authDomain:a,clientPlatform:n,apiHost:"identitytoolkit.googleapis.com",tokenApiHost:"securetoken.googleapis.com",apiScheme:"https",sdkClientVersion:VP(n)},u=new ZU(r,s,i,l);return f$(u,t),u},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((e,t,r)=>{e.getProvider("auth-internal").initialize()})),ws(new Sr("auth-internal",e=>{const t=ln(e.getProvider("auth").getImmediate());return(r=>new _z(r))(t)},"PRIVATE").setInstantiationMode("EXPLICIT")),Ir(yb,_b,vz(n)),Ir(yb,_b,"esm2020")}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const xz=5*60,Iz=X1("authIdTokenMaxAge")||xz;let vb=null;const Ez=n=>async e=>{const t=e&&await e.getIdTokenResult(),r=t&&(new Date().getTime()-Date.parse(t.issuedAtTime))/1e3;if(r&&r>Iz)return;const s=t==null?void 0:t.token;vb!==s&&(vb=s,await fetch(n,{method:s?"POST":"DELETE",headers:s?{Authorization:`Bearer ${s}`}:{}}))};function Sz(n=sh()){const e=Qs(n,"auth");if(e.isInitialized())return e.getImmediate();const t=h$(n,{popupRedirectResolver:pz,persistence:[_B,XP,tD]}),r=X1("authTokenSyncURL");if(r&&typeof isSecureContext=="boolean"&&isSecureContext){const i=new URL(r,location.origin);if(location.origin===i.origin){const o=Ez(i.toString());Z$(t,o,()=>o(t.currentUser)),X$(t,a=>o(a))}}const s=Q1("auth");return s&&g$(t,`http://${s}`),t}function Tz(){var n;return((n=document.getElementsByTagName("head"))==null?void 0:n[0])??document}e$({loadJS(n){return new Promise((e,t)=>{const r=document.createElement("script");r.setAttribute("src",n),r.onload=e,r.onerror=s=>{const i=lr("internal-error");i.customData=s,t(i)},r.type="text/javascript",r.charset="UTF-8",Tz().appendChild(r)})},gapiScript:"https://apis.google.com/js/api.js",recaptchaV2Script:"https://www.google.com/recaptcha/api.js",recaptchaEnterpriseScript:"https://www.google.com/recaptcha/enterprise.js?render="});wz("Browser");const hD="@firebase/installations",Wx="0.6.19";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const fD=1e4,gD=`w:${Wx}`,pD="FIS_v2",bz="https://firebaseinstallations.googleapis.com/v1",Az=60*60*1e3,Cz="installations",Rz="Installations";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Nz={"missing-app-config-values":'Missing App configuration value: "{$valueName}"',"not-registered":"Firebase Installation is not registered.","installation-not-found":"Firebase Installation not found.","request-failed":'{$requestName} request failed with error "{$serverCode} {$serverStatus}: {$serverMessage}"',"app-offline":"Could not process request. Application offline.","delete-pending-registration":"Can't delete installation while there is a pending registration request."},Ua=new qa(Cz,Rz,Nz);function mD(n){return n instanceof xs&&n.code.includes("request-failed")}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function yD({projectId:n}){return`${bz}/projects/${n}/installations`}function _D(n){return{token:n.token,requestStatus:2,expiresIn:Pz(n.expiresIn),creationTime:Date.now()}}async function vD(n,e){const r=(await e.json()).error;return Ua.create("request-failed",{requestName:n,serverCode:r.code,serverMessage:r.message,serverStatus:r.status})}function wD({apiKey:n}){return new Headers({"Content-Type":"application/json",Accept:"application/json","x-goog-api-key":n})}function kz(n,{refreshToken:e}){const t=wD(n);return t.append("Authorization",Dz(e)),t}async function xD(n){const e=await n();return e.status>=500&&e.status<600?n():e}function Pz(n){return Number(n.replace("s","000"))}function Dz(n){return`${pD} ${n}`}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Mz({appConfig:n,heartbeatServiceProvider:e},{fid:t}){const r=yD(n),s=wD(n),i=e.getImmediate({optional:!0});if(i){const u=await i.getHeartbeatsHeader();u&&s.append("x-firebase-client",u)}const o={fid:t,authVersion:pD,appId:n.appId,sdkVersion:gD},a={method:"POST",headers:s,body:JSON.stringify(o)},l=await xD(()=>fetch(r,a));if(l.ok){const u=await l.json();return{fid:u.fid||t,registrationStatus:2,refreshToken:u.refreshToken,authToken:_D(u.authToken)}}else throw await vD("Create Installation",l)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ID(n){return new Promise(e=>{setTimeout(e,n)})}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Lz(n){return btoa(String.fromCharCode(...n)).replace(/\+/g,"-").replace(/\//g,"_")}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Oz=/^[cdef][\w-]{21}$/,Ov="";function Vz(){try{const n=new Uint8Array(17);(self.crypto||self.msCrypto).getRandomValues(n),n[0]=112+n[0]%16;const t=Fz(n);return Oz.test(t)?t:Ov}catch{return Ov}}function Fz(n){return Lz(n).substr(0,22)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Pm(n){return`${n.appName}!${n.appId}`}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ED=new Map;function SD(n,e){const t=Pm(n);TD(t,e),jz(t,e)}function TD(n,e){const t=ED.get(n);if(t)for(const r of t)r(e)}function jz(n,e){const t=Uz();t&&t.postMessage({key:n,fid:e}),$z()}let ha=null;function Uz(){return!ha&&"BroadcastChannel"in self&&(ha=new BroadcastChannel("[Firebase] FID Change"),ha.onmessage=n=>{TD(n.data.key,n.data.fid)}),ha}function $z(){ED.size===0&&ha&&(ha.close(),ha=null)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Bz="firebase-installations-database",zz=1,$a="firebase-installations-store";let $y=null;function Gx(){return $y||($y=uC(Bz,zz,{upgrade:(n,e)=>{switch(e){case 0:n.createObjectStore($a)}}})),$y}async function up(n,e){const t=Pm(n),s=(await Gx()).transaction($a,"readwrite"),i=s.objectStore($a),o=await i.get(t);return await i.put(e,t),await s.done,(!o||o.fid!==e.fid)&&SD(n,e.fid),e}async function bD(n){const e=Pm(n),r=(await Gx()).transaction($a,"readwrite");await r.objectStore($a).delete(e),await r.done}async function Dm(n,e){const t=Pm(n),s=(await Gx()).transaction($a,"readwrite"),i=s.objectStore($a),o=await i.get(t),a=e(o);return a===void 0?await i.delete(t):await i.put(a,t),await s.done,a&&(!o||o.fid!==a.fid)&&SD(n,a.fid),a}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Hx(n){let e;const t=await Dm(n.appConfig,r=>{const s=qz(r),i=Wz(n,s);return e=i.registrationPromise,i.installationEntry});return t.fid===Ov?{installationEntry:await e}:{installationEntry:t,registrationPromise:e}}function qz(n){const e=n||{fid:Vz(),registrationStatus:0};return AD(e)}function Wz(n,e){if(e.registrationStatus===0){if(!navigator.onLine){const s=Promise.reject(Ua.create("app-offline"));return{installationEntry:e,registrationPromise:s}}const t={fid:e.fid,registrationStatus:1,registrationTime:Date.now()},r=Gz(n,t);return{installationEntry:t,registrationPromise:r}}else return e.registrationStatus===1?{installationEntry:e,registrationPromise:Hz(n)}:{installationEntry:e}}async function Gz(n,e){try{const t=await Mz(n,e);return up(n.appConfig,t)}catch(t){throw mD(t)&&t.customData.serverCode===409?await bD(n.appConfig):await up(n.appConfig,{fid:e.fid,registrationStatus:0}),t}}async function Hz(n){let e=await wb(n.appConfig);for(;e.registrationStatus===1;)await ID(100),e=await wb(n.appConfig);if(e.registrationStatus===0){const{installationEntry:t,registrationPromise:r}=await Hx(n);return r||t}return e}function wb(n){return Dm(n,e=>{if(!e)throw Ua.create("installation-not-found");return AD(e)})}function AD(n){return Kz(n)?{fid:n.fid,registrationStatus:0}:n}function Kz(n){return n.registrationStatus===1&&n.registrationTime+fD<Date.now()}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Qz({appConfig:n,heartbeatServiceProvider:e},t){const r=Yz(n,t),s=kz(n,t),i=e.getImmediate({optional:!0});if(i){const u=await i.getHeartbeatsHeader();u&&s.append("x-firebase-client",u)}const o={installation:{sdkVersion:gD,appId:n.appId}},a={method:"POST",headers:s,body:JSON.stringify(o)},l=await xD(()=>fetch(r,a));if(l.ok){const u=await l.json();return _D(u)}else throw await vD("Generate Auth Token",l)}function Yz(n,{fid:e}){return`${yD(n)}/${e}/authTokens:generate`}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Kx(n,e=!1){let t;const r=await Dm(n.appConfig,i=>{if(!CD(i))throw Ua.create("not-registered");const o=i.authToken;if(!e&&Zz(o))return i;if(o.requestStatus===1)return t=Jz(n,e),i;{if(!navigator.onLine)throw Ua.create("app-offline");const a=t9(i);return t=Xz(n,a),a}});return t?await t:r.authToken}async function Jz(n,e){let t=await xb(n.appConfig);for(;t.authToken.requestStatus===1;)await ID(100),t=await xb(n.appConfig);const r=t.authToken;return r.requestStatus===0?Kx(n,e):r}function xb(n){return Dm(n,e=>{if(!CD(e))throw Ua.create("not-registered");const t=e.authToken;return n9(t)?{...e,authToken:{requestStatus:0}}:e})}async function Xz(n,e){try{const t=await Qz(n,e),r={...e,authToken:t};return await up(n.appConfig,r),t}catch(t){if(mD(t)&&(t.customData.serverCode===401||t.customData.serverCode===404))await bD(n.appConfig);else{const r={...e,authToken:{requestStatus:0}};await up(n.appConfig,r)}throw t}}function CD(n){return n!==void 0&&n.registrationStatus===2}function Zz(n){return n.requestStatus===2&&!e9(n)}function e9(n){const e=Date.now();return e<n.creationTime||n.creationTime+n.expiresIn<e+Az}function t9(n){const e={requestStatus:1,requestTime:Date.now()};return{...n,authToken:e}}function n9(n){return n.requestStatus===1&&n.requestTime+fD<Date.now()}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function r9(n){const e=n,{installationEntry:t,registrationPromise:r}=await Hx(e);return r?r.catch(console.error):Kx(e).catch(console.error),t.fid}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function s9(n,e=!1){const t=n;return await i9(t),(await Kx(t,e)).token}async function i9(n){const{registrationPromise:e}=await Hx(n);e&&await e}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function o9(n){if(!n||!n.options)throw By("App Configuration");if(!n.name)throw By("App Name");const e=["projectId","apiKey","appId"];for(const t of e)if(!n.options[t])throw By(t);return{appName:n.name,projectId:n.options.projectId,apiKey:n.options.apiKey,appId:n.options.appId}}function By(n){return Ua.create("missing-app-config-values",{valueName:n})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const RD="installations",a9="installations-internal",l9=n=>{const e=n.getProvider("app").getImmediate(),t=o9(e),r=Qs(e,"heartbeat");return{app:e,appConfig:t,heartbeatServiceProvider:r,_delete:()=>Promise.resolve()}},c9=n=>{const e=n.getProvider("app").getImmediate(),t=Qs(e,RD).getImmediate();return{getId:()=>r9(t),getToken:s=>s9(t,s)}};function u9(){ws(new Sr(RD,l9,"PUBLIC")),ws(new Sr(a9,c9,"PRIVATE"))}u9();Ir(hD,Wx);Ir(hD,Wx,"esm2020");/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const dp="analytics",d9="firebase_id",h9="origin",f9=60*1e3,g9="https://firebase.googleapis.com/v1alpha/projects/-/apps/{app-id}/webConfig",Qx="https://www.googletagmanager.com/gtag/js";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Er=new rh("@firebase/analytics");/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const p9={"already-exists":"A Firebase Analytics instance with the appId {$id}  already exists. Only one Firebase Analytics instance can be created for each appId.","already-initialized":"initializeAnalytics() cannot be called again with different options than those it was initially called with. It can be called again with the same options to return the existing instance, or getAnalytics() can be used to get a reference to the already-initialized instance.","already-initialized-settings":"Firebase Analytics has already been initialized.settings() must be called before initializing any Analytics instanceor it will have no effect.","interop-component-reg-failed":"Firebase Analytics Interop Component failed to instantiate: {$reason}","invalid-analytics-context":"Firebase Analytics is not supported in this environment. Wrap initialization of analytics in analytics.isSupported() to prevent initialization in unsupported environments. Details: {$errorInfo}","indexeddb-unavailable":"IndexedDB unavailable or restricted in this environment. Wrap initialization of analytics in analytics.isSupported() to prevent initialization in unsupported environments. Details: {$errorInfo}","fetch-throttle":"The config fetch request timed out while in an exponential backoff state. Unix timestamp in milliseconds when fetch request throttling ends: {$throttleEndTimeMillis}.","config-fetch-failed":"Dynamic config fetch failed: [{$httpStatus}] {$responseMessage}","no-api-key":'The "apiKey" field is empty in the local Firebase config. Firebase Analytics requires this field tocontain a valid API key.',"no-app-id":'The "appId" field is empty in the local Firebase config. Firebase Analytics requires this field tocontain a valid app ID.',"no-client-id":'The "client_id" field is empty.',"invalid-gtag-resource":"Trusted Types detected an invalid gtag resource: {$gtagURL}."},Fr=new qa("analytics","Analytics",p9);/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function m9(n){if(!n.startsWith(Qx)){const e=Fr.create("invalid-gtag-resource",{gtagURL:n});return Er.warn(e.message),""}return n}function ND(n){return Promise.all(n.map(e=>e.catch(t=>t)))}function y9(n,e){let t;return window.trustedTypes&&(t=window.trustedTypes.createPolicy(n,e)),t}function _9(n,e){const t=y9("firebase-js-sdk-policy",{createScriptURL:m9}),r=document.createElement("script"),s=`${Qx}?l=${n}&id=${e}`;r.src=t?t==null?void 0:t.createScriptURL(s):s,r.async=!0,document.head.appendChild(r)}function v9(n){let e=[];return Array.isArray(window[n])?e=window[n]:window[n]=e,e}async function w9(n,e,t,r,s,i){const o=r[s];try{if(o)await e[o];else{const l=(await ND(t)).find(u=>u.measurementId===s);l&&await e[l.appId]}}catch(a){Er.error(a)}n("config",s,i)}async function x9(n,e,t,r,s){try{let i=[];if(s&&s.send_to){let o=s.send_to;Array.isArray(o)||(o=[o]);const a=await ND(t);for(const l of o){const u=a.find(f=>f.measurementId===l),h=u&&e[u.appId];if(h)i.push(h);else{i=[];break}}}i.length===0&&(i=Object.values(e)),await Promise.all(i),n("event",r,s||{})}catch(i){Er.error(i)}}function I9(n,e,t,r){async function s(i,...o){try{if(i==="event"){const[a,l]=o;await x9(n,e,t,a,l)}else if(i==="config"){const[a,l]=o;await w9(n,e,t,r,a,l)}else if(i==="consent"){const[a,l]=o;n("consent",a,l)}else if(i==="get"){const[a,l,u]=o;n("get",a,l,u)}else if(i==="set"){const[a]=o;n("set",a)}else n(i,...o)}catch(a){Er.error(a)}}return s}function E9(n,e,t,r,s){let i=function(...o){window[r].push(arguments)};return window[s]&&typeof window[s]=="function"&&(i=window[s]),window[s]=I9(i,n,e,t),{gtagCore:i,wrappedGtag:window[s]}}function S9(n){const e=window.document.getElementsByTagName("script");for(const t of Object.values(e))if(t.src&&t.src.includes(Qx)&&t.src.includes(n))return t;return null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const T9=30,b9=1e3;class A9{constructor(e={},t=b9){this.throttleMetadata=e,this.intervalMillis=t}getThrottleMetadata(e){return this.throttleMetadata[e]}setThrottleMetadata(e,t){this.throttleMetadata[e]=t}deleteThrottleMetadata(e){delete this.throttleMetadata[e]}}const kD=new A9;function C9(n){return new Headers({Accept:"application/json","x-goog-api-key":n})}async function R9(n){var o;const{appId:e,apiKey:t}=n,r={method:"GET",headers:C9(t)},s=g9.replace("{app-id}",e),i=await fetch(s,r);if(i.status!==200&&i.status!==304){let a="";try{const l=await i.json();(o=l.error)!=null&&o.message&&(a=l.error.message)}catch{}throw Fr.create("config-fetch-failed",{httpStatus:i.status,responseMessage:a})}return i.json()}async function N9(n,e=kD,t){const{appId:r,apiKey:s,measurementId:i}=n.options;if(!r)throw Fr.create("no-app-id");if(!s){if(i)return{measurementId:i,appId:r};throw Fr.create("no-api-key")}const o=e.getThrottleMetadata(r)||{backoffCount:0,throttleEndTimeMillis:Date.now()},a=new D9;return setTimeout(async()=>{a.abort()},t!==void 0?t:f9),PD({appId:r,apiKey:s,measurementId:i},o,a,e)}async function PD(n,{throttleEndTimeMillis:e,backoffCount:t},r,s=kD){var a;const{appId:i,measurementId:o}=n;try{await k9(r,e)}catch(l){if(o)return Er.warn(`Timed out fetching this Firebase app's measurement ID from the server. Falling back to the measurement ID ${o} provided in the "measurementId" field in the local Firebase config. [${l==null?void 0:l.message}]`),{appId:i,measurementId:o};throw l}try{const l=await R9(n);return s.deleteThrottleMetadata(i),l}catch(l){const u=l;if(!P9(u)){if(s.deleteThrottleMetadata(i),o)return Er.warn(`Failed to fetch this Firebase app's measurement ID from the server. Falling back to the measurement ID ${o} provided in the "measurementId" field in the local Firebase config. [${u==null?void 0:u.message}]`),{appId:i,measurementId:o};throw l}const h=Number((a=u==null?void 0:u.customData)==null?void 0:a.httpStatus)===503?FE(t,s.intervalMillis,T9):FE(t,s.intervalMillis),f={throttleEndTimeMillis:Date.now()+h,backoffCount:t+1};return s.setThrottleMetadata(i,f),Er.debug(`Calling attemptFetch again in ${h} millis`),PD(n,f,r,s)}}function k9(n,e){return new Promise((t,r)=>{const s=Math.max(e-Date.now(),0),i=setTimeout(t,s);n.addEventListener(()=>{clearTimeout(i),r(Fr.create("fetch-throttle",{throttleEndTimeMillis:e}))})})}function P9(n){if(!(n instanceof xs)||!n.customData)return!1;const e=Number(n.customData.httpStatus);return e===429||e===500||e===503||e===504}class D9{constructor(){this.listeners=[]}addEventListener(e){this.listeners.push(e)}abort(){this.listeners.forEach(e=>e())}}async function M9(n,e,t,r,s){if(s&&s.global){n("event",t,r);return}else{const i=await e,o={...r,send_to:i};n("event",t,o)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function L9(){if(Np())try{await L0()}catch(n){return Er.warn(Fr.create("indexeddb-unavailable",{errorInfo:n==null?void 0:n.toString()}).message),!1}else return Er.warn(Fr.create("indexeddb-unavailable",{errorInfo:"IndexedDB is not available in this environment."}).message),!1;return!0}async function O9(n,e,t,r,s,i,o){const a=N9(n);a.then(g=>{t[g.measurementId]=g.appId,n.options.measurementId&&g.measurementId!==n.options.measurementId&&Er.warn(`The measurement ID in the local Firebase config (${n.options.measurementId}) does not match the measurement ID fetched from the server (${g.measurementId}). To ensure analytics events are always sent to the correct Analytics property, update the measurement ID field in the local config or remove it from the local config.`)}).catch(g=>Er.error(g)),e.push(a);const l=L9().then(g=>{if(g)return r.getId()}),[u,h]=await Promise.all([a,l]);S9(i)||_9(i,u.measurementId),s("js",new Date);const f=(o==null?void 0:o.config)??{};return f[h9]="firebase",f.update=!0,h!=null&&(f[d9]=h),s("config",u.measurementId,f),u.measurementId}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class V9{constructor(e){this.app=e}_delete(){return delete sd[this.app.options.appId],Promise.resolve()}}let sd={},Ib=[];const Eb={};let zy="dataLayer",F9="gtag",Sb,DD,Tb=!1;function j9(){const n=[];if(M0()&&n.push("This is a browser extension environment."),iC()||n.push("Cookies are not available."),n.length>0){const e=n.map((r,s)=>`(${s+1}) ${r}`).join(" "),t=Fr.create("invalid-analytics-context",{errorInfo:e});Er.warn(t.message)}}function U9(n,e,t){j9();const r=n.options.appId;if(!r)throw Fr.create("no-app-id");if(!n.options.apiKey)if(n.options.measurementId)Er.warn(`The "apiKey" field is empty in the local Firebase config. This is needed to fetch the latest measurement ID for this Firebase app. Falling back to the measurement ID ${n.options.measurementId} provided in the "measurementId" field in the local Firebase config.`);else throw Fr.create("no-api-key");if(sd[r]!=null)throw Fr.create("already-exists",{id:r});if(!Tb){v9(zy);const{wrappedGtag:i,gtagCore:o}=E9(sd,Ib,Eb,zy,F9);DD=i,Sb=o,Tb=!0}return sd[r]=O9(n,Ib,Eb,e,Sb,zy,t),new V9(n)}function $9(n=sh()){n=ae(n);const e=Qs(n,dp);return e.isInitialized()?e.getImmediate():B9(n)}function B9(n,e={}){const t=Qs(n,dp);if(t.isInitialized()){const s=t.getImmediate();if(Ur(e,t.getOptions()))return s;throw Fr.create("already-initialized")}return t.initialize({options:e})}async function z9(){if(M0()||!iC()||!Np())return!1;try{return await L0()}catch{return!1}}function q9(n,e,t,r){n=ae(n),M9(DD,sd[n.app.options.appId],e,t,r).catch(s=>Er.error(s))}const bb="@firebase/analytics",Ab="0.10.18";function W9(){ws(new Sr(dp,(e,{options:t})=>{const r=e.getProvider("app").getImmediate(),s=e.getProvider("installations-internal").getImmediate();return U9(r,s,t)},"PUBLIC")),ws(new Sr("analytics-internal",n,"PRIVATE")),Ir(bb,Ab),Ir(bb,Ab,"esm2020");function n(e){try{const t=e.getProvider(dp).getImmediate();return{logEvent:(r,s,i)=>q9(t,r,s,i)}}catch(t){throw Fr.create("interop-component-reg-failed",{reason:t})}}}W9();const MD={apiKey:"AIzaSyAdJ3lRxhgZWhnqH8SNQsT1bTFB8E0-cDg",authDomain:"quitarena-a97de.firebaseapp.com",databaseURL:"https://quitarena-a97de-default-rtdb.europe-west1.firebasedatabase.app",projectId:"quitarena-a97de",storageBucket:"quitarena-a97de.firebasestorage.app",messagingSenderId:"693525963288",appId:"1:693525963288:web:a175e9a8bd56fffb35596d",measurementId:"G-H2CCRXYY74"},Mm=sV().length?sh():dC(MD),q=R4(Mm,MD.databaseURL),si=eU(Mm),so=Sz(Mm);console.log("✅ Firebase services initialized:",{db:!!q,firestore:!!si,auth:!!so});J$(so,XP).then(()=>{console.log("Firebase Auth persistence configured for 30 days")}).catch(n=>{console.error("Error setting auth persistence:",n)});let G9=null;(async()=>{try{await z9()&&(G9=$9(Mm))}catch(n){console.debug("Analytics not initialized:",n==null?void 0:n.message)}})();class Lm{constructor(e,t){this.db=e,this.userUID=t,this.userRef=ge(e,`users/${t}`),this.statsRef=ge(e,`users/${t}/stats`),this.profileRef=ge(e,`users/${t}/profile`),this.behaviorLogRef=ge(e,`users/${t}/behaviorLog`)}async updateStat(e,t,r=""){try{console.log(`🔄 StatManager: updateStat called - ${e}: ${t>0?"+":""}${t} (${r})`);const s=await Fe(this.statsRef);if(!s.exists())return console.error(`❌ StatManager: Stats don't exist for user ${this.userUID}`),!1;const i=s.val(),o=i[e]||0,a=Math.max(0,Math.min(100,o+t));console.log(`🔄 StatManager: ${e} change: ${o} → ${a} (${t>0?"+":""}${t})`),console.log(`🔄 StatManager: About to write to Firebase - ${e}: ${a}`),console.log("🔄 StatManager: Writing to path:",this.statsRef.toString()),console.log("🔄 StatManager: Full stats object to write:",{...i,[e]:a});try{await ct(this.statsRef,{...i,[e]:a}),console.log(`✅ StatManager: Successfully updated ${e} in Firebase`)}catch(l){throw console.error(`❌ StatManager: Firebase write failed for ${e}:`,l),l}return await this.logBehavior(e,t,r),this.showStatNotification(e,t,r),console.log(`${e}: ${t>0?"+":""}${t} (${r})`),!0}catch(s){return console.error(`❌ StatManager: CRITICAL ERROR updating ${e}:`,s),console.error("❌ StatManager: Error details:",{message:s.message,code:s.code,stack:s.stack}),!1}}async updateAddictionFromCleanTime(){try{const e=await Fe(ge(this.db,`users/${this.userUID}/profile/lastRelapseDate`)),t=await Fe(this.userRef);if(!t.exists())return;const r=t.val(),s=e.exists()?new Date(e.val()):new Date(r.quitDate||Date.now()),o=Math.floor((new Date-s)/(1e3*60*60*24*7));if(o>=1){const a=o*2;await this.updateStat("addictionLevel",-a,`Clean time: ${o} week(s)`),o>=1&&await this.resetRelapseEscalationLevel()}}catch(e){console.error("Error updating addiction from clean time:",e)}}async handleRelapse(){try{console.log("🔄 StatManager: handleRelapse() called for user:",this.userUID);const e=new Date,t=await Fe(ge(this.db,`users/${this.userUID}/profile/lastRelapseDate`)),r=await Fe(ge(this.db,`users/${this.userUID}/profile/relapseEscalationLevel`));let s=1;if(console.log("🔄 StatManager: Last relapse exists:",t.exists()),console.log("🔄 StatManager: Current escalation level exists:",r.exists()),t.exists()){const o=new Date(t.val()),a=Math.floor((e-o)/(1e3*60*60*24)),l=r.exists()?r.val():1;console.log(`🔄 StatManager: Current escalation level from Firebase: ${l}`),console.log(`🔄 StatManager: Days since last relapse: ${a}`),a>=7?(s=1,console.log(`🔄 StatManager: After 7+ days clean → escalation level reset to: ${s}`)):(s=l+1,console.log(`🔄 StatManager: Within ${a} days → escalation level: ${l} + 1 = ${s}`))}let i=0;switch(s){case 1:i=4;break;case 2:i=6;break;default:i=8;break}console.log(`🔄 StatManager: Escalation level ${s} → addiction increase: +${i}`),console.log("🔄 StatManager: Updating all stats in single write operation...");try{const o=await Fe(this.statsRef);if(!o.exists())return console.error("❌ StatManager: No stats found for user"),!1;const a=o.val();console.log("🔄 StatManager: Current stats before relapse:",a);const l=Math.max(0,Math.min(100,(a.addictionLevel||0)+i)),u=Math.max(0,Math.min(100,(a.mentalStrength||0)-3)),h=Math.max(0,Math.min(100,(a.triggerDefense||0)-3));console.log(`🔄 StatManager: addictionLevel change: ${a.addictionLevel} → ${l} (+${i})`),console.log(`🔄 StatManager: mentalStrength change: ${a.mentalStrength} → ${u} (-3)`),console.log(`🔄 StatManager: triggerDefense change: ${a.triggerDefense} → ${h} (-3)`);const f={...a,addictionLevel:l,mentalStrength:u,triggerDefense:h};console.log("🔄 StatManager: Writing complete updated stats:",f),await ct(this.statsRef,f),console.log("✅ StatManager: Successfully updated ALL stats in single write"),await Promise.all([this.logBehavior("addictionLevel",i,`Relapse escalation level ${s}`),this.logBehavior("mentalStrength",-3,"Relapse setback"),this.logBehavior("triggerDefense",-3,"Relapse to known trigger")]),this.showStatNotification("addictionLevel",i,`Relapse escalation level ${s}`),this.showStatNotification("mentalStrength",-3,"Relapse setback"),this.showStatNotification("triggerDefense",-3,"Relapse to known trigger")}catch(o){throw console.error("❌ StatManager: CRITICAL ERROR updating relapse stats:",o),o}return await Promise.all([ct(ge(this.db,`users/${this.userUID}/profile/lastRelapseDate`),e.toISOString()),ct(ge(this.db,`users/${this.userUID}/profile/relapseDate`),e.toISOString()),ct(ge(this.db,`users/${this.userUID}/profile/relapseEscalationLevel`),s)]),await this.logBehavior("relapse",s,`Escalation level ${s} - ${i} addiction, -3 mental, -3 trigger defense`),!0}catch(e){return console.error("Error handling relapse:",e),!1}}async resetRelapseEscalationLevel(){try{await ct(ge(this.db,`users/${this.userUID}/profile/relapseEscalationLevel`),1),console.log("Relapse escalation level reset")}catch(e){console.error("Error resetting relapse escalation level:",e)}}async getAddictionStatus(){try{const e=await Fe(ge(this.db,`users/${this.userUID}/profile/lastRelapseDate`)),t=await Fe(ge(this.db,`users/${this.userUID}/profile/relapseEscalationLevel`)),r=await Fe(this.userRef);if(!r.exists())return null;const s=r.val(),i=e.exists()?new Date(e.val()):new Date(s.quitDate||Date.now()),o=t.exists()?t.val():1,a=new Date,l=Math.floor((a-i)/(1e3*60*60*24)),u=Math.floor((a-i)/(1e3*60*60*24*7));return{lastRelapseDate:i,escalationLevel:o,daysSinceLastRelapse:l,cleanWeeks:u,isCleanFor7Days:l>=7}}catch(e){return console.error("Error getting addiction status:",e),null}}async getCurrentEscalationLevel(){try{const e=await Fe(ge(this.db,`users/${this.userUID}/profile/relapseEscalationLevel`));return e.exists()?e.val():1}catch(e){return console.error("Error getting current escalation level:",e),1}}async handleCravingResistance(){try{const e=new Date().toDateString(),t=await this.checkDailyCravingResistanceLimits(e);if(!t.canAwardMentalStrength&&!t.canAwardTriggerDefense)return console.log("Daily craving resistance limits reached for both stats"),await this.trackAppUsageDuringCravings(),!0;const r=[];return t.canAwardMentalStrength?r.push(this.updateStat("mentalStrength",1,"Successful craving resistance")):console.log("Daily mental strength limit reached for craving resistance"),t.canAwardTriggerDefense?r.push(this.updateStat("triggerDefense",3,"Surviving trigger situation")):console.log("Daily trigger defense limit reached for craving resistance"),r.length>0&&await Promise.all(r),await this.trackAppUsageDuringCravings(),await this.logDailyCravingResistance(e,t),!0}catch(e){return console.error("Error handling craving resistance:",e),!1}}async handleCravingLogged(){try{const e=new Date().toDateString(),t=await this.checkDailyCravingLoggingLimits(e);if(!t.canAwardMotivation&&!t.canAwardTriggerDefense)return console.log("Daily craving logging limits reached for both stats"),!0;const r=[];return t.canAwardMotivation?r.push(this.updateStat("motivation",.25,"Craving awareness and tracking")):console.log("Daily motivation limit reached for craving logging"),t.canAwardTriggerDefense?r.push(this.updateStat("triggerDefense",.25,"Craving awareness and tracking")):console.log("Daily trigger defense limit reached for craving logging"),r.length>0&&await Promise.all(r),await this.logDailyCravingLogging(e,t),!0}catch(e){return console.error("Error handling craving logged:",e),!1}}async handleBreathingExercise(){try{const e=new Date().toDateString();return await ct(ge(this.db,`users/${this.userUID}/profile/daily/${e}/breathing`),!0),await this.checkBreathingStreak()>=3&&await this.updateStat("mentalStrength",1,"3-day breathing exercise streak"),!0}catch(e){return console.error("Error handling breathing exercise:",e),!1}}async handleHydrationUpdate(e){try{const t=new Date().toDateString();return await ct(ge(this.db,`users/${this.userUID}/profile/daily/${t}/water`),e),await this.checkHydrationStreak()>=3&&await this.updateStat("mentalStrength",1,"3-day hydration streak"),!0}catch(t){return console.error("Error handling hydration update:",t),!1}}async checkMilestoneBonuses(){try{const e=await Fe(ge(this.db,`users/${this.userUID}/profile/relapseDate`)),t=await Fe(this.userRef);if(!t.exists())return;const r=t.val(),s=e.exists()?new Date(e.val()):new Date(r.quitDate||Date.now()),o=Math.floor((new Date-s)/(1e3*60*60*24)),a=[{days:7,bonus:5,name:"First week"},{days:30,bonus:10,name:"First month"},{days:90,bonus:15,name:"Three months"}];for(const l of a)if(o>=l.days){const u=`milestone_${l.days}`;(await Fe(ge(this.db,`users/${this.userUID}/profile/${u}`))).exists()||await Promise.all([this.updateStat("mentalStrength",l.bonus,`${l.name} milestone bonus`),ct(ge(this.db,`users/${this.userUID}/profile/${u}`),!0)])}}catch(e){console.error("Error checking milestone bonuses:",e)}}async trackLoggingActivity(){try{const e=new Date().toDateString(),t=new Date;return await ct(ge(this.db,`users/${this.userUID}/profile/daily/${e}/logged`),!0),await ct(ge(this.db,`users/${this.userUID}/profile/lastActivity`),t.toISOString()),await this.checkWeeklyLoggingFrequency()>=3&&await this.updateStat("motivation",2,"Regular logging (3+ days this week)"),!0}catch(e){return console.error("Error tracking logging activity:",e),!1}}async handleAchievementShare(){try{return await this.updateStat("motivation",3,"Sharing achievement"),!0}catch(e){return console.error("Error handling achievement share:",e),!1}}async handleTriggerPlanning(){try{return await this.updateStat("triggerDefense",1,"Pre-planning for known triggers"),!0}catch(e){return console.error("Error handling trigger planning:",e),!1}}async handleTriggerListUpdate(){try{return await this.updateStat("triggerDefense",1,"Updating trigger list"),!0}catch(e){return console.error("Error handling trigger list update:",e),!1}}async handleUnpreparedTrigger(){try{return await this.updateStat("triggerDefense",-1,"Entering trigger situation unprepared"),!0}catch(e){return console.error("Error handling unprepared trigger:",e),!1}}async checkBreathingStreak(){try{let e=0;for(let t=0;t<7;t++){const r=new Date;r.setDate(r.getDate()-t);const s=r.toDateString(),i=await Fe(ge(this.db,`users/${this.userUID}/profile/daily/${s}/breathing`));if(i.exists()&&i.val())e++;else break}return e}catch(e){return console.error("Error checking breathing streak:",e),0}}async checkHydrationStreak(){try{let e=0;for(let t=0;t<7;t++){const r=new Date;r.setDate(r.getDate()-t);const s=r.toDateString(),i=await Fe(ge(this.db,`users/${this.userUID}/profile/daily/${s}/water`));if(i.exists()&&i.val()>0)e++;else break}return e}catch(e){return console.error("Error checking hydration streak:",e),0}}async checkWeeklyLoggingFrequency(){try{let e=0;for(let t=0;t<7;t++){const r=new Date;r.setDate(r.getDate()-t);const s=r.toDateString(),i=await Fe(ge(this.db,`users/${this.userUID}/profile/daily/${s}/logged`));i.exists()&&i.val()&&e++}return e}catch(e){return console.error("Error checking weekly logging frequency:",e),0}}async checkInactivityPenalty(){try{const e=await Fe(this.userRef);if(!e.exists())return;const t=e.val(),r=new Date,s=t.createdAt?new Date(t.createdAt):t.quitStartDate?new Date(t.quitStartDate):r,i=Math.floor((r-s)/(1e3*60*60*24));if(i<1)return;const o=await Fe(ge(this.db,`users/${this.userUID}/profile/lastActivity`));if(o.exists()){const u=new Date(o.val()),h=Math.floor((r-u)/(1e3*60*60*24));if(h>=7&&i>=7){await this.updateStat("motivation",-3,"Long period inactive (7+ days)"),console.log(`Inactivity penalty applied: ${h} days since last activity`);return}}let a=null,l=null;for(let u=0;u<10;u++){const h=new Date;h.setDate(h.getDate()-u);const f=h.toDateString(),g=await Fe(ge(this.db,`users/${this.userUID}/profile/daily/${f}/logged`));if(g.exists()&&g.val()){a=u,l=h;break}}if(a===null||a>=7)if(l){const u=Math.floor((r-l)/864e5);u>=7&&i>=7&&(await this.updateStat("motivation",-3,"Long period inactive (7+ days)"),console.log(`Inactivity penalty applied: ${u} days since last activity`))}else i>=7&&(await this.updateStat("motivation",1,"Long period inactive (7+ days)"),console.log(`Inactivity penalty applied: ${i} days since registration with no activity`))}catch(e){console.error("Error checking inactivity penalty:",e)}}async trackAppUsageDuringCravings(){try{const t=`appUsage_${new Date().toDateString()}`,r=await Fe(ge(this.db,`users/${this.userUID}/profile/daily/${t}`));let s=r.exists()?r.val():0;s++,await ct(ge(this.db,`users/${this.userUID}/profile/daily/${t}`),s),s===3&&await this.updateStat("mentalStrength",1,"Using app during cravings (3 times, no relapse)")}catch(e){console.error("Error tracking app usage during cravings:",e)}}async logBehavior(e,t,r){try{const s={timestamp:Date.now(),statName:e,change:t,reason:r,date:new Date().toISOString()};await f4(ge(this.db,`users/${this.userUID}/behaviorLog`),s)}catch(s){console.error("Error logging behavior:",s)}}showStatNotification(e,t,r){const s=document.createElement("div");s.className=`fixed top-20 right-4 z-50 p-4 rounded-lg shadow-lg transition-all duration-500 transform translate-x-full ${t>0?"bg-green-500 text-white":"bg-red-500 text-white"}`,s.innerHTML=`
      <div class="flex items-center gap-2">
        <span class="text-lg">${t>0?"↗":"↘"}</span>
        <span class="font-bold">${e}</span>
        <span class="text-xl">${t>0?"+":""}${t}</span>
      </div>
      <div class="text-sm opacity-90">${r}</div>
    `,document.body.appendChild(s),setTimeout(()=>{s.classList.remove("translate-x-full")},100),setTimeout(()=>{s.classList.add("translate-x-full"),setTimeout(()=>{s.parentNode&&s.parentNode.removeChild(s)},500)},3e3)}async runDailyUpdates(){try{const e=await Fe(ge(this.db,`users/${this.userUID}`));if(!e.exists())return;const t=e.val(),r=new Date,s=t.createdAt?new Date(t.createdAt):t.quitStartDate?new Date(t.quitStartDate):r;if(Math.floor((r-s)/(1e3*60*60*24))<1)return;await Promise.all([this.updateAddictionFromCleanTime(),this.checkMilestoneBonuses(),this.checkInactivityPenalty()])}catch(e){console.error("Error running daily updates:",e)}}async initialize(){try{await this.ensureActivityTrackingInitialized(),setInterval(()=>{this.runDailyUpdates()},24*60*60*1e3),await this.runDailyUpdates()}catch(e){console.error("Error initializing StatManager:",e)}}async ensureActivityTrackingInitialized(){try{const e=await Fe(ge(this.db,`users/${this.userUID}/profile/lastActivity`)),t=await Fe(ge(this.db,`users/${this.userUID}/createdAt`));if(!e.exists()){const i=new Date;await ct(ge(this.db,`users/${this.userUID}/profile/lastActivity`),i.toISOString()),console.log("Initialized lastActivity timestamp for new user")}if(!t.exists()){const i=new Date;await ct(ge(this.db,`users/${this.userUID}/createdAt`),i.toISOString()),console.log("Initialized createdAt timestamp for new user");return}const r=new Date().toDateString();(await Fe(ge(this.db,`users/${this.userUID}/profile/daily/${r}/logged`))).exists()||(await ct(ge(this.db,`users/${this.userUID}/profile/daily/${r}/logged`),!0),console.log("Initialized today's activity tracking for new user"))}catch(e){console.error("Error ensuring activity tracking initialization:",e)}}async checkDailyCravingResistanceLimits(e){try{const t=await Fe(ge(this.db,`users/${this.userUID}/profile/daily/${e}/cravingResistanceStats`));if(!t.exists())return await ct(ge(this.db,`users/${this.userUID}/profile/daily/${e}/cravingResistanceStats`),{mentalStrength:0,triggerDefense:0}),{canAwardMentalStrength:!0,canAwardTriggerDefense:!0};const r=t.val(),s=r.mentalStrength||0,i=r.triggerDefense||0;return{canAwardMentalStrength:s<3,canAwardTriggerDefense:i<5}}catch(t){return console.error("Error checking daily craving resistance limits:",t),{canAwardMentalStrength:!0,canAwardTriggerDefense:!0}}}async logDailyCravingResistance(e,t){try{const r=await Fe(ge(this.db,`users/${this.userUID}/profile/daily/${e}/cravingResistanceStats`));r.exists()||await ct(ge(this.db,`users/${this.userUID}/profile/daily/${e}/cravingResistanceStats`),{mentalStrength:0,triggerDefense:0});const s=r.val(),i=s.mentalStrength||0,o=s.triggerDefense||0,a=t.canAwardMentalStrength?1:0,l=t.canAwardTriggerDefense?3:0;await ct(ge(this.db,`users/${this.userUID}/profile/daily/${e}/cravingResistanceStats`),{mentalStrength:Math.min(3,i+a),triggerDefense:Math.min(5,o+l)})}catch(r){console.error("Error logging daily craving resistance:",r)}}async getDailyCravingResistanceStats(e=null){try{const t=e||new Date().toDateString(),r=await Fe(ge(this.db,`users/${this.userUID}/profile/daily/${t}/cravingResistanceStats`));if(!r.exists())return{mentalStrength:0,triggerDefense:0,mentalStrengthLimit:3,triggerDefenseLimit:5,mentalStrengthRemaining:3,triggerDefenseRemaining:5};const s=r.val(),i=s.mentalStrength||0,o=s.triggerDefense||0;return{mentalStrength:i,triggerDefense:o,mentalStrengthLimit:3,triggerDefenseLimit:5,mentalStrengthRemaining:Math.max(0,3-i),triggerDefenseRemaining:Math.max(0,5-o)}}catch(t){return console.error("Error getting daily craving resistance stats:",t),{mentalStrength:0,triggerDefense:0,mentalStrengthLimit:3,triggerDefenseLimit:5,mentalStrengthRemaining:3,triggerDefenseRemaining:5}}}async checkDailyCravingLoggingLimits(e){try{const t=await Fe(ge(this.db,`users/${this.userUID}/profile/daily/${e}/cravingLoggingStats`));if(!t.exists())return await ct(ge(this.db,`users/${this.userUID}/profile/daily/${e}/cravingLoggingStats`),{motivation:0,triggerDefense:0}),{canAwardMotivation:!0,canAwardTriggerDefense:!0};const r=t.val(),s=r.motivation||0,i=r.triggerDefense||0;return{canAwardMotivation:s<.5,canAwardTriggerDefense:i<.5}}catch(t){return console.error("Error checking daily craving logging limits:",t),{canAwardMotivation:!0,canAwardTriggerDefense:!0}}}async logDailyCravingLogging(e,t){try{const r=await Fe(ge(this.db,`users/${this.userUID}/profile/daily/${e}/cravingLoggingStats`));r.exists()||await ct(ge(this.db,`users/${this.userUID}/profile/daily/${e}/cravingLoggingStats`),{motivation:0,triggerDefense:0});const s=r.val(),i=s.motivation||0,o=s.triggerDefense||0,a=t.canAwardMotivation?.25:0,l=t.canAwardTriggerDefense?.25:0;await ct(ge(this.db,`users/${this.userUID}/profile/daily/${e}/cravingLoggingStats`),{motivation:Math.min(.5,i+a),triggerDefense:Math.min(.5,o+l)})}catch(r){console.error("Error logging daily craving logging:",r)}}async getDailyCravingLoggingStats(e=null){try{const t=e||new Date().toDateString(),r=await Fe(ge(this.db,`users/${this.userUID}/profile/daily/${t}/cravingLoggingStats`));if(!r.exists())return{motivation:0,triggerDefense:0,motivationLimit:.5,triggerDefenseLimit:.5,motivationRemaining:.5,triggerDefenseRemaining:.5};const s=r.val(),i=s.motivation||0,o=s.triggerDefense||0;return{motivation:i,triggerDefense:o,motivationLimit:.5,triggerDefenseLimit:.5,motivationRemaining:Math.max(0,.5-i),triggerDefenseRemaining:Math.max(0,.5-o)}}catch(t){return console.error("Error getting daily craving logging stats:",t),{motivation:0,triggerDefense:0,motivationLimit:.5,triggerDefenseLimit:.5,motivationRemaining:.5,triggerDefenseRemaining:.5}}}}const H9=Object.freeze(Object.defineProperty({__proto__:null,default:Lm},Symbol.toStringTag,{value:"Module"}));class Kl{constructor(e){if(!e)throw new Error("Firestore instance is required for FirestoreBuddyService");this.firestore=e,this.matchingPoolCollection=Hr(e,"matchingPool"),this.buddyPairsCollection=Hr(e,"buddyPairs"),console.log("🚀 FirestoreBuddyService initialized with Firestore instance:",!!e),console.log("📁 Collections configured:",{matchingPool:this.matchingPoolCollection.path,buddyPairs:this.buddyPairsCollection.path})}async addToMatchingPool(e,t){try{console.log("🔄 Firestore: Adding user to matching pool:",e);const r={userId:e,...t,createdAt:cs(),lastActive:cs(),status:"waiting"};return await hU(Qf(this.matchingPoolCollection,e),r),console.log("✅ Firestore: User successfully added to matching pool:",e),!0}catch(r){return console.error("❌ Firestore: Failed to add user to matching pool:",r),console.error("❌ Error details:",{code:r.code,message:r.message,userId:e,userData:Object.keys(t||{})}),!1}}async removeFromMatchingPool(e){try{return console.log("🔄 Firestore: Removing user from matching pool:",e),await fU(Qf(this.matchingPoolCollection,e)),console.log("✅ Firestore: User successfully removed from matching pool:",e),!0}catch(t){return console.error("❌ Firestore: Failed to remove user from matching pool:",t),console.error("❌ Error details:",{code:t.code,message:t.message,userId:e}),!1}}async createBuddyPair(e,t,r={}){try{console.log("🔄 Firestore: Creating buddy pair:",{user1Id:e,user2Id:t});const s={user1Id:e,user2Id:t,createdAt:cs(),status:"active",...r},i=await ti(this.buddyPairsCollection,s);return console.log("✅ Firestore: Buddy pair created successfully:",i.id),i.id}catch(s){return console.error("❌ Firestore: Failed to create buddy pair:",s),console.error("❌ Error details:",{code:s.code,message:s.message,user1Id:e,user2Id:t}),null}}async getAllMatchingPoolUsers(){try{console.log("🔄 Firestore: Fetching all matching pool users");const e=await ed(this.matchingPoolCollection),t=[];return e.forEach(r=>{t.push({id:r.id,...r.data()})}),console.log("✅ Firestore: Retrieved",t.length,"users from matching pool"),t}catch(e){return console.error("❌ Firestore: Failed to fetch matching pool users:",e),console.error("❌ Error details:",{code:e.code,message:e.message}),[]}}async getMatchingPoolUser(e){try{console.log("🔄 Firestore: Fetching user from matching pool:",e);const t=Qf(this.matchingPoolCollection,e),r=await dU(t);if(r.exists()){const s={id:r.id,...r.data()};return console.log("✅ Firestore: User found in matching pool:",e),s}else return console.log("ℹ️ Firestore: User not found in matching pool:",e),null}catch(t){return console.error("❌ Firestore: Failed to fetch user from matching pool:",t),console.error("❌ Error details:",{code:t.code,message:t.message,userId:e}),null}}async getUserBuddyPair(e){try{console.log("🔄 Firestore: Getting buddy pair for user:",e);const t=Pl(this.buddyPairsCollection,Dl("user1Id","==",e)),r=Pl(this.buddyPairsCollection,Dl("user2Id","==",e)),[s,i]=await Promise.all([ed(t),ed(r)]);let o=null;if(s.empty?i.empty||(o=i.docs[0]):o=s.docs[0],o){const a=o.data();return console.log("✅ Firestore: Found buddy pair:",o.id),{id:o.id,...a}}else return console.log("ℹ️ Firestore: No buddy pair found for user"),null}catch(t){return console.error("❌ Firestore: Error getting buddy pair:",t),null}}async testConnectivity(){try{return console.log("🧪 Firestore: Testing connectivity..."),this.firestore&&typeof this.firestore.app<"u"?(console.log("✅ Firestore: Service available and initialized"),!0):(console.warn("⚠️ Firestore: Service not properly initialized"),!1)}catch(e){return console.warn("⚠️ Firestore: Connectivity check failed (non-critical):",(e==null?void 0:e.message)||e),!1}}getServiceStatus(){var e,t;return{firestore:!!this.firestore,matchingPoolCollection:((e=this.matchingPoolCollection)==null?void 0:e.path)||"not configured",buddyPairsCollection:((t=this.buddyPairsCollection)==null?void 0:t.path)||"not configured",timestamp:new Date().toISOString()}}}class K9{constructor(e){this.firestore=e,this.collections={cravings:"behavioral_cravings",relapses:"behavioral_relapses",hydration:"behavioral_hydration",breathing:"behavioral_breathing",meditation:"behavioral_meditation",physicalActivity:"behavioral_physical_activity",moodTracking:"behavioral_mood",stressLevels:"behavioral_stress",sleepTracking:"behavioral_sleep",socialTriggers:"behavioral_social_triggers",environmentalFactors:"behavioral_environmental"},console.log("🚀 FirestoreBehavioralService initialized for predictive analytics")}async logCraving(e,t){try{const r={userId:e,timestamp:cs(),date:new Date().toISOString().split("T")[0],outcome:t.outcome,strength:t.strength||0,duration:t.duration||null,context:t.context||"unknown",triggers:t.triggers||[],location:t.location||null,mood:t.mood||null,stressLevel:t.stressLevel||null,copingStrategiesUsed:t.copingStrategiesUsed||[],helpfulStrategies:t.helpfulStrategies||[],socialSituation:t.socialSituation||null,timeOfDay:new Date().getHours(),dayOfWeek:new Date().getDay(),appVersion:"1.0.0",deviceType:navigator.userAgent.includes("Mobile")?"mobile":"desktop"},s=await ti(Hr(this.firestore,this.collections.cravings),r);return console.log("✅ Craving logged to Firestore for analytics:",s.id),s.id}catch(r){throw console.error("❌ Error logging craving to Firestore:",r),r}}async logRelapse(e,t){try{const r={userId:e,timestamp:cs(),date:new Date().toISOString().split("T")[0],escalationLevel:t.escalationLevel||1,daysSinceLastRelapse:t.daysSinceLastRelapse||0,triggers:t.triggers||[],mood:t.mood||null,stressLevel:t.stressLevel||null,location:t.location||null,socialSituation:t.socialSituation||null,timeToRelapse:t.timeToRelapse||null,copingAttempts:t.copingAttempts||[],addictionIncrease:t.addictionIncrease||0,mentalStrengthDecrease:t.mentalStrengthDecrease||0,triggerDefenseDecrease:t.triggerDefenseDecrease||0,timeOfDay:new Date().getHours(),dayOfWeek:new Date().getDay()},s=await ti(Hr(this.firestore,this.collections.relapses),r);return console.log("✅ Relapse logged to Firestore for analytics:",s.id),s.id}catch(r){throw console.error("❌ Error logging relapse to Firestore:",r),r}}async logHydration(e,t){try{const r={userId:e,timestamp:cs(),date:new Date().toISOString().split("T")[0],glassesConsumed:t.glassesConsumed||0,targetGlasses:t.targetGlasses||6,achievedTarget:(t.glassesConsumed||0)>=(t.targetGlasses||6),timeOfDay:new Date().getHours(),loggedAt:new Date().toISOString(),currentStreak:t.currentStreak||0,mood:t.mood||null,energyLevel:t.energyLevel||null},s=await ti(Hr(this.firestore,this.collections.hydration),r);return console.log("✅ Hydration logged to Firestore for analytics:",s.id),s.id}catch(r){throw console.error("❌ Error logging hydration to Firestore:",r),r}}async logBreathingExercise(e,t){try{const r={userId:e,timestamp:cs(),date:new Date().toISOString().split("T")[0],duration:t.duration||0,breathingRate:t.breathingRate||null,completed:t.completed||!0,triggerContext:t.triggerContext||null,moodBefore:t.moodBefore||null,moodAfter:t.moodAfter||null,stressLevelBefore:t.stressLevelBefore||null,stressLevelAfter:t.stressLevelAfter||null,helpfulness:t.helpfulness||null,timeOfDay:new Date().getHours(),currentStreak:t.currentStreak||0},s=await ti(Hr(this.firestore,this.collections.breathing),r);return console.log("✅ Breathing exercise logged to Firestore for analytics:",s.id),s.id}catch(r){throw console.error("❌ Error logging breathing exercise to Firestore:",r),r}}async logMeditation(e,t){try{const r={userId:e,timestamp:cs(),date:new Date().toISOString().split("T")[0],duration:t.duration||0,type:t.type||"mindfulness",completed:t.completed||!0,triggerContext:t.triggerContext||null,moodBefore:t.moodBefore||null,moodAfter:t.moodAfter||null,stressLevelBefore:t.stressLevelBefore||null,stressLevelAfter:t.stressLevelAfter||null,helpfulness:t.helpfulness||null,timeOfDay:new Date().getHours()},s=await ti(Hr(this.firestore,this.collections.meditation),r);return console.log("✅ Meditation logged to Firestore for analytics:",s.id),s.id}catch(r){throw console.error("❌ Error logging meditation to Firestore:",r),r}}async logPhysicalActivity(e,t){try{const r={userId:e,timestamp:cs(),date:new Date().toISOString().split("T")[0],type:t.type||"walk",duration:t.duration||0,intensity:t.intensity||"moderate",completed:t.completed||!0,triggerContext:t.triggerContext||null,moodBefore:t.moodBefore||null,moodAfter:t.moodAfter||null,energyBefore:t.energyBefore||null,energyAfter:t.energyAfter||null,helpfulness:t.helpfulness||null,cravingReduction:t.cravingReduction||null,timeOfDay:new Date().getHours(),location:t.location||null},s=await ti(Hr(this.firestore,this.collections.physicalActivity),r);return console.log("✅ Physical activity logged to Firestore for analytics:",s.id),s.id}catch(r){throw console.error("❌ Error logging physical activity to Firestore:",r),r}}async logMood(e,t){try{const r={userId:e,timestamp:cs(),date:new Date().toISOString().split("T")[0],mood:t.mood,intensity:t.intensity||5,triggers:t.triggers||[],activities:t.activities||[],socialContext:t.socialContext||null,timeOfDay:new Date().getHours(),copingStrategiesUsed:t.copingStrategiesUsed||[]},s=await ti(Hr(this.firestore,this.collections.moodTracking),r);return console.log("✅ Mood logged to Firestore for analytics:",s.id),s.id}catch(r){throw console.error("❌ Error logging mood to Firestore:",r),r}}async getUserBehavioralData(e,t,r=null,s=null){try{if(!this.collections[t])throw new Error(`Unknown data type: ${t}`);let i=Pl(Hr(this.firestore,this.collections[t]),Dl("userId","==",e),lU("timestamp","desc"));r&&(i=Pl(i,Dl("timestamp",">=",gt.fromDate(new Date(r))))),s&&(i=Pl(i,Dl("timestamp","<=",gt.fromDate(new Date(s)))));const o=await ed(i),a=[];return o.forEach(l=>{var u;a.push({id:l.id,...l.data(),timestamp:((u=l.data().timestamp)==null?void 0:u.toDate())||new Date})}),console.log(`✅ Retrieved ${a.length} ${t} records for analytics`),a}catch(i){throw console.error(`❌ Error retrieving ${t} data:`,i),i}}async getUserAnalytics(e,t=30){try{const r=new Date,s=new Date;s.setDate(s.getDate()-t),console.log(`📊 Generating behavioral analytics for user ${e} (last ${t} days)`);const[i,o,a,l,u,h,f]=await Promise.all([this.getUserBehavioralData(e,"cravings",s,r).catch(y=>(console.warn("⚠️ Cravings data not available yet (indexes building):",y.message),[])),this.getUserBehavioralData(e,"relapses",s,r).catch(y=>(console.warn("⚠️ Relapses data not available yet (indexes building):",y.message),[])),this.getUserBehavioralData(e,"hydration",s,r).catch(y=>(console.warn("⚠️ Hydration data not available yet (indexes building):",y.message),[])),this.getUserBehavioralData(e,"breathing",s,r).catch(y=>(console.warn("⚠️ Breathing data not available yet (indexes building):",y.message),[])),this.getUserBehavioralData(e,"meditation",s,r).catch(y=>(console.warn("⚠️ Meditation data not available yet (indexes building):",y.message),[])),this.getUserBehavioralData(e,"physicalActivity",s,r).catch(y=>(console.warn("⚠️ Physical activity data not available yet (indexes building):",y.message),[])),this.getUserBehavioralData(e,"moodTracking",s,r).catch(y=>(console.warn("⚠️ Mood data not available yet (indexes building):",y.message),[]))]),g={userId:e,period:{startDate:s,endDate:r,days:t},cravingStats:{total:i.length,resisted:i.filter(y=>y.outcome==="resisted").length,relapsed:i.filter(y=>y.outcome==="relapsed").length,averageStrength:i.length>0?i.reduce((y,w)=>y+(w.strength||0),0)/i.length:0,commonTriggers:this.getCommonTriggers(i),timePatterns:this.getTimePatterns(i)},relapseStats:{total:o.length,averageEscalationLevel:o.length>0?o.reduce((y,w)=>y+(w.escalationLevel||1),0)/o.length:0,commonTriggers:this.getCommonTriggers(o),recoveryTimes:o.map(y=>y.daysSinceLastRelapse||0)},wellnessStats:{hydrationDays:a.filter(y=>y.achievedTarget).length,breathingExercises:l.length,meditationSessions:u.length,physicalActivities:h.length,totalWellnessActivities:l.length+u.length+h.length},moodStats:{entries:f.length,averageMood:f.length>0?f.reduce((y,w)=>y+(w.intensity||5),0)/f.length:5,moodTrends:this.getMoodTrends(f)},insights:this.generateInsights(i,o,a,l,u,h,f),generatedAt:new Date};return console.log("📊 Behavioral analytics generated:",g),g}catch(r){throw console.error("❌ Error generating user analytics:",r),r}}getCommonTriggers(e){const t={};return e.forEach(r=>{r.triggers&&Array.isArray(r.triggers)&&r.triggers.forEach(s=>{t[s]=(t[s]||0)+1})}),Object.entries(t).sort(([,r],[,s])=>s-r).slice(0,5).map(([r,s])=>({trigger:r,count:s}))}getTimePatterns(e){const t={};return e.forEach(r=>{const s=r.timeOfDay||new Date(r.timestamp).getHours();t[s]=(t[s]||0)+1}),Object.entries(t).sort(([,r],[,s])=>s-r).slice(0,3).map(([r,s])=>({hour:parseInt(r),count:s}))}getMoodTrends(e){if(e.length<2)return[];const t=e.sort((s,i)=>new Date(s.timestamp)-new Date(i.timestamp)),r=[];for(let s=1;s<t.length;s++){const i=t[s],o=t[s-1],a=(i.intensity||5)-(o.intensity||5);Math.abs(a)>=2&&r.push({date:i.date,change:a,direction:a>0?"improved":"declined",from:o.mood,to:i.mood})}return r.slice(-5)}generateInsights(e,t,r,s,i,o,a){const l=[],u=e.filter(y=>y.outcome==="resisted").length,h=e.length;if(h>0){const y=u/h*100;l.push(`Craving resistance rate: ${y.toFixed(1)}%`)}const f=s.length+i.length+o.length;f>0&&t.length>0&&l.push(`${f} wellness activities vs ${t.length} relapses - wellness correlation analysis available`);const g=r.filter(y=>y.achievedTarget).length;return g>0&&l.push(`Achieved hydration target on ${g} days`),l}async migrateUserData(e,t){try{console.log(`🔄 Starting data migration for user ${e} from Realtime DB to Firestore...`);const{ref:r,get:s}=await be(()=>import("./index.esm-eba9a326.js"),[]),i=r(t,`users/${e}/cravings`),o=await s(i);if(o.exists()){const a=o.val();let l=0;for(const[u,h]of Object.entries(a))try{const f={userId:e,timestamp:h.timestamp?gt.fromDate(new Date(h.timestamp)):cs(),date:h.date||new Date().toISOString().split("T")[0],outcome:h.outcome||"unknown",strength:h.strength||0,context:h.context||"migrated",mood:h.mood||null,triggers:[],timeOfDay:h.timestamp?new Date(h.timestamp).getHours():12,dayOfWeek:h.timestamp?new Date(h.timestamp).getDay():0,migrated:!0,originalId:u};await ti(Hr(this.firestore,this.collections.cravings),f),l++}catch(f){console.error(`❌ Error migrating craving ${u}:`,f)}console.log(`✅ Migrated ${l} cravings to Firestore`)}return console.log(`✅ Data migration completed for user ${e}`),!0}catch(r){throw console.error("❌ Error during data migration:",r),r}}async testConnectivity(){try{return console.log("🧪 FirestoreBehavioralService: Testing connectivity..."),this.firestore&&typeof this.firestore.app<"u"?(console.log("✅ FirestoreBehavioralService: Ready for behavioral data logging"),!0):(console.warn("⚠️ FirestoreBehavioralService: Not properly initialized"),!1)}catch(e){return console.warn("⚠️ FirestoreBehavioralService: Connectivity test failed:",(e==null?void 0:e.message)||e),!1}}async getBasicAnalytics(e){try{console.log(`📊 Getting basic analytics for user ${e} (no indexes required)`);const t=["behavioral_cravings","behavioral_relapses","behavioral_hydration","behavioral_breathing","behavioral_meditation","behavioral_physical_activity"],r={};for(const s of t)try{const i=Pl(Hr(this.db,s),Dl("userId","==",e)),o=await ed(i);r[s]=o.size}catch(i){console.warn(`⚠️ Could not get count for ${s}:`,i.message),r[s]=0}return{userId:e,cravingStats:{total:r.behavioral_cravings||0,resisted:Math.max(0,r.behavioral_cravings-r.behavioral_relapses),averageStrength:5,commonTriggers:[],timePatterns:[]},relapseStats:{total:r.behavioral_relapses||0},wellnessStats:{breathingExercises:r.behavioral_breathing||0,meditationSessions:r.behavioral_meditation||0,physicalActivities:r.behavioral_physical_activity||0,hydrationDays:r.behavioral_hydration||0,totalWellnessActivities:(r.behavioral_breathing||0)+(r.behavioral_meditation||0)+(r.behavioral_physical_activity||0)},insights:["Analytics dashboard is ready for behavioral tracking!","Indexes are being built for advanced analytics.","Start logging activities to see detailed insights."]}}catch(t){throw console.error("❌ Error generating basic analytics:",t),t}}}class Cb{constructor(e,t){this.db=e,this.userId=t,this.statsRef=ge(e,`users/${t}/stats`),this.profileRef=ge(e,`users/${t}/profile`),this.listeners=[]}async refreshAllStats(){try{console.log(`📊 CentralizedStats: Refreshing all stats for user ${this.userId}`);const[e,t]=await Promise.all([Fe(this.profileRef),Fe(this.statsRef)]),r=e.exists()?e.val():{},s=t.exists()?t.val():this.getDefaultStats(),i=this.calculateEffectiveQuitDate(r),o=this.calculateStreakFromRelapse(r),a=await this.calculateCravingsResisted(),l=await this.calculateAddictionLevel(r,i),u=await this.checkMilestonesFromRelapse(r,s),h=await this.generateSpecialFeatures(r),f={...s,...u,streakDays:o.value,streakUnit:o.unit,streakDisplayText:o.displayText,cravingsResisted:a,addictionLevel:l,specialFeatures:h,lastUpdated:new Date().toISOString()};return await ct(this.statsRef,f),console.log(`✅ CentralizedStats: Stats updated in Firebase for ${this.userId}:`,{streak:o.displayText,cravingsResisted:a,addictionLevel:l,specialFeatures:(h==null?void 0:h.length)||0,effectiveQuitDate:i}),f}catch(e){throw console.error(`❌ CentralizedStats: Error refreshing stats for ${this.userId}:`,e),e}}calculateEffectiveQuitDate(e){const t=e.quitDate||new Date().toISOString();if(e.lastRelapseDate){const r=new Date(e.lastRelapseDate),s=new Date(t),i=r>s?e.lastRelapseDate:t;return console.log(`📊 CentralizedStats: Effective quit date for ${this.userId}: ${i} (original: ${t}, lastRelapse: ${e.lastRelapseDate})`),i}return console.log(`📊 CentralizedStats: Using base quit date for ${this.userId}: ${t}`),t}calculateStreak(e){const t=new Date,r=new Date(e),s=t-r,i=Math.floor(s/(1e3*60*60)),o=Math.floor(i/24);return o>=1?{value:o,unit:"days",displayText:`${o} day${o===1?"":"s"}`}:{value:i,unit:"hours",displayText:`${i} hour${i===1?"":"s"}`}}calculateStreakFromRelapse(e){const t=new Date,r=e.lastRelapseDate;if(!r){const l=e.quitDate||new Date().toISOString();return console.log(`📊 CentralizedStats: No relapse date found for ${this.userId}, using quit date: ${l}`),this.calculateStreak(l)}const s=new Date(r),i=t-s,o=Math.floor(i/(1e3*60*60)),a=Math.floor(o/24);return console.log(`📊 CentralizedStats: Streak calculation for ${this.userId}:`),console.log(`  - Last relapse: ${r}`),console.log(`  - Current time: ${t.toISOString()}`),console.log(`  - Hours since relapse: ${o}`),console.log(`  - Days since relapse: ${a}`),o<24?{value:o,unit:"hours",displayText:`${o} hour${o===1?"":"s"}`,streakDays:0}:{value:a,unit:"days",displayText:`${a} day${a===1?"":"s"}`,streakDays:a}}async calculateCravingsResisted(){try{const[e,t]=await Promise.all([Fe(ge(this.db,`users/${this.userId}/profile/cravingsResisted`)),Fe(ge(this.db,`users/${this.userId}/cravings`))]);let r=0;if(e.exists())r=Math.max(0,parseInt(e.val())||0),console.log(`📊 CentralizedStats: Found cravings in profile: ${r}`);else if(t.exists()){const s=t.val();r=Object.values(s).filter(i=>i.outcome==="resisted").length,console.log(`📊 CentralizedStats: Counted cravings from collection: ${r}`)}return r}catch(e){return console.warn(`⚠️ CentralizedStats: Could not get cravings for ${this.userId}:`,e.message),0}}async calculateAddictionLevel(e,t){try{const[r,s,i]=await Promise.all([Fe(this.statsRef),Fe(ge(this.db,`users/${this.userId}/profile/lastRelapseDate`)),Fe(ge(this.db,`users/${this.userId}/profile/relapseEscalationLevel`))]);let o=50;if(r.exists()&&(o=r.val().addictionLevel||50),!s.exists())return console.log(`📊 CentralizedStats: No relapses found, returning base addiction: ${o}`),o;const a=new Date(s.val()),u=Math.floor((new Date-a)/(1e3*60*60*24)),h=i.exists()?i.val():1;console.log(`📊 CentralizedStats: Last relapse: ${a.toISOString()}`),console.log(`📊 CentralizedStats: Days since last relapse: ${u}`),console.log(`📊 CentralizedStats: Current escalation level: ${h}`);let f=1;u>=7?(f=1,await ct(ge(this.db,`users/${this.userId}/profile/relapseEscalationLevel`),1)):f=h;const g=Math.floor(u/7),y=g*2;let w=Math.max(30,o-y);return console.log(`📊 CentralizedStats: Base addiction: ${o}, Weeks clean: ${g}, Decay: -${y}, Final: ${w}`),w}catch(r){return console.error("❌ CentralizedStats: Error calculating addiction level:",r),50}}async checkMilestones(e,t){try{const r=new Date,s=new Date(e),i=Math.floor((r-s)/(1e3*60*60*24));console.log(`📊 CentralizedStats: Checking milestones for ${this.userId}, clean days: ${i}`);const o=[{days:7,bonus:5,name:"First week",key:"milestone_7"},{days:30,bonus:10,name:"First month",key:"milestone_30"},{days:90,bonus:15,name:"Three months",key:"milestone_90"}];let a={},l=!1;for(const u of o)if(i>=u.days){const h=ge(this.db,`users/${this.userId}/profile/milestones/${u.key}`);if(!(await Fe(h)).exists()){const g=Math.min(100,(t.mentalStrength||50)+u.bonus);a.mentalStrength=g,l=!0,await ct(h,{achieved:!0,achievedDate:new Date().toISOString(),bonus:u.bonus,cleanDaysAtAchievement:i}),console.log(`🎉 CentralizedStats: Milestone achieved for ${this.userId}! ${u.name} (+${u.bonus} Mental Strength)`),this.showMilestoneNotification(u,i);break}}return a}catch(r){return console.error(`❌ CentralizedStats: Error checking milestones for ${this.userId}:`,r),{}}}async checkMilestonesFromRelapse(e,t){try{const r=new Date,s=e.lastRelapseDate;if(!s)return console.log(`📊 CentralizedStats: No relapse date found for ${this.userId}, skipping milestones`),{};const i=new Date(s),o=Math.floor((r-i)/(1e3*60*60*24));console.log(`📊 CentralizedStats: Checking milestones for ${this.userId}, clean days since relapse: ${o}`);const a=[{days:7,bonus:5,name:"First week",key:"milestone_7"},{days:30,bonus:10,name:"First month",key:"milestone_30"},{days:90,bonus:15,name:"Three months",key:"milestone_90"}];let l={},u=!1;for(const h of a)if(o>=h.days){const f=ge(this.db,`users/${this.userId}/profile/milestones/${h.key}`);if(!(await Fe(f)).exists()){const y=Math.min(100,(t.mentalStrength||50)+h.bonus);l.mentalStrength=y,u=!0,await ct(f,{achieved:!0,achievedDate:new Date().toISOString(),bonus:h.bonus,cleanDaysAtAchievement:o}),console.log(`🎉 CentralizedStats: Milestone achieved for ${this.userId}! ${h.name} (+${h.bonus} Mental Strength)`),this.showMilestoneNotification(h,o);break}}return l}catch(r){return console.error(`❌ CentralizedStats: Error checking milestones from relapse for ${this.userId}:`,r),{}}}async generateSpecialFeatures(e){try{const t=await Fe(ge(this.db,`users/${this.userId}/specialFeatures`));if(t.exists()){const h=t.val();if(Array.isArray(h)&&h.length>0)return console.log(`📊 CentralizedStats: Using existing Special Features for ${this.userId}:`,h),h}let r=e.triggers||[],s=e.dailyPatterns||[],i=e.copingStrategies||[];if(r.length===0||s.length===0||i.length===0)try{const h=await Fe(ge(this.db,`users/${this.userId}`));if(h.exists()){const f=h.val();r=r.length>0?r:f.triggers||[],s=s.length>0?s:f.dailyPatterns||[],i=i.length>0?i:f.copingStrategies||[],console.log(`📊 CentralizedStats: Found onboarding data for ${this.userId}:`,{triggers:r.length,dailyPatterns:s.length,copingStrategies:i.length})}}catch(h){console.warn(`⚠️ CentralizedStats: Could not read user onboarding data for ${this.userId}:`,h.message)}const o=[],a={triggers:["Stress Vaper","Social Smoker","Coffee Companion","Work Breaker","Gaming Buddy","Party Animal","Peer Pressure","Celebration Trigger","Anxiety Soother","Focus Enhancer","Boredom Fighter","Emotional Support"],dailyPatterns:["Night Owl","Morning Struggler","Weekend Warrior","Routine Builder","Habit Former","Work Breaker","Coffee Companion","Party Animal"],copingStrategies:["First Timer","Veteran Quitter","Cold Turkey","Gradual Reduction","Stress Reliever","Mood Stabilizer","Reward Seeker","Social Lubricant"]};console.log(`📊 CentralizedStats: Generating features from onboarding data for ${this.userId}:`,{triggers:r,dailyPatterns:s,copingStrategies:i}),r.includes("Stress/anxiety")&&o.push("Stress Vaper"),r.includes("Social situations")&&o.push("Social Smoker"),r.includes("Boredom")&&o.push("Boredom Fighter"),r.includes("After meals")&&o.push("Coffee Companion"),r.includes("Work breaks")&&o.push("Work Breaker"),s.includes("Evening wind-down")&&o.push("Night Owl"),s.includes("Morning routine")&&o.push("Morning Struggler"),s.includes("Social events")&&o.push("Party Animal"),s.includes("Work breaks")&&o.push("Work Breaker"),i.includes("Breathing exercises")&&o.push("Stress Reliever"),i.includes("Exercise/physical activity")&&o.push("Health Seeker"),i.includes("Nicotine replacement therapy")&&o.push("Veteran Quitter"),i.includes("Nothing - this is new to me")&&o.push("First Timer"),console.log(`📊 CentralizedStats: Generated ${o.length} personalized features:`,o);const l=["Freedom Chaser","Nicotine Fighter","Health Seeker","Willpower Warrior"];for(;o.length<4;){const h=l[Math.floor(Math.random()*l.length)];o.includes(h)||o.push(h)}const u=o.slice(0,4);return await ct(ge(this.db,`users/${this.userId}/specialFeatures`),u),console.log(`📊 CentralizedStats: Generated and stored Special Features for ${this.userId}:`,u),u}catch(t){return console.error(`❌ CentralizedStats: Error generating Special Features for ${this.userId}:`,t),["Freedom Chaser","Nicotine Fighter","Health Seeker","Willpower Warrior"]}}setupRealTimeListener(e){const t=CR(this.statsRef,r=>{if(r.exists()){const s=r.val();console.log(`🔄 CentralizedStats: Real-time update for ${this.userId}:`,s),e(s)}});return this.listeners.push(t),t}getDefaultStats(){return{mentalStrength:50,motivation:50,triggerDefense:30,addictionLevel:50,streakDays:0,streakUnit:"hours",streakDisplayText:"0 hours",cravingsResisted:0,experiencePoints:0}}showMilestoneNotification(e,t){try{if(typeof window<"u"&&window.showQuickActionPopup){const s={7:{title:"🎉 First Week Milestone!",message:`Congratulations! You've been clean for 7 days!

🧠 Mental Strength: +${e.bonus} points

You're building incredible willpower! Keep going! 💪`},30:{title:"🏆 One Month Champion!",message:`Amazing! You've reached 30 days clean!

🧠 Mental Strength: +${e.bonus} points

You're proving your strength every day! 🌟`},90:{title:"👑 Three Month Legend!",message:`Incredible! You've achieved 90 days clean!

🧠 Mental Strength: +${e.bonus} points

You're a true inspiration! 🎯✨`}}[e.days]||{title:"🎉 Milestone Achieved!",message:`You've reached ${t} days clean!

🧠 Mental Strength: +${e.bonus} points`};window.showQuickActionPopup(s.title,s.message,"success")}else console.log(`🎉 Milestone achieved: ${e.name} (+${e.bonus} Mental Strength)`)}catch(r){console.error("Error showing milestone notification:",r)}}async resetMilestones(){try{console.log(`🔄 CentralizedStats: Resetting milestones for ${this.userId} after relapse`);const e=ge(this.db,`users/${this.userId}/profile/milestones`);await ct(e,null),console.log(`✅ CentralizedStats: Milestones reset for ${this.userId} - can be earned again`)}catch(e){console.error(`❌ CentralizedStats: Error resetting milestones for ${this.userId}:`,e)}}cleanup(){this.listeners.forEach(e=>e()),this.listeners=[]}async handleRelapse(){try{console.log(`🔄 CentralizedStats: Handling relapse for ${this.userId}`);const e=new Date,t=e.toISOString(),[r,s,i]=await Promise.all([Fe(ge(this.db,`users/${this.userId}/profile/lastRelapseDate`)),Fe(ge(this.db,`users/${this.userId}/profile/relapseEscalationLevel`)),Fe(this.statsRef)]);let o=1;if(r.exists()){const g=new Date(r.val()),y=Math.floor((e-g)/(1e3*60*60*24)),w=s.exists()?s.val():1;console.log(`🔄 CentralizedStats: Current escalation level: ${w}`),console.log(`🔄 CentralizedStats: Days since last relapse: ${y}`),y>=7?(o=1,console.log(`🔄 CentralizedStats: After 7+ days clean → escalation level reset to: ${o}`)):(o=w+1,console.log(`🔄 CentralizedStats: Within ${y} days → escalation level: ${w} + 1 = ${o}`))}let a=0;switch(o){case 1:a=4;break;case 2:a=6;break;default:a=8;break}console.log(`🔄 CentralizedStats: Escalation level ${o} → addiction increase: +${a}`);const l=i.exists()?i.val():this.getDefaultStats(),u=Math.max(0,Math.min(100,(l.addictionLevel||50)+a)),h=Math.max(0,Math.min(100,(l.mentalStrength||50)-3)),f=Math.max(0,Math.min(100,(l.triggerDefense||30)-3));console.log(`🔄 CentralizedStats: addictionLevel change: ${l.addictionLevel} → ${u} (+${a})`),console.log(`🔄 CentralizedStats: mentalStrength change: ${l.mentalStrength} → ${h} (-3)`),console.log(`🔄 CentralizedStats: triggerDefense change: ${l.triggerDefense} → ${f} (-3)`),await Promise.all([ct(ge(this.db,`users/${this.userId}/profile/lastRelapseDate`),t),ct(ge(this.db,`users/${this.userId}/profile/relapseDate`),t),ct(ge(this.db,`users/${this.userId}/profile/relapseEscalationLevel`),o),this.resetMilestones(),ct(this.statsRef,{...l,addictionLevel:u,mentalStrength:h,triggerDefense:f,lastUpdated:t})]),console.log(`✅ CentralizedStats: Relapse handled with escalation level ${o}, addiction +${a} for ${this.userId}`)}catch(e){throw console.error(`❌ CentralizedStats: Error handling relapse for ${this.userId}:`,e),e}}async handleCravingResisted(){try{console.log(`🔄 CentralizedStats: Handling craving resisted for ${this.userId}`),await this.refreshAllStats(),console.log(`✅ CentralizedStats: Craving resistance updated for ${this.userId}`)}catch(e){throw console.error(`❌ CentralizedStats: Error handling craving resistance for ${this.userId}:`,e),e}}}const Q9=({onAuthSuccess:n,isNewUser:e})=>{const[t,r]=j.useState("signin"),[s,i]=j.useState(""),[o,a]=j.useState(""),[l,u]=j.useState(""),[h,f]=j.useState(!1),[g,y]=j.useState(!1),[w,C]=j.useState(""),[M,A]=j.useState(""),[I,R]=j.useState(!1);j.useEffect(()=>()=>{g&&y(!1)},[g]);const D=new ii;D.addScope("email"),D.addScope("profile"),D.setCustomParameters({prompt:"select_account",access_type:"offline",include_granted_scopes:"true"});const V=()=>{i(""),a(""),u(""),C(""),A("")},P=async()=>{f(!0),y(!0),C("");try{console.log("Starting Google sign-in process..."),console.log("Opening Google authentication popup..."),console.log("Google provider configuration:",{scopes:D.scopes,customParameters:D.customParameters});const E=kB(so,D),N=new Promise((K,mt)=>{setTimeout(()=>mt(new Error("Popup timeout - please try again")),6e4)}),T=await Promise.race([E,N]);if(T&&T.user){const K=T.user;console.log("Google sign-in successful for:",K.email,"UID:",K.uid),console.log("User display name:",K.displayName),console.log("User photo URL:",K.photoURL),await new Promise(mt=>setTimeout(mt,800)),n(K)}else throw new Error("No user data received from Google authentication")}catch(E){console.error("Google sign-in error:",E),E.code==="auth/popup-closed-by-user"?C("Google sign-in was cancelled. Please try again and complete the account selection in the popup window."):E.code==="auth/popup-blocked"?C("Google sign-in popup was blocked by your browser. Please allow popups for this site and try again."):E.code==="auth/cancelled-popup-request"?C("Google sign-in was cancelled. Please try again and complete the authentication process."):E.code==="auth/account-exists-with-different-credential"?C("An account already exists with this email using a different sign-in method. Please use email/password instead."):E.message==="Popup timeout - please try again"?C("Google sign-in popup timed out. Please try again and complete the account selection quickly."):E.code==="auth/network-request-failed"?C("Network error during Google sign-in. Please check your internet connection and try again."):E.code==="auth/operation-not-allowed"?C("Google sign-in is not enabled for this app. Please contact support."):C(_(E.code))}finally{f(!1),y(!1)}},S=async E=>{E.preventDefault(),f(!0),C("");try{const T=(await B$(so,s,o)).user;console.log("Email sign-in successful for:",T.email),n(T)}catch(N){console.error("Email sign-in error:",N),C(_(N.code))}finally{f(!1)}},v=async E=>{if(E.preventDefault(),f(!0),C(""),o!==l){C("Passwords do not match"),f(!1);return}if(o.length<6){C("Password must be at least 6 characters long"),f(!1);return}try{const T=(await $$(so,s,o)).user;console.log("Email sign-up successful for:",T.email),await q$(T),n(T)}catch(N){console.error("Email sign-up error:",N),C(_(N.code))}finally{f(!1)}},b=async E=>{if(E.preventDefault(),!s){C("Please enter your email address");return}f(!0),C("");try{await j$(so,s),A("Password reset email sent! Check your inbox.")}catch(N){console.error("Password reset error:",N),C(_(N.code))}finally{f(!1)}},_=E=>{switch(E){case"auth/user-not-found":return"No account found with this email address";case"auth/wrong-password":return"Incorrect password";case"auth/email-already-in-use":return"An account with this email already exists";case"auth/weak-password":return"Password is too weak. Use at least 6 characters";case"auth/invalid-email":return"Invalid email address";case"auth/popup-closed-by-user":return"Google sign-in was cancelled. Please try again and complete the account selection.";case"auth/popup-blocked":return"Google sign-in popup was blocked. Please allow popups for this site and try again.";case"auth/cancelled-popup-request":return"Google sign-in was cancelled. Please try again.";case"auth/account-exists-with-different-credential":return"An account already exists with this email using a different sign-in method.";case"auth/network-request-failed":return"Network error. Please check your connection";case"auth/operation-not-allowed":return"Google sign-in is not enabled. Please contact support.";case"auth/too-many-requests":return"Too many sign-in attempts. Please try again later.";default:return"Authentication failed. Please try again"}};return I?d.jsx("div",{className:"min-h-screen bg-gray-900 flex items-center justify-center px-4",children:d.jsxs("div",{className:"max-w-md w-full space-y-8",children:[d.jsxs("div",{className:"text-center",children:[d.jsx("h2",{className:"text-3xl font-bold text-white",children:"Reset Password"}),d.jsx("p",{className:"mt-2 text-gray-400",children:"Enter your email to receive a reset link"})]}),d.jsxs("form",{onSubmit:b,className:"space-y-6",children:[d.jsxs("div",{children:[d.jsx("label",{htmlFor:"email",className:"block text-sm font-medium text-gray-300",children:"Email Address"}),d.jsx("input",{id:"email",type:"email",value:s,onChange:E=>i(E.target.value),required:!0,autoComplete:"email",className:"mt-1 block w-full px-3 py-2 bg-gray-800 border border-gray-600 rounded-md text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"Enter your email"})]}),w&&d.jsx("div",{className:"text-red-400 text-sm",children:w}),M&&d.jsx("div",{className:"text-green-400 text-sm",children:M}),d.jsxs("div",{className:"flex space-x-3",children:[d.jsx("button",{type:"button",onClick:()=>{R(!1),C(""),A("")},className:"flex-1 px-4 py-2 border border-gray-600 rounded-md text-gray-300 hover:bg-gray-700 focus:outline-none focus:ring-2 focus:ring-gray-500",children:"Back to Login"}),d.jsx("button",{type:"submit",disabled:h,className:"flex-1 px-4 py-2 bg-blue-600 border border-transparent rounded-md text-white hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 disabled:opacity-50",children:h?"Sending...":"Send Reset Link"})]})]})]})}):d.jsx("div",{className:"min-h-screen bg-gray-900 flex items-center justify-center px-4",children:d.jsxs("div",{className:"max-w-md w-full space-y-8",children:[d.jsxs("div",{className:"text-center",children:[d.jsx("h1",{className:"text-4xl font-bold text-white mb-2",children:"QuitCard Arena"}),d.jsx("p",{className:"text-gray-400",children:"Your journey to quit starts here"})]}),d.jsxs("div",{children:[g&&d.jsx("div",{className:"mb-3 p-3 bg-blue-900/20 border border-blue-500/30 rounded-lg",children:d.jsxs("div",{className:"flex items-center justify-center text-blue-300 text-sm",children:[d.jsx("div",{className:"animate-pulse mr-2",children:"🔐"}),"Google popup is open - please complete your account selection"]})}),d.jsx("button",{onClick:P,disabled:h,className:"w-full flex items-center justify-center px-4 py-3 border border-gray-600 rounded-md text-white bg-gray-800 hover:bg-gray-700 focus:outline-none focus:ring-2 focus:ring-blue-500 disabled:opacity-50",children:h?d.jsxs(d.Fragment,{children:[d.jsx("div",{className:"animate-spin rounded-full h-5 w-5 border-b-2 border-white mr-3"}),"Opening Google Sign-in..."]}):d.jsxs(d.Fragment,{children:[d.jsxs("svg",{className:"w-5 h-5 mr-3",viewBox:"0 0 24 24",children:[d.jsx("path",{fill:"currentColor",d:"M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z"}),d.jsx("path",{fill:"currentColor",d:"M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z"}),d.jsx("path",{fill:"currentColor",d:"M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z"}),d.jsx("path",{fill:"currentColor",d:"M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z"})]}),"Continue with Google"]})}),d.jsx("p",{className:"text-xs text-gray-500 mt-2 text-center",children:g?d.jsx("span",{className:"text-blue-400 font-medium",children:"🔐 Google popup is open - please complete account selection"}):"Click to open Google account selection popup"}),!1,w&&d.jsxs("div",{className:"mt-3 p-3 bg-red-900/20 border border-red-500/30 rounded-lg",children:[d.jsx("div",{className:"text-red-300 text-sm mb-2",children:w}),w.includes("Google sign-in")&&!g&&d.jsx("button",{onClick:P,disabled:h,className:"w-full px-3 py-2 bg-red-600 hover:bg-red-700 text-white text-sm rounded-md transition-colors disabled:opacity-50",children:h?"Retrying...":"Try Google Sign-in Again"})]})]}),d.jsxs("div",{className:"relative",children:[d.jsx("div",{className:"absolute inset-0 flex items-center",children:d.jsx("div",{className:"w-full border-t border-gray-600"})}),d.jsx("div",{className:"relative flex justify-center text-sm",children:d.jsx("span",{className:"px-2 bg-gray-900 text-gray-400",children:"Or continue with email"})})]}),d.jsxs("div",{className:"flex space-x-1 bg-gray-800 p-1 rounded-lg",children:[d.jsx("button",{onClick:()=>{r("signin"),V()},className:`flex-1 py-2 px-4 rounded-md text-sm font-medium transition-colors ${t==="signin"?"bg-blue-600 text-white":"text-gray-400 hover:text-white"}`,children:"Sign In"}),d.jsx("button",{onClick:()=>{r("signup"),V()},className:`flex-1 py-2 px-4 rounded-md text-sm font-medium transition-colors ${t==="signup"?"bg-blue-600 text-white":"text-gray-400 hover:text-white"}`,children:"Sign Up"})]}),t==="signin"&&d.jsxs("form",{onSubmit:S,className:"space-y-6",children:[d.jsxs("div",{children:[d.jsx("label",{htmlFor:"signin-email",className:"block text-sm font-medium text-gray-300",children:"Email Address"}),d.jsx("input",{id:"signin-email",type:"email",value:s,onChange:E=>i(E.target.value),required:!0,className:"mt-1 block w-full px-3 py-2 bg-gray-800 border border-gray-600 rounded-md text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"Enter your email"})]}),d.jsxs("div",{children:[d.jsx("label",{htmlFor:"signin-password",className:"block text-sm font-medium text-gray-300",children:"Password"}),d.jsx("input",{id:"signin-password",type:"password",value:o,onChange:E=>a(E.target.value),required:!0,autoComplete:"current-password",className:"mt-1 block w-full px-3 py-2 bg-gray-800 border border-gray-600 rounded-md text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"Enter your password"})]}),d.jsx("div",{className:"flex items-center justify-between",children:d.jsx("button",{type:"button",onClick:()=>R(!0),className:"text-sm text-blue-400 hover:text-blue-300",children:"Forgot your password?"})}),w&&d.jsx("div",{className:"text-red-400 text-sm",children:w}),d.jsx("button",{type:"submit",disabled:h,className:"w-full flex justify-center py-2 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 disabled:opacity-50",children:h?"Signing in...":"Sign In"})]}),t==="signup"&&d.jsxs("form",{onSubmit:v,className:"space-y-6",children:[d.jsxs("div",{children:[d.jsx("label",{htmlFor:"signup-email",className:"block text-sm font-medium text-gray-300",children:"Email Address"}),d.jsx("input",{id:"signup-email",type:"email",value:s,onChange:E=>i(E.target.value),required:!0,autoComplete:"email",className:"mt-1 block w-full px-3 py-2 bg-gray-800 border border-gray-600 rounded-md text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"Enter your email"})]}),d.jsxs("div",{children:[d.jsx("label",{htmlFor:"signup-password",className:"block text-sm font-medium text-gray-300",children:"Password"}),d.jsx("input",{id:"signup-password",type:"password",value:o,onChange:E=>a(E.target.value),required:!0,autoComplete:"new-password",className:"mt-1 block w-full px-3 py-2 bg-gray-800 border border-gray-600 rounded-md text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"Create a password (min 6 characters)"})]}),d.jsxs("div",{children:[d.jsx("label",{htmlFor:"confirm-password",className:"block text-sm font-medium text-gray-300",children:"Confirm Password"}),d.jsx("input",{id:"confirm-password",type:"password",value:l,onChange:E=>u(E.target.value),required:!0,autoComplete:"new-password",className:"mt-1 block w-full px-3 py-2 bg-gray-800 border border-gray-600 rounded-md text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"Confirm your password"})]}),w&&d.jsx("div",{className:"text-red-400 text-sm",children:w}),M&&d.jsx("div",{className:"text-green-400 text-sm",children:M}),d.jsx("button",{type:"submit",disabled:h,className:"w-full flex justify-center py-2 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 disabled:opacity-50",children:h?"Creating account...":"Create Account"})]})]})})},Y9=()=>{const[n,e]=j.useState(navigator.onLine),[t,r]=j.useState(!1);return j.useEffect(()=>{const s=()=>{e(!0),r(!1),console.log("🌐 Connection restored")},i=()=>{e(!1),r(!0),console.log("📡 Connection lost")};return window.addEventListener("online",s),window.addEventListener("offline",i),e(navigator.onLine),()=>{window.removeEventListener("online",s),window.removeEventListener("offline",i)}},[]),n?null:d.jsxs("div",{className:"fixed top-0 left-0 right-0 z-50 bg-yellow-600 text-white p-3 text-center shadow-lg",children:[d.jsxs("div",{className:"flex items-center justify-center space-x-2",children:[d.jsx("svg",{className:"w-5 h-5 animate-pulse",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:d.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L3.732 16.5c-.77.833.192 2.5 1.732 2.5z"})}),d.jsx("span",{className:"font-medium",children:"You're offline. Some features may be limited."}),d.jsx("button",{onClick:()=>r(!1),className:"ml-2 text-white hover:text-yellow-200 transition-colors",children:d.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:d.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),t&&d.jsxs("div",{className:"mt-2 text-sm bg-yellow-700 p-2 rounded",children:[d.jsx("p",{className:"mb-2",children:"While offline, you can:"}),d.jsxs("ul",{className:"text-left space-y-1 ml-4",children:[d.jsx("li",{children:"• View your current stats and progress"}),d.jsx("li",{children:"• Track habits and cravings"}),d.jsx("li",{children:"• Play distraction games"}),d.jsx("li",{children:"• View your profile information"})]}),d.jsx("p",{className:"mt-2 text-yellow-200",children:"Changes will sync when you're back online."})]})]})},J9=({selectedRate:n,duration:e,onRateSelect:t,onDurationSelect:r,onStartExercise:s})=>d.jsxs("div",{className:"p-8",children:[d.jsxs("div",{className:"text-center mb-8",children:[d.jsx("h2",{className:"text-2xl font-bold text-white mb-2",children:"Breathing Exercise"}),d.jsx("p",{className:"text-slate-400",children:"Configure your breathing session"})]}),d.jsx("div",{onClick:t,className:"bg-slate-800/50 hover:bg-slate-700/50 rounded-2xl p-6 mb-6 border border-slate-600/30 cursor-pointer transition-all duration-300 hover:scale-[1.02] group",children:d.jsxs("div",{className:"flex items-center justify-between",children:[d.jsxs("div",{className:"flex items-center space-x-4",children:[d.jsx("div",{className:"w-12 h-12 bg-slate-700/50 rounded-xl flex items-center justify-center group-hover:bg-slate-600/50 transition-colors",children:d.jsx("span",{className:"text-2xl",children:"🫁"})}),d.jsxs("div",{className:"text-left",children:[d.jsx("div",{className:"text-white font-semibold text-lg",children:"BREATHING RATE"}),d.jsxs("div",{className:"text-slate-400 text-sm",children:[n.inhale,"s | ",n.exhale,"s"]})]})]}),d.jsxs("div",{className:"text-right",children:[d.jsx("div",{className:"text-white font-bold text-lg",children:n.name}),d.jsxs("div",{className:"text-slate-400 text-sm",children:[n.inhale,"s | ",n.exhale,"s"]})]})]})}),d.jsx("div",{onClick:r,className:"bg-slate-800/50 hover:bg-slate-700/50 rounded-2xl p-6 mb-8 border border-slate-600/30 cursor-pointer transition-all duration-300 hover:scale-[1.02] group",children:d.jsxs("div",{className:"flex items-center justify-between",children:[d.jsxs("div",{className:"flex items-center space-x-4",children:[d.jsx("div",{className:"w-12 h-12 bg-slate-700/50 rounded-xl flex items-center justify-center group-hover:bg-slate-600/50 transition-colors",children:d.jsx("span",{className:"text-2xl",children:"⏱️"})}),d.jsxs("div",{className:"text-left",children:[d.jsx("div",{className:"text-white font-semibold text-lg",children:"DURATION"}),d.jsx("div",{className:"text-slate-400 text-sm",children:"Session length"})]})]}),d.jsxs("div",{className:"text-right",children:[d.jsxs("div",{className:"text-white font-bold text-lg",children:[e,"min."]}),d.jsx("div",{className:"text-slate-400 text-sm",children:"Total time"})]})]})}),d.jsx("button",{onClick:s,className:"w-full bg-gradient-to-r from-blue-600 to-purple-600 hover:from-blue-700 hover:to-purple-700 text-white font-bold text-lg py-4 px-6 rounded-2xl transition-all duration-300 hover:scale-105 shadow-lg hover:shadow-xl",children:"START EXERCISE"}),d.jsx("div",{className:"mt-6 text-center",children:d.jsx("p",{className:"text-slate-400 text-sm",children:"Find a comfortable position and prepare to relax"})})]}),X9=({selectedRate:n,onSelect:e,onBack:t})=>{const r=[{name:"INTRO",inhale:3,exhale:6},{name:"BASIC",inhale:5,exhale:10},{name:"INTERMEDIATE",inhale:10,exhale:20},{name:"ADVANCED",inhale:20,exhale:40},{name:"ELITE",inhale:30,exhale:60}];return d.jsxs("div",{className:"p-8",children:[d.jsxs("div",{className:"text-center mb-8",children:[d.jsx("h2",{className:"text-2xl font-bold text-white mb-2",children:"BREATHING RATE"}),d.jsx("p",{className:"text-slate-400",children:"Choose your breathing pattern"})]}),d.jsx("div",{className:"space-y-4 mb-8",children:r.map(s=>d.jsx("div",{onClick:()=>e(s),className:`rounded-2xl p-6 border transition-all duration-300 cursor-pointer hover:scale-[1.02] ${n.name===s.name?"bg-white text-slate-900 border-white shadow-lg":"bg-slate-800/50 text-white border-slate-600/30 hover:bg-slate-700/50"}`,children:d.jsxs("div",{className:"flex items-center justify-between",children:[d.jsxs("div",{className:"text-left",children:[d.jsx("div",{className:`font-bold text-lg ${n.name===s.name?"text-slate-900":"text-white"}`,children:s.name}),d.jsxs("div",{className:`text-sm ${n.name===s.name?"text-slate-600":"text-slate-400"}`,children:[s.inhale,"s inhale | ",s.exhale,"s exhale"]})]}),n.name===s.name&&d.jsx("div",{className:"w-6 h-6 bg-slate-900 rounded-full flex items-center justify-center",children:d.jsx("svg",{className:"w-4 h-4 text-white",fill:"currentColor",viewBox:"0 0 20 20",children:d.jsx("path",{fillRule:"evenodd",d:"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z",clipRule:"evenodd"})})})]})},s.name))}),d.jsx("button",{onClick:t,className:"w-full bg-slate-700/50 hover:bg-slate-600/50 text-white font-medium py-3 px-6 rounded-2xl transition-all duration-300 border border-slate-600/30",children:"Back to Setup"})]})},Z9=({selectedDuration:n,onSelect:e,onBack:t})=>{const[r,s]=j.useState(n),i=2,o=10;j.useEffect(()=>{s(n)},[n]);const a=f=>{const g=parseInt(f.target.value);s(g),navigator.vibrate&&navigator.vibrate(50),console.log(`🎯 Duration picker: Selected ${g} minutes`)},l=()=>{e(r)},u=f=>f<=3?"Short Session":f<=6?"Medium Session":f<=8?"Long Session":"Extended Session",h=f=>f<=3?"text-green-400":f<=6?"text-blue-400":f<=8?"text-orange-400":"text-red-400";return d.jsxs("div",{className:"p-8",children:[d.jsxs("div",{className:"text-center mb-8",children:[d.jsx("h2",{className:"text-2xl font-bold text-white mb-2",children:"DURATION"}),d.jsx("p",{className:"text-slate-400",children:"Choose your session length"})]}),d.jsxs("div",{className:"text-center mb-8",children:[d.jsxs("div",{className:`text-8xl font-bold ${h(r)} mb-2`,children:[r," mins"]}),d.jsx("div",{className:`text-xl font-medium ${h(r)}`,children:u(r)})]}),d.jsx("div",{className:"mb-8",children:d.jsx("input",{type:"range",min:i,max:o,step:1,value:r,onChange:a,style:{background:`linear-gradient(to right, #3b82f6 0%, #3b82f6 ${(r-i)/(o-i)*100}%, #475569 ${(r-i)/(o-i)*100}%, #475569 100%)`},className:"w-full h-4 rounded-lg appearance-none cursor-pointer slider mb-4"})}),d.jsx("button",{onClick:l,className:"w-full bg-gradient-to-r from-green-600 to-green-700 hover:from-green-700 hover:to-green-800 text-white font-bold text-lg py-4 px-6 rounded-2xl transition-all duration-300 hover:scale-105 shadow-lg transform active:scale-95",children:"SAVE"}),d.jsx("button",{onClick:t,className:"w-full mt-4 bg-slate-700/50 hover:bg-slate-600/50 text-white font-medium py-3 px-6 rounded-2xl transition-all duration-300 border border-slate-600/30 hover:border-slate-500/50",children:"Back to Setup"})]})},e8=({rate:n,duration:e,onComplete:t,onClose:r,onLeave:s})=>{const[h,f]=j.useState(e*60),[g,y]=j.useState("inhale"),[w,C]=j.useState(0),[M,A]=j.useState(!1),[I,R]=j.useState(.1),[D,V]=j.useState(!1),[P,S]=j.useState(!1),v=j.useRef(null),b=j.useRef(null);j.useEffect(()=>{h===0&&M&&!P&&(console.log("🎯 Exercise completed, calling onComplete"),S(!0),t())},[h,M,P,t]);const _=()=>{console.log(`⏰ Starting main timer for ${e} minutes`),b.current&&(console.log("⚠️ Timer already exists, clearing previous timer"),clearInterval(b.current)),b.current=setInterval(()=>{f(ie=>{if(ie<=1)return console.log(`⏰ Main exercise timer completed! Total duration: ${e} minutes`),clearInterval(b.current),b.current=null,0;const le=ie-1;return le%10===0&&console.log(`⏰ Main timer: ${le}s remaining`),le})},1e3),console.log("✅ Main timer started successfully")},E=()=>{console.log(`🚀 Starting breathing cycle with rate: inhale=${n.inhale}s, exhale=${n.exhale}s`),v.current&&(console.log("⚠️ Animation already running, clearing previous animation"),cancelAnimationFrame(v.current));const ie=n.inhale+n.exhale;let le=0,ce=0,Ae="inhale";console.log(`📊 Cycle duration: ${ie}s, starting animation loop...`);const $e=()=>{if(le+=16,le>=ie*1e3&&(console.log(`🔄 Breathing cycle completed, resetting to 0ms. Current phase: ${Ae}, phaseTime: ${w}`),le=0,ce=0,Ae="inhale",y("inhale"),C(0)),le<n.inhale*1e3){Ae!=="inhale"&&(console.log(`🔄 Switching to INHALE phase at ${le}ms`),Ae="inhale",y("inhale"),C(0),ce=0);const xe=le/(n.inhale*1e3),de=.1+N(xe)*3.9;R(de);const Ee=Math.floor(xe*n.inhale);Ee!==ce&&(C(Ee),ce=Ee,console.log(`⏱️ INHALE: ${Ee}/${n.inhale}s (phase: ${Ae}, scale: ${de.toFixed(3)})`))}else{Ae!=="exhale"&&(console.log(`🔄 Switching to EXHALE phase at ${le}ms`),Ae="exhale",y("exhale"),C(0),ce=0);const xe=(le-n.inhale*1e3)/(n.exhale*1e3),de=4-N(xe)*3.9;R(de);const Ee=Math.floor(xe*n.exhale);Ee!==ce&&(C(Ee),ce=Ee,console.log(`⏱️ EXHALE: ${Ee}/${n.exhale}s (phase: ${Ae}, scale: ${de.toFixed(3)})`))}v.current=requestAnimationFrame($e)};$e(),console.log("✅ Breathing cycle animation started successfully")},N=ie=>ie<.5?2*ie*ie:-1+(4-2*ie)*ie;j.useEffect(()=>(M&&(_(),E()),()=>{M&&ee()}),[M]);const T=ie=>{const le=Math.floor(ie/60),ce=ie%60;return`${le.toString().padStart(2,"0")}:${ce.toString().padStart(2,"0")}`},K=()=>w,mt=()=>g==="inhale"?"from-orange-400 to-red-500":"from-blue-400 to-cyan-500",Me=()=>g==="inhale"?"Inhale through the nose":"Exhale slowly through the mouth and empty your lungs",qt=()=>{console.log("🔄 User clicked close button, showing confirmation popup"),V(!0)},k=()=>{console.log("🚪 User confirmed leaving exercise, cleaning up..."),ee(),s?s():r()},$=()=>{V(!1)},Q=()=>{if(M){console.log("⚠️ Exercise already active, ignoring start request");return}console.log(`🎬 Starting breathing exercise: ${e} minutes, rate: ${n.name}`),console.log(`📊 Initial state - isActive: ${M}, progress: ${I}, currentPhase: ${g}`),R(.1),y("inhale"),C(0),f(e*60),A(!0),console.log("✅ isActive set to true, starting timers..."),setTimeout(()=>{console.log("🚀 Starting main timer and breathing cycle..."),_(),E()},0)},ee=()=>{console.log("🧹 Cleaning up breathing exercise resources"),v.current&&(cancelAnimationFrame(v.current),v.current=null),b.current&&(clearInterval(b.current),b.current=null),A(!1),f(0),R(.1),y("inhale"),C(0)};return j.useEffect(()=>{M||(console.log("🎬 Component mounted, starting breathing exercise automatically"),Q())},[]),d.jsxs("div",{className:"h-screen bg-slate-900 flex flex-col",children:[d.jsxs("div",{className:"flex items-center justify-between p-6",children:[d.jsx("button",{onClick:qt,className:"w-11 h-11 flex items-center justify-center text-white hover:text-slate-300 transition-colors bg-slate-800/50 hover:bg-slate-700/50 rounded-lg border border-slate-600/30 hover:border-slate-500/50 z-50",title:"End breathing exercise",children:d.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:d.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})}),d.jsx("div",{className:"text-center",children:d.jsx("div",{className:"text-white text-2xl font-mono",children:T(h)})}),d.jsx("div",{className:"w-11"})," "]}),d.jsxs("div",{className:"flex-1 flex items-center justify-center relative",children:[d.jsx("div",{className:"absolute w-80 h-80 border-2 border-dashed border-white/30 rounded-full"}),d.jsx("div",{className:`w-20 h-20 bg-gradient-to-br ${mt()} rounded-full shadow-2xl`,style:{transform:`scale(${I})`,transition:"none",boxShadow:`0 0 ${Math.max(I*40,10)}px ${Math.max(I*15,5)}px ${g==="inhale"?"rgba(251, 146, 60, 0.5)":"rgba(59, 130, 246, 0.5)"}`}})]}),d.jsxs("div",{className:"p-6 text-center",children:[d.jsx("div",{className:"flex items-center justify-center mb-4 h-16",children:d.jsx("span",{className:"text-white text-lg leading-tight",children:Me()})}),d.jsxs("div",{className:"text-slate-400 text-sm",children:[K(),"/",g==="inhale"?n.inhale:n.exhale,"s"]})]}),d.jsx("div",{className:"px-6 pb-6",children:d.jsx("div",{className:"w-full bg-slate-700/30 rounded-full h-1",children:d.jsx("div",{className:"bg-gradient-to-r from-blue-500 to-purple-500 h-1 rounded-full transition-all duration-1000 ease-out",style:{width:`${(e*60-h)/(e*60)*100}%`}})})}),D&&d.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/80 backdrop-blur-sm",children:d.jsxs("div",{className:"bg-slate-800 rounded-2xl p-6 mx-4 max-w-sm w-full border border-slate-600/50",children:[d.jsxs("div",{className:"text-center mb-6",children:[d.jsx("h3",{className:"text-white text-xl font-bold mb-2",children:"Want to stop now?"}),d.jsx("p",{className:"text-slate-300 text-sm leading-relaxed",children:"Stay strong - resist the craving? If you leave now, you will not get the bonus points"})]}),d.jsxs("div",{className:"flex space-x-3",children:[d.jsx("button",{onClick:k,className:"flex-1 bg-red-600 hover:bg-red-700 text-white font-medium py-3 px-4 rounded-xl transition-colors",children:"Leave"}),d.jsx("button",{onClick:$,className:"flex-1 bg-green-600 hover:bg-green-700 text-white font-medium py-3 px-4 rounded-xl transition-colors",children:"Stay"})]})]})})]})},t8=({isOpen:n,onClose:e,onNavigateToCravingSupport:t,onComplete:r})=>{const[s,i]=j.useState("setup"),[o,a]=j.useState({name:"INTERMEDIATE",inhale:10,exhale:20}),[l,u]=j.useState(4),[h,f]=j.useState(!1);j.useEffect(()=>{n&&(i("setup"),f(!1))},[n]);const g=I=>{a(I),i("setup")},y=I=>{u(I),i("setup")},w=()=>{f(!0),i("exercise")},C=()=>{f(!1),i("setup"),r&&r(),e()},M=()=>{s==="exercise"&&h||e()},A=()=>{console.log("🚪 User leaving breathing exercise via close button"),e(),t&&t()};return n?d.jsxs("div",{className:"fixed inset-0 z-50 flex items-center justify-center",children:[d.jsx("div",{className:"absolute inset-0 bg-black/80 backdrop-blur-sm",onClick:M}),d.jsxs("div",{className:"relative w-full max-w-md mx-4 bg-slate-900 rounded-3xl shadow-2xl border border-slate-700/50 overflow-hidden",children:[!(s==="exercise"&&h)&&d.jsx("button",{onClick:M,className:"absolute top-4 left-4 z-10 w-8 h-8 flex items-center justify-center text-white hover:text-slate-300 transition-colors",children:d.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:d.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})}),s==="setup"&&d.jsx(J9,{selectedRate:o,duration:l,onRateSelect:()=>i("rate"),onDurationSelect:()=>i("duration"),onStartExercise:w}),s==="rate"&&d.jsx(X9,{selectedRate:o,onSelect:g,onBack:()=>i("setup")}),s==="duration"&&d.jsx(Z9,{selectedDuration:l,onSelect:y,onBack:()=>i("setup")}),s==="exercise"&&d.jsx(e8,{rate:o,duration:l,onComplete:C,onClose:M,onLeave:A})]})]}):null};var n8={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};const r8=n=>n.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase(),s8=(n,e)=>{const t=j.forwardRef(({color:r="currentColor",size:s=24,strokeWidth:i=2,absoluteStrokeWidth:o,children:a,...l},u)=>j.createElement("svg",{ref:u,...n8,width:s,height:s,stroke:r,strokeWidth:o?Number(i)*24/Number(s):i,className:`lucide lucide-${r8(n)}`,...l},[...e.map(([h,f])=>j.createElement(h,f)),...(Array.isArray(a)?a:[a])||[]]));return t.displayName=`${n}`,t};var qn=s8;const i8=qn("ArrowRight",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"m12 5 7 7-7 7",key:"xquz4c"}]]),o8=qn("BarChart3",[["path",{d:"M3 3v18h18",key:"1s2lah"}],["path",{d:"M18 17V9",key:"2bz60n"}],["path",{d:"M13 17V5",key:"1frdt8"}],["path",{d:"M8 17v-3",key:"17ska0"}]]),LD=qn("Calendar",[["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",ry:"2",key:"eu3xkr"}],["line",{x1:"16",x2:"16",y1:"2",y2:"6",key:"m3sa8f"}],["line",{x1:"8",x2:"8",y1:"2",y2:"6",key:"18kwsl"}],["line",{x1:"3",x2:"21",y1:"10",y2:"10",key:"xt86sb"}]]),OD=qn("DollarSign",[["line",{x1:"12",x2:"12",y1:"2",y2:"22",key:"7eqyqh"}],["path",{d:"M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6",key:"1b0p4s"}]]),VD=qn("Heart",[["path",{d:"M19 14c1.49-1.46 3-3.21 3-5.5A5.5 5.5 0 0 0 16.5 3c-1.76 0-3 .5-4.5 2-1.5-1.5-2.74-2-4.5-2A5.5 5.5 0 0 0 2 8.5c0 2.3 1.5 4.05 3 5.5l7 7Z",key:"c3ymky"}]]),a8=qn("Home",[["path",{d:"m3 9 9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z",key:"y5dka4"}],["polyline",{points:"9 22 9 12 15 12 15 22",key:"e2us08"}]]),If=qn("RefreshCw",[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]]),FD=qn("Settings",[["path",{d:"M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.5a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z",key:"1qme2f"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]),Jd=qn("Shield",[["path",{d:"M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z",key:"3xmgem"}]]),l8=qn("Sparkles",[["path",{d:"m12 3-1.912 5.813a2 2 0 0 1-1.275 1.275L3 12l5.813 1.912a2 2 0 0 1 1.275 1.275L12 21l1.912-5.813a2 2 0 0 1 1.275-1.275L21 12l-5.813-1.912a2 2 0 0 1-1.275-1.275L12 3Z",key:"17u4zn"}],["path",{d:"M5 3v4",key:"bklmnn"}],["path",{d:"M19 17v4",key:"iiml17"}],["path",{d:"M3 5h4",key:"nem4j1"}],["path",{d:"M17 19h4",key:"lbex7p"}]]),jD=qn("Star",[["polygon",{points:"12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2",key:"8f66p6"}]]),c8=qn("Sword",[["polyline",{points:"14.5 17.5 3 6 3 3 6 3 17.5 14.5",key:"1hfsw2"}],["line",{x1:"13",x2:"19",y1:"19",y2:"13",key:"1vrmhu"}],["line",{x1:"16",x2:"20",y1:"16",y2:"20",key:"1bron3"}],["line",{x1:"19",x2:"21",y1:"21",y2:"19",key:"13pww6"}]]),u8=qn("Target",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["circle",{cx:"12",cy:"12",r:"6",key:"1vlfrh"}],["circle",{cx:"12",cy:"12",r:"2",key:"1c9p78"}]]),d8=qn("TrendingUp",[["polyline",{points:"22 7 13.5 15.5 8.5 10.5 2 17",key:"126l90"}],["polyline",{points:"16 7 22 7 22 13",key:"kwv8wd"}]]),UD=qn("Trophy",[["path",{d:"M6 9H4.5a2.5 2.5 0 0 1 0-5H6",key:"17hqa7"}],["path",{d:"M18 9h1.5a2.5 2.5 0 0 0 0-5H18",key:"lmptdp"}],["path",{d:"M4 22h16",key:"57wxv0"}],["path",{d:"M10 14.66V17c0 .55-.47.98-.97 1.21C7.85 18.75 7 20.24 7 22",key:"1nw9bq"}],["path",{d:"M14 14.66V17c0 .55.47.98.97 1.21C16.15 18.75 17 20.24 17 22",key:"1np0yb"}],["path",{d:"M18 2H6v7a6 6 0 0 0 12 0V2Z",key:"u46fv3"}]]),$D=qn("User",[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]]),BD=qn("Users",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["path",{d:"M22 21v-2a4 4 0 0 0-3-3.87",key:"kshegd"}],["path",{d:"M16 3.13a4 4 0 0 1 0 7.75",key:"1da9ce"}]]),h8=({user:n,behavioralService:e,onClose:t})=>{const[r,s]=j.useState(null),[i,o]=j.useState(!0),[a,l]=j.useState(30);j.useEffect(()=>{e&&(n!=null&&n.uid)&&u()},[e,n==null?void 0:n.uid,a]);const u=async()=>{try{o(!0);try{const h=await e.getUserAnalytics(n.uid,a);s(h)}catch(h){console.warn("Full analytics not available (indexes building), using basic analytics:",h.message);const f=await e.getBasicAnalytics(n.uid);s(f)}}catch(h){console.error("Error loading analytics:",h)}finally{o(!1)}};return e?d.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:d.jsxs("div",{className:"bg-slate-800 rounded-lg max-w-4xl w-full max-h-[90vh] overflow-y-auto",children:[d.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-slate-700",children:[d.jsxs("div",{className:"flex items-center gap-3",children:[d.jsx(o8,{className:"w-6 h-6 text-blue-400"}),d.jsx("h2",{className:"text-xl font-bold text-white",children:"Behavioral Analytics"})]}),d.jsxs("div",{className:"flex items-center gap-4",children:[d.jsxs("select",{value:a,onChange:h=>l(parseInt(h.target.value)),className:"bg-slate-700 text-white px-3 py-2 rounded border border-slate-600",children:[d.jsx("option",{value:7,children:"Last 7 days"}),d.jsx("option",{value:30,children:"Last 30 days"}),d.jsx("option",{value:90,children:"Last 90 days"})]}),d.jsx("button",{onClick:t,className:"text-gray-400 hover:text-white",children:"✕"})]})]}),d.jsx("div",{className:"p-6",children:i?d.jsxs("div",{className:"text-center py-8",children:[d.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-400 mx-auto mb-4"}),d.jsx("p",{className:"text-gray-300",children:"Loading behavioral analytics..."})]}):r?d.jsxs("div",{className:"space-y-6",children:[d.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[d.jsx("div",{className:"bg-slate-700 rounded-lg p-4",children:d.jsxs("div",{className:"flex items-center gap-3",children:[d.jsx(u8,{className:"w-5 h-5 text-green-400"}),d.jsxs("div",{children:[d.jsx("p",{className:"text-gray-300 text-sm",children:"Craving Resistance"}),d.jsx("p",{className:"text-white font-bold",children:r.cravingStats.total>0?`${(r.cravingStats.resisted/r.cravingStats.total*100).toFixed(1)}%`:"No data"})]})]})}),d.jsx("div",{className:"bg-slate-700 rounded-lg p-4",children:d.jsxs("div",{className:"flex items-center gap-3",children:[d.jsx(d8,{className:"w-5 h-5 text-blue-400"}),d.jsxs("div",{children:[d.jsx("p",{className:"text-gray-300 text-sm",children:"Wellness Activities"}),d.jsx("p",{className:"text-white font-bold",children:r.wellnessStats.totalWellnessActivities})]})]})}),d.jsx("div",{className:"bg-slate-700 rounded-lg p-4",children:d.jsxs("div",{className:"flex items-center gap-3",children:[d.jsx(LD,{className:"w-5 h-5 text-purple-400"}),d.jsxs("div",{children:[d.jsx("p",{className:"text-gray-300 text-sm",children:"Relapses"}),d.jsx("p",{className:"text-white font-bold",children:r.relapseStats.total})]})]})}),d.jsx("div",{className:"bg-slate-700 rounded-lg p-4",children:d.jsxs("div",{className:"flex items-center gap-3",children:[d.jsx("span",{className:"text-orange-400",children:"💧"}),d.jsxs("div",{children:[d.jsx("p",{className:"text-gray-300 text-sm",children:"Hydration Days"}),d.jsx("p",{className:"text-white font-bold",children:r.wellnessStats.hydrationDays})]})]})})]}),d.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[d.jsxs("div",{className:"bg-slate-700 rounded-lg p-4",children:[d.jsx("h3",{className:"text-lg font-semibold text-white mb-4",children:"Craving Patterns"}),d.jsxs("div",{className:"space-y-3",children:[d.jsxs("div",{children:[d.jsx("p",{className:"text-gray-300 text-sm",children:"Total Cravings"}),d.jsx("p",{className:"text-white font-bold",children:r.cravingStats.total})]}),d.jsxs("div",{children:[d.jsx("p",{className:"text-gray-300 text-sm",children:"Average Strength"}),d.jsxs("p",{className:"text-white font-bold",children:[r.cravingStats.averageStrength.toFixed(1),"/10"]})]}),d.jsxs("div",{children:[d.jsx("p",{className:"text-gray-300 text-sm",children:"Common Triggers"}),d.jsx("div",{className:"space-y-1",children:r.cravingStats.commonTriggers.slice(0,3).map((h,f)=>d.jsxs("p",{className:"text-blue-400 text-sm",children:[h.trigger," (",h.count,"x)"]},f))})]})]})]}),d.jsxs("div",{className:"bg-slate-700 rounded-lg p-4",children:[d.jsx("h3",{className:"text-lg font-semibold text-white mb-4",children:"Wellness Activities"}),d.jsxs("div",{className:"space-y-3",children:[d.jsxs("div",{className:"flex justify-between",children:[d.jsx("span",{className:"text-gray-300",children:"🫁 Breathing Exercises"}),d.jsx("span",{className:"text-white font-bold",children:r.wellnessStats.breathingExercises})]}),d.jsxs("div",{className:"flex justify-between",children:[d.jsx("span",{className:"text-gray-300",children:"🧘‍♀️ Meditation Sessions"}),d.jsx("span",{className:"text-white font-bold",children:r.wellnessStats.meditationSessions})]}),d.jsxs("div",{className:"flex justify-between",children:[d.jsx("span",{className:"text-gray-300",children:"🚶‍♂️ Physical Activities"}),d.jsx("span",{className:"text-white font-bold",children:r.wellnessStats.physicalActivities})]}),d.jsxs("div",{className:"flex justify-between",children:[d.jsx("span",{className:"text-gray-300",children:"💧 Hydration Goals Met"}),d.jsx("span",{className:"text-white font-bold",children:r.wellnessStats.hydrationDays})]})]})]}),d.jsxs("div",{className:"bg-slate-700 rounded-lg p-4",children:[d.jsx("h3",{className:"text-lg font-semibold text-white mb-4",children:"Time Patterns"}),d.jsxs("div",{className:"space-y-2",children:[d.jsx("p",{className:"text-gray-300 text-sm",children:"Peak Craving Hours"}),r.cravingStats.timePatterns.map((h,f)=>d.jsxs("div",{className:"flex justify-between",children:[d.jsxs("span",{className:"text-blue-400",children:[h.hour,":00"]}),d.jsxs("span",{className:"text-white",children:[h.count," cravings"]})]},f))]})]}),d.jsxs("div",{className:"bg-slate-700 rounded-lg p-4",children:[d.jsx("h3",{className:"text-lg font-semibold text-white mb-4",children:"AI Insights"}),d.jsxs("div",{className:"space-y-2",children:[r.insights.map((h,f)=>d.jsxs("p",{className:"text-gray-300 text-sm",children:["• ",h]},f)),r.insights.length===0&&d.jsx("p",{className:"text-gray-400 text-sm italic",children:"More insights will appear as you track more activities."})]})]})]}),d.jsxs("div",{className:"bg-slate-700 rounded-lg p-4",children:[d.jsx("h3",{className:"text-lg font-semibold text-white mb-4",children:"📡 System Status"}),d.jsxs("div",{className:"space-y-2 mb-4",children:[d.jsxs("div",{className:"flex items-center gap-2",children:[d.jsx("span",{className:"w-3 h-3 bg-green-500 rounded-full"}),d.jsx("span",{className:"text-gray-300 text-sm",children:"Behavioral Service Connected"})]}),d.jsxs("div",{className:"flex items-center gap-2",children:[d.jsx("span",{className:"w-3 h-3 bg-yellow-500 rounded-full animate-pulse"}),d.jsx("span",{className:"text-gray-300 text-sm",children:"Database Indexes Building (may take 5-10 minutes)"})]}),d.jsxs("div",{className:"flex items-center gap-2",children:[d.jsx("span",{className:"w-3 h-3 bg-blue-500 rounded-full"}),d.jsx("span",{className:"text-gray-300 text-sm",children:"Data Logging Active"})]})]}),d.jsx("p",{className:"text-gray-400 text-xs",children:"Full analytics will be available once indexes are built. Basic analytics are shown in the meantime."})]}),d.jsxs("div",{className:"bg-slate-700 rounded-lg p-4",children:[d.jsx("h3",{className:"text-lg font-semibold text-white mb-4",children:"Data Export"}),d.jsx("p",{className:"text-gray-300 text-sm mb-4",children:"All your behavioral data is stored in Firestore for predictive analytics and research purposes."}),d.jsx("button",{onClick:()=>{const h=new Blob([JSON.stringify(r,null,2)],{type:"application/json"}),f=URL.createObjectURL(h),g=document.createElement("a");g.href=f,g.download=`behavioral-analytics-${n.heroName}-${new Date().toISOString().split("T")[0]}.json`,g.click(),URL.revokeObjectURL(f)},className:"bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded transition-colors",children:"Export Analytics Data"})]})]}):d.jsxs("div",{className:"text-center py-8",children:[d.jsx("p",{className:"text-gray-300",children:"No analytics data available."}),d.jsx("p",{className:"text-gray-400 text-sm mt-2",children:"Start tracking activities to see insights!"})]})})]})}):d.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",children:d.jsxs("div",{className:"bg-slate-800 rounded-lg p-6 max-w-md w-full mx-4",children:[d.jsx("h2",{className:"text-xl font-bold text-white mb-4",children:"Analytics Dashboard"}),d.jsx("p",{className:"text-gray-300",children:"Behavioral service not available. Analytics require Firestore connection."}),d.jsx("button",{onClick:t,className:"mt-4 bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded transition-colors",children:"Close"})]})})};console.log("🧪 FirestoreBuddyService import check:",!!Kl);console.log("🧪 FirestoreBuddyService type:",typeof Kl);console.log("🧪 FirestoreBuddyService constructor:",Kl==null?void 0:Kl.name);const Ns=(n,e="adventurer")=>{const t="https://api.dicebear.com/7.x",r={seed:n||Math.random().toString(36).substring(7),backgroundColor:["b6e3f4","c0aede","ffdfbf","ffd5dc"],radius:50,size:200},s=new URLSearchParams(r).toString();return`${t}/${e}/svg?${s}`},Ef=n=>{const e=["#3B82F6","#10B981","#F59E0B","#EF4444","#8B5CF6","#EC4899"],t=e[n.charCodeAt(0)%e.length],r=n.substring(0,2).toUpperCase();return`data:image/svg+xml,${encodeURIComponent(`
    <svg width="200" height="200" xmlns="http://www.w3.org/2000/svg">
      <rect width="200" height="200" fill="${t}"/>
      <text x="100" y="120" font-family="Arial, sans-serif" font-size="80" font-weight="bold" text-anchor="middle" fill="white">${r}</text>
    </svg>
  `)}`},Sf=n=>n<=3?"#ef4444":n<=6?"#fbbf24":n<=9?"#84cc16":"#22c55e",pl=(n,e=new Date)=>{const t=e.getTime()-n.getTime(),r=Math.floor(t/(1e3*3600)),s=Math.floor(t/(1e3*3600*24));return r<24?{value:Math.max(0,r),unit:"hours",displayText:`${Math.max(0,r)} hour${r===1?"":"s"}`}:{value:Math.max(0,s),unit:"days",displayText:`${Math.max(0,s)} day${s===1?"":"s"}`}},f8=({onComplete:n,authUser:e})=>{const[t,r]=j.useState(1),[s,i]=j.useState({heroName:"",archetype:"",avatar:null,avatarSeed:Math.random().toString(36).substring(7),triggers:[],dailyPatterns:[],copingStrategies:[],vapePodsPerWeek:0,nicotineStrength:"",quitAttempts:"",confidence:5}),[o,a]=j.useState(!1),[l,u]=j.useState(!1),[h,f]=j.useState(null),[g,y]=j.useState(null),w=[{id:"DETERMINED",name:"The Determined",description:"Unstoppable willpower and determination",color:"bg-red-500",icon:Jd},{id:"SOCIAL_FIGHTER",name:"The Social Fighter",description:"Thrives on community support",color:"bg-blue-500",icon:BD},{id:"HEALTH_WARRIOR",name:"The Health Warrior",description:"Focused on physical and mental wellness",color:"bg-green-500",icon:VD},{id:"MONEY_SAVER",name:"The Money Saver",description:"Motivated by financial freedom",color:"bg-yellow-500",icon:OD}],C=["Stress/anxiety","Social situations","Boredom","After meals","Drinking alcohol","Work breaks","Driving"],M=["Morning routine","Work breaks","After meals","Evening wind-down","Social events","Throughout the day"],A=["Breathing exercises","Nicotine replacement therapy","Exercise/physical activity","Distraction techniques","Nothing - this is new to me"],I=()=>{console.log("Calculating stats with userData:",s);let _=40;s.vapePodsPerWeek<=1?_+=5:s.vapePodsPerWeek<=3?_+=15:s.vapePodsPerWeek<=5?_+=25:s.vapePodsPerWeek<=7?_+=35:_+=40;const E=s.nicotineStrength||"",N=parseInt(E.replace("mg",""))||0;N<=5?_+=0:N<=11?_+=10:N<=20?_+=20:_+=25,s.dailyPatterns.includes("Throughout the day")?_+=20:s.dailyPatterns.length>2?_+=10:_+=0,_=Math.min(_,100);let T=25;s.confidence>=9?T+=35:s.confidence>=7?T+=25:s.confidence>=4?T+=15:T+=0,s.quitAttempts==="first"?T+=15:parseInt(s.quitAttempts)<=3?T+=10:T+=5,s.copingStrategies.length>=3?T+=15:s.copingStrategies.length>=1?T+=10:T+=0,T=Math.min(T,80);let K=35;K+={DETERMINED:20,HEALTH_WARRIOR:15,SOCIAL_FIGHTER:15,MONEY_SAVER:10}[s.archetype]||0,s.confidence>=8?K+=25:s.confidence>=5?K+=15:K+=0,s.quitAttempts==="first"?K+=10:parseInt(s.quitAttempts)<=3?K+=5:K+=15,K=Math.min(K,90);let Me=15;s.triggers.length<=2?Me+=15:s.triggers.length<=4?Me+=10:Me+=5;const qt=s.triggers.includes("Drinking alcohol"),k=s.triggers.includes("Social situations");return qt&&k?Me+=0:s.triggers.length>3?Me+=5:Me+=10,s.copingStrategies.length>=3?Me+=25:s.copingStrategies.length>=1?Me+=15:Me+=0,s.dailyPatterns.includes("Throughout the day")?Me+=0:s.dailyPatterns.length>2?Me+=5:Me+=10,Me=Math.min(Me,60),{addictionLevel:_,mentalStrength:T,motivation:K,triggerDefense:Me}},R=_=>{const E=_.target.files[0];if(E){f(E);const N=new FileReader;N.onload=T=>y(T.target.result),N.readAsDataURL(E)}},D=async()=>{if(h){u(!0);try{const _=document.createElement("canvas"),E=_.getContext("2d"),N=new Image;N.onload=()=>{_.width=200,_.height=200,E.filter="contrast(1.2) saturate(1.3) brightness(1.1)",E.drawImage(N,0,0,200,200),E.globalCompositeOperation="overlay",E.fillStyle="rgba(255, 200, 200, 0.1)",E.fillRect(0,0,200,200);const T=_.toDataURL("image/png"),K={...s,avatar:T};i(K),b(K,3),u(!1)},N.src=g}catch(_){console.error("Photo processing failed:",_);const E=Ef(s.avatarSeed);i(N=>({...N,avatar:E})),u(!1)}}},V=()=>{a(!0);const _=Math.random().toString(36).substring(7);(async()=>{try{const N=Ns(_),T={...s,avatarSeed:_,avatar:N};i(T),b(T,3)}catch{const T=Ef(_),K={...s,avatarSeed:_,avatar:T};i(K),b(K,3)}})(),setTimeout(()=>a(!1),500)},P=async()=>{if(t<10)await b(s,t),r(t+1);else try{console.log("Completing onboarding with userData:",s);const _=I();console.log("Calculated stats:",_);const E={...s,stats:{..._,streakDays:0,experiencePoints:0},achievements:[],quitDate:new Date};await b(E,10),console.log("Final user data:",E),n(E)}catch(_){console.error("Error completing onboarding:",_);const N={...s,stats:{...{addictionLevel:50,mentalStrength:50,motivation:50,triggerDefense:30},streakDays:0,experiencePoints:0},achievements:[],quitDate:new Date};try{await b(N,10)}catch(T){console.error("Failed to save fallback data to Firebase:",T)}console.log("Using fallback stats:",N),n(N)}},S=()=>{t>1&&r(t-1)},v=()=>{switch(t){case 1:return s.heroName.trim().length>0;case 2:return s.archetype!=="";case 3:return s.avatar!==null;case 4:return s.triggers.length>0;case 5:return s.dailyPatterns.length>0;case 6:return s.copingStrategies.length>0;case 7:return s.vapePodsPerWeek>0;case 8:return s.nicotineStrength!=="";case 9:return s.quitAttempts!=="";case 10:return s.confidence>0;default:return!1}},b=async(_,E)=>{if(e)try{const{ref:N,set:T}=await be(()=>import("./index.esm-eba9a326.js"),[]),K=N(q,`users/${e.uid}/onboarding`);await T(N(q,`users/${e.uid}/onboarding/step${E}`),{..._,stepNumber:E,timestamp:Date.now()}),await T(N(q,`users/${e.uid}/onboarding/progress`),{currentStep:E,completedSteps:Array.from({length:E},(mt,Me)=>Me+1),lastUpdated:Date.now()}),console.log(`Step ${E} saved to Firebase successfully`)}catch(N){console.error(`Error saving step ${E} to Firebase:`,N)}};return j.useEffect(()=>{if(!s.avatar){const _=Ns(s.avatarSeed);i(E=>({...E,avatar:_}))}},[]),d.jsx("div",{className:"min-h-screen bg-gradient-to-br from-slate-900 via-blue-900 to-slate-900 flex items-center justify-center p-4",children:d.jsxs("div",{className:"bg-slate-800/80 backdrop-blur-sm rounded-2xl p-8 max-w-md w-full shadow-2xl border border-slate-700",children:[d.jsx("div",{className:"flex justify-between items-center mb-8 overflow-x-auto",children:[1,2,3,4,5,6,7,8,9,10].map(_=>d.jsxs("div",{className:"flex items-center flex-shrink-0",children:[d.jsx("div",{className:`w-6 h-6 rounded-full flex items-center justify-center text-xs font-bold ${_<=t?"bg-blue-500 text-white":"bg-slate-600 text-gray-400"}`,children:_<t?"✓":_}),_<10&&d.jsx("div",{className:`w-4 h-1 mx-1 ${_<t?"bg-blue-500":"bg-slate-600"}`})]},_))}),t===1&&d.jsxs("div",{className:"text-center",children:[d.jsx("div",{className:"w-20 h-20 bg-gradient-to-br from-blue-400 to-blue-600 rounded-full flex items-center justify-center mx-auto mb-6",children:d.jsx(l8,{className:"w-10 h-10 text-white"})}),d.jsx("h1",{className:"text-2xl font-bold text-white mb-4",children:"Welcome to QuitCard Arena"}),d.jsx("p",{className:"text-gray-300 mb-6",children:"Your journey to freedom starts here. Let's create your hero identity."}),d.jsxs("div",{className:"mb-6",children:[d.jsx("label",{className:"block text-left text-white text-sm font-medium mb-2",children:"What's your hero name?"}),d.jsx("input",{type:"text",value:s.heroName,onChange:_=>{const E={...s,heroName:_.target.value};i(E),_.target.value.trim().length>0&&b(E,1)},placeholder:"e.g., FreedomSeeker, HealthGuardian",className:"w-full px-4 py-3 bg-slate-700 border border-slate-600 rounded-lg text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]})]}),t===2&&d.jsxs("div",{className:"text-center",children:[d.jsx("div",{className:"w-20 h-20 bg-gradient-to-br from-green-400 to-green-600 rounded-full flex items-center justify-center mx-auto mb-6",children:d.jsx(Jd,{className:"w-10 h-10 text-white"})}),d.jsx("h1",{className:"text-2xl font-bold text-white mb-4",children:"Choose Your Archetype"}),d.jsx("p",{className:"text-gray-300 mb-6",children:"Select the warrior type that resonates with your journey."}),d.jsx("div",{className:"space-y-3 mb-6",children:w.map(_=>{const E=_.icon;return d.jsx("button",{onClick:()=>{const N={...s,archetype:_.id};i(N),b(N,2)},className:`w-full p-4 rounded-lg border-2 transition-all duration-300 text-left ${s.archetype===_.id?"border-blue-500 bg-blue-500/20":"border-slate-600 bg-slate-700 hover:border-slate-500"}`,children:d.jsxs("div",{className:"flex items-center gap-3",children:[d.jsx("div",{className:`w-10 h-10 ${_.color} rounded-lg flex items-center justify-center`,children:d.jsx(E,{className:"w-5 h-5 text-white"})}),d.jsxs("div",{children:[d.jsx("h3",{className:"text-white font-semibold",children:_.name}),d.jsx("p",{className:"text-gray-400 text-sm",children:_.description})]})]})},_.id)})})]}),t===3&&d.jsxs("div",{className:"text-center",children:[d.jsx("div",{className:"w-20 h-20 bg-gradient-to-br from-purple-400 to-purple-600 rounded-full flex items-center justify-center mx-auto mb-6",children:d.jsx($D,{className:"w-10 h-10 text-white"})}),d.jsx("h1",{className:"text-2xl font-bold text-white mb-4",children:"Create Your Avatar"}),d.jsx("p",{className:"text-gray-300 mb-6",children:"Choose your battle card identity in the arena."}),d.jsxs("div",{className:"mb-6",children:[d.jsx("div",{className:"w-32 h-32 mx-auto mb-4 rounded-full overflow-hidden border-4 border-slate-600 bg-slate-700",children:s.avatar?d.jsx("img",{src:s.avatar,alt:"Avatar",className:"w-full h-full object-cover",onError:()=>{i(_=>({..._,avatar:Ef(_.avatarSeed)}))}}):d.jsx("div",{className:"w-full h-full flex items-center justify-center",children:d.jsx(If,{className:"w-8 h-8 text-gray-400 animate-spin"})})}),d.jsxs("div",{className:"space-y-3",children:[d.jsxs("div",{className:"mb-4",children:[d.jsx("label",{className:"block text-white text-sm font-medium mb-2",children:"Upload Your Photo"}),d.jsx("input",{type:"file",accept:"image/*",onChange:R,className:"hidden",id:"photo-upload"}),d.jsx("label",{htmlFor:"photo-upload",className:"w-full px-6 py-3 bg-green-600 hover:bg-green-700 text-white rounded-lg transition-colors flex items-center gap-2 justify-center cursor-pointer",children:"📷 Upload Photo"})]}),g&&d.jsx("div",{className:"mb-4",children:d.jsx("button",{onClick:D,disabled:l,className:"w-full px-6 py-3 bg-purple-600 hover:bg-purple-700 disabled:bg-purple-800 text-white rounded-lg transition-colors flex items-center gap-2 justify-center",children:l?d.jsxs(d.Fragment,{children:[d.jsx(If,{className:"w-4 h-4 animate-spin"}),"Converting to Anime..."]}):d.jsx(d.Fragment,{children:"✨ Convert to Anime"})})}),d.jsx("div",{className:"text-gray-400 text-sm",children:"- OR -"}),d.jsx("button",{onClick:V,disabled:o,className:"w-full px-6 py-3 bg-slate-600 hover:bg-slate-500 disabled:bg-slate-700 text-white rounded-lg transition-colors flex items-center gap-2 justify-center",children:o?d.jsxs(d.Fragment,{children:[d.jsx(If,{className:"w-4 h-4 animate-spin"}),"Generate Random Avatar"]}):d.jsxs(d.Fragment,{children:[d.jsx(If,{className:"w-4 h-4"}),"Generate Random Avatar"]})}),d.jsx("button",{onClick:()=>{const _=Ef(s.avatarSeed),E={...s,avatar:_};i(E),b(E,3)},className:"w-full px-6 py-3 bg-blue-600 hover:bg-blue-700 text-white rounded-lg transition-colors",children:"Use Fallback Avatar"})]})]})]}),t===4&&d.jsxs("div",{className:"text-center",children:[d.jsx("div",{className:"w-20 h-20 bg-gradient-to-br from-orange-400 to-orange-600 rounded-full flex items-center justify-center mx-auto mb-6",children:d.jsx("span",{className:"text-2xl",children:"🎯"})}),d.jsx("h1",{className:"text-2xl font-bold text-white mb-4",children:"Trigger Identification"}),d.jsx("p",{className:"text-gray-300 mb-6",children:"What usually makes you want to vape? (Select all that apply)"}),d.jsx("div",{className:"space-y-3 mb-6",children:C.map(_=>d.jsx("button",{onClick:()=>{const E={...s,triggers:s.triggers.includes(_)?s.triggers.filter(N=>N!==_):[...s.triggers,_]};i(E),b(E,4)},className:`w-full p-4 rounded-lg border-2 transition-all duration-300 text-left ${s.triggers.includes(_)?"border-blue-500 bg-blue-500/20":"border-slate-600 bg-slate-700 hover:border-slate-500"}`,children:d.jsxs("div",{className:"flex items-center gap-3",children:[d.jsx("div",{className:`w-6 h-6 rounded border-2 flex items-center justify-center ${s.triggers.includes(_)?"bg-blue-500 border-blue-500":"border-gray-400"}`,children:s.triggers.includes(_)&&d.jsx("span",{className:"text-white text-sm",children:"✓"})}),d.jsx("span",{className:"text-white font-semibold",children:_})]})},_))})]}),t===5&&d.jsxs("div",{className:"text-center",children:[d.jsx("div",{className:"w-20 h-20 bg-gradient-to-br from-indigo-400 to-indigo-600 rounded-full flex items-center justify-center mx-auto mb-6",children:d.jsx("span",{className:"text-2xl",children:"📅"})}),d.jsx("h1",{className:"text-2xl font-bold text-white mb-4",children:"Daily Routine"}),d.jsx("p",{className:"text-gray-300 mb-6",children:"When do you vape most? (Select all that apply)"}),d.jsx("div",{className:"space-y-3 mb-6",children:M.map(_=>d.jsx("button",{onClick:()=>{const E={...s,dailyPatterns:s.dailyPatterns.includes(_)?s.dailyPatterns.filter(N=>N!==_):[...s.dailyPatterns,_]};i(E),b(E,5)},className:`w-full p-4 rounded-lg border-2 transition-all duration-300 text-left ${s.dailyPatterns.includes(_)?"border-blue-500 bg-blue-500/20":"border-slate-600 bg-slate-700 hover:border-slate-500"}`,children:d.jsxs("div",{className:"flex items-center gap-3",children:[d.jsx("div",{className:`w-6 h-6 rounded border-2 flex items-center justify-center ${s.dailyPatterns.includes(_)?"bg-blue-500 border-blue-500":"border-gray-400"}`,children:s.dailyPatterns.includes(_)&&d.jsx("span",{className:"text-white text-sm",children:"✓"})}),d.jsx("span",{className:"text-white font-semibold",children:_})]})},_))})]}),t===6&&d.jsxs("div",{className:"text-center",children:[d.jsx("div",{className:"w-20 h-20 bg-gradient-to-br from-teal-400 to-teal-600 rounded-full flex items-center justify-center mx-auto mb-6",children:d.jsx("span",{className:"text-2xl",children:"🛡️"})}),d.jsx("h1",{className:"text-2xl font-bold text-white mb-4",children:"Coping Experience"}),d.jsx("p",{className:"text-gray-300 mb-6",children:"Have you tried any of these strategies before? (Select all that apply)"}),d.jsx("div",{className:"space-y-3 mb-6",children:A.map(_=>d.jsx("button",{onClick:()=>{const E={...s,copingStrategies:s.copingStrategies.includes(_)?s.copingStrategies.filter(N=>N!==_):[...s.copingStrategies,_]};i(E),b(E,6)},className:`w-full p-4 rounded-lg border-2 transition-all duration-300 text-left ${s.copingStrategies.includes(_)?"border-blue-500 bg-blue-500/20":"border-slate-600 bg-slate-700 hover:border-slate-500"}`,children:d.jsxs("div",{className:"flex items-center gap-3",children:[d.jsx("div",{className:`w-6 h-6 rounded border-2 flex items-center justify-center ${s.copingStrategies.includes(_)?"bg-blue-500 border-blue-500":"border-gray-400"}`,children:s.copingStrategies.includes(_)&&d.jsx("span",{className:"text-white text-sm",children:"✓"})}),d.jsx("span",{className:"text-white font-semibold",children:_})]})},_))})]}),t===7&&d.jsxs("div",{className:"text-center",children:[d.jsx("div",{className:"w-20 h-20 bg-gradient-to-br from-red-400 to-red-600 rounded-full flex items-center justify-center mx-auto mb-6",children:d.jsx("span",{className:"text-2xl",children:"🚬"})}),d.jsx("h1",{className:"text-2xl font-bold text-white mb-4",children:"Vape Usage"}),d.jsx("p",{className:"text-gray-300 mb-6",children:"How many vape pods do you typically use per week?"}),d.jsx("div",{className:"mb-6",children:d.jsxs("select",{value:s.vapePodsPerWeek,onChange:_=>{const E={...s,vapePodsPerWeek:parseFloat(_.target.value)||0};i(E),E.vapePodsPerWeek>0&&b(E,7)},className:"w-full px-4 py-3 bg-slate-700 border border-slate-600 rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-red-500 focus:border-transparent",children:[d.jsx("option",{value:"",children:"Select pods per week"}),d.jsx("option",{value:"0.5",children:"0.5 pods"}),d.jsx("option",{value:"1",children:"1 pod"}),d.jsx("option",{value:"2",children:"2 pods"}),d.jsx("option",{value:"3",children:"3 pods"}),d.jsx("option",{value:"4",children:"4 pods"}),d.jsx("option",{value:"5",children:"5 pods"}),d.jsx("option",{value:"6",children:"6 pods"}),d.jsx("option",{value:"7",children:"7 pods"}),d.jsx("option",{value:"8",children:"8+ pods"})]})})]}),t===8&&d.jsxs("div",{className:"text-center",children:[d.jsx("div",{className:"w-20 h-20 bg-gradient-to-br from-orange-400 to-orange-600 rounded-full flex items-center justify-center mx-auto mb-6",children:d.jsx("span",{className:"text-2xl",children:"⚡"})}),d.jsx("h1",{className:"text-2xl font-bold text-white mb-4",children:"Nicotine Strength"}),d.jsx("p",{className:"text-gray-300 mb-6",children:"What nicotine strength do you typically use?"}),d.jsx("div",{className:"mb-6",children:d.jsxs("select",{value:s.nicotineStrength,onChange:_=>{const E={...s,nicotineStrength:_.target.value};i(E),E.nicotineStrength&&b(E,8)},className:"w-full px-4 py-3 bg-slate-700 border border-slate-600 rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-orange-500 focus:border-transparent",children:[d.jsx("option",{value:"",children:"Select nicotine strength"}),d.jsx("option",{value:"3mg",children:"3mg"}),d.jsx("option",{value:"6mg",children:"6mg"}),d.jsx("option",{value:"12mg",children:"12mg"}),d.jsx("option",{value:"18mg",children:"18mg"}),d.jsx("option",{value:"20mg",children:"20mg"}),d.jsx("option",{value:"50mg",children:"50mg"})]})})]}),t===9&&d.jsxs("div",{className:"text-center",children:[d.jsx("div",{className:"w-20 h-20 bg-gradient-to-br from-blue-400 to-blue-600 rounded-full flex items-center justify-center mx-auto mb-6",children:d.jsx("span",{className:"text-2xl",children:"📚"})}),d.jsx("h1",{className:"text-2xl font-bold text-white mb-4",children:"Previous Attempts"}),d.jsx("p",{className:"text-gray-300 mb-6",children:"How many times have you tried to quit before?"}),d.jsx("div",{className:"mb-6",children:d.jsxs("select",{value:s.quitAttempts,onChange:_=>{const E={...s,quitAttempts:_.target.value};i(E),E.quitAttempts&&b(E,9)},className:"w-full px-4 py-3 bg-slate-700 border border-slate-600 rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[d.jsx("option",{value:"",children:"Select option"}),d.jsx("option",{value:"first",children:"This is my first attempt"}),d.jsx("option",{value:"1",children:"Once before"}),d.jsx("option",{value:"2",children:"Twice before"}),d.jsx("option",{value:"3",children:"3-5 times"}),d.jsx("option",{value:"5",children:"More than 5 times"})]})})]}),t===10&&d.jsxs("div",{className:"text-center",children:[d.jsx("div",{className:"w-20 h-20 bg-gradient-to-br from-green-400 to-green-600 rounded-full flex items-center justify-center mx-auto mb-6",children:d.jsx("span",{className:"text-2xl",children:"🎯"})}),d.jsx("h1",{className:"text-2xl font-bold text-white mb-4",children:"Confidence Level"}),d.jsx("p",{className:"text-gray-300 mb-6",children:"How confident are you this time? (1-10 scale)"}),d.jsxs("div",{className:"mb-6",children:[d.jsxs("div",{className:"flex items-center gap-4",children:[d.jsx("span",{className:"text-gray-400 text-sm",children:"1"}),d.jsx("input",{type:"range",min:"1",max:"10",value:s.confidence,onChange:_=>{const E={...s,confidence:parseInt(_.target.value)};i(E),b(E,10)},className:"flex-1 h-2 rounded-lg appearance-none cursor-pointer slider",style:{background:`linear-gradient(to right, ${Sf(s.confidence)} 0%, ${Sf(s.confidence)} ${s.confidence/10*100}%, #475569 ${s.confidence/10*100}%, #475569 100%)`}}),d.jsx("span",{className:"text-gray-400 text-sm",children:"10"})]}),d.jsxs("div",{className:"text-center mt-4",children:[d.jsx("span",{className:"font-bold text-4xl",style:{color:Sf(s.confidence)},children:s.confidence}),d.jsx("span",{className:"text-gray-400 text-lg ml-2",children:"/ 10"})]}),d.jsx("div",{className:"text-center mt-2",children:d.jsx("span",{className:"text-sm font-medium",style:{color:Sf(s.confidence)},children:s.confidence<=3?"You can do this! 💪":s.confidence<=6?"Good confidence! 🎯":s.confidence<=9?"Great confidence! 🚀":"Excellent confidence! 🌟"})})]})]}),d.jsxs("div",{className:"flex justify-between",children:[t>1&&d.jsx("button",{onClick:S,className:"px-6 py-3 bg-slate-600 hover:bg-slate-500 text-white rounded-lg transition-colors",children:"Back"}),d.jsxs("button",{onClick:P,disabled:!v(),className:`ml-auto px-6 py-3 rounded-lg transition-colors flex items-center gap-2 ${v()?"bg-blue-600 hover:bg-blue-700 text-white":"bg-slate-700 text-gray-400 cursor-not-allowed"}`,children:[t===10?"Start Journey":"Next",d.jsx(i8,{className:"w-4 h-4"})]})]})]})})},Rb={DETERMINED:{name:"The Determined",color:"bg-red-500",icon:Jd},SOCIAL_FIGHTER:{name:"The Social Fighter",color:"bg-blue-500",icon:BD},HEALTH_WARRIOR:{name:"The Health Warrior",color:"bg-green-500",icon:VD},MONEY_SAVER:{name:"The Money Saver",color:"bg-yellow-500",icon:OD}},g8={COMMON:{name:"Common",color:"border-gray-400",glow:"",days:0},UNCOMMON:{name:"Uncommon",color:"border-gray-300",glow:"shadow-lg",days:7},RARE:{name:"Rare",color:"border-yellow-400",glow:"shadow-yellow-400/50 shadow-lg",days:14},EPIC:{name:"Epic",color:"border-purple-400",glow:"shadow-purple-400/50 shadow-xl",days:30},LEGENDARY:{name:"Legendary",color:"border-orange-400",glow:"shadow-orange-400/50 shadow-2xl animate-pulse",days:90}},Nb={WEEK_WARRIOR:{name:"Week Warrior",icon:LD,description:"7 days clean"},MONTH_MASTER:{name:"Month Master",icon:UD,description:"30 days clean"},LEGEND:{name:"Legend",icon:jD,description:"90 days clean"}},p8=n=>n>=90?"LEGENDARY":n>=30?"EPIC":n>=14?"RARE":n>=7?"UNCOMMON":"COMMON",m8=({isOpen:n,onClose:e,statType:t})=>{if(!n)return null;const s={addiction:{title:"Addiction",description:"Your body's dependence level - decreases with clean time, increases with relapses",impacts:["What decreases it:","• Clean time: -2 points per week","","What increases it:","• First relapse (after clean period): +4 points","• Second relapse (within 7 days): +6 additional points","• Third relapse and on (within 3 days): +8 additional points","","Note: Escalation level resets after 7 clean days"]},mentalStrength:{title:"Mental Strength",description:"Your ability to resist urges and stay strong",impacts:["What increases it:","• Successful craving resistance: +1 point","• Using app during cravings every 3 times with no relapse: +1 point","• Completing breathing exercises 3 days straight: +1 point","• Staying hydrated for 3 days straight: +1 point","• Milestone bonuses: First 7 days +5 points, 30 days +10 points, 90 days +15 points","","What decreases it:","• Giving in to cravings: -3 points","• Each relapse: -3 points"]},motivation:{title:"Motivation",description:"Your drive to quit - boosted by staying engaged",impacts:["What increases it:","• Regular logging (3+ days per week): +2 points (weekly)","• Sharing achievements: +3 points per share (weekly)","","What decreases it:","• Long periods inactive (7+ days no logging): -3 points"]},triggerDefense:{title:"Trigger Defense",description:"Protection against your personal vaping triggers",impacts:["What increases it:","• Surviving trigger situations without vaping: +3 points","• Pre-planning for known triggers: +1 point","• Updating your trigger list: +1 point","","What decreases it:","• Relapsing to known triggers: -3 points","• Entering trigger situations unprepared: -1 point"]}}[t];return s?d.jsx("div",{className:"fixed inset-0 bg-black/80 backdrop-blur-sm flex items-center justify-center z-50 p-4",children:d.jsxs("div",{className:"bg-slate-800 rounded-2xl p-6 max-w-md w-full shadow-2xl border border-slate-700",children:[d.jsxs("div",{className:"text-center mb-4",children:[d.jsx("h3",{className:"text-xl font-bold text-white mb-2",children:s.title}),d.jsx("p",{className:"text-gray-300 text-sm",children:s.description})]}),d.jsxs("div",{className:"mb-6",children:[d.jsx("h4",{className:"text-white font-semibold mb-3 text-left",children:"What impacts it:"}),d.jsx("ul",{className:"space-y-2 text-left",children:s.impacts.map((i,o)=>d.jsxs("li",{className:"text-gray-300 text-sm flex items-start",children:[d.jsx("span",{className:"text-blue-400 mr-2",children:"•"}),i]},o))})]}),d.jsx("button",{onClick:e,className:"w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 rounded-lg transition-all duration-300",children:"Got it"})]})}):null},Tf=({label:n,value:e,max:t,color:r,statType:s,onInfoClick:i})=>{const o=Math.min(e,t);return d.jsxs("div",{className:"mb-1 sm:mb-2",children:[d.jsxs("div",{className:"flex justify-between text-white text-xs mb-1",children:[d.jsxs("div",{className:"flex items-center gap-1",children:[d.jsx("span",{className:"text-xs sm:text-xs",children:n}),s&&i&&d.jsx("button",{onClick:()=>i(s),className:"w-3 h-3 sm:w-4 sm:h-4 bg-blue-600 hover:bg-blue-700 rounded-full flex items-center justify-center text-white text-xs font-bold transition-colors",title:`Learn about ${n}`,children:"i"})]}),d.jsxs("span",{className:"text-xs",children:[o,"/",t]})]}),d.jsx("div",{className:"w-full bg-gray-700 rounded-full h-1.5 sm:h-2",children:d.jsx("div",{className:`${r} h-1.5 sm:h-2 rounded-full transition-all duration-500`,style:{width:`${o/t*100}%`}})})]})},kb=({user:n,isNemesis:e=!1,showComparison:t=!1,nemesisUser:r=null,onInfoClick:s})=>{const[i,o]=j.useState(!1),[a,l]=j.useState(null),[u,h]=j.useState([]),[f,g]=j.useState({});if(j.useEffect(()=>{let P=!1;return(async()=>{try{if(console.log("🔄 TradingCard: Loading Special Features for user:",n==null?void 0:n.heroName,"uid:",n==null?void 0:n.uid),console.log("🔄 TradingCard: User has specialFeatures:",!!(n!=null&&n.specialFeatures)),console.log("🔄 TradingCard: User has triggers:",n==null?void 0:n.triggers),console.log("🔄 TradingCard: User has dailyPatterns:",n==null?void 0:n.dailyPatterns),console.log("🔄 TradingCard: User has copingStrategies:",n==null?void 0:n.copingStrategies),n&&n.uid)if(n.specialFeatures)console.log("✅ TradingCard: Using pre-loaded Special Features"),P||(Array.isArray(n.specialFeatures)?(h(n.specialFeatures),g({})):n.specialFeatures&&n.specialFeatures.features?(h(n.specialFeatures.features),g(n.specialFeatures.categories||{})):(h([]),g({})));else{console.log("🔄 TradingCard: Generating new Special Features");const v=await M(n);console.log("✅ TradingCard: Generated features:",v),P||(Array.isArray(v)?(h(v),g({})):v&&v.features?(h(v.features),g(v.categories||{})):(h([]),g({})))}else console.log("⚠️ TradingCard: No user or uid, setting empty features"),P||(h([]),g({}))}catch(v){console.error("❌ TradingCard: Error loading Special Features:",v),P||(h([]),g({}))}})(),()=>{P=!0}},[n==null?void 0:n.uid,n==null?void 0:n.specialFeatures,n==null?void 0:n.triggers,n==null?void 0:n.dailyPatterns,n==null?void 0:n.copingStrategies]),n.isEmpty)return d.jsx("div",{className:"w-80 h-[520px] bg-slate-800 rounded-xl border-2 border-slate-600 p-4 text-white text-center mx-auto flex items-center justify-center",children:d.jsxs("div",{className:"text-center",children:[d.jsx("div",{className:"w-24 h-24 bg-slate-700 rounded-full flex items-center justify-center mx-auto mb-4",children:d.jsx("span",{className:"text-4xl text-slate-400",children:"🔍"})}),d.jsx("h3",{className:"text-slate-300 text-lg font-semibold mb-2",children:"Looking for a buddy"}),d.jsx("p",{className:"text-slate-400 text-sm leading-relaxed",children:"We'll find you a match soon"})]})});if(!n||!n.archetype||!n.stats)return d.jsx("div",{className:"w-80 h-[520px] bg-slate-800 rounded-xl border-2 border-gray-400 p-4 text-white text-center mx-auto flex items-center justify-center",children:d.jsx("div",{className:"animate-pulse",children:"Loading Card..."})});const y=Rb[n.archetype];if(!y)return console.error("Invalid archetype:",n.archetype,"Available:",Object.keys(Rb)),d.jsx("div",{className:"w-80 h-[520px] bg-slate-800 rounded-xl border-2 border-red-400 p-4 text-white text-center mx-auto flex items-center justify-center",children:d.jsxs("div",{children:[d.jsx("h3",{className:"text-red-400 mb-2",children:"Invalid Archetype"}),d.jsx("p",{className:"text-gray-300 text-sm",children:n.archetype})]})});const w=g8[p8(n.stats.streakDays)],C=y.icon;async function M(P){if(P!=null&&P.isRealBuddy){console.log("🔄 TradingCard: Loading centralized Special Features for buddy:",P.heroName);try{const{ref:T,get:K}=await be(()=>import("./index.esm-eba9a326.js"),[]),mt=T(q,`users/${P.uid}/stats`),Me=await K(mt);if(Me.exists()){const $=Me.val();if($.specialFeatures&&Array.isArray($.specialFeatures))return console.log("✅ TradingCard: Using centralized Special Features for buddy:",$.specialFeatures),$.specialFeatures}const qt=T(q,`users/${P.uid}/specialFeatures`),k=await K(qt);if(k.exists()){const $=k.val();return console.log("✅ TradingCard: Using legacy Special Features for buddy:",$),$}}catch(T){console.warn("⚠️ TradingCard: Could not load centralized Special Features for buddy:",T.message)}return console.log("🔄 TradingCard: Generating placeholder features for buddy:",P.heroName),["Freedom Chaser","Nicotine Fighter","Health Seeker","Willpower Warrior"]}let S=null;if(P.uid)try{const{ref:T,get:K}=await be(()=>import("./index.esm-eba9a326.js"),[]),mt=T(q,`users/${P.uid}/specialFeatures`),Me=await K(mt);Me.exists()&&(S=Me.val())}catch(T){console.error("Error fetching special features from Firebase:",T)}if(!S){const T=`specialFeatures_${P.heroName||P.id||"default"}`,K=localStorage.getItem(T);K&&(S=JSON.parse(K))}if(S){if(Array.isArray(S))return S;if(S&&S.features)return S}const v=[],b={};for(P.triggers&&P.triggers.length>0&&P.triggers.forEach(T=>{let K="";switch(T){case"Stress/anxiety":K="Stress Vaper";break;case"Social situations":K="Social Vaper";break;case"Boredom":K="Boredom Fighter";break;case"After meals":K="Habit Former";break;case"Drinking alcohol":K="Party Animal";break;case"Work breaks":K="Work Breaker";break;case"Driving":K="Driving Vaper";break;default:K="Trigger Aware"}K&&!v.includes(K)&&(v.push(K),b[K]="triggers")}),P.dailyPatterns&&P.dailyPatterns.length>0&&P.dailyPatterns.forEach(T=>{let K="";switch(T){case"Morning routine":K="Morning Struggler";break;case"Evening wind-down":K="Night Owl";break;case"Throughout the day":K="All-Day Warrior";break;default:K="Routine Builder"}K&&!v.includes(K)&&(v.push(K),b[K]="dailyPatterns")}),P.copingStrategies&&P.copingStrategies.length>0&&(P.copingStrategies.includes("Nothing - this is new to me")?(v.push("First Timer"),b["First Timer"]="copingStrategies"):P.copingStrategies.length>2?(v.push("Veteran Quitter"),b["Veteran Quitter"]="copingStrategies"):(v.push("Cold Turkey"),b["Cold Turkey"]="copingStrategies"));v.length<4;){const T=[{name:"Nicotine Fighter",category:"copingStrategies"},{name:"Health Seeker",category:"copingStrategies"},{name:"Freedom Chaser",category:"copingStrategies"},{name:"Willpower Warrior",category:"copingStrategies"}],K=T[Math.floor(Math.random()*T.length)];v.includes(K.name)||(v.push(K.name),b[K.name]=K.category)}const _=v.slice(0,4),E={};_.forEach(T=>{E[T]=b[T]||"copingStrategies"});const N={features:_,categories:E};if(P.uid)try{const{ref:T,set:K}=await be(()=>import("./index.esm-eba9a326.js"),[]),mt=T(q,`users/${P.uid}/specialFeatures`);await K(mt,N),console.log("Special features with categories saved to Firebase successfully")}catch(T){console.error("Error saving special features to Firebase:",T);const K=`specialFeatures_${P.heroName||P.id||"default"}`;localStorage.setItem(K,JSON.stringify(N))}else{const T=`specialFeatures_${P.heroName||P.id||"default"}`;localStorage.setItem(T,JSON.stringify(_))}return _}const A=n.stats.addictionLevel||50,I=n.stats.mentalStrength||50,R=n.stats.motivation||50,D=n.stats.triggerDefense||30;n.stats.nemesisVictories||(Math.floor(Math.random()*8)+1,Math.floor(Math.random()*5)+1);const V=P=>{l(P),o(!0)};return d.jsxs(d.Fragment,{children:[d.jsxs("div",{className:`relative w-72 sm:w-80 h-[480px] sm:h-[520px] rounded-xl ${w.color} border-4 ${w.glow} bg-gradient-to-br from-slate-800 to-slate-900 p-3 sm:p-4 transform transition-all duration-300 hover:scale-105 mx-auto overflow-hidden`,children:[d.jsxs("div",{className:"text-center mb-3",children:[d.jsx("h3",{className:"text-white font-bold text-sm sm:text-lg leading-tight break-words px-1",children:n.heroName}),d.jsx("p",{className:"text-gray-300 text-xs sm:text-base",children:y.name})]}),d.jsx("div",{className:"w-20 h-20 sm:w-24 sm:h-24 mx-auto mb-3 sm:mb-4 rounded-full overflow-hidden bg-slate-700 flex items-center justify-center ring-2 ring-blue-400/50",children:n.avatar?d.jsx("img",{src:n.avatar,alt:"Avatar",className:"w-full h-full object-cover",onError:()=>{console.log("Avatar failed to load, using fallback")}}):d.jsx("div",{className:`w-full h-full ${y.color} flex items-center justify-center`,children:d.jsx(C,{className:"w-12 h-12 text-white"})})}),d.jsxs("div",{className:"space-y-1 sm:space-y-2 mb-3 sm:mb-4",children:[d.jsx(Tf,{label:"Addiction",value:A,max:100,color:"bg-red-500",statType:e?null:"addiction",onInfoClick:e?null:V}),d.jsx(Tf,{label:"Mental Strength",value:I,max:100,color:"bg-blue-500",statType:e?null:"mentalStrength",onInfoClick:e?null:V}),d.jsx(Tf,{label:"Motivation",value:R,max:100,color:"bg-green-500",statType:e?null:"motivation",onInfoClick:e?null:V}),d.jsx(Tf,{label:"Trigger Defense",value:D,max:100,color:"bg-orange-500",statType:e?null:"triggerDefense",onInfoClick:e?null:V})]}),d.jsxs("div",{className:"mb-4",children:[d.jsx("h4",{className:"text-white text-xs font-semibold mb-2 text-center",children:"Special Features"}),d.jsx("div",{className:"flex flex-wrap gap-1 justify-center",children:u.map((P,S)=>{const v=f[P]||"copingStrategies",b=_=>{switch(_){case"triggers":return"bg-yellow-500/80";case"dailyPatterns":return"bg-orange-500/80";case"copingStrategies":default:return"bg-blue-600/80"}};return d.jsx("div",{className:`px-2 py-1 ${b(v)} text-white text-xs rounded-full font-medium`,title:`${P} (${v})`,children:P},S)})})]}),d.jsxs("div",{className:"bg-black/30 rounded-lg p-2 sm:p-3 space-y-1 sm:space-y-2 mb-2 sm:mb-3 backdrop-blur-sm",children:[d.jsxs("div",{className:"flex justify-between text-white text-xs sm:text-sm",children:[d.jsx("span",{className:"text-gray-300",children:"Streak:"}),d.jsxs("span",{className:"font-bold text-green-400 flex items-center gap-1",children:[(()=>{if(n.stats.streakDisplayText)return n.stats.streakDisplayText;const P=n.stats.streakDays;return`${P} day${P===1?"":"s"}`})(),n.stats.streakDays>0&&d.jsx("span",{className:"text-xs",children:"🔥"})]})]}),d.jsxs("div",{className:"flex justify-between text-white text-xs sm:text-sm",children:[d.jsx("span",{className:"text-gray-300",children:"Cravings Resisted:"}),d.jsxs("span",{className:"font-bold text-blue-400 flex items-center gap-1",children:[(()=>n.stats.cravingsResisted||0)(),d.jsx("span",{className:"text-xs",children:"💪"})]})]})]}),n.achievements&&n.achievements.length>0&&d.jsxs("div",{className:"flex flex-wrap gap-1 justify-center",children:[n.achievements.slice(0,4).map((P,S)=>{var b,_;const v=((b=Nb[P])==null?void 0:b.icon)||jD;return d.jsx("div",{className:"w-5 h-5 sm:w-6 sm:h-6 bg-yellow-500 rounded-full flex items-center justify-center shadow-lg",title:(_=Nb[P])==null?void 0:_.description,children:d.jsx(v,{className:"w-2.5 h-2.5 sm:w-3 sm:h-3 text-white"})},S)}),n.achievements.length>4&&d.jsxs("div",{className:"w-5 h-5 sm:w-6 sm:h-6 bg-gray-500 rounded-full flex items-center justify-center text-white text-xs font-bold",children:["+",n.achievements.length-4]})]})]}),d.jsx(m8,{isOpen:i,onClose:()=>o(!1),statType:a})]})},y8=({activeTab:n,onTabChange:e,dataLoadingState:t,onRefreshData:r,offlineManager:s})=>{const i=[{id:"arena",label:"Arena",icon:a8},{id:"craving-support",label:"Craving Support",icon:Jd},{id:"profile",label:"Profile",icon:$D},{id:"settings",label:"Explore",icon:FD}];return d.jsx(d.Fragment,{children:d.jsx("div",{className:"fixed bottom-0 left-0 right-0 bg-slate-800 border-t border-slate-700 px-4 py-2 z-40",children:d.jsx("div",{className:"flex justify-around max-w-md mx-auto",children:i.map(o=>{const a=o.icon,l=n===o.id;return d.jsxs("button",{onClick:()=>e(o.id),className:`flex flex-col items-center transition-colors ${l?"text-blue-400":"text-gray-400 hover:text-blue-300"}`,children:[d.jsx(a,{className:"w-5 h-5"}),d.jsx("span",{className:"text-xs",children:o.label})]},o.id)})})})})},_8=({user:n,userStats:e,nemesis:t,onBackToLogin:r,onResetForTesting:s,buddyLoading:i,buddyError:o,realBuddy:a,loadRealBuddy:l,buddyLoadAttempted:u})=>{if(!n)return console.warn("ArenaView: user prop is undefined"),d.jsx("div",{className:"min-h-screen bg-gradient-to-br from-slate-900 via-blue-900 to-slate-900 py-8 pb-20",children:d.jsx("div",{className:"max-w-7xl mx-auto px-4",children:d.jsxs("div",{className:"text-center text-white",children:[d.jsx("h1",{className:"text-2xl font-bold mb-4",children:"Loading User Data..."}),d.jsx("p",{children:"Please wait while we load your profile information."})]})})});if(!t)return console.warn("ArenaView: nemesis prop is undefined"),d.jsx("div",{className:"min-h-screen bg-gradient-to-br from-slate-900 via-blue-900 to-slate-900 py-8 pb-20",children:d.jsx("div",{className:"max-w-7xl mx-auto px-4",children:d.jsxs("div",{className:"text-center text-white",children:[d.jsx("h1",{className:"text-2xl font-bold mb-4",children:"Loading Nemesis Data..."}),d.jsx("p",{children:"Please wait while we load your nemesis information."})]})})});const[h,f]=j.useState(!1),[g,y]=j.useState(null),[w,C]=j.useState(null);j.useEffect(()=>{const k=()=>{const $=document.querySelector(".battle-cards-container");$&&(window.innerWidth<1024?($.style.flexDirection="column",$.style.gap="1rem"):($.style.flexDirection="row",$.style.gap="3rem"))};return k(),window.addEventListener("resize",k),()=>window.removeEventListener("resize",k)},[]),j.useEffect(()=>{w&&n&&(async()=>{if(w&&n)try{console.log("🔄 App: Refreshing stats on page load for user:",n.uid),await w.refreshAllStats(),console.log("✅ App: Stats refreshed on page load")}catch($){console.error("❌ App: Error refreshing stats on page load:",$)}})()},[w,n]);const M=async()=>{g&&await g.handleAchievementShare()},A=async k=>{if((k==null?void 0:k.uid)==="uGZGbLUytbfu8W3mQPW0YAvXTQn1"&&(!k.quitDate||new Date(k.quitDate)>new Date("2025-09-19")))if(console.log("🔧 TEMPORARY FIX: Restoring correct quit date for User 3 in calculateRealTimeStats (created 18/09)"),k.lastRelapseDate){const Q=new Date(k.lastRelapseDate),ee=new Date("2025-09-18T13:56:46.584Z");k.quitDate=Q>ee?k.lastRelapseDate:"2025-09-18T13:56:46.584Z",console.log(`🔧 TEMPORARY FIX: User 3 quit date set to ${k.quitDate} (considering relapse: ${k.lastRelapseDate})`)}else k.quitDate="2025-09-18T13:56:46.584Z";if((k==null?void 0:k.uid)==="AmwwlNyHD5T3WthUbyR6bFL0QkF2"&&(!k.quitDate||new Date(k.quitDate)>new Date("2025-09-19")))if(console.log("🔧 TEMPORARY FIX: Restoring correct quit date for User 2 in calculateRealTimeStats (created 18/09)"),k.lastRelapseDate){const Q=new Date(k.lastRelapseDate),ee=new Date("2025-09-18T13:56:46.584Z");k.quitDate=Q>ee?k.lastRelapseDate:"2025-09-18T13:56:46.584Z",console.log(`🔧 TEMPORARY FIX: User 2 quit date set to ${k.quitDate} (considering relapse: ${k.lastRelapseDate})`)}else k.quitDate="2025-09-18T13:56:46.584Z";let $={addictionLevel:50,mentalStrength:50,motivation:50,triggerDefense:30,experiencePoints:0,streakDays:0,cravingsResisted:0};if(k!=null&&k.isRealBuddy){if(k.stats&&Object.assign($,k.stats),k.quitDate){const Q=new Date(k.quitDate),ee=pl(Q);$.streakDays=ee.value,$.streakUnit=ee.unit,$.streakDisplayText=ee.displayText}try{const{ref:Q,get:ee}=await be(()=>import("./index.esm-eba9a326.js"),[]),ie=Q(q,`users/${k.uid}/cravings`),le=await ee(ie);let ce=0;le.exists()&&(le.forEach(Ae=>{Ae.val().outcome==="resisted"&&ce++}),$.cravingsResisted=ce,console.log("🔄 Arena: Got buddy cravings resisted:",ce))}catch{console.log("⚠️ Arena: Could not read buddy cravings, using default"),$.cravingsResisted=0}return $}if(!(k!=null&&k.uid)){const Q=localStorage.getItem("quitCoachRelapseDate");if(Q){const le=new Date(Q),Ae=new Date().getTime()-le.getTime(),$e=Math.floor(Ae/(1e3*3600*24));$.streakDays=$e,$.streakUnit="days",$.streakDisplayText=`${$e} day${$e===1?"":"s"}`}else{const le=k.quitDate?new Date(k.quitDate):new Date,ce=pl(le);$.streakDays=ce.value,$.streakUnit=ce.unit,$.streakDisplayText=ce.displayText}const ee=parseInt(localStorage.getItem("cravingWins")||0);$.cravingsResisted=ee,new Date().toDateString();let ie=0;for(let le=0;le<7;le++){const ce=new Date;ce.setDate(ce.getDate()-le);const Ae=ce.toDateString(),$e=localStorage.getItem(`water_${k.uid}_${Ae}`);if($e&&parseInt($e)>0)ie++;else break}return ie>=3&&($.mentalStrength=Math.min(80,($.mentalStrength||50)+1)),$}try{const{ref:Q,get:ee}=await be(()=>import("./index.esm-eba9a326.js"),[]),ie=Q(q,`users/${k.uid}/cravings`);try{const xe=await ee(ie);let te=0,de=0;if(xe.exists()){const ve=xe.val();xe.forEach(He=>{const oe=He.val();oe.outcome==="resisted"?te++:oe.outcome==="relapsed"&&de++})}$.cravingsResisted=te;const Ee=Q(q,`users/${k.uid}/profile/cravingsResisted`),H=await ee(Ee);if(H.exists()){const ve=H.val();console.log(`🔍 Arena: Profile cravingsResisted field value: ${ve}`),$.cravingsResisted=Math.max(te,ve)}}catch{console.log("Could not query cravings for Arena stats, using fallback");const te=Q(q,`users/${k.uid}/profile/cravingsResisted`),de=await ee(te);$.cravingsResisted=de.exists()?de.val():0}let le=0;const ce=Q(q,`users/${k.uid}/profile/relapseDate`),Ae=await ee(ce);if(Ae.exists()){const xe=Ae.val(),te=new Date(xe),Ee=new Date().getTime()-te.getTime();le=Math.floor(Ee/(1e3*3600*24))}else{const xe=k.quitDate?new Date(k.quitDate):new Date,te=pl(xe);le=te.value,$.streakUnit=te.unit,$.streakDisplayText=te.displayText,console.log(`🔍 Arena: Calculated streak from quit date: ${te.displayText} (quit: ${xe.toISOString()})`),console.log(`🔍 Arena: Setting streak fields - streakDays: ${le}, streakUnit: ${$.streakUnit}, streakDisplayText: ${$.streakDisplayText}`)}$.streakDays=le;let $e=0;for(let xe=0;xe<7;xe++){const te=new Date;te.setDate(te.getDate()-xe);const de=te.toDateString(),Ee=Q(q,`users/${k.uid}/profile/daily/${de}/water`),H=await ee(Ee);if(H.exists()&&H.val()>0)$e++;else break}$e>=3&&($.mentalStrength=Math.min(80,($.mentalStrength||50)+1))}catch(Q){console.error("Error fetching profile data from Firebase:",Q);const ee=localStorage.getItem("quitCoachRelapseDate");if(ee){const ce=new Date(ee),$e=new Date().getTime()-ce.getTime(),xe=Math.floor($e/(1e3*3600*24));$.streakDays=xe,$.streakUnit="days",$.streakDisplayText=`${xe} day${xe===1?"":"s"}`}else{const ce=k.quitDate?new Date(k.quitDate):new Date,Ae=pl(ce);$.streakDays=Ae.value,$.streakUnit=Ae.unit,$.streakDisplayText=Ae.displayText}const ie=parseInt(localStorage.getItem("cravingWins")||0);$.cravingsResisted=ie,new Date().toDateString();let le=0;for(let ce=0;ce<7;ce++){const Ae=new Date;Ae.setDate(Ae.getDate()-ce);const $e=Ae.toDateString(),xe=localStorage.getItem(`water_${k.uid}_${$e}`);if(xe&&parseInt(xe)>0)le++;else break}le>=3&&($.mentalStrength=Math.min(80,($.mentalStrength||50)+1))}if(k!=null&&k.uid&&!(k!=null&&k.isRealBuddy))try{const{ref:Q,get:ee}=await be(()=>import("./index.esm-eba9a326.js"),[]),ie=Date.now();await new Promise(ce=>setTimeout(ce,800));const le=await ee(Q(q,`users/${k.uid}/stats`));if(le.exists()){const ce=le.val();Object.assign($,ce)}else Object.assign($,k.stats),console.log("🔄 Arena: Using user.stats as fallback:",$);if(g){await g.updateAddictionFromCleanTime();const ce=await ee(Q(q,`users/${k.uid}/stats`));if(ce.exists()){const Ae=ce.val();if(Object.assign($,Ae),k.uid==="uGZGbLUytbfu8W3mQPW0YAvXTQn1"||k.uid==="AmwwlNyHD5T3WthUbyR6bFL0QkF2")return console.log(`🔄 Arena: Using Firebase stats directly for ${k.uid} - no client-side calculation`),$}}}catch(Q){console.error("Error reading/updating stats from Firebase:",Q),Object.assign($,k.stats)}return $},[I,R]=j.useState(()=>{const k={mentalStrength:50,motivation:50,triggerDefense:30,addictionLevel:50,cravingsResisted:0,streakDays:0};return n!=null&&n.stats?{...k,...n.stats}:k}),[D,V]=j.useState(()=>{const k={mentalStrength:50,motivation:50,triggerDefense:30,addictionLevel:50,cravingsResisted:0,streakDays:0};return console.log("🔄 Arena: Initializing realTimeNemesisStats with default stats:",k),k});j.useEffect(()=>{if(!(n!=null&&n.uid))return;let k=!0;return(async()=>{await(async()=>{if(k)try{const ie=new Lm(q,n.uid);await ie.initialize(),k&&y(ie)}catch(ie){console.error("Error initializing StatManager:",ie)}})(),await(async()=>{if(k){if(n&&k){const ie=await A(n);k&&R(ie)}t&&t.uid&&k&&console.log(`🔄 Arena: Skipping initial calculation for buddy ${t.uid} - will use centralized Firebase stats`)}})()})(),()=>{k=!1}},[n==null?void 0:n.uid,t==null?void 0:t.uid]),j.useEffect(()=>{if(!(t!=null&&t.uid)||!(t!=null&&t.isRealBuddy))return;if(t.uid==="uGZGbLUytbfu8W3mQPW0YAvXTQn1"||t.uid==="AmwwlNyHD5T3WthUbyR6bFL0QkF2"){console.log(`🚫 Arena: SKIPPING real-time listener for centralized buddy ${t.uid}`);return}let k=!0;console.log("🔄 Arena: Setting up real-time listener for buddy stats:",t.heroName);const Q=(async()=>{try{const{ref:ee,onValue:ie}=await be(()=>import("./index.esm-eba9a326.js"),[]),le=ee(q,`users/${t.uid}/stats`),ce=ie(le,xe=>{if(k&&xe.exists()){const te=xe.val();console.log("🔄 Arena: Buddy stats updated in real-time:",te),console.log("🔍 Arena: Buddy streak display info - streakDays:",te.streakDays,"streakUnit:",te.streakUnit,"streakDisplayText:",te.streakDisplayText);const de=(t==null?void 0:t.uid)||(a==null?void 0:a.uid);if(de==="uGZGbLUytbfu8W3mQPW0YAvXTQn1"||de==="AmwwlNyHD5T3WthUbyR6bFL0QkF2")console.log(`🔄 Arena: Using centralized stats for buddy ${de} - no local calculation needed`),console.log("🔄 Arena: Centralized buddy streak:",te.streakDisplayText);else{let H=(t==null?void 0:t.quitDate)||(a==null?void 0:a.quitDate);if(console.log("🔍 Arena: Checking if buddy needs streak calculation - hasDisplayText:",!!te.streakDisplayText,"buddyQuitDate:",H),!te.streakDisplayText&&H){const ve=new Date(H),He=pl(ve);te.streakDays=He.value,te.streakUnit=He.unit,te.streakDisplayText=He.displayText,console.log("🔄 Arena: Applied streak calculation to buddy stats:",He.displayText)}else te.streakDisplayText||(console.log("⚠️ Arena: Cannot calculate buddy streak - no quit date available"),te.streakUnit="days",te.streakDisplayText=`${te.streakDays||0} day${te.streakDays===1?"":"s"}`,console.log("🔄 Arena: Set default buddy streak display:",te.streakDisplayText))}const Ee=(t==null?void 0:t.uid)||(a==null?void 0:a.uid);Ee==="uGZGbLUytbfu8W3mQPW0YAvXTQn1"||Ee==="AmwwlNyHD5T3WthUbyR6bFL0QkF2"?(console.log(`🔄 Arena: Updating centralized buddy stats for ${Ee} - preserving streakDisplayText`),V(H=>({...H,...te,streakDisplayText:te.streakDisplayText,streakDays:te.streakDays,streakUnit:te.streakUnit}))):V(H=>{const ve=H.streakDisplayText?{streakDisplayText:H.streakDisplayText,streakDays:H.streakDays,streakUnit:H.streakUnit}:{};return console.log("🔄 Arena: Preserving locally calculated buddy streak:",ve),{...H,...te,...ve}})}},xe=>{xe.code!=="PERMISSION_DENIED"&&console.error("Error listening to buddy stats:",xe)}),Ae=ee(q,`users/${t.uid}/profile`),$e=ie(Ae,async xe=>{if(k&&xe.exists()){const te=xe.val();console.log("🔄 Arena: Buddy profile updated, recalculating stats..."),console.log("🔄 Arena: Preserving pre-loaded buddy stats during profile update...");const de=(t==null?void 0:t.uid)||(a==null?void 0:a.uid);if(de==="uGZGbLUytbfu8W3mQPW0YAvXTQn1"||de==="AmwwlNyHD5T3WthUbyR6bFL0QkF2")console.log(`🔄 Arena: Profile change for centralized buddy ${de} - keeping centralized stats intact`);else if(D&&D.addictionLevel!==50){let Ee={...D};if(te.quitDate&&te.quitDate!==t.quitDate){const H=new Date(te.quitDate),ve=pl(H);Ee.streakDays=ve.value,Ee.streakUnit=ve.unit,Ee.streakDisplayText=ve.displayText,console.log("🔄 Arena: Updated buddy streak from profile change:",ve.displayText)}console.log("🔄 Arena: Preserved real buddy stats during profile update:",Ee),V(H=>{const ve=H.streakDisplayText?{streakDisplayText:H.streakDisplayText,streakDays:H.streakDays,streakUnit:H.streakUnit}:{};return console.log("🔄 Arena: Preserving locally calculated streak during profile update:",ve),{...H,...Ee,...ve}})}else console.log("🔄 Arena: Skipping profile update - waiting for real stats to load first")}},xe=>{xe.code!=="PERMISSION_DENIED"&&console.error("Error listening to buddy profile:",xe)});return()=>{ce(),$e()}}catch(ee){console.error("Error setting up buddy stats listeners:",ee)}})();return()=>{k=!1,Q.then(ee=>{ee&&typeof ee=="function"&&ee()})}},[t==null?void 0:t.uid,t==null?void 0:t.isRealBuddy,a==null?void 0:a.quitDate]);const P=async()=>{if(n){const k=await A(n);R(k)}if(t)if(t.uid==="uGZGbLUytbfu8W3mQPW0YAvXTQn1"||t.uid==="AmwwlNyHD5T3WthUbyR6bFL0QkF2")console.log(`🔄 Arena: Skipping refresh for centralized buddy ${t.uid} - using Firebase stats directly`);else{const k=await A(t);V($=>{const Q=$.streakDisplayText?{streakDisplayText:$.streakDisplayText,streakDays:$.streakDays,streakUnit:$.streakUnit}:{};return console.log("🔄 Arena: Preserving locally calculated streak during stats calculation:",Q),{...$,...k,...Q}})}};j.useEffect(()=>{if(!(n!=null&&n.uid))return;const k=setInterval(P,3e4);return()=>clearInterval(k)},[n==null?void 0:n.uid,t==null?void 0:t.uid]),j.useEffect(()=>{t!=null&&t.uid&&(t.uid==="uGZGbLUytbfu8W3mQPW0YAvXTQn1"||t.uid==="AmwwlNyHD5T3WthUbyR6bFL0QkF2"||P())},[t==null?void 0:t.uid]),j.useEffect(()=>{a!=null&&a.quitDate&&(t!=null&&t.uid)&&(t.uid==="uGZGbLUytbfu8W3mQPW0YAvXTQn1"||t.uid==="AmwwlNyHD5T3WthUbyR6bFL0QkF2"||P())},[a==null?void 0:a.quitDate,t==null?void 0:t.uid]),j.useEffect(()=>{n!=null&&n.uid&&!a&&!i&&!u&&(console.log("🔄 Arena: Loading buddy data for user:",n.uid),l(A,V))},[n==null?void 0:n.uid,a,i,u]),j.useEffect(()=>{const k=()=>{console.log("🌐 Internet connection restored")},$=()=>{console.log("📡 Internet connection lost")};return window.addEventListener("online",k),window.addEventListener("offline",$),()=>{window.removeEventListener("online",k),window.removeEventListener("offline",$)}},[]);const S=k=>{if(!k||!k.stats)return console.warn("Player or player stats not available for battle score calculation"),0;const $=k.stats.mentalStrength||50,Q=k.stats.motivation||50,ee=k.stats.triggerDefense||30,ie=k.stats.addictionLevel||50;return $*1.5+Q*1+ee*1.2-ie*1},v=S({...n,stats:I}),b=S({...t,stats:D}),_=typeof v=="number"&&!isNaN(v)?v:0,E=typeof b=="number"&&!isNaN(b)?b:0,N=_>E?"WINNING":_===E?"TIED":"LOSING",T=()=>{if(N==="WINNING")return null;if(!I||!D)return console.warn("Stats not available for recommendations calculation"),[];const k=E-_+1,$=[],Q=(I==null?void 0:I.mentalStrength)||50,ee=(I==null?void 0:I.motivation)||50,ie=(I==null?void 0:I.triggerDefense)||30,le=(I==null?void 0:I.addictionLevel)||50,ce=(D==null?void 0:D.mentalStrength)||50,Ae=(D==null?void 0:D.motivation)||50;D!=null&&D.triggerDefense;const $e=(D==null?void 0:D.addictionLevel)||50,xe=ce-Q,te=Ae-ee,de=le-$e,Ee=[{name:"Mental Strength",multiplier:1.5,gap:xe,current:Q,max:100},{name:"Trigger Defense",multiplier:1.2,gap:te,current:ie,max:100},{name:"Motivation",multiplier:1,gap:te,current:ee,max:100},{name:"Addiction",multiplier:1,gap:de,current:le,min:0,isReduction:!0}];if(Ee.sort((H,ve)=>H.multiplier!==ve.multiplier?ve.multiplier-H.multiplier:Math.abs(ve.gap)-Math.abs(H.gap)),Ee.forEach(H=>{if(H.isReduction){const ve=Math.min(H.current-H.min,50),He=ve*H.multiplier;He>0&&$.push({stat:H.name,change:ve,action:K(ve),priority:He,canWin:He>=k,isReduction:!0,efficiency:H.multiplier,gap:H.gap})}else{const ve=Math.min(H.max-H.current,50),He=ve*H.multiplier;He>0&&$.push({stat:H.name,change:ve,action:mt(H.name,ve),priority:He,canWin:He>=k,efficiency:H.multiplier,gap:H.gap})}}),$.sort((H,ve)=>ve.priority-H.priority),$.length>0&&!$.some(H=>H.canWin)){const H=Me($,k);H&&$.unshift(H)}return $.slice(0,3)},K=k=>k>=30?"Stay completely clean, avoid all triggers, use nicotine replacement therapy":k>=20?"Reduce nicotine intake significantly, avoid high-risk situations":k>=10?"Cut back on vaping frequency, identify and avoid main triggers":"Small reduction in nicotine intake, practice trigger avoidance",mt=(k,$)=>{switch(k){case"Mental Strength":return $>=30?"Complete daily breathing exercises, stay hydrated for 3+ days, practice meditation":$>=20?"Complete breathing exercises 3 days straight, stay hydrated, use stress management":"Complete breathing exercises, stay hydrated for 3 days straight";case"Motivation":return $>=30?"Log progress daily, share achievements weekly":$>=20?"Log progress 5+ days per week, share achievements, track progress":"Regular logging (3+ days per week), share achievements, reach milestones";case"Trigger Defense":return $>=30?"Survive multiple trigger situations, pre-plan for all triggers, update trigger list":$>=20?"Survive trigger situations, pre-plan for known triggers, practice coping":"Survive trigger situations without vaping, pre-plan for known triggers";default:return"Focus on improving this stat through consistent practice"}},Me=(k,$)=>{let Q=0;const ee=[];for(const ie of k){if(Q>=$)break;const le=$-Q,ce=Math.min(ie.priority,le);ce>0&&(ee.push({stat:ie.stat,change:Math.ceil(ce/ie.efficiency),contribution:ce}),Q+=ce)}return ee.length>0?{stat:"Combination Strategy",change:Math.ceil($),action:`Focus on: ${ee.map(ie=>`${ie.stat} (+${ie.change})`).join(", ")}`,priority:Q,canWin:Q>=$,isCombination:!0,strategy:ee}:null},qt=T()||[];return d.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-slate-900 via-blue-900 to-slate-900 py-4 pb-20",children:[d.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:[d.jsx("div",{className:"text-center mb-6",children:d.jsxs("div",{className:"flex flex-col sm:flex-row items-center justify-center gap-2 sm:gap-4",children:[d.jsxs("div",{className:`inline-flex items-center px-4 py-2 sm:px-6 sm:py-3 rounded-full font-bold text-sm sm:text-lg shadow-xl ${N==="WINNING"?"bg-green-600":N==="TIED"?"bg-yellow-600":"bg-red-600"} text-white`,children:[N==="WINNING"?d.jsx(UD,{className:"w-5 h-5 mr-2"}):N==="TIED"?d.jsx(Jd,{className:"w-5 h-5 mr-2"}):d.jsx("span",{className:"mr-2",children:"📉"}),"You are ",N]}),d.jsx("button",{onClick:()=>f(!0),className:"w-8 h-8 sm:w-10 sm:h-10 bg-blue-600 hover:bg-blue-700 text-white rounded-full flex items-center justify-center transition-colors shadow-lg",title:"Battle Algorithm Info",children:d.jsx("span",{className:"text-sm sm:text-lg font-bold",children:"i"})}),d.jsx("button",{onClick:P,className:"w-8 h-8 sm:w-10 sm:h-10 bg-green-600 hover:bg-green-700 text-white rounded-full flex items-center justify-center transition-colors shadow-lg",title:"Refresh Stats",children:d.jsx("span",{className:"text-sm sm:text-lg font-bold",children:"🔄"})}),d.jsxs("div",{className:"text-xs text-gray-400 bg-gray-800 p-2 rounded",children:[d.jsxs("div",{children:["User Stats: ",JSON.stringify(I)]}),d.jsxs("div",{children:["Base Stats: ",JSON.stringify(n==null?void 0:n.stats)]})]}),d.jsx("button",{onClick:P,className:"mt-2 px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg transition-colors",children:"🔄 Refresh Stats"}),d.jsx("button",{onClick:async()=>{console.log("🧪 Manual buddy matching test triggered...");try{await autoMatchUsers(),console.log("✅ Manual buddy matching completed")}catch(k){console.error("❌ Manual buddy matching failed:",k)}},className:"mt-2 ml-2 px-4 py-2 bg-purple-600 hover:bg-purple-700 text-white rounded-lg transition-colors",children:"🔗 Test Matching"}),d.jsx("button",{onClick:async()=>{console.log("🧪 Manual buddy reload test triggered...");try{setBuddyLoadAttempted(!1),setRealBuddy(null),await l(A,V),console.log("✅ Manual buddy reload completed")}catch(k){console.error("❌ Manual buddy reload failed:",k)}},className:"mt-2 ml-2 px-4 py-2 bg-green-600 hover:bg-green-700 text-white rounded-lg transition-colors",children:"👥 Reload Buddy"}),d.jsx("button",{onClick:async()=>{console.log("🧪 Resetting matching system...");try{const k=firestoreBuddyServiceRef.current||firestoreBuddyService;if(k){const{getDocs:$,deleteDoc:Q,doc:ee}=await be(()=>import("./index.esm-396c6e3a.js"),[]),le=(await $(k.buddyPairsCollection)).docs.map(de=>Q(ee(si,"buddyPairs",de.id)));await Promise.all(le);const Ae=(await $(k.matchingPoolCollection)).docs.map(de=>Q(ee(si,"matchingPool",de.id)));await Promise.all(Ae);const{ref:$e,remove:xe}=await be(()=>import("./index.esm-eba9a326.js"),[]),te=["5uSH8SA6y4eZ7jkoLEZCRJZmTGW2","KB67Yg17rkZmCa8UV1N5xIUWoK12","o4mW4BmLWOOVBybTrYcvGJ4nimA3"];for(const de of te)try{await xe($e(q,`users/${de}/buddyInfo`))}catch{console.log("Could not remove buddy info for:",de)}console.log("✅ Matching system reset completed"),setRealBuddy(null),setBuddyLoadAttempted(!1)}}catch(k){console.error("❌ Reset failed:",k)}},className:"mt-2 ml-2 px-4 py-2 bg-red-600 hover:bg-red-700 text-white rounded-lg transition-colors",children:"🔄 Reset Matching"})]})}),d.jsxs("div",{className:"battle-cards-container flex flex-col lg:flex-row items-center justify-center gap-4 lg:gap-12 mb-8 w-full",children:[d.jsx("div",{className:"battle-card flex flex-col items-center space-y-4 flex-shrink-0",children:(()=>{if(!n||!I)return console.log("🎯 TradingCard: Missing data, not rendering user card"),d.jsx("div",{className:"w-72 sm:w-80 h-[480px] sm:h-[520px] bg-slate-800 rounded-xl border-2 border-slate-600 p-4 text-white text-center mx-auto flex items-center justify-center",children:d.jsx("div",{className:"animate-pulse",children:"Loading User..."})});const k=e&&Object.keys(e).length>0?{...n.stats,...e}:{...n.stats,...I};return console.log(`🎯 TradingCard: Using ${e&&Object.keys(e).length>0?"centralized":"calculated"} stats for ${n.uid}`),console.log("🎯 TradingCard: Final stats:",{streak:k.streakDisplayText,addiction:k.addictionLevel}),d.jsx(kb,{user:{...n,stats:k},showComparison:!1,nemesisUser:t})})()}),d.jsxs("div",{className:"vs-section flex flex-row lg:flex-col items-center justify-center space-x-4 lg:space-x-0 space-y-0 lg:space-y-4 flex-shrink-0",children:[d.jsx("div",{className:"vs-icon w-16 h-16 lg:w-24 lg:h-24 bg-gradient-to-br from-red-500 to-purple-600 rounded-full flex items-center justify-center shadow-xl animate-pulse",children:d.jsx(c8,{className:"w-8 h-8 lg:w-12 lg:h-12 text-white"})}),d.jsx("div",{className:"bg-red-600 px-4 py-2 lg:px-8 lg:py-3 rounded-full",children:d.jsx("p",{className:"vs-text text-white font-bold text-lg lg:text-2xl",children:"VS"})})]}),d.jsx("div",{className:"battle-card flex flex-col items-center space-y-4 flex-shrink-0",children:(()=>{var $;if(!t||!D)return console.log("🎯 TradingCard: Missing data, not rendering nemesis card"),d.jsx("div",{className:"w-72 sm:w-80 h-[480px] sm:h-[520px] bg-slate-800 rounded-xl border-2 border-slate-600 p-4 text-white text-center mx-auto flex items-center justify-center",children:d.jsx("div",{className:"animate-pulse",children:"Loading Nemesis..."})});const k={...t,stats:{...t.stats,...D}};return console.log("🎯 TradingCard: Buddy streak debug:",{realTimeNemesisStats:D,mergedNemesisStats:k.stats,buddyStreak:($=k.stats)==null?void 0:$.streakDisplayText}),d.jsx(kb,{user:k,isNemesis:!0,showComparison:!1,nemesisUser:n})})()})]}),N==="LOSING"&&qt&&qt.length>0&&d.jsxs("div",{className:"w-full max-w-4xl mx-auto bg-slate-800/50 rounded-xl p-4 sm:p-6 border border-slate-700",children:[d.jsx("h3",{className:"text-xl font-bold text-white mb-4 text-center",children:"🎯 Quick Win Strategy"}),d.jsx("div",{className:"space-y-4",children:qt.slice(0,3).map((k,$)=>d.jsx("div",{className:"bg-slate-700/50 rounded-lg p-3 sm:p-4 border-l-4 border-blue-500",children:d.jsxs("div",{className:"flex flex-col sm:flex-row items-start sm:items-center justify-between gap-2 sm:gap-0",children:[d.jsxs("div",{className:"flex-1",children:[d.jsx("h4",{className:"text-white font-semibold mb-2",children:k.isReduction?d.jsxs(d.Fragment,{children:["🎯 Reduce your ",k.stat," by ",k.change," points!"]}):k.isCombination?d.jsxs(d.Fragment,{children:["🎯 Best Strategy: Improve multiple stats by ",k.change," total points!"]}):k.isMajor?d.jsxs(d.Fragment,{children:["🎯 Major improvement needed: ",k.change," total points!"]}):d.jsxs(d.Fragment,{children:["🎯 Increase your ",k.stat," by ",k.change," points!"]})}),d.jsxs("p",{className:"text-gray-300 text-sm",children:["💡 ",k.action]})]}),d.jsxs("div",{className:`font-bold text-xl sm:text-2xl sm:ml-4 ${k.isReduction?"text-green-400":k.isCombination?"text-purple-400":k.isMajor?"text-orange-400":"text-blue-400"}`,children:[k.isReduction?"-":"+",k.change]})]})},$))}),d.jsx("div",{className:"text-center mt-4",children:d.jsx("p",{className:"text-gray-400 text-sm",children:"Focus on the top recommendation for the fastest path to victory!"})})]})]}),h&&d.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:d.jsxs("div",{className:"bg-slate-800 rounded-xl p-6 max-w-md w-full border border-slate-600",children:[d.jsxs("div",{className:"flex justify-between items-center mb-4",children:[d.jsx("h3",{className:"text-xl font-bold text-white",children:"Battle Algorithm"}),d.jsxs("div",{className:"flex items-center gap-2",children:[d.jsx("button",{onClick:M,className:"bg-blue-600 hover:bg-blue-700 text-white px-3 py-1 rounded-lg text-sm transition-colors",title:"Share achievement for Motivation bonus",children:"📤 Share"}),d.jsx("button",{onClick:()=>f(!1),className:"text-gray-400 hover:text-white text-2xl",children:"×"})]})]}),d.jsxs("div",{className:"space-y-4 text-sm",children:[d.jsxs("div",{children:[d.jsx("h4",{className:"text-white font-semibold mb-2",children:"Formula:"}),d.jsx("p",{className:"text-gray-300 font-mono",children:"(Mental Strength × 1.5) + (Motivation × 1.0) + (Trigger Defense × 1.2) - (Addiction × 1.0)"})]}),d.jsxs("div",{children:[d.jsx("h4",{className:"text-white font-semibold mb-2",children:"Your Score:"}),d.jsxs("p",{className:"text-green-400 font-mono",children:["(",I.mentalStrength||50," × 1.5) + (",I.motivation||50," × 1.0) + (",I.triggerDefense||30," × 1.2) - (",I.addictionLevel||50," × 1.0) = ",v.toFixed(1)]})]}),d.jsxs("div",{children:[d.jsx("h4",{className:"text-white font-semibold mb-2",children:"Nemesis Score:"}),d.jsxs("p",{className:"text-red-400 font-mono",children:["(",D.mentalStrength||50," × 1.5) + (",D.motivation||50," × 1.0) + (",D.triggerDefense||30," × 1.2) - (",D.addictionLevel||50," × 1.0) = ",b.toFixed(1)]})]}),d.jsx("div",{className:"bg-slate-700/50 rounded-lg p-3",children:d.jsxs("p",{className:"text-gray-300 text-xs",children:[d.jsx("strong",{children:"Mental Strength (×1.5):"})," Your resilience and coping ability",d.jsx("br",{}),d.jsx("strong",{children:"Motivation (×1.0):"})," Your drive to quit",d.jsx("br",{}),d.jsx("strong",{children:"Trigger Defense (×1.2):"})," Your ability to resist triggers",d.jsx("br",{}),d.jsx("strong",{children:"Addiction (×1.0):"})," Your nicotine dependence level"]})})]})]})})]})},v8=({isOpen:n,onClose:e,title:t,message:r,type:s="info"})=>{if(!n)return null;const i=()=>{switch(s){case"success":return"🎉";case"warning":return"⚠️";case"info":return"ℹ️";default:return"💡"}},o=()=>{switch(s){case"success":return"from-green-600 to-green-700";case"warning":return"from-yellow-600 to-yellow-700";case"info":return"from-blue-600 to-blue-700";default:return"from-slate-600 to-slate-700"}};return d.jsx("div",{className:"fixed inset-0 bg-black/60 backdrop-blur-sm flex items-center justify-center z-50 p-4",children:d.jsx("div",{className:"bg-slate-800 rounded-2xl p-6 max-w-md w-full border border-slate-600 shadow-2xl animate-in slide-in-from-bottom-4 duration-300",children:d.jsxs("div",{className:"text-center",children:[d.jsx("div",{className:"w-16 h-16 bg-gradient-to-br from-slate-600 to-slate-700 rounded-full flex items-center justify-center mx-auto mb-4",children:d.jsx("span",{className:"text-3xl",children:i()})}),d.jsx("h3",{className:"text-xl font-bold text-white mb-3",children:t}),d.jsx("div",{className:"text-gray-300 mb-6 whitespace-pre-line text-sm leading-relaxed",children:r}),d.jsx("button",{onClick:e,className:`w-full bg-gradient-to-r ${o()} hover:from-slate-700 hover:to-slate-800 text-white font-bold py-3 px-6 rounded-xl transition-all duration-300 transform hover:scale-105`,children:"Got it"})]})})})},w8=({gameType:n,onClose:e})=>{j.useState(0);const t=()=>{const s=j.useRef(null),[i,o]=j.useState([{x:12,y:12}]),[a,l]=j.useState({x:1,y:0}),[u,h]=j.useState({x:1,y:0}),[f,g]=j.useState({x:15,y:15}),[y,w]=j.useState(!1),[C,M]=j.useState(0),[A,I]=j.useState(1),R={1:128,2:Math.round(128/1.25),3:Math.round(128/1.25/1.25)},D={1:5,2:5,3:10};return j.useEffect(()=>{const V=P=>{if(y){P.preventDefault(),o([{x:12,y:12}]),l({x:1,y:0}),h({x:1,y:0}),g({x:15,y:15}),w(!1),M(0),I(1);return}switch(P.key){case"ArrowUp":P.preventDefault(),a.y!==1&&h({x:0,y:-1});break;case"ArrowDown":P.preventDefault(),a.y!==-1&&h({x:0,y:1});break;case"ArrowLeft":P.preventDefault(),a.x!==1&&h({x:-1,y:0});break;case"ArrowRight":P.preventDefault(),a.x!==-1&&h({x:1,y:0});break}};return window.addEventListener("keydown",V),()=>window.removeEventListener("keydown",V)},[a,y]),j.useEffect(()=>{if(y)return;const V=setInterval(()=>{o(P=>{const S={x:P[0].x+a.x,y:P[0].y+a.y};if(S.x<0&&(S.x=24),S.x>=25&&(S.x=0),S.y<0&&(S.y=24),S.y>=25&&(S.y=0),P.slice(0,-1).some(E=>E.x===S.x&&E.y===S.y))return w(!0),P;const b=S.x===f.x&&S.y===f.y;let _;return b?(M(E=>E+D[A]),g({x:Math.floor(Math.random()*25),y:Math.floor(Math.random()*25)}),_=[S,...P]):_=[S,...P.slice(0,-1)],(u.x!==a.x||u.y!==a.y)&&setTimeout(()=>{l(u)},0),_})},R[A]);return()=>clearInterval(V)},[a,u,f,y]),j.useEffect(()=>{const V=s.current;if(!V)return;const P=V.getContext("2d"),S=15,v=25;P.fillStyle="#1f2937",P.fillRect(0,0,375,375),P.strokeStyle="#374151",P.lineWidth=1;for(let b=0;b<=v;b++)P.beginPath(),P.moveTo(b*S,0),P.lineTo(b*S,375),P.stroke(),P.beginPath(),P.moveTo(0,b*S),P.lineTo(375,b*S),P.stroke();i.forEach((b,_)=>{_===0?P.fillStyle="#fbbf24":P.fillStyle="#10b981",P.fillRect(b.x*S+1,b.y*S+1,S-2,S-2)}),P.fillStyle="#ef4444",P.fillRect(f.x*S+2,f.y*S+2,S-4,S-4)},[i,f]),d.jsxs("div",{className:"text-center",children:[d.jsx("div",{className:"mb-4",children:d.jsxs("div",{className:"flex justify-center gap-2 mb-3",children:[d.jsx("span",{className:"text-white mr-2 text-sm",children:"Level:"}),[1,2,3].map(V=>d.jsxs("button",{onClick:()=>I(V),className:`
                  px-4 py-2 text-sm font-mono border-2 border-green-500 transition-all
                  ${A===V?"bg-green-500 text-black":"bg-green-900 text-green-400"}
                  hover:bg-green-600 cursor-pointer
                `,style:{minWidth:"80px"},children:[d.jsxs("div",{children:["Level ",V]}),d.jsxs("div",{className:"text-xs mt-1",children:[V===1&&"Normal",V===2&&"Fast",V===3&&"Insane"]})]},V))]})}),d.jsx("canvas",{ref:s,width:"375",height:"375",className:"border-2 border-gray-300 mx-auto",style:{imageRendering:"pixelated"}}),d.jsxs("div",{className:"mt-4",children:[d.jsxs("p",{className:"text-lg font-bold text-gray-800",children:["Score: ",C," | Level: ",A]}),y&&d.jsxs("div",{className:"mt-2",children:[d.jsx("p",{className:"text-red-600 font-bold mb-2",children:"Game Over!"}),d.jsx("button",{onClick:()=>{o([{x:12,y:12}]),l({x:1,y:0}),h({x:1,y:0}),g({x:15,y:15}),w(!1),M(0),I(1)},className:"bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded text-sm",children:"Restart Game"})]})]})]})},r=()=>{try{return n==="snake"?d.jsx(t,{}):d.jsx("div",{className:"text-center text-red-600",children:"Game not found"})}catch(s){return console.error("Error rendering game:",s),d.jsxs("div",{className:"text-center text-red-600",children:[d.jsx("p",{className:"text-lg font-bold mb-2",children:"⚠️ Game Error"}),d.jsx("p",{className:"text-sm",children:"Something went wrong loading the game."}),d.jsx("button",{onClick:()=>window.location.reload(),className:"mt-2 bg-red-600 hover:bg-red-700 text-white px-4 py-2 rounded text-sm",children:"Reload Game"})]})}};return d.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:d.jsxs("div",{className:"bg-white rounded-2xl p-6 max-w-4xl w-full max-h-[90vh] overflow-y-auto",children:[d.jsxs("div",{className:"flex justify-between items-center mb-4",children:[d.jsx("h3",{className:"text-xl font-bold text-gray-800",children:"🐍 Snake Game"}),d.jsx("div",{className:"flex items-center gap-4",children:d.jsx("button",{onClick:e,className:"text-gray-500 hover:text-gray-700 text-2xl",children:"×"})})]}),d.jsx("div",{className:"bg-gray-100 rounded-lg p-4 min-h-[500px] flex items-center justify-center relative",children:r()})]})})},x8=({user:n,nemesis:e,onBackToLogin:t,onResetForTesting:r,onBreathingComplete:s,setActiveTab:i,behavioralService:o})=>{const[a,l]=j.useState(!1),[u,h]=j.useState(null),[f,g]=j.useState(!1),[y,w]=j.useState({title:"",message:"",type:"info"}),[C,M]=j.useState(null),[A,I]=j.useState(!1),[R,D]=j.useState(0),[V,P]=j.useState(!1),[S,v]=j.useState(!1),[b,_]=j.useState(1),[E,N]=j.useState({strength:5,mood:"",context:"",outcome:"",copingStrategy:"",location:"",timeOfDay:"",triggerType:""}),[T,K]=j.useState({resisted:0,relapses:0}),[mt,Me]=j.useState(0),[qt,k]=j.useState(!1),[$,Q]=j.useState(""),ee=(oe,Ce,qe="info")=>{w({title:oe,message:Ce,type:qe}),g(!0)};I2.useEffect(()=>(typeof window<"u"&&(window.showQuickActionPopup=ee),()=>{typeof window<"u"&&delete window.showQuickActionPopup}),[]),j.useEffect(()=>n!=null&&n.uid?(D(0),(async()=>{try{const he=new Lm(q,n.uid);await he.initialize(),M(he)}catch(he){console.error("Error initializing StatManager:",he)}})(),(async()=>{try{const he=new Date().toDateString(),{ref:De,get:Ke}=await be(()=>import("./index.esm-eba9a326.js"),[]);try{const Tt=De(q,`users/${n.uid}/profile/dailyCravingLogs/${he}`),yt=await Ke(Tt);if(yt.exists()){const vt=yt.val();Me(vt.count||0)}else Me(0)}catch{const yt=`cravingLogs_${n.uid}_${he}`,vt=localStorage.getItem(yt);if(vt){const Be=JSON.parse(vt);Me(Be.count||0)}else Me(0)}}catch(he){console.error("Error loading daily craving logs:",he),Me(0)}})(),(async()=>{try{const{ref:he,get:De,onValue:Ke,query:Tt,orderByChild:yt,startAt:vt,endAt:Be,set:_t}=await be(()=>import("./index.esm-eba9a326.js"),[]),nt=new Date,Te=new Date(nt.getTime()-7*24*60*60*1e3),rt=Te.toDateString(),Wt=nt.toDateString();try{const lt=he(q,`users/${n.uid}/profile/cravingStats`),Tn=await De(lt);if(Tn.exists()){const On=Tn.val();if(On.lastUpdated&&new Date(On.lastUpdated)>Te){K(On);return}}}catch{console.log("Firebase stats not available, calculating from cravings data")}const{ref:rn,get:Sn,query:dr,orderByChild:Wn,startAt:it,endAt:Vt}=await be(()=>import("./index.esm-eba9a326.js"),[]),br=rn(q,`users/${n.uid}/cravings`),Wo=dr(br,Wn("date"),it(rt),Vt(Wt));try{const lt=await Sn(Wo);let Tn=0,On=0;if(console.log(`🔍 Weekly Stats: Checking cravings for ${rt} to ${Wt}`),console.log(`🔍 Weekly Stats: Cravings snapshot exists: ${lt.exists()}`),lt.exists()){const Ts=lt.val();console.log("🔍 Weekly Stats: Raw cravings data:",Ts),lt.forEach(is=>{const Di=is.val();console.log("🔍 Weekly Stats: Individual craving:",Di),Di.outcome==="resisted"?Tn++:Di.outcome==="relapsed"&&On++})}console.log(`🔍 Weekly Stats: Calculated - resisted: ${Tn}, relapses: ${On}`);const Ys={resisted:Tn,relapses:On,lastUpdated:nt.toISOString()};K(Ys);try{const Ts=he(q,`users/${n.uid}/profile/cravingStats`);await _t(Ts,Ys)}catch{console.log("Could not save weekly stats to Firebase, using localStorage")}localStorage.setItem(`cravingStats_${n.uid}`,JSON.stringify(Ys))}catch{console.log("Could not query cravings, using localStorage fallback");const Tn=JSON.parse(localStorage.getItem(`cravingStats_${n.uid}`)||'{"resisted": 0, "relapses": 0}');K(Tn)}const Gr=he(q,`users/${n.uid}/profile/cravingStats`);return Ke(Gr,lt=>{lt.exists()&&K(lt.val())})}catch(he){console.error("Error loading weekly stats:",he);const De=JSON.parse(localStorage.getItem(`cravingStats_${n.uid}`)||'{"resisted": 0, "relapses": 0}');K(De)}})(),(async()=>{try{const{ref:he,get:De,onValue:Ke}=await be(()=>import("./index.esm-eba9a326.js"),[]),Tt=new Date().toDateString(),yt=he(q,`users/${n.uid}/profile/daily/${Tt}/water`),vt=await De(yt);if(vt.exists())D(vt.val()||0);else{const _t=parseInt(localStorage.getItem(`water_${n.uid}_${Tt}`)||0);D(_t)}return Ke(yt,_t=>{_t.exists()&&D(_t.val()||0)})}catch(he){console.error("Error loading daily water from Firebase:",he);const De=new Date().toDateString(),Ke=parseInt(localStorage.getItem(`water_${n.uid}_${De}`)||0);D(Ke)}})(),()=>{D(0),I(!1),K({resisted:0,relapses:0}),v(!1),_(1),N({strength:5,mood:"",context:"",outcome:""}),Me(0),k(!1),Q("")}):void 0,[n==null?void 0:n.uid]);const ie=()=>{h("snake"),l(!0)},le=()=>{h(null),l(!1)},ce=async()=>{if(!(n!=null&&n.uid)){console.warn("Cannot log water: No authenticated user");return}try{const oe=Math.min(R+1,6);D(oe);const Ce=new Date().toDateString();if(C){if(await C.handleHydrationUpdate(oe),o)try{const De=await C.checkHydrationStreak();await o.logHydration(n.uid,{glassesConsumed:oe,targetGlasses:6,currentStreak:De}),console.log("✅ Hydration also logged to Firestore for analytics")}catch(De){console.warn("⚠️ Could not log hydration to Firestore:",De.message)}oe===6&&R===5&&await C.checkHydrationStreak()>=3&&(await C.updateStat("mentalStrength",1,"3-day hydration streak"),console.log("Mental Strength +1 for 3-day hydration streak!"))}const{ref:qe,set:Oe}=await be(()=>import("./index.esm-eba9a326.js"),[]),he=qe(q,`users/${n.uid}/profile/daily/${Ce}/water`);await Oe(he,oe),localStorage.setItem(`water_${n.uid}_${Ce}`,oe.toString()),console.log("Water intake updated:",oe)}catch(oe){console.error("Error updating water intake:",oe);const Ce=Math.min(R+1,6);D(Ce);const qe=new Date().toDateString();localStorage.setItem(`water_${n.uid}_${qe}`,Ce.toString())}},Ae=()=>{N({strength:5,mood:"",context:"",outcome:""}),_(1),v(!0)},$e=()=>{b<4&&_(b+1)},xe=()=>{b>1&&_(b-1)},te=async oe=>{try{const Ce=new Date().toISOString(),qe=new Date().toDateString(),Oe=new Date,he={...E,outcome:oe,timestamp:Ce,date:qe,timeOfDay:Oe.getHours()<12?"morning":Oe.getHours()<17?"afternoon":"evening",dayOfWeek:Oe.toLocaleDateString("en-US",{weekday:"long"}),weekOfYear:Math.ceil((Oe.getDate()+new Date(Oe.getFullYear(),0,1).getDay())/7),month:Oe.toLocaleDateString("en-US",{month:"long"}),year:Oe.getFullYear(),userId:n==null?void 0:n.uid,sessionId:Date.now().toString(),userAgent:navigator.userAgent.substring(0,100),outcomeDetails:{resisted:oe==="resisted",relapsed:oe==="relapsed",logged:oe==="logged",usedPractices:oe==="resistance_practices"}},De=new Date().toDateString(),Ke=mt+1;Me(Ke);let Tt={resisted:T.resisted,relapses:T.relapses,lastUpdated:Ce},yt=!1;Ke<=2&&C&&(await C.handleCravingLogged(),yt=!0);const{ref:vt,set:Be,push:_t,get:nt}=await be(()=>import("./index.esm-eba9a326.js"),[]);if(n&&n.uid){try{const it=vt(q,`users/${n.uid}/profile/dailyCravingLogs/${De}`);await Be(it,{count:Ke,lastUpdated:Ce})}catch{const Vt=`cravingLogs_${n.uid}_${De}`;localStorage.setItem(Vt,JSON.stringify({count:Ke,lastUpdated:Ce}))}const rt=vt(q,`users/${n.uid}/cravings`),Wt=_t(rt);if(await Be(Wt,he),o)try{await o.logCraving(n.uid,{outcome:"resisted",strength:E.strength,duration:E.duration,context:"detailed_assessment",triggers:E.triggers||[],mood:E.mood,stressLevel:E.stressLevel,copingStrategiesUsed:E.copingStrategies||[],location:E.location,socialSituation:E.socialSituation}),console.log("✅ Craving also logged to Firestore for analytics")}catch(it){console.warn("⚠️ Could not log craving to Firestore:",it.message)}let rn=[],Sn=[];try{const it=vt(q,`users/${n.uid}/profile/cravingHistory/${De}`),Vt=await nt(it);rn=Vt.exists()?Vt.val():[],rn.push({id:Wt.key,strength:he.strength,mood:he.mood,context:he.context,outcome:he.outcome,timestamp:he.timestamp,timeOfDay:he.timeOfDay}),await Be(it,rn),console.log(`📅 Daily history updated for ${De}:`,rn.length,"records")}catch(it){console.warn("⚠️ Could not save to daily history:",it)}const dr=`${Oe.getFullYear()}-${String(Oe.getMonth()+1).padStart(2,"0")}`;try{const it=vt(q,`users/${n.uid}/profile/cravingTrends/${dr}`),Vt=await nt(it);Sn=Vt.exists()?Vt.val():[],Sn.push({id:Wt.key,date:he.date,strength:he.strength,outcome:he.outcome,timeOfDay:he.timeOfDay}),await Be(it,Sn),console.log(`📊 Monthly trends updated for ${dr}:`,Sn.length,"records")}catch(it){console.warn("⚠️ Could not save to monthly trends:",it)}const Wn=vt(q,`users/${n.uid}/profile/cravingStats`);if(oe==="resisted"){Tt.resisted=T.resisted+1;let it=null;C&&(it=await C.checkDailyCravingResistanceLimits(De),await C.handleCravingResistance()),he.resistanceLimits=it}else if(oe==="relapsed"){if(Tt.relapses=T.relapses+1,C){console.log("🔄 Detailed Craving: Calling StatManager.handleRelapse()...");const it=await C.handleRelapse();if(console.log("🔄 Detailed Craving: StatManager.handleRelapse() result:",it),o)try{const Vt=await C.getCurrentEscalationLevel();await o.logRelapse(n.uid,{escalationLevel:Vt,triggers:E.triggers||[],mood:E.mood,stressLevel:E.stressLevel,location:E.location,socialSituation:E.socialSituation,copingAttempts:E.copingStrategies||[],addictionIncrease:Vt===1?4:Vt===2?6:8,mentalStrengthDecrease:3,triggerDefenseDecrease:3}),console.log("✅ Relapse also logged to Firestore for analytics")}catch(Vt){console.warn("⚠️ Could not log relapse to Firestore:",Vt.message)}}else console.error("❌ Detailed Craving: StatManager not available!");console.log("🔄 Detailed Craving: Triggering stats refresh..."),typeof refreshStats=="function"?(refreshStats(),setTimeout(()=>{console.log("🔄 Detailed Craving: Secondary stats refresh..."),refreshStats()},1500)):console.error("❌ Detailed Craving: refreshStats function not available!")}await Be(Wn,Tt),K(Tt),console.log("📊 Craving assessment saved to database:",{userId:n.uid,cravingId:Wt.key,data:he,databasePaths:{main:`users/${n.uid}/cravings/${Wt.key}`,dailyHistory:`users/${n.uid}/profile/cravingHistory/${De}`,monthlyTrends:`users/${n.uid}/profile/cravingTrends/${dr}`,weeklyStats:`users/${n.uid}/profile/cravingStats`,dailyLogs:`users/${n.uid}/profile/dailyCravingLogs/${De}`},summary:{dailyHistoryRecords:(rn==null?void 0:rn.length)||0,monthlyTrendsRecords:(Sn==null?void 0:Sn.length)||0,monthKey:dr,today:De}})}const Te=JSON.parse(localStorage.getItem(`cravings_${n.uid}`)||"[]");if(Te.push(he),localStorage.setItem(`cravings_${n.uid}`,JSON.stringify(Te)),localStorage.setItem(`cravingStats_${n.uid}`,JSON.stringify(Tt)),oe==="resisted")if(he.resistanceLimits){const rt=he.resistanceLimits;!rt.canAwardMentalStrength&&!rt.canAwardTriggerDefense?w({title:"🎯 Daily Limits Reached",message:`You've reached your daily limits for Mental Strength (3 points) and Trigger Defense (5 points).

Great job staying consistent! Come back tomorrow for more opportunities to grow.`,type:"info"}):rt.canAwardMentalStrength?rt.canAwardTriggerDefense?w({title:"🎉 Great Job!",message:`You successfully resisted that craving!

Your Mental Strength increased by 1 point and Trigger Defense increased by 3 points!

Plus, you earned awareness bonuses for tracking your craving!`,type:"success"}):w({title:"🎯 Trigger Defense Limit Reached",message:`You've reached your daily limit for Trigger Defense (5 points).

Your Mental Strength increased by 1 point!

Come back tomorrow for more Trigger Defense opportunities.`,type:"info"}):w({title:"🎯 Mental Strength Limit Reached",message:`You've reached your daily limit for Mental Strength (3 points).

Your Trigger Defense increased by 3 points!

Come back tomorrow for more Mental Strength opportunities.`,type:"info"})}else w({title:"🎉 Great Job!",message:`You successfully resisted that craving!

Your Mental Strength and Trigger Defense have increased significantly.

Plus, you earned awareness bonuses for tracking your craving!`,type:"success"});else w(oe==="resistance_practices"?{title:"🛡️ Stay Strong!",message:`Stay strong! Use distraction or wellbeing practices to resist.

You earned awareness bonuses for tracking your craving!`,type:"info"}:oe==="relapsed"?{title:"💪 Don't Give Up",message:`Relapses happen to everyone. The important thing is that you're here and trying again.

You still earned awareness bonuses for tracking your craving!`,type:"info"}:oe==="logged"?yt?{title:"📝 Craving Logged",message:`Great job tracking your craving!

You earned awareness bonuses for your self-awareness.

This helps build your Motivation and Trigger Defense.`,type:"info"}:{title:"📝 Daily Limit Reached",message:"Daily craving logging limit reached. Additional logs are recorded but won't award stat points until tomorrow.",type:"info"}:{title:"📝 Progress Recorded",message:`Your craving has been logged successfully.

You earned awareness bonuses for tracking your craving!`,type:"info"});g(!0),v(!1),_(1)}catch(Ce){console.error("Error saving craving assessment:",Ce),w({title:"Progress Recorded",message:`Your progress has been recorded locally.

Keep up the great work!`,type:"info"}),g(!0),v(!1),_(1)}},de=async()=>{try{const oe=new Date().toISOString(),Ce=new Date().toDateString();let qe=null;const{ref:Oe,set:he,push:De,get:Ke}=await be(()=>import("./index.esm-eba9a326.js"),[]);if(n&&n.uid){const vt=Oe(q,`users/${n.uid}/cravings`),Be=De(vt);await he(Be,{strength:0,mood:"quick",context:"quick_action",outcome:"resisted",timestamp:oe,date:Ce});const _t=Oe(q,`users/${n.uid}/profile/cravingStats`),nt={resisted:T.resisted+1,relapses:T.relapses,lastUpdated:oe};await he(_t,nt),K(nt),window.centralizedStatService?(console.log("🔄 Quick Resistance: Using CentralizedStatService..."),await window.centralizedStatService.handleCravingResisted(),console.log("✅ Quick Resistance: Stats updated via CentralizedStatService")):C&&(qe=await C.checkDailyCravingResistanceLimits(Ce),await C.handleCravingResistance())}const Tt=JSON.parse(localStorage.getItem(`cravings_${n.uid}`)||"[]");Tt.push({strength:0,mood:"quick",context:"quick_action",outcome:"resisted",timestamp:oe,date:Ce}),localStorage.setItem(`cravings_${n.uid}`,JSON.stringify(Tt));const yt={resisted:T.resisted+1,relapses:T.relapses,lastUpdated:oe};localStorage.setItem(`cravingStats_${n.uid}`,JSON.stringify(yt)),K(yt),qe?!qe.canAwardMentalStrength&&!qe.canAwardTriggerDefense?w({title:"🎯 Daily Limits Reached",message:`You've reached your daily limits for Mental Strength (3 points) and Trigger Defense (5 points).

Great job staying consistent! Come back tomorrow for more opportunities to grow.`,type:"info"}):qe.canAwardMentalStrength?qe.canAwardTriggerDefense?w({title:"🎉 Quick Win!",message:`Great job resisting that craving!

Your Mental Strength increased by 1 point and Trigger Defense increased by 3 points!`,type:"success"}):w({title:"🎯 Trigger Defense Limit Reached",message:`You've reached your daily limit for Trigger Defense (5 points).

Your Mental Strength increased by 1 point!

Come back tomorrow for more Trigger Defense opportunities.`,type:"info"}):w({title:"🎯 Mental Strength Limit Reached",message:`You've reached your daily limit for Mental Strength (3 points).

Your Trigger Defense increased by 3 points!

Come back tomorrow for more Mental Strength opportunities.`,type:"info"}):w({title:"🎉 Quick Win!",message:`Great job resisting that craving!

Your Mental Strength and Trigger Defense have increased.`,type:"success"}),g(!0)}catch(oe){console.error("Error recording quick resistance:",oe),w({title:"Progress Recorded",message:"Your progress has been recorded locally.",type:"info"}),g(!0)}},Ee=async()=>{try{const oe=new Date().toISOString(),Ce=new Date().toDateString();if(n&&n.uid){const{ref:he,set:De,push:Ke}=await be(()=>import("./index.esm-eba9a326.js"),[]),Tt=he(q,`users/${n.uid}/cravings`),yt=Ke(Tt);if(await De(yt,{strength:0,mood:"quick",context:"quick_action",outcome:"relapsed",timestamp:oe,date:Ce}),window.centralizedStatService)console.log("🔄 Quick Relapse: Using CentralizedStatService..."),await window.centralizedStatService.handleRelapse(),console.log("✅ Quick Relapse: Stats updated via CentralizedStatService"),ee("💔 Relapse Logged",`It's okay, setbacks happen. What matters is that you're getting back on track.

Your stats have been updated with escalation penalties.

Keep pushing forward! 💪`,"warning");else if(C){console.log("🔄 Quick Relapse: Calling StatManager.handleRelapse()...");const _t=await C.handleRelapse();if(console.log("🔄 Quick Relapse: StatManager.handleRelapse() result:",_t),o)try{const nt=await C.getCurrentEscalationLevel();await o.logRelapse(n.uid,{escalationLevel:nt,triggers:n.triggers||[],mood:"quick",context:"quick_action",addictionIncrease:nt===1?4:nt===2?6:8,mentalStrengthDecrease:3,triggerDefenseDecrease:3}),console.log("✅ Quick relapse also logged to Firestore for analytics")}catch(nt){console.warn("⚠️ Could not log quick relapse to Firestore:",nt.message)}try{await new Promise(Wt=>setTimeout(Wt,100));const{ref:nt,get:Te}=await be(()=>import("./index.esm-eba9a326.js"),[]),rt=await Te(nt(q,`users/${n.uid}/stats`));if(rt.exists()){const Wt=rt.val();console.log("🔍 Quick Relapse: VERIFICATION - Firebase stats immediately after StatManager:",Wt)}else console.log("❌ Quick Relapse: VERIFICATION - No stats found in Firebase!")}catch(nt){console.error("❌ Quick Relapse: VERIFICATION failed:",nt)}try{const nt=await C.getCurrentEscalationLevel();let Te=0;switch(nt){case 1:Te=4;break;case 2:Te=6;break;default:Te=8;break}ee("💔 Relapse Logged",`It's okay, setbacks happen. What matters is that you're getting back on track.

📊 Stat Changes:
• Addiction: +${Te} points
• Mental Strength: -3 points
• Trigger Defense: -3 points

Your journey continues! 💪`,"warning")}catch(nt){console.warn("Could not get escalation level for message:",nt),ee("💔 Relapse Logged",`It's okay, setbacks happen. What matters is that you're getting back on track.

Your stats have been updated. Keep pushing forward! 💪`,"warning")}}else console.error("❌ Quick Relapse: StatManager not available!"),ee("⚠️ Service Unavailable","Stats service is not available. Your relapse has been recorded locally and will sync when the service is restored.","warning");const vt=he(q,`users/${n.uid}/profile/cravingStats`),Be={resisted:T.resisted,relapses:T.relapses+1,lastUpdated:oe};await De(vt,Be),K(Be),console.log("🔄 Quick Relapse: Triggering stats refresh..."),typeof refreshStats=="function"?(refreshStats(),setTimeout(()=>{console.log("🔄 Quick Relapse: Secondary stats refresh..."),refreshStats()},1500)):console.log("ℹ️ Quick Relapse: refreshStats function not available in this context (will refresh when returning to Arena)")}const qe=JSON.parse(localStorage.getItem(`cravings_${n.uid}`)||"[]");qe.push({strength:0,mood:"quick",context:"quick_action",outcome:"relapsed",timestamp:oe,date:Ce}),localStorage.setItem(`cravings_${n.uid}`,JSON.stringify(qe));const Oe={resisted:T.resisted,relapses:T.relapses+1,lastUpdated:oe};localStorage.setItem(`cravingStats_${n.uid}`,JSON.stringify(Oe)),K(Oe)}catch(oe){console.error("Error recording quick relapse:",oe),ee("💔 Relapse Logged",`It's okay, setbacks happen. What matters is that you're getting back on track.

Your progress has been recorded locally and will sync when the connection is restored.

Keep pushing forward! 💪`,"warning")}},H=async(oe,Ce=30)=>{try{if(!oe)return null;const{ref:qe,get:Oe,query:he,orderByChild:De,startAt:Ke,endAt:Tt}=await be(()=>import("./index.esm-eba9a326.js"),[]),yt=new Date,vt=new Date(yt.getTime()-Ce*24*60*60*1e3),Be=qe(q,`users/${oe}/cravings`),_t=await Oe(Be);if(!_t.exists())return{totalCravings:0,resistedCount:0,relapseCount:0,averageStrength:0,commonMoods:[],commonContexts:[],timeOfDayPatterns:{},weeklyTrends:{},insights:[]};const Te=Object.values(_t.val()||{}).filter(at=>{const lt=new Date(at.timestamp);return lt>=vt&&lt<=yt});if(Te.length===0)return{totalCravings:0,resistedCount:0,relapseCount:0,averageStrength:0,commonMoods:[],commonContexts:[],timeOfDayPatterns:{},weeklyTrends:{},insights:[]};const rt=Te.filter(at=>at.outcome==="resisted").length,Wt=Te.filter(at=>at.outcome==="relapsed").length,rn=Te.length,Sn=Te.reduce((at,lt)=>at+(lt.strength||0),0)/rn,dr={},Wn={},it={},Vt={};Te.forEach(at=>{at.mood&&(dr[at.mood]=(dr[at.mood]||0)+1),at.context&&(Wn[at.context]=(Wn[at.context]||0)+1),at.timeOfDay&&(it[at.timeOfDay]=(it[at.timeOfDay]||0)+1);const lt=new Date(at.timestamp),Tn=`${lt.getFullYear()}-W${Math.ceil((lt.getDate()+new Date(lt.getFullYear(),0,1).getDay())/7)}`;Vt[Tn]=(Vt[Tn]||0)+1});const br=Object.entries(dr).sort(([,at],[,lt])=>lt-at).slice(0,3).map(([at,lt])=>({mood:at,count:lt})),Wo=Object.entries(Wn).sort(([,at],[,lt])=>lt-at).slice(0,3).map(([at,lt])=>({context:at,count:lt})),Gr=[];return rt>Wt&&Gr.push("You're successfully resisting more cravings than giving in - great job!"),Sn>7&&Gr.push("Your cravings tend to be high intensity. Consider developing stronger coping strategies for intense moments."),it.afternoon>it.morning&&it.afternoon>it.evening&&Gr.push("Afternoons seem to be your most challenging time. Consider planning activities or support during this period."),br.length>0&&br[0].count>rn*.4&&Gr.push(`You often experience cravings when feeling ${br[0].mood}. This might be a key trigger to address.`),{totalCravings:rn,resistedCount:rt,relapseCount:Wt,averageStrength:Math.round(Sn*10)/10,successRate:rn>0?Math.round(rt/rn*100):0,commonMoods:br,commonContexts:Wo,timeOfDayPatterns:it,weeklyTrends:Vt,insights:Gr,dateRange:{start:vt.toDateString(),end:yt.toDateString(),days:Ce}}}catch(qe){return console.error("Error getting craving insights:",qe),null}},ve=async(oe,Ce="json")=>{try{if(!oe)return null;const{ref:qe,get:Oe}=await be(()=>import("./index.esm-eba9a326.js"),[]),he=qe(q,`users/${n.uid}/cravings`),De=await Oe(he);if(!De.exists())return console.log("No craving data to export"),null;const Ke=Object.values(De.val()||{});if(Ce==="json"){const Tt=JSON.stringify(Ke,null,2),yt=new Blob([Tt],{type:"application/json"}),vt=URL.createObjectURL(yt),Be=document.createElement("a");return Be.href=vt,Be.download=`craving-data-${oe}-${new Date().toISOString().split("T")[0]}.json`,Be.click(),URL.revokeObjectURL(vt),console.log(`Exported ${Ke.length} craving records for user ${oe}`),Ke.length}return Ke.length}catch(qe){return console.error("Error exporting craving data:",qe),null}},He=async()=>{if(!(n!=null&&n.uid)){console.log("No user logged in");return}console.log("🧪 Testing craving insights...");const oe=await H(n.uid,30);oe?(console.log("📊 Craving Insights:",oe),w({title:"📊 Your Craving Insights",message:`Last 30 days:

Total cravings: ${oe.totalCravings}
Successfully resisted: ${oe.resistedCount}
Relapses: ${oe.relapseCount}
Success rate: ${oe.successRate}%
Average intensity: ${oe.averageStrength}/10

Top mood triggers: ${oe.commonMoods.map(Ce=>`${Ce.mood} (${Ce.count})`).join(", ")}
Top contexts: ${oe.commonContexts.map(Ce=>`${Ce.context} (${Ce.count})`).join(", ")}

Insights:
${oe.insights.join(`
`)}`,type:"info"}),g(!0)):(console.log("No insights available"),w({title:"📊 No Data Yet",message:"Start logging cravings to see insights and patterns!",type:"info"}),g(!0))};return d.jsx("div",{className:"min-h-screen bg-gradient-to-br from-slate-900 via-blue-900 to-slate-900 py-8 pb-20",children:d.jsxs("div",{className:"max-w-2xl mx-auto px-4",children:[d.jsx("div",{className:"mb-8",children:d.jsxs("div",{className:"flex justify-start gap-3",children:[d.jsx("button",{onClick:t,className:"px-6 py-3 bg-slate-600 hover:bg-slate-500 text-white rounded-lg transition-colors flex items-center gap-2",children:"← Back to Login"}),!1]})}),d.jsxs("div",{className:"bg-slate-800/30 rounded-2xl p-8 mb-8 border border-slate-600/30 shadow-xl",children:[d.jsx("div",{className:"mb-8",children:d.jsx("button",{onClick:Ae,className:"w-full bg-gradient-to-r from-orange-400 via-amber-500 to-orange-500 hover:from-orange-500 hover:via-amber-600 hover:to-orange-600 text-white font-semibold py-5 px-6 rounded-2xl text-lg transition-all duration-300 transform hover:scale-102 shadow-2xl border border-orange-300/30 hover:border-orange-300/50",children:d.jsxs("div",{className:"flex items-center justify-center gap-3",children:[d.jsx("span",{className:"text-xl",children:"⚠️"}),d.jsx("span",{children:"I feel like vaping"})]})})}),d.jsxs("div",{className:"grid grid-cols-2 gap-6",children:[d.jsx("button",{onClick:de,className:"bg-slate-700/50 hover:bg-slate-600/50 text-slate-200 font-medium py-3 px-5 rounded-full transition-all duration-300 transform hover:scale-105 shadow-lg border border-slate-500/30 hover:border-slate-400/50",children:d.jsxs("div",{className:"flex items-center justify-center gap-2",children:[d.jsx("span",{className:"text-green-400",children:"✅"}),d.jsx("span",{children:"I resisted craving"})]})}),d.jsx("button",{onClick:Ee,className:"bg-slate-700/50 hover:bg-slate-600/50 text-slate-200 font-medium py-3 px-5 rounded-full transition-all duration-300 transform hover:scale-105 shadow-lg border border-slate-500/30 hover:border-slate-400/50",children:d.jsxs("div",{className:"flex items-center justify-center gap-2",children:[d.jsx("span",{className:"text-red-400",children:"❌"}),d.jsx("span",{children:"I relapsed"})]})})]})]}),d.jsxs("div",{className:"bg-slate-800/30 rounded-2xl p-6 mb-8 border border-slate-600/30 shadow-lg",children:[d.jsx("h2",{className:"text-lg font-medium text-slate-200 mb-6 text-center",children:"📊 This Week"}),d.jsxs("div",{className:"grid grid-cols-2 gap-6",children:[d.jsxs("div",{className:"text-center p-5 bg-slate-700/30 rounded-xl border border-slate-500/20 hover:border-slate-400/40 transition-all duration-300",children:[d.jsx("div",{className:"text-2xl mb-3 text-green-400",children:"🎯"}),d.jsx("p",{className:"text-2xl font-semibold text-white mb-1",children:T.resisted}),d.jsx("p",{className:"text-sm text-slate-300",children:"Cravings Resisted"})]}),d.jsxs("div",{className:"text-center p-5 bg-slate-700/30 rounded-xl border border-slate-500/20 hover:border-slate-400/40 transition-all duration-300",children:[d.jsx("div",{className:"text-2xl mb-3 text-red-400",children:"💔"}),d.jsx("p",{className:"text-2xl font-semibold text-white mb-1",children:T.relapses}),d.jsx("p",{className:"text-sm text-slate-300",children:"Relapses"})]})]})]}),d.jsx("div",{className:"bg-slate-800/30 rounded-2xl p-6 mb-8 border border-slate-600/30 shadow-lg",children:d.jsxs("div",{className:"text-center",children:[d.jsx("h2",{className:"text-lg font-medium text-slate-200 mb-6",children:"🎮 Distract Yourself"}),d.jsx("div",{className:"flex justify-center",children:d.jsx("button",{onClick:ie,className:"w-full max-w-xs bg-slate-700/30 hover:bg-slate-600/40 text-slate-200 font-medium py-4 px-6 rounded-xl text-lg transition-all duration-300 transform hover:scale-105 border border-slate-500/20 hover:border-slate-400/40 shadow-lg",children:"🐍 Play Snake"})})]})}),d.jsx("div",{className:"bg-slate-800/30 rounded-2xl p-6 mb-8 border border-slate-600/30 shadow-lg",children:d.jsxs("div",{className:"text-center",children:[d.jsx("h2",{className:"text-lg font-medium text-slate-200 mb-6",children:"📊 Data Analysis"}),d.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[d.jsx("button",{onClick:He,className:"bg-blue-600/30 hover:bg-blue-500/40 text-blue-200 font-medium py-3 px-4 rounded-xl transition-all duration-300 transform hover:scale-105 border border-blue-500/20 hover:border-blue-400/40 shadow-lg",children:"🔍 View Insights"}),d.jsx("button",{onClick:()=>ve(n==null?void 0:n.uid,"json"),className:"bg-green-600/30 hover:bg-green-500/40 text-green-200 font-medium py-3 px-4 rounded-xl transition-all duration-300 transform hover:scale-105 border border-green-500/20 hover:border-green-400/40 shadow-lg",children:"📥 Export Data"})]})]})}),d.jsxs("div",{className:"bg-slate-800/30 rounded-2xl p-6 border border-slate-600/30 shadow-lg",children:[d.jsx("h2",{className:"text-lg font-medium text-slate-200 mb-6 text-center",children:"⚡ Quick Actions"}),d.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[d.jsx("button",{onClick:()=>I(!0),className:"bg-slate-700/30 hover:bg-slate-600/40 text-slate-200 font-medium py-4 px-4 rounded-xl transition-all duration-300 border border-slate-500/20 hover:border-slate-400/40 hover:scale-105 shadow-lg",children:"💧 Hydration"}),d.jsx("button",{onClick:()=>P(!0),className:"bg-slate-700/30 hover:bg-slate-600/40 text-slate-200 font-medium py-4 px-4 rounded-xl transition-all duration-300 border border-slate-500/20 hover:border-slate-400/40 hover:scale-105 shadow-lg",children:"🫁 Breathe"}),d.jsx("button",{onClick:async()=>{if(ee("🚶‍♂️ Walk",`Take a 5-minute walk:

Physical activity releases endorphins that can help reduce cravings.

Walk around your room or step outside if possible.`),o)try{await o.logPhysicalActivity(n.uid,{type:"walk",duration:5,intensity:"moderate",triggerContext:"craving-triggered",location:"indoor/outdoor"}),console.log("✅ Physical activity (walk) logged to Firestore for analytics")}catch(oe){console.warn("⚠️ Could not log physical activity to Firestore:",oe.message)}},className:"bg-slate-700/30 hover:bg-slate-600/40 text-slate-200 font-medium py-4 px-4 rounded-xl transition-all duration-300 border border-slate-500/20 hover:border-slate-400/40 hover:scale-105 shadow-lg",children:"🚶‍♂️ Walk"}),d.jsx("button",{onClick:async()=>{if(ee("🧘‍♀️ Meditate",`Quick Meditation:

1. Close your eyes
2. Focus on your breath
3. Count to 10 slowly
4. Repeat 3 times

This helps calm your mind and reduce stress.`),o)try{await o.logMeditation(n.uid,{type:"mindfulness",duration:2,triggerContext:"craving-triggered",completed:!0}),console.log("✅ Meditation (quick) logged to Firestore for analytics")}catch(oe){console.warn("⚠️ Could not log meditation to Firestore:",oe.message)}},className:"bg-slate-700/30 hover:bg-slate-600/40 text-slate-200 font-medium py-4 px-4 rounded-xl transition-all duration-300 border border-slate-500/20 hover:border-slate-400/40 hover:scale-105 shadow-lg",children:"🧘‍♀️ Meditate"})]})]}),a&&u&&d.jsx(w8,{gameType:u,onClose:le}),d.jsx(v8,{isOpen:f,onClose:()=>g(!1),title:y.title,message:y.message,type:y.type}),A&&d.jsx(E8,{isOpen:A,onClose:()=>I(!1),onLogWater:ce,currentWater:R,userId:n.uid}),V&&d.jsx(t8,{isOpen:V,onClose:()=>P(!1),onComplete:s,onNavigateToCravingSupport:()=>i("craving-support")}),S&&d.jsx(I8,{isOpen:S,onClose:()=>v(!1),step:b,cravingData:E,setCravingData:N,onNext:$e,onPrev:xe,onComplete:te,dailyCravingLogs:mt})]})})},I8=({isOpen:n,onClose:e,step:t,cravingData:r,setCravingData:s,onNext:i,onPrev:o,onComplete:a,dailyCravingLogs:l})=>{const u=y=>y<=3?{text:"text-green-400",slider:"#22c55e",shadow:"rgba(74, 222, 128, 0.5)",label:"Low",effect:"craving-low",thumbClass:"slider-thumb-green"}:y<=7?{text:"text-orange-400",slider:"#fbbf24",shadow:"rgba(249, 115, 22, 0.5)",label:"Medium",effect:"craving-medium",thumbClass:"slider-thumb-orange"}:{text:"text-red-400",slider:"#ef4444",shadow:"rgba(239, 68, 68, 0.5)",label:"High",effect:"craving-high",thumbClass:"slider-thumb-red"},h=[{id:"stressed",icon:"😰",label:"Stressed"},{id:"lonely",icon:"😔",label:"Lonely"},{id:"happy",icon:"😊",label:"Happy"},{id:"bored",icon:"😐",label:"Bored"},{id:"excited",icon:"🤩",label:"Excited"},{id:"down",icon:"😞",label:"Down"},{id:"angry",icon:"😠",label:"Angry"},{id:"anxious",icon:"😰",label:"Anxious"}],f=[{id:"break",icon:"☕",label:"I'm taking a break"},{id:"partying",icon:"🎉",label:"I'm partying"},{id:"drinking",icon:"🍺",label:"I'm drinking alcohol"},{id:"car",icon:"🚗",label:"I'm in a car"},{id:"coffee",icon:"☕",label:"I'm drinking coffee"},{id:"eating",icon:"🍽️",label:"I've just finished eating"},{id:"intimate",icon:"💕",label:"I've made love"},{id:"tv",icon:"📺",label:"I'm watching TV"},{id:"wake",icon:"🌅",label:"I've just woken up"}],g=()=>{switch(t){case 1:return d.jsx("div",{className:"text-center",children:d.jsx("div",{className:"mb-8",children:(()=>{const y=u(r.strength);return d.jsxs(d.Fragment,{children:[d.jsx("div",{className:`text-6xl font-bold mb-2 ${y.text} ${y.effect}`,children:r.strength}),d.jsxs("div",{className:`text-lg font-medium mb-6 ${y.text}`,children:[y.label," Craving"]}),d.jsx("input",{type:"range",min:"0",max:"10",value:r.strength,onChange:w=>s({...r,strength:parseInt(w.target.value)}),style:{background:`linear-gradient(to right, ${y.slider} 0%, ${y.slider} ${r.strength/10*100}%, #475569 ${r.strength/10*100}%, #475569 100%)`},className:`w-full h-4 rounded-lg appearance-none cursor-pointer slider mb-4 ${y.thumbClass}`}),d.jsxs("div",{className:"flex justify-between text-sm text-gray-400",children:[d.jsx("span",{children:"Not at all"}),d.jsx("span",{children:"Extremely"})]})]})})()})});case 2:return d.jsx("div",{className:"text-center",children:d.jsx("div",{className:"grid grid-cols-4 gap-3",children:h.map(y=>d.jsxs("button",{onClick:()=>s({...r,mood:y.id}),className:`p-4 rounded-xl border-2 transition-all duration-300 ${r.mood===y.id?"border-blue-400 bg-blue-500/20":"border-slate-600 bg-slate-700/50 hover:border-slate-500"}`,children:[d.jsx("div",{className:"text-3xl mb-2",children:y.icon}),d.jsx("div",{className:"text-xs text-gray-300",children:y.label})]},y.id))})});case 3:return d.jsx("div",{className:"text-center",children:d.jsx("div",{className:"grid grid-cols-3 gap-3",children:f.map(y=>d.jsxs("button",{onClick:()=>s({...r,context:y.id}),className:`p-4 rounded-xl border-2 transition-all duration-300 ${r.context===y.id?"border-blue-400 bg-blue-500/20":"border-slate-600 bg-slate-700/50 hover:border-slate-500"}`,children:[d.jsx("div",{className:"text-2xl mb-2",children:y.icon}),d.jsx("div",{className:"text-xs text-gray-300 text-center",children:y.label})]},y.id))})});case 4:return d.jsx("div",{className:"text-center",children:d.jsxs("div",{className:"space-y-4",children:[d.jsx("button",{onClick:()=>a("resisted"),className:"w-full bg-gradient-to-r from-green-500 to-green-600 hover:from-green-600 hover:to-green-700 text-white font-bold py-4 px-6 rounded-xl transition-all duration-300 transform hover:scale-105 shadow-lg",children:"💪 I successfully resisted"}),d.jsx("button",{onClick:()=>a("resistance_practices"),className:"w-full bg-gradient-to-r from-purple-500 to-purple-600 hover:from-purple-600 hover:to-purple-700 text-white font-bold py-4 px-6 rounded-xl transition-all duration-300 transform hover:scale-105 shadow-lg",children:"🛡️ Use resistance practices"}),d.jsx("button",{onClick:()=>a("logged"),className:"w-full bg-gradient-to-r from-blue-500 to-blue-600 hover:from-blue-600 hover:to-blue-700 text-white font-bold py-4 px-6 rounded-xl transition-all duration-300 transform hover:scale-105 shadow-lg",children:"📝 Just log this craving"}),d.jsx("button",{onClick:()=>a("relapsed"),className:"w-full bg-gradient-to-r from-red-500 to-red-600 hover:from-red-600 hover:to-red-700 text-white font-bold py-4 px-6 rounded-xl transition-all duration-300 transform hover:scale-105 shadow-lg",children:"💔 I had a relapse"})]})});default:return null}};return n?d.jsx("div",{className:"fixed inset-0 bg-black/80 backdrop-blur-sm flex items-center justify-center z-50 p-4",children:d.jsxs("div",{className:"bg-gradient-to-br from-slate-800 via-slate-700 to-slate-800 rounded-3xl p-8 max-w-lg w-full shadow-2xl border border-slate-600/50 relative overflow-hidden",children:[d.jsx("div",{className:"absolute inset-0 bg-orange-500/5 pointer-events-none"}),d.jsxs("div",{className:"relative z-10",children:[d.jsxs("div",{className:"text-center mb-6",children:[d.jsx("div",{className:"flex justify-center space-x-2 mb-3",children:[1,2,3,4].map(y=>d.jsx("div",{className:`w-3 h-3 rounded-full ${y<=t?"bg-orange-400":"bg-slate-600"}`},y))}),d.jsxs("p",{className:"text-gray-400 text-sm",children:["Step ",t," of 4"]}),d.jsxs("div",{className:"mt-2 text-xs text-gray-500",children:["Daily logs: ",l,"/2"]})]}),d.jsx("div",{className:"mb-8",children:g()}),d.jsxs("div",{className:"flex justify-between",children:[t>1&&d.jsx("button",{onClick:o,className:"px-6 py-3 bg-slate-600 hover:bg-slate-500 text-white rounded-xl transition-colors",children:"← Back"}),t<4&&d.jsx("button",{onClick:i,disabled:t===1&&r.strength===void 0||t===2&&!r.mood||t===3&&!r.context,className:"px-6 py-3 bg-orange-500 hover:bg-orange-600 disabled:bg-slate-600 disabled:cursor-not-allowed text-white rounded-xl transition-colors ml-auto",children:"Next →"})]}),d.jsx("button",{onClick:e,className:"absolute top-4 right-4 text-gray-400 hover:text-white text-2xl",children:"×"})]})]})}):null},E8=({isOpen:n,onClose:e,onLogWater:t,currentWater:r,userId:s})=>{const[i,o]=j.useState(!1),[a,l]=j.useState(0),[u,h]=j.useState(0),[f,g]=j.useState(!1),[y,w]=j.useState(!1);j.useEffect(()=>{n&&s&&C()},[n,s,r]);const C=async()=>{try{const{ref:D,get:V}=await be(()=>import("./index.esm-eba9a326.js"),[]),P=await M();l(P);const S=await A();h(S)}catch(D){console.error("Error loading hydration data:",D)}},M=async()=>{try{const{ref:D,get:V}=await be(()=>import("./index.esm-eba9a326.js"),[]);let P=0;for(let S=0;S<7;S++){const v=new Date;v.setDate(v.getDate()-S);const b=v.toDateString(),_=await V(D(q,`users/${s}/profile/daily/${b}/water`));if(_.exists()&&_.val()>0)P++;else break}return P}catch(D){return console.error("Error checking hydration streak:",D),0}},A=async()=>{try{const{ref:D,get:V}=await be(()=>import("./index.esm-eba9a326.js"),[]);let P=0;for(let S=0;S<7;S++){const v=new Date;v.setDate(v.getDate()-S);const b=v.toDateString(),_=await V(D(q,`users/${s}/profile/daily/${b}/water`));_.exists()&&_.val()>=6&&P++}return Math.min(P,3)}catch(D){return console.error("Error checking mental strength progress:",D),0}},I=()=>d.jsx("div",{className:"grid grid-cols-3 gap-4 sm:gap-6",children:[...Array(6)].map((D,V)=>{const P=V<r,S=V===r-1&&f,v=r===6&&P;return d.jsxs("div",{className:"relative w-16 h-20 sm:w-20 sm:h-24 glass-container",children:[d.jsxs("div",{className:"absolute inset-0 glass-outline overflow-hidden",children:[d.jsx("div",{className:"absolute inset-0 glass-reflection"}),P&&d.jsxs("div",{className:"absolute bottom-0 left-0 right-0 water-container",children:[d.jsxs("div",{className:`water-body ${S?"water-fill-animation":""} ${v?"water-celebration":""}`,style:{height:`${Math.min(100,(V+1)*16.67)}%`,background:`linear-gradient(to bottom, 
                          ${v?"#4ade80, #22c55e, #16a34a":"#60a5fa, #3b82f6, #2563eb"}
                        )`},children:[d.jsxs("div",{className:`water-surface ${S?"water-surface-pour":"water-surface-gentle"}`,children:[d.jsx("div",{className:"water-wave-1"}),d.jsx("div",{className:"water-wave-2"}),d.jsx("div",{className:"water-wave-3"})]}),d.jsx("div",{className:"water-bubbles",children:[...Array(3+V)].map((b,_)=>d.jsx("div",{className:`water-bubble bubble-${_%3+1}`,style:{left:`${20+_*15%60}%`,animationDelay:`${_*.5}s`}},_))}),d.jsx("div",{className:"water-shine"})]}),S&&d.jsxs("div",{className:"water-pour-overlay",children:[d.jsx("div",{className:"water-stream"}),d.jsx("div",{className:"water-splash"})]})]}),d.jsxs("div",{className:"glass-rim",children:[d.jsx("div",{className:"glass-rim-highlight"}),d.jsx("div",{className:"glass-rim-shadow"})]}),d.jsx("div",{className:"glass-side-reflection"}),d.jsx("div",{className:"glass-base-shadow"}),v&&d.jsx("div",{className:"glass-completion-glow"})]}),S&&d.jsxs("div",{className:"water-drop-container",children:[d.jsx("div",{className:"water-drop water-drop-1"}),d.jsx("div",{className:"water-drop water-drop-2"}),d.jsx("div",{className:"water-drop water-drop-3"})]}),v&&d.jsx("div",{className:"glass-sparkles",children:[...Array(6)].map((b,_)=>d.jsx("div",{className:`completion-sparkle sparkle-${_+1}`},_))})]},V)})}),R=async()=>{!s||f||r>=6||(g(!0),t(),setTimeout(async()=>{g(!1),await C(),r+1>=6&&(o(!0),setTimeout(()=>o(!1),3e3))},1e3))};return!n||!s?null:d.jsx("div",{className:"fixed inset-0 bg-black/80 backdrop-blur-sm flex items-center justify-center z-50 p-4",children:d.jsxs("div",{className:"bg-gradient-to-br from-slate-800 via-slate-700 to-slate-800 rounded-3xl p-8 max-w-lg w-full shadow-2xl border border-slate-600/50 relative overflow-hidden",children:[i&&d.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-blue-500/10 via-purple-500/10 to-blue-500/10 pointer-events-none animate-pulse"}),d.jsx("div",{className:"absolute inset-0 bg-blue-500/5 pointer-events-none"}),d.jsxs("div",{className:"relative z-10",children:[d.jsxs("div",{className:"flex items-center justify-center mb-6 relative",children:[I(),i&&d.jsxs(d.Fragment,{children:[d.jsx("div",{className:"celebration-sparkles",children:[...Array(20)].map((D,V)=>d.jsx("div",{className:`floating-sparkle sparkle-${V+1}`,style:{animationDelay:`${V*.1}s`,left:`${Math.random()*100}%`,top:`${Math.random()*100}%`},children:["✨","🌟","💫","⭐","✨"][V%5]},V))}),d.jsx("div",{className:"confetti-container",children:[...Array(50)].map((D,V)=>d.jsx("div",{className:`confetti-piece confetti-${V+1}`,style:{animationDelay:`${V*.02}s`,left:`${Math.random()*100}%`,backgroundColor:["#60a5fa","#34d399","#fbbf24","#f472b6","#a78bfa"][V%5]}},V))}),d.jsx("div",{className:"energy-waves",children:[...Array(3)].map((D,V)=>d.jsx("div",{className:`energy-wave wave-${V+1}`,style:{animationDelay:`${V*.3}s`}},V))}),d.jsxs("div",{className:"celebration-text",children:[d.jsx("div",{className:"celebration-main",children:"🎉 LEGEND! 🎉"}),d.jsx("div",{className:"celebration-sub",children:"HYDRATION MASTER"})]})]})]}),d.jsx("div",{className:"text-center mb-6",children:d.jsxs("div",{className:"bg-gradient-to-r from-blue-500/20 to-blue-600/20 border border-blue-500/30 rounded-2xl p-6",children:[d.jsx("p",{className:"text-gray-300 text-lg mb-3",children:"Glasses today"}),d.jsxs("p",{className:"text-6xl font-black text-blue-400 mb-2",children:[r,"/6"]}),d.jsx("p",{className:"text-blue-200 text-sm font-medium",children:r===6?"🎉 You are a legend of hydration!":`${r} of 6 glasses completed`})]})}),d.jsx("div",{"aria-live":"polite",className:"sr-only",children:r===6?"You are a legend of hydration for today":`${r} of 6 glasses completed today`}),d.jsxs("div",{className:"grid grid-cols-2 gap-4 mb-8",children:[d.jsx("div",{className:"text-center",children:d.jsxs("div",{className:"bg-gradient-to-r from-orange-500/20 to-red-500/20 border border-orange-500/30 rounded-2xl px-4 py-3 h-24 flex flex-col justify-center",children:[d.jsx("span",{className:"text-xl mb-1",children:"🔥"}),d.jsxs("div",{children:[d.jsx("p",{className:"text-orange-200 text-xs font-medium",children:"Hydration Streak"}),d.jsxs("p",{className:"text-lg font-bold text-orange-300",children:[a," days"]})]})]})}),d.jsx("div",{className:"text-center",children:d.jsxs("div",{className:"bg-gradient-to-r from-purple-500/20 to-purple-600/20 border border-purple-500/30 rounded-2xl px-4 py-3 h-24 flex flex-col justify-center",children:[d.jsxs("div",{className:"flex items-center justify-center gap-2 mb-1",children:[d.jsx("p",{className:"text-purple-200 text-xs font-medium",children:"Mental Strength"}),d.jsx("button",{onClick:()=>w(!y),className:"text-purple-300 hover:text-purple-200 transition-colors",title:"Learn more about Mental Strength",children:"ℹ️"})]}),y&&d.jsx("div",{className:"bg-slate-700/90 border border-purple-400/30 rounded-lg p-2 mb-2 text-xs text-purple-100",children:"Staying hydrated for 3 days straight adds 1 point to Mental Strength stat"}),d.jsx("div",{className:"flex justify-center items-center gap-1 mb-1",children:[...Array(3)].map((D,V)=>d.jsx("div",{className:`w-2 h-2 rounded-full transition-all duration-300 ${V<u?"bg-purple-400 shadow-lg shadow-purple-400/50":"bg-slate-600 border border-slate-500"}`},V))}),d.jsxs("p",{className:"text-purple-200 text-xs",children:[u,"/3 days"]})]})})]}),d.jsxs("div",{className:"flex flex-col gap-4",children:[d.jsx("button",{onClick:R,disabled:r>=6||f,className:"w-full py-4 px-6 rounded-2xl font-bold text-lg bg-blue-500 hover:bg-blue-600 text-white transition-all duration-300 disabled:bg-gray-600 disabled:cursor-not-allowed",children:r>=6?"🎉 You are a legend of hydration!":f?"💧 Logging...":"💧 Log Water"}),d.jsx("button",{onClick:e,className:"bg-slate-600/50 hover:bg-slate-600 text-gray-300 hover:text-white font-medium py-3 px-6 rounded-xl transition-all duration-300",children:"Done"})]})]})]})})},S8=({user:n,onNavigate:e})=>{const[t,r]=j.useState(null),[s,i]=j.useState(!1),[o,a]=j.useState(!1),[l,u]=j.useState(!1),[h,f]=j.useState(!1),[g,y]=j.useState(null),[w,C]=j.useState(0),[M,A]=j.useState(null),[I,R]=j.useState(!1),[D,V]=j.useState([]),[P,S]=j.useState(null);j.useEffect(()=>{if(!(n!=null&&n.uid))return;(async()=>{try{const H=new Lm(q,n.uid);await H.initialize(),S(H)}catch(H){console.error("Error initializing StatManager:",H)}})();const de=async()=>{try{const{ref:H,get:ve,onValue:He}=await be(()=>import("./index.esm-eba9a326.js"),[]),oe=H(q,`users/${n.uid}/profile/relapseDate`),Ce=await ve(oe);Ce.exists()&&r(new Date(Ce.val()));const qe=H(q,`users/${n.uid}/profile/scheduledTriggers`),Oe=await ve(qe);Oe.exists()&&V(Oe.val());const he=new Date().toDateString(),De=H(q,`users/${n.uid}/profile/daily/${he}/water`),Ke=He(De,Te=>{Te.exists()&&C(Te.val()||0)}),Tt=H(q,`users/${n.uid}/profile/daily/${he}/mood`),yt=He(Tt,Te=>{Te.exists()&&A(Te.val())}),vt=H(q,`users/${n.uid}/profile/daily/${he}/breathing`),Be=He(vt,Te=>{Te.exists()&&R(Te.val()||!1)}),_t=H(q,`users/${n.uid}/profile/scheduledTriggers`),nt=He(_t,Te=>{Te.exists()&&V(Te.val()||[])});return()=>{Ke(),yt(),Be(),nt()}}catch(H){console.error("Error loading profile data from Firebase:",H),Ee()}},Ee=()=>{const H=localStorage.getItem("quitCoachRelapseDate");H&&r(new Date(H));const ve=new Date().toDateString(),He=localStorage.getItem(`water_${n.uid}_${ve}`),oe=localStorage.getItem(`mood_${n.uid}_${ve}`),Ce=localStorage.getItem(`breathing_${n.uid}_${ve}`);He&&C(parseInt(He)),oe&&A(JSON.parse(oe)),Ce&&R(Ce==="true");const qe=localStorage.getItem("scheduledTriggers");qe&&V(JSON.parse(qe))};de()},[n==null?void 0:n.uid]),j.useEffect(()=>{P&&P.trackLoggingActivity()},[P]),j.useEffect(()=>{if(!(n!=null&&n.uid))return;(async()=>{try{const{ref:de,get:Ee,set:H}=await be(()=>import("./index.esm-eba9a326.js"),[]),ve=de(q,`users/${n.uid}/profile`),He=await Ee(ve);if(!He.exists()||Object.keys(He.val()).length===0){console.log("Migrating localStorage data to Firebase...");const oe=localStorage.getItem("quitCoachRelapseDate");oe&&(await H(de(q,`users/${n.uid}/profile/relapseDate`),oe),r(new Date(oe)));const Ce=parseInt(localStorage.getItem("cravingWins")||0);Ce>0&&await H(de(q,`users/${n.uid}/profile/cravingsResisted`),Ce);for(let Oe=0;Oe<7;Oe++){const he=new Date;he.setDate(he.getDate()-Oe);const De=he.toDateString(),Ke=localStorage.getItem(`water_${n.uid}_${De}`);Ke&&await H(de(q,`users/${n.uid}/profile/daily/${De}/water`),parseInt(Ke))}for(let Oe=0;Oe<7;Oe++){const he=new Date;he.setDate(he.getDate()-Oe);const De=he.toDateString(),Ke=localStorage.getItem(`mood_${n.uid}_${De}`);Ke&&await H(de(q,`users/${n.uid}/profile/daily/${De}/mood`),JSON.parse(Ke))}for(let Oe=0;Oe<7;Oe++){const he=new Date;he.setDate(he.getDate()-Oe);const De=he.toDateString(),Ke=localStorage.getItem(`breathing_${n.uid}_${De}`);Ke&&await H(de(q,`users/${n.uid}/profile/daily/${De}/breathing`),Ke==="true")}const qe=localStorage.getItem("scheduledTriggers");if(qe){const Oe=JSON.parse(qe);await H(de(q,`users/${n.uid}/profile/scheduledTriggers`),Oe),V(Oe)}console.log("localStorage data migration to Firebase completed")}}catch(de){console.error("Error migrating localStorage data to Firebase:",de)}})()},[n==null?void 0:n.uid]);const v=()=>t&&t>((n==null?void 0:n.quitDate)||new Date(0))?t:(n==null?void 0:n.quitDate)||new Date,b=()=>{const te=new Date,de=new Date(te);de.setHours(24,0,0,0);const Ee=de-te,H=Math.floor(Ee/(1e3*60*60)),ve=Math.floor(Ee%(1e3*60*60)/(1e3*60)),He=Math.floor(Ee%(1e3*60)/1e3);return{hours:H,minutes:ve,seconds:He}},[_,E]=j.useState(b()),[N,T]=j.useState(0),[K,mt]=j.useState(0),[Me,qt]=j.useState(0),[k,$]=j.useState(0);j.useEffect(()=>{const te=setInterval(()=>{E(b());const de=v(),H=new Date-de,ve=Math.floor(H/(1e3*60*60*24)),He=Math.floor(H%(1e3*60*60*24)/(1e3*60*60)),oe=Math.floor(H%(1e3*60*60)/(1e3*60)),Ce=Math.floor(H%(1e3*60)/1e3);T(ve),mt(He),qt(oe),$(Ce)},1e3);return()=>clearInterval(te)},[t,n==null?void 0:n.quitDate]);const Q=async(te,de)=>{if(!(n!=null&&n.uid))return!1;try{const{ref:Ee,set:H}=await be(()=>import("./index.esm-eba9a326.js"),[]),ve=Ee(q,`users/${n.uid}/profile/${te}`);return await H(ve,de),!0}catch(Ee){return console.error("Error saving to Firebase:",Ee),!1}},ee=async()=>{const te=new Date;r(te),P&&await P.handleRelapse(),await Q("relapseDate",te.toISOString())||localStorage.setItem("quitCoachRelapseDate",te.toISOString())},le=(()=>{const te=new Date,de=te.getDay(),Ee=de===0?6:de-1,H=[{name:"Mon",color:"bg-slate-700"},{name:"Tue",color:"bg-slate-700"},{name:"Wed",color:"bg-slate-700"},{name:"Thu",color:"bg-slate-700"},{name:"Fri",color:"bg-slate-700"},{name:"Sat",color:"bg-slate-700"},{name:"Sun",color:"bg-slate-700"}];for(let ve=0;ve<=Ee;ve++)H[ve].color="bg-green-500";return t&&t.toDateString()===te.toDateString()&&(H[Ee].color="bg-red-500"),H})(),ce=async te=>{C(te);const de=new Date().toDateString();P&&await P.handleHydrationUpdate(te),await Q(`daily/${de}/water`,te)||localStorage.setItem(`water_${de}`,te.toString()),i(!1)},Ae=async te=>{A(te);const de=new Date().toDateString();await Q(`daily/${de}/mood`,te)||localStorage.setItem(`mood_${de}`,JSON.stringify(te)),a(!1)},$e=async(te,de,Ee)=>{const H={day:te,triggerType:de,time:Ee,id:Date.now()},ve=[...D,H];V(ve),P&&await P.handleTriggerPlanning(),await Q("scheduledTriggers",ve)||localStorage.setItem("scheduledTriggers",JSON.stringify(ve)),u(!1)},xe=async()=>{P&&await P.handleTriggerListUpdate()};return d.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-slate-900 via-blue-900 to-slate-900 pb-20",children:[d.jsxs("div",{className:"flex items-center justify-between p-4 pt-16",children:[d.jsxs("div",{className:"flex items-center gap-3",children:[d.jsx("div",{className:"w-12 h-12 bg-gradient-to-br from-blue-400 to-blue-600 rounded-full flex items-center justify-center",children:n!=null&&n.avatar?d.jsx("img",{src:n.avatar,alt:"Avatar",className:"w-full h-full object-cover rounded-full"}):d.jsx("span",{className:"text-white font-bold text-lg",children:n!=null&&n.heroName?n.heroName.charAt(0).toUpperCase():"H"})}),d.jsxs("div",{children:[d.jsx("p",{className:"text-white text-lg",children:"Hello,"}),d.jsx("p",{className:"text-white text-2xl font-bold",children:(n==null?void 0:n.heroName)||"Hero"})]})]}),d.jsx("div",{className:"bg-yellow-500 px-3 py-1 rounded-full",children:d.jsx("span",{className:"font-bold text-slate-900",children:N})})]}),d.jsxs("div",{className:"px-4 space-y-6",children:[d.jsx("div",{className:"mb-6",children:d.jsxs("button",{onClick:ee,className:"w-full bg-gradient-to-r from-red-600 to-orange-600 hover:from-red-700 hover:to-orange-700 text-white font-bold py-4 px-6 rounded-xl transition-all duration-300 shadow-lg hover:shadow-xl transform hover:scale-105",children:[d.jsxs("div",{className:"flex items-center justify-center gap-3",children:[d.jsx("span",{className:"text-2xl",children:"⚠️"}),d.jsx("span",{className:"text-lg",children:"RELAPSE"}),d.jsx("span",{className:"text-2xl",children:"⚠️"})]}),d.jsx("p",{className:"text-sm opacity-90 mt-1",children:"Reset progress and start over"})]})}),d.jsxs("div",{className:"bg-slate-800/50 rounded-xl p-4",children:[d.jsxs("div",{className:"flex items-center justify-between mb-4",children:[d.jsx("h2",{className:"text-white text-xl font-bold",children:"My week"}),d.jsxs("div",{className:"bg-green-500 px-3 py-1 rounded-full flex items-center gap-1",children:[d.jsx("span",{className:"text-white text-sm",children:"✓"}),d.jsx("span",{className:"text-white font-bold",children:"0"})]})]}),d.jsx("div",{className:"flex justify-between items-center mb-4",children:le.map((te,de)=>d.jsxs("div",{className:"text-center",children:[d.jsx("div",{className:`w-8 h-8 rounded-full mb-1 ${te.color}`}),d.jsx("p",{className:"text-gray-400 text-xs",children:te.name})]},te.name))})]}),d.jsxs("div",{className:"bg-slate-800/50 rounded-xl p-4",children:[d.jsx("h3",{className:"text-white text-lg font-semibold mb-2",children:"Remaining time for Today"}),d.jsxs("div",{className:"text-center",children:[d.jsxs("div",{className:"text-white text-3xl font-bold",children:[_.hours.toString().padStart(2,"0"),":",_.minutes.toString().padStart(2,"0"),":",_.seconds.toString().padStart(2,"0")]}),d.jsx("p",{className:"text-gray-400 text-sm",children:"Countdown to midnight"})]})]}),d.jsxs("div",{children:[d.jsx("h2",{className:"text-white text-2xl font-bold mb-4",children:"My progress"}),d.jsxs("div",{className:"bg-slate-800/50 rounded-xl p-4 mb-4",children:[d.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[d.jsx("span",{className:"text-yellow-400 text-lg",children:"⏰"}),d.jsx("span",{className:"text-gray-300",children:"Clean for"})]}),d.jsxs("div",{className:"flex items-baseline gap-4",children:[d.jsxs("div",{className:"text-center",children:[d.jsx("div",{className:"text-white text-3xl font-bold",children:N.toString().padStart(2,"0")}),d.jsx("div",{className:"text-gray-400 text-sm",children:"days"})]}),d.jsxs("div",{className:"text-center",children:[d.jsx("div",{className:"text-white text-3xl font-bold",children:K.toString().padStart(2,"0")}),d.jsx("div",{className:"text-gray-400 text-sm",children:"hours"})]}),d.jsxs("div",{className:"text-center",children:[d.jsx("div",{className:"text-white text-3xl font-bold",children:Me.toString().padStart(2,"0")}),d.jsx("div",{className:"text-gray-400 text-sm",children:"minutes"})]}),d.jsxs("div",{className:"text-center",children:[d.jsx("div",{className:"text-white text-2xl font-bold animate-pulse",children:k.toString().padStart(2,"0")}),d.jsx("div",{className:"text-gray-400 text-sm",children:"seconds"})]})]}),t&&d.jsx("div",{className:"mt-3 text-center",children:d.jsxs("p",{className:"text-red-400 text-sm",children:["Last relapse: ",t.toLocaleDateString()," at ",t.toLocaleTimeString()]})})]})]}),d.jsxs("div",{children:[d.jsx("h2",{className:"text-white text-2xl font-bold mb-4",children:"Habit Tracking"}),d.jsxs("div",{className:"space-y-4",children:[d.jsx("button",{onClick:()=>i(!0),className:"w-full bg-gradient-to-r from-blue-500/20 to-blue-600/20 bg-slate-800/50 rounded-xl p-4 text-left hover:scale-105 transition-all duration-300",children:d.jsxs("div",{className:"flex items-center gap-4",children:[d.jsx("div",{className:"w-12 h-12 bg-white rounded-lg flex items-center justify-center text-xl",children:"💧"}),d.jsxs("div",{className:"flex-1",children:[d.jsx("h3",{className:"text-white font-bold text-lg",children:"Stay hydrated"}),d.jsx("p",{className:"text-gray-300 text-sm",children:w>0?`${w} glasses today`:"Tap to log water intake"})]}),d.jsx("div",{className:"text-blue-400 text-2xl",children:"→"})]})}),d.jsx("button",{onClick:()=>a(!0),className:"w-full bg-gradient-to-r from-green-500/20 to-green-600/20 bg-slate-800/50 rounded-xl p-4 text-left hover:scale-105 transition-all duration-300",children:d.jsxs("div",{className:"flex items-center gap-4",children:[d.jsx("div",{className:"w-12 h-12 bg-white rounded-lg flex items-center justify-center text-xl",children:"🌤️"}),d.jsxs("div",{className:"flex-1",children:[d.jsx("h3",{className:"text-white font-bold text-lg",children:"Mood tracking"}),d.jsx("p",{className:"text-gray-300 text-sm",children:M?`You feel ${M.name.toLowerCase()}`:"How do you feel today?"})]}),d.jsx("div",{className:"text-green-400 text-2xl",children:"→"})]})})]})]}),d.jsxs("div",{children:[d.jsx("h2",{className:"text-white text-2xl font-bold mb-4",children:"This Week's Battle Plan"}),d.jsxs("div",{className:"space-y-3",children:[d.jsx("button",{onClick:()=>u(!0),className:"w-full bg-gradient-to-r from-orange-500/20 to-orange-600/20 bg-slate-800/50 rounded-xl p-4 text-left hover:scale-105 transition-all duration-300",children:d.jsxs("div",{className:"flex items-center gap-4",children:[d.jsx("div",{className:"w-12 h-12 bg-white rounded-lg flex items-center justify-center text-xl",children:"🛡️"}),d.jsxs("div",{className:"flex-1",children:[d.jsx("h3",{className:"text-white font-bold text-lg",children:"Trigger defense planning"}),d.jsx("p",{className:"text-gray-300 text-sm",children:D.length>0?`${D.length} triggers planned`:"Plan your trigger defense strategy"})]}),d.jsx("div",{className:"text-orange-400 text-2xl",children:"→"})]})}),d.jsx("button",{onClick:xe,className:"w-full bg-gradient-to-r from-purple-500/20 to-purple-600/20 bg-slate-800/50 rounded-xl p-4 text-left hover:scale-105 transition-all duration-300",children:d.jsxs("div",{className:"flex items-center gap-4",children:[d.jsx("div",{className:"w-12 h-12 bg-white rounded-lg flex items-center justify-center text-xl",children:"📝"}),d.jsxs("div",{className:"flex-1",children:[d.jsx("h3",{className:"text-white font-bold text-lg",children:"Update trigger list"}),d.jsx("p",{className:"text-gray-300 text-sm",children:"Review and update your personal triggers for +1 Trigger Defense"})]}),d.jsx("div",{className:"text-purple-400 text-2xl",children:"→"})]})})]})]}),d.jsx("div",{children:d.jsx("h2",{className:"text-white text-2xl font-bold mb-4",children:"Benefits Monitor"})}),d.jsxs("div",{children:[d.jsx("h2",{className:"text-white text-2xl font-bold mb-4",children:"Diary"}),d.jsx("button",{onClick:()=>f(!0),className:"w-full bg-gradient-to-r from-indigo-500/20 to-indigo-600/20 bg-slate-800/50 rounded-xl p-4 text-left hover:scale-105 transition-all duration-300",children:d.jsxs("div",{className:"flex items-center gap-4",children:[d.jsx("div",{className:"w-12 h-12 bg-white rounded-lg flex items-center justify-center text-xl",children:"📅"}),d.jsxs("div",{className:"flex-1",children:[d.jsx("h3",{className:"text-white font-bold text-lg",children:"Monthly overview"}),d.jsx("p",{className:"text-gray-300 text-sm",children:"View your progress and daily activities"})]}),d.jsx("div",{className:"text-indigo-400 text-2xl",children:"→"})]})})]})]}),d.jsx(T8,{isOpen:s,onClose:()=>i(!1),onConfirm:ce,currentWater:w}),d.jsx(b8,{isOpen:o,onClose:()=>a(!1),onSelect:Ae,selectedMood:M}),d.jsx(A8,{isOpen:l,onClose:()=>u(!1),onSchedule:$e,scheduledTriggers:D}),d.jsx(C8,{isOpen:h,onClose:()=>f(!1),selectedDate:g,onDateSelect:y,dailyData:{water:w,mood:M,breathing:I,relapseDate:t}})]})},T8=({isOpen:n,onClose:e,onConfirm:t,currentWater:r})=>{const[s,i]=j.useState(r);return n?d.jsx("div",{className:"fixed inset-0 bg-black/80 backdrop-blur-sm flex items-center justify-center z-50 p-4",children:d.jsxs("div",{className:"bg-slate-800 rounded-2xl p-6 max-w-md w-full shadow-2xl border border-slate-700",children:[d.jsxs("div",{className:"text-center mb-6",children:[d.jsx("h3",{className:"text-xl font-bold text-white mb-2",children:"💧 Water Intake"}),d.jsx("p",{className:"text-gray-300 text-sm",children:"How many glasses of water today?"})]}),d.jsxs("div",{className:"mb-6",children:[d.jsx("input",{type:"number",min:"0",max:"20",value:s,onChange:o=>i(parseInt(o.target.value)||0),className:"w-full bg-slate-700 text-white text-center text-2xl font-bold py-4 rounded-lg border border-slate-600 focus:border-blue-500 focus:outline-none",placeholder:"0"}),d.jsx("p",{className:"text-gray-400 text-sm text-center mt-2",children:"0-20 glasses"})]}),d.jsxs("div",{className:"flex gap-3",children:[d.jsx("button",{onClick:e,className:"flex-1 bg-slate-600 hover:bg-slate-700 text-white font-bold py-3 rounded-lg transition-colors",children:"Cancel"}),d.jsx("button",{onClick:()=>t(s),className:"flex-1 bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 rounded-lg transition-colors",children:"Confirm"})]})]})}):null},b8=({isOpen:n,onClose:e,onSelect:t,selectedMood:r})=>{const s=[{name:"Anger",icon:"😠",color:"bg-red-500"},{name:"Disgust",icon:"🤢",color:"bg-orange-500"},{name:"Enjoyment",icon:"😊",color:"bg-yellow-500"},{name:"Calm",icon:"😌",color:"bg-blue-500"},{name:"Fear",icon:"😨",color:"bg-purple-500"},{name:"Sadness",icon:"😢",color:"bg-indigo-500"},{name:"Indifferent",icon:"😐",color:"bg-gray-500"}];return n?d.jsx("div",{className:"fixed inset-0 bg-black/80 backdrop-blur-sm flex items-center justify-center z-50 p-4",children:d.jsxs("div",{className:"bg-slate-800 rounded-2xl p-6 max-w-md w-full shadow-2xl border border-slate-700",children:[d.jsxs("div",{className:"text-center mb-6",children:[d.jsx("h3",{className:"text-xl font-bold text-white mb-2",children:"🌤️ How do you feel?"}),d.jsx("p",{className:"text-gray-300 text-sm",children:"Select your current mood"})]}),d.jsx("div",{className:"grid grid-cols-2 gap-3 mb-6",children:s.map(i=>d.jsxs("button",{onClick:()=>t(i),className:`p-4 rounded-xl text-center transition-all duration-300 hover:scale-105 ${(r==null?void 0:r.name)===i.name?"ring-2 ring-blue-400":"bg-slate-700 hover:bg-slate-600"}`,children:[d.jsx("div",{className:`w-12 h-12 ${i.color} rounded-full flex items-center justify-center text-2xl mx-auto mb-2`,children:i.icon}),d.jsx("p",{className:"text-white font-semibold",children:i.name})]},i.name))}),d.jsx("button",{onClick:e,className:"w-full bg-slate-600 hover:bg-slate-700 text-white font-bold py-3 rounded-lg transition-colors",children:"Cancel"})]})}):null},A8=({isOpen:n,onClose:e,onSchedule:t,scheduledTriggers:r})=>{const[s,i]=j.useState(""),[o,a]=j.useState(""),[l,u]=j.useState("12:00"),h=["Social event","Drinks","High-stress event","Social pressure"],f=["Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday"];return n?d.jsx("div",{className:"fixed inset-0 bg-black/80 backdrop-blur-sm flex items-center justify-center z-50 p-4",children:d.jsxs("div",{className:"bg-slate-800 rounded-2xl p-6 max-w-md w-full shadow-2xl border border-slate-700",children:[d.jsxs("div",{className:"text-center mb-6",children:[d.jsx("h3",{className:"text-xl font-bold text-white mb-2",children:"🛡️ Trigger Defense Planning"}),d.jsx("p",{className:"text-gray-300 text-sm",children:"Schedule your trigger defense strategy"})]}),d.jsxs("div",{className:"space-y-4 mb-6",children:[d.jsxs("div",{children:[d.jsx("label",{className:"block text-white text-sm font-semibold mb-2",children:"Day of the week"}),d.jsxs("select",{value:s,onChange:g=>i(g.target.value),className:"w-full bg-slate-700 text-white p-3 rounded-lg border border-slate-600 focus:border-blue-500 focus:outline-none",children:[d.jsx("option",{value:"",children:"Select a day"}),f.map(g=>d.jsx("option",{value:g,children:g},g))]})]}),d.jsxs("div",{children:[d.jsx("label",{className:"block text-white text-sm font-semibold mb-2",children:"Trigger type"}),d.jsxs("select",{value:o,onChange:g=>a(g.target.value),className:"w-full bg-slate-700 text-white p-3 rounded-lg border border-slate-600 focus:border-blue-500 focus:outline-none",children:[d.jsx("option",{value:"",children:"Select trigger type"}),h.map(g=>d.jsx("option",{value:g,children:g},g))]})]}),d.jsxs("div",{children:[d.jsx("label",{className:"block text-white text-sm font-semibold mb-2",children:"Time"}),d.jsx("input",{type:"time",value:l,onChange:g=>u(g.target.value),className:"w-full bg-slate-700 text-white p-3 rounded-lg border border-slate-600 focus:border-blue-500 focus:outline-none"})]})]}),d.jsxs("div",{className:"flex gap-3",children:[d.jsx("button",{onClick:e,className:"flex-1 bg-slate-600 hover:bg-slate-700 text-white font-bold py-3 rounded-lg transition-colors",children:"Cancel"}),d.jsx("button",{onClick:()=>{s&&o&&l&&t(s,o,l)},disabled:!s||!o||!l,className:"flex-1 bg-orange-600 hover:bg-orange-700 disabled:bg-slate-600 text-white font-bold py-3 rounded-lg transition-colors disabled:cursor-not-allowed",children:"Schedule"})]})]})}):null},C8=({isOpen:n,onClose:e,selectedDate:t,onDateSelect:r,dailyData:s})=>n?d.jsx("div",{className:"fixed inset-0 bg-black/80 backdrop-blur-sm flex items-center justify-center z-50 p-4",children:d.jsxs("div",{className:"bg-slate-800 rounded-2xl p-6 max-w-md w-full shadow-2xl border border-slate-700",children:[d.jsxs("div",{className:"text-center mb-6",children:[d.jsx("h3",{className:"text-xl font-bold text-white mb-2",children:"📅 Daily Summary"}),d.jsx("p",{className:"text-gray-300 text-sm",children:"Your activities and progress"})]}),d.jsxs("div",{className:"space-y-4 mb-6",children:[d.jsxs("div",{className:"bg-slate-700 rounded-lg p-4",children:[d.jsx("h4",{className:"text-white font-semibold mb-2",children:"💧 Water Intake"}),d.jsxs("p",{className:"text-gray-300",children:[s.water," glasses"]})]}),d.jsxs("div",{className:"bg-slate-700 rounded-lg p-4",children:[d.jsx("h4",{className:"text-white font-semibold mb-2",children:"🌤️ Mood"}),d.jsx("p",{className:"text-gray-300",children:s.mood?s.mood.name:"Not logged"})]}),d.jsxs("div",{className:"bg-slate-700 rounded-lg p-4",children:[d.jsx("h4",{className:"text-white font-semibold mb-2",children:"🫁 Breathing Exercise"}),d.jsx("p",{className:"text-gray-300",children:s.breathing?"✓ Completed":"✗ Not completed"})]}),s.relapseDate&&d.jsxs("div",{className:"bg-red-900/50 rounded-lg p-4 border border-red-500",children:[d.jsx("h4",{className:"text-red-300 font-semibold mb-2",children:"⚠️ Relapse"}),d.jsxs("p",{className:"text-red-300",children:[s.relapseDate.toLocaleDateString()," at ",s.relapseDate.toLocaleTimeString()]})]})]}),d.jsx("button",{onClick:e,className:"w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 rounded-lg transition-colors",children:"Close"})]})}):null,R8=({onResetApp:n,onBackToLogin:e,onResetForTesting:t,firestoreBuddyService:r,firestoreBuddyServiceRef:s,initializeFirestoreBuddyService:i,behavioralService:o,user:a,onShowAnalytics:l})=>d.jsx("div",{className:"min-h-screen bg-gradient-to-br from-slate-900 via-blue-900 to-slate-900 pb-20",children:d.jsxs("div",{className:"max-w-md mx-auto px-4 pt-16",children:[d.jsxs("div",{className:"text-center mb-8",children:[d.jsx(FD,{className:"w-16 h-16 mx-auto mb-4 text-blue-400"}),d.jsx("h2",{className:"text-2xl font-bold text-white mb-2",children:"Settings"}),d.jsx("p",{className:"text-gray-300",children:"Manage your app preferences"})]}),d.jsxs("div",{className:"space-y-4",children:[d.jsxs("div",{className:"bg-slate-800/50 rounded-xl p-4",children:[d.jsx("h3",{className:"text-white font-semibold mb-2",children:"📊 Behavioral Analytics"}),d.jsx("p",{className:"text-gray-400 text-sm mb-4",children:"View your behavioral patterns and insights"}),d.jsx("button",{onClick:l,disabled:!o,className:`w-full py-3 rounded-lg transition-colors mb-3 ${o?"bg-blue-600 hover:bg-blue-700 text-white":"bg-gray-600 text-gray-400 cursor-not-allowed"}`,children:o?"📈 View Analytics Dashboard":"📈 Analytics (Service Loading...)"}),o&&d.jsx("button",{onClick:async()=>{try{await o.logCraving(a.uid,{outcome:"resisted",strength:7,duration:5,context:"test_data",triggers:["stress","work"],mood:"anxious",stressLevel:6}),await o.logBreathingExercise(a.uid,{duration:5,completed:!0,triggerContext:"test_data"}),alert("✅ Test data added to Firestore for analytics demo!")}catch(u){alert("❌ Error adding test data: "+u.message)}},className:"w-full bg-green-600 hover:bg-green-700 text-white py-2 rounded-lg transition-colors text-sm",children:"🧪 Add Test Data"})]}),d.jsxs("div",{className:"bg-slate-800/50 rounded-xl p-4",children:[d.jsx("h3",{className:"text-white font-semibold mb-2",children:"Session"}),d.jsx("p",{className:"text-gray-400 text-sm mb-4",children:"Manage your current session"}),d.jsx("button",{onClick:e,className:"w-full bg-slate-600 hover:bg-slate-500 text-white py-3 rounded-lg transition-colors mb-3",children:"← Back to Login"})]}),d.jsxs("div",{className:"bg-slate-800/50 rounded-xl p-4",children:[d.jsx("h3",{className:"text-white font-semibold mb-2",children:"App Data"}),d.jsx("p",{className:"text-gray-400 text-sm mb-4",children:"Reset your progress and start over"}),d.jsx("button",{onClick:n,className:"w-full bg-red-600 hover:bg-red-700 text-white py-3 rounded-lg transition-colors",children:"Reset App & Start Over"})]}),!1,d.jsxs("div",{className:"bg-slate-800/50 rounded-xl p-4",children:[d.jsx("h3",{className:"text-white font-semibold mb-2",children:"About"}),d.jsx("p",{className:"text-gray-400 text-sm",children:"QuitCard Arena v1.0.0"}),d.jsx("p",{className:"text-gray-400 text-sm",children:"Your journey to freedom starts here"})]})]})]})}),N8=()=>{const[n,e]=j.useState("arena"),[t,r]=j.useState("auth"),[s,i]=j.useState(null),[o,a]=j.useState(null),[l,u]=j.useState(!1),[h,f]=j.useState(!1),[g,y]=j.useState(null),[w,C]=j.useState(!0),[M,A]=j.useState({isLoading:!1,progress:0,currentStep:"",error:null,isComplete:!1}),[I,R]=j.useState([]);j.useState(null);const[D,V]=j.useState(null),[P,S]=j.useState(null),[v,b]=j.useState(null),_=j.useRef(null),[E,N]=j.useState(null),T=async()=>{try{if(!si){console.error("❌ Firestore instance is not available");return}const F=new Kl(si),Y=new K9(si),G=await F.testConnectivity(),fe=await Y.testConnectivity();G?(V(F),_.current=F,console.log("✅ FirestoreBuddyService initialized successfully")):console.warn("⚠️ Firestore connectivity test failed - service not initialized"),fe?(S(Y),console.log("✅ FirestoreBehavioralService initialized successfully")):console.warn("⚠️ Firestore behavioral service connectivity test failed")}catch(F){console.error("❌ Error initializing FirestoreBuddyService:",F)}},K=()=>({mentalStrength:50,motivation:50,triggerDefense:30,addictionLevel:50,streakDays:0,streakUnit:"hours",streakDisplayText:"0 hours",cravingsResisted:0}),mt=()=>({dailyWater:0,dailyMood:null,dailyBreathing:!1,scheduledTriggers:[],relapseDate:null,cravingsResisted:0}),Me=F=>{F.relapseDate&&Ee(new Date(F.relapseDate)),F.dailyWater!==void 0&&ve(F.dailyWater),F.dailyMood!==void 0&&oe(F.dailyMood),F.dailyBreathing!==void 0&&qe(F.dailyBreathing),F.scheduledTriggers&&he(F.scheduledTriggers)},qt=async()=>{const F=new Date().toDateString();try{const{ref:Y,set:G}=await be(()=>import("./index.esm-eba9a326.js"),[]),fe=Y(q,`users/${g==null?void 0:g.uid}/profile/daily/${F}/breathing`);await G(fe,!0)}catch(Y){console.error("Error saving breathing exercise to Firebase:",Y),localStorage.setItem(`breathing_${g==null?void 0:g.uid}_${F}`,"true")}if(E)try{await E.handleBreathingExercise();const Y=await E.checkBreathingStreak(),G=Math.max(0,3-Y%3),fe=Y>=3&&Y%3===0?`🎉 Excellent! You've completed a ${Y}-day breathing streak and earned +1 Mental Strength!`:`✅ Breathing exercise completed! Current streak: ${Y} days. Complete ${G} more days to earn +1 Mental Strength.`;if(showQuickActionPopup("🫁 Breathing Exercise Complete",`${fe}

Keep up the great work! Regular breathing exercises help reduce stress and improve mental resilience.`,"success"),P)try{await P.logBreathingExercise(o.uid,{duration:5,completed:!0,triggerContext:"scheduled",currentStreak:Y,mentalStrengthEarned:Y>=3&&Y%3===0}),console.log("✅ Breathing exercise also logged to Firestore for analytics")}catch(_e){console.warn("⚠️ Could not log breathing exercise to Firestore:",_e.message)}}catch(Y){console.warn("⚠️ Error handling breathing exercise completion:",Y.message),showQuickActionPopup("🫁 Breathing Exercise Complete","✅ Breathing exercise completed! Keep practicing daily to build your mental strength.","success")}},k=(F,Y)=>{const G=document.createElement("div");G.className="fixed top-20 right-4 z-50 p-4 rounded-lg shadow-lg bg-red-500 text-white max-w-sm",G.innerHTML=`
      <div class="font-bold">${F}</div>
      <div class="text-sm opacity-90">${Y}</div>
      <button class="mt-2 text-sm underline" onclick="this.parentElement.remove()">Dismiss</button>
    `,document.body.appendChild(G),setTimeout(()=>{G.parentNode&&G.parentNode.removeChild(G)},1e4)},$=async F=>{if(!F)return!1;A({isLoading:!0,progress:0,currentStep:"Initializing...",error:null,isComplete:!1});try{const{ref:Y,get:G,onValue:fe}=await be(()=>import("./index.esm-eba9a326.js"),[]);A(Xe=>({...Xe,currentStep:"Loading profile data...",progress:20}));const _e=Y(q,`users/${F}`),ze=await G(_e);if(!ze.exists())throw new Error("User profile not found");const Se=ze.val(),Re=Q(Se);A(Xe=>({...Xe,currentStep:"Loading battle stats...",progress:40}));const Ve=Y(q,`users/${F}/stats`),bt=await G(Ve),Le=bt.exists()?ee(bt.val()):K();A(Xe=>({...Xe,currentStep:"Loading habits and progress...",progress:60}));const Ue=Y(q,`users/${F}/profile`),Qe=await G(Ue),me=Qe.exists()?ie(Qe.val()):mt();A(Xe=>({...Xe,currentStep:"Loading achievements...",progress:80}));const we=Y(q,`users/${F}/profile/cravingsResisted`),ke=await G(we),dt=ke.exists()?Math.max(0,parseInt(ke.val())||0):0;A(Xe=>({...Xe,currentStep:"Setting up live sync...",progress:90}));const ht=fe(Ve,Xe=>{if(Xe.exists()){const Gn=ee(Xe.val());if(console.log("🔄 Firebase Listener: Stats changed, new stats:",Gn),yt(Gn),t==="arena"&&o){console.log("🔄 Firebase Listener: Current user object:",o),console.log("🔄 Firebase Listener: user.quitDate:",o.quitDate),console.log("🔄 Firebase Listener: user.uid:",o.uid);const bs={...o,stats:Gn};console.log("🔄 Firebase Listener: Triggering calculateRealTimeStats for Arena with updatedUser:",bs),console.log("🔄 Firebase Listener: updatedUser.quitDate:",bs.quitDate),console.log("🔄 Firebase Listener: updatedUser.uid:",bs.uid),calculateRealTimeStats(bs).then(Vn=>{console.log("🔄 Firebase Listener: calculateRealTimeStats returned:",Vn),console.log("🔄 Firebase Listener: calculatedStats.streakDays:",Vn.streakDays),setRealTimeUserStats(Vn)})}}}),_n=fe(Ue,Xe=>{if(Xe.exists()){const Gn=ie(Xe.val());t==="profile"&&Me(Gn)}}),Ct=fe(we,Xe=>{if(Xe.exists()){const Gn=Math.max(0,parseInt(Xe.val())||0);t==="craving-support"&&Ke(Gn)}});return R([ht,_n,Ct]),A(Xe=>({...Xe,currentStep:"Finalizing...",progress:100})),a(Xe=>({...Xe,...Re,...me,stats:Le})),Me(me),Ke(dt),Re.onboardingCompleted&&f(!0),A({isLoading:!1,progress:100,currentStep:"Data loaded successfully!",error:null,isComplete:!0}),console.log("✅ All user data loaded successfully:",{profile:Re,stats:Le,profileData:me,cravingsResisted:dt}),!0}catch(Y){return console.error("❌ Error loading user data:",Y),A({isLoading:!1,progress:0,currentStep:"Failed to load data",error:Y.message,isComplete:!1}),k("Failed to load user data",Y.message),!1}},Q=F=>F?{uid:F.uid||"",email:F.email||"",heroName:F.heroName||"Hero",archetype:F.archetype||"The Determined",avatar:F.avatar||Ns("default"),quitDate:F.quitDate,onboardingCompleted:!!F.onboardingCompleted,updatedAt:F.updatedAt||Date.now(),...F}:le(),ee=F=>F?{mentalStrength:Math.max(0,Math.min(100,parseInt(F.mentalStrength)||50)),motivation:Math.max(0,Math.min(100,parseInt(F.motivation)||50)),triggerDefense:Math.max(0,Math.min(100,parseInt(F.triggerDefense)||30)),addictionLevel:Math.max(0,Math.min(100,parseInt(F.addictionLevel)||50)),streakDays:Math.max(0,parseInt(F.streakDays)||0),streakUnit:F.streakUnit||"hours",streakDisplayText:F.streakDisplayText||"0 hours",cravingsResisted:Math.max(0,parseInt(F.cravingsResisted)||0),...F}:K(),ie=F=>F?{dailyWater:Math.max(0,parseInt(F.dailyWater)||0),dailyMood:F.dailyMood||null,dailyBreathing:!!F.dailyBreathing,scheduledTriggers:Array.isArray(F.scheduledTriggers)?F.scheduledTriggers:[],relapseDate:F.relapseDate?new Date(F.relapseDate).toISOString():null,cravingsResisted:Math.max(0,parseInt(F.cravingsResisted)||0),...F}:mt(),le=()=>({uid:"",email:"",heroName:"Hero",archetype:"The Determined",avatar:Ns("default"),quitDate:new Date().toISOString(),onboardingCompleted:!1,updatedAt:Date.now()});j.useEffect(()=>()=>{I.forEach(F=>{typeof F=="function"&&F()})},[I]);const[ce,Ae]=j.useState(null);j.useEffect(()=>{(async()=>{try{const Y=(await be(()=>import("./offlineManager-b05a5ed3.js"),[])).default,G=new Y;Ae(G),window.refreshUserData=te,console.log("✅ Offline manager initialized")}catch(Y){console.error("Error initializing offline manager:",Y)}})()},[]);const $e=async F=>{if(!F)return!1;const Y=await $(F);if(Y&&ce&&(await ce.cacheUserData(o),await ce.cacheProfileData({dailyWater:H,dailyMood:He,dailyBreathing:Ce,scheduledTriggers:Oe,relapseDate:de,cravingsResisted:De})),!Y&&ce){console.log("📱 Loading offline data...");const G=await ce.getCachedUserData(),fe=await ce.getCachedProfileData();if(G)return console.log("📱 Using offline user data"),a(G),f(G.onboardingCompleted),fe&&Me(fe),!0}return Y},xe=async()=>g!=null&&g.uid?(console.log("🔄 Refreshing user data with offline support..."),await $e(g.uid)):!1,te=async()=>{if(!(g!=null&&g.uid)){k("Cannot Refresh","No authenticated user found");return}if(console.log("🔄 Manually refreshing user data..."),await xe()){const Y=document.createElement("div");Y.className="fixed top-20 right-4 z-50 p-4 rounded-lg shadow-lg bg-green-500 text-white max-w-sm",Y.innerHTML=`
        <div class="font-bold">✅ Data Refreshed!</div>
        <div class="text-sm opacity-90">Your data has been synced across all devices</div>
        <button class="mt-2 text-sm underline" onclick="this.parentElement.remove()">Dismiss</button>
      `,document.body.appendChild(Y),setTimeout(()=>{Y.parentNode&&Y.parentNode.removeChild(Y)},5e3)}else k("Refresh Failed","Could not refresh data. Please try again.")},[de,Ee]=j.useState(null),[H,ve]=j.useState(0),[He,oe]=j.useState(null),[Ce,qe]=j.useState(!1),[Oe,he]=j.useState([]),[De,Ke]=j.useState(0),[Tt,yt]=j.useState(K());j.useEffect(()=>{const F=G=>{if(G.message&&G.message.includes("content_script")){console.warn("Browser extension error (ignored):",G.message);return}if(G.message&&(G.message.includes("FrameDoesNotExistError")||G.message.includes("background.js"))){console.warn("Background frame error (ignored):",G.message);return}console.error("Global error caught:",G)},Y=G=>{if(G.reason&&G.reason.message&&G.reason.message.includes("content_script")){console.warn("Browser extension promise rejection (ignored):",G.reason.message);return}if(G.reason&&G.reason.message&&(G.reason.message.includes("FrameDoesNotExistError")||G.reason.message.includes("background.js"))){console.warn("Background frame promise rejection (ignored):",G.reason.message);return}console.error("Unhandled promise rejection:",G.reason)};return window.addEventListener("error",F),window.addEventListener("unhandledrejection",Y),()=>{window.removeEventListener("error",F),window.removeEventListener("unhandledrejection",Y)}},[]),j.useEffect(()=>{(()=>{try{q&&typeof q.app<"u"&&console.log("🔥 Firebase RTDB initialized successfully")}catch(Y){console.warn("⚠️ Firebase initialization check failed (non-critical):",(Y==null?void 0:Y.message)||Y)}})()},[]),j.useEffect(()=>{let F=!0,Y=null;return(async()=>{try{console.log("Initializing authentication state..."),C(!0);const fe=async Se=>{const Re=`quitDateFixed_${Se}_v2`;if(!localStorage.getItem(Re)&&!(Se!=="AmwwlNyHD5T3WthUbyR6bFL0QkF2"&&Se!=="uGZGbLUytbfu8W3mQPW0YAvXTQn1"))try{const{ref:Ve,get:bt,set:Le}=await be(()=>import("./index.esm-eba9a326.js"),[]),Ue="2025-09-18T13:56:46.584Z";console.log(`🔧 One-time fix: Setting proper quit date for ${Se}...`);const Qe=Ve(q,`users/${Se}/profile`),me=await bt(Qe);let we=Ue;if(me.exists()){const ke=me.val();if(ke.lastRelapseDate){const dt=new Date(ke.lastRelapseDate),ht=new Date(Ue);we=dt>ht?ke.lastRelapseDate:Ue,console.log(`📅 ${Se}: Using quit date ${we} (considering relapse: ${ke.lastRelapseDate})`)}}await Le(Ve(q,`users/${Se}/quitDate`),we),await Le(Ve(q,`users/${Se}/profile/quitDate`),we),localStorage.setItem(Re,"true"),console.log(`✅ One-time fix: Quit date fixed for ${Se} in Firebase database`)}catch(Ve){console.warn(`⚠️ One-time fix failed for ${Se}:`,Ve.message)}},{onAuthStateChanged:_e}=await be(()=>import("./index.esm-ef74de8c.js"),[]);Y=_e(so,async Se=>{if(F)if(console.log("Auth state changed:",Se?`User: ${Se.uid}`:"No user"),Se){y(Se),console.log("User authenticated, checking database for user data..."),(Se.uid==="AmwwlNyHD5T3WthUbyR6bFL0QkF2"||Se.uid==="uGZGbLUytbfu8W3mQPW0YAvXTQn1")&&(console.log(`🧹 Clearing cache for ${Se.uid} to ensure fresh data loading...`),Object.keys(localStorage).forEach(Re=>{(Re.includes("quitCoach")||Re.includes("quitDate")||Re.includes("user")||Re.includes("arena"))&&localStorage.removeItem(Re)})),fe(Se.uid);try{const{ref:Re,get:Ve}=await be(()=>import("./index.esm-eba9a326.js"),[]),bt=Re(q,`users/${Se.uid}`),Le=await Ve(bt);if(Le.exists()){const Ue=Le.val();console.log("Existing user data found - auto-login successful"),(()=>{const me=[];for(let we=0;we<localStorage.length;we++){const ke=localStorage.key(we);ke&&(ke.startsWith("water_")||ke.startsWith("mood_")||ke.startsWith("breathing_"))&&me.push(ke)}me.forEach(we=>localStorage.removeItem(we)),console.log("Cleared previous user data from localStorage")})(),a(Ue),f(!0),r("arena");try{const me=await be(()=>Promise.resolve().then(()=>H9),void 0),we=new me.default(q,Se.uid);await we.initialize(),N(we),console.log("✅ StatManager initialized successfully")}catch(me){console.error("Error initializing StatManager:",me)}try{const me=new Cb(q,Se.uid);b(me),window.centralizedStatService=me,await me.refreshAllStats(),console.log("✅ CentralizedStatService initialized and stats refreshed for user:",Se.uid),me.setupRealTimeListener(we=>{console.log("🔄 Real-time stats update received:",we),yt(we)})}catch(me){console.error("Error initializing CentralizedStatService:",me)}try{console.log("🔍 Checking if existing user needs buddy matching...");const me=_.current||D;if(me)if(await me.getUserBuddyPair(Se.uid))console.log("✅ Existing user already has a buddy pair");else{console.log("🔄 Existing user has no buddy - adding to matching pool...");const ke={userId:Se.uid,heroName:Ue.heroName,archetype:Ue.archetype,joinedAt:new Date().toISOString(),stats:Ue.stats};await me.addToMatchingPool(ke),console.log("✅ Added existing user to matching pool"),setTimeout(async()=>{try{console.log("⏳ Triggering auto-matching for existing user..."),await Vt()}catch(dt){console.error("Auto-matching failed for existing user:",dt)}},2e3)}else console.log("⚠️ FirestoreBuddyService not available for existing user buddy check")}catch(me){console.error("Error checking existing user buddy status:",me)}console.log("User auto-logged in and redirected to Arena")}else console.log("No user data found - new user needs onboarding"),r("onboarding")}catch(Re){console.error("Error fetching user data during auto-login:",Re),r("onboarding")}}else console.log("No authenticated user - showing login screen"),y(null),a(null),f(!1),r("auth"),(()=>{const Ve=[];for(let bt=0;bt<localStorage.length;bt++){const Le=localStorage.key(bt);Le&&(Le.startsWith("water_")||Le.startsWith("mood_")||Le.startsWith("breathing_"))&&Ve.push(Le)}Ve.forEach(bt=>localStorage.removeItem(bt)),console.log("Cleared user-specific data from localStorage")})()});const ze=setTimeout(()=>{F&&(console.warn("Auth initialization timeout - forcing to auth screen"),C(!1),r("auth"))},1e4);Y&&clearTimeout(ze)}catch(fe){console.error("Error initializing authentication:",fe),F&&(C(!1),r("auth"))}finally{F&&C(!1)}})(),T(),()=>{F=!1,Y&&Y()}},[]);const vt=async F=>{console.log("Authentication successful, checking for existing user data...",{uid:F==null?void 0:F.uid,email:F==null?void 0:F.email});try{const{ref:Y,get:G}=await be(()=>import("./index.esm-eba9a326.js"),[]);console.log("Checking database for existing user data...");const fe=Y(q,`users/${F.uid}`),_e=await G(fe);if(_e.exists()){const ze=_e.val();if(console.log("Existing user data found - loading all user data..."),await $e(F.uid)){console.log("✅ All user data loaded successfully, going to Arena");try{const Re=new Cb(q,F.uid);b(Re),window.centralizedStatService=Re,await Re.refreshAllStats(),console.log("✅ CentralizedStatService initialized for existing user:",F.uid),Re.setupRealTimeListener(Ve=>{console.log("🔄 Real-time stats update received:",Ve),yt(Ve)})}catch(Re){console.error("Error initializing CentralizedStatService for existing user:",Re)}r("arena")}else{console.log("⚠️ Data loading failed, but proceeding to Arena with basic data"),a(ze);const Re=!!ze.onboardingCompleted;f(Re),r("arena")}}else console.log("No user data found - starting onboarding"),r("onboarding")}catch(Y){console.error("Database check failed:",Y),r("onboarding")}},[Be,_t]=j.useState(null),[nt,Te]=j.useState(!1),[rt,Wt]=j.useState(null),[rn,Sn]=j.useState(!1),dr=async(F,Y)=>{var G,fe,_e;if(!(!(o!=null&&o.uid)||nt)){Te(!0),Wt(null),Sn(!0);try{console.log("🔄 Starting loadRealBuddy function..."),console.log("🔄 FirestoreBuddyService available:",!!D),console.log("🔄 FirestoreBuddyService type:",typeof D);const ze=_.current||D;if(!ze){console.log("⚠️ FirestoreBuddyService not available, falling back to Realtime Database"),await Wn();return}console.log("✅ Using Firestore for buddy loading"),console.log("🔄 Firestore: Loading real buddy data...");const{collection:Se,query:Re,where:Ve,getDocs:bt}=await be(()=>import("./index.esm-396c6e3a.js"),[]),Le=Se(si,"buddyPairs"),Ue=Re(Le,Ve("user1Id","==",o.uid)),Qe=await bt(Ue);let me=null,we=null;if(Qe.empty){const ke=Re(Le,Ve("user2Id","==",o.uid)),dt=await bt(ke);if(!dt.empty){const ht=dt.docs[0];me={id:ht.id,...ht.data()},we=me.user1Id}}else{const ke=Qe.docs[0];me={id:ke.id,...ke.data()},we=me.user2Id}if(me&&we){console.log("✅ Firestore: Found buddy pair:",me.id),console.log("🔍 Buddy pair data:",{user1Id:me.user1Id,user2Id:me.user2Id,user1Name:me.user1Name,user2Name:me.user2Name,currentUserId:o.uid,buddyUserId:we});let ke="Your Buddy";if(me.user1Id===o.uid?ke=me.user2Name||"Your Buddy":ke=me.user1Name||"Your Buddy",ke==="Your Buddy")try{const Pt=(await ze.getAllMatchingPoolUsers()).find(hr=>hr.userId===we);Pt&&Pt.heroName&&(ke=Pt.heroName,console.log("🔍 Found buddy name from matching pool:",ke))}catch(wt){console.log("⚠️ Could not get buddy name from matching pool:",wt.message)}if(ke==="Your Buddy"&&(ke=`Buddy ${we.slice(-4)}`),console.log("🔍 Selected buddy name:",ke),ke!=="Your Buddy"&&ke.startsWith("Buddy ")===!1)try{console.log("🔄 Updating buddy pair with correct names...");const{doc:wt,updateDoc:Pt}=await be(()=>import("./index.esm-396c6e3a.js"),[]),hr=wt(si,"buddyPairs",me.id),cn={};me.user1Id===o.uid?(cn.user1Name=o.heroName,cn.user2Name=ke):(cn.user1Name=ke,cn.user2Name=o.heroName),await Pt(hr,cn),console.log("✅ Updated buddy pair with names:",cn)}catch(wt){console.log("⚠️ Could not update buddy pair names:",wt.message)}let dt={streakDays:0,addictionLevel:50,willpower:50,motivation:50,cravingResistance:50,triggerDefense:30,experiencePoints:0};try{console.log("🔄 Attempting to get real buddy stats from Firebase...");const{ref:wt,get:Pt}=await be(()=>import("./index.esm-eba9a326.js"),[]),hr=wt(q,`users/${we}/stats`),cn=await Pt(hr);if(cn.exists()){const sr=cn.val();dt={...dt,...sr},console.log("✅ Got real buddy stats from Firebase:",sr)}else console.log("⚠️ Buddy stats not found in Firebase, using defaults")}catch(wt){console.log("⚠️ Could not read buddy stats (permission), using defaults:",wt.message)}let ht=null,_n=null,Ct=Ns("buddy","adventurer"),Xe="DETERMINED";try{console.log("🔄 Loading Firebase imports for buddy profile...");const{ref:wt,get:Pt}=await be(()=>import("./index.esm-eba9a326.js"),[]);console.log("✅ Firebase imports loaded successfully"),console.log("🔍 Reading buddy profile fields from path:",`users/${we}`),console.log("🔄 Firestore: Attempting to read buddy quit date from multiple locations...");const[hr,cn,sr,Ar,As,Mi,fr]=await Promise.all([Pt(wt(q,`users/${we}/avatar`)),Pt(wt(q,`users/${we}/avatarSeed`)),Pt(wt(q,`users/${we}/archetype`)),Pt(wt(q,`users/${we}/heroName`)),Pt(wt(q,`users/${we}/quitDate`)),Pt(wt(q,`users/${we}/profile/quitDate`)),Pt(wt(q,`users/${we}/profile`))]);if(console.log("🔍 Firestore: Quit date snapshots - root exists:",As.exists(),"profile exists:",Mi.exists()),hr.exists())Ct=hr.val(),console.log("✅ Got buddy avatar from Firebase");else if(cn.exists()){const fn=cn.val(),Js=sr.exists()?sr.val():"adventurer";Ct=Ns(fn,Js),console.log("✅ Generated buddy avatar from seed:",fn)}if(sr.exists()&&(Xe=sr.val(),console.log("✅ Got buddy archetype:",Xe)),Ar.exists()){const fn=Ar.val();console.log("✅ Got buddy hero name:",fn),ke=fn}if(As.exists())ht=As.val(),console.log("✅ Got buddy quit date from Firebase (root):",ht);else if(Mi.exists())ht=Mi.val(),console.log("✅ Got buddy quit date from Firebase (profile):",ht);else{if(console.log("⚠️ No buddy quit date found in Firebase (neither root nor profile)"),console.log("🔍 quitDateSnapshot exists:",As.exists()),console.log("🔍 profileQuitDateSnapshot exists:",Mi.exists()),fr.exists()){const fn=fr.val();console.log("🔍 Full profile data available:",fn),fn&&fn.quitDate?(ht=fn.quitDate,console.log("✅ Found buddy quit date in profile data:",ht)):console.log("⚠️ Profile exists but has no quit date field")}else console.log("⚠️ No profile data available at all");if(fr.exists()){const fn=fr.val();_n=fn.lastRelapseDate||fn.relapseDate,console.log("🔍 Found buddy relapse date:",_n)}ht||(console.log("⚠️ This means the buddy has no quit date stored - streak will be 0"),console.log("🔍 Buddy user ID:",we),console.log("🔍 This could be because:"),console.log("   1. User completed onboarding before quit date was properly saved"),console.log("   2. User quit date was overwritten during validation"),console.log("   3. User was created before proper quit date handling was implemented"),we==="AmwwlNyHD5T3WthUbyR6bFL0QkF2"?console.log("🔄 Arena: User 2 uses centralized stats - no hardcoded quit date needed"):we==="uGZGbLUytbfu8W3mQPW0YAvXTQn1"&&console.log("🔄 Arena: User 3 uses centralized stats - no hardcoded quit date needed"))}}catch(wt){console.log("⚠️ Could not read buddy profile (permission):",wt.message),console.log("🔍 Full profile error details:",wt),console.log("🔍 Trying to access path:",`users/${we}`),console.log("🔍 Current user can read own profile, but not buddy profile")}const Gn=ht||new Date().toISOString();let bs=Gn;(we==="uGZGbLUytbfu8W3mQPW0YAvXTQn1"||we==="AmwwlNyHD5T3WthUbyR6bFL0QkF2")&&(console.log(`🔄 Arena: Not setting quit date for centralized buddy ${we} - using null to prevent calculations`),bs=null);const Vn={heroName:ke,uid:we,stats:dt,quitDate:bs,lastRelapseDate:_n,achievements:[],archetype:Xe,avatar:Ct,userId:we,isRealBuddy:!0,pairId:me.id,triggers:[],dailyPatterns:[],copingStrategies:[],specialFeatures:null};console.log("🔍 Firestore: Final buddy object with quit date:",{heroName:ke,originalQuitDate:ht,finalQuitDate:Gn,lastRelapseDate:_n,hasOriginalQuitDate:!!ht,usingDefaultQuitDate:!ht,hasRelapseDate:!!_n}),_t(Vn),console.log("✅ Firestore: Buddy data loaded successfully"),console.log("🔍 Firestore: Buddy Special Features data:",{hasSpecialFeatures:!!Vn.specialFeatures,hasTriggers:!!((G=Vn.triggers)!=null&&G.length),hasDailyPatterns:!!((fe=Vn.dailyPatterns)!=null&&fe.length),hasCopingStrategies:!!((_e=Vn.copingStrategies)!=null&&_e.length),uid:Vn.uid}),console.log(`🔄 Firestore: Reading centralized buddy stats for ${we} (read-only)`);try{try{const{ref:wt,get:Pt}=await be(()=>import("./index.esm-eba9a326.js"),[]),hr=await Pt(wt(q,`users/${we}/stats`));if(hr.exists()){const cn=hr.val(),sr=new Date,Ar=Vn.lastRelapseDate;if(Ar){const As=new Date(Ar),Mi=sr-As,fr=Math.floor(Mi/(1e3*60*60)),fn=Math.floor(fr/24);let Js,Go;fr<24?(Js=`${fr} hour${fr===1?"":"s"}`,Go=0):(Js=`${fn} day${fn===1?"":"s"}`,Go=fn),console.log(`🔄 Firestore: Calculated buddy streak locally: ${Js} (${fr} hours since relapse)`);const Xs={...cn,streakDays:Go,streakUnit:fr<24?"hours":"days",streakDisplayText:Js};console.log("🔄 Firestore: Using buddy stats with locally calculated streak:",Xs),console.log("🔄 Firestore: Buddy streak fields:",{streakDays:Xs.streakDays,streakUnit:Xs.streakUnit,streakDisplayText:Xs.streakDisplayText}),Y(Xs)}else console.log("🔄 Firestore: No relapse date found for buddy, using existing stats"),Y(cn)}else{console.log("⚠️ Firestore: No centralized stats found for buddy, using fallback calculation");const cn=await F(Vn);Y(cn)}}catch(wt){console.error("❌ Error reading buddy stats:",wt);const Pt=await F(Vn);Y(Pt)}}catch(wt){console.error("❌ Error reading centralized buddy stats:",wt);const Pt=await F(Vn);Y(Pt)}await it(o.uid,we)}else console.log("ℹ️ Firestore: No buddy pair found for user"),_t(null)}catch(ze){console.error("❌ Firestore: Error loading buddy:",ze),console.log("🔄 Falling back to Realtime Database buddy loading..."),await Wn()}finally{Te(!1)}}},Wn=async()=>{var F,Y,G,fe,_e,ze,Se,Re,Ve,bt;try{console.log("🔄 Realtime Database: Loading buddy data...");const{ref:Le,get:Ue}=await be(()=>import("./index.esm-eba9a326.js"),[]),Qe=Le(q,"buddyPairs"),me=await Ue(Qe);if(!me.exists()){_t(null);return}const we=me.val();let ke=null,dt=null;for(const[ht,_n]of Object.entries(we))if(_n.users&&Array.isArray(_n.users)&&_n.users.includes(o.uid)){ke={..._n,pairId:ht},dt=_n.users.find(Ct=>Ct!==o.uid);break}if(ke&&dt){const ht=Le(q,`users/${dt}`),_n=await Ue(ht);if(!_n.exists()){const{remove:Gn}=await be(()=>import("./index.esm-eba9a326.js"),[]);await Gn(Le(q,`buddyPairs/${ke.pairId}`)),_t(null);return}const Ct=_n.val(),Xe={heroName:Ct.heroName||"Buddy",stats:{streakDays:((F=Ct.stats)==null?void 0:F.streakDays)||0,addictionLevel:((Y=Ct.stats)==null?void 0:Y.addictionLevel)||50,willpower:((G=Ct.stats)==null?void 0:G.mentalStrength)||50,motivation:((fe=Ct.stats)==null?void 0:fe.mentalStrength)||50,cravingResistance:((_e=Ct.stats)==null?void 0:_e.mentalStrength)||50,triggerDefense:((ze=Ct.stats)==null?void 0:ze.triggerDefense)||30,experiencePoints:((Se=Ct.stats)==null?void 0:Se.experiencePoints)||0},achievements:Ct.achievements||[],archetype:Ct.archetype||"The Determined",avatar:Ct.avatar||Ns(Ct.heroName||"buddy","adventurer"),uid:dt,userId:dt,isRealBuddy:!0,pairId:ke.pairId,triggers:Ct.triggers||[],dailyPatterns:Ct.dailyPatterns||[],copingStrategies:Ct.copingStrategies||[],specialFeatures:Ct.specialFeatures||null};_t(Xe),console.log("🔍 RealtimeDB: Buddy Special Features data:",{hasSpecialFeatures:!!Xe.specialFeatures,hasTriggers:!!((Re=Xe.triggers)!=null&&Re.length),hasDailyPatterns:!!((Ve=Xe.dailyPatterns)!=null&&Ve.length),hasCopingStrategies:!!((bt=Xe.copingStrategies)!=null&&bt.length),uid:Xe.uid}),await it(o.uid,dt)}else _t(null)}catch(Le){console.error("Error loading buddy from Realtime Database:",Le),Wt("Failed to load buddy data"),_t(null)}},it=async(F,Y)=>{try{const G=_.current||D;if(G&&(Be!=null&&Be.pairId)){console.log("🔄 Firestore: Removing users from matching pool"),await G.removeFromMatchingPool(F),await G.removeFromMatchingPool(Y);const{doc:fe,updateDoc:_e}=await be(()=>import("./index.esm-396c6e3a.js"),[]),ze=fe(si,"buddyPairs",Be.pairId);await _e(ze,{user1RemovedFromPool:!0,user2RemovedFromPool:!0}),console.log("✅ Firestore: Users removed from matching pool and pair updated")}else{console.log("🔄 Realtime Database: Removing users from matching pool");const{ref:fe,remove:_e,set:ze}=await be(()=>import("./index.esm-eba9a326.js"),[]);await _e(fe(q,`matchingPool/${F}`)),await _e(fe(q,`matchingPool/${Y}`)),Be!=null&&Be.pairId&&(await ze(fe(q,`buddyPairs/${Be.pairId}/user1RemovedFromPool`),!0),await ze(fe(q,`buddyPairs/${Be.pairId}/user2RemovedFromPool`),!0)),console.log("✅ Realtime Database: Users removed from matching pool and pair updated")}}catch(G){console.error("❌ Error removing users from matching pool:",G)}};j.useEffect(()=>{Sn(!1),_t(null)},[o==null?void 0:o.uid]),j.useEffect(()=>{o!=null&&o.uid&&!Be&&!nt&&!rn&&console.log("🔄 Buddy loading will be handled by Arena component")},[o==null?void 0:o.uid,Be,nt,rn]),j.useEffect(()=>{D&&console.log("✅ FirestoreBuddyService is now available")},[D]);const Vt=async()=>{try{const F=_.current||D;if(!F){console.log("⚠️ FirestoreBuddyService not available, falling back to Realtime Database"),await br();return}console.log("✅ Using Firestore for auto-matching"),console.log("🔄 Firestore: Starting NEW CHAIN PAIRING algorithm...");const Y=await F.getAllMatchingPoolUsers();if(console.log("🔍 Firestore: Current matching pool state:",{totalUsers:Y.length,userIds:Y.map(fe=>({id:fe.userId,name:fe.heroName,joinedAt:fe.joinedAt}))}),Y.length<2){console.log("ℹ️ Firestore: Not enough users in matching pool for pairing (need 2, have",Y.length,")");return}console.log(`🔄 Firestore: Found ${Y.length} users in matching pool`);const G=Y;if(console.log("ℹ️ Firestore: Skipping user validation to avoid permission errors"),G.sort((fe,_e)=>{const ze=fe.joinedAt?new Date(fe.joinedAt).getTime():0,Se=_e.joinedAt?new Date(_e.joinedAt).getTime():0;return ze-Se}),console.log("🔄 Firestore: Sorted users by join time (oldest first):",G.map(fe=>({userId:fe.userId,joinedAt:fe.joinedAt}))),G.length>=2){const fe=G[G.length-1],_e=G[G.length-2];if(fe.userId!==_e.userId)try{console.log(`🔄 Firestore: SEQUENTIAL PAIRING: ${fe.userId} (${fe.heroName}) pairs with ${_e.userId} (${_e.heroName})`);const ze={matchedAt:new Date().toISOString(),compatibilityScore:.85,matchReasons:["Chain pairing algorithm","Arriving user paired with waiting user"],status:"active",lastMessageAt:new Date().toISOString(),user1RemovedFromPool:!1,user2RemovedFromPool:!1,user1Name:fe.heroName||"User 1",user2Name:_e.heroName||"User 2"};console.log("🔄 Firestore: About to call createBuddyPair with data:",{arrivingUserId:fe.userId,targetUserId:_e.userId,pairData:ze});const Se=await F.createBuddyPair(fe.userId,_e.userId,ze);if(console.log("🔄 Firestore: createBuddyPair returned:",Se),Se){const{ref:Re,set:Ve}=await be(()=>import("./index.esm-eba9a326.js"),[]);if(await Ve(Re(q,`users/${_e.userId}/buddyInfo`),{hasBuddy:!0,buddyId:fe.userId,pairId:Se,matchedAt:ze.matchedAt}),await Ve(Re(q,`users/${fe.userId}/buddyInfo`),{hasBuddy:!0,buddyId:_e.userId,pairId:Se,matchedAt:ze.matchedAt}),await F.removeFromMatchingPool(_e.userId),console.log(`✅ Firestore: SEQUENTIAL PAIRING: Created buddy pair ${Se}`),console.log(`✅ Firestore: SEQUENTIAL PAIRING: Removed ${_e.userId} (${_e.heroName}) from matching pool`),console.log(`✅ Firestore: SEQUENTIAL PAIRING: Kept ${fe.userId} (${fe.heroName}) in matching pool for next pairing`),o!=null&&o.uid&&[fe.userId,_e.userId].includes(o.uid))try{console.log("🔄 Buddy reloading will be handled by Arena component after matching")}catch(Le){console.error("Error reloading buddy data:",Le)}}else console.error(`❌ Firestore: Failed to create buddy pair between ${fe.userId} and ${_e.userId}`)}catch(ze){console.error(`❌ Firestore: Failed to create buddy pair between ${fe.userId} and ${_e.userId}:`,ze)}else console.log("ℹ️ Firestore: Same user in pool, cannot pair")}else console.log("ℹ️ Firestore: Not enough users in pool for pairing (need 2, have",G.length,")")}catch(F){console.error("❌ Firestore: Auto-matching failed:",F),console.log("🔄 Falling back to Realtime Database auto-matching..."),await br()}},br=async()=>{try{console.log("🔄 Realtime Database: Starting fallback auto-matching...");const{ref:F,get:Y,set:G,push:fe,remove:_e}=await be(()=>import("./index.esm-eba9a326.js"),[]),ze=F(q,"matchingPool"),Se=await Y(ze);if(!Se.exists()){console.log("ℹ️ Realtime Database: No users in matching pool");return}const Re=Se.val(),Ve=[];if(Object.entries(Re).forEach(([Ue,Qe])=>{typeof Qe=="string"?Ve.push(Qe):Qe&&typeof Qe=="object"?Qe.uid?Ve.push(Qe.uid):Qe.userId?Ve.push(Qe.userId):Ve.push(Ue):Ve.push(Ue)}),console.log(`🔄 Realtime Database: Found ${Ve.length} users in matching pool`),Ve.length<2){console.log("ℹ️ Realtime Database: Not enough users for pairing (need 2, have",Ve.length,")");return}const bt=Ve;console.log("ℹ️ Realtime Database: Skipping user validation to avoid permission errors"),console.log(`🔄 Realtime Database: Valid users for pairing: ${bt.join(", ")}`);const Le=bt.map((Ue,Qe)=>({userId:Ue,joinedAt:new Date(Date.now()-(bt.length-Qe)*1e3).toISOString()}));if(Le.sort((Ue,Qe)=>{const me=Ue.joinedAt?new Date(Ue.joinedAt).getTime():0,we=Qe.joinedAt?new Date(Qe.joinedAt).getTime():0;return me-we}),console.log("🔄 Realtime Database: Sorted users by join time (oldest first):",Le.map(Ue=>({userId:Ue.userId,joinedAt:Ue.joinedAt}))),Le.length>=2){const Ue=Le[0],Qe=Le[Le.length-1];if(Ue&&Qe&&Ue.userId!==Qe.userId){console.log(`🔄 Realtime Database: CHAIN PAIRING: ${Qe.userId} (arriving) pairs with ${Ue.userId} (waiting)`);try{const me=fe(F(q,"buddyPairs")).key,we={pairId:me,users:[Qe.userId,Ue.userId],matchedAt:new Date().toISOString(),compatibilityScore:.85,matchReasons:["Chain pairing algorithm","Arriving user paired with waiting user"],status:"active",lastMessageAt:new Date().toISOString(),user1RemovedFromPool:!1,user2RemovedFromPool:!1};await G(F(q,`buddyPairs/${me}`),we),await G(F(q,`users/${Ue.userId}/buddyInfo`),{hasBuddy:!0,buddyId:Qe.userId,pairId:me,matchedAt:we.matchedAt}),await G(F(q,`users/${Qe.userId}/buddyInfo`),{hasBuddy:!0,buddyId:Ue.userId,pairId:me,matchedAt:we.matchedAt}),Object.keys(Re).forEach(async ke=>{const dt=Re[ke];((dt==null?void 0:dt.uid)||(dt==null?void 0:dt.userId)||ke)===Ue.userId&&(await _e(F(q,`matchingPool/${ke}`)),console.log(`✅ Realtime Database: Removed ${Ue.userId} (waiting) from matching pool`))}),await G(F(q,`buddyPairs/${me}/user1RemovedFromPool`),!0),await G(F(q,`buddyPairs/${me}/user2RemovedFromPool`),!1),console.log(`✅ Realtime Database: CHAIN PAIRING: Created buddy pair ${me}`),console.log(`✅ Realtime Database: CHAIN PAIRING: Kept ${Qe.userId} (arriving) in matching pool for next pairing`)}catch(me){console.error("Error creating buddy pair:",me)}}else console.log("ℹ️ Realtime Database: Same user in pool, cannot pair")}else console.log("ℹ️ Realtime Database: Not enough users in pool for pairing (need 2, have",Le.length,")");if(o!=null&&o.uid&&Le.length>=2){const Ue=Le[0],Qe=Le[Le.length-1];if([Qe==null?void 0:Qe.userId,Ue==null?void 0:Ue.userId].includes(o.uid))try{console.log("🔄 Buddy reloading will be handled by Arena component after matching")}catch(we){console.error("Error reloading buddy data:",we)}}}catch(F){console.error("Error in Realtime Database auto-matching:",F)}},Wo={heroName:"",stats:null,achievements:[],archetype:"",avatar:null,isEmpty:!0,message:"We are looking for a suitable buddy for you"},Gr=()=>nt?{heroName:"Loading Buddy...",stats:{streakDays:0,addictionLevel:50,willpower:50,motivation:50,cravingResistance:50,triggerDefense:30,experiencePoints:0},achievements:[],archetype:"DETERMINED",avatar:Ns("loading","adventurer"),isLoading:!0}:rt?{heroName:"Error Loading Buddy",stats:{streakDays:0,addictionLevel:50,willpower:50,motivation:50,cravingResistance:50,triggerDefense:30,experiencePoints:0},achievements:[],archetype:"DETERMINED",avatar:Ns("error","adventurer"),isError:!0,errorMessage:rt}:Be||Wo,at=async F=>{console.log("Onboarding completed with user data:",F);try{if(!F||!F.heroName||!F.stats)throw new Error("Invalid user data received from onboarding");if(!g)throw new Error("No authenticated user found");const Y=new Date,G={...F,uid:g.uid,email:g.email,displayName:g.displayName||F.heroName,photoURL:g.photoURL,onboardingCompleted:!0,createdAt:Y.toISOString(),updatedAt:Y.getTime(),lastActivity:Y.toISOString(),daily:{[Y.toDateString()]:{logged:!0,onboarding:!0}}};console.log("Saving user data to Firebase:",G);const{ref:fe,set:_e}=await be(()=>import("./index.esm-eba9a326.js"),[]),ze=fe(q,`users/${g.uid}`);await _e(ze,G),console.log("Firebase save successful, updating app state..."),a(G),f(!0);try{const Re=_.current||D;if(Re){console.log("✅ Using Firestore for matching pool");const Ve={quitStartDate:G.quitDate||new Date().toISOString(),addictionLevel:G.stats.addictionLevel||50,triggers:G.triggers||[],timezone:Intl.DateTimeFormat().resolvedOptions().timeZone,quitExperience:G.quitAttempts||"first",availableForMatching:!0,lastActive:new Date,userId:g.uid,heroName:G.heroName,archetype:G.archetype,joinedAt:new Date().toISOString()};if(await Re.addToMatchingPool(g.uid,Ve))console.log("✅ User successfully added to Firestore matching pool");else throw new Error("Failed to add user to Firestore matching pool")}else{console.log("⚠️ FirestoreBuddyService not available, falling back to Realtime Database");const{ref:Ve,set:bt}=await be(()=>import("./index.esm-eba9a326.js"),[]),Le={quitStartDate:G.quitDate||new Date().toISOString(),addictionLevel:G.stats.addictionLevel||50,triggers:G.triggers||[],timezone:Intl.DateTimeFormat().resolvedOptions().timeZone,quitExperience:G.quitAttempts||"first",availableForMatching:!0,lastActive:Date.now(),userId:g.uid,heroName:G.heroName,archetype:G.archetype,joinedAt:new Date().toISOString()};await bt(Ve(q,`matchingPool/${g.uid}`),Le),console.log("✅ User added to Realtime Database matching pool (fallback)")}try{console.log("⏳ Waiting 1 second before attempting auto-matching..."),await new Promise(Ve=>setTimeout(Ve,1e3)),await Vt()}catch(Ve){console.error("Automatic matching failed:",Ve)}}catch(Re){console.error("⚠️ Failed to add user to buddy matching pool:",Re)}const Se=await $e(g.uid);r("arena")}catch(Y){console.error("Error in handleOnboardingComplete:",Y);const G=new Date,fe={heroName:(F==null?void 0:F.heroName)||"Hero",archetype:(F==null?void 0:F.archetype)||"The Determined",avatar:(F==null?void 0:F.avatar)||Ns("fallback"),stats:{addictionLevel:50,mentalStrength:50,motivation:50,triggerDefense:30,streakDays:0,experiencePoints:0},achievements:[],quitDate:G,createdAt:G.toISOString(),lastActivity:G.toISOString(),uid:g==null?void 0:g.uid,email:g==null?void 0:g.email,onboardingCompleted:!0};if(g)try{const{ref:_e,set:ze}=await be(()=>import("./index.esm-eba9a326.js"),[]),Se=_e(q,`users/${g.uid}`);await ze(Se,fe)}catch(_e){console.error("Failed to save fallback data to Firebase:",_e)}a(fe),f(!0),r("arena")}},lt=()=>{a(null),f(!1),r("onboarding"),e("arena"),i(null),localStorage.removeItem("quitCoachUser")},Tn=async()=>{try{console.log("Logging out user...");const{signOut:F}=await be(()=>import("./index.esm-ef74de8c.js"),[]);await F(so),a(null),y(null),f(!1),r("auth"),localStorage.removeItem("cravingWins"),localStorage.removeItem("specialFeatures"),console.log("User successfully logged out and redirected to login screen")}catch(F){console.error("Error during logout:",F),a(null),y(null),f(!1),r("auth")}},On=async()=>{if(!g){console.error("No authenticated user to reset");return}try{console.log("Resetting ALL user data for testing...");const{ref:F,set:Y,remove:G}=await be(()=>import("./index.esm-eba9a326.js"),[]),fe=F(q,`users/${g.uid}`);await Y(fe,null);const _e=F(q,"users");await Y(_e,null);const ze=F(q,"buddyPairs");await Y(ze,null);const Se=F(q,"matchingPool");await Y(Se,null),console.log("All user data and buddy matching data cleared from database"),a(null),f(!1),r("onboarding"),_t(null),Te(!1),Wt(null),console.log("Account reset successful - ready for fresh onboarding")}catch(F){console.error("Error resetting account for testing:",F)}},Ys=F=>{console.log("Tab changed to:",F),e(F),r(F),F==="arena"&&(o!=null&&o.uid)&&(console.log("🔄 Tab: Returning to Arena, forcing fresh stats reload..."),setTimeout(()=>{typeof refreshStats=="function"&&(console.log("🔄 Tab: Delayed refresh after tab switch..."),refreshStats())},1e3))},Ts=F=>{r(F==="mood-selector"?"mood-selector":"profile")},is=F=>{i(F),r("profile")},Di=()=>{r("profile")};return w?d.jsx("div",{className:"min-h-screen bg-gradient-to-br from-slate-900 via-blue-900 to-slate-900 flex items-center justify-center",children:d.jsxs("div",{className:"text-center text-white",children:[d.jsx("div",{className:"animate-spin rounded-full h-16 w-16 border-b-2 border-white mx-auto mb-6"}),d.jsx("h2",{className:"text-3xl font-bold mb-4",children:"🔐 Restoring Session..."}),d.jsx("p",{className:"text-xl text-gray-300 mb-4",children:"Checking authentication state"}),d.jsx("div",{className:"bg-slate-800/50 rounded-lg p-4 max-w-md mx-auto",children:d.jsxs("div",{className:"text-sm text-gray-400 space-y-2",children:[d.jsxs("div",{className:"flex items-center gap-2",children:[d.jsx("span",{className:"text-blue-400",children:"✓"}),"Checking Firebase Auth persistence"]}),d.jsxs("div",{className:"flex items-center gap-2",children:[d.jsx("span",{className:"text-blue-400",children:"✓"}),"Verifying user session (30 days)"]}),d.jsxs("div",{className:"flex items-center gap-2",children:[d.jsx("span",{className:"text-blue-400",children:"✓"}),"Loading user data from database"]})]})}),d.jsx("p",{className:"text-gray-400 text-sm mt-4",children:"This should take only a few seconds"})]})}):t==="auth"?d.jsx(Q9,{onAuthSuccess:vt}):M.isLoading?d.jsx("div",{className:"min-h-screen bg-gradient-to-br from-slate-900 via-blue-900 to-slate-900 flex items-center justify-center",children:d.jsxs("div",{className:"text-center text-white",children:[d.jsx("div",{className:"animate-spin rounded-full h-16 w-16 border-b-2 border-white mx-auto mb-6"}),d.jsx("h2",{className:"text-3xl font-bold mb-4",children:"📊 Loading Your Data..."}),d.jsx("p",{className:"text-xl text-gray-300 mb-4",children:M.currentStep}),d.jsxs("div",{className:"bg-slate-800/50 rounded-lg p-4 max-w-md mx-auto mb-6",children:[d.jsx("div",{className:"w-full bg-slate-700 rounded-full h-3 mb-3",children:d.jsx("div",{className:"bg-blue-500 h-3 rounded-full transition-all duration-500 ease-out",style:{width:`${M.progress}%`}})}),d.jsxs("div",{className:"text-sm text-gray-400",children:[M.progress,"% Complete"]})]}),d.jsx("div",{className:"bg-slate-800/50 rounded-lg p-4 max-w-md mx-auto",children:d.jsxs("div",{className:"text-sm text-gray-400 space-y-2",children:[d.jsxs("div",{className:"flex items-center gap-2",children:[d.jsx("span",{className:"text-blue-400",children:"✓"}),"Profile and onboarding data"]}),d.jsxs("div",{className:"flex items-center gap-2",children:[d.jsx("span",{className:"text-blue-400",children:"✓"}),"Battle stats and progress"]}),d.jsxs("div",{className:"flex items-center gap-2",children:[d.jsx("span",{className:"text-blue-400",children:"✓"}),"Habits and achievements"]}),d.jsxs("div",{className:"flex items-center gap-2",children:[d.jsx("span",{className:"text-blue-400",children:"✓"}),"Setting up live sync"]})]})}),M.error&&d.jsxs("div",{className:"mt-4 p-3 bg-red-600/20 border border-red-500/30 rounded-lg max-w-md mx-auto",children:[d.jsxs("p",{className:"text-red-300 text-sm",children:[d.jsx("span",{className:"font-semibold",children:"Error:"})," ",M.error]}),d.jsx("p",{className:"text-red-400 text-xs mt-1",children:"Don't worry, you can still use the app with basic functionality"})]}),d.jsx("p",{className:"text-gray-400 text-sm mt-4",children:"Syncing your data across all devices..."})]})}):d.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-slate-900 via-blue-900 to-slate-900",children:[d.jsx(Y9,{}),t==="onboarding"&&d.jsx("div",{children:d.jsx(f8,{onComplete:at,authUser:g})}),h&&o?d.jsxs(d.Fragment,{children:[t==="arena"&&d.jsx("div",{children:(()=>{try{const F=Gr();return d.jsx(_8,{user:o,userStats:Tt,nemesis:F,onBackToLogin:Tn,onResetForTesting:On,buddyLoading:nt,buddyError:rt,realBuddy:Be,loadRealBuddy:dr,buddyLoadAttempted:rn})}catch(F){return console.error("Error rendering ArenaView:",F),d.jsxs("div",{className:"text-white text-center p-8",children:[d.jsx("h2",{className:"text-2xl font-bold mb-4",children:"Error Loading Arena"}),d.jsx("p",{className:"text-gray-300 mb-4",children:F.message}),d.jsx("button",{onClick:()=>window.location.reload(),className:"bg-blue-600 px-4 py-2 rounded hover:bg-blue-700",children:"Reload App"})]})}})()}),t==="craving-support"&&d.jsx("div",{children:d.jsx(x8,{user:o,nemesis:Gr(),onBackToLogin:Tn,onResetForTesting:On,behavioralService:P,onBreathingComplete:async F=>{await qt()},setActiveTab:e})}),t==="profile"&&d.jsx("div",{children:d.jsx(S8,{user:o,onNavigate:Ts})}),t==="mood-selector"&&d.jsx(MoodSelector,{onMoodSelect:is,onBack:Di}),t==="settings"&&d.jsx(R8,{onResetApp:lt,onBackToLogin:Tn,onResetForTesting:On,firestoreBuddyService:D,firestoreBuddyServiceRef:_,initializeFirestoreBuddyService:T,behavioralService:P,user:o,onShowAnalytics:()=>u(!0)}),l&&d.jsx(h8,{user:o,behavioralService:P,onClose:()=>u(!1)}),d.jsx(y8,{activeTab:n,onTabChange:Ys,dataLoadingState:M,onRefreshData:te,offlineManager:ce})]}):d.jsx("div",{className:"flex items-center justify-center min-h-screen text-white",children:d.jsxs("div",{className:"text-center",children:[d.jsx("h2",{className:"text-2xl font-bold mb-4",children:"Loading..."}),d.jsx("p",{className:"text-gray-300",children:h?"User data missing":"Onboarding not completed"}),d.jsxs("p",{className:"text-gray-300",children:["Current view: ",t]}),d.jsxs("p",{className:"text-gray-300",children:["User data: ",o?JSON.stringify(o,null,2):"None"]}),d.jsx("button",{onClick:()=>{console.log("Debug button clicked"),console.log("Current state:",{hasCompletedOnboarding:h,user:o,currentView:t}),console.log("User data:",o)},className:"mt-4 px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700",children:"Debug State"})]})})]})};qy.createRoot(document.getElementById("root")).render(d.jsx(N8,{}));export{V8 as $,j8 as A,U8 as B,$8 as C,Ra as D,D8 as E,CR as F,X8 as G,Z8 as H,eq as I,tq as J,f4 as K,rq as L,ge as M,P8 as N,h4 as O,M8 as P,Ss as Q,Es as R,dq as S,D4 as T,cq as U,ct as V,L8 as W,O8 as X,Q8 as Y,K8 as Z,gq as _,C4 as a,Pq as a$,yP as a0,zd as a1,nU as a2,Dr as a3,Eq as a4,qs as a5,At as a6,Or as a7,Xa as a8,Za as a9,Yt as aA,x7 as aB,et as aC,yq as aD,w7 as aE,v7 as aF,wq as aG,rs as aH,q4 as aI,ti as aJ,zq as aK,qq as aL,Mq as aM,u7 as aN,c7 as aO,Bq as aP,Aq as aQ,Hr as aR,xq as aS,X6 as aT,cU as aU,_7 as aV,fU as aW,l7 as aX,Nq as aY,y7 as aZ,Qf as a_,kt as aa,z as ab,Ws as ac,Z6 as ad,bU as ae,Ln as af,Wc as ag,bh as ah,Yf as ai,Im as aj,Ah as ak,wm as al,Ix as am,Vr as an,xm as ao,no as ap,gt as aq,TU as ar,_s as as,EU as at,ww as au,an as av,Na as aw,ne as ax,_q as ay,M4 as az,Wr as b,Qi as b$,Wq as b0,Tq as b1,bq as b2,Rq as b3,m7 as b4,Uq as b5,jq as b6,nn as b7,Ch as b8,gU as b9,Pl as bA,rP as bB,Gq as bC,Iq as bD,a7 as bE,cs as bF,hU as bG,g7 as bH,mq as bI,Hq as bJ,Fq as bK,Vq as bL,$q as bM,kq as bN,Xq as bO,h7 as bP,Cq as bQ,Dl as bR,f7 as bS,b7 as bT,Ph as bU,kh as bV,C7 as bW,Kd as bX,nl as bY,Ki as bZ,I7 as b_,t7 as ba,dU as bb,Kq as bc,Qq as bd,ed as be,Yq as bf,Jq as bg,eU as bh,p7 as bi,d7 as bj,Sq as bk,Lq as bl,Oq as bm,GT as bn,n7 as bo,s7 as bp,r7 as bq,tU as br,QT as bs,Zq as bt,e7 as bu,Dq as bv,lU as bw,i7 as bx,o7 as by,xU as bz,K0 as c,kB as c$,ii as c0,Si as c1,Zf as c2,T7 as c3,va as c4,Hl as c5,mz as c6,E7 as c7,rW as c8,Mv as c9,G7 as cA,F7 as cB,O$ as cC,iW as cD,cW as cE,hW as cF,tW as cG,K7 as cH,X$ as cI,N7 as cJ,CU as cK,V$ as cL,oW as cM,lW as cN,dW as cO,zU as cP,X7 as cQ,q$ as cR,j$ as cS,V7 as cT,J$ as cU,k7 as cV,Dx as cW,D7 as cX,B$ as cY,j7 as cZ,sW as c_,S7 as ca,yz as cb,qx as cc,Yi as cd,L7 as ce,Z$ as cf,nW as cg,XP as ch,pz as ci,tD as cj,U$ as ck,M7 as cl,g$ as cm,$$ as cn,A7 as co,Z7 as cp,U7 as cq,W7 as cr,Sz as cs,R7 as ct,UU as cu,eW as cv,fW as cw,rb as cx,_B as cy,h$ as cz,Ls as d,uW as d0,J7 as d1,P7 as d2,Y7 as d3,z7 as d4,q7 as d5,aW as d6,B7 as d7,Q7 as d8,H7 as d9,$7 as da,O7 as db,be as dc,ac as e,fq as f,N4 as g,hq as h,lq as i,W8 as j,G8 as k,nq as l,iq as m,sq as n,Fe as o,R4 as p,oq as q,PR as r,pC as s,aq as t,uq as u,fw as v,Y8 as w,J8 as x,B8 as y,F8 as z};
