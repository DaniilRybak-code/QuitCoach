var N2=Object.defineProperty;var R2=(n,e,t)=>e in n?N2(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t;var qh=(n,e,t)=>(R2(n,typeof e!="symbol"?e+"":e,t),t);(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))r(s);new MutationObserver(s=>{for(const i of s)if(i.type==="childList")for(const o of i.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&r(o)}).observe(document,{childList:!0,subtree:!0});function t(s){const i={};return s.integrity&&(i.integrity=s.integrity),s.referrerPolicy&&(i.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?i.credentials="include":s.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function r(s){if(s.ep)return;s.ep=!0;const i=t(s);fetch(s.href,i)}})();function D2(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}var ZT={exports:{}},yp={},eA={exports:{}},He={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Hd=Symbol.for("react.element"),P2=Symbol.for("react.portal"),O2=Symbol.for("react.fragment"),j2=Symbol.for("react.strict_mode"),L2=Symbol.for("react.profiler"),M2=Symbol.for("react.provider"),V2=Symbol.for("react.context"),F2=Symbol.for("react.forward_ref"),$2=Symbol.for("react.suspense"),U2=Symbol.for("react.memo"),B2=Symbol.for("react.lazy"),BS=Symbol.iterator;function z2(n){return n===null||typeof n!="object"?null:(n=BS&&n[BS]||n["@@iterator"],typeof n=="function"?n:null)}var tA={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},nA=Object.assign,rA={};function xc(n,e,t){this.props=n,this.context=e,this.refs=rA,this.updater=t||tA}xc.prototype.isReactComponent={};xc.prototype.setState=function(n,e){if(typeof n!="object"&&typeof n!="function"&&n!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,n,e,"setState")};xc.prototype.forceUpdate=function(n){this.updater.enqueueForceUpdate(this,n,"forceUpdate")};function sA(){}sA.prototype=xc.prototype;function Gv(n,e,t){this.props=n,this.context=e,this.refs=rA,this.updater=t||tA}var Hv=Gv.prototype=new sA;Hv.constructor=Gv;nA(Hv,xc.prototype);Hv.isPureReactComponent=!0;var zS=Array.isArray,iA=Object.prototype.hasOwnProperty,Qv={current:null},oA={key:!0,ref:!0,__self:!0,__source:!0};function aA(n,e,t){var r,s={},i=null,o=null;if(e!=null)for(r in e.ref!==void 0&&(o=e.ref),e.key!==void 0&&(i=""+e.key),e)iA.call(e,r)&&!oA.hasOwnProperty(r)&&(s[r]=e[r]);var a=arguments.length-2;if(a===1)s.children=t;else if(1<a){for(var c=Array(a),u=0;u<a;u++)c[u]=arguments[u+2];s.children=c}if(n&&n.defaultProps)for(r in a=n.defaultProps,a)s[r]===void 0&&(s[r]=a[r]);return{$$typeof:Hd,type:n,key:i,ref:o,props:s,_owner:Qv.current}}function q2(n,e){return{$$typeof:Hd,type:n.type,key:e,ref:n.ref,props:n.props,_owner:n._owner}}function Kv(n){return typeof n=="object"&&n!==null&&n.$$typeof===Hd}function W2(n){var e={"=":"=0",":":"=2"};return"$"+n.replace(/[=:]/g,function(t){return e[t]})}var qS=/\/+/g;function Kg(n,e){return typeof n=="object"&&n!==null&&n.key!=null?W2(""+n.key):e.toString(36)}function Af(n,e,t,r,s){var i=typeof n;(i==="undefined"||i==="boolean")&&(n=null);var o=!1;if(n===null)o=!0;else switch(i){case"string":case"number":o=!0;break;case"object":switch(n.$$typeof){case Hd:case P2:o=!0}}if(o)return o=n,s=s(o),n=r===""?"."+Kg(o,0):r,zS(s)?(t="",n!=null&&(t=n.replace(qS,"$&/")+"/"),Af(s,e,t,"",function(u){return u})):s!=null&&(Kv(s)&&(s=q2(s,t+(!s.key||o&&o.key===s.key?"":(""+s.key).replace(qS,"$&/")+"/")+n)),e.push(s)),1;if(o=0,r=r===""?".":r+":",zS(n))for(var a=0;a<n.length;a++){i=n[a];var c=r+Kg(i,a);o+=Af(i,e,t,c,s)}else if(c=z2(n),typeof c=="function")for(n=c.call(n),a=0;!(i=n.next()).done;)i=i.value,c=r+Kg(i,a++),o+=Af(i,e,t,c,s);else if(i==="object")throw e=String(n),Error("Objects are not valid as a React child (found: "+(e==="[object Object]"?"object with keys {"+Object.keys(n).join(", ")+"}":e)+"). If you meant to render a collection of children, use an array instead.");return o}function Wh(n,e,t){if(n==null)return n;var r=[],s=0;return Af(n,r,"","",function(i){return e.call(t,i,s++)}),r}function G2(n){if(n._status===-1){var e=n._result;e=e(),e.then(function(t){(n._status===0||n._status===-1)&&(n._status=1,n._result=t)},function(t){(n._status===0||n._status===-1)&&(n._status=2,n._result=t)}),n._status===-1&&(n._status=0,n._result=e)}if(n._status===1)return n._result.default;throw n._result}var lr={current:null},Cf={transition:null},H2={ReactCurrentDispatcher:lr,ReactCurrentBatchConfig:Cf,ReactCurrentOwner:Qv};function lA(){throw Error("act(...) is not supported in production builds of React.")}He.Children={map:Wh,forEach:function(n,e,t){Wh(n,function(){e.apply(this,arguments)},t)},count:function(n){var e=0;return Wh(n,function(){e++}),e},toArray:function(n){return Wh(n,function(e){return e})||[]},only:function(n){if(!Kv(n))throw Error("React.Children.only expected to receive a single React element child.");return n}};He.Component=xc;He.Fragment=O2;He.Profiler=L2;He.PureComponent=Gv;He.StrictMode=j2;He.Suspense=$2;He.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=H2;He.act=lA;He.cloneElement=function(n,e,t){if(n==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+n+".");var r=nA({},n.props),s=n.key,i=n.ref,o=n._owner;if(e!=null){if(e.ref!==void 0&&(i=e.ref,o=Qv.current),e.key!==void 0&&(s=""+e.key),n.type&&n.type.defaultProps)var a=n.type.defaultProps;for(c in e)iA.call(e,c)&&!oA.hasOwnProperty(c)&&(r[c]=e[c]===void 0&&a!==void 0?a[c]:e[c])}var c=arguments.length-2;if(c===1)r.children=t;else if(1<c){a=Array(c);for(var u=0;u<c;u++)a[u]=arguments[u+2];r.children=a}return{$$typeof:Hd,type:n.type,key:s,ref:i,props:r,_owner:o}};He.createContext=function(n){return n={$$typeof:V2,_currentValue:n,_currentValue2:n,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},n.Provider={$$typeof:M2,_context:n},n.Consumer=n};He.createElement=aA;He.createFactory=function(n){var e=aA.bind(null,n);return e.type=n,e};He.createRef=function(){return{current:null}};He.forwardRef=function(n){return{$$typeof:F2,render:n}};He.isValidElement=Kv;He.lazy=function(n){return{$$typeof:B2,_payload:{_status:-1,_result:n},_init:G2}};He.memo=function(n,e){return{$$typeof:U2,type:n,compare:e===void 0?null:e}};He.startTransition=function(n){var e=Cf.transition;Cf.transition={};try{n()}finally{Cf.transition=e}};He.unstable_act=lA;He.useCallback=function(n,e){return lr.current.useCallback(n,e)};He.useContext=function(n){return lr.current.useContext(n)};He.useDebugValue=function(){};He.useDeferredValue=function(n){return lr.current.useDeferredValue(n)};He.useEffect=function(n,e){return lr.current.useEffect(n,e)};He.useId=function(){return lr.current.useId()};He.useImperativeHandle=function(n,e,t){return lr.current.useImperativeHandle(n,e,t)};He.useInsertionEffect=function(n,e){return lr.current.useInsertionEffect(n,e)};He.useLayoutEffect=function(n,e){return lr.current.useLayoutEffect(n,e)};He.useMemo=function(n,e){return lr.current.useMemo(n,e)};He.useReducer=function(n,e,t){return lr.current.useReducer(n,e,t)};He.useRef=function(n){return lr.current.useRef(n)};He.useState=function(n){return lr.current.useState(n)};He.useSyncExternalStore=function(n,e,t){return lr.current.useSyncExternalStore(n,e,t)};He.useTransition=function(){return lr.current.useTransition()};He.version="18.3.1";eA.exports=He;var D=eA.exports;const cA=D2(D);/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Q2=D,K2=Symbol.for("react.element"),Y2=Symbol.for("react.fragment"),J2=Object.prototype.hasOwnProperty,X2=Q2.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,Z2={key:!0,ref:!0,__self:!0,__source:!0};function uA(n,e,t){var r,s={},i=null,o=null;t!==void 0&&(i=""+t),e.key!==void 0&&(i=""+e.key),e.ref!==void 0&&(o=e.ref);for(r in e)J2.call(e,r)&&!Z2.hasOwnProperty(r)&&(s[r]=e[r]);if(n&&n.defaultProps)for(r in e=n.defaultProps,e)s[r]===void 0&&(s[r]=e[r]);return{$$typeof:K2,type:n,key:i,ref:o,props:s,_owner:X2.current}}yp.Fragment=Y2;yp.jsx=uA;yp.jsxs=uA;ZT.exports=yp;var l=ZT.exports,Zy={},dA={exports:{}},Vr={},hA={exports:{}},fA={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(n){function e(z,re){var W=z.length;z.push(re);e:for(;0<W;){var Q=W-1>>>1,ee=z[Q];if(0<s(ee,re))z[Q]=re,z[W]=ee,W=Q;else break e}}function t(z){return z.length===0?null:z[0]}function r(z){if(z.length===0)return null;var re=z[0],W=z.pop();if(W!==re){z[0]=W;e:for(var Q=0,ee=z.length,pe=ee>>>1;Q<pe;){var xe=2*(Q+1)-1,De=z[xe],Re=xe+1,_t=z[Re];if(0>s(De,W))Re<ee&&0>s(_t,De)?(z[Q]=_t,z[Re]=W,Q=Re):(z[Q]=De,z[xe]=W,Q=xe);else if(Re<ee&&0>s(_t,W))z[Q]=_t,z[Re]=W,Q=Re;else break e}}return re}function s(z,re){var W=z.sortIndex-re.sortIndex;return W!==0?W:z.id-re.id}if(typeof performance=="object"&&typeof performance.now=="function"){var i=performance;n.unstable_now=function(){return i.now()}}else{var o=Date,a=o.now();n.unstable_now=function(){return o.now()-a}}var c=[],u=[],h=1,f=null,m=3,y=!1,w=!1,S=!1,R=typeof setTimeout=="function"?setTimeout:null,T=typeof clearTimeout=="function"?clearTimeout:null,I=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function N(z){for(var re=t(u);re!==null;){if(re.callback===null)r(u);else if(re.startTime<=z)r(u),re.sortIndex=re.expirationTime,e(c,re);else break;re=t(u)}}function P(z){if(S=!1,N(z),!w)if(t(c)!==null)w=!0,ce(B);else{var re=t(u);re!==null&&we(P,re.startTime-z)}}function B(z,re){w=!1,S&&(S=!1,T(x),x=-1),y=!0;var W=m;try{for(N(re),f=t(c);f!==null&&(!(f.expirationTime>re)||z&&!C());){var Q=f.callback;if(typeof Q=="function"){f.callback=null,m=f.priorityLevel;var ee=Q(f.expirationTime<=re);re=n.unstable_now(),typeof ee=="function"?f.callback=ee:f===t(c)&&r(c),N(re)}else r(c);f=t(c)}if(f!==null)var pe=!0;else{var xe=t(u);xe!==null&&we(P,xe.startTime-re),pe=!1}return pe}finally{f=null,m=W,y=!1}}var F=!1,A=null,x=-1,E=5,k=-1;function C(){return!(n.unstable_now()-k<E)}function _(){if(A!==null){var z=n.unstable_now();k=z;var re=!0;try{re=A(!0,z)}finally{re?v():(F=!1,A=null)}}else F=!1}var v;if(typeof I=="function")v=function(){I(_)};else if(typeof MessageChannel<"u"){var V=new MessageChannel,U=V.port2;V.port1.onmessage=_,v=function(){U.postMessage(null)}}else v=function(){R(_,0)};function ce(z){A=z,F||(F=!0,v())}function we(z,re){x=R(function(){z(n.unstable_now())},re)}n.unstable_IdlePriority=5,n.unstable_ImmediatePriority=1,n.unstable_LowPriority=4,n.unstable_NormalPriority=3,n.unstable_Profiling=null,n.unstable_UserBlockingPriority=2,n.unstable_cancelCallback=function(z){z.callback=null},n.unstable_continueExecution=function(){w||y||(w=!0,ce(B))},n.unstable_forceFrameRate=function(z){0>z||125<z?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):E=0<z?Math.floor(1e3/z):5},n.unstable_getCurrentPriorityLevel=function(){return m},n.unstable_getFirstCallbackNode=function(){return t(c)},n.unstable_next=function(z){switch(m){case 1:case 2:case 3:var re=3;break;default:re=m}var W=m;m=re;try{return z()}finally{m=W}},n.unstable_pauseExecution=function(){},n.unstable_requestPaint=function(){},n.unstable_runWithPriority=function(z,re){switch(z){case 1:case 2:case 3:case 4:case 5:break;default:z=3}var W=m;m=z;try{return re()}finally{m=W}},n.unstable_scheduleCallback=function(z,re,W){var Q=n.unstable_now();switch(typeof W=="object"&&W!==null?(W=W.delay,W=typeof W=="number"&&0<W?Q+W:Q):W=Q,z){case 1:var ee=-1;break;case 2:ee=250;break;case 5:ee=1073741823;break;case 4:ee=1e4;break;default:ee=5e3}return ee=W+ee,z={id:h++,callback:re,priorityLevel:z,startTime:W,expirationTime:ee,sortIndex:-1},W>Q?(z.sortIndex=W,e(u,z),t(c)===null&&z===t(u)&&(S?(T(x),x=-1):S=!0,we(P,W-Q))):(z.sortIndex=ee,e(c,z),w||y||(w=!0,ce(B))),z},n.unstable_shouldYield=C,n.unstable_wrapCallback=function(z){var re=m;return function(){var W=m;m=re;try{return z.apply(this,arguments)}finally{m=W}}}})(fA);hA.exports=fA;var eO=hA.exports;/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var tO=D,Or=eO;function Y(n){for(var e="https://reactjs.org/docs/error-decoder.html?invariant="+n,t=1;t<arguments.length;t++)e+="&args[]="+encodeURIComponent(arguments[t]);return"Minified React error #"+n+"; visit "+e+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var mA=new Set,ed={};function Oa(n,e){Ul(n,e),Ul(n+"Capture",e)}function Ul(n,e){for(ed[n]=e,n=0;n<e.length;n++)mA.add(e[n])}var li=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),e_=Object.prototype.hasOwnProperty,nO=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,WS={},GS={};function rO(n){return e_.call(GS,n)?!0:e_.call(WS,n)?!1:nO.test(n)?GS[n]=!0:(WS[n]=!0,!1)}function sO(n,e,t,r){if(t!==null&&t.type===0)return!1;switch(typeof e){case"function":case"symbol":return!0;case"boolean":return r?!1:t!==null?!t.acceptsBooleans:(n=n.toLowerCase().slice(0,5),n!=="data-"&&n!=="aria-");default:return!1}}function iO(n,e,t,r){if(e===null||typeof e>"u"||sO(n,e,t,r))return!0;if(r)return!1;if(t!==null)switch(t.type){case 3:return!e;case 4:return e===!1;case 5:return isNaN(e);case 6:return isNaN(e)||1>e}return!1}function cr(n,e,t,r,s,i,o){this.acceptsBooleans=e===2||e===3||e===4,this.attributeName=r,this.attributeNamespace=s,this.mustUseProperty=t,this.propertyName=n,this.type=e,this.sanitizeURL=i,this.removeEmptyString=o}var Wn={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(n){Wn[n]=new cr(n,0,!1,n,null,!1,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(n){var e=n[0];Wn[e]=new cr(e,1,!1,n[1],null,!1,!1)});["contentEditable","draggable","spellCheck","value"].forEach(function(n){Wn[n]=new cr(n,2,!1,n.toLowerCase(),null,!1,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(n){Wn[n]=new cr(n,2,!1,n,null,!1,!1)});"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(n){Wn[n]=new cr(n,3,!1,n.toLowerCase(),null,!1,!1)});["checked","multiple","muted","selected"].forEach(function(n){Wn[n]=new cr(n,3,!0,n,null,!1,!1)});["capture","download"].forEach(function(n){Wn[n]=new cr(n,4,!1,n,null,!1,!1)});["cols","rows","size","span"].forEach(function(n){Wn[n]=new cr(n,6,!1,n,null,!1,!1)});["rowSpan","start"].forEach(function(n){Wn[n]=new cr(n,5,!1,n.toLowerCase(),null,!1,!1)});var Yv=/[\-:]([a-z])/g;function Jv(n){return n[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(n){var e=n.replace(Yv,Jv);Wn[e]=new cr(e,1,!1,n,null,!1,!1)});"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(n){var e=n.replace(Yv,Jv);Wn[e]=new cr(e,1,!1,n,"http://www.w3.org/1999/xlink",!1,!1)});["xml:base","xml:lang","xml:space"].forEach(function(n){var e=n.replace(Yv,Jv);Wn[e]=new cr(e,1,!1,n,"http://www.w3.org/XML/1998/namespace",!1,!1)});["tabIndex","crossOrigin"].forEach(function(n){Wn[n]=new cr(n,1,!1,n.toLowerCase(),null,!1,!1)});Wn.xlinkHref=new cr("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1);["src","href","action","formAction"].forEach(function(n){Wn[n]=new cr(n,1,!1,n.toLowerCase(),null,!0,!0)});function Xv(n,e,t,r){var s=Wn.hasOwnProperty(e)?Wn[e]:null;(s!==null?s.type!==0:r||!(2<e.length)||e[0]!=="o"&&e[0]!=="O"||e[1]!=="n"&&e[1]!=="N")&&(iO(e,t,s,r)&&(t=null),r||s===null?rO(e)&&(t===null?n.removeAttribute(e):n.setAttribute(e,""+t)):s.mustUseProperty?n[s.propertyName]=t===null?s.type===3?!1:"":t:(e=s.attributeName,r=s.attributeNamespace,t===null?n.removeAttribute(e):(s=s.type,t=s===3||s===4&&t===!0?"":""+t,r?n.setAttributeNS(r,e,t):n.setAttribute(e,t))))}var vi=tO.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,Gh=Symbol.for("react.element"),pl=Symbol.for("react.portal"),gl=Symbol.for("react.fragment"),Zv=Symbol.for("react.strict_mode"),t_=Symbol.for("react.profiler"),pA=Symbol.for("react.provider"),gA=Symbol.for("react.context"),e0=Symbol.for("react.forward_ref"),n_=Symbol.for("react.suspense"),r_=Symbol.for("react.suspense_list"),t0=Symbol.for("react.memo"),ji=Symbol.for("react.lazy"),yA=Symbol.for("react.offscreen"),HS=Symbol.iterator;function Qc(n){return n===null||typeof n!="object"?null:(n=HS&&n[HS]||n["@@iterator"],typeof n=="function"?n:null)}var Xt=Object.assign,Yg;function fu(n){if(Yg===void 0)try{throw Error()}catch(t){var e=t.stack.trim().match(/\n( *(at )?)/);Yg=e&&e[1]||""}return`
`+Yg+n}var Jg=!1;function Xg(n,e){if(!n||Jg)return"";Jg=!0;var t=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(e)if(e=function(){throw Error()},Object.defineProperty(e.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(e,[])}catch(u){var r=u}Reflect.construct(n,[],e)}else{try{e.call()}catch(u){r=u}n.call(e.prototype)}else{try{throw Error()}catch(u){r=u}n()}}catch(u){if(u&&r&&typeof u.stack=="string"){for(var s=u.stack.split(`
`),i=r.stack.split(`
`),o=s.length-1,a=i.length-1;1<=o&&0<=a&&s[o]!==i[a];)a--;for(;1<=o&&0<=a;o--,a--)if(s[o]!==i[a]){if(o!==1||a!==1)do if(o--,a--,0>a||s[o]!==i[a]){var c=`
`+s[o].replace(" at new "," at ");return n.displayName&&c.includes("<anonymous>")&&(c=c.replace("<anonymous>",n.displayName)),c}while(1<=o&&0<=a);break}}}finally{Jg=!1,Error.prepareStackTrace=t}return(n=n?n.displayName||n.name:"")?fu(n):""}function oO(n){switch(n.tag){case 5:return fu(n.type);case 16:return fu("Lazy");case 13:return fu("Suspense");case 19:return fu("SuspenseList");case 0:case 2:case 15:return n=Xg(n.type,!1),n;case 11:return n=Xg(n.type.render,!1),n;case 1:return n=Xg(n.type,!0),n;default:return""}}function s_(n){if(n==null)return null;if(typeof n=="function")return n.displayName||n.name||null;if(typeof n=="string")return n;switch(n){case gl:return"Fragment";case pl:return"Portal";case t_:return"Profiler";case Zv:return"StrictMode";case n_:return"Suspense";case r_:return"SuspenseList"}if(typeof n=="object")switch(n.$$typeof){case gA:return(n.displayName||"Context")+".Consumer";case pA:return(n._context.displayName||"Context")+".Provider";case e0:var e=n.render;return n=n.displayName,n||(n=e.displayName||e.name||"",n=n!==""?"ForwardRef("+n+")":"ForwardRef"),n;case t0:return e=n.displayName||null,e!==null?e:s_(n.type)||"Memo";case ji:e=n._payload,n=n._init;try{return s_(n(e))}catch{}}return null}function aO(n){var e=n.type;switch(n.tag){case 24:return"Cache";case 9:return(e.displayName||"Context")+".Consumer";case 10:return(e._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return n=e.render,n=n.displayName||n.name||"",e.displayName||(n!==""?"ForwardRef("+n+")":"ForwardRef");case 7:return"Fragment";case 5:return e;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return s_(e);case 8:return e===Zv?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof e=="function")return e.displayName||e.name||null;if(typeof e=="string")return e}return null}function fo(n){switch(typeof n){case"boolean":case"number":case"string":case"undefined":return n;case"object":return n;default:return""}}function _A(n){var e=n.type;return(n=n.nodeName)&&n.toLowerCase()==="input"&&(e==="checkbox"||e==="radio")}function lO(n){var e=_A(n)?"checked":"value",t=Object.getOwnPropertyDescriptor(n.constructor.prototype,e),r=""+n[e];if(!n.hasOwnProperty(e)&&typeof t<"u"&&typeof t.get=="function"&&typeof t.set=="function"){var s=t.get,i=t.set;return Object.defineProperty(n,e,{configurable:!0,get:function(){return s.call(this)},set:function(o){r=""+o,i.call(this,o)}}),Object.defineProperty(n,e,{enumerable:t.enumerable}),{getValue:function(){return r},setValue:function(o){r=""+o},stopTracking:function(){n._valueTracker=null,delete n[e]}}}}function Hh(n){n._valueTracker||(n._valueTracker=lO(n))}function vA(n){if(!n)return!1;var e=n._valueTracker;if(!e)return!0;var t=e.getValue(),r="";return n&&(r=_A(n)?n.checked?"true":"false":n.value),n=r,n!==t?(e.setValue(n),!0):!1}function rm(n){if(n=n||(typeof document<"u"?document:void 0),typeof n>"u")return null;try{return n.activeElement||n.body}catch{return n.body}}function i_(n,e){var t=e.checked;return Xt({},e,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:t??n._wrapperState.initialChecked})}function QS(n,e){var t=e.defaultValue==null?"":e.defaultValue,r=e.checked!=null?e.checked:e.defaultChecked;t=fo(e.value!=null?e.value:t),n._wrapperState={initialChecked:r,initialValue:t,controlled:e.type==="checkbox"||e.type==="radio"?e.checked!=null:e.value!=null}}function wA(n,e){e=e.checked,e!=null&&Xv(n,"checked",e,!1)}function o_(n,e){wA(n,e);var t=fo(e.value),r=e.type;if(t!=null)r==="number"?(t===0&&n.value===""||n.value!=t)&&(n.value=""+t):n.value!==""+t&&(n.value=""+t);else if(r==="submit"||r==="reset"){n.removeAttribute("value");return}e.hasOwnProperty("value")?a_(n,e.type,t):e.hasOwnProperty("defaultValue")&&a_(n,e.type,fo(e.defaultValue)),e.checked==null&&e.defaultChecked!=null&&(n.defaultChecked=!!e.defaultChecked)}function KS(n,e,t){if(e.hasOwnProperty("value")||e.hasOwnProperty("defaultValue")){var r=e.type;if(!(r!=="submit"&&r!=="reset"||e.value!==void 0&&e.value!==null))return;e=""+n._wrapperState.initialValue,t||e===n.value||(n.value=e),n.defaultValue=e}t=n.name,t!==""&&(n.name=""),n.defaultChecked=!!n._wrapperState.initialChecked,t!==""&&(n.name=t)}function a_(n,e,t){(e!=="number"||rm(n.ownerDocument)!==n)&&(t==null?n.defaultValue=""+n._wrapperState.initialValue:n.defaultValue!==""+t&&(n.defaultValue=""+t))}var mu=Array.isArray;function Al(n,e,t,r){if(n=n.options,e){e={};for(var s=0;s<t.length;s++)e["$"+t[s]]=!0;for(t=0;t<n.length;t++)s=e.hasOwnProperty("$"+n[t].value),n[t].selected!==s&&(n[t].selected=s),s&&r&&(n[t].defaultSelected=!0)}else{for(t=""+fo(t),e=null,s=0;s<n.length;s++){if(n[s].value===t){n[s].selected=!0,r&&(n[s].defaultSelected=!0);return}e!==null||n[s].disabled||(e=n[s])}e!==null&&(e.selected=!0)}}function l_(n,e){if(e.dangerouslySetInnerHTML!=null)throw Error(Y(91));return Xt({},e,{value:void 0,defaultValue:void 0,children:""+n._wrapperState.initialValue})}function YS(n,e){var t=e.value;if(t==null){if(t=e.children,e=e.defaultValue,t!=null){if(e!=null)throw Error(Y(92));if(mu(t)){if(1<t.length)throw Error(Y(93));t=t[0]}e=t}e==null&&(e=""),t=e}n._wrapperState={initialValue:fo(t)}}function xA(n,e){var t=fo(e.value),r=fo(e.defaultValue);t!=null&&(t=""+t,t!==n.value&&(n.value=t),e.defaultValue==null&&n.defaultValue!==t&&(n.defaultValue=t)),r!=null&&(n.defaultValue=""+r)}function JS(n){var e=n.textContent;e===n._wrapperState.initialValue&&e!==""&&e!==null&&(n.value=e)}function SA(n){switch(n){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function c_(n,e){return n==null||n==="http://www.w3.org/1999/xhtml"?SA(e):n==="http://www.w3.org/2000/svg"&&e==="foreignObject"?"http://www.w3.org/1999/xhtml":n}var Qh,IA=function(n){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(e,t,r,s){MSApp.execUnsafeLocalFunction(function(){return n(e,t,r,s)})}:n}(function(n,e){if(n.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in n)n.innerHTML=e;else{for(Qh=Qh||document.createElement("div"),Qh.innerHTML="<svg>"+e.valueOf().toString()+"</svg>",e=Qh.firstChild;n.firstChild;)n.removeChild(n.firstChild);for(;e.firstChild;)n.appendChild(e.firstChild)}});function td(n,e){if(e){var t=n.firstChild;if(t&&t===n.lastChild&&t.nodeType===3){t.nodeValue=e;return}}n.textContent=e}var bu={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},cO=["Webkit","ms","Moz","O"];Object.keys(bu).forEach(function(n){cO.forEach(function(e){e=e+n.charAt(0).toUpperCase()+n.substring(1),bu[e]=bu[n]})});function EA(n,e,t){return e==null||typeof e=="boolean"||e===""?"":t||typeof e!="number"||e===0||bu.hasOwnProperty(n)&&bu[n]?(""+e).trim():e+"px"}function bA(n,e){n=n.style;for(var t in e)if(e.hasOwnProperty(t)){var r=t.indexOf("--")===0,s=EA(t,e[t],r);t==="float"&&(t="cssFloat"),r?n.setProperty(t,s):n[t]=s}}var uO=Xt({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function u_(n,e){if(e){if(uO[n]&&(e.children!=null||e.dangerouslySetInnerHTML!=null))throw Error(Y(137,n));if(e.dangerouslySetInnerHTML!=null){if(e.children!=null)throw Error(Y(60));if(typeof e.dangerouslySetInnerHTML!="object"||!("__html"in e.dangerouslySetInnerHTML))throw Error(Y(61))}if(e.style!=null&&typeof e.style!="object")throw Error(Y(62))}}function d_(n,e){if(n.indexOf("-")===-1)return typeof e.is=="string";switch(n){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var h_=null;function n0(n){return n=n.target||n.srcElement||window,n.correspondingUseElement&&(n=n.correspondingUseElement),n.nodeType===3?n.parentNode:n}var f_=null,Cl=null,kl=null;function XS(n){if(n=Yd(n)){if(typeof f_!="function")throw Error(Y(280));var e=n.stateNode;e&&(e=Sp(e),f_(n.stateNode,n.type,e))}}function TA(n){Cl?kl?kl.push(n):kl=[n]:Cl=n}function AA(){if(Cl){var n=Cl,e=kl;if(kl=Cl=null,XS(n),e)for(n=0;n<e.length;n++)XS(e[n])}}function CA(n,e){return n(e)}function kA(){}var Zg=!1;function NA(n,e,t){if(Zg)return n(e,t);Zg=!0;try{return CA(n,e,t)}finally{Zg=!1,(Cl!==null||kl!==null)&&(kA(),AA())}}function nd(n,e){var t=n.stateNode;if(t===null)return null;var r=Sp(t);if(r===null)return null;t=r[e];e:switch(e){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(r=!r.disabled)||(n=n.type,r=!(n==="button"||n==="input"||n==="select"||n==="textarea")),n=!r;break e;default:n=!1}if(n)return null;if(t&&typeof t!="function")throw Error(Y(231,e,typeof t));return t}var m_=!1;if(li)try{var Kc={};Object.defineProperty(Kc,"passive",{get:function(){m_=!0}}),window.addEventListener("test",Kc,Kc),window.removeEventListener("test",Kc,Kc)}catch{m_=!1}function dO(n,e,t,r,s,i,o,a,c){var u=Array.prototype.slice.call(arguments,3);try{e.apply(t,u)}catch(h){this.onError(h)}}var Tu=!1,sm=null,im=!1,p_=null,hO={onError:function(n){Tu=!0,sm=n}};function fO(n,e,t,r,s,i,o,a,c){Tu=!1,sm=null,dO.apply(hO,arguments)}function mO(n,e,t,r,s,i,o,a,c){if(fO.apply(this,arguments),Tu){if(Tu){var u=sm;Tu=!1,sm=null}else throw Error(Y(198));im||(im=!0,p_=u)}}function ja(n){var e=n,t=n;if(n.alternate)for(;e.return;)e=e.return;else{n=e;do e=n,e.flags&4098&&(t=e.return),n=e.return;while(n)}return e.tag===3?t:null}function RA(n){if(n.tag===13){var e=n.memoizedState;if(e===null&&(n=n.alternate,n!==null&&(e=n.memoizedState)),e!==null)return e.dehydrated}return null}function ZS(n){if(ja(n)!==n)throw Error(Y(188))}function pO(n){var e=n.alternate;if(!e){if(e=ja(n),e===null)throw Error(Y(188));return e!==n?null:n}for(var t=n,r=e;;){var s=t.return;if(s===null)break;var i=s.alternate;if(i===null){if(r=s.return,r!==null){t=r;continue}break}if(s.child===i.child){for(i=s.child;i;){if(i===t)return ZS(s),n;if(i===r)return ZS(s),e;i=i.sibling}throw Error(Y(188))}if(t.return!==r.return)t=s,r=i;else{for(var o=!1,a=s.child;a;){if(a===t){o=!0,t=s,r=i;break}if(a===r){o=!0,r=s,t=i;break}a=a.sibling}if(!o){for(a=i.child;a;){if(a===t){o=!0,t=i,r=s;break}if(a===r){o=!0,r=i,t=s;break}a=a.sibling}if(!o)throw Error(Y(189))}}if(t.alternate!==r)throw Error(Y(190))}if(t.tag!==3)throw Error(Y(188));return t.stateNode.current===t?n:e}function DA(n){return n=pO(n),n!==null?PA(n):null}function PA(n){if(n.tag===5||n.tag===6)return n;for(n=n.child;n!==null;){var e=PA(n);if(e!==null)return e;n=n.sibling}return null}var OA=Or.unstable_scheduleCallback,eI=Or.unstable_cancelCallback,gO=Or.unstable_shouldYield,yO=Or.unstable_requestPaint,un=Or.unstable_now,_O=Or.unstable_getCurrentPriorityLevel,r0=Or.unstable_ImmediatePriority,jA=Or.unstable_UserBlockingPriority,om=Or.unstable_NormalPriority,vO=Or.unstable_LowPriority,LA=Or.unstable_IdlePriority,_p=null,Ps=null;function wO(n){if(Ps&&typeof Ps.onCommitFiberRoot=="function")try{Ps.onCommitFiberRoot(_p,n,void 0,(n.current.flags&128)===128)}catch{}}var ds=Math.clz32?Math.clz32:IO,xO=Math.log,SO=Math.LN2;function IO(n){return n>>>=0,n===0?32:31-(xO(n)/SO|0)|0}var Kh=64,Yh=4194304;function pu(n){switch(n&-n){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return n&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return n&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return n}}function am(n,e){var t=n.pendingLanes;if(t===0)return 0;var r=0,s=n.suspendedLanes,i=n.pingedLanes,o=t&268435455;if(o!==0){var a=o&~s;a!==0?r=pu(a):(i&=o,i!==0&&(r=pu(i)))}else o=t&~s,o!==0?r=pu(o):i!==0&&(r=pu(i));if(r===0)return 0;if(e!==0&&e!==r&&!(e&s)&&(s=r&-r,i=e&-e,s>=i||s===16&&(i&4194240)!==0))return e;if(r&4&&(r|=t&16),e=n.entangledLanes,e!==0)for(n=n.entanglements,e&=r;0<e;)t=31-ds(e),s=1<<t,r|=n[t],e&=~s;return r}function EO(n,e){switch(n){case 1:case 2:case 4:return e+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return e+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function bO(n,e){for(var t=n.suspendedLanes,r=n.pingedLanes,s=n.expirationTimes,i=n.pendingLanes;0<i;){var o=31-ds(i),a=1<<o,c=s[o];c===-1?(!(a&t)||a&r)&&(s[o]=EO(a,e)):c<=e&&(n.expiredLanes|=a),i&=~a}}function g_(n){return n=n.pendingLanes&-1073741825,n!==0?n:n&1073741824?1073741824:0}function MA(){var n=Kh;return Kh<<=1,!(Kh&4194240)&&(Kh=64),n}function ey(n){for(var e=[],t=0;31>t;t++)e.push(n);return e}function Qd(n,e,t){n.pendingLanes|=e,e!==536870912&&(n.suspendedLanes=0,n.pingedLanes=0),n=n.eventTimes,e=31-ds(e),n[e]=t}function TO(n,e){var t=n.pendingLanes&~e;n.pendingLanes=e,n.suspendedLanes=0,n.pingedLanes=0,n.expiredLanes&=e,n.mutableReadLanes&=e,n.entangledLanes&=e,e=n.entanglements;var r=n.eventTimes;for(n=n.expirationTimes;0<t;){var s=31-ds(t),i=1<<s;e[s]=0,r[s]=-1,n[s]=-1,t&=~i}}function s0(n,e){var t=n.entangledLanes|=e;for(n=n.entanglements;t;){var r=31-ds(t),s=1<<r;s&e|n[r]&e&&(n[r]|=e),t&=~s}}var ft=0;function VA(n){return n&=-n,1<n?4<n?n&268435455?16:536870912:4:1}var FA,i0,$A,UA,BA,y_=!1,Jh=[],Xi=null,Zi=null,eo=null,rd=new Map,sd=new Map,Mi=[],AO="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function tI(n,e){switch(n){case"focusin":case"focusout":Xi=null;break;case"dragenter":case"dragleave":Zi=null;break;case"mouseover":case"mouseout":eo=null;break;case"pointerover":case"pointerout":rd.delete(e.pointerId);break;case"gotpointercapture":case"lostpointercapture":sd.delete(e.pointerId)}}function Yc(n,e,t,r,s,i){return n===null||n.nativeEvent!==i?(n={blockedOn:e,domEventName:t,eventSystemFlags:r,nativeEvent:i,targetContainers:[s]},e!==null&&(e=Yd(e),e!==null&&i0(e)),n):(n.eventSystemFlags|=r,e=n.targetContainers,s!==null&&e.indexOf(s)===-1&&e.push(s),n)}function CO(n,e,t,r,s){switch(e){case"focusin":return Xi=Yc(Xi,n,e,t,r,s),!0;case"dragenter":return Zi=Yc(Zi,n,e,t,r,s),!0;case"mouseover":return eo=Yc(eo,n,e,t,r,s),!0;case"pointerover":var i=s.pointerId;return rd.set(i,Yc(rd.get(i)||null,n,e,t,r,s)),!0;case"gotpointercapture":return i=s.pointerId,sd.set(i,Yc(sd.get(i)||null,n,e,t,r,s)),!0}return!1}function zA(n){var e=Xo(n.target);if(e!==null){var t=ja(e);if(t!==null){if(e=t.tag,e===13){if(e=RA(t),e!==null){n.blockedOn=e,BA(n.priority,function(){$A(t)});return}}else if(e===3&&t.stateNode.current.memoizedState.isDehydrated){n.blockedOn=t.tag===3?t.stateNode.containerInfo:null;return}}}n.blockedOn=null}function kf(n){if(n.blockedOn!==null)return!1;for(var e=n.targetContainers;0<e.length;){var t=__(n.domEventName,n.eventSystemFlags,e[0],n.nativeEvent);if(t===null){t=n.nativeEvent;var r=new t.constructor(t.type,t);h_=r,t.target.dispatchEvent(r),h_=null}else return e=Yd(t),e!==null&&i0(e),n.blockedOn=t,!1;e.shift()}return!0}function nI(n,e,t){kf(n)&&t.delete(e)}function kO(){y_=!1,Xi!==null&&kf(Xi)&&(Xi=null),Zi!==null&&kf(Zi)&&(Zi=null),eo!==null&&kf(eo)&&(eo=null),rd.forEach(nI),sd.forEach(nI)}function Jc(n,e){n.blockedOn===e&&(n.blockedOn=null,y_||(y_=!0,Or.unstable_scheduleCallback(Or.unstable_NormalPriority,kO)))}function id(n){function e(s){return Jc(s,n)}if(0<Jh.length){Jc(Jh[0],n);for(var t=1;t<Jh.length;t++){var r=Jh[t];r.blockedOn===n&&(r.blockedOn=null)}}for(Xi!==null&&Jc(Xi,n),Zi!==null&&Jc(Zi,n),eo!==null&&Jc(eo,n),rd.forEach(e),sd.forEach(e),t=0;t<Mi.length;t++)r=Mi[t],r.blockedOn===n&&(r.blockedOn=null);for(;0<Mi.length&&(t=Mi[0],t.blockedOn===null);)zA(t),t.blockedOn===null&&Mi.shift()}var Nl=vi.ReactCurrentBatchConfig,lm=!0;function NO(n,e,t,r){var s=ft,i=Nl.transition;Nl.transition=null;try{ft=1,o0(n,e,t,r)}finally{ft=s,Nl.transition=i}}function RO(n,e,t,r){var s=ft,i=Nl.transition;Nl.transition=null;try{ft=4,o0(n,e,t,r)}finally{ft=s,Nl.transition=i}}function o0(n,e,t,r){if(lm){var s=__(n,e,t,r);if(s===null)uy(n,e,r,cm,t),tI(n,r);else if(CO(s,n,e,t,r))r.stopPropagation();else if(tI(n,r),e&4&&-1<AO.indexOf(n)){for(;s!==null;){var i=Yd(s);if(i!==null&&FA(i),i=__(n,e,t,r),i===null&&uy(n,e,r,cm,t),i===s)break;s=i}s!==null&&r.stopPropagation()}else uy(n,e,r,null,t)}}var cm=null;function __(n,e,t,r){if(cm=null,n=n0(r),n=Xo(n),n!==null)if(e=ja(n),e===null)n=null;else if(t=e.tag,t===13){if(n=RA(e),n!==null)return n;n=null}else if(t===3){if(e.stateNode.current.memoizedState.isDehydrated)return e.tag===3?e.stateNode.containerInfo:null;n=null}else e!==n&&(n=null);return cm=n,null}function qA(n){switch(n){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(_O()){case r0:return 1;case jA:return 4;case om:case vO:return 16;case LA:return 536870912;default:return 16}default:return 16}}var qi=null,a0=null,Nf=null;function WA(){if(Nf)return Nf;var n,e=a0,t=e.length,r,s="value"in qi?qi.value:qi.textContent,i=s.length;for(n=0;n<t&&e[n]===s[n];n++);var o=t-n;for(r=1;r<=o&&e[t-r]===s[i-r];r++);return Nf=s.slice(n,1<r?1-r:void 0)}function Rf(n){var e=n.keyCode;return"charCode"in n?(n=n.charCode,n===0&&e===13&&(n=13)):n=e,n===10&&(n=13),32<=n||n===13?n:0}function Xh(){return!0}function rI(){return!1}function Fr(n){function e(t,r,s,i,o){this._reactName=t,this._targetInst=s,this.type=r,this.nativeEvent=i,this.target=o,this.currentTarget=null;for(var a in n)n.hasOwnProperty(a)&&(t=n[a],this[a]=t?t(i):i[a]);return this.isDefaultPrevented=(i.defaultPrevented!=null?i.defaultPrevented:i.returnValue===!1)?Xh:rI,this.isPropagationStopped=rI,this}return Xt(e.prototype,{preventDefault:function(){this.defaultPrevented=!0;var t=this.nativeEvent;t&&(t.preventDefault?t.preventDefault():typeof t.returnValue!="unknown"&&(t.returnValue=!1),this.isDefaultPrevented=Xh)},stopPropagation:function(){var t=this.nativeEvent;t&&(t.stopPropagation?t.stopPropagation():typeof t.cancelBubble!="unknown"&&(t.cancelBubble=!0),this.isPropagationStopped=Xh)},persist:function(){},isPersistent:Xh}),e}var Sc={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(n){return n.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},l0=Fr(Sc),Kd=Xt({},Sc,{view:0,detail:0}),DO=Fr(Kd),ty,ny,Xc,vp=Xt({},Kd,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:c0,button:0,buttons:0,relatedTarget:function(n){return n.relatedTarget===void 0?n.fromElement===n.srcElement?n.toElement:n.fromElement:n.relatedTarget},movementX:function(n){return"movementX"in n?n.movementX:(n!==Xc&&(Xc&&n.type==="mousemove"?(ty=n.screenX-Xc.screenX,ny=n.screenY-Xc.screenY):ny=ty=0,Xc=n),ty)},movementY:function(n){return"movementY"in n?n.movementY:ny}}),sI=Fr(vp),PO=Xt({},vp,{dataTransfer:0}),OO=Fr(PO),jO=Xt({},Kd,{relatedTarget:0}),ry=Fr(jO),LO=Xt({},Sc,{animationName:0,elapsedTime:0,pseudoElement:0}),MO=Fr(LO),VO=Xt({},Sc,{clipboardData:function(n){return"clipboardData"in n?n.clipboardData:window.clipboardData}}),FO=Fr(VO),$O=Xt({},Sc,{data:0}),iI=Fr($O),UO={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},BO={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},zO={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function qO(n){var e=this.nativeEvent;return e.getModifierState?e.getModifierState(n):(n=zO[n])?!!e[n]:!1}function c0(){return qO}var WO=Xt({},Kd,{key:function(n){if(n.key){var e=UO[n.key]||n.key;if(e!=="Unidentified")return e}return n.type==="keypress"?(n=Rf(n),n===13?"Enter":String.fromCharCode(n)):n.type==="keydown"||n.type==="keyup"?BO[n.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:c0,charCode:function(n){return n.type==="keypress"?Rf(n):0},keyCode:function(n){return n.type==="keydown"||n.type==="keyup"?n.keyCode:0},which:function(n){return n.type==="keypress"?Rf(n):n.type==="keydown"||n.type==="keyup"?n.keyCode:0}}),GO=Fr(WO),HO=Xt({},vp,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),oI=Fr(HO),QO=Xt({},Kd,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:c0}),KO=Fr(QO),YO=Xt({},Sc,{propertyName:0,elapsedTime:0,pseudoElement:0}),JO=Fr(YO),XO=Xt({},vp,{deltaX:function(n){return"deltaX"in n?n.deltaX:"wheelDeltaX"in n?-n.wheelDeltaX:0},deltaY:function(n){return"deltaY"in n?n.deltaY:"wheelDeltaY"in n?-n.wheelDeltaY:"wheelDelta"in n?-n.wheelDelta:0},deltaZ:0,deltaMode:0}),ZO=Fr(XO),ej=[9,13,27,32],u0=li&&"CompositionEvent"in window,Au=null;li&&"documentMode"in document&&(Au=document.documentMode);var tj=li&&"TextEvent"in window&&!Au,GA=li&&(!u0||Au&&8<Au&&11>=Au),aI=String.fromCharCode(32),lI=!1;function HA(n,e){switch(n){case"keyup":return ej.indexOf(e.keyCode)!==-1;case"keydown":return e.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function QA(n){return n=n.detail,typeof n=="object"&&"data"in n?n.data:null}var yl=!1;function nj(n,e){switch(n){case"compositionend":return QA(e);case"keypress":return e.which!==32?null:(lI=!0,aI);case"textInput":return n=e.data,n===aI&&lI?null:n;default:return null}}function rj(n,e){if(yl)return n==="compositionend"||!u0&&HA(n,e)?(n=WA(),Nf=a0=qi=null,yl=!1,n):null;switch(n){case"paste":return null;case"keypress":if(!(e.ctrlKey||e.altKey||e.metaKey)||e.ctrlKey&&e.altKey){if(e.char&&1<e.char.length)return e.char;if(e.which)return String.fromCharCode(e.which)}return null;case"compositionend":return GA&&e.locale!=="ko"?null:e.data;default:return null}}var sj={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function cI(n){var e=n&&n.nodeName&&n.nodeName.toLowerCase();return e==="input"?!!sj[n.type]:e==="textarea"}function KA(n,e,t,r){TA(r),e=um(e,"onChange"),0<e.length&&(t=new l0("onChange","change",null,t,r),n.push({event:t,listeners:e}))}var Cu=null,od=null;function ij(n){o1(n,0)}function wp(n){var e=wl(n);if(vA(e))return n}function oj(n,e){if(n==="change")return e}var YA=!1;if(li){var sy;if(li){var iy="oninput"in document;if(!iy){var uI=document.createElement("div");uI.setAttribute("oninput","return;"),iy=typeof uI.oninput=="function"}sy=iy}else sy=!1;YA=sy&&(!document.documentMode||9<document.documentMode)}function dI(){Cu&&(Cu.detachEvent("onpropertychange",JA),od=Cu=null)}function JA(n){if(n.propertyName==="value"&&wp(od)){var e=[];KA(e,od,n,n0(n)),NA(ij,e)}}function aj(n,e,t){n==="focusin"?(dI(),Cu=e,od=t,Cu.attachEvent("onpropertychange",JA)):n==="focusout"&&dI()}function lj(n){if(n==="selectionchange"||n==="keyup"||n==="keydown")return wp(od)}function cj(n,e){if(n==="click")return wp(e)}function uj(n,e){if(n==="input"||n==="change")return wp(e)}function dj(n,e){return n===e&&(n!==0||1/n===1/e)||n!==n&&e!==e}var ps=typeof Object.is=="function"?Object.is:dj;function ad(n,e){if(ps(n,e))return!0;if(typeof n!="object"||n===null||typeof e!="object"||e===null)return!1;var t=Object.keys(n),r=Object.keys(e);if(t.length!==r.length)return!1;for(r=0;r<t.length;r++){var s=t[r];if(!e_.call(e,s)||!ps(n[s],e[s]))return!1}return!0}function hI(n){for(;n&&n.firstChild;)n=n.firstChild;return n}function fI(n,e){var t=hI(n);n=0;for(var r;t;){if(t.nodeType===3){if(r=n+t.textContent.length,n<=e&&r>=e)return{node:t,offset:e-n};n=r}e:{for(;t;){if(t.nextSibling){t=t.nextSibling;break e}t=t.parentNode}t=void 0}t=hI(t)}}function XA(n,e){return n&&e?n===e?!0:n&&n.nodeType===3?!1:e&&e.nodeType===3?XA(n,e.parentNode):"contains"in n?n.contains(e):n.compareDocumentPosition?!!(n.compareDocumentPosition(e)&16):!1:!1}function ZA(){for(var n=window,e=rm();e instanceof n.HTMLIFrameElement;){try{var t=typeof e.contentWindow.location.href=="string"}catch{t=!1}if(t)n=e.contentWindow;else break;e=rm(n.document)}return e}function d0(n){var e=n&&n.nodeName&&n.nodeName.toLowerCase();return e&&(e==="input"&&(n.type==="text"||n.type==="search"||n.type==="tel"||n.type==="url"||n.type==="password")||e==="textarea"||n.contentEditable==="true")}function hj(n){var e=ZA(),t=n.focusedElem,r=n.selectionRange;if(e!==t&&t&&t.ownerDocument&&XA(t.ownerDocument.documentElement,t)){if(r!==null&&d0(t)){if(e=r.start,n=r.end,n===void 0&&(n=e),"selectionStart"in t)t.selectionStart=e,t.selectionEnd=Math.min(n,t.value.length);else if(n=(e=t.ownerDocument||document)&&e.defaultView||window,n.getSelection){n=n.getSelection();var s=t.textContent.length,i=Math.min(r.start,s);r=r.end===void 0?i:Math.min(r.end,s),!n.extend&&i>r&&(s=r,r=i,i=s),s=fI(t,i);var o=fI(t,r);s&&o&&(n.rangeCount!==1||n.anchorNode!==s.node||n.anchorOffset!==s.offset||n.focusNode!==o.node||n.focusOffset!==o.offset)&&(e=e.createRange(),e.setStart(s.node,s.offset),n.removeAllRanges(),i>r?(n.addRange(e),n.extend(o.node,o.offset)):(e.setEnd(o.node,o.offset),n.addRange(e)))}}for(e=[],n=t;n=n.parentNode;)n.nodeType===1&&e.push({element:n,left:n.scrollLeft,top:n.scrollTop});for(typeof t.focus=="function"&&t.focus(),t=0;t<e.length;t++)n=e[t],n.element.scrollLeft=n.left,n.element.scrollTop=n.top}}var fj=li&&"documentMode"in document&&11>=document.documentMode,_l=null,v_=null,ku=null,w_=!1;function mI(n,e,t){var r=t.window===t?t.document:t.nodeType===9?t:t.ownerDocument;w_||_l==null||_l!==rm(r)||(r=_l,"selectionStart"in r&&d0(r)?r={start:r.selectionStart,end:r.selectionEnd}:(r=(r.ownerDocument&&r.ownerDocument.defaultView||window).getSelection(),r={anchorNode:r.anchorNode,anchorOffset:r.anchorOffset,focusNode:r.focusNode,focusOffset:r.focusOffset}),ku&&ad(ku,r)||(ku=r,r=um(v_,"onSelect"),0<r.length&&(e=new l0("onSelect","select",null,e,t),n.push({event:e,listeners:r}),e.target=_l)))}function Zh(n,e){var t={};return t[n.toLowerCase()]=e.toLowerCase(),t["Webkit"+n]="webkit"+e,t["Moz"+n]="moz"+e,t}var vl={animationend:Zh("Animation","AnimationEnd"),animationiteration:Zh("Animation","AnimationIteration"),animationstart:Zh("Animation","AnimationStart"),transitionend:Zh("Transition","TransitionEnd")},oy={},e1={};li&&(e1=document.createElement("div").style,"AnimationEvent"in window||(delete vl.animationend.animation,delete vl.animationiteration.animation,delete vl.animationstart.animation),"TransitionEvent"in window||delete vl.transitionend.transition);function xp(n){if(oy[n])return oy[n];if(!vl[n])return n;var e=vl[n],t;for(t in e)if(e.hasOwnProperty(t)&&t in e1)return oy[n]=e[t];return n}var t1=xp("animationend"),n1=xp("animationiteration"),r1=xp("animationstart"),s1=xp("transitionend"),i1=new Map,pI="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function Ao(n,e){i1.set(n,e),Oa(e,[n])}for(var ay=0;ay<pI.length;ay++){var ly=pI[ay],mj=ly.toLowerCase(),pj=ly[0].toUpperCase()+ly.slice(1);Ao(mj,"on"+pj)}Ao(t1,"onAnimationEnd");Ao(n1,"onAnimationIteration");Ao(r1,"onAnimationStart");Ao("dblclick","onDoubleClick");Ao("focusin","onFocus");Ao("focusout","onBlur");Ao(s1,"onTransitionEnd");Ul("onMouseEnter",["mouseout","mouseover"]);Ul("onMouseLeave",["mouseout","mouseover"]);Ul("onPointerEnter",["pointerout","pointerover"]);Ul("onPointerLeave",["pointerout","pointerover"]);Oa("onChange","change click focusin focusout input keydown keyup selectionchange".split(" "));Oa("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" "));Oa("onBeforeInput",["compositionend","keypress","textInput","paste"]);Oa("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" "));Oa("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" "));Oa("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var gu="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),gj=new Set("cancel close invalid load scroll toggle".split(" ").concat(gu));function gI(n,e,t){var r=n.type||"unknown-event";n.currentTarget=t,mO(r,e,void 0,n),n.currentTarget=null}function o1(n,e){e=(e&4)!==0;for(var t=0;t<n.length;t++){var r=n[t],s=r.event;r=r.listeners;e:{var i=void 0;if(e)for(var o=r.length-1;0<=o;o--){var a=r[o],c=a.instance,u=a.currentTarget;if(a=a.listener,c!==i&&s.isPropagationStopped())break e;gI(s,a,u),i=c}else for(o=0;o<r.length;o++){if(a=r[o],c=a.instance,u=a.currentTarget,a=a.listener,c!==i&&s.isPropagationStopped())break e;gI(s,a,u),i=c}}}if(im)throw n=p_,im=!1,p_=null,n}function jt(n,e){var t=e[b_];t===void 0&&(t=e[b_]=new Set);var r=n+"__bubble";t.has(r)||(a1(e,n,2,!1),t.add(r))}function cy(n,e,t){var r=0;e&&(r|=4),a1(t,n,r,e)}var ef="_reactListening"+Math.random().toString(36).slice(2);function ld(n){if(!n[ef]){n[ef]=!0,mA.forEach(function(t){t!=="selectionchange"&&(gj.has(t)||cy(t,!1,n),cy(t,!0,n))});var e=n.nodeType===9?n:n.ownerDocument;e===null||e[ef]||(e[ef]=!0,cy("selectionchange",!1,e))}}function a1(n,e,t,r){switch(qA(e)){case 1:var s=NO;break;case 4:s=RO;break;default:s=o0}t=s.bind(null,e,t,n),s=void 0,!m_||e!=="touchstart"&&e!=="touchmove"&&e!=="wheel"||(s=!0),r?s!==void 0?n.addEventListener(e,t,{capture:!0,passive:s}):n.addEventListener(e,t,!0):s!==void 0?n.addEventListener(e,t,{passive:s}):n.addEventListener(e,t,!1)}function uy(n,e,t,r,s){var i=r;if(!(e&1)&&!(e&2)&&r!==null)e:for(;;){if(r===null)return;var o=r.tag;if(o===3||o===4){var a=r.stateNode.containerInfo;if(a===s||a.nodeType===8&&a.parentNode===s)break;if(o===4)for(o=r.return;o!==null;){var c=o.tag;if((c===3||c===4)&&(c=o.stateNode.containerInfo,c===s||c.nodeType===8&&c.parentNode===s))return;o=o.return}for(;a!==null;){if(o=Xo(a),o===null)return;if(c=o.tag,c===5||c===6){r=i=o;continue e}a=a.parentNode}}r=r.return}NA(function(){var u=i,h=n0(t),f=[];e:{var m=i1.get(n);if(m!==void 0){var y=l0,w=n;switch(n){case"keypress":if(Rf(t)===0)break e;case"keydown":case"keyup":y=GO;break;case"focusin":w="focus",y=ry;break;case"focusout":w="blur",y=ry;break;case"beforeblur":case"afterblur":y=ry;break;case"click":if(t.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":y=sI;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":y=OO;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":y=KO;break;case t1:case n1:case r1:y=MO;break;case s1:y=JO;break;case"scroll":y=DO;break;case"wheel":y=ZO;break;case"copy":case"cut":case"paste":y=FO;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":y=oI}var S=(e&4)!==0,R=!S&&n==="scroll",T=S?m!==null?m+"Capture":null:m;S=[];for(var I=u,N;I!==null;){N=I;var P=N.stateNode;if(N.tag===5&&P!==null&&(N=P,T!==null&&(P=nd(I,T),P!=null&&S.push(cd(I,P,N)))),R)break;I=I.return}0<S.length&&(m=new y(m,w,null,t,h),f.push({event:m,listeners:S}))}}if(!(e&7)){e:{if(m=n==="mouseover"||n==="pointerover",y=n==="mouseout"||n==="pointerout",m&&t!==h_&&(w=t.relatedTarget||t.fromElement)&&(Xo(w)||w[ci]))break e;if((y||m)&&(m=h.window===h?h:(m=h.ownerDocument)?m.defaultView||m.parentWindow:window,y?(w=t.relatedTarget||t.toElement,y=u,w=w?Xo(w):null,w!==null&&(R=ja(w),w!==R||w.tag!==5&&w.tag!==6)&&(w=null)):(y=null,w=u),y!==w)){if(S=sI,P="onMouseLeave",T="onMouseEnter",I="mouse",(n==="pointerout"||n==="pointerover")&&(S=oI,P="onPointerLeave",T="onPointerEnter",I="pointer"),R=y==null?m:wl(y),N=w==null?m:wl(w),m=new S(P,I+"leave",y,t,h),m.target=R,m.relatedTarget=N,P=null,Xo(h)===u&&(S=new S(T,I+"enter",w,t,h),S.target=N,S.relatedTarget=R,P=S),R=P,y&&w)t:{for(S=y,T=w,I=0,N=S;N;N=nl(N))I++;for(N=0,P=T;P;P=nl(P))N++;for(;0<I-N;)S=nl(S),I--;for(;0<N-I;)T=nl(T),N--;for(;I--;){if(S===T||T!==null&&S===T.alternate)break t;S=nl(S),T=nl(T)}S=null}else S=null;y!==null&&yI(f,m,y,S,!1),w!==null&&R!==null&&yI(f,R,w,S,!0)}}e:{if(m=u?wl(u):window,y=m.nodeName&&m.nodeName.toLowerCase(),y==="select"||y==="input"&&m.type==="file")var B=oj;else if(cI(m))if(YA)B=uj;else{B=lj;var F=aj}else(y=m.nodeName)&&y.toLowerCase()==="input"&&(m.type==="checkbox"||m.type==="radio")&&(B=cj);if(B&&(B=B(n,u))){KA(f,B,t,h);break e}F&&F(n,m,u),n==="focusout"&&(F=m._wrapperState)&&F.controlled&&m.type==="number"&&a_(m,"number",m.value)}switch(F=u?wl(u):window,n){case"focusin":(cI(F)||F.contentEditable==="true")&&(_l=F,v_=u,ku=null);break;case"focusout":ku=v_=_l=null;break;case"mousedown":w_=!0;break;case"contextmenu":case"mouseup":case"dragend":w_=!1,mI(f,t,h);break;case"selectionchange":if(fj)break;case"keydown":case"keyup":mI(f,t,h)}var A;if(u0)e:{switch(n){case"compositionstart":var x="onCompositionStart";break e;case"compositionend":x="onCompositionEnd";break e;case"compositionupdate":x="onCompositionUpdate";break e}x=void 0}else yl?HA(n,t)&&(x="onCompositionEnd"):n==="keydown"&&t.keyCode===229&&(x="onCompositionStart");x&&(GA&&t.locale!=="ko"&&(yl||x!=="onCompositionStart"?x==="onCompositionEnd"&&yl&&(A=WA()):(qi=h,a0="value"in qi?qi.value:qi.textContent,yl=!0)),F=um(u,x),0<F.length&&(x=new iI(x,n,null,t,h),f.push({event:x,listeners:F}),A?x.data=A:(A=QA(t),A!==null&&(x.data=A)))),(A=tj?nj(n,t):rj(n,t))&&(u=um(u,"onBeforeInput"),0<u.length&&(h=new iI("onBeforeInput","beforeinput",null,t,h),f.push({event:h,listeners:u}),h.data=A))}o1(f,e)})}function cd(n,e,t){return{instance:n,listener:e,currentTarget:t}}function um(n,e){for(var t=e+"Capture",r=[];n!==null;){var s=n,i=s.stateNode;s.tag===5&&i!==null&&(s=i,i=nd(n,t),i!=null&&r.unshift(cd(n,i,s)),i=nd(n,e),i!=null&&r.push(cd(n,i,s))),n=n.return}return r}function nl(n){if(n===null)return null;do n=n.return;while(n&&n.tag!==5);return n||null}function yI(n,e,t,r,s){for(var i=e._reactName,o=[];t!==null&&t!==r;){var a=t,c=a.alternate,u=a.stateNode;if(c!==null&&c===r)break;a.tag===5&&u!==null&&(a=u,s?(c=nd(t,i),c!=null&&o.unshift(cd(t,c,a))):s||(c=nd(t,i),c!=null&&o.push(cd(t,c,a)))),t=t.return}o.length!==0&&n.push({event:e,listeners:o})}var yj=/\r\n?/g,_j=/\u0000|\uFFFD/g;function _I(n){return(typeof n=="string"?n:""+n).replace(yj,`
`).replace(_j,"")}function tf(n,e,t){if(e=_I(e),_I(n)!==e&&t)throw Error(Y(425))}function dm(){}var x_=null,S_=null;function I_(n,e){return n==="textarea"||n==="noscript"||typeof e.children=="string"||typeof e.children=="number"||typeof e.dangerouslySetInnerHTML=="object"&&e.dangerouslySetInnerHTML!==null&&e.dangerouslySetInnerHTML.__html!=null}var E_=typeof setTimeout=="function"?setTimeout:void 0,vj=typeof clearTimeout=="function"?clearTimeout:void 0,vI=typeof Promise=="function"?Promise:void 0,wj=typeof queueMicrotask=="function"?queueMicrotask:typeof vI<"u"?function(n){return vI.resolve(null).then(n).catch(xj)}:E_;function xj(n){setTimeout(function(){throw n})}function dy(n,e){var t=e,r=0;do{var s=t.nextSibling;if(n.removeChild(t),s&&s.nodeType===8)if(t=s.data,t==="/$"){if(r===0){n.removeChild(s),id(e);return}r--}else t!=="$"&&t!=="$?"&&t!=="$!"||r++;t=s}while(t);id(e)}function to(n){for(;n!=null;n=n.nextSibling){var e=n.nodeType;if(e===1||e===3)break;if(e===8){if(e=n.data,e==="$"||e==="$!"||e==="$?")break;if(e==="/$")return null}}return n}function wI(n){n=n.previousSibling;for(var e=0;n;){if(n.nodeType===8){var t=n.data;if(t==="$"||t==="$!"||t==="$?"){if(e===0)return n;e--}else t==="/$"&&e++}n=n.previousSibling}return null}var Ic=Math.random().toString(36).slice(2),Ts="__reactFiber$"+Ic,ud="__reactProps$"+Ic,ci="__reactContainer$"+Ic,b_="__reactEvents$"+Ic,Sj="__reactListeners$"+Ic,Ij="__reactHandles$"+Ic;function Xo(n){var e=n[Ts];if(e)return e;for(var t=n.parentNode;t;){if(e=t[ci]||t[Ts]){if(t=e.alternate,e.child!==null||t!==null&&t.child!==null)for(n=wI(n);n!==null;){if(t=n[Ts])return t;n=wI(n)}return e}n=t,t=n.parentNode}return null}function Yd(n){return n=n[Ts]||n[ci],!n||n.tag!==5&&n.tag!==6&&n.tag!==13&&n.tag!==3?null:n}function wl(n){if(n.tag===5||n.tag===6)return n.stateNode;throw Error(Y(33))}function Sp(n){return n[ud]||null}var T_=[],xl=-1;function Co(n){return{current:n}}function Mt(n){0>xl||(n.current=T_[xl],T_[xl]=null,xl--)}function kt(n,e){xl++,T_[xl]=n.current,n.current=e}var mo={},rr=Co(mo),pr=Co(!1),ha=mo;function Bl(n,e){var t=n.type.contextTypes;if(!t)return mo;var r=n.stateNode;if(r&&r.__reactInternalMemoizedUnmaskedChildContext===e)return r.__reactInternalMemoizedMaskedChildContext;var s={},i;for(i in t)s[i]=e[i];return r&&(n=n.stateNode,n.__reactInternalMemoizedUnmaskedChildContext=e,n.__reactInternalMemoizedMaskedChildContext=s),s}function gr(n){return n=n.childContextTypes,n!=null}function hm(){Mt(pr),Mt(rr)}function xI(n,e,t){if(rr.current!==mo)throw Error(Y(168));kt(rr,e),kt(pr,t)}function l1(n,e,t){var r=n.stateNode;if(e=e.childContextTypes,typeof r.getChildContext!="function")return t;r=r.getChildContext();for(var s in r)if(!(s in e))throw Error(Y(108,aO(n)||"Unknown",s));return Xt({},t,r)}function fm(n){return n=(n=n.stateNode)&&n.__reactInternalMemoizedMergedChildContext||mo,ha=rr.current,kt(rr,n),kt(pr,pr.current),!0}function SI(n,e,t){var r=n.stateNode;if(!r)throw Error(Y(169));t?(n=l1(n,e,ha),r.__reactInternalMemoizedMergedChildContext=n,Mt(pr),Mt(rr),kt(rr,n)):Mt(pr),kt(pr,t)}var Ys=null,Ip=!1,hy=!1;function c1(n){Ys===null?Ys=[n]:Ys.push(n)}function Ej(n){Ip=!0,c1(n)}function ko(){if(!hy&&Ys!==null){hy=!0;var n=0,e=ft;try{var t=Ys;for(ft=1;n<t.length;n++){var r=t[n];do r=r(!0);while(r!==null)}Ys=null,Ip=!1}catch(s){throw Ys!==null&&(Ys=Ys.slice(n+1)),OA(r0,ko),s}finally{ft=e,hy=!1}}return null}var Sl=[],Il=0,mm=null,pm=0,Br=[],zr=0,fa=null,Xs=1,Zs="";function Uo(n,e){Sl[Il++]=pm,Sl[Il++]=mm,mm=n,pm=e}function u1(n,e,t){Br[zr++]=Xs,Br[zr++]=Zs,Br[zr++]=fa,fa=n;var r=Xs;n=Zs;var s=32-ds(r)-1;r&=~(1<<s),t+=1;var i=32-ds(e)+s;if(30<i){var o=s-s%5;i=(r&(1<<o)-1).toString(32),r>>=o,s-=o,Xs=1<<32-ds(e)+s|t<<s|r,Zs=i+n}else Xs=1<<i|t<<s|r,Zs=n}function h0(n){n.return!==null&&(Uo(n,1),u1(n,1,0))}function f0(n){for(;n===mm;)mm=Sl[--Il],Sl[Il]=null,pm=Sl[--Il],Sl[Il]=null;for(;n===fa;)fa=Br[--zr],Br[zr]=null,Zs=Br[--zr],Br[zr]=null,Xs=Br[--zr],Br[zr]=null}var Nr=null,kr=null,Ut=!1,ls=null;function d1(n,e){var t=Wr(5,null,null,0);t.elementType="DELETED",t.stateNode=e,t.return=n,e=n.deletions,e===null?(n.deletions=[t],n.flags|=16):e.push(t)}function II(n,e){switch(n.tag){case 5:var t=n.type;return e=e.nodeType!==1||t.toLowerCase()!==e.nodeName.toLowerCase()?null:e,e!==null?(n.stateNode=e,Nr=n,kr=to(e.firstChild),!0):!1;case 6:return e=n.pendingProps===""||e.nodeType!==3?null:e,e!==null?(n.stateNode=e,Nr=n,kr=null,!0):!1;case 13:return e=e.nodeType!==8?null:e,e!==null?(t=fa!==null?{id:Xs,overflow:Zs}:null,n.memoizedState={dehydrated:e,treeContext:t,retryLane:1073741824},t=Wr(18,null,null,0),t.stateNode=e,t.return=n,n.child=t,Nr=n,kr=null,!0):!1;default:return!1}}function A_(n){return(n.mode&1)!==0&&(n.flags&128)===0}function C_(n){if(Ut){var e=kr;if(e){var t=e;if(!II(n,e)){if(A_(n))throw Error(Y(418));e=to(t.nextSibling);var r=Nr;e&&II(n,e)?d1(r,t):(n.flags=n.flags&-4097|2,Ut=!1,Nr=n)}}else{if(A_(n))throw Error(Y(418));n.flags=n.flags&-4097|2,Ut=!1,Nr=n}}}function EI(n){for(n=n.return;n!==null&&n.tag!==5&&n.tag!==3&&n.tag!==13;)n=n.return;Nr=n}function nf(n){if(n!==Nr)return!1;if(!Ut)return EI(n),Ut=!0,!1;var e;if((e=n.tag!==3)&&!(e=n.tag!==5)&&(e=n.type,e=e!=="head"&&e!=="body"&&!I_(n.type,n.memoizedProps)),e&&(e=kr)){if(A_(n))throw h1(),Error(Y(418));for(;e;)d1(n,e),e=to(e.nextSibling)}if(EI(n),n.tag===13){if(n=n.memoizedState,n=n!==null?n.dehydrated:null,!n)throw Error(Y(317));e:{for(n=n.nextSibling,e=0;n;){if(n.nodeType===8){var t=n.data;if(t==="/$"){if(e===0){kr=to(n.nextSibling);break e}e--}else t!=="$"&&t!=="$!"&&t!=="$?"||e++}n=n.nextSibling}kr=null}}else kr=Nr?to(n.stateNode.nextSibling):null;return!0}function h1(){for(var n=kr;n;)n=to(n.nextSibling)}function zl(){kr=Nr=null,Ut=!1}function m0(n){ls===null?ls=[n]:ls.push(n)}var bj=vi.ReactCurrentBatchConfig;function Zc(n,e,t){if(n=t.ref,n!==null&&typeof n!="function"&&typeof n!="object"){if(t._owner){if(t=t._owner,t){if(t.tag!==1)throw Error(Y(309));var r=t.stateNode}if(!r)throw Error(Y(147,n));var s=r,i=""+n;return e!==null&&e.ref!==null&&typeof e.ref=="function"&&e.ref._stringRef===i?e.ref:(e=function(o){var a=s.refs;o===null?delete a[i]:a[i]=o},e._stringRef=i,e)}if(typeof n!="string")throw Error(Y(284));if(!t._owner)throw Error(Y(290,n))}return n}function rf(n,e){throw n=Object.prototype.toString.call(e),Error(Y(31,n==="[object Object]"?"object with keys {"+Object.keys(e).join(", ")+"}":n))}function bI(n){var e=n._init;return e(n._payload)}function f1(n){function e(T,I){if(n){var N=T.deletions;N===null?(T.deletions=[I],T.flags|=16):N.push(I)}}function t(T,I){if(!n)return null;for(;I!==null;)e(T,I),I=I.sibling;return null}function r(T,I){for(T=new Map;I!==null;)I.key!==null?T.set(I.key,I):T.set(I.index,I),I=I.sibling;return T}function s(T,I){return T=io(T,I),T.index=0,T.sibling=null,T}function i(T,I,N){return T.index=N,n?(N=T.alternate,N!==null?(N=N.index,N<I?(T.flags|=2,I):N):(T.flags|=2,I)):(T.flags|=1048576,I)}function o(T){return n&&T.alternate===null&&(T.flags|=2),T}function a(T,I,N,P){return I===null||I.tag!==6?(I=vy(N,T.mode,P),I.return=T,I):(I=s(I,N),I.return=T,I)}function c(T,I,N,P){var B=N.type;return B===gl?h(T,I,N.props.children,P,N.key):I!==null&&(I.elementType===B||typeof B=="object"&&B!==null&&B.$$typeof===ji&&bI(B)===I.type)?(P=s(I,N.props),P.ref=Zc(T,I,N),P.return=T,P):(P=Vf(N.type,N.key,N.props,null,T.mode,P),P.ref=Zc(T,I,N),P.return=T,P)}function u(T,I,N,P){return I===null||I.tag!==4||I.stateNode.containerInfo!==N.containerInfo||I.stateNode.implementation!==N.implementation?(I=wy(N,T.mode,P),I.return=T,I):(I=s(I,N.children||[]),I.return=T,I)}function h(T,I,N,P,B){return I===null||I.tag!==7?(I=oa(N,T.mode,P,B),I.return=T,I):(I=s(I,N),I.return=T,I)}function f(T,I,N){if(typeof I=="string"&&I!==""||typeof I=="number")return I=vy(""+I,T.mode,N),I.return=T,I;if(typeof I=="object"&&I!==null){switch(I.$$typeof){case Gh:return N=Vf(I.type,I.key,I.props,null,T.mode,N),N.ref=Zc(T,null,I),N.return=T,N;case pl:return I=wy(I,T.mode,N),I.return=T,I;case ji:var P=I._init;return f(T,P(I._payload),N)}if(mu(I)||Qc(I))return I=oa(I,T.mode,N,null),I.return=T,I;rf(T,I)}return null}function m(T,I,N,P){var B=I!==null?I.key:null;if(typeof N=="string"&&N!==""||typeof N=="number")return B!==null?null:a(T,I,""+N,P);if(typeof N=="object"&&N!==null){switch(N.$$typeof){case Gh:return N.key===B?c(T,I,N,P):null;case pl:return N.key===B?u(T,I,N,P):null;case ji:return B=N._init,m(T,I,B(N._payload),P)}if(mu(N)||Qc(N))return B!==null?null:h(T,I,N,P,null);rf(T,N)}return null}function y(T,I,N,P,B){if(typeof P=="string"&&P!==""||typeof P=="number")return T=T.get(N)||null,a(I,T,""+P,B);if(typeof P=="object"&&P!==null){switch(P.$$typeof){case Gh:return T=T.get(P.key===null?N:P.key)||null,c(I,T,P,B);case pl:return T=T.get(P.key===null?N:P.key)||null,u(I,T,P,B);case ji:var F=P._init;return y(T,I,N,F(P._payload),B)}if(mu(P)||Qc(P))return T=T.get(N)||null,h(I,T,P,B,null);rf(I,P)}return null}function w(T,I,N,P){for(var B=null,F=null,A=I,x=I=0,E=null;A!==null&&x<N.length;x++){A.index>x?(E=A,A=null):E=A.sibling;var k=m(T,A,N[x],P);if(k===null){A===null&&(A=E);break}n&&A&&k.alternate===null&&e(T,A),I=i(k,I,x),F===null?B=k:F.sibling=k,F=k,A=E}if(x===N.length)return t(T,A),Ut&&Uo(T,x),B;if(A===null){for(;x<N.length;x++)A=f(T,N[x],P),A!==null&&(I=i(A,I,x),F===null?B=A:F.sibling=A,F=A);return Ut&&Uo(T,x),B}for(A=r(T,A);x<N.length;x++)E=y(A,T,x,N[x],P),E!==null&&(n&&E.alternate!==null&&A.delete(E.key===null?x:E.key),I=i(E,I,x),F===null?B=E:F.sibling=E,F=E);return n&&A.forEach(function(C){return e(T,C)}),Ut&&Uo(T,x),B}function S(T,I,N,P){var B=Qc(N);if(typeof B!="function")throw Error(Y(150));if(N=B.call(N),N==null)throw Error(Y(151));for(var F=B=null,A=I,x=I=0,E=null,k=N.next();A!==null&&!k.done;x++,k=N.next()){A.index>x?(E=A,A=null):E=A.sibling;var C=m(T,A,k.value,P);if(C===null){A===null&&(A=E);break}n&&A&&C.alternate===null&&e(T,A),I=i(C,I,x),F===null?B=C:F.sibling=C,F=C,A=E}if(k.done)return t(T,A),Ut&&Uo(T,x),B;if(A===null){for(;!k.done;x++,k=N.next())k=f(T,k.value,P),k!==null&&(I=i(k,I,x),F===null?B=k:F.sibling=k,F=k);return Ut&&Uo(T,x),B}for(A=r(T,A);!k.done;x++,k=N.next())k=y(A,T,x,k.value,P),k!==null&&(n&&k.alternate!==null&&A.delete(k.key===null?x:k.key),I=i(k,I,x),F===null?B=k:F.sibling=k,F=k);return n&&A.forEach(function(_){return e(T,_)}),Ut&&Uo(T,x),B}function R(T,I,N,P){if(typeof N=="object"&&N!==null&&N.type===gl&&N.key===null&&(N=N.props.children),typeof N=="object"&&N!==null){switch(N.$$typeof){case Gh:e:{for(var B=N.key,F=I;F!==null;){if(F.key===B){if(B=N.type,B===gl){if(F.tag===7){t(T,F.sibling),I=s(F,N.props.children),I.return=T,T=I;break e}}else if(F.elementType===B||typeof B=="object"&&B!==null&&B.$$typeof===ji&&bI(B)===F.type){t(T,F.sibling),I=s(F,N.props),I.ref=Zc(T,F,N),I.return=T,T=I;break e}t(T,F);break}else e(T,F);F=F.sibling}N.type===gl?(I=oa(N.props.children,T.mode,P,N.key),I.return=T,T=I):(P=Vf(N.type,N.key,N.props,null,T.mode,P),P.ref=Zc(T,I,N),P.return=T,T=P)}return o(T);case pl:e:{for(F=N.key;I!==null;){if(I.key===F)if(I.tag===4&&I.stateNode.containerInfo===N.containerInfo&&I.stateNode.implementation===N.implementation){t(T,I.sibling),I=s(I,N.children||[]),I.return=T,T=I;break e}else{t(T,I);break}else e(T,I);I=I.sibling}I=wy(N,T.mode,P),I.return=T,T=I}return o(T);case ji:return F=N._init,R(T,I,F(N._payload),P)}if(mu(N))return w(T,I,N,P);if(Qc(N))return S(T,I,N,P);rf(T,N)}return typeof N=="string"&&N!==""||typeof N=="number"?(N=""+N,I!==null&&I.tag===6?(t(T,I.sibling),I=s(I,N),I.return=T,T=I):(t(T,I),I=vy(N,T.mode,P),I.return=T,T=I),o(T)):t(T,I)}return R}var ql=f1(!0),m1=f1(!1),gm=Co(null),ym=null,El=null,p0=null;function g0(){p0=El=ym=null}function y0(n){var e=gm.current;Mt(gm),n._currentValue=e}function k_(n,e,t){for(;n!==null;){var r=n.alternate;if((n.childLanes&e)!==e?(n.childLanes|=e,r!==null&&(r.childLanes|=e)):r!==null&&(r.childLanes&e)!==e&&(r.childLanes|=e),n===t)break;n=n.return}}function Rl(n,e){ym=n,p0=El=null,n=n.dependencies,n!==null&&n.firstContext!==null&&(n.lanes&e&&(dr=!0),n.firstContext=null)}function Yr(n){var e=n._currentValue;if(p0!==n)if(n={context:n,memoizedValue:e,next:null},El===null){if(ym===null)throw Error(Y(308));El=n,ym.dependencies={lanes:0,firstContext:n}}else El=El.next=n;return e}var Zo=null;function _0(n){Zo===null?Zo=[n]:Zo.push(n)}function p1(n,e,t,r){var s=e.interleaved;return s===null?(t.next=t,_0(e)):(t.next=s.next,s.next=t),e.interleaved=t,ui(n,r)}function ui(n,e){n.lanes|=e;var t=n.alternate;for(t!==null&&(t.lanes|=e),t=n,n=n.return;n!==null;)n.childLanes|=e,t=n.alternate,t!==null&&(t.childLanes|=e),t=n,n=n.return;return t.tag===3?t.stateNode:null}var Li=!1;function v0(n){n.updateQueue={baseState:n.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function g1(n,e){n=n.updateQueue,e.updateQueue===n&&(e.updateQueue={baseState:n.baseState,firstBaseUpdate:n.firstBaseUpdate,lastBaseUpdate:n.lastBaseUpdate,shared:n.shared,effects:n.effects})}function oi(n,e){return{eventTime:n,lane:e,tag:0,payload:null,callback:null,next:null}}function no(n,e,t){var r=n.updateQueue;if(r===null)return null;if(r=r.shared,tt&2){var s=r.pending;return s===null?e.next=e:(e.next=s.next,s.next=e),r.pending=e,ui(n,t)}return s=r.interleaved,s===null?(e.next=e,_0(r)):(e.next=s.next,s.next=e),r.interleaved=e,ui(n,t)}function Df(n,e,t){if(e=e.updateQueue,e!==null&&(e=e.shared,(t&4194240)!==0)){var r=e.lanes;r&=n.pendingLanes,t|=r,e.lanes=t,s0(n,t)}}function TI(n,e){var t=n.updateQueue,r=n.alternate;if(r!==null&&(r=r.updateQueue,t===r)){var s=null,i=null;if(t=t.firstBaseUpdate,t!==null){do{var o={eventTime:t.eventTime,lane:t.lane,tag:t.tag,payload:t.payload,callback:t.callback,next:null};i===null?s=i=o:i=i.next=o,t=t.next}while(t!==null);i===null?s=i=e:i=i.next=e}else s=i=e;t={baseState:r.baseState,firstBaseUpdate:s,lastBaseUpdate:i,shared:r.shared,effects:r.effects},n.updateQueue=t;return}n=t.lastBaseUpdate,n===null?t.firstBaseUpdate=e:n.next=e,t.lastBaseUpdate=e}function _m(n,e,t,r){var s=n.updateQueue;Li=!1;var i=s.firstBaseUpdate,o=s.lastBaseUpdate,a=s.shared.pending;if(a!==null){s.shared.pending=null;var c=a,u=c.next;c.next=null,o===null?i=u:o.next=u,o=c;var h=n.alternate;h!==null&&(h=h.updateQueue,a=h.lastBaseUpdate,a!==o&&(a===null?h.firstBaseUpdate=u:a.next=u,h.lastBaseUpdate=c))}if(i!==null){var f=s.baseState;o=0,h=u=c=null,a=i;do{var m=a.lane,y=a.eventTime;if((r&m)===m){h!==null&&(h=h.next={eventTime:y,lane:0,tag:a.tag,payload:a.payload,callback:a.callback,next:null});e:{var w=n,S=a;switch(m=e,y=t,S.tag){case 1:if(w=S.payload,typeof w=="function"){f=w.call(y,f,m);break e}f=w;break e;case 3:w.flags=w.flags&-65537|128;case 0:if(w=S.payload,m=typeof w=="function"?w.call(y,f,m):w,m==null)break e;f=Xt({},f,m);break e;case 2:Li=!0}}a.callback!==null&&a.lane!==0&&(n.flags|=64,m=s.effects,m===null?s.effects=[a]:m.push(a))}else y={eventTime:y,lane:m,tag:a.tag,payload:a.payload,callback:a.callback,next:null},h===null?(u=h=y,c=f):h=h.next=y,o|=m;if(a=a.next,a===null){if(a=s.shared.pending,a===null)break;m=a,a=m.next,m.next=null,s.lastBaseUpdate=m,s.shared.pending=null}}while(1);if(h===null&&(c=f),s.baseState=c,s.firstBaseUpdate=u,s.lastBaseUpdate=h,e=s.shared.interleaved,e!==null){s=e;do o|=s.lane,s=s.next;while(s!==e)}else i===null&&(s.shared.lanes=0);pa|=o,n.lanes=o,n.memoizedState=f}}function AI(n,e,t){if(n=e.effects,e.effects=null,n!==null)for(e=0;e<n.length;e++){var r=n[e],s=r.callback;if(s!==null){if(r.callback=null,r=t,typeof s!="function")throw Error(Y(191,s));s.call(r)}}}var Jd={},Os=Co(Jd),dd=Co(Jd),hd=Co(Jd);function ea(n){if(n===Jd)throw Error(Y(174));return n}function w0(n,e){switch(kt(hd,e),kt(dd,n),kt(Os,Jd),n=e.nodeType,n){case 9:case 11:e=(e=e.documentElement)?e.namespaceURI:c_(null,"");break;default:n=n===8?e.parentNode:e,e=n.namespaceURI||null,n=n.tagName,e=c_(e,n)}Mt(Os),kt(Os,e)}function Wl(){Mt(Os),Mt(dd),Mt(hd)}function y1(n){ea(hd.current);var e=ea(Os.current),t=c_(e,n.type);e!==t&&(kt(dd,n),kt(Os,t))}function x0(n){dd.current===n&&(Mt(Os),Mt(dd))}var Kt=Co(0);function vm(n){for(var e=n;e!==null;){if(e.tag===13){var t=e.memoizedState;if(t!==null&&(t=t.dehydrated,t===null||t.data==="$?"||t.data==="$!"))return e}else if(e.tag===19&&e.memoizedProps.revealOrder!==void 0){if(e.flags&128)return e}else if(e.child!==null){e.child.return=e,e=e.child;continue}if(e===n)break;for(;e.sibling===null;){if(e.return===null||e.return===n)return null;e=e.return}e.sibling.return=e.return,e=e.sibling}return null}var fy=[];function S0(){for(var n=0;n<fy.length;n++)fy[n]._workInProgressVersionPrimary=null;fy.length=0}var Pf=vi.ReactCurrentDispatcher,my=vi.ReactCurrentBatchConfig,ma=0,Jt=null,xn=null,Nn=null,wm=!1,Nu=!1,fd=0,Tj=0;function Kn(){throw Error(Y(321))}function I0(n,e){if(e===null)return!1;for(var t=0;t<e.length&&t<n.length;t++)if(!ps(n[t],e[t]))return!1;return!0}function E0(n,e,t,r,s,i){if(ma=i,Jt=e,e.memoizedState=null,e.updateQueue=null,e.lanes=0,Pf.current=n===null||n.memoizedState===null?Nj:Rj,n=t(r,s),Nu){i=0;do{if(Nu=!1,fd=0,25<=i)throw Error(Y(301));i+=1,Nn=xn=null,e.updateQueue=null,Pf.current=Dj,n=t(r,s)}while(Nu)}if(Pf.current=xm,e=xn!==null&&xn.next!==null,ma=0,Nn=xn=Jt=null,wm=!1,e)throw Error(Y(300));return n}function b0(){var n=fd!==0;return fd=0,n}function Is(){var n={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return Nn===null?Jt.memoizedState=Nn=n:Nn=Nn.next=n,Nn}function Jr(){if(xn===null){var n=Jt.alternate;n=n!==null?n.memoizedState:null}else n=xn.next;var e=Nn===null?Jt.memoizedState:Nn.next;if(e!==null)Nn=e,xn=n;else{if(n===null)throw Error(Y(310));xn=n,n={memoizedState:xn.memoizedState,baseState:xn.baseState,baseQueue:xn.baseQueue,queue:xn.queue,next:null},Nn===null?Jt.memoizedState=Nn=n:Nn=Nn.next=n}return Nn}function md(n,e){return typeof e=="function"?e(n):e}function py(n){var e=Jr(),t=e.queue;if(t===null)throw Error(Y(311));t.lastRenderedReducer=n;var r=xn,s=r.baseQueue,i=t.pending;if(i!==null){if(s!==null){var o=s.next;s.next=i.next,i.next=o}r.baseQueue=s=i,t.pending=null}if(s!==null){i=s.next,r=r.baseState;var a=o=null,c=null,u=i;do{var h=u.lane;if((ma&h)===h)c!==null&&(c=c.next={lane:0,action:u.action,hasEagerState:u.hasEagerState,eagerState:u.eagerState,next:null}),r=u.hasEagerState?u.eagerState:n(r,u.action);else{var f={lane:h,action:u.action,hasEagerState:u.hasEagerState,eagerState:u.eagerState,next:null};c===null?(a=c=f,o=r):c=c.next=f,Jt.lanes|=h,pa|=h}u=u.next}while(u!==null&&u!==i);c===null?o=r:c.next=a,ps(r,e.memoizedState)||(dr=!0),e.memoizedState=r,e.baseState=o,e.baseQueue=c,t.lastRenderedState=r}if(n=t.interleaved,n!==null){s=n;do i=s.lane,Jt.lanes|=i,pa|=i,s=s.next;while(s!==n)}else s===null&&(t.lanes=0);return[e.memoizedState,t.dispatch]}function gy(n){var e=Jr(),t=e.queue;if(t===null)throw Error(Y(311));t.lastRenderedReducer=n;var r=t.dispatch,s=t.pending,i=e.memoizedState;if(s!==null){t.pending=null;var o=s=s.next;do i=n(i,o.action),o=o.next;while(o!==s);ps(i,e.memoizedState)||(dr=!0),e.memoizedState=i,e.baseQueue===null&&(e.baseState=i),t.lastRenderedState=i}return[i,r]}function _1(){}function v1(n,e){var t=Jt,r=Jr(),s=e(),i=!ps(r.memoizedState,s);if(i&&(r.memoizedState=s,dr=!0),r=r.queue,T0(S1.bind(null,t,r,n),[n]),r.getSnapshot!==e||i||Nn!==null&&Nn.memoizedState.tag&1){if(t.flags|=2048,pd(9,x1.bind(null,t,r,s,e),void 0,null),Pn===null)throw Error(Y(349));ma&30||w1(t,e,s)}return s}function w1(n,e,t){n.flags|=16384,n={getSnapshot:e,value:t},e=Jt.updateQueue,e===null?(e={lastEffect:null,stores:null},Jt.updateQueue=e,e.stores=[n]):(t=e.stores,t===null?e.stores=[n]:t.push(n))}function x1(n,e,t,r){e.value=t,e.getSnapshot=r,I1(e)&&E1(n)}function S1(n,e,t){return t(function(){I1(e)&&E1(n)})}function I1(n){var e=n.getSnapshot;n=n.value;try{var t=e();return!ps(n,t)}catch{return!0}}function E1(n){var e=ui(n,1);e!==null&&hs(e,n,1,-1)}function CI(n){var e=Is();return typeof n=="function"&&(n=n()),e.memoizedState=e.baseState=n,n={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:md,lastRenderedState:n},e.queue=n,n=n.dispatch=kj.bind(null,Jt,n),[e.memoizedState,n]}function pd(n,e,t,r){return n={tag:n,create:e,destroy:t,deps:r,next:null},e=Jt.updateQueue,e===null?(e={lastEffect:null,stores:null},Jt.updateQueue=e,e.lastEffect=n.next=n):(t=e.lastEffect,t===null?e.lastEffect=n.next=n:(r=t.next,t.next=n,n.next=r,e.lastEffect=n)),n}function b1(){return Jr().memoizedState}function Of(n,e,t,r){var s=Is();Jt.flags|=n,s.memoizedState=pd(1|e,t,void 0,r===void 0?null:r)}function Ep(n,e,t,r){var s=Jr();r=r===void 0?null:r;var i=void 0;if(xn!==null){var o=xn.memoizedState;if(i=o.destroy,r!==null&&I0(r,o.deps)){s.memoizedState=pd(e,t,i,r);return}}Jt.flags|=n,s.memoizedState=pd(1|e,t,i,r)}function kI(n,e){return Of(8390656,8,n,e)}function T0(n,e){return Ep(2048,8,n,e)}function T1(n,e){return Ep(4,2,n,e)}function A1(n,e){return Ep(4,4,n,e)}function C1(n,e){if(typeof e=="function")return n=n(),e(n),function(){e(null)};if(e!=null)return n=n(),e.current=n,function(){e.current=null}}function k1(n,e,t){return t=t!=null?t.concat([n]):null,Ep(4,4,C1.bind(null,e,n),t)}function A0(){}function N1(n,e){var t=Jr();e=e===void 0?null:e;var r=t.memoizedState;return r!==null&&e!==null&&I0(e,r[1])?r[0]:(t.memoizedState=[n,e],n)}function R1(n,e){var t=Jr();e=e===void 0?null:e;var r=t.memoizedState;return r!==null&&e!==null&&I0(e,r[1])?r[0]:(n=n(),t.memoizedState=[n,e],n)}function D1(n,e,t){return ma&21?(ps(t,e)||(t=MA(),Jt.lanes|=t,pa|=t,n.baseState=!0),e):(n.baseState&&(n.baseState=!1,dr=!0),n.memoizedState=t)}function Aj(n,e){var t=ft;ft=t!==0&&4>t?t:4,n(!0);var r=my.transition;my.transition={};try{n(!1),e()}finally{ft=t,my.transition=r}}function P1(){return Jr().memoizedState}function Cj(n,e,t){var r=so(n);if(t={lane:r,action:t,hasEagerState:!1,eagerState:null,next:null},O1(n))j1(e,t);else if(t=p1(n,e,t,r),t!==null){var s=or();hs(t,n,r,s),L1(t,e,r)}}function kj(n,e,t){var r=so(n),s={lane:r,action:t,hasEagerState:!1,eagerState:null,next:null};if(O1(n))j1(e,s);else{var i=n.alternate;if(n.lanes===0&&(i===null||i.lanes===0)&&(i=e.lastRenderedReducer,i!==null))try{var o=e.lastRenderedState,a=i(o,t);if(s.hasEagerState=!0,s.eagerState=a,ps(a,o)){var c=e.interleaved;c===null?(s.next=s,_0(e)):(s.next=c.next,c.next=s),e.interleaved=s;return}}catch{}finally{}t=p1(n,e,s,r),t!==null&&(s=or(),hs(t,n,r,s),L1(t,e,r))}}function O1(n){var e=n.alternate;return n===Jt||e!==null&&e===Jt}function j1(n,e){Nu=wm=!0;var t=n.pending;t===null?e.next=e:(e.next=t.next,t.next=e),n.pending=e}function L1(n,e,t){if(t&4194240){var r=e.lanes;r&=n.pendingLanes,t|=r,e.lanes=t,s0(n,t)}}var xm={readContext:Yr,useCallback:Kn,useContext:Kn,useEffect:Kn,useImperativeHandle:Kn,useInsertionEffect:Kn,useLayoutEffect:Kn,useMemo:Kn,useReducer:Kn,useRef:Kn,useState:Kn,useDebugValue:Kn,useDeferredValue:Kn,useTransition:Kn,useMutableSource:Kn,useSyncExternalStore:Kn,useId:Kn,unstable_isNewReconciler:!1},Nj={readContext:Yr,useCallback:function(n,e){return Is().memoizedState=[n,e===void 0?null:e],n},useContext:Yr,useEffect:kI,useImperativeHandle:function(n,e,t){return t=t!=null?t.concat([n]):null,Of(4194308,4,C1.bind(null,e,n),t)},useLayoutEffect:function(n,e){return Of(4194308,4,n,e)},useInsertionEffect:function(n,e){return Of(4,2,n,e)},useMemo:function(n,e){var t=Is();return e=e===void 0?null:e,n=n(),t.memoizedState=[n,e],n},useReducer:function(n,e,t){var r=Is();return e=t!==void 0?t(e):e,r.memoizedState=r.baseState=e,n={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:n,lastRenderedState:e},r.queue=n,n=n.dispatch=Cj.bind(null,Jt,n),[r.memoizedState,n]},useRef:function(n){var e=Is();return n={current:n},e.memoizedState=n},useState:CI,useDebugValue:A0,useDeferredValue:function(n){return Is().memoizedState=n},useTransition:function(){var n=CI(!1),e=n[0];return n=Aj.bind(null,n[1]),Is().memoizedState=n,[e,n]},useMutableSource:function(){},useSyncExternalStore:function(n,e,t){var r=Jt,s=Is();if(Ut){if(t===void 0)throw Error(Y(407));t=t()}else{if(t=e(),Pn===null)throw Error(Y(349));ma&30||w1(r,e,t)}s.memoizedState=t;var i={value:t,getSnapshot:e};return s.queue=i,kI(S1.bind(null,r,i,n),[n]),r.flags|=2048,pd(9,x1.bind(null,r,i,t,e),void 0,null),t},useId:function(){var n=Is(),e=Pn.identifierPrefix;if(Ut){var t=Zs,r=Xs;t=(r&~(1<<32-ds(r)-1)).toString(32)+t,e=":"+e+"R"+t,t=fd++,0<t&&(e+="H"+t.toString(32)),e+=":"}else t=Tj++,e=":"+e+"r"+t.toString(32)+":";return n.memoizedState=e},unstable_isNewReconciler:!1},Rj={readContext:Yr,useCallback:N1,useContext:Yr,useEffect:T0,useImperativeHandle:k1,useInsertionEffect:T1,useLayoutEffect:A1,useMemo:R1,useReducer:py,useRef:b1,useState:function(){return py(md)},useDebugValue:A0,useDeferredValue:function(n){var e=Jr();return D1(e,xn.memoizedState,n)},useTransition:function(){var n=py(md)[0],e=Jr().memoizedState;return[n,e]},useMutableSource:_1,useSyncExternalStore:v1,useId:P1,unstable_isNewReconciler:!1},Dj={readContext:Yr,useCallback:N1,useContext:Yr,useEffect:T0,useImperativeHandle:k1,useInsertionEffect:T1,useLayoutEffect:A1,useMemo:R1,useReducer:gy,useRef:b1,useState:function(){return gy(md)},useDebugValue:A0,useDeferredValue:function(n){var e=Jr();return xn===null?e.memoizedState=n:D1(e,xn.memoizedState,n)},useTransition:function(){var n=gy(md)[0],e=Jr().memoizedState;return[n,e]},useMutableSource:_1,useSyncExternalStore:v1,useId:P1,unstable_isNewReconciler:!1};function is(n,e){if(n&&n.defaultProps){e=Xt({},e),n=n.defaultProps;for(var t in n)e[t]===void 0&&(e[t]=n[t]);return e}return e}function N_(n,e,t,r){e=n.memoizedState,t=t(r,e),t=t==null?e:Xt({},e,t),n.memoizedState=t,n.lanes===0&&(n.updateQueue.baseState=t)}var bp={isMounted:function(n){return(n=n._reactInternals)?ja(n)===n:!1},enqueueSetState:function(n,e,t){n=n._reactInternals;var r=or(),s=so(n),i=oi(r,s);i.payload=e,t!=null&&(i.callback=t),e=no(n,i,s),e!==null&&(hs(e,n,s,r),Df(e,n,s))},enqueueReplaceState:function(n,e,t){n=n._reactInternals;var r=or(),s=so(n),i=oi(r,s);i.tag=1,i.payload=e,t!=null&&(i.callback=t),e=no(n,i,s),e!==null&&(hs(e,n,s,r),Df(e,n,s))},enqueueForceUpdate:function(n,e){n=n._reactInternals;var t=or(),r=so(n),s=oi(t,r);s.tag=2,e!=null&&(s.callback=e),e=no(n,s,r),e!==null&&(hs(e,n,r,t),Df(e,n,r))}};function NI(n,e,t,r,s,i,o){return n=n.stateNode,typeof n.shouldComponentUpdate=="function"?n.shouldComponentUpdate(r,i,o):e.prototype&&e.prototype.isPureReactComponent?!ad(t,r)||!ad(s,i):!0}function M1(n,e,t){var r=!1,s=mo,i=e.contextType;return typeof i=="object"&&i!==null?i=Yr(i):(s=gr(e)?ha:rr.current,r=e.contextTypes,i=(r=r!=null)?Bl(n,s):mo),e=new e(t,i),n.memoizedState=e.state!==null&&e.state!==void 0?e.state:null,e.updater=bp,n.stateNode=e,e._reactInternals=n,r&&(n=n.stateNode,n.__reactInternalMemoizedUnmaskedChildContext=s,n.__reactInternalMemoizedMaskedChildContext=i),e}function RI(n,e,t,r){n=e.state,typeof e.componentWillReceiveProps=="function"&&e.componentWillReceiveProps(t,r),typeof e.UNSAFE_componentWillReceiveProps=="function"&&e.UNSAFE_componentWillReceiveProps(t,r),e.state!==n&&bp.enqueueReplaceState(e,e.state,null)}function R_(n,e,t,r){var s=n.stateNode;s.props=t,s.state=n.memoizedState,s.refs={},v0(n);var i=e.contextType;typeof i=="object"&&i!==null?s.context=Yr(i):(i=gr(e)?ha:rr.current,s.context=Bl(n,i)),s.state=n.memoizedState,i=e.getDerivedStateFromProps,typeof i=="function"&&(N_(n,e,i,t),s.state=n.memoizedState),typeof e.getDerivedStateFromProps=="function"||typeof s.getSnapshotBeforeUpdate=="function"||typeof s.UNSAFE_componentWillMount!="function"&&typeof s.componentWillMount!="function"||(e=s.state,typeof s.componentWillMount=="function"&&s.componentWillMount(),typeof s.UNSAFE_componentWillMount=="function"&&s.UNSAFE_componentWillMount(),e!==s.state&&bp.enqueueReplaceState(s,s.state,null),_m(n,t,s,r),s.state=n.memoizedState),typeof s.componentDidMount=="function"&&(n.flags|=4194308)}function Gl(n,e){try{var t="",r=e;do t+=oO(r),r=r.return;while(r);var s=t}catch(i){s=`
Error generating stack: `+i.message+`
`+i.stack}return{value:n,source:e,stack:s,digest:null}}function yy(n,e,t){return{value:n,source:null,stack:t??null,digest:e??null}}function D_(n,e){try{console.error(e.value)}catch(t){setTimeout(function(){throw t})}}var Pj=typeof WeakMap=="function"?WeakMap:Map;function V1(n,e,t){t=oi(-1,t),t.tag=3,t.payload={element:null};var r=e.value;return t.callback=function(){Im||(Im=!0,B_=r),D_(n,e)},t}function F1(n,e,t){t=oi(-1,t),t.tag=3;var r=n.type.getDerivedStateFromError;if(typeof r=="function"){var s=e.value;t.payload=function(){return r(s)},t.callback=function(){D_(n,e)}}var i=n.stateNode;return i!==null&&typeof i.componentDidCatch=="function"&&(t.callback=function(){D_(n,e),typeof r!="function"&&(ro===null?ro=new Set([this]):ro.add(this));var o=e.stack;this.componentDidCatch(e.value,{componentStack:o!==null?o:""})}),t}function DI(n,e,t){var r=n.pingCache;if(r===null){r=n.pingCache=new Pj;var s=new Set;r.set(e,s)}else s=r.get(e),s===void 0&&(s=new Set,r.set(e,s));s.has(t)||(s.add(t),n=Hj.bind(null,n,e,t),e.then(n,n))}function PI(n){do{var e;if((e=n.tag===13)&&(e=n.memoizedState,e=e!==null?e.dehydrated!==null:!0),e)return n;n=n.return}while(n!==null);return null}function OI(n,e,t,r,s){return n.mode&1?(n.flags|=65536,n.lanes=s,n):(n===e?n.flags|=65536:(n.flags|=128,t.flags|=131072,t.flags&=-52805,t.tag===1&&(t.alternate===null?t.tag=17:(e=oi(-1,1),e.tag=2,no(t,e,1))),t.lanes|=1),n)}var Oj=vi.ReactCurrentOwner,dr=!1;function sr(n,e,t,r){e.child=n===null?m1(e,null,t,r):ql(e,n.child,t,r)}function jI(n,e,t,r,s){t=t.render;var i=e.ref;return Rl(e,s),r=E0(n,e,t,r,i,s),t=b0(),n!==null&&!dr?(e.updateQueue=n.updateQueue,e.flags&=-2053,n.lanes&=~s,di(n,e,s)):(Ut&&t&&h0(e),e.flags|=1,sr(n,e,r,s),e.child)}function LI(n,e,t,r,s){if(n===null){var i=t.type;return typeof i=="function"&&!j0(i)&&i.defaultProps===void 0&&t.compare===null&&t.defaultProps===void 0?(e.tag=15,e.type=i,$1(n,e,i,r,s)):(n=Vf(t.type,null,r,e,e.mode,s),n.ref=e.ref,n.return=e,e.child=n)}if(i=n.child,!(n.lanes&s)){var o=i.memoizedProps;if(t=t.compare,t=t!==null?t:ad,t(o,r)&&n.ref===e.ref)return di(n,e,s)}return e.flags|=1,n=io(i,r),n.ref=e.ref,n.return=e,e.child=n}function $1(n,e,t,r,s){if(n!==null){var i=n.memoizedProps;if(ad(i,r)&&n.ref===e.ref)if(dr=!1,e.pendingProps=r=i,(n.lanes&s)!==0)n.flags&131072&&(dr=!0);else return e.lanes=n.lanes,di(n,e,s)}return P_(n,e,t,r,s)}function U1(n,e,t){var r=e.pendingProps,s=r.children,i=n!==null?n.memoizedState:null;if(r.mode==="hidden")if(!(e.mode&1))e.memoizedState={baseLanes:0,cachePool:null,transitions:null},kt(Tl,Er),Er|=t;else{if(!(t&1073741824))return n=i!==null?i.baseLanes|t:t,e.lanes=e.childLanes=1073741824,e.memoizedState={baseLanes:n,cachePool:null,transitions:null},e.updateQueue=null,kt(Tl,Er),Er|=n,null;e.memoizedState={baseLanes:0,cachePool:null,transitions:null},r=i!==null?i.baseLanes:t,kt(Tl,Er),Er|=r}else i!==null?(r=i.baseLanes|t,e.memoizedState=null):r=t,kt(Tl,Er),Er|=r;return sr(n,e,s,t),e.child}function B1(n,e){var t=e.ref;(n===null&&t!==null||n!==null&&n.ref!==t)&&(e.flags|=512,e.flags|=2097152)}function P_(n,e,t,r,s){var i=gr(t)?ha:rr.current;return i=Bl(e,i),Rl(e,s),t=E0(n,e,t,r,i,s),r=b0(),n!==null&&!dr?(e.updateQueue=n.updateQueue,e.flags&=-2053,n.lanes&=~s,di(n,e,s)):(Ut&&r&&h0(e),e.flags|=1,sr(n,e,t,s),e.child)}function MI(n,e,t,r,s){if(gr(t)){var i=!0;fm(e)}else i=!1;if(Rl(e,s),e.stateNode===null)jf(n,e),M1(e,t,r),R_(e,t,r,s),r=!0;else if(n===null){var o=e.stateNode,a=e.memoizedProps;o.props=a;var c=o.context,u=t.contextType;typeof u=="object"&&u!==null?u=Yr(u):(u=gr(t)?ha:rr.current,u=Bl(e,u));var h=t.getDerivedStateFromProps,f=typeof h=="function"||typeof o.getSnapshotBeforeUpdate=="function";f||typeof o.UNSAFE_componentWillReceiveProps!="function"&&typeof o.componentWillReceiveProps!="function"||(a!==r||c!==u)&&RI(e,o,r,u),Li=!1;var m=e.memoizedState;o.state=m,_m(e,r,o,s),c=e.memoizedState,a!==r||m!==c||pr.current||Li?(typeof h=="function"&&(N_(e,t,h,r),c=e.memoizedState),(a=Li||NI(e,t,a,r,m,c,u))?(f||typeof o.UNSAFE_componentWillMount!="function"&&typeof o.componentWillMount!="function"||(typeof o.componentWillMount=="function"&&o.componentWillMount(),typeof o.UNSAFE_componentWillMount=="function"&&o.UNSAFE_componentWillMount()),typeof o.componentDidMount=="function"&&(e.flags|=4194308)):(typeof o.componentDidMount=="function"&&(e.flags|=4194308),e.memoizedProps=r,e.memoizedState=c),o.props=r,o.state=c,o.context=u,r=a):(typeof o.componentDidMount=="function"&&(e.flags|=4194308),r=!1)}else{o=e.stateNode,g1(n,e),a=e.memoizedProps,u=e.type===e.elementType?a:is(e.type,a),o.props=u,f=e.pendingProps,m=o.context,c=t.contextType,typeof c=="object"&&c!==null?c=Yr(c):(c=gr(t)?ha:rr.current,c=Bl(e,c));var y=t.getDerivedStateFromProps;(h=typeof y=="function"||typeof o.getSnapshotBeforeUpdate=="function")||typeof o.UNSAFE_componentWillReceiveProps!="function"&&typeof o.componentWillReceiveProps!="function"||(a!==f||m!==c)&&RI(e,o,r,c),Li=!1,m=e.memoizedState,o.state=m,_m(e,r,o,s);var w=e.memoizedState;a!==f||m!==w||pr.current||Li?(typeof y=="function"&&(N_(e,t,y,r),w=e.memoizedState),(u=Li||NI(e,t,u,r,m,w,c)||!1)?(h||typeof o.UNSAFE_componentWillUpdate!="function"&&typeof o.componentWillUpdate!="function"||(typeof o.componentWillUpdate=="function"&&o.componentWillUpdate(r,w,c),typeof o.UNSAFE_componentWillUpdate=="function"&&o.UNSAFE_componentWillUpdate(r,w,c)),typeof o.componentDidUpdate=="function"&&(e.flags|=4),typeof o.getSnapshotBeforeUpdate=="function"&&(e.flags|=1024)):(typeof o.componentDidUpdate!="function"||a===n.memoizedProps&&m===n.memoizedState||(e.flags|=4),typeof o.getSnapshotBeforeUpdate!="function"||a===n.memoizedProps&&m===n.memoizedState||(e.flags|=1024),e.memoizedProps=r,e.memoizedState=w),o.props=r,o.state=w,o.context=c,r=u):(typeof o.componentDidUpdate!="function"||a===n.memoizedProps&&m===n.memoizedState||(e.flags|=4),typeof o.getSnapshotBeforeUpdate!="function"||a===n.memoizedProps&&m===n.memoizedState||(e.flags|=1024),r=!1)}return O_(n,e,t,r,i,s)}function O_(n,e,t,r,s,i){B1(n,e);var o=(e.flags&128)!==0;if(!r&&!o)return s&&SI(e,t,!1),di(n,e,i);r=e.stateNode,Oj.current=e;var a=o&&typeof t.getDerivedStateFromError!="function"?null:r.render();return e.flags|=1,n!==null&&o?(e.child=ql(e,n.child,null,i),e.child=ql(e,null,a,i)):sr(n,e,a,i),e.memoizedState=r.state,s&&SI(e,t,!0),e.child}function z1(n){var e=n.stateNode;e.pendingContext?xI(n,e.pendingContext,e.pendingContext!==e.context):e.context&&xI(n,e.context,!1),w0(n,e.containerInfo)}function VI(n,e,t,r,s){return zl(),m0(s),e.flags|=256,sr(n,e,t,r),e.child}var j_={dehydrated:null,treeContext:null,retryLane:0};function L_(n){return{baseLanes:n,cachePool:null,transitions:null}}function q1(n,e,t){var r=e.pendingProps,s=Kt.current,i=!1,o=(e.flags&128)!==0,a;if((a=o)||(a=n!==null&&n.memoizedState===null?!1:(s&2)!==0),a?(i=!0,e.flags&=-129):(n===null||n.memoizedState!==null)&&(s|=1),kt(Kt,s&1),n===null)return C_(e),n=e.memoizedState,n!==null&&(n=n.dehydrated,n!==null)?(e.mode&1?n.data==="$!"?e.lanes=8:e.lanes=1073741824:e.lanes=1,null):(o=r.children,n=r.fallback,i?(r=e.mode,i=e.child,o={mode:"hidden",children:o},!(r&1)&&i!==null?(i.childLanes=0,i.pendingProps=o):i=Cp(o,r,0,null),n=oa(n,r,t,null),i.return=e,n.return=e,i.sibling=n,e.child=i,e.child.memoizedState=L_(t),e.memoizedState=j_,n):C0(e,o));if(s=n.memoizedState,s!==null&&(a=s.dehydrated,a!==null))return jj(n,e,o,r,a,s,t);if(i){i=r.fallback,o=e.mode,s=n.child,a=s.sibling;var c={mode:"hidden",children:r.children};return!(o&1)&&e.child!==s?(r=e.child,r.childLanes=0,r.pendingProps=c,e.deletions=null):(r=io(s,c),r.subtreeFlags=s.subtreeFlags&14680064),a!==null?i=io(a,i):(i=oa(i,o,t,null),i.flags|=2),i.return=e,r.return=e,r.sibling=i,e.child=r,r=i,i=e.child,o=n.child.memoizedState,o=o===null?L_(t):{baseLanes:o.baseLanes|t,cachePool:null,transitions:o.transitions},i.memoizedState=o,i.childLanes=n.childLanes&~t,e.memoizedState=j_,r}return i=n.child,n=i.sibling,r=io(i,{mode:"visible",children:r.children}),!(e.mode&1)&&(r.lanes=t),r.return=e,r.sibling=null,n!==null&&(t=e.deletions,t===null?(e.deletions=[n],e.flags|=16):t.push(n)),e.child=r,e.memoizedState=null,r}function C0(n,e){return e=Cp({mode:"visible",children:e},n.mode,0,null),e.return=n,n.child=e}function sf(n,e,t,r){return r!==null&&m0(r),ql(e,n.child,null,t),n=C0(e,e.pendingProps.children),n.flags|=2,e.memoizedState=null,n}function jj(n,e,t,r,s,i,o){if(t)return e.flags&256?(e.flags&=-257,r=yy(Error(Y(422))),sf(n,e,o,r)):e.memoizedState!==null?(e.child=n.child,e.flags|=128,null):(i=r.fallback,s=e.mode,r=Cp({mode:"visible",children:r.children},s,0,null),i=oa(i,s,o,null),i.flags|=2,r.return=e,i.return=e,r.sibling=i,e.child=r,e.mode&1&&ql(e,n.child,null,o),e.child.memoizedState=L_(o),e.memoizedState=j_,i);if(!(e.mode&1))return sf(n,e,o,null);if(s.data==="$!"){if(r=s.nextSibling&&s.nextSibling.dataset,r)var a=r.dgst;return r=a,i=Error(Y(419)),r=yy(i,r,void 0),sf(n,e,o,r)}if(a=(o&n.childLanes)!==0,dr||a){if(r=Pn,r!==null){switch(o&-o){case 4:s=2;break;case 16:s=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:s=32;break;case 536870912:s=268435456;break;default:s=0}s=s&(r.suspendedLanes|o)?0:s,s!==0&&s!==i.retryLane&&(i.retryLane=s,ui(n,s),hs(r,n,s,-1))}return O0(),r=yy(Error(Y(421))),sf(n,e,o,r)}return s.data==="$?"?(e.flags|=128,e.child=n.child,e=Qj.bind(null,n),s._reactRetry=e,null):(n=i.treeContext,kr=to(s.nextSibling),Nr=e,Ut=!0,ls=null,n!==null&&(Br[zr++]=Xs,Br[zr++]=Zs,Br[zr++]=fa,Xs=n.id,Zs=n.overflow,fa=e),e=C0(e,r.children),e.flags|=4096,e)}function FI(n,e,t){n.lanes|=e;var r=n.alternate;r!==null&&(r.lanes|=e),k_(n.return,e,t)}function _y(n,e,t,r,s){var i=n.memoizedState;i===null?n.memoizedState={isBackwards:e,rendering:null,renderingStartTime:0,last:r,tail:t,tailMode:s}:(i.isBackwards=e,i.rendering=null,i.renderingStartTime=0,i.last=r,i.tail=t,i.tailMode=s)}function W1(n,e,t){var r=e.pendingProps,s=r.revealOrder,i=r.tail;if(sr(n,e,r.children,t),r=Kt.current,r&2)r=r&1|2,e.flags|=128;else{if(n!==null&&n.flags&128)e:for(n=e.child;n!==null;){if(n.tag===13)n.memoizedState!==null&&FI(n,t,e);else if(n.tag===19)FI(n,t,e);else if(n.child!==null){n.child.return=n,n=n.child;continue}if(n===e)break e;for(;n.sibling===null;){if(n.return===null||n.return===e)break e;n=n.return}n.sibling.return=n.return,n=n.sibling}r&=1}if(kt(Kt,r),!(e.mode&1))e.memoizedState=null;else switch(s){case"forwards":for(t=e.child,s=null;t!==null;)n=t.alternate,n!==null&&vm(n)===null&&(s=t),t=t.sibling;t=s,t===null?(s=e.child,e.child=null):(s=t.sibling,t.sibling=null),_y(e,!1,s,t,i);break;case"backwards":for(t=null,s=e.child,e.child=null;s!==null;){if(n=s.alternate,n!==null&&vm(n)===null){e.child=s;break}n=s.sibling,s.sibling=t,t=s,s=n}_y(e,!0,t,null,i);break;case"together":_y(e,!1,null,null,void 0);break;default:e.memoizedState=null}return e.child}function jf(n,e){!(e.mode&1)&&n!==null&&(n.alternate=null,e.alternate=null,e.flags|=2)}function di(n,e,t){if(n!==null&&(e.dependencies=n.dependencies),pa|=e.lanes,!(t&e.childLanes))return null;if(n!==null&&e.child!==n.child)throw Error(Y(153));if(e.child!==null){for(n=e.child,t=io(n,n.pendingProps),e.child=t,t.return=e;n.sibling!==null;)n=n.sibling,t=t.sibling=io(n,n.pendingProps),t.return=e;t.sibling=null}return e.child}function Lj(n,e,t){switch(e.tag){case 3:z1(e),zl();break;case 5:y1(e);break;case 1:gr(e.type)&&fm(e);break;case 4:w0(e,e.stateNode.containerInfo);break;case 10:var r=e.type._context,s=e.memoizedProps.value;kt(gm,r._currentValue),r._currentValue=s;break;case 13:if(r=e.memoizedState,r!==null)return r.dehydrated!==null?(kt(Kt,Kt.current&1),e.flags|=128,null):t&e.child.childLanes?q1(n,e,t):(kt(Kt,Kt.current&1),n=di(n,e,t),n!==null?n.sibling:null);kt(Kt,Kt.current&1);break;case 19:if(r=(t&e.childLanes)!==0,n.flags&128){if(r)return W1(n,e,t);e.flags|=128}if(s=e.memoizedState,s!==null&&(s.rendering=null,s.tail=null,s.lastEffect=null),kt(Kt,Kt.current),r)break;return null;case 22:case 23:return e.lanes=0,U1(n,e,t)}return di(n,e,t)}var G1,M_,H1,Q1;G1=function(n,e){for(var t=e.child;t!==null;){if(t.tag===5||t.tag===6)n.appendChild(t.stateNode);else if(t.tag!==4&&t.child!==null){t.child.return=t,t=t.child;continue}if(t===e)break;for(;t.sibling===null;){if(t.return===null||t.return===e)return;t=t.return}t.sibling.return=t.return,t=t.sibling}};M_=function(){};H1=function(n,e,t,r){var s=n.memoizedProps;if(s!==r){n=e.stateNode,ea(Os.current);var i=null;switch(t){case"input":s=i_(n,s),r=i_(n,r),i=[];break;case"select":s=Xt({},s,{value:void 0}),r=Xt({},r,{value:void 0}),i=[];break;case"textarea":s=l_(n,s),r=l_(n,r),i=[];break;default:typeof s.onClick!="function"&&typeof r.onClick=="function"&&(n.onclick=dm)}u_(t,r);var o;t=null;for(u in s)if(!r.hasOwnProperty(u)&&s.hasOwnProperty(u)&&s[u]!=null)if(u==="style"){var a=s[u];for(o in a)a.hasOwnProperty(o)&&(t||(t={}),t[o]="")}else u!=="dangerouslySetInnerHTML"&&u!=="children"&&u!=="suppressContentEditableWarning"&&u!=="suppressHydrationWarning"&&u!=="autoFocus"&&(ed.hasOwnProperty(u)?i||(i=[]):(i=i||[]).push(u,null));for(u in r){var c=r[u];if(a=s!=null?s[u]:void 0,r.hasOwnProperty(u)&&c!==a&&(c!=null||a!=null))if(u==="style")if(a){for(o in a)!a.hasOwnProperty(o)||c&&c.hasOwnProperty(o)||(t||(t={}),t[o]="");for(o in c)c.hasOwnProperty(o)&&a[o]!==c[o]&&(t||(t={}),t[o]=c[o])}else t||(i||(i=[]),i.push(u,t)),t=c;else u==="dangerouslySetInnerHTML"?(c=c?c.__html:void 0,a=a?a.__html:void 0,c!=null&&a!==c&&(i=i||[]).push(u,c)):u==="children"?typeof c!="string"&&typeof c!="number"||(i=i||[]).push(u,""+c):u!=="suppressContentEditableWarning"&&u!=="suppressHydrationWarning"&&(ed.hasOwnProperty(u)?(c!=null&&u==="onScroll"&&jt("scroll",n),i||a===c||(i=[])):(i=i||[]).push(u,c))}t&&(i=i||[]).push("style",t);var u=i;(e.updateQueue=u)&&(e.flags|=4)}};Q1=function(n,e,t,r){t!==r&&(e.flags|=4)};function eu(n,e){if(!Ut)switch(n.tailMode){case"hidden":e=n.tail;for(var t=null;e!==null;)e.alternate!==null&&(t=e),e=e.sibling;t===null?n.tail=null:t.sibling=null;break;case"collapsed":t=n.tail;for(var r=null;t!==null;)t.alternate!==null&&(r=t),t=t.sibling;r===null?e||n.tail===null?n.tail=null:n.tail.sibling=null:r.sibling=null}}function Yn(n){var e=n.alternate!==null&&n.alternate.child===n.child,t=0,r=0;if(e)for(var s=n.child;s!==null;)t|=s.lanes|s.childLanes,r|=s.subtreeFlags&14680064,r|=s.flags&14680064,s.return=n,s=s.sibling;else for(s=n.child;s!==null;)t|=s.lanes|s.childLanes,r|=s.subtreeFlags,r|=s.flags,s.return=n,s=s.sibling;return n.subtreeFlags|=r,n.childLanes=t,e}function Mj(n,e,t){var r=e.pendingProps;switch(f0(e),e.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Yn(e),null;case 1:return gr(e.type)&&hm(),Yn(e),null;case 3:return r=e.stateNode,Wl(),Mt(pr),Mt(rr),S0(),r.pendingContext&&(r.context=r.pendingContext,r.pendingContext=null),(n===null||n.child===null)&&(nf(e)?e.flags|=4:n===null||n.memoizedState.isDehydrated&&!(e.flags&256)||(e.flags|=1024,ls!==null&&(W_(ls),ls=null))),M_(n,e),Yn(e),null;case 5:x0(e);var s=ea(hd.current);if(t=e.type,n!==null&&e.stateNode!=null)H1(n,e,t,r,s),n.ref!==e.ref&&(e.flags|=512,e.flags|=2097152);else{if(!r){if(e.stateNode===null)throw Error(Y(166));return Yn(e),null}if(n=ea(Os.current),nf(e)){r=e.stateNode,t=e.type;var i=e.memoizedProps;switch(r[Ts]=e,r[ud]=i,n=(e.mode&1)!==0,t){case"dialog":jt("cancel",r),jt("close",r);break;case"iframe":case"object":case"embed":jt("load",r);break;case"video":case"audio":for(s=0;s<gu.length;s++)jt(gu[s],r);break;case"source":jt("error",r);break;case"img":case"image":case"link":jt("error",r),jt("load",r);break;case"details":jt("toggle",r);break;case"input":QS(r,i),jt("invalid",r);break;case"select":r._wrapperState={wasMultiple:!!i.multiple},jt("invalid",r);break;case"textarea":YS(r,i),jt("invalid",r)}u_(t,i),s=null;for(var o in i)if(i.hasOwnProperty(o)){var a=i[o];o==="children"?typeof a=="string"?r.textContent!==a&&(i.suppressHydrationWarning!==!0&&tf(r.textContent,a,n),s=["children",a]):typeof a=="number"&&r.textContent!==""+a&&(i.suppressHydrationWarning!==!0&&tf(r.textContent,a,n),s=["children",""+a]):ed.hasOwnProperty(o)&&a!=null&&o==="onScroll"&&jt("scroll",r)}switch(t){case"input":Hh(r),KS(r,i,!0);break;case"textarea":Hh(r),JS(r);break;case"select":case"option":break;default:typeof i.onClick=="function"&&(r.onclick=dm)}r=s,e.updateQueue=r,r!==null&&(e.flags|=4)}else{o=s.nodeType===9?s:s.ownerDocument,n==="http://www.w3.org/1999/xhtml"&&(n=SA(t)),n==="http://www.w3.org/1999/xhtml"?t==="script"?(n=o.createElement("div"),n.innerHTML="<script><\/script>",n=n.removeChild(n.firstChild)):typeof r.is=="string"?n=o.createElement(t,{is:r.is}):(n=o.createElement(t),t==="select"&&(o=n,r.multiple?o.multiple=!0:r.size&&(o.size=r.size))):n=o.createElementNS(n,t),n[Ts]=e,n[ud]=r,G1(n,e,!1,!1),e.stateNode=n;e:{switch(o=d_(t,r),t){case"dialog":jt("cancel",n),jt("close",n),s=r;break;case"iframe":case"object":case"embed":jt("load",n),s=r;break;case"video":case"audio":for(s=0;s<gu.length;s++)jt(gu[s],n);s=r;break;case"source":jt("error",n),s=r;break;case"img":case"image":case"link":jt("error",n),jt("load",n),s=r;break;case"details":jt("toggle",n),s=r;break;case"input":QS(n,r),s=i_(n,r),jt("invalid",n);break;case"option":s=r;break;case"select":n._wrapperState={wasMultiple:!!r.multiple},s=Xt({},r,{value:void 0}),jt("invalid",n);break;case"textarea":YS(n,r),s=l_(n,r),jt("invalid",n);break;default:s=r}u_(t,s),a=s;for(i in a)if(a.hasOwnProperty(i)){var c=a[i];i==="style"?bA(n,c):i==="dangerouslySetInnerHTML"?(c=c?c.__html:void 0,c!=null&&IA(n,c)):i==="children"?typeof c=="string"?(t!=="textarea"||c!=="")&&td(n,c):typeof c=="number"&&td(n,""+c):i!=="suppressContentEditableWarning"&&i!=="suppressHydrationWarning"&&i!=="autoFocus"&&(ed.hasOwnProperty(i)?c!=null&&i==="onScroll"&&jt("scroll",n):c!=null&&Xv(n,i,c,o))}switch(t){case"input":Hh(n),KS(n,r,!1);break;case"textarea":Hh(n),JS(n);break;case"option":r.value!=null&&n.setAttribute("value",""+fo(r.value));break;case"select":n.multiple=!!r.multiple,i=r.value,i!=null?Al(n,!!r.multiple,i,!1):r.defaultValue!=null&&Al(n,!!r.multiple,r.defaultValue,!0);break;default:typeof s.onClick=="function"&&(n.onclick=dm)}switch(t){case"button":case"input":case"select":case"textarea":r=!!r.autoFocus;break e;case"img":r=!0;break e;default:r=!1}}r&&(e.flags|=4)}e.ref!==null&&(e.flags|=512,e.flags|=2097152)}return Yn(e),null;case 6:if(n&&e.stateNode!=null)Q1(n,e,n.memoizedProps,r);else{if(typeof r!="string"&&e.stateNode===null)throw Error(Y(166));if(t=ea(hd.current),ea(Os.current),nf(e)){if(r=e.stateNode,t=e.memoizedProps,r[Ts]=e,(i=r.nodeValue!==t)&&(n=Nr,n!==null))switch(n.tag){case 3:tf(r.nodeValue,t,(n.mode&1)!==0);break;case 5:n.memoizedProps.suppressHydrationWarning!==!0&&tf(r.nodeValue,t,(n.mode&1)!==0)}i&&(e.flags|=4)}else r=(t.nodeType===9?t:t.ownerDocument).createTextNode(r),r[Ts]=e,e.stateNode=r}return Yn(e),null;case 13:if(Mt(Kt),r=e.memoizedState,n===null||n.memoizedState!==null&&n.memoizedState.dehydrated!==null){if(Ut&&kr!==null&&e.mode&1&&!(e.flags&128))h1(),zl(),e.flags|=98560,i=!1;else if(i=nf(e),r!==null&&r.dehydrated!==null){if(n===null){if(!i)throw Error(Y(318));if(i=e.memoizedState,i=i!==null?i.dehydrated:null,!i)throw Error(Y(317));i[Ts]=e}else zl(),!(e.flags&128)&&(e.memoizedState=null),e.flags|=4;Yn(e),i=!1}else ls!==null&&(W_(ls),ls=null),i=!0;if(!i)return e.flags&65536?e:null}return e.flags&128?(e.lanes=t,e):(r=r!==null,r!==(n!==null&&n.memoizedState!==null)&&r&&(e.child.flags|=8192,e.mode&1&&(n===null||Kt.current&1?In===0&&(In=3):O0())),e.updateQueue!==null&&(e.flags|=4),Yn(e),null);case 4:return Wl(),M_(n,e),n===null&&ld(e.stateNode.containerInfo),Yn(e),null;case 10:return y0(e.type._context),Yn(e),null;case 17:return gr(e.type)&&hm(),Yn(e),null;case 19:if(Mt(Kt),i=e.memoizedState,i===null)return Yn(e),null;if(r=(e.flags&128)!==0,o=i.rendering,o===null)if(r)eu(i,!1);else{if(In!==0||n!==null&&n.flags&128)for(n=e.child;n!==null;){if(o=vm(n),o!==null){for(e.flags|=128,eu(i,!1),r=o.updateQueue,r!==null&&(e.updateQueue=r,e.flags|=4),e.subtreeFlags=0,r=t,t=e.child;t!==null;)i=t,n=r,i.flags&=14680066,o=i.alternate,o===null?(i.childLanes=0,i.lanes=n,i.child=null,i.subtreeFlags=0,i.memoizedProps=null,i.memoizedState=null,i.updateQueue=null,i.dependencies=null,i.stateNode=null):(i.childLanes=o.childLanes,i.lanes=o.lanes,i.child=o.child,i.subtreeFlags=0,i.deletions=null,i.memoizedProps=o.memoizedProps,i.memoizedState=o.memoizedState,i.updateQueue=o.updateQueue,i.type=o.type,n=o.dependencies,i.dependencies=n===null?null:{lanes:n.lanes,firstContext:n.firstContext}),t=t.sibling;return kt(Kt,Kt.current&1|2),e.child}n=n.sibling}i.tail!==null&&un()>Hl&&(e.flags|=128,r=!0,eu(i,!1),e.lanes=4194304)}else{if(!r)if(n=vm(o),n!==null){if(e.flags|=128,r=!0,t=n.updateQueue,t!==null&&(e.updateQueue=t,e.flags|=4),eu(i,!0),i.tail===null&&i.tailMode==="hidden"&&!o.alternate&&!Ut)return Yn(e),null}else 2*un()-i.renderingStartTime>Hl&&t!==1073741824&&(e.flags|=128,r=!0,eu(i,!1),e.lanes=4194304);i.isBackwards?(o.sibling=e.child,e.child=o):(t=i.last,t!==null?t.sibling=o:e.child=o,i.last=o)}return i.tail!==null?(e=i.tail,i.rendering=e,i.tail=e.sibling,i.renderingStartTime=un(),e.sibling=null,t=Kt.current,kt(Kt,r?t&1|2:t&1),e):(Yn(e),null);case 22:case 23:return P0(),r=e.memoizedState!==null,n!==null&&n.memoizedState!==null!==r&&(e.flags|=8192),r&&e.mode&1?Er&1073741824&&(Yn(e),e.subtreeFlags&6&&(e.flags|=8192)):Yn(e),null;case 24:return null;case 25:return null}throw Error(Y(156,e.tag))}function Vj(n,e){switch(f0(e),e.tag){case 1:return gr(e.type)&&hm(),n=e.flags,n&65536?(e.flags=n&-65537|128,e):null;case 3:return Wl(),Mt(pr),Mt(rr),S0(),n=e.flags,n&65536&&!(n&128)?(e.flags=n&-65537|128,e):null;case 5:return x0(e),null;case 13:if(Mt(Kt),n=e.memoizedState,n!==null&&n.dehydrated!==null){if(e.alternate===null)throw Error(Y(340));zl()}return n=e.flags,n&65536?(e.flags=n&-65537|128,e):null;case 19:return Mt(Kt),null;case 4:return Wl(),null;case 10:return y0(e.type._context),null;case 22:case 23:return P0(),null;case 24:return null;default:return null}}var of=!1,Zn=!1,Fj=typeof WeakSet=="function"?WeakSet:Set,de=null;function bl(n,e){var t=n.ref;if(t!==null)if(typeof t=="function")try{t(null)}catch(r){on(n,e,r)}else t.current=null}function V_(n,e,t){try{t()}catch(r){on(n,e,r)}}var $I=!1;function $j(n,e){if(x_=lm,n=ZA(),d0(n)){if("selectionStart"in n)var t={start:n.selectionStart,end:n.selectionEnd};else e:{t=(t=n.ownerDocument)&&t.defaultView||window;var r=t.getSelection&&t.getSelection();if(r&&r.rangeCount!==0){t=r.anchorNode;var s=r.anchorOffset,i=r.focusNode;r=r.focusOffset;try{t.nodeType,i.nodeType}catch{t=null;break e}var o=0,a=-1,c=-1,u=0,h=0,f=n,m=null;t:for(;;){for(var y;f!==t||s!==0&&f.nodeType!==3||(a=o+s),f!==i||r!==0&&f.nodeType!==3||(c=o+r),f.nodeType===3&&(o+=f.nodeValue.length),(y=f.firstChild)!==null;)m=f,f=y;for(;;){if(f===n)break t;if(m===t&&++u===s&&(a=o),m===i&&++h===r&&(c=o),(y=f.nextSibling)!==null)break;f=m,m=f.parentNode}f=y}t=a===-1||c===-1?null:{start:a,end:c}}else t=null}t=t||{start:0,end:0}}else t=null;for(S_={focusedElem:n,selectionRange:t},lm=!1,de=e;de!==null;)if(e=de,n=e.child,(e.subtreeFlags&1028)!==0&&n!==null)n.return=e,de=n;else for(;de!==null;){e=de;try{var w=e.alternate;if(e.flags&1024)switch(e.tag){case 0:case 11:case 15:break;case 1:if(w!==null){var S=w.memoizedProps,R=w.memoizedState,T=e.stateNode,I=T.getSnapshotBeforeUpdate(e.elementType===e.type?S:is(e.type,S),R);T.__reactInternalSnapshotBeforeUpdate=I}break;case 3:var N=e.stateNode.containerInfo;N.nodeType===1?N.textContent="":N.nodeType===9&&N.documentElement&&N.removeChild(N.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(Y(163))}}catch(P){on(e,e.return,P)}if(n=e.sibling,n!==null){n.return=e.return,de=n;break}de=e.return}return w=$I,$I=!1,w}function Ru(n,e,t){var r=e.updateQueue;if(r=r!==null?r.lastEffect:null,r!==null){var s=r=r.next;do{if((s.tag&n)===n){var i=s.destroy;s.destroy=void 0,i!==void 0&&V_(e,t,i)}s=s.next}while(s!==r)}}function Tp(n,e){if(e=e.updateQueue,e=e!==null?e.lastEffect:null,e!==null){var t=e=e.next;do{if((t.tag&n)===n){var r=t.create;t.destroy=r()}t=t.next}while(t!==e)}}function F_(n){var e=n.ref;if(e!==null){var t=n.stateNode;switch(n.tag){case 5:n=t;break;default:n=t}typeof e=="function"?e(n):e.current=n}}function K1(n){var e=n.alternate;e!==null&&(n.alternate=null,K1(e)),n.child=null,n.deletions=null,n.sibling=null,n.tag===5&&(e=n.stateNode,e!==null&&(delete e[Ts],delete e[ud],delete e[b_],delete e[Sj],delete e[Ij])),n.stateNode=null,n.return=null,n.dependencies=null,n.memoizedProps=null,n.memoizedState=null,n.pendingProps=null,n.stateNode=null,n.updateQueue=null}function Y1(n){return n.tag===5||n.tag===3||n.tag===4}function UI(n){e:for(;;){for(;n.sibling===null;){if(n.return===null||Y1(n.return))return null;n=n.return}for(n.sibling.return=n.return,n=n.sibling;n.tag!==5&&n.tag!==6&&n.tag!==18;){if(n.flags&2||n.child===null||n.tag===4)continue e;n.child.return=n,n=n.child}if(!(n.flags&2))return n.stateNode}}function $_(n,e,t){var r=n.tag;if(r===5||r===6)n=n.stateNode,e?t.nodeType===8?t.parentNode.insertBefore(n,e):t.insertBefore(n,e):(t.nodeType===8?(e=t.parentNode,e.insertBefore(n,t)):(e=t,e.appendChild(n)),t=t._reactRootContainer,t!=null||e.onclick!==null||(e.onclick=dm));else if(r!==4&&(n=n.child,n!==null))for($_(n,e,t),n=n.sibling;n!==null;)$_(n,e,t),n=n.sibling}function U_(n,e,t){var r=n.tag;if(r===5||r===6)n=n.stateNode,e?t.insertBefore(n,e):t.appendChild(n);else if(r!==4&&(n=n.child,n!==null))for(U_(n,e,t),n=n.sibling;n!==null;)U_(n,e,t),n=n.sibling}var Un=null,os=!1;function Ni(n,e,t){for(t=t.child;t!==null;)J1(n,e,t),t=t.sibling}function J1(n,e,t){if(Ps&&typeof Ps.onCommitFiberUnmount=="function")try{Ps.onCommitFiberUnmount(_p,t)}catch{}switch(t.tag){case 5:Zn||bl(t,e);case 6:var r=Un,s=os;Un=null,Ni(n,e,t),Un=r,os=s,Un!==null&&(os?(n=Un,t=t.stateNode,n.nodeType===8?n.parentNode.removeChild(t):n.removeChild(t)):Un.removeChild(t.stateNode));break;case 18:Un!==null&&(os?(n=Un,t=t.stateNode,n.nodeType===8?dy(n.parentNode,t):n.nodeType===1&&dy(n,t),id(n)):dy(Un,t.stateNode));break;case 4:r=Un,s=os,Un=t.stateNode.containerInfo,os=!0,Ni(n,e,t),Un=r,os=s;break;case 0:case 11:case 14:case 15:if(!Zn&&(r=t.updateQueue,r!==null&&(r=r.lastEffect,r!==null))){s=r=r.next;do{var i=s,o=i.destroy;i=i.tag,o!==void 0&&(i&2||i&4)&&V_(t,e,o),s=s.next}while(s!==r)}Ni(n,e,t);break;case 1:if(!Zn&&(bl(t,e),r=t.stateNode,typeof r.componentWillUnmount=="function"))try{r.props=t.memoizedProps,r.state=t.memoizedState,r.componentWillUnmount()}catch(a){on(t,e,a)}Ni(n,e,t);break;case 21:Ni(n,e,t);break;case 22:t.mode&1?(Zn=(r=Zn)||t.memoizedState!==null,Ni(n,e,t),Zn=r):Ni(n,e,t);break;default:Ni(n,e,t)}}function BI(n){var e=n.updateQueue;if(e!==null){n.updateQueue=null;var t=n.stateNode;t===null&&(t=n.stateNode=new Fj),e.forEach(function(r){var s=Kj.bind(null,n,r);t.has(r)||(t.add(r),r.then(s,s))})}}function ss(n,e){var t=e.deletions;if(t!==null)for(var r=0;r<t.length;r++){var s=t[r];try{var i=n,o=e,a=o;e:for(;a!==null;){switch(a.tag){case 5:Un=a.stateNode,os=!1;break e;case 3:Un=a.stateNode.containerInfo,os=!0;break e;case 4:Un=a.stateNode.containerInfo,os=!0;break e}a=a.return}if(Un===null)throw Error(Y(160));J1(i,o,s),Un=null,os=!1;var c=s.alternate;c!==null&&(c.return=null),s.return=null}catch(u){on(s,e,u)}}if(e.subtreeFlags&12854)for(e=e.child;e!==null;)X1(e,n),e=e.sibling}function X1(n,e){var t=n.alternate,r=n.flags;switch(n.tag){case 0:case 11:case 14:case 15:if(ss(e,n),Ss(n),r&4){try{Ru(3,n,n.return),Tp(3,n)}catch(S){on(n,n.return,S)}try{Ru(5,n,n.return)}catch(S){on(n,n.return,S)}}break;case 1:ss(e,n),Ss(n),r&512&&t!==null&&bl(t,t.return);break;case 5:if(ss(e,n),Ss(n),r&512&&t!==null&&bl(t,t.return),n.flags&32){var s=n.stateNode;try{td(s,"")}catch(S){on(n,n.return,S)}}if(r&4&&(s=n.stateNode,s!=null)){var i=n.memoizedProps,o=t!==null?t.memoizedProps:i,a=n.type,c=n.updateQueue;if(n.updateQueue=null,c!==null)try{a==="input"&&i.type==="radio"&&i.name!=null&&wA(s,i),d_(a,o);var u=d_(a,i);for(o=0;o<c.length;o+=2){var h=c[o],f=c[o+1];h==="style"?bA(s,f):h==="dangerouslySetInnerHTML"?IA(s,f):h==="children"?td(s,f):Xv(s,h,f,u)}switch(a){case"input":o_(s,i);break;case"textarea":xA(s,i);break;case"select":var m=s._wrapperState.wasMultiple;s._wrapperState.wasMultiple=!!i.multiple;var y=i.value;y!=null?Al(s,!!i.multiple,y,!1):m!==!!i.multiple&&(i.defaultValue!=null?Al(s,!!i.multiple,i.defaultValue,!0):Al(s,!!i.multiple,i.multiple?[]:"",!1))}s[ud]=i}catch(S){on(n,n.return,S)}}break;case 6:if(ss(e,n),Ss(n),r&4){if(n.stateNode===null)throw Error(Y(162));s=n.stateNode,i=n.memoizedProps;try{s.nodeValue=i}catch(S){on(n,n.return,S)}}break;case 3:if(ss(e,n),Ss(n),r&4&&t!==null&&t.memoizedState.isDehydrated)try{id(e.containerInfo)}catch(S){on(n,n.return,S)}break;case 4:ss(e,n),Ss(n);break;case 13:ss(e,n),Ss(n),s=n.child,s.flags&8192&&(i=s.memoizedState!==null,s.stateNode.isHidden=i,!i||s.alternate!==null&&s.alternate.memoizedState!==null||(R0=un())),r&4&&BI(n);break;case 22:if(h=t!==null&&t.memoizedState!==null,n.mode&1?(Zn=(u=Zn)||h,ss(e,n),Zn=u):ss(e,n),Ss(n),r&8192){if(u=n.memoizedState!==null,(n.stateNode.isHidden=u)&&!h&&n.mode&1)for(de=n,h=n.child;h!==null;){for(f=de=h;de!==null;){switch(m=de,y=m.child,m.tag){case 0:case 11:case 14:case 15:Ru(4,m,m.return);break;case 1:bl(m,m.return);var w=m.stateNode;if(typeof w.componentWillUnmount=="function"){r=m,t=m.return;try{e=r,w.props=e.memoizedProps,w.state=e.memoizedState,w.componentWillUnmount()}catch(S){on(r,t,S)}}break;case 5:bl(m,m.return);break;case 22:if(m.memoizedState!==null){qI(f);continue}}y!==null?(y.return=m,de=y):qI(f)}h=h.sibling}e:for(h=null,f=n;;){if(f.tag===5){if(h===null){h=f;try{s=f.stateNode,u?(i=s.style,typeof i.setProperty=="function"?i.setProperty("display","none","important"):i.display="none"):(a=f.stateNode,c=f.memoizedProps.style,o=c!=null&&c.hasOwnProperty("display")?c.display:null,a.style.display=EA("display",o))}catch(S){on(n,n.return,S)}}}else if(f.tag===6){if(h===null)try{f.stateNode.nodeValue=u?"":f.memoizedProps}catch(S){on(n,n.return,S)}}else if((f.tag!==22&&f.tag!==23||f.memoizedState===null||f===n)&&f.child!==null){f.child.return=f,f=f.child;continue}if(f===n)break e;for(;f.sibling===null;){if(f.return===null||f.return===n)break e;h===f&&(h=null),f=f.return}h===f&&(h=null),f.sibling.return=f.return,f=f.sibling}}break;case 19:ss(e,n),Ss(n),r&4&&BI(n);break;case 21:break;default:ss(e,n),Ss(n)}}function Ss(n){var e=n.flags;if(e&2){try{e:{for(var t=n.return;t!==null;){if(Y1(t)){var r=t;break e}t=t.return}throw Error(Y(160))}switch(r.tag){case 5:var s=r.stateNode;r.flags&32&&(td(s,""),r.flags&=-33);var i=UI(n);U_(n,i,s);break;case 3:case 4:var o=r.stateNode.containerInfo,a=UI(n);$_(n,a,o);break;default:throw Error(Y(161))}}catch(c){on(n,n.return,c)}n.flags&=-3}e&4096&&(n.flags&=-4097)}function Uj(n,e,t){de=n,Z1(n)}function Z1(n,e,t){for(var r=(n.mode&1)!==0;de!==null;){var s=de,i=s.child;if(s.tag===22&&r){var o=s.memoizedState!==null||of;if(!o){var a=s.alternate,c=a!==null&&a.memoizedState!==null||Zn;a=of;var u=Zn;if(of=o,(Zn=c)&&!u)for(de=s;de!==null;)o=de,c=o.child,o.tag===22&&o.memoizedState!==null?WI(s):c!==null?(c.return=o,de=c):WI(s);for(;i!==null;)de=i,Z1(i),i=i.sibling;de=s,of=a,Zn=u}zI(n)}else s.subtreeFlags&8772&&i!==null?(i.return=s,de=i):zI(n)}}function zI(n){for(;de!==null;){var e=de;if(e.flags&8772){var t=e.alternate;try{if(e.flags&8772)switch(e.tag){case 0:case 11:case 15:Zn||Tp(5,e);break;case 1:var r=e.stateNode;if(e.flags&4&&!Zn)if(t===null)r.componentDidMount();else{var s=e.elementType===e.type?t.memoizedProps:is(e.type,t.memoizedProps);r.componentDidUpdate(s,t.memoizedState,r.__reactInternalSnapshotBeforeUpdate)}var i=e.updateQueue;i!==null&&AI(e,i,r);break;case 3:var o=e.updateQueue;if(o!==null){if(t=null,e.child!==null)switch(e.child.tag){case 5:t=e.child.stateNode;break;case 1:t=e.child.stateNode}AI(e,o,t)}break;case 5:var a=e.stateNode;if(t===null&&e.flags&4){t=a;var c=e.memoizedProps;switch(e.type){case"button":case"input":case"select":case"textarea":c.autoFocus&&t.focus();break;case"img":c.src&&(t.src=c.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(e.memoizedState===null){var u=e.alternate;if(u!==null){var h=u.memoizedState;if(h!==null){var f=h.dehydrated;f!==null&&id(f)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(Y(163))}Zn||e.flags&512&&F_(e)}catch(m){on(e,e.return,m)}}if(e===n){de=null;break}if(t=e.sibling,t!==null){t.return=e.return,de=t;break}de=e.return}}function qI(n){for(;de!==null;){var e=de;if(e===n){de=null;break}var t=e.sibling;if(t!==null){t.return=e.return,de=t;break}de=e.return}}function WI(n){for(;de!==null;){var e=de;try{switch(e.tag){case 0:case 11:case 15:var t=e.return;try{Tp(4,e)}catch(c){on(e,t,c)}break;case 1:var r=e.stateNode;if(typeof r.componentDidMount=="function"){var s=e.return;try{r.componentDidMount()}catch(c){on(e,s,c)}}var i=e.return;try{F_(e)}catch(c){on(e,i,c)}break;case 5:var o=e.return;try{F_(e)}catch(c){on(e,o,c)}}}catch(c){on(e,e.return,c)}if(e===n){de=null;break}var a=e.sibling;if(a!==null){a.return=e.return,de=a;break}de=e.return}}var Bj=Math.ceil,Sm=vi.ReactCurrentDispatcher,k0=vi.ReactCurrentOwner,Hr=vi.ReactCurrentBatchConfig,tt=0,Pn=null,_n=null,qn=0,Er=0,Tl=Co(0),In=0,gd=null,pa=0,Ap=0,N0=0,Du=null,ur=null,R0=0,Hl=1/0,Ks=null,Im=!1,B_=null,ro=null,af=!1,Wi=null,Em=0,Pu=0,z_=null,Lf=-1,Mf=0;function or(){return tt&6?un():Lf!==-1?Lf:Lf=un()}function so(n){return n.mode&1?tt&2&&qn!==0?qn&-qn:bj.transition!==null?(Mf===0&&(Mf=MA()),Mf):(n=ft,n!==0||(n=window.event,n=n===void 0?16:qA(n.type)),n):1}function hs(n,e,t,r){if(50<Pu)throw Pu=0,z_=null,Error(Y(185));Qd(n,t,r),(!(tt&2)||n!==Pn)&&(n===Pn&&(!(tt&2)&&(Ap|=t),In===4&&Vi(n,qn)),yr(n,r),t===1&&tt===0&&!(e.mode&1)&&(Hl=un()+500,Ip&&ko()))}function yr(n,e){var t=n.callbackNode;bO(n,e);var r=am(n,n===Pn?qn:0);if(r===0)t!==null&&eI(t),n.callbackNode=null,n.callbackPriority=0;else if(e=r&-r,n.callbackPriority!==e){if(t!=null&&eI(t),e===1)n.tag===0?Ej(GI.bind(null,n)):c1(GI.bind(null,n)),wj(function(){!(tt&6)&&ko()}),t=null;else{switch(VA(r)){case 1:t=r0;break;case 4:t=jA;break;case 16:t=om;break;case 536870912:t=LA;break;default:t=om}t=aC(t,eC.bind(null,n))}n.callbackPriority=e,n.callbackNode=t}}function eC(n,e){if(Lf=-1,Mf=0,tt&6)throw Error(Y(327));var t=n.callbackNode;if(Dl()&&n.callbackNode!==t)return null;var r=am(n,n===Pn?qn:0);if(r===0)return null;if(r&30||r&n.expiredLanes||e)e=bm(n,r);else{e=r;var s=tt;tt|=2;var i=nC();(Pn!==n||qn!==e)&&(Ks=null,Hl=un()+500,ia(n,e));do try{Wj();break}catch(a){tC(n,a)}while(1);g0(),Sm.current=i,tt=s,_n!==null?e=0:(Pn=null,qn=0,e=In)}if(e!==0){if(e===2&&(s=g_(n),s!==0&&(r=s,e=q_(n,s))),e===1)throw t=gd,ia(n,0),Vi(n,r),yr(n,un()),t;if(e===6)Vi(n,r);else{if(s=n.current.alternate,!(r&30)&&!zj(s)&&(e=bm(n,r),e===2&&(i=g_(n),i!==0&&(r=i,e=q_(n,i))),e===1))throw t=gd,ia(n,0),Vi(n,r),yr(n,un()),t;switch(n.finishedWork=s,n.finishedLanes=r,e){case 0:case 1:throw Error(Y(345));case 2:Bo(n,ur,Ks);break;case 3:if(Vi(n,r),(r&130023424)===r&&(e=R0+500-un(),10<e)){if(am(n,0)!==0)break;if(s=n.suspendedLanes,(s&r)!==r){or(),n.pingedLanes|=n.suspendedLanes&s;break}n.timeoutHandle=E_(Bo.bind(null,n,ur,Ks),e);break}Bo(n,ur,Ks);break;case 4:if(Vi(n,r),(r&4194240)===r)break;for(e=n.eventTimes,s=-1;0<r;){var o=31-ds(r);i=1<<o,o=e[o],o>s&&(s=o),r&=~i}if(r=s,r=un()-r,r=(120>r?120:480>r?480:1080>r?1080:1920>r?1920:3e3>r?3e3:4320>r?4320:1960*Bj(r/1960))-r,10<r){n.timeoutHandle=E_(Bo.bind(null,n,ur,Ks),r);break}Bo(n,ur,Ks);break;case 5:Bo(n,ur,Ks);break;default:throw Error(Y(329))}}}return yr(n,un()),n.callbackNode===t?eC.bind(null,n):null}function q_(n,e){var t=Du;return n.current.memoizedState.isDehydrated&&(ia(n,e).flags|=256),n=bm(n,e),n!==2&&(e=ur,ur=t,e!==null&&W_(e)),n}function W_(n){ur===null?ur=n:ur.push.apply(ur,n)}function zj(n){for(var e=n;;){if(e.flags&16384){var t=e.updateQueue;if(t!==null&&(t=t.stores,t!==null))for(var r=0;r<t.length;r++){var s=t[r],i=s.getSnapshot;s=s.value;try{if(!ps(i(),s))return!1}catch{return!1}}}if(t=e.child,e.subtreeFlags&16384&&t!==null)t.return=e,e=t;else{if(e===n)break;for(;e.sibling===null;){if(e.return===null||e.return===n)return!0;e=e.return}e.sibling.return=e.return,e=e.sibling}}return!0}function Vi(n,e){for(e&=~N0,e&=~Ap,n.suspendedLanes|=e,n.pingedLanes&=~e,n=n.expirationTimes;0<e;){var t=31-ds(e),r=1<<t;n[t]=-1,e&=~r}}function GI(n){if(tt&6)throw Error(Y(327));Dl();var e=am(n,0);if(!(e&1))return yr(n,un()),null;var t=bm(n,e);if(n.tag!==0&&t===2){var r=g_(n);r!==0&&(e=r,t=q_(n,r))}if(t===1)throw t=gd,ia(n,0),Vi(n,e),yr(n,un()),t;if(t===6)throw Error(Y(345));return n.finishedWork=n.current.alternate,n.finishedLanes=e,Bo(n,ur,Ks),yr(n,un()),null}function D0(n,e){var t=tt;tt|=1;try{return n(e)}finally{tt=t,tt===0&&(Hl=un()+500,Ip&&ko())}}function ga(n){Wi!==null&&Wi.tag===0&&!(tt&6)&&Dl();var e=tt;tt|=1;var t=Hr.transition,r=ft;try{if(Hr.transition=null,ft=1,n)return n()}finally{ft=r,Hr.transition=t,tt=e,!(tt&6)&&ko()}}function P0(){Er=Tl.current,Mt(Tl)}function ia(n,e){n.finishedWork=null,n.finishedLanes=0;var t=n.timeoutHandle;if(t!==-1&&(n.timeoutHandle=-1,vj(t)),_n!==null)for(t=_n.return;t!==null;){var r=t;switch(f0(r),r.tag){case 1:r=r.type.childContextTypes,r!=null&&hm();break;case 3:Wl(),Mt(pr),Mt(rr),S0();break;case 5:x0(r);break;case 4:Wl();break;case 13:Mt(Kt);break;case 19:Mt(Kt);break;case 10:y0(r.type._context);break;case 22:case 23:P0()}t=t.return}if(Pn=n,_n=n=io(n.current,null),qn=Er=e,In=0,gd=null,N0=Ap=pa=0,ur=Du=null,Zo!==null){for(e=0;e<Zo.length;e++)if(t=Zo[e],r=t.interleaved,r!==null){t.interleaved=null;var s=r.next,i=t.pending;if(i!==null){var o=i.next;i.next=s,r.next=o}t.pending=r}Zo=null}return n}function tC(n,e){do{var t=_n;try{if(g0(),Pf.current=xm,wm){for(var r=Jt.memoizedState;r!==null;){var s=r.queue;s!==null&&(s.pending=null),r=r.next}wm=!1}if(ma=0,Nn=xn=Jt=null,Nu=!1,fd=0,k0.current=null,t===null||t.return===null){In=1,gd=e,_n=null;break}e:{var i=n,o=t.return,a=t,c=e;if(e=qn,a.flags|=32768,c!==null&&typeof c=="object"&&typeof c.then=="function"){var u=c,h=a,f=h.tag;if(!(h.mode&1)&&(f===0||f===11||f===15)){var m=h.alternate;m?(h.updateQueue=m.updateQueue,h.memoizedState=m.memoizedState,h.lanes=m.lanes):(h.updateQueue=null,h.memoizedState=null)}var y=PI(o);if(y!==null){y.flags&=-257,OI(y,o,a,i,e),y.mode&1&&DI(i,u,e),e=y,c=u;var w=e.updateQueue;if(w===null){var S=new Set;S.add(c),e.updateQueue=S}else w.add(c);break e}else{if(!(e&1)){DI(i,u,e),O0();break e}c=Error(Y(426))}}else if(Ut&&a.mode&1){var R=PI(o);if(R!==null){!(R.flags&65536)&&(R.flags|=256),OI(R,o,a,i,e),m0(Gl(c,a));break e}}i=c=Gl(c,a),In!==4&&(In=2),Du===null?Du=[i]:Du.push(i),i=o;do{switch(i.tag){case 3:i.flags|=65536,e&=-e,i.lanes|=e;var T=V1(i,c,e);TI(i,T);break e;case 1:a=c;var I=i.type,N=i.stateNode;if(!(i.flags&128)&&(typeof I.getDerivedStateFromError=="function"||N!==null&&typeof N.componentDidCatch=="function"&&(ro===null||!ro.has(N)))){i.flags|=65536,e&=-e,i.lanes|=e;var P=F1(i,a,e);TI(i,P);break e}}i=i.return}while(i!==null)}sC(t)}catch(B){e=B,_n===t&&t!==null&&(_n=t=t.return);continue}break}while(1)}function nC(){var n=Sm.current;return Sm.current=xm,n===null?xm:n}function O0(){(In===0||In===3||In===2)&&(In=4),Pn===null||!(pa&268435455)&&!(Ap&268435455)||Vi(Pn,qn)}function bm(n,e){var t=tt;tt|=2;var r=nC();(Pn!==n||qn!==e)&&(Ks=null,ia(n,e));do try{qj();break}catch(s){tC(n,s)}while(1);if(g0(),tt=t,Sm.current=r,_n!==null)throw Error(Y(261));return Pn=null,qn=0,In}function qj(){for(;_n!==null;)rC(_n)}function Wj(){for(;_n!==null&&!gO();)rC(_n)}function rC(n){var e=oC(n.alternate,n,Er);n.memoizedProps=n.pendingProps,e===null?sC(n):_n=e,k0.current=null}function sC(n){var e=n;do{var t=e.alternate;if(n=e.return,e.flags&32768){if(t=Vj(t,e),t!==null){t.flags&=32767,_n=t;return}if(n!==null)n.flags|=32768,n.subtreeFlags=0,n.deletions=null;else{In=6,_n=null;return}}else if(t=Mj(t,e,Er),t!==null){_n=t;return}if(e=e.sibling,e!==null){_n=e;return}_n=e=n}while(e!==null);In===0&&(In=5)}function Bo(n,e,t){var r=ft,s=Hr.transition;try{Hr.transition=null,ft=1,Gj(n,e,t,r)}finally{Hr.transition=s,ft=r}return null}function Gj(n,e,t,r){do Dl();while(Wi!==null);if(tt&6)throw Error(Y(327));t=n.finishedWork;var s=n.finishedLanes;if(t===null)return null;if(n.finishedWork=null,n.finishedLanes=0,t===n.current)throw Error(Y(177));n.callbackNode=null,n.callbackPriority=0;var i=t.lanes|t.childLanes;if(TO(n,i),n===Pn&&(_n=Pn=null,qn=0),!(t.subtreeFlags&2064)&&!(t.flags&2064)||af||(af=!0,aC(om,function(){return Dl(),null})),i=(t.flags&15990)!==0,t.subtreeFlags&15990||i){i=Hr.transition,Hr.transition=null;var o=ft;ft=1;var a=tt;tt|=4,k0.current=null,$j(n,t),X1(t,n),hj(S_),lm=!!x_,S_=x_=null,n.current=t,Uj(t),yO(),tt=a,ft=o,Hr.transition=i}else n.current=t;if(af&&(af=!1,Wi=n,Em=s),i=n.pendingLanes,i===0&&(ro=null),wO(t.stateNode),yr(n,un()),e!==null)for(r=n.onRecoverableError,t=0;t<e.length;t++)s=e[t],r(s.value,{componentStack:s.stack,digest:s.digest});if(Im)throw Im=!1,n=B_,B_=null,n;return Em&1&&n.tag!==0&&Dl(),i=n.pendingLanes,i&1?n===z_?Pu++:(Pu=0,z_=n):Pu=0,ko(),null}function Dl(){if(Wi!==null){var n=VA(Em),e=Hr.transition,t=ft;try{if(Hr.transition=null,ft=16>n?16:n,Wi===null)var r=!1;else{if(n=Wi,Wi=null,Em=0,tt&6)throw Error(Y(331));var s=tt;for(tt|=4,de=n.current;de!==null;){var i=de,o=i.child;if(de.flags&16){var a=i.deletions;if(a!==null){for(var c=0;c<a.length;c++){var u=a[c];for(de=u;de!==null;){var h=de;switch(h.tag){case 0:case 11:case 15:Ru(8,h,i)}var f=h.child;if(f!==null)f.return=h,de=f;else for(;de!==null;){h=de;var m=h.sibling,y=h.return;if(K1(h),h===u){de=null;break}if(m!==null){m.return=y,de=m;break}de=y}}}var w=i.alternate;if(w!==null){var S=w.child;if(S!==null){w.child=null;do{var R=S.sibling;S.sibling=null,S=R}while(S!==null)}}de=i}}if(i.subtreeFlags&2064&&o!==null)o.return=i,de=o;else e:for(;de!==null;){if(i=de,i.flags&2048)switch(i.tag){case 0:case 11:case 15:Ru(9,i,i.return)}var T=i.sibling;if(T!==null){T.return=i.return,de=T;break e}de=i.return}}var I=n.current;for(de=I;de!==null;){o=de;var N=o.child;if(o.subtreeFlags&2064&&N!==null)N.return=o,de=N;else e:for(o=I;de!==null;){if(a=de,a.flags&2048)try{switch(a.tag){case 0:case 11:case 15:Tp(9,a)}}catch(B){on(a,a.return,B)}if(a===o){de=null;break e}var P=a.sibling;if(P!==null){P.return=a.return,de=P;break e}de=a.return}}if(tt=s,ko(),Ps&&typeof Ps.onPostCommitFiberRoot=="function")try{Ps.onPostCommitFiberRoot(_p,n)}catch{}r=!0}return r}finally{ft=t,Hr.transition=e}}return!1}function HI(n,e,t){e=Gl(t,e),e=V1(n,e,1),n=no(n,e,1),e=or(),n!==null&&(Qd(n,1,e),yr(n,e))}function on(n,e,t){if(n.tag===3)HI(n,n,t);else for(;e!==null;){if(e.tag===3){HI(e,n,t);break}else if(e.tag===1){var r=e.stateNode;if(typeof e.type.getDerivedStateFromError=="function"||typeof r.componentDidCatch=="function"&&(ro===null||!ro.has(r))){n=Gl(t,n),n=F1(e,n,1),e=no(e,n,1),n=or(),e!==null&&(Qd(e,1,n),yr(e,n));break}}e=e.return}}function Hj(n,e,t){var r=n.pingCache;r!==null&&r.delete(e),e=or(),n.pingedLanes|=n.suspendedLanes&t,Pn===n&&(qn&t)===t&&(In===4||In===3&&(qn&130023424)===qn&&500>un()-R0?ia(n,0):N0|=t),yr(n,e)}function iC(n,e){e===0&&(n.mode&1?(e=Yh,Yh<<=1,!(Yh&130023424)&&(Yh=4194304)):e=1);var t=or();n=ui(n,e),n!==null&&(Qd(n,e,t),yr(n,t))}function Qj(n){var e=n.memoizedState,t=0;e!==null&&(t=e.retryLane),iC(n,t)}function Kj(n,e){var t=0;switch(n.tag){case 13:var r=n.stateNode,s=n.memoizedState;s!==null&&(t=s.retryLane);break;case 19:r=n.stateNode;break;default:throw Error(Y(314))}r!==null&&r.delete(e),iC(n,t)}var oC;oC=function(n,e,t){if(n!==null)if(n.memoizedProps!==e.pendingProps||pr.current)dr=!0;else{if(!(n.lanes&t)&&!(e.flags&128))return dr=!1,Lj(n,e,t);dr=!!(n.flags&131072)}else dr=!1,Ut&&e.flags&1048576&&u1(e,pm,e.index);switch(e.lanes=0,e.tag){case 2:var r=e.type;jf(n,e),n=e.pendingProps;var s=Bl(e,rr.current);Rl(e,t),s=E0(null,e,r,n,s,t);var i=b0();return e.flags|=1,typeof s=="object"&&s!==null&&typeof s.render=="function"&&s.$$typeof===void 0?(e.tag=1,e.memoizedState=null,e.updateQueue=null,gr(r)?(i=!0,fm(e)):i=!1,e.memoizedState=s.state!==null&&s.state!==void 0?s.state:null,v0(e),s.updater=bp,e.stateNode=s,s._reactInternals=e,R_(e,r,n,t),e=O_(null,e,r,!0,i,t)):(e.tag=0,Ut&&i&&h0(e),sr(null,e,s,t),e=e.child),e;case 16:r=e.elementType;e:{switch(jf(n,e),n=e.pendingProps,s=r._init,r=s(r._payload),e.type=r,s=e.tag=Jj(r),n=is(r,n),s){case 0:e=P_(null,e,r,n,t);break e;case 1:e=MI(null,e,r,n,t);break e;case 11:e=jI(null,e,r,n,t);break e;case 14:e=LI(null,e,r,is(r.type,n),t);break e}throw Error(Y(306,r,""))}return e;case 0:return r=e.type,s=e.pendingProps,s=e.elementType===r?s:is(r,s),P_(n,e,r,s,t);case 1:return r=e.type,s=e.pendingProps,s=e.elementType===r?s:is(r,s),MI(n,e,r,s,t);case 3:e:{if(z1(e),n===null)throw Error(Y(387));r=e.pendingProps,i=e.memoizedState,s=i.element,g1(n,e),_m(e,r,null,t);var o=e.memoizedState;if(r=o.element,i.isDehydrated)if(i={element:r,isDehydrated:!1,cache:o.cache,pendingSuspenseBoundaries:o.pendingSuspenseBoundaries,transitions:o.transitions},e.updateQueue.baseState=i,e.memoizedState=i,e.flags&256){s=Gl(Error(Y(423)),e),e=VI(n,e,r,t,s);break e}else if(r!==s){s=Gl(Error(Y(424)),e),e=VI(n,e,r,t,s);break e}else for(kr=to(e.stateNode.containerInfo.firstChild),Nr=e,Ut=!0,ls=null,t=m1(e,null,r,t),e.child=t;t;)t.flags=t.flags&-3|4096,t=t.sibling;else{if(zl(),r===s){e=di(n,e,t);break e}sr(n,e,r,t)}e=e.child}return e;case 5:return y1(e),n===null&&C_(e),r=e.type,s=e.pendingProps,i=n!==null?n.memoizedProps:null,o=s.children,I_(r,s)?o=null:i!==null&&I_(r,i)&&(e.flags|=32),B1(n,e),sr(n,e,o,t),e.child;case 6:return n===null&&C_(e),null;case 13:return q1(n,e,t);case 4:return w0(e,e.stateNode.containerInfo),r=e.pendingProps,n===null?e.child=ql(e,null,r,t):sr(n,e,r,t),e.child;case 11:return r=e.type,s=e.pendingProps,s=e.elementType===r?s:is(r,s),jI(n,e,r,s,t);case 7:return sr(n,e,e.pendingProps,t),e.child;case 8:return sr(n,e,e.pendingProps.children,t),e.child;case 12:return sr(n,e,e.pendingProps.children,t),e.child;case 10:e:{if(r=e.type._context,s=e.pendingProps,i=e.memoizedProps,o=s.value,kt(gm,r._currentValue),r._currentValue=o,i!==null)if(ps(i.value,o)){if(i.children===s.children&&!pr.current){e=di(n,e,t);break e}}else for(i=e.child,i!==null&&(i.return=e);i!==null;){var a=i.dependencies;if(a!==null){o=i.child;for(var c=a.firstContext;c!==null;){if(c.context===r){if(i.tag===1){c=oi(-1,t&-t),c.tag=2;var u=i.updateQueue;if(u!==null){u=u.shared;var h=u.pending;h===null?c.next=c:(c.next=h.next,h.next=c),u.pending=c}}i.lanes|=t,c=i.alternate,c!==null&&(c.lanes|=t),k_(i.return,t,e),a.lanes|=t;break}c=c.next}}else if(i.tag===10)o=i.type===e.type?null:i.child;else if(i.tag===18){if(o=i.return,o===null)throw Error(Y(341));o.lanes|=t,a=o.alternate,a!==null&&(a.lanes|=t),k_(o,t,e),o=i.sibling}else o=i.child;if(o!==null)o.return=i;else for(o=i;o!==null;){if(o===e){o=null;break}if(i=o.sibling,i!==null){i.return=o.return,o=i;break}o=o.return}i=o}sr(n,e,s.children,t),e=e.child}return e;case 9:return s=e.type,r=e.pendingProps.children,Rl(e,t),s=Yr(s),r=r(s),e.flags|=1,sr(n,e,r,t),e.child;case 14:return r=e.type,s=is(r,e.pendingProps),s=is(r.type,s),LI(n,e,r,s,t);case 15:return $1(n,e,e.type,e.pendingProps,t);case 17:return r=e.type,s=e.pendingProps,s=e.elementType===r?s:is(r,s),jf(n,e),e.tag=1,gr(r)?(n=!0,fm(e)):n=!1,Rl(e,t),M1(e,r,s),R_(e,r,s,t),O_(null,e,r,!0,n,t);case 19:return W1(n,e,t);case 22:return U1(n,e,t)}throw Error(Y(156,e.tag))};function aC(n,e){return OA(n,e)}function Yj(n,e,t,r){this.tag=n,this.key=t,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=e,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=r,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Wr(n,e,t,r){return new Yj(n,e,t,r)}function j0(n){return n=n.prototype,!(!n||!n.isReactComponent)}function Jj(n){if(typeof n=="function")return j0(n)?1:0;if(n!=null){if(n=n.$$typeof,n===e0)return 11;if(n===t0)return 14}return 2}function io(n,e){var t=n.alternate;return t===null?(t=Wr(n.tag,e,n.key,n.mode),t.elementType=n.elementType,t.type=n.type,t.stateNode=n.stateNode,t.alternate=n,n.alternate=t):(t.pendingProps=e,t.type=n.type,t.flags=0,t.subtreeFlags=0,t.deletions=null),t.flags=n.flags&14680064,t.childLanes=n.childLanes,t.lanes=n.lanes,t.child=n.child,t.memoizedProps=n.memoizedProps,t.memoizedState=n.memoizedState,t.updateQueue=n.updateQueue,e=n.dependencies,t.dependencies=e===null?null:{lanes:e.lanes,firstContext:e.firstContext},t.sibling=n.sibling,t.index=n.index,t.ref=n.ref,t}function Vf(n,e,t,r,s,i){var o=2;if(r=n,typeof n=="function")j0(n)&&(o=1);else if(typeof n=="string")o=5;else e:switch(n){case gl:return oa(t.children,s,i,e);case Zv:o=8,s|=8;break;case t_:return n=Wr(12,t,e,s|2),n.elementType=t_,n.lanes=i,n;case n_:return n=Wr(13,t,e,s),n.elementType=n_,n.lanes=i,n;case r_:return n=Wr(19,t,e,s),n.elementType=r_,n.lanes=i,n;case yA:return Cp(t,s,i,e);default:if(typeof n=="object"&&n!==null)switch(n.$$typeof){case pA:o=10;break e;case gA:o=9;break e;case e0:o=11;break e;case t0:o=14;break e;case ji:o=16,r=null;break e}throw Error(Y(130,n==null?n:typeof n,""))}return e=Wr(o,t,e,s),e.elementType=n,e.type=r,e.lanes=i,e}function oa(n,e,t,r){return n=Wr(7,n,r,e),n.lanes=t,n}function Cp(n,e,t,r){return n=Wr(22,n,r,e),n.elementType=yA,n.lanes=t,n.stateNode={isHidden:!1},n}function vy(n,e,t){return n=Wr(6,n,null,e),n.lanes=t,n}function wy(n,e,t){return e=Wr(4,n.children!==null?n.children:[],n.key,e),e.lanes=t,e.stateNode={containerInfo:n.containerInfo,pendingChildren:null,implementation:n.implementation},e}function Xj(n,e,t,r,s){this.tag=e,this.containerInfo=n,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=ey(0),this.expirationTimes=ey(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=ey(0),this.identifierPrefix=r,this.onRecoverableError=s,this.mutableSourceEagerHydrationData=null}function L0(n,e,t,r,s,i,o,a,c){return n=new Xj(n,e,t,a,c),e===1?(e=1,i===!0&&(e|=8)):e=0,i=Wr(3,null,null,e),n.current=i,i.stateNode=n,i.memoizedState={element:r,isDehydrated:t,cache:null,transitions:null,pendingSuspenseBoundaries:null},v0(i),n}function Zj(n,e,t){var r=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:pl,key:r==null?null:""+r,children:n,containerInfo:e,implementation:t}}function lC(n){if(!n)return mo;n=n._reactInternals;e:{if(ja(n)!==n||n.tag!==1)throw Error(Y(170));var e=n;do{switch(e.tag){case 3:e=e.stateNode.context;break e;case 1:if(gr(e.type)){e=e.stateNode.__reactInternalMemoizedMergedChildContext;break e}}e=e.return}while(e!==null);throw Error(Y(171))}if(n.tag===1){var t=n.type;if(gr(t))return l1(n,t,e)}return e}function cC(n,e,t,r,s,i,o,a,c){return n=L0(t,r,!0,n,s,i,o,a,c),n.context=lC(null),t=n.current,r=or(),s=so(t),i=oi(r,s),i.callback=e??null,no(t,i,s),n.current.lanes=s,Qd(n,s,r),yr(n,r),n}function kp(n,e,t,r){var s=e.current,i=or(),o=so(s);return t=lC(t),e.context===null?e.context=t:e.pendingContext=t,e=oi(i,o),e.payload={element:n},r=r===void 0?null:r,r!==null&&(e.callback=r),n=no(s,e,o),n!==null&&(hs(n,s,o,i),Df(n,s,o)),o}function Tm(n){if(n=n.current,!n.child)return null;switch(n.child.tag){case 5:return n.child.stateNode;default:return n.child.stateNode}}function QI(n,e){if(n=n.memoizedState,n!==null&&n.dehydrated!==null){var t=n.retryLane;n.retryLane=t!==0&&t<e?t:e}}function M0(n,e){QI(n,e),(n=n.alternate)&&QI(n,e)}function eL(){return null}var uC=typeof reportError=="function"?reportError:function(n){console.error(n)};function V0(n){this._internalRoot=n}Np.prototype.render=V0.prototype.render=function(n){var e=this._internalRoot;if(e===null)throw Error(Y(409));kp(n,e,null,null)};Np.prototype.unmount=V0.prototype.unmount=function(){var n=this._internalRoot;if(n!==null){this._internalRoot=null;var e=n.containerInfo;ga(function(){kp(null,n,null,null)}),e[ci]=null}};function Np(n){this._internalRoot=n}Np.prototype.unstable_scheduleHydration=function(n){if(n){var e=UA();n={blockedOn:null,target:n,priority:e};for(var t=0;t<Mi.length&&e!==0&&e<Mi[t].priority;t++);Mi.splice(t,0,n),t===0&&zA(n)}};function F0(n){return!(!n||n.nodeType!==1&&n.nodeType!==9&&n.nodeType!==11)}function Rp(n){return!(!n||n.nodeType!==1&&n.nodeType!==9&&n.nodeType!==11&&(n.nodeType!==8||n.nodeValue!==" react-mount-point-unstable "))}function KI(){}function tL(n,e,t,r,s){if(s){if(typeof r=="function"){var i=r;r=function(){var u=Tm(o);i.call(u)}}var o=cC(e,r,n,0,null,!1,!1,"",KI);return n._reactRootContainer=o,n[ci]=o.current,ld(n.nodeType===8?n.parentNode:n),ga(),o}for(;s=n.lastChild;)n.removeChild(s);if(typeof r=="function"){var a=r;r=function(){var u=Tm(c);a.call(u)}}var c=L0(n,0,!1,null,null,!1,!1,"",KI);return n._reactRootContainer=c,n[ci]=c.current,ld(n.nodeType===8?n.parentNode:n),ga(function(){kp(e,c,t,r)}),c}function Dp(n,e,t,r,s){var i=t._reactRootContainer;if(i){var o=i;if(typeof s=="function"){var a=s;s=function(){var c=Tm(o);a.call(c)}}kp(e,o,n,s)}else o=tL(t,e,n,s,r);return Tm(o)}FA=function(n){switch(n.tag){case 3:var e=n.stateNode;if(e.current.memoizedState.isDehydrated){var t=pu(e.pendingLanes);t!==0&&(s0(e,t|1),yr(e,un()),!(tt&6)&&(Hl=un()+500,ko()))}break;case 13:ga(function(){var r=ui(n,1);if(r!==null){var s=or();hs(r,n,1,s)}}),M0(n,1)}};i0=function(n){if(n.tag===13){var e=ui(n,134217728);if(e!==null){var t=or();hs(e,n,134217728,t)}M0(n,134217728)}};$A=function(n){if(n.tag===13){var e=so(n),t=ui(n,e);if(t!==null){var r=or();hs(t,n,e,r)}M0(n,e)}};UA=function(){return ft};BA=function(n,e){var t=ft;try{return ft=n,e()}finally{ft=t}};f_=function(n,e,t){switch(e){case"input":if(o_(n,t),e=t.name,t.type==="radio"&&e!=null){for(t=n;t.parentNode;)t=t.parentNode;for(t=t.querySelectorAll("input[name="+JSON.stringify(""+e)+'][type="radio"]'),e=0;e<t.length;e++){var r=t[e];if(r!==n&&r.form===n.form){var s=Sp(r);if(!s)throw Error(Y(90));vA(r),o_(r,s)}}}break;case"textarea":xA(n,t);break;case"select":e=t.value,e!=null&&Al(n,!!t.multiple,e,!1)}};CA=D0;kA=ga;var nL={usingClientEntryPoint:!1,Events:[Yd,wl,Sp,TA,AA,D0]},tu={findFiberByHostInstance:Xo,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},rL={bundleType:tu.bundleType,version:tu.version,rendererPackageName:tu.rendererPackageName,rendererConfig:tu.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:vi.ReactCurrentDispatcher,findHostInstanceByFiber:function(n){return n=DA(n),n===null?null:n.stateNode},findFiberByHostInstance:tu.findFiberByHostInstance||eL,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var lf=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!lf.isDisabled&&lf.supportsFiber)try{_p=lf.inject(rL),Ps=lf}catch{}}Vr.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=nL;Vr.createPortal=function(n,e){var t=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!F0(e))throw Error(Y(200));return Zj(n,e,null,t)};Vr.createRoot=function(n,e){if(!F0(n))throw Error(Y(299));var t=!1,r="",s=uC;return e!=null&&(e.unstable_strictMode===!0&&(t=!0),e.identifierPrefix!==void 0&&(r=e.identifierPrefix),e.onRecoverableError!==void 0&&(s=e.onRecoverableError)),e=L0(n,1,!1,null,null,t,!1,r,s),n[ci]=e.current,ld(n.nodeType===8?n.parentNode:n),new V0(e)};Vr.findDOMNode=function(n){if(n==null)return null;if(n.nodeType===1)return n;var e=n._reactInternals;if(e===void 0)throw typeof n.render=="function"?Error(Y(188)):(n=Object.keys(n).join(","),Error(Y(268,n)));return n=DA(e),n=n===null?null:n.stateNode,n};Vr.flushSync=function(n){return ga(n)};Vr.hydrate=function(n,e,t){if(!Rp(e))throw Error(Y(200));return Dp(null,n,e,!0,t)};Vr.hydrateRoot=function(n,e,t){if(!F0(n))throw Error(Y(405));var r=t!=null&&t.hydratedSources||null,s=!1,i="",o=uC;if(t!=null&&(t.unstable_strictMode===!0&&(s=!0),t.identifierPrefix!==void 0&&(i=t.identifierPrefix),t.onRecoverableError!==void 0&&(o=t.onRecoverableError)),e=cC(e,null,n,1,t??null,s,!1,i,o),n[ci]=e.current,ld(n),r)for(n=0;n<r.length;n++)t=r[n],s=t._getVersion,s=s(t._source),e.mutableSourceEagerHydrationData==null?e.mutableSourceEagerHydrationData=[t,s]:e.mutableSourceEagerHydrationData.push(t,s);return new Np(e)};Vr.render=function(n,e,t){if(!Rp(e))throw Error(Y(200));return Dp(null,n,e,!1,t)};Vr.unmountComponentAtNode=function(n){if(!Rp(n))throw Error(Y(40));return n._reactRootContainer?(ga(function(){Dp(null,null,n,!1,function(){n._reactRootContainer=null,n[ci]=null})}),!0):!1};Vr.unstable_batchedUpdates=D0;Vr.unstable_renderSubtreeIntoContainer=function(n,e,t,r){if(!Rp(t))throw Error(Y(200));if(n==null||n._reactInternals===void 0)throw Error(Y(38));return Dp(n,e,t,!1,r)};Vr.version="18.3.1-next-f1338f8080-20240426";function dC(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(dC)}catch(n){console.error(n)}}dC(),dA.exports=Vr;var sL=dA.exports,YI=sL;Zy.createRoot=YI.createRoot,Zy.hydrateRoot=YI.hydrateRoot;const iL="modulepreload",oL=function(n){return"/"+n},JI={},Ve=function(e,t,r){if(!t||t.length===0)return e();const s=document.getElementsByTagName("link");return Promise.all(t.map(i=>{if(i=oL(i),i in JI)return;JI[i]=!0;const o=i.endsWith(".css"),a=o?'[rel="stylesheet"]':"";if(!!r)for(let h=s.length-1;h>=0;h--){const f=s[h];if(f.href===i&&(!o||f.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${i}"]${a}`))return;const u=document.createElement("link");if(u.rel=o?"stylesheet":iL,o||(u.as="script",u.crossOrigin=""),u.href=i,document.head.appendChild(u),o)return new Promise((h,f)=>{u.addEventListener("load",h),u.addEventListener("error",()=>f(new Error(`Unable to preload CSS for ${i}`)))})})).then(()=>e()).catch(i=>{const o=new Event("vite:preloadError",{cancelable:!0});if(o.payload=i,window.dispatchEvent(o),!o.defaultPrevented)throw i})},aL=()=>{};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const hC={NODE_CLIENT:!1,NODE_ADMIN:!1,SDK_VERSION:"${JSCORE_VERSION}"};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Z=function(n,e){if(!n)throw Ec(e)},Ec=function(n){return new Error("Firebase Database ("+hC.SDK_VERSION+") INTERNAL ASSERT FAILED: "+n)};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const fC=function(n){const e=[];let t=0;for(let r=0;r<n.length;r++){let s=n.charCodeAt(r);s<128?e[t++]=s:s<2048?(e[t++]=s>>6|192,e[t++]=s&63|128):(s&64512)===55296&&r+1<n.length&&(n.charCodeAt(r+1)&64512)===56320?(s=65536+((s&1023)<<10)+(n.charCodeAt(++r)&1023),e[t++]=s>>18|240,e[t++]=s>>12&63|128,e[t++]=s>>6&63|128,e[t++]=s&63|128):(e[t++]=s>>12|224,e[t++]=s>>6&63|128,e[t++]=s&63|128)}return e},lL=function(n){const e=[];let t=0,r=0;for(;t<n.length;){const s=n[t++];if(s<128)e[r++]=String.fromCharCode(s);else if(s>191&&s<224){const i=n[t++];e[r++]=String.fromCharCode((s&31)<<6|i&63)}else if(s>239&&s<365){const i=n[t++],o=n[t++],a=n[t++],c=((s&7)<<18|(i&63)<<12|(o&63)<<6|a&63)-65536;e[r++]=String.fromCharCode(55296+(c>>10)),e[r++]=String.fromCharCode(56320+(c&1023))}else{const i=n[t++],o=n[t++];e[r++]=String.fromCharCode((s&15)<<12|(i&63)<<6|o&63)}}return e.join("")},$0={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:typeof atob=="function",encodeByteArray(n,e){if(!Array.isArray(n))throw Error("encodeByteArray takes an array as a parameter");this.init_();const t=e?this.byteToCharMapWebSafe_:this.byteToCharMap_,r=[];for(let s=0;s<n.length;s+=3){const i=n[s],o=s+1<n.length,a=o?n[s+1]:0,c=s+2<n.length,u=c?n[s+2]:0,h=i>>2,f=(i&3)<<4|a>>4;let m=(a&15)<<2|u>>6,y=u&63;c||(y=64,o||(m=64)),r.push(t[h],t[f],t[m],t[y])}return r.join("")},encodeString(n,e){return this.HAS_NATIVE_SUPPORT&&!e?btoa(n):this.encodeByteArray(fC(n),e)},decodeString(n,e){return this.HAS_NATIVE_SUPPORT&&!e?atob(n):lL(this.decodeStringToByteArray(n,e))},decodeStringToByteArray(n,e){this.init_();const t=e?this.charToByteMapWebSafe_:this.charToByteMap_,r=[];for(let s=0;s<n.length;){const i=t[n.charAt(s++)],a=s<n.length?t[n.charAt(s)]:0;++s;const u=s<n.length?t[n.charAt(s)]:64;++s;const f=s<n.length?t[n.charAt(s)]:64;if(++s,i==null||a==null||u==null||f==null)throw new cL;const m=i<<2|a>>4;if(r.push(m),u!==64){const y=a<<4&240|u>>2;if(r.push(y),f!==64){const w=u<<6&192|f;r.push(w)}}}return r},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let n=0;n<this.ENCODED_VALS.length;n++)this.byteToCharMap_[n]=this.ENCODED_VALS.charAt(n),this.charToByteMap_[this.byteToCharMap_[n]]=n,this.byteToCharMapWebSafe_[n]=this.ENCODED_VALS_WEBSAFE.charAt(n),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[n]]=n,n>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(n)]=n,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(n)]=n)}}};class cL extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}const mC=function(n){const e=fC(n);return $0.encodeByteArray(e,!0)},Am=function(n){return mC(n).replace(/\./g,"")},Cm=function(n){try{return $0.decodeString(n,!0)}catch(e){console.error("base64Decode failed: ",e)}return null};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function uL(n){return pC(void 0,n)}function pC(n,e){if(!(e instanceof Object))return e;switch(e.constructor){case Date:const t=e;return new Date(t.getTime());case Object:n===void 0&&(n={});break;case Array:n=[];break;default:return e}for(const t in e)!e.hasOwnProperty(t)||!dL(t)||(n[t]=pC(n[t],e[t]));return n}function dL(n){return n!=="__proto__"}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function gC(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("Unable to locate global object.")}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const hL=()=>gC().__FIREBASE_DEFAULTS__,fL=()=>{if(typeof process>"u"||typeof process.env>"u")return;const n={}.__FIREBASE_DEFAULTS__;if(n)return JSON.parse(n)},mL=()=>{if(typeof document>"u")return;let n;try{n=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch{return}const e=n&&Cm(n[1]);return e&&JSON.parse(e)},Pp=()=>{try{return aL()||hL()||fL()||mL()}catch(n){console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${n}`);return}},yC=n=>{var e,t;return(t=(e=Pp())==null?void 0:e.emulatorHosts)==null?void 0:t[n]},_C=n=>{const e=yC(n);if(!e)return;const t=e.lastIndexOf(":");if(t<=0||t+1===e.length)throw new Error(`Invalid host ${e} with no separate hostname and port!`);const r=parseInt(e.substring(t+1),10);return e[0]==="["?[e.substring(1,t-1),r]:[e.substring(0,t),r]},vC=()=>{var n;return(n=Pp())==null?void 0:n.config},wC=n=>{var e;return(e=Pp())==null?void 0:e[`_${n}`]};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ar{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}wrapCallback(e){return(t,r)=>{t?this.reject(t):this.resolve(r),typeof e=="function"&&(this.promise.catch(()=>{}),e.length===1?e(t):e(t,r))}}}/**
 * @license
 * Copyright 2025 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function wi(n){try{return(n.startsWith("http://")||n.startsWith("https://")?new URL(n).hostname:n).endsWith(".cloudworkstations.dev")}catch{return!1}}async function Op(n){return(await fetch(n,{credentials:"include"})).ok}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function xC(n,e){if(n.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');const t={alg:"none",type:"JWT"},r=e||"demo-project",s=n.iat||0,i=n.sub||n.user_id;if(!i)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");const o={iss:`https://securetoken.google.com/${r}`,aud:r,iat:s,exp:s+3600,auth_time:s,sub:i,user_id:i,firebase:{sign_in_provider:"custom",identities:{}},...n},a="";return[Am(JSON.stringify(t)),Am(JSON.stringify(o)),a].join(".")}const Ou={};function pL(){const n={prod:[],emulator:[]};for(const e of Object.keys(Ou))Ou[e]?n.emulator.push(e):n.prod.push(e);return n}function gL(n){let e=document.getElementById(n),t=!1;return e||(e=document.createElement("div"),e.setAttribute("id",n),t=!0),{created:t,element:e}}let XI=!1;function U0(n,e){if(typeof window>"u"||typeof document>"u"||!wi(window.location.host)||Ou[n]===e||Ou[n]||XI)return;Ou[n]=e;function t(m){return`__firebase__banner__${m}`}const r="__firebase__banner",i=pL().prod.length>0;function o(){const m=document.getElementById(r);m&&m.remove()}function a(m){m.style.display="flex",m.style.background="#7faaf0",m.style.position="fixed",m.style.bottom="5px",m.style.left="5px",m.style.padding=".5em",m.style.borderRadius="5px",m.style.alignItems="center"}function c(m,y){m.setAttribute("width","24"),m.setAttribute("id",y),m.setAttribute("height","24"),m.setAttribute("viewBox","0 0 24 24"),m.setAttribute("fill","none"),m.style.marginLeft="-6px"}function u(){const m=document.createElement("span");return m.style.cursor="pointer",m.style.marginLeft="16px",m.style.fontSize="24px",m.innerHTML=" &times;",m.onclick=()=>{XI=!0,o()},m}function h(m,y){m.setAttribute("id",y),m.innerText="Learn more",m.href="https://firebase.google.com/docs/studio/preview-apps#preview-backend",m.setAttribute("target","__blank"),m.style.paddingLeft="5px",m.style.textDecoration="underline"}function f(){const m=gL(r),y=t("text"),w=document.getElementById(y)||document.createElement("span"),S=t("learnmore"),R=document.getElementById(S)||document.createElement("a"),T=t("preprendIcon"),I=document.getElementById(T)||document.createElementNS("http://www.w3.org/2000/svg","svg");if(m.created){const N=m.element;a(N),h(R,S);const P=u();c(I,T),N.append(I,w,R,P),document.body.appendChild(N)}i?(w.innerText="Preview backend disconnected.",I.innerHTML=`<g clip-path="url(#clip0_6013_33858)">
<path d="M4.8 17.6L12 5.6L19.2 17.6H4.8ZM6.91667 16.4H17.0833L12 7.93333L6.91667 16.4ZM12 15.6C12.1667 15.6 12.3056 15.5444 12.4167 15.4333C12.5389 15.3111 12.6 15.1667 12.6 15C12.6 14.8333 12.5389 14.6944 12.4167 14.5833C12.3056 14.4611 12.1667 14.4 12 14.4C11.8333 14.4 11.6889 14.4611 11.5667 14.5833C11.4556 14.6944 11.4 14.8333 11.4 15C11.4 15.1667 11.4556 15.3111 11.5667 15.4333C11.6889 15.5444 11.8333 15.6 12 15.6ZM11.4 13.6H12.6V10.4H11.4V13.6Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6013_33858">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`):(I.innerHTML=`<g clip-path="url(#clip0_6083_34804)">
<path d="M11.4 15.2H12.6V11.2H11.4V15.2ZM12 10C12.1667 10 12.3056 9.94444 12.4167 9.83333C12.5389 9.71111 12.6 9.56667 12.6 9.4C12.6 9.23333 12.5389 9.09444 12.4167 8.98333C12.3056 8.86111 12.1667 8.8 12 8.8C11.8333 8.8 11.6889 8.86111 11.5667 8.98333C11.4556 9.09444 11.4 9.23333 11.4 9.4C11.4 9.56667 11.4556 9.71111 11.5667 9.83333C11.6889 9.94444 11.8333 10 12 10ZM12 18.4C11.1222 18.4 10.2944 18.2333 9.51667 17.9C8.73889 17.5667 8.05556 17.1111 7.46667 16.5333C6.88889 15.9444 6.43333 15.2611 6.1 14.4833C5.76667 13.7056 5.6 12.8778 5.6 12C5.6 11.1111 5.76667 10.2833 6.1 9.51667C6.43333 8.73889 6.88889 8.06111 7.46667 7.48333C8.05556 6.89444 8.73889 6.43333 9.51667 6.1C10.2944 5.76667 11.1222 5.6 12 5.6C12.8889 5.6 13.7167 5.76667 14.4833 6.1C15.2611 6.43333 15.9389 6.89444 16.5167 7.48333C17.1056 8.06111 17.5667 8.73889 17.9 9.51667C18.2333 10.2833 18.4 11.1111 18.4 12C18.4 12.8778 18.2333 13.7056 17.9 14.4833C17.5667 15.2611 17.1056 15.9444 16.5167 16.5333C15.9389 17.1111 15.2611 17.5667 14.4833 17.9C13.7167 18.2333 12.8889 18.4 12 18.4ZM12 17.2C13.4444 17.2 14.6722 16.6944 15.6833 15.6833C16.6944 14.6722 17.2 13.4444 17.2 12C17.2 10.5556 16.6944 9.32778 15.6833 8.31667C14.6722 7.30555 13.4444 6.8 12 6.8C10.5556 6.8 9.32778 7.30555 8.31667 8.31667C7.30556 9.32778 6.8 10.5556 6.8 12C6.8 13.4444 7.30556 14.6722 8.31667 15.6833C9.32778 16.6944 10.5556 17.2 12 17.2Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6083_34804">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`,w.innerText="Preview backend running in this workspace."),w.setAttribute("id",y)}document.readyState==="loading"?window.addEventListener("DOMContentLoaded",f):f()}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function En(){return typeof navigator<"u"&&typeof navigator.userAgent=="string"?navigator.userAgent:""}function B0(){return typeof window<"u"&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(En())}function SC(){var e;const n=(e=Pp())==null?void 0:e.forceEnvironment;if(n==="node")return!0;if(n==="browser")return!1;try{return Object.prototype.toString.call(global.process)==="[object process]"}catch{return!1}}function yL(){return typeof navigator<"u"&&navigator.userAgent==="Cloudflare-Workers"}function z0(){const n=typeof chrome=="object"?chrome.runtime:typeof browser=="object"?browser.runtime:void 0;return typeof n=="object"&&n.id!==void 0}function IC(){return typeof navigator=="object"&&navigator.product==="ReactNative"}function _L(){const n=En();return n.indexOf("MSIE ")>=0||n.indexOf("Trident/")>=0}function EC(){return hC.NODE_ADMIN===!0}function bC(){return!SC()&&!!navigator.userAgent&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")}function TC(){return!SC()&&!!navigator.userAgent&&(navigator.userAgent.includes("Safari")||navigator.userAgent.includes("WebKit"))&&!navigator.userAgent.includes("Chrome")}function jp(){try{return typeof indexedDB=="object"}catch{return!1}}function q0(){return new Promise((n,e)=>{try{let t=!0;const r="validate-browser-context-for-indexeddb-analytics-module",s=self.indexedDB.open(r);s.onsuccess=()=>{s.result.close(),t||self.indexedDB.deleteDatabase(r),n(!0)},s.onupgradeneeded=()=>{t=!1},s.onerror=()=>{var i;e(((i=s.error)==null?void 0:i.message)||"")}}catch(t){e(t)}})}function AC(){return!(typeof navigator>"u"||!navigator.cookieEnabled)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const vL="FirebaseError";class ys extends Error{constructor(e,t,r){super(t),this.code=e,this.customData=r,this.name=vL,Object.setPrototypeOf(this,ys.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,La.prototype.create)}}class La{constructor(e,t,r){this.service=e,this.serviceName=t,this.errors=r}create(e,...t){const r=t[0]||{},s=`${this.service}/${e}`,i=this.errors[e],o=i?wL(i,r):"Error",a=`${this.serviceName}: ${o} (${s}).`;return new ys(s,a,r)}}function wL(n,e){return n.replace(xL,(t,r)=>{const s=e[r];return s!=null?String(s):`<${r}?>`})}const xL=/\{\$([^}]+)}/g;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function yd(n){return JSON.parse(n)}function Sn(n){return JSON.stringify(n)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const CC=function(n){let e={},t={},r={},s="";try{const i=n.split(".");e=yd(Cm(i[0])||""),t=yd(Cm(i[1])||""),s=i[2],r=t.d||{},delete t.d}catch{}return{header:e,claims:t,data:r,signature:s}},SL=function(n){const e=CC(n),t=e.claims;return!!t&&typeof t=="object"&&t.hasOwnProperty("iat")},IL=function(n){const e=CC(n).claims;return typeof e=="object"&&e.admin===!0};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function _s(n,e){return Object.prototype.hasOwnProperty.call(n,e)}function ya(n,e){if(Object.prototype.hasOwnProperty.call(n,e))return n[e]}function km(n){for(const e in n)if(Object.prototype.hasOwnProperty.call(n,e))return!1;return!0}function Nm(n,e,t){const r={};for(const s in n)Object.prototype.hasOwnProperty.call(n,s)&&(r[s]=e.call(t,n[s],s,n));return r}function jr(n,e){if(n===e)return!0;const t=Object.keys(n),r=Object.keys(e);for(const s of t){if(!r.includes(s))return!1;const i=n[s],o=e[s];if(ZI(i)&&ZI(o)){if(!jr(i,o))return!1}else if(i!==o)return!1}for(const s of r)if(!t.includes(s))return!1;return!0}function ZI(n){return n!==null&&typeof n=="object"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ma(n){const e=[];for(const[t,r]of Object.entries(n))Array.isArray(r)?r.forEach(s=>{e.push(encodeURIComponent(t)+"="+encodeURIComponent(s))}):e.push(encodeURIComponent(t)+"="+encodeURIComponent(r));return e.length?"&"+e.join("&"):""}function yu(n){const e={};return n.replace(/^\?/,"").split("&").forEach(r=>{if(r){const[s,i]=r.split("=");e[decodeURIComponent(s)]=decodeURIComponent(i)}}),e}function _u(n){const e=n.indexOf("?");if(!e)return"";const t=n.indexOf("#",e);return n.substring(e,t>0?t:void 0)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class EL{constructor(){this.chain_=[],this.buf_=[],this.W_=[],this.pad_=[],this.inbuf_=0,this.total_=0,this.blockSize=512/8,this.pad_[0]=128;for(let e=1;e<this.blockSize;++e)this.pad_[e]=0;this.reset()}reset(){this.chain_[0]=1732584193,this.chain_[1]=4023233417,this.chain_[2]=2562383102,this.chain_[3]=271733878,this.chain_[4]=3285377520,this.inbuf_=0,this.total_=0}compress_(e,t){t||(t=0);const r=this.W_;if(typeof e=="string")for(let f=0;f<16;f++)r[f]=e.charCodeAt(t)<<24|e.charCodeAt(t+1)<<16|e.charCodeAt(t+2)<<8|e.charCodeAt(t+3),t+=4;else for(let f=0;f<16;f++)r[f]=e[t]<<24|e[t+1]<<16|e[t+2]<<8|e[t+3],t+=4;for(let f=16;f<80;f++){const m=r[f-3]^r[f-8]^r[f-14]^r[f-16];r[f]=(m<<1|m>>>31)&4294967295}let s=this.chain_[0],i=this.chain_[1],o=this.chain_[2],a=this.chain_[3],c=this.chain_[4],u,h;for(let f=0;f<80;f++){f<40?f<20?(u=a^i&(o^a),h=1518500249):(u=i^o^a,h=1859775393):f<60?(u=i&o|a&(i|o),h=2400959708):(u=i^o^a,h=3395469782);const m=(s<<5|s>>>27)+u+c+h+r[f]&4294967295;c=a,a=o,o=(i<<30|i>>>2)&4294967295,i=s,s=m}this.chain_[0]=this.chain_[0]+s&4294967295,this.chain_[1]=this.chain_[1]+i&4294967295,this.chain_[2]=this.chain_[2]+o&4294967295,this.chain_[3]=this.chain_[3]+a&4294967295,this.chain_[4]=this.chain_[4]+c&4294967295}update(e,t){if(e==null)return;t===void 0&&(t=e.length);const r=t-this.blockSize;let s=0;const i=this.buf_;let o=this.inbuf_;for(;s<t;){if(o===0)for(;s<=r;)this.compress_(e,s),s+=this.blockSize;if(typeof e=="string"){for(;s<t;)if(i[o]=e.charCodeAt(s),++o,++s,o===this.blockSize){this.compress_(i),o=0;break}}else for(;s<t;)if(i[o]=e[s],++o,++s,o===this.blockSize){this.compress_(i),o=0;break}}this.inbuf_=o,this.total_+=t}digest(){const e=[];let t=this.total_*8;this.inbuf_<56?this.update(this.pad_,56-this.inbuf_):this.update(this.pad_,this.blockSize-(this.inbuf_-56));for(let s=this.blockSize-1;s>=56;s--)this.buf_[s]=t&255,t/=256;this.compress_(this.buf_);let r=0;for(let s=0;s<5;s++)for(let i=24;i>=0;i-=8)e[r]=this.chain_[s]>>i&255,++r;return e}}function bL(n,e){const t=new TL(n,e);return t.subscribe.bind(t)}class TL{constructor(e,t){this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=t,this.task.then(()=>{e(this)}).catch(r=>{this.error(r)})}next(e){this.forEachObserver(t=>{t.next(e)})}error(e){this.forEachObserver(t=>{t.error(e)}),this.close(e)}complete(){this.forEachObserver(e=>{e.complete()}),this.close()}subscribe(e,t,r){let s;if(e===void 0&&t===void 0&&r===void 0)throw new Error("Missing Observer.");AL(e,["next","error","complete"])?s=e:s={next:e,error:t,complete:r},s.next===void 0&&(s.next=xy),s.error===void 0&&(s.error=xy),s.complete===void 0&&(s.complete=xy);const i=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then(()=>{try{this.finalError?s.error(this.finalError):s.complete()}catch{}}),this.observers.push(s),i}unsubscribeOne(e){this.observers===void 0||this.observers[e]===void 0||(delete this.observers[e],this.observerCount-=1,this.observerCount===0&&this.onNoObservers!==void 0&&this.onNoObservers(this))}forEachObserver(e){if(!this.finalized)for(let t=0;t<this.observers.length;t++)this.sendOne(t,e)}sendOne(e,t){this.task.then(()=>{if(this.observers!==void 0&&this.observers[e]!==void 0)try{t(this.observers[e])}catch(r){typeof console<"u"&&console.error&&console.error(r)}})}close(e){this.finalized||(this.finalized=!0,e!==void 0&&(this.finalError=e),this.task.then(()=>{this.observers=void 0,this.onNoObservers=void 0}))}}function AL(n,e){if(typeof n!="object"||n===null)return!1;for(const t of e)if(t in n&&typeof n[t]=="function")return!0;return!1}function xy(){}function _a(n,e){return`${n} failed: ${e} argument `}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const CL=function(n){const e=[];let t=0;for(let r=0;r<n.length;r++){let s=n.charCodeAt(r);if(s>=55296&&s<=56319){const i=s-55296;r++,Z(r<n.length,"Surrogate pair missing trail surrogate.");const o=n.charCodeAt(r)-56320;s=65536+(i<<10)+o}s<128?e[t++]=s:s<2048?(e[t++]=s>>6|192,e[t++]=s&63|128):s<65536?(e[t++]=s>>12|224,e[t++]=s>>6&63|128,e[t++]=s&63|128):(e[t++]=s>>18|240,e[t++]=s>>12&63|128,e[t++]=s>>6&63|128,e[t++]=s&63|128)}return e},Lp=function(n){let e=0;for(let t=0;t<n.length;t++){const r=n.charCodeAt(t);r<128?e++:r<2048?e+=2:r>=55296&&r<=56319?(e+=4,t++):e+=3}return e};/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const kL=1e3,NL=2,RL=4*60*60*1e3,DL=.5;function eE(n,e=kL,t=NL){const r=e*Math.pow(t,n),s=Math.round(DL*r*(Math.random()-.5)*2);return Math.min(RL,r+s)}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function le(n){return n&&n._delegate?n._delegate:n}class wr{constructor(e,t,r){this.name=e,this.instanceFactory=t,this.type=r,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const zo="[DEFAULT]";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class G_{constructor(e,t){this.name=e,this.container=t,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(e){const t=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(t)){const r=new Ar;if(this.instancesDeferred.set(t,r),this.isInitialized(t)||this.shouldAutoInitialize())try{const s=this.getOrInitializeService({instanceIdentifier:t});s&&r.resolve(s)}catch{}}return this.instancesDeferred.get(t).promise}getImmediate(e){const t=this.normalizeInstanceIdentifier(e==null?void 0:e.identifier),r=(e==null?void 0:e.optional)??!1;if(this.isInitialized(t)||this.shouldAutoInitialize())try{return this.getOrInitializeService({instanceIdentifier:t})}catch(s){if(r)return null;throw s}else{if(r)return null;throw Error(`Service ${this.name} is not available`)}}getComponent(){return this.component}setComponent(e){if(e.name!==this.name)throw Error(`Mismatching Component ${e.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=e,!!this.shouldAutoInitialize()){if(OL(e))try{this.getOrInitializeService({instanceIdentifier:zo})}catch{}for(const[t,r]of this.instancesDeferred.entries()){const s=this.normalizeInstanceIdentifier(t);try{const i=this.getOrInitializeService({instanceIdentifier:s});r.resolve(i)}catch{}}}}clearInstance(e=zo){this.instancesDeferred.delete(e),this.instancesOptions.delete(e),this.instances.delete(e)}async delete(){const e=Array.from(this.instances.values());await Promise.all([...e.filter(t=>"INTERNAL"in t).map(t=>t.INTERNAL.delete()),...e.filter(t=>"_delete"in t).map(t=>t._delete())])}isComponentSet(){return this.component!=null}isInitialized(e=zo){return this.instances.has(e)}getOptions(e=zo){return this.instancesOptions.get(e)||{}}initialize(e={}){const{options:t={}}=e,r=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(r))throw Error(`${this.name}(${r}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const s=this.getOrInitializeService({instanceIdentifier:r,options:t});for(const[i,o]of this.instancesDeferred.entries()){const a=this.normalizeInstanceIdentifier(i);r===a&&o.resolve(s)}return s}onInit(e,t){const r=this.normalizeInstanceIdentifier(t),s=this.onInitCallbacks.get(r)??new Set;s.add(e),this.onInitCallbacks.set(r,s);const i=this.instances.get(r);return i&&e(i,r),()=>{s.delete(e)}}invokeOnInitCallbacks(e,t){const r=this.onInitCallbacks.get(t);if(r)for(const s of r)try{s(e,t)}catch{}}getOrInitializeService({instanceIdentifier:e,options:t={}}){let r=this.instances.get(e);if(!r&&this.component&&(r=this.component.instanceFactory(this.container,{instanceIdentifier:PL(e),options:t}),this.instances.set(e,r),this.instancesOptions.set(e,t),this.invokeOnInitCallbacks(r,e),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,e,r)}catch{}return r||null}normalizeInstanceIdentifier(e=zo){return this.component?this.component.multipleInstances?e:zo:e}shouldAutoInitialize(){return!!this.component&&this.component.instantiationMode!=="EXPLICIT"}}function PL(n){return n===zo?void 0:n}function OL(n){return n.instantiationMode==="EAGER"}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class kC{constructor(e){this.name=e,this.providers=new Map}addComponent(e){const t=this.getProvider(e.name);if(t.isComponentSet())throw new Error(`Component ${e.name} has already been registered with ${this.name}`);t.setComponent(e)}addOrOverwriteComponent(e){this.getProvider(e.name).isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)}getProvider(e){if(this.providers.has(e))return this.providers.get(e);const t=new G_(e,this);return this.providers.set(e,t),t}getProviders(){return Array.from(this.providers.values())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var We;(function(n){n[n.DEBUG=0]="DEBUG",n[n.VERBOSE=1]="VERBOSE",n[n.INFO=2]="INFO",n[n.WARN=3]="WARN",n[n.ERROR=4]="ERROR",n[n.SILENT=5]="SILENT"})(We||(We={}));const jL={debug:We.DEBUG,verbose:We.VERBOSE,info:We.INFO,warn:We.WARN,error:We.ERROR,silent:We.SILENT},LL=We.INFO,ML={[We.DEBUG]:"log",[We.VERBOSE]:"log",[We.INFO]:"info",[We.WARN]:"warn",[We.ERROR]:"error"},VL=(n,e,...t)=>{if(e<n.logLevel)return;const r=new Date().toISOString(),s=ML[e];if(s)console[s](`[${r}]  ${n.name}:`,...t);else throw new Error(`Attempted to log a message with an invalid logType (value: ${e})`)};class Xd{constructor(e){this.name=e,this._logLevel=LL,this._logHandler=VL,this._userLogHandler=null}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in We))throw new TypeError(`Invalid value "${e}" assigned to \`logLevel\``);this._logLevel=e}setLogLevel(e){this._logLevel=typeof e=="string"?jL[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if(typeof e!="function")throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(...e){this._userLogHandler&&this._userLogHandler(this,We.DEBUG,...e),this._logHandler(this,We.DEBUG,...e)}log(...e){this._userLogHandler&&this._userLogHandler(this,We.VERBOSE,...e),this._logHandler(this,We.VERBOSE,...e)}info(...e){this._userLogHandler&&this._userLogHandler(this,We.INFO,...e),this._logHandler(this,We.INFO,...e)}warn(...e){this._userLogHandler&&this._userLogHandler(this,We.WARN,...e),this._logHandler(this,We.WARN,...e)}error(...e){this._userLogHandler&&this._userLogHandler(this,We.ERROR,...e),this._logHandler(this,We.ERROR,...e)}}const FL=(n,e)=>e.some(t=>n instanceof t);let tE,nE;function $L(){return tE||(tE=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function UL(){return nE||(nE=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const NC=new WeakMap,H_=new WeakMap,RC=new WeakMap,Sy=new WeakMap,W0=new WeakMap;function BL(n){const e=new Promise((t,r)=>{const s=()=>{n.removeEventListener("success",i),n.removeEventListener("error",o)},i=()=>{t(js(n.result)),s()},o=()=>{r(n.error),s()};n.addEventListener("success",i),n.addEventListener("error",o)});return e.then(t=>{t instanceof IDBCursor&&NC.set(t,n)}).catch(()=>{}),W0.set(e,n),e}function zL(n){if(H_.has(n))return;const e=new Promise((t,r)=>{const s=()=>{n.removeEventListener("complete",i),n.removeEventListener("error",o),n.removeEventListener("abort",o)},i=()=>{t(),s()},o=()=>{r(n.error||new DOMException("AbortError","AbortError")),s()};n.addEventListener("complete",i),n.addEventListener("error",o),n.addEventListener("abort",o)});H_.set(n,e)}let Q_={get(n,e,t){if(n instanceof IDBTransaction){if(e==="done")return H_.get(n);if(e==="objectStoreNames")return n.objectStoreNames||RC.get(n);if(e==="store")return t.objectStoreNames[1]?void 0:t.objectStore(t.objectStoreNames[0])}return js(n[e])},set(n,e,t){return n[e]=t,!0},has(n,e){return n instanceof IDBTransaction&&(e==="done"||e==="store")?!0:e in n}};function qL(n){Q_=n(Q_)}function WL(n){return n===IDBDatabase.prototype.transaction&&!("objectStoreNames"in IDBTransaction.prototype)?function(e,...t){const r=n.call(Ff(this),e,...t);return RC.set(r,e.sort?e.sort():[e]),js(r)}:UL().includes(n)?function(...e){return n.apply(Ff(this),e),js(NC.get(this))}:function(...e){return js(n.apply(Ff(this),e))}}function GL(n){return typeof n=="function"?WL(n):(n instanceof IDBTransaction&&zL(n),FL(n,$L())?new Proxy(n,Q_):n)}function js(n){if(n instanceof IDBRequest)return BL(n);if(Sy.has(n))return Sy.get(n);const e=GL(n);return e!==n&&(Sy.set(n,e),W0.set(e,n)),e}const Ff=n=>W0.get(n);function G0(n,e,{blocked:t,upgrade:r,blocking:s,terminated:i}={}){const o=indexedDB.open(n,e),a=js(o);return r&&o.addEventListener("upgradeneeded",c=>{r(js(o.result),c.oldVersion,c.newVersion,js(o.transaction),c)}),t&&o.addEventListener("blocked",c=>t(c.oldVersion,c.newVersion,c)),a.then(c=>{i&&c.addEventListener("close",()=>i()),s&&c.addEventListener("versionchange",u=>s(u.oldVersion,u.newVersion,u))}).catch(()=>{}),a}function HL(n,{blocked:e}={}){const t=indexedDB.deleteDatabase(n);return e&&t.addEventListener("blocked",r=>e(r.oldVersion,r)),js(t).then(()=>{})}const QL=["get","getKey","getAll","getAllKeys","count"],KL=["put","add","delete","clear"],Iy=new Map;function rE(n,e){if(!(n instanceof IDBDatabase&&!(e in n)&&typeof e=="string"))return;if(Iy.get(e))return Iy.get(e);const t=e.replace(/FromIndex$/,""),r=e!==t,s=KL.includes(t);if(!(t in(r?IDBIndex:IDBObjectStore).prototype)||!(s||QL.includes(t)))return;const i=async function(o,...a){const c=this.transaction(o,s?"readwrite":"readonly");let u=c.store;return r&&(u=u.index(a.shift())),(await Promise.all([u[t](...a),s&&c.done]))[0]};return Iy.set(e,i),i}qL(n=>({...n,get:(e,t,r)=>rE(e,t)||n.get(e,t,r),has:(e,t)=>!!rE(e,t)||n.has(e,t)}));const Iq=Object.freeze(Object.defineProperty({__proto__:null,deleteDB:HL,openDB:G0,unwrap:Ff,wrap:js},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class YL{constructor(e){this.container=e}getPlatformInfoString(){return this.container.getProviders().map(t=>{if(JL(t)){const r=t.getImmediate();return`${r.library}/${r.version}`}else return null}).filter(t=>t).join(" ")}}function JL(n){const e=n.getComponent();return(e==null?void 0:e.type)==="VERSION"}const K_="@firebase/app",sE="0.14.1";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const hi=new Xd("@firebase/app"),XL="@firebase/app-compat",ZL="@firebase/analytics-compat",eM="@firebase/analytics",tM="@firebase/app-check-compat",nM="@firebase/app-check",rM="@firebase/auth",sM="@firebase/auth-compat",iM="@firebase/database",oM="@firebase/data-connect",aM="@firebase/database-compat",lM="@firebase/functions",cM="@firebase/functions-compat",uM="@firebase/installations",dM="@firebase/installations-compat",hM="@firebase/messaging",fM="@firebase/messaging-compat",mM="@firebase/performance",pM="@firebase/performance-compat",gM="@firebase/remote-config",yM="@firebase/remote-config-compat",_M="@firebase/storage",vM="@firebase/storage-compat",wM="@firebase/firestore",xM="@firebase/ai",SM="@firebase/firestore-compat",IM="firebase",EM="12.1.0";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Rm="[DEFAULT]",bM={[K_]:"fire-core",[XL]:"fire-core-compat",[eM]:"fire-analytics",[ZL]:"fire-analytics-compat",[nM]:"fire-app-check",[tM]:"fire-app-check-compat",[rM]:"fire-auth",[sM]:"fire-auth-compat",[iM]:"fire-rtdb",[oM]:"fire-data-connect",[aM]:"fire-rtdb-compat",[lM]:"fire-fn",[cM]:"fire-fn-compat",[uM]:"fire-iid",[dM]:"fire-iid-compat",[hM]:"fire-fcm",[fM]:"fire-fcm-compat",[mM]:"fire-perf",[pM]:"fire-perf-compat",[gM]:"fire-rc",[yM]:"fire-rc-compat",[_M]:"fire-gcs",[vM]:"fire-gcs-compat",[wM]:"fire-fst",[SM]:"fire-fst-compat",[xM]:"fire-vertex","fire-js":"fire-js",[IM]:"fire-js-all"};/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const _d=new Map,TM=new Map,Y_=new Map;function iE(n,e){try{n.container.addComponent(e)}catch(t){hi.debug(`Component ${e.name} failed to register with FirebaseApp ${n.name}`,t)}}function gs(n){const e=n.name;if(Y_.has(e))return hi.debug(`There were multiple attempts to register component ${e}.`),!1;Y_.set(e,n);for(const t of _d.values())iE(t,n);for(const t of TM.values())iE(t,n);return!0}function Ws(n,e){const t=n.container.getProvider("heartbeat").getImmediate({optional:!0});return t&&t.triggerHeartbeat(),n.container.getProvider(e)}function AM(n,e,t=Rm){Ws(n,e).clearInstance(t)}function Bt(n){return n==null?!1:n.settings!==void 0}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const CM={"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."},oo=new La("app","Firebase",CM);/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class kM{constructor(e,t,r){this._isDeleted=!1,this._options={...e},this._config={...t},this._name=t.name,this._automaticDataCollectionEnabled=t.automaticDataCollectionEnabled,this._container=r,this.container.addComponent(new wr("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this.checkDestroyed(),this._automaticDataCollectionEnabled=e}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(e){this._isDeleted=e}checkDestroyed(){if(this.isDeleted)throw oo.create("app-deleted",{appName:this._name})}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Va=EM;function DC(n,e={}){let t=n;typeof e!="object"&&(e={name:e});const r={name:Rm,automaticDataCollectionEnabled:!0,...e},s=r.name;if(typeof s!="string"||!s)throw oo.create("bad-app-name",{appName:String(s)});if(t||(t=vC()),!t)throw oo.create("no-options");const i=_d.get(s);if(i){if(jr(t,i.options)&&jr(r,i.config))return i;throw oo.create("duplicate-app",{appName:s})}const o=new kC(s);for(const c of Y_.values())o.addComponent(c);const a=new kM(t,r,o);return _d.set(s,a),a}function Zd(n=Rm){const e=_d.get(n);if(!e&&n===Rm&&vC())return DC();if(!e)throw oo.create("no-app",{appName:n});return e}function NM(){return Array.from(_d.values())}function _r(n,e,t){let r=bM[n]??n;t&&(r+=`-${t}`);const s=r.match(/\s|\//),i=e.match(/\s|\//);if(s||i){const o=[`Unable to register library "${r}" with version "${e}":`];s&&o.push(`library name "${r}" contains illegal characters (whitespace or "/")`),s&&i&&o.push("and"),i&&o.push(`version name "${e}" contains illegal characters (whitespace or "/")`),hi.warn(o.join(" "));return}gs(new wr(`${r}-version`,()=>({library:r,version:e}),"VERSION"))}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const RM="firebase-heartbeat-database",DM=1,vd="firebase-heartbeat-store";let Ey=null;function PC(){return Ey||(Ey=G0(RM,DM,{upgrade:(n,e)=>{switch(e){case 0:try{n.createObjectStore(vd)}catch(t){console.warn(t)}}}}).catch(n=>{throw oo.create("idb-open",{originalErrorMessage:n.message})})),Ey}async function PM(n){try{const t=(await PC()).transaction(vd),r=await t.objectStore(vd).get(OC(n));return await t.done,r}catch(e){if(e instanceof ys)hi.warn(e.message);else{const t=oo.create("idb-get",{originalErrorMessage:e==null?void 0:e.message});hi.warn(t.message)}}}async function oE(n,e){try{const r=(await PC()).transaction(vd,"readwrite");await r.objectStore(vd).put(e,OC(n)),await r.done}catch(t){if(t instanceof ys)hi.warn(t.message);else{const r=oo.create("idb-set",{originalErrorMessage:t==null?void 0:t.message});hi.warn(r.message)}}}function OC(n){return`${n.name}!${n.options.appId}`}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const OM=1024,jM=30;class LM{constructor(e){this.container=e,this._heartbeatsCache=null;const t=this.container.getProvider("app").getImmediate();this._storage=new VM(t),this._heartbeatsCachePromise=this._storage.read().then(r=>(this._heartbeatsCache=r,r))}async triggerHeartbeat(){var e,t;try{const s=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),i=aE();if(((e=this._heartbeatsCache)==null?void 0:e.heartbeats)==null&&(this._heartbeatsCache=await this._heartbeatsCachePromise,((t=this._heartbeatsCache)==null?void 0:t.heartbeats)==null)||this._heartbeatsCache.lastSentHeartbeatDate===i||this._heartbeatsCache.heartbeats.some(o=>o.date===i))return;if(this._heartbeatsCache.heartbeats.push({date:i,agent:s}),this._heartbeatsCache.heartbeats.length>jM){const o=FM(this._heartbeatsCache.heartbeats);this._heartbeatsCache.heartbeats.splice(o,1)}return this._storage.overwrite(this._heartbeatsCache)}catch(r){hi.warn(r)}}async getHeartbeatsHeader(){var e;try{if(this._heartbeatsCache===null&&await this._heartbeatsCachePromise,((e=this._heartbeatsCache)==null?void 0:e.heartbeats)==null||this._heartbeatsCache.heartbeats.length===0)return"";const t=aE(),{heartbeatsToSend:r,unsentEntries:s}=MM(this._heartbeatsCache.heartbeats),i=Am(JSON.stringify({version:2,heartbeats:r}));return this._heartbeatsCache.lastSentHeartbeatDate=t,s.length>0?(this._heartbeatsCache.heartbeats=s,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),i}catch(t){return hi.warn(t),""}}}function aE(){return new Date().toISOString().substring(0,10)}function MM(n,e=OM){const t=[];let r=n.slice();for(const s of n){const i=t.find(o=>o.agent===s.agent);if(i){if(i.dates.push(s.date),lE(t)>e){i.dates.pop();break}}else if(t.push({agent:s.agent,dates:[s.date]}),lE(t)>e){t.pop();break}r=r.slice(1)}return{heartbeatsToSend:t,unsentEntries:r}}class VM{constructor(e){this.app=e,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return jp()?q0().then(()=>!0).catch(()=>!1):!1}async read(){if(await this._canUseIndexedDBPromise){const t=await PM(this.app);return t!=null&&t.heartbeats?t:{heartbeats:[]}}else return{heartbeats:[]}}async overwrite(e){if(await this._canUseIndexedDBPromise){const r=await this.read();return oE(this.app,{lastSentHeartbeatDate:e.lastSentHeartbeatDate??r.lastSentHeartbeatDate,heartbeats:e.heartbeats})}else return}async add(e){if(await this._canUseIndexedDBPromise){const r=await this.read();return oE(this.app,{lastSentHeartbeatDate:e.lastSentHeartbeatDate??r.lastSentHeartbeatDate,heartbeats:[...r.heartbeats,...e.heartbeats]})}else return}}function lE(n){return Am(JSON.stringify({version:2,heartbeats:n})).length}function FM(n){if(n.length===0)return-1;let e=0,t=n[0].date;for(let r=1;r<n.length;r++)n[r].date<t&&(t=n[r].date,e=r);return e}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function $M(n){gs(new wr("platform-logger",e=>new YL(e),"PRIVATE")),gs(new wr("heartbeat",e=>new LM(e),"PRIVATE")),_r(K_,sE,n),_r(K_,sE,"esm2020"),_r("fire-js","")}$M("");var UM="firebase",BM="12.1.0";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */_r(UM,BM,"app");const cE="@firebase/database",uE="1.1.0";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let jC="";function LC(n){jC=n}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class zM{constructor(e){this.domStorage_=e,this.prefix_="firebase:"}set(e,t){t==null?this.domStorage_.removeItem(this.prefixedName_(e)):this.domStorage_.setItem(this.prefixedName_(e),Sn(t))}get(e){const t=this.domStorage_.getItem(this.prefixedName_(e));return t==null?null:yd(t)}remove(e){this.domStorage_.removeItem(this.prefixedName_(e))}prefixedName_(e){return this.prefix_+e}toString(){return this.domStorage_.toString()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class qM{constructor(){this.cache_={},this.isInMemoryStorage=!0}set(e,t){t==null?delete this.cache_[e]:this.cache_[e]=t}get(e){return _s(this.cache_,e)?this.cache_[e]:null}remove(e){delete this.cache_[e]}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const MC=function(n){try{if(typeof window<"u"&&typeof window[n]<"u"){const e=window[n];return e.setItem("firebase:sentinel","cache"),e.removeItem("firebase:sentinel"),new zM(e)}}catch{}return new qM},ta=MC("localStorage"),J_=MC("sessionStorage");/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Pl=new Xd("@firebase/database"),VC=function(){let n=1;return function(){return n++}}(),FC=function(n){const e=CL(n),t=new EL;t.update(e);const r=t.digest();return $0.encodeByteArray(r)},eh=function(...n){let e="";for(let t=0;t<n.length;t++){const r=n[t];Array.isArray(r)||r&&typeof r=="object"&&typeof r.length=="number"?e+=eh.apply(null,r):typeof r=="object"?e+=Sn(r):e+=r,e+=" "}return e};let aa=null,dE=!0;const $C=function(n,e){Z(!e||n===!0||n===!1,"Can't turn on custom loggers persistently."),n===!0?(Pl.logLevel=We.VERBOSE,aa=Pl.log.bind(Pl),e&&J_.set("logging_enabled",!0)):typeof n=="function"?aa=n:(aa=null,J_.remove("logging_enabled"))},Dn=function(...n){if(dE===!0&&(dE=!1,aa===null&&J_.get("logging_enabled")===!0&&$C(!0)),aa){const e=eh.apply(null,n);aa(e)}},th=function(n){return function(...e){Dn(n,...e)}},X_=function(...n){const e="FIREBASE INTERNAL ERROR: "+eh(...n);Pl.error(e)},Bs=function(...n){const e=`FIREBASE FATAL ERROR: ${eh(...n)}`;throw Pl.error(e),new Error(e)},er=function(...n){const e="FIREBASE WARNING: "+eh(...n);Pl.warn(e)},WM=function(){typeof window<"u"&&window.location&&window.location.protocol&&window.location.protocol.indexOf("https:")!==-1&&er("Insecure Firebase access from a secure page. Please use https in calls to new Firebase().")},Mp=function(n){return typeof n=="number"&&(n!==n||n===Number.POSITIVE_INFINITY||n===Number.NEGATIVE_INFINITY)},GM=function(n){if(document.readyState==="complete")n();else{let e=!1;const t=function(){if(!document.body){setTimeout(t,Math.floor(10));return}e||(e=!0,n())};document.addEventListener?(document.addEventListener("DOMContentLoaded",t,!1),window.addEventListener("load",t,!1)):document.attachEvent&&(document.attachEvent("onreadystatechange",()=>{document.readyState==="complete"&&t()}),window.attachEvent("onload",t))}},po="[MIN_NAME]",fi="[MAX_NAME]",Fa=function(n,e){if(n===e)return 0;if(n===po||e===fi)return-1;if(e===po||n===fi)return 1;{const t=hE(n),r=hE(e);return t!==null?r!==null?t-r===0?n.length-e.length:t-r:-1:r!==null?1:n<e?-1:1}},HM=function(n,e){return n===e?0:n<e?-1:1},nu=function(n,e){if(e&&n in e)return e[n];throw new Error("Missing required key ("+n+") in object: "+Sn(e))},H0=function(n){if(typeof n!="object"||n===null)return Sn(n);const e=[];for(const r in n)e.push(r);e.sort();let t="{";for(let r=0;r<e.length;r++)r!==0&&(t+=","),t+=Sn(e[r]),t+=":",t+=H0(n[e[r]]);return t+="}",t},UC=function(n,e){const t=n.length;if(t<=e)return[n];const r=[];for(let s=0;s<t;s+=e)s+e>t?r.push(n.substring(s,t)):r.push(n.substring(s,s+e));return r};function Ln(n,e){for(const t in n)n.hasOwnProperty(t)&&e(t,n[t])}const BC=function(n){Z(!Mp(n),"Invalid JSON number");const e=11,t=52,r=(1<<e-1)-1;let s,i,o,a,c;n===0?(i=0,o=0,s=1/n===-1/0?1:0):(s=n<0,n=Math.abs(n),n>=Math.pow(2,1-r)?(a=Math.min(Math.floor(Math.log(n)/Math.LN2),r),i=a+r,o=Math.round(n*Math.pow(2,t-a)-Math.pow(2,t))):(i=0,o=Math.round(n/Math.pow(2,1-r-t))));const u=[];for(c=t;c;c-=1)u.push(o%2?1:0),o=Math.floor(o/2);for(c=e;c;c-=1)u.push(i%2?1:0),i=Math.floor(i/2);u.push(s?1:0),u.reverse();const h=u.join("");let f="";for(c=0;c<64;c+=8){let m=parseInt(h.substr(c,8),2).toString(16);m.length===1&&(m="0"+m),f=f+m}return f.toLowerCase()},QM=function(){return!!(typeof window=="object"&&window.chrome&&window.chrome.extension&&!/^chrome/.test(window.location.href))},KM=function(){return typeof Windows=="object"&&typeof Windows.UI=="object"};function YM(n,e){let t="Unknown Error";n==="too_big"?t="The data requested exceeds the maximum size that can be accessed with a single request.":n==="permission_denied"?t="Client doesn't have permission to access the desired data.":n==="unavailable"&&(t="The service is unavailable");const r=new Error(n+" at "+e._path.toString()+": "+t);return r.code=n.toUpperCase(),r}const JM=new RegExp("^-?(0*)\\d{1,10}$"),XM=-2147483648,ZM=2147483647,hE=function(n){if(JM.test(n)){const e=Number(n);if(e>=XM&&e<=ZM)return e}return null},bc=function(n){try{n()}catch(e){setTimeout(()=>{const t=e.stack||"";throw er("Exception was thrown by user callback.",t),e},Math.floor(0))}},e4=function(){return(typeof window=="object"&&window.navigator&&window.navigator.userAgent||"").search(/googlebot|google webmaster tools|bingbot|yahoo! slurp|baiduspider|yandexbot|duckduckbot/i)>=0},ju=function(n,e){const t=setTimeout(n,e);return typeof t=="number"&&typeof Deno<"u"&&Deno.unrefTimer?Deno.unrefTimer(t):typeof t=="object"&&t.unref&&t.unref(),t};/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class t4{constructor(e,t){this.appCheckProvider=t,this.appName=e.name,Bt(e)&&e.settings.appCheckToken&&(this.serverAppAppCheckToken=e.settings.appCheckToken),this.appCheck=t==null?void 0:t.getImmediate({optional:!0}),this.appCheck||t==null||t.get().then(r=>this.appCheck=r)}getToken(e){if(this.serverAppAppCheckToken){if(e)throw new Error("Attempted reuse of `FirebaseServerApp.appCheckToken` after previous usage failed.");return Promise.resolve({token:this.serverAppAppCheckToken})}return this.appCheck?this.appCheck.getToken(e):new Promise((t,r)=>{setTimeout(()=>{this.appCheck?this.getToken(e).then(t,r):t(null)},0)})}addTokenChangeListener(e){var t;(t=this.appCheckProvider)==null||t.get().then(r=>r.addTokenListener(e))}notifyForInvalidToken(){er(`Provided AppCheck credentials for the app named "${this.appName}" are invalid. This usually indicates your app was not initialized correctly.`)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class n4{constructor(e,t,r){this.appName_=e,this.firebaseOptions_=t,this.authProvider_=r,this.auth_=null,this.auth_=r.getImmediate({optional:!0}),this.auth_||r.onInit(s=>this.auth_=s)}getToken(e){return this.auth_?this.auth_.getToken(e).catch(t=>t&&t.code==="auth/token-not-initialized"?(Dn("Got auth/token-not-initialized error.  Treating as null token."),null):Promise.reject(t)):new Promise((t,r)=>{setTimeout(()=>{this.auth_?this.getToken(e).then(t,r):t(null)},0)})}addTokenChangeListener(e){this.auth_?this.auth_.addAuthTokenListener(e):this.authProvider_.get().then(t=>t.addAuthTokenListener(e))}removeTokenChangeListener(e){this.authProvider_.get().then(t=>t.removeAuthTokenListener(e))}notifyForInvalidToken(){let e='Provided authentication credentials for the app named "'+this.appName_+'" are invalid. This usually indicates your app was not initialized correctly. ';"credential"in this.firebaseOptions_?e+='Make sure the "credential" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':"serviceAccount"in this.firebaseOptions_?e+='Make sure the "serviceAccount" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':e+='Make sure the "apiKey" and "databaseURL" properties provided to initializeApp() match the values provided for your app at https://console.firebase.google.com/.',er(e)}}class Ol{constructor(e){this.accessToken=e}getToken(e){return Promise.resolve({accessToken:this.accessToken})}addTokenChangeListener(e){e(this.accessToken)}removeTokenChangeListener(e){}notifyForInvalidToken(){}}Ol.OWNER="owner";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Q0="5",zC="v",qC="s",WC="r",GC="f",HC=/(console\.firebase|firebase-console-\w+\.corp|firebase\.corp)\.google\.com/,QC="ls",KC="p",Z_="ac",YC="websocket",JC="long_polling";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class XC{constructor(e,t,r,s,i=!1,o="",a=!1,c=!1,u=null){this.secure=t,this.namespace=r,this.webSocketOnly=s,this.nodeAdmin=i,this.persistenceKey=o,this.includeNamespaceInQueryParams=a,this.isUsingEmulator=c,this.emulatorOptions=u,this._host=e.toLowerCase(),this._domain=this._host.substr(this._host.indexOf(".")+1),this.internalHost=ta.get("host:"+e)||this._host}isCacheableHost(){return this.internalHost.substr(0,2)==="s-"}isCustomHost(){return this._domain!=="firebaseio.com"&&this._domain!=="firebaseio-demo.com"}get host(){return this._host}set host(e){e!==this.internalHost&&(this.internalHost=e,this.isCacheableHost()&&ta.set("host:"+this._host,this.internalHost))}toString(){let e=this.toURLString();return this.persistenceKey&&(e+="<"+this.persistenceKey+">"),e}toURLString(){const e=this.secure?"https://":"http://",t=this.includeNamespaceInQueryParams?`?ns=${this.namespace}`:"";return`${e}${this.host}/${t}`}}function r4(n){return n.host!==n.internalHost||n.isCustomHost()||n.includeNamespaceInQueryParams}function ZC(n,e,t){Z(typeof e=="string","typeof type must == string"),Z(typeof t=="object","typeof params must == object");let r;if(e===YC)r=(n.secure?"wss://":"ws://")+n.internalHost+"/.ws?";else if(e===JC)r=(n.secure?"https://":"http://")+n.internalHost+"/.lp?";else throw new Error("Unknown connection type: "+e);r4(n)&&(t.ns=n.namespace);const s=[];return Ln(t,(i,o)=>{s.push(i+"="+o)}),r+s.join("&")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class s4{constructor(){this.counters_={}}incrementCounter(e,t=1){_s(this.counters_,e)||(this.counters_[e]=0),this.counters_[e]+=t}get(){return uL(this.counters_)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const by={},Ty={};function K0(n){const e=n.toString();return by[e]||(by[e]=new s4),by[e]}function i4(n,e){const t=n.toString();return Ty[t]||(Ty[t]=e()),Ty[t]}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class o4{constructor(e){this.onMessage_=e,this.pendingResponses=[],this.currentResponseNum=0,this.closeAfterResponse=-1,this.onClose=null}closeAfter(e,t){this.closeAfterResponse=e,this.onClose=t,this.closeAfterResponse<this.currentResponseNum&&(this.onClose(),this.onClose=null)}handleResponse(e,t){for(this.pendingResponses[e]=t;this.pendingResponses[this.currentResponseNum];){const r=this.pendingResponses[this.currentResponseNum];delete this.pendingResponses[this.currentResponseNum];for(let s=0;s<r.length;++s)r[s]&&bc(()=>{this.onMessage_(r[s])});if(this.currentResponseNum===this.closeAfterResponse){this.onClose&&(this.onClose(),this.onClose=null);break}this.currentResponseNum++}}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const fE="start",a4="close",l4="pLPCommand",c4="pRTLPCB",ek="id",tk="pw",nk="ser",u4="cb",d4="seg",h4="ts",f4="d",m4="dframe",rk=1870,sk=30,p4=rk-sk,g4=25e3,y4=3e4;class Gi{constructor(e,t,r,s,i,o,a){this.connId=e,this.repoInfo=t,this.applicationId=r,this.appCheckToken=s,this.authToken=i,this.transportSessionId=o,this.lastSessionId=a,this.bytesSent=0,this.bytesReceived=0,this.everConnected_=!1,this.log_=th(e),this.stats_=K0(t),this.urlFn=c=>(this.appCheckToken&&(c[Z_]=this.appCheckToken),ZC(t,JC,c))}open(e,t){this.curSegmentNum=0,this.onDisconnect_=t,this.myPacketOrderer=new o4(e),this.isClosed_=!1,this.connectTimeoutTimer_=setTimeout(()=>{this.log_("Timed out trying to connect."),this.onClosed_(),this.connectTimeoutTimer_=null},Math.floor(y4)),GM(()=>{if(this.isClosed_)return;this.scriptTagHolder=new Y0((...i)=>{const[o,a,c,u,h]=i;if(this.incrementIncomingBytes_(i),!!this.scriptTagHolder)if(this.connectTimeoutTimer_&&(clearTimeout(this.connectTimeoutTimer_),this.connectTimeoutTimer_=null),this.everConnected_=!0,o===fE)this.id=a,this.password=c;else if(o===a4)a?(this.scriptTagHolder.sendNewPolls=!1,this.myPacketOrderer.closeAfter(a,()=>{this.onClosed_()})):this.onClosed_();else throw new Error("Unrecognized command received: "+o)},(...i)=>{const[o,a]=i;this.incrementIncomingBytes_(i),this.myPacketOrderer.handleResponse(o,a)},()=>{this.onClosed_()},this.urlFn);const r={};r[fE]="t",r[nk]=Math.floor(Math.random()*1e8),this.scriptTagHolder.uniqueCallbackIdentifier&&(r[u4]=this.scriptTagHolder.uniqueCallbackIdentifier),r[zC]=Q0,this.transportSessionId&&(r[qC]=this.transportSessionId),this.lastSessionId&&(r[QC]=this.lastSessionId),this.applicationId&&(r[KC]=this.applicationId),this.appCheckToken&&(r[Z_]=this.appCheckToken),typeof location<"u"&&location.hostname&&HC.test(location.hostname)&&(r[WC]=GC);const s=this.urlFn(r);this.log_("Connecting via long-poll to "+s),this.scriptTagHolder.addTag(s,()=>{})})}start(){this.scriptTagHolder.startLongPoll(this.id,this.password),this.addDisconnectPingFrame(this.id,this.password)}static forceAllow(){Gi.forceAllow_=!0}static forceDisallow(){Gi.forceDisallow_=!0}static isAvailable(){return Gi.forceAllow_?!0:!Gi.forceDisallow_&&typeof document<"u"&&document.createElement!=null&&!QM()&&!KM()}markConnectionHealthy(){}shutdown_(){this.isClosed_=!0,this.scriptTagHolder&&(this.scriptTagHolder.close(),this.scriptTagHolder=null),this.myDisconnFrame&&(document.body.removeChild(this.myDisconnFrame),this.myDisconnFrame=null),this.connectTimeoutTimer_&&(clearTimeout(this.connectTimeoutTimer_),this.connectTimeoutTimer_=null)}onClosed_(){this.isClosed_||(this.log_("Longpoll is closing itself"),this.shutdown_(),this.onDisconnect_&&(this.onDisconnect_(this.everConnected_),this.onDisconnect_=null))}close(){this.isClosed_||(this.log_("Longpoll is being closed."),this.shutdown_())}send(e){const t=Sn(e);this.bytesSent+=t.length,this.stats_.incrementCounter("bytes_sent",t.length);const r=mC(t),s=UC(r,p4);for(let i=0;i<s.length;i++)this.scriptTagHolder.enqueueSegment(this.curSegmentNum,s.length,s[i]),this.curSegmentNum++}addDisconnectPingFrame(e,t){this.myDisconnFrame=document.createElement("iframe");const r={};r[m4]="t",r[ek]=e,r[tk]=t,this.myDisconnFrame.src=this.urlFn(r),this.myDisconnFrame.style.display="none",document.body.appendChild(this.myDisconnFrame)}incrementIncomingBytes_(e){const t=Sn(e).length;this.bytesReceived+=t,this.stats_.incrementCounter("bytes_received",t)}}class Y0{constructor(e,t,r,s){this.onDisconnect=r,this.urlFn=s,this.outstandingRequests=new Set,this.pendingSegs=[],this.currentSerial=Math.floor(Math.random()*1e8),this.sendNewPolls=!0;{this.uniqueCallbackIdentifier=VC(),window[l4+this.uniqueCallbackIdentifier]=e,window[c4+this.uniqueCallbackIdentifier]=t,this.myIFrame=Y0.createIFrame_();let i="";this.myIFrame.src&&this.myIFrame.src.substr(0,11)==="javascript:"&&(i='<script>document.domain="'+document.domain+'";<\/script>');const o="<html><body>"+i+"</body></html>";try{this.myIFrame.doc.open(),this.myIFrame.doc.write(o),this.myIFrame.doc.close()}catch(a){Dn("frame writing exception"),a.stack&&Dn(a.stack),Dn(a)}}}static createIFrame_(){const e=document.createElement("iframe");if(e.style.display="none",document.body){document.body.appendChild(e);try{e.contentWindow.document||Dn("No IE domain setting required")}catch{const r=document.domain;e.src="javascript:void((function(){document.open();document.domain='"+r+"';document.close();})())"}}else throw"Document body has not initialized. Wait to initialize Firebase until after the document is ready.";return e.contentDocument?e.doc=e.contentDocument:e.contentWindow?e.doc=e.contentWindow.document:e.document&&(e.doc=e.document),e}close(){this.alive=!1,this.myIFrame&&(this.myIFrame.doc.body.textContent="",setTimeout(()=>{this.myIFrame!==null&&(document.body.removeChild(this.myIFrame),this.myIFrame=null)},Math.floor(0)));const e=this.onDisconnect;e&&(this.onDisconnect=null,e())}startLongPoll(e,t){for(this.myID=e,this.myPW=t,this.alive=!0;this.newRequest_(););}newRequest_(){if(this.alive&&this.sendNewPolls&&this.outstandingRequests.size<(this.pendingSegs.length>0?2:1)){this.currentSerial++;const e={};e[ek]=this.myID,e[tk]=this.myPW,e[nk]=this.currentSerial;let t=this.urlFn(e),r="",s=0;for(;this.pendingSegs.length>0&&this.pendingSegs[0].d.length+sk+r.length<=rk;){const o=this.pendingSegs.shift();r=r+"&"+d4+s+"="+o.seg+"&"+h4+s+"="+o.ts+"&"+f4+s+"="+o.d,s++}return t=t+r,this.addLongPollTag_(t,this.currentSerial),!0}else return!1}enqueueSegment(e,t,r){this.pendingSegs.push({seg:e,ts:t,d:r}),this.alive&&this.newRequest_()}addLongPollTag_(e,t){this.outstandingRequests.add(t);const r=()=>{this.outstandingRequests.delete(t),this.newRequest_()},s=setTimeout(r,Math.floor(g4)),i=()=>{clearTimeout(s),r()};this.addTag(e,i)}addTag(e,t){setTimeout(()=>{try{if(!this.sendNewPolls)return;const r=this.myIFrame.doc.createElement("script");r.type="text/javascript",r.async=!0,r.src=e,r.onload=r.onreadystatechange=function(){const s=r.readyState;(!s||s==="loaded"||s==="complete")&&(r.onload=r.onreadystatechange=null,r.parentNode&&r.parentNode.removeChild(r),t())},r.onerror=()=>{Dn("Long-poll script failed to load: "+e),this.sendNewPolls=!1,this.close()},this.myIFrame.doc.body.appendChild(r)}catch{}},Math.floor(1))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const _4=16384,v4=45e3;let Dm=null;typeof MozWebSocket<"u"?Dm=MozWebSocket:typeof WebSocket<"u"&&(Dm=WebSocket);class qr{constructor(e,t,r,s,i,o,a){this.connId=e,this.applicationId=r,this.appCheckToken=s,this.authToken=i,this.keepaliveTimer=null,this.frames=null,this.totalFrames=0,this.bytesSent=0,this.bytesReceived=0,this.log_=th(this.connId),this.stats_=K0(t),this.connURL=qr.connectionURL_(t,o,a,s,r),this.nodeAdmin=t.nodeAdmin}static connectionURL_(e,t,r,s,i){const o={};return o[zC]=Q0,typeof location<"u"&&location.hostname&&HC.test(location.hostname)&&(o[WC]=GC),t&&(o[qC]=t),r&&(o[QC]=r),s&&(o[Z_]=s),i&&(o[KC]=i),ZC(e,YC,o)}open(e,t){this.onDisconnect=t,this.onMessage=e,this.log_("Websocket connecting to "+this.connURL),this.everConnected_=!1,ta.set("previous_websocket_failure",!0);try{let r;EC(),this.mySock=new Dm(this.connURL,[],r)}catch(r){this.log_("Error instantiating WebSocket.");const s=r.message||r.data;s&&this.log_(s),this.onClosed_();return}this.mySock.onopen=()=>{this.log_("Websocket connected."),this.everConnected_=!0},this.mySock.onclose=()=>{this.log_("Websocket connection was disconnected."),this.mySock=null,this.onClosed_()},this.mySock.onmessage=r=>{this.handleIncomingFrame(r)},this.mySock.onerror=r=>{this.log_("WebSocket error.  Closing connection.");const s=r.message||r.data;s&&this.log_(s),this.onClosed_()}}start(){}static forceDisallow(){qr.forceDisallow_=!0}static isAvailable(){let e=!1;if(typeof navigator<"u"&&navigator.userAgent){const t=/Android ([0-9]{0,}\.[0-9]{0,})/,r=navigator.userAgent.match(t);r&&r.length>1&&parseFloat(r[1])<4.4&&(e=!0)}return!e&&Dm!==null&&!qr.forceDisallow_}static previouslyFailed(){return ta.isInMemoryStorage||ta.get("previous_websocket_failure")===!0}markConnectionHealthy(){ta.remove("previous_websocket_failure")}appendFrame_(e){if(this.frames.push(e),this.frames.length===this.totalFrames){const t=this.frames.join("");this.frames=null;const r=yd(t);this.onMessage(r)}}handleNewFrameCount_(e){this.totalFrames=e,this.frames=[]}extractFrameCount_(e){if(Z(this.frames===null,"We already have a frame buffer"),e.length<=6){const t=Number(e);if(!isNaN(t))return this.handleNewFrameCount_(t),null}return this.handleNewFrameCount_(1),e}handleIncomingFrame(e){if(this.mySock===null)return;const t=e.data;if(this.bytesReceived+=t.length,this.stats_.incrementCounter("bytes_received",t.length),this.resetKeepAlive(),this.frames!==null)this.appendFrame_(t);else{const r=this.extractFrameCount_(t);r!==null&&this.appendFrame_(r)}}send(e){this.resetKeepAlive();const t=Sn(e);this.bytesSent+=t.length,this.stats_.incrementCounter("bytes_sent",t.length);const r=UC(t,_4);r.length>1&&this.sendString_(String(r.length));for(let s=0;s<r.length;s++)this.sendString_(r[s])}shutdown_(){this.isClosed_=!0,this.keepaliveTimer&&(clearInterval(this.keepaliveTimer),this.keepaliveTimer=null),this.mySock&&(this.mySock.close(),this.mySock=null)}onClosed_(){this.isClosed_||(this.log_("WebSocket is closing itself"),this.shutdown_(),this.onDisconnect&&(this.onDisconnect(this.everConnected_),this.onDisconnect=null))}close(){this.isClosed_||(this.log_("WebSocket is being closed"),this.shutdown_())}resetKeepAlive(){clearInterval(this.keepaliveTimer),this.keepaliveTimer=setInterval(()=>{this.mySock&&this.sendString_("0"),this.resetKeepAlive()},Math.floor(v4))}sendString_(e){try{this.mySock.send(e)}catch(t){this.log_("Exception thrown from WebSocket.send():",t.message||t.data,"Closing connection."),setTimeout(this.onClosed_.bind(this),0)}}}qr.responsesRequiredToBeHealthy=2;qr.healthyTimeout=3e4;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ql{static get ALL_TRANSPORTS(){return[Gi,qr]}static get IS_TRANSPORT_INITIALIZED(){return this.globalTransportInitialized_}constructor(e){this.initTransports_(e)}initTransports_(e){const t=qr&&qr.isAvailable();let r=t&&!qr.previouslyFailed();if(e.webSocketOnly&&(t||er("wss:// URL used, but browser isn't known to support websockets.  Trying anyway."),r=!0),r)this.transports_=[qr];else{const s=this.transports_=[];for(const i of Ql.ALL_TRANSPORTS)i&&i.isAvailable()&&s.push(i);Ql.globalTransportInitialized_=!0}}initialTransport(){if(this.transports_.length>0)return this.transports_[0];throw new Error("No transports available")}upgradeTransport(){return this.transports_.length>1?this.transports_[1]:null}}Ql.globalTransportInitialized_=!1;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const w4=6e4,x4=5e3,S4=10*1024,I4=100*1024,Ay="t",mE="d",E4="s",pE="r",b4="e",gE="o",yE="a",_E="n",vE="p",T4="h";class A4{constructor(e,t,r,s,i,o,a,c,u,h){this.id=e,this.repoInfo_=t,this.applicationId_=r,this.appCheckToken_=s,this.authToken_=i,this.onMessage_=o,this.onReady_=a,this.onDisconnect_=c,this.onKill_=u,this.lastSessionId=h,this.connectionCount=0,this.pendingDataMessages=[],this.state_=0,this.log_=th("c:"+this.id+":"),this.transportManager_=new Ql(t),this.log_("Connection created"),this.start_()}start_(){const e=this.transportManager_.initialTransport();this.conn_=new e(this.nextTransportId_(),this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,null,this.lastSessionId),this.primaryResponsesRequired_=e.responsesRequiredToBeHealthy||0;const t=this.connReceiver_(this.conn_),r=this.disconnReceiver_(this.conn_);this.tx_=this.conn_,this.rx_=this.conn_,this.secondaryConn_=null,this.isHealthy_=!1,setTimeout(()=>{this.conn_&&this.conn_.open(t,r)},Math.floor(0));const s=e.healthyTimeout||0;s>0&&(this.healthyTimeout_=ju(()=>{this.healthyTimeout_=null,this.isHealthy_||(this.conn_&&this.conn_.bytesReceived>I4?(this.log_("Connection exceeded healthy timeout but has received "+this.conn_.bytesReceived+" bytes.  Marking connection healthy."),this.isHealthy_=!0,this.conn_.markConnectionHealthy()):this.conn_&&this.conn_.bytesSent>S4?this.log_("Connection exceeded healthy timeout but has sent "+this.conn_.bytesSent+" bytes.  Leaving connection alive."):(this.log_("Closing unhealthy connection after timeout."),this.close()))},Math.floor(s)))}nextTransportId_(){return"c:"+this.id+":"+this.connectionCount++}disconnReceiver_(e){return t=>{e===this.conn_?this.onConnectionLost_(t):e===this.secondaryConn_?(this.log_("Secondary connection lost."),this.onSecondaryConnectionLost_()):this.log_("closing an old connection")}}connReceiver_(e){return t=>{this.state_!==2&&(e===this.rx_?this.onPrimaryMessageReceived_(t):e===this.secondaryConn_?this.onSecondaryMessageReceived_(t):this.log_("message on old connection"))}}sendRequest(e){const t={t:"d",d:e};this.sendData_(t)}tryCleanupConnection(){this.tx_===this.secondaryConn_&&this.rx_===this.secondaryConn_&&(this.log_("cleaning up and promoting a connection: "+this.secondaryConn_.connId),this.conn_=this.secondaryConn_,this.secondaryConn_=null)}onSecondaryControl_(e){if(Ay in e){const t=e[Ay];t===yE?this.upgradeIfSecondaryHealthy_():t===pE?(this.log_("Got a reset on secondary, closing it"),this.secondaryConn_.close(),(this.tx_===this.secondaryConn_||this.rx_===this.secondaryConn_)&&this.close()):t===gE&&(this.log_("got pong on secondary."),this.secondaryResponsesRequired_--,this.upgradeIfSecondaryHealthy_())}}onSecondaryMessageReceived_(e){const t=nu("t",e),r=nu("d",e);if(t==="c")this.onSecondaryControl_(r);else if(t==="d")this.pendingDataMessages.push(r);else throw new Error("Unknown protocol layer: "+t)}upgradeIfSecondaryHealthy_(){this.secondaryResponsesRequired_<=0?(this.log_("Secondary connection is healthy."),this.isHealthy_=!0,this.secondaryConn_.markConnectionHealthy(),this.proceedWithUpgrade_()):(this.log_("sending ping on secondary."),this.secondaryConn_.send({t:"c",d:{t:vE,d:{}}}))}proceedWithUpgrade_(){this.secondaryConn_.start(),this.log_("sending client ack on secondary"),this.secondaryConn_.send({t:"c",d:{t:yE,d:{}}}),this.log_("Ending transmission on primary"),this.conn_.send({t:"c",d:{t:_E,d:{}}}),this.tx_=this.secondaryConn_,this.tryCleanupConnection()}onPrimaryMessageReceived_(e){const t=nu("t",e),r=nu("d",e);t==="c"?this.onControl_(r):t==="d"&&this.onDataMessage_(r)}onDataMessage_(e){this.onPrimaryResponse_(),this.onMessage_(e)}onPrimaryResponse_(){this.isHealthy_||(this.primaryResponsesRequired_--,this.primaryResponsesRequired_<=0&&(this.log_("Primary connection is healthy."),this.isHealthy_=!0,this.conn_.markConnectionHealthy()))}onControl_(e){const t=nu(Ay,e);if(mE in e){const r=e[mE];if(t===T4){const s={...r};this.repoInfo_.isUsingEmulator&&(s.h=this.repoInfo_.host),this.onHandshake_(s)}else if(t===_E){this.log_("recvd end transmission on primary"),this.rx_=this.secondaryConn_;for(let s=0;s<this.pendingDataMessages.length;++s)this.onDataMessage_(this.pendingDataMessages[s]);this.pendingDataMessages=[],this.tryCleanupConnection()}else t===E4?this.onConnectionShutdown_(r):t===pE?this.onReset_(r):t===b4?X_("Server Error: "+r):t===gE?(this.log_("got pong on primary."),this.onPrimaryResponse_(),this.sendPingOnPrimaryIfNecessary_()):X_("Unknown control packet command: "+t)}}onHandshake_(e){const t=e.ts,r=e.v,s=e.h;this.sessionId=e.s,this.repoInfo_.host=s,this.state_===0&&(this.conn_.start(),this.onConnectionEstablished_(this.conn_,t),Q0!==r&&er("Protocol version mismatch detected"),this.tryStartUpgrade_())}tryStartUpgrade_(){const e=this.transportManager_.upgradeTransport();e&&this.startUpgrade_(e)}startUpgrade_(e){this.secondaryConn_=new e(this.nextTransportId_(),this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,this.sessionId),this.secondaryResponsesRequired_=e.responsesRequiredToBeHealthy||0;const t=this.connReceiver_(this.secondaryConn_),r=this.disconnReceiver_(this.secondaryConn_);this.secondaryConn_.open(t,r),ju(()=>{this.secondaryConn_&&(this.log_("Timed out trying to upgrade."),this.secondaryConn_.close())},Math.floor(w4))}onReset_(e){this.log_("Reset packet received.  New host: "+e),this.repoInfo_.host=e,this.state_===1?this.close():(this.closeConnections_(),this.start_())}onConnectionEstablished_(e,t){this.log_("Realtime connection established."),this.conn_=e,this.state_=1,this.onReady_&&(this.onReady_(t,this.sessionId),this.onReady_=null),this.primaryResponsesRequired_===0?(this.log_("Primary connection is healthy."),this.isHealthy_=!0):ju(()=>{this.sendPingOnPrimaryIfNecessary_()},Math.floor(x4))}sendPingOnPrimaryIfNecessary_(){!this.isHealthy_&&this.state_===1&&(this.log_("sending ping on primary."),this.sendData_({t:"c",d:{t:vE,d:{}}}))}onSecondaryConnectionLost_(){const e=this.secondaryConn_;this.secondaryConn_=null,(this.tx_===e||this.rx_===e)&&this.close()}onConnectionLost_(e){this.conn_=null,!e&&this.state_===0?(this.log_("Realtime connection failed."),this.repoInfo_.isCacheableHost()&&(ta.remove("host:"+this.repoInfo_.host),this.repoInfo_.internalHost=this.repoInfo_.host)):this.state_===1&&this.log_("Realtime connection lost."),this.close()}onConnectionShutdown_(e){this.log_("Connection shutdown command received. Shutting down..."),this.onKill_&&(this.onKill_(e),this.onKill_=null),this.onDisconnect_=null,this.close()}sendData_(e){if(this.state_!==1)throw"Connection is not connected";this.tx_.send(e)}close(){this.state_!==2&&(this.log_("Closing realtime connection."),this.state_=2,this.closeConnections_(),this.onDisconnect_&&(this.onDisconnect_(),this.onDisconnect_=null))}closeConnections_(){this.log_("Shutting down all connections"),this.conn_&&(this.conn_.close(),this.conn_=null),this.secondaryConn_&&(this.secondaryConn_.close(),this.secondaryConn_=null),this.healthyTimeout_&&(clearTimeout(this.healthyTimeout_),this.healthyTimeout_=null)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ik{put(e,t,r,s){}merge(e,t,r,s){}refreshAuthToken(e){}refreshAppCheckToken(e){}onDisconnectPut(e,t,r){}onDisconnectMerge(e,t,r){}onDisconnectCancel(e,t){}reportStats(e){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ok{constructor(e){this.allowedEvents_=e,this.listeners_={},Z(Array.isArray(e)&&e.length>0,"Requires a non-empty array")}trigger(e,...t){if(Array.isArray(this.listeners_[e])){const r=[...this.listeners_[e]];for(let s=0;s<r.length;s++)r[s].callback.apply(r[s].context,t)}}on(e,t,r){this.validateEventType_(e),this.listeners_[e]=this.listeners_[e]||[],this.listeners_[e].push({callback:t,context:r});const s=this.getInitialEvent(e);s&&t.apply(r,s)}off(e,t,r){this.validateEventType_(e);const s=this.listeners_[e]||[];for(let i=0;i<s.length;i++)if(s[i].callback===t&&(!r||r===s[i].context)){s.splice(i,1);return}}validateEventType_(e){Z(this.allowedEvents_.find(t=>t===e),"Unknown event: "+e)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Pm extends ok{static getInstance(){return new Pm}constructor(){super(["online"]),this.online_=!0,typeof window<"u"&&typeof window.addEventListener<"u"&&!B0()&&(window.addEventListener("online",()=>{this.online_||(this.online_=!0,this.trigger("online",!0))},!1),window.addEventListener("offline",()=>{this.online_&&(this.online_=!1,this.trigger("online",!1))},!1))}getInitialEvent(e){return Z(e==="online","Unknown event type: "+e),[this.online_]}currentlyOnline(){return this.online_}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const wE=32,xE=768;class ct{constructor(e,t){if(t===void 0){this.pieces_=e.split("/");let r=0;for(let s=0;s<this.pieces_.length;s++)this.pieces_[s].length>0&&(this.pieces_[r]=this.pieces_[s],r++);this.pieces_.length=r,this.pieceNum_=0}else this.pieces_=e,this.pieceNum_=t}toString(){let e="";for(let t=this.pieceNum_;t<this.pieces_.length;t++)this.pieces_[t]!==""&&(e+="/"+this.pieces_[t]);return e||"/"}}function rt(){return new ct("")}function $e(n){return n.pieceNum_>=n.pieces_.length?null:n.pieces_[n.pieceNum_]}function go(n){return n.pieces_.length-n.pieceNum_}function St(n){let e=n.pieceNum_;return e<n.pieces_.length&&e++,new ct(n.pieces_,e)}function J0(n){return n.pieceNum_<n.pieces_.length?n.pieces_[n.pieces_.length-1]:null}function C4(n){let e="";for(let t=n.pieceNum_;t<n.pieces_.length;t++)n.pieces_[t]!==""&&(e+="/"+encodeURIComponent(String(n.pieces_[t])));return e||"/"}function wd(n,e=0){return n.pieces_.slice(n.pieceNum_+e)}function ak(n){if(n.pieceNum_>=n.pieces_.length)return null;const e=[];for(let t=n.pieceNum_;t<n.pieces_.length-1;t++)e.push(n.pieces_[t]);return new ct(e,0)}function zt(n,e){const t=[];for(let r=n.pieceNum_;r<n.pieces_.length;r++)t.push(n.pieces_[r]);if(e instanceof ct)for(let r=e.pieceNum_;r<e.pieces_.length;r++)t.push(e.pieces_[r]);else{const r=e.split("/");for(let s=0;s<r.length;s++)r[s].length>0&&t.push(r[s])}return new ct(t,0)}function Ue(n){return n.pieceNum_>=n.pieces_.length}function ir(n,e){const t=$e(n),r=$e(e);if(t===null)return e;if(t===r)return ir(St(n),St(e));throw new Error("INTERNAL ERROR: innerPath ("+e+") is not within outerPath ("+n+")")}function k4(n,e){const t=wd(n,0),r=wd(e,0);for(let s=0;s<t.length&&s<r.length;s++){const i=Fa(t[s],r[s]);if(i!==0)return i}return t.length===r.length?0:t.length<r.length?-1:1}function X0(n,e){if(go(n)!==go(e))return!1;for(let t=n.pieceNum_,r=e.pieceNum_;t<=n.pieces_.length;t++,r++)if(n.pieces_[t]!==e.pieces_[r])return!1;return!0}function Gr(n,e){let t=n.pieceNum_,r=e.pieceNum_;if(go(n)>go(e))return!1;for(;t<n.pieces_.length;){if(n.pieces_[t]!==e.pieces_[r])return!1;++t,++r}return!0}class N4{constructor(e,t){this.errorPrefix_=t,this.parts_=wd(e,0),this.byteLength_=Math.max(1,this.parts_.length);for(let r=0;r<this.parts_.length;r++)this.byteLength_+=Lp(this.parts_[r]);lk(this)}}function R4(n,e){n.parts_.length>0&&(n.byteLength_+=1),n.parts_.push(e),n.byteLength_+=Lp(e),lk(n)}function D4(n){const e=n.parts_.pop();n.byteLength_-=Lp(e),n.parts_.length>0&&(n.byteLength_-=1)}function lk(n){if(n.byteLength_>xE)throw new Error(n.errorPrefix_+"has a key path longer than "+xE+" bytes ("+n.byteLength_+").");if(n.parts_.length>wE)throw new Error(n.errorPrefix_+"path specified exceeds the maximum depth that can be written ("+wE+") or object contains a cycle "+qo(n))}function qo(n){return n.parts_.length===0?"":"in property '"+n.parts_.join(".")+"'"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Z0 extends ok{static getInstance(){return new Z0}constructor(){super(["visible"]);let e,t;typeof document<"u"&&typeof document.addEventListener<"u"&&(typeof document.hidden<"u"?(t="visibilitychange",e="hidden"):typeof document.mozHidden<"u"?(t="mozvisibilitychange",e="mozHidden"):typeof document.msHidden<"u"?(t="msvisibilitychange",e="msHidden"):typeof document.webkitHidden<"u"&&(t="webkitvisibilitychange",e="webkitHidden")),this.visible_=!0,t&&document.addEventListener(t,()=>{const r=!document[e];r!==this.visible_&&(this.visible_=r,this.trigger("visible",r))},!1)}getInitialEvent(e){return Z(e==="visible","Unknown event type: "+e),[this.visible_]}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ru=1e3,P4=60*5*1e3,SE=30*1e3,O4=1.3,j4=3e4,L4="server_kill",IE=3;class Qr extends ik{constructor(e,t,r,s,i,o,a,c){if(super(),this.repoInfo_=e,this.applicationId_=t,this.onDataUpdate_=r,this.onConnectStatus_=s,this.onServerInfoUpdate_=i,this.authTokenProvider_=o,this.appCheckTokenProvider_=a,this.authOverride_=c,this.id=Qr.nextPersistentConnectionId_++,this.log_=th("p:"+this.id+":"),this.interruptReasons_={},this.listens=new Map,this.outstandingPuts_=[],this.outstandingGets_=[],this.outstandingPutCount_=0,this.outstandingGetCount_=0,this.onDisconnectRequestQueue_=[],this.connected_=!1,this.reconnectDelay_=ru,this.maxReconnectDelay_=P4,this.securityDebugCallback_=null,this.lastSessionId=null,this.establishConnectionTimer_=null,this.visible_=!1,this.requestCBHash_={},this.requestNumber_=0,this.realtime_=null,this.authToken_=null,this.appCheckToken_=null,this.forceTokenRefresh_=!1,this.invalidAuthTokenCount_=0,this.invalidAppCheckTokenCount_=0,this.firstConnection_=!0,this.lastConnectionAttemptTime_=null,this.lastConnectionEstablishedTime_=null,c&&!EC())throw new Error("Auth override specified in options, but not supported on non Node.js platforms");Z0.getInstance().on("visible",this.onVisible_,this),e.host.indexOf("fblocal")===-1&&Pm.getInstance().on("online",this.onOnline_,this)}sendRequest(e,t,r){const s=++this.requestNumber_,i={r:s,a:e,b:t};this.log_(Sn(i)),Z(this.connected_,"sendRequest call when we're not connected not allowed."),this.realtime_.sendRequest(i),r&&(this.requestCBHash_[s]=r)}get(e){this.initConnection_();const t=new Ar,s={action:"g",request:{p:e._path.toString(),q:e._queryObject},onComplete:o=>{const a=o.d;o.s==="ok"?t.resolve(a):t.reject(a)}};this.outstandingGets_.push(s),this.outstandingGetCount_++;const i=this.outstandingGets_.length-1;return this.connected_&&this.sendGet_(i),t.promise}listen(e,t,r,s){this.initConnection_();const i=e._queryIdentifier,o=e._path.toString();this.log_("Listen called for "+o+" "+i),this.listens.has(o)||this.listens.set(o,new Map),Z(e._queryParams.isDefault()||!e._queryParams.loadsAllData(),"listen() called for non-default but complete query"),Z(!this.listens.get(o).has(i),"listen() called twice for same path/queryId.");const a={onComplete:s,hashFn:t,query:e,tag:r};this.listens.get(o).set(i,a),this.connected_&&this.sendListen_(a)}sendGet_(e){const t=this.outstandingGets_[e];this.sendRequest("g",t.request,r=>{delete this.outstandingGets_[e],this.outstandingGetCount_--,this.outstandingGetCount_===0&&(this.outstandingGets_=[]),t.onComplete&&t.onComplete(r)})}sendListen_(e){const t=e.query,r=t._path.toString(),s=t._queryIdentifier;this.log_("Listen on "+r+" for "+s);const i={p:r},o="q";e.tag&&(i.q=t._queryObject,i.t=e.tag),i.h=e.hashFn(),this.sendRequest(o,i,a=>{const c=a.d,u=a.s;Qr.warnOnListenWarnings_(c,t),(this.listens.get(r)&&this.listens.get(r).get(s))===e&&(this.log_("listen response",a),u!=="ok"&&this.removeListen_(r,s),e.onComplete&&e.onComplete(u,c))})}static warnOnListenWarnings_(e,t){if(e&&typeof e=="object"&&_s(e,"w")){const r=ya(e,"w");if(Array.isArray(r)&&~r.indexOf("no_index")){const s='".indexOn": "'+t._queryParams.getIndex().toString()+'"',i=t._path.toString();er(`Using an unspecified index. Your data will be downloaded and filtered on the client. Consider adding ${s} at ${i} to your security rules for better performance.`)}}}refreshAuthToken(e){this.authToken_=e,this.log_("Auth token refreshed"),this.authToken_?this.tryAuth():this.connected_&&this.sendRequest("unauth",{},()=>{}),this.reduceReconnectDelayIfAdminCredential_(e)}reduceReconnectDelayIfAdminCredential_(e){(e&&e.length===40||IL(e))&&(this.log_("Admin auth credential detected.  Reducing max reconnect time."),this.maxReconnectDelay_=SE)}refreshAppCheckToken(e){this.appCheckToken_=e,this.log_("App check token refreshed"),this.appCheckToken_?this.tryAppCheck():this.connected_&&this.sendRequest("unappeck",{},()=>{})}tryAuth(){if(this.connected_&&this.authToken_){const e=this.authToken_,t=SL(e)?"auth":"gauth",r={cred:e};this.authOverride_===null?r.noauth=!0:typeof this.authOverride_=="object"&&(r.authvar=this.authOverride_),this.sendRequest(t,r,s=>{const i=s.s,o=s.d||"error";this.authToken_===e&&(i==="ok"?this.invalidAuthTokenCount_=0:this.onAuthRevoked_(i,o))})}}tryAppCheck(){this.connected_&&this.appCheckToken_&&this.sendRequest("appcheck",{token:this.appCheckToken_},e=>{const t=e.s,r=e.d||"error";t==="ok"?this.invalidAppCheckTokenCount_=0:this.onAppCheckRevoked_(t,r)})}unlisten(e,t){const r=e._path.toString(),s=e._queryIdentifier;this.log_("Unlisten called for "+r+" "+s),Z(e._queryParams.isDefault()||!e._queryParams.loadsAllData(),"unlisten() called for non-default but complete query"),this.removeListen_(r,s)&&this.connected_&&this.sendUnlisten_(r,s,e._queryObject,t)}sendUnlisten_(e,t,r,s){this.log_("Unlisten on "+e+" for "+t);const i={p:e},o="n";s&&(i.q=r,i.t=s),this.sendRequest(o,i)}onDisconnectPut(e,t,r){this.initConnection_(),this.connected_?this.sendOnDisconnect_("o",e,t,r):this.onDisconnectRequestQueue_.push({pathString:e,action:"o",data:t,onComplete:r})}onDisconnectMerge(e,t,r){this.initConnection_(),this.connected_?this.sendOnDisconnect_("om",e,t,r):this.onDisconnectRequestQueue_.push({pathString:e,action:"om",data:t,onComplete:r})}onDisconnectCancel(e,t){this.initConnection_(),this.connected_?this.sendOnDisconnect_("oc",e,null,t):this.onDisconnectRequestQueue_.push({pathString:e,action:"oc",data:null,onComplete:t})}sendOnDisconnect_(e,t,r,s){const i={p:t,d:r};this.log_("onDisconnect "+e,i),this.sendRequest(e,i,o=>{s&&setTimeout(()=>{s(o.s,o.d)},Math.floor(0))})}put(e,t,r,s){this.putInternal("p",e,t,r,s)}merge(e,t,r,s){this.putInternal("m",e,t,r,s)}putInternal(e,t,r,s,i){this.initConnection_();const o={p:t,d:r};i!==void 0&&(o.h=i),this.outstandingPuts_.push({action:e,request:o,onComplete:s}),this.outstandingPutCount_++;const a=this.outstandingPuts_.length-1;this.connected_?this.sendPut_(a):this.log_("Buffering put: "+t)}sendPut_(e){const t=this.outstandingPuts_[e].action,r=this.outstandingPuts_[e].request,s=this.outstandingPuts_[e].onComplete;this.outstandingPuts_[e].queued=this.connected_,this.sendRequest(t,r,i=>{this.log_(t+" response",i),delete this.outstandingPuts_[e],this.outstandingPutCount_--,this.outstandingPutCount_===0&&(this.outstandingPuts_=[]),s&&s(i.s,i.d)})}reportStats(e){if(this.connected_){const t={c:e};this.log_("reportStats",t),this.sendRequest("s",t,r=>{if(r.s!=="ok"){const i=r.d;this.log_("reportStats","Error sending stats: "+i)}})}}onDataMessage_(e){if("r"in e){this.log_("from server: "+Sn(e));const t=e.r,r=this.requestCBHash_[t];r&&(delete this.requestCBHash_[t],r(e.b))}else{if("error"in e)throw"A server-side error has occurred: "+e.error;"a"in e&&this.onDataPush_(e.a,e.b)}}onDataPush_(e,t){this.log_("handleServerMessage",e,t),e==="d"?this.onDataUpdate_(t.p,t.d,!1,t.t):e==="m"?this.onDataUpdate_(t.p,t.d,!0,t.t):e==="c"?this.onListenRevoked_(t.p,t.q):e==="ac"?this.onAuthRevoked_(t.s,t.d):e==="apc"?this.onAppCheckRevoked_(t.s,t.d):e==="sd"?this.onSecurityDebugPacket_(t):X_("Unrecognized action received from server: "+Sn(e)+`
Are you using the latest client?`)}onReady_(e,t){this.log_("connection ready"),this.connected_=!0,this.lastConnectionEstablishedTime_=new Date().getTime(),this.handleTimestamp_(e),this.lastSessionId=t,this.firstConnection_&&this.sendConnectStats_(),this.restoreState_(),this.firstConnection_=!1,this.onConnectStatus_(!0)}scheduleConnect_(e){Z(!this.realtime_,"Scheduling a connect when we're already connected/ing?"),this.establishConnectionTimer_&&clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=setTimeout(()=>{this.establishConnectionTimer_=null,this.establishConnection_()},Math.floor(e))}initConnection_(){!this.realtime_&&this.firstConnection_&&this.scheduleConnect_(0)}onVisible_(e){e&&!this.visible_&&this.reconnectDelay_===this.maxReconnectDelay_&&(this.log_("Window became visible.  Reducing delay."),this.reconnectDelay_=ru,this.realtime_||this.scheduleConnect_(0)),this.visible_=e}onOnline_(e){e?(this.log_("Browser went online."),this.reconnectDelay_=ru,this.realtime_||this.scheduleConnect_(0)):(this.log_("Browser went offline.  Killing connection."),this.realtime_&&this.realtime_.close())}onRealtimeDisconnect_(){if(this.log_("data client disconnected"),this.connected_=!1,this.realtime_=null,this.cancelSentTransactions_(),this.requestCBHash_={},this.shouldReconnect_()){this.visible_?this.lastConnectionEstablishedTime_&&(new Date().getTime()-this.lastConnectionEstablishedTime_>j4&&(this.reconnectDelay_=ru),this.lastConnectionEstablishedTime_=null):(this.log_("Window isn't visible.  Delaying reconnect."),this.reconnectDelay_=this.maxReconnectDelay_,this.lastConnectionAttemptTime_=new Date().getTime());const e=Math.max(0,new Date().getTime()-this.lastConnectionAttemptTime_);let t=Math.max(0,this.reconnectDelay_-e);t=Math.random()*t,this.log_("Trying to reconnect in "+t+"ms"),this.scheduleConnect_(t),this.reconnectDelay_=Math.min(this.maxReconnectDelay_,this.reconnectDelay_*O4)}this.onConnectStatus_(!1)}async establishConnection_(){if(this.shouldReconnect_()){this.log_("Making a connection attempt"),this.lastConnectionAttemptTime_=new Date().getTime(),this.lastConnectionEstablishedTime_=null;const e=this.onDataMessage_.bind(this),t=this.onReady_.bind(this),r=this.onRealtimeDisconnect_.bind(this),s=this.id+":"+Qr.nextConnectionId_++,i=this.lastSessionId;let o=!1,a=null;const c=function(){a?a.close():(o=!0,r())},u=function(f){Z(a,"sendRequest call when we're not connected not allowed."),a.sendRequest(f)};this.realtime_={close:c,sendRequest:u};const h=this.forceTokenRefresh_;this.forceTokenRefresh_=!1;try{const[f,m]=await Promise.all([this.authTokenProvider_.getToken(h),this.appCheckTokenProvider_.getToken(h)]);o?Dn("getToken() completed but was canceled"):(Dn("getToken() completed. Creating connection."),this.authToken_=f&&f.accessToken,this.appCheckToken_=m&&m.token,a=new A4(s,this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,e,t,r,y=>{er(y+" ("+this.repoInfo_.toString()+")"),this.interrupt(L4)},i))}catch(f){this.log_("Failed to get token: "+f),o||(this.repoInfo_.nodeAdmin&&er(f),c())}}}interrupt(e){Dn("Interrupting connection for reason: "+e),this.interruptReasons_[e]=!0,this.realtime_?this.realtime_.close():(this.establishConnectionTimer_&&(clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=null),this.connected_&&this.onRealtimeDisconnect_())}resume(e){Dn("Resuming connection for reason: "+e),delete this.interruptReasons_[e],km(this.interruptReasons_)&&(this.reconnectDelay_=ru,this.realtime_||this.scheduleConnect_(0))}handleTimestamp_(e){const t=e-new Date().getTime();this.onServerInfoUpdate_({serverTimeOffset:t})}cancelSentTransactions_(){for(let e=0;e<this.outstandingPuts_.length;e++){const t=this.outstandingPuts_[e];t&&"h"in t.request&&t.queued&&(t.onComplete&&t.onComplete("disconnect"),delete this.outstandingPuts_[e],this.outstandingPutCount_--)}this.outstandingPutCount_===0&&(this.outstandingPuts_=[])}onListenRevoked_(e,t){let r;t?r=t.map(i=>H0(i)).join("$"):r="default";const s=this.removeListen_(e,r);s&&s.onComplete&&s.onComplete("permission_denied")}removeListen_(e,t){const r=new ct(e).toString();let s;if(this.listens.has(r)){const i=this.listens.get(r);s=i.get(t),i.delete(t),i.size===0&&this.listens.delete(r)}else s=void 0;return s}onAuthRevoked_(e,t){Dn("Auth token revoked: "+e+"/"+t),this.authToken_=null,this.forceTokenRefresh_=!0,this.realtime_.close(),(e==="invalid_token"||e==="permission_denied")&&(this.invalidAuthTokenCount_++,this.invalidAuthTokenCount_>=IE&&(this.reconnectDelay_=SE,this.authTokenProvider_.notifyForInvalidToken()))}onAppCheckRevoked_(e,t){Dn("App check token revoked: "+e+"/"+t),this.appCheckToken_=null,this.forceTokenRefresh_=!0,(e==="invalid_token"||e==="permission_denied")&&(this.invalidAppCheckTokenCount_++,this.invalidAppCheckTokenCount_>=IE&&this.appCheckTokenProvider_.notifyForInvalidToken())}onSecurityDebugPacket_(e){this.securityDebugCallback_?this.securityDebugCallback_(e):"msg"in e&&console.log("FIREBASE: "+e.msg.replace(`
`,`
FIREBASE: `))}restoreState_(){this.tryAuth(),this.tryAppCheck();for(const e of this.listens.values())for(const t of e.values())this.sendListen_(t);for(let e=0;e<this.outstandingPuts_.length;e++)this.outstandingPuts_[e]&&this.sendPut_(e);for(;this.onDisconnectRequestQueue_.length;){const e=this.onDisconnectRequestQueue_.shift();this.sendOnDisconnect_(e.action,e.pathString,e.data,e.onComplete)}for(let e=0;e<this.outstandingGets_.length;e++)this.outstandingGets_[e]&&this.sendGet_(e)}sendConnectStats_(){const e={};let t="js";e["sdk."+t+"."+jC.replace(/\./g,"-")]=1,B0()?e["framework.cordova"]=1:IC()&&(e["framework.reactnative"]=1),this.reportStats(e)}shouldReconnect_(){const e=Pm.getInstance().currentlyOnline();return km(this.interruptReasons_)&&e}}Qr.nextPersistentConnectionId_=0;Qr.nextConnectionId_=0;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Be{constructor(e,t){this.name=e,this.node=t}static Wrap(e,t){return new Be(e,t)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Vp{getCompare(){return this.compare.bind(this)}indexedValueChanged(e,t){const r=new Be(po,e),s=new Be(po,t);return this.compare(r,s)!==0}minPost(){return Be.MIN}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let cf;class ck extends Vp{static get __EMPTY_NODE(){return cf}static set __EMPTY_NODE(e){cf=e}compare(e,t){return Fa(e.name,t.name)}isDefinedOn(e){throw Ec("KeyIndex.isDefinedOn not expected to be called.")}indexedValueChanged(e,t){return!1}minPost(){return Be.MIN}maxPost(){return new Be(fi,cf)}makePost(e,t){return Z(typeof e=="string","KeyIndex indexValue must always be a string."),new Be(e,cf)}toString(){return".key"}}const Ls=new ck;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let uf=class{constructor(e,t,r,s,i=null){this.isReverse_=s,this.resultGenerator_=i,this.nodeStack_=[];let o=1;for(;!e.isEmpty();)if(e=e,o=t?r(e.key,t):1,s&&(o*=-1),o<0)this.isReverse_?e=e.left:e=e.right;else if(o===0){this.nodeStack_.push(e);break}else this.nodeStack_.push(e),this.isReverse_?e=e.right:e=e.left}getNext(){if(this.nodeStack_.length===0)return null;let e=this.nodeStack_.pop(),t;if(this.resultGenerator_?t=this.resultGenerator_(e.key,e.value):t={key:e.key,value:e.value},this.isReverse_)for(e=e.left;!e.isEmpty();)this.nodeStack_.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack_.push(e),e=e.left;return t}hasNext(){return this.nodeStack_.length>0}peek(){if(this.nodeStack_.length===0)return null;const e=this.nodeStack_[this.nodeStack_.length-1];return this.resultGenerator_?this.resultGenerator_(e.key,e.value):{key:e.key,value:e.value}}},br=class vu{constructor(e,t,r,s,i){this.key=e,this.value=t,this.color=r??vu.RED,this.left=s??As.EMPTY_NODE,this.right=i??As.EMPTY_NODE}copy(e,t,r,s,i){return new vu(e??this.key,t??this.value,r??this.color,s??this.left,i??this.right)}count(){return this.left.count()+1+this.right.count()}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||!!e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min_(){return this.left.isEmpty()?this:this.left.min_()}minKey(){return this.min_().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,r){let s=this;const i=r(e,s.key);return i<0?s=s.copy(null,null,null,s.left.insert(e,t,r),null):i===0?s=s.copy(null,t,null,null,null):s=s.copy(null,null,null,null,s.right.insert(e,t,r)),s.fixUp_()}removeMin_(){if(this.left.isEmpty())return As.EMPTY_NODE;let e=this;return!e.left.isRed_()&&!e.left.left.isRed_()&&(e=e.moveRedLeft_()),e=e.copy(null,null,null,e.left.removeMin_(),null),e.fixUp_()}remove(e,t){let r,s;if(r=this,t(e,r.key)<0)!r.left.isEmpty()&&!r.left.isRed_()&&!r.left.left.isRed_()&&(r=r.moveRedLeft_()),r=r.copy(null,null,null,r.left.remove(e,t),null);else{if(r.left.isRed_()&&(r=r.rotateRight_()),!r.right.isEmpty()&&!r.right.isRed_()&&!r.right.left.isRed_()&&(r=r.moveRedRight_()),t(e,r.key)===0){if(r.right.isEmpty())return As.EMPTY_NODE;s=r.right.min_(),r=r.copy(s.key,s.value,null,null,r.right.removeMin_())}r=r.copy(null,null,null,null,r.right.remove(e,t))}return r.fixUp_()}isRed_(){return this.color}fixUp_(){let e=this;return e.right.isRed_()&&!e.left.isRed_()&&(e=e.rotateLeft_()),e.left.isRed_()&&e.left.left.isRed_()&&(e=e.rotateRight_()),e.left.isRed_()&&e.right.isRed_()&&(e=e.colorFlip_()),e}moveRedLeft_(){let e=this.colorFlip_();return e.right.left.isRed_()&&(e=e.copy(null,null,null,null,e.right.rotateRight_()),e=e.rotateLeft_(),e=e.colorFlip_()),e}moveRedRight_(){let e=this.colorFlip_();return e.left.left.isRed_()&&(e=e.rotateRight_(),e=e.colorFlip_()),e}rotateLeft_(){const e=this.copy(null,null,vu.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight_(){const e=this.copy(null,null,vu.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip_(){const e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth_(){const e=this.check_();return Math.pow(2,e)<=this.count()+1}check_(){if(this.isRed_()&&this.left.isRed_())throw new Error("Red node has red child("+this.key+","+this.value+")");if(this.right.isRed_())throw new Error("Right child of ("+this.key+","+this.value+") is red");const e=this.left.check_();if(e!==this.right.check_())throw new Error("Black depths differ");return e+(this.isRed_()?0:1)}};br.RED=!0;br.BLACK=!1;class M4{copy(e,t,r,s,i){return this}insert(e,t,r){return new br(e,t,null)}remove(e,t){return this}count(){return 0}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}check_(){return 0}isRed_(){return!1}}let As=class $f{constructor(e,t=$f.EMPTY_NODE){this.comparator_=e,this.root_=t}insert(e,t){return new $f(this.comparator_,this.root_.insert(e,t,this.comparator_).copy(null,null,br.BLACK,null,null))}remove(e){return new $f(this.comparator_,this.root_.remove(e,this.comparator_).copy(null,null,br.BLACK,null,null))}get(e){let t,r=this.root_;for(;!r.isEmpty();){if(t=this.comparator_(e,r.key),t===0)return r.value;t<0?r=r.left:t>0&&(r=r.right)}return null}getPredecessorKey(e){let t,r=this.root_,s=null;for(;!r.isEmpty();)if(t=this.comparator_(e,r.key),t===0){if(r.left.isEmpty())return s?s.key:null;for(r=r.left;!r.right.isEmpty();)r=r.right;return r.key}else t<0?r=r.left:t>0&&(s=r,r=r.right);throw new Error("Attempted to find predecessor key for a nonexistent key.  What gives?")}isEmpty(){return this.root_.isEmpty()}count(){return this.root_.count()}minKey(){return this.root_.minKey()}maxKey(){return this.root_.maxKey()}inorderTraversal(e){return this.root_.inorderTraversal(e)}reverseTraversal(e){return this.root_.reverseTraversal(e)}getIterator(e){return new uf(this.root_,null,this.comparator_,!1,e)}getIteratorFrom(e,t){return new uf(this.root_,e,this.comparator_,!1,t)}getReverseIteratorFrom(e,t){return new uf(this.root_,e,this.comparator_,!0,t)}getReverseIterator(e){return new uf(this.root_,null,this.comparator_,!0,e)}};As.EMPTY_NODE=new M4;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function V4(n,e){return Fa(n.name,e.name)}function ew(n,e){return Fa(n,e)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let ev;function F4(n){ev=n}const uk=function(n){return typeof n=="number"?"number:"+BC(n):"string:"+n},dk=function(n){if(n.isLeafNode()){const e=n.val();Z(typeof e=="string"||typeof e=="number"||typeof e=="object"&&_s(e,".sv"),"Priority must be a string or number.")}else Z(n===ev||n.isEmpty(),"priority of unexpected type.");Z(n===ev||n.getPriority().isEmpty(),"Priority nodes can't have a priority of their own.")};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let EE;class An{static set __childrenNodeConstructor(e){EE=e}static get __childrenNodeConstructor(){return EE}constructor(e,t=An.__childrenNodeConstructor.EMPTY_NODE){this.value_=e,this.priorityNode_=t,this.lazyHash_=null,Z(this.value_!==void 0&&this.value_!==null,"LeafNode shouldn't be created with null/undefined value."),dk(this.priorityNode_)}isLeafNode(){return!0}getPriority(){return this.priorityNode_}updatePriority(e){return new An(this.value_,e)}getImmediateChild(e){return e===".priority"?this.priorityNode_:An.__childrenNodeConstructor.EMPTY_NODE}getChild(e){return Ue(e)?this:$e(e)===".priority"?this.priorityNode_:An.__childrenNodeConstructor.EMPTY_NODE}hasChild(){return!1}getPredecessorChildName(e,t){return null}updateImmediateChild(e,t){return e===".priority"?this.updatePriority(t):t.isEmpty()&&e!==".priority"?this:An.__childrenNodeConstructor.EMPTY_NODE.updateImmediateChild(e,t).updatePriority(this.priorityNode_)}updateChild(e,t){const r=$e(e);return r===null?t:t.isEmpty()&&r!==".priority"?this:(Z(r!==".priority"||go(e)===1,".priority must be the last token in a path"),this.updateImmediateChild(r,An.__childrenNodeConstructor.EMPTY_NODE.updateChild(St(e),t)))}isEmpty(){return!1}numChildren(){return 0}forEachChild(e,t){return!1}val(e){return e&&!this.getPriority().isEmpty()?{".value":this.getValue(),".priority":this.getPriority().val()}:this.getValue()}hash(){if(this.lazyHash_===null){let e="";this.priorityNode_.isEmpty()||(e+="priority:"+uk(this.priorityNode_.val())+":");const t=typeof this.value_;e+=t+":",t==="number"?e+=BC(this.value_):e+=this.value_,this.lazyHash_=FC(e)}return this.lazyHash_}getValue(){return this.value_}compareTo(e){return e===An.__childrenNodeConstructor.EMPTY_NODE?1:e instanceof An.__childrenNodeConstructor?-1:(Z(e.isLeafNode(),"Unknown node type"),this.compareToLeafNode_(e))}compareToLeafNode_(e){const t=typeof e.value_,r=typeof this.value_,s=An.VALUE_TYPE_ORDER.indexOf(t),i=An.VALUE_TYPE_ORDER.indexOf(r);return Z(s>=0,"Unknown leaf type: "+t),Z(i>=0,"Unknown leaf type: "+r),s===i?r==="object"?0:this.value_<e.value_?-1:this.value_===e.value_?0:1:i-s}withIndex(){return this}isIndexed(){return!0}equals(e){if(e===this)return!0;if(e.isLeafNode()){const t=e;return this.value_===t.value_&&this.priorityNode_.equals(t.priorityNode_)}else return!1}}An.VALUE_TYPE_ORDER=["object","boolean","number","string"];/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let hk,fk;function $4(n){hk=n}function U4(n){fk=n}class B4 extends Vp{compare(e,t){const r=e.node.getPriority(),s=t.node.getPriority(),i=r.compareTo(s);return i===0?Fa(e.name,t.name):i}isDefinedOn(e){return!e.getPriority().isEmpty()}indexedValueChanged(e,t){return!e.getPriority().equals(t.getPriority())}minPost(){return Be.MIN}maxPost(){return new Be(fi,new An("[PRIORITY-POST]",fk))}makePost(e,t){const r=hk(e);return new Be(t,new An("[PRIORITY-POST]",r))}toString(){return".priority"}}const Nt=new B4;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const z4=Math.log(2);class q4{constructor(e){const t=i=>parseInt(Math.log(i)/z4,10),r=i=>parseInt(Array(i+1).join("1"),2);this.count=t(e+1),this.current_=this.count-1;const s=r(this.count);this.bits_=e+1&s}nextBitIsOne(){const e=!(this.bits_&1<<this.current_);return this.current_--,e}}const Om=function(n,e,t,r){n.sort(e);const s=function(c,u){const h=u-c;let f,m;if(h===0)return null;if(h===1)return f=n[c],m=t?t(f):f,new br(m,f.node,br.BLACK,null,null);{const y=parseInt(h/2,10)+c,w=s(c,y),S=s(y+1,u);return f=n[y],m=t?t(f):f,new br(m,f.node,br.BLACK,w,S)}},i=function(c){let u=null,h=null,f=n.length;const m=function(w,S){const R=f-w,T=f;f-=w;const I=s(R+1,T),N=n[R],P=t?t(N):N;y(new br(P,N.node,S,null,I))},y=function(w){u?(u.left=w,u=w):(h=w,u=w)};for(let w=0;w<c.count;++w){const S=c.nextBitIsOne(),R=Math.pow(2,c.count-(w+1));S?m(R,br.BLACK):(m(R,br.BLACK),m(R,br.RED))}return h},o=new q4(n.length),a=i(o);return new As(r||e,a)};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Cy;const rl={};class ei{static get Default(){return Z(rl&&Nt,"ChildrenNode.ts has not been loaded"),Cy=Cy||new ei({".priority":rl},{".priority":Nt}),Cy}constructor(e,t){this.indexes_=e,this.indexSet_=t}get(e){const t=ya(this.indexes_,e);if(!t)throw new Error("No index defined for "+e);return t instanceof As?t:null}hasIndex(e){return _s(this.indexSet_,e.toString())}addIndex(e,t){Z(e!==Ls,"KeyIndex always exists and isn't meant to be added to the IndexMap.");const r=[];let s=!1;const i=t.getIterator(Be.Wrap);let o=i.getNext();for(;o;)s=s||e.isDefinedOn(o.node),r.push(o),o=i.getNext();let a;s?a=Om(r,e.getCompare()):a=rl;const c=e.toString(),u={...this.indexSet_};u[c]=e;const h={...this.indexes_};return h[c]=a,new ei(h,u)}addToIndexes(e,t){const r=Nm(this.indexes_,(s,i)=>{const o=ya(this.indexSet_,i);if(Z(o,"Missing index implementation for "+i),s===rl)if(o.isDefinedOn(e.node)){const a=[],c=t.getIterator(Be.Wrap);let u=c.getNext();for(;u;)u.name!==e.name&&a.push(u),u=c.getNext();return a.push(e),Om(a,o.getCompare())}else return rl;else{const a=t.get(e.name);let c=s;return a&&(c=c.remove(new Be(e.name,a))),c.insert(e,e.node)}});return new ei(r,this.indexSet_)}removeFromIndexes(e,t){const r=Nm(this.indexes_,s=>{if(s===rl)return s;{const i=t.get(e.name);return i?s.remove(new Be(e.name,i)):s}});return new ei(r,this.indexSet_)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let su;class ke{static get EMPTY_NODE(){return su||(su=new ke(new As(ew),null,ei.Default))}constructor(e,t,r){this.children_=e,this.priorityNode_=t,this.indexMap_=r,this.lazyHash_=null,this.priorityNode_&&dk(this.priorityNode_),this.children_.isEmpty()&&Z(!this.priorityNode_||this.priorityNode_.isEmpty(),"An empty node cannot have a priority")}isLeafNode(){return!1}getPriority(){return this.priorityNode_||su}updatePriority(e){return this.children_.isEmpty()?this:new ke(this.children_,e,this.indexMap_)}getImmediateChild(e){if(e===".priority")return this.getPriority();{const t=this.children_.get(e);return t===null?su:t}}getChild(e){const t=$e(e);return t===null?this:this.getImmediateChild(t).getChild(St(e))}hasChild(e){return this.children_.get(e)!==null}updateImmediateChild(e,t){if(Z(t,"We should always be passing snapshot nodes"),e===".priority")return this.updatePriority(t);{const r=new Be(e,t);let s,i;t.isEmpty()?(s=this.children_.remove(e),i=this.indexMap_.removeFromIndexes(r,this.children_)):(s=this.children_.insert(e,t),i=this.indexMap_.addToIndexes(r,this.children_));const o=s.isEmpty()?su:this.priorityNode_;return new ke(s,o,i)}}updateChild(e,t){const r=$e(e);if(r===null)return t;{Z($e(e)!==".priority"||go(e)===1,".priority must be the last token in a path");const s=this.getImmediateChild(r).updateChild(St(e),t);return this.updateImmediateChild(r,s)}}isEmpty(){return this.children_.isEmpty()}numChildren(){return this.children_.count()}val(e){if(this.isEmpty())return null;const t={};let r=0,s=0,i=!0;if(this.forEachChild(Nt,(o,a)=>{t[o]=a.val(e),r++,i&&ke.INTEGER_REGEXP_.test(o)?s=Math.max(s,Number(o)):i=!1}),!e&&i&&s<2*r){const o=[];for(const a in t)o[a]=t[a];return o}else return e&&!this.getPriority().isEmpty()&&(t[".priority"]=this.getPriority().val()),t}hash(){if(this.lazyHash_===null){let e="";this.getPriority().isEmpty()||(e+="priority:"+uk(this.getPriority().val())+":"),this.forEachChild(Nt,(t,r)=>{const s=r.hash();s!==""&&(e+=":"+t+":"+s)}),this.lazyHash_=e===""?"":FC(e)}return this.lazyHash_}getPredecessorChildName(e,t,r){const s=this.resolveIndex_(r);if(s){const i=s.getPredecessorKey(new Be(e,t));return i?i.name:null}else return this.children_.getPredecessorKey(e)}getFirstChildName(e){const t=this.resolveIndex_(e);if(t){const r=t.minKey();return r&&r.name}else return this.children_.minKey()}getFirstChild(e){const t=this.getFirstChildName(e);return t?new Be(t,this.children_.get(t)):null}getLastChildName(e){const t=this.resolveIndex_(e);if(t){const r=t.maxKey();return r&&r.name}else return this.children_.maxKey()}getLastChild(e){const t=this.getLastChildName(e);return t?new Be(t,this.children_.get(t)):null}forEachChild(e,t){const r=this.resolveIndex_(e);return r?r.inorderTraversal(s=>t(s.name,s.node)):this.children_.inorderTraversal(t)}getIterator(e){return this.getIteratorFrom(e.minPost(),e)}getIteratorFrom(e,t){const r=this.resolveIndex_(t);if(r)return r.getIteratorFrom(e,s=>s);{const s=this.children_.getIteratorFrom(e.name,Be.Wrap);let i=s.peek();for(;i!=null&&t.compare(i,e)<0;)s.getNext(),i=s.peek();return s}}getReverseIterator(e){return this.getReverseIteratorFrom(e.maxPost(),e)}getReverseIteratorFrom(e,t){const r=this.resolveIndex_(t);if(r)return r.getReverseIteratorFrom(e,s=>s);{const s=this.children_.getReverseIteratorFrom(e.name,Be.Wrap);let i=s.peek();for(;i!=null&&t.compare(i,e)>0;)s.getNext(),i=s.peek();return s}}compareTo(e){return this.isEmpty()?e.isEmpty()?0:-1:e.isLeafNode()||e.isEmpty()?1:e===nh?-1:0}withIndex(e){if(e===Ls||this.indexMap_.hasIndex(e))return this;{const t=this.indexMap_.addIndex(e,this.children_);return new ke(this.children_,this.priorityNode_,t)}}isIndexed(e){return e===Ls||this.indexMap_.hasIndex(e)}equals(e){if(e===this)return!0;if(e.isLeafNode())return!1;{const t=e;if(this.getPriority().equals(t.getPriority()))if(this.children_.count()===t.children_.count()){const r=this.getIterator(Nt),s=t.getIterator(Nt);let i=r.getNext(),o=s.getNext();for(;i&&o;){if(i.name!==o.name||!i.node.equals(o.node))return!1;i=r.getNext(),o=s.getNext()}return i===null&&o===null}else return!1;else return!1}}resolveIndex_(e){return e===Ls?null:this.indexMap_.get(e.toString())}}ke.INTEGER_REGEXP_=/^(0|[1-9]\d*)$/;class W4 extends ke{constructor(){super(new As(ew),ke.EMPTY_NODE,ei.Default)}compareTo(e){return e===this?0:1}equals(e){return e===this}getPriority(){return this}getImmediateChild(e){return ke.EMPTY_NODE}isEmpty(){return!1}}const nh=new W4;Object.defineProperties(Be,{MIN:{value:new Be(po,ke.EMPTY_NODE)},MAX:{value:new Be(fi,nh)}});ck.__EMPTY_NODE=ke.EMPTY_NODE;An.__childrenNodeConstructor=ke;F4(nh);U4(nh);/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const G4=!0;function Yt(n,e=null){if(n===null)return ke.EMPTY_NODE;if(typeof n=="object"&&".priority"in n&&(e=n[".priority"]),Z(e===null||typeof e=="string"||typeof e=="number"||typeof e=="object"&&".sv"in e,"Invalid priority type found: "+typeof e),typeof n=="object"&&".value"in n&&n[".value"]!==null&&(n=n[".value"]),typeof n!="object"||".sv"in n){const t=n;return new An(t,Yt(e))}if(!(n instanceof Array)&&G4){const t=[];let r=!1;if(Ln(n,(o,a)=>{if(o.substring(0,1)!=="."){const c=Yt(a);c.isEmpty()||(r=r||!c.getPriority().isEmpty(),t.push(new Be(o,c)))}}),t.length===0)return ke.EMPTY_NODE;const i=Om(t,V4,o=>o.name,ew);if(r){const o=Om(t,Nt.getCompare());return new ke(i,Yt(e),new ei({".priority":o},{".priority":Nt}))}else return new ke(i,Yt(e),ei.Default)}else{let t=ke.EMPTY_NODE;return Ln(n,(r,s)=>{if(_s(n,r)&&r.substring(0,1)!=="."){const i=Yt(s);(i.isLeafNode()||!i.isEmpty())&&(t=t.updateImmediateChild(r,i))}}),t.updatePriority(Yt(e))}}$4(Yt);/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class tw extends Vp{constructor(e){super(),this.indexPath_=e,Z(!Ue(e)&&$e(e)!==".priority","Can't create PathIndex with empty path or .priority key")}extractChild(e){return e.getChild(this.indexPath_)}isDefinedOn(e){return!e.getChild(this.indexPath_).isEmpty()}compare(e,t){const r=this.extractChild(e.node),s=this.extractChild(t.node),i=r.compareTo(s);return i===0?Fa(e.name,t.name):i}makePost(e,t){const r=Yt(e),s=ke.EMPTY_NODE.updateChild(this.indexPath_,r);return new Be(t,s)}maxPost(){const e=ke.EMPTY_NODE.updateChild(this.indexPath_,nh);return new Be(fi,e)}toString(){return wd(this.indexPath_,0).join("/")}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class H4 extends Vp{compare(e,t){const r=e.node.compareTo(t.node);return r===0?Fa(e.name,t.name):r}isDefinedOn(e){return!0}indexedValueChanged(e,t){return!e.equals(t)}minPost(){return Be.MIN}maxPost(){return Be.MAX}makePost(e,t){const r=Yt(e);return new Be(t,r)}toString(){return".value"}}const nw=new H4;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function mk(n){return{type:"value",snapshotNode:n}}function Kl(n,e){return{type:"child_added",snapshotNode:e,childName:n}}function xd(n,e){return{type:"child_removed",snapshotNode:e,childName:n}}function Sd(n,e,t){return{type:"child_changed",snapshotNode:e,childName:n,oldSnap:t}}function Q4(n,e){return{type:"child_moved",snapshotNode:e,childName:n}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class rw{constructor(e){this.index_=e}updateChild(e,t,r,s,i,o){Z(e.isIndexed(this.index_),"A node must be indexed if only a child is updated");const a=e.getImmediateChild(t);return a.getChild(s).equals(r.getChild(s))&&a.isEmpty()===r.isEmpty()||(o!=null&&(r.isEmpty()?e.hasChild(t)?o.trackChildChange(xd(t,a)):Z(e.isLeafNode(),"A child remove without an old child only makes sense on a leaf node"):a.isEmpty()?o.trackChildChange(Kl(t,r)):o.trackChildChange(Sd(t,r,a))),e.isLeafNode()&&r.isEmpty())?e:e.updateImmediateChild(t,r).withIndex(this.index_)}updateFullNode(e,t,r){return r!=null&&(e.isLeafNode()||e.forEachChild(Nt,(s,i)=>{t.hasChild(s)||r.trackChildChange(xd(s,i))}),t.isLeafNode()||t.forEachChild(Nt,(s,i)=>{if(e.hasChild(s)){const o=e.getImmediateChild(s);o.equals(i)||r.trackChildChange(Sd(s,i,o))}else r.trackChildChange(Kl(s,i))})),t.withIndex(this.index_)}updatePriority(e,t){return e.isEmpty()?ke.EMPTY_NODE:e.updatePriority(t)}filtersNodes(){return!1}getIndexedFilter(){return this}getIndex(){return this.index_}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Id{constructor(e){this.indexedFilter_=new rw(e.getIndex()),this.index_=e.getIndex(),this.startPost_=Id.getStartPost_(e),this.endPost_=Id.getEndPost_(e),this.startIsInclusive_=!e.startAfterSet_,this.endIsInclusive_=!e.endBeforeSet_}getStartPost(){return this.startPost_}getEndPost(){return this.endPost_}matches(e){const t=this.startIsInclusive_?this.index_.compare(this.getStartPost(),e)<=0:this.index_.compare(this.getStartPost(),e)<0,r=this.endIsInclusive_?this.index_.compare(e,this.getEndPost())<=0:this.index_.compare(e,this.getEndPost())<0;return t&&r}updateChild(e,t,r,s,i,o){return this.matches(new Be(t,r))||(r=ke.EMPTY_NODE),this.indexedFilter_.updateChild(e,t,r,s,i,o)}updateFullNode(e,t,r){t.isLeafNode()&&(t=ke.EMPTY_NODE);let s=t.withIndex(this.index_);s=s.updatePriority(ke.EMPTY_NODE);const i=this;return t.forEachChild(Nt,(o,a)=>{i.matches(new Be(o,a))||(s=s.updateImmediateChild(o,ke.EMPTY_NODE))}),this.indexedFilter_.updateFullNode(e,s,r)}updatePriority(e,t){return e}filtersNodes(){return!0}getIndexedFilter(){return this.indexedFilter_}getIndex(){return this.index_}static getStartPost_(e){if(e.hasStart()){const t=e.getIndexStartName();return e.getIndex().makePost(e.getIndexStartValue(),t)}else return e.getIndex().minPost()}static getEndPost_(e){if(e.hasEnd()){const t=e.getIndexEndName();return e.getIndex().makePost(e.getIndexEndValue(),t)}else return e.getIndex().maxPost()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class K4{constructor(e){this.withinDirectionalStart=t=>this.reverse_?this.withinEndPost(t):this.withinStartPost(t),this.withinDirectionalEnd=t=>this.reverse_?this.withinStartPost(t):this.withinEndPost(t),this.withinStartPost=t=>{const r=this.index_.compare(this.rangedFilter_.getStartPost(),t);return this.startIsInclusive_?r<=0:r<0},this.withinEndPost=t=>{const r=this.index_.compare(t,this.rangedFilter_.getEndPost());return this.endIsInclusive_?r<=0:r<0},this.rangedFilter_=new Id(e),this.index_=e.getIndex(),this.limit_=e.getLimit(),this.reverse_=!e.isViewFromLeft(),this.startIsInclusive_=!e.startAfterSet_,this.endIsInclusive_=!e.endBeforeSet_}updateChild(e,t,r,s,i,o){return this.rangedFilter_.matches(new Be(t,r))||(r=ke.EMPTY_NODE),e.getImmediateChild(t).equals(r)?e:e.numChildren()<this.limit_?this.rangedFilter_.getIndexedFilter().updateChild(e,t,r,s,i,o):this.fullLimitUpdateChild_(e,t,r,i,o)}updateFullNode(e,t,r){let s;if(t.isLeafNode()||t.isEmpty())s=ke.EMPTY_NODE.withIndex(this.index_);else if(this.limit_*2<t.numChildren()&&t.isIndexed(this.index_)){s=ke.EMPTY_NODE.withIndex(this.index_);let i;this.reverse_?i=t.getReverseIteratorFrom(this.rangedFilter_.getEndPost(),this.index_):i=t.getIteratorFrom(this.rangedFilter_.getStartPost(),this.index_);let o=0;for(;i.hasNext()&&o<this.limit_;){const a=i.getNext();if(this.withinDirectionalStart(a))if(this.withinDirectionalEnd(a))s=s.updateImmediateChild(a.name,a.node),o++;else break;else continue}}else{s=t.withIndex(this.index_),s=s.updatePriority(ke.EMPTY_NODE);let i;this.reverse_?i=s.getReverseIterator(this.index_):i=s.getIterator(this.index_);let o=0;for(;i.hasNext();){const a=i.getNext();o<this.limit_&&this.withinDirectionalStart(a)&&this.withinDirectionalEnd(a)?o++:s=s.updateImmediateChild(a.name,ke.EMPTY_NODE)}}return this.rangedFilter_.getIndexedFilter().updateFullNode(e,s,r)}updatePriority(e,t){return e}filtersNodes(){return!0}getIndexedFilter(){return this.rangedFilter_.getIndexedFilter()}getIndex(){return this.index_}fullLimitUpdateChild_(e,t,r,s,i){let o;if(this.reverse_){const f=this.index_.getCompare();o=(m,y)=>f(y,m)}else o=this.index_.getCompare();const a=e;Z(a.numChildren()===this.limit_,"");const c=new Be(t,r),u=this.reverse_?a.getFirstChild(this.index_):a.getLastChild(this.index_),h=this.rangedFilter_.matches(c);if(a.hasChild(t)){const f=a.getImmediateChild(t);let m=s.getChildAfterChild(this.index_,u,this.reverse_);for(;m!=null&&(m.name===t||a.hasChild(m.name));)m=s.getChildAfterChild(this.index_,m,this.reverse_);const y=m==null?1:o(m,c);if(h&&!r.isEmpty()&&y>=0)return i!=null&&i.trackChildChange(Sd(t,r,f)),a.updateImmediateChild(t,r);{i!=null&&i.trackChildChange(xd(t,f));const S=a.updateImmediateChild(t,ke.EMPTY_NODE);return m!=null&&this.rangedFilter_.matches(m)?(i!=null&&i.trackChildChange(Kl(m.name,m.node)),S.updateImmediateChild(m.name,m.node)):S}}else return r.isEmpty()?e:h&&o(u,c)>=0?(i!=null&&(i.trackChildChange(xd(u.name,u.node)),i.trackChildChange(Kl(t,r))),a.updateImmediateChild(t,r).updateImmediateChild(u.name,ke.EMPTY_NODE)):e}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class sw{constructor(){this.limitSet_=!1,this.startSet_=!1,this.startNameSet_=!1,this.startAfterSet_=!1,this.endSet_=!1,this.endNameSet_=!1,this.endBeforeSet_=!1,this.limit_=0,this.viewFrom_="",this.indexStartValue_=null,this.indexStartName_="",this.indexEndValue_=null,this.indexEndName_="",this.index_=Nt}hasStart(){return this.startSet_}isViewFromLeft(){return this.viewFrom_===""?this.startSet_:this.viewFrom_==="l"}getIndexStartValue(){return Z(this.startSet_,"Only valid if start has been set"),this.indexStartValue_}getIndexStartName(){return Z(this.startSet_,"Only valid if start has been set"),this.startNameSet_?this.indexStartName_:po}hasEnd(){return this.endSet_}getIndexEndValue(){return Z(this.endSet_,"Only valid if end has been set"),this.indexEndValue_}getIndexEndName(){return Z(this.endSet_,"Only valid if end has been set"),this.endNameSet_?this.indexEndName_:fi}hasLimit(){return this.limitSet_}hasAnchoredLimit(){return this.limitSet_&&this.viewFrom_!==""}getLimit(){return Z(this.limitSet_,"Only valid if limit has been set"),this.limit_}getIndex(){return this.index_}loadsAllData(){return!(this.startSet_||this.endSet_||this.limitSet_)}isDefault(){return this.loadsAllData()&&this.index_===Nt}copy(){const e=new sw;return e.limitSet_=this.limitSet_,e.limit_=this.limit_,e.startSet_=this.startSet_,e.startAfterSet_=this.startAfterSet_,e.indexStartValue_=this.indexStartValue_,e.startNameSet_=this.startNameSet_,e.indexStartName_=this.indexStartName_,e.endSet_=this.endSet_,e.endBeforeSet_=this.endBeforeSet_,e.indexEndValue_=this.indexEndValue_,e.endNameSet_=this.endNameSet_,e.indexEndName_=this.indexEndName_,e.index_=this.index_,e.viewFrom_=this.viewFrom_,e}}function Y4(n){return n.loadsAllData()?new rw(n.getIndex()):n.hasLimit()?new K4(n):new Id(n)}function J4(n,e){const t=n.copy();return t.limitSet_=!0,t.limit_=e,t.viewFrom_="l",t}function X4(n,e){const t=n.copy();return t.limitSet_=!0,t.limit_=e,t.viewFrom_="r",t}function tv(n,e,t){const r=n.copy();return r.startSet_=!0,e===void 0&&(e=null),r.indexStartValue_=e,t!=null?(r.startNameSet_=!0,r.indexStartName_=t):(r.startNameSet_=!1,r.indexStartName_=""),r}function Z4(n,e,t){let r;return n.index_===Ls||t?r=tv(n,e,t):r=tv(n,e,fi),r.startAfterSet_=!0,r}function nv(n,e,t){const r=n.copy();return r.endSet_=!0,e===void 0&&(e=null),r.indexEndValue_=e,t!==void 0?(r.endNameSet_=!0,r.indexEndName_=t):(r.endNameSet_=!1,r.indexEndName_=""),r}function eV(n,e,t){let r;return n.index_===Ls||t?r=nv(n,e,t):r=nv(n,e,po),r.endBeforeSet_=!0,r}function Fp(n,e){const t=n.copy();return t.index_=e,t}function bE(n){const e={};if(n.isDefault())return e;let t;if(n.index_===Nt?t="$priority":n.index_===nw?t="$value":n.index_===Ls?t="$key":(Z(n.index_ instanceof tw,"Unrecognized index type!"),t=n.index_.toString()),e.orderBy=Sn(t),n.startSet_){const r=n.startAfterSet_?"startAfter":"startAt";e[r]=Sn(n.indexStartValue_),n.startNameSet_&&(e[r]+=","+Sn(n.indexStartName_))}if(n.endSet_){const r=n.endBeforeSet_?"endBefore":"endAt";e[r]=Sn(n.indexEndValue_),n.endNameSet_&&(e[r]+=","+Sn(n.indexEndName_))}return n.limitSet_&&(n.isViewFromLeft()?e.limitToFirst=n.limit_:e.limitToLast=n.limit_),e}function TE(n){const e={};if(n.startSet_&&(e.sp=n.indexStartValue_,n.startNameSet_&&(e.sn=n.indexStartName_),e.sin=!n.startAfterSet_),n.endSet_&&(e.ep=n.indexEndValue_,n.endNameSet_&&(e.en=n.indexEndName_),e.ein=!n.endBeforeSet_),n.limitSet_){e.l=n.limit_;let t=n.viewFrom_;t===""&&(n.isViewFromLeft()?t="l":t="r"),e.vf=t}return n.index_!==Nt&&(e.i=n.index_.toString()),e}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class jm extends ik{reportStats(e){throw new Error("Method not implemented.")}static getListenId_(e,t){return t!==void 0?"tag$"+t:(Z(e._queryParams.isDefault(),"should have a tag if it's not a default query."),e._path.toString())}constructor(e,t,r,s){super(),this.repoInfo_=e,this.onDataUpdate_=t,this.authTokenProvider_=r,this.appCheckTokenProvider_=s,this.log_=th("p:rest:"),this.listens_={}}listen(e,t,r,s){const i=e._path.toString();this.log_("Listen called for "+i+" "+e._queryIdentifier);const o=jm.getListenId_(e,r),a={};this.listens_[o]=a;const c=bE(e._queryParams);this.restRequest_(i+".json",c,(u,h)=>{let f=h;if(u===404&&(f=null,u=null),u===null&&this.onDataUpdate_(i,f,!1,r),ya(this.listens_,o)===a){let m;u?u===401?m="permission_denied":m="rest_error:"+u:m="ok",s(m,null)}})}unlisten(e,t){const r=jm.getListenId_(e,t);delete this.listens_[r]}get(e){const t=bE(e._queryParams),r=e._path.toString(),s=new Ar;return this.restRequest_(r+".json",t,(i,o)=>{let a=o;i===404&&(a=null,i=null),i===null?(this.onDataUpdate_(r,a,!1,null),s.resolve(a)):s.reject(new Error(a))}),s.promise}refreshAuthToken(e){}restRequest_(e,t={},r){return t.format="export",Promise.all([this.authTokenProvider_.getToken(!1),this.appCheckTokenProvider_.getToken(!1)]).then(([s,i])=>{s&&s.accessToken&&(t.auth=s.accessToken),i&&i.token&&(t.ac=i.token);const o=(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host+e+"?ns="+this.repoInfo_.namespace+Ma(t);this.log_("Sending REST request for "+o);const a=new XMLHttpRequest;a.onreadystatechange=()=>{if(r&&a.readyState===4){this.log_("REST Response for "+o+" received. status:",a.status,"response:",a.responseText);let c=null;if(a.status>=200&&a.status<300){try{c=yd(a.responseText)}catch{er("Failed to parse JSON response for "+o+": "+a.responseText)}r(null,c)}else a.status!==401&&a.status!==404&&er("Got unsuccessful REST response for "+o+" Status: "+a.status),r(a.status);r=null}},a.open("GET",o,!0),a.send()})}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class tV{constructor(){this.rootNode_=ke.EMPTY_NODE}getNode(e){return this.rootNode_.getChild(e)}updateSnapshot(e,t){this.rootNode_=this.rootNode_.updateChild(e,t)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Lm(){return{value:null,children:new Map}}function Tc(n,e,t){if(Ue(e))n.value=t,n.children.clear();else if(n.value!==null)n.value=n.value.updateChild(e,t);else{const r=$e(e);n.children.has(r)||n.children.set(r,Lm());const s=n.children.get(r);e=St(e),Tc(s,e,t)}}function rv(n,e){if(Ue(e))return n.value=null,n.children.clear(),!0;if(n.value!==null){if(n.value.isLeafNode())return!1;{const t=n.value;return n.value=null,t.forEachChild(Nt,(r,s)=>{Tc(n,new ct(r),s)}),rv(n,e)}}else if(n.children.size>0){const t=$e(e);return e=St(e),n.children.has(t)&&rv(n.children.get(t),e)&&n.children.delete(t),n.children.size===0}else return!0}function sv(n,e,t){n.value!==null?t(e,n.value):nV(n,(r,s)=>{const i=new ct(e.toString()+"/"+r);sv(s,i,t)})}function nV(n,e){n.children.forEach((t,r)=>{e(r,t)})}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class rV{constructor(e){this.collection_=e,this.last_=null}get(){const e=this.collection_.get(),t={...e};return this.last_&&Ln(this.last_,(r,s)=>{t[r]=t[r]-s}),this.last_=e,t}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const AE=10*1e3,sV=30*1e3,iV=5*60*1e3;class oV{constructor(e,t){this.server_=t,this.statsToReport_={},this.statsListener_=new rV(e);const r=AE+(sV-AE)*Math.random();ju(this.reportStats_.bind(this),Math.floor(r))}reportStats_(){const e=this.statsListener_.get(),t={};let r=!1;Ln(e,(s,i)=>{i>0&&_s(this.statsToReport_,s)&&(t[s]=i,r=!0)}),r&&this.server_.reportStats(t),ju(this.reportStats_.bind(this),Math.floor(Math.random()*2*iV))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var cs;(function(n){n[n.OVERWRITE=0]="OVERWRITE",n[n.MERGE=1]="MERGE",n[n.ACK_USER_WRITE=2]="ACK_USER_WRITE",n[n.LISTEN_COMPLETE=3]="LISTEN_COMPLETE"})(cs||(cs={}));function iw(){return{fromUser:!0,fromServer:!1,queryId:null,tagged:!1}}function ow(){return{fromUser:!1,fromServer:!0,queryId:null,tagged:!1}}function aw(n){return{fromUser:!1,fromServer:!0,queryId:n,tagged:!0}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Mm{constructor(e,t,r){this.path=e,this.affectedTree=t,this.revert=r,this.type=cs.ACK_USER_WRITE,this.source=iw()}operationForChild(e){if(Ue(this.path)){if(this.affectedTree.value!=null)return Z(this.affectedTree.children.isEmpty(),"affectedTree should not have overlapping affected paths."),this;{const t=this.affectedTree.subtree(new ct(e));return new Mm(rt(),t,this.revert)}}else return Z($e(this.path)===e,"operationForChild called for unrelated child."),new Mm(St(this.path),this.affectedTree,this.revert)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ed{constructor(e,t){this.source=e,this.path=t,this.type=cs.LISTEN_COMPLETE}operationForChild(e){return Ue(this.path)?new Ed(this.source,rt()):new Ed(this.source,St(this.path))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class va{constructor(e,t,r){this.source=e,this.path=t,this.snap=r,this.type=cs.OVERWRITE}operationForChild(e){return Ue(this.path)?new va(this.source,rt(),this.snap.getImmediateChild(e)):new va(this.source,St(this.path),this.snap)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Yl{constructor(e,t,r){this.source=e,this.path=t,this.children=r,this.type=cs.MERGE}operationForChild(e){if(Ue(this.path)){const t=this.children.subtree(new ct(e));return t.isEmpty()?null:t.value?new va(this.source,rt(),t.value):new Yl(this.source,rt(),t)}else return Z($e(this.path)===e,"Can't get a merge for a child not on the path of the operation"),new Yl(this.source,St(this.path),this.children)}toString(){return"Operation("+this.path+": "+this.source.toString()+" merge: "+this.children.toString()+")"}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class yo{constructor(e,t,r){this.node_=e,this.fullyInitialized_=t,this.filtered_=r}isFullyInitialized(){return this.fullyInitialized_}isFiltered(){return this.filtered_}isCompleteForPath(e){if(Ue(e))return this.isFullyInitialized()&&!this.filtered_;const t=$e(e);return this.isCompleteForChild(t)}isCompleteForChild(e){return this.isFullyInitialized()&&!this.filtered_||this.node_.hasChild(e)}getNode(){return this.node_}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class aV{constructor(e){this.query_=e,this.index_=this.query_._queryParams.getIndex()}}function lV(n,e,t,r){const s=[],i=[];return e.forEach(o=>{o.type==="child_changed"&&n.index_.indexedValueChanged(o.oldSnap,o.snapshotNode)&&i.push(Q4(o.childName,o.snapshotNode))}),iu(n,s,"child_removed",e,r,t),iu(n,s,"child_added",e,r,t),iu(n,s,"child_moved",i,r,t),iu(n,s,"child_changed",e,r,t),iu(n,s,"value",e,r,t),s}function iu(n,e,t,r,s,i){const o=r.filter(a=>a.type===t);o.sort((a,c)=>uV(n,a,c)),o.forEach(a=>{const c=cV(n,a,i);s.forEach(u=>{u.respondsTo(a.type)&&e.push(u.createEvent(c,n.query_))})})}function cV(n,e,t){return e.type==="value"||e.type==="child_removed"||(e.prevName=t.getPredecessorChildName(e.childName,e.snapshotNode,n.index_)),e}function uV(n,e,t){if(e.childName==null||t.childName==null)throw Ec("Should only compare child_ events.");const r=new Be(e.childName,e.snapshotNode),s=new Be(t.childName,t.snapshotNode);return n.index_.compare(r,s)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function $p(n,e){return{eventCache:n,serverCache:e}}function Lu(n,e,t,r){return $p(new yo(e,t,r),n.serverCache)}function pk(n,e,t,r){return $p(n.eventCache,new yo(e,t,r))}function Vm(n){return n.eventCache.isFullyInitialized()?n.eventCache.getNode():null}function wa(n){return n.serverCache.isFullyInitialized()?n.serverCache.getNode():null}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let ky;const dV=()=>(ky||(ky=new As(HM)),ky);class Ct{static fromObject(e){let t=new Ct(null);return Ln(e,(r,s)=>{t=t.set(new ct(r),s)}),t}constructor(e,t=dV()){this.value=e,this.children=t}isEmpty(){return this.value===null&&this.children.isEmpty()}findRootMostMatchingPathAndValue(e,t){if(this.value!=null&&t(this.value))return{path:rt(),value:this.value};if(Ue(e))return null;{const r=$e(e),s=this.children.get(r);if(s!==null){const i=s.findRootMostMatchingPathAndValue(St(e),t);return i!=null?{path:zt(new ct(r),i.path),value:i.value}:null}else return null}}findRootMostValueAndPath(e){return this.findRootMostMatchingPathAndValue(e,()=>!0)}subtree(e){if(Ue(e))return this;{const t=$e(e),r=this.children.get(t);return r!==null?r.subtree(St(e)):new Ct(null)}}set(e,t){if(Ue(e))return new Ct(t,this.children);{const r=$e(e),i=(this.children.get(r)||new Ct(null)).set(St(e),t),o=this.children.insert(r,i);return new Ct(this.value,o)}}remove(e){if(Ue(e))return this.children.isEmpty()?new Ct(null):new Ct(null,this.children);{const t=$e(e),r=this.children.get(t);if(r){const s=r.remove(St(e));let i;return s.isEmpty()?i=this.children.remove(t):i=this.children.insert(t,s),this.value===null&&i.isEmpty()?new Ct(null):new Ct(this.value,i)}else return this}}get(e){if(Ue(e))return this.value;{const t=$e(e),r=this.children.get(t);return r?r.get(St(e)):null}}setTree(e,t){if(Ue(e))return t;{const r=$e(e),i=(this.children.get(r)||new Ct(null)).setTree(St(e),t);let o;return i.isEmpty()?o=this.children.remove(r):o=this.children.insert(r,i),new Ct(this.value,o)}}fold(e){return this.fold_(rt(),e)}fold_(e,t){const r={};return this.children.inorderTraversal((s,i)=>{r[s]=i.fold_(zt(e,s),t)}),t(e,this.value,r)}findOnPath(e,t){return this.findOnPath_(e,rt(),t)}findOnPath_(e,t,r){const s=this.value?r(t,this.value):!1;if(s)return s;if(Ue(e))return null;{const i=$e(e),o=this.children.get(i);return o?o.findOnPath_(St(e),zt(t,i),r):null}}foreachOnPath(e,t){return this.foreachOnPath_(e,rt(),t)}foreachOnPath_(e,t,r){if(Ue(e))return this;{this.value&&r(t,this.value);const s=$e(e),i=this.children.get(s);return i?i.foreachOnPath_(St(e),zt(t,s),r):new Ct(null)}}foreach(e){this.foreach_(rt(),e)}foreach_(e,t){this.children.inorderTraversal((r,s)=>{s.foreach_(zt(e,r),t)}),this.value&&t(e,this.value)}foreachChild(e){this.children.inorderTraversal((t,r)=>{r.value&&e(t,r.value)})}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class fs{constructor(e){this.writeTree_=e}static empty(){return new fs(new Ct(null))}}function Mu(n,e,t){if(Ue(e))return new fs(new Ct(t));{const r=n.writeTree_.findRootMostValueAndPath(e);if(r!=null){const s=r.path;let i=r.value;const o=ir(s,e);return i=i.updateChild(o,t),new fs(n.writeTree_.set(s,i))}else{const s=new Ct(t),i=n.writeTree_.setTree(e,s);return new fs(i)}}}function iv(n,e,t){let r=n;return Ln(t,(s,i)=>{r=Mu(r,zt(e,s),i)}),r}function CE(n,e){if(Ue(e))return fs.empty();{const t=n.writeTree_.setTree(e,new Ct(null));return new fs(t)}}function ov(n,e){return $a(n,e)!=null}function $a(n,e){const t=n.writeTree_.findRootMostValueAndPath(e);return t!=null?n.writeTree_.get(t.path).getChild(ir(t.path,e)):null}function kE(n){const e=[],t=n.writeTree_.value;return t!=null?t.isLeafNode()||t.forEachChild(Nt,(r,s)=>{e.push(new Be(r,s))}):n.writeTree_.children.inorderTraversal((r,s)=>{s.value!=null&&e.push(new Be(r,s.value))}),e}function ao(n,e){if(Ue(e))return n;{const t=$a(n,e);return t!=null?new fs(new Ct(t)):new fs(n.writeTree_.subtree(e))}}function av(n){return n.writeTree_.isEmpty()}function Jl(n,e){return gk(rt(),n.writeTree_,e)}function gk(n,e,t){if(e.value!=null)return t.updateChild(n,e.value);{let r=null;return e.children.inorderTraversal((s,i)=>{s===".priority"?(Z(i.value!==null,"Priority writes must always be leaf nodes"),r=i.value):t=gk(zt(n,s),i,t)}),!t.getChild(n).isEmpty()&&r!==null&&(t=t.updateChild(zt(n,".priority"),r)),t}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Up(n,e){return wk(e,n)}function hV(n,e,t,r,s){Z(r>n.lastWriteId,"Stacking an older write on top of newer ones"),s===void 0&&(s=!0),n.allWrites.push({path:e,snap:t,writeId:r,visible:s}),s&&(n.visibleWrites=Mu(n.visibleWrites,e,t)),n.lastWriteId=r}function fV(n,e,t,r){Z(r>n.lastWriteId,"Stacking an older merge on top of newer ones"),n.allWrites.push({path:e,children:t,writeId:r,visible:!0}),n.visibleWrites=iv(n.visibleWrites,e,t),n.lastWriteId=r}function mV(n,e){for(let t=0;t<n.allWrites.length;t++){const r=n.allWrites[t];if(r.writeId===e)return r}return null}function pV(n,e){const t=n.allWrites.findIndex(a=>a.writeId===e);Z(t>=0,"removeWrite called with nonexistent writeId.");const r=n.allWrites[t];n.allWrites.splice(t,1);let s=r.visible,i=!1,o=n.allWrites.length-1;for(;s&&o>=0;){const a=n.allWrites[o];a.visible&&(o>=t&&gV(a,r.path)?s=!1:Gr(r.path,a.path)&&(i=!0)),o--}if(s){if(i)return yV(n),!0;if(r.snap)n.visibleWrites=CE(n.visibleWrites,r.path);else{const a=r.children;Ln(a,c=>{n.visibleWrites=CE(n.visibleWrites,zt(r.path,c))})}return!0}else return!1}function gV(n,e){if(n.snap)return Gr(n.path,e);for(const t in n.children)if(n.children.hasOwnProperty(t)&&Gr(zt(n.path,t),e))return!0;return!1}function yV(n){n.visibleWrites=yk(n.allWrites,_V,rt()),n.allWrites.length>0?n.lastWriteId=n.allWrites[n.allWrites.length-1].writeId:n.lastWriteId=-1}function _V(n){return n.visible}function yk(n,e,t){let r=fs.empty();for(let s=0;s<n.length;++s){const i=n[s];if(e(i)){const o=i.path;let a;if(i.snap)Gr(t,o)?(a=ir(t,o),r=Mu(r,a,i.snap)):Gr(o,t)&&(a=ir(o,t),r=Mu(r,rt(),i.snap.getChild(a)));else if(i.children){if(Gr(t,o))a=ir(t,o),r=iv(r,a,i.children);else if(Gr(o,t))if(a=ir(o,t),Ue(a))r=iv(r,rt(),i.children);else{const c=ya(i.children,$e(a));if(c){const u=c.getChild(St(a));r=Mu(r,rt(),u)}}}else throw Ec("WriteRecord should have .snap or .children")}}return r}function _k(n,e,t,r,s){if(!r&&!s){const i=$a(n.visibleWrites,e);if(i!=null)return i;{const o=ao(n.visibleWrites,e);if(av(o))return t;if(t==null&&!ov(o,rt()))return null;{const a=t||ke.EMPTY_NODE;return Jl(o,a)}}}else{const i=ao(n.visibleWrites,e);if(!s&&av(i))return t;if(!s&&t==null&&!ov(i,rt()))return null;{const o=function(u){return(u.visible||s)&&(!r||!~r.indexOf(u.writeId))&&(Gr(u.path,e)||Gr(e,u.path))},a=yk(n.allWrites,o,e),c=t||ke.EMPTY_NODE;return Jl(a,c)}}}function vV(n,e,t){let r=ke.EMPTY_NODE;const s=$a(n.visibleWrites,e);if(s)return s.isLeafNode()||s.forEachChild(Nt,(i,o)=>{r=r.updateImmediateChild(i,o)}),r;if(t){const i=ao(n.visibleWrites,e);return t.forEachChild(Nt,(o,a)=>{const c=Jl(ao(i,new ct(o)),a);r=r.updateImmediateChild(o,c)}),kE(i).forEach(o=>{r=r.updateImmediateChild(o.name,o.node)}),r}else{const i=ao(n.visibleWrites,e);return kE(i).forEach(o=>{r=r.updateImmediateChild(o.name,o.node)}),r}}function wV(n,e,t,r,s){Z(r||s,"Either existingEventSnap or existingServerSnap must exist");const i=zt(e,t);if(ov(n.visibleWrites,i))return null;{const o=ao(n.visibleWrites,i);return av(o)?s.getChild(t):Jl(o,s.getChild(t))}}function xV(n,e,t,r){const s=zt(e,t),i=$a(n.visibleWrites,s);if(i!=null)return i;if(r.isCompleteForChild(t)){const o=ao(n.visibleWrites,s);return Jl(o,r.getNode().getImmediateChild(t))}else return null}function SV(n,e){return $a(n.visibleWrites,e)}function IV(n,e,t,r,s,i,o){let a;const c=ao(n.visibleWrites,e),u=$a(c,rt());if(u!=null)a=u;else if(t!=null)a=Jl(c,t);else return[];if(a=a.withIndex(o),!a.isEmpty()&&!a.isLeafNode()){const h=[],f=o.getCompare(),m=i?a.getReverseIteratorFrom(r,o):a.getIteratorFrom(r,o);let y=m.getNext();for(;y&&h.length<s;)f(y,r)!==0&&h.push(y),y=m.getNext();return h}else return[]}function EV(){return{visibleWrites:fs.empty(),allWrites:[],lastWriteId:-1}}function Fm(n,e,t,r){return _k(n.writeTree,n.treePath,e,t,r)}function lw(n,e){return vV(n.writeTree,n.treePath,e)}function NE(n,e,t,r){return wV(n.writeTree,n.treePath,e,t,r)}function $m(n,e){return SV(n.writeTree,zt(n.treePath,e))}function bV(n,e,t,r,s,i){return IV(n.writeTree,n.treePath,e,t,r,s,i)}function cw(n,e,t){return xV(n.writeTree,n.treePath,e,t)}function vk(n,e){return wk(zt(n.treePath,e),n.writeTree)}function wk(n,e){return{treePath:n,writeTree:e}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class TV{constructor(){this.changeMap=new Map}trackChildChange(e){const t=e.type,r=e.childName;Z(t==="child_added"||t==="child_changed"||t==="child_removed","Only child changes supported for tracking"),Z(r!==".priority","Only non-priority child changes can be tracked.");const s=this.changeMap.get(r);if(s){const i=s.type;if(t==="child_added"&&i==="child_removed")this.changeMap.set(r,Sd(r,e.snapshotNode,s.snapshotNode));else if(t==="child_removed"&&i==="child_added")this.changeMap.delete(r);else if(t==="child_removed"&&i==="child_changed")this.changeMap.set(r,xd(r,s.oldSnap));else if(t==="child_changed"&&i==="child_added")this.changeMap.set(r,Kl(r,e.snapshotNode));else if(t==="child_changed"&&i==="child_changed")this.changeMap.set(r,Sd(r,e.snapshotNode,s.oldSnap));else throw Ec("Illegal combination of changes: "+e+" occurred after "+s)}else this.changeMap.set(r,e)}getChanges(){return Array.from(this.changeMap.values())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class AV{getCompleteChild(e){return null}getChildAfterChild(e,t,r){return null}}const xk=new AV;class uw{constructor(e,t,r=null){this.writes_=e,this.viewCache_=t,this.optCompleteServerCache_=r}getCompleteChild(e){const t=this.viewCache_.eventCache;if(t.isCompleteForChild(e))return t.getNode().getImmediateChild(e);{const r=this.optCompleteServerCache_!=null?new yo(this.optCompleteServerCache_,!0,!1):this.viewCache_.serverCache;return cw(this.writes_,e,r)}}getChildAfterChild(e,t,r){const s=this.optCompleteServerCache_!=null?this.optCompleteServerCache_:wa(this.viewCache_),i=bV(this.writes_,s,t,1,r,e);return i.length===0?null:i[0]}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function CV(n){return{filter:n}}function kV(n,e){Z(e.eventCache.getNode().isIndexed(n.filter.getIndex()),"Event snap not indexed"),Z(e.serverCache.getNode().isIndexed(n.filter.getIndex()),"Server snap not indexed")}function NV(n,e,t,r,s){const i=new TV;let o,a;if(t.type===cs.OVERWRITE){const u=t;u.source.fromUser?o=lv(n,e,u.path,u.snap,r,s,i):(Z(u.source.fromServer,"Unknown source."),a=u.source.tagged||e.serverCache.isFiltered()&&!Ue(u.path),o=Um(n,e,u.path,u.snap,r,s,a,i))}else if(t.type===cs.MERGE){const u=t;u.source.fromUser?o=DV(n,e,u.path,u.children,r,s,i):(Z(u.source.fromServer,"Unknown source."),a=u.source.tagged||e.serverCache.isFiltered(),o=cv(n,e,u.path,u.children,r,s,a,i))}else if(t.type===cs.ACK_USER_WRITE){const u=t;u.revert?o=jV(n,e,u.path,r,s,i):o=PV(n,e,u.path,u.affectedTree,r,s,i)}else if(t.type===cs.LISTEN_COMPLETE)o=OV(n,e,t.path,r,i);else throw Ec("Unknown operation type: "+t.type);const c=i.getChanges();return RV(e,o,c),{viewCache:o,changes:c}}function RV(n,e,t){const r=e.eventCache;if(r.isFullyInitialized()){const s=r.getNode().isLeafNode()||r.getNode().isEmpty(),i=Vm(n);(t.length>0||!n.eventCache.isFullyInitialized()||s&&!r.getNode().equals(i)||!r.getNode().getPriority().equals(i.getPriority()))&&t.push(mk(Vm(e)))}}function Sk(n,e,t,r,s,i){const o=e.eventCache;if($m(r,t)!=null)return e;{let a,c;if(Ue(t))if(Z(e.serverCache.isFullyInitialized(),"If change path is empty, we must have complete server data"),e.serverCache.isFiltered()){const u=wa(e),h=u instanceof ke?u:ke.EMPTY_NODE,f=lw(r,h);a=n.filter.updateFullNode(e.eventCache.getNode(),f,i)}else{const u=Fm(r,wa(e));a=n.filter.updateFullNode(e.eventCache.getNode(),u,i)}else{const u=$e(t);if(u===".priority"){Z(go(t)===1,"Can't have a priority with additional path components");const h=o.getNode();c=e.serverCache.getNode();const f=NE(r,t,h,c);f!=null?a=n.filter.updatePriority(h,f):a=o.getNode()}else{const h=St(t);let f;if(o.isCompleteForChild(u)){c=e.serverCache.getNode();const m=NE(r,t,o.getNode(),c);m!=null?f=o.getNode().getImmediateChild(u).updateChild(h,m):f=o.getNode().getImmediateChild(u)}else f=cw(r,u,e.serverCache);f!=null?a=n.filter.updateChild(o.getNode(),u,f,h,s,i):a=o.getNode()}}return Lu(e,a,o.isFullyInitialized()||Ue(t),n.filter.filtersNodes())}}function Um(n,e,t,r,s,i,o,a){const c=e.serverCache;let u;const h=o?n.filter:n.filter.getIndexedFilter();if(Ue(t))u=h.updateFullNode(c.getNode(),r,null);else if(h.filtersNodes()&&!c.isFiltered()){const y=c.getNode().updateChild(t,r);u=h.updateFullNode(c.getNode(),y,null)}else{const y=$e(t);if(!c.isCompleteForPath(t)&&go(t)>1)return e;const w=St(t),R=c.getNode().getImmediateChild(y).updateChild(w,r);y===".priority"?u=h.updatePriority(c.getNode(),R):u=h.updateChild(c.getNode(),y,R,w,xk,null)}const f=pk(e,u,c.isFullyInitialized()||Ue(t),h.filtersNodes()),m=new uw(s,f,i);return Sk(n,f,t,s,m,a)}function lv(n,e,t,r,s,i,o){const a=e.eventCache;let c,u;const h=new uw(s,e,i);if(Ue(t))u=n.filter.updateFullNode(e.eventCache.getNode(),r,o),c=Lu(e,u,!0,n.filter.filtersNodes());else{const f=$e(t);if(f===".priority")u=n.filter.updatePriority(e.eventCache.getNode(),r),c=Lu(e,u,a.isFullyInitialized(),a.isFiltered());else{const m=St(t),y=a.getNode().getImmediateChild(f);let w;if(Ue(m))w=r;else{const S=h.getCompleteChild(f);S!=null?J0(m)===".priority"&&S.getChild(ak(m)).isEmpty()?w=S:w=S.updateChild(m,r):w=ke.EMPTY_NODE}if(y.equals(w))c=e;else{const S=n.filter.updateChild(a.getNode(),f,w,m,h,o);c=Lu(e,S,a.isFullyInitialized(),n.filter.filtersNodes())}}}return c}function RE(n,e){return n.eventCache.isCompleteForChild(e)}function DV(n,e,t,r,s,i,o){let a=e;return r.foreach((c,u)=>{const h=zt(t,c);RE(e,$e(h))&&(a=lv(n,a,h,u,s,i,o))}),r.foreach((c,u)=>{const h=zt(t,c);RE(e,$e(h))||(a=lv(n,a,h,u,s,i,o))}),a}function DE(n,e,t){return t.foreach((r,s)=>{e=e.updateChild(r,s)}),e}function cv(n,e,t,r,s,i,o,a){if(e.serverCache.getNode().isEmpty()&&!e.serverCache.isFullyInitialized())return e;let c=e,u;Ue(t)?u=r:u=new Ct(null).setTree(t,r);const h=e.serverCache.getNode();return u.children.inorderTraversal((f,m)=>{if(h.hasChild(f)){const y=e.serverCache.getNode().getImmediateChild(f),w=DE(n,y,m);c=Um(n,c,new ct(f),w,s,i,o,a)}}),u.children.inorderTraversal((f,m)=>{const y=!e.serverCache.isCompleteForChild(f)&&m.value===null;if(!h.hasChild(f)&&!y){const w=e.serverCache.getNode().getImmediateChild(f),S=DE(n,w,m);c=Um(n,c,new ct(f),S,s,i,o,a)}}),c}function PV(n,e,t,r,s,i,o){if($m(s,t)!=null)return e;const a=e.serverCache.isFiltered(),c=e.serverCache;if(r.value!=null){if(Ue(t)&&c.isFullyInitialized()||c.isCompleteForPath(t))return Um(n,e,t,c.getNode().getChild(t),s,i,a,o);if(Ue(t)){let u=new Ct(null);return c.getNode().forEachChild(Ls,(h,f)=>{u=u.set(new ct(h),f)}),cv(n,e,t,u,s,i,a,o)}else return e}else{let u=new Ct(null);return r.foreach((h,f)=>{const m=zt(t,h);c.isCompleteForPath(m)&&(u=u.set(h,c.getNode().getChild(m)))}),cv(n,e,t,u,s,i,a,o)}}function OV(n,e,t,r,s){const i=e.serverCache,o=pk(e,i.getNode(),i.isFullyInitialized()||Ue(t),i.isFiltered());return Sk(n,o,t,r,xk,s)}function jV(n,e,t,r,s,i){let o;if($m(r,t)!=null)return e;{const a=new uw(r,e,s),c=e.eventCache.getNode();let u;if(Ue(t)||$e(t)===".priority"){let h;if(e.serverCache.isFullyInitialized())h=Fm(r,wa(e));else{const f=e.serverCache.getNode();Z(f instanceof ke,"serverChildren would be complete if leaf node"),h=lw(r,f)}h=h,u=n.filter.updateFullNode(c,h,i)}else{const h=$e(t);let f=cw(r,h,e.serverCache);f==null&&e.serverCache.isCompleteForChild(h)&&(f=c.getImmediateChild(h)),f!=null?u=n.filter.updateChild(c,h,f,St(t),a,i):e.eventCache.getNode().hasChild(h)?u=n.filter.updateChild(c,h,ke.EMPTY_NODE,St(t),a,i):u=c,u.isEmpty()&&e.serverCache.isFullyInitialized()&&(o=Fm(r,wa(e)),o.isLeafNode()&&(u=n.filter.updateFullNode(u,o,i)))}return o=e.serverCache.isFullyInitialized()||$m(r,rt())!=null,Lu(e,u,o,n.filter.filtersNodes())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class LV{constructor(e,t){this.query_=e,this.eventRegistrations_=[];const r=this.query_._queryParams,s=new rw(r.getIndex()),i=Y4(r);this.processor_=CV(i);const o=t.serverCache,a=t.eventCache,c=s.updateFullNode(ke.EMPTY_NODE,o.getNode(),null),u=i.updateFullNode(ke.EMPTY_NODE,a.getNode(),null),h=new yo(c,o.isFullyInitialized(),s.filtersNodes()),f=new yo(u,a.isFullyInitialized(),i.filtersNodes());this.viewCache_=$p(f,h),this.eventGenerator_=new aV(this.query_)}get query(){return this.query_}}function MV(n){return n.viewCache_.serverCache.getNode()}function VV(n){return Vm(n.viewCache_)}function FV(n,e){const t=wa(n.viewCache_);return t&&(n.query._queryParams.loadsAllData()||!Ue(e)&&!t.getImmediateChild($e(e)).isEmpty())?t.getChild(e):null}function PE(n){return n.eventRegistrations_.length===0}function $V(n,e){n.eventRegistrations_.push(e)}function OE(n,e,t){const r=[];if(t){Z(e==null,"A cancel should cancel all event registrations.");const s=n.query._path;n.eventRegistrations_.forEach(i=>{const o=i.createCancelEvent(t,s);o&&r.push(o)})}if(e){let s=[];for(let i=0;i<n.eventRegistrations_.length;++i){const o=n.eventRegistrations_[i];if(!o.matches(e))s.push(o);else if(e.hasAnyCallback()){s=s.concat(n.eventRegistrations_.slice(i+1));break}}n.eventRegistrations_=s}else n.eventRegistrations_=[];return r}function jE(n,e,t,r){e.type===cs.MERGE&&e.source.queryId!==null&&(Z(wa(n.viewCache_),"We should always have a full cache before handling merges"),Z(Vm(n.viewCache_),"Missing event cache, even though we have a server cache"));const s=n.viewCache_,i=NV(n.processor_,s,e,t,r);return kV(n.processor_,i.viewCache),Z(i.viewCache.serverCache.isFullyInitialized()||!s.serverCache.isFullyInitialized(),"Once a server snap is complete, it should never go back"),n.viewCache_=i.viewCache,Ik(n,i.changes,i.viewCache.eventCache.getNode(),null)}function UV(n,e){const t=n.viewCache_.eventCache,r=[];return t.getNode().isLeafNode()||t.getNode().forEachChild(Nt,(i,o)=>{r.push(Kl(i,o))}),t.isFullyInitialized()&&r.push(mk(t.getNode())),Ik(n,r,t.getNode(),e)}function Ik(n,e,t,r){const s=r?[r]:n.eventRegistrations_;return lV(n.eventGenerator_,e,t,s)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Bm;class Ek{constructor(){this.views=new Map}}function BV(n){Z(!Bm,"__referenceConstructor has already been defined"),Bm=n}function zV(){return Z(Bm,"Reference.ts has not been loaded"),Bm}function qV(n){return n.views.size===0}function dw(n,e,t,r){const s=e.source.queryId;if(s!==null){const i=n.views.get(s);return Z(i!=null,"SyncTree gave us an op for an invalid query."),jE(i,e,t,r)}else{let i=[];for(const o of n.views.values())i=i.concat(jE(o,e,t,r));return i}}function bk(n,e,t,r,s){const i=e._queryIdentifier,o=n.views.get(i);if(!o){let a=Fm(t,s?r:null),c=!1;a?c=!0:r instanceof ke?(a=lw(t,r),c=!1):(a=ke.EMPTY_NODE,c=!1);const u=$p(new yo(a,c,!1),new yo(r,s,!1));return new LV(e,u)}return o}function WV(n,e,t,r,s,i){const o=bk(n,e,r,s,i);return n.views.has(e._queryIdentifier)||n.views.set(e._queryIdentifier,o),$V(o,t),UV(o,t)}function GV(n,e,t,r){const s=e._queryIdentifier,i=[];let o=[];const a=_o(n);if(s==="default")for(const[c,u]of n.views.entries())o=o.concat(OE(u,t,r)),PE(u)&&(n.views.delete(c),u.query._queryParams.loadsAllData()||i.push(u.query));else{const c=n.views.get(s);c&&(o=o.concat(OE(c,t,r)),PE(c)&&(n.views.delete(s),c.query._queryParams.loadsAllData()||i.push(c.query)))}return a&&!_o(n)&&i.push(new(zV())(e._repo,e._path)),{removed:i,events:o}}function Tk(n){const e=[];for(const t of n.views.values())t.query._queryParams.loadsAllData()||e.push(t);return e}function lo(n,e){let t=null;for(const r of n.views.values())t=t||FV(r,e);return t}function Ak(n,e){if(e._queryParams.loadsAllData())return Bp(n);{const r=e._queryIdentifier;return n.views.get(r)}}function Ck(n,e){return Ak(n,e)!=null}function _o(n){return Bp(n)!=null}function Bp(n){for(const e of n.views.values())if(e.query._queryParams.loadsAllData())return e;return null}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let zm;function HV(n){Z(!zm,"__referenceConstructor has already been defined"),zm=n}function QV(){return Z(zm,"Reference.ts has not been loaded"),zm}let KV=1;class LE{constructor(e){this.listenProvider_=e,this.syncPointTree_=new Ct(null),this.pendingWriteTree_=EV(),this.tagToQueryMap=new Map,this.queryToTagMap=new Map}}function hw(n,e,t,r,s){return hV(n.pendingWriteTree_,e,t,r,s),s?Ac(n,new va(iw(),e,t)):[]}function YV(n,e,t,r){fV(n.pendingWriteTree_,e,t,r);const s=Ct.fromObject(t);return Ac(n,new Yl(iw(),e,s))}function Hi(n,e,t=!1){const r=mV(n.pendingWriteTree_,e);if(pV(n.pendingWriteTree_,e)){let i=new Ct(null);return r.snap!=null?i=i.set(rt(),!0):Ln(r.children,o=>{i=i.set(new ct(o),!0)}),Ac(n,new Mm(r.path,i,t))}else return[]}function rh(n,e,t){return Ac(n,new va(ow(),e,t))}function JV(n,e,t){const r=Ct.fromObject(t);return Ac(n,new Yl(ow(),e,r))}function XV(n,e){return Ac(n,new Ed(ow(),e))}function ZV(n,e,t){const r=fw(n,t);if(r){const s=mw(r),i=s.path,o=s.queryId,a=ir(i,e),c=new Ed(aw(o),a);return pw(n,i,c)}else return[]}function qm(n,e,t,r,s=!1){const i=e._path,o=n.syncPointTree_.get(i);let a=[];if(o&&(e._queryIdentifier==="default"||Ck(o,e))){const c=GV(o,e,t,r);qV(o)&&(n.syncPointTree_=n.syncPointTree_.remove(i));const u=c.removed;if(a=c.events,!s){const h=u.findIndex(m=>m._queryParams.loadsAllData())!==-1,f=n.syncPointTree_.findOnPath(i,(m,y)=>_o(y));if(h&&!f){const m=n.syncPointTree_.subtree(i);if(!m.isEmpty()){const y=nF(m);for(let w=0;w<y.length;++w){const S=y[w],R=S.query,T=Dk(n,S);n.listenProvider_.startListening(Vu(R),bd(n,R),T.hashFn,T.onComplete)}}}!f&&u.length>0&&!r&&(h?n.listenProvider_.stopListening(Vu(e),null):u.forEach(m=>{const y=n.queryToTagMap.get(qp(m));n.listenProvider_.stopListening(Vu(m),y)}))}rF(n,u)}return a}function kk(n,e,t,r){const s=fw(n,r);if(s!=null){const i=mw(s),o=i.path,a=i.queryId,c=ir(o,e),u=new va(aw(a),c,t);return pw(n,o,u)}else return[]}function eF(n,e,t,r){const s=fw(n,r);if(s){const i=mw(s),o=i.path,a=i.queryId,c=ir(o,e),u=Ct.fromObject(t),h=new Yl(aw(a),c,u);return pw(n,o,h)}else return[]}function uv(n,e,t,r=!1){const s=e._path;let i=null,o=!1;n.syncPointTree_.foreachOnPath(s,(m,y)=>{const w=ir(m,s);i=i||lo(y,w),o=o||_o(y)});let a=n.syncPointTree_.get(s);a?(o=o||_o(a),i=i||lo(a,rt())):(a=new Ek,n.syncPointTree_=n.syncPointTree_.set(s,a));let c;i!=null?c=!0:(c=!1,i=ke.EMPTY_NODE,n.syncPointTree_.subtree(s).foreachChild((y,w)=>{const S=lo(w,rt());S&&(i=i.updateImmediateChild(y,S))}));const u=Ck(a,e);if(!u&&!e._queryParams.loadsAllData()){const m=qp(e);Z(!n.queryToTagMap.has(m),"View does not exist, but we have a tag");const y=sF();n.queryToTagMap.set(m,y),n.tagToQueryMap.set(y,m)}const h=Up(n.pendingWriteTree_,s);let f=WV(a,e,t,h,i,c);if(!u&&!o&&!r){const m=Ak(a,e);f=f.concat(iF(n,e,m))}return f}function zp(n,e,t){const s=n.pendingWriteTree_,i=n.syncPointTree_.findOnPath(e,(o,a)=>{const c=ir(o,e),u=lo(a,c);if(u)return u});return _k(s,e,i,t,!0)}function tF(n,e){const t=e._path;let r=null;n.syncPointTree_.foreachOnPath(t,(u,h)=>{const f=ir(u,t);r=r||lo(h,f)});let s=n.syncPointTree_.get(t);s?r=r||lo(s,rt()):(s=new Ek,n.syncPointTree_=n.syncPointTree_.set(t,s));const i=r!=null,o=i?new yo(r,!0,!1):null,a=Up(n.pendingWriteTree_,e._path),c=bk(s,e,a,i?o.getNode():ke.EMPTY_NODE,i);return VV(c)}function Ac(n,e){return Nk(e,n.syncPointTree_,null,Up(n.pendingWriteTree_,rt()))}function Nk(n,e,t,r){if(Ue(n.path))return Rk(n,e,t,r);{const s=e.get(rt());t==null&&s!=null&&(t=lo(s,rt()));let i=[];const o=$e(n.path),a=n.operationForChild(o),c=e.children.get(o);if(c&&a){const u=t?t.getImmediateChild(o):null,h=vk(r,o);i=i.concat(Nk(a,c,u,h))}return s&&(i=i.concat(dw(s,n,r,t))),i}}function Rk(n,e,t,r){const s=e.get(rt());t==null&&s!=null&&(t=lo(s,rt()));let i=[];return e.children.inorderTraversal((o,a)=>{const c=t?t.getImmediateChild(o):null,u=vk(r,o),h=n.operationForChild(o);h&&(i=i.concat(Rk(h,a,c,u)))}),s&&(i=i.concat(dw(s,n,r,t))),i}function Dk(n,e){const t=e.query,r=bd(n,t);return{hashFn:()=>(MV(e)||ke.EMPTY_NODE).hash(),onComplete:s=>{if(s==="ok")return r?ZV(n,t._path,r):XV(n,t._path);{const i=YM(s,t);return qm(n,t,null,i)}}}}function bd(n,e){const t=qp(e);return n.queryToTagMap.get(t)}function qp(n){return n._path.toString()+"$"+n._queryIdentifier}function fw(n,e){return n.tagToQueryMap.get(e)}function mw(n){const e=n.indexOf("$");return Z(e!==-1&&e<n.length-1,"Bad queryKey."),{queryId:n.substr(e+1),path:new ct(n.substr(0,e))}}function pw(n,e,t){const r=n.syncPointTree_.get(e);Z(r,"Missing sync point for query tag that we're tracking");const s=Up(n.pendingWriteTree_,e);return dw(r,t,s,null)}function nF(n){return n.fold((e,t,r)=>{if(t&&_o(t))return[Bp(t)];{let s=[];return t&&(s=Tk(t)),Ln(r,(i,o)=>{s=s.concat(o)}),s}})}function Vu(n){return n._queryParams.loadsAllData()&&!n._queryParams.isDefault()?new(QV())(n._repo,n._path):n}function rF(n,e){for(let t=0;t<e.length;++t){const r=e[t];if(!r._queryParams.loadsAllData()){const s=qp(r),i=n.queryToTagMap.get(s);n.queryToTagMap.delete(s),n.tagToQueryMap.delete(i)}}}function sF(){return KV++}function iF(n,e,t){const r=e._path,s=bd(n,e),i=Dk(n,t),o=n.listenProvider_.startListening(Vu(e),s,i.hashFn,i.onComplete),a=n.syncPointTree_.subtree(r);if(s)Z(!_o(a.value),"If we're adding a query, it shouldn't be shadowed");else{const c=a.fold((u,h,f)=>{if(!Ue(u)&&h&&_o(h))return[Bp(h).query];{let m=[];return h&&(m=m.concat(Tk(h).map(y=>y.query))),Ln(f,(y,w)=>{m=m.concat(w)}),m}});for(let u=0;u<c.length;++u){const h=c[u];n.listenProvider_.stopListening(Vu(h),bd(n,h))}}return o}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class gw{constructor(e){this.node_=e}getImmediateChild(e){const t=this.node_.getImmediateChild(e);return new gw(t)}node(){return this.node_}}class yw{constructor(e,t){this.syncTree_=e,this.path_=t}getImmediateChild(e){const t=zt(this.path_,e);return new yw(this.syncTree_,t)}node(){return zp(this.syncTree_,this.path_)}}const oF=function(n){return n=n||{},n.timestamp=n.timestamp||new Date().getTime(),n},ME=function(n,e,t){if(!n||typeof n!="object")return n;if(Z(".sv"in n,"Unexpected leaf node or priority contents"),typeof n[".sv"]=="string")return aF(n[".sv"],e,t);if(typeof n[".sv"]=="object")return lF(n[".sv"],e);Z(!1,"Unexpected server value: "+JSON.stringify(n,null,2))},aF=function(n,e,t){switch(n){case"timestamp":return t.timestamp;default:Z(!1,"Unexpected server value: "+n)}},lF=function(n,e,t){n.hasOwnProperty("increment")||Z(!1,"Unexpected server value: "+JSON.stringify(n,null,2));const r=n.increment;typeof r!="number"&&Z(!1,"Unexpected increment value: "+r);const s=e.node();if(Z(s!==null&&typeof s<"u","Expected ChildrenNode.EMPTY_NODE for nulls"),!s.isLeafNode())return r;const o=s.getValue();return typeof o!="number"?r:o+r},Pk=function(n,e,t,r){return vw(e,new yw(t,n),r)},_w=function(n,e,t){return vw(n,new gw(e),t)};function vw(n,e,t){const r=n.getPriority().val(),s=ME(r,e.getImmediateChild(".priority"),t);let i;if(n.isLeafNode()){const o=n,a=ME(o.getValue(),e,t);return a!==o.getValue()||s!==o.getPriority().val()?new An(a,Yt(s)):n}else{const o=n;return i=o,s!==o.getPriority().val()&&(i=i.updatePriority(new An(s))),o.forEachChild(Nt,(a,c)=>{const u=vw(c,e.getImmediateChild(a),t);u!==c&&(i=i.updateImmediateChild(a,u))}),i}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ww{constructor(e="",t=null,r={children:{},childCount:0}){this.name=e,this.parent=t,this.node=r}}function Wp(n,e){let t=e instanceof ct?e:new ct(e),r=n,s=$e(t);for(;s!==null;){const i=ya(r.node.children,s)||{children:{},childCount:0};r=new ww(s,r,i),t=St(t),s=$e(t)}return r}function Ua(n){return n.node.value}function xw(n,e){n.node.value=e,dv(n)}function Ok(n){return n.node.childCount>0}function cF(n){return Ua(n)===void 0&&!Ok(n)}function Gp(n,e){Ln(n.node.children,(t,r)=>{e(new ww(t,n,r))})}function jk(n,e,t,r){t&&!r&&e(n),Gp(n,s=>{jk(s,e,!0,r)}),t&&r&&e(n)}function uF(n,e,t){let r=t?n:n.parent;for(;r!==null;){if(e(r))return!0;r=r.parent}return!1}function sh(n){return new ct(n.parent===null?n.name:sh(n.parent)+"/"+n.name)}function dv(n){n.parent!==null&&dF(n.parent,n.name,n)}function dF(n,e,t){const r=cF(t),s=_s(n.node.children,e);r&&s?(delete n.node.children[e],n.node.childCount--,dv(n)):!r&&!s&&(n.node.children[e]=t.node,n.node.childCount++,dv(n))}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const hF=/[\[\].#$\/\u0000-\u001F\u007F]/,fF=/[\[\].#$\u0000-\u001F\u007F]/,Ny=10*1024*1024,Hp=function(n){return typeof n=="string"&&n.length!==0&&!hF.test(n)},Lk=function(n){return typeof n=="string"&&n.length!==0&&!fF.test(n)},mF=function(n){return n&&(n=n.replace(/^\/*\.info(\/|$)/,"/")),Lk(n)},Td=function(n){return n===null||typeof n=="string"||typeof n=="number"&&!Mp(n)||n&&typeof n=="object"&&_s(n,".sv")},zs=function(n,e,t,r){r&&e===void 0||ih(_a(n,"value"),e,t)},ih=function(n,e,t){const r=t instanceof ct?new N4(t,n):t;if(e===void 0)throw new Error(n+"contains undefined "+qo(r));if(typeof e=="function")throw new Error(n+"contains a function "+qo(r)+" with contents = "+e.toString());if(Mp(e))throw new Error(n+"contains "+e.toString()+" "+qo(r));if(typeof e=="string"&&e.length>Ny/3&&Lp(e)>Ny)throw new Error(n+"contains a string greater than "+Ny+" utf8 bytes "+qo(r)+" ('"+e.substring(0,50)+"...')");if(e&&typeof e=="object"){let s=!1,i=!1;if(Ln(e,(o,a)=>{if(o===".value")s=!0;else if(o!==".priority"&&o!==".sv"&&(i=!0,!Hp(o)))throw new Error(n+" contains an invalid key ("+o+") "+qo(r)+`.  Keys must be non-empty strings and can't contain ".", "#", "$", "/", "[", or "]"`);R4(r,o),ih(n,a,r),D4(r)}),s&&i)throw new Error(n+' contains ".value" child '+qo(r)+" in addition to actual children.")}},pF=function(n,e){let t,r;for(t=0;t<e.length;t++){r=e[t];const i=wd(r);for(let o=0;o<i.length;o++)if(!(i[o]===".priority"&&o===i.length-1)){if(!Hp(i[o]))throw new Error(n+"contains an invalid key ("+i[o]+") in path "+r.toString()+`. Keys must be non-empty strings and can't contain ".", "#", "$", "/", "[", or "]"`)}}e.sort(k4);let s=null;for(t=0;t<e.length;t++){if(r=e[t],s!==null&&Gr(s,r))throw new Error(n+"contains a path "+s.toString()+" that is ancestor of another path "+r.toString());s=r}},Mk=function(n,e,t,r){if(r&&e===void 0)return;const s=_a(n,"values");if(!(e&&typeof e=="object")||Array.isArray(e))throw new Error(s+" must be an object containing the children to replace.");const i=[];Ln(e,(o,a)=>{const c=new ct(o);if(ih(s,a,zt(t,c)),J0(c)===".priority"&&!Td(a))throw new Error(s+"contains an invalid value for '"+c.toString()+"', which must be a valid Firebase priority (a string, finite number, server value, or null).");i.push(c)}),pF(s,i)},Sw=function(n,e,t){if(!(t&&e===void 0)){if(Mp(e))throw new Error(_a(n,"priority")+"is "+e.toString()+", but must be a valid Firebase priority (a string, finite number, server value, or null).");if(!Td(e))throw new Error(_a(n,"priority")+"must be a valid Firebase priority (a string, finite number, server value, or null).")}},oh=function(n,e,t,r){if(!(r&&t===void 0)&&!Hp(t))throw new Error(_a(n,e)+'was an invalid key = "'+t+`".  Firebase keys must be non-empty strings and can't contain ".", "#", "$", "/", "[", or "]").`)},Iw=function(n,e,t,r){if(!(r&&t===void 0)&&!Lk(t))throw new Error(_a(n,e)+'was an invalid path = "'+t+`". Paths must be non-empty strings and can't contain ".", "#", "$", "[", or "]"`)},gF=function(n,e,t,r){t&&(t=t.replace(/^\/*\.info(\/|$)/,"/")),Iw(n,e,t,r)},Cs=function(n,e){if($e(e)===".info")throw new Error(n+" failed = Can't modify data under /.info/")},Vk=function(n,e){const t=e.path.toString();if(typeof e.repoInfo.host!="string"||e.repoInfo.host.length===0||!Hp(e.repoInfo.namespace)&&e.repoInfo.host.split(":")[0]!=="localhost"||t.length!==0&&!mF(t))throw new Error(_a(n,"url")+`must be a valid firebase URL and the path can't contain ".", "#", "$", "[", or "]".`)};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class yF{constructor(){this.eventLists_=[],this.recursionDepth_=0}}function Qp(n,e){let t=null;for(let r=0;r<e.length;r++){const s=e[r],i=s.getPath();t!==null&&!X0(i,t.path)&&(n.eventLists_.push(t),t=null),t===null&&(t={events:[],path:i}),t.events.push(s)}t&&n.eventLists_.push(t)}function Fk(n,e,t){Qp(n,t),$k(n,r=>X0(r,e))}function Lr(n,e,t){Qp(n,t),$k(n,r=>Gr(r,e)||Gr(e,r))}function $k(n,e){n.recursionDepth_++;let t=!0;for(let r=0;r<n.eventLists_.length;r++){const s=n.eventLists_[r];if(s){const i=s.path;e(i)?(_F(n.eventLists_[r]),n.eventLists_[r]=null):t=!1}}t&&(n.eventLists_=[]),n.recursionDepth_--}function _F(n){for(let e=0;e<n.events.length;e++){const t=n.events[e];if(t!==null){n.events[e]=null;const r=t.getEventRunner();aa&&Dn("event: "+t.toString()),bc(r)}}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Uk="repo_interrupt",vF=25;class wF{constructor(e,t,r,s){this.repoInfo_=e,this.forceRestClient_=t,this.authTokenProvider_=r,this.appCheckProvider_=s,this.dataUpdateCount=0,this.statsListener_=null,this.eventQueue_=new yF,this.nextWriteId_=1,this.interceptServerDataCallback_=null,this.onDisconnect_=Lm(),this.transactionQueueTree_=new ww,this.persistentConnection_=null,this.key=this.repoInfo_.toURLString()}toString(){return(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host}}function xF(n,e,t){if(n.stats_=K0(n.repoInfo_),n.forceRestClient_||e4())n.server_=new jm(n.repoInfo_,(r,s,i,o)=>{VE(n,r,s,i,o)},n.authTokenProvider_,n.appCheckProvider_),setTimeout(()=>FE(n,!0),0);else{if(typeof t<"u"&&t!==null){if(typeof t!="object")throw new Error("Only objects are supported for option databaseAuthVariableOverride");try{Sn(t)}catch(r){throw new Error("Invalid authOverride provided: "+r)}}n.persistentConnection_=new Qr(n.repoInfo_,e,(r,s,i,o)=>{VE(n,r,s,i,o)},r=>{FE(n,r)},r=>{SF(n,r)},n.authTokenProvider_,n.appCheckProvider_,t),n.server_=n.persistentConnection_}n.authTokenProvider_.addTokenChangeListener(r=>{n.server_.refreshAuthToken(r)}),n.appCheckProvider_.addTokenChangeListener(r=>{n.server_.refreshAppCheckToken(r.token)}),n.statsReporter_=i4(n.repoInfo_,()=>new oV(n.stats_,n.server_)),n.infoData_=new tV,n.infoSyncTree_=new LE({startListening:(r,s,i,o)=>{let a=[];const c=n.infoData_.getNode(r._path);return c.isEmpty()||(a=rh(n.infoSyncTree_,r._path,c),setTimeout(()=>{o("ok")},0)),a},stopListening:()=>{}}),Ew(n,"connected",!1),n.serverSyncTree_=new LE({startListening:(r,s,i,o)=>(n.server_.listen(r,i,s,(a,c)=>{const u=o(a,c);Lr(n.eventQueue_,r._path,u)}),[]),stopListening:(r,s)=>{n.server_.unlisten(r,s)}})}function Bk(n){const t=n.infoData_.getNode(new ct(".info/serverTimeOffset")).val()||0;return new Date().getTime()+t}function ah(n){return oF({timestamp:Bk(n)})}function VE(n,e,t,r,s){n.dataUpdateCount++;const i=new ct(e);t=n.interceptServerDataCallback_?n.interceptServerDataCallback_(e,t):t;let o=[];if(s)if(r){const c=Nm(t,u=>Yt(u));o=eF(n.serverSyncTree_,i,c,s)}else{const c=Yt(t);o=kk(n.serverSyncTree_,i,c,s)}else if(r){const c=Nm(t,u=>Yt(u));o=JV(n.serverSyncTree_,i,c)}else{const c=Yt(t);o=rh(n.serverSyncTree_,i,c)}let a=i;o.length>0&&(a=Xl(n,i)),Lr(n.eventQueue_,a,o)}function FE(n,e){Ew(n,"connected",e),e===!1&&bF(n)}function SF(n,e){Ln(e,(t,r)=>{Ew(n,t,r)})}function Ew(n,e,t){const r=new ct("/.info/"+e),s=Yt(t);n.infoData_.updateSnapshot(r,s);const i=rh(n.infoSyncTree_,r,s);Lr(n.eventQueue_,r,i)}function Kp(n){return n.nextWriteId_++}function IF(n,e,t){const r=tF(n.serverSyncTree_,e);return r!=null?Promise.resolve(r):n.server_.get(e).then(s=>{const i=Yt(s).withIndex(e._queryParams.getIndex());uv(n.serverSyncTree_,e,t,!0);let o;if(e._queryParams.loadsAllData())o=rh(n.serverSyncTree_,e._path,i);else{const a=bd(n.serverSyncTree_,e);o=kk(n.serverSyncTree_,e._path,i,a)}return Lr(n.eventQueue_,e._path,o),qm(n.serverSyncTree_,e,t,null,!0),i},s=>(Cc(n,"get for query "+Sn(e)+" failed: "+s),Promise.reject(new Error(s))))}function bw(n,e,t,r,s){Cc(n,"set",{path:e.toString(),value:t,priority:r});const i=ah(n),o=Yt(t,r),a=zp(n.serverSyncTree_,e),c=_w(o,a,i),u=Kp(n),h=hw(n.serverSyncTree_,e,c,u,!0);Qp(n.eventQueue_,h),n.server_.put(e.toString(),o.val(!0),(m,y)=>{const w=m==="ok";w||er("set at "+e+" failed: "+m);const S=Hi(n.serverSyncTree_,u,!w);Lr(n.eventQueue_,e,S),vo(n,s,m,y)});const f=Aw(n,e);Xl(n,f),Lr(n.eventQueue_,f,[])}function EF(n,e,t,r){Cc(n,"update",{path:e.toString(),value:t});let s=!0;const i=ah(n),o={};if(Ln(t,(a,c)=>{s=!1,o[a]=Pk(zt(e,a),Yt(c),n.serverSyncTree_,i)}),s)Dn("update() called with empty data.  Don't do anything."),vo(n,r,"ok",void 0);else{const a=Kp(n),c=YV(n.serverSyncTree_,e,o,a);Qp(n.eventQueue_,c),n.server_.merge(e.toString(),t,(u,h)=>{const f=u==="ok";f||er("update at "+e+" failed: "+u);const m=Hi(n.serverSyncTree_,a,!f),y=m.length>0?Xl(n,e):e;Lr(n.eventQueue_,y,m),vo(n,r,u,h)}),Ln(t,u=>{const h=Aw(n,zt(e,u));Xl(n,h)}),Lr(n.eventQueue_,e,[])}}function bF(n){Cc(n,"onDisconnectEvents");const e=ah(n),t=Lm();sv(n.onDisconnect_,rt(),(s,i)=>{const o=Pk(s,i,n.serverSyncTree_,e);Tc(t,s,o)});let r=[];sv(t,rt(),(s,i)=>{r=r.concat(rh(n.serverSyncTree_,s,i));const o=Aw(n,s);Xl(n,o)}),n.onDisconnect_=Lm(),Lr(n.eventQueue_,rt(),r)}function TF(n,e,t){n.server_.onDisconnectCancel(e.toString(),(r,s)=>{r==="ok"&&rv(n.onDisconnect_,e),vo(n,t,r,s)})}function $E(n,e,t,r){const s=Yt(t);n.server_.onDisconnectPut(e.toString(),s.val(!0),(i,o)=>{i==="ok"&&Tc(n.onDisconnect_,e,s),vo(n,r,i,o)})}function AF(n,e,t,r,s){const i=Yt(t,r);n.server_.onDisconnectPut(e.toString(),i.val(!0),(o,a)=>{o==="ok"&&Tc(n.onDisconnect_,e,i),vo(n,s,o,a)})}function CF(n,e,t,r){if(km(t)){Dn("onDisconnect().update() called with empty data.  Don't do anything."),vo(n,r,"ok",void 0);return}n.server_.onDisconnectMerge(e.toString(),t,(s,i)=>{s==="ok"&&Ln(t,(o,a)=>{const c=Yt(a);Tc(n.onDisconnect_,zt(e,o),c)}),vo(n,r,s,i)})}function kF(n,e,t){let r;$e(e._path)===".info"?r=uv(n.infoSyncTree_,e,t):r=uv(n.serverSyncTree_,e,t),Fk(n.eventQueue_,e._path,r)}function hv(n,e,t){let r;$e(e._path)===".info"?r=qm(n.infoSyncTree_,e,t):r=qm(n.serverSyncTree_,e,t),Fk(n.eventQueue_,e._path,r)}function zk(n){n.persistentConnection_&&n.persistentConnection_.interrupt(Uk)}function NF(n){n.persistentConnection_&&n.persistentConnection_.resume(Uk)}function Cc(n,...e){let t="";n.persistentConnection_&&(t=n.persistentConnection_.id+":"),Dn(t,...e)}function vo(n,e,t,r){e&&bc(()=>{if(t==="ok")e(null);else{const s=(t||"error").toUpperCase();let i=s;r&&(i+=": "+r);const o=new Error(i);o.code=s,e(o)}})}function RF(n,e,t,r,s,i){Cc(n,"transaction on "+e);const o={path:e,update:t,onComplete:r,status:null,order:VC(),applyLocally:i,retryCount:0,unwatcher:s,abortReason:null,currentWriteId:null,currentInputSnapshot:null,currentOutputSnapshotRaw:null,currentOutputSnapshotResolved:null},a=Tw(n,e,void 0);o.currentInputSnapshot=a;const c=o.update(a.val());if(c===void 0)o.unwatcher(),o.currentOutputSnapshotRaw=null,o.currentOutputSnapshotResolved=null,o.onComplete&&o.onComplete(null,!1,o.currentInputSnapshot);else{ih("transaction failed: Data returned ",c,o.path),o.status=0;const u=Wp(n.transactionQueueTree_,e),h=Ua(u)||[];h.push(o),xw(u,h);let f;typeof c=="object"&&c!==null&&_s(c,".priority")?(f=ya(c,".priority"),Z(Td(f),"Invalid priority returned by transaction. Priority must be a valid string, finite number, server value, or null.")):f=(zp(n.serverSyncTree_,e)||ke.EMPTY_NODE).getPriority().val();const m=ah(n),y=Yt(c,f),w=_w(y,a,m);o.currentOutputSnapshotRaw=y,o.currentOutputSnapshotResolved=w,o.currentWriteId=Kp(n);const S=hw(n.serverSyncTree_,e,w,o.currentWriteId,o.applyLocally);Lr(n.eventQueue_,e,S),Yp(n,n.transactionQueueTree_)}}function Tw(n,e,t){return zp(n.serverSyncTree_,e,t)||ke.EMPTY_NODE}function Yp(n,e=n.transactionQueueTree_){if(e||Jp(n,e),Ua(e)){const t=Wk(n,e);Z(t.length>0,"Sending zero length transaction queue"),t.every(s=>s.status===0)&&DF(n,sh(e),t)}else Ok(e)&&Gp(e,t=>{Yp(n,t)})}function DF(n,e,t){const r=t.map(u=>u.currentWriteId),s=Tw(n,e,r);let i=s;const o=s.hash();for(let u=0;u<t.length;u++){const h=t[u];Z(h.status===0,"tryToSendTransactionQueue_: items in queue should all be run."),h.status=1,h.retryCount++;const f=ir(e,h.path);i=i.updateChild(f,h.currentOutputSnapshotRaw)}const a=i.val(!0),c=e;n.server_.put(c.toString(),a,u=>{Cc(n,"transaction put response",{path:c.toString(),status:u});let h=[];if(u==="ok"){const f=[];for(let m=0;m<t.length;m++)t[m].status=2,h=h.concat(Hi(n.serverSyncTree_,t[m].currentWriteId)),t[m].onComplete&&f.push(()=>t[m].onComplete(null,!0,t[m].currentOutputSnapshotResolved)),t[m].unwatcher();Jp(n,Wp(n.transactionQueueTree_,e)),Yp(n,n.transactionQueueTree_),Lr(n.eventQueue_,e,h);for(let m=0;m<f.length;m++)bc(f[m])}else{if(u==="datastale")for(let f=0;f<t.length;f++)t[f].status===3?t[f].status=4:t[f].status=0;else{er("transaction at "+c.toString()+" failed: "+u);for(let f=0;f<t.length;f++)t[f].status=4,t[f].abortReason=u}Xl(n,e)}},o)}function Xl(n,e){const t=qk(n,e),r=sh(t),s=Wk(n,t);return PF(n,s,r),r}function PF(n,e,t){if(e.length===0)return;const r=[];let s=[];const o=e.filter(a=>a.status===0).map(a=>a.currentWriteId);for(let a=0;a<e.length;a++){const c=e[a],u=ir(t,c.path);let h=!1,f;if(Z(u!==null,"rerunTransactionsUnderNode_: relativePath should not be null."),c.status===4)h=!0,f=c.abortReason,s=s.concat(Hi(n.serverSyncTree_,c.currentWriteId,!0));else if(c.status===0)if(c.retryCount>=vF)h=!0,f="maxretry",s=s.concat(Hi(n.serverSyncTree_,c.currentWriteId,!0));else{const m=Tw(n,c.path,o);c.currentInputSnapshot=m;const y=e[a].update(m.val());if(y!==void 0){ih("transaction failed: Data returned ",y,c.path);let w=Yt(y);typeof y=="object"&&y!=null&&_s(y,".priority")||(w=w.updatePriority(m.getPriority()));const R=c.currentWriteId,T=ah(n),I=_w(w,m,T);c.currentOutputSnapshotRaw=w,c.currentOutputSnapshotResolved=I,c.currentWriteId=Kp(n),o.splice(o.indexOf(R),1),s=s.concat(hw(n.serverSyncTree_,c.path,I,c.currentWriteId,c.applyLocally)),s=s.concat(Hi(n.serverSyncTree_,R,!0))}else h=!0,f="nodata",s=s.concat(Hi(n.serverSyncTree_,c.currentWriteId,!0))}Lr(n.eventQueue_,t,s),s=[],h&&(e[a].status=2,function(m){setTimeout(m,Math.floor(0))}(e[a].unwatcher),e[a].onComplete&&(f==="nodata"?r.push(()=>e[a].onComplete(null,!1,e[a].currentInputSnapshot)):r.push(()=>e[a].onComplete(new Error(f),!1,null))))}Jp(n,n.transactionQueueTree_);for(let a=0;a<r.length;a++)bc(r[a]);Yp(n,n.transactionQueueTree_)}function qk(n,e){let t,r=n.transactionQueueTree_;for(t=$e(e);t!==null&&Ua(r)===void 0;)r=Wp(r,t),e=St(e),t=$e(e);return r}function Wk(n,e){const t=[];return Gk(n,e,t),t.sort((r,s)=>r.order-s.order),t}function Gk(n,e,t){const r=Ua(e);if(r)for(let s=0;s<r.length;s++)t.push(r[s]);Gp(e,s=>{Gk(n,s,t)})}function Jp(n,e){const t=Ua(e);if(t){let r=0;for(let s=0;s<t.length;s++)t[s].status!==2&&(t[r]=t[s],r++);t.length=r,xw(e,t.length>0?t:void 0)}Gp(e,r=>{Jp(n,r)})}function Aw(n,e){const t=sh(qk(n,e)),r=Wp(n.transactionQueueTree_,e);return uF(r,s=>{Ry(n,s)}),Ry(n,r),jk(r,s=>{Ry(n,s)}),t}function Ry(n,e){const t=Ua(e);if(t){const r=[];let s=[],i=-1;for(let o=0;o<t.length;o++)t[o].status===3||(t[o].status===1?(Z(i===o-1,"All SENT items should be at beginning of queue."),i=o,t[o].status=3,t[o].abortReason="set"):(Z(t[o].status===0,"Unexpected transaction status in abort"),t[o].unwatcher(),s=s.concat(Hi(n.serverSyncTree_,t[o].currentWriteId,!0)),t[o].onComplete&&r.push(t[o].onComplete.bind(null,new Error("set"),!1,null))));i===-1?xw(e,void 0):t.length=i+1,Lr(n.eventQueue_,sh(e),s);for(let o=0;o<r.length;o++)bc(r[o])}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function OF(n){let e="";const t=n.split("/");for(let r=0;r<t.length;r++)if(t[r].length>0){let s=t[r];try{s=decodeURIComponent(s.replace(/\+/g," "))}catch{}e+="/"+s}return e}function jF(n){const e={};n.charAt(0)==="?"&&(n=n.substring(1));for(const t of n.split("&")){if(t.length===0)continue;const r=t.split("=");r.length===2?e[decodeURIComponent(r[0])]=decodeURIComponent(r[1]):er(`Invalid query segment '${t}' in query '${n}'`)}return e}const fv=function(n,e){const t=LF(n),r=t.namespace;t.domain==="firebase.com"&&Bs(t.host+" is no longer supported. Please use <YOUR FIREBASE>.firebaseio.com instead"),(!r||r==="undefined")&&t.domain!=="localhost"&&Bs("Cannot parse Firebase url. Please use https://<YOUR FIREBASE>.firebaseio.com"),t.secure||WM();const s=t.scheme==="ws"||t.scheme==="wss";return{repoInfo:new XC(t.host,t.secure,r,s,e,"",r!==t.subdomain),path:new ct(t.pathString)}},LF=function(n){let e="",t="",r="",s="",i="",o=!0,a="https",c=443;if(typeof n=="string"){let u=n.indexOf("//");u>=0&&(a=n.substring(0,u-1),n=n.substring(u+2));let h=n.indexOf("/");h===-1&&(h=n.length);let f=n.indexOf("?");f===-1&&(f=n.length),e=n.substring(0,Math.min(h,f)),h<f&&(s=OF(n.substring(h,f)));const m=jF(n.substring(Math.min(n.length,f)));u=e.indexOf(":"),u>=0?(o=a==="https"||a==="wss",c=parseInt(e.substring(u+1),10)):u=e.length;const y=e.slice(0,u);if(y.toLowerCase()==="localhost")t="localhost";else if(y.split(".").length<=2)t=y;else{const w=e.indexOf(".");r=e.substring(0,w).toLowerCase(),t=e.substring(w+1),i=r}"ns"in m&&(i=m.ns)}return{host:e,port:c,domain:t,subdomain:r,secure:o,scheme:a,pathString:s,namespace:i}};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const UE="-0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ_abcdefghijklmnopqrstuvwxyz",MF=function(){let n=0;const e=[];return function(t){const r=t===n;n=t;let s;const i=new Array(8);for(s=7;s>=0;s--)i[s]=UE.charAt(t%64),t=Math.floor(t/64);Z(t===0,"Cannot push at time == 0");let o=i.join("");if(r){for(s=11;s>=0&&e[s]===63;s--)e[s]=0;e[s]++}else for(s=0;s<12;s++)e[s]=Math.floor(Math.random()*64);for(s=0;s<12;s++)o+=UE.charAt(e[s]);return Z(o.length===20,"nextPushId: Length should be 20."),o}}();/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Hk{constructor(e,t,r,s){this.eventType=e,this.eventRegistration=t,this.snapshot=r,this.prevName=s}getPath(){const e=this.snapshot.ref;return this.eventType==="value"?e._path:e.parent._path}getEventType(){return this.eventType}getEventRunner(){return this.eventRegistration.getEventRunner(this)}toString(){return this.getPath().toString()+":"+this.eventType+":"+Sn(this.snapshot.exportVal())}}class Qk{constructor(e,t,r){this.eventRegistration=e,this.error=t,this.path=r}getPath(){return this.path}getEventType(){return"cancel"}getEventRunner(){return this.eventRegistration.getEventRunner(this)}toString(){return this.path.toString()+":cancel"}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Cw{constructor(e,t){this.snapshotCallback=e,this.cancelCallback=t}onValue(e,t){this.snapshotCallback.call(null,e,t)}onCancel(e){return Z(this.hasCancelCallback,"Raising a cancel event on a listener with no cancel callback"),this.cancelCallback.call(null,e)}get hasCancelCallback(){return!!this.cancelCallback}matches(e){return this.snapshotCallback===e.snapshotCallback||this.snapshotCallback.userCallback!==void 0&&this.snapshotCallback.userCallback===e.snapshotCallback.userCallback&&this.snapshotCallback.context===e.snapshotCallback.context}}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class VF{constructor(e,t){this._repo=e,this._path=t}cancel(){const e=new Ar;return TF(this._repo,this._path,e.wrapCallback(()=>{})),e.promise}remove(){Cs("OnDisconnect.remove",this._path);const e=new Ar;return $E(this._repo,this._path,null,e.wrapCallback(()=>{})),e.promise}set(e){Cs("OnDisconnect.set",this._path),zs("OnDisconnect.set",e,this._path,!1);const t=new Ar;return $E(this._repo,this._path,e,t.wrapCallback(()=>{})),t.promise}setWithPriority(e,t){Cs("OnDisconnect.setWithPriority",this._path),zs("OnDisconnect.setWithPriority",e,this._path,!1),Sw("OnDisconnect.setWithPriority",t,!1);const r=new Ar;return AF(this._repo,this._path,e,t,r.wrapCallback(()=>{})),r.promise}update(e){Cs("OnDisconnect.update",this._path),Mk("OnDisconnect.update",e,this._path,!1);const t=new Ar;return CF(this._repo,this._path,e,t.wrapCallback(()=>{})),t.promise}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class $r{constructor(e,t,r,s){this._repo=e,this._path=t,this._queryParams=r,this._orderByCalled=s}get key(){return Ue(this._path)?null:J0(this._path)}get ref(){return new vs(this._repo,this._path)}get _queryIdentifier(){const e=TE(this._queryParams),t=H0(e);return t==="{}"?"default":t}get _queryObject(){return TE(this._queryParams)}isEqual(e){if(e=le(e),!(e instanceof $r))return!1;const t=this._repo===e._repo,r=X0(this._path,e._path),s=this._queryIdentifier===e._queryIdentifier;return t&&r&&s}toJSON(){return this.toString()}toString(){return this._repo.toString()+C4(this._path)}}function Xp(n,e){if(n._orderByCalled===!0)throw new Error(e+": You can't combine multiple orderBy calls.")}function No(n){let e=null,t=null;if(n.hasStart()&&(e=n.getIndexStartValue()),n.hasEnd()&&(t=n.getIndexEndValue()),n.getIndex()===Ls){const r="Query: When ordering by key, you may only pass one argument to startAt(), endAt(), or equalTo().",s="Query: When ordering by key, the argument passed to startAt(), startAfter(), endAt(), endBefore(), or equalTo() must be a string.";if(n.hasStart()){if(n.getIndexStartName()!==po)throw new Error(r);if(typeof e!="string")throw new Error(s)}if(n.hasEnd()){if(n.getIndexEndName()!==fi)throw new Error(r);if(typeof t!="string")throw new Error(s)}}else if(n.getIndex()===Nt){if(e!=null&&!Td(e)||t!=null&&!Td(t))throw new Error("Query: When ordering by priority, the first argument passed to startAt(), startAfter() endAt(), endBefore(), or equalTo() must be a valid priority value (null, a number, or a string).")}else if(Z(n.getIndex()instanceof tw||n.getIndex()===nw,"unknown index type."),e!=null&&typeof e=="object"||t!=null&&typeof t=="object")throw new Error("Query: First argument passed to startAt(), startAfter(), endAt(), endBefore(), or equalTo() cannot be an object.")}function Zp(n){if(n.hasStart()&&n.hasEnd()&&n.hasLimit()&&!n.hasAnchoredLimit())throw new Error("Query: Can't combine startAt(), startAfter(), endAt(), endBefore(), and limit(). Use limitToFirst() or limitToLast() instead.")}class vs extends $r{constructor(e,t){super(e,t,new sw,!1)}get parent(){const e=ak(this._path);return e===null?null:new vs(this._repo,e)}get root(){let e=this;for(;e.parent!==null;)e=e.parent;return e}}class xa{constructor(e,t,r){this._node=e,this.ref=t,this._index=r}get priority(){return this._node.getPriority().val()}get key(){return this.ref.key}get size(){return this._node.numChildren()}child(e){const t=new ct(e),r=Zl(this.ref,e);return new xa(this._node.getChild(t),r,Nt)}exists(){return!this._node.isEmpty()}exportVal(){return this._node.val(!0)}forEach(e){return this._node.isLeafNode()?!1:!!this._node.forEachChild(this._index,(r,s)=>e(new xa(s,Zl(this.ref,r),Nt)))}hasChild(e){const t=new ct(e);return!this._node.getChild(t).isEmpty()}hasChildren(){return this._node.isLeafNode()?!1:!this._node.isEmpty()}toJSON(){return this.exportVal()}val(){return this._node.val()}}function K(n,e){return n=le(n),n._checkNotDeleted("ref"),e!==void 0?Zl(n._root,e):n._root}function bq(n,e){n=le(n),n._checkNotDeleted("refFromURL");const t=fv(e,n._repo.repoInfo_.nodeAdmin);Vk("refFromURL",t);const r=t.repoInfo;return!n._repo.repoInfo_.isCustomHost()&&r.host!==n._repo.repoInfo_.host&&Bs("refFromURL: Host name does not match the current database: (found "+r.host+" but expected "+n._repo.repoInfo_.host+")"),K(n,t.path.toString())}function Zl(n,e){return n=le(n),$e(n._path)===null?gF("child","path",e,!1):Iw("child","path",e,!1),new vs(n._repo,zt(n._path,e))}function Tq(n){return n=le(n),new VF(n._repo,n._path)}function Kk(n,e){n=le(n),Cs("push",n._path),zs("push",e,n._path,!0);const t=Bk(n._repo),r=MF(t),s=Zl(n,r),i=Zl(n,r);let o;return e!=null?o=Te(i,e).then(()=>i):o=Promise.resolve(i),s.then=o.then.bind(o),s.catch=o.then.bind(o,void 0),s}function FF(n){return Cs("remove",n._path),Te(n,null)}function Te(n,e){n=le(n),Cs("set",n._path),zs("set",e,n._path,!1);const t=new Ar;return bw(n._repo,n._path,e,null,t.wrapCallback(()=>{})),t.promise}function Aq(n,e){n=le(n),Cs("setPriority",n._path),Sw("setPriority",e,!1);const t=new Ar;return bw(n._repo,zt(n._path,".priority"),e,null,t.wrapCallback(()=>{})),t.promise}function Cq(n,e,t){if(Cs("setWithPriority",n._path),zs("setWithPriority",e,n._path,!1),Sw("setWithPriority",t,!1),n.key===".length"||n.key===".keys")throw"setWithPriority failed: "+n.key+" is a read-only object.";const r=new Ar;return bw(n._repo,n._path,e,t,r.wrapCallback(()=>{})),r.promise}function $F(n,e){Mk("update",e,n._path,!1);const t=new Ar;return EF(n._repo,n._path,e,t.wrapCallback(()=>{})),t.promise}function ve(n){n=le(n);const e=new Cw(()=>{}),t=new lh(e);return IF(n._repo,n,t).then(r=>new xa(r,new vs(n._repo,n._path),n._queryParams.getIndex()))}class lh{constructor(e){this.callbackContext=e}respondsTo(e){return e==="value"}createEvent(e,t){const r=t._queryParams.getIndex();return new Hk("value",this,new xa(e.snapshotNode,new vs(t._repo,t._path),r))}getEventRunner(e){return e.getEventType()==="cancel"?()=>this.callbackContext.onCancel(e.error):()=>this.callbackContext.onValue(e.snapshot,null)}createCancelEvent(e,t){return this.callbackContext.hasCancelCallback?new Qk(this,e,t):null}matches(e){return e instanceof lh?!e.callbackContext||!this.callbackContext?!0:e.callbackContext.matches(this.callbackContext):!1}hasAnyCallback(){return this.callbackContext!==null}}class eg{constructor(e,t){this.eventType=e,this.callbackContext=t}respondsTo(e){let t=e==="children_added"?"child_added":e;return t=t==="children_removed"?"child_removed":t,this.eventType===t}createCancelEvent(e,t){return this.callbackContext.hasCancelCallback?new Qk(this,e,t):null}createEvent(e,t){Z(e.childName!=null,"Child events should have a childName.");const r=Zl(new vs(t._repo,t._path),e.childName),s=t._queryParams.getIndex();return new Hk(e.type,this,new xa(e.snapshotNode,r,s),e.prevName)}getEventRunner(e){return e.getEventType()==="cancel"?()=>this.callbackContext.onCancel(e.error):()=>this.callbackContext.onValue(e.snapshot,e.prevName)}matches(e){return e instanceof eg?this.eventType===e.eventType&&(!this.callbackContext||!e.callbackContext||this.callbackContext.matches(e.callbackContext)):!1}hasAnyCallback(){return!!this.callbackContext}}function ch(n,e,t,r,s){let i;if(typeof r=="object"&&(i=void 0,s=r),typeof r=="function"&&(i=r),s&&s.onlyOnce){const c=t,u=(h,f)=>{hv(n._repo,n,a),c(h,f)};u.userCallback=t.userCallback,u.context=t.context,t=u}const o=new Cw(t,i||void 0),a=e==="value"?new lh(o):new eg(e,o);return kF(n._repo,n,a),()=>hv(n._repo,n,a)}function kw(n,e,t,r){return ch(n,"value",e,t,r)}function kq(n,e,t,r){return ch(n,"child_added",e,t,r)}function Nq(n,e,t,r){return ch(n,"child_changed",e,t,r)}function Rq(n,e,t,r){return ch(n,"child_moved",e,t,r)}function Dq(n,e,t,r){return ch(n,"child_removed",e,t,r)}function UF(n,e,t){let r=null;const s=t?new Cw(t):null;e==="value"?r=new lh(s):e&&(r=new eg(e,s)),hv(n._repo,n,r)}let ws=class{},Yk=class extends ws{constructor(e,t){super(),this._value=e,this._key=t,this.type="endAt"}_apply(e){zs("endAt",this._value,e._path,!0);const t=nv(e._queryParams,this._value,this._key);if(Zp(t),No(t),e._queryParams.hasEnd())throw new Error("endAt: Starting point was already set (by another call to endAt, endBefore or equalTo).");return new $r(e._repo,e._path,t,e._orderByCalled)}};function jq(n,e){return oh("endAt","key",e,!0),new Yk(n,e)}class BF extends ws{constructor(e,t){super(),this._value=e,this._key=t,this.type="endBefore"}_apply(e){zs("endBefore",this._value,e._path,!1);const t=eV(e._queryParams,this._value,this._key);if(Zp(t),No(t),e._queryParams.hasEnd())throw new Error("endBefore: Starting point was already set (by another call to endAt, endBefore or equalTo).");return new $r(e._repo,e._path,t,e._orderByCalled)}}function Lq(n,e){return oh("endBefore","key",e,!0),new BF(n,e)}let Jk=class extends ws{constructor(e,t){super(),this._value=e,this._key=t,this.type="startAt"}_apply(e){zs("startAt",this._value,e._path,!0);const t=tv(e._queryParams,this._value,this._key);if(Zp(t),No(t),e._queryParams.hasStart())throw new Error("startAt: Starting point was already set (by another call to startAt, startBefore or equalTo).");return new $r(e._repo,e._path,t,e._orderByCalled)}};function Vq(n=null,e){return oh("startAt","key",e,!0),new Jk(n,e)}class zF extends ws{constructor(e,t){super(),this._value=e,this._key=t,this.type="startAfter"}_apply(e){zs("startAfter",this._value,e._path,!1);const t=Z4(e._queryParams,this._value,this._key);if(Zp(t),No(t),e._queryParams.hasStart())throw new Error("startAfter: Starting point was already set (by another call to startAt, startAfter, or equalTo).");return new $r(e._repo,e._path,t,e._orderByCalled)}}function Fq(n,e){return oh("startAfter","key",e,!0),new zF(n,e)}class qF extends ws{constructor(e){super(),this._limit=e,this.type="limitToFirst"}_apply(e){if(e._queryParams.hasLimit())throw new Error("limitToFirst: Limit was already set (by another call to limitToFirst or limitToLast).");return new $r(e._repo,e._path,J4(e._queryParams,this._limit),e._orderByCalled)}}function $q(n){if(typeof n!="number"||Math.floor(n)!==n||n<=0)throw new Error("limitToFirst: First argument must be a positive integer.");return new qF(n)}class WF extends ws{constructor(e){super(),this._limit=e,this.type="limitToLast"}_apply(e){if(e._queryParams.hasLimit())throw new Error("limitToLast: Limit was already set (by another call to limitToFirst or limitToLast).");return new $r(e._repo,e._path,X4(e._queryParams,this._limit),e._orderByCalled)}}function Uq(n){if(typeof n!="number"||Math.floor(n)!==n||n<=0)throw new Error("limitToLast: First argument must be a positive integer.");return new WF(n)}class GF extends ws{constructor(e){super(),this._path=e,this.type="orderByChild"}_apply(e){Xp(e,"orderByChild");const t=new ct(this._path);if(Ue(t))throw new Error("orderByChild: cannot pass in empty path. Use orderByValue() instead.");const r=new tw(t),s=Fp(e._queryParams,r);return No(s),new $r(e._repo,e._path,s,!0)}}function Bq(n){if(n==="$key")throw new Error('orderByChild: "$key" is invalid.  Use orderByKey() instead.');if(n==="$priority")throw new Error('orderByChild: "$priority" is invalid.  Use orderByPriority() instead.');if(n==="$value")throw new Error('orderByChild: "$value" is invalid.  Use orderByValue() instead.');return Iw("orderByChild","path",n,!1),new GF(n)}class HF extends ws{constructor(){super(...arguments),this.type="orderByKey"}_apply(e){Xp(e,"orderByKey");const t=Fp(e._queryParams,Ls);return No(t),new $r(e._repo,e._path,t,!0)}}function zq(){return new HF}class QF extends ws{constructor(){super(...arguments),this.type="orderByPriority"}_apply(e){Xp(e,"orderByPriority");const t=Fp(e._queryParams,Nt);return No(t),new $r(e._repo,e._path,t,!0)}}function qq(){return new QF}class KF extends ws{constructor(){super(...arguments),this.type="orderByValue"}_apply(e){Xp(e,"orderByValue");const t=Fp(e._queryParams,nw);return No(t),new $r(e._repo,e._path,t,!0)}}function Wq(){return new KF}class YF extends ws{constructor(e,t){super(),this._value=e,this._key=t,this.type="equalTo"}_apply(e){if(zs("equalTo",this._value,e._path,!1),e._queryParams.hasStart())throw new Error("equalTo: Starting point was already set (by another call to startAt/startAfter or equalTo).");if(e._queryParams.hasEnd())throw new Error("equalTo: Ending point was already set (by another call to endAt/endBefore or equalTo).");return new Yk(this._value,this._key)._apply(new Jk(this._value,this._key)._apply(e))}}function Gq(n,e){return oh("equalTo","key",e,!0),new YF(n,e)}function JF(n,...e){let t=le(n);for(const r of e)t=r._apply(t);return t}BV(vs);HV(vs);/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const XF="FIREBASE_DATABASE_EMULATOR_HOST",mv={};let Xk=!1;function ZF(n,e,t,r){const s=e.lastIndexOf(":"),i=e.substring(0,s),o=wi(i);n.repoInfo_=new XC(e,o,n.repoInfo_.namespace,n.repoInfo_.webSocketOnly,n.repoInfo_.nodeAdmin,n.repoInfo_.persistenceKey,n.repoInfo_.includeNamespaceInQueryParams,!0,t),r&&(n.authTokenProvider_=r)}function Zk(n,e,t,r,s){let i=r||n.options.databaseURL;i===void 0&&(n.options.projectId||Bs("Can't determine Firebase Database URL. Be sure to include  a Project ID when calling firebase.initializeApp()."),Dn("Using default host for project ",n.options.projectId),i=`${n.options.projectId}-default-rtdb.firebaseio.com`);let o=fv(i,s),a=o.repoInfo,c,u;typeof process<"u"&&process.env&&(u=process.env[XF]),u?(c=!0,i=`http://${u}?ns=${a.namespace}`,o=fv(i,s),a=o.repoInfo):c=!o.repoInfo.secure;const h=s&&c?new Ol(Ol.OWNER):new n4(n.name,n.options,e);Vk("Invalid Firebase Database URL",o),Ue(o.path)||Bs("Database URL must point to the root of a Firebase Database (not including a child path).");const f=t3(a,n,h,new t4(n,t));return new r3(f,n)}function e3(n,e){const t=mv[e];(!t||t[n.key]!==n)&&Bs(`Database ${e}(${n.repoInfo_}) has already been deleted.`),zk(n),delete t[n.key]}function t3(n,e,t,r){let s=mv[e.name];s||(s={},mv[e.name]=s);let i=s[n.toURLString()];return i&&Bs("Database initialized multiple times. Please make sure the format of the database URL matches with each database() call."),i=new wF(n,Xk,t,r),s[n.toURLString()]=i,i}function n3(n){Xk=n}let r3=class{constructor(e,t){this._repoInternal=e,this.app=t,this.type="database",this._instanceStarted=!1}get _repo(){return this._instanceStarted||(xF(this._repoInternal,this.app.options.appId,this.app.options.databaseAuthVariableOverride),this._instanceStarted=!0),this._repoInternal}get _root(){return this._rootInternal||(this._rootInternal=new vs(this._repo,rt())),this._rootInternal}_delete(){return this._rootInternal!==null&&(e3(this._repo,this.app.name),this._repoInternal=null,this._rootInternal=null),Promise.resolve()}_checkNotDeleted(e){this._rootInternal===null&&Bs("Cannot call "+e+" on a deleted database.")}};function eN(){Ql.IS_TRANSPORT_INITIALIZED&&er("Transport has already been initialized. Please call this function before calling ref or setting up a listener")}function Qq(){eN(),Gi.forceDisallow()}function Kq(){eN(),qr.forceDisallow(),Gi.forceAllow()}function s3(n=Zd(),e){const t=Ws(n,"database").getImmediate({identifier:e});if(!t._instanceStarted){const r=_C("database");r&&i3(t,...r)}return t}function i3(n,e,t,r={}){n=le(n),n._checkNotDeleted("useEmulator");const s=`${e}:${t}`,i=n._repoInternal;if(n._instanceStarted){if(s===n._repoInternal.repoInfo_.host&&jr(r,i.repoInfo_.emulatorOptions))return;Bs("connectDatabaseEmulator() cannot initialize or alter the emulator configuration after the database instance has started.")}let o;if(i.repoInfo_.nodeAdmin)r.mockUserToken&&Bs('mockUserToken is not supported by the Admin SDK. For client access with mock users, please use the "firebase" package instead of "firebase-admin".'),o=new Ol(Ol.OWNER);else if(r.mockUserToken){const a=typeof r.mockUserToken=="string"?r.mockUserToken:xC(r.mockUserToken,n.app.options.projectId);o=new Ol(a)}wi(e)&&(Op(e),U0("Database",!0)),ZF(i,s,r,o)}function Yq(n){n=le(n),n._checkNotDeleted("goOffline"),zk(n._repo)}function Jq(n){n=le(n),n._checkNotDeleted("goOnline"),NF(n._repo)}function Xq(n,e){$C(n,e)}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function o3(n){LC(Va),gs(new wr("database",(e,{instanceIdentifier:t})=>{const r=e.getProvider("app").getImmediate(),s=e.getProvider("auth-internal"),i=e.getProvider("app-check-internal");return Zk(r,s,i,t)},"PUBLIC").setMultipleInstances(!0)),_r(cE,uE,n),_r(cE,uE,"esm2020")}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const a3={".sv":"timestamp"};function Zq(){return a3}function e7(n){return{".sv":{increment:n}}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class l3{constructor(e,t){this.committed=e,this.snapshot=t}toJSON(){return{committed:this.committed,snapshot:this.snapshot.toJSON()}}}function t7(n,e,t){if(n=le(n),Cs("Reference.transaction",n._path),n.key===".length"||n.key===".keys")throw"Reference.transaction failed: "+n.key+" is a read-only object.";const r=(t==null?void 0:t.applyLocally)??!0,s=new Ar,i=(a,c,u)=>{let h=null;a?s.reject(a):(h=new xa(u,new vs(n._repo,n._path),Nt),s.resolve(new l3(c,h)))},o=kw(n,()=>{});return RF(n._repo,n._path,e,i,o,r),s.promise}Qr.prototype.simpleListen=function(n,e){this.sendRequest("q",{p:n},e)};Qr.prototype.echo=function(n,e){this.sendRequest("echo",{d:n},e)};const n7=function(n){const e=Qr.prototype.put;return Qr.prototype.put=function(t,r,s,i){i!==void 0&&(i=n()),e.call(this,t,r,s,i)},function(){Qr.prototype.put=e}},r7=function(n){n3(n)};/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function s7({app:n,url:e,version:t,customAuthImpl:r,customAppCheckImpl:s,nodeAdmin:i=!1}){LC(t);const o=new kC("database-standalone"),a=new G_("auth-internal",o);let c;return s&&(c=new G_("app-check-internal",o),c.setComponent(new wr("app-check-internal",()=>s,"PRIVATE"))),a.setComponent(new wr("auth-internal",()=>r,"PRIVATE")),Zk(n,a,c,e,i)}o3();var BE=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};/** @license
Copyright The Closure Library Authors.
SPDX-License-Identifier: Apache-2.0
*/var co,tN;(function(){var n;/** @license

 Copyright The Closure Library Authors.
 SPDX-License-Identifier: Apache-2.0
*/function e(A,x){function E(){}E.prototype=x.prototype,A.D=x.prototype,A.prototype=new E,A.prototype.constructor=A,A.C=function(k,C,_){for(var v=Array(arguments.length-2),V=2;V<arguments.length;V++)v[V-2]=arguments[V];return x.prototype[C].apply(k,v)}}function t(){this.blockSize=-1}function r(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.B=Array(this.blockSize),this.o=this.h=0,this.s()}e(r,t),r.prototype.s=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.o=this.h=0};function s(A,x,E){E||(E=0);var k=Array(16);if(typeof x=="string")for(var C=0;16>C;++C)k[C]=x.charCodeAt(E++)|x.charCodeAt(E++)<<8|x.charCodeAt(E++)<<16|x.charCodeAt(E++)<<24;else for(C=0;16>C;++C)k[C]=x[E++]|x[E++]<<8|x[E++]<<16|x[E++]<<24;x=A.g[0],E=A.g[1],C=A.g[2];var _=A.g[3],v=x+(_^E&(C^_))+k[0]+3614090360&4294967295;x=E+(v<<7&4294967295|v>>>25),v=_+(C^x&(E^C))+k[1]+3905402710&4294967295,_=x+(v<<12&4294967295|v>>>20),v=C+(E^_&(x^E))+k[2]+606105819&4294967295,C=_+(v<<17&4294967295|v>>>15),v=E+(x^C&(_^x))+k[3]+3250441966&4294967295,E=C+(v<<22&4294967295|v>>>10),v=x+(_^E&(C^_))+k[4]+4118548399&4294967295,x=E+(v<<7&4294967295|v>>>25),v=_+(C^x&(E^C))+k[5]+1200080426&4294967295,_=x+(v<<12&4294967295|v>>>20),v=C+(E^_&(x^E))+k[6]+2821735955&4294967295,C=_+(v<<17&4294967295|v>>>15),v=E+(x^C&(_^x))+k[7]+4249261313&4294967295,E=C+(v<<22&4294967295|v>>>10),v=x+(_^E&(C^_))+k[8]+1770035416&4294967295,x=E+(v<<7&4294967295|v>>>25),v=_+(C^x&(E^C))+k[9]+2336552879&4294967295,_=x+(v<<12&4294967295|v>>>20),v=C+(E^_&(x^E))+k[10]+4294925233&4294967295,C=_+(v<<17&4294967295|v>>>15),v=E+(x^C&(_^x))+k[11]+2304563134&4294967295,E=C+(v<<22&4294967295|v>>>10),v=x+(_^E&(C^_))+k[12]+1804603682&4294967295,x=E+(v<<7&4294967295|v>>>25),v=_+(C^x&(E^C))+k[13]+4254626195&4294967295,_=x+(v<<12&4294967295|v>>>20),v=C+(E^_&(x^E))+k[14]+2792965006&4294967295,C=_+(v<<17&4294967295|v>>>15),v=E+(x^C&(_^x))+k[15]+1236535329&4294967295,E=C+(v<<22&4294967295|v>>>10),v=x+(C^_&(E^C))+k[1]+4129170786&4294967295,x=E+(v<<5&4294967295|v>>>27),v=_+(E^C&(x^E))+k[6]+3225465664&4294967295,_=x+(v<<9&4294967295|v>>>23),v=C+(x^E&(_^x))+k[11]+643717713&4294967295,C=_+(v<<14&4294967295|v>>>18),v=E+(_^x&(C^_))+k[0]+3921069994&4294967295,E=C+(v<<20&4294967295|v>>>12),v=x+(C^_&(E^C))+k[5]+3593408605&4294967295,x=E+(v<<5&4294967295|v>>>27),v=_+(E^C&(x^E))+k[10]+38016083&4294967295,_=x+(v<<9&4294967295|v>>>23),v=C+(x^E&(_^x))+k[15]+3634488961&4294967295,C=_+(v<<14&4294967295|v>>>18),v=E+(_^x&(C^_))+k[4]+3889429448&4294967295,E=C+(v<<20&4294967295|v>>>12),v=x+(C^_&(E^C))+k[9]+568446438&4294967295,x=E+(v<<5&4294967295|v>>>27),v=_+(E^C&(x^E))+k[14]+3275163606&4294967295,_=x+(v<<9&4294967295|v>>>23),v=C+(x^E&(_^x))+k[3]+4107603335&4294967295,C=_+(v<<14&4294967295|v>>>18),v=E+(_^x&(C^_))+k[8]+1163531501&4294967295,E=C+(v<<20&4294967295|v>>>12),v=x+(C^_&(E^C))+k[13]+2850285829&4294967295,x=E+(v<<5&4294967295|v>>>27),v=_+(E^C&(x^E))+k[2]+4243563512&4294967295,_=x+(v<<9&4294967295|v>>>23),v=C+(x^E&(_^x))+k[7]+1735328473&4294967295,C=_+(v<<14&4294967295|v>>>18),v=E+(_^x&(C^_))+k[12]+2368359562&4294967295,E=C+(v<<20&4294967295|v>>>12),v=x+(E^C^_)+k[5]+4294588738&4294967295,x=E+(v<<4&4294967295|v>>>28),v=_+(x^E^C)+k[8]+2272392833&4294967295,_=x+(v<<11&4294967295|v>>>21),v=C+(_^x^E)+k[11]+1839030562&4294967295,C=_+(v<<16&4294967295|v>>>16),v=E+(C^_^x)+k[14]+4259657740&4294967295,E=C+(v<<23&4294967295|v>>>9),v=x+(E^C^_)+k[1]+2763975236&4294967295,x=E+(v<<4&4294967295|v>>>28),v=_+(x^E^C)+k[4]+1272893353&4294967295,_=x+(v<<11&4294967295|v>>>21),v=C+(_^x^E)+k[7]+4139469664&4294967295,C=_+(v<<16&4294967295|v>>>16),v=E+(C^_^x)+k[10]+3200236656&4294967295,E=C+(v<<23&4294967295|v>>>9),v=x+(E^C^_)+k[13]+681279174&4294967295,x=E+(v<<4&4294967295|v>>>28),v=_+(x^E^C)+k[0]+3936430074&4294967295,_=x+(v<<11&4294967295|v>>>21),v=C+(_^x^E)+k[3]+3572445317&4294967295,C=_+(v<<16&4294967295|v>>>16),v=E+(C^_^x)+k[6]+76029189&4294967295,E=C+(v<<23&4294967295|v>>>9),v=x+(E^C^_)+k[9]+3654602809&4294967295,x=E+(v<<4&4294967295|v>>>28),v=_+(x^E^C)+k[12]+3873151461&4294967295,_=x+(v<<11&4294967295|v>>>21),v=C+(_^x^E)+k[15]+530742520&4294967295,C=_+(v<<16&4294967295|v>>>16),v=E+(C^_^x)+k[2]+3299628645&4294967295,E=C+(v<<23&4294967295|v>>>9),v=x+(C^(E|~_))+k[0]+4096336452&4294967295,x=E+(v<<6&4294967295|v>>>26),v=_+(E^(x|~C))+k[7]+1126891415&4294967295,_=x+(v<<10&4294967295|v>>>22),v=C+(x^(_|~E))+k[14]+2878612391&4294967295,C=_+(v<<15&4294967295|v>>>17),v=E+(_^(C|~x))+k[5]+4237533241&4294967295,E=C+(v<<21&4294967295|v>>>11),v=x+(C^(E|~_))+k[12]+1700485571&4294967295,x=E+(v<<6&4294967295|v>>>26),v=_+(E^(x|~C))+k[3]+2399980690&4294967295,_=x+(v<<10&4294967295|v>>>22),v=C+(x^(_|~E))+k[10]+4293915773&4294967295,C=_+(v<<15&4294967295|v>>>17),v=E+(_^(C|~x))+k[1]+2240044497&4294967295,E=C+(v<<21&4294967295|v>>>11),v=x+(C^(E|~_))+k[8]+1873313359&4294967295,x=E+(v<<6&4294967295|v>>>26),v=_+(E^(x|~C))+k[15]+4264355552&4294967295,_=x+(v<<10&4294967295|v>>>22),v=C+(x^(_|~E))+k[6]+2734768916&4294967295,C=_+(v<<15&4294967295|v>>>17),v=E+(_^(C|~x))+k[13]+1309151649&4294967295,E=C+(v<<21&4294967295|v>>>11),v=x+(C^(E|~_))+k[4]+4149444226&4294967295,x=E+(v<<6&4294967295|v>>>26),v=_+(E^(x|~C))+k[11]+3174756917&4294967295,_=x+(v<<10&4294967295|v>>>22),v=C+(x^(_|~E))+k[2]+718787259&4294967295,C=_+(v<<15&4294967295|v>>>17),v=E+(_^(C|~x))+k[9]+3951481745&4294967295,A.g[0]=A.g[0]+x&4294967295,A.g[1]=A.g[1]+(C+(v<<21&4294967295|v>>>11))&4294967295,A.g[2]=A.g[2]+C&4294967295,A.g[3]=A.g[3]+_&4294967295}r.prototype.u=function(A,x){x===void 0&&(x=A.length);for(var E=x-this.blockSize,k=this.B,C=this.h,_=0;_<x;){if(C==0)for(;_<=E;)s(this,A,_),_+=this.blockSize;if(typeof A=="string"){for(;_<x;)if(k[C++]=A.charCodeAt(_++),C==this.blockSize){s(this,k),C=0;break}}else for(;_<x;)if(k[C++]=A[_++],C==this.blockSize){s(this,k),C=0;break}}this.h=C,this.o+=x},r.prototype.v=function(){var A=Array((56>this.h?this.blockSize:2*this.blockSize)-this.h);A[0]=128;for(var x=1;x<A.length-8;++x)A[x]=0;var E=8*this.o;for(x=A.length-8;x<A.length;++x)A[x]=E&255,E/=256;for(this.u(A),A=Array(16),x=E=0;4>x;++x)for(var k=0;32>k;k+=8)A[E++]=this.g[x]>>>k&255;return A};function i(A,x){var E=a;return Object.prototype.hasOwnProperty.call(E,A)?E[A]:E[A]=x(A)}function o(A,x){this.h=x;for(var E=[],k=!0,C=A.length-1;0<=C;C--){var _=A[C]|0;k&&_==x||(E[C]=_,k=!1)}this.g=E}var a={};function c(A){return-128<=A&&128>A?i(A,function(x){return new o([x|0],0>x?-1:0)}):new o([A|0],0>A?-1:0)}function u(A){if(isNaN(A)||!isFinite(A))return f;if(0>A)return R(u(-A));for(var x=[],E=1,k=0;A>=E;k++)x[k]=A/E|0,E*=4294967296;return new o(x,0)}function h(A,x){if(A.length==0)throw Error("number format error: empty string");if(x=x||10,2>x||36<x)throw Error("radix out of range: "+x);if(A.charAt(0)=="-")return R(h(A.substring(1),x));if(0<=A.indexOf("-"))throw Error('number format error: interior "-" character');for(var E=u(Math.pow(x,8)),k=f,C=0;C<A.length;C+=8){var _=Math.min(8,A.length-C),v=parseInt(A.substring(C,C+_),x);8>_?(_=u(Math.pow(x,_)),k=k.j(_).add(u(v))):(k=k.j(E),k=k.add(u(v)))}return k}var f=c(0),m=c(1),y=c(16777216);n=o.prototype,n.m=function(){if(S(this))return-R(this).m();for(var A=0,x=1,E=0;E<this.g.length;E++){var k=this.i(E);A+=(0<=k?k:4294967296+k)*x,x*=4294967296}return A},n.toString=function(A){if(A=A||10,2>A||36<A)throw Error("radix out of range: "+A);if(w(this))return"0";if(S(this))return"-"+R(this).toString(A);for(var x=u(Math.pow(A,6)),E=this,k="";;){var C=P(E,x).g;E=T(E,C.j(x));var _=((0<E.g.length?E.g[0]:E.h)>>>0).toString(A);if(E=C,w(E))return _+k;for(;6>_.length;)_="0"+_;k=_+k}},n.i=function(A){return 0>A?0:A<this.g.length?this.g[A]:this.h};function w(A){if(A.h!=0)return!1;for(var x=0;x<A.g.length;x++)if(A.g[x]!=0)return!1;return!0}function S(A){return A.h==-1}n.l=function(A){return A=T(this,A),S(A)?-1:w(A)?0:1};function R(A){for(var x=A.g.length,E=[],k=0;k<x;k++)E[k]=~A.g[k];return new o(E,~A.h).add(m)}n.abs=function(){return S(this)?R(this):this},n.add=function(A){for(var x=Math.max(this.g.length,A.g.length),E=[],k=0,C=0;C<=x;C++){var _=k+(this.i(C)&65535)+(A.i(C)&65535),v=(_>>>16)+(this.i(C)>>>16)+(A.i(C)>>>16);k=v>>>16,_&=65535,v&=65535,E[C]=v<<16|_}return new o(E,E[E.length-1]&-2147483648?-1:0)};function T(A,x){return A.add(R(x))}n.j=function(A){if(w(this)||w(A))return f;if(S(this))return S(A)?R(this).j(R(A)):R(R(this).j(A));if(S(A))return R(this.j(R(A)));if(0>this.l(y)&&0>A.l(y))return u(this.m()*A.m());for(var x=this.g.length+A.g.length,E=[],k=0;k<2*x;k++)E[k]=0;for(k=0;k<this.g.length;k++)for(var C=0;C<A.g.length;C++){var _=this.i(k)>>>16,v=this.i(k)&65535,V=A.i(C)>>>16,U=A.i(C)&65535;E[2*k+2*C]+=v*U,I(E,2*k+2*C),E[2*k+2*C+1]+=_*U,I(E,2*k+2*C+1),E[2*k+2*C+1]+=v*V,I(E,2*k+2*C+1),E[2*k+2*C+2]+=_*V,I(E,2*k+2*C+2)}for(k=0;k<x;k++)E[k]=E[2*k+1]<<16|E[2*k];for(k=x;k<2*x;k++)E[k]=0;return new o(E,0)};function I(A,x){for(;(A[x]&65535)!=A[x];)A[x+1]+=A[x]>>>16,A[x]&=65535,x++}function N(A,x){this.g=A,this.h=x}function P(A,x){if(w(x))throw Error("division by zero");if(w(A))return new N(f,f);if(S(A))return x=P(R(A),x),new N(R(x.g),R(x.h));if(S(x))return x=P(A,R(x)),new N(R(x.g),x.h);if(30<A.g.length){if(S(A)||S(x))throw Error("slowDivide_ only works with positive integers.");for(var E=m,k=x;0>=k.l(A);)E=B(E),k=B(k);var C=F(E,1),_=F(k,1);for(k=F(k,2),E=F(E,2);!w(k);){var v=_.add(k);0>=v.l(A)&&(C=C.add(E),_=v),k=F(k,1),E=F(E,1)}return x=T(A,C.j(x)),new N(C,x)}for(C=f;0<=A.l(x);){for(E=Math.max(1,Math.floor(A.m()/x.m())),k=Math.ceil(Math.log(E)/Math.LN2),k=48>=k?1:Math.pow(2,k-48),_=u(E),v=_.j(x);S(v)||0<v.l(A);)E-=k,_=u(E),v=_.j(x);w(_)&&(_=m),C=C.add(_),A=T(A,v)}return new N(C,A)}n.A=function(A){return P(this,A).h},n.and=function(A){for(var x=Math.max(this.g.length,A.g.length),E=[],k=0;k<x;k++)E[k]=this.i(k)&A.i(k);return new o(E,this.h&A.h)},n.or=function(A){for(var x=Math.max(this.g.length,A.g.length),E=[],k=0;k<x;k++)E[k]=this.i(k)|A.i(k);return new o(E,this.h|A.h)},n.xor=function(A){for(var x=Math.max(this.g.length,A.g.length),E=[],k=0;k<x;k++)E[k]=this.i(k)^A.i(k);return new o(E,this.h^A.h)};function B(A){for(var x=A.g.length+1,E=[],k=0;k<x;k++)E[k]=A.i(k)<<1|A.i(k-1)>>>31;return new o(E,A.h)}function F(A,x){var E=x>>5;x%=32;for(var k=A.g.length-E,C=[],_=0;_<k;_++)C[_]=0<x?A.i(_+E)>>>x|A.i(_+E+1)<<32-x:A.i(_+E);return new o(C,A.h)}r.prototype.digest=r.prototype.v,r.prototype.reset=r.prototype.s,r.prototype.update=r.prototype.u,tN=r,o.prototype.add=o.prototype.add,o.prototype.multiply=o.prototype.j,o.prototype.modulo=o.prototype.A,o.prototype.compare=o.prototype.l,o.prototype.toNumber=o.prototype.m,o.prototype.toString=o.prototype.toString,o.prototype.getBits=o.prototype.i,o.fromNumber=u,o.fromString=h,co=o}).apply(typeof BE<"u"?BE:typeof self<"u"?self:typeof window<"u"?window:{});var df=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};/** @license
Copyright The Closure Library Authors.
SPDX-License-Identifier: Apache-2.0
*/var nN,wu,rN,Uf,pv,sN,iN,oN;(function(){var n,e=typeof Object.defineProperties=="function"?Object.defineProperty:function(d,p,g){return d==Array.prototype||d==Object.prototype||(d[p]=g.value),d};function t(d){d=[typeof globalThis=="object"&&globalThis,d,typeof window=="object"&&window,typeof self=="object"&&self,typeof df=="object"&&df];for(var p=0;p<d.length;++p){var g=d[p];if(g&&g.Math==Math)return g}throw Error("Cannot find global object")}var r=t(this);function s(d,p){if(p)e:{var g=r;d=d.split(".");for(var b=0;b<d.length-1;b++){var O=d[b];if(!(O in g))break e;g=g[O]}d=d[d.length-1],b=g[d],p=p(b),p!=b&&p!=null&&e(g,d,{configurable:!0,writable:!0,value:p})}}function i(d,p){d instanceof String&&(d+="");var g=0,b=!1,O={next:function(){if(!b&&g<d.length){var $=g++;return{value:p($,d[$]),done:!1}}return b=!0,{done:!0,value:void 0}}};return O[Symbol.iterator]=function(){return O},O}s("Array.prototype.values",function(d){return d||function(){return i(this,function(p,g){return g})}});/** @license

 Copyright The Closure Library Authors.
 SPDX-License-Identifier: Apache-2.0
*/var o=o||{},a=this||self;function c(d){var p=typeof d;return p=p!="object"?p:d?Array.isArray(d)?"array":p:"null",p=="array"||p=="object"&&typeof d.length=="number"}function u(d){var p=typeof d;return p=="object"&&d!=null||p=="function"}function h(d,p,g){return d.call.apply(d.bind,arguments)}function f(d,p,g){if(!d)throw Error();if(2<arguments.length){var b=Array.prototype.slice.call(arguments,2);return function(){var O=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(O,b),d.apply(p,O)}}return function(){return d.apply(p,arguments)}}function m(d,p,g){return m=Function.prototype.bind&&Function.prototype.bind.toString().indexOf("native code")!=-1?h:f,m.apply(null,arguments)}function y(d,p){var g=Array.prototype.slice.call(arguments,1);return function(){var b=g.slice();return b.push.apply(b,arguments),d.apply(this,b)}}function w(d,p){function g(){}g.prototype=p.prototype,d.aa=p.prototype,d.prototype=new g,d.prototype.constructor=d,d.Qb=function(b,O,$){for(var oe=Array(arguments.length-2),xt=2;xt<arguments.length;xt++)oe[xt-2]=arguments[xt];return p.prototype[O].apply(b,oe)}}function S(d){const p=d.length;if(0<p){const g=Array(p);for(let b=0;b<p;b++)g[b]=d[b];return g}return[]}function R(d,p){for(let g=1;g<arguments.length;g++){const b=arguments[g];if(c(b)){const O=d.length||0,$=b.length||0;d.length=O+$;for(let oe=0;oe<$;oe++)d[O+oe]=b[oe]}else d.push(b)}}class T{constructor(p,g){this.i=p,this.j=g,this.h=0,this.g=null}get(){let p;return 0<this.h?(this.h--,p=this.g,this.g=p.next,p.next=null):p=this.i(),p}}function I(d){return/^[\s\xa0]*$/.test(d)}function N(){var d=a.navigator;return d&&(d=d.userAgent)?d:""}function P(d){return P[" "](d),d}P[" "]=function(){};var B=N().indexOf("Gecko")!=-1&&!(N().toLowerCase().indexOf("webkit")!=-1&&N().indexOf("Edge")==-1)&&!(N().indexOf("Trident")!=-1||N().indexOf("MSIE")!=-1)&&N().indexOf("Edge")==-1;function F(d,p,g){for(const b in d)p.call(g,d[b],b,d)}function A(d,p){for(const g in d)p.call(void 0,d[g],g,d)}function x(d){const p={};for(const g in d)p[g]=d[g];return p}const E="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function k(d,p){let g,b;for(let O=1;O<arguments.length;O++){b=arguments[O];for(g in b)d[g]=b[g];for(let $=0;$<E.length;$++)g=E[$],Object.prototype.hasOwnProperty.call(b,g)&&(d[g]=b[g])}}function C(d){var p=1;d=d.split(":");const g=[];for(;0<p&&d.length;)g.push(d.shift()),p--;return d.length&&g.push(d.join(":")),g}function _(d){a.setTimeout(()=>{throw d},0)}function v(){var d=re;let p=null;return d.g&&(p=d.g,d.g=d.g.next,d.g||(d.h=null),p.next=null),p}class V{constructor(){this.h=this.g=null}add(p,g){const b=U.get();b.set(p,g),this.h?this.h.next=b:this.g=b,this.h=b}}var U=new T(()=>new ce,d=>d.reset());class ce{constructor(){this.next=this.g=this.h=null}set(p,g){this.h=p,this.g=g,this.next=null}reset(){this.next=this.g=this.h=null}}let we,z=!1,re=new V,W=()=>{const d=a.Promise.resolve(void 0);we=()=>{d.then(Q)}};var Q=()=>{for(var d;d=v();){try{d.h.call(d.g)}catch(g){_(g)}var p=U;p.j(d),100>p.h&&(p.h++,d.next=p.g,p.g=d)}z=!1};function ee(){this.s=this.s,this.C=this.C}ee.prototype.s=!1,ee.prototype.ma=function(){this.s||(this.s=!0,this.N())},ee.prototype.N=function(){if(this.C)for(;this.C.length;)this.C.shift()()};function pe(d,p){this.type=d,this.g=this.target=p,this.defaultPrevented=!1}pe.prototype.h=function(){this.defaultPrevented=!0};var xe=function(){if(!a.addEventListener||!Object.defineProperty)return!1;var d=!1,p=Object.defineProperty({},"passive",{get:function(){d=!0}});try{const g=()=>{};a.addEventListener("test",g,p),a.removeEventListener("test",g,p)}catch{}return d}();function De(d,p){if(pe.call(this,d?d.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,d){var g=this.type=d.type,b=d.changedTouches&&d.changedTouches.length?d.changedTouches[0]:null;if(this.target=d.target||d.srcElement,this.g=p,p=d.relatedTarget){if(B){e:{try{P(p.nodeName);var O=!0;break e}catch{}O=!1}O||(p=null)}}else g=="mouseover"?p=d.fromElement:g=="mouseout"&&(p=d.toElement);this.relatedTarget=p,b?(this.clientX=b.clientX!==void 0?b.clientX:b.pageX,this.clientY=b.clientY!==void 0?b.clientY:b.pageY,this.screenX=b.screenX||0,this.screenY=b.screenY||0):(this.clientX=d.clientX!==void 0?d.clientX:d.pageX,this.clientY=d.clientY!==void 0?d.clientY:d.pageY,this.screenX=d.screenX||0,this.screenY=d.screenY||0),this.button=d.button,this.key=d.key||"",this.ctrlKey=d.ctrlKey,this.altKey=d.altKey,this.shiftKey=d.shiftKey,this.metaKey=d.metaKey,this.pointerId=d.pointerId||0,this.pointerType=typeof d.pointerType=="string"?d.pointerType:Re[d.pointerType]||"",this.state=d.state,this.i=d,d.defaultPrevented&&De.aa.h.call(this)}}w(De,pe);var Re={2:"touch",3:"pen",4:"mouse"};De.prototype.h=function(){De.aa.h.call(this);var d=this.i;d.preventDefault?d.preventDefault():d.returnValue=!1};var _t="closure_listenable_"+(1e6*Math.random()|0),Ce=0;function Ae(d,p,g,b,O){this.listener=d,this.proxy=null,this.src=p,this.type=g,this.capture=!!b,this.ha=O,this.key=++Ce,this.da=this.fa=!1}function Pe(d){d.da=!0,d.listener=null,d.proxy=null,d.src=null,d.ha=null}function Ee(d){this.src=d,this.g={},this.h=0}Ee.prototype.add=function(d,p,g,b,O){var $=d.toString();d=this.g[$],d||(d=this.g[$]=[],this.h++);var oe=Et(d,p,b,O);return-1<oe?(p=d[oe],g||(p.fa=!1)):(p=new Ae(p,this.src,$,!!b,O),p.fa=g,d.push(p)),p};function Je(d,p){var g=p.type;if(g in d.g){var b=d.g[g],O=Array.prototype.indexOf.call(b,p,void 0),$;($=0<=O)&&Array.prototype.splice.call(b,O,1),$&&(Pe(p),d.g[g].length==0&&(delete d.g[g],d.h--))}}function Et(d,p,g,b){for(var O=0;O<d.length;++O){var $=d[O];if(!$.da&&$.listener==p&&$.capture==!!g&&$.ha==b)return O}return-1}var ut="closure_lm_"+(1e6*Math.random()|0),te={};function Se(d,p,g,b,O){if(b&&b.once)return be(d,p,g,b,O);if(Array.isArray(p)){for(var $=0;$<p.length;$++)Se(d,p[$],g,b,O);return null}return g=Me(g),d&&d[_t]?d.K(p,g,u(b)?!!b.capture:!!b,O):ge(d,p,g,!1,b,O)}function ge(d,p,g,b,O,$){if(!p)throw Error("Invalid event type");var oe=u(O)?!!O.capture:!!O,xt=Xe(d);if(xt||(d[ut]=xt=new Ee(d)),g=xt.add(p,g,b,oe,$),g.proxy)return g;if(b=Oe(),g.proxy=b,b.src=d,b.listener=g,d.addEventListener)xe||(O=oe),O===void 0&&(O=!1),d.addEventListener(p.toString(),b,O);else if(d.attachEvent)d.attachEvent(bt(p.toString()),b);else if(d.addListener&&d.removeListener)d.addListener(b);else throw Error("addEventListener and attachEvent are unavailable.");return g}function Oe(){function d(g){return p.call(d.src,d.listener,g)}const p=dt;return d}function be(d,p,g,b,O){if(Array.isArray(p)){for(var $=0;$<p.length;$++)be(d,p[$],g,b,O);return null}return g=Me(g),d&&d[_t]?d.L(p,g,u(b)?!!b.capture:!!b,O):ge(d,p,g,!0,b,O)}function ye(d,p,g,b,O){if(Array.isArray(p))for(var $=0;$<p.length;$++)ye(d,p[$],g,b,O);else b=u(b)?!!b.capture:!!b,g=Me(g),d&&d[_t]?(d=d.i,p=String(p).toString(),p in d.g&&($=d.g[p],g=Et($,g,b,O),-1<g&&(Pe($[g]),Array.prototype.splice.call($,g,1),$.length==0&&(delete d.g[p],d.h--)))):d&&(d=Xe(d))&&(p=d.g[p.toString()],d=-1,p&&(d=Et(p,g,b,O)),(g=-1<d?p[d]:null)&&at(g))}function at(d){if(typeof d!="number"&&d&&!d.da){var p=d.src;if(p&&p[_t])Je(p.i,d);else{var g=d.type,b=d.proxy;p.removeEventListener?p.removeEventListener(g,b,d.capture):p.detachEvent?p.detachEvent(bt(g),b):p.addListener&&p.removeListener&&p.removeListener(b),(g=Xe(p))?(Je(g,d),g.h==0&&(g.src=null,p[ut]=null)):Pe(d)}}}function bt(d){return d in te?te[d]:te[d]="on"+d}function dt(d,p){if(d.da)d=!0;else{p=new De(p,this);var g=d.listener,b=d.ha||d.src;d.fa&&at(d),d=g.call(b,p)}return d}function Xe(d){return d=d[ut],d instanceof Ee?d:null}var st="__closure_events_fn_"+(1e9*Math.random()>>>0);function Me(d){return typeof d=="function"?d:(d[st]||(d[st]=function(p){return d.handleEvent(p)}),d[st])}function fe(){ee.call(this),this.i=new Ee(this),this.M=this,this.F=null}w(fe,ee),fe.prototype[_t]=!0,fe.prototype.removeEventListener=function(d,p,g,b){ye(this,d,p,g,b)};function je(d,p){var g,b=d.F;if(b)for(g=[];b;b=b.F)g.push(b);if(d=d.M,b=p.type||p,typeof p=="string")p=new pe(p,d);else if(p instanceof pe)p.target=p.target||d;else{var O=p;p=new pe(b,d),k(p,O)}if(O=!0,g)for(var $=g.length-1;0<=$;$--){var oe=p.g=g[$];O=Gt(oe,b,!0,p)&&O}if(oe=p.g=d,O=Gt(oe,b,!0,p)&&O,O=Gt(oe,b,!1,p)&&O,g)for($=0;$<g.length;$++)oe=p.g=g[$],O=Gt(oe,b,!1,p)&&O}fe.prototype.N=function(){if(fe.aa.N.call(this),this.i){var d=this.i,p;for(p in d.g){for(var g=d.g[p],b=0;b<g.length;b++)Pe(g[b]);delete d.g[p],d.h--}}this.F=null},fe.prototype.K=function(d,p,g,b){return this.i.add(String(d),p,!1,g,b)},fe.prototype.L=function(d,p,g,b){return this.i.add(String(d),p,!0,g,b)};function Gt(d,p,g,b){if(p=d.i.g[String(p)],!p)return!0;p=p.concat();for(var O=!0,$=0;$<p.length;++$){var oe=p[$];if(oe&&!oe.da&&oe.capture==g){var xt=oe.listener,$n=oe.ha||oe.src;oe.fa&&Je(d.i,oe),O=xt.call($n,b)!==!1&&O}}return O&&!b.defaultPrevented}function Tt(d,p,g){if(typeof d=="function")g&&(d=m(d,g));else if(d&&typeof d.handleEvent=="function")d=m(d.handleEvent,d);else throw Error("Invalid listener argument");return 2147483647<Number(p)?-1:a.setTimeout(d,p||0)}function en(d){d.g=Tt(()=>{d.g=null,d.i&&(d.i=!1,en(d))},d.l);const p=d.h;d.h=null,d.m.apply(null,p)}class fn extends ee{constructor(p,g){super(),this.m=p,this.l=g,this.h=null,this.i=!1,this.g=null}j(p){this.h=arguments,this.g?this.i=!0:en(this)}N(){super.N(),this.g&&(a.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function Ht(d){ee.call(this),this.h=d,this.g={}}w(Ht,ee);var wn=[];function tn(d){F(d.g,function(p,g){this.g.hasOwnProperty(g)&&at(p)},d),d.g={}}Ht.prototype.N=function(){Ht.aa.N.call(this),tn(this)},Ht.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var mn=a.JSON.stringify,cn=a.JSON.parse,Qt=class{stringify(d){return a.JSON.stringify(d,void 0)}parse(d){return a.JSON.parse(d,void 0)}};function Gn(){}Gn.prototype.h=null;function qe(d){return d.h||(d.h=d.i())}function Qe(){}var nn={OPEN:"a",kb:"b",Ja:"c",wb:"d"};function ae(){pe.call(this,"d")}w(ae,pe);function lt(){pe.call(this,"c")}w(lt,pe);var Dt={},es=null;function Tn(){return es=es||new fe}Dt.La="serverreachability";function Ya(d){pe.call(this,Dt.La,d)}w(Ya,pe);function Mo(d){const p=Tn();je(p,new Ya(p))}Dt.STAT_EVENT="statevent";function Rh(d,p){pe.call(this,Dt.STAT_EVENT,d),this.stat=p}w(Rh,pe);function Vn(d){const p=Tn();je(p,new Rh(p,d))}Dt.Ma="timingevent";function Dh(d,p){pe.call(this,Dt.Ma,d),this.size=p}w(Dh,pe);function L(d,p){if(typeof d!="function")throw Error("Fn must not be null and must be a function");return a.setTimeout(function(){d()},p)}function J(){this.g=!0}J.prototype.xa=function(){this.g=!1};function ne(d,p,g,b,O,$){d.info(function(){if(d.g)if($)for(var oe="",xt=$.split("&"),$n=0;$n<xt.length;$n++){var nt=xt[$n].split("=");if(1<nt.length){var Hn=nt[0];nt=nt[1];var Qn=Hn.split("_");oe=2<=Qn.length&&Qn[1]=="type"?oe+(Hn+"="+nt+"&"):oe+(Hn+"=redacted&")}}else oe=null;else oe=$;return"XMLHTTP REQ ("+b+") [attempt "+O+"]: "+p+`
`+g+`
`+oe})}function et(d,p,g,b,O,$,oe){d.info(function(){return"XMLHTTP RESP ("+b+") [ attempt "+O+"]: "+p+`
`+g+`
`+$+" "+oe})}function vt(d,p,g,b){d.info(function(){return"XMLHTTP TEXT ("+p+"): "+Ie(d,g)+(b?" "+b:"")})}function pn(d,p){d.info(function(){return"TIMEOUT: "+p})}J.prototype.info=function(){};function Ie(d,p){if(!d.g)return p;if(!p)return null;try{var g=JSON.parse(p);if(g){for(d=0;d<g.length;d++)if(Array.isArray(g[d])){var b=g[d];if(!(2>b.length)){var O=b[1];if(Array.isArray(O)&&!(1>O.length)){var $=O[0];if($!="noop"&&$!="stop"&&$!="close")for(var oe=1;oe<O.length;oe++)O[oe]=""}}}}return mn(g)}catch{return p}}var Ye={NO_ERROR:0,gb:1,tb:2,sb:3,nb:4,rb:5,ub:6,Ia:7,TIMEOUT:8,xb:9},it={lb:"complete",Hb:"success",Ja:"error",Ia:"abort",zb:"ready",Ab:"readystatechange",TIMEOUT:"timeout",vb:"incrementaldata",yb:"progress",ob:"downloadprogress",Pb:"uploadprogress"},At;function gt(){}w(gt,Gn),gt.prototype.g=function(){return new XMLHttpRequest},gt.prototype.i=function(){return{}},At=new gt;function rn(d,p,g,b){this.j=d,this.i=p,this.l=g,this.R=b||1,this.U=new Ht(this),this.I=45e3,this.H=null,this.o=!1,this.m=this.A=this.v=this.L=this.F=this.S=this.B=null,this.D=[],this.g=null,this.C=0,this.s=this.u=null,this.X=-1,this.J=!1,this.O=0,this.M=null,this.W=this.K=this.T=this.P=!1,this.h=new Ai}function Ai(){this.i=null,this.g="",this.h=!1}var Sr={},ot={};function wt(d,p,g){d.L=1,d.v=jh(Gs(p)),d.m=g,d.P=!0,Fn(d,null)}function Fn(d,p){d.F=Date.now(),Xa(d),d.A=Gs(d.v);var g=d.A,b=d.R;Array.isArray(b)||(b=[String(b)]),wS(g.i,"t",b),d.C=0,g=d.j.J,d.h=new Ai,d.g=VS(d.j,g?p:null,!d.m),0<d.O&&(d.M=new fn(m(d.Y,d,d.g),d.O)),p=d.U,g=d.g,b=d.ca;var O="readystatechange";Array.isArray(O)||(O&&(wn[0]=O.toString()),O=wn);for(var $=0;$<O.length;$++){var oe=Se(g,O[$],b||p.handleEvent,!1,p.h||p);if(!oe)break;p.g[oe.key]=oe}p=d.H?x(d.H):{},d.m?(d.u||(d.u="POST"),p["Content-Type"]="application/x-www-form-urlencoded",d.g.ea(d.A,d.u,d.m,p)):(d.u="GET",d.g.ea(d.A,d.u,null,p)),Mo(),ne(d.i,d.u,d.A,d.l,d.R,d.m)}rn.prototype.ca=function(d){d=d.target;const p=this.M;p&&Hs(d)==3?p.j():this.Y(d)},rn.prototype.Y=function(d){try{if(d==this.g)e:{const Qn=Hs(this.g);var p=this.g.Ba();const tl=this.g.Z();if(!(3>Qn)&&(Qn!=3||this.g&&(this.h.h||this.g.oa()||AS(this.g)))){this.J||Qn!=4||p==7||(p==8||0>=tl?Mo(3):Mo(2)),ts(this);var g=this.g.Z();this.X=g;t:if(Ja(this)){var b=AS(this.g);d="";var O=b.length,$=Hs(this.g)==4;if(!this.h.i){if(typeof TextDecoder>"u"){ns(this),xs(this);var oe="";break t}this.h.i=new a.TextDecoder}for(p=0;p<O;p++)this.h.h=!0,d+=this.h.i.decode(b[p],{stream:!($&&p==O-1)});b.length=0,this.h.g+=d,this.C=0,oe=this.h.g}else oe=this.g.oa();if(this.o=g==200,et(this.i,this.u,this.A,this.l,this.R,Qn,g),this.o){if(this.T&&!this.K){t:{if(this.g){var xt,$n=this.g;if((xt=$n.g?$n.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!I(xt)){var nt=xt;break t}}nt=null}if(g=nt)vt(this.i,this.l,g,"Initial handshake response via X-HTTP-Initial-Response"),this.K=!0,Ug(this,g);else{this.o=!1,this.s=3,Vn(12),ns(this),xs(this);break e}}if(this.P){g=!0;let rs;for(;!this.J&&this.C<oe.length;)if(rs=$g(this,oe),rs==ot){Qn==4&&(this.s=4,Vn(14),g=!1),vt(this.i,this.l,null,"[Incomplete Response]");break}else if(rs==Sr){this.s=4,Vn(15),vt(this.i,this.l,oe,"[Invalid Chunk]"),g=!1;break}else vt(this.i,this.l,rs,null),Ug(this,rs);if(Ja(this)&&this.C!=0&&(this.h.g=this.h.g.slice(this.C),this.C=0),Qn!=4||oe.length!=0||this.h.h||(this.s=1,Vn(16),g=!1),this.o=this.o&&g,!g)vt(this.i,this.l,oe,"[Invalid Chunked Response]"),ns(this),xs(this);else if(0<oe.length&&!this.W){this.W=!0;var Hn=this.j;Hn.g==this&&Hn.ba&&!Hn.M&&(Hn.j.info("Great, no buffering proxy detected. Bytes received: "+oe.length),Hg(Hn),Hn.M=!0,Vn(11))}}else vt(this.i,this.l,oe,null),Ug(this,oe);Qn==4&&ns(this),this.o&&!this.J&&(Qn==4?OS(this.j,this):(this.o=!1,Xa(this)))}else C2(this.g),g==400&&0<oe.indexOf("Unknown SID")?(this.s=3,Vn(12)):(this.s=0,Vn(13)),ns(this),xs(this)}}}catch{}finally{}};function Ja(d){return d.g?d.u=="GET"&&d.L!=2&&d.j.Ca:!1}function $g(d,p){var g=d.C,b=p.indexOf(`
`,g);return b==-1?ot:(g=Number(p.substring(g,b)),isNaN(g)?Sr:(b+=1,b+g>p.length?ot:(p=p.slice(b,b+g),d.C=b+g,p)))}rn.prototype.cancel=function(){this.J=!0,ns(this)};function Xa(d){d.S=Date.now()+d.I,Pt(d,d.I)}function Pt(d,p){if(d.B!=null)throw Error("WatchDog timer not null");d.B=L(m(d.ba,d),p)}function ts(d){d.B&&(a.clearTimeout(d.B),d.B=null)}rn.prototype.ba=function(){this.B=null;const d=Date.now();0<=d-this.S?(pn(this.i,this.A),this.L!=2&&(Mo(),Vn(17)),ns(this),this.s=2,xs(this)):Pt(this,this.S-d)};function xs(d){d.j.G==0||d.J||OS(d.j,d)}function ns(d){ts(d);var p=d.M;p&&typeof p.ma=="function"&&p.ma(),d.M=null,tn(d.U),d.g&&(p=d.g,d.g=null,p.abort(),p.ma())}function Ug(d,p){try{var g=d.j;if(g.G!=0&&(g.g==d||Bg(g.h,d))){if(!d.K&&Bg(g.h,d)&&g.G==3){try{var b=g.Da.g.parse(p)}catch{b=null}if(Array.isArray(b)&&b.length==3){var O=b;if(O[0]==0){e:if(!g.u){if(g.g)if(g.g.F+3e3<d.F)Uh(g),Fh(g);else break e;Gg(g),Vn(18)}}else g.za=O[1],0<g.za-g.T&&37500>O[2]&&g.F&&g.v==0&&!g.C&&(g.C=L(m(g.Za,g),6e3));if(1>=dS(g.h)&&g.ca){try{g.ca()}catch{}g.ca=void 0}}else Fo(g,11)}else if((d.K||g.g==d)&&Uh(g),!I(p))for(O=g.Da.g.parse(p),p=0;p<O.length;p++){let nt=O[p];if(g.T=nt[0],nt=nt[1],g.G==2)if(nt[0]=="c"){g.K=nt[1],g.ia=nt[2];const Hn=nt[3];Hn!=null&&(g.la=Hn,g.j.info("VER="+g.la));const Qn=nt[4];Qn!=null&&(g.Aa=Qn,g.j.info("SVER="+g.Aa));const tl=nt[5];tl!=null&&typeof tl=="number"&&0<tl&&(b=1.5*tl,g.L=b,g.j.info("backChannelRequestTimeoutMs_="+b)),b=g;const rs=d.g;if(rs){const zh=rs.g?rs.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(zh){var $=b.h;$.g||zh.indexOf("spdy")==-1&&zh.indexOf("quic")==-1&&zh.indexOf("h2")==-1||($.j=$.l,$.g=new Set,$.h&&(zg($,$.h),$.h=null))}if(b.D){const Qg=rs.g?rs.g.getResponseHeader("X-HTTP-Session-Id"):null;Qg&&(b.ya=Qg,Ot(b.I,b.D,Qg))}}g.G=3,g.l&&g.l.ua(),g.ba&&(g.R=Date.now()-d.F,g.j.info("Handshake RTT: "+g.R+"ms")),b=g;var oe=d;if(b.qa=MS(b,b.J?b.ia:null,b.W),oe.K){hS(b.h,oe);var xt=oe,$n=b.L;$n&&(xt.I=$n),xt.B&&(ts(xt),Xa(xt)),b.g=oe}else DS(b);0<g.i.length&&$h(g)}else nt[0]!="stop"&&nt[0]!="close"||Fo(g,7);else g.G==3&&(nt[0]=="stop"||nt[0]=="close"?nt[0]=="stop"?Fo(g,7):Wg(g):nt[0]!="noop"&&g.l&&g.l.ta(nt),g.v=0)}}Mo(4)}catch{}}var h2=class{constructor(d,p){this.g=d,this.map=p}};function cS(d){this.l=d||10,a.PerformanceNavigationTiming?(d=a.performance.getEntriesByType("navigation"),d=0<d.length&&(d[0].nextHopProtocol=="hq"||d[0].nextHopProtocol=="h2")):d=!!(a.chrome&&a.chrome.loadTimes&&a.chrome.loadTimes()&&a.chrome.loadTimes().wasFetchedViaSpdy),this.j=d?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}function uS(d){return d.h?!0:d.g?d.g.size>=d.j:!1}function dS(d){return d.h?1:d.g?d.g.size:0}function Bg(d,p){return d.h?d.h==p:d.g?d.g.has(p):!1}function zg(d,p){d.g?d.g.add(p):d.h=p}function hS(d,p){d.h&&d.h==p?d.h=null:d.g&&d.g.has(p)&&d.g.delete(p)}cS.prototype.cancel=function(){if(this.i=fS(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&this.g.size!==0){for(const d of this.g.values())d.cancel();this.g.clear()}};function fS(d){if(d.h!=null)return d.i.concat(d.h.D);if(d.g!=null&&d.g.size!==0){let p=d.i;for(const g of d.g.values())p=p.concat(g.D);return p}return S(d.i)}function f2(d){if(d.V&&typeof d.V=="function")return d.V();if(typeof Map<"u"&&d instanceof Map||typeof Set<"u"&&d instanceof Set)return Array.from(d.values());if(typeof d=="string")return d.split("");if(c(d)){for(var p=[],g=d.length,b=0;b<g;b++)p.push(d[b]);return p}p=[],g=0;for(b in d)p[g++]=d[b];return p}function m2(d){if(d.na&&typeof d.na=="function")return d.na();if(!d.V||typeof d.V!="function"){if(typeof Map<"u"&&d instanceof Map)return Array.from(d.keys());if(!(typeof Set<"u"&&d instanceof Set)){if(c(d)||typeof d=="string"){var p=[];d=d.length;for(var g=0;g<d;g++)p.push(g);return p}p=[],g=0;for(const b in d)p[g++]=b;return p}}}function mS(d,p){if(d.forEach&&typeof d.forEach=="function")d.forEach(p,void 0);else if(c(d)||typeof d=="string")Array.prototype.forEach.call(d,p,void 0);else for(var g=m2(d),b=f2(d),O=b.length,$=0;$<O;$++)p.call(void 0,b[$],g&&g[$],d)}var pS=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function p2(d,p){if(d){d=d.split("&");for(var g=0;g<d.length;g++){var b=d[g].indexOf("="),O=null;if(0<=b){var $=d[g].substring(0,b);O=d[g].substring(b+1)}else $=d[g];p($,O?decodeURIComponent(O.replace(/\+/g," ")):"")}}}function Vo(d){if(this.g=this.o=this.j="",this.s=null,this.m=this.l="",this.h=!1,d instanceof Vo){this.h=d.h,Ph(this,d.j),this.o=d.o,this.g=d.g,Oh(this,d.s),this.l=d.l;var p=d.i,g=new zc;g.i=p.i,p.g&&(g.g=new Map(p.g),g.h=p.h),gS(this,g),this.m=d.m}else d&&(p=String(d).match(pS))?(this.h=!1,Ph(this,p[1]||"",!0),this.o=Uc(p[2]||""),this.g=Uc(p[3]||"",!0),Oh(this,p[4]),this.l=Uc(p[5]||"",!0),gS(this,p[6]||"",!0),this.m=Uc(p[7]||"")):(this.h=!1,this.i=new zc(null,this.h))}Vo.prototype.toString=function(){var d=[],p=this.j;p&&d.push(Bc(p,yS,!0),":");var g=this.g;return(g||p=="file")&&(d.push("//"),(p=this.o)&&d.push(Bc(p,yS,!0),"@"),d.push(encodeURIComponent(String(g)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),g=this.s,g!=null&&d.push(":",String(g))),(g=this.l)&&(this.g&&g.charAt(0)!="/"&&d.push("/"),d.push(Bc(g,g.charAt(0)=="/"?_2:y2,!0))),(g=this.i.toString())&&d.push("?",g),(g=this.m)&&d.push("#",Bc(g,w2)),d.join("")};function Gs(d){return new Vo(d)}function Ph(d,p,g){d.j=g?Uc(p,!0):p,d.j&&(d.j=d.j.replace(/:$/,""))}function Oh(d,p){if(p){if(p=Number(p),isNaN(p)||0>p)throw Error("Bad port number "+p);d.s=p}else d.s=null}function gS(d,p,g){p instanceof zc?(d.i=p,x2(d.i,d.h)):(g||(p=Bc(p,v2)),d.i=new zc(p,d.h))}function Ot(d,p,g){d.i.set(p,g)}function jh(d){return Ot(d,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),d}function Uc(d,p){return d?p?decodeURI(d.replace(/%25/g,"%2525")):decodeURIComponent(d):""}function Bc(d,p,g){return typeof d=="string"?(d=encodeURI(d).replace(p,g2),g&&(d=d.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),d):null}function g2(d){return d=d.charCodeAt(0),"%"+(d>>4&15).toString(16)+(d&15).toString(16)}var yS=/[#\/\?@]/g,y2=/[#\?:]/g,_2=/[#\?]/g,v2=/[#\?@]/g,w2=/#/g;function zc(d,p){this.h=this.g=null,this.i=d||null,this.j=!!p}function Ci(d){d.g||(d.g=new Map,d.h=0,d.i&&p2(d.i,function(p,g){d.add(decodeURIComponent(p.replace(/\+/g," ")),g)}))}n=zc.prototype,n.add=function(d,p){Ci(this),this.i=null,d=Za(this,d);var g=this.g.get(d);return g||this.g.set(d,g=[]),g.push(p),this.h+=1,this};function _S(d,p){Ci(d),p=Za(d,p),d.g.has(p)&&(d.i=null,d.h-=d.g.get(p).length,d.g.delete(p))}function vS(d,p){return Ci(d),p=Za(d,p),d.g.has(p)}n.forEach=function(d,p){Ci(this),this.g.forEach(function(g,b){g.forEach(function(O){d.call(p,O,b,this)},this)},this)},n.na=function(){Ci(this);const d=Array.from(this.g.values()),p=Array.from(this.g.keys()),g=[];for(let b=0;b<p.length;b++){const O=d[b];for(let $=0;$<O.length;$++)g.push(p[b])}return g},n.V=function(d){Ci(this);let p=[];if(typeof d=="string")vS(this,d)&&(p=p.concat(this.g.get(Za(this,d))));else{d=Array.from(this.g.values());for(let g=0;g<d.length;g++)p=p.concat(d[g])}return p},n.set=function(d,p){return Ci(this),this.i=null,d=Za(this,d),vS(this,d)&&(this.h-=this.g.get(d).length),this.g.set(d,[p]),this.h+=1,this},n.get=function(d,p){return d?(d=this.V(d),0<d.length?String(d[0]):p):p};function wS(d,p,g){_S(d,p),0<g.length&&(d.i=null,d.g.set(Za(d,p),S(g)),d.h+=g.length)}n.toString=function(){if(this.i)return this.i;if(!this.g)return"";const d=[],p=Array.from(this.g.keys());for(var g=0;g<p.length;g++){var b=p[g];const $=encodeURIComponent(String(b)),oe=this.V(b);for(b=0;b<oe.length;b++){var O=$;oe[b]!==""&&(O+="="+encodeURIComponent(String(oe[b]))),d.push(O)}}return this.i=d.join("&")};function Za(d,p){return p=String(p),d.j&&(p=p.toLowerCase()),p}function x2(d,p){p&&!d.j&&(Ci(d),d.i=null,d.g.forEach(function(g,b){var O=b.toLowerCase();b!=O&&(_S(this,b),wS(this,O,g))},d)),d.j=p}function S2(d,p){const g=new J;if(a.Image){const b=new Image;b.onload=y(ki,g,"TestLoadImage: loaded",!0,p,b),b.onerror=y(ki,g,"TestLoadImage: error",!1,p,b),b.onabort=y(ki,g,"TestLoadImage: abort",!1,p,b),b.ontimeout=y(ki,g,"TestLoadImage: timeout",!1,p,b),a.setTimeout(function(){b.ontimeout&&b.ontimeout()},1e4),b.src=d}else p(!1)}function I2(d,p){const g=new J,b=new AbortController,O=setTimeout(()=>{b.abort(),ki(g,"TestPingServer: timeout",!1,p)},1e4);fetch(d,{signal:b.signal}).then($=>{clearTimeout(O),$.ok?ki(g,"TestPingServer: ok",!0,p):ki(g,"TestPingServer: server error",!1,p)}).catch(()=>{clearTimeout(O),ki(g,"TestPingServer: error",!1,p)})}function ki(d,p,g,b,O){try{O&&(O.onload=null,O.onerror=null,O.onabort=null,O.ontimeout=null),b(g)}catch{}}function E2(){this.g=new Qt}function b2(d,p,g){const b=g||"";try{mS(d,function(O,$){let oe=O;u(O)&&(oe=mn(O)),p.push(b+$+"="+encodeURIComponent(oe))})}catch(O){throw p.push(b+"type="+encodeURIComponent("_badmap")),O}}function Lh(d){this.l=d.Ub||null,this.j=d.eb||!1}w(Lh,Gn),Lh.prototype.g=function(){return new Mh(this.l,this.j)},Lh.prototype.i=function(d){return function(){return d}}({});function Mh(d,p){fe.call(this),this.D=d,this.o=p,this.m=void 0,this.status=this.readyState=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.u=new Headers,this.h=null,this.B="GET",this.A="",this.g=!1,this.v=this.j=this.l=null}w(Mh,fe),n=Mh.prototype,n.open=function(d,p){if(this.readyState!=0)throw this.abort(),Error("Error reopening a connection");this.B=d,this.A=p,this.readyState=1,Wc(this)},n.send=function(d){if(this.readyState!=1)throw this.abort(),Error("need to call open() first. ");this.g=!0;const p={headers:this.u,method:this.B,credentials:this.m,cache:void 0};d&&(p.body=d),(this.D||a).fetch(new Request(this.A,p)).then(this.Sa.bind(this),this.ga.bind(this))},n.abort=function(){this.response=this.responseText="",this.u=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),1<=this.readyState&&this.g&&this.readyState!=4&&(this.g=!1,qc(this)),this.readyState=0},n.Sa=function(d){if(this.g&&(this.l=d,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=d.headers,this.readyState=2,Wc(this)),this.g&&(this.readyState=3,Wc(this),this.g)))if(this.responseType==="arraybuffer")d.arrayBuffer().then(this.Qa.bind(this),this.ga.bind(this));else if(typeof a.ReadableStream<"u"&&"body"in d){if(this.j=d.body.getReader(),this.o){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.v=new TextDecoder;xS(this)}else d.text().then(this.Ra.bind(this),this.ga.bind(this))};function xS(d){d.j.read().then(d.Pa.bind(d)).catch(d.ga.bind(d))}n.Pa=function(d){if(this.g){if(this.o&&d.value)this.response.push(d.value);else if(!this.o){var p=d.value?d.value:new Uint8Array(0);(p=this.v.decode(p,{stream:!d.done}))&&(this.response=this.responseText+=p)}d.done?qc(this):Wc(this),this.readyState==3&&xS(this)}},n.Ra=function(d){this.g&&(this.response=this.responseText=d,qc(this))},n.Qa=function(d){this.g&&(this.response=d,qc(this))},n.ga=function(){this.g&&qc(this)};function qc(d){d.readyState=4,d.l=null,d.j=null,d.v=null,Wc(d)}n.setRequestHeader=function(d,p){this.u.append(d,p)},n.getResponseHeader=function(d){return this.h&&this.h.get(d.toLowerCase())||""},n.getAllResponseHeaders=function(){if(!this.h)return"";const d=[],p=this.h.entries();for(var g=p.next();!g.done;)g=g.value,d.push(g[0]+": "+g[1]),g=p.next();return d.join(`\r
`)};function Wc(d){d.onreadystatechange&&d.onreadystatechange.call(d)}Object.defineProperty(Mh.prototype,"withCredentials",{get:function(){return this.m==="include"},set:function(d){this.m=d?"include":"same-origin"}});function SS(d){let p="";return F(d,function(g,b){p+=b,p+=":",p+=g,p+=`\r
`}),p}function qg(d,p,g){e:{for(b in g){var b=!1;break e}b=!0}b||(g=SS(g),typeof d=="string"?g!=null&&encodeURIComponent(String(g)):Ot(d,p,g))}function sn(d){fe.call(this),this.headers=new Map,this.o=d||null,this.h=!1,this.v=this.g=null,this.D="",this.m=0,this.l="",this.j=this.B=this.u=this.A=!1,this.I=null,this.H="",this.J=!1}w(sn,fe);var T2=/^https?$/i,A2=["POST","PUT"];n=sn.prototype,n.Ha=function(d){this.J=d},n.ea=function(d,p,g,b){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.D+"; newUri="+d);p=p?p.toUpperCase():"GET",this.D=d,this.l="",this.m=0,this.A=!1,this.h=!0,this.g=this.o?this.o.g():At.g(),this.v=this.o?qe(this.o):qe(At),this.g.onreadystatechange=m(this.Ea,this);try{this.B=!0,this.g.open(p,String(d),!0),this.B=!1}catch($){IS(this,$);return}if(d=g||"",g=new Map(this.headers),b)if(Object.getPrototypeOf(b)===Object.prototype)for(var O in b)g.set(O,b[O]);else if(typeof b.keys=="function"&&typeof b.get=="function")for(const $ of b.keys())g.set($,b.get($));else throw Error("Unknown input type for opt_headers: "+String(b));b=Array.from(g.keys()).find($=>$.toLowerCase()=="content-type"),O=a.FormData&&d instanceof a.FormData,!(0<=Array.prototype.indexOf.call(A2,p,void 0))||b||O||g.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(const[$,oe]of g)this.g.setRequestHeader($,oe);this.H&&(this.g.responseType=this.H),"withCredentials"in this.g&&this.g.withCredentials!==this.J&&(this.g.withCredentials=this.J);try{TS(this),this.u=!0,this.g.send(d),this.u=!1}catch($){IS(this,$)}};function IS(d,p){d.h=!1,d.g&&(d.j=!0,d.g.abort(),d.j=!1),d.l=p,d.m=5,ES(d),Vh(d)}function ES(d){d.A||(d.A=!0,je(d,"complete"),je(d,"error"))}n.abort=function(d){this.g&&this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1,this.m=d||7,je(this,"complete"),je(this,"abort"),Vh(this))},n.N=function(){this.g&&(this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1),Vh(this,!0)),sn.aa.N.call(this)},n.Ea=function(){this.s||(this.B||this.u||this.j?bS(this):this.bb())},n.bb=function(){bS(this)};function bS(d){if(d.h&&typeof o<"u"&&(!d.v[1]||Hs(d)!=4||d.Z()!=2)){if(d.u&&Hs(d)==4)Tt(d.Ea,0,d);else if(je(d,"readystatechange"),Hs(d)==4){d.h=!1;try{const oe=d.Z();e:switch(oe){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var p=!0;break e;default:p=!1}var g;if(!(g=p)){var b;if(b=oe===0){var O=String(d.D).match(pS)[1]||null;!O&&a.self&&a.self.location&&(O=a.self.location.protocol.slice(0,-1)),b=!T2.test(O?O.toLowerCase():"")}g=b}if(g)je(d,"complete"),je(d,"success");else{d.m=6;try{var $=2<Hs(d)?d.g.statusText:""}catch{$=""}d.l=$+" ["+d.Z()+"]",ES(d)}}finally{Vh(d)}}}}function Vh(d,p){if(d.g){TS(d);const g=d.g,b=d.v[0]?()=>{}:null;d.g=null,d.v=null,p||je(d,"ready");try{g.onreadystatechange=b}catch{}}}function TS(d){d.I&&(a.clearTimeout(d.I),d.I=null)}n.isActive=function(){return!!this.g};function Hs(d){return d.g?d.g.readyState:0}n.Z=function(){try{return 2<Hs(this)?this.g.status:-1}catch{return-1}},n.oa=function(){try{return this.g?this.g.responseText:""}catch{return""}},n.Oa=function(d){if(this.g){var p=this.g.responseText;return d&&p.indexOf(d)==0&&(p=p.substring(d.length)),cn(p)}};function AS(d){try{if(!d.g)return null;if("response"in d.g)return d.g.response;switch(d.H){case"":case"text":return d.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in d.g)return d.g.mozResponseArrayBuffer}return null}catch{return null}}function C2(d){const p={};d=(d.g&&2<=Hs(d)&&d.g.getAllResponseHeaders()||"").split(`\r
`);for(let b=0;b<d.length;b++){if(I(d[b]))continue;var g=C(d[b]);const O=g[0];if(g=g[1],typeof g!="string")continue;g=g.trim();const $=p[O]||[];p[O]=$,$.push(g)}A(p,function(b){return b.join(", ")})}n.Ba=function(){return this.m},n.Ka=function(){return typeof this.l=="string"?this.l:String(this.l)};function Gc(d,p,g){return g&&g.internalChannelParams&&g.internalChannelParams[d]||p}function CS(d){this.Aa=0,this.i=[],this.j=new J,this.ia=this.qa=this.I=this.W=this.g=this.ya=this.D=this.H=this.m=this.S=this.o=null,this.Ya=this.U=0,this.Va=Gc("failFast",!1,d),this.F=this.C=this.u=this.s=this.l=null,this.X=!0,this.za=this.T=-1,this.Y=this.v=this.B=0,this.Ta=Gc("baseRetryDelayMs",5e3,d),this.cb=Gc("retryDelaySeedMs",1e4,d),this.Wa=Gc("forwardChannelMaxRetries",2,d),this.wa=Gc("forwardChannelRequestTimeoutMs",2e4,d),this.pa=d&&d.xmlHttpFactory||void 0,this.Xa=d&&d.Tb||void 0,this.Ca=d&&d.useFetchStreams||!1,this.L=void 0,this.J=d&&d.supportsCrossDomainXhr||!1,this.K="",this.h=new cS(d&&d.concurrentRequestLimit),this.Da=new E2,this.P=d&&d.fastHandshake||!1,this.O=d&&d.encodeInitMessageHeaders||!1,this.P&&this.O&&(this.O=!1),this.Ua=d&&d.Rb||!1,d&&d.xa&&this.j.xa(),d&&d.forceLongPolling&&(this.X=!1),this.ba=!this.P&&this.X&&d&&d.detectBufferingProxy||!1,this.ja=void 0,d&&d.longPollingTimeout&&0<d.longPollingTimeout&&(this.ja=d.longPollingTimeout),this.ca=void 0,this.R=0,this.M=!1,this.ka=this.A=null}n=CS.prototype,n.la=8,n.G=1,n.connect=function(d,p,g,b){Vn(0),this.W=d,this.H=p||{},g&&b!==void 0&&(this.H.OSID=g,this.H.OAID=b),this.F=this.X,this.I=MS(this,null,this.W),$h(this)};function Wg(d){if(kS(d),d.G==3){var p=d.U++,g=Gs(d.I);if(Ot(g,"SID",d.K),Ot(g,"RID",p),Ot(g,"TYPE","terminate"),Hc(d,g),p=new rn(d,d.j,p),p.L=2,p.v=jh(Gs(g)),g=!1,a.navigator&&a.navigator.sendBeacon)try{g=a.navigator.sendBeacon(p.v.toString(),"")}catch{}!g&&a.Image&&(new Image().src=p.v,g=!0),g||(p.g=VS(p.j,null),p.g.ea(p.v)),p.F=Date.now(),Xa(p)}LS(d)}function Fh(d){d.g&&(Hg(d),d.g.cancel(),d.g=null)}function kS(d){Fh(d),d.u&&(a.clearTimeout(d.u),d.u=null),Uh(d),d.h.cancel(),d.s&&(typeof d.s=="number"&&a.clearTimeout(d.s),d.s=null)}function $h(d){if(!uS(d.h)&&!d.s){d.s=!0;var p=d.Ga;we||W(),z||(we(),z=!0),re.add(p,d),d.B=0}}function k2(d,p){return dS(d.h)>=d.h.j-(d.s?1:0)?!1:d.s?(d.i=p.D.concat(d.i),!0):d.G==1||d.G==2||d.B>=(d.Va?0:d.Wa)?!1:(d.s=L(m(d.Ga,d,p),jS(d,d.B)),d.B++,!0)}n.Ga=function(d){if(this.s)if(this.s=null,this.G==1){if(!d){this.U=Math.floor(1e5*Math.random()),d=this.U++;const O=new rn(this,this.j,d);let $=this.o;if(this.S&&($?($=x($),k($,this.S)):$=this.S),this.m!==null||this.O||(O.H=$,$=null),this.P)e:{for(var p=0,g=0;g<this.i.length;g++){t:{var b=this.i[g];if("__data__"in b.map&&(b=b.map.__data__,typeof b=="string")){b=b.length;break t}b=void 0}if(b===void 0)break;if(p+=b,4096<p){p=g;break e}if(p===4096||g===this.i.length-1){p=g+1;break e}}p=1e3}else p=1e3;p=RS(this,O,p),g=Gs(this.I),Ot(g,"RID",d),Ot(g,"CVER",22),this.D&&Ot(g,"X-HTTP-Session-Id",this.D),Hc(this,g),$&&(this.O?p="headers="+encodeURIComponent(String(SS($)))+"&"+p:this.m&&qg(g,this.m,$)),zg(this.h,O),this.Ua&&Ot(g,"TYPE","init"),this.P?(Ot(g,"$req",p),Ot(g,"SID","null"),O.T=!0,wt(O,g,null)):wt(O,g,p),this.G=2}}else this.G==3&&(d?NS(this,d):this.i.length==0||uS(this.h)||NS(this))};function NS(d,p){var g;p?g=p.l:g=d.U++;const b=Gs(d.I);Ot(b,"SID",d.K),Ot(b,"RID",g),Ot(b,"AID",d.T),Hc(d,b),d.m&&d.o&&qg(b,d.m,d.o),g=new rn(d,d.j,g,d.B+1),d.m===null&&(g.H=d.o),p&&(d.i=p.D.concat(d.i)),p=RS(d,g,1e3),g.I=Math.round(.5*d.wa)+Math.round(.5*d.wa*Math.random()),zg(d.h,g),wt(g,b,p)}function Hc(d,p){d.H&&F(d.H,function(g,b){Ot(p,b,g)}),d.l&&mS({},function(g,b){Ot(p,b,g)})}function RS(d,p,g){g=Math.min(d.i.length,g);var b=d.l?m(d.l.Na,d.l,d):null;e:{var O=d.i;let $=-1;for(;;){const oe=["count="+g];$==-1?0<g?($=O[0].g,oe.push("ofs="+$)):$=0:oe.push("ofs="+$);let xt=!0;for(let $n=0;$n<g;$n++){let nt=O[$n].g;const Hn=O[$n].map;if(nt-=$,0>nt)$=Math.max(0,O[$n].g-100),xt=!1;else try{b2(Hn,oe,"req"+nt+"_")}catch{b&&b(Hn)}}if(xt){b=oe.join("&");break e}}}return d=d.i.splice(0,g),p.D=d,b}function DS(d){if(!d.g&&!d.u){d.Y=1;var p=d.Fa;we||W(),z||(we(),z=!0),re.add(p,d),d.v=0}}function Gg(d){return d.g||d.u||3<=d.v?!1:(d.Y++,d.u=L(m(d.Fa,d),jS(d,d.v)),d.v++,!0)}n.Fa=function(){if(this.u=null,PS(this),this.ba&&!(this.M||this.g==null||0>=this.R)){var d=2*this.R;this.j.info("BP detection timer enabled: "+d),this.A=L(m(this.ab,this),d)}},n.ab=function(){this.A&&(this.A=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.F=!1,this.M=!0,Vn(10),Fh(this),PS(this))};function Hg(d){d.A!=null&&(a.clearTimeout(d.A),d.A=null)}function PS(d){d.g=new rn(d,d.j,"rpc",d.Y),d.m===null&&(d.g.H=d.o),d.g.O=0;var p=Gs(d.qa);Ot(p,"RID","rpc"),Ot(p,"SID",d.K),Ot(p,"AID",d.T),Ot(p,"CI",d.F?"0":"1"),!d.F&&d.ja&&Ot(p,"TO",d.ja),Ot(p,"TYPE","xmlhttp"),Hc(d,p),d.m&&d.o&&qg(p,d.m,d.o),d.L&&(d.g.I=d.L);var g=d.g;d=d.ia,g.L=1,g.v=jh(Gs(p)),g.m=null,g.P=!0,Fn(g,d)}n.Za=function(){this.C!=null&&(this.C=null,Fh(this),Gg(this),Vn(19))};function Uh(d){d.C!=null&&(a.clearTimeout(d.C),d.C=null)}function OS(d,p){var g=null;if(d.g==p){Uh(d),Hg(d),d.g=null;var b=2}else if(Bg(d.h,p))g=p.D,hS(d.h,p),b=1;else return;if(d.G!=0){if(p.o)if(b==1){g=p.m?p.m.length:0,p=Date.now()-p.F;var O=d.B;b=Tn(),je(b,new Dh(b,g)),$h(d)}else DS(d);else if(O=p.s,O==3||O==0&&0<p.X||!(b==1&&k2(d,p)||b==2&&Gg(d)))switch(g&&0<g.length&&(p=d.h,p.i=p.i.concat(g)),O){case 1:Fo(d,5);break;case 4:Fo(d,10);break;case 3:Fo(d,6);break;default:Fo(d,2)}}}function jS(d,p){let g=d.Ta+Math.floor(Math.random()*d.cb);return d.isActive()||(g*=2),g*p}function Fo(d,p){if(d.j.info("Error code "+p),p==2){var g=m(d.fb,d),b=d.Xa;const O=!b;b=new Vo(b||"//www.google.com/images/cleardot.gif"),a.location&&a.location.protocol=="http"||Ph(b,"https"),jh(b),O?S2(b.toString(),g):I2(b.toString(),g)}else Vn(2);d.G=0,d.l&&d.l.sa(p),LS(d),kS(d)}n.fb=function(d){d?(this.j.info("Successfully pinged google.com"),Vn(2)):(this.j.info("Failed to ping google.com"),Vn(1))};function LS(d){if(d.G=0,d.ka=[],d.l){const p=fS(d.h);(p.length!=0||d.i.length!=0)&&(R(d.ka,p),R(d.ka,d.i),d.h.i.length=0,S(d.i),d.i.length=0),d.l.ra()}}function MS(d,p,g){var b=g instanceof Vo?Gs(g):new Vo(g);if(b.g!="")p&&(b.g=p+"."+b.g),Oh(b,b.s);else{var O=a.location;b=O.protocol,p=p?p+"."+O.hostname:O.hostname,O=+O.port;var $=new Vo(null);b&&Ph($,b),p&&($.g=p),O&&Oh($,O),g&&($.l=g),b=$}return g=d.D,p=d.ya,g&&p&&Ot(b,g,p),Ot(b,"VER",d.la),Hc(d,b),b}function VS(d,p,g){if(p&&!d.J)throw Error("Can't create secondary domain capable XhrIo object.");return p=d.Ca&&!d.pa?new sn(new Lh({eb:g})):new sn(d.pa),p.Ha(d.J),p}n.isActive=function(){return!!this.l&&this.l.isActive(this)};function FS(){}n=FS.prototype,n.ua=function(){},n.ta=function(){},n.sa=function(){},n.ra=function(){},n.isActive=function(){return!0},n.Na=function(){};function Bh(){}Bh.prototype.g=function(d,p){return new Ir(d,p)};function Ir(d,p){fe.call(this),this.g=new CS(p),this.l=d,this.h=p&&p.messageUrlParams||null,d=p&&p.messageHeaders||null,p&&p.clientProtocolHeaderRequired&&(d?d["X-Client-Protocol"]="webchannel":d={"X-Client-Protocol":"webchannel"}),this.g.o=d,d=p&&p.initMessageHeaders||null,p&&p.messageContentType&&(d?d["X-WebChannel-Content-Type"]=p.messageContentType:d={"X-WebChannel-Content-Type":p.messageContentType}),p&&p.va&&(d?d["X-WebChannel-Client-Profile"]=p.va:d={"X-WebChannel-Client-Profile":p.va}),this.g.S=d,(d=p&&p.Sb)&&!I(d)&&(this.g.m=d),this.v=p&&p.supportsCrossDomainXhr||!1,this.u=p&&p.sendRawJson||!1,(p=p&&p.httpSessionIdParam)&&!I(p)&&(this.g.D=p,d=this.h,d!==null&&p in d&&(d=this.h,p in d&&delete d[p])),this.j=new el(this)}w(Ir,fe),Ir.prototype.m=function(){this.g.l=this.j,this.v&&(this.g.J=!0),this.g.connect(this.l,this.h||void 0)},Ir.prototype.close=function(){Wg(this.g)},Ir.prototype.o=function(d){var p=this.g;if(typeof d=="string"){var g={};g.__data__=d,d=g}else this.u&&(g={},g.__data__=mn(d),d=g);p.i.push(new h2(p.Ya++,d)),p.G==3&&$h(p)},Ir.prototype.N=function(){this.g.l=null,delete this.j,Wg(this.g),delete this.g,Ir.aa.N.call(this)};function $S(d){ae.call(this),d.__headers__&&(this.headers=d.__headers__,this.statusCode=d.__status__,delete d.__headers__,delete d.__status__);var p=d.__sm__;if(p){e:{for(const g in p){d=g;break e}d=void 0}(this.i=d)&&(d=this.i,p=p!==null&&d in p?p[d]:void 0),this.data=p}else this.data=d}w($S,ae);function US(){lt.call(this),this.status=1}w(US,lt);function el(d){this.g=d}w(el,FS),el.prototype.ua=function(){je(this.g,"a")},el.prototype.ta=function(d){je(this.g,new $S(d))},el.prototype.sa=function(d){je(this.g,new US)},el.prototype.ra=function(){je(this.g,"b")},Bh.prototype.createWebChannel=Bh.prototype.g,Ir.prototype.send=Ir.prototype.o,Ir.prototype.open=Ir.prototype.m,Ir.prototype.close=Ir.prototype.close,oN=function(){return new Bh},iN=function(){return Tn()},sN=Dt,pv={mb:0,pb:1,qb:2,Jb:3,Ob:4,Lb:5,Mb:6,Kb:7,Ib:8,Nb:9,PROXY:10,NOPROXY:11,Gb:12,Cb:13,Db:14,Bb:15,Eb:16,Fb:17,ib:18,hb:19,jb:20},Ye.NO_ERROR=0,Ye.TIMEOUT=8,Ye.HTTP_ERROR=6,Uf=Ye,it.COMPLETE="complete",rN=it,Qe.EventType=nn,nn.OPEN="a",nn.CLOSE="b",nn.ERROR="c",nn.MESSAGE="d",fe.prototype.listen=fe.prototype.K,wu=Qe,sn.prototype.listenOnce=sn.prototype.L,sn.prototype.getLastError=sn.prototype.Ka,sn.prototype.getLastErrorCode=sn.prototype.Ba,sn.prototype.getStatus=sn.prototype.Z,sn.prototype.getResponseJson=sn.prototype.Oa,sn.prototype.getResponseText=sn.prototype.oa,sn.prototype.send=sn.prototype.ea,sn.prototype.setWithCredentials=sn.prototype.Ha,nN=sn}).apply(typeof df<"u"?df:typeof self<"u"?self:typeof window<"u"?window:{});const zE="@firebase/firestore",qE="4.9.0";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Rn=class{constructor(e){this.uid=e}isAuthenticated(){return this.uid!=null}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}};Rn.UNAUTHENTICATED=new Rn(null),Rn.GOOGLE_CREDENTIALS=new Rn("google-credentials-uid"),Rn.FIRST_PARTY=new Rn("first-party-uid"),Rn.MOCK_USER=new Rn("mock-user");/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let kc="12.0.0";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const wo=new Xd("@firebase/firestore");function dl(){return wo.logLevel}function o7(n){wo.setLogLevel(n)}function G(n,...e){if(wo.logLevel<=We.DEBUG){const t=e.map(Nw);wo.debug(`Firestore (${kc}): ${n}`,...t)}}function dn(n,...e){if(wo.logLevel<=We.ERROR){const t=e.map(Nw);wo.error(`Firestore (${kc}): ${n}`,...t)}}function Xr(n,...e){if(wo.logLevel<=We.WARN){const t=e.map(Nw);wo.warn(`Firestore (${kc}): ${n}`,...t)}}function Nw(n){if(typeof n=="string")return n;try{/**
* @license
* Copyright 2020 Google LLC
*
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
*   http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
*/return function(t){return JSON.stringify(t)}(n)}catch{return n}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ue(n,e,t){let r="Unexpected state";typeof e=="string"?r=e:t=e,aN(n,r,t)}function aN(n,e,t){let r=`FIRESTORE (${kc}) INTERNAL ASSERTION FAILED: ${e} (ID: ${n.toString(16)})`;if(t!==void 0)try{r+=" CONTEXT: "+JSON.stringify(t)}catch{r+=" CONTEXT: "+t}throw dn(r),new Error(r)}function me(n,e,t,r){let s="Unexpected state";typeof t=="string"?s=t:r=t,n||aN(e,s,r)}function a7(n,e){n||ue(57014,e)}function ie(n,e){return n}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const M={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class q extends ys{constructor(e,t){super(e,t),this.code=e,this.message=t,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class On{constructor(){this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class lN{constructor(e,t){this.user=t,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}}class c3{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,t){e.enqueueRetryable(()=>t(Rn.UNAUTHENTICATED))}shutdown(){}}class u3{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,t){this.changeListener=t,e.enqueueRetryable(()=>t(this.token.user))}shutdown(){this.changeListener=null}}class d3{constructor(e){this.t=e,this.currentUser=Rn.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(e,t){me(this.o===void 0,42304);let r=this.i;const s=c=>this.i!==r?(r=this.i,t(c)):Promise.resolve();let i=new On;this.o=()=>{this.i++,this.currentUser=this.u(),i.resolve(),i=new On,e.enqueueRetryable(()=>s(this.currentUser))};const o=()=>{const c=i;e.enqueueRetryable(async()=>{await c.promise,await s(this.currentUser)})},a=c=>{G("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=c,this.o&&(this.auth.addAuthTokenListener(this.o),o())};this.t.onInit(c=>a(c)),setTimeout(()=>{if(!this.auth){const c=this.t.getImmediate({optional:!0});c?a(c):(G("FirebaseAuthCredentialsProvider","Auth not yet detected"),i.resolve(),i=new On)}},0),o()}getToken(){const e=this.i,t=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(t).then(r=>this.i!==e?(G("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):r?(me(typeof r.accessToken=="string",31837,{l:r}),new lN(r.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.o&&this.auth.removeAuthTokenListener(this.o),this.o=void 0}u(){const e=this.auth&&this.auth.getUid();return me(e===null||typeof e=="string",2055,{h:e}),new Rn(e)}}class h3{constructor(e,t,r){this.P=e,this.T=t,this.I=r,this.type="FirstParty",this.user=Rn.FIRST_PARTY,this.A=new Map}R(){return this.I?this.I():null}get headers(){this.A.set("X-Goog-AuthUser",this.P);const e=this.R();return e&&this.A.set("Authorization",e),this.T&&this.A.set("X-Goog-Iam-Authorization-Token",this.T),this.A}}class f3{constructor(e,t,r){this.P=e,this.T=t,this.I=r}getToken(){return Promise.resolve(new h3(this.P,this.T,this.I))}start(e,t){e.enqueueRetryable(()=>t(Rn.FIRST_PARTY))}shutdown(){}invalidateToken(){}}class gv{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class m3{constructor(e,t){this.V=t,this.forceRefresh=!1,this.appCheck=null,this.m=null,this.p=null,Bt(e)&&e.settings.appCheckToken&&(this.p=e.settings.appCheckToken)}start(e,t){me(this.o===void 0,3512);const r=i=>{i.error!=null&&G("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${i.error.message}`);const o=i.token!==this.m;return this.m=i.token,G("FirebaseAppCheckTokenProvider",`Received ${o?"new":"existing"} token.`),o?t(i.token):Promise.resolve()};this.o=i=>{e.enqueueRetryable(()=>r(i))};const s=i=>{G("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=i,this.o&&this.appCheck.addTokenListener(this.o)};this.V.onInit(i=>s(i)),setTimeout(()=>{if(!this.appCheck){const i=this.V.getImmediate({optional:!0});i?s(i):G("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}},0)}getToken(){if(this.p)return Promise.resolve(new gv(this.p));const e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then(t=>t?(me(typeof t.token=="string",44558,{tokenResult:t}),this.m=t.token,new gv(t.token)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.o&&this.appCheck.removeTokenListener(this.o),this.o=void 0}}class l7{getToken(){return Promise.resolve(new gv(""))}invalidateToken(){}start(e,t){}shutdown(){}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function p3(n){const e=typeof self<"u"&&(self.crypto||self.msCrypto),t=new Uint8Array(n);if(e&&typeof e.getRandomValues=="function")e.getRandomValues(t);else for(let r=0;r<n;r++)t[r]=Math.floor(256*Math.random());return t}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Rw{static newId(){const e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",t=62*Math.floor(4.129032258064516);let r="";for(;r.length<20;){const s=p3(40);for(let i=0;i<s.length;++i)r.length<20&&s[i]<t&&(r+=e.charAt(s[i]%62))}return r}}function Ne(n,e){return n<e?-1:n>e?1:0}function yv(n,e){const t=Math.min(n.length,e.length);for(let r=0;r<t;r++){const s=n.charAt(r),i=e.charAt(r);if(s!==i)return Dy(s)===Dy(i)?Ne(s,i):Dy(s)?1:-1}return Ne(n.length,e.length)}const g3=55296,y3=57343;function Dy(n){const e=n.charCodeAt(0);return e>=g3&&e<=y3}function ec(n,e,t){return n.length===e.length&&n.every((r,s)=>t(r,e[s]))}function cN(n){return n+"\0"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const _v="__name__";class Es{constructor(e,t,r){t===void 0?t=0:t>e.length&&ue(637,{offset:t,range:e.length}),r===void 0?r=e.length-t:r>e.length-t&&ue(1746,{length:r,range:e.length-t}),this.segments=e,this.offset=t,this.len=r}get length(){return this.len}isEqual(e){return Es.comparator(this,e)===0}child(e){const t=this.segments.slice(this.offset,this.limit());return e instanceof Es?e.forEach(r=>{t.push(r)}):t.push(e),this.construct(t)}limit(){return this.offset+this.length}popFirst(e){return e=e===void 0?1:e,this.construct(this.segments,this.offset+e,this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return this.length===0}isPrefixOf(e){if(e.length<this.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}forEach(e){for(let t=this.offset,r=this.limit();t<r;t++)e(this.segments[t])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,t){const r=Math.min(e.length,t.length);for(let s=0;s<r;s++){const i=Es.compareSegments(e.get(s),t.get(s));if(i!==0)return i}return Ne(e.length,t.length)}static compareSegments(e,t){const r=Es.isNumericId(e),s=Es.isNumericId(t);return r&&!s?-1:!r&&s?1:r&&s?Es.extractNumericId(e).compare(Es.extractNumericId(t)):yv(e,t)}static isNumericId(e){return e.startsWith("__id")&&e.endsWith("__")}static extractNumericId(e){return co.fromString(e.substring(4,e.length-2))}}class ze extends Es{construct(e,t,r){return new ze(e,t,r)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...e){const t=[];for(const r of e){if(r.indexOf("//")>=0)throw new q(M.INVALID_ARGUMENT,`Invalid segment (${r}). Paths must not contain // in them.`);t.push(...r.split("/").filter(s=>s.length>0))}return new ze(t)}static emptyPath(){return new ze([])}}const _3=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class qt extends Es{construct(e,t,r){return new qt(e,t,r)}static isValidIdentifier(e){return _3.test(e)}canonicalString(){return this.toArray().map(e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),qt.isValidIdentifier(e)||(e="`"+e+"`"),e)).join(".")}toString(){return this.canonicalString()}isKeyField(){return this.length===1&&this.get(0)===_v}static keyField(){return new qt([_v])}static fromServerFormat(e){const t=[];let r="",s=0;const i=()=>{if(r.length===0)throw new q(M.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);t.push(r),r=""};let o=!1;for(;s<e.length;){const a=e[s];if(a==="\\"){if(s+1===e.length)throw new q(M.INVALID_ARGUMENT,"Path has trailing escape character: "+e);const c=e[s+1];if(c!=="\\"&&c!=="."&&c!=="`")throw new q(M.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);r+=c,s+=2}else a==="`"?(o=!o,s++):a!=="."||o?(r+=a,s++):(i(),s++)}if(i(),o)throw new q(M.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new qt(t)}static emptyPath(){return new qt([])}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class se{constructor(e){this.path=e}static fromPath(e){return new se(ze.fromString(e))}static fromName(e){return new se(ze.fromString(e).popFirst(5))}static empty(){return new se(ze.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return e!==null&&ze.comparator(this.path,e.path)===0}toString(){return this.path.toString()}static comparator(e,t){return ze.comparator(e.path,t.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new se(new ze(e.slice()))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Dw(n,e,t){if(!t)throw new q(M.INVALID_ARGUMENT,`Function ${n}() cannot be called with an empty ${e}.`)}function v3(n,e,t,r){if(e===!0&&r===!0)throw new q(M.INVALID_ARGUMENT,`${n} and ${t} cannot be used together.`)}function WE(n){if(!se.isDocumentKey(n))throw new q(M.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${n} has ${n.length}.`)}function GE(n){if(se.isDocumentKey(n))throw new q(M.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${n} has ${n.length}.`)}function uN(n){return typeof n=="object"&&n!==null&&(Object.getPrototypeOf(n)===Object.prototype||Object.getPrototypeOf(n)===null)}function tg(n){if(n===void 0)return"undefined";if(n===null)return"null";if(typeof n=="string")return n.length>20&&(n=`${n.substring(0,20)}...`),JSON.stringify(n);if(typeof n=="number"||typeof n=="boolean")return""+n;if(typeof n=="object"){if(n instanceof Array)return"an array";{const e=function(r){return r.constructor?r.constructor.name:null}(n);return e?`a custom ${e} object`:"an object"}}return typeof n=="function"?"a function":ue(12329,{type:typeof n})}function Ge(n,e){if("_delegate"in n&&(n=n._delegate),!(n instanceof e)){if(e.name===n.constructor.name)throw new q(M.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{const t=tg(n);throw new q(M.INVALID_ARGUMENT,`Expected type '${e.name}', but it was: ${t}`)}}return n}function dN(n,e){if(e<=0)throw new q(M.INVALID_ARGUMENT,`Function ${n}() requires a positive number, but it was: ${e}.`)}/**
 * @license
 * Copyright 2025 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function vn(n,e){const t={typeString:n};return e&&(t.value=e),t}function Ba(n,e){if(!uN(n))throw new q(M.INVALID_ARGUMENT,"JSON must be an object");let t;for(const r in e)if(e[r]){const s=e[r].typeString,i="value"in e[r]?{value:e[r].value}:void 0;if(!(r in n)){t=`JSON missing required field: '${r}'`;break}const o=n[r];if(s&&typeof o!==s){t=`JSON field '${r}' must be a ${s}.`;break}if(i!==void 0&&o!==i.value){t=`Expected '${r}' field to equal '${i.value}'`;break}}if(t)throw new q(M.INVALID_ARGUMENT,t);return!0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const HE=-62135596800,QE=1e6;class Fe{static now(){return Fe.fromMillis(Date.now())}static fromDate(e){return Fe.fromMillis(e.getTime())}static fromMillis(e){const t=Math.floor(e/1e3),r=Math.floor((e-1e3*t)*QE);return new Fe(t,r)}constructor(e,t){if(this.seconds=e,this.nanoseconds=t,t<0)throw new q(M.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(t>=1e9)throw new q(M.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(e<HE)throw new q(M.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e);if(e>=253402300800)throw new q(M.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/QE}_compareTo(e){return this.seconds===e.seconds?Ne(this.nanoseconds,e.nanoseconds):Ne(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{type:Fe._jsonSchemaVersion,seconds:this.seconds,nanoseconds:this.nanoseconds}}static fromJSON(e){if(Ba(e,Fe._jsonSchema))return new Fe(e.seconds,e.nanoseconds)}valueOf(){const e=this.seconds-HE;return String(e).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}Fe._jsonSchemaVersion="firestore/timestamp/1.0",Fe._jsonSchema={type:vn("string",Fe._jsonSchemaVersion),seconds:vn("number"),nanoseconds:vn("number")};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class _e{static fromTimestamp(e){return new _e(e)}static min(){return new _e(new Fe(0,0))}static max(){return new _e(new Fe(253402300799,999999999))}constructor(e){this.timestamp=e}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const tc=-1;class nc{constructor(e,t,r,s){this.indexId=e,this.collectionGroup=t,this.fields=r,this.indexState=s}}function vv(n){return n.fields.find(e=>e.kind===2)}function Wo(n){return n.fields.filter(e=>e.kind!==2)}function w3(n,e){let t=Ne(n.collectionGroup,e.collectionGroup);if(t!==0)return t;for(let r=0;r<Math.min(n.fields.length,e.fields.length);++r)if(t=x3(n.fields[r],e.fields[r]),t!==0)return t;return Ne(n.fields.length,e.fields.length)}nc.UNKNOWN_ID=-1;class la{constructor(e,t){this.fieldPath=e,this.kind=t}}function x3(n,e){const t=qt.comparator(n.fieldPath,e.fieldPath);return t!==0?t:Ne(n.kind,e.kind)}class rc{constructor(e,t){this.sequenceNumber=e,this.offset=t}static empty(){return new rc(0,Mr.min())}}function hN(n,e){const t=n.toTimestamp().seconds,r=n.toTimestamp().nanoseconds+1,s=_e.fromTimestamp(r===1e9?new Fe(t+1,0):new Fe(t,r));return new Mr(s,se.empty(),e)}function fN(n){return new Mr(n.readTime,n.key,tc)}class Mr{constructor(e,t,r){this.readTime=e,this.documentKey=t,this.largestBatchId=r}static min(){return new Mr(_e.min(),se.empty(),tc)}static max(){return new Mr(_e.max(),se.empty(),tc)}}function Pw(n,e){let t=n.readTime.compareTo(e.readTime);return t!==0?t:(t=se.comparator(n.documentKey,e.documentKey),t!==0?t:Ne(n.largestBatchId,e.largestBatchId))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const mN="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class pN{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach(e=>e())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Ro(n){if(n.code!==M.FAILED_PRECONDITION||n.message!==mN)throw n;G("LocalStore","Unexpectedly lost primary lease")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class j{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e(t=>{this.isDone=!0,this.result=t,this.nextCallback&&this.nextCallback(t)},t=>{this.isDone=!0,this.error=t,this.catchCallback&&this.catchCallback(t)})}catch(e){return this.next(void 0,e)}next(e,t){return this.callbackAttached&&ue(59440),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(t,this.error):this.wrapSuccess(e,this.result):new j((r,s)=>{this.nextCallback=i=>{this.wrapSuccess(e,i).next(r,s)},this.catchCallback=i=>{this.wrapFailure(t,i).next(r,s)}})}toPromise(){return new Promise((e,t)=>{this.next(e,t)})}wrapUserFunction(e){try{const t=e();return t instanceof j?t:j.resolve(t)}catch(t){return j.reject(t)}}wrapSuccess(e,t){return e?this.wrapUserFunction(()=>e(t)):j.resolve(t)}wrapFailure(e,t){return e?this.wrapUserFunction(()=>e(t)):j.reject(t)}static resolve(e){return new j((t,r)=>{t(e)})}static reject(e){return new j((t,r)=>{r(e)})}static waitFor(e){return new j((t,r)=>{let s=0,i=0,o=!1;e.forEach(a=>{++s,a.next(()=>{++i,o&&i===s&&t()},c=>r(c))}),o=!0,i===s&&t()})}static or(e){let t=j.resolve(!1);for(const r of e)t=t.next(s=>s?j.resolve(s):r());return t}static forEach(e,t){const r=[];return e.forEach((s,i)=>{r.push(t.call(this,s,i))}),this.waitFor(r)}static mapArray(e,t){return new j((r,s)=>{const i=e.length,o=new Array(i);let a=0;for(let c=0;c<i;c++){const u=c;t(e[u]).next(h=>{o[u]=h,++a,a===i&&r(o)},h=>s(h))}})}static doWhile(e,t){return new j((r,s)=>{const i=()=>{e()===!0?t().next(()=>{i()},s):r()};i()})}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Tr="SimpleDb";class ng{static open(e,t,r,s){try{return new ng(t,e.transaction(s,r))}catch(i){throw new Fu(t,i)}}constructor(e,t){this.action=e,this.transaction=t,this.aborted=!1,this.S=new On,this.transaction.oncomplete=()=>{this.S.resolve()},this.transaction.onabort=()=>{t.error?this.S.reject(new Fu(e,t.error)):this.S.resolve()},this.transaction.onerror=r=>{const s=Ow(r.target.error);this.S.reject(new Fu(e,s))}}get D(){return this.S.promise}abort(e){e&&this.S.reject(e),this.aborted||(G(Tr,"Aborting transaction:",e?e.message:"Client-initiated abort"),this.aborted=!0,this.transaction.abort())}C(){const e=this.transaction;this.aborted||typeof e.commit!="function"||e.commit()}store(e){const t=this.transaction.objectStore(e);return new I3(t)}}class Ms{static delete(e){return G(Tr,"Removing database:",e),Ho(gC().indexedDB.deleteDatabase(e)).toPromise()}static v(){if(!jp())return!1;if(Ms.F())return!0;const e=En(),t=Ms.M(e),r=0<t&&t<10,s=gN(e),i=0<s&&s<4.5;return!(e.indexOf("MSIE ")>0||e.indexOf("Trident/")>0||e.indexOf("Edge/")>0||r||i)}static F(){var e;return typeof process<"u"&&((e=process.__PRIVATE_env)==null?void 0:e.__PRIVATE_USE_MOCK_PERSISTENCE)==="YES"}static O(e,t){return e.store(t)}static M(e){const t=e.match(/i(?:phone|pad|pod) os ([\d_]+)/i),r=t?t[1].split("_").slice(0,2).join("."):"-1";return Number(r)}constructor(e,t,r){this.name=e,this.version=t,this.N=r,this.B=null,Ms.M(En())===12.2&&dn("Firestore persistence suffers from a bug in iOS 12.2 Safari that may cause your app to stop working. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.")}async L(e){return this.db||(G(Tr,"Opening database:",this.name),this.db=await new Promise((t,r)=>{const s=indexedDB.open(this.name,this.version);s.onsuccess=i=>{const o=i.target.result;t(o)},s.onblocked=()=>{r(new Fu(e,"Cannot upgrade IndexedDB schema while another tab is open. Close all tabs that access Firestore and reload this page to proceed."))},s.onerror=i=>{const o=i.target.error;o.name==="VersionError"?r(new q(M.FAILED_PRECONDITION,"A newer version of the Firestore SDK was previously used and so the persisted data is not compatible with the version of the SDK you are now using. The SDK will operate with persistence disabled. If you need persistence, please re-upgrade to a newer version of the SDK or else clear the persisted IndexedDB data for your app to start fresh.")):o.name==="InvalidStateError"?r(new q(M.FAILED_PRECONDITION,"Unable to open an IndexedDB connection. This could be due to running in a private browsing session on a browser whose private browsing sessions do not support IndexedDB: "+o)):r(new Fu(e,o))},s.onupgradeneeded=i=>{G(Tr,'Database "'+this.name+'" requires upgrade from version:',i.oldVersion);const o=i.target.result;this.N.k(o,s.transaction,i.oldVersion,this.version).next(()=>{G(Tr,"Database upgrade to version "+this.version+" complete")})}})),this.q&&(this.db.onversionchange=t=>this.q(t)),this.db}$(e){this.q=e,this.db&&(this.db.onversionchange=t=>e(t))}async runTransaction(e,t,r,s){const i=t==="readonly";let o=0;for(;;){++o;try{this.db=await this.L(e);const a=ng.open(this.db,e,i?"readonly":"readwrite",r),c=s(a).next(u=>(a.C(),u)).catch(u=>(a.abort(u),j.reject(u))).toPromise();return c.catch(()=>{}),await a.D,c}catch(a){const c=a,u=c.name!=="FirebaseError"&&o<3;if(G(Tr,"Transaction failed with error:",c.message,"Retrying:",u),this.close(),!u)return Promise.reject(c)}}}close(){this.db&&this.db.close(),this.db=void 0}}function gN(n){const e=n.match(/Android ([\d.]+)/i),t=e?e[1].split(".").slice(0,2).join("."):"-1";return Number(t)}class S3{constructor(e){this.U=e,this.K=!1,this.W=null}get isDone(){return this.K}get G(){return this.W}set cursor(e){this.U=e}done(){this.K=!0}j(e){this.W=e}delete(){return Ho(this.U.delete())}}class Fu extends q{constructor(e,t){super(M.UNAVAILABLE,`IndexedDB transaction '${e}' failed: ${t}`),this.name="IndexedDbTransactionError"}}function Do(n){return n.name==="IndexedDbTransactionError"}class I3{constructor(e){this.store=e}put(e,t){let r;return t!==void 0?(G(Tr,"PUT",this.store.name,e,t),r=this.store.put(t,e)):(G(Tr,"PUT",this.store.name,"<auto-key>",e),r=this.store.put(e)),Ho(r)}add(e){return G(Tr,"ADD",this.store.name,e,e),Ho(this.store.add(e))}get(e){return Ho(this.store.get(e)).next(t=>(t===void 0&&(t=null),G(Tr,"GET",this.store.name,e,t),t))}delete(e){return G(Tr,"DELETE",this.store.name,e),Ho(this.store.delete(e))}count(){return G(Tr,"COUNT",this.store.name),Ho(this.store.count())}J(e,t){const r=this.options(e,t),s=r.index?this.store.index(r.index):this.store;if(typeof s.getAll=="function"){const i=s.getAll(r.range);return new j((o,a)=>{i.onerror=c=>{a(c.target.error)},i.onsuccess=c=>{o(c.target.result)}})}{const i=this.cursor(r),o=[];return this.H(i,(a,c)=>{o.push(c)}).next(()=>o)}}Y(e,t){const r=this.store.getAll(e,t===null?void 0:t);return new j((s,i)=>{r.onerror=o=>{i(o.target.error)},r.onsuccess=o=>{s(o.target.result)}})}Z(e,t){G(Tr,"DELETE ALL",this.store.name);const r=this.options(e,t);r.X=!1;const s=this.cursor(r);return this.H(s,(i,o,a)=>a.delete())}ee(e,t){let r;t?r=e:(r={},t=e);const s=this.cursor(r);return this.H(s,t)}te(e){const t=this.cursor({});return new j((r,s)=>{t.onerror=i=>{const o=Ow(i.target.error);s(o)},t.onsuccess=i=>{const o=i.target.result;o?e(o.primaryKey,o.value).next(a=>{a?o.continue():r()}):r()}})}H(e,t){const r=[];return new j((s,i)=>{e.onerror=o=>{i(o.target.error)},e.onsuccess=o=>{const a=o.target.result;if(!a)return void s();const c=new S3(a),u=t(a.primaryKey,a.value,c);if(u instanceof j){const h=u.catch(f=>(c.done(),j.reject(f)));r.push(h)}c.isDone?s():c.G===null?a.continue():a.continue(c.G)}}).next(()=>j.waitFor(r))}options(e,t){let r;return e!==void 0&&(typeof e=="string"?r=e:t=e),{index:r,range:t}}cursor(e){let t="next";if(e.reverse&&(t="prev"),e.index){const r=this.store.index(e.index);return e.X?r.openKeyCursor(e.range,t):r.openCursor(e.range,t)}return this.store.openCursor(e.range,t)}}function Ho(n){return new j((e,t)=>{n.onsuccess=r=>{const s=r.target.result;e(s)},n.onerror=r=>{const s=Ow(r.target.error);t(s)}})}let KE=!1;function Ow(n){const e=Ms.M(En());if(e>=12.2&&e<13){const t="An internal error was encountered in the Indexed Database server";if(n.message.indexOf(t)>=0){const r=new q("internal",`IOS_INDEXEDDB_BUG1: IndexedDb has thrown '${t}'. This is likely due to an unavoidable bug in iOS. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.`);return KE||(KE=!0,setTimeout(()=>{throw r},0)),r}}return n}const $u="IndexBackfiller";class E3{constructor(e,t){this.asyncQueue=e,this.ne=t,this.task=null}start(){this.re(15e3)}stop(){this.task&&(this.task.cancel(),this.task=null)}get started(){return this.task!==null}re(e){G($u,`Scheduled in ${e}ms`),this.task=this.asyncQueue.enqueueAfterDelay("index_backfill",e,async()=>{this.task=null;try{const t=await this.ne.ie();G($u,`Documents written: ${t}`)}catch(t){Do(t)?G($u,"Ignoring IndexedDB error during index backfill: ",t):await Ro(t)}await this.re(6e4)})}}class b3{constructor(e,t){this.localStore=e,this.persistence=t}async ie(e=50){return this.persistence.runTransaction("Backfill Indexes","readwrite-primary",t=>this.se(t,e))}se(e,t){const r=new Set;let s=t,i=!0;return j.doWhile(()=>i===!0&&s>0,()=>this.localStore.indexManager.getNextCollectionGroupToUpdate(e).next(o=>{if(o!==null&&!r.has(o))return G($u,`Processing collection: ${o}`),this.oe(e,o,s).next(a=>{s-=a,r.add(o)});i=!1})).next(()=>t-s)}oe(e,t,r){return this.localStore.indexManager.getMinOffsetFromCollectionGroup(e,t).next(s=>this.localStore.localDocuments.getNextDocuments(e,t,s,r).next(i=>{const o=i.changes;return this.localStore.indexManager.updateIndexEntries(e,o).next(()=>this._e(s,i)).next(a=>(G($u,`Updating offset: ${a}`),this.localStore.indexManager.updateCollectionGroup(e,t,a))).next(()=>o.size)}))}_e(e,t){let r=e;return t.changes.forEach((s,i)=>{const o=fN(i);Pw(o,r)>0&&(r=o)}),new Mr(r.readTime,r.documentKey,Math.max(t.batchId,e.largestBatchId))}}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class hr{constructor(e,t){this.previousValue=e,t&&(t.sequenceNumberHandler=r=>this.ae(r),this.ue=r=>t.writeSequenceNumber(r))}ae(e){return this.previousValue=Math.max(e,this.previousValue),this.previousValue}next(){const e=++this.previousValue;return this.ue&&this.ue(e),e}}hr.ce=-1;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const uo=-1;function uh(n){return n==null}function Ad(n){return n===0&&1/n==-1/0}function yN(n){return typeof n=="number"&&Number.isInteger(n)&&!Ad(n)&&n<=Number.MAX_SAFE_INTEGER&&n>=Number.MIN_SAFE_INTEGER}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Wm="";function tr(n){let e="";for(let t=0;t<n.length;t++)e.length>0&&(e=YE(e)),e=T3(n.get(t),e);return YE(e)}function T3(n,e){let t=e;const r=n.length;for(let s=0;s<r;s++){const i=n.charAt(s);switch(i){case"\0":t+="";break;case Wm:t+="";break;default:t+=i}}return t}function YE(n){return n+Wm+""}function ks(n){const e=n.length;if(me(e>=2,64408,{path:n}),e===2)return me(n.charAt(0)===Wm&&n.charAt(1)==="",56145,{path:n}),ze.emptyPath();const t=e-2,r=[];let s="";for(let i=0;i<e;){const o=n.indexOf(Wm,i);switch((o<0||o>t)&&ue(50515,{path:n}),n.charAt(o+1)){case"":const a=n.substring(i,o);let c;s.length===0?c=a:(s+=a,c=s,s=""),r.push(c);break;case"":s+=n.substring(i,o),s+="\0";break;case"":s+=n.substring(i,o+1);break;default:ue(61167,{path:n})}i=o+2}return new ze(r)}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Go="remoteDocuments",dh="owner",sl="owner",Cd="mutationQueues",A3="userId",as="mutations",JE="batchId",na="userMutationsIndex",XE=["userId","batchId"];/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Bf(n,e){return[n,tr(e)]}function _N(n,e,t){return[n,tr(e),t]}const C3={},sc="documentMutations",Gm="remoteDocumentsV14",k3=["prefixPath","collectionGroup","readTime","documentId"],zf="documentKeyIndex",N3=["prefixPath","collectionGroup","documentId"],vN="collectionGroupIndex",R3=["collectionGroup","readTime","prefixPath","documentId"],kd="remoteDocumentGlobal",wv="remoteDocumentGlobalKey",ic="targets",wN="queryTargetsIndex",D3=["canonicalId","targetId"],oc="targetDocuments",P3=["targetId","path"],jw="documentTargetsIndex",O3=["path","targetId"],Hm="targetGlobalKey",ca="targetGlobal",Nd="collectionParents",j3=["collectionId","parent"],ac="clientMetadata",L3="clientId",rg="bundles",M3="bundleId",sg="namedQueries",V3="name",Lw="indexConfiguration",F3="indexId",xv="collectionGroupIndex",$3="collectionGroup",Uu="indexState",U3=["indexId","uid"],xN="sequenceNumberIndex",B3=["uid","sequenceNumber"],Bu="indexEntries",z3=["indexId","uid","arrayValue","directionalValue","orderedDocumentKey","documentKey"],SN="documentKeyIndex",q3=["indexId","uid","orderedDocumentKey"],ig="documentOverlays",W3=["userId","collectionPath","documentId"],Sv="collectionPathOverlayIndex",G3=["userId","collectionPath","largestBatchId"],IN="collectionGroupOverlayIndex",H3=["userId","collectionGroup","largestBatchId"],Mw="globals",Q3="name",EN=[Cd,as,sc,Go,ic,dh,ca,oc,ac,kd,Nd,rg,sg],K3=[...EN,ig],bN=[Cd,as,sc,Gm,ic,dh,ca,oc,ac,kd,Nd,rg,sg,ig],TN=bN,Vw=[...TN,Lw,Uu,Bu],Y3=Vw,AN=[...Vw,Mw],J3=AN;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Iv extends pN{constructor(e,t){super(),this.le=e,this.currentSequenceNumber=t}}function bn(n,e){const t=ie(n);return Ms.O(t.le,e)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ZE(n){let e=0;for(const t in n)Object.prototype.hasOwnProperty.call(n,t)&&e++;return e}function Po(n,e){for(const t in n)Object.prototype.hasOwnProperty.call(n,t)&&e(t,n[t])}function CN(n,e){const t=[];for(const r in n)Object.prototype.hasOwnProperty.call(n,r)&&t.push(e(n[r],r,n));return t}function kN(n){for(const e in n)if(Object.prototype.hasOwnProperty.call(n,e))return!1;return!0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Rt{constructor(e,t){this.comparator=e,this.root=t||Bn.EMPTY}insert(e,t){return new Rt(this.comparator,this.root.insert(e,t,this.comparator).copy(null,null,Bn.BLACK,null,null))}remove(e){return new Rt(this.comparator,this.root.remove(e,this.comparator).copy(null,null,Bn.BLACK,null,null))}get(e){let t=this.root;for(;!t.isEmpty();){const r=this.comparator(e,t.key);if(r===0)return t.value;r<0?t=t.left:r>0&&(t=t.right)}return null}indexOf(e){let t=0,r=this.root;for(;!r.isEmpty();){const s=this.comparator(e,r.key);if(s===0)return t+r.left.size;s<0?r=r.left:(t+=r.left.size+1,r=r.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal((t,r)=>(e(t,r),!1))}toString(){const e=[];return this.inorderTraversal((t,r)=>(e.push(`${t}:${r}`),!1)),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new hf(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new hf(this.root,e,this.comparator,!1)}getReverseIterator(){return new hf(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new hf(this.root,e,this.comparator,!0)}}class hf{constructor(e,t,r,s){this.isReverse=s,this.nodeStack=[];let i=1;for(;!e.isEmpty();)if(i=t?r(e.key,t):1,t&&s&&(i*=-1),i<0)e=this.isReverse?e.left:e.right;else{if(i===0){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop();const t={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return t}hasNext(){return this.nodeStack.length>0}peek(){if(this.nodeStack.length===0)return null;const e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}}class Bn{constructor(e,t,r,s,i){this.key=e,this.value=t,this.color=r??Bn.RED,this.left=s??Bn.EMPTY,this.right=i??Bn.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,t,r,s,i){return new Bn(e??this.key,t??this.value,r??this.color,s??this.left,i??this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,r){let s=this;const i=r(e,s.key);return s=i<0?s.copy(null,null,null,s.left.insert(e,t,r),null):i===0?s.copy(null,t,null,null,null):s.copy(null,null,null,null,s.right.insert(e,t,r)),s.fixUp()}removeMin(){if(this.left.isEmpty())return Bn.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),e=e.copy(null,null,null,e.left.removeMin(),null),e.fixUp()}remove(e,t){let r,s=this;if(t(e,s.key)<0)s.left.isEmpty()||s.left.isRed()||s.left.left.isRed()||(s=s.moveRedLeft()),s=s.copy(null,null,null,s.left.remove(e,t),null);else{if(s.left.isRed()&&(s=s.rotateRight()),s.right.isEmpty()||s.right.isRed()||s.right.left.isRed()||(s=s.moveRedRight()),t(e,s.key)===0){if(s.right.isEmpty())return Bn.EMPTY;r=s.right.min(),s=s.copy(r.key,r.value,null,null,s.right.removeMin())}s=s.copy(null,null,null,null,s.right.remove(e,t))}return s.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=e.copy(null,null,null,null,e.right.rotateRight()),e=e.rotateLeft(),e=e.colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=e.rotateRight(),e=e.colorFlip()),e}rotateLeft(){const e=this.copy(null,null,Bn.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){const e=this.copy(null,null,Bn.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){const e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth(){const e=this.check();return Math.pow(2,e)<=this.size+1}check(){if(this.isRed()&&this.left.isRed())throw ue(43730,{key:this.key,value:this.value});if(this.right.isRed())throw ue(14113,{key:this.key,value:this.value});const e=this.left.check();if(e!==this.right.check())throw ue(27949);return e+(this.isRed()?0:1)}}Bn.EMPTY=null,Bn.RED=!0,Bn.BLACK=!1;Bn.EMPTY=new class{constructor(){this.size=0}get key(){throw ue(57766)}get value(){throw ue(16141)}get color(){throw ue(16727)}get left(){throw ue(29726)}get right(){throw ue(36894)}copy(e,t,r,s,i){return this}insert(e,t,r){return new Bn(e,t)}remove(e,t){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class mt{constructor(e){this.comparator=e,this.data=new Rt(this.comparator)}has(e){return this.data.get(e)!==null}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal((t,r)=>(e(t),!1))}forEachInRange(e,t){const r=this.data.getIteratorFrom(e[0]);for(;r.hasNext();){const s=r.getNext();if(this.comparator(s.key,e[1])>=0)return;t(s.key)}}forEachWhile(e,t){let r;for(r=t!==void 0?this.data.getIteratorFrom(t):this.data.getIterator();r.hasNext();)if(!e(r.getNext().key))return}firstAfterOrEqual(e){const t=this.data.getIteratorFrom(e);return t.hasNext()?t.getNext().key:null}getIterator(){return new eb(this.data.getIterator())}getIteratorFrom(e){return new eb(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let t=this;return t.size<e.size&&(t=e,e=this),e.forEach(r=>{t=t.add(r)}),t}isEqual(e){if(!(e instanceof mt)||this.size!==e.size)return!1;const t=this.data.getIterator(),r=e.data.getIterator();for(;t.hasNext();){const s=t.getNext().key,i=r.getNext().key;if(this.comparator(s,i)!==0)return!1}return!0}toArray(){const e=[];return this.forEach(t=>{e.push(t)}),e}toString(){const e=[];return this.forEach(t=>e.push(t)),"SortedSet("+e.toString()+")"}copy(e){const t=new mt(this.comparator);return t.data=e,t}}class eb{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}function il(n){return n.hasNext()?n.getNext():void 0}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class fr{constructor(e){this.fields=e,e.sort(qt.comparator)}static empty(){return new fr([])}unionWith(e){let t=new mt(qt.comparator);for(const r of this.fields)t=t.add(r);for(const r of e)t=t.add(r);return new fr(t.toArray())}covers(e){for(const t of this.fields)if(t.isPrefixOf(e))return!0;return!1}isEqual(e){return ec(this.fields,e.fields,(t,r)=>t.isEqual(r))}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class NN extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function u7(){return typeof atob<"u"}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class an{constructor(e){this.binaryString=e}static fromBase64String(e){const t=function(s){try{return atob(s)}catch(i){throw typeof DOMException<"u"&&i instanceof DOMException?new NN("Invalid base64 string: "+i):i}}(e);return new an(t)}static fromUint8Array(e){const t=function(s){let i="";for(let o=0;o<s.length;++o)i+=String.fromCharCode(s[o]);return i}(e);return new an(t)}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return function(t){return btoa(t)}(this.binaryString)}toUint8Array(){return function(t){const r=new Uint8Array(t.length);for(let s=0;s<t.length;s++)r[s]=t.charCodeAt(s);return r}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return Ne(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}}an.EMPTY_BYTE_STRING=new an("");const X3=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function mi(n){if(me(!!n,39018),typeof n=="string"){let e=0;const t=X3.exec(n);if(me(!!t,46558,{timestamp:n}),t[1]){let s=t[1];s=(s+"000000000").substr(0,9),e=Number(s)}const r=new Date(n);return{seconds:Math.floor(r.getTime()/1e3),nanos:e}}return{seconds:$t(n.seconds),nanos:$t(n.nanos)}}function $t(n){return typeof n=="number"?n:typeof n=="string"?Number(n):0}function pi(n){return typeof n=="string"?an.fromBase64String(n):an.fromUint8Array(n)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const RN="server_timestamp",DN="__type__",PN="__previous_value__",ON="__local_write_time__";function og(n){var t,r;return((r=(((t=n==null?void 0:n.mapValue)==null?void 0:t.fields)||{})[DN])==null?void 0:r.stringValue)===RN}function ag(n){const e=n.mapValue.fields[PN];return og(e)?ag(e):e}function Rd(n){const e=mi(n.mapValue.fields[ON].timestampValue);return new Fe(e.seconds,e.nanos)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Z3{constructor(e,t,r,s,i,o,a,c,u,h){this.databaseId=e,this.appId=t,this.persistenceKey=r,this.host=s,this.ssl=i,this.forceLongPolling=o,this.autoDetectLongPolling=a,this.longPollingOptions=c,this.useFetchStreams=u,this.isUsingEmulator=h}}const Dd="(default)";class Sa{constructor(e,t){this.projectId=e,this.database=t||Dd}static empty(){return new Sa("","")}get isDefaultDatabase(){return this.database===Dd}isEqual(e){return e instanceof Sa&&e.projectId===this.projectId&&e.database===this.database}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Fw="__type__",jN="__max__",Qi={mapValue:{fields:{__type__:{stringValue:jN}}}},$w="__vector__",lc="value",qf={nullValue:"NULL_VALUE"};function xo(n){return"nullValue"in n?0:"booleanValue"in n?1:"integerValue"in n||"doubleValue"in n?2:"timestampValue"in n?3:"stringValue"in n?5:"bytesValue"in n?6:"referenceValue"in n?7:"geoPointValue"in n?8:"arrayValue"in n?9:"mapValue"in n?og(n)?4:LN(n)?9007199254740991:lg(n)?10:11:ue(28295,{value:n})}function qs(n,e){if(n===e)return!0;const t=xo(n);if(t!==xo(e))return!1;switch(t){case 0:case 9007199254740991:return!0;case 1:return n.booleanValue===e.booleanValue;case 4:return Rd(n).isEqual(Rd(e));case 3:return function(s,i){if(typeof s.timestampValue=="string"&&typeof i.timestampValue=="string"&&s.timestampValue.length===i.timestampValue.length)return s.timestampValue===i.timestampValue;const o=mi(s.timestampValue),a=mi(i.timestampValue);return o.seconds===a.seconds&&o.nanos===a.nanos}(n,e);case 5:return n.stringValue===e.stringValue;case 6:return function(s,i){return pi(s.bytesValue).isEqual(pi(i.bytesValue))}(n,e);case 7:return n.referenceValue===e.referenceValue;case 8:return function(s,i){return $t(s.geoPointValue.latitude)===$t(i.geoPointValue.latitude)&&$t(s.geoPointValue.longitude)===$t(i.geoPointValue.longitude)}(n,e);case 2:return function(s,i){if("integerValue"in s&&"integerValue"in i)return $t(s.integerValue)===$t(i.integerValue);if("doubleValue"in s&&"doubleValue"in i){const o=$t(s.doubleValue),a=$t(i.doubleValue);return o===a?Ad(o)===Ad(a):isNaN(o)&&isNaN(a)}return!1}(n,e);case 9:return ec(n.arrayValue.values||[],e.arrayValue.values||[],qs);case 10:case 11:return function(s,i){const o=s.mapValue.fields||{},a=i.mapValue.fields||{};if(ZE(o)!==ZE(a))return!1;for(const c in o)if(o.hasOwnProperty(c)&&(a[c]===void 0||!qs(o[c],a[c])))return!1;return!0}(n,e);default:return ue(52216,{left:n})}}function Pd(n,e){return(n.values||[]).find(t=>qs(t,e))!==void 0}function So(n,e){if(n===e)return 0;const t=xo(n),r=xo(e);if(t!==r)return Ne(t,r);switch(t){case 0:case 9007199254740991:return 0;case 1:return Ne(n.booleanValue,e.booleanValue);case 2:return function(i,o){const a=$t(i.integerValue||i.doubleValue),c=$t(o.integerValue||o.doubleValue);return a<c?-1:a>c?1:a===c?0:isNaN(a)?isNaN(c)?0:-1:1}(n,e);case 3:return tb(n.timestampValue,e.timestampValue);case 4:return tb(Rd(n),Rd(e));case 5:return yv(n.stringValue,e.stringValue);case 6:return function(i,o){const a=pi(i),c=pi(o);return a.compareTo(c)}(n.bytesValue,e.bytesValue);case 7:return function(i,o){const a=i.split("/"),c=o.split("/");for(let u=0;u<a.length&&u<c.length;u++){const h=Ne(a[u],c[u]);if(h!==0)return h}return Ne(a.length,c.length)}(n.referenceValue,e.referenceValue);case 8:return function(i,o){const a=Ne($t(i.latitude),$t(o.latitude));return a!==0?a:Ne($t(i.longitude),$t(o.longitude))}(n.geoPointValue,e.geoPointValue);case 9:return nb(n.arrayValue,e.arrayValue);case 10:return function(i,o){var m,y,w,S;const a=i.fields||{},c=o.fields||{},u=(m=a[lc])==null?void 0:m.arrayValue,h=(y=c[lc])==null?void 0:y.arrayValue,f=Ne(((w=u==null?void 0:u.values)==null?void 0:w.length)||0,((S=h==null?void 0:h.values)==null?void 0:S.length)||0);return f!==0?f:nb(u,h)}(n.mapValue,e.mapValue);case 11:return function(i,o){if(i===Qi.mapValue&&o===Qi.mapValue)return 0;if(i===Qi.mapValue)return 1;if(o===Qi.mapValue)return-1;const a=i.fields||{},c=Object.keys(a),u=o.fields||{},h=Object.keys(u);c.sort(),h.sort();for(let f=0;f<c.length&&f<h.length;++f){const m=yv(c[f],h[f]);if(m!==0)return m;const y=So(a[c[f]],u[h[f]]);if(y!==0)return y}return Ne(c.length,h.length)}(n.mapValue,e.mapValue);default:throw ue(23264,{he:t})}}function tb(n,e){if(typeof n=="string"&&typeof e=="string"&&n.length===e.length)return Ne(n,e);const t=mi(n),r=mi(e),s=Ne(t.seconds,r.seconds);return s!==0?s:Ne(t.nanos,r.nanos)}function nb(n,e){const t=n.values||[],r=e.values||[];for(let s=0;s<t.length&&s<r.length;++s){const i=So(t[s],r[s]);if(i)return i}return Ne(t.length,r.length)}function cc(n){return Ev(n)}function Ev(n){return"nullValue"in n?"null":"booleanValue"in n?""+n.booleanValue:"integerValue"in n?""+n.integerValue:"doubleValue"in n?""+n.doubleValue:"timestampValue"in n?function(t){const r=mi(t);return`time(${r.seconds},${r.nanos})`}(n.timestampValue):"stringValue"in n?n.stringValue:"bytesValue"in n?function(t){return pi(t).toBase64()}(n.bytesValue):"referenceValue"in n?function(t){return se.fromName(t).toString()}(n.referenceValue):"geoPointValue"in n?function(t){return`geo(${t.latitude},${t.longitude})`}(n.geoPointValue):"arrayValue"in n?function(t){let r="[",s=!0;for(const i of t.values||[])s?s=!1:r+=",",r+=Ev(i);return r+"]"}(n.arrayValue):"mapValue"in n?function(t){const r=Object.keys(t.fields||{}).sort();let s="{",i=!0;for(const o of r)i?i=!1:s+=",",s+=`${o}:${Ev(t.fields[o])}`;return s+"}"}(n.mapValue):ue(61005,{value:n})}function Wf(n){switch(xo(n)){case 0:case 1:return 4;case 2:return 8;case 3:case 8:return 16;case 4:const e=ag(n);return e?16+Wf(e):16;case 5:return 2*n.stringValue.length;case 6:return pi(n.bytesValue).approximateByteSize();case 7:return n.referenceValue.length;case 9:return function(r){return(r.values||[]).reduce((s,i)=>s+Wf(i),0)}(n.arrayValue);case 10:case 11:return function(r){let s=0;return Po(r.fields,(i,o)=>{s+=i.length+Wf(o)}),s}(n.mapValue);default:throw ue(13486,{value:n})}}function Ia(n,e){return{referenceValue:`projects/${n.projectId}/databases/${n.database}/documents/${e.path.canonicalString()}`}}function bv(n){return!!n&&"integerValue"in n}function Od(n){return!!n&&"arrayValue"in n}function rb(n){return!!n&&"nullValue"in n}function sb(n){return!!n&&"doubleValue"in n&&isNaN(Number(n.doubleValue))}function Gf(n){return!!n&&"mapValue"in n}function lg(n){var t,r;return((r=(((t=n==null?void 0:n.mapValue)==null?void 0:t.fields)||{})[Fw])==null?void 0:r.stringValue)===$w}function zu(n){if(n.geoPointValue)return{geoPointValue:{...n.geoPointValue}};if(n.timestampValue&&typeof n.timestampValue=="object")return{timestampValue:{...n.timestampValue}};if(n.mapValue){const e={mapValue:{fields:{}}};return Po(n.mapValue.fields,(t,r)=>e.mapValue.fields[t]=zu(r)),e}if(n.arrayValue){const e={arrayValue:{values:[]}};for(let t=0;t<(n.arrayValue.values||[]).length;++t)e.arrayValue.values[t]=zu(n.arrayValue.values[t]);return e}return{...n}}function LN(n){return(((n.mapValue||{}).fields||{}).__type__||{}).stringValue===jN}const MN={mapValue:{fields:{[Fw]:{stringValue:$w},[lc]:{arrayValue:{}}}}};function e6(n){return"nullValue"in n?qf:"booleanValue"in n?{booleanValue:!1}:"integerValue"in n||"doubleValue"in n?{doubleValue:NaN}:"timestampValue"in n?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"stringValue"in n?{stringValue:""}:"bytesValue"in n?{bytesValue:""}:"referenceValue"in n?Ia(Sa.empty(),se.empty()):"geoPointValue"in n?{geoPointValue:{latitude:-90,longitude:-180}}:"arrayValue"in n?{arrayValue:{}}:"mapValue"in n?lg(n)?MN:{mapValue:{}}:ue(35942,{value:n})}function t6(n){return"nullValue"in n?{booleanValue:!1}:"booleanValue"in n?{doubleValue:NaN}:"integerValue"in n||"doubleValue"in n?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"timestampValue"in n?{stringValue:""}:"stringValue"in n?{bytesValue:""}:"bytesValue"in n?Ia(Sa.empty(),se.empty()):"referenceValue"in n?{geoPointValue:{latitude:-90,longitude:-180}}:"geoPointValue"in n?{arrayValue:{}}:"arrayValue"in n?MN:"mapValue"in n?lg(n)?{mapValue:{}}:Qi:ue(61959,{value:n})}function ib(n,e){const t=So(n.value,e.value);return t!==0?t:n.inclusive&&!e.inclusive?-1:!n.inclusive&&e.inclusive?1:0}function ob(n,e){const t=So(n.value,e.value);return t!==0?t:n.inclusive&&!e.inclusive?1:!n.inclusive&&e.inclusive?-1:0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class zn{constructor(e){this.value=e}static empty(){return new zn({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let t=this.value;for(let r=0;r<e.length-1;++r)if(t=(t.mapValue.fields||{})[e.get(r)],!Gf(t))return null;return t=(t.mapValue.fields||{})[e.lastSegment()],t||null}}set(e,t){this.getFieldsMap(e.popLast())[e.lastSegment()]=zu(t)}setAll(e){let t=qt.emptyPath(),r={},s=[];e.forEach((o,a)=>{if(!t.isImmediateParentOf(a)){const c=this.getFieldsMap(t);this.applyChanges(c,r,s),r={},s=[],t=a.popLast()}o?r[a.lastSegment()]=zu(o):s.push(a.lastSegment())});const i=this.getFieldsMap(t);this.applyChanges(i,r,s)}delete(e){const t=this.field(e.popLast());Gf(t)&&t.mapValue.fields&&delete t.mapValue.fields[e.lastSegment()]}isEqual(e){return qs(this.value,e.value)}getFieldsMap(e){let t=this.value;t.mapValue.fields||(t.mapValue={fields:{}});for(let r=0;r<e.length;++r){let s=t.mapValue.fields[e.get(r)];Gf(s)&&s.mapValue.fields||(s={mapValue:{fields:{}}},t.mapValue.fields[e.get(r)]=s),t=s}return t.mapValue.fields}applyChanges(e,t,r){Po(t,(s,i)=>e[s]=i);for(const s of r)delete e[s]}clone(){return new zn(zu(this.value))}}function VN(n){const e=[];return Po(n.fields,(t,r)=>{const s=new qt([t]);if(Gf(r)){const i=VN(r.mapValue).fields;if(i.length===0)e.push(s);else for(const o of i)e.push(s.child(o))}else e.push(s)}),new fr(e)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Lt{constructor(e,t,r,s,i,o,a){this.key=e,this.documentType=t,this.version=r,this.readTime=s,this.createTime=i,this.data=o,this.documentState=a}static newInvalidDocument(e){return new Lt(e,0,_e.min(),_e.min(),_e.min(),zn.empty(),0)}static newFoundDocument(e,t,r,s){return new Lt(e,1,t,_e.min(),r,s,0)}static newNoDocument(e,t){return new Lt(e,2,t,_e.min(),_e.min(),zn.empty(),0)}static newUnknownDocument(e,t){return new Lt(e,3,t,_e.min(),_e.min(),zn.empty(),2)}convertToFoundDocument(e,t){return!this.createTime.isEqual(_e.min())||this.documentType!==2&&this.documentType!==0||(this.createTime=e),this.version=e,this.documentType=1,this.data=t,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=zn.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=zn.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=_e.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return this.documentState===1}get hasCommittedMutations(){return this.documentState===2}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return this.documentType!==0}isFoundDocument(){return this.documentType===1}isNoDocument(){return this.documentType===2}isUnknownDocument(){return this.documentType===3}isEqual(e){return e instanceof Lt&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new Lt(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Io{constructor(e,t){this.position=e,this.inclusive=t}}function ab(n,e,t){let r=0;for(let s=0;s<n.position.length;s++){const i=e[s],o=n.position[s];if(i.field.isKeyField()?r=se.comparator(se.fromName(o.referenceValue),t.key):r=So(o,t.data.field(i.field)),i.dir==="desc"&&(r*=-1),r!==0)break}return r}function lb(n,e){if(n===null)return e===null;if(e===null||n.inclusive!==e.inclusive||n.position.length!==e.position.length)return!1;for(let t=0;t<n.position.length;t++)if(!qs(n.position[t],e.position[t]))return!1;return!0}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class jd{constructor(e,t="asc"){this.field=e,this.dir=t}}function n6(n,e){return n.dir===e.dir&&n.field.isEqual(e.field)}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class FN{}class Ke extends FN{constructor(e,t,r){super(),this.field=e,this.op=t,this.value=r}static create(e,t,r){return e.isKeyField()?t==="in"||t==="not-in"?this.createKeyFieldInFilter(e,t,r):new r6(e,t,r):t==="array-contains"?new o6(e,r):t==="in"?new WN(e,r):t==="not-in"?new a6(e,r):t==="array-contains-any"?new l6(e,r):new Ke(e,t,r)}static createKeyFieldInFilter(e,t,r){return t==="in"?new s6(e,r):new i6(e,r)}matches(e){const t=e.data.field(this.field);return this.op==="!="?t!==null&&t.nullValue===void 0&&this.matchesComparison(So(t,this.value)):t!==null&&xo(this.value)===xo(t)&&this.matchesComparison(So(t,this.value))}matchesComparison(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return e===0;case"!=":return e!==0;case">":return e>0;case">=":return e>=0;default:return ue(47266,{operator:this.op})}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}}class ht extends FN{constructor(e,t){super(),this.filters=e,this.op=t,this.Pe=null}static create(e,t){return new ht(e,t)}matches(e){return uc(this)?this.filters.find(t=>!t.matches(e))===void 0:this.filters.find(t=>t.matches(e))!==void 0}getFlattenedFilters(){return this.Pe!==null||(this.Pe=this.filters.reduce((e,t)=>e.concat(t.getFlattenedFilters()),[])),this.Pe}getFilters(){return Object.assign([],this.filters)}}function uc(n){return n.op==="and"}function Tv(n){return n.op==="or"}function Uw(n){return $N(n)&&uc(n)}function $N(n){for(const e of n.filters)if(e instanceof ht)return!1;return!0}function Av(n){if(n instanceof Ke)return n.field.canonicalString()+n.op.toString()+cc(n.value);if(Uw(n))return n.filters.map(e=>Av(e)).join(",");{const e=n.filters.map(t=>Av(t)).join(",");return`${n.op}(${e})`}}function UN(n,e){return n instanceof Ke?function(r,s){return s instanceof Ke&&r.op===s.op&&r.field.isEqual(s.field)&&qs(r.value,s.value)}(n,e):n instanceof ht?function(r,s){return s instanceof ht&&r.op===s.op&&r.filters.length===s.filters.length?r.filters.reduce((i,o,a)=>i&&UN(o,s.filters[a]),!0):!1}(n,e):void ue(19439)}function BN(n,e){const t=n.filters.concat(e);return ht.create(t,n.op)}function zN(n){return n instanceof Ke?function(t){return`${t.field.canonicalString()} ${t.op} ${cc(t.value)}`}(n):n instanceof ht?function(t){return t.op.toString()+" {"+t.getFilters().map(zN).join(" ,")+"}"}(n):"Filter"}class r6 extends Ke{constructor(e,t,r){super(e,t,r),this.key=se.fromName(r.referenceValue)}matches(e){const t=se.comparator(e.key,this.key);return this.matchesComparison(t)}}class s6 extends Ke{constructor(e,t){super(e,"in",t),this.keys=qN("in",t)}matches(e){return this.keys.some(t=>t.isEqual(e.key))}}class i6 extends Ke{constructor(e,t){super(e,"not-in",t),this.keys=qN("not-in",t)}matches(e){return!this.keys.some(t=>t.isEqual(e.key))}}function qN(n,e){var t;return(((t=e.arrayValue)==null?void 0:t.values)||[]).map(r=>se.fromName(r.referenceValue))}class o6 extends Ke{constructor(e,t){super(e,"array-contains",t)}matches(e){const t=e.data.field(this.field);return Od(t)&&Pd(t.arrayValue,this.value)}}class WN extends Ke{constructor(e,t){super(e,"in",t)}matches(e){const t=e.data.field(this.field);return t!==null&&Pd(this.value.arrayValue,t)}}class a6 extends Ke{constructor(e,t){super(e,"not-in",t)}matches(e){if(Pd(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;const t=e.data.field(this.field);return t!==null&&t.nullValue===void 0&&!Pd(this.value.arrayValue,t)}}class l6 extends Ke{constructor(e,t){super(e,"array-contains-any",t)}matches(e){const t=e.data.field(this.field);return!(!Od(t)||!t.arrayValue.values)&&t.arrayValue.values.some(r=>Pd(this.value.arrayValue,r))}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class c6{constructor(e,t=null,r=[],s=[],i=null,o=null,a=null){this.path=e,this.collectionGroup=t,this.orderBy=r,this.filters=s,this.limit=i,this.startAt=o,this.endAt=a,this.Te=null}}function Cv(n,e=null,t=[],r=[],s=null,i=null,o=null){return new c6(n,e,t,r,s,i,o)}function Ea(n){const e=ie(n);if(e.Te===null){let t=e.path.canonicalString();e.collectionGroup!==null&&(t+="|cg:"+e.collectionGroup),t+="|f:",t+=e.filters.map(r=>Av(r)).join(","),t+="|ob:",t+=e.orderBy.map(r=>function(i){return i.field.canonicalString()+i.dir}(r)).join(","),uh(e.limit)||(t+="|l:",t+=e.limit),e.startAt&&(t+="|lb:",t+=e.startAt.inclusive?"b:":"a:",t+=e.startAt.position.map(r=>cc(r)).join(",")),e.endAt&&(t+="|ub:",t+=e.endAt.inclusive?"a:":"b:",t+=e.endAt.position.map(r=>cc(r)).join(",")),e.Te=t}return e.Te}function hh(n,e){if(n.limit!==e.limit||n.orderBy.length!==e.orderBy.length)return!1;for(let t=0;t<n.orderBy.length;t++)if(!n6(n.orderBy[t],e.orderBy[t]))return!1;if(n.filters.length!==e.filters.length)return!1;for(let t=0;t<n.filters.length;t++)if(!UN(n.filters[t],e.filters[t]))return!1;return n.collectionGroup===e.collectionGroup&&!!n.path.isEqual(e.path)&&!!lb(n.startAt,e.startAt)&&lb(n.endAt,e.endAt)}function Qm(n){return se.isDocumentKey(n.path)&&n.collectionGroup===null&&n.filters.length===0}function Km(n,e){return n.filters.filter(t=>t instanceof Ke&&t.field.isEqual(e))}function cb(n,e,t){let r=qf,s=!0;for(const i of Km(n,e)){let o=qf,a=!0;switch(i.op){case"<":case"<=":o=e6(i.value);break;case"==":case"in":case">=":o=i.value;break;case">":o=i.value,a=!1;break;case"!=":case"not-in":o=qf}ib({value:r,inclusive:s},{value:o,inclusive:a})<0&&(r=o,s=a)}if(t!==null){for(let i=0;i<n.orderBy.length;++i)if(n.orderBy[i].field.isEqual(e)){const o=t.position[i];ib({value:r,inclusive:s},{value:o,inclusive:t.inclusive})<0&&(r=o,s=t.inclusive);break}}return{value:r,inclusive:s}}function ub(n,e,t){let r=Qi,s=!0;for(const i of Km(n,e)){let o=Qi,a=!0;switch(i.op){case">=":case">":o=t6(i.value),a=!1;break;case"==":case"in":case"<=":o=i.value;break;case"<":o=i.value,a=!1;break;case"!=":case"not-in":o=Qi}ob({value:r,inclusive:s},{value:o,inclusive:a})>0&&(r=o,s=a)}if(t!==null){for(let i=0;i<n.orderBy.length;++i)if(n.orderBy[i].field.isEqual(e)){const o=t.position[i];ob({value:r,inclusive:s},{value:o,inclusive:t.inclusive})>0&&(r=o,s=t.inclusive);break}}return{value:r,inclusive:s}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class xi{constructor(e,t=null,r=[],s=[],i=null,o="F",a=null,c=null){this.path=e,this.collectionGroup=t,this.explicitOrderBy=r,this.filters=s,this.limit=i,this.limitType=o,this.startAt=a,this.endAt=c,this.Ie=null,this.Ee=null,this.de=null,this.startAt,this.endAt}}function GN(n,e,t,r,s,i,o,a){return new xi(n,e,t,r,s,i,o,a)}function Nc(n){return new xi(n)}function db(n){return n.filters.length===0&&n.limit===null&&n.startAt==null&&n.endAt==null&&(n.explicitOrderBy.length===0||n.explicitOrderBy.length===1&&n.explicitOrderBy[0].field.isKeyField())}function Bw(n){return n.collectionGroup!==null}function jl(n){const e=ie(n);if(e.Ie===null){e.Ie=[];const t=new Set;for(const i of e.explicitOrderBy)e.Ie.push(i),t.add(i.field.canonicalString());const r=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc";(function(o){let a=new mt(qt.comparator);return o.filters.forEach(c=>{c.getFlattenedFilters().forEach(u=>{u.isInequality()&&(a=a.add(u.field))})}),a})(e).forEach(i=>{t.has(i.canonicalString())||i.isKeyField()||e.Ie.push(new jd(i,r))}),t.has(qt.keyField().canonicalString())||e.Ie.push(new jd(qt.keyField(),r))}return e.Ie}function nr(n){const e=ie(n);return e.Ee||(e.Ee=QN(e,jl(n))),e.Ee}function HN(n){const e=ie(n);return e.de||(e.de=QN(e,n.explicitOrderBy)),e.de}function QN(n,e){if(n.limitType==="F")return Cv(n.path,n.collectionGroup,e,n.filters,n.limit,n.startAt,n.endAt);{e=e.map(s=>{const i=s.dir==="desc"?"asc":"desc";return new jd(s.field,i)});const t=n.endAt?new Io(n.endAt.position,n.endAt.inclusive):null,r=n.startAt?new Io(n.startAt.position,n.startAt.inclusive):null;return Cv(n.path,n.collectionGroup,e,n.filters,n.limit,t,r)}}function kv(n,e){const t=n.filters.concat([e]);return new xi(n.path,n.collectionGroup,n.explicitOrderBy.slice(),t,n.limit,n.limitType,n.startAt,n.endAt)}function Ym(n,e,t){return new xi(n.path,n.collectionGroup,n.explicitOrderBy.slice(),n.filters.slice(),e,t,n.startAt,n.endAt)}function fh(n,e){return hh(nr(n),nr(e))&&n.limitType===e.limitType}function KN(n){return`${Ea(nr(n))}|lt:${n.limitType}`}function hl(n){return`Query(target=${function(t){let r=t.path.canonicalString();return t.collectionGroup!==null&&(r+=" collectionGroup="+t.collectionGroup),t.filters.length>0&&(r+=`, filters: [${t.filters.map(s=>zN(s)).join(", ")}]`),uh(t.limit)||(r+=", limit: "+t.limit),t.orderBy.length>0&&(r+=`, orderBy: [${t.orderBy.map(s=>function(o){return`${o.field.canonicalString()} (${o.dir})`}(s)).join(", ")}]`),t.startAt&&(r+=", startAt: ",r+=t.startAt.inclusive?"b:":"a:",r+=t.startAt.position.map(s=>cc(s)).join(",")),t.endAt&&(r+=", endAt: ",r+=t.endAt.inclusive?"a:":"b:",r+=t.endAt.position.map(s=>cc(s)).join(",")),`Target(${r})`}(nr(n))}; limitType=${n.limitType})`}function mh(n,e){return e.isFoundDocument()&&function(r,s){const i=s.key.path;return r.collectionGroup!==null?s.key.hasCollectionId(r.collectionGroup)&&r.path.isPrefixOf(i):se.isDocumentKey(r.path)?r.path.isEqual(i):r.path.isImmediateParentOf(i)}(n,e)&&function(r,s){for(const i of jl(r))if(!i.field.isKeyField()&&s.data.field(i.field)===null)return!1;return!0}(n,e)&&function(r,s){for(const i of r.filters)if(!i.matches(s))return!1;return!0}(n,e)&&function(r,s){return!(r.startAt&&!function(o,a,c){const u=ab(o,a,c);return o.inclusive?u<=0:u<0}(r.startAt,jl(r),s)||r.endAt&&!function(o,a,c){const u=ab(o,a,c);return o.inclusive?u>=0:u>0}(r.endAt,jl(r),s))}(n,e)}function YN(n){return n.collectionGroup||(n.path.length%2==1?n.path.lastSegment():n.path.get(n.path.length-2))}function JN(n){return(e,t)=>{let r=!1;for(const s of jl(n)){const i=u6(s,e,t);if(i!==0)return i;r=r||s.field.isKeyField()}return 0}}function u6(n,e,t){const r=n.field.isKeyField()?se.comparator(e.key,t.key):function(i,o,a){const c=o.data.field(i),u=a.data.field(i);return c!==null&&u!==null?So(c,u):ue(42886)}(n.field,e,t);switch(n.dir){case"asc":return r;case"desc":return-1*r;default:return ue(19790,{direction:n.dir})}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Si{constructor(e,t){this.mapKeyFn=e,this.equalsFn=t,this.inner={},this.innerSize=0}get(e){const t=this.mapKeyFn(e),r=this.inner[t];if(r!==void 0){for(const[s,i]of r)if(this.equalsFn(s,e))return i}}has(e){return this.get(e)!==void 0}set(e,t){const r=this.mapKeyFn(e),s=this.inner[r];if(s===void 0)return this.inner[r]=[[e,t]],void this.innerSize++;for(let i=0;i<s.length;i++)if(this.equalsFn(s[i][0],e))return void(s[i]=[e,t]);s.push([e,t]),this.innerSize++}delete(e){const t=this.mapKeyFn(e),r=this.inner[t];if(r===void 0)return!1;for(let s=0;s<r.length;s++)if(this.equalsFn(r[s][0],e))return r.length===1?delete this.inner[t]:r.splice(s,1),this.innerSize--,!0;return!1}forEach(e){Po(this.inner,(t,r)=>{for(const[s,i]of r)e(s,i)})}isEmpty(){return kN(this.inner)}size(){return this.innerSize}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const d6=new Rt(se.comparator);function mr(){return d6}const XN=new Rt(se.comparator);function xu(...n){let e=XN;for(const t of n)e=e.insert(t.key,t);return e}function ZN(n){let e=XN;return n.forEach((t,r)=>e=e.insert(t,r.overlayedDocument)),e}function Ns(){return qu()}function eR(){return qu()}function qu(){return new Si(n=>n.toString(),(n,e)=>n.isEqual(e))}const h6=new Rt(se.comparator),f6=new mt(se.comparator);function Le(...n){let e=f6;for(const t of n)e=e.add(t);return e}const m6=new mt(Ne);function zw(){return m6}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function qw(n,e){if(n.useProto3Json){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:Ad(e)?"-0":e}}function tR(n){return{integerValue:""+n}}function nR(n,e){return yN(e)?tR(e):qw(n,e)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class cg{constructor(){this._=void 0}}function p6(n,e,t){return n instanceof dc?function(s,i){const o={fields:{[DN]:{stringValue:RN},[ON]:{timestampValue:{seconds:s.seconds,nanos:s.nanoseconds}}}};return i&&og(i)&&(i=ag(i)),i&&(o.fields[PN]=i),{mapValue:o}}(t,e):n instanceof ba?sR(n,e):n instanceof Ta?iR(n,e):function(s,i){const o=rR(s,i),a=hb(o)+hb(s.Ae);return bv(o)&&bv(s.Ae)?tR(a):qw(s.serializer,a)}(n,e)}function g6(n,e,t){return n instanceof ba?sR(n,e):n instanceof Ta?iR(n,e):t}function rR(n,e){return n instanceof hc?function(r){return bv(r)||function(i){return!!i&&"doubleValue"in i}(r)}(e)?e:{integerValue:0}:null}class dc extends cg{}class ba extends cg{constructor(e){super(),this.elements=e}}function sR(n,e){const t=oR(e);for(const r of n.elements)t.some(s=>qs(s,r))||t.push(r);return{arrayValue:{values:t}}}class Ta extends cg{constructor(e){super(),this.elements=e}}function iR(n,e){let t=oR(e);for(const r of n.elements)t=t.filter(s=>!qs(s,r));return{arrayValue:{values:t}}}class hc extends cg{constructor(e,t){super(),this.serializer=e,this.Ae=t}}function hb(n){return $t(n.integerValue||n.doubleValue)}function oR(n){return Od(n)&&n.arrayValue.values?n.arrayValue.values.slice():[]}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ph{constructor(e,t){this.field=e,this.transform=t}}function y6(n,e){return n.field.isEqual(e.field)&&function(r,s){return r instanceof ba&&s instanceof ba||r instanceof Ta&&s instanceof Ta?ec(r.elements,s.elements,qs):r instanceof hc&&s instanceof hc?qs(r.Ae,s.Ae):r instanceof dc&&s instanceof dc}(n.transform,e.transform)}class _6{constructor(e,t){this.version=e,this.transformResults=t}}class Wt{constructor(e,t){this.updateTime=e,this.exists=t}static none(){return new Wt}static exists(e){return new Wt(void 0,e)}static updateTime(e){return new Wt(e)}get isNone(){return this.updateTime===void 0&&this.exists===void 0}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}}function Hf(n,e){return n.updateTime!==void 0?e.isFoundDocument()&&e.version.isEqual(n.updateTime):n.exists===void 0||n.exists===e.isFoundDocument()}class ug{}function aR(n,e){if(!n.hasLocalMutations||e&&e.fields.length===0)return null;if(e===null)return n.isNoDocument()?new Dc(n.key,Wt.none()):new Rc(n.key,n.data,Wt.none());{const t=n.data,r=zn.empty();let s=new mt(qt.comparator);for(let i of e.fields)if(!s.has(i)){let o=t.field(i);o===null&&i.length>1&&(i=i.popLast(),o=t.field(i)),o===null?r.delete(i):r.set(i,o),s=s.add(i)}return new Ii(n.key,r,new fr(s.toArray()),Wt.none())}}function v6(n,e,t){n instanceof Rc?function(s,i,o){const a=s.value.clone(),c=mb(s.fieldTransforms,i,o.transformResults);a.setAll(c),i.convertToFoundDocument(o.version,a).setHasCommittedMutations()}(n,e,t):n instanceof Ii?function(s,i,o){if(!Hf(s.precondition,i))return void i.convertToUnknownDocument(o.version);const a=mb(s.fieldTransforms,i,o.transformResults),c=i.data;c.setAll(lR(s)),c.setAll(a),i.convertToFoundDocument(o.version,c).setHasCommittedMutations()}(n,e,t):function(s,i,o){i.convertToNoDocument(o.version).setHasCommittedMutations()}(0,e,t)}function Wu(n,e,t,r){return n instanceof Rc?function(i,o,a,c){if(!Hf(i.precondition,o))return a;const u=i.value.clone(),h=pb(i.fieldTransforms,c,o);return u.setAll(h),o.convertToFoundDocument(o.version,u).setHasLocalMutations(),null}(n,e,t,r):n instanceof Ii?function(i,o,a,c){if(!Hf(i.precondition,o))return a;const u=pb(i.fieldTransforms,c,o),h=o.data;return h.setAll(lR(i)),h.setAll(u),o.convertToFoundDocument(o.version,h).setHasLocalMutations(),a===null?null:a.unionWith(i.fieldMask.fields).unionWith(i.fieldTransforms.map(f=>f.field))}(n,e,t,r):function(i,o,a){return Hf(i.precondition,o)?(o.convertToNoDocument(o.version).setHasLocalMutations(),null):a}(n,e,t)}function w6(n,e){let t=null;for(const r of n.fieldTransforms){const s=e.data.field(r.field),i=rR(r.transform,s||null);i!=null&&(t===null&&(t=zn.empty()),t.set(r.field,i))}return t||null}function fb(n,e){return n.type===e.type&&!!n.key.isEqual(e.key)&&!!n.precondition.isEqual(e.precondition)&&!!function(r,s){return r===void 0&&s===void 0||!(!r||!s)&&ec(r,s,(i,o)=>y6(i,o))}(n.fieldTransforms,e.fieldTransforms)&&(n.type===0?n.value.isEqual(e.value):n.type!==1||n.data.isEqual(e.data)&&n.fieldMask.isEqual(e.fieldMask))}class Rc extends ug{constructor(e,t,r,s=[]){super(),this.key=e,this.value=t,this.precondition=r,this.fieldTransforms=s,this.type=0}getFieldMask(){return null}}class Ii extends ug{constructor(e,t,r,s,i=[]){super(),this.key=e,this.data=t,this.fieldMask=r,this.precondition=s,this.fieldTransforms=i,this.type=1}getFieldMask(){return this.fieldMask}}function lR(n){const e=new Map;return n.fieldMask.fields.forEach(t=>{if(!t.isEmpty()){const r=n.data.field(t);e.set(t,r)}}),e}function mb(n,e,t){const r=new Map;me(n.length===t.length,32656,{Re:t.length,Ve:n.length});for(let s=0;s<t.length;s++){const i=n[s],o=i.transform,a=e.data.field(i.field);r.set(i.field,g6(o,a,t[s]))}return r}function pb(n,e,t){const r=new Map;for(const s of n){const i=s.transform,o=t.data.field(s.field);r.set(s.field,p6(i,o,e))}return r}class Dc extends ug{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class Ww extends ug{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Gw{constructor(e,t,r,s){this.batchId=e,this.localWriteTime=t,this.baseMutations=r,this.mutations=s}applyToRemoteDocument(e,t){const r=t.mutationResults;for(let s=0;s<this.mutations.length;s++){const i=this.mutations[s];i.key.isEqual(e.key)&&v6(i,e,r[s])}}applyToLocalView(e,t){for(const r of this.baseMutations)r.key.isEqual(e.key)&&(t=Wu(r,e,t,this.localWriteTime));for(const r of this.mutations)r.key.isEqual(e.key)&&(t=Wu(r,e,t,this.localWriteTime));return t}applyToLocalDocumentSet(e,t){const r=eR();return this.mutations.forEach(s=>{const i=e.get(s.key),o=i.overlayedDocument;let a=this.applyToLocalView(o,i.mutatedFields);a=t.has(s.key)?null:a;const c=aR(o,a);c!==null&&r.set(s.key,c),o.isValidDocument()||o.convertToNoDocument(_e.min())}),r}keys(){return this.mutations.reduce((e,t)=>e.add(t.key),Le())}isEqual(e){return this.batchId===e.batchId&&ec(this.mutations,e.mutations,(t,r)=>fb(t,r))&&ec(this.baseMutations,e.baseMutations,(t,r)=>fb(t,r))}}class Hw{constructor(e,t,r,s){this.batch=e,this.commitVersion=t,this.mutationResults=r,this.docVersions=s}static from(e,t,r){me(e.mutations.length===r.length,58842,{me:e.mutations.length,fe:r.length});let s=function(){return h6}();const i=e.mutations;for(let o=0;o<i.length;o++)s=s.insert(i[o].key,r[o].version);return new Hw(e,t,r,s)}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Qw{constructor(e,t){this.largestBatchId=e,this.mutation=t}getKey(){return this.mutation.key}isEqual(e){return e!==null&&this.mutation===e.mutation}toString(){return`Overlay{
      largestBatchId: ${this.largestBatchId},
      mutation: ${this.mutation.toString()}
    }`}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class cR{constructor(e,t,r){this.alias=e,this.aggregateType=t,this.fieldPath=r}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class x6{constructor(e,t){this.count=e,this.unchangedNames=t}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var gn,Ze;function uR(n){switch(n){case M.OK:return ue(64938);case M.CANCELLED:case M.UNKNOWN:case M.DEADLINE_EXCEEDED:case M.RESOURCE_EXHAUSTED:case M.INTERNAL:case M.UNAVAILABLE:case M.UNAUTHENTICATED:return!1;case M.INVALID_ARGUMENT:case M.NOT_FOUND:case M.ALREADY_EXISTS:case M.PERMISSION_DENIED:case M.FAILED_PRECONDITION:case M.ABORTED:case M.OUT_OF_RANGE:case M.UNIMPLEMENTED:case M.DATA_LOSS:return!0;default:return ue(15467,{code:n})}}function dR(n){if(n===void 0)return dn("GRPC error has no .code"),M.UNKNOWN;switch(n){case gn.OK:return M.OK;case gn.CANCELLED:return M.CANCELLED;case gn.UNKNOWN:return M.UNKNOWN;case gn.DEADLINE_EXCEEDED:return M.DEADLINE_EXCEEDED;case gn.RESOURCE_EXHAUSTED:return M.RESOURCE_EXHAUSTED;case gn.INTERNAL:return M.INTERNAL;case gn.UNAVAILABLE:return M.UNAVAILABLE;case gn.UNAUTHENTICATED:return M.UNAUTHENTICATED;case gn.INVALID_ARGUMENT:return M.INVALID_ARGUMENT;case gn.NOT_FOUND:return M.NOT_FOUND;case gn.ALREADY_EXISTS:return M.ALREADY_EXISTS;case gn.PERMISSION_DENIED:return M.PERMISSION_DENIED;case gn.FAILED_PRECONDITION:return M.FAILED_PRECONDITION;case gn.ABORTED:return M.ABORTED;case gn.OUT_OF_RANGE:return M.OUT_OF_RANGE;case gn.UNIMPLEMENTED:return M.UNIMPLEMENTED;case gn.DATA_LOSS:return M.DATA_LOSS;default:return ue(39323,{code:n})}}(Ze=gn||(gn={}))[Ze.OK=0]="OK",Ze[Ze.CANCELLED=1]="CANCELLED",Ze[Ze.UNKNOWN=2]="UNKNOWN",Ze[Ze.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",Ze[Ze.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",Ze[Ze.NOT_FOUND=5]="NOT_FOUND",Ze[Ze.ALREADY_EXISTS=6]="ALREADY_EXISTS",Ze[Ze.PERMISSION_DENIED=7]="PERMISSION_DENIED",Ze[Ze.UNAUTHENTICATED=16]="UNAUTHENTICATED",Ze[Ze.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",Ze[Ze.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",Ze[Ze.ABORTED=10]="ABORTED",Ze[Ze.OUT_OF_RANGE=11]="OUT_OF_RANGE",Ze[Ze.UNIMPLEMENTED=12]="UNIMPLEMENTED",Ze[Ze.INTERNAL=13]="INTERNAL",Ze[Ze.UNAVAILABLE=14]="UNAVAILABLE",Ze[Ze.DATA_LOSS=15]="DATA_LOSS";/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Gu=null;/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function hR(){return new TextEncoder}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const S6=new co([4294967295,4294967295],0);function gb(n){const e=hR().encode(n),t=new tN;return t.update(e),new Uint8Array(t.digest())}function yb(n){const e=new DataView(n.buffer),t=e.getUint32(0,!0),r=e.getUint32(4,!0),s=e.getUint32(8,!0),i=e.getUint32(12,!0);return[new co([t,r],0),new co([s,i],0)]}class Kw{constructor(e,t,r){if(this.bitmap=e,this.padding=t,this.hashCount=r,t<0||t>=8)throw new Su(`Invalid padding: ${t}`);if(r<0)throw new Su(`Invalid hash count: ${r}`);if(e.length>0&&this.hashCount===0)throw new Su(`Invalid hash count: ${r}`);if(e.length===0&&t!==0)throw new Su(`Invalid padding when bitmap length is 0: ${t}`);this.ge=8*e.length-t,this.pe=co.fromNumber(this.ge)}ye(e,t,r){let s=e.add(t.multiply(co.fromNumber(r)));return s.compare(S6)===1&&(s=new co([s.getBits(0),s.getBits(1)],0)),s.modulo(this.pe).toNumber()}we(e){return!!(this.bitmap[Math.floor(e/8)]&1<<e%8)}mightContain(e){if(this.ge===0)return!1;const t=gb(e),[r,s]=yb(t);for(let i=0;i<this.hashCount;i++){const o=this.ye(r,s,i);if(!this.we(o))return!1}return!0}static create(e,t,r){const s=e%8==0?0:8-e%8,i=new Uint8Array(Math.ceil(e/8)),o=new Kw(i,s,t);return r.forEach(a=>o.insert(a)),o}insert(e){if(this.ge===0)return;const t=gb(e),[r,s]=yb(t);for(let i=0;i<this.hashCount;i++){const o=this.ye(r,s,i);this.Se(o)}}Se(e){const t=Math.floor(e/8),r=e%8;this.bitmap[t]|=1<<r}}class Su extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class gh{constructor(e,t,r,s,i){this.snapshotVersion=e,this.targetChanges=t,this.targetMismatches=r,this.documentUpdates=s,this.resolvedLimboDocuments=i}static createSynthesizedRemoteEventForCurrentChange(e,t,r){const s=new Map;return s.set(e,yh.createSynthesizedTargetChangeForCurrentChange(e,t,r)),new gh(_e.min(),s,new Rt(Ne),mr(),Le())}}class yh{constructor(e,t,r,s,i){this.resumeToken=e,this.current=t,this.addedDocuments=r,this.modifiedDocuments=s,this.removedDocuments=i}static createSynthesizedTargetChangeForCurrentChange(e,t,r){return new yh(r,t,Le(),Le(),Le())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Qf{constructor(e,t,r,s){this.be=e,this.removedTargetIds=t,this.key=r,this.De=s}}class fR{constructor(e,t){this.targetId=e,this.Ce=t}}class mR{constructor(e,t,r=an.EMPTY_BYTE_STRING,s=null){this.state=e,this.targetIds=t,this.resumeToken=r,this.cause=s}}class _b{constructor(){this.ve=0,this.Fe=vb(),this.Me=an.EMPTY_BYTE_STRING,this.xe=!1,this.Oe=!0}get current(){return this.xe}get resumeToken(){return this.Me}get Ne(){return this.ve!==0}get Be(){return this.Oe}Le(e){e.approximateByteSize()>0&&(this.Oe=!0,this.Me=e)}ke(){let e=Le(),t=Le(),r=Le();return this.Fe.forEach((s,i)=>{switch(i){case 0:e=e.add(s);break;case 2:t=t.add(s);break;case 1:r=r.add(s);break;default:ue(38017,{changeType:i})}}),new yh(this.Me,this.xe,e,t,r)}qe(){this.Oe=!1,this.Fe=vb()}Qe(e,t){this.Oe=!0,this.Fe=this.Fe.insert(e,t)}$e(e){this.Oe=!0,this.Fe=this.Fe.remove(e)}Ue(){this.ve+=1}Ke(){this.ve-=1,me(this.ve>=0,3241,{ve:this.ve})}We(){this.Oe=!0,this.xe=!0}}class I6{constructor(e){this.Ge=e,this.ze=new Map,this.je=mr(),this.Je=ff(),this.He=ff(),this.Ye=new Rt(Ne)}Ze(e){for(const t of e.be)e.De&&e.De.isFoundDocument()?this.Xe(t,e.De):this.et(t,e.key,e.De);for(const t of e.removedTargetIds)this.et(t,e.key,e.De)}tt(e){this.forEachTarget(e,t=>{const r=this.nt(t);switch(e.state){case 0:this.rt(t)&&r.Le(e.resumeToken);break;case 1:r.Ke(),r.Ne||r.qe(),r.Le(e.resumeToken);break;case 2:r.Ke(),r.Ne||this.removeTarget(t);break;case 3:this.rt(t)&&(r.We(),r.Le(e.resumeToken));break;case 4:this.rt(t)&&(this.it(t),r.Le(e.resumeToken));break;default:ue(56790,{state:e.state})}})}forEachTarget(e,t){e.targetIds.length>0?e.targetIds.forEach(t):this.ze.forEach((r,s)=>{this.rt(s)&&t(s)})}st(e){const t=e.targetId,r=e.Ce.count,s=this.ot(t);if(s){const i=s.target;if(Qm(i))if(r===0){const o=new se(i.path);this.et(t,o,Lt.newNoDocument(o,_e.min()))}else me(r===1,20013,{expectedCount:r});else{const o=this._t(t);if(o!==r){const a=this.ut(e),c=a?this.ct(a,e,o):1;if(c!==0){this.it(t);const u=c===2?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.Ye=this.Ye.insert(t,u)}Gu==null||Gu.lt(function(h,f,m,y,w){var T,I,N;const S={localCacheCount:h,existenceFilterCount:f.count,databaseId:m.database,projectId:m.projectId},R=f.unchangedNames;return R&&(S.bloomFilter={applied:w===0,hashCount:(R==null?void 0:R.hashCount)??0,bitmapLength:((I=(T=R==null?void 0:R.bits)==null?void 0:T.bitmap)==null?void 0:I.length)??0,padding:((N=R==null?void 0:R.bits)==null?void 0:N.padding)??0,mightContain:P=>(y==null?void 0:y.mightContain(P))??!1}),S}(o,e.Ce,this.Ge.ht(),a,c))}}}}ut(e){const t=e.Ce.unchangedNames;if(!t||!t.bits)return null;const{bits:{bitmap:r="",padding:s=0},hashCount:i=0}=t;let o,a;try{o=pi(r).toUint8Array()}catch(c){if(c instanceof NN)return Xr("Decoding the base64 bloom filter in existence filter failed ("+c.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw c}try{a=new Kw(o,s,i)}catch(c){return Xr(c instanceof Su?"BloomFilter error: ":"Applying bloom filter failed: ",c),null}return a.ge===0?null:a}ct(e,t,r){return t.Ce.count===r-this.Pt(e,t.targetId)?0:2}Pt(e,t){const r=this.Ge.getRemoteKeysForTarget(t);let s=0;return r.forEach(i=>{const o=this.Ge.ht(),a=`projects/${o.projectId}/databases/${o.database}/documents/${i.path.canonicalString()}`;e.mightContain(a)||(this.et(t,i,null),s++)}),s}Tt(e){const t=new Map;this.ze.forEach((i,o)=>{const a=this.ot(o);if(a){if(i.current&&Qm(a.target)){const c=new se(a.target.path);this.It(c).has(o)||this.Et(o,c)||this.et(o,c,Lt.newNoDocument(c,e))}i.Be&&(t.set(o,i.ke()),i.qe())}});let r=Le();this.He.forEach((i,o)=>{let a=!0;o.forEachWhile(c=>{const u=this.ot(c);return!u||u.purpose==="TargetPurposeLimboResolution"||(a=!1,!1)}),a&&(r=r.add(i))}),this.je.forEach((i,o)=>o.setReadTime(e));const s=new gh(e,t,this.Ye,this.je,r);return this.je=mr(),this.Je=ff(),this.He=ff(),this.Ye=new Rt(Ne),s}Xe(e,t){if(!this.rt(e))return;const r=this.Et(e,t.key)?2:0;this.nt(e).Qe(t.key,r),this.je=this.je.insert(t.key,t),this.Je=this.Je.insert(t.key,this.It(t.key).add(e)),this.He=this.He.insert(t.key,this.dt(t.key).add(e))}et(e,t,r){if(!this.rt(e))return;const s=this.nt(e);this.Et(e,t)?s.Qe(t,1):s.$e(t),this.He=this.He.insert(t,this.dt(t).delete(e)),this.He=this.He.insert(t,this.dt(t).add(e)),r&&(this.je=this.je.insert(t,r))}removeTarget(e){this.ze.delete(e)}_t(e){const t=this.nt(e).ke();return this.Ge.getRemoteKeysForTarget(e).size+t.addedDocuments.size-t.removedDocuments.size}Ue(e){this.nt(e).Ue()}nt(e){let t=this.ze.get(e);return t||(t=new _b,this.ze.set(e,t)),t}dt(e){let t=this.He.get(e);return t||(t=new mt(Ne),this.He=this.He.insert(e,t)),t}It(e){let t=this.Je.get(e);return t||(t=new mt(Ne),this.Je=this.Je.insert(e,t)),t}rt(e){const t=this.ot(e)!==null;return t||G("WatchChangeAggregator","Detected inactive target",e),t}ot(e){const t=this.ze.get(e);return t&&t.Ne?null:this.Ge.At(e)}it(e){this.ze.set(e,new _b),this.Ge.getRemoteKeysForTarget(e).forEach(t=>{this.et(e,t,null)})}Et(e,t){return this.Ge.getRemoteKeysForTarget(e).has(t)}}function ff(){return new Rt(se.comparator)}function vb(){return new Rt(se.comparator)}const E6=(()=>({asc:"ASCENDING",desc:"DESCENDING"}))(),b6=(()=>({"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"}))(),T6=(()=>({and:"AND",or:"OR"}))();class A6{constructor(e,t){this.databaseId=e,this.useProto3Json=t}}function Nv(n,e){return n.useProto3Json||uh(e)?e:{value:e}}function fc(n,e){return n.useProto3Json?`${new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+e.nanoseconds).slice(-9)}Z`:{seconds:""+e.seconds,nanos:e.nanoseconds}}function pR(n,e){return n.useProto3Json?e.toBase64():e.toUint8Array()}function C6(n,e){return fc(n,e.toTimestamp())}function hn(n){return me(!!n,49232),_e.fromTimestamp(function(t){const r=mi(t);return new Fe(r.seconds,r.nanos)}(n))}function Yw(n,e){return Rv(n,e).canonicalString()}function Rv(n,e){const t=function(s){return new ze(["projects",s.projectId,"databases",s.database])}(n).child("documents");return e===void 0?t:t.child(e)}function gR(n){const e=ze.fromString(n);return me(bR(e),10190,{key:e.toString()}),e}function Ld(n,e){return Yw(n.databaseId,e.path)}function Vs(n,e){const t=gR(e);if(t.get(1)!==n.databaseId.projectId)throw new q(M.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+t.get(1)+" vs "+n.databaseId.projectId);if(t.get(3)!==n.databaseId.database)throw new q(M.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+t.get(3)+" vs "+n.databaseId.database);return new se(vR(t))}function yR(n,e){return Yw(n.databaseId,e)}function _R(n){const e=gR(n);return e.length===4?ze.emptyPath():vR(e)}function Dv(n){return new ze(["projects",n.databaseId.projectId,"databases",n.databaseId.database]).canonicalString()}function vR(n){return me(n.length>4&&n.get(4)==="documents",29091,{key:n.toString()}),n.popFirst(5)}function wb(n,e,t){return{name:Ld(n,e),fields:t.value.mapValue.fields}}function dg(n,e,t){const r=Vs(n,e.name),s=hn(e.updateTime),i=e.createTime?hn(e.createTime):_e.min(),o=new zn({mapValue:{fields:e.fields}}),a=Lt.newFoundDocument(r,s,i,o);return t&&a.setHasCommittedMutations(),t?a.setHasCommittedMutations():a}function k6(n,e){return"found"in e?function(r,s){me(!!s.found,43571),s.found.name,s.found.updateTime;const i=Vs(r,s.found.name),o=hn(s.found.updateTime),a=s.found.createTime?hn(s.found.createTime):_e.min(),c=new zn({mapValue:{fields:s.found.fields}});return Lt.newFoundDocument(i,o,a,c)}(n,e):"missing"in e?function(r,s){me(!!s.missing,3894),me(!!s.readTime,22933);const i=Vs(r,s.missing),o=hn(s.readTime);return Lt.newNoDocument(i,o)}(n,e):ue(7234,{result:e})}function N6(n,e){let t;if("targetChange"in e){e.targetChange;const r=function(u){return u==="NO_CHANGE"?0:u==="ADD"?1:u==="REMOVE"?2:u==="CURRENT"?3:u==="RESET"?4:ue(39313,{state:u})}(e.targetChange.targetChangeType||"NO_CHANGE"),s=e.targetChange.targetIds||[],i=function(u,h){return u.useProto3Json?(me(h===void 0||typeof h=="string",58123),an.fromBase64String(h||"")):(me(h===void 0||h instanceof Buffer||h instanceof Uint8Array,16193),an.fromUint8Array(h||new Uint8Array))}(n,e.targetChange.resumeToken),o=e.targetChange.cause,a=o&&function(u){const h=u.code===void 0?M.UNKNOWN:dR(u.code);return new q(h,u.message||"")}(o);t=new mR(r,s,i,a||null)}else if("documentChange"in e){e.documentChange;const r=e.documentChange;r.document,r.document.name,r.document.updateTime;const s=Vs(n,r.document.name),i=hn(r.document.updateTime),o=r.document.createTime?hn(r.document.createTime):_e.min(),a=new zn({mapValue:{fields:r.document.fields}}),c=Lt.newFoundDocument(s,i,o,a),u=r.targetIds||[],h=r.removedTargetIds||[];t=new Qf(u,h,c.key,c)}else if("documentDelete"in e){e.documentDelete;const r=e.documentDelete;r.document;const s=Vs(n,r.document),i=r.readTime?hn(r.readTime):_e.min(),o=Lt.newNoDocument(s,i),a=r.removedTargetIds||[];t=new Qf([],a,o.key,o)}else if("documentRemove"in e){e.documentRemove;const r=e.documentRemove;r.document;const s=Vs(n,r.document),i=r.removedTargetIds||[];t=new Qf([],i,s,null)}else{if(!("filter"in e))return ue(11601,{Rt:e});{e.filter;const r=e.filter;r.targetId;const{count:s=0,unchangedNames:i}=r,o=new x6(s,i),a=r.targetId;t=new fR(a,o)}}return t}function Md(n,e){let t;if(e instanceof Rc)t={update:wb(n,e.key,e.value)};else if(e instanceof Dc)t={delete:Ld(n,e.key)};else if(e instanceof Ii)t={update:wb(n,e.key,e.data),updateMask:L6(e.fieldMask)};else{if(!(e instanceof Ww))return ue(16599,{Vt:e.type});t={verify:Ld(n,e.key)}}return e.fieldTransforms.length>0&&(t.updateTransforms=e.fieldTransforms.map(r=>function(i,o){const a=o.transform;if(a instanceof dc)return{fieldPath:o.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(a instanceof ba)return{fieldPath:o.field.canonicalString(),appendMissingElements:{values:a.elements}};if(a instanceof Ta)return{fieldPath:o.field.canonicalString(),removeAllFromArray:{values:a.elements}};if(a instanceof hc)return{fieldPath:o.field.canonicalString(),increment:a.Ae};throw ue(20930,{transform:o.transform})}(0,r))),e.precondition.isNone||(t.currentDocument=function(s,i){return i.updateTime!==void 0?{updateTime:C6(s,i.updateTime)}:i.exists!==void 0?{exists:i.exists}:ue(27497)}(n,e.precondition)),t}function Pv(n,e){const t=e.currentDocument?function(i){return i.updateTime!==void 0?Wt.updateTime(hn(i.updateTime)):i.exists!==void 0?Wt.exists(i.exists):Wt.none()}(e.currentDocument):Wt.none(),r=e.updateTransforms?e.updateTransforms.map(s=>function(o,a){let c=null;if("setToServerValue"in a)me(a.setToServerValue==="REQUEST_TIME",16630,{proto:a}),c=new dc;else if("appendMissingElements"in a){const h=a.appendMissingElements.values||[];c=new ba(h)}else if("removeAllFromArray"in a){const h=a.removeAllFromArray.values||[];c=new Ta(h)}else"increment"in a?c=new hc(o,a.increment):ue(16584,{proto:a});const u=qt.fromServerFormat(a.fieldPath);return new ph(u,c)}(n,s)):[];if(e.update){e.update.name;const s=Vs(n,e.update.name),i=new zn({mapValue:{fields:e.update.fields}});if(e.updateMask){const o=function(c){const u=c.fieldPaths||[];return new fr(u.map(h=>qt.fromServerFormat(h)))}(e.updateMask);return new Ii(s,i,o,t,r)}return new Rc(s,i,t,r)}if(e.delete){const s=Vs(n,e.delete);return new Dc(s,t)}if(e.verify){const s=Vs(n,e.verify);return new Ww(s,t)}return ue(1463,{proto:e})}function R6(n,e){return n&&n.length>0?(me(e!==void 0,14353),n.map(t=>function(s,i){let o=s.updateTime?hn(s.updateTime):hn(i);return o.isEqual(_e.min())&&(o=hn(i)),new _6(o,s.transformResults||[])}(t,e))):[]}function wR(n,e){return{documents:[yR(n,e.path)]}}function hg(n,e){const t={structuredQuery:{}},r=e.path;let s;e.collectionGroup!==null?(s=r,t.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(s=r.popLast(),t.structuredQuery.from=[{collectionId:r.lastSegment()}]),t.parent=yR(n,s);const i=function(u){if(u.length!==0)return ER(ht.create(u,"and"))}(e.filters);i&&(t.structuredQuery.where=i);const o=function(u){if(u.length!==0)return u.map(h=>function(m){return{field:Fi(m.field),direction:P6(m.dir)}}(h))}(e.orderBy);o&&(t.structuredQuery.orderBy=o);const a=Nv(n,e.limit);return a!==null&&(t.structuredQuery.limit=a),e.startAt&&(t.structuredQuery.startAt=function(u){return{before:u.inclusive,values:u.position}}(e.startAt)),e.endAt&&(t.structuredQuery.endAt=function(u){return{before:!u.inclusive,values:u.position}}(e.endAt)),{ft:t,parent:s}}function xR(n,e,t,r){const{ft:s,parent:i}=hg(n,e),o={},a=[];let c=0;return t.forEach(u=>{const h=r?u.alias:"aggregate_"+c++;o[h]=u.alias,u.aggregateType==="count"?a.push({alias:h,count:{}}):u.aggregateType==="avg"?a.push({alias:h,avg:{field:Fi(u.fieldPath)}}):u.aggregateType==="sum"&&a.push({alias:h,sum:{field:Fi(u.fieldPath)}})}),{request:{structuredAggregationQuery:{aggregations:a,structuredQuery:s.structuredQuery},parent:s.parent},gt:o,parent:i}}function SR(n){let e=_R(n.parent);const t=n.structuredQuery,r=t.from?t.from.length:0;let s=null;if(r>0){me(r===1,65062);const h=t.from[0];h.allDescendants?s=h.collectionId:e=e.child(h.collectionId)}let i=[];t.where&&(i=function(f){const m=IR(f);return m instanceof ht&&Uw(m)?m.getFilters():[m]}(t.where));let o=[];t.orderBy&&(o=function(f){return f.map(m=>function(w){return new jd(fl(w.field),function(R){switch(R){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(w.direction))}(m))}(t.orderBy));let a=null;t.limit&&(a=function(f){let m;return m=typeof f=="object"?f.value:f,uh(m)?null:m}(t.limit));let c=null;t.startAt&&(c=function(f){const m=!!f.before,y=f.values||[];return new Io(y,m)}(t.startAt));let u=null;return t.endAt&&(u=function(f){const m=!f.before,y=f.values||[];return new Io(y,m)}(t.endAt)),GN(e,s,o,i,a,"F",c,u)}function D6(n,e){const t=function(s){switch(s){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return ue(28987,{purpose:s})}}(e.purpose);return t==null?null:{"goog-listen-tags":t}}function IR(n){return n.unaryFilter!==void 0?function(t){switch(t.unaryFilter.op){case"IS_NAN":const r=fl(t.unaryFilter.field);return Ke.create(r,"==",{doubleValue:NaN});case"IS_NULL":const s=fl(t.unaryFilter.field);return Ke.create(s,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const i=fl(t.unaryFilter.field);return Ke.create(i,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const o=fl(t.unaryFilter.field);return Ke.create(o,"!=",{nullValue:"NULL_VALUE"});case"OPERATOR_UNSPECIFIED":return ue(61313);default:return ue(60726)}}(n):n.fieldFilter!==void 0?function(t){return Ke.create(fl(t.fieldFilter.field),function(s){switch(s){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";case"OPERATOR_UNSPECIFIED":return ue(58110);default:return ue(50506)}}(t.fieldFilter.op),t.fieldFilter.value)}(n):n.compositeFilter!==void 0?function(t){return ht.create(t.compositeFilter.filters.map(r=>IR(r)),function(s){switch(s){case"AND":return"and";case"OR":return"or";default:return ue(1026)}}(t.compositeFilter.op))}(n):ue(30097,{filter:n})}function P6(n){return E6[n]}function O6(n){return b6[n]}function j6(n){return T6[n]}function Fi(n){return{fieldPath:n.canonicalString()}}function fl(n){return qt.fromServerFormat(n.fieldPath)}function ER(n){return n instanceof Ke?function(t){if(t.op==="=="){if(sb(t.value))return{unaryFilter:{field:Fi(t.field),op:"IS_NAN"}};if(rb(t.value))return{unaryFilter:{field:Fi(t.field),op:"IS_NULL"}}}else if(t.op==="!="){if(sb(t.value))return{unaryFilter:{field:Fi(t.field),op:"IS_NOT_NAN"}};if(rb(t.value))return{unaryFilter:{field:Fi(t.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:Fi(t.field),op:O6(t.op),value:t.value}}}(n):n instanceof ht?function(t){const r=t.getFilters().map(s=>ER(s));return r.length===1?r[0]:{compositeFilter:{op:j6(t.op),filters:r}}}(n):ue(54877,{filter:n})}function L6(n){const e=[];return n.fields.forEach(t=>e.push(t.canonicalString())),{fieldPaths:e}}function bR(n){return n.length>=4&&n.get(0)==="projects"&&n.get(2)==="databases"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ti{constructor(e,t,r,s,i=_e.min(),o=_e.min(),a=an.EMPTY_BYTE_STRING,c=null){this.target=e,this.targetId=t,this.purpose=r,this.sequenceNumber=s,this.snapshotVersion=i,this.lastLimboFreeSnapshotVersion=o,this.resumeToken=a,this.expectedCount=c}withSequenceNumber(e){return new ti(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(e,t){return new ti(this.target,this.targetId,this.purpose,this.sequenceNumber,t,this.lastLimboFreeSnapshotVersion,e,null)}withExpectedCount(e){return new ti(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,e)}withLastLimboFreeSnapshotVersion(e){return new ti(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken,this.expectedCount)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class TR{constructor(e){this.yt=e}}function M6(n,e){let t;if(e.document)t=dg(n.yt,e.document,!!e.hasCommittedMutations);else if(e.noDocument){const r=se.fromSegments(e.noDocument.path),s=Ca(e.noDocument.readTime);t=Lt.newNoDocument(r,s),e.hasCommittedMutations&&t.setHasCommittedMutations()}else{if(!e.unknownDocument)return ue(56709);{const r=se.fromSegments(e.unknownDocument.path),s=Ca(e.unknownDocument.version);t=Lt.newUnknownDocument(r,s)}}return e.readTime&&t.setReadTime(function(s){const i=new Fe(s[0],s[1]);return _e.fromTimestamp(i)}(e.readTime)),t}function xb(n,e){const t=e.key,r={prefixPath:t.getCollectionPath().popLast().toArray(),collectionGroup:t.collectionGroup,documentId:t.path.lastSegment(),readTime:Jm(e.readTime),hasCommittedMutations:e.hasCommittedMutations};if(e.isFoundDocument())r.document=function(i,o){return{name:Ld(i,o.key),fields:o.data.value.mapValue.fields,updateTime:fc(i,o.version.toTimestamp()),createTime:fc(i,o.createTime.toTimestamp())}}(n.yt,e);else if(e.isNoDocument())r.noDocument={path:t.path.toArray(),readTime:Aa(e.version)};else{if(!e.isUnknownDocument())return ue(57904,{document:e});r.unknownDocument={path:t.path.toArray(),version:Aa(e.version)}}return r}function Jm(n){const e=n.toTimestamp();return[e.seconds,e.nanoseconds]}function Aa(n){const e=n.toTimestamp();return{seconds:e.seconds,nanoseconds:e.nanoseconds}}function Ca(n){const e=new Fe(n.seconds,n.nanoseconds);return _e.fromTimestamp(e)}function Qo(n,e){const t=(e.baseMutations||[]).map(i=>Pv(n.yt,i));for(let i=0;i<e.mutations.length-1;++i){const o=e.mutations[i];if(i+1<e.mutations.length&&e.mutations[i+1].transform!==void 0){const a=e.mutations[i+1];o.updateTransforms=a.transform.fieldTransforms,e.mutations.splice(i+1,1),++i}}const r=e.mutations.map(i=>Pv(n.yt,i)),s=Fe.fromMillis(e.localWriteTimeMs);return new Gw(e.batchId,s,t,r)}function Iu(n){const e=Ca(n.readTime),t=n.lastLimboFreeSnapshotVersion!==void 0?Ca(n.lastLimboFreeSnapshotVersion):_e.min();let r;return r=function(i){return i.documents!==void 0}(n.query)?function(i){const o=i.documents.length;return me(o===1,1966,{count:o}),nr(Nc(_R(i.documents[0])))}(n.query):function(i){return nr(SR(i))}(n.query),new ti(r,n.targetId,"TargetPurposeListen",n.lastListenSequenceNumber,e,t,an.fromBase64String(n.resumeToken))}function AR(n,e){const t=Aa(e.snapshotVersion),r=Aa(e.lastLimboFreeSnapshotVersion);let s;s=Qm(e.target)?wR(n.yt,e.target):hg(n.yt,e.target).ft;const i=e.resumeToken.toBase64();return{targetId:e.targetId,canonicalId:Ea(e.target),readTime:t,resumeToken:i,lastListenSequenceNumber:e.sequenceNumber,lastLimboFreeSnapshotVersion:r,query:s}}function fg(n){const e=SR({parent:n.parent,structuredQuery:n.structuredQuery});return n.limitType==="LAST"?Ym(e,e.limit,"L"):e}function Py(n,e){return new Qw(e.largestBatchId,Pv(n.yt,e.overlayMutation))}function Sb(n,e){const t=e.path.lastSegment();return[n,tr(e.path.popLast()),t]}function Ib(n,e,t,r){return{indexId:n,uid:e,sequenceNumber:t,readTime:Aa(r.readTime),documentKey:tr(r.documentKey.path),largestBatchId:r.largestBatchId}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class V6{getBundleMetadata(e,t){return Eb(e).get(t).next(r=>{if(r)return function(i){return{id:i.bundleId,createTime:Ca(i.createTime),version:i.version}}(r)})}saveBundleMetadata(e,t){return Eb(e).put(function(s){return{bundleId:s.id,createTime:Aa(hn(s.createTime)),version:s.version}}(t))}getNamedQuery(e,t){return bb(e).get(t).next(r=>{if(r)return function(i){return{name:i.name,query:fg(i.bundledQuery),readTime:Ca(i.readTime)}}(r)})}saveNamedQuery(e,t){return bb(e).put(function(s){return{name:s.name,readTime:Aa(hn(s.readTime)),bundledQuery:s.bundledQuery}}(t))}}function Eb(n){return bn(n,rg)}function bb(n){return bn(n,sg)}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class mg{constructor(e,t){this.serializer=e,this.userId=t}static wt(e,t){const r=t.uid||"";return new mg(e,r)}getOverlay(e,t){return ou(e).get(Sb(this.userId,t)).next(r=>r?Py(this.serializer,r):null)}getOverlays(e,t){const r=Ns();return j.forEach(t,s=>this.getOverlay(e,s).next(i=>{i!==null&&r.set(s,i)})).next(()=>r)}saveOverlays(e,t,r){const s=[];return r.forEach((i,o)=>{const a=new Qw(t,o);s.push(this.St(e,a))}),j.waitFor(s)}removeOverlaysForBatchId(e,t,r){const s=new Set;t.forEach(o=>s.add(tr(o.getCollectionPath())));const i=[];return s.forEach(o=>{const a=IDBKeyRange.bound([this.userId,o,r],[this.userId,o,r+1],!1,!0);i.push(ou(e).Z(Sv,a))}),j.waitFor(i)}getOverlaysForCollection(e,t,r){const s=Ns(),i=tr(t),o=IDBKeyRange.bound([this.userId,i,r],[this.userId,i,Number.POSITIVE_INFINITY],!0);return ou(e).J(Sv,o).next(a=>{for(const c of a){const u=Py(this.serializer,c);s.set(u.getKey(),u)}return s})}getOverlaysForCollectionGroup(e,t,r,s){const i=Ns();let o;const a=IDBKeyRange.bound([this.userId,t,r],[this.userId,t,Number.POSITIVE_INFINITY],!0);return ou(e).ee({index:IN,range:a},(c,u,h)=>{const f=Py(this.serializer,u);i.size()<s||f.largestBatchId===o?(i.set(f.getKey(),f),o=f.largestBatchId):h.done()}).next(()=>i)}St(e,t){return ou(e).put(function(s,i,o){const[a,c,u]=Sb(i,o.mutation.key);return{userId:i,collectionPath:c,documentId:u,collectionGroup:o.mutation.key.getCollectionGroup(),largestBatchId:o.largestBatchId,overlayMutation:Md(s.yt,o.mutation)}}(this.serializer,this.userId,t))}}function ou(n){return bn(n,ig)}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class F6{bt(e){return bn(e,Mw)}getSessionToken(e){return this.bt(e).get("sessionToken").next(t=>{const r=t==null?void 0:t.value;return r?an.fromUint8Array(r):an.EMPTY_BYTE_STRING})}setSessionToken(e,t){return this.bt(e).put({name:"sessionToken",value:t.toUint8Array()})}}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ko{constructor(){}Dt(e,t){this.Ct(e,t),t.vt()}Ct(e,t){if("nullValue"in e)this.Ft(t,5);else if("booleanValue"in e)this.Ft(t,10),t.Mt(e.booleanValue?1:0);else if("integerValue"in e)this.Ft(t,15),t.Mt($t(e.integerValue));else if("doubleValue"in e){const r=$t(e.doubleValue);isNaN(r)?this.Ft(t,13):(this.Ft(t,15),Ad(r)?t.Mt(0):t.Mt(r))}else if("timestampValue"in e){let r=e.timestampValue;this.Ft(t,20),typeof r=="string"&&(r=mi(r)),t.xt(`${r.seconds||""}`),t.Mt(r.nanos||0)}else if("stringValue"in e)this.Ot(e.stringValue,t),this.Nt(t);else if("bytesValue"in e)this.Ft(t,30),t.Bt(pi(e.bytesValue)),this.Nt(t);else if("referenceValue"in e)this.Lt(e.referenceValue,t);else if("geoPointValue"in e){const r=e.geoPointValue;this.Ft(t,45),t.Mt(r.latitude||0),t.Mt(r.longitude||0)}else"mapValue"in e?LN(e)?this.Ft(t,Number.MAX_SAFE_INTEGER):lg(e)?this.kt(e.mapValue,t):(this.qt(e.mapValue,t),this.Nt(t)):"arrayValue"in e?(this.Qt(e.arrayValue,t),this.Nt(t)):ue(19022,{$t:e})}Ot(e,t){this.Ft(t,25),this.Ut(e,t)}Ut(e,t){t.xt(e)}qt(e,t){const r=e.fields||{};this.Ft(t,55);for(const s of Object.keys(r))this.Ot(s,t),this.Ct(r[s],t)}kt(e,t){var o,a;const r=e.fields||{};this.Ft(t,53);const s=lc,i=((a=(o=r[s].arrayValue)==null?void 0:o.values)==null?void 0:a.length)||0;this.Ft(t,15),t.Mt($t(i)),this.Ot(s,t),this.Ct(r[s],t)}Qt(e,t){const r=e.values||[];this.Ft(t,50);for(const s of r)this.Ct(s,t)}Lt(e,t){this.Ft(t,37),se.fromName(e).path.forEach(r=>{this.Ft(t,60),this.Ut(r,t)})}Ft(e,t){e.Mt(t)}Nt(e){e.Mt(2)}}Ko.Kt=new Ko;/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law | agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES | CONDITIONS OF ANY KIND, either express | implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ol=255;function $6(n){if(n===0)return 8;let e=0;return n>>4||(e+=4,n<<=4),n>>6||(e+=2,n<<=2),n>>7||(e+=1),e}function Tb(n){const e=64-function(r){let s=0;for(let i=0;i<8;++i){const o=$6(255&r[i]);if(s+=o,o!==8)break}return s}(n);return Math.ceil(e/8)}class U6{constructor(){this.buffer=new Uint8Array(1024),this.position=0}Wt(e){const t=e[Symbol.iterator]();let r=t.next();for(;!r.done;)this.Gt(r.value),r=t.next();this.zt()}jt(e){const t=e[Symbol.iterator]();let r=t.next();for(;!r.done;)this.Jt(r.value),r=t.next();this.Ht()}Yt(e){for(const t of e){const r=t.charCodeAt(0);if(r<128)this.Gt(r);else if(r<2048)this.Gt(960|r>>>6),this.Gt(128|63&r);else if(t<"\uD800"||"\uDBFF"<t)this.Gt(480|r>>>12),this.Gt(128|63&r>>>6),this.Gt(128|63&r);else{const s=t.codePointAt(0);this.Gt(240|s>>>18),this.Gt(128|63&s>>>12),this.Gt(128|63&s>>>6),this.Gt(128|63&s)}}this.zt()}Zt(e){for(const t of e){const r=t.charCodeAt(0);if(r<128)this.Jt(r);else if(r<2048)this.Jt(960|r>>>6),this.Jt(128|63&r);else if(t<"\uD800"||"\uDBFF"<t)this.Jt(480|r>>>12),this.Jt(128|63&r>>>6),this.Jt(128|63&r);else{const s=t.codePointAt(0);this.Jt(240|s>>>18),this.Jt(128|63&s>>>12),this.Jt(128|63&s>>>6),this.Jt(128|63&s)}}this.Ht()}Xt(e){const t=this.en(e),r=Tb(t);this.tn(1+r),this.buffer[this.position++]=255&r;for(let s=t.length-r;s<t.length;++s)this.buffer[this.position++]=255&t[s]}nn(e){const t=this.en(e),r=Tb(t);this.tn(1+r),this.buffer[this.position++]=~(255&r);for(let s=t.length-r;s<t.length;++s)this.buffer[this.position++]=~(255&t[s])}rn(){this.sn(ol),this.sn(255)}_n(){this.an(ol),this.an(255)}reset(){this.position=0}seed(e){this.tn(e.length),this.buffer.set(e,this.position),this.position+=e.length}un(){return this.buffer.slice(0,this.position)}en(e){const t=function(i){const o=new DataView(new ArrayBuffer(8));return o.setFloat64(0,i,!1),new Uint8Array(o.buffer)}(e),r=!!(128&t[0]);t[0]^=r?255:128;for(let s=1;s<t.length;++s)t[s]^=r?255:0;return t}Gt(e){const t=255&e;t===0?(this.sn(0),this.sn(255)):t===ol?(this.sn(ol),this.sn(0)):this.sn(t)}Jt(e){const t=255&e;t===0?(this.an(0),this.an(255)):t===ol?(this.an(ol),this.an(0)):this.an(e)}zt(){this.sn(0),this.sn(1)}Ht(){this.an(0),this.an(1)}sn(e){this.tn(1),this.buffer[this.position++]=e}an(e){this.tn(1),this.buffer[this.position++]=~e}tn(e){const t=e+this.position;if(t<=this.buffer.length)return;let r=2*this.buffer.length;r<t&&(r=t);const s=new Uint8Array(r);s.set(this.buffer),this.buffer=s}}class B6{constructor(e){this.cn=e}Bt(e){this.cn.Wt(e)}xt(e){this.cn.Yt(e)}Mt(e){this.cn.Xt(e)}vt(){this.cn.rn()}}class z6{constructor(e){this.cn=e}Bt(e){this.cn.jt(e)}xt(e){this.cn.Zt(e)}Mt(e){this.cn.nn(e)}vt(){this.cn._n()}}class au{constructor(){this.cn=new U6,this.ln=new B6(this.cn),this.hn=new z6(this.cn)}seed(e){this.cn.seed(e)}Pn(e){return e===0?this.ln:this.hn}un(){return this.cn.un()}reset(){this.cn.reset()}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Yo{constructor(e,t,r,s){this.Tn=e,this.In=t,this.En=r,this.dn=s}An(){const e=this.dn.length,t=e===0||this.dn[e-1]===255?e+1:e,r=new Uint8Array(t);return r.set(this.dn,0),t!==e?r.set([0],this.dn.length):++r[r.length-1],new Yo(this.Tn,this.In,this.En,r)}Rn(e,t,r){return{indexId:this.Tn,uid:e,arrayValue:Kf(this.En),directionalValue:Kf(this.dn),orderedDocumentKey:Kf(t),documentKey:r.path.toArray()}}Vn(e,t,r){const s=this.Rn(e,t,r);return[s.indexId,s.uid,s.arrayValue,s.directionalValue,s.orderedDocumentKey,s.documentKey]}}function Ri(n,e){let t=n.Tn-e.Tn;return t!==0?t:(t=Ab(n.En,e.En),t!==0?t:(t=Ab(n.dn,e.dn),t!==0?t:se.comparator(n.In,e.In)))}function Ab(n,e){for(let t=0;t<n.length&&t<e.length;++t){const r=n[t]-e[t];if(r!==0)return r}return n.length-e.length}function Kf(n){return TC()?function(t){let r="";for(let s=0;s<t.length;s++)r+=String.fromCharCode(t[s]);return r}(n):n}function Cb(n){return typeof n!="string"?n:function(t){const r=new Uint8Array(t.length);for(let s=0;s<t.length;s++)r[s]=t.charCodeAt(s);return r}(n)}class kb{constructor(e){this.mn=new mt((t,r)=>qt.comparator(t.field,r.field)),this.collectionId=e.collectionGroup!=null?e.collectionGroup:e.path.lastSegment(),this.fn=e.orderBy,this.gn=[];for(const t of e.filters){const r=t;r.isInequality()?this.mn=this.mn.add(r):this.gn.push(r)}}get pn(){return this.mn.size>1}yn(e){if(me(e.collectionGroup===this.collectionId,49279),this.pn)return!1;const t=vv(e);if(t!==void 0&&!this.wn(t))return!1;const r=Wo(e);let s=new Set,i=0,o=0;for(;i<r.length&&this.wn(r[i]);++i)s=s.add(r[i].fieldPath.canonicalString());if(i===r.length)return!0;if(this.mn.size>0){const a=this.mn.getIterator().getNext();if(!s.has(a.field.canonicalString())){const c=r[i];if(!this.Sn(a,c)||!this.bn(this.fn[o++],c))return!1}++i}for(;i<r.length;++i){const a=r[i];if(o>=this.fn.length||!this.bn(this.fn[o++],a))return!1}return!0}Dn(){if(this.pn)return null;let e=new mt(qt.comparator);const t=[];for(const r of this.gn)if(!r.field.isKeyField())if(r.op==="array-contains"||r.op==="array-contains-any")t.push(new la(r.field,2));else{if(e.has(r.field))continue;e=e.add(r.field),t.push(new la(r.field,0))}for(const r of this.fn)r.field.isKeyField()||e.has(r.field)||(e=e.add(r.field),t.push(new la(r.field,r.dir==="asc"?0:1)));return new nc(nc.UNKNOWN_ID,this.collectionId,t,rc.empty())}wn(e){for(const t of this.gn)if(this.Sn(t,e))return!0;return!1}Sn(e,t){if(e===void 0||!e.field.isEqual(t.fieldPath))return!1;const r=e.op==="array-contains"||e.op==="array-contains-any";return t.kind===2===r}bn(e,t){return!!e.field.isEqual(t.fieldPath)&&(t.kind===0&&e.dir==="asc"||t.kind===1&&e.dir==="desc")}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function CR(n){var t,r;if(me(n instanceof Ke||n instanceof ht,20012),n instanceof Ke){if(n instanceof WN){const s=((r=(t=n.value.arrayValue)==null?void 0:t.values)==null?void 0:r.map(i=>Ke.create(n.field,"==",i)))||[];return ht.create(s,"or")}return n}const e=n.filters.map(s=>CR(s));return ht.create(e,n.op)}function q6(n){if(n.getFilters().length===0)return[];const e=Lv(CR(n));return me(kR(e),7391),Ov(e)||jv(e)?[e]:e.getFilters()}function Ov(n){return n instanceof Ke}function jv(n){return n instanceof ht&&Uw(n)}function kR(n){return Ov(n)||jv(n)||function(t){if(t instanceof ht&&Tv(t)){for(const r of t.getFilters())if(!Ov(r)&&!jv(r))return!1;return!0}return!1}(n)}function Lv(n){if(me(n instanceof Ke||n instanceof ht,34018),n instanceof Ke)return n;if(n.filters.length===1)return Lv(n.filters[0]);const e=n.filters.map(r=>Lv(r));let t=ht.create(e,n.op);return t=Xm(t),kR(t)?t:(me(t instanceof ht,64498),me(uc(t),40251),me(t.filters.length>1,57927),t.filters.reduce((r,s)=>Jw(r,s)))}function Jw(n,e){let t;return me(n instanceof Ke||n instanceof ht,38388),me(e instanceof Ke||e instanceof ht,25473),t=n instanceof Ke?e instanceof Ke?function(s,i){return ht.create([s,i],"and")}(n,e):Nb(n,e):e instanceof Ke?Nb(e,n):function(s,i){if(me(s.filters.length>0&&i.filters.length>0,48005),uc(s)&&uc(i))return BN(s,i.getFilters());const o=Tv(s)?s:i,a=Tv(s)?i:s,c=o.filters.map(u=>Jw(u,a));return ht.create(c,"or")}(n,e),Xm(t)}function Nb(n,e){if(uc(e))return BN(e,n.getFilters());{const t=e.filters.map(r=>Jw(n,r));return ht.create(t,"or")}}function Xm(n){if(me(n instanceof Ke||n instanceof ht,11850),n instanceof Ke)return n;const e=n.getFilters();if(e.length===1)return Xm(e[0]);if($N(n))return n;const t=e.map(s=>Xm(s)),r=[];return t.forEach(s=>{s instanceof Ke?r.push(s):s instanceof ht&&(s.op===n.op?r.push(...s.filters):r.push(s))}),r.length===1?r[0]:ht.create(r,n.op)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class W6{constructor(){this.Cn=new Xw}addToCollectionParentIndex(e,t){return this.Cn.add(t),j.resolve()}getCollectionParents(e,t){return j.resolve(this.Cn.getEntries(t))}addFieldIndex(e,t){return j.resolve()}deleteFieldIndex(e,t){return j.resolve()}deleteAllFieldIndexes(e){return j.resolve()}createTargetIndexes(e,t){return j.resolve()}getDocumentsMatchingTarget(e,t){return j.resolve(null)}getIndexType(e,t){return j.resolve(0)}getFieldIndexes(e,t){return j.resolve([])}getNextCollectionGroupToUpdate(e){return j.resolve(null)}getMinOffset(e,t){return j.resolve(Mr.min())}getMinOffsetFromCollectionGroup(e,t){return j.resolve(Mr.min())}updateCollectionGroup(e,t,r){return j.resolve()}updateIndexEntries(e,t){return j.resolve()}}class Xw{constructor(){this.index={}}add(e){const t=e.lastSegment(),r=e.popLast(),s=this.index[t]||new mt(ze.comparator),i=!s.has(r);return this.index[t]=s.add(r),i}has(e){const t=e.lastSegment(),r=e.popLast(),s=this.index[t];return s&&s.has(r)}getEntries(e){return(this.index[e]||new mt(ze.comparator)).toArray()}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Rb="IndexedDbIndexManager",mf=new Uint8Array(0);class G6{constructor(e,t){this.databaseId=t,this.vn=new Xw,this.Fn=new Si(r=>Ea(r),(r,s)=>hh(r,s)),this.uid=e.uid||""}addToCollectionParentIndex(e,t){if(!this.vn.has(t)){const r=t.lastSegment(),s=t.popLast();e.addOnCommittedListener(()=>{this.vn.add(t)});const i={collectionId:r,parent:tr(s)};return Db(e).put(i)}return j.resolve()}getCollectionParents(e,t){const r=[],s=IDBKeyRange.bound([t,""],[cN(t),""],!1,!0);return Db(e).J(s).next(i=>{for(const o of i){if(o.collectionId!==t)break;r.push(ks(o.parent))}return r})}addFieldIndex(e,t){const r=lu(e),s=function(a){return{indexId:a.indexId,collectionGroup:a.collectionGroup,fields:a.fields.map(c=>[c.fieldPath.canonicalString(),c.kind])}}(t);delete s.indexId;const i=r.add(s);if(t.indexState){const o=ll(e);return i.next(a=>{o.put(Ib(a,this.uid,t.indexState.sequenceNumber,t.indexState.offset))})}return i.next()}deleteFieldIndex(e,t){const r=lu(e),s=ll(e),i=al(e);return r.delete(t.indexId).next(()=>s.delete(IDBKeyRange.bound([t.indexId],[t.indexId+1],!1,!0))).next(()=>i.delete(IDBKeyRange.bound([t.indexId],[t.indexId+1],!1,!0)))}deleteAllFieldIndexes(e){const t=lu(e),r=al(e),s=ll(e);return t.Z().next(()=>r.Z()).next(()=>s.Z())}createTargetIndexes(e,t){return j.forEach(this.Mn(t),r=>this.getIndexType(e,r).next(s=>{if(s===0||s===1){const i=new kb(r).Dn();if(i!=null)return this.addFieldIndex(e,i)}}))}getDocumentsMatchingTarget(e,t){const r=al(e);let s=!0;const i=new Map;return j.forEach(this.Mn(t),o=>this.xn(e,o).next(a=>{s&&(s=!!a),i.set(o,a)})).next(()=>{if(s){let o=Le();const a=[];return j.forEach(i,(c,u)=>{G(Rb,`Using index ${function(N){return`id=${N.indexId}|cg=${N.collectionGroup}|f=${N.fields.map(P=>`${P.fieldPath}:${P.kind}`).join(",")}`}(c)} to execute ${Ea(t)}`);const h=function(N,P){const B=vv(P);if(B===void 0)return null;for(const F of Km(N,B.fieldPath))switch(F.op){case"array-contains-any":return F.value.arrayValue.values||[];case"array-contains":return[F.value]}return null}(u,c),f=function(N,P){const B=new Map;for(const F of Wo(P))for(const A of Km(N,F.fieldPath))switch(A.op){case"==":case"in":B.set(F.fieldPath.canonicalString(),A.value);break;case"not-in":case"!=":return B.set(F.fieldPath.canonicalString(),A.value),Array.from(B.values())}return null}(u,c),m=function(N,P){const B=[];let F=!0;for(const A of Wo(P)){const x=A.kind===0?cb(N,A.fieldPath,N.startAt):ub(N,A.fieldPath,N.startAt);B.push(x.value),F&&(F=x.inclusive)}return new Io(B,F)}(u,c),y=function(N,P){const B=[];let F=!0;for(const A of Wo(P)){const x=A.kind===0?ub(N,A.fieldPath,N.endAt):cb(N,A.fieldPath,N.endAt);B.push(x.value),F&&(F=x.inclusive)}return new Io(B,F)}(u,c),w=this.On(c,u,m),S=this.On(c,u,y),R=this.Nn(c,u,f),T=this.Bn(c.indexId,h,w,m.inclusive,S,y.inclusive,R);return j.forEach(T,I=>r.Y(I,t.limit).next(N=>{N.forEach(P=>{const B=se.fromSegments(P.documentKey);o.has(B)||(o=o.add(B),a.push(B))})}))}).next(()=>a)}return j.resolve(null)})}Mn(e){let t=this.Fn.get(e);return t||(e.filters.length===0?t=[e]:t=q6(ht.create(e.filters,"and")).map(r=>Cv(e.path,e.collectionGroup,e.orderBy,r.getFilters(),e.limit,e.startAt,e.endAt)),this.Fn.set(e,t),t)}Bn(e,t,r,s,i,o,a){const c=(t!=null?t.length:1)*Math.max(r.length,i.length),u=c/(t!=null?t.length:1),h=[];for(let f=0;f<c;++f){const m=t?this.Ln(t[f/u]):mf,y=this.kn(e,m,r[f%u],s),w=this.qn(e,m,i[f%u],o),S=a.map(R=>this.kn(e,m,R,!0));h.push(...this.createRange(y,w,S))}return h}kn(e,t,r,s){const i=new Yo(e,se.empty(),t,r);return s?i:i.An()}qn(e,t,r,s){const i=new Yo(e,se.empty(),t,r);return s?i.An():i}xn(e,t){const r=new kb(t),s=t.collectionGroup!=null?t.collectionGroup:t.path.lastSegment();return this.getFieldIndexes(e,s).next(i=>{let o=null;for(const a of i)r.yn(a)&&(!o||a.fields.length>o.fields.length)&&(o=a);return o})}getIndexType(e,t){let r=2;const s=this.Mn(t);return j.forEach(s,i=>this.xn(e,i).next(o=>{o?r!==0&&o.fields.length<function(c){let u=new mt(qt.comparator),h=!1;for(const f of c.filters)for(const m of f.getFlattenedFilters())m.field.isKeyField()||(m.op==="array-contains"||m.op==="array-contains-any"?h=!0:u=u.add(m.field));for(const f of c.orderBy)f.field.isKeyField()||(u=u.add(f.field));return u.size+(h?1:0)}(i)&&(r=1):r=0})).next(()=>function(o){return o.limit!==null}(t)&&s.length>1&&r===2?1:r)}Qn(e,t){const r=new au;for(const s of Wo(e)){const i=t.data.field(s.fieldPath);if(i==null)return null;const o=r.Pn(s.kind);Ko.Kt.Dt(i,o)}return r.un()}Ln(e){const t=new au;return Ko.Kt.Dt(e,t.Pn(0)),t.un()}$n(e,t){const r=new au;return Ko.Kt.Dt(Ia(this.databaseId,t),r.Pn(function(i){const o=Wo(i);return o.length===0?0:o[o.length-1].kind}(e))),r.un()}Nn(e,t,r){if(r===null)return[];let s=[];s.push(new au);let i=0;for(const o of Wo(e)){const a=r[i++];for(const c of s)if(this.Un(t,o.fieldPath)&&Od(a))s=this.Kn(s,o,a);else{const u=c.Pn(o.kind);Ko.Kt.Dt(a,u)}}return this.Wn(s)}On(e,t,r){return this.Nn(e,t,r.position)}Wn(e){const t=[];for(let r=0;r<e.length;++r)t[r]=e[r].un();return t}Kn(e,t,r){const s=[...e],i=[];for(const o of r.arrayValue.values||[])for(const a of s){const c=new au;c.seed(a.un()),Ko.Kt.Dt(o,c.Pn(t.kind)),i.push(c)}return i}Un(e,t){return!!e.filters.find(r=>r instanceof Ke&&r.field.isEqual(t)&&(r.op==="in"||r.op==="not-in"))}getFieldIndexes(e,t){const r=lu(e),s=ll(e);return(t?r.J(xv,IDBKeyRange.bound(t,t)):r.J()).next(i=>{const o=[];return j.forEach(i,a=>s.get([a.indexId,this.uid]).next(c=>{o.push(function(h,f){const m=f?new rc(f.sequenceNumber,new Mr(Ca(f.readTime),new se(ks(f.documentKey)),f.largestBatchId)):rc.empty(),y=h.fields.map(([w,S])=>new la(qt.fromServerFormat(w),S));return new nc(h.indexId,h.collectionGroup,y,m)}(a,c))})).next(()=>o)})}getNextCollectionGroupToUpdate(e){return this.getFieldIndexes(e).next(t=>t.length===0?null:(t.sort((r,s)=>{const i=r.indexState.sequenceNumber-s.indexState.sequenceNumber;return i!==0?i:Ne(r.collectionGroup,s.collectionGroup)}),t[0].collectionGroup))}updateCollectionGroup(e,t,r){const s=lu(e),i=ll(e);return this.Gn(e).next(o=>s.J(xv,IDBKeyRange.bound(t,t)).next(a=>j.forEach(a,c=>i.put(Ib(c.indexId,this.uid,o,r)))))}updateIndexEntries(e,t){const r=new Map;return j.forEach(t,(s,i)=>{const o=r.get(s.collectionGroup);return(o?j.resolve(o):this.getFieldIndexes(e,s.collectionGroup)).next(a=>(r.set(s.collectionGroup,a),j.forEach(a,c=>this.zn(e,s,c).next(u=>{const h=this.jn(i,c);return u.isEqual(h)?j.resolve():this.Jn(e,i,c,u,h)}))))})}Hn(e,t,r,s){return al(e).put(s.Rn(this.uid,this.$n(r,t.key),t.key))}Yn(e,t,r,s){return al(e).delete(s.Vn(this.uid,this.$n(r,t.key),t.key))}zn(e,t,r){const s=al(e);let i=new mt(Ri);return s.ee({index:SN,range:IDBKeyRange.only([r.indexId,this.uid,Kf(this.$n(r,t))])},(o,a)=>{i=i.add(new Yo(r.indexId,t,Cb(a.arrayValue),Cb(a.directionalValue)))}).next(()=>i)}jn(e,t){let r=new mt(Ri);const s=this.Qn(t,e);if(s==null)return r;const i=vv(t);if(i!=null){const o=e.data.field(i.fieldPath);if(Od(o))for(const a of o.arrayValue.values||[])r=r.add(new Yo(t.indexId,e.key,this.Ln(a),s))}else r=r.add(new Yo(t.indexId,e.key,mf,s));return r}Jn(e,t,r,s,i){G(Rb,"Updating index entries for document '%s'",t.key);const o=[];return function(c,u,h,f,m){const y=c.getIterator(),w=u.getIterator();let S=il(y),R=il(w);for(;S||R;){let T=!1,I=!1;if(S&&R){const N=h(S,R);N<0?I=!0:N>0&&(T=!0)}else S!=null?I=!0:T=!0;T?(f(R),R=il(w)):I?(m(S),S=il(y)):(S=il(y),R=il(w))}}(s,i,Ri,a=>{o.push(this.Hn(e,t,r,a))},a=>{o.push(this.Yn(e,t,r,a))}),j.waitFor(o)}Gn(e){let t=1;return ll(e).ee({index:xN,reverse:!0,range:IDBKeyRange.upperBound([this.uid,Number.MAX_SAFE_INTEGER])},(r,s,i)=>{i.done(),t=s.sequenceNumber+1}).next(()=>t)}createRange(e,t,r){r=r.sort((o,a)=>Ri(o,a)).filter((o,a,c)=>!a||Ri(o,c[a-1])!==0);const s=[];s.push(e);for(const o of r){const a=Ri(o,e),c=Ri(o,t);if(a===0)s[0]=e.An();else if(a>0&&c<0)s.push(o),s.push(o.An());else if(c>0)break}s.push(t);const i=[];for(let o=0;o<s.length;o+=2){if(this.Zn(s[o],s[o+1]))return[];const a=s[o].Vn(this.uid,mf,se.empty()),c=s[o+1].Vn(this.uid,mf,se.empty());i.push(IDBKeyRange.bound(a,c))}return i}Zn(e,t){return Ri(e,t)>0}getMinOffsetFromCollectionGroup(e,t){return this.getFieldIndexes(e,t).next(Pb)}getMinOffset(e,t){return j.mapArray(this.Mn(t),r=>this.xn(e,r).next(s=>s||ue(44426))).next(Pb)}}function Db(n){return bn(n,Nd)}function al(n){return bn(n,Bu)}function lu(n){return bn(n,Lw)}function ll(n){return bn(n,Uu)}function Pb(n){me(n.length!==0,28825);let e=n[0].indexState.offset,t=e.largestBatchId;for(let r=1;r<n.length;r++){const s=n[r].indexState.offset;Pw(s,e)<0&&(e=s),t<s.largestBatchId&&(t=s.largestBatchId)}return new Mr(e.readTime,e.documentKey,t)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ob={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0},NR=41943040;class Xn{static withCacheSize(e){return new Xn(e,Xn.DEFAULT_COLLECTION_PERCENTILE,Xn.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}constructor(e,t,r){this.cacheSizeCollectionThreshold=e,this.percentileToCollect=t,this.maximumSequenceNumbersToCollect=r}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function RR(n,e,t){const r=n.store(as),s=n.store(sc),i=[],o=IDBKeyRange.only(t.batchId);let a=0;const c=r.ee({range:o},(h,f,m)=>(a++,m.delete()));i.push(c.next(()=>{me(a===1,47070,{batchId:t.batchId})}));const u=[];for(const h of t.mutations){const f=_N(e,h.key.path,t.batchId);i.push(s.delete(f)),u.push(h.key)}return j.waitFor(i).next(()=>u)}function Zm(n){if(!n)return 0;let e;if(n.document)e=n.document;else if(n.unknownDocument)e=n.unknownDocument;else{if(!n.noDocument)throw ue(14731);e=n.noDocument}return JSON.stringify(e).length}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */Xn.DEFAULT_COLLECTION_PERCENTILE=10,Xn.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,Xn.DEFAULT=new Xn(NR,Xn.DEFAULT_COLLECTION_PERCENTILE,Xn.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),Xn.DISABLED=new Xn(-1,0,0);class pg{constructor(e,t,r,s){this.userId=e,this.serializer=t,this.indexManager=r,this.referenceDelegate=s,this.Xn={}}static wt(e,t,r,s){me(e.uid!=="",64387);const i=e.isAuthenticated()?e.uid:"";return new pg(i,t,r,s)}checkEmpty(e){let t=!0;const r=IDBKeyRange.bound([this.userId,Number.NEGATIVE_INFINITY],[this.userId,Number.POSITIVE_INFINITY]);return Di(e).ee({index:na,range:r},(s,i,o)=>{t=!1,o.done()}).next(()=>t)}addMutationBatch(e,t,r,s){const i=ml(e),o=Di(e);return o.add({}).next(a=>{me(typeof a=="number",49019);const c=new Gw(a,t,r,s),u=function(y,w,S){const R=S.baseMutations.map(I=>Md(y.yt,I)),T=S.mutations.map(I=>Md(y.yt,I));return{userId:w,batchId:S.batchId,localWriteTimeMs:S.localWriteTime.toMillis(),baseMutations:R,mutations:T}}(this.serializer,this.userId,c),h=[];let f=new mt((m,y)=>Ne(m.canonicalString(),y.canonicalString()));for(const m of s){const y=_N(this.userId,m.key.path,a);f=f.add(m.key.path.popLast()),h.push(o.put(u)),h.push(i.put(y,C3))}return f.forEach(m=>{h.push(this.indexManager.addToCollectionParentIndex(e,m))}),e.addOnCommittedListener(()=>{this.Xn[a]=c.keys()}),j.waitFor(h).next(()=>c)})}lookupMutationBatch(e,t){return Di(e).get(t).next(r=>r?(me(r.userId===this.userId,48,"Unexpected user for mutation batch",{userId:r.userId,batchId:t}),Qo(this.serializer,r)):null)}er(e,t){return this.Xn[t]?j.resolve(this.Xn[t]):this.lookupMutationBatch(e,t).next(r=>{if(r){const s=r.keys();return this.Xn[t]=s,s}return null})}getNextMutationBatchAfterBatchId(e,t){const r=t+1,s=IDBKeyRange.lowerBound([this.userId,r]);let i=null;return Di(e).ee({index:na,range:s},(o,a,c)=>{a.userId===this.userId&&(me(a.batchId>=r,47524,{tr:r}),i=Qo(this.serializer,a)),c.done()}).next(()=>i)}getHighestUnacknowledgedBatchId(e){const t=IDBKeyRange.upperBound([this.userId,Number.POSITIVE_INFINITY]);let r=uo;return Di(e).ee({index:na,range:t,reverse:!0},(s,i,o)=>{r=i.batchId,o.done()}).next(()=>r)}getAllMutationBatches(e){const t=IDBKeyRange.bound([this.userId,uo],[this.userId,Number.POSITIVE_INFINITY]);return Di(e).J(na,t).next(r=>r.map(s=>Qo(this.serializer,s)))}getAllMutationBatchesAffectingDocumentKey(e,t){const r=Bf(this.userId,t.path),s=IDBKeyRange.lowerBound(r),i=[];return ml(e).ee({range:s},(o,a,c)=>{const[u,h,f]=o,m=ks(h);if(u===this.userId&&t.path.isEqual(m))return Di(e).get(f).next(y=>{if(!y)throw ue(61480,{nr:o,batchId:f});me(y.userId===this.userId,10503,"Unexpected user for mutation batch",{userId:y.userId,batchId:f}),i.push(Qo(this.serializer,y))});c.done()}).next(()=>i)}getAllMutationBatchesAffectingDocumentKeys(e,t){let r=new mt(Ne);const s=[];return t.forEach(i=>{const o=Bf(this.userId,i.path),a=IDBKeyRange.lowerBound(o),c=ml(e).ee({range:a},(u,h,f)=>{const[m,y,w]=u,S=ks(y);m===this.userId&&i.path.isEqual(S)?r=r.add(w):f.done()});s.push(c)}),j.waitFor(s).next(()=>this.rr(e,r))}getAllMutationBatchesAffectingQuery(e,t){const r=t.path,s=r.length+1,i=Bf(this.userId,r),o=IDBKeyRange.lowerBound(i);let a=new mt(Ne);return ml(e).ee({range:o},(c,u,h)=>{const[f,m,y]=c,w=ks(m);f===this.userId&&r.isPrefixOf(w)?w.length===s&&(a=a.add(y)):h.done()}).next(()=>this.rr(e,a))}rr(e,t){const r=[],s=[];return t.forEach(i=>{s.push(Di(e).get(i).next(o=>{if(o===null)throw ue(35274,{batchId:i});me(o.userId===this.userId,9748,"Unexpected user for mutation batch",{userId:o.userId,batchId:i}),r.push(Qo(this.serializer,o))}))}),j.waitFor(s).next(()=>r)}removeMutationBatch(e,t){return RR(e.le,this.userId,t).next(r=>(e.addOnCommittedListener(()=>{this.ir(t.batchId)}),j.forEach(r,s=>this.referenceDelegate.markPotentiallyOrphaned(e,s))))}ir(e){delete this.Xn[e]}performConsistencyCheck(e){return this.checkEmpty(e).next(t=>{if(!t)return j.resolve();const r=IDBKeyRange.lowerBound(function(o){return[o]}(this.userId)),s=[];return ml(e).ee({range:r},(i,o,a)=>{if(i[0]===this.userId){const c=ks(i[1]);s.push(c)}else a.done()}).next(()=>{me(s.length===0,56720,{sr:s.map(i=>i.canonicalString())})})})}containsKey(e,t){return DR(e,this.userId,t)}_r(e){return PR(e).get(this.userId).next(t=>t||{userId:this.userId,lastAcknowledgedBatchId:uo,lastStreamToken:""})}}function DR(n,e,t){const r=Bf(e,t.path),s=r[1],i=IDBKeyRange.lowerBound(r);let o=!1;return ml(n).ee({range:i,X:!0},(a,c,u)=>{const[h,f,m]=a;h===e&&f===s&&(o=!0),u.done()}).next(()=>o)}function Di(n){return bn(n,as)}function ml(n){return bn(n,sc)}function PR(n){return bn(n,Cd)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ka{constructor(e){this.ar=e}next(){return this.ar+=2,this.ar}static ur(){return new ka(0)}static cr(){return new ka(-1)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class H6{constructor(e,t){this.referenceDelegate=e,this.serializer=t}allocateTargetId(e){return this.lr(e).next(t=>{const r=new ka(t.highestTargetId);return t.highestTargetId=r.next(),this.hr(e,t).next(()=>t.highestTargetId)})}getLastRemoteSnapshotVersion(e){return this.lr(e).next(t=>_e.fromTimestamp(new Fe(t.lastRemoteSnapshotVersion.seconds,t.lastRemoteSnapshotVersion.nanoseconds)))}getHighestSequenceNumber(e){return this.lr(e).next(t=>t.highestListenSequenceNumber)}setTargetsMetadata(e,t,r){return this.lr(e).next(s=>(s.highestListenSequenceNumber=t,r&&(s.lastRemoteSnapshotVersion=r.toTimestamp()),t>s.highestListenSequenceNumber&&(s.highestListenSequenceNumber=t),this.hr(e,s)))}addTargetData(e,t){return this.Pr(e,t).next(()=>this.lr(e).next(r=>(r.targetCount+=1,this.Tr(t,r),this.hr(e,r))))}updateTargetData(e,t){return this.Pr(e,t)}removeTargetData(e,t){return this.removeMatchingKeysForTargetId(e,t.targetId).next(()=>cl(e).delete(t.targetId)).next(()=>this.lr(e)).next(r=>(me(r.targetCount>0,8065),r.targetCount-=1,this.hr(e,r)))}removeTargets(e,t,r){let s=0;const i=[];return cl(e).ee((o,a)=>{const c=Iu(a);c.sequenceNumber<=t&&r.get(c.targetId)===null&&(s++,i.push(this.removeTargetData(e,c)))}).next(()=>j.waitFor(i)).next(()=>s)}forEachTarget(e,t){return cl(e).ee((r,s)=>{const i=Iu(s);t(i)})}lr(e){return jb(e).get(Hm).next(t=>(me(t!==null,2888),t))}hr(e,t){return jb(e).put(Hm,t)}Pr(e,t){return cl(e).put(AR(this.serializer,t))}Tr(e,t){let r=!1;return e.targetId>t.highestTargetId&&(t.highestTargetId=e.targetId,r=!0),e.sequenceNumber>t.highestListenSequenceNumber&&(t.highestListenSequenceNumber=e.sequenceNumber,r=!0),r}getTargetCount(e){return this.lr(e).next(t=>t.targetCount)}getTargetData(e,t){const r=Ea(t),s=IDBKeyRange.bound([r,Number.NEGATIVE_INFINITY],[r,Number.POSITIVE_INFINITY]);let i=null;return cl(e).ee({range:s,index:wN},(o,a,c)=>{const u=Iu(a);hh(t,u.target)&&(i=u,c.done())}).next(()=>i)}addMatchingKeys(e,t,r){const s=[],i=$i(e);return t.forEach(o=>{const a=tr(o.path);s.push(i.put({targetId:r,path:a})),s.push(this.referenceDelegate.addReference(e,r,o))}),j.waitFor(s)}removeMatchingKeys(e,t,r){const s=$i(e);return j.forEach(t,i=>{const o=tr(i.path);return j.waitFor([s.delete([r,o]),this.referenceDelegate.removeReference(e,r,i)])})}removeMatchingKeysForTargetId(e,t){const r=$i(e),s=IDBKeyRange.bound([t],[t+1],!1,!0);return r.delete(s)}getMatchingKeysForTargetId(e,t){const r=IDBKeyRange.bound([t],[t+1],!1,!0),s=$i(e);let i=Le();return s.ee({range:r,X:!0},(o,a,c)=>{const u=ks(o[1]),h=new se(u);i=i.add(h)}).next(()=>i)}containsKey(e,t){const r=tr(t.path),s=IDBKeyRange.bound([r],[cN(r)],!1,!0);let i=0;return $i(e).ee({index:jw,X:!0,range:s},([o,a],c,u)=>{o!==0&&(i++,u.done())}).next(()=>i>0)}At(e,t){return cl(e).get(t).next(r=>r?Iu(r):null)}}function cl(n){return bn(n,ic)}function jb(n){return bn(n,ca)}function $i(n){return bn(n,oc)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Lb="LruGarbageCollector",OR=1048576;function Mb([n,e],[t,r]){const s=Ne(n,t);return s===0?Ne(e,r):s}class Q6{constructor(e){this.Ir=e,this.buffer=new mt(Mb),this.Er=0}dr(){return++this.Er}Ar(e){const t=[e,this.dr()];if(this.buffer.size<this.Ir)this.buffer=this.buffer.add(t);else{const r=this.buffer.last();Mb(t,r)<0&&(this.buffer=this.buffer.delete(r).add(t))}}get maxValue(){return this.buffer.last()[0]}}class jR{constructor(e,t,r){this.garbageCollector=e,this.asyncQueue=t,this.localStore=r,this.Rr=null}start(){this.garbageCollector.params.cacheSizeCollectionThreshold!==-1&&this.Vr(6e4)}stop(){this.Rr&&(this.Rr.cancel(),this.Rr=null)}get started(){return this.Rr!==null}Vr(e){G(Lb,`Garbage collection scheduled in ${e}ms`),this.Rr=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",e,async()=>{this.Rr=null;try{await this.localStore.collectGarbage(this.garbageCollector)}catch(t){Do(t)?G(Lb,"Ignoring IndexedDB error during garbage collection: ",t):await Ro(t)}await this.Vr(3e5)})}}class K6{constructor(e,t){this.mr=e,this.params=t}calculateTargetCount(e,t){return this.mr.gr(e).next(r=>Math.floor(t/100*r))}nthSequenceNumber(e,t){if(t===0)return j.resolve(hr.ce);const r=new Q6(t);return this.mr.forEachTarget(e,s=>r.Ar(s.sequenceNumber)).next(()=>this.mr.pr(e,s=>r.Ar(s))).next(()=>r.maxValue)}removeTargets(e,t,r){return this.mr.removeTargets(e,t,r)}removeOrphanedDocuments(e,t){return this.mr.removeOrphanedDocuments(e,t)}collect(e,t){return this.params.cacheSizeCollectionThreshold===-1?(G("LruGarbageCollector","Garbage collection skipped; disabled"),j.resolve(Ob)):this.getCacheSize(e).next(r=>r<this.params.cacheSizeCollectionThreshold?(G("LruGarbageCollector",`Garbage collection skipped; Cache size ${r} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),Ob):this.yr(e,t))}getCacheSize(e){return this.mr.getCacheSize(e)}yr(e,t){let r,s,i,o,a,c,u;const h=Date.now();return this.calculateTargetCount(e,this.params.percentileToCollect).next(f=>(f>this.params.maximumSequenceNumbersToCollect?(G("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${f}`),s=this.params.maximumSequenceNumbersToCollect):s=f,o=Date.now(),this.nthSequenceNumber(e,s))).next(f=>(r=f,a=Date.now(),this.removeTargets(e,r,t))).next(f=>(i=f,c=Date.now(),this.removeOrphanedDocuments(e,r))).next(f=>(u=Date.now(),dl()<=We.DEBUG&&G("LruGarbageCollector",`LRU Garbage Collection
	Counted targets in ${o-h}ms
	Determined least recently used ${s} in `+(a-o)+`ms
	Removed ${i} targets in `+(c-a)+`ms
	Removed ${f} documents in `+(u-c)+`ms
Total Duration: ${u-h}ms`),j.resolve({didRun:!0,sequenceNumbersCollected:s,targetsRemoved:i,documentsRemoved:f})))}}function LR(n,e){return new K6(n,e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Y6{constructor(e,t){this.db=e,this.garbageCollector=LR(this,t)}gr(e){const t=this.wr(e);return this.db.getTargetCache().getTargetCount(e).next(r=>t.next(s=>r+s))}wr(e){let t=0;return this.pr(e,r=>{t++}).next(()=>t)}forEachTarget(e,t){return this.db.getTargetCache().forEachTarget(e,t)}pr(e,t){return this.Sr(e,(r,s)=>t(s))}addReference(e,t,r){return pf(e,r)}removeReference(e,t,r){return pf(e,r)}removeTargets(e,t,r){return this.db.getTargetCache().removeTargets(e,t,r)}markPotentiallyOrphaned(e,t){return pf(e,t)}br(e,t){return function(s,i){let o=!1;return PR(s).te(a=>DR(s,a,i).next(c=>(c&&(o=!0),j.resolve(!c)))).next(()=>o)}(e,t)}removeOrphanedDocuments(e,t){const r=this.db.getRemoteDocumentCache().newChangeBuffer(),s=[];let i=0;return this.Sr(e,(o,a)=>{if(a<=t){const c=this.br(e,o).next(u=>{if(!u)return i++,r.getEntry(e,o).next(()=>(r.removeEntry(o,_e.min()),$i(e).delete(function(f){return[0,tr(f.path)]}(o))))});s.push(c)}}).next(()=>j.waitFor(s)).next(()=>r.apply(e)).next(()=>i)}removeTarget(e,t){const r=t.withSequenceNumber(e.currentSequenceNumber);return this.db.getTargetCache().updateTargetData(e,r)}updateLimboDocument(e,t){return pf(e,t)}Sr(e,t){const r=$i(e);let s,i=hr.ce;return r.ee({index:jw},([o,a],{path:c,sequenceNumber:u})=>{o===0?(i!==hr.ce&&t(new se(ks(s)),i),i=u,s=c):i=hr.ce}).next(()=>{i!==hr.ce&&t(new se(ks(s)),i)})}getCacheSize(e){return this.db.getRemoteDocumentCache().getSize(e)}}function pf(n,e){return $i(n).put(function(r,s){return{targetId:0,path:tr(r.path),sequenceNumber:s}}(e,n.currentSequenceNumber))}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class MR{constructor(){this.changes=new Si(e=>e.toString(),(e,t)=>e.isEqual(t)),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,t){this.assertNotApplied(),this.changes.set(e,Lt.newInvalidDocument(e).setReadTime(t))}getEntry(e,t){this.assertNotApplied();const r=this.changes.get(t);return r!==void 0?j.resolve(r):this.getFromCache(e,t)}getEntries(e,t){return this.getAllFromCache(e,t)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class J6{constructor(e){this.serializer=e}setIndexManager(e){this.indexManager=e}addEntry(e,t,r){return $o(e).put(r)}removeEntry(e,t,r){return $o(e).delete(function(i,o){const a=i.path.toArray();return[a.slice(0,a.length-2),a[a.length-2],Jm(o),a[a.length-1]]}(t,r))}updateMetadata(e,t){return this.getMetadata(e).next(r=>(r.byteSize+=t,this.Dr(e,r)))}getEntry(e,t){let r=Lt.newInvalidDocument(t);return $o(e).ee({index:zf,range:IDBKeyRange.only(cu(t))},(s,i)=>{r=this.Cr(t,i)}).next(()=>r)}vr(e,t){let r={size:0,document:Lt.newInvalidDocument(t)};return $o(e).ee({index:zf,range:IDBKeyRange.only(cu(t))},(s,i)=>{r={document:this.Cr(t,i),size:Zm(i)}}).next(()=>r)}getEntries(e,t){let r=mr();return this.Fr(e,t,(s,i)=>{const o=this.Cr(s,i);r=r.insert(s,o)}).next(()=>r)}Mr(e,t){let r=mr(),s=new Rt(se.comparator);return this.Fr(e,t,(i,o)=>{const a=this.Cr(i,o);r=r.insert(i,a),s=s.insert(i,Zm(o))}).next(()=>({documents:r,Or:s}))}Fr(e,t,r){if(t.isEmpty())return j.resolve();let s=new mt($b);t.forEach(c=>s=s.add(c));const i=IDBKeyRange.bound(cu(s.first()),cu(s.last())),o=s.getIterator();let a=o.getNext();return $o(e).ee({index:zf,range:i},(c,u,h)=>{const f=se.fromSegments([...u.prefixPath,u.collectionGroup,u.documentId]);for(;a&&$b(a,f)<0;)r(a,null),a=o.getNext();a&&a.isEqual(f)&&(r(a,u),a=o.hasNext()?o.getNext():null),a?h.j(cu(a)):h.done()}).next(()=>{for(;a;)r(a,null),a=o.hasNext()?o.getNext():null})}getDocumentsMatchingQuery(e,t,r,s,i){const o=t.path,a=[o.popLast().toArray(),o.lastSegment(),Jm(r.readTime),r.documentKey.path.isEmpty()?"":r.documentKey.path.lastSegment()],c=[o.popLast().toArray(),o.lastSegment(),[Number.MAX_SAFE_INTEGER,Number.MAX_SAFE_INTEGER],""];return $o(e).J(IDBKeyRange.bound(a,c,!0)).next(u=>{i==null||i.incrementDocumentReadCount(u.length);let h=mr();for(const f of u){const m=this.Cr(se.fromSegments(f.prefixPath.concat(f.collectionGroup,f.documentId)),f);m.isFoundDocument()&&(mh(t,m)||s.has(m.key))&&(h=h.insert(m.key,m))}return h})}getAllFromCollectionGroup(e,t,r,s){let i=mr();const o=Fb(t,r),a=Fb(t,Mr.max());return $o(e).ee({index:vN,range:IDBKeyRange.bound(o,a,!0)},(c,u,h)=>{const f=this.Cr(se.fromSegments(u.prefixPath.concat(u.collectionGroup,u.documentId)),u);i=i.insert(f.key,f),i.size===s&&h.done()}).next(()=>i)}newChangeBuffer(e){return new X6(this,!!e&&e.trackRemovals)}getSize(e){return this.getMetadata(e).next(t=>t.byteSize)}getMetadata(e){return Vb(e).get(wv).next(t=>(me(!!t,20021),t))}Dr(e,t){return Vb(e).put(wv,t)}Cr(e,t){if(t){const r=M6(this.serializer,t);if(!(r.isNoDocument()&&r.version.isEqual(_e.min())))return r}return Lt.newInvalidDocument(e)}}function VR(n){return new J6(n)}class X6 extends MR{constructor(e,t){super(),this.Nr=e,this.trackRemovals=t,this.Br=new Si(r=>r.toString(),(r,s)=>r.isEqual(s))}applyChanges(e){const t=[];let r=0,s=new mt((i,o)=>Ne(i.canonicalString(),o.canonicalString()));return this.changes.forEach((i,o)=>{const a=this.Br.get(i);if(t.push(this.Nr.removeEntry(e,i,a.readTime)),o.isValidDocument()){const c=xb(this.Nr.serializer,o);s=s.add(i.path.popLast());const u=Zm(c);r+=u-a.size,t.push(this.Nr.addEntry(e,i,c))}else if(r-=a.size,this.trackRemovals){const c=xb(this.Nr.serializer,o.convertToNoDocument(_e.min()));t.push(this.Nr.addEntry(e,i,c))}}),s.forEach(i=>{t.push(this.Nr.indexManager.addToCollectionParentIndex(e,i))}),t.push(this.Nr.updateMetadata(e,r)),j.waitFor(t)}getFromCache(e,t){return this.Nr.vr(e,t).next(r=>(this.Br.set(t,{size:r.size,readTime:r.document.readTime}),r.document))}getAllFromCache(e,t){return this.Nr.Mr(e,t).next(({documents:r,Or:s})=>(s.forEach((i,o)=>{this.Br.set(i,{size:o,readTime:r.get(i).readTime})}),r))}}function Vb(n){return bn(n,kd)}function $o(n){return bn(n,Gm)}function cu(n){const e=n.path.toArray();return[e.slice(0,e.length-2),e[e.length-2],e[e.length-1]]}function Fb(n,e){const t=e.documentKey.path.toArray();return[n,Jm(e.readTime),t.slice(0,t.length-2),t.length>0?t[t.length-1]:""]}function $b(n,e){const t=n.path.toArray(),r=e.path.toArray();let s=0;for(let i=0;i<t.length-2&&i<r.length-2;++i)if(s=Ne(t[i],r[i]),s)return s;return s=Ne(t.length,r.length),s||(s=Ne(t[t.length-2],r[r.length-2]),s||Ne(t[t.length-1],r[r.length-1]))}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Z6{constructor(e,t){this.overlayedDocument=e,this.mutatedFields=t}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class FR{constructor(e,t,r,s){this.remoteDocumentCache=e,this.mutationQueue=t,this.documentOverlayCache=r,this.indexManager=s}getDocument(e,t){let r=null;return this.documentOverlayCache.getOverlay(e,t).next(s=>(r=s,this.remoteDocumentCache.getEntry(e,t))).next(s=>(r!==null&&Wu(r.mutation,s,fr.empty(),Fe.now()),s))}getDocuments(e,t){return this.remoteDocumentCache.getEntries(e,t).next(r=>this.getLocalViewOfDocuments(e,r,Le()).next(()=>r))}getLocalViewOfDocuments(e,t,r=Le()){const s=Ns();return this.populateOverlays(e,s,t).next(()=>this.computeViews(e,t,s,r).next(i=>{let o=xu();return i.forEach((a,c)=>{o=o.insert(a,c.overlayedDocument)}),o}))}getOverlayedDocuments(e,t){const r=Ns();return this.populateOverlays(e,r,t).next(()=>this.computeViews(e,t,r,Le()))}populateOverlays(e,t,r){const s=[];return r.forEach(i=>{t.has(i)||s.push(i)}),this.documentOverlayCache.getOverlays(e,s).next(i=>{i.forEach((o,a)=>{t.set(o,a)})})}computeViews(e,t,r,s){let i=mr();const o=qu(),a=function(){return qu()}();return t.forEach((c,u)=>{const h=r.get(u.key);s.has(u.key)&&(h===void 0||h.mutation instanceof Ii)?i=i.insert(u.key,u):h!==void 0?(o.set(u.key,h.mutation.getFieldMask()),Wu(h.mutation,u,h.mutation.getFieldMask(),Fe.now())):o.set(u.key,fr.empty())}),this.recalculateAndSaveOverlays(e,i).next(c=>(c.forEach((u,h)=>o.set(u,h)),t.forEach((u,h)=>a.set(u,new Z6(h,o.get(u)??null))),a))}recalculateAndSaveOverlays(e,t){const r=qu();let s=new Rt((o,a)=>o-a),i=Le();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,t).next(o=>{for(const a of o)a.keys().forEach(c=>{const u=t.get(c);if(u===null)return;let h=r.get(c)||fr.empty();h=a.applyToLocalView(u,h),r.set(c,h);const f=(s.get(a.batchId)||Le()).add(c);s=s.insert(a.batchId,f)})}).next(()=>{const o=[],a=s.getReverseIterator();for(;a.hasNext();){const c=a.getNext(),u=c.key,h=c.value,f=eR();h.forEach(m=>{if(!i.has(m)){const y=aR(t.get(m),r.get(m));y!==null&&f.set(m,y),i=i.add(m)}}),o.push(this.documentOverlayCache.saveOverlays(e,u,f))}return j.waitFor(o)}).next(()=>r)}recalculateAndSaveOverlaysForDocumentKeys(e,t){return this.remoteDocumentCache.getEntries(e,t).next(r=>this.recalculateAndSaveOverlays(e,r))}getDocumentsMatchingQuery(e,t,r,s){return function(o){return se.isDocumentKey(o.path)&&o.collectionGroup===null&&o.filters.length===0}(t)?this.getDocumentsMatchingDocumentQuery(e,t.path):Bw(t)?this.getDocumentsMatchingCollectionGroupQuery(e,t,r,s):this.getDocumentsMatchingCollectionQuery(e,t,r,s)}getNextDocuments(e,t,r,s){return this.remoteDocumentCache.getAllFromCollectionGroup(e,t,r,s).next(i=>{const o=s-i.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(e,t,r.largestBatchId,s-i.size):j.resolve(Ns());let a=tc,c=i;return o.next(u=>j.forEach(u,(h,f)=>(a<f.largestBatchId&&(a=f.largestBatchId),i.get(h)?j.resolve():this.remoteDocumentCache.getEntry(e,h).next(m=>{c=c.insert(h,m)}))).next(()=>this.populateOverlays(e,u,i)).next(()=>this.computeViews(e,c,u,Le())).next(h=>({batchId:a,changes:ZN(h)})))})}getDocumentsMatchingDocumentQuery(e,t){return this.getDocument(e,new se(t)).next(r=>{let s=xu();return r.isFoundDocument()&&(s=s.insert(r.key,r)),s})}getDocumentsMatchingCollectionGroupQuery(e,t,r,s){const i=t.collectionGroup;let o=xu();return this.indexManager.getCollectionParents(e,i).next(a=>j.forEach(a,c=>{const u=function(f,m){return new xi(m,null,f.explicitOrderBy.slice(),f.filters.slice(),f.limit,f.limitType,f.startAt,f.endAt)}(t,c.child(i));return this.getDocumentsMatchingCollectionQuery(e,u,r,s).next(h=>{h.forEach((f,m)=>{o=o.insert(f,m)})})}).next(()=>o))}getDocumentsMatchingCollectionQuery(e,t,r,s){let i;return this.documentOverlayCache.getOverlaysForCollection(e,t.path,r.largestBatchId).next(o=>(i=o,this.remoteDocumentCache.getDocumentsMatchingQuery(e,t,r,i,s))).next(o=>{i.forEach((c,u)=>{const h=u.getKey();o.get(h)===null&&(o=o.insert(h,Lt.newInvalidDocument(h)))});let a=xu();return o.forEach((c,u)=>{const h=i.get(c);h!==void 0&&Wu(h.mutation,u,fr.empty(),Fe.now()),mh(t,u)&&(a=a.insert(c,u))}),a})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class e5{constructor(e){this.serializer=e,this.Lr=new Map,this.kr=new Map}getBundleMetadata(e,t){return j.resolve(this.Lr.get(t))}saveBundleMetadata(e,t){return this.Lr.set(t.id,function(s){return{id:s.id,version:s.version,createTime:hn(s.createTime)}}(t)),j.resolve()}getNamedQuery(e,t){return j.resolve(this.kr.get(t))}saveNamedQuery(e,t){return this.kr.set(t.name,function(s){return{name:s.name,query:fg(s.bundledQuery),readTime:hn(s.readTime)}}(t)),j.resolve()}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class t5{constructor(){this.overlays=new Rt(se.comparator),this.qr=new Map}getOverlay(e,t){return j.resolve(this.overlays.get(t))}getOverlays(e,t){const r=Ns();return j.forEach(t,s=>this.getOverlay(e,s).next(i=>{i!==null&&r.set(s,i)})).next(()=>r)}saveOverlays(e,t,r){return r.forEach((s,i)=>{this.St(e,t,i)}),j.resolve()}removeOverlaysForBatchId(e,t,r){const s=this.qr.get(r);return s!==void 0&&(s.forEach(i=>this.overlays=this.overlays.remove(i)),this.qr.delete(r)),j.resolve()}getOverlaysForCollection(e,t,r){const s=Ns(),i=t.length+1,o=new se(t.child("")),a=this.overlays.getIteratorFrom(o);for(;a.hasNext();){const c=a.getNext().value,u=c.getKey();if(!t.isPrefixOf(u.path))break;u.path.length===i&&c.largestBatchId>r&&s.set(c.getKey(),c)}return j.resolve(s)}getOverlaysForCollectionGroup(e,t,r,s){let i=new Rt((u,h)=>u-h);const o=this.overlays.getIterator();for(;o.hasNext();){const u=o.getNext().value;if(u.getKey().getCollectionGroup()===t&&u.largestBatchId>r){let h=i.get(u.largestBatchId);h===null&&(h=Ns(),i=i.insert(u.largestBatchId,h)),h.set(u.getKey(),u)}}const a=Ns(),c=i.getIterator();for(;c.hasNext()&&(c.getNext().value.forEach((u,h)=>a.set(u,h)),!(a.size()>=s)););return j.resolve(a)}St(e,t,r){const s=this.overlays.get(r.key);if(s!==null){const o=this.qr.get(s.largestBatchId).delete(r.key);this.qr.set(s.largestBatchId,o)}this.overlays=this.overlays.insert(r.key,new Qw(t,r));let i=this.qr.get(t);i===void 0&&(i=Le(),this.qr.set(t,i)),this.qr.set(t,i.add(r.key))}}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class n5{constructor(){this.sessionToken=an.EMPTY_BYTE_STRING}getSessionToken(e){return j.resolve(this.sessionToken)}setSessionToken(e,t){return this.sessionToken=t,j.resolve()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Zw{constructor(){this.Qr=new mt(kn.$r),this.Ur=new mt(kn.Kr)}isEmpty(){return this.Qr.isEmpty()}addReference(e,t){const r=new kn(e,t);this.Qr=this.Qr.add(r),this.Ur=this.Ur.add(r)}Wr(e,t){e.forEach(r=>this.addReference(r,t))}removeReference(e,t){this.Gr(new kn(e,t))}zr(e,t){e.forEach(r=>this.removeReference(r,t))}jr(e){const t=new se(new ze([])),r=new kn(t,e),s=new kn(t,e+1),i=[];return this.Ur.forEachInRange([r,s],o=>{this.Gr(o),i.push(o.key)}),i}Jr(){this.Qr.forEach(e=>this.Gr(e))}Gr(e){this.Qr=this.Qr.delete(e),this.Ur=this.Ur.delete(e)}Hr(e){const t=new se(new ze([])),r=new kn(t,e),s=new kn(t,e+1);let i=Le();return this.Ur.forEachInRange([r,s],o=>{i=i.add(o.key)}),i}containsKey(e){const t=new kn(e,0),r=this.Qr.firstAfterOrEqual(t);return r!==null&&e.isEqual(r.key)}}class kn{constructor(e,t){this.key=e,this.Yr=t}static $r(e,t){return se.comparator(e.key,t.key)||Ne(e.Yr,t.Yr)}static Kr(e,t){return Ne(e.Yr,t.Yr)||se.comparator(e.key,t.key)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class r5{constructor(e,t){this.indexManager=e,this.referenceDelegate=t,this.mutationQueue=[],this.tr=1,this.Zr=new mt(kn.$r)}checkEmpty(e){return j.resolve(this.mutationQueue.length===0)}addMutationBatch(e,t,r,s){const i=this.tr;this.tr++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];const o=new Gw(i,t,r,s);this.mutationQueue.push(o);for(const a of s)this.Zr=this.Zr.add(new kn(a.key,i)),this.indexManager.addToCollectionParentIndex(e,a.key.path.popLast());return j.resolve(o)}lookupMutationBatch(e,t){return j.resolve(this.Xr(t))}getNextMutationBatchAfterBatchId(e,t){const r=t+1,s=this.ei(r),i=s<0?0:s;return j.resolve(this.mutationQueue.length>i?this.mutationQueue[i]:null)}getHighestUnacknowledgedBatchId(){return j.resolve(this.mutationQueue.length===0?uo:this.tr-1)}getAllMutationBatches(e){return j.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,t){const r=new kn(t,0),s=new kn(t,Number.POSITIVE_INFINITY),i=[];return this.Zr.forEachInRange([r,s],o=>{const a=this.Xr(o.Yr);i.push(a)}),j.resolve(i)}getAllMutationBatchesAffectingDocumentKeys(e,t){let r=new mt(Ne);return t.forEach(s=>{const i=new kn(s,0),o=new kn(s,Number.POSITIVE_INFINITY);this.Zr.forEachInRange([i,o],a=>{r=r.add(a.Yr)})}),j.resolve(this.ti(r))}getAllMutationBatchesAffectingQuery(e,t){const r=t.path,s=r.length+1;let i=r;se.isDocumentKey(i)||(i=i.child(""));const o=new kn(new se(i),0);let a=new mt(Ne);return this.Zr.forEachWhile(c=>{const u=c.key.path;return!!r.isPrefixOf(u)&&(u.length===s&&(a=a.add(c.Yr)),!0)},o),j.resolve(this.ti(a))}ti(e){const t=[];return e.forEach(r=>{const s=this.Xr(r);s!==null&&t.push(s)}),t}removeMutationBatch(e,t){me(this.ni(t.batchId,"removed")===0,55003),this.mutationQueue.shift();let r=this.Zr;return j.forEach(t.mutations,s=>{const i=new kn(s.key,t.batchId);return r=r.delete(i),this.referenceDelegate.markPotentiallyOrphaned(e,s.key)}).next(()=>{this.Zr=r})}ir(e){}containsKey(e,t){const r=new kn(t,0),s=this.Zr.firstAfterOrEqual(r);return j.resolve(t.isEqual(s&&s.key))}performConsistencyCheck(e){return this.mutationQueue.length,j.resolve()}ni(e,t){return this.ei(e)}ei(e){return this.mutationQueue.length===0?0:e-this.mutationQueue[0].batchId}Xr(e){const t=this.ei(e);return t<0||t>=this.mutationQueue.length?null:this.mutationQueue[t]}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class s5{constructor(e){this.ri=e,this.docs=function(){return new Rt(se.comparator)}(),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,t){const r=t.key,s=this.docs.get(r),i=s?s.size:0,o=this.ri(t);return this.docs=this.docs.insert(r,{document:t.mutableCopy(),size:o}),this.size+=o-i,this.indexManager.addToCollectionParentIndex(e,r.path.popLast())}removeEntry(e){const t=this.docs.get(e);t&&(this.docs=this.docs.remove(e),this.size-=t.size)}getEntry(e,t){const r=this.docs.get(t);return j.resolve(r?r.document.mutableCopy():Lt.newInvalidDocument(t))}getEntries(e,t){let r=mr();return t.forEach(s=>{const i=this.docs.get(s);r=r.insert(s,i?i.document.mutableCopy():Lt.newInvalidDocument(s))}),j.resolve(r)}getDocumentsMatchingQuery(e,t,r,s){let i=mr();const o=t.path,a=new se(o.child("__id-9223372036854775808__")),c=this.docs.getIteratorFrom(a);for(;c.hasNext();){const{key:u,value:{document:h}}=c.getNext();if(!o.isPrefixOf(u.path))break;u.path.length>o.length+1||Pw(fN(h),r)<=0||(s.has(h.key)||mh(t,h))&&(i=i.insert(h.key,h.mutableCopy()))}return j.resolve(i)}getAllFromCollectionGroup(e,t,r,s){ue(9500)}ii(e,t){return j.forEach(this.docs,r=>t(r))}newChangeBuffer(e){return new i5(this)}getSize(e){return j.resolve(this.size)}}class i5 extends MR{constructor(e){super(),this.Nr=e}applyChanges(e){const t=[];return this.changes.forEach((r,s)=>{s.isValidDocument()?t.push(this.Nr.addEntry(e,s)):this.Nr.removeEntry(r)}),j.waitFor(t)}getFromCache(e,t){return this.Nr.getEntry(e,t)}getAllFromCache(e,t){return this.Nr.getEntries(e,t)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class o5{constructor(e){this.persistence=e,this.si=new Si(t=>Ea(t),hh),this.lastRemoteSnapshotVersion=_e.min(),this.highestTargetId=0,this.oi=0,this._i=new Zw,this.targetCount=0,this.ai=ka.ur()}forEachTarget(e,t){return this.si.forEach((r,s)=>t(s)),j.resolve()}getLastRemoteSnapshotVersion(e){return j.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return j.resolve(this.oi)}allocateTargetId(e){return this.highestTargetId=this.ai.next(),j.resolve(this.highestTargetId)}setTargetsMetadata(e,t,r){return r&&(this.lastRemoteSnapshotVersion=r),t>this.oi&&(this.oi=t),j.resolve()}Pr(e){this.si.set(e.target,e);const t=e.targetId;t>this.highestTargetId&&(this.ai=new ka(t),this.highestTargetId=t),e.sequenceNumber>this.oi&&(this.oi=e.sequenceNumber)}addTargetData(e,t){return this.Pr(t),this.targetCount+=1,j.resolve()}updateTargetData(e,t){return this.Pr(t),j.resolve()}removeTargetData(e,t){return this.si.delete(t.target),this._i.jr(t.targetId),this.targetCount-=1,j.resolve()}removeTargets(e,t,r){let s=0;const i=[];return this.si.forEach((o,a)=>{a.sequenceNumber<=t&&r.get(a.targetId)===null&&(this.si.delete(o),i.push(this.removeMatchingKeysForTargetId(e,a.targetId)),s++)}),j.waitFor(i).next(()=>s)}getTargetCount(e){return j.resolve(this.targetCount)}getTargetData(e,t){const r=this.si.get(t)||null;return j.resolve(r)}addMatchingKeys(e,t,r){return this._i.Wr(t,r),j.resolve()}removeMatchingKeys(e,t,r){this._i.zr(t,r);const s=this.persistence.referenceDelegate,i=[];return s&&t.forEach(o=>{i.push(s.markPotentiallyOrphaned(e,o))}),j.waitFor(i)}removeMatchingKeysForTargetId(e,t){return this._i.jr(t),j.resolve()}getMatchingKeysForTargetId(e,t){const r=this._i.Hr(t);return j.resolve(r)}containsKey(e,t){return j.resolve(this._i.containsKey(t))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ex{constructor(e,t){this.ui={},this.overlays={},this.ci=new hr(0),this.li=!1,this.li=!0,this.hi=new n5,this.referenceDelegate=e(this),this.Pi=new o5(this),this.indexManager=new W6,this.remoteDocumentCache=function(s){return new s5(s)}(r=>this.referenceDelegate.Ti(r)),this.serializer=new TR(t),this.Ii=new e5(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.li=!1,Promise.resolve()}get started(){return this.li}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let t=this.overlays[e.toKey()];return t||(t=new t5,this.overlays[e.toKey()]=t),t}getMutationQueue(e,t){let r=this.ui[e.toKey()];return r||(r=new r5(t,this.referenceDelegate),this.ui[e.toKey()]=r),r}getGlobalsCache(){return this.hi}getTargetCache(){return this.Pi}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.Ii}runTransaction(e,t,r){G("MemoryPersistence","Starting transaction:",e);const s=new a5(this.ci.next());return this.referenceDelegate.Ei(),r(s).next(i=>this.referenceDelegate.di(s).next(()=>i)).toPromise().then(i=>(s.raiseOnCommittedEvent(),i))}Ai(e,t){return j.or(Object.values(this.ui).map(r=>()=>r.containsKey(e,t)))}}class a5 extends pN{constructor(e){super(),this.currentSequenceNumber=e}}class gg{constructor(e){this.persistence=e,this.Ri=new Zw,this.Vi=null}static mi(e){return new gg(e)}get fi(){if(this.Vi)return this.Vi;throw ue(60996)}addReference(e,t,r){return this.Ri.addReference(r,t),this.fi.delete(r.toString()),j.resolve()}removeReference(e,t,r){return this.Ri.removeReference(r,t),this.fi.add(r.toString()),j.resolve()}markPotentiallyOrphaned(e,t){return this.fi.add(t.toString()),j.resolve()}removeTarget(e,t){this.Ri.jr(t.targetId).forEach(s=>this.fi.add(s.toString()));const r=this.persistence.getTargetCache();return r.getMatchingKeysForTargetId(e,t.targetId).next(s=>{s.forEach(i=>this.fi.add(i.toString()))}).next(()=>r.removeTargetData(e,t))}Ei(){this.Vi=new Set}di(e){const t=this.persistence.getRemoteDocumentCache().newChangeBuffer();return j.forEach(this.fi,r=>{const s=se.fromPath(r);return this.gi(e,s).next(i=>{i||t.removeEntry(s,_e.min())})}).next(()=>(this.Vi=null,t.apply(e)))}updateLimboDocument(e,t){return this.gi(e,t).next(r=>{r?this.fi.delete(t.toString()):this.fi.add(t.toString())})}Ti(e){return 0}gi(e,t){return j.or([()=>j.resolve(this.Ri.containsKey(t)),()=>this.persistence.getTargetCache().containsKey(e,t),()=>this.persistence.Ai(e,t)])}}class ep{constructor(e,t){this.persistence=e,this.pi=new Si(r=>tr(r.path),(r,s)=>r.isEqual(s)),this.garbageCollector=LR(this,t)}static mi(e,t){return new ep(e,t)}Ei(){}di(e){return j.resolve()}forEachTarget(e,t){return this.persistence.getTargetCache().forEachTarget(e,t)}gr(e){const t=this.wr(e);return this.persistence.getTargetCache().getTargetCount(e).next(r=>t.next(s=>r+s))}wr(e){let t=0;return this.pr(e,r=>{t++}).next(()=>t)}pr(e,t){return j.forEach(this.pi,(r,s)=>this.br(e,r,s).next(i=>i?j.resolve():t(s)))}removeTargets(e,t,r){return this.persistence.getTargetCache().removeTargets(e,t,r)}removeOrphanedDocuments(e,t){let r=0;const s=this.persistence.getRemoteDocumentCache(),i=s.newChangeBuffer();return s.ii(e,o=>this.br(e,o,t).next(a=>{a||(r++,i.removeEntry(o,_e.min()))})).next(()=>i.apply(e)).next(()=>r)}markPotentiallyOrphaned(e,t){return this.pi.set(t,e.currentSequenceNumber),j.resolve()}removeTarget(e,t){const r=t.withSequenceNumber(e.currentSequenceNumber);return this.persistence.getTargetCache().updateTargetData(e,r)}addReference(e,t,r){return this.pi.set(r,e.currentSequenceNumber),j.resolve()}removeReference(e,t,r){return this.pi.set(r,e.currentSequenceNumber),j.resolve()}updateLimboDocument(e,t){return this.pi.set(t,e.currentSequenceNumber),j.resolve()}Ti(e){let t=e.key.toString().length;return e.isFoundDocument()&&(t+=Wf(e.data.value)),t}br(e,t,r){return j.or([()=>this.persistence.Ai(e,t),()=>this.persistence.getTargetCache().containsKey(e,t),()=>{const s=this.pi.get(t);return j.resolve(s!==void 0&&s>r)}])}getCacheSize(e){return this.persistence.getRemoteDocumentCache().getSize(e)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class l5{constructor(e){this.serializer=e}k(e,t,r,s){const i=new ng("createOrUpgrade",t);r<1&&s>=1&&(function(c){c.createObjectStore(dh)}(e),function(c){c.createObjectStore(Cd,{keyPath:A3}),c.createObjectStore(as,{keyPath:JE,autoIncrement:!0}).createIndex(na,XE,{unique:!0}),c.createObjectStore(sc)}(e),Ub(e),function(c){c.createObjectStore(Go)}(e));let o=j.resolve();return r<3&&s>=3&&(r!==0&&(function(c){c.deleteObjectStore(oc),c.deleteObjectStore(ic),c.deleteObjectStore(ca)}(e),Ub(e)),o=o.next(()=>function(c){const u=c.store(ca),h={highestTargetId:0,highestListenSequenceNumber:0,lastRemoteSnapshotVersion:_e.min().toTimestamp(),targetCount:0};return u.put(Hm,h)}(i))),r<4&&s>=4&&(r!==0&&(o=o.next(()=>function(c,u){return u.store(as).J().next(f=>{c.deleteObjectStore(as),c.createObjectStore(as,{keyPath:JE,autoIncrement:!0}).createIndex(na,XE,{unique:!0});const m=u.store(as),y=f.map(w=>m.put(w));return j.waitFor(y)})}(e,i))),o=o.next(()=>{(function(c){c.createObjectStore(ac,{keyPath:L3})})(e)})),r<5&&s>=5&&(o=o.next(()=>this.yi(i))),r<6&&s>=6&&(o=o.next(()=>(function(c){c.createObjectStore(kd)}(e),this.wi(i)))),r<7&&s>=7&&(o=o.next(()=>this.Si(i))),r<8&&s>=8&&(o=o.next(()=>this.bi(e,i))),r<9&&s>=9&&(o=o.next(()=>{(function(c){c.objectStoreNames.contains("remoteDocumentChanges")&&c.deleteObjectStore("remoteDocumentChanges")})(e)})),r<10&&s>=10&&(o=o.next(()=>this.Di(i))),r<11&&s>=11&&(o=o.next(()=>{(function(c){c.createObjectStore(rg,{keyPath:M3})})(e),function(c){c.createObjectStore(sg,{keyPath:V3})}(e)})),r<12&&s>=12&&(o=o.next(()=>{(function(c){const u=c.createObjectStore(ig,{keyPath:W3});u.createIndex(Sv,G3,{unique:!1}),u.createIndex(IN,H3,{unique:!1})})(e)})),r<13&&s>=13&&(o=o.next(()=>function(c){const u=c.createObjectStore(Gm,{keyPath:k3});u.createIndex(zf,N3),u.createIndex(vN,R3)}(e)).next(()=>this.Ci(e,i)).next(()=>e.deleteObjectStore(Go))),r<14&&s>=14&&(o=o.next(()=>this.Fi(e,i))),r<15&&s>=15&&(o=o.next(()=>function(c){c.createObjectStore(Lw,{keyPath:F3,autoIncrement:!0}).createIndex(xv,$3,{unique:!1}),c.createObjectStore(Uu,{keyPath:U3}).createIndex(xN,B3,{unique:!1}),c.createObjectStore(Bu,{keyPath:z3}).createIndex(SN,q3,{unique:!1})}(e))),r<16&&s>=16&&(o=o.next(()=>{t.objectStore(Uu).clear()}).next(()=>{t.objectStore(Bu).clear()})),r<17&&s>=17&&(o=o.next(()=>{(function(c){c.createObjectStore(Mw,{keyPath:Q3})})(e)})),r<18&&s>=18&&TC()&&(o=o.next(()=>{t.objectStore(Uu).clear()}).next(()=>{t.objectStore(Bu).clear()})),o}wi(e){let t=0;return e.store(Go).ee((r,s)=>{t+=Zm(s)}).next(()=>{const r={byteSize:t};return e.store(kd).put(wv,r)})}yi(e){const t=e.store(Cd),r=e.store(as);return t.J().next(s=>j.forEach(s,i=>{const o=IDBKeyRange.bound([i.userId,uo],[i.userId,i.lastAcknowledgedBatchId]);return r.J(na,o).next(a=>j.forEach(a,c=>{me(c.userId===i.userId,18650,"Cannot process batch from unexpected user",{batchId:c.batchId});const u=Qo(this.serializer,c);return RR(e,i.userId,u).next(()=>{})}))}))}Si(e){const t=e.store(oc),r=e.store(Go);return e.store(ca).get(Hm).next(s=>{const i=[];return r.ee((o,a)=>{const c=new ze(o),u=function(f){return[0,tr(f)]}(c);i.push(t.get(u).next(h=>h?j.resolve():(f=>t.put({targetId:0,path:tr(f),sequenceNumber:s.highestListenSequenceNumber}))(c)))}).next(()=>j.waitFor(i))})}bi(e,t){e.createObjectStore(Nd,{keyPath:j3});const r=t.store(Nd),s=new Xw,i=o=>{if(s.add(o)){const a=o.lastSegment(),c=o.popLast();return r.put({collectionId:a,parent:tr(c)})}};return t.store(Go).ee({X:!0},(o,a)=>{const c=new ze(o);return i(c.popLast())}).next(()=>t.store(sc).ee({X:!0},([o,a,c],u)=>{const h=ks(a);return i(h.popLast())}))}Di(e){const t=e.store(ic);return t.ee((r,s)=>{const i=Iu(s),o=AR(this.serializer,i);return t.put(o)})}Ci(e,t){const r=t.store(Go),s=[];return r.ee((i,o)=>{const a=t.store(Gm),c=function(f){return f.document?new se(ze.fromString(f.document.name).popFirst(5)):f.noDocument?se.fromSegments(f.noDocument.path):f.unknownDocument?se.fromSegments(f.unknownDocument.path):ue(36783)}(o).path.toArray(),u={prefixPath:c.slice(0,c.length-2),collectionGroup:c[c.length-2],documentId:c[c.length-1],readTime:o.readTime||[0,0],unknownDocument:o.unknownDocument,noDocument:o.noDocument,document:o.document,hasCommittedMutations:!!o.hasCommittedMutations};s.push(a.put(u))}).next(()=>j.waitFor(s))}Fi(e,t){const r=t.store(as),s=VR(this.serializer),i=new ex(gg.mi,this.serializer.yt);return r.J().next(o=>{const a=new Map;return o.forEach(c=>{let u=a.get(c.userId)??Le();Qo(this.serializer,c).keys().forEach(h=>u=u.add(h)),a.set(c.userId,u)}),j.forEach(a,(c,u)=>{const h=new Rn(u),f=mg.wt(this.serializer,h),m=i.getIndexManager(h),y=pg.wt(h,this.serializer,m,i.referenceDelegate);return new FR(s,y,f,m).recalculateAndSaveOverlaysForDocumentKeys(new Iv(t,hr.ce),c).next()})})}}function Ub(n){n.createObjectStore(oc,{keyPath:P3}).createIndex(jw,O3,{unique:!0}),n.createObjectStore(ic,{keyPath:"targetId"}).createIndex(wN,D3,{unique:!0}),n.createObjectStore(ca)}const Pi="IndexedDbPersistence",Oy=18e5,jy=5e3,Ly="Failed to obtain exclusive access to the persistence layer. To allow shared access, multi-tab synchronization has to be enabled in all tabs. If you are using `experimentalForceOwningTab:true`, make sure that only one tab has persistence enabled at any given time.",$R="main";class tx{constructor(e,t,r,s,i,o,a,c,u,h,f=18){if(this.allowTabSynchronization=e,this.persistenceKey=t,this.clientId=r,this.Mi=i,this.window=o,this.document=a,this.xi=u,this.Oi=h,this.Ni=f,this.ci=null,this.li=!1,this.isPrimary=!1,this.networkEnabled=!0,this.Bi=null,this.inForeground=!1,this.Li=null,this.ki=null,this.qi=Number.NEGATIVE_INFINITY,this.Qi=m=>Promise.resolve(),!tx.v())throw new q(M.UNIMPLEMENTED,"This platform is either missing IndexedDB or is known to have an incomplete implementation. Offline persistence has been disabled.");this.referenceDelegate=new Y6(this,s),this.$i=t+$R,this.serializer=new TR(c),this.Ui=new Ms(this.$i,this.Ni,new l5(this.serializer)),this.hi=new F6,this.Pi=new H6(this.referenceDelegate,this.serializer),this.remoteDocumentCache=VR(this.serializer),this.Ii=new V6,this.window&&this.window.localStorage?this.Ki=this.window.localStorage:(this.Ki=null,h===!1&&dn(Pi,"LocalStorage is unavailable. As a result, persistence may not work reliably. In particular enablePersistence() could fail immediately after refreshing the page."))}start(){return this.Wi().then(()=>{if(!this.isPrimary&&!this.allowTabSynchronization)throw new q(M.FAILED_PRECONDITION,Ly);return this.Gi(),this.zi(),this.ji(),this.runTransaction("getHighestListenSequenceNumber","readonly",e=>this.Pi.getHighestSequenceNumber(e))}).then(e=>{this.ci=new hr(e,this.xi)}).then(()=>{this.li=!0}).catch(e=>(this.Ui&&this.Ui.close(),Promise.reject(e)))}Ji(e){return this.Qi=async t=>{if(this.started)return e(t)},e(this.isPrimary)}setDatabaseDeletedListener(e){this.Ui.$(async t=>{t.newVersion===null&&await e()})}setNetworkEnabled(e){this.networkEnabled!==e&&(this.networkEnabled=e,this.Mi.enqueueAndForget(async()=>{this.started&&await this.Wi()}))}Wi(){return this.runTransaction("updateClientMetadataAndTryBecomePrimary","readwrite",e=>gf(e).put({clientId:this.clientId,updateTimeMs:Date.now(),networkEnabled:this.networkEnabled,inForeground:this.inForeground}).next(()=>{if(this.isPrimary)return this.Hi(e).next(t=>{t||(this.isPrimary=!1,this.Mi.enqueueRetryable(()=>this.Qi(!1)))})}).next(()=>this.Yi(e)).next(t=>this.isPrimary&&!t?this.Zi(e).next(()=>!1):!!t&&this.Xi(e).next(()=>!0))).catch(e=>{if(Do(e))return G(Pi,"Failed to extend owner lease: ",e),this.isPrimary;if(!this.allowTabSynchronization)throw e;return G(Pi,"Releasing owner lease after error during lease refresh",e),!1}).then(e=>{this.isPrimary!==e&&this.Mi.enqueueRetryable(()=>this.Qi(e)),this.isPrimary=e})}Hi(e){return uu(e).get(sl).next(t=>j.resolve(this.es(t)))}ts(e){return gf(e).delete(this.clientId)}async ns(){if(this.isPrimary&&!this.rs(this.qi,Oy)){this.qi=Date.now();const e=await this.runTransaction("maybeGarbageCollectMultiClientState","readwrite-primary",t=>{const r=bn(t,ac);return r.J().next(s=>{const i=this.ss(s,Oy),o=s.filter(a=>i.indexOf(a)===-1);return j.forEach(o,a=>r.delete(a.clientId)).next(()=>o)})}).catch(()=>[]);if(this.Ki)for(const t of e)this.Ki.removeItem(this._s(t.clientId))}}ji(){this.ki=this.Mi.enqueueAfterDelay("client_metadata_refresh",4e3,()=>this.Wi().then(()=>this.ns()).then(()=>this.ji()))}es(e){return!!e&&e.ownerId===this.clientId}Yi(e){return this.Oi?j.resolve(!0):uu(e).get(sl).next(t=>{if(t!==null&&this.rs(t.leaseTimestampMs,jy)&&!this.us(t.ownerId)){if(this.es(t)&&this.networkEnabled)return!0;if(!this.es(t)){if(!t.allowTabSynchronization)throw new q(M.FAILED_PRECONDITION,Ly);return!1}}return!(!this.networkEnabled||!this.inForeground)||gf(e).J().next(r=>this.ss(r,jy).find(s=>{if(this.clientId!==s.clientId){const i=!this.networkEnabled&&s.networkEnabled,o=!this.inForeground&&s.inForeground,a=this.networkEnabled===s.networkEnabled;if(i||o&&a)return!0}return!1})===void 0)}).next(t=>(this.isPrimary!==t&&G(Pi,`Client ${t?"is":"is not"} eligible for a primary lease.`),t))}async shutdown(){this.li=!1,this.cs(),this.ki&&(this.ki.cancel(),this.ki=null),this.ls(),this.hs(),await this.Ui.runTransaction("shutdown","readwrite",[dh,ac],e=>{const t=new Iv(e,hr.ce);return this.Zi(t).next(()=>this.ts(t))}),this.Ui.close(),this.Ps()}ss(e,t){return e.filter(r=>this.rs(r.updateTimeMs,t)&&!this.us(r.clientId))}Ts(){return this.runTransaction("getActiveClients","readonly",e=>gf(e).J().next(t=>this.ss(t,Oy).map(r=>r.clientId)))}get started(){return this.li}getGlobalsCache(){return this.hi}getMutationQueue(e,t){return pg.wt(e,this.serializer,t,this.referenceDelegate)}getTargetCache(){return this.Pi}getRemoteDocumentCache(){return this.remoteDocumentCache}getIndexManager(e){return new G6(e,this.serializer.yt.databaseId)}getDocumentOverlayCache(e){return mg.wt(this.serializer,e)}getBundleCache(){return this.Ii}runTransaction(e,t,r){G(Pi,"Starting transaction:",e);const s=t==="readonly"?"readonly":"readwrite",i=function(c){return c===18?J3:c===17?AN:c===16?Y3:c===15?Vw:c===14?TN:c===13?bN:c===12?K3:c===11?EN:void ue(60245)}(this.Ni);let o;return this.Ui.runTransaction(e,s,i,a=>(o=new Iv(a,this.ci?this.ci.next():hr.ce),t==="readwrite-primary"?this.Hi(o).next(c=>!!c||this.Yi(o)).next(c=>{if(!c)throw dn(`Failed to obtain primary lease for action '${e}'.`),this.isPrimary=!1,this.Mi.enqueueRetryable(()=>this.Qi(!1)),new q(M.FAILED_PRECONDITION,mN);return r(o)}).next(c=>this.Xi(o).next(()=>c)):this.Is(o).next(()=>r(o)))).then(a=>(o.raiseOnCommittedEvent(),a))}Is(e){return uu(e).get(sl).next(t=>{if(t!==null&&this.rs(t.leaseTimestampMs,jy)&&!this.us(t.ownerId)&&!this.es(t)&&!(this.Oi||this.allowTabSynchronization&&t.allowTabSynchronization))throw new q(M.FAILED_PRECONDITION,Ly)})}Xi(e){const t={ownerId:this.clientId,allowTabSynchronization:this.allowTabSynchronization,leaseTimestampMs:Date.now()};return uu(e).put(sl,t)}static v(){return Ms.v()}Zi(e){const t=uu(e);return t.get(sl).next(r=>this.es(r)?(G(Pi,"Releasing primary lease."),t.delete(sl)):j.resolve())}rs(e,t){const r=Date.now();return!(e<r-t)&&(!(e>r)||(dn(`Detected an update time that is in the future: ${e} > ${r}`),!1))}Gi(){this.document!==null&&typeof this.document.addEventListener=="function"&&(this.Li=()=>{this.Mi.enqueueAndForget(()=>(this.inForeground=this.document.visibilityState==="visible",this.Wi()))},this.document.addEventListener("visibilitychange",this.Li),this.inForeground=this.document.visibilityState==="visible")}ls(){this.Li&&(this.document.removeEventListener("visibilitychange",this.Li),this.Li=null)}zi(){var e;typeof((e=this.window)==null?void 0:e.addEventListener)=="function"&&(this.Bi=()=>{this.cs();const t=/(?:Version|Mobile)\/1[456]/;bC()&&(navigator.appVersion.match(t)||navigator.userAgent.match(t))&&this.Mi.enterRestrictedMode(!0),this.Mi.enqueueAndForget(()=>this.shutdown())},this.window.addEventListener("pagehide",this.Bi))}hs(){this.Bi&&(this.window.removeEventListener("pagehide",this.Bi),this.Bi=null)}us(e){var t;try{const r=((t=this.Ki)==null?void 0:t.getItem(this._s(e)))!==null;return G(Pi,`Client '${e}' ${r?"is":"is not"} zombied in LocalStorage`),r}catch(r){return dn(Pi,"Failed to get zombied client id.",r),!1}}cs(){if(this.Ki)try{this.Ki.setItem(this._s(this.clientId),String(Date.now()))}catch(e){dn("Failed to set zombie client id.",e)}}Ps(){if(this.Ki)try{this.Ki.removeItem(this._s(this.clientId))}catch{}}_s(e){return`firestore_zombie_${this.persistenceKey}_${e}`}}function uu(n){return bn(n,dh)}function gf(n){return bn(n,ac)}function nx(n,e){let t=n.projectId;return n.isDefaultDatabase||(t+="."+n.database),"firestore/"+e+"/"+t+"/"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class rx{constructor(e,t,r,s){this.targetId=e,this.fromCache=t,this.Es=r,this.ds=s}static As(e,t){let r=Le(),s=Le();for(const i of t.docChanges)switch(i.type){case 0:r=r.add(i.doc.key);break;case 1:s=s.add(i.doc.key)}return new rx(e,t.fromCache,r,s)}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class c5{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(e){this._documentReadCount+=e}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class UR{constructor(){this.Rs=!1,this.Vs=!1,this.fs=100,this.gs=function(){return bC()?8:gN(En())>0?6:4}()}initialize(e,t){this.ps=e,this.indexManager=t,this.Rs=!0}getDocumentsMatchingQuery(e,t,r,s){const i={result:null};return this.ys(e,t).next(o=>{i.result=o}).next(()=>{if(!i.result)return this.ws(e,t,s,r).next(o=>{i.result=o})}).next(()=>{if(i.result)return;const o=new c5;return this.Ss(e,t,o).next(a=>{if(i.result=a,this.Vs)return this.bs(e,t,o,a.size)})}).next(()=>i.result)}bs(e,t,r,s){return r.documentReadCount<this.fs?(dl()<=We.DEBUG&&G("QueryEngine","SDK will not create cache indexes for query:",hl(t),"since it only creates cache indexes for collection contains","more than or equal to",this.fs,"documents"),j.resolve()):(dl()<=We.DEBUG&&G("QueryEngine","Query:",hl(t),"scans",r.documentReadCount,"local documents and returns",s,"documents as results."),r.documentReadCount>this.gs*s?(dl()<=We.DEBUG&&G("QueryEngine","The SDK decides to create cache indexes for query:",hl(t),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(e,nr(t))):j.resolve())}ys(e,t){if(db(t))return j.resolve(null);let r=nr(t);return this.indexManager.getIndexType(e,r).next(s=>s===0?null:(t.limit!==null&&s===1&&(t=Ym(t,null,"F"),r=nr(t)),this.indexManager.getDocumentsMatchingTarget(e,r).next(i=>{const o=Le(...i);return this.ps.getDocuments(e,o).next(a=>this.indexManager.getMinOffset(e,r).next(c=>{const u=this.Ds(t,a);return this.Cs(t,u,o,c.readTime)?this.ys(e,Ym(t,null,"F")):this.vs(e,u,t,c)}))})))}ws(e,t,r,s){return db(t)||s.isEqual(_e.min())?j.resolve(null):this.ps.getDocuments(e,r).next(i=>{const o=this.Ds(t,i);return this.Cs(t,o,r,s)?j.resolve(null):(dl()<=We.DEBUG&&G("QueryEngine","Re-using previous result from %s to execute query: %s",s.toString(),hl(t)),this.vs(e,o,t,hN(s,tc)).next(a=>a))})}Ds(e,t){let r=new mt(JN(e));return t.forEach((s,i)=>{mh(e,i)&&(r=r.add(i))}),r}Cs(e,t,r,s){if(e.limit===null)return!1;if(r.size!==t.size)return!0;const i=e.limitType==="F"?t.last():t.first();return!!i&&(i.hasPendingWrites||i.version.compareTo(s)>0)}Ss(e,t,r){return dl()<=We.DEBUG&&G("QueryEngine","Using full collection scan to execute query:",hl(t)),this.ps.getDocumentsMatchingQuery(e,t,Mr.min(),r)}vs(e,t,r,s){return this.ps.getDocumentsMatchingQuery(e,r,s).next(i=>(t.forEach(o=>{i=i.insert(o.key,o)}),i))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const sx="LocalStore",u5=3e8;class d5{constructor(e,t,r,s){this.persistence=e,this.Fs=t,this.serializer=s,this.Ms=new Rt(Ne),this.xs=new Si(i=>Ea(i),hh),this.Os=new Map,this.Ns=e.getRemoteDocumentCache(),this.Pi=e.getTargetCache(),this.Ii=e.getBundleCache(),this.Bs(r)}Bs(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new FR(this.Ns,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.Ns.setIndexManager(this.indexManager),this.Fs.initialize(this.localDocuments,this.indexManager)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",t=>e.collect(t,this.Ms))}}function BR(n,e,t,r){return new d5(n,e,t,r)}async function zR(n,e){const t=ie(n);return await t.persistence.runTransaction("Handle user change","readonly",r=>{let s;return t.mutationQueue.getAllMutationBatches(r).next(i=>(s=i,t.Bs(e),t.mutationQueue.getAllMutationBatches(r))).next(i=>{const o=[],a=[];let c=Le();for(const u of s){o.push(u.batchId);for(const h of u.mutations)c=c.add(h.key)}for(const u of i){a.push(u.batchId);for(const h of u.mutations)c=c.add(h.key)}return t.localDocuments.getDocuments(r,c).next(u=>({Ls:u,removedBatchIds:o,addedBatchIds:a}))})})}function h5(n,e){const t=ie(n);return t.persistence.runTransaction("Acknowledge batch","readwrite-primary",r=>{const s=e.batch.keys(),i=t.Ns.newChangeBuffer({trackRemovals:!0});return function(a,c,u,h){const f=u.batch,m=f.keys();let y=j.resolve();return m.forEach(w=>{y=y.next(()=>h.getEntry(c,w)).next(S=>{const R=u.docVersions.get(w);me(R!==null,48541),S.version.compareTo(R)<0&&(f.applyToRemoteDocument(S,u),S.isValidDocument()&&(S.setReadTime(u.commitVersion),h.addEntry(S)))})}),y.next(()=>a.mutationQueue.removeMutationBatch(c,f))}(t,r,e,i).next(()=>i.apply(r)).next(()=>t.mutationQueue.performConsistencyCheck(r)).next(()=>t.documentOverlayCache.removeOverlaysForBatchId(r,s,e.batch.batchId)).next(()=>t.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(r,function(a){let c=Le();for(let u=0;u<a.mutationResults.length;++u)a.mutationResults[u].transformResults.length>0&&(c=c.add(a.batch.mutations[u].key));return c}(e))).next(()=>t.localDocuments.getDocuments(r,s))})}function qR(n){const e=ie(n);return e.persistence.runTransaction("Get last remote snapshot version","readonly",t=>e.Pi.getLastRemoteSnapshotVersion(t))}function f5(n,e){const t=ie(n),r=e.snapshotVersion;let s=t.Ms;return t.persistence.runTransaction("Apply remote event","readwrite-primary",i=>{const o=t.Ns.newChangeBuffer({trackRemovals:!0});s=t.Ms;const a=[];e.targetChanges.forEach((h,f)=>{const m=s.get(f);if(!m)return;a.push(t.Pi.removeMatchingKeys(i,h.removedDocuments,f).next(()=>t.Pi.addMatchingKeys(i,h.addedDocuments,f)));let y=m.withSequenceNumber(i.currentSequenceNumber);e.targetMismatches.get(f)!==null?y=y.withResumeToken(an.EMPTY_BYTE_STRING,_e.min()).withLastLimboFreeSnapshotVersion(_e.min()):h.resumeToken.approximateByteSize()>0&&(y=y.withResumeToken(h.resumeToken,r)),s=s.insert(f,y),function(S,R,T){return S.resumeToken.approximateByteSize()===0||R.snapshotVersion.toMicroseconds()-S.snapshotVersion.toMicroseconds()>=u5?!0:T.addedDocuments.size+T.modifiedDocuments.size+T.removedDocuments.size>0}(m,y,h)&&a.push(t.Pi.updateTargetData(i,y))});let c=mr(),u=Le();if(e.documentUpdates.forEach(h=>{e.resolvedLimboDocuments.has(h)&&a.push(t.persistence.referenceDelegate.updateLimboDocument(i,h))}),a.push(WR(i,o,e.documentUpdates).next(h=>{c=h.ks,u=h.qs})),!r.isEqual(_e.min())){const h=t.Pi.getLastRemoteSnapshotVersion(i).next(f=>t.Pi.setTargetsMetadata(i,i.currentSequenceNumber,r));a.push(h)}return j.waitFor(a).next(()=>o.apply(i)).next(()=>t.localDocuments.getLocalViewOfDocuments(i,c,u)).next(()=>c)}).then(i=>(t.Ms=s,i))}function WR(n,e,t){let r=Le(),s=Le();return t.forEach(i=>r=r.add(i)),e.getEntries(n,r).next(i=>{let o=mr();return t.forEach((a,c)=>{const u=i.get(a);c.isFoundDocument()!==u.isFoundDocument()&&(s=s.add(a)),c.isNoDocument()&&c.version.isEqual(_e.min())?(e.removeEntry(a,c.readTime),o=o.insert(a,c)):!u.isValidDocument()||c.version.compareTo(u.version)>0||c.version.compareTo(u.version)===0&&u.hasPendingWrites?(e.addEntry(c),o=o.insert(a,c)):G(sx,"Ignoring outdated watch update for ",a,". Current version:",u.version," Watch version:",c.version)}),{ks:o,qs:s}})}function m5(n,e){const t=ie(n);return t.persistence.runTransaction("Get next mutation batch","readonly",r=>(e===void 0&&(e=uo),t.mutationQueue.getNextMutationBatchAfterBatchId(r,e)))}function mc(n,e){const t=ie(n);return t.persistence.runTransaction("Allocate target","readwrite",r=>{let s;return t.Pi.getTargetData(r,e).next(i=>i?(s=i,j.resolve(s)):t.Pi.allocateTargetId(r).next(o=>(s=new ti(e,o,"TargetPurposeListen",r.currentSequenceNumber),t.Pi.addTargetData(r,s).next(()=>s))))}).then(r=>{const s=t.Ms.get(r.targetId);return(s===null||r.snapshotVersion.compareTo(s.snapshotVersion)>0)&&(t.Ms=t.Ms.insert(r.targetId,r),t.xs.set(e,r.targetId)),r})}async function pc(n,e,t){const r=ie(n),s=r.Ms.get(e),i=t?"readwrite":"readwrite-primary";try{t||await r.persistence.runTransaction("Release target",i,o=>r.persistence.referenceDelegate.removeTarget(o,s))}catch(o){if(!Do(o))throw o;G(sx,`Failed to update sequence numbers for target ${e}: ${o}`)}r.Ms=r.Ms.remove(e),r.xs.delete(s.target)}function tp(n,e,t){const r=ie(n);let s=_e.min(),i=Le();return r.persistence.runTransaction("Execute query","readwrite",o=>function(c,u,h){const f=ie(c),m=f.xs.get(h);return m!==void 0?j.resolve(f.Ms.get(m)):f.Pi.getTargetData(u,h)}(r,o,nr(e)).next(a=>{if(a)return s=a.lastLimboFreeSnapshotVersion,r.Pi.getMatchingKeysForTargetId(o,a.targetId).next(c=>{i=c})}).next(()=>r.Fs.getDocumentsMatchingQuery(o,e,t?s:_e.min(),t?i:Le())).next(a=>(QR(r,YN(e),a),{documents:a,Qs:i})))}function GR(n,e){const t=ie(n),r=ie(t.Pi),s=t.Ms.get(e);return s?Promise.resolve(s.target):t.persistence.runTransaction("Get target data","readonly",i=>r.At(i,e).next(o=>o?o.target:null))}function HR(n,e){const t=ie(n),r=t.Os.get(e)||_e.min();return t.persistence.runTransaction("Get new document changes","readonly",s=>t.Ns.getAllFromCollectionGroup(s,e,hN(r,tc),Number.MAX_SAFE_INTEGER)).then(s=>(QR(t,e,s),s))}function QR(n,e,t){let r=n.Os.get(e)||_e.min();t.forEach((s,i)=>{i.readTime.compareTo(r)>0&&(r=i.readTime)}),n.Os.set(e,r)}async function p5(n,e,t,r){const s=ie(n);let i=Le(),o=mr();for(const u of t){const h=e.$s(u.metadata.name);u.document&&(i=i.add(h));const f=e.Us(u);f.setReadTime(e.Ks(u.metadata.readTime)),o=o.insert(h,f)}const a=s.Ns.newChangeBuffer({trackRemovals:!0}),c=await mc(s,function(h){return nr(Nc(ze.fromString(`__bundle__/docs/${h}`)))}(r));return s.persistence.runTransaction("Apply bundle documents","readwrite",u=>WR(u,a,o).next(h=>(a.apply(u),h)).next(h=>s.Pi.removeMatchingKeysForTargetId(u,c.targetId).next(()=>s.Pi.addMatchingKeys(u,i,c.targetId)).next(()=>s.localDocuments.getLocalViewOfDocuments(u,h.ks,h.qs)).next(()=>h.ks)))}async function g5(n,e,t=Le()){const r=await mc(n,nr(fg(e.bundledQuery))),s=ie(n);return s.persistence.runTransaction("Save named query","readwrite",i=>{const o=hn(e.readTime);if(r.snapshotVersion.compareTo(o)>=0)return s.Ii.saveNamedQuery(i,e);const a=r.withResumeToken(an.EMPTY_BYTE_STRING,o);return s.Ms=s.Ms.insert(a.targetId,a),s.Pi.updateTargetData(i,a).next(()=>s.Pi.removeMatchingKeysForTargetId(i,r.targetId)).next(()=>s.Pi.addMatchingKeys(i,t,r.targetId)).next(()=>s.Ii.saveNamedQuery(i,e))})}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const KR="firestore_clients";function Bb(n,e){return`${KR}_${n}_${e}`}const YR="firestore_mutations";function zb(n,e,t){let r=`${YR}_${n}_${t}`;return e.isAuthenticated()&&(r+=`_${e.uid}`),r}const JR="firestore_targets";function My(n,e){return`${JR}_${n}_${e}`}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const bs="SharedClientState";class np{constructor(e,t,r,s){this.user=e,this.batchId=t,this.state=r,this.error=s}static Ws(e,t,r){const s=JSON.parse(r);let i,o=typeof s=="object"&&["pending","acknowledged","rejected"].indexOf(s.state)!==-1&&(s.error===void 0||typeof s.error=="object");return o&&s.error&&(o=typeof s.error.message=="string"&&typeof s.error.code=="string",o&&(i=new q(s.error.code,s.error.message))),o?new np(e,t,s.state,i):(dn(bs,`Failed to parse mutation state for ID '${t}': ${r}`),null)}Gs(){const e={state:this.state,updateTimeMs:Date.now()};return this.error&&(e.error={code:this.error.code,message:this.error.message}),JSON.stringify(e)}}class Hu{constructor(e,t,r){this.targetId=e,this.state=t,this.error=r}static Ws(e,t){const r=JSON.parse(t);let s,i=typeof r=="object"&&["not-current","current","rejected"].indexOf(r.state)!==-1&&(r.error===void 0||typeof r.error=="object");return i&&r.error&&(i=typeof r.error.message=="string"&&typeof r.error.code=="string",i&&(s=new q(r.error.code,r.error.message))),i?new Hu(e,r.state,s):(dn(bs,`Failed to parse target state for ID '${e}': ${t}`),null)}Gs(){const e={state:this.state,updateTimeMs:Date.now()};return this.error&&(e.error={code:this.error.code,message:this.error.message}),JSON.stringify(e)}}class rp{constructor(e,t){this.clientId=e,this.activeTargetIds=t}static Ws(e,t){const r=JSON.parse(t);let s=typeof r=="object"&&r.activeTargetIds instanceof Array,i=zw();for(let o=0;s&&o<r.activeTargetIds.length;++o)s=yN(r.activeTargetIds[o]),i=i.add(r.activeTargetIds[o]);return s?new rp(e,i):(dn(bs,`Failed to parse client data for instance '${e}': ${t}`),null)}}class ix{constructor(e,t){this.clientId=e,this.onlineState=t}static Ws(e){const t=JSON.parse(e);return typeof t=="object"&&["Unknown","Online","Offline"].indexOf(t.onlineState)!==-1&&typeof t.clientId=="string"?new ix(t.clientId,t.onlineState):(dn(bs,`Failed to parse online state: ${e}`),null)}}class Mv{constructor(){this.activeTargetIds=zw()}zs(e){this.activeTargetIds=this.activeTargetIds.add(e)}js(e){this.activeTargetIds=this.activeTargetIds.delete(e)}Gs(){const e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}}class Vy{constructor(e,t,r,s,i){this.window=e,this.Mi=t,this.persistenceKey=r,this.Js=s,this.syncEngine=null,this.onlineStateHandler=null,this.sequenceNumberHandler=null,this.Hs=this.Ys.bind(this),this.Zs=new Rt(Ne),this.started=!1,this.Xs=[];const o=r.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");this.storage=this.window.localStorage,this.currentUser=i,this.eo=Bb(this.persistenceKey,this.Js),this.no=function(c){return`firestore_sequence_number_${c}`}(this.persistenceKey),this.Zs=this.Zs.insert(this.Js,new Mv),this.ro=new RegExp(`^${KR}_${o}_([^_]*)$`),this.io=new RegExp(`^${YR}_${o}_(\\d+)(?:_(.*))?$`),this.so=new RegExp(`^${JR}_${o}_(\\d+)$`),this.oo=function(c){return`firestore_online_state_${c}`}(this.persistenceKey),this._o=function(c){return`firestore_bundle_loaded_v2_${c}`}(this.persistenceKey),this.window.addEventListener("storage",this.Hs)}static v(e){return!(!e||!e.localStorage)}async start(){const e=await this.syncEngine.Ts();for(const r of e){if(r===this.Js)continue;const s=this.getItem(Bb(this.persistenceKey,r));if(s){const i=rp.Ws(r,s);i&&(this.Zs=this.Zs.insert(i.clientId,i))}}this.ao();const t=this.storage.getItem(this.oo);if(t){const r=this.uo(t);r&&this.co(r)}for(const r of this.Xs)this.Ys(r);this.Xs=[],this.window.addEventListener("pagehide",()=>this.shutdown()),this.started=!0}writeSequenceNumber(e){this.setItem(this.no,JSON.stringify(e))}getAllActiveQueryTargets(){return this.lo(this.Zs)}isActiveQueryTarget(e){let t=!1;return this.Zs.forEach((r,s)=>{s.activeTargetIds.has(e)&&(t=!0)}),t}addPendingMutation(e){this.ho(e,"pending")}updateMutationState(e,t,r){this.ho(e,t,r),this.Po(e)}addLocalQueryTarget(e,t=!0){let r="not-current";if(this.isActiveQueryTarget(e)){const s=this.storage.getItem(My(this.persistenceKey,e));if(s){const i=Hu.Ws(e,s);i&&(r=i.state)}}return t&&this.To.zs(e),this.ao(),r}removeLocalQueryTarget(e){this.To.js(e),this.ao()}isLocalQueryTarget(e){return this.To.activeTargetIds.has(e)}clearQueryState(e){this.removeItem(My(this.persistenceKey,e))}updateQueryState(e,t,r){this.Io(e,t,r)}handleUserChange(e,t,r){t.forEach(s=>{this.Po(s)}),this.currentUser=e,r.forEach(s=>{this.addPendingMutation(s)})}setOnlineState(e){this.Eo(e)}notifyBundleLoaded(e){this.Ao(e)}shutdown(){this.started&&(this.window.removeEventListener("storage",this.Hs),this.removeItem(this.eo),this.started=!1)}getItem(e){const t=this.storage.getItem(e);return G(bs,"READ",e,t),t}setItem(e,t){G(bs,"SET",e,t),this.storage.setItem(e,t)}removeItem(e){G(bs,"REMOVE",e),this.storage.removeItem(e)}Ys(e){const t=e;if(t.storageArea===this.storage){if(G(bs,"EVENT",t.key,t.newValue),t.key===this.eo)return void dn("Received WebStorage notification for local change. Another client might have garbage-collected our state");this.Mi.enqueueRetryable(async()=>{if(this.started){if(t.key!==null){if(this.ro.test(t.key)){if(t.newValue==null){const r=this.Ro(t.key);return this.Vo(r,null)}{const r=this.mo(t.key,t.newValue);if(r)return this.Vo(r.clientId,r)}}else if(this.io.test(t.key)){if(t.newValue!==null){const r=this.fo(t.key,t.newValue);if(r)return this.po(r)}}else if(this.so.test(t.key)){if(t.newValue!==null){const r=this.yo(t.key,t.newValue);if(r)return this.wo(r)}}else if(t.key===this.oo){if(t.newValue!==null){const r=this.uo(t.newValue);if(r)return this.co(r)}}else if(t.key===this.no){const r=function(i){let o=hr.ce;if(i!=null)try{const a=JSON.parse(i);me(typeof a=="number",30636,{So:i}),o=a}catch(a){dn(bs,"Failed to read sequence number from WebStorage",a)}return o}(t.newValue);r!==hr.ce&&this.sequenceNumberHandler(r)}else if(t.key===this._o){const r=this.bo(t.newValue);await Promise.all(r.map(s=>this.syncEngine.Do(s)))}}}else this.Xs.push(t)})}}get To(){return this.Zs.get(this.Js)}ao(){this.setItem(this.eo,this.To.Gs())}ho(e,t,r){const s=new np(this.currentUser,e,t,r),i=zb(this.persistenceKey,this.currentUser,e);this.setItem(i,s.Gs())}Po(e){const t=zb(this.persistenceKey,this.currentUser,e);this.removeItem(t)}Eo(e){const t={clientId:this.Js,onlineState:e};this.storage.setItem(this.oo,JSON.stringify(t))}Io(e,t,r){const s=My(this.persistenceKey,e),i=new Hu(e,t,r);this.setItem(s,i.Gs())}Ao(e){const t=JSON.stringify(Array.from(e));this.setItem(this._o,t)}Ro(e){const t=this.ro.exec(e);return t?t[1]:null}mo(e,t){const r=this.Ro(e);return rp.Ws(r,t)}fo(e,t){const r=this.io.exec(e),s=Number(r[1]),i=r[2]!==void 0?r[2]:null;return np.Ws(new Rn(i),s,t)}yo(e,t){const r=this.so.exec(e),s=Number(r[1]);return Hu.Ws(s,t)}uo(e){return ix.Ws(e)}bo(e){return JSON.parse(e)}async po(e){if(e.user.uid===this.currentUser.uid)return this.syncEngine.Co(e.batchId,e.state,e.error);G(bs,`Ignoring mutation for non-active user ${e.user.uid}`)}wo(e){return this.syncEngine.vo(e.targetId,e.state,e.error)}Vo(e,t){const r=t?this.Zs.insert(e,t):this.Zs.remove(e),s=this.lo(this.Zs),i=this.lo(r),o=[],a=[];return i.forEach(c=>{s.has(c)||o.push(c)}),s.forEach(c=>{i.has(c)||a.push(c)}),this.syncEngine.Fo(o,a).then(()=>{this.Zs=r})}co(e){this.Zs.get(e.clientId)&&this.onlineStateHandler(e.onlineState)}lo(e){let t=zw();return e.forEach((r,s)=>{t=t.unionWith(s.activeTargetIds)}),t}}class XR{constructor(){this.Mo=new Mv,this.xo={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,t,r){}addLocalQueryTarget(e,t=!0){return t&&this.Mo.zs(e),this.xo[e]||"not-current"}updateQueryState(e,t,r){this.xo[e]=t}removeLocalQueryTarget(e){this.Mo.js(e)}isLocalQueryTarget(e){return this.Mo.activeTargetIds.has(e)}clearQueryState(e){delete this.xo[e]}getAllActiveQueryTargets(){return this.Mo.activeTargetIds}isActiveQueryTarget(e){return this.Mo.activeTargetIds.has(e)}start(){return this.Mo=new Mv,Promise.resolve()}handleUserChange(e,t,r){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class y5{Oo(e){}shutdown(){}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const qb="ConnectivityMonitor";class Wb{constructor(){this.No=()=>this.Bo(),this.Lo=()=>this.ko(),this.qo=[],this.Qo()}Oo(e){this.qo.push(e)}shutdown(){window.removeEventListener("online",this.No),window.removeEventListener("offline",this.Lo)}Qo(){window.addEventListener("online",this.No),window.addEventListener("offline",this.Lo)}Bo(){G(qb,"Network connectivity changed: AVAILABLE");for(const e of this.qo)e(0)}ko(){G(qb,"Network connectivity changed: UNAVAILABLE");for(const e of this.qo)e(1)}static v(){return typeof window<"u"&&window.addEventListener!==void 0&&window.removeEventListener!==void 0}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let yf=null;function Vv(){return yf===null?yf=function(){return 268435456+Math.round(2147483648*Math.random())}():yf++,"0x"+yf.toString(16)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Fy="RestConnection",_5={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};class v5{get $o(){return!1}constructor(e){this.databaseInfo=e,this.databaseId=e.databaseId;const t=e.ssl?"https":"http",r=encodeURIComponent(this.databaseId.projectId),s=encodeURIComponent(this.databaseId.database);this.Uo=t+"://"+e.host,this.Ko=`projects/${r}/databases/${s}`,this.Wo=this.databaseId.database===Dd?`project_id=${r}`:`project_id=${r}&database_id=${s}`}Go(e,t,r,s,i){const o=Vv(),a=this.zo(e,t.toUriEncodedString());G(Fy,`Sending RPC '${e}' ${o}:`,a,r);const c={"google-cloud-resource-prefix":this.Ko,"x-goog-request-params":this.Wo};this.jo(c,s,i);const{host:u}=new URL(a),h=wi(u);return this.Jo(e,a,c,r,h).then(f=>(G(Fy,`Received RPC '${e}' ${o}: `,f),f),f=>{throw Xr(Fy,`RPC '${e}' ${o} failed with error: `,f,"url: ",a,"request:",r),f})}Ho(e,t,r,s,i,o){return this.Go(e,t,r,s,i)}jo(e,t,r){e["X-Goog-Api-Client"]=function(){return"gl-js/ fire/"+kc}(),e["Content-Type"]="text/plain",this.databaseInfo.appId&&(e["X-Firebase-GMPID"]=this.databaseInfo.appId),t&&t.headers.forEach((s,i)=>e[i]=s),r&&r.headers.forEach((s,i)=>e[i]=s)}zo(e,t){const r=_5[e];return`${this.Uo}/v1/${t}:${r}`}terminate(){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class w5{constructor(e){this.Yo=e.Yo,this.Zo=e.Zo}Xo(e){this.e_=e}t_(e){this.n_=e}r_(e){this.i_=e}onMessage(e){this.s_=e}close(){this.Zo()}send(e){this.Yo(e)}o_(){this.e_()}__(){this.n_()}a_(e){this.i_(e)}u_(e){this.s_(e)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Jn="WebChannelConnection";class x5 extends v5{constructor(e){super(e),this.c_=[],this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams,this.longPollingOptions=e.longPollingOptions}Jo(e,t,r,s,i){const o=Vv();return new Promise((a,c)=>{const u=new nN;u.setWithCredentials(!0),u.listenOnce(rN.COMPLETE,()=>{try{switch(u.getLastErrorCode()){case Uf.NO_ERROR:const f=u.getResponseJson();G(Jn,`XHR for RPC '${e}' ${o} received:`,JSON.stringify(f)),a(f);break;case Uf.TIMEOUT:G(Jn,`RPC '${e}' ${o} timed out`),c(new q(M.DEADLINE_EXCEEDED,"Request time out"));break;case Uf.HTTP_ERROR:const m=u.getStatus();if(G(Jn,`RPC '${e}' ${o} failed with status:`,m,"response text:",u.getResponseText()),m>0){let y=u.getResponseJson();Array.isArray(y)&&(y=y[0]);const w=y==null?void 0:y.error;if(w&&w.status&&w.message){const S=function(T){const I=T.toLowerCase().replace(/_/g,"-");return Object.values(M).indexOf(I)>=0?I:M.UNKNOWN}(w.status);c(new q(S,w.message))}else c(new q(M.UNKNOWN,"Server responded with status "+u.getStatus()))}else c(new q(M.UNAVAILABLE,"Connection failed."));break;default:ue(9055,{l_:e,streamId:o,h_:u.getLastErrorCode(),P_:u.getLastError()})}}finally{G(Jn,`RPC '${e}' ${o} completed.`)}});const h=JSON.stringify(s);G(Jn,`RPC '${e}' ${o} sending request:`,s),u.send(t,"POST",h,r,15)})}T_(e,t,r){const s=Vv(),i=[this.Uo,"/","google.firestore.v1.Firestore","/",e,"/channel"],o=oN(),a=iN(),c={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},u=this.longPollingOptions.timeoutSeconds;u!==void 0&&(c.longPollingTimeout=Math.round(1e3*u)),this.useFetchStreams&&(c.useFetchStreams=!0),this.jo(c.initMessageHeaders,t,r),c.encodeInitMessageHeaders=!0;const h=i.join("");G(Jn,`Creating RPC '${e}' stream ${s}: ${h}`,c);const f=o.createWebChannel(h,c);this.I_(f);let m=!1,y=!1;const w=new w5({Yo:R=>{y?G(Jn,`Not sending because RPC '${e}' stream ${s} is closed:`,R):(m||(G(Jn,`Opening RPC '${e}' stream ${s} transport.`),f.open(),m=!0),G(Jn,`RPC '${e}' stream ${s} sending:`,R),f.send(R))},Zo:()=>f.close()}),S=(R,T,I)=>{R.listen(T,N=>{try{I(N)}catch(P){setTimeout(()=>{throw P},0)}})};return S(f,wu.EventType.OPEN,()=>{y||(G(Jn,`RPC '${e}' stream ${s} transport opened.`),w.o_())}),S(f,wu.EventType.CLOSE,()=>{y||(y=!0,G(Jn,`RPC '${e}' stream ${s} transport closed`),w.a_(),this.E_(f))}),S(f,wu.EventType.ERROR,R=>{y||(y=!0,Xr(Jn,`RPC '${e}' stream ${s} transport errored. Name:`,R.name,"Message:",R.message),w.a_(new q(M.UNAVAILABLE,"The operation could not be completed")))}),S(f,wu.EventType.MESSAGE,R=>{var T;if(!y){const I=R.data[0];me(!!I,16349);const N=I,P=(N==null?void 0:N.error)||((T=N[0])==null?void 0:T.error);if(P){G(Jn,`RPC '${e}' stream ${s} received error:`,P);const B=P.status;let F=function(E){const k=gn[E];if(k!==void 0)return dR(k)}(B),A=P.message;F===void 0&&(F=M.INTERNAL,A="Unknown error status: "+B+" with message "+P.message),y=!0,w.a_(new q(F,A)),f.close()}else G(Jn,`RPC '${e}' stream ${s} received:`,I),w.u_(I)}}),S(a,sN.STAT_EVENT,R=>{R.stat===pv.PROXY?G(Jn,`RPC '${e}' stream ${s} detected buffering proxy`):R.stat===pv.NOPROXY&&G(Jn,`RPC '${e}' stream ${s} detected no buffering proxy`)}),setTimeout(()=>{w.__()},0),w}terminate(){this.c_.forEach(e=>e.close()),this.c_=[]}I_(e){this.c_.push(e)}E_(e){this.c_=this.c_.filter(t=>t===e)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ZR(){return typeof window<"u"?window:null}function Yf(){return typeof document<"u"?document:null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function za(n){return new A6(n,!0)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ox{constructor(e,t,r=1e3,s=1.5,i=6e4){this.Mi=e,this.timerId=t,this.d_=r,this.A_=s,this.R_=i,this.V_=0,this.m_=null,this.f_=Date.now(),this.reset()}reset(){this.V_=0}g_(){this.V_=this.R_}p_(e){this.cancel();const t=Math.floor(this.V_+this.y_()),r=Math.max(0,Date.now()-this.f_),s=Math.max(0,t-r);s>0&&G("ExponentialBackoff",`Backing off for ${s} ms (base delay: ${this.V_} ms, delay with jitter: ${t} ms, last attempt: ${r} ms ago)`),this.m_=this.Mi.enqueueAfterDelay(this.timerId,s,()=>(this.f_=Date.now(),e())),this.V_*=this.A_,this.V_<this.d_&&(this.V_=this.d_),this.V_>this.R_&&(this.V_=this.R_)}w_(){this.m_!==null&&(this.m_.skipDelay(),this.m_=null)}cancel(){this.m_!==null&&(this.m_.cancel(),this.m_=null)}y_(){return(Math.random()-.5)*this.V_}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Gb="PersistentStream";class eD{constructor(e,t,r,s,i,o,a,c){this.Mi=e,this.S_=r,this.b_=s,this.connection=i,this.authCredentialsProvider=o,this.appCheckCredentialsProvider=a,this.listener=c,this.state=0,this.D_=0,this.C_=null,this.v_=null,this.stream=null,this.F_=0,this.M_=new ox(e,t)}x_(){return this.state===1||this.state===5||this.O_()}O_(){return this.state===2||this.state===3}start(){this.F_=0,this.state!==4?this.auth():this.N_()}async stop(){this.x_()&&await this.close(0)}B_(){this.state=0,this.M_.reset()}L_(){this.O_()&&this.C_===null&&(this.C_=this.Mi.enqueueAfterDelay(this.S_,6e4,()=>this.k_()))}q_(e){this.Q_(),this.stream.send(e)}async k_(){if(this.O_())return this.close(0)}Q_(){this.C_&&(this.C_.cancel(),this.C_=null)}U_(){this.v_&&(this.v_.cancel(),this.v_=null)}async close(e,t){this.Q_(),this.U_(),this.M_.cancel(),this.D_++,e!==4?this.M_.reset():t&&t.code===M.RESOURCE_EXHAUSTED?(dn(t.toString()),dn("Using maximum backoff delay to prevent overloading the backend."),this.M_.g_()):t&&t.code===M.UNAUTHENTICATED&&this.state!==3&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),this.stream!==null&&(this.K_(),this.stream.close(),this.stream=null),this.state=e,await this.listener.r_(t)}K_(){}auth(){this.state=1;const e=this.W_(this.D_),t=this.D_;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then(([r,s])=>{this.D_===t&&this.G_(r,s)},r=>{e(()=>{const s=new q(M.UNKNOWN,"Fetching auth token failed: "+r.message);return this.z_(s)})})}G_(e,t){const r=this.W_(this.D_);this.stream=this.j_(e,t),this.stream.Xo(()=>{r(()=>this.listener.Xo())}),this.stream.t_(()=>{r(()=>(this.state=2,this.v_=this.Mi.enqueueAfterDelay(this.b_,1e4,()=>(this.O_()&&(this.state=3),Promise.resolve())),this.listener.t_()))}),this.stream.r_(s=>{r(()=>this.z_(s))}),this.stream.onMessage(s=>{r(()=>++this.F_==1?this.J_(s):this.onNext(s))})}N_(){this.state=5,this.M_.p_(async()=>{this.state=0,this.start()})}z_(e){return G(Gb,`close with error: ${e}`),this.stream=null,this.close(4,e)}W_(e){return t=>{this.Mi.enqueueAndForget(()=>this.D_===e?t():(G(Gb,"stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve()))}}}class S5 extends eD{constructor(e,t,r,s,i,o){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",t,r,s,o),this.serializer=i}j_(e,t){return this.connection.T_("Listen",e,t)}J_(e){return this.onNext(e)}onNext(e){this.M_.reset();const t=N6(this.serializer,e),r=function(i){if(!("targetChange"in i))return _e.min();const o=i.targetChange;return o.targetIds&&o.targetIds.length?_e.min():o.readTime?hn(o.readTime):_e.min()}(e);return this.listener.H_(t,r)}Y_(e){const t={};t.database=Dv(this.serializer),t.addTarget=function(i,o){let a;const c=o.target;if(a=Qm(c)?{documents:wR(i,c)}:{query:hg(i,c).ft},a.targetId=o.targetId,o.resumeToken.approximateByteSize()>0){a.resumeToken=pR(i,o.resumeToken);const u=Nv(i,o.expectedCount);u!==null&&(a.expectedCount=u)}else if(o.snapshotVersion.compareTo(_e.min())>0){a.readTime=fc(i,o.snapshotVersion.toTimestamp());const u=Nv(i,o.expectedCount);u!==null&&(a.expectedCount=u)}return a}(this.serializer,e);const r=D6(this.serializer,e);r&&(t.labels=r),this.q_(t)}Z_(e){const t={};t.database=Dv(this.serializer),t.removeTarget=e,this.q_(t)}}class I5 extends eD{constructor(e,t,r,s,i,o){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",t,r,s,o),this.serializer=i}get X_(){return this.F_>0}start(){this.lastStreamToken=void 0,super.start()}K_(){this.X_&&this.ea([])}j_(e,t){return this.connection.T_("Write",e,t)}J_(e){return me(!!e.streamToken,31322),this.lastStreamToken=e.streamToken,me(!e.writeResults||e.writeResults.length===0,55816),this.listener.ta()}onNext(e){me(!!e.streamToken,12678),this.lastStreamToken=e.streamToken,this.M_.reset();const t=R6(e.writeResults,e.commitTime),r=hn(e.commitTime);return this.listener.na(r,t)}ra(){const e={};e.database=Dv(this.serializer),this.q_(e)}ea(e){const t={streamToken:this.lastStreamToken,writes:e.map(r=>Md(this.serializer,r))};this.q_(t)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class E5{}class b5 extends E5{constructor(e,t,r,s){super(),this.authCredentials=e,this.appCheckCredentials=t,this.connection=r,this.serializer=s,this.ia=!1}sa(){if(this.ia)throw new q(M.FAILED_PRECONDITION,"The client has already been terminated.")}Go(e,t,r,s){return this.sa(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([i,o])=>this.connection.Go(e,Rv(t,r),s,i,o)).catch(i=>{throw i.name==="FirebaseError"?(i.code===M.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),i):new q(M.UNKNOWN,i.toString())})}Ho(e,t,r,s,i){return this.sa(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([o,a])=>this.connection.Ho(e,Rv(t,r),s,o,a,i)).catch(o=>{throw o.name==="FirebaseError"?(o.code===M.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),o):new q(M.UNKNOWN,o.toString())})}terminate(){this.ia=!0,this.connection.terminate()}}class T5{constructor(e,t){this.asyncQueue=e,this.onlineStateHandler=t,this.state="Unknown",this.oa=0,this._a=null,this.aa=!0}ua(){this.oa===0&&(this.ca("Unknown"),this._a=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,()=>(this._a=null,this.la("Backend didn't respond within 10 seconds."),this.ca("Offline"),Promise.resolve())))}ha(e){this.state==="Online"?this.ca("Unknown"):(this.oa++,this.oa>=1&&(this.Pa(),this.la(`Connection failed 1 times. Most recent error: ${e.toString()}`),this.ca("Offline")))}set(e){this.Pa(),this.oa=0,e==="Online"&&(this.aa=!1),this.ca(e)}ca(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}la(e){const t=`Could not reach Cloud Firestore backend. ${e}
This typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.aa?(dn(t),this.aa=!1):G("OnlineStateTracker",t)}Pa(){this._a!==null&&(this._a.cancel(),this._a=null)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Na="RemoteStore";class A5{constructor(e,t,r,s,i){this.localStore=e,this.datastore=t,this.asyncQueue=r,this.remoteSyncer={},this.Ta=[],this.Ia=new Map,this.Ea=new Set,this.da=[],this.Aa=i,this.Aa.Oo(o=>{r.enqueueAndForget(async()=>{Oo(this)&&(G(Na,"Restarting streams for network reachability change."),await async function(c){const u=ie(c);u.Ea.add(4),await Pc(u),u.Ra.set("Unknown"),u.Ea.delete(4),await _h(u)}(this))})}),this.Ra=new T5(r,s)}}async function _h(n){if(Oo(n))for(const e of n.da)await e(!0)}async function Pc(n){for(const e of n.da)await e(!1)}function yg(n,e){const t=ie(n);t.Ia.has(e.targetId)||(t.Ia.set(e.targetId,e),cx(t)?lx(t):jc(t).O_()&&ax(t,e))}function gc(n,e){const t=ie(n),r=jc(t);t.Ia.delete(e),r.O_()&&tD(t,e),t.Ia.size===0&&(r.O_()?r.L_():Oo(t)&&t.Ra.set("Unknown"))}function ax(n,e){if(n.Va.Ue(e.targetId),e.resumeToken.approximateByteSize()>0||e.snapshotVersion.compareTo(_e.min())>0){const t=n.remoteSyncer.getRemoteKeysForTarget(e.targetId).size;e=e.withExpectedCount(t)}jc(n).Y_(e)}function tD(n,e){n.Va.Ue(e),jc(n).Z_(e)}function lx(n){n.Va=new I6({getRemoteKeysForTarget:e=>n.remoteSyncer.getRemoteKeysForTarget(e),At:e=>n.Ia.get(e)||null,ht:()=>n.datastore.serializer.databaseId}),jc(n).start(),n.Ra.ua()}function cx(n){return Oo(n)&&!jc(n).x_()&&n.Ia.size>0}function Oo(n){return ie(n).Ea.size===0}function nD(n){n.Va=void 0}async function C5(n){n.Ra.set("Online")}async function k5(n){n.Ia.forEach((e,t)=>{ax(n,e)})}async function N5(n,e){nD(n),cx(n)?(n.Ra.ha(e),lx(n)):n.Ra.set("Unknown")}async function R5(n,e,t){if(n.Ra.set("Online"),e instanceof mR&&e.state===2&&e.cause)try{await async function(s,i){const o=i.cause;for(const a of i.targetIds)s.Ia.has(a)&&(await s.remoteSyncer.rejectListen(a,o),s.Ia.delete(a),s.Va.removeTarget(a))}(n,e)}catch(r){G(Na,"Failed to remove targets %s: %s ",e.targetIds.join(","),r),await sp(n,r)}else if(e instanceof Qf?n.Va.Ze(e):e instanceof fR?n.Va.st(e):n.Va.tt(e),!t.isEqual(_e.min()))try{const r=await qR(n.localStore);t.compareTo(r)>=0&&await function(i,o){const a=i.Va.Tt(o);return a.targetChanges.forEach((c,u)=>{if(c.resumeToken.approximateByteSize()>0){const h=i.Ia.get(u);h&&i.Ia.set(u,h.withResumeToken(c.resumeToken,o))}}),a.targetMismatches.forEach((c,u)=>{const h=i.Ia.get(c);if(!h)return;i.Ia.set(c,h.withResumeToken(an.EMPTY_BYTE_STRING,h.snapshotVersion)),tD(i,c);const f=new ti(h.target,c,u,h.sequenceNumber);ax(i,f)}),i.remoteSyncer.applyRemoteEvent(a)}(n,t)}catch(r){G(Na,"Failed to raise snapshot:",r),await sp(n,r)}}async function sp(n,e,t){if(!Do(e))throw e;n.Ea.add(1),await Pc(n),n.Ra.set("Offline"),t||(t=()=>qR(n.localStore)),n.asyncQueue.enqueueRetryable(async()=>{G(Na,"Retrying IndexedDB access"),await t(),n.Ea.delete(1),await _h(n)})}function rD(n,e){return e().catch(t=>sp(n,t,e))}async function Oc(n){const e=ie(n),t=Eo(e);let r=e.Ta.length>0?e.Ta[e.Ta.length-1].batchId:uo;for(;D5(e);)try{const s=await m5(e.localStore,r);if(s===null){e.Ta.length===0&&t.L_();break}r=s.batchId,P5(e,s)}catch(s){await sp(e,s)}sD(e)&&iD(e)}function D5(n){return Oo(n)&&n.Ta.length<10}function P5(n,e){n.Ta.push(e);const t=Eo(n);t.O_()&&t.X_&&t.ea(e.mutations)}function sD(n){return Oo(n)&&!Eo(n).x_()&&n.Ta.length>0}function iD(n){Eo(n).start()}async function O5(n){Eo(n).ra()}async function j5(n){const e=Eo(n);for(const t of n.Ta)e.ea(t.mutations)}async function L5(n,e,t){const r=n.Ta.shift(),s=Hw.from(r,e,t);await rD(n,()=>n.remoteSyncer.applySuccessfulWrite(s)),await Oc(n)}async function M5(n,e){e&&Eo(n).X_&&await async function(r,s){if(function(o){return uR(o)&&o!==M.ABORTED}(s.code)){const i=r.Ta.shift();Eo(r).B_(),await rD(r,()=>r.remoteSyncer.rejectFailedWrite(i.batchId,s)),await Oc(r)}}(n,e),sD(n)&&iD(n)}async function Hb(n,e){const t=ie(n);t.asyncQueue.verifyOperationInProgress(),G(Na,"RemoteStore received new credentials");const r=Oo(t);t.Ea.add(3),await Pc(t),r&&t.Ra.set("Unknown"),await t.remoteSyncer.handleCredentialChange(e),t.Ea.delete(3),await _h(t)}async function Fv(n,e){const t=ie(n);e?(t.Ea.delete(2),await _h(t)):e||(t.Ea.add(2),await Pc(t),t.Ra.set("Unknown"))}function jc(n){return n.ma||(n.ma=function(t,r,s){const i=ie(t);return i.sa(),new S5(r,i.connection,i.authCredentials,i.appCheckCredentials,i.serializer,s)}(n.datastore,n.asyncQueue,{Xo:C5.bind(null,n),t_:k5.bind(null,n),r_:N5.bind(null,n),H_:R5.bind(null,n)}),n.da.push(async e=>{e?(n.ma.B_(),cx(n)?lx(n):n.Ra.set("Unknown")):(await n.ma.stop(),nD(n))})),n.ma}function Eo(n){return n.fa||(n.fa=function(t,r,s){const i=ie(t);return i.sa(),new I5(r,i.connection,i.authCredentials,i.appCheckCredentials,i.serializer,s)}(n.datastore,n.asyncQueue,{Xo:()=>Promise.resolve(),t_:O5.bind(null,n),r_:M5.bind(null,n),ta:j5.bind(null,n),na:L5.bind(null,n)}),n.da.push(async e=>{e?(n.fa.B_(),await Oc(n)):(await n.fa.stop(),n.Ta.length>0&&(G(Na,`Stopping write stream with ${n.Ta.length} pending writes`),n.Ta=[]))})),n.fa}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ux{constructor(e,t,r,s,i){this.asyncQueue=e,this.timerId=t,this.targetTimeMs=r,this.op=s,this.removalCallback=i,this.deferred=new On,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(o=>{})}get promise(){return this.deferred.promise}static createAndSchedule(e,t,r,s,i){const o=Date.now()+r,a=new ux(e,t,o,s,i);return a.start(r),a}start(e){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){this.timerHandle!==null&&(this.clearTimeout(),this.deferred.reject(new q(M.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>this.timerHandle!==null?(this.clearTimeout(),this.op().then(e=>this.deferred.resolve(e))):Promise.resolve())}clearTimeout(){this.timerHandle!==null&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function Lc(n,e){if(dn("AsyncQueue",`${e}: ${n}`),Do(n))return new q(M.UNAVAILABLE,`${e}: ${n}`);throw n}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ua{static emptySet(e){return new ua(e.comparator)}constructor(e){this.comparator=e?(t,r)=>e(t,r)||se.comparator(t.key,r.key):(t,r)=>se.comparator(t.key,r.key),this.keyedMap=xu(),this.sortedSet=new Rt(this.comparator)}has(e){return this.keyedMap.get(e)!=null}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){const t=this.keyedMap.get(e);return t?this.sortedSet.indexOf(t):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal((t,r)=>(e(t),!1))}add(e){const t=this.delete(e.key);return t.copy(t.keyedMap.insert(e.key,e),t.sortedSet.insert(e,null))}delete(e){const t=this.get(e);return t?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(t)):this}isEqual(e){if(!(e instanceof ua)||this.size!==e.size)return!1;const t=this.sortedSet.getIterator(),r=e.sortedSet.getIterator();for(;t.hasNext();){const s=t.getNext().key,i=r.getNext().key;if(!s.isEqual(i))return!1}return!0}toString(){const e=[];return this.forEach(t=>{e.push(t.toString())}),e.length===0?"DocumentSet ()":`DocumentSet (
  `+e.join(`  
`)+`
)`}copy(e,t){const r=new ua;return r.comparator=this.comparator,r.keyedMap=e,r.sortedSet=t,r}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Qb{constructor(){this.ga=new Rt(se.comparator)}track(e){const t=e.doc.key,r=this.ga.get(t);r?e.type!==0&&r.type===3?this.ga=this.ga.insert(t,e):e.type===3&&r.type!==1?this.ga=this.ga.insert(t,{type:r.type,doc:e.doc}):e.type===2&&r.type===2?this.ga=this.ga.insert(t,{type:2,doc:e.doc}):e.type===2&&r.type===0?this.ga=this.ga.insert(t,{type:0,doc:e.doc}):e.type===1&&r.type===0?this.ga=this.ga.remove(t):e.type===1&&r.type===2?this.ga=this.ga.insert(t,{type:1,doc:r.doc}):e.type===0&&r.type===1?this.ga=this.ga.insert(t,{type:2,doc:e.doc}):ue(63341,{Rt:e,pa:r}):this.ga=this.ga.insert(t,e)}ya(){const e=[];return this.ga.inorderTraversal((t,r)=>{e.push(r)}),e}}class Ra{constructor(e,t,r,s,i,o,a,c,u){this.query=e,this.docs=t,this.oldDocs=r,this.docChanges=s,this.mutatedKeys=i,this.fromCache=o,this.syncStateChanged=a,this.excludesMetadataChanges=c,this.hasCachedResults=u}static fromInitialDocuments(e,t,r,s,i){const o=[];return t.forEach(a=>{o.push({type:0,doc:a})}),new Ra(e,t,ua.emptySet(t),o,r,s,!0,!1,i)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(!(this.fromCache===e.fromCache&&this.hasCachedResults===e.hasCachedResults&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&fh(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;const t=this.docChanges,r=e.docChanges;if(t.length!==r.length)return!1;for(let s=0;s<t.length;s++)if(t[s].type!==r[s].type||!t[s].doc.isEqual(r[s].doc))return!1;return!0}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class V5{constructor(){this.wa=void 0,this.Sa=[]}ba(){return this.Sa.some(e=>e.Da())}}class F5{constructor(){this.queries=Kb(),this.onlineState="Unknown",this.Ca=new Set}terminate(){(function(t,r){const s=ie(t),i=s.queries;s.queries=Kb(),i.forEach((o,a)=>{for(const c of a.Sa)c.onError(r)})})(this,new q(M.ABORTED,"Firestore shutting down"))}}function Kb(){return new Si(n=>KN(n),fh)}async function dx(n,e){const t=ie(n);let r=3;const s=e.query;let i=t.queries.get(s);i?!i.ba()&&e.Da()&&(r=2):(i=new V5,r=e.Da()?0:1);try{switch(r){case 0:i.wa=await t.onListen(s,!0);break;case 1:i.wa=await t.onListen(s,!1);break;case 2:await t.onFirstRemoteStoreListen(s)}}catch(o){const a=Lc(o,`Initialization of query '${hl(e.query)}' failed`);return void e.onError(a)}t.queries.set(s,i),i.Sa.push(e),e.va(t.onlineState),i.wa&&e.Fa(i.wa)&&fx(t)}async function hx(n,e){const t=ie(n),r=e.query;let s=3;const i=t.queries.get(r);if(i){const o=i.Sa.indexOf(e);o>=0&&(i.Sa.splice(o,1),i.Sa.length===0?s=e.Da()?0:1:!i.ba()&&e.Da()&&(s=2))}switch(s){case 0:return t.queries.delete(r),t.onUnlisten(r,!0);case 1:return t.queries.delete(r),t.onUnlisten(r,!1);case 2:return t.onLastRemoteStoreUnlisten(r);default:return}}function $5(n,e){const t=ie(n);let r=!1;for(const s of e){const i=s.query,o=t.queries.get(i);if(o){for(const a of o.Sa)a.Fa(s)&&(r=!0);o.wa=s}}r&&fx(t)}function U5(n,e,t){const r=ie(n),s=r.queries.get(e);if(s)for(const i of s.Sa)i.onError(t);r.queries.delete(e)}function fx(n){n.Ca.forEach(e=>{e.next()})}var $v,Yb;(Yb=$v||($v={})).Ma="default",Yb.Cache="cache";class mx{constructor(e,t,r){this.query=e,this.xa=t,this.Oa=!1,this.Na=null,this.onlineState="Unknown",this.options=r||{}}Fa(e){if(!this.options.includeMetadataChanges){const r=[];for(const s of e.docChanges)s.type!==3&&r.push(s);e=new Ra(e.query,e.docs,e.oldDocs,r,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0,e.hasCachedResults)}let t=!1;return this.Oa?this.Ba(e)&&(this.xa.next(e),t=!0):this.La(e,this.onlineState)&&(this.ka(e),t=!0),this.Na=e,t}onError(e){this.xa.error(e)}va(e){this.onlineState=e;let t=!1;return this.Na&&!this.Oa&&this.La(this.Na,e)&&(this.ka(this.Na),t=!0),t}La(e,t){if(!e.fromCache||!this.Da())return!0;const r=t!=="Offline";return(!this.options.qa||!r)&&(!e.docs.isEmpty()||e.hasCachedResults||t==="Offline")}Ba(e){if(e.docChanges.length>0)return!0;const t=this.Na&&this.Na.hasPendingWrites!==e.hasPendingWrites;return!(!e.syncStateChanged&&!t)&&this.options.includeMetadataChanges===!0}ka(e){e=Ra.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache,e.hasCachedResults),this.Oa=!0,this.xa.next(e)}Da(){return this.options.source!==$v.Cache}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class oD{constructor(e,t){this.Qa=e,this.byteLength=t}$a(){return"metadata"in this.Qa}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Jb{constructor(e){this.serializer=e}$s(e){return Vs(this.serializer,e)}Us(e){return e.metadata.exists?dg(this.serializer,e.document,!1):Lt.newNoDocument(this.$s(e.metadata.name),this.Ks(e.metadata.readTime))}Ks(e){return hn(e)}}class px{constructor(e,t){this.Ua=e,this.serializer=t,this.Ka=[],this.Wa=[],this.collectionGroups=new Set,this.progress=aD(e)}get queries(){return this.Ka}get documents(){return this.Wa}Ga(e){this.progress.bytesLoaded+=e.byteLength;let t=this.progress.documentsLoaded;if(e.Qa.namedQuery)this.Ka.push(e.Qa.namedQuery);else if(e.Qa.documentMetadata){this.Wa.push({metadata:e.Qa.documentMetadata}),e.Qa.documentMetadata.exists||++t;const r=ze.fromString(e.Qa.documentMetadata.name);this.collectionGroups.add(r.get(r.length-2))}else e.Qa.document&&(this.Wa[this.Wa.length-1].document=e.Qa.document,++t);return t!==this.progress.documentsLoaded?(this.progress.documentsLoaded=t,{...this.progress}):null}za(e){const t=new Map,r=new Jb(this.serializer);for(const s of e)if(s.metadata.queries){const i=r.$s(s.metadata.name);for(const o of s.metadata.queries){const a=(t.get(o)||Le()).add(i);t.set(o,a)}}return t}async ja(e){const t=await p5(e,new Jb(this.serializer),this.Wa,this.Ua.id),r=this.za(this.documents);for(const s of this.Ka)await g5(e,s,r.get(s.name));return this.progress.taskState="Success",{progress:this.progress,Ja:this.collectionGroups,Ha:t}}}function aD(n){return{taskState:"Running",documentsLoaded:0,bytesLoaded:0,totalDocuments:n.totalDocuments,totalBytes:n.totalBytes}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class lD{constructor(e){this.key=e}}class cD{constructor(e){this.key=e}}class uD{constructor(e,t){this.query=e,this.Ya=t,this.Za=null,this.hasCachedResults=!1,this.current=!1,this.Xa=Le(),this.mutatedKeys=Le(),this.eu=JN(e),this.tu=new ua(this.eu)}get nu(){return this.Ya}ru(e,t){const r=t?t.iu:new Qb,s=t?t.tu:this.tu;let i=t?t.mutatedKeys:this.mutatedKeys,o=s,a=!1;const c=this.query.limitType==="F"&&s.size===this.query.limit?s.last():null,u=this.query.limitType==="L"&&s.size===this.query.limit?s.first():null;if(e.inorderTraversal((h,f)=>{const m=s.get(h),y=mh(this.query,f)?f:null,w=!!m&&this.mutatedKeys.has(m.key),S=!!y&&(y.hasLocalMutations||this.mutatedKeys.has(y.key)&&y.hasCommittedMutations);let R=!1;m&&y?m.data.isEqual(y.data)?w!==S&&(r.track({type:3,doc:y}),R=!0):this.su(m,y)||(r.track({type:2,doc:y}),R=!0,(c&&this.eu(y,c)>0||u&&this.eu(y,u)<0)&&(a=!0)):!m&&y?(r.track({type:0,doc:y}),R=!0):m&&!y&&(r.track({type:1,doc:m}),R=!0,(c||u)&&(a=!0)),R&&(y?(o=o.add(y),i=S?i.add(h):i.delete(h)):(o=o.delete(h),i=i.delete(h)))}),this.query.limit!==null)for(;o.size>this.query.limit;){const h=this.query.limitType==="F"?o.last():o.first();o=o.delete(h.key),i=i.delete(h.key),r.track({type:1,doc:h})}return{tu:o,iu:r,Cs:a,mutatedKeys:i}}su(e,t){return e.hasLocalMutations&&t.hasCommittedMutations&&!t.hasLocalMutations}applyChanges(e,t,r,s){const i=this.tu;this.tu=e.tu,this.mutatedKeys=e.mutatedKeys;const o=e.iu.ya();o.sort((h,f)=>function(y,w){const S=R=>{switch(R){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return ue(20277,{Rt:R})}};return S(y)-S(w)}(h.type,f.type)||this.eu(h.doc,f.doc)),this.ou(r),s=s??!1;const a=t&&!s?this._u():[],c=this.Xa.size===0&&this.current&&!s?1:0,u=c!==this.Za;return this.Za=c,o.length!==0||u?{snapshot:new Ra(this.query,e.tu,i,o,e.mutatedKeys,c===0,u,!1,!!r&&r.resumeToken.approximateByteSize()>0),au:a}:{au:a}}va(e){return this.current&&e==="Offline"?(this.current=!1,this.applyChanges({tu:this.tu,iu:new Qb,mutatedKeys:this.mutatedKeys,Cs:!1},!1)):{au:[]}}uu(e){return!this.Ya.has(e)&&!!this.tu.has(e)&&!this.tu.get(e).hasLocalMutations}ou(e){e&&(e.addedDocuments.forEach(t=>this.Ya=this.Ya.add(t)),e.modifiedDocuments.forEach(t=>{}),e.removedDocuments.forEach(t=>this.Ya=this.Ya.delete(t)),this.current=e.current)}_u(){if(!this.current)return[];const e=this.Xa;this.Xa=Le(),this.tu.forEach(r=>{this.uu(r.key)&&(this.Xa=this.Xa.add(r.key))});const t=[];return e.forEach(r=>{this.Xa.has(r)||t.push(new cD(r))}),this.Xa.forEach(r=>{e.has(r)||t.push(new lD(r))}),t}cu(e){this.Ya=e.Qs,this.Xa=Le();const t=this.ru(e.documents);return this.applyChanges(t,!0)}lu(){return Ra.fromInitialDocuments(this.query,this.tu,this.mutatedKeys,this.Za===0,this.hasCachedResults)}}const jo="SyncEngine";class B5{constructor(e,t,r){this.query=e,this.targetId=t,this.view=r}}class z5{constructor(e){this.key=e,this.hu=!1}}class q5{constructor(e,t,r,s,i,o){this.localStore=e,this.remoteStore=t,this.eventManager=r,this.sharedClientState=s,this.currentUser=i,this.maxConcurrentLimboResolutions=o,this.Pu={},this.Tu=new Si(a=>KN(a),fh),this.Iu=new Map,this.Eu=new Set,this.du=new Rt(se.comparator),this.Au=new Map,this.Ru=new Zw,this.Vu={},this.mu=new Map,this.fu=ka.cr(),this.onlineState="Unknown",this.gu=void 0}get isPrimaryClient(){return this.gu===!0}}async function W5(n,e,t=!0){const r=_g(n);let s;const i=r.Tu.get(e);return i?(r.sharedClientState.addLocalQueryTarget(i.targetId),s=i.view.lu()):s=await dD(r,e,t,!0),s}async function G5(n,e){const t=_g(n);await dD(t,e,!0,!1)}async function dD(n,e,t,r){const s=await mc(n.localStore,nr(e)),i=s.targetId,o=n.sharedClientState.addLocalQueryTarget(i,t);let a;return r&&(a=await gx(n,e,i,o==="current",s.resumeToken)),n.isPrimaryClient&&t&&yg(n.remoteStore,s),a}async function gx(n,e,t,r,s){n.pu=(f,m,y)=>async function(S,R,T,I){let N=R.view.ru(T);N.Cs&&(N=await tp(S.localStore,R.query,!1).then(({documents:A})=>R.view.ru(A,N)));const P=I&&I.targetChanges.get(R.targetId),B=I&&I.targetMismatches.get(R.targetId)!=null,F=R.view.applyChanges(N,S.isPrimaryClient,P,B);return Uv(S,R.targetId,F.au),F.snapshot}(n,f,m,y);const i=await tp(n.localStore,e,!0),o=new uD(e,i.Qs),a=o.ru(i.documents),c=yh.createSynthesizedTargetChangeForCurrentChange(t,r&&n.onlineState!=="Offline",s),u=o.applyChanges(a,n.isPrimaryClient,c);Uv(n,t,u.au);const h=new B5(e,t,o);return n.Tu.set(e,h),n.Iu.has(t)?n.Iu.get(t).push(e):n.Iu.set(t,[e]),u.snapshot}async function H5(n,e,t){const r=ie(n),s=r.Tu.get(e),i=r.Iu.get(s.targetId);if(i.length>1)return r.Iu.set(s.targetId,i.filter(o=>!fh(o,e))),void r.Tu.delete(e);r.isPrimaryClient?(r.sharedClientState.removeLocalQueryTarget(s.targetId),r.sharedClientState.isActiveQueryTarget(s.targetId)||await pc(r.localStore,s.targetId,!1).then(()=>{r.sharedClientState.clearQueryState(s.targetId),t&&gc(r.remoteStore,s.targetId),yc(r,s.targetId)}).catch(Ro)):(yc(r,s.targetId),await pc(r.localStore,s.targetId,!0))}async function Q5(n,e){const t=ie(n),r=t.Tu.get(e),s=t.Iu.get(r.targetId);t.isPrimaryClient&&s.length===1&&(t.sharedClientState.removeLocalQueryTarget(r.targetId),gc(t.remoteStore,r.targetId))}async function K5(n,e,t){const r=wx(n);try{const s=await function(o,a){const c=ie(o),u=Fe.now(),h=a.reduce((y,w)=>y.add(w.key),Le());let f,m;return c.persistence.runTransaction("Locally write mutations","readwrite",y=>{let w=mr(),S=Le();return c.Ns.getEntries(y,h).next(R=>{w=R,w.forEach((T,I)=>{I.isValidDocument()||(S=S.add(T))})}).next(()=>c.localDocuments.getOverlayedDocuments(y,w)).next(R=>{f=R;const T=[];for(const I of a){const N=w6(I,f.get(I.key).overlayedDocument);N!=null&&T.push(new Ii(I.key,N,VN(N.value.mapValue),Wt.exists(!0)))}return c.mutationQueue.addMutationBatch(y,u,T,a)}).next(R=>{m=R;const T=R.applyToLocalDocumentSet(f,S);return c.documentOverlayCache.saveOverlays(y,R.batchId,T)})}).then(()=>({batchId:m.batchId,changes:ZN(f)}))}(r.localStore,e);r.sharedClientState.addPendingMutation(s.batchId),function(o,a,c){let u=o.Vu[o.currentUser.toKey()];u||(u=new Rt(Ne)),u=u.insert(a,c),o.Vu[o.currentUser.toKey()]=u}(r,s.batchId,t),await Ei(r,s.changes),await Oc(r.remoteStore)}catch(s){const i=Lc(s,"Failed to persist write");t.reject(i)}}async function hD(n,e){const t=ie(n);try{const r=await f5(t.localStore,e);e.targetChanges.forEach((s,i)=>{const o=t.Au.get(i);o&&(me(s.addedDocuments.size+s.modifiedDocuments.size+s.removedDocuments.size<=1,22616),s.addedDocuments.size>0?o.hu=!0:s.modifiedDocuments.size>0?me(o.hu,14607):s.removedDocuments.size>0&&(me(o.hu,42227),o.hu=!1))}),await Ei(t,r,e)}catch(r){await Ro(r)}}function Xb(n,e,t){const r=ie(n);if(r.isPrimaryClient&&t===0||!r.isPrimaryClient&&t===1){const s=[];r.Tu.forEach((i,o)=>{const a=o.view.va(e);a.snapshot&&s.push(a.snapshot)}),function(o,a){const c=ie(o);c.onlineState=a;let u=!1;c.queries.forEach((h,f)=>{for(const m of f.Sa)m.va(a)&&(u=!0)}),u&&fx(c)}(r.eventManager,e),s.length&&r.Pu.H_(s),r.onlineState=e,r.isPrimaryClient&&r.sharedClientState.setOnlineState(e)}}async function Y5(n,e,t){const r=ie(n);r.sharedClientState.updateQueryState(e,"rejected",t);const s=r.Au.get(e),i=s&&s.key;if(i){let o=new Rt(se.comparator);o=o.insert(i,Lt.newNoDocument(i,_e.min()));const a=Le().add(i),c=new gh(_e.min(),new Map,new Rt(Ne),o,a);await hD(r,c),r.du=r.du.remove(i),r.Au.delete(e),vx(r)}else await pc(r.localStore,e,!1).then(()=>yc(r,e,t)).catch(Ro)}async function J5(n,e){const t=ie(n),r=e.batch.batchId;try{const s=await h5(t.localStore,e);_x(t,r,null),yx(t,r),t.sharedClientState.updateMutationState(r,"acknowledged"),await Ei(t,s)}catch(s){await Ro(s)}}async function X5(n,e,t){const r=ie(n);try{const s=await function(o,a){const c=ie(o);return c.persistence.runTransaction("Reject batch","readwrite-primary",u=>{let h;return c.mutationQueue.lookupMutationBatch(u,a).next(f=>(me(f!==null,37113),h=f.keys(),c.mutationQueue.removeMutationBatch(u,f))).next(()=>c.mutationQueue.performConsistencyCheck(u)).next(()=>c.documentOverlayCache.removeOverlaysForBatchId(u,h,a)).next(()=>c.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(u,h)).next(()=>c.localDocuments.getDocuments(u,h))})}(r.localStore,e);_x(r,e,t),yx(r,e),r.sharedClientState.updateMutationState(e,"rejected",t),await Ei(r,s)}catch(s){await Ro(s)}}async function Z5(n,e){const t=ie(n);Oo(t.remoteStore)||G(jo,"The network is disabled. The task returned by 'awaitPendingWrites()' will not complete until the network is enabled.");try{const r=await function(o){const a=ie(o);return a.persistence.runTransaction("Get highest unacknowledged batch id","readonly",c=>a.mutationQueue.getHighestUnacknowledgedBatchId(c))}(t.localStore);if(r===uo)return void e.resolve();const s=t.mu.get(r)||[];s.push(e),t.mu.set(r,s)}catch(r){const s=Lc(r,"Initialization of waitForPendingWrites() operation failed");e.reject(s)}}function yx(n,e){(n.mu.get(e)||[]).forEach(t=>{t.resolve()}),n.mu.delete(e)}function _x(n,e,t){const r=ie(n);let s=r.Vu[r.currentUser.toKey()];if(s){const i=s.get(e);i&&(t?i.reject(t):i.resolve(),s=s.remove(e)),r.Vu[r.currentUser.toKey()]=s}}function yc(n,e,t=null){n.sharedClientState.removeLocalQueryTarget(e);for(const r of n.Iu.get(e))n.Tu.delete(r),t&&n.Pu.yu(r,t);n.Iu.delete(e),n.isPrimaryClient&&n.Ru.jr(e).forEach(r=>{n.Ru.containsKey(r)||fD(n,r)})}function fD(n,e){n.Eu.delete(e.path.canonicalString());const t=n.du.get(e);t!==null&&(gc(n.remoteStore,t),n.du=n.du.remove(e),n.Au.delete(t),vx(n))}function Uv(n,e,t){for(const r of t)r instanceof lD?(n.Ru.addReference(r.key,e),e$(n,r)):r instanceof cD?(G(jo,"Document no longer in limbo: "+r.key),n.Ru.removeReference(r.key,e),n.Ru.containsKey(r.key)||fD(n,r.key)):ue(19791,{wu:r})}function e$(n,e){const t=e.key,r=t.path.canonicalString();n.du.get(t)||n.Eu.has(r)||(G(jo,"New document in limbo: "+t),n.Eu.add(r),vx(n))}function vx(n){for(;n.Eu.size>0&&n.du.size<n.maxConcurrentLimboResolutions;){const e=n.Eu.values().next().value;n.Eu.delete(e);const t=new se(ze.fromString(e)),r=n.fu.next();n.Au.set(r,new z5(t)),n.du=n.du.insert(t,r),yg(n.remoteStore,new ti(nr(Nc(t.path)),r,"TargetPurposeLimboResolution",hr.ce))}}async function Ei(n,e,t){const r=ie(n),s=[],i=[],o=[];r.Tu.isEmpty()||(r.Tu.forEach((a,c)=>{o.push(r.pu(c,e,t).then(u=>{var h;if((u||t)&&r.isPrimaryClient){const f=u?!u.fromCache:(h=t==null?void 0:t.targetChanges.get(c.targetId))==null?void 0:h.current;r.sharedClientState.updateQueryState(c.targetId,f?"current":"not-current")}if(u){s.push(u);const f=rx.As(c.targetId,u);i.push(f)}}))}),await Promise.all(o),r.Pu.H_(s),await async function(c,u){const h=ie(c);try{await h.persistence.runTransaction("notifyLocalViewChanges","readwrite",f=>j.forEach(u,m=>j.forEach(m.Es,y=>h.persistence.referenceDelegate.addReference(f,m.targetId,y)).next(()=>j.forEach(m.ds,y=>h.persistence.referenceDelegate.removeReference(f,m.targetId,y)))))}catch(f){if(!Do(f))throw f;G(sx,"Failed to update sequence numbers: "+f)}for(const f of u){const m=f.targetId;if(!f.fromCache){const y=h.Ms.get(m),w=y.snapshotVersion,S=y.withLastLimboFreeSnapshotVersion(w);h.Ms=h.Ms.insert(m,S)}}}(r.localStore,i))}async function t$(n,e){const t=ie(n);if(!t.currentUser.isEqual(e)){G(jo,"User change. New user:",e.toKey());const r=await zR(t.localStore,e);t.currentUser=e,function(i,o){i.mu.forEach(a=>{a.forEach(c=>{c.reject(new q(M.CANCELLED,o))})}),i.mu.clear()}(t,"'waitForPendingWrites' promise is rejected due to a user change."),t.sharedClientState.handleUserChange(e,r.removedBatchIds,r.addedBatchIds),await Ei(t,r.Ls)}}function n$(n,e){const t=ie(n),r=t.Au.get(e);if(r&&r.hu)return Le().add(r.key);{let s=Le();const i=t.Iu.get(e);if(!i)return s;for(const o of i){const a=t.Tu.get(o);s=s.unionWith(a.view.nu)}return s}}async function r$(n,e){const t=ie(n),r=await tp(t.localStore,e.query,!0),s=e.view.cu(r);return t.isPrimaryClient&&Uv(t,e.targetId,s.au),s}async function s$(n,e){const t=ie(n);return HR(t.localStore,e).then(r=>Ei(t,r))}async function i$(n,e,t,r){const s=ie(n),i=await function(a,c){const u=ie(a),h=ie(u.mutationQueue);return u.persistence.runTransaction("Lookup mutation documents","readonly",f=>h.er(f,c).next(m=>m?u.localDocuments.getDocuments(f,m):j.resolve(null)))}(s.localStore,e);i!==null?(t==="pending"?await Oc(s.remoteStore):t==="acknowledged"||t==="rejected"?(_x(s,e,r||null),yx(s,e),function(a,c){ie(ie(a).mutationQueue).ir(c)}(s.localStore,e)):ue(6720,"Unknown batchState",{Su:t}),await Ei(s,i)):G(jo,"Cannot apply mutation batch with id: "+e)}async function o$(n,e){const t=ie(n);if(_g(t),wx(t),e===!0&&t.gu!==!0){const r=t.sharedClientState.getAllActiveQueryTargets(),s=await Zb(t,r.toArray());t.gu=!0,await Fv(t.remoteStore,!0);for(const i of s)yg(t.remoteStore,i)}else if(e===!1&&t.gu!==!1){const r=[];let s=Promise.resolve();t.Iu.forEach((i,o)=>{t.sharedClientState.isLocalQueryTarget(o)?r.push(o):s=s.then(()=>(yc(t,o),pc(t.localStore,o,!0))),gc(t.remoteStore,o)}),await s,await Zb(t,r),function(o){const a=ie(o);a.Au.forEach((c,u)=>{gc(a.remoteStore,u)}),a.Ru.Jr(),a.Au=new Map,a.du=new Rt(se.comparator)}(t),t.gu=!1,await Fv(t.remoteStore,!1)}}async function Zb(n,e,t){const r=ie(n),s=[],i=[];for(const o of e){let a;const c=r.Iu.get(o);if(c&&c.length!==0){a=await mc(r.localStore,nr(c[0]));for(const u of c){const h=r.Tu.get(u),f=await r$(r,h);f.snapshot&&i.push(f.snapshot)}}else{const u=await GR(r.localStore,o);a=await mc(r.localStore,u),await gx(r,mD(u),o,!1,a.resumeToken)}s.push(a)}return r.Pu.H_(i),s}function mD(n){return GN(n.path,n.collectionGroup,n.orderBy,n.filters,n.limit,"F",n.startAt,n.endAt)}function a$(n){return function(t){return ie(ie(t).persistence).Ts()}(ie(n).localStore)}async function l$(n,e,t,r){const s=ie(n);if(s.gu)return void G(jo,"Ignoring unexpected query state notification.");const i=s.Iu.get(e);if(i&&i.length>0)switch(t){case"current":case"not-current":{const o=await HR(s.localStore,YN(i[0])),a=gh.createSynthesizedRemoteEventForCurrentChange(e,t==="current",an.EMPTY_BYTE_STRING);await Ei(s,o,a);break}case"rejected":await pc(s.localStore,e,!0),yc(s,e,r);break;default:ue(64155,t)}}async function c$(n,e,t){const r=_g(n);if(r.gu){for(const s of e){if(r.Iu.has(s)&&r.sharedClientState.isActiveQueryTarget(s)){G(jo,"Adding an already active target "+s);continue}const i=await GR(r.localStore,s),o=await mc(r.localStore,i);await gx(r,mD(i),o.targetId,!1,o.resumeToken),yg(r.remoteStore,o)}for(const s of t)r.Iu.has(s)&&await pc(r.localStore,s,!1).then(()=>{gc(r.remoteStore,s),yc(r,s)}).catch(Ro)}}function _g(n){const e=ie(n);return e.remoteStore.remoteSyncer.applyRemoteEvent=hD.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=n$.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=Y5.bind(null,e),e.Pu.H_=$5.bind(null,e.eventManager),e.Pu.yu=U5.bind(null,e.eventManager),e}function wx(n){const e=ie(n);return e.remoteStore.remoteSyncer.applySuccessfulWrite=J5.bind(null,e),e.remoteStore.remoteSyncer.rejectFailedWrite=X5.bind(null,e),e}function u$(n,e,t){const r=ie(n);(async function(i,o,a){try{const c=await o.getMetadata();if(await function(y,w){const S=ie(y),R=hn(w.createTime);return S.persistence.runTransaction("hasNewerBundle","readonly",T=>S.Ii.getBundleMetadata(T,w.id)).then(T=>!!T&&T.createTime.compareTo(R)>=0)}(i.localStore,c))return await o.close(),a._completeWith(function(y){return{taskState:"Success",documentsLoaded:y.totalDocuments,bytesLoaded:y.totalBytes,totalDocuments:y.totalDocuments,totalBytes:y.totalBytes}}(c)),Promise.resolve(new Set);a._updateProgress(aD(c));const u=new px(c,o.serializer);let h=await o.bu();for(;h;){const m=await u.Ga(h);m&&a._updateProgress(m),h=await o.bu()}const f=await u.ja(i.localStore);return await Ei(i,f.Ha,void 0),await function(y,w){const S=ie(y);return S.persistence.runTransaction("Save bundle","readwrite",R=>S.Ii.saveBundleMetadata(R,w))}(i.localStore,c),a._completeWith(f.progress),Promise.resolve(f.Ja)}catch(c){return Xr(jo,`Loading bundle failed with ${c}`),a._failWith(c),Promise.resolve(new Set)}})(r,e,t).then(s=>{r.sharedClientState.notifyBundleLoaded(s)})}class _c{constructor(){this.kind="memory",this.synchronizeTabs=!1}async initialize(e){this.serializer=za(e.databaseInfo.databaseId),this.sharedClientState=this.Du(e),this.persistence=this.Cu(e),await this.persistence.start(),this.localStore=this.vu(e),this.gcScheduler=this.Fu(e,this.localStore),this.indexBackfillerScheduler=this.Mu(e,this.localStore)}Fu(e,t){return null}Mu(e,t){return null}vu(e){return BR(this.persistence,new UR,e.initialUser,this.serializer)}Cu(e){return new ex(gg.mi,this.serializer)}Du(e){return new XR}async terminate(){var e,t;(e=this.gcScheduler)==null||e.stop(),(t=this.indexBackfillerScheduler)==null||t.stop(),this.sharedClientState.shutdown(),await this.persistence.shutdown()}}_c.provider={build:()=>new _c};class xx extends _c{constructor(e){super(),this.cacheSizeBytes=e}Fu(e,t){me(this.persistence.referenceDelegate instanceof ep,46915);const r=this.persistence.referenceDelegate.garbageCollector;return new jR(r,e.asyncQueue,t)}Cu(e){const t=this.cacheSizeBytes!==void 0?Xn.withCacheSize(this.cacheSizeBytes):Xn.DEFAULT;return new ex(r=>ep.mi(r,t),this.serializer)}}class Sx extends _c{constructor(e,t,r){super(),this.xu=e,this.cacheSizeBytes=t,this.forceOwnership=r,this.kind="persistent",this.synchronizeTabs=!1}async initialize(e){await super.initialize(e),await this.xu.initialize(this,e),await wx(this.xu.syncEngine),await Oc(this.xu.remoteStore),await this.persistence.Ji(()=>(this.gcScheduler&&!this.gcScheduler.started&&this.gcScheduler.start(),this.indexBackfillerScheduler&&!this.indexBackfillerScheduler.started&&this.indexBackfillerScheduler.start(),Promise.resolve()))}vu(e){return BR(this.persistence,new UR,e.initialUser,this.serializer)}Fu(e,t){const r=this.persistence.referenceDelegate.garbageCollector;return new jR(r,e.asyncQueue,t)}Mu(e,t){const r=new b3(t,this.persistence);return new E3(e.asyncQueue,r)}Cu(e){const t=nx(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey),r=this.cacheSizeBytes!==void 0?Xn.withCacheSize(this.cacheSizeBytes):Xn.DEFAULT;return new tx(this.synchronizeTabs,t,e.clientId,r,e.asyncQueue,ZR(),Yf(),this.serializer,this.sharedClientState,!!this.forceOwnership)}Du(e){return new XR}}class pD extends Sx{constructor(e,t){super(e,t,!1),this.xu=e,this.cacheSizeBytes=t,this.synchronizeTabs=!0}async initialize(e){await super.initialize(e);const t=this.xu.syncEngine;this.sharedClientState instanceof Vy&&(this.sharedClientState.syncEngine={Co:i$.bind(null,t),vo:l$.bind(null,t),Fo:c$.bind(null,t),Ts:a$.bind(null,t),Do:s$.bind(null,t)},await this.sharedClientState.start()),await this.persistence.Ji(async r=>{await o$(this.xu.syncEngine,r),this.gcScheduler&&(r&&!this.gcScheduler.started?this.gcScheduler.start():r||this.gcScheduler.stop()),this.indexBackfillerScheduler&&(r&&!this.indexBackfillerScheduler.started?this.indexBackfillerScheduler.start():r||this.indexBackfillerScheduler.stop())})}Du(e){const t=ZR();if(!Vy.v(t))throw new q(M.UNIMPLEMENTED,"IndexedDB persistence is only available on platforms that support LocalStorage.");const r=nx(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey);return new Vy(t,e.asyncQueue,r,e.clientId,e.initialUser)}}class bo{async initialize(e,t){this.localStore||(this.localStore=e.localStore,this.sharedClientState=e.sharedClientState,this.datastore=this.createDatastore(t),this.remoteStore=this.createRemoteStore(t),this.eventManager=this.createEventManager(t),this.syncEngine=this.createSyncEngine(t,!e.synchronizeTabs),this.sharedClientState.onlineStateHandler=r=>Xb(this.syncEngine,r,1),this.remoteStore.remoteSyncer.handleCredentialChange=t$.bind(null,this.syncEngine),await Fv(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(e){return function(){return new F5}()}createDatastore(e){const t=za(e.databaseInfo.databaseId),r=function(i){return new x5(i)}(e.databaseInfo);return function(i,o,a,c){return new b5(i,o,a,c)}(e.authCredentials,e.appCheckCredentials,r,t)}createRemoteStore(e){return function(r,s,i,o,a){return new A5(r,s,i,o,a)}(this.localStore,this.datastore,e.asyncQueue,t=>Xb(this.syncEngine,t,0),function(){return Wb.v()?new Wb:new y5}())}createSyncEngine(e,t){return function(s,i,o,a,c,u,h){const f=new q5(s,i,o,a,c,u);return h&&(f.gu=!0),f}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,e.initialUser,e.maxConcurrentLimboResolutions,t)}async terminate(){var e,t;await async function(s){const i=ie(s);G(Na,"RemoteStore shutting down."),i.Ea.add(5),await Pc(i),i.Aa.shutdown(),i.Ra.set("Unknown")}(this.remoteStore),(e=this.datastore)==null||e.terminate(),(t=this.eventManager)==null||t.terminate()}}bo.provider={build:()=>new bo};function eT(n,e=10240){let t=0;return{async read(){if(t<n.byteLength){const r={value:n.slice(t,t+e),done:!1};return t+=e,r}return{done:!0}},async cancel(){},releaseLock(){},closed:Promise.resolve()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class vg{constructor(e){this.observer=e,this.muted=!1}next(e){this.muted||this.observer.next&&this.Ou(this.observer.next,e)}error(e){this.muted||(this.observer.error?this.Ou(this.observer.error,e):dn("Uncaught Error in snapshot listener:",e.toString()))}Nu(){this.muted=!0}Ou(e,t){setTimeout(()=>{this.muted||e(t)},0)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class d${constructor(e,t){this.Bu=e,this.serializer=t,this.metadata=new On,this.buffer=new Uint8Array,this.Lu=function(){return new TextDecoder("utf-8")}(),this.ku().then(r=>{r&&r.$a()?this.metadata.resolve(r.Qa.metadata):this.metadata.reject(new Error(`The first element of the bundle is not a metadata, it is
             ${JSON.stringify(r==null?void 0:r.Qa)}`))},r=>this.metadata.reject(r))}close(){return this.Bu.cancel()}async getMetadata(){return this.metadata.promise}async bu(){return await this.getMetadata(),this.ku()}async ku(){const e=await this.qu();if(e===null)return null;const t=this.Lu.decode(e),r=Number(t);isNaN(r)&&this.Qu(`length string (${t}) is not valid number`);const s=await this.$u(r);return new oD(JSON.parse(s),e.length+r)}Uu(){return this.buffer.findIndex(e=>e==="{".charCodeAt(0))}async qu(){for(;this.Uu()<0&&!await this.Ku(););if(this.buffer.length===0)return null;const e=this.Uu();e<0&&this.Qu("Reached the end of bundle when a length string is expected.");const t=this.buffer.slice(0,e);return this.buffer=this.buffer.slice(e),t}async $u(e){for(;this.buffer.length<e;)await this.Ku()&&this.Qu("Reached the end of bundle when more is expected.");const t=this.Lu.decode(this.buffer.slice(0,e));return this.buffer=this.buffer.slice(e),t}Qu(e){throw this.Bu.cancel(),new Error(`Invalid bundle format: ${e}`)}async Ku(){const e=await this.Bu.read();if(!e.done){const t=new Uint8Array(this.buffer.length+e.value.length);t.set(this.buffer),t.set(e.value,this.buffer.length),this.buffer=t}return e.done}}/**
 * @license
 * Copyright 2025 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class h${constructor(e,t){this.bundleData=e,this.serializer=t,this.cursor=0,this.elements=[];let r=this.bu();if(!r||!r.$a())throw new Error(`The first element of the bundle is not a metadata object, it is
         ${JSON.stringify(r==null?void 0:r.Qa)}`);this.metadata=r;do r=this.bu(),r!==null&&this.elements.push(r);while(r!==null)}getMetadata(){return this.metadata}Wu(){return this.elements}bu(){if(this.cursor===this.bundleData.length)return null;const e=this.qu(),t=this.$u(e);return new oD(JSON.parse(t),e)}$u(e){if(this.cursor+e>this.bundleData.length)throw new q(M.INTERNAL,"Reached the end of bundle when more is expected.");return this.bundleData.slice(this.cursor,this.cursor+=e)}qu(){const e=this.cursor;let t=this.cursor;for(;t<this.bundleData.length;){if(this.bundleData[t]==="{"){if(t===e)throw new Error("First character is a bracket and not a number");return this.cursor=t,Number(this.bundleData.slice(e,t))}t++}throw new Error("Reached the end of bundle when more is expected.")}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class f${constructor(e){this.datastore=e,this.readVersions=new Map,this.mutations=[],this.committed=!1,this.lastTransactionError=null,this.writtenDocs=new Set}async lookup(e){if(this.ensureCommitNotCalled(),this.mutations.length>0)throw this.lastTransactionError=new q(M.INVALID_ARGUMENT,"Firestore transactions require all reads to be executed before all writes."),this.lastTransactionError;const t=await async function(s,i){const o=ie(s),a={documents:i.map(f=>Ld(o.serializer,f))},c=await o.Ho("BatchGetDocuments",o.serializer.databaseId,ze.emptyPath(),a,i.length),u=new Map;c.forEach(f=>{const m=k6(o.serializer,f);u.set(m.key.toString(),m)});const h=[];return i.forEach(f=>{const m=u.get(f.toString());me(!!m,55234,{key:f}),h.push(m)}),h}(this.datastore,e);return t.forEach(r=>this.recordVersion(r)),t}set(e,t){this.write(t.toMutation(e,this.precondition(e))),this.writtenDocs.add(e.toString())}update(e,t){try{this.write(t.toMutation(e,this.preconditionForUpdate(e)))}catch(r){this.lastTransactionError=r}this.writtenDocs.add(e.toString())}delete(e){this.write(new Dc(e,this.precondition(e))),this.writtenDocs.add(e.toString())}async commit(){if(this.ensureCommitNotCalled(),this.lastTransactionError)throw this.lastTransactionError;const e=this.readVersions;this.mutations.forEach(t=>{e.delete(t.key.toString())}),e.forEach((t,r)=>{const s=se.fromPath(r);this.mutations.push(new Ww(s,this.precondition(s)))}),await async function(r,s){const i=ie(r),o={writes:s.map(a=>Md(i.serializer,a))};await i.Go("Commit",i.serializer.databaseId,ze.emptyPath(),o)}(this.datastore,this.mutations),this.committed=!0}recordVersion(e){let t;if(e.isFoundDocument())t=e.version;else{if(!e.isNoDocument())throw ue(50498,{Gu:e.constructor.name});t=_e.min()}const r=this.readVersions.get(e.key.toString());if(r){if(!t.isEqual(r))throw new q(M.ABORTED,"Document version changed between two reads.")}else this.readVersions.set(e.key.toString(),t)}precondition(e){const t=this.readVersions.get(e.toString());return!this.writtenDocs.has(e.toString())&&t?t.isEqual(_e.min())?Wt.exists(!1):Wt.updateTime(t):Wt.none()}preconditionForUpdate(e){const t=this.readVersions.get(e.toString());if(!this.writtenDocs.has(e.toString())&&t){if(t.isEqual(_e.min()))throw new q(M.INVALID_ARGUMENT,"Can't update a document that doesn't exist.");return Wt.updateTime(t)}return Wt.exists(!0)}write(e){this.ensureCommitNotCalled(),this.mutations.push(e)}ensureCommitNotCalled(){}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class m${constructor(e,t,r,s,i){this.asyncQueue=e,this.datastore=t,this.options=r,this.updateFunction=s,this.deferred=i,this.zu=r.maxAttempts,this.M_=new ox(this.asyncQueue,"transaction_retry")}ju(){this.zu-=1,this.Ju()}Ju(){this.M_.p_(async()=>{const e=new f$(this.datastore),t=this.Hu(e);t&&t.then(r=>{this.asyncQueue.enqueueAndForget(()=>e.commit().then(()=>{this.deferred.resolve(r)}).catch(s=>{this.Yu(s)}))}).catch(r=>{this.Yu(r)})})}Hu(e){try{const t=this.updateFunction(e);return!uh(t)&&t.catch&&t.then?t:(this.deferred.reject(Error("Transaction callback must return a Promise")),null)}catch(t){return this.deferred.reject(t),null}}Yu(e){this.zu>0&&this.Zu(e)?(this.zu-=1,this.asyncQueue.enqueueAndForget(()=>(this.Ju(),Promise.resolve()))):this.deferred.reject(e)}Zu(e){if(e.name==="FirebaseError"){const t=e.code;return t==="aborted"||t==="failed-precondition"||t==="already-exists"||!uR(t)}return!1}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const To="FirestoreClient";class p${constructor(e,t,r,s,i){this.authCredentials=e,this.appCheckCredentials=t,this.asyncQueue=r,this.databaseInfo=s,this.user=Rn.UNAUTHENTICATED,this.clientId=Rw.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this._uninitializedComponentsProvider=i,this.authCredentials.start(r,async o=>{G(To,"Received user=",o.uid),await this.authCredentialListener(o),this.user=o}),this.appCheckCredentials.start(r,o=>(G(To,"Received new app check token=",o),this.appCheckCredentialListener(o,this.user)))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}terminate(){this.asyncQueue.enterRestrictedMode();const e=new On;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted(async()=>{try{this._onlineComponents&&await this._onlineComponents.terminate(),this._offlineComponents&&await this._offlineComponents.terminate(),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),e.resolve()}catch(t){const r=Lc(t,"Failed to shutdown persistence");e.reject(r)}}),e.promise}}async function $y(n,e){n.asyncQueue.verifyOperationInProgress(),G(To,"Initializing OfflineComponentProvider");const t=n.configuration;await e.initialize(t);let r=t.initialUser;n.setCredentialChangeListener(async s=>{r.isEqual(s)||(await zR(e.localStore,s),r=s)}),e.persistence.setDatabaseDeletedListener(()=>n.terminate()),n._offlineComponents=e}async function tT(n,e){n.asyncQueue.verifyOperationInProgress();const t=await Ix(n);G(To,"Initializing OnlineComponentProvider"),await e.initialize(t,n.configuration),n.setCredentialChangeListener(r=>Hb(e.remoteStore,r)),n.setAppCheckTokenChangeListener((r,s)=>Hb(e.remoteStore,s)),n._onlineComponents=e}async function Ix(n){if(!n._offlineComponents)if(n._uninitializedComponentsProvider){G(To,"Using user provided OfflineComponentProvider");try{await $y(n,n._uninitializedComponentsProvider._offline)}catch(e){const t=e;if(!function(s){return s.name==="FirebaseError"?s.code===M.FAILED_PRECONDITION||s.code===M.UNIMPLEMENTED:!(typeof DOMException<"u"&&s instanceof DOMException)||s.code===22||s.code===20||s.code===11}(t))throw t;Xr("Error using user provided cache. Falling back to memory cache: "+t),await $y(n,new _c)}}else G(To,"Using default OfflineComponentProvider"),await $y(n,new xx(void 0));return n._offlineComponents}async function wg(n){return n._onlineComponents||(n._uninitializedComponentsProvider?(G(To,"Using user provided OnlineComponentProvider"),await tT(n,n._uninitializedComponentsProvider._online)):(G(To,"Using default OnlineComponentProvider"),await tT(n,new bo))),n._onlineComponents}function gD(n){return Ix(n).then(e=>e.persistence)}function Mc(n){return Ix(n).then(e=>e.localStore)}function yD(n){return wg(n).then(e=>e.remoteStore)}function Ex(n){return wg(n).then(e=>e.syncEngine)}function _D(n){return wg(n).then(e=>e.datastore)}async function vc(n){const e=await wg(n),t=e.eventManager;return t.onListen=W5.bind(null,e.syncEngine),t.onUnlisten=H5.bind(null,e.syncEngine),t.onFirstRemoteStoreListen=G5.bind(null,e.syncEngine),t.onLastRemoteStoreUnlisten=Q5.bind(null,e.syncEngine),t}function g$(n){return n.asyncQueue.enqueue(async()=>{const e=await gD(n),t=await yD(n);return e.setNetworkEnabled(!0),function(s){const i=ie(s);return i.Ea.delete(0),_h(i)}(t)})}function y$(n){return n.asyncQueue.enqueue(async()=>{const e=await gD(n),t=await yD(n);return e.setNetworkEnabled(!1),async function(s){const i=ie(s);i.Ea.add(0),await Pc(i),i.Ra.set("Offline")}(t)})}function _$(n,e){const t=new On;return n.asyncQueue.enqueueAndForget(async()=>async function(s,i,o){try{const a=await function(u,h){const f=ie(u);return f.persistence.runTransaction("read document","readonly",m=>f.localDocuments.getDocument(m,h))}(s,i);a.isFoundDocument()?o.resolve(a):a.isNoDocument()?o.resolve(null):o.reject(new q(M.UNAVAILABLE,"Failed to get document from cache. (However, this document may exist on the server. Run again without setting 'source' in the GetOptions to attempt to retrieve the document from the server.)"))}catch(a){const c=Lc(a,`Failed to get document '${i} from cache`);o.reject(c)}}(await Mc(n),e,t)),t.promise}function vD(n,e,t={}){const r=new On;return n.asyncQueue.enqueueAndForget(async()=>function(i,o,a,c,u){const h=new vg({next:m=>{h.Nu(),o.enqueueAndForget(()=>hx(i,f));const y=m.docs.has(a);!y&&m.fromCache?u.reject(new q(M.UNAVAILABLE,"Failed to get document because the client is offline.")):y&&m.fromCache&&c&&c.source==="server"?u.reject(new q(M.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):u.resolve(m)},error:m=>u.reject(m)}),f=new mx(Nc(a.path),h,{includeMetadataChanges:!0,qa:!0});return dx(i,f)}(await vc(n),n.asyncQueue,e,t,r)),r.promise}function v$(n,e){const t=new On;return n.asyncQueue.enqueueAndForget(async()=>async function(s,i,o){try{const a=await tp(s,i,!0),c=new uD(i,a.Qs),u=c.ru(a.documents),h=c.applyChanges(u,!1);o.resolve(h.snapshot)}catch(a){const c=Lc(a,`Failed to execute query '${i} against cache`);o.reject(c)}}(await Mc(n),e,t)),t.promise}function wD(n,e,t={}){const r=new On;return n.asyncQueue.enqueueAndForget(async()=>function(i,o,a,c,u){const h=new vg({next:m=>{h.Nu(),o.enqueueAndForget(()=>hx(i,f)),m.fromCache&&c.source==="server"?u.reject(new q(M.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):u.resolve(m)},error:m=>u.reject(m)}),f=new mx(a,h,{includeMetadataChanges:!0,qa:!0});return dx(i,f)}(await vc(n),n.asyncQueue,e,t,r)),r.promise}function w$(n,e,t){const r=new On;return n.asyncQueue.enqueueAndForget(async()=>{try{const s=await _D(n);r.resolve(async function(o,a,c){var S;const u=ie(o),{request:h,gt:f,parent:m}=xR(u.serializer,HN(a),c);u.connection.$o||delete h.parent;const y=(await u.Ho("RunAggregationQuery",u.serializer.databaseId,m,h,1)).filter(R=>!!R.result);me(y.length===1,64727);const w=(S=y[0].result)==null?void 0:S.aggregateFields;return Object.keys(w).reduce((R,T)=>(R[f[T]]=w[T],R),{})}(s,e,t))}catch(s){r.reject(s)}}),r.promise}function x$(n,e){const t=new vg(e);return n.asyncQueue.enqueueAndForget(async()=>function(s,i){ie(s).Ca.add(i),i.next()}(await vc(n),t)),()=>{t.Nu(),n.asyncQueue.enqueueAndForget(async()=>function(s,i){ie(s).Ca.delete(i)}(await vc(n),t))}}function S$(n,e,t,r){const s=function(o,a){let c;return c=typeof o=="string"?hR().encode(o):o,function(h,f){return new d$(h,f)}(function(h,f){if(h instanceof Uint8Array)return eT(h,f);if(h instanceof ArrayBuffer)return eT(new Uint8Array(h),f);if(h instanceof ReadableStream)return h.getReader();throw new Error("Source of `toByteStreamReader` has to be a ArrayBuffer or ReadableStream")}(c),a)}(t,za(e));n.asyncQueue.enqueueAndForget(async()=>{u$(await Ex(n),s,r)})}function I$(n,e){return n.asyncQueue.enqueue(async()=>function(r,s){const i=ie(r);return i.persistence.runTransaction("Get named query","readonly",o=>i.Ii.getNamedQuery(o,s))}(await Mc(n),e))}function xD(n,e){return function(r,s){return new h$(r,s)}(n,e)}function E$(n,e){return n.asyncQueue.enqueue(async()=>async function(r,s){const i=ie(r),o=i.indexManager,a=[];return i.persistence.runTransaction("Configure indexes","readwrite",c=>o.getFieldIndexes(c).next(u=>function(f,m,y,w,S){f=[...f],m=[...m],f.sort(y),m.sort(y);const R=f.length,T=m.length;let I=0,N=0;for(;I<T&&N<R;){const P=y(f[N],m[I]);P<0?S(f[N++]):P>0?w(m[I++]):(I++,N++)}for(;I<T;)w(m[I++]);for(;N<R;)S(f[N++])}(u,s,w3,h=>{a.push(o.addFieldIndex(c,h))},h=>{a.push(o.deleteFieldIndex(c,h))})).next(()=>j.waitFor(a)))}(await Mc(n),e))}function b$(n,e){return n.asyncQueue.enqueue(async()=>function(r,s){ie(r).Fs.Vs=s}(await Mc(n),e))}function T$(n){return n.asyncQueue.enqueue(async()=>function(t){const r=ie(t),s=r.indexManager;return r.persistence.runTransaction("Delete All Indexes","readwrite",i=>s.deleteAllFieldIndexes(i))}(await Mc(n)))}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function SD(n){const e={};return n.timeoutSeconds!==void 0&&(e.timeoutSeconds=n.timeoutSeconds),e}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const nT=new Map;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ID="firestore.googleapis.com",rT=!0;class sT{constructor(e){if(e.host===void 0){if(e.ssl!==void 0)throw new q(M.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host=ID,this.ssl=rT}else this.host=e.host,this.ssl=e.ssl??rT;if(this.isUsingEmulator=e.emulatorOptions!==void 0,this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,this.localCache=e.localCache,e.cacheSizeBytes===void 0)this.cacheSizeBytes=NR;else{if(e.cacheSizeBytes!==-1&&e.cacheSizeBytes<OR)throw new q(M.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}v3("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:e.experimentalAutoDetectLongPolling===void 0?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=SD(e.experimentalLongPollingOptions??{}),function(r){if(r.timeoutSeconds!==void 0){if(isNaN(r.timeoutSeconds))throw new q(M.INVALID_ARGUMENT,`invalid long polling timeout: ${r.timeoutSeconds} (must not be NaN)`);if(r.timeoutSeconds<5)throw new q(M.INVALID_ARGUMENT,`invalid long polling timeout: ${r.timeoutSeconds} (minimum allowed value is 5)`);if(r.timeoutSeconds>30)throw new q(M.INVALID_ARGUMENT,`invalid long polling timeout: ${r.timeoutSeconds} (maximum allowed value is 30)`)}}(this.experimentalLongPollingOptions),this.useFetchStreams=!!e.useFetchStreams}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&function(r,s){return r.timeoutSeconds===s.timeoutSeconds}(this.experimentalLongPollingOptions,e.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}}class vh{constructor(e,t,r,s){this._authCredentials=e,this._appCheckCredentials=t,this._databaseId=r,this._app=s,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new sT({}),this._settingsFrozen=!1,this._emulatorOptions={},this._terminateTask="notTerminated"}get app(){if(!this._app)throw new q(M.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return this._terminateTask!=="notTerminated"}_setSettings(e){if(this._settingsFrozen)throw new q(M.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new sT(e),this._emulatorOptions=e.emulatorOptions||{},e.credentials!==void 0&&(this._authCredentials=function(r){if(!r)return new c3;switch(r.type){case"firstParty":return new f3(r.sessionIndex||"0",r.iamToken||null,r.authTokenFactory||null);case"provider":return r.client;default:throw new q(M.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(e.credentials))}_getSettings(){return this._settings}_getEmulatorOptions(){return this._emulatorOptions}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask==="notTerminated"&&(this._terminateTask=this._terminate()),this._terminateTask}async _restart(){this._terminateTask==="notTerminated"?await this._terminate():this._terminateTask="notTerminated"}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(t){const r=nT.get(t);r&&(G("ComponentProvider","Removing Datastore"),nT.delete(t),r.terminate())}(this),Promise.resolve()}}function A$(n,e,t,r={}){var u;n=Ge(n,vh);const s=wi(e),i=n._getSettings(),o={...i,emulatorOptions:n._getEmulatorOptions()},a=`${e}:${t}`;s&&(Op(`https://${a}`),U0("Firestore",!0)),i.host!==ID&&i.host!==a&&Xr("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used.");const c={...i,host:a,ssl:s,emulatorOptions:r};if(!jr(c,o)&&(n._setSettings(c),r.mockUserToken)){let h,f;if(typeof r.mockUserToken=="string")h=r.mockUserToken,f=Rn.MOCK_USER;else{h=xC(r.mockUserToken,(u=n._app)==null?void 0:u.options.projectId);const m=r.mockUserToken.sub||r.mockUserToken.user_id;if(!m)throw new q(M.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");f=new Rn(m)}n._authCredentials=new u3(new lN(h,f))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Mn{constructor(e,t,r){this.converter=t,this._query=r,this.type="query",this.firestore=e}withConverter(e){return new Mn(this.firestore,e,this._query)}}class yt{constructor(e,t,r){this.converter=t,this._key=r,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new Fs(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new yt(this.firestore,e,this._key)}toJSON(){return{type:yt._jsonSchemaVersion,referencePath:this._key.toString()}}static fromJSON(e,t,r){if(Ba(t,yt._jsonSchema))return new yt(e,r||null,new se(ze.fromString(t.referencePath)))}}yt._jsonSchemaVersion="firestore/documentReference/1.0",yt._jsonSchema={type:vn("string",yt._jsonSchemaVersion),referencePath:vn("string")};class Fs extends Mn{constructor(e,t,r){super(e,t,Nc(r)),this._path=r,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const e=this._path.popLast();return e.isEmpty()?null:new yt(this.firestore,null,new se(e))}withConverter(e){return new Fs(this.firestore,e,this._path)}}function Cn(n,e,...t){if(n=le(n),Dw("collection","path",e),n instanceof vh){const r=ze.fromString(e,...t);return GE(r),new Fs(n,null,r)}{if(!(n instanceof yt||n instanceof Fs))throw new q(M.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const r=n._path.child(ze.fromString(e,...t));return GE(r),new Fs(n.firestore,null,r)}}function d7(n,e){if(n=Ge(n,vh),Dw("collectionGroup","collection id",e),e.indexOf("/")>=0)throw new q(M.INVALID_ARGUMENT,`Invalid collection ID '${e}' passed to function collectionGroup(). Collection IDs must not contain '/'.`);return new Mn(n,null,function(r){return new xi(ze.emptyPath(),r)}(e))}function C$(n,e,...t){if(n=le(n),arguments.length===1&&(e=Rw.newId()),Dw("doc","path",e),n instanceof vh){const r=ze.fromString(e,...t);return WE(r),new yt(n,null,new se(r))}{if(!(n instanceof yt||n instanceof Fs))throw new q(M.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const r=n._path.child(ze.fromString(e,...t));return WE(r),new yt(n.firestore,n instanceof Fs?n.converter:null,new se(r))}}function h7(n,e){return n=le(n),e=le(e),(n instanceof yt||n instanceof Fs)&&(e instanceof yt||e instanceof Fs)&&n.firestore===e.firestore&&n.path===e.path&&n.converter===e.converter}function ED(n,e){return n=le(n),e=le(e),n instanceof Mn&&e instanceof Mn&&n.firestore===e.firestore&&fh(n._query,e._query)&&n.converter===e.converter}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const iT="AsyncQueue";class oT{constructor(e=Promise.resolve()){this.Xu=[],this.ec=!1,this.tc=[],this.nc=null,this.rc=!1,this.sc=!1,this.oc=[],this.M_=new ox(this,"async_queue_retry"),this._c=()=>{const r=Yf();r&&G(iT,"Visibility state changed to "+r.visibilityState),this.M_.w_()},this.ac=e;const t=Yf();t&&typeof t.addEventListener=="function"&&t.addEventListener("visibilitychange",this._c)}get isShuttingDown(){return this.ec}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.uc(),this.cc(e)}enterRestrictedMode(e){if(!this.ec){this.ec=!0,this.sc=e||!1;const t=Yf();t&&typeof t.removeEventListener=="function"&&t.removeEventListener("visibilitychange",this._c)}}enqueue(e){if(this.uc(),this.ec)return new Promise(()=>{});const t=new On;return this.cc(()=>this.ec&&this.sc?Promise.resolve():(e().then(t.resolve,t.reject),t.promise)).then(()=>t.promise)}enqueueRetryable(e){this.enqueueAndForget(()=>(this.Xu.push(e),this.lc()))}async lc(){if(this.Xu.length!==0){try{await this.Xu[0](),this.Xu.shift(),this.M_.reset()}catch(e){if(!Do(e))throw e;G(iT,"Operation failed with retryable error: "+e)}this.Xu.length>0&&this.M_.p_(()=>this.lc())}}cc(e){const t=this.ac.then(()=>(this.rc=!0,e().catch(r=>{throw this.nc=r,this.rc=!1,dn("INTERNAL UNHANDLED ERROR: ",aT(r)),r}).then(r=>(this.rc=!1,r))));return this.ac=t,t}enqueueAfterDelay(e,t,r){this.uc(),this.oc.indexOf(e)>-1&&(t=0);const s=ux.createAndSchedule(this,e,t,r,i=>this.hc(i));return this.tc.push(s),s}uc(){this.nc&&ue(47125,{Pc:aT(this.nc)})}verifyOperationInProgress(){}async Tc(){let e;do e=this.ac,await e;while(e!==this.ac)}Ic(e){for(const t of this.tc)if(t.timerId===e)return!0;return!1}Ec(e){return this.Tc().then(()=>{this.tc.sort((t,r)=>t.targetTimeMs-r.targetTimeMs);for(const t of this.tc)if(t.skipDelay(),e!=="all"&&t.timerId===e)break;return this.Tc()})}dc(e){this.oc.push(e)}hc(e){const t=this.tc.indexOf(e);this.tc.splice(t,1)}}function aT(n){let e=n.message||"";return n.stack&&(e=n.stack.includes(n.message)?n.stack:n.message+`
`+n.stack),e}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ll(n){return function(t,r){if(typeof t!="object"||t===null)return!1;const s=t;for(const i of r)if(i in s&&typeof s[i]=="function")return!0;return!1}(n,["next","error","complete"])}class k${constructor(){this._progressObserver={},this._taskCompletionResolver=new On,this._lastProgress={taskState:"Running",totalBytes:0,totalDocuments:0,bytesLoaded:0,documentsLoaded:0}}onProgress(e,t,r){this._progressObserver={next:e,error:t,complete:r}}catch(e){return this._taskCompletionResolver.promise.catch(e)}then(e,t){return this._taskCompletionResolver.promise.then(e,t)}_completeWith(e){this._updateProgress(e),this._progressObserver.complete&&this._progressObserver.complete(),this._taskCompletionResolver.resolve(e)}_failWith(e){this._lastProgress.taskState="Error",this._progressObserver.next&&this._progressObserver.next(this._lastProgress),this._progressObserver.error&&this._progressObserver.error(e),this._taskCompletionResolver.reject(e)}_updateProgress(e){this._lastProgress=e,this._progressObserver.next&&this._progressObserver.next(e)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const f7=-1;class It extends vh{constructor(e,t,r,s){super(e,t,r,s),this.type="firestore",this._queue=new oT,this._persistenceKey=(s==null?void 0:s.name)||"[DEFAULT]"}async _terminate(){if(this._firestoreClient){const e=this._firestoreClient.terminate();this._queue=new oT(e),this._firestoreClient=void 0,await e}}}function m7(n,e,t){t||(t=Dd);const r=Ws(n,"firestore");if(r.isInitialized(t)){const s=r.getImmediate({identifier:t}),i=r.getOptions(t);if(jr(i,e))return s;throw new q(M.FAILED_PRECONDITION,"initializeFirestore() has already been called with different options. To avoid this error, call initializeFirestore() with the same options as when it was originally called, or call getFirestore() to return the already initialized instance.")}if(e.cacheSizeBytes!==void 0&&e.localCache!==void 0)throw new q(M.INVALID_ARGUMENT,"cache and cacheSizeBytes cannot be specified at the same time as cacheSizeBytes willbe deprecated. Instead, specify the cache size in the cache object");if(e.cacheSizeBytes!==void 0&&e.cacheSizeBytes!==-1&&e.cacheSizeBytes<OR)throw new q(M.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");return e.host&&wi(e.host)&&Op(e.host),r.initialize({options:e,instanceIdentifier:t})}function N$(n,e){const t=typeof n=="object"?n:Zd(),r=typeof n=="string"?n:e||Dd,s=Ws(t,"firestore").getImmediate({identifier:r});if(!s._initialized){const i=_C("firestore");i&&A$(s,...i)}return s}function Zt(n){if(n._terminated)throw new q(M.FAILED_PRECONDITION,"The client has already been terminated.");return n._firestoreClient||bD(n),n._firestoreClient}function bD(n){var r,s,i;const e=n._freezeSettings(),t=function(a,c,u,h){return new Z3(a,c,u,h.host,h.ssl,h.experimentalForceLongPolling,h.experimentalAutoDetectLongPolling,SD(h.experimentalLongPollingOptions),h.useFetchStreams,h.isUsingEmulator)}(n._databaseId,((r=n._app)==null?void 0:r.options.appId)||"",n._persistenceKey,e);n._componentsProvider||(s=e.localCache)!=null&&s._offlineComponentProvider&&((i=e.localCache)!=null&&i._onlineComponentProvider)&&(n._componentsProvider={_offline:e.localCache._offlineComponentProvider,_online:e.localCache._onlineComponentProvider}),n._firestoreClient=new p$(n._authCredentials,n._appCheckCredentials,n._queue,t,n._componentsProvider&&function(a){const c=a==null?void 0:a._online.build();return{_offline:a==null?void 0:a._offline.build(c),_online:c}}(n._componentsProvider))}function p7(n,e){Xr("enableIndexedDbPersistence() will be deprecated in the future, you can use `FirestoreSettings.cache` instead.");const t=n._freezeSettings();return TD(n,bo.provider,{build:r=>new Sx(r,t.cacheSizeBytes,e==null?void 0:e.forceOwnership)}),Promise.resolve()}async function g7(n){Xr("enableMultiTabIndexedDbPersistence() will be deprecated in the future, you can use `FirestoreSettings.cache` instead.");const e=n._freezeSettings();TD(n,bo.provider,{build:t=>new pD(t,e.cacheSizeBytes)})}function TD(n,e,t){if((n=Ge(n,It))._firestoreClient||n._terminated)throw new q(M.FAILED_PRECONDITION,"Firestore has already been started and persistence can no longer be enabled. You can only enable persistence before calling any other methods on a Firestore object.");if(n._componentsProvider||n._getSettings().localCache)throw new q(M.FAILED_PRECONDITION,"SDK cache is already specified.");n._componentsProvider={_online:e,_offline:t},bD(n)}function y7(n){if(n._initialized&&!n._terminated)throw new q(M.FAILED_PRECONDITION,"Persistence can only be cleared before a Firestore instance is initialized or after it is terminated.");const e=new On;return n._queue.enqueueAndForgetEvenWhileRestricted(async()=>{try{await async function(r){if(!Ms.v())return Promise.resolve();const s=r+$R;await Ms.delete(s)}(nx(n._databaseId,n._persistenceKey)),e.resolve()}catch(t){e.reject(t)}}),e.promise}function _7(n){return function(t){const r=new On;return t.asyncQueue.enqueueAndForget(async()=>Z5(await Ex(t),r)),r.promise}(Zt(n=Ge(n,It)))}function v7(n){return g$(Zt(n=Ge(n,It)))}function w7(n){return y$(Zt(n=Ge(n,It)))}function x7(n){return AM(n.app,"firestore",n._databaseId.database),n._delete()}function lT(n,e){const t=Zt(n=Ge(n,It)),r=new k$;return S$(t,n._databaseId,e,r),r}function R$(n,e){return I$(Zt(n=Ge(n,It)),e).then(t=>t?new Mn(n,null,t.query):null)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Vd{constructor(e="count",t){this._internalFieldPath=t,this.type="AggregateField",this.aggregateType=e}}class D${constructor(e,t,r){this._userDataWriter=t,this._data=r,this.type="AggregateQuerySnapshot",this.query=e}data(){return this._userDataWriter.convertObjectMap(this._data)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Cr{constructor(e){this._byteString=e}static fromBase64String(e){try{return new Cr(an.fromBase64String(e))}catch(t){throw new q(M.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+t)}}static fromUint8Array(e){return new Cr(an.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}toJSON(){return{type:Cr._jsonSchemaVersion,bytes:this.toBase64()}}static fromJSON(e){if(Ba(e,Cr._jsonSchema))return Cr.fromBase64String(e.bytes)}}Cr._jsonSchemaVersion="firestore/bytes/1.0",Cr._jsonSchema={type:vn("string",Cr._jsonSchemaVersion),bytes:vn("string")};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class qa{constructor(...e){for(let t=0;t<e.length;++t)if(e[t].length===0)throw new q(M.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new qt(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}}function S7(){return new qa(_v)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Wa{constructor(e){this._methodName=e}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class $s{constructor(e,t){if(!isFinite(e)||e<-90||e>90)throw new q(M.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(t)||t<-180||t>180)throw new q(M.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+t);this._lat=e,this._long=t}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}_compareTo(e){return Ne(this._lat,e._lat)||Ne(this._long,e._long)}toJSON(){return{latitude:this._lat,longitude:this._long,type:$s._jsonSchemaVersion}}static fromJSON(e){if(Ba(e,$s._jsonSchema))return new $s(e.latitude,e.longitude)}}$s._jsonSchemaVersion="firestore/geoPoint/1.0",$s._jsonSchema={type:vn("string",$s._jsonSchemaVersion),latitude:vn("number"),longitude:vn("number")};/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ms{constructor(e){this._values=(e||[]).map(t=>t)}toArray(){return this._values.map(e=>e)}isEqual(e){return function(r,s){if(r.length!==s.length)return!1;for(let i=0;i<r.length;++i)if(r[i]!==s[i])return!1;return!0}(this._values,e._values)}toJSON(){return{type:ms._jsonSchemaVersion,vectorValues:this._values}}static fromJSON(e){if(Ba(e,ms._jsonSchema)){if(Array.isArray(e.vectorValues)&&e.vectorValues.every(t=>typeof t=="number"))return new ms(e.vectorValues);throw new q(M.INVALID_ARGUMENT,"Expected 'vectorValues' field to be a number array")}}}ms._jsonSchemaVersion="firestore/vectorValue/1.0",ms._jsonSchema={type:vn("string",ms._jsonSchemaVersion),vectorValues:vn("object")};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const P$=/^__.*__$/;class O${constructor(e,t,r){this.data=e,this.fieldMask=t,this.fieldTransforms=r}toMutation(e,t){return this.fieldMask!==null?new Ii(e,this.data,this.fieldMask,t,this.fieldTransforms):new Rc(e,this.data,t,this.fieldTransforms)}}class AD{constructor(e,t,r){this.data=e,this.fieldMask=t,this.fieldTransforms=r}toMutation(e,t){return new Ii(e,this.data,this.fieldMask,t,this.fieldTransforms)}}function CD(n){switch(n){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw ue(40011,{Ac:n})}}class xg{constructor(e,t,r,s,i,o){this.settings=e,this.databaseId=t,this.serializer=r,this.ignoreUndefinedProperties=s,i===void 0&&this.Rc(),this.fieldTransforms=i||[],this.fieldMask=o||[]}get path(){return this.settings.path}get Ac(){return this.settings.Ac}Vc(e){return new xg({...this.settings,...e},this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}mc(e){var s;const t=(s=this.path)==null?void 0:s.child(e),r=this.Vc({path:t,fc:!1});return r.gc(e),r}yc(e){var s;const t=(s=this.path)==null?void 0:s.child(e),r=this.Vc({path:t,fc:!1});return r.Rc(),r}wc(e){return this.Vc({path:void 0,fc:!0})}Sc(e){return ip(e,this.settings.methodName,this.settings.bc||!1,this.path,this.settings.Dc)}contains(e){return this.fieldMask.find(t=>e.isPrefixOf(t))!==void 0||this.fieldTransforms.find(t=>e.isPrefixOf(t.field))!==void 0}Rc(){if(this.path)for(let e=0;e<this.path.length;e++)this.gc(this.path.get(e))}gc(e){if(e.length===0)throw this.Sc("Document fields must not be empty");if(CD(this.Ac)&&P$.test(e))throw this.Sc('Document fields cannot begin and end with "__"')}}class j${constructor(e,t,r){this.databaseId=e,this.ignoreUndefinedProperties=t,this.serializer=r||za(e)}Cc(e,t,r,s=!1){return new xg({Ac:e,methodName:t,Dc:r,path:qt.emptyPath(),fc:!1,bc:s},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}}function Ga(n){const e=n._freezeSettings(),t=za(n._databaseId);return new j$(n._databaseId,!!e.ignoreUndefinedProperties,t)}function Sg(n,e,t,r,s,i={}){const o=n.Cc(i.merge||i.mergeFields?2:0,e,t,s);Rx("Data must be an object, but it was:",o,r);const a=RD(r,o);let c,u;if(i.merge)c=new fr(o.fieldMask),u=o.fieldTransforms;else if(i.mergeFields){const h=[];for(const f of i.mergeFields){const m=Fd(e,f,t);if(!o.contains(m))throw new q(M.INVALID_ARGUMENT,`Field '${m}' is specified in your field mask but missing from your input data.`);PD(h,m)||h.push(m)}c=new fr(h),u=o.fieldTransforms.filter(f=>c.covers(f.field))}else c=null,u=o.fieldTransforms;return new O$(new zn(a),c,u)}class wh extends Wa{_toFieldTransform(e){if(e.Ac!==2)throw e.Ac===1?e.Sc(`${this._methodName}() can only appear at the top level of your update data`):e.Sc(`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return e.fieldMask.push(e.path),null}isEqual(e){return e instanceof wh}}function kD(n,e,t){return new xg({Ac:3,Dc:e.settings.Dc,methodName:n._methodName,fc:t},e.databaseId,e.serializer,e.ignoreUndefinedProperties)}class bx extends Wa{_toFieldTransform(e){return new ph(e.path,new dc)}isEqual(e){return e instanceof bx}}class Tx extends Wa{constructor(e,t){super(e),this.vc=t}_toFieldTransform(e){const t=kD(this,e,!0),r=this.vc.map(i=>Ha(i,t)),s=new ba(r);return new ph(e.path,s)}isEqual(e){return e instanceof Tx&&jr(this.vc,e.vc)}}class Ax extends Wa{constructor(e,t){super(e),this.vc=t}_toFieldTransform(e){const t=kD(this,e,!0),r=this.vc.map(i=>Ha(i,t)),s=new Ta(r);return new ph(e.path,s)}isEqual(e){return e instanceof Ax&&jr(this.vc,e.vc)}}class Cx extends Wa{constructor(e,t){super(e),this.Fc=t}_toFieldTransform(e){const t=new hc(e.serializer,nR(e.serializer,this.Fc));return new ph(e.path,t)}isEqual(e){return e instanceof Cx&&this.Fc===e.Fc}}function kx(n,e,t,r){const s=n.Cc(1,e,t);Rx("Data must be an object, but it was:",s,r);const i=[],o=zn.empty();Po(r,(c,u)=>{const h=Ig(e,c,t);u=le(u);const f=s.yc(h);if(u instanceof wh)i.push(h);else{const m=Ha(u,f);m!=null&&(i.push(h),o.set(h,m))}});const a=new fr(i);return new AD(o,a,s.fieldTransforms)}function Nx(n,e,t,r,s,i){const o=n.Cc(1,e,t),a=[Fd(e,r,t)],c=[s];if(i.length%2!=0)throw new q(M.INVALID_ARGUMENT,`Function ${e}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let m=0;m<i.length;m+=2)a.push(Fd(e,i[m])),c.push(i[m+1]);const u=[],h=zn.empty();for(let m=a.length-1;m>=0;--m)if(!PD(u,a[m])){const y=a[m];let w=c[m];w=le(w);const S=o.yc(y);if(w instanceof wh)u.push(y);else{const R=Ha(w,S);R!=null&&(u.push(y),h.set(y,R))}}const f=new fr(u);return new AD(h,f,o.fieldTransforms)}function ND(n,e,t,r=!1){return Ha(t,n.Cc(r?4:3,e))}function Ha(n,e){if(DD(n=le(n)))return Rx("Unsupported field value:",e,n),RD(n,e);if(n instanceof Wa)return function(r,s){if(!CD(s.Ac))throw s.Sc(`${r._methodName}() can only be used with update() and set()`);if(!s.path)throw s.Sc(`${r._methodName}() is not currently supported inside arrays`);const i=r._toFieldTransform(s);i&&s.fieldTransforms.push(i)}(n,e),null;if(n===void 0&&e.ignoreUndefinedProperties)return null;if(e.path&&e.fieldMask.push(e.path),n instanceof Array){if(e.settings.fc&&e.Ac!==4)throw e.Sc("Nested arrays are not supported");return function(r,s){const i=[];let o=0;for(const a of r){let c=Ha(a,s.wc(o));c==null&&(c={nullValue:"NULL_VALUE"}),i.push(c),o++}return{arrayValue:{values:i}}}(n,e)}return function(r,s){if((r=le(r))===null)return{nullValue:"NULL_VALUE"};if(typeof r=="number")return nR(s.serializer,r);if(typeof r=="boolean")return{booleanValue:r};if(typeof r=="string")return{stringValue:r};if(r instanceof Date){const i=Fe.fromDate(r);return{timestampValue:fc(s.serializer,i)}}if(r instanceof Fe){const i=new Fe(r.seconds,1e3*Math.floor(r.nanoseconds/1e3));return{timestampValue:fc(s.serializer,i)}}if(r instanceof $s)return{geoPointValue:{latitude:r.latitude,longitude:r.longitude}};if(r instanceof Cr)return{bytesValue:pR(s.serializer,r._byteString)};if(r instanceof yt){const i=s.databaseId,o=r.firestore._databaseId;if(!o.isEqual(i))throw s.Sc(`Document reference is for database ${o.projectId}/${o.database} but should be for database ${i.projectId}/${i.database}`);return{referenceValue:Yw(r.firestore._databaseId||s.databaseId,r._key.path)}}if(r instanceof ms)return function(o,a){return{mapValue:{fields:{[Fw]:{stringValue:$w},[lc]:{arrayValue:{values:o.toArray().map(u=>{if(typeof u!="number")throw a.Sc("VectorValues must only contain numeric values.");return qw(a.serializer,u)})}}}}}}(r,s);throw s.Sc(`Unsupported field value: ${tg(r)}`)}(n,e)}function RD(n,e){const t={};return kN(n)?e.path&&e.path.length>0&&e.fieldMask.push(e.path):Po(n,(r,s)=>{const i=Ha(s,e.mc(r));i!=null&&(t[r]=i)}),{mapValue:{fields:t}}}function DD(n){return!(typeof n!="object"||n===null||n instanceof Array||n instanceof Date||n instanceof Fe||n instanceof $s||n instanceof Cr||n instanceof yt||n instanceof Wa||n instanceof ms)}function Rx(n,e,t){if(!DD(t)||!uN(t)){const r=tg(t);throw r==="an object"?e.Sc(n+" a custom object"):e.Sc(n+" "+r)}}function Fd(n,e,t){if((e=le(e))instanceof qa)return e._internalPath;if(typeof e=="string")return Ig(n,e);throw ip("Field path arguments must be of type string or ",n,!1,void 0,t)}const L$=new RegExp("[~\\*/\\[\\]]");function Ig(n,e,t){if(e.search(L$)>=0)throw ip(`Invalid field path (${e}). Paths must not contain '~', '*', '/', '[', or ']'`,n,!1,void 0,t);try{return new qa(...e.split("."))._internalPath}catch{throw ip(`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,n,!1,void 0,t)}}function ip(n,e,t,r,s){const i=r&&!r.isEmpty(),o=s!==void 0;let a=`Function ${e}() called with invalid data`;t&&(a+=" (via `toFirestore()`)"),a+=". ";let c="";return(i||o)&&(c+=" (found",i&&(c+=` in field ${r}`),o&&(c+=` in document ${s}`),c+=")"),new q(M.INVALID_ARGUMENT,a+n+c)}function PD(n,e){return n.some(t=>t.isEqual(e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class $d{constructor(e,t,r,s,i){this._firestore=e,this._userDataWriter=t,this._key=r,this._document=s,this._converter=i}get id(){return this._key.path.lastSegment()}get ref(){return new yt(this._firestore,this._converter,this._key)}exists(){return this._document!==null}data(){if(this._document){if(this._converter){const e=new M$(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}get(e){if(this._document){const t=this._document.data.field(Eg("DocumentSnapshot.get",e));if(t!==null)return this._userDataWriter.convertValue(t)}}}class M$ extends $d{data(){return super.data()}}function Eg(n,e){return typeof e=="string"?Ig(n,e):e instanceof qa?e._internalPath:e._delegate._internalPath}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function OD(n){if(n.limitType==="L"&&n.explicitOrderBy.length===0)throw new q(M.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}class Dx{}class xh extends Dx{}function Ki(n,e,...t){let r=[];e instanceof Dx&&r.push(e),r=r.concat(t),function(i){const o=i.filter(c=>c instanceof Vc).length,a=i.filter(c=>c instanceof Sh).length;if(o>1||o>0&&a>0)throw new q(M.INVALID_ARGUMENT,"InvalidQuery. When using composite filters, you cannot use more than one filter at the top level. Consider nesting the multiple filters within an `and(...)` statement. For example: change `query(query, where(...), or(...))` to `query(query, and(where(...), or(...)))`.")}(r);for(const s of r)n=s._apply(n);return n}class Sh extends xh{constructor(e,t,r){super(),this._field=e,this._op=t,this._value=r,this.type="where"}static _create(e,t,r){return new Sh(e,t,r)}_apply(e){const t=this._parse(e);return LD(e._query,t),new Mn(e.firestore,e.converter,kv(e._query,t))}_parse(e){const t=Ga(e.firestore);return function(i,o,a,c,u,h,f){let m;if(u.isKeyField()){if(h==="array-contains"||h==="array-contains-any")throw new q(M.INVALID_ARGUMENT,`Invalid Query. You can't perform '${h}' queries on documentId().`);if(h==="in"||h==="not-in"){uT(f,h);const w=[];for(const S of f)w.push(cT(c,i,S));m={arrayValue:{values:w}}}else m=cT(c,i,f)}else h!=="in"&&h!=="not-in"&&h!=="array-contains-any"||uT(f,h),m=ND(a,o,f,h==="in"||h==="not-in");return Ke.create(u,h,m)}(e._query,"where",t,e.firestore._databaseId,this._field,this._op,this._value)}}function ni(n,e,t){const r=e,s=Eg("where",n);return Sh._create(s,r,t)}class Vc extends Dx{constructor(e,t){super(),this.type=e,this._queryConstraints=t}static _create(e,t){return new Vc(e,t)}_parse(e){const t=this._queryConstraints.map(r=>r._parse(e)).filter(r=>r.getFilters().length>0);return t.length===1?t[0]:ht.create(t,this._getOperator())}_apply(e){const t=this._parse(e);return t.getFilters().length===0?e:(function(s,i){let o=s;const a=i.getFlattenedFilters();for(const c of a)LD(o,c),o=kv(o,c)}(e._query,t),new Mn(e.firestore,e.converter,kv(e._query,t)))}_getQueryConstraints(){return this._queryConstraints}_getOperator(){return this.type==="and"?"and":"or"}}function I7(...n){return n.forEach(e=>MD("or",e)),Vc._create("or",n)}function E7(...n){return n.forEach(e=>MD("and",e)),Vc._create("and",n)}class Px extends xh{constructor(e,t){super(),this._field=e,this._direction=t,this.type="orderBy"}static _create(e,t){return new Px(e,t)}_apply(e){const t=function(s,i,o){if(s.startAt!==null)throw new q(M.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(s.endAt!==null)throw new q(M.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");return new jd(i,o)}(e._query,this._field,this._direction);return new Mn(e.firestore,e.converter,function(s,i){const o=s.explicitOrderBy.concat([i]);return new xi(s.path,s.collectionGroup,o,s.filters.slice(),s.limit,s.limitType,s.startAt,s.endAt)}(e._query,t))}}function op(n,e="asc"){const t=e,r=Eg("orderBy",n);return Px._create(r,t)}class bg extends xh{constructor(e,t,r){super(),this.type=e,this._limit=t,this._limitType=r}static _create(e,t,r){return new bg(e,t,r)}_apply(e){return new Mn(e.firestore,e.converter,Ym(e._query,this._limit,this._limitType))}}function V$(n){return dN("limit",n),bg._create("limit",n,"F")}function b7(n){return dN("limitToLast",n),bg._create("limitToLast",n,"L")}class Tg extends xh{constructor(e,t,r){super(),this.type=e,this._docOrFields=t,this._inclusive=r}static _create(e,t,r){return new Tg(e,t,r)}_apply(e){const t=jD(e,this.type,this._docOrFields,this._inclusive);return new Mn(e.firestore,e.converter,function(s,i){return new xi(s.path,s.collectionGroup,s.explicitOrderBy.slice(),s.filters.slice(),s.limit,s.limitType,i,s.endAt)}(e._query,t))}}function T7(...n){return Tg._create("startAt",n,!0)}function A7(...n){return Tg._create("startAfter",n,!1)}class Ag extends xh{constructor(e,t,r){super(),this.type=e,this._docOrFields=t,this._inclusive=r}static _create(e,t,r){return new Ag(e,t,r)}_apply(e){const t=jD(e,this.type,this._docOrFields,this._inclusive);return new Mn(e.firestore,e.converter,function(s,i){return new xi(s.path,s.collectionGroup,s.explicitOrderBy.slice(),s.filters.slice(),s.limit,s.limitType,s.startAt,i)}(e._query,t))}}function C7(...n){return Ag._create("endBefore",n,!1)}function k7(...n){return Ag._create("endAt",n,!0)}function jD(n,e,t,r){if(t[0]=le(t[0]),t[0]instanceof $d)return function(i,o,a,c,u){if(!c)throw new q(M.NOT_FOUND,`Can't use a DocumentSnapshot that doesn't exist for ${a}().`);const h=[];for(const f of jl(i))if(f.field.isKeyField())h.push(Ia(o,c.key));else{const m=c.data.field(f.field);if(og(m))throw new q(M.INVALID_ARGUMENT,'Invalid query. You are trying to start or end a query using a document for which the field "'+f.field+'" is an uncommitted server timestamp. (Since the value of this field is unknown, you cannot start/end a query with it.)');if(m===null){const y=f.field.canonicalString();throw new q(M.INVALID_ARGUMENT,`Invalid query. You are trying to start or end a query using a document for which the field '${y}' (used as the orderBy) does not exist.`)}h.push(m)}return new Io(h,u)}(n._query,n.firestore._databaseId,e,t[0]._document,r);{const s=Ga(n.firestore);return function(o,a,c,u,h,f){const m=o.explicitOrderBy;if(h.length>m.length)throw new q(M.INVALID_ARGUMENT,`Too many arguments provided to ${u}(). The number of arguments must be less than or equal to the number of orderBy() clauses`);const y=[];for(let w=0;w<h.length;w++){const S=h[w];if(m[w].field.isKeyField()){if(typeof S!="string")throw new q(M.INVALID_ARGUMENT,`Invalid query. Expected a string for document ID in ${u}(), but got a ${typeof S}`);if(!Bw(o)&&S.indexOf("/")!==-1)throw new q(M.INVALID_ARGUMENT,`Invalid query. When querying a collection and ordering by documentId(), the value passed to ${u}() must be a plain document ID, but '${S}' contains a slash.`);const R=o.path.child(ze.fromString(S));if(!se.isDocumentKey(R))throw new q(M.INVALID_ARGUMENT,`Invalid query. When querying a collection group and ordering by documentId(), the value passed to ${u}() must result in a valid document path, but '${R}' is not because it contains an odd number of segments.`);const T=new se(R);y.push(Ia(a,T))}else{const R=ND(c,u,S);y.push(R)}}return new Io(y,f)}(n._query,n.firestore._databaseId,s,e,t,r)}}function cT(n,e,t){if(typeof(t=le(t))=="string"){if(t==="")throw new q(M.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!Bw(e)&&t.indexOf("/")!==-1)throw new q(M.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${t}' contains a '/' character.`);const r=e.path.child(ze.fromString(t));if(!se.isDocumentKey(r))throw new q(M.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${r}' is not because it has an odd number of segments (${r.length}).`);return Ia(n,new se(r))}if(t instanceof yt)return Ia(n,t._key);throw new q(M.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${tg(t)}.`)}function uT(n,e){if(!Array.isArray(n)||n.length===0)throw new q(M.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${e.toString()}' filters.`)}function LD(n,e){const t=function(s,i){for(const o of s)for(const a of o.getFlattenedFilters())if(i.indexOf(a.op)>=0)return a.op;return null}(n.filters,function(s){switch(s){case"!=":return["!=","not-in"];case"array-contains-any":case"in":return["not-in"];case"not-in":return["array-contains-any","in","not-in","!="];default:return[]}}(e.op));if(t!==null)throw t===e.op?new q(M.INVALID_ARGUMENT,`Invalid query. You cannot use more than one '${e.op.toString()}' filter.`):new q(M.INVALID_ARGUMENT,`Invalid query. You cannot use '${e.op.toString()}' filters with '${t.toString()}' filters.`)}function MD(n,e){if(!(e instanceof Sh||e instanceof Vc))throw new q(M.INVALID_ARGUMENT,`Function ${n}() requires AppliableConstraints created with a call to 'where(...)', 'or(...)', or 'and(...)'.`)}class VD{convertValue(e,t="none"){switch(xo(e)){case 0:return null;case 1:return e.booleanValue;case 2:return $t(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,t);case 5:return e.stringValue;case 6:return this.convertBytes(pi(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,t);case 11:return this.convertObject(e.mapValue,t);case 10:return this.convertVectorValue(e.mapValue);default:throw ue(62114,{value:e})}}convertObject(e,t){return this.convertObjectMap(e.fields,t)}convertObjectMap(e,t="none"){const r={};return Po(e,(s,i)=>{r[s]=this.convertValue(i,t)}),r}convertVectorValue(e){var r,s,i;const t=(i=(s=(r=e.fields)==null?void 0:r[lc].arrayValue)==null?void 0:s.values)==null?void 0:i.map(o=>$t(o.doubleValue));return new ms(t)}convertGeoPoint(e){return new $s($t(e.latitude),$t(e.longitude))}convertArray(e,t){return(e.values||[]).map(r=>this.convertValue(r,t))}convertServerTimestamp(e,t){switch(t){case"previous":const r=ag(e);return r==null?null:this.convertValue(r,t);case"estimate":return this.convertTimestamp(Rd(e));default:return null}}convertTimestamp(e){const t=mi(e);return new Fe(t.seconds,t.nanos)}convertDocumentKey(e,t){const r=ze.fromString(e);me(bR(r),9688,{name:e});const s=new Sa(r.get(1),r.get(3)),i=new se(r.popFirst(5));return s.isEqual(t)||dn(`Document ${i} contains a document reference within a different database (${s.projectId}/${s.database}) which is not supported. It will be treated as a reference in the current database (${t.projectId}/${t.database}) instead.`),i}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Cg(n,e,t){let r;return r=n?t&&(t.merge||t.mergeFields)?n.toFirestore(e,t):n.toFirestore(e):e,r}class Ox extends VD{constructor(e){super(),this.firestore=e}convertBytes(e){return new Cr(e)}convertReference(e){const t=this.convertDocumentKey(e,this.firestore._databaseId);return new yt(this.firestore,null,t)}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function N7(n){return new Vd("sum",Fd("sum",n))}function R7(n){return new Vd("avg",Fd("average",n))}function F$(){return new Vd("count")}function D7(n,e){var t,r;return n instanceof Vd&&e instanceof Vd&&n.aggregateType===e.aggregateType&&((t=n._internalFieldPath)==null?void 0:t.canonicalString())===((r=e._internalFieldPath)==null?void 0:r.canonicalString())}function P7(n,e){return ED(n.query,e.query)&&jr(n.data(),e.data())}/**
 * @license
 * Copyright 2025 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const FD="NOT SUPPORTED";class Yi{constructor(e,t){this.hasPendingWrites=e,this.fromCache=t}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}}class Rr extends $d{constructor(e,t,r,s,i,o){super(e,t,r,s,o),this._firestore=e,this._firestoreImpl=e,this.metadata=i}exists(){return super.exists()}data(e={}){if(this._document){if(this._converter){const t=new Jf(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(t,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}get(e,t={}){if(this._document){const r=this._document.data.field(Eg("DocumentSnapshot.get",e));if(r!==null)return this._userDataWriter.convertValue(r,t.serverTimestamps)}}toJSON(){if(this.metadata.hasPendingWrites)throw new q(M.FAILED_PRECONDITION,"DocumentSnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");const e=this._document,t={};return t.type=Rr._jsonSchemaVersion,t.bundle="",t.bundleSource="DocumentSnapshot",t.bundleName=this._key.toString(),!e||!e.isValidDocument()||!e.isFoundDocument()?t:(this._userDataWriter.convertObjectMap(e.data.value.mapValue.fields,"previous"),t.bundle=(this._firestore,this.ref.path,"NOT SUPPORTED"),t)}}function O7(n,e,t){if(Ba(e,Rr._jsonSchema)){if(e.bundle===FD)throw new q(M.INVALID_ARGUMENT,"The provided JSON object was created in a client environment, which is not supported.");const r=za(n._databaseId),s=xD(e.bundle,r),i=s.Wu(),o=new px(s.getMetadata(),r);for(const h of i)o.Ga(h);const a=o.documents;if(a.length!==1)throw new q(M.INVALID_ARGUMENT,`Expected bundle data to contain 1 document, but it contains ${a.length} documents.`);const c=dg(r,a[0].document),u=new se(ze.fromString(e.bundleName));return new Rr(n,new Ox(n),u,c,new Yi(!1,!1),t||null)}}Rr._jsonSchemaVersion="firestore/documentSnapshot/1.0",Rr._jsonSchema={type:vn("string",Rr._jsonSchemaVersion),bundleSource:vn("string","DocumentSnapshot"),bundleName:vn("string"),bundle:vn("string")};class Jf extends Rr{data(e={}){return super.data(e)}}class Dr{constructor(e,t,r,s){this._firestore=e,this._userDataWriter=t,this._snapshot=s,this.metadata=new Yi(s.hasPendingWrites,s.fromCache),this.query=r}get docs(){const e=[];return this.forEach(t=>e.push(t)),e}get size(){return this._snapshot.docs.size}get empty(){return this.size===0}forEach(e,t){this._snapshot.docs.forEach(r=>{e.call(t,new Jf(this._firestore,this._userDataWriter,r.key,r,new Yi(this._snapshot.mutatedKeys.has(r.key),this._snapshot.fromCache),this.query.converter))})}docChanges(e={}){const t=!!e.includeMetadataChanges;if(t&&this._snapshot.excludesMetadataChanges)throw new q(M.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===t||(this._cachedChanges=function(s,i){if(s._snapshot.oldDocs.isEmpty()){let o=0;return s._snapshot.docChanges.map(a=>{const c=new Jf(s._firestore,s._userDataWriter,a.doc.key,a.doc,new Yi(s._snapshot.mutatedKeys.has(a.doc.key),s._snapshot.fromCache),s.query.converter);return a.doc,{type:"added",doc:c,oldIndex:-1,newIndex:o++}})}{let o=s._snapshot.oldDocs;return s._snapshot.docChanges.filter(a=>i||a.type!==3).map(a=>{const c=new Jf(s._firestore,s._userDataWriter,a.doc.key,a.doc,new Yi(s._snapshot.mutatedKeys.has(a.doc.key),s._snapshot.fromCache),s.query.converter);let u=-1,h=-1;return a.type!==0&&(u=o.indexOf(a.doc.key),o=o.delete(a.doc.key)),a.type!==1&&(o=o.add(a.doc),h=o.indexOf(a.doc.key)),{type:$$(a.type),doc:c,oldIndex:u,newIndex:h}})}}(this,t),this._cachedChangesIncludeMetadataChanges=t),this._cachedChanges}toJSON(){if(this.metadata.hasPendingWrites)throw new q(M.FAILED_PRECONDITION,"QuerySnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");const e={};e.type=Dr._jsonSchemaVersion,e.bundleSource="QuerySnapshot",e.bundleName=Rw.newId(),this._firestore._databaseId.database,this._firestore._databaseId.projectId;const t=[],r=[],s=[];return this.docs.forEach(i=>{i._document!==null&&(t.push(i._document),r.push(this._userDataWriter.convertObjectMap(i._document.data.value.mapValue.fields,"previous")),s.push(i.ref.path))}),e.bundle=(this._firestore,this.query._query,e.bundleName,"NOT SUPPORTED"),e}}function j7(n,e,t){if(Ba(e,Dr._jsonSchema)){if(e.bundle===FD)throw new q(M.INVALID_ARGUMENT,"The provided JSON object was created in a client environment, which is not supported.");const r=za(n._databaseId),s=xD(e.bundle,r),i=s.Wu(),o=new px(s.getMetadata(),r);for(const m of i)o.Ga(m);if(o.queries.length!==1)throw new q(M.INVALID_ARGUMENT,`Snapshot data expected 1 query but found ${o.queries.length} queries.`);const a=fg(o.queries[0].bundledQuery),c=o.documents;let u=new ua;c.map(m=>{const y=dg(r,m.document);u=u.add(y)});const h=Ra.fromInitialDocuments(a,u,Le(),!1,!1),f=new Mn(n,t||null,a);return new Dr(n,new Ox(n),f,h)}}function $$(n){switch(n){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return ue(61501,{type:n})}}function L7(n,e){return n instanceof Rr&&e instanceof Rr?n._firestore===e._firestore&&n._key.isEqual(e._key)&&(n._document===null?e._document===null:n._document.isEqual(e._document))&&n._converter===e._converter:n instanceof Dr&&e instanceof Dr&&n._firestore===e._firestore&&ED(n.query,e.query)&&n.metadata.isEqual(e.metadata)&&n._snapshot.isEqual(e._snapshot)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function M7(n){n=Ge(n,yt);const e=Ge(n.firestore,It);return vD(Zt(e),n._key).then(t=>jx(e,n,t))}Dr._jsonSchemaVersion="firestore/querySnapshot/1.0",Dr._jsonSchema={type:vn("string",Dr._jsonSchemaVersion),bundleSource:vn("string","QuerySnapshot"),bundleName:vn("string"),bundle:vn("string")};class Lo extends VD{constructor(e){super(),this.firestore=e}convertBytes(e){return new Cr(e)}convertReference(e){const t=this.convertDocumentKey(e,this.firestore._databaseId);return new yt(this.firestore,null,t)}}function V7(n){n=Ge(n,yt);const e=Ge(n.firestore,It),t=Zt(e),r=new Lo(e);return _$(t,n._key).then(s=>new Rr(e,r,n._key,s,new Yi(s!==null&&s.hasLocalMutations,!0),n.converter))}function F7(n){n=Ge(n,yt);const e=Ge(n.firestore,It);return vD(Zt(e),n._key,{source:"server"}).then(t=>jx(e,n,t))}function wc(n){n=Ge(n,Mn);const e=Ge(n.firestore,It),t=Zt(e),r=new Lo(e);return OD(n._query),wD(t,n._query).then(s=>new Dr(e,r,n,s))}function $7(n){n=Ge(n,Mn);const e=Ge(n.firestore,It),t=Zt(e),r=new Lo(e);return v$(t,n._query).then(s=>new Dr(e,r,n,s))}function U7(n){n=Ge(n,Mn);const e=Ge(n.firestore,It),t=Zt(e),r=new Lo(e);return wD(t,n._query,{source:"server"}).then(s=>new Dr(e,r,n,s))}function B7(n,e,t){n=Ge(n,yt);const r=Ge(n.firestore,It),s=Cg(n.converter,e,t);return Ih(r,[Sg(Ga(r),"setDoc",n._key,s,n.converter!==null,t).toMutation(n._key,Wt.none())])}function z7(n,e,t,...r){n=Ge(n,yt);const s=Ge(n.firestore,It),i=Ga(s);let o;return o=typeof(e=le(e))=="string"||e instanceof qa?Nx(i,"updateDoc",n._key,e,t,r):kx(i,"updateDoc",n._key,e),Ih(s,[o.toMutation(n._key,Wt.exists(!0))])}function q7(n){return Ih(Ge(n.firestore,It),[new Dc(n._key,Wt.none())])}function Ur(n,e){const t=Ge(n.firestore,It),r=C$(n),s=Cg(n.converter,e);return Ih(t,[Sg(Ga(n.firestore),"addDoc",r._key,s,n.converter!==null,{}).toMutation(r._key,Wt.exists(!1))]).then(()=>r)}function dT(n,...e){var c,u,h;n=le(n);let t={includeMetadataChanges:!1,source:"default"},r=0;typeof e[r]!="object"||Ll(e[r])||(t=e[r++]);const s={includeMetadataChanges:t.includeMetadataChanges,source:t.source};if(Ll(e[r])){const f=e[r];e[r]=(c=f.next)==null?void 0:c.bind(f),e[r+1]=(u=f.error)==null?void 0:u.bind(f),e[r+2]=(h=f.complete)==null?void 0:h.bind(f)}let i,o,a;if(n instanceof yt)o=Ge(n.firestore,It),a=Nc(n._key.path),i={next:f=>{e[r]&&e[r](jx(o,n,f))},error:e[r+1],complete:e[r+2]};else{const f=Ge(n,Mn);o=Ge(f.firestore,It),a=f._query;const m=new Lo(o);i={next:y=>{e[r]&&e[r](new Dr(o,m,f,y))},error:e[r+1],complete:e[r+2]},OD(n._query)}return function(m,y,w,S){const R=new vg(S),T=new mx(y,R,w);return m.asyncQueue.enqueueAndForget(async()=>dx(await vc(m),T)),()=>{R.Nu(),m.asyncQueue.enqueueAndForget(async()=>hx(await vc(m),T))}}(Zt(o),a,s,i)}function W7(n,e,...t){const r=le(n),s=function(c){const u={bundle:"",bundleName:"",bundleSource:""},h=["bundle","bundleName","bundleSource"];for(const f of h){if(!(f in c)){u.error=`snapshotJson missing required field: ${f}`;break}const m=c[f];if(typeof m!="string"){u.error=`snapshotJson field '${f}' must be a string.`;break}if(m.length===0){u.error=`snapshotJson field '${f}' cannot be an empty string.`;break}f==="bundle"?u.bundle=m:f==="bundleName"?u.bundleName=m:f==="bundleSource"&&(u.bundleSource=m)}return u}(e);if(s.error)throw new q(M.INVALID_ARGUMENT,s.error);let i,o=0;if(typeof t[o]!="object"||Ll(t[o])||(i=t[o++]),s.bundleSource==="QuerySnapshot"){let a=null;if(typeof t[o]=="object"&&Ll(t[o])){const c=t[o++];a={next:c.next,error:c.error,complete:c.complete}}else a={next:t[o++],error:t[o++],complete:t[o++]};return function(u,h,f,m,y){let w,S=!1;return lT(u,h.bundle).then(()=>R$(u,h.bundleName)).then(T=>{T&&!S&&(y&&T.withConverter(y),w=dT(T,f||{},m))}).catch(T=>(m.error&&m.error(T),()=>{})),()=>{S||(S=!0,w&&w())}}(r,s,i,a,t[o])}if(s.bundleSource==="DocumentSnapshot"){let a=null;if(typeof t[o]=="object"&&Ll(t[o])){const c=t[o++];a={next:c.next,error:c.error,complete:c.complete}}else a={next:t[o++],error:t[o++],complete:t[o++]};return function(u,h,f,m,y){let w,S=!1;return lT(u,h.bundle).then(()=>{if(!S){const T=new yt(u,y||null,se.fromPath(h.bundleName));w=dT(T,f||{},m)}}).catch(T=>(m.error&&m.error(T),()=>{})),()=>{S||(S=!0,w&&w())}}(r,s,i,a,t[o])}throw new q(M.INVALID_ARGUMENT,`unsupported bundle source: ${s.bundleSource}`)}function G7(n,e){return x$(Zt(n=Ge(n,It)),Ll(e)?e:{next:e})}function Ih(n,e){return function(r,s){const i=new On;return r.asyncQueue.enqueueAndForget(async()=>K5(await Ex(r),s,i)),i.promise}(Zt(n),e)}function jx(n,e,t){const r=t.docs.get(e._key),s=new Lo(n);return new Rr(n,s,e._key,r,new Yi(t.hasPendingWrites,t.fromCache),e.converter)}function H7(n){return U$(n,{count:F$()})}function U$(n,e){const t=Ge(n.firestore,It),r=Zt(t),s=CN(e,(i,o)=>new cR(o,i.aggregateType,i._internalFieldPath));return w$(r,n._query,s).then(i=>function(a,c,u){const h=new Lo(a);return new D$(c,h,u)}(t,n,i))}class B${constructor(e){this.kind="memory",this._onlineComponentProvider=bo.provider,this._offlineComponentProvider=e!=null&&e.garbageCollector?e.garbageCollector._offlineComponentProvider:{build:()=>new xx(void 0)}}toJSON(){return{kind:this.kind}}}class z${constructor(e){let t;this.kind="persistent",e!=null&&e.tabManager?(e.tabManager._initialize(e),t=e.tabManager):(t=Q$(void 0),t._initialize(e)),this._onlineComponentProvider=t._onlineComponentProvider,this._offlineComponentProvider=t._offlineComponentProvider}toJSON(){return{kind:this.kind}}}class q${constructor(){this.kind="memoryEager",this._offlineComponentProvider=_c.provider}toJSON(){return{kind:this.kind}}}class W${constructor(e){this.kind="memoryLru",this._offlineComponentProvider={build:()=>new xx(e)}}toJSON(){return{kind:this.kind}}}function Q7(){return new q$}function K7(n){return new W$(n==null?void 0:n.cacheSizeBytes)}function Y7(n){return new B$(n)}function J7(n){return new z$(n)}class G${constructor(e){this.forceOwnership=e,this.kind="persistentSingleTab"}toJSON(){return{kind:this.kind}}_initialize(e){this._onlineComponentProvider=bo.provider,this._offlineComponentProvider={build:t=>new Sx(t,e==null?void 0:e.cacheSizeBytes,this.forceOwnership)}}}class H${constructor(){this.kind="PersistentMultipleTab"}toJSON(){return{kind:this.kind}}_initialize(e){this._onlineComponentProvider=bo.provider,this._offlineComponentProvider={build:t=>new pD(t,e==null?void 0:e.cacheSizeBytes)}}}function Q$(n){return new G$(n==null?void 0:n.forceOwnership)}function X7(){return new H$}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const K$={maxAttempts:5};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Y${constructor(e,t){this._firestore=e,this._commitHandler=t,this._mutations=[],this._committed=!1,this._dataReader=Ga(e)}set(e,t,r){this._verifyNotCommitted();const s=Ji(e,this._firestore),i=Cg(s.converter,t,r),o=Sg(this._dataReader,"WriteBatch.set",s._key,i,s.converter!==null,r);return this._mutations.push(o.toMutation(s._key,Wt.none())),this}update(e,t,r,...s){this._verifyNotCommitted();const i=Ji(e,this._firestore);let o;return o=typeof(t=le(t))=="string"||t instanceof qa?Nx(this._dataReader,"WriteBatch.update",i._key,t,r,s):kx(this._dataReader,"WriteBatch.update",i._key,t),this._mutations.push(o.toMutation(i._key,Wt.exists(!0))),this}delete(e){this._verifyNotCommitted();const t=Ji(e,this._firestore);return this._mutations=this._mutations.concat(new Dc(t._key,Wt.none())),this}commit(){return this._verifyNotCommitted(),this._committed=!0,this._mutations.length>0?this._commitHandler(this._mutations):Promise.resolve()}_verifyNotCommitted(){if(this._committed)throw new q(M.FAILED_PRECONDITION,"A write batch can no longer be used after commit() has been called.")}}function Ji(n,e){if((n=le(n)).firestore!==e)throw new q(M.INVALID_ARGUMENT,"Provided document reference is from a different Firestore instance.");return n}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class J${constructor(e,t){this._firestore=e,this._transaction=t,this._dataReader=Ga(e)}get(e){const t=Ji(e,this._firestore),r=new Ox(this._firestore);return this._transaction.lookup([t._key]).then(s=>{if(!s||s.length!==1)return ue(24041);const i=s[0];if(i.isFoundDocument())return new $d(this._firestore,r,i.key,i,t.converter);if(i.isNoDocument())return new $d(this._firestore,r,t._key,null,t.converter);throw ue(18433,{doc:i})})}set(e,t,r){const s=Ji(e,this._firestore),i=Cg(s.converter,t,r),o=Sg(this._dataReader,"Transaction.set",s._key,i,s.converter!==null,r);return this._transaction.set(s._key,o),this}update(e,t,r,...s){const i=Ji(e,this._firestore);let o;return o=typeof(t=le(t))=="string"||t instanceof qa?Nx(this._dataReader,"Transaction.update",i._key,t,r,s):kx(this._dataReader,"Transaction.update",i._key,t),this._transaction.update(i._key,o),this}delete(e){const t=Ji(e,this._firestore);return this._transaction.delete(t._key),this}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class X$ extends J${constructor(e,t){super(e,t),this._firestore=e}get(e){const t=Ji(e,this._firestore),r=new Lo(this._firestore);return super.get(e).then(s=>new Rr(this._firestore,r,t._key,s._document,new Yi(!1,!1),t.converter))}}function Z7(n,e,t){n=Ge(n,It);const r={...K$,...t};return function(i){if(i.maxAttempts<1)throw new q(M.INVALID_ARGUMENT,"Max attempts must be at least 1")}(r),function(i,o,a){const c=new On;return i.asyncQueue.enqueueAndForget(async()=>{const u=await _D(i);new m$(i.asyncQueue,u,a,o,c).ju()}),c.promise}(Zt(n),s=>e(new X$(n,s)),r)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function eW(){return new wh("deleteField")}function Z$(){return new bx("serverTimestamp")}function tW(...n){return new Tx("arrayUnion",n)}function nW(...n){return new Ax("arrayRemove",n)}function rW(n){return new Cx("increment",n)}function sW(n){return new ms(n)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function iW(n){return Zt(n=Ge(n,It)),new Y$(n,e=>Ih(n,e))}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function oW(n,e){const t=Zt(n=Ge(n,It));if(!t._uninitializedComponentsProvider||t._uninitializedComponentsProvider._offline.kind==="memory")return Xr("Cannot enable indexes when persistence is disabled"),Promise.resolve();const r=function(i){const o=typeof i=="string"?function(u){try{return JSON.parse(u)}catch(h){throw new q(M.INVALID_ARGUMENT,"Failed to parse JSON: "+(h==null?void 0:h.message))}}(i):i,a=[];if(Array.isArray(o.indexes))for(const c of o.indexes){const u=hT(c,"collectionGroup"),h=[];if(Array.isArray(c.fields))for(const f of c.fields){const m=Ig("setIndexConfiguration",hT(f,"fieldPath"));f.arrayConfig==="CONTAINS"?h.push(new la(m,2)):f.order==="ASCENDING"?h.push(new la(m,0)):f.order==="DESCENDING"&&h.push(new la(m,1))}a.push(new nc(nc.UNKNOWN_ID,u,h,rc.empty()))}return a}(e);return E$(t,r)}function hT(n,e){if(typeof n[e]!="string")throw new q(M.INVALID_ARGUMENT,"Missing string value for: "+e);return n[e]}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class eU{constructor(e){this._firestore=e,this.type="PersistentCacheIndexManager"}}function aW(n){var s;n=Ge(n,It);const e=fT.get(n);if(e)return e;if(((s=Zt(n)._uninitializedComponentsProvider)==null?void 0:s._offline.kind)!=="persistent")return null;const r=new eU(n);return fT.set(n,r),r}function lW(n){$D(n,!0)}function cW(n){$D(n,!1)}function uW(n){T$(Zt(n._firestore)).then(e=>G("deleting all persistent cache indexes succeeded")).catch(e=>Xr("deleting all persistent cache indexes failed",e))}function $D(n,e){b$(Zt(n._firestore),e).then(t=>G(`setting persistent cache index auto creation isEnabled=${e} succeeded`)).catch(t=>Xr(`setting persistent cache index auto creation isEnabled=${e} failed`,t))}const fT=new WeakMap;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function dW(n){var r;const e=Zt(Ge(n.firestore,It)),t=(r=e._onlineComponents)==null?void 0:r.datastore.serializer;return t===void 0?null:hg(t,nr(n._query)).ft}function hW(n,e){var i;const t=CN(e,(o,a)=>new cR(a,o.aggregateType,o._internalFieldPath)),r=Zt(Ge(n.firestore,It)),s=(i=r._onlineComponents)==null?void 0:i.datastore.serializer;return s===void 0?null:xR(s,HN(n._query),t,!0).request}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class fW{constructor(){throw new Error("instances of this class should not be created")}static onExistenceFilterMismatch(e){return Lx.instance.onExistenceFilterMismatch(e)}}class Lx{constructor(){this.Mc=new Map}static get instance(){return _f||(_f=new Lx,function(t){if(Gu)throw new Error("a TestingHooksSpi instance is already set");Gu=t}(_f)),_f}lt(e){this.Mc.forEach(t=>t(e))}onExistenceFilterMismatch(e){const t=Symbol(),r=this.Mc;return r.set(t,e),()=>r.delete(t)}}let _f=null;(function(e,t=!0){(function(s){kc=s})(Va),gs(new wr("firestore",(r,{instanceIdentifier:s,options:i})=>{const o=r.getProvider("app").getImmediate(),a=new It(new d3(r.getProvider("auth-internal")),new m3(o,r.getProvider("app-check-internal")),function(u,h){if(!Object.prototype.hasOwnProperty.apply(u.options,["projectId"]))throw new q(M.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new Sa(u.options.projectId,h)}(o,s),o);return i={useFetchStreams:t,...i},a._setSettings(i),a},"PUBLIC").setMultipleInstances(!0)),_r(zE,qE,e),_r(zE,qE,"esm2020")})();/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const mW={PHONE:"phone",TOTP:"totp"},pW={FACEBOOK:"facebook.com",GITHUB:"github.com",GOOGLE:"google.com",PASSWORD:"password",PHONE:"phone",TWITTER:"twitter.com"},gW={EMAIL_LINK:"emailLink",EMAIL_PASSWORD:"password",FACEBOOK:"facebook.com",GITHUB:"github.com",GOOGLE:"google.com",PHONE:"phone",TWITTER:"twitter.com"},yW={LINK:"link",REAUTHENTICATE:"reauthenticate",SIGN_IN:"signIn"},_W={EMAIL_SIGNIN:"EMAIL_SIGNIN",PASSWORD_RESET:"PASSWORD_RESET",RECOVER_EMAIL:"RECOVER_EMAIL",REVERT_SECOND_FACTOR_ADDITION:"REVERT_SECOND_FACTOR_ADDITION",VERIFY_AND_CHANGE_EMAIL:"VERIFY_AND_CHANGE_EMAIL",VERIFY_EMAIL:"VERIFY_EMAIL"};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function tU(){return{"admin-restricted-operation":"This operation is restricted to administrators only.","argument-error":"","app-not-authorized":"This app, identified by the domain where it's hosted, is not authorized to use Firebase Authentication with the provided API key. Review your key configuration in the Google API console.","app-not-installed":"The requested mobile application corresponding to the identifier (Android package name or iOS bundle ID) provided is not installed on this device.","captcha-check-failed":"The reCAPTCHA response token provided is either invalid, expired, already used or the domain associated with it does not match the list of whitelisted domains.","code-expired":"The SMS code has expired. Please re-send the verification code to try again.","cordova-not-ready":"Cordova framework is not ready.","cors-unsupported":"This browser is not supported.","credential-already-in-use":"This credential is already associated with a different user account.","custom-token-mismatch":"The custom token corresponds to a different audience.","requires-recent-login":"This operation is sensitive and requires recent authentication. Log in again before retrying this request.","dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK.","dynamic-link-not-activated":"Please activate Dynamic Links in the Firebase Console and agree to the terms and conditions.","email-change-needs-verification":"Multi-factor users must always have a verified email.","email-already-in-use":"The email address is already in use by another account.","emulator-config-failed":'Auth instance has already been used to make a network call. Auth can no longer be configured to use the emulator. Try calling "connectAuthEmulator()" sooner.',"expired-action-code":"The action code has expired.","cancelled-popup-request":"This operation has been cancelled due to another conflicting popup being opened.","internal-error":"An internal AuthError has occurred.","invalid-app-credential":"The phone verification request contains an invalid application verifier. The reCAPTCHA token response is either invalid or expired.","invalid-app-id":"The mobile app identifier is not registered for the current project.","invalid-user-token":"This user's credential isn't valid for this project. This can happen if the user's token has been tampered with, or if the user isn't for the project associated with this API key.","invalid-auth-event":"An internal AuthError has occurred.","invalid-verification-code":"The SMS verification code used to create the phone auth credential is invalid. Please resend the verification code sms and be sure to use the verification code provided by the user.","invalid-continue-uri":"The continue URL provided in the request is invalid.","invalid-cordova-configuration":"The following Cordova plugins must be installed to enable OAuth sign-in: cordova-plugin-buildinfo, cordova-universal-links-plugin, cordova-plugin-browsertab, cordova-plugin-inappbrowser and cordova-plugin-customurlscheme.","invalid-custom-token":"The custom token format is incorrect. Please check the documentation.","invalid-dynamic-link-domain":"The provided dynamic link domain is not configured or authorized for the current project.","invalid-email":"The email address is badly formatted.","invalid-emulator-scheme":"Emulator URL must start with a valid scheme (http:// or https://).","invalid-api-key":"Your API key is invalid, please check you have copied it correctly.","invalid-cert-hash":"The SHA-1 certificate hash provided is invalid.","invalid-credential":"The supplied auth credential is incorrect, malformed or has expired.","invalid-message-payload":"The email template corresponding to this action contains invalid characters in its message. Please fix by going to the Auth email templates section in the Firebase Console.","invalid-multi-factor-session":"The request does not contain a valid proof of first factor successful sign-in.","invalid-oauth-provider":"EmailAuthProvider is not supported for this operation. This operation only supports OAuth providers.","invalid-oauth-client-id":"The OAuth client ID provided is either invalid or does not match the specified API key.","unauthorized-domain":"This domain is not authorized for OAuth operations for your Firebase project. Edit the list of authorized domains from the Firebase console.","invalid-action-code":"The action code is invalid. This can happen if the code is malformed, expired, or has already been used.","wrong-password":"The password is invalid or the user does not have a password.","invalid-persistence-type":"The specified persistence type is invalid. It can only be local, session or none.","invalid-phone-number":"The format of the phone number provided is incorrect. Please enter the phone number in a format that can be parsed into E.164 format. E.164 phone numbers are written in the format [+][country code][subscriber number including area code].","invalid-provider-id":"The specified provider ID is invalid.","invalid-recipient-email":"The email corresponding to this action failed to send as the provided recipient email address is invalid.","invalid-sender":"The email template corresponding to this action contains an invalid sender email or name. Please fix by going to the Auth email templates section in the Firebase Console.","invalid-verification-id":"The verification ID used to create the phone auth credential is invalid.","invalid-tenant-id":"The Auth instance's tenant ID is invalid.","login-blocked":"Login blocked by user-provided method: {$originalMessage}","missing-android-pkg-name":"An Android Package Name must be provided if the Android App is required to be installed.","auth-domain-config-required":"Be sure to include authDomain when calling firebase.initializeApp(), by following the instructions in the Firebase console.","missing-app-credential":"The phone verification request is missing an application verifier assertion. A reCAPTCHA response token needs to be provided.","missing-verification-code":"The phone auth credential was created with an empty SMS verification code.","missing-continue-uri":"A continue URL must be provided in the request.","missing-iframe-start":"An internal AuthError has occurred.","missing-ios-bundle-id":"An iOS Bundle ID must be provided if an App Store ID is provided.","missing-or-invalid-nonce":"The request does not contain a valid nonce. This can occur if the SHA-256 hash of the provided raw nonce does not match the hashed nonce in the ID token payload.","missing-password":"A non-empty password must be provided","missing-multi-factor-info":"No second factor identifier is provided.","missing-multi-factor-session":"The request is missing proof of first factor successful sign-in.","missing-phone-number":"To send verification codes, provide a phone number for the recipient.","missing-verification-id":"The phone auth credential was created with an empty verification ID.","app-deleted":"This instance of FirebaseApp has been deleted.","multi-factor-info-not-found":"The user does not have a second factor matching the identifier provided.","multi-factor-auth-required":"Proof of ownership of a second factor is required to complete sign-in.","account-exists-with-different-credential":"An account already exists with the same email address but different sign-in credentials. Sign in using a provider associated with this email address.","network-request-failed":"A network AuthError (such as timeout, interrupted connection or unreachable host) has occurred.","no-auth-event":"An internal AuthError has occurred.","no-such-provider":"User was not linked to an account with the given provider.","null-user":"A null user object was provided as the argument for an operation which requires a non-null user object.","operation-not-allowed":"The given sign-in provider is disabled for this Firebase project. Enable it in the Firebase console, under the sign-in method tab of the Auth section.","operation-not-supported-in-this-environment":'This operation is not supported in the environment this application is running on. "location.protocol" must be http, https or chrome-extension and web storage must be enabled.',"popup-blocked":"Unable to establish a connection with the popup. It may have been blocked by the browser.","popup-closed-by-user":"The popup has been closed by the user before finalizing the operation.","provider-already-linked":"User can only be linked to one identity for the given provider.","quota-exceeded":"The project's quota for this operation has been exceeded.","redirect-cancelled-by-user":"The redirect operation has been cancelled by the user before finalizing.","redirect-operation-pending":"A redirect sign-in operation is already pending.","rejected-credential":"The request contains malformed or mismatching credentials.","second-factor-already-in-use":"The second factor is already enrolled on this account.","maximum-second-factor-count-exceeded":"The maximum allowed number of second factors on a user has been exceeded.","tenant-id-mismatch":"The provided tenant ID does not match the Auth instance's tenant ID",timeout:"The operation has timed out.","user-token-expired":"The user's credential is no longer valid. The user must sign in again.","too-many-requests":"We have blocked all requests from this device due to unusual activity. Try again later.","unauthorized-continue-uri":"The domain of the continue URL is not whitelisted.  Please whitelist the domain in the Firebase console.","unsupported-first-factor":"Enrolling a second factor or signing in with a multi-factor account requires sign-in with a supported first factor.","unsupported-persistence-type":"The current environment does not support the specified persistence type.","unsupported-tenant-operation":"This operation is not supported in a multi-tenant context.","unverified-email":"The operation requires a verified email.","user-cancelled":"The user did not grant your application the permissions it requested.","user-not-found":"There is no user record corresponding to this identifier. The user may have been deleted.","user-disabled":"The user account has been disabled by an administrator.","user-mismatch":"The supplied credentials do not correspond to the previously signed in user.","user-signed-out":"","weak-password":"The password must be 6 characters long or more.","web-storage-unsupported":"This browser is not supported or 3rd party cookies and data may be disabled.","already-initialized":"initializeAuth() has already been called with different options. To avoid this error, call initializeAuth() with the same options as when it was originally called, or call getAuth() to return the already initialized instance.","missing-recaptcha-token":"The reCAPTCHA token is missing when sending request to the backend.","invalid-recaptcha-token":"The reCAPTCHA token is invalid when sending request to the backend.","invalid-recaptcha-action":"The reCAPTCHA action is invalid when sending request to the backend.","recaptcha-not-enabled":"reCAPTCHA Enterprise integration is not enabled for this project.","missing-client-type":"The reCAPTCHA client type is missing when sending request to the backend.","missing-recaptcha-version":"The reCAPTCHA version is missing when sending request to the backend.","invalid-req-type":"Invalid request parameters.","invalid-recaptcha-version":"The reCAPTCHA version is invalid when sending request to the backend.","unsupported-password-policy-schema-version":"The password policy received from the backend uses a schema version that is not supported by this version of the Firebase SDK.","password-does-not-meet-requirements":"The password does not meet the requirements.","invalid-hosting-link-domain":"The provided Hosting link domain is not configured in Firebase Hosting or is not owned by the current project. This cannot be a default Hosting domain (`web.app` or `firebaseapp.com`)."}}function UD(){return{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}}const vW=tU,nU=UD,BD=new La("auth","Firebase",UD()),wW={ADMIN_ONLY_OPERATION:"auth/admin-restricted-operation",ARGUMENT_ERROR:"auth/argument-error",APP_NOT_AUTHORIZED:"auth/app-not-authorized",APP_NOT_INSTALLED:"auth/app-not-installed",CAPTCHA_CHECK_FAILED:"auth/captcha-check-failed",CODE_EXPIRED:"auth/code-expired",CORDOVA_NOT_READY:"auth/cordova-not-ready",CORS_UNSUPPORTED:"auth/cors-unsupported",CREDENTIAL_ALREADY_IN_USE:"auth/credential-already-in-use",CREDENTIAL_MISMATCH:"auth/custom-token-mismatch",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"auth/requires-recent-login",DEPENDENT_SDK_INIT_BEFORE_AUTH:"auth/dependent-sdk-initialized-before-auth",DYNAMIC_LINK_NOT_ACTIVATED:"auth/dynamic-link-not-activated",EMAIL_CHANGE_NEEDS_VERIFICATION:"auth/email-change-needs-verification",EMAIL_EXISTS:"auth/email-already-in-use",EMULATOR_CONFIG_FAILED:"auth/emulator-config-failed",EXPIRED_OOB_CODE:"auth/expired-action-code",EXPIRED_POPUP_REQUEST:"auth/cancelled-popup-request",INTERNAL_ERROR:"auth/internal-error",INVALID_API_KEY:"auth/invalid-api-key",INVALID_APP_CREDENTIAL:"auth/invalid-app-credential",INVALID_APP_ID:"auth/invalid-app-id",INVALID_AUTH:"auth/invalid-user-token",INVALID_AUTH_EVENT:"auth/invalid-auth-event",INVALID_CERT_HASH:"auth/invalid-cert-hash",INVALID_CODE:"auth/invalid-verification-code",INVALID_CONTINUE_URI:"auth/invalid-continue-uri",INVALID_CORDOVA_CONFIGURATION:"auth/invalid-cordova-configuration",INVALID_CUSTOM_TOKEN:"auth/invalid-custom-token",INVALID_DYNAMIC_LINK_DOMAIN:"auth/invalid-dynamic-link-domain",INVALID_EMAIL:"auth/invalid-email",INVALID_EMULATOR_SCHEME:"auth/invalid-emulator-scheme",INVALID_IDP_RESPONSE:"auth/invalid-credential",INVALID_LOGIN_CREDENTIALS:"auth/invalid-credential",INVALID_MESSAGE_PAYLOAD:"auth/invalid-message-payload",INVALID_MFA_SESSION:"auth/invalid-multi-factor-session",INVALID_OAUTH_CLIENT_ID:"auth/invalid-oauth-client-id",INVALID_OAUTH_PROVIDER:"auth/invalid-oauth-provider",INVALID_OOB_CODE:"auth/invalid-action-code",INVALID_ORIGIN:"auth/unauthorized-domain",INVALID_PASSWORD:"auth/wrong-password",INVALID_PERSISTENCE:"auth/invalid-persistence-type",INVALID_PHONE_NUMBER:"auth/invalid-phone-number",INVALID_PROVIDER_ID:"auth/invalid-provider-id",INVALID_RECIPIENT_EMAIL:"auth/invalid-recipient-email",INVALID_SENDER:"auth/invalid-sender",INVALID_SESSION_INFO:"auth/invalid-verification-id",INVALID_TENANT_ID:"auth/invalid-tenant-id",MFA_INFO_NOT_FOUND:"auth/multi-factor-info-not-found",MFA_REQUIRED:"auth/multi-factor-auth-required",MISSING_ANDROID_PACKAGE_NAME:"auth/missing-android-pkg-name",MISSING_APP_CREDENTIAL:"auth/missing-app-credential",MISSING_AUTH_DOMAIN:"auth/auth-domain-config-required",MISSING_CODE:"auth/missing-verification-code",MISSING_CONTINUE_URI:"auth/missing-continue-uri",MISSING_IFRAME_START:"auth/missing-iframe-start",MISSING_IOS_BUNDLE_ID:"auth/missing-ios-bundle-id",MISSING_OR_INVALID_NONCE:"auth/missing-or-invalid-nonce",MISSING_MFA_INFO:"auth/missing-multi-factor-info",MISSING_MFA_SESSION:"auth/missing-multi-factor-session",MISSING_PHONE_NUMBER:"auth/missing-phone-number",MISSING_SESSION_INFO:"auth/missing-verification-id",MODULE_DESTROYED:"auth/app-deleted",NEED_CONFIRMATION:"auth/account-exists-with-different-credential",NETWORK_REQUEST_FAILED:"auth/network-request-failed",NULL_USER:"auth/null-user",NO_AUTH_EVENT:"auth/no-auth-event",NO_SUCH_PROVIDER:"auth/no-such-provider",OPERATION_NOT_ALLOWED:"auth/operation-not-allowed",OPERATION_NOT_SUPPORTED:"auth/operation-not-supported-in-this-environment",POPUP_BLOCKED:"auth/popup-blocked",POPUP_CLOSED_BY_USER:"auth/popup-closed-by-user",PROVIDER_ALREADY_LINKED:"auth/provider-already-linked",QUOTA_EXCEEDED:"auth/quota-exceeded",REDIRECT_CANCELLED_BY_USER:"auth/redirect-cancelled-by-user",REDIRECT_OPERATION_PENDING:"auth/redirect-operation-pending",REJECTED_CREDENTIAL:"auth/rejected-credential",SECOND_FACTOR_ALREADY_ENROLLED:"auth/second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"auth/maximum-second-factor-count-exceeded",TENANT_ID_MISMATCH:"auth/tenant-id-mismatch",TIMEOUT:"auth/timeout",TOKEN_EXPIRED:"auth/user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"auth/too-many-requests",UNAUTHORIZED_DOMAIN:"auth/unauthorized-continue-uri",UNSUPPORTED_FIRST_FACTOR:"auth/unsupported-first-factor",UNSUPPORTED_PERSISTENCE:"auth/unsupported-persistence-type",UNSUPPORTED_TENANT_OPERATION:"auth/unsupported-tenant-operation",UNVERIFIED_EMAIL:"auth/unverified-email",USER_CANCELLED:"auth/user-cancelled",USER_DELETED:"auth/user-not-found",USER_DISABLED:"auth/user-disabled",USER_MISMATCH:"auth/user-mismatch",USER_SIGNED_OUT:"auth/user-signed-out",WEAK_PASSWORD:"auth/weak-password",WEB_STORAGE_UNSUPPORTED:"auth/web-storage-unsupported",ALREADY_INITIALIZED:"auth/already-initialized",RECAPTCHA_NOT_ENABLED:"auth/recaptcha-not-enabled",MISSING_RECAPTCHA_TOKEN:"auth/missing-recaptcha-token",INVALID_RECAPTCHA_TOKEN:"auth/invalid-recaptcha-token",INVALID_RECAPTCHA_ACTION:"auth/invalid-recaptcha-action",MISSING_CLIENT_TYPE:"auth/missing-client-type",MISSING_RECAPTCHA_VERSION:"auth/missing-recaptcha-version",INVALID_RECAPTCHA_VERSION:"auth/invalid-recaptcha-version",INVALID_REQ_TYPE:"auth/invalid-req-type",INVALID_HOSTING_LINK_DOMAIN:"auth/invalid-hosting-link-domain"};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ap=new Xd("@firebase/auth");function rU(n,...e){ap.logLevel<=We.WARN&&ap.warn(`Auth (${Va}): ${n}`,...e)}function Xf(n,...e){ap.logLevel<=We.ERROR&&ap.error(`Auth (${Va}): ${n}`,...e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function xr(n,...e){throw Vx(n,...e)}function ar(n,...e){return Vx(n,...e)}function Mx(n,e,t){const r={...nU(),[e]:t};return new La("auth","Firebase",r).create(e,{appName:n.name})}function jn(n){return Mx(n,"operation-not-supported-in-this-environment","Operations that alter the current user are not supported in conjunction with FirebaseServerApp")}function Fc(n,e,t){const r=t;if(!(e instanceof r))throw r.name!==e.constructor.name&&xr(n,"argument-error"),Mx(n,"argument-error",`Type of ${e.constructor.name} does not match expected instance.Did you pass a reference from a different Auth SDK?`)}function Vx(n,...e){if(typeof n!="string"){const t=e[0],r=[...e.slice(1)];return r[0]&&(r[0].appName=n.name),n._errorFactory.create(t,...r)}return BD.create(n,...e)}function X(n,e,...t){if(!n)throw Vx(e,...t)}function Rs(n){const e="INTERNAL ASSERTION FAILED: "+n;throw Xf(e),new Error(e)}function gi(n,e){n||Rs(e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ud(){var n;return typeof self<"u"&&((n=self.location)==null?void 0:n.href)||""}function Fx(){return mT()==="http:"||mT()==="https:"}function mT(){var n;return typeof self<"u"&&((n=self.location)==null?void 0:n.protocol)||null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function sU(){return typeof navigator<"u"&&navigator&&"onLine"in navigator&&typeof navigator.onLine=="boolean"&&(Fx()||z0()||"connection"in navigator)?navigator.onLine:!0}function iU(){if(typeof navigator>"u")return null;const n=navigator;return n.languages&&n.languages[0]||n.language||null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Eh{constructor(e,t){this.shortDelay=e,this.longDelay=t,gi(t>e,"Short delay should be less than long delay!"),this.isMobile=B0()||IC()}get(){return sU()?this.isMobile?this.longDelay:this.shortDelay:Math.min(5e3,this.shortDelay)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function $x(n,e){gi(n.emulator,"Emulator should always be set here");const{url:t}=n.emulator;return e?`${t}${e.startsWith("/")?e.slice(1):e}`:t}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class zD{static initialize(e,t,r){this.fetchImpl=e,t&&(this.headersImpl=t),r&&(this.responseImpl=r)}static fetch(){if(this.fetchImpl)return this.fetchImpl;if(typeof self<"u"&&"fetch"in self)return self.fetch;if(typeof globalThis<"u"&&globalThis.fetch)return globalThis.fetch;if(typeof fetch<"u")return fetch;Rs("Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static headers(){if(this.headersImpl)return this.headersImpl;if(typeof self<"u"&&"Headers"in self)return self.Headers;if(typeof globalThis<"u"&&globalThis.Headers)return globalThis.Headers;if(typeof Headers<"u")return Headers;Rs("Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static response(){if(this.responseImpl)return this.responseImpl;if(typeof self<"u"&&"Response"in self)return self.Response;if(typeof globalThis<"u"&&globalThis.Response)return globalThis.Response;if(typeof Response<"u")return Response;Rs("Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const oU={CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_PASSWORD:"wrong-password",MISSING_PASSWORD:"missing-password",INVALID_LOGIN_CREDENTIALS:"invalid-credential",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_REQ_TYPE:"internal-error",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",PASSWORD_DOES_NOT_MEET_REQUIREMENTS:"password-does-not-meet-requirements",INVALID_CODE:"invalid-verification-code",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_SESSION_INFO:"missing-verification-id",SESSION_EXPIRED:"code-expired",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",ADMIN_ONLY_OPERATION:"admin-restricted-operation",INVALID_MFA_PENDING_CREDENTIAL:"invalid-multi-factor-session",MFA_ENROLLMENT_NOT_FOUND:"multi-factor-info-not-found",MISSING_MFA_ENROLLMENT_ID:"missing-multi-factor-info",MISSING_MFA_PENDING_CREDENTIAL:"missing-multi-factor-session",SECOND_FACTOR_EXISTS:"second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"maximum-second-factor-count-exceeded",BLOCKING_FUNCTION_ERROR_RESPONSE:"internal-error",RECAPTCHA_NOT_ENABLED:"recaptcha-not-enabled",MISSING_RECAPTCHA_TOKEN:"missing-recaptcha-token",INVALID_RECAPTCHA_TOKEN:"invalid-recaptcha-token",INVALID_RECAPTCHA_ACTION:"invalid-recaptcha-action",MISSING_CLIENT_TYPE:"missing-client-type",MISSING_RECAPTCHA_VERSION:"missing-recaptcha-version",INVALID_RECAPTCHA_VERSION:"invalid-recaptcha-version",INVALID_REQ_TYPE:"invalid-req-type"};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const aU=["/v1/accounts:signInWithCustomToken","/v1/accounts:signInWithEmailLink","/v1/accounts:signInWithIdp","/v1/accounts:signInWithPassword","/v1/accounts:signInWithPhoneNumber","/v1/token"],lU=new Eh(3e4,6e4);function Vt(n,e){return n.tenantId&&!e.tenantId?{...e,tenantId:n.tenantId}:e}async function Ft(n,e,t,r,s={}){return qD(n,s,async()=>{let i={},o={};r&&(e==="GET"?o=r:i={body:JSON.stringify(r)});const a=Ma({key:n.config.apiKey,...o}).slice(1),c=await n._getAdditionalHeaders();c["Content-Type"]="application/json",n.languageCode&&(c["X-Firebase-Locale"]=n.languageCode);const u={method:e,headers:c,...i};return yL()||(u.referrerPolicy="no-referrer"),n.emulatorConfig&&wi(n.emulatorConfig.host)&&(u.credentials="include"),zD.fetch()(await WD(n,n.config.apiHost,t,a),u)})}async function qD(n,e,t){n._canInitEmulator=!1;const r={...oU,...e};try{const s=new uU(n),i=await Promise.race([t(),s.promise]);s.clearNetworkTimeout();const o=await i.json();if("needConfirmation"in o)throw Eu(n,"account-exists-with-different-credential",o);if(i.ok&&!("errorMessage"in o))return o;{const a=i.ok?o.errorMessage:o.error.message,[c,u]=a.split(" : ");if(c==="FEDERATED_USER_ID_ALREADY_LINKED")throw Eu(n,"credential-already-in-use",o);if(c==="EMAIL_EXISTS")throw Eu(n,"email-already-in-use",o);if(c==="USER_DISABLED")throw Eu(n,"user-disabled",o);const h=r[c]||c.toLowerCase().replace(/[_\s]+/g,"-");if(u)throw Mx(n,h,u);xr(n,h)}}catch(s){if(s instanceof ys)throw s;xr(n,"network-request-failed",{message:String(s)})}}async function bi(n,e,t,r,s={}){const i=await Ft(n,e,t,r,s);return"mfaPendingCredential"in i&&xr(n,"multi-factor-auth-required",{_serverResponse:i}),i}async function WD(n,e,t,r){const s=`${e}${t}?${r}`,i=n,o=i.config.emulator?$x(n.config,s):`${n.config.apiScheme}://${s}`;return aU.includes(t)&&(await i._persistenceManagerAvailable,i._getPersistenceType()==="COOKIE")?i._getPersistence()._getFinalTarget(o).toString():o}function cU(n){switch(n){case"ENFORCE":return"ENFORCE";case"AUDIT":return"AUDIT";case"OFF":return"OFF";default:return"ENFORCEMENT_STATE_UNSPECIFIED"}}class uU{clearNetworkTimeout(){clearTimeout(this.timer)}constructor(e){this.auth=e,this.timer=null,this.promise=new Promise((t,r)=>{this.timer=setTimeout(()=>r(ar(this.auth,"network-request-failed")),lU.get())})}}function Eu(n,e,t){const r={appName:n.name};t.email&&(r.email=t.email),t.phoneNumber&&(r.phoneNumber=t.phoneNumber);const s=ar(n,e,r);return s.customData._tokenResponse=t,s}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function pT(n){return n!==void 0&&n.getResponse!==void 0}function gT(n){return n!==void 0&&n.enterprise!==void 0}class GD{constructor(e){if(this.siteKey="",this.recaptchaEnforcementState=[],e.recaptchaKey===void 0)throw new Error("recaptchaKey undefined");this.siteKey=e.recaptchaKey.split("/")[3],this.recaptchaEnforcementState=e.recaptchaEnforcementState}getProviderEnforcementState(e){if(!this.recaptchaEnforcementState||this.recaptchaEnforcementState.length===0)return null;for(const t of this.recaptchaEnforcementState)if(t.provider&&t.provider===e)return cU(t.enforcementState);return null}isProviderEnabled(e){return this.getProviderEnforcementState(e)==="ENFORCE"||this.getProviderEnforcementState(e)==="AUDIT"}isAnyProviderEnabled(){return this.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")||this.isProviderEnabled("PHONE_PROVIDER")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function dU(n){return(await Ft(n,"GET","/v1/recaptchaParams")).recaptchaSiteKey||""}async function HD(n,e){return Ft(n,"GET","/v2/recaptchaConfig",Vt(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function hU(n,e){return Ft(n,"POST","/v1/accounts:delete",e)}async function fU(n,e){return Ft(n,"POST","/v1/accounts:update",e)}async function lp(n,e){return Ft(n,"POST","/v1/accounts:lookup",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Qu(n){if(n)try{const e=new Date(Number(n));if(!isNaN(e.getTime()))return e.toUTCString()}catch{}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function xW(n,e=!1){return le(n).getIdToken(e)}async function mU(n,e=!1){const t=le(n),r=await t.getIdToken(e),s=kg(r);X(s&&s.exp&&s.auth_time&&s.iat,t.auth,"internal-error");const i=typeof s.firebase=="object"?s.firebase:void 0,o=i==null?void 0:i.sign_in_provider;return{claims:s,token:r,authTime:Qu(Uy(s.auth_time)),issuedAtTime:Qu(Uy(s.iat)),expirationTime:Qu(Uy(s.exp)),signInProvider:o||null,signInSecondFactor:(i==null?void 0:i.sign_in_second_factor)||null}}function Uy(n){return Number(n)*1e3}function kg(n){const[e,t,r]=n.split(".");if(e===void 0||t===void 0||r===void 0)return Xf("JWT malformed, contained fewer than 3 sections"),null;try{const s=Cm(t);return s?JSON.parse(s):(Xf("Failed to decode base64 JWT payload"),null)}catch(s){return Xf("Caught error parsing JWT payload as JSON",s==null?void 0:s.toString()),null}}function yT(n){const e=kg(n);return X(e,"internal-error"),X(typeof e.exp<"u","internal-error"),X(typeof e.iat<"u","internal-error"),Number(e.exp)-Number(e.iat)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function yi(n,e,t=!1){if(t)return e;try{return await e}catch(r){throw r instanceof ys&&pU(r)&&n.auth.currentUser===n&&await n.auth.signOut(),r}}function pU({code:n}){return n==="auth/user-disabled"||n==="auth/user-token-expired"}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class gU{constructor(e){this.user=e,this.isRunning=!1,this.timerId=null,this.errorBackoff=3e4}_start(){this.isRunning||(this.isRunning=!0,this.schedule())}_stop(){this.isRunning&&(this.isRunning=!1,this.timerId!==null&&clearTimeout(this.timerId))}getInterval(e){if(e){const t=this.errorBackoff;return this.errorBackoff=Math.min(this.errorBackoff*2,96e4),t}else{this.errorBackoff=3e4;const r=(this.user.stsTokenManager.expirationTime??0)-Date.now()-3e5;return Math.max(0,r)}}schedule(e=!1){if(!this.isRunning)return;const t=this.getInterval(e);this.timerId=setTimeout(async()=>{await this.iteration()},t)}async iteration(){try{await this.user.getIdToken(!0)}catch(e){(e==null?void 0:e.code)==="auth/network-request-failed"&&this.schedule(!0);return}this.schedule()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Bv{constructor(e,t){this.createdAt=e,this.lastLoginAt=t,this._initializeTime()}_initializeTime(){this.lastSignInTime=Qu(this.lastLoginAt),this.creationTime=Qu(this.createdAt)}_copy(e){this.createdAt=e.createdAt,this.lastLoginAt=e.lastLoginAt,this._initializeTime()}toJSON(){return{createdAt:this.createdAt,lastLoginAt:this.lastLoginAt}}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Bd(n){var f;const e=n.auth,t=await n.getIdToken(),r=await yi(n,lp(e,{idToken:t}));X(r==null?void 0:r.users.length,e,"internal-error");const s=r.users[0];n._notifyReloadListener(s);const i=(f=s.providerUserInfo)!=null&&f.length?QD(s.providerUserInfo):[],o=_U(n.providerData,i),a=n.isAnonymous,c=!(n.email&&s.passwordHash)&&!(o!=null&&o.length),u=a?c:!1,h={uid:s.localId,displayName:s.displayName||null,photoURL:s.photoUrl||null,email:s.email||null,emailVerified:s.emailVerified||!1,phoneNumber:s.phoneNumber||null,tenantId:s.tenantId||null,providerData:o,metadata:new Bv(s.createdAt,s.lastLoginAt),isAnonymous:u};Object.assign(n,h)}async function yU(n){const e=le(n);await Bd(e),await e.auth._persistUserIfCurrent(e),e.auth._notifyListenersIfCurrent(e)}function _U(n,e){return[...n.filter(r=>!e.some(s=>s.providerId===r.providerId)),...e]}function QD(n){return n.map(({providerId:e,...t})=>({providerId:e,uid:t.rawId||"",displayName:t.displayName||null,email:t.email||null,phoneNumber:t.phoneNumber||null,photoURL:t.photoUrl||null}))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function vU(n,e){const t=await qD(n,{},async()=>{const r=Ma({grant_type:"refresh_token",refresh_token:e}).slice(1),{tokenApiHost:s,apiKey:i}=n.config,o=await WD(n,s,"/v1/token",`key=${i}`),a=await n._getAdditionalHeaders();a["Content-Type"]="application/x-www-form-urlencoded";const c={method:"POST",headers:a,body:r};return n.emulatorConfig&&wi(n.emulatorConfig.host)&&(c.credentials="include"),zD.fetch()(o,c)});return{accessToken:t.access_token,expiresIn:t.expires_in,refreshToken:t.refresh_token}}async function wU(n,e){return Ft(n,"POST","/v2/accounts:revokeToken",Vt(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ml{constructor(){this.refreshToken=null,this.accessToken=null,this.expirationTime=null}get isExpired(){return!this.expirationTime||Date.now()>this.expirationTime-3e4}updateFromServerResponse(e){X(e.idToken,"internal-error"),X(typeof e.idToken<"u","internal-error"),X(typeof e.refreshToken<"u","internal-error");const t="expiresIn"in e&&typeof e.expiresIn<"u"?Number(e.expiresIn):yT(e.idToken);this.updateTokensAndExpiration(e.idToken,e.refreshToken,t)}updateFromIdToken(e){X(e.length!==0,"internal-error");const t=yT(e);this.updateTokensAndExpiration(e,null,t)}async getToken(e,t=!1){return!t&&this.accessToken&&!this.isExpired?this.accessToken:(X(this.refreshToken,e,"user-token-expired"),this.refreshToken?(await this.refresh(e,this.refreshToken),this.accessToken):null)}clearRefreshToken(){this.refreshToken=null}async refresh(e,t){const{accessToken:r,refreshToken:s,expiresIn:i}=await vU(e,t);this.updateTokensAndExpiration(r,s,Number(i))}updateTokensAndExpiration(e,t,r){this.refreshToken=t||null,this.accessToken=e||null,this.expirationTime=Date.now()+r*1e3}static fromJSON(e,t){const{refreshToken:r,accessToken:s,expirationTime:i}=t,o=new Ml;return r&&(X(typeof r=="string","internal-error",{appName:e}),o.refreshToken=r),s&&(X(typeof s=="string","internal-error",{appName:e}),o.accessToken=s),i&&(X(typeof i=="number","internal-error",{appName:e}),o.expirationTime=i),o}toJSON(){return{refreshToken:this.refreshToken,accessToken:this.accessToken,expirationTime:this.expirationTime}}_assign(e){this.accessToken=e.accessToken,this.refreshToken=e.refreshToken,this.expirationTime=e.expirationTime}_clone(){return Object.assign(new Ml,this.toJSON())}_performRefresh(){return Rs("not implemented")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Oi(n,e){X(typeof n=="string"||typeof n>"u","internal-error",{appName:e})}class us{constructor({uid:e,auth:t,stsTokenManager:r,...s}){this.providerId="firebase",this.proactiveRefresh=new gU(this),this.reloadUserInfo=null,this.reloadListener=null,this.uid=e,this.auth=t,this.stsTokenManager=r,this.accessToken=r.accessToken,this.displayName=s.displayName||null,this.email=s.email||null,this.emailVerified=s.emailVerified||!1,this.phoneNumber=s.phoneNumber||null,this.photoURL=s.photoURL||null,this.isAnonymous=s.isAnonymous||!1,this.tenantId=s.tenantId||null,this.providerData=s.providerData?[...s.providerData]:[],this.metadata=new Bv(s.createdAt||void 0,s.lastLoginAt||void 0)}async getIdToken(e){const t=await yi(this,this.stsTokenManager.getToken(this.auth,e));return X(t,this.auth,"internal-error"),this.accessToken!==t&&(this.accessToken=t,await this.auth._persistUserIfCurrent(this),this.auth._notifyListenersIfCurrent(this)),t}getIdTokenResult(e){return mU(this,e)}reload(){return yU(this)}_assign(e){this!==e&&(X(this.uid===e.uid,this.auth,"internal-error"),this.displayName=e.displayName,this.photoURL=e.photoURL,this.email=e.email,this.emailVerified=e.emailVerified,this.phoneNumber=e.phoneNumber,this.isAnonymous=e.isAnonymous,this.tenantId=e.tenantId,this.providerData=e.providerData.map(t=>({...t})),this.metadata._copy(e.metadata),this.stsTokenManager._assign(e.stsTokenManager))}_clone(e){const t=new us({...this,auth:e,stsTokenManager:this.stsTokenManager._clone()});return t.metadata._copy(this.metadata),t}_onReload(e){X(!this.reloadListener,this.auth,"internal-error"),this.reloadListener=e,this.reloadUserInfo&&(this._notifyReloadListener(this.reloadUserInfo),this.reloadUserInfo=null)}_notifyReloadListener(e){this.reloadListener?this.reloadListener(e):this.reloadUserInfo=e}_startProactiveRefresh(){this.proactiveRefresh._start()}_stopProactiveRefresh(){this.proactiveRefresh._stop()}async _updateTokensIfNecessary(e,t=!1){let r=!1;e.idToken&&e.idToken!==this.stsTokenManager.accessToken&&(this.stsTokenManager.updateFromServerResponse(e),r=!0),t&&await Bd(this),await this.auth._persistUserIfCurrent(this),r&&this.auth._notifyListenersIfCurrent(this)}async delete(){if(Bt(this.auth.app))return Promise.reject(jn(this.auth));const e=await this.getIdToken();return await yi(this,hU(this.auth,{idToken:e})),this.stsTokenManager.clearRefreshToken(),this.auth.signOut()}toJSON(){return{uid:this.uid,email:this.email||void 0,emailVerified:this.emailVerified,displayName:this.displayName||void 0,isAnonymous:this.isAnonymous,photoURL:this.photoURL||void 0,phoneNumber:this.phoneNumber||void 0,tenantId:this.tenantId||void 0,providerData:this.providerData.map(e=>({...e})),stsTokenManager:this.stsTokenManager.toJSON(),_redirectEventId:this._redirectEventId,...this.metadata.toJSON(),apiKey:this.auth.config.apiKey,appName:this.auth.name}}get refreshToken(){return this.stsTokenManager.refreshToken||""}static _fromJSON(e,t){const r=t.displayName??void 0,s=t.email??void 0,i=t.phoneNumber??void 0,o=t.photoURL??void 0,a=t.tenantId??void 0,c=t._redirectEventId??void 0,u=t.createdAt??void 0,h=t.lastLoginAt??void 0,{uid:f,emailVerified:m,isAnonymous:y,providerData:w,stsTokenManager:S}=t;X(f&&S,e,"internal-error");const R=Ml.fromJSON(this.name,S);X(typeof f=="string",e,"internal-error"),Oi(r,e.name),Oi(s,e.name),X(typeof m=="boolean",e,"internal-error"),X(typeof y=="boolean",e,"internal-error"),Oi(i,e.name),Oi(o,e.name),Oi(a,e.name),Oi(c,e.name),Oi(u,e.name),Oi(h,e.name);const T=new us({uid:f,auth:e,email:s,emailVerified:m,displayName:r,isAnonymous:y,photoURL:o,phoneNumber:i,tenantId:a,stsTokenManager:R,createdAt:u,lastLoginAt:h});return w&&Array.isArray(w)&&(T.providerData=w.map(I=>({...I}))),c&&(T._redirectEventId=c),T}static async _fromIdTokenResponse(e,t,r=!1){const s=new Ml;s.updateFromServerResponse(t);const i=new us({uid:t.localId,auth:e,stsTokenManager:s,isAnonymous:r});return await Bd(i),i}static async _fromGetAccountInfoResponse(e,t,r){const s=t.users[0];X(s.localId!==void 0,"internal-error");const i=s.providerUserInfo!==void 0?QD(s.providerUserInfo):[],o=!(s.email&&s.passwordHash)&&!(i!=null&&i.length),a=new Ml;a.updateFromIdToken(r);const c=new us({uid:s.localId,auth:e,stsTokenManager:a,isAnonymous:o}),u={uid:s.localId,displayName:s.displayName||null,photoURL:s.photoUrl||null,email:s.email||null,emailVerified:s.emailVerified||!1,phoneNumber:s.phoneNumber||null,tenantId:s.tenantId||null,providerData:i,metadata:new Bv(s.createdAt,s.lastLoginAt),isAnonymous:!(s.email&&s.passwordHash)&&!(i!=null&&i.length)};return Object.assign(c,u),c}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const _T=new Map;function ri(n){gi(n instanceof Function,"Expected a class definition");let e=_T.get(n);return e?(gi(e instanceof n,"Instance stored in cache mismatched with class"),e):(e=new n,_T.set(n,e),e)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class KD{constructor(){this.type="NONE",this.storage={}}async _isAvailable(){return!0}async _set(e,t){this.storage[e]=t}async _get(e){const t=this.storage[e];return t===void 0?null:t}async _remove(e){delete this.storage[e]}_addListener(e,t){}_removeListener(e,t){}}KD.type="NONE";const vT=KD;/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Zf(n,e,t){return`firebase:${n}:${e}:${t}`}class Vl{constructor(e,t,r){this.persistence=e,this.auth=t,this.userKey=r;const{config:s,name:i}=this.auth;this.fullUserKey=Zf(this.userKey,s.apiKey,i),this.fullPersistenceKey=Zf("persistence",s.apiKey,i),this.boundEventHandler=t._onStorageEvent.bind(t),this.persistence._addListener(this.fullUserKey,this.boundEventHandler)}setCurrentUser(e){return this.persistence._set(this.fullUserKey,e.toJSON())}async getCurrentUser(){const e=await this.persistence._get(this.fullUserKey);if(!e)return null;if(typeof e=="string"){const t=await lp(this.auth,{idToken:e}).catch(()=>{});return t?us._fromGetAccountInfoResponse(this.auth,t,e):null}return us._fromJSON(this.auth,e)}removeCurrentUser(){return this.persistence._remove(this.fullUserKey)}savePersistenceForRedirect(){return this.persistence._set(this.fullPersistenceKey,this.persistence.type)}async setPersistence(e){if(this.persistence===e)return;const t=await this.getCurrentUser();if(await this.removeCurrentUser(),this.persistence=e,t)return this.setCurrentUser(t)}delete(){this.persistence._removeListener(this.fullUserKey,this.boundEventHandler)}static async create(e,t,r="authUser"){if(!t.length)return new Vl(ri(vT),e,r);const s=(await Promise.all(t.map(async u=>{if(await u._isAvailable())return u}))).filter(u=>u);let i=s[0]||ri(vT);const o=Zf(r,e.config.apiKey,e.name);let a=null;for(const u of t)try{const h=await u._get(o);if(h){let f;if(typeof h=="string"){const m=await lp(e,{idToken:h}).catch(()=>{});if(!m)break;f=await us._fromGetAccountInfoResponse(e,m,h)}else f=us._fromJSON(e,h);u!==i&&(a=f),i=u;break}}catch{}const c=s.filter(u=>u._shouldAllowMigration);return!i._shouldAllowMigration||!c.length?new Vl(i,e,r):(i=c[0],a&&await i._set(o,a.toJSON()),await Promise.all(t.map(async u=>{if(u!==i)try{await u._remove(o)}catch{}})),new Vl(i,e,r))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function wT(n){const e=n.toLowerCase();if(e.includes("opera/")||e.includes("opr/")||e.includes("opios/"))return"Opera";if(ZD(e))return"IEMobile";if(e.includes("msie")||e.includes("trident/"))return"IE";if(e.includes("edge/"))return"Edge";if(YD(e))return"Firefox";if(e.includes("silk/"))return"Silk";if(tP(e))return"Blackberry";if(nP(e))return"Webos";if(JD(e))return"Safari";if((e.includes("chrome/")||XD(e))&&!e.includes("edge/"))return"Chrome";if(eP(e))return"Android";{const t=/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/,r=n.match(t);if((r==null?void 0:r.length)===2)return r[1]}return"Other"}function YD(n=En()){return/firefox\//i.test(n)}function JD(n=En()){const e=n.toLowerCase();return e.includes("safari/")&&!e.includes("chrome/")&&!e.includes("crios/")&&!e.includes("android")}function XD(n=En()){return/crios\//i.test(n)}function ZD(n=En()){return/iemobile/i.test(n)}function eP(n=En()){return/android/i.test(n)}function tP(n=En()){return/blackberry/i.test(n)}function nP(n=En()){return/webos/i.test(n)}function Ux(n=En()){return/iphone|ipad|ipod/i.test(n)||/macintosh/i.test(n)&&/mobile/i.test(n)}function xU(n=En()){var e;return Ux(n)&&!!((e=window.navigator)!=null&&e.standalone)}function SU(){return _L()&&document.documentMode===10}function rP(n=En()){return Ux(n)||eP(n)||nP(n)||tP(n)||/windows phone/i.test(n)||ZD(n)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function sP(n,e=[]){let t;switch(n){case"Browser":t=wT(En());break;case"Worker":t=`${wT(En())}-${n}`;break;default:t=n}const r=e.length?e.join(","):"FirebaseCore-web";return`${t}/JsCore/${Va}/${r}`}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class IU{constructor(e){this.auth=e,this.queue=[]}pushCallback(e,t){const r=i=>new Promise((o,a)=>{try{const c=e(i);o(c)}catch(c){a(c)}});r.onAbort=t,this.queue.push(r);const s=this.queue.length-1;return()=>{this.queue[s]=()=>Promise.resolve()}}async runMiddleware(e){if(this.auth.currentUser===e)return;const t=[];try{for(const r of this.queue)await r(e),r.onAbort&&t.push(r.onAbort)}catch(r){t.reverse();for(const s of t)try{s()}catch{}throw this.auth._errorFactory.create("login-blocked",{originalMessage:r==null?void 0:r.message})}}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function EU(n,e={}){return Ft(n,"GET","/v2/passwordPolicy",Vt(n,e))}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const bU=6;class TU{constructor(e){var r;const t=e.customStrengthOptions;this.customStrengthOptions={},this.customStrengthOptions.minPasswordLength=t.minPasswordLength??bU,t.maxPasswordLength&&(this.customStrengthOptions.maxPasswordLength=t.maxPasswordLength),t.containsLowercaseCharacter!==void 0&&(this.customStrengthOptions.containsLowercaseLetter=t.containsLowercaseCharacter),t.containsUppercaseCharacter!==void 0&&(this.customStrengthOptions.containsUppercaseLetter=t.containsUppercaseCharacter),t.containsNumericCharacter!==void 0&&(this.customStrengthOptions.containsNumericCharacter=t.containsNumericCharacter),t.containsNonAlphanumericCharacter!==void 0&&(this.customStrengthOptions.containsNonAlphanumericCharacter=t.containsNonAlphanumericCharacter),this.enforcementState=e.enforcementState,this.enforcementState==="ENFORCEMENT_STATE_UNSPECIFIED"&&(this.enforcementState="OFF"),this.allowedNonAlphanumericCharacters=((r=e.allowedNonAlphanumericCharacters)==null?void 0:r.join(""))??"",this.forceUpgradeOnSignin=e.forceUpgradeOnSignin??!1,this.schemaVersion=e.schemaVersion}validatePassword(e){const t={isValid:!0,passwordPolicy:this};return this.validatePasswordLengthOptions(e,t),this.validatePasswordCharacterOptions(e,t),t.isValid&&(t.isValid=t.meetsMinPasswordLength??!0),t.isValid&&(t.isValid=t.meetsMaxPasswordLength??!0),t.isValid&&(t.isValid=t.containsLowercaseLetter??!0),t.isValid&&(t.isValid=t.containsUppercaseLetter??!0),t.isValid&&(t.isValid=t.containsNumericCharacter??!0),t.isValid&&(t.isValid=t.containsNonAlphanumericCharacter??!0),t}validatePasswordLengthOptions(e,t){const r=this.customStrengthOptions.minPasswordLength,s=this.customStrengthOptions.maxPasswordLength;r&&(t.meetsMinPasswordLength=e.length>=r),s&&(t.meetsMaxPasswordLength=e.length<=s)}validatePasswordCharacterOptions(e,t){this.updatePasswordCharacterOptionsStatuses(t,!1,!1,!1,!1);let r;for(let s=0;s<e.length;s++)r=e.charAt(s),this.updatePasswordCharacterOptionsStatuses(t,r>="a"&&r<="z",r>="A"&&r<="Z",r>="0"&&r<="9",this.allowedNonAlphanumericCharacters.includes(r))}updatePasswordCharacterOptionsStatuses(e,t,r,s,i){this.customStrengthOptions.containsLowercaseLetter&&(e.containsLowercaseLetter||(e.containsLowercaseLetter=t)),this.customStrengthOptions.containsUppercaseLetter&&(e.containsUppercaseLetter||(e.containsUppercaseLetter=r)),this.customStrengthOptions.containsNumericCharacter&&(e.containsNumericCharacter||(e.containsNumericCharacter=s)),this.customStrengthOptions.containsNonAlphanumericCharacter&&(e.containsNonAlphanumericCharacter||(e.containsNonAlphanumericCharacter=i))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class AU{constructor(e,t,r,s){this.app=e,this.heartbeatServiceProvider=t,this.appCheckServiceProvider=r,this.config=s,this.currentUser=null,this.emulatorConfig=null,this.operations=Promise.resolve(),this.authStateSubscription=new xT(this),this.idTokenSubscription=new xT(this),this.beforeStateQueue=new IU(this),this.redirectUser=null,this.isProactiveRefreshEnabled=!1,this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION=1,this._canInitEmulator=!0,this._isInitialized=!1,this._deleted=!1,this._initializationPromise=null,this._popupRedirectResolver=null,this._errorFactory=BD,this._agentRecaptchaConfig=null,this._tenantRecaptchaConfigs={},this._projectPasswordPolicy=null,this._tenantPasswordPolicies={},this._resolvePersistenceManagerAvailable=void 0,this.lastNotifiedUid=void 0,this.languageCode=null,this.tenantId=null,this.settings={appVerificationDisabledForTesting:!1},this.frameworks=[],this.name=e.name,this.clientVersion=s.sdkClientVersion,this._persistenceManagerAvailable=new Promise(i=>this._resolvePersistenceManagerAvailable=i)}_initializeWithPersistence(e,t){return t&&(this._popupRedirectResolver=ri(t)),this._initializationPromise=this.queue(async()=>{var r,s,i;if(!this._deleted&&(this.persistenceManager=await Vl.create(this,e),(r=this._resolvePersistenceManagerAvailable)==null||r.call(this),!this._deleted)){if((s=this._popupRedirectResolver)!=null&&s._shouldInitProactively)try{await this._popupRedirectResolver._initialize(this)}catch{}await this.initializeCurrentUser(t),this.lastNotifiedUid=((i=this.currentUser)==null?void 0:i.uid)||null,!this._deleted&&(this._isInitialized=!0)}}),this._initializationPromise}async _onStorageEvent(){if(this._deleted)return;const e=await this.assertedPersistence.getCurrentUser();if(!(!this.currentUser&&!e)){if(this.currentUser&&e&&this.currentUser.uid===e.uid){this._currentUser._assign(e),await this.currentUser.getIdToken();return}await this._updateCurrentUser(e,!0)}}async initializeCurrentUserFromIdToken(e){try{const t=await lp(this,{idToken:e}),r=await us._fromGetAccountInfoResponse(this,t,e);await this.directlySetCurrentUser(r)}catch(t){console.warn("FirebaseServerApp could not login user with provided authIdToken: ",t),await this.directlySetCurrentUser(null)}}async initializeCurrentUser(e){var i;if(Bt(this.app)){const o=this.app.settings.authIdToken;return o?new Promise(a=>{setTimeout(()=>this.initializeCurrentUserFromIdToken(o).then(a,a))}):this.directlySetCurrentUser(null)}const t=await this.assertedPersistence.getCurrentUser();let r=t,s=!1;if(e&&this.config.authDomain){await this.getOrInitRedirectPersistenceManager();const o=(i=this.redirectUser)==null?void 0:i._redirectEventId,a=r==null?void 0:r._redirectEventId,c=await this.tryRedirectSignIn(e);(!o||o===a)&&(c!=null&&c.user)&&(r=c.user,s=!0)}if(!r)return this.directlySetCurrentUser(null);if(!r._redirectEventId){if(s)try{await this.beforeStateQueue.runMiddleware(r)}catch(o){r=t,this._popupRedirectResolver._overrideRedirectResult(this,()=>Promise.reject(o))}return r?this.reloadAndSetCurrentUserOrClear(r):this.directlySetCurrentUser(null)}return X(this._popupRedirectResolver,this,"argument-error"),await this.getOrInitRedirectPersistenceManager(),this.redirectUser&&this.redirectUser._redirectEventId===r._redirectEventId?this.directlySetCurrentUser(r):this.reloadAndSetCurrentUserOrClear(r)}async tryRedirectSignIn(e){let t=null;try{t=await this._popupRedirectResolver._completeRedirectFn(this,e,!0)}catch{await this._setRedirectUser(null)}return t}async reloadAndSetCurrentUserOrClear(e){try{await Bd(e)}catch(t){if((t==null?void 0:t.code)!=="auth/network-request-failed")return this.directlySetCurrentUser(null)}return this.directlySetCurrentUser(e)}useDeviceLanguage(){this.languageCode=iU()}async _delete(){this._deleted=!0}async updateCurrentUser(e){if(Bt(this.app))return Promise.reject(jn(this));const t=e?le(e):null;return t&&X(t.auth.config.apiKey===this.config.apiKey,this,"invalid-user-token"),this._updateCurrentUser(t&&t._clone(this))}async _updateCurrentUser(e,t=!1){if(!this._deleted)return e&&X(this.tenantId===e.tenantId,this,"tenant-id-mismatch"),t||await this.beforeStateQueue.runMiddleware(e),this.queue(async()=>{await this.directlySetCurrentUser(e),this.notifyAuthListeners()})}async signOut(){return Bt(this.app)?Promise.reject(jn(this)):(await this.beforeStateQueue.runMiddleware(null),(this.redirectPersistenceManager||this._popupRedirectResolver)&&await this._setRedirectUser(null),this._updateCurrentUser(null,!0))}setPersistence(e){return Bt(this.app)?Promise.reject(jn(this)):this.queue(async()=>{await this.assertedPersistence.setPersistence(ri(e))})}_getRecaptchaConfig(){return this.tenantId==null?this._agentRecaptchaConfig:this._tenantRecaptchaConfigs[this.tenantId]}async validatePassword(e){this._getPasswordPolicyInternal()||await this._updatePasswordPolicy();const t=this._getPasswordPolicyInternal();return t.schemaVersion!==this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION?Promise.reject(this._errorFactory.create("unsupported-password-policy-schema-version",{})):t.validatePassword(e)}_getPasswordPolicyInternal(){return this.tenantId===null?this._projectPasswordPolicy:this._tenantPasswordPolicies[this.tenantId]}async _updatePasswordPolicy(){const e=await EU(this),t=new TU(e);this.tenantId===null?this._projectPasswordPolicy=t:this._tenantPasswordPolicies[this.tenantId]=t}_getPersistenceType(){return this.assertedPersistence.persistence.type}_getPersistence(){return this.assertedPersistence.persistence}_updateErrorMap(e){this._errorFactory=new La("auth","Firebase",e())}onAuthStateChanged(e,t,r){return this.registerStateListener(this.authStateSubscription,e,t,r)}beforeAuthStateChanged(e,t){return this.beforeStateQueue.pushCallback(e,t)}onIdTokenChanged(e,t,r){return this.registerStateListener(this.idTokenSubscription,e,t,r)}authStateReady(){return new Promise((e,t)=>{if(this.currentUser)e();else{const r=this.onAuthStateChanged(()=>{r(),e()},t)}})}async revokeAccessToken(e){if(this.currentUser){const t=await this.currentUser.getIdToken(),r={providerId:"apple.com",tokenType:"ACCESS_TOKEN",token:e,idToken:t};this.tenantId!=null&&(r.tenantId=this.tenantId),await wU(this,r)}}toJSON(){var e;return{apiKey:this.config.apiKey,authDomain:this.config.authDomain,appName:this.name,currentUser:(e=this._currentUser)==null?void 0:e.toJSON()}}async _setRedirectUser(e,t){const r=await this.getOrInitRedirectPersistenceManager(t);return e===null?r.removeCurrentUser():r.setCurrentUser(e)}async getOrInitRedirectPersistenceManager(e){if(!this.redirectPersistenceManager){const t=e&&ri(e)||this._popupRedirectResolver;X(t,this,"argument-error"),this.redirectPersistenceManager=await Vl.create(this,[ri(t._redirectPersistence)],"redirectUser"),this.redirectUser=await this.redirectPersistenceManager.getCurrentUser()}return this.redirectPersistenceManager}async _redirectUserForId(e){var t,r;return this._isInitialized&&await this.queue(async()=>{}),((t=this._currentUser)==null?void 0:t._redirectEventId)===e?this._currentUser:((r=this.redirectUser)==null?void 0:r._redirectEventId)===e?this.redirectUser:null}async _persistUserIfCurrent(e){if(e===this.currentUser)return this.queue(async()=>this.directlySetCurrentUser(e))}_notifyListenersIfCurrent(e){e===this.currentUser&&this.notifyAuthListeners()}_key(){return`${this.config.authDomain}:${this.config.apiKey}:${this.name}`}_startProactiveRefresh(){this.isProactiveRefreshEnabled=!0,this.currentUser&&this._currentUser._startProactiveRefresh()}_stopProactiveRefresh(){this.isProactiveRefreshEnabled=!1,this.currentUser&&this._currentUser._stopProactiveRefresh()}get _currentUser(){return this.currentUser}notifyAuthListeners(){var t;if(!this._isInitialized)return;this.idTokenSubscription.next(this.currentUser);const e=((t=this.currentUser)==null?void 0:t.uid)??null;this.lastNotifiedUid!==e&&(this.lastNotifiedUid=e,this.authStateSubscription.next(this.currentUser))}registerStateListener(e,t,r,s){if(this._deleted)return()=>{};const i=typeof t=="function"?t:t.next.bind(t);let o=!1;const a=this._isInitialized?Promise.resolve():this._initializationPromise;if(X(a,this,"internal-error"),a.then(()=>{o||i(this.currentUser)}),typeof t=="function"){const c=e.addObserver(t,r,s);return()=>{o=!0,c()}}else{const c=e.addObserver(t);return()=>{o=!0,c()}}}async directlySetCurrentUser(e){this.currentUser&&this.currentUser!==e&&this._currentUser._stopProactiveRefresh(),e&&this.isProactiveRefreshEnabled&&e._startProactiveRefresh(),this.currentUser=e,e?await this.assertedPersistence.setCurrentUser(e):await this.assertedPersistence.removeCurrentUser()}queue(e){return this.operations=this.operations.then(e,e),this.operations}get assertedPersistence(){return X(this.persistenceManager,this,"internal-error"),this.persistenceManager}_logFramework(e){!e||this.frameworks.includes(e)||(this.frameworks.push(e),this.frameworks.sort(),this.clientVersion=sP(this.config.clientPlatform,this._getFrameworks()))}_getFrameworks(){return this.frameworks}async _getAdditionalHeaders(){var s;const e={"X-Client-Version":this.clientVersion};this.app.options.appId&&(e["X-Firebase-gmpid"]=this.app.options.appId);const t=await((s=this.heartbeatServiceProvider.getImmediate({optional:!0}))==null?void 0:s.getHeartbeatsHeader());t&&(e["X-Firebase-Client"]=t);const r=await this._getAppCheckToken();return r&&(e["X-Firebase-AppCheck"]=r),e}async _getAppCheckToken(){var t;if(Bt(this.app)&&this.app.settings.appCheckToken)return this.app.settings.appCheckToken;const e=await((t=this.appCheckServiceProvider.getImmediate({optional:!0}))==null?void 0:t.getToken());return e!=null&&e.error&&rU(`Error while retrieving App Check token: ${e.error}`),e==null?void 0:e.token}}function ln(n){return le(n)}class xT{constructor(e){this.auth=e,this.observer=null,this.addObserver=bL(t=>this.observer=t)}get next(){return X(this.observer,this.auth,"internal-error"),this.observer.next.bind(this.observer)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let bh={async loadJS(){throw new Error("Unable to load external scripts")},recaptchaV2Script:"",recaptchaEnterpriseScript:"",gapiScript:""};function CU(n){bh=n}function Bx(n){return bh.loadJS(n)}function kU(){return bh.recaptchaV2Script}function NU(){return bh.recaptchaEnterpriseScript}function RU(){return bh.gapiScript}function iP(n){return`__${n}${Math.floor(Math.random()*1e6)}`}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const DU=500,PU=6e4,vf=1e12;class OU{constructor(e){this.auth=e,this.counter=vf,this._widgets=new Map}render(e,t){const r=this.counter;return this._widgets.set(r,new MU(e,this.auth.name,t||{})),this.counter++,r}reset(e){var r;const t=e||vf;(r=this._widgets.get(t))==null||r.delete(),this._widgets.delete(t)}getResponse(e){var r;const t=e||vf;return((r=this._widgets.get(t))==null?void 0:r.getResponse())||""}async execute(e){var r;const t=e||vf;return(r=this._widgets.get(t))==null||r.execute(),""}}class jU{constructor(){this.enterprise=new LU}ready(e){e()}execute(e,t){return Promise.resolve("token")}render(e,t){return""}}class LU{ready(e){e()}execute(e,t){return Promise.resolve("token")}render(e,t){return""}}class MU{constructor(e,t,r){this.params=r,this.timerId=null,this.deleted=!1,this.responseToken=null,this.clickHandler=()=>{this.execute()};const s=typeof e=="string"?document.getElementById(e):e;X(s,"argument-error",{appName:t}),this.container=s,this.isVisible=this.params.size!=="invisible",this.isVisible?this.execute():this.container.addEventListener("click",this.clickHandler)}getResponse(){return this.checkIfDeleted(),this.responseToken}delete(){this.checkIfDeleted(),this.deleted=!0,this.timerId&&(clearTimeout(this.timerId),this.timerId=null),this.container.removeEventListener("click",this.clickHandler)}execute(){this.checkIfDeleted(),!this.timerId&&(this.timerId=window.setTimeout(()=>{this.responseToken=VU(50);const{callback:e,"expired-callback":t}=this.params;if(e)try{e(this.responseToken)}catch{}this.timerId=window.setTimeout(()=>{if(this.timerId=null,this.responseToken=null,t)try{t()}catch{}this.isVisible&&this.execute()},PU)},DU))}checkIfDeleted(){if(this.deleted)throw new Error("reCAPTCHA mock was already deleted!")}}function VU(n){const e=[],t="1234567890abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ";for(let r=0;r<n;r++)e.push(t.charAt(Math.floor(Math.random()*t.length)));return e.join("")}const FU="recaptcha-enterprise",Ku="NO_RECAPTCHA";class oP{constructor(e){this.type=FU,this.auth=ln(e)}async verify(e="verify",t=!1){async function r(i){if(!t){if(i.tenantId==null&&i._agentRecaptchaConfig!=null)return i._agentRecaptchaConfig.siteKey;if(i.tenantId!=null&&i._tenantRecaptchaConfigs[i.tenantId]!==void 0)return i._tenantRecaptchaConfigs[i.tenantId].siteKey}return new Promise(async(o,a)=>{HD(i,{clientType:"CLIENT_TYPE_WEB",version:"RECAPTCHA_ENTERPRISE"}).then(c=>{if(c.recaptchaKey===void 0)a(new Error("recaptcha Enterprise site key undefined"));else{const u=new GD(c);return i.tenantId==null?i._agentRecaptchaConfig=u:i._tenantRecaptchaConfigs[i.tenantId]=u,o(u.siteKey)}}).catch(c=>{a(c)})})}function s(i,o,a){const c=window.grecaptcha;gT(c)?c.enterprise.ready(()=>{c.enterprise.execute(i,{action:e}).then(u=>{o(u)}).catch(()=>{o(Ku)})}):a(Error("No reCAPTCHA enterprise script loaded."))}return this.auth.settings.appVerificationDisabledForTesting?new jU().execute("siteKey",{action:"verify"}):new Promise((i,o)=>{r(this.auth).then(a=>{if(!t&&gT(window.grecaptcha))s(a,i,o);else{if(typeof window>"u"){o(new Error("RecaptchaVerifier is only supported in browser"));return}let c=NU();c.length!==0&&(c+=a),Bx(c).then(()=>{s(a,i,o)}).catch(u=>{o(u)})}}).catch(a=>{o(a)})})}}async function du(n,e,t,r=!1,s=!1){const i=new oP(n);let o;if(s)o=Ku;else try{o=await i.verify(t)}catch{o=await i.verify(t,!0)}const a={...e};if(t==="mfaSmsEnrollment"||t==="mfaSmsSignIn"){if("phoneEnrollmentInfo"in a){const c=a.phoneEnrollmentInfo.phoneNumber,u=a.phoneEnrollmentInfo.recaptchaToken;Object.assign(a,{phoneEnrollmentInfo:{phoneNumber:c,recaptchaToken:u,captchaResponse:o,clientType:"CLIENT_TYPE_WEB",recaptchaVersion:"RECAPTCHA_ENTERPRISE"}})}else if("phoneSignInInfo"in a){const c=a.phoneSignInInfo.recaptchaToken;Object.assign(a,{phoneSignInInfo:{recaptchaToken:c,captchaResponse:o,clientType:"CLIENT_TYPE_WEB",recaptchaVersion:"RECAPTCHA_ENTERPRISE"}})}return a}return r?Object.assign(a,{captchaResp:o}):Object.assign(a,{captchaResponse:o}),Object.assign(a,{clientType:"CLIENT_TYPE_WEB"}),Object.assign(a,{recaptchaVersion:"RECAPTCHA_ENTERPRISE"}),a}async function ho(n,e,t,r,s){var i,o;if(s==="EMAIL_PASSWORD_PROVIDER")if((i=n._getRecaptchaConfig())!=null&&i.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")){const a=await du(n,e,t,t==="getOobCode");return r(n,a)}else return r(n,e).catch(async a=>{if(a.code==="auth/missing-recaptcha-token"){console.log(`${t} is protected by reCAPTCHA Enterprise for this project. Automatically triggering the reCAPTCHA flow and restarting the flow.`);const c=await du(n,e,t,t==="getOobCode");return r(n,c)}else return Promise.reject(a)});else if(s==="PHONE_PROVIDER")if((o=n._getRecaptchaConfig())!=null&&o.isProviderEnabled("PHONE_PROVIDER")){const a=await du(n,e,t);return r(n,a).catch(async c=>{var u;if(((u=n._getRecaptchaConfig())==null?void 0:u.getProviderEnforcementState("PHONE_PROVIDER"))==="AUDIT"&&(c.code==="auth/missing-recaptcha-token"||c.code==="auth/invalid-app-credential")){console.log(`Failed to verify with reCAPTCHA Enterprise. Automatically triggering the reCAPTCHA v2 flow to complete the ${t} flow.`);const h=await du(n,e,t,!1,!0);return r(n,h)}return Promise.reject(c)})}else{const a=await du(n,e,t,!1,!0);return r(n,a)}else return Promise.reject(s+" provider is not supported.")}async function aP(n){const e=ln(n),t=await HD(e,{clientType:"CLIENT_TYPE_WEB",version:"RECAPTCHA_ENTERPRISE"}),r=new GD(t);e.tenantId==null?e._agentRecaptchaConfig=r:e._tenantRecaptchaConfigs[e.tenantId]=r,r.isAnyProviderEnabled()&&new oP(e).verify()}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function $U(n,e){const t=Ws(n,"auth");if(t.isInitialized()){const s=t.getImmediate(),i=t.getOptions();if(jr(i,e??{}))return s;xr(s,"already-initialized")}return t.initialize({options:e})}function UU(n,e){const t=(e==null?void 0:e.persistence)||[],r=(Array.isArray(t)?t:[t]).map(ri);e!=null&&e.errorMap&&n._updateErrorMap(e.errorMap),n._initializeWithPersistence(r,e==null?void 0:e.popupRedirectResolver)}function BU(n,e,t){const r=ln(n);X(/^https?:\/\//.test(e),r,"invalid-emulator-scheme");const s=!!(t!=null&&t.disableWarnings),i=lP(e),{host:o,port:a}=zU(e),c=a===null?"":`:${a}`,u={url:`${i}//${o}${c}/`},h=Object.freeze({host:o,port:a,protocol:i.replace(":",""),options:Object.freeze({disableWarnings:s})});if(!r._canInitEmulator){X(r.config.emulator&&r.emulatorConfig,r,"emulator-config-failed"),X(jr(u,r.config.emulator)&&jr(h,r.emulatorConfig),r,"emulator-config-failed");return}r.config.emulator=u,r.emulatorConfig=h,r.settings.appVerificationDisabledForTesting=!0,wi(o)?(Op(`${i}//${o}${c}`),U0("Auth",!0)):s||qU()}function lP(n){const e=n.indexOf(":");return e<0?"":n.substr(0,e+1)}function zU(n){const e=lP(n),t=/(\/\/)?([^?#/]+)/.exec(n.substr(e.length));if(!t)return{host:"",port:null};const r=t[2].split("@").pop()||"",s=/^(\[[^\]]+\])(:|$)/.exec(r);if(s){const i=s[1];return{host:i,port:ST(r.substr(i.length+1))}}else{const[i,o]=r.split(":");return{host:i,port:ST(o)}}}function ST(n){if(!n)return null;const e=Number(n);return isNaN(e)?null:e}function qU(){function n(){const e=document.createElement("p"),t=e.style;e.innerText="Running in emulator mode. Do not use with production credentials.",t.position="fixed",t.width="100%",t.backgroundColor="#ffffff",t.border=".1em solid #000000",t.color="#b50000",t.bottom="0px",t.left="0px",t.margin="0px",t.zIndex="10000",t.textAlign="center",e.classList.add("firebase-emulator-warning"),document.body.appendChild(e)}typeof console<"u"&&typeof console.info=="function"&&console.info("WARNING: You are using the Auth Emulator, which is intended for local testing only.  Do not use with production credentials."),typeof window<"u"&&typeof document<"u"&&(document.readyState==="loading"?window.addEventListener("DOMContentLoaded",n):n())}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Th{constructor(e,t){this.providerId=e,this.signInMethod=t}toJSON(){return Rs("not implemented")}_getIdTokenResponse(e){return Rs("not implemented")}_linkToIdToken(e,t){return Rs("not implemented")}_getReauthenticationResolver(e){return Rs("not implemented")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function cP(n,e){return Ft(n,"POST","/v1/accounts:resetPassword",Vt(n,e))}async function WU(n,e){return Ft(n,"POST","/v1/accounts:update",e)}async function GU(n,e){return Ft(n,"POST","/v1/accounts:signUp",e)}async function HU(n,e){return Ft(n,"POST","/v1/accounts:update",Vt(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function QU(n,e){return bi(n,"POST","/v1/accounts:signInWithPassword",Vt(n,e))}async function Ng(n,e){return Ft(n,"POST","/v1/accounts:sendOobCode",Vt(n,e))}async function KU(n,e){return Ng(n,e)}async function YU(n,e){return Ng(n,e)}async function JU(n,e){return Ng(n,e)}async function XU(n,e){return Ng(n,e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function ZU(n,e){return bi(n,"POST","/v1/accounts:signInWithEmailLink",Vt(n,e))}async function eB(n,e){return bi(n,"POST","/v1/accounts:signInWithEmailLink",Vt(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class zd extends Th{constructor(e,t,r,s=null){super("password",r),this._email=e,this._password=t,this._tenantId=s}static _fromEmailAndPassword(e,t){return new zd(e,t,"password")}static _fromEmailAndCode(e,t,r=null){return new zd(e,t,"emailLink",r)}toJSON(){return{email:this._email,password:this._password,signInMethod:this.signInMethod,tenantId:this._tenantId}}static fromJSON(e){const t=typeof e=="string"?JSON.parse(e):e;if(t!=null&&t.email&&(t!=null&&t.password)){if(t.signInMethod==="password")return this._fromEmailAndPassword(t.email,t.password);if(t.signInMethod==="emailLink")return this._fromEmailAndCode(t.email,t.password,t.tenantId)}return null}async _getIdTokenResponse(e){switch(this.signInMethod){case"password":const t={returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"};return ho(e,t,"signInWithPassword",QU,"EMAIL_PASSWORD_PROVIDER");case"emailLink":return ZU(e,{email:this._email,oobCode:this._password});default:xr(e,"internal-error")}}async _linkToIdToken(e,t){switch(this.signInMethod){case"password":const r={idToken:t,returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"};return ho(e,r,"signUpPassword",GU,"EMAIL_PASSWORD_PROVIDER");case"emailLink":return eB(e,{idToken:t,email:this._email,oobCode:this._password});default:xr(e,"internal-error")}}_getReauthenticationResolver(e){return this._getIdTokenResponse(e)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function ai(n,e){return bi(n,"POST","/v1/accounts:signInWithIdp",Vt(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const tB="http://localhost";class _i extends Th{constructor(){super(...arguments),this.pendingToken=null}static _fromParams(e){const t=new _i(e.providerId,e.signInMethod);return e.idToken||e.accessToken?(e.idToken&&(t.idToken=e.idToken),e.accessToken&&(t.accessToken=e.accessToken),e.nonce&&!e.pendingToken&&(t.nonce=e.nonce),e.pendingToken&&(t.pendingToken=e.pendingToken)):e.oauthToken&&e.oauthTokenSecret?(t.accessToken=e.oauthToken,t.secret=e.oauthTokenSecret):xr("argument-error"),t}toJSON(){return{idToken:this.idToken,accessToken:this.accessToken,secret:this.secret,nonce:this.nonce,pendingToken:this.pendingToken,providerId:this.providerId,signInMethod:this.signInMethod}}static fromJSON(e){const t=typeof e=="string"?JSON.parse(e):e,{providerId:r,signInMethod:s,...i}=t;if(!r||!s)return null;const o=new _i(r,s);return o.idToken=i.idToken||void 0,o.accessToken=i.accessToken||void 0,o.secret=i.secret,o.nonce=i.nonce,o.pendingToken=i.pendingToken||null,o}_getIdTokenResponse(e){const t=this.buildRequest();return ai(e,t)}_linkToIdToken(e,t){const r=this.buildRequest();return r.idToken=t,ai(e,r)}_getReauthenticationResolver(e){const t=this.buildRequest();return t.autoCreate=!1,ai(e,t)}buildRequest(){const e={requestUri:tB,returnSecureToken:!0};if(this.pendingToken)e.pendingToken=this.pendingToken;else{const t={};this.idToken&&(t.id_token=this.idToken),this.accessToken&&(t.access_token=this.accessToken),this.secret&&(t.oauth_token_secret=this.secret),t.providerId=this.providerId,this.nonce&&!this.pendingToken&&(t.nonce=this.nonce),e.postBody=Ma(t)}return e}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function IT(n,e){return Ft(n,"POST","/v1/accounts:sendVerificationCode",Vt(n,e))}async function nB(n,e){return bi(n,"POST","/v1/accounts:signInWithPhoneNumber",Vt(n,e))}async function rB(n,e){const t=await bi(n,"POST","/v1/accounts:signInWithPhoneNumber",Vt(n,e));if(t.temporaryProof)throw Eu(n,"account-exists-with-different-credential",t);return t}const sB={USER_NOT_FOUND:"user-not-found"};async function iB(n,e){const t={...e,operation:"REAUTH"};return bi(n,"POST","/v1/accounts:signInWithPhoneNumber",Vt(n,t),sB)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class da extends Th{constructor(e){super("phone","phone"),this.params=e}static _fromVerification(e,t){return new da({verificationId:e,verificationCode:t})}static _fromTokenResponse(e,t){return new da({phoneNumber:e,temporaryProof:t})}_getIdTokenResponse(e){return nB(e,this._makeVerificationRequest())}_linkToIdToken(e,t){return rB(e,{idToken:t,...this._makeVerificationRequest()})}_getReauthenticationResolver(e){return iB(e,this._makeVerificationRequest())}_makeVerificationRequest(){const{temporaryProof:e,phoneNumber:t,verificationId:r,verificationCode:s}=this.params;return e&&t?{temporaryProof:e,phoneNumber:t}:{sessionInfo:r,code:s}}toJSON(){const e={providerId:this.providerId};return this.params.phoneNumber&&(e.phoneNumber=this.params.phoneNumber),this.params.temporaryProof&&(e.temporaryProof=this.params.temporaryProof),this.params.verificationCode&&(e.verificationCode=this.params.verificationCode),this.params.verificationId&&(e.verificationId=this.params.verificationId),e}static fromJSON(e){typeof e=="string"&&(e=JSON.parse(e));const{verificationId:t,verificationCode:r,phoneNumber:s,temporaryProof:i}=e;return!r&&!t&&!s&&!i?null:new da({verificationId:t,verificationCode:r,phoneNumber:s,temporaryProof:i})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function oB(n){switch(n){case"recoverEmail":return"RECOVER_EMAIL";case"resetPassword":return"PASSWORD_RESET";case"signIn":return"EMAIL_SIGNIN";case"verifyEmail":return"VERIFY_EMAIL";case"verifyAndChangeEmail":return"VERIFY_AND_CHANGE_EMAIL";case"revertSecondFactorAddition":return"REVERT_SECOND_FACTOR_ADDITION";default:return null}}function aB(n){const e=yu(_u(n)).link,t=e?yu(_u(e)).deep_link_id:null,r=yu(_u(n)).deep_link_id;return(r?yu(_u(r)).link:null)||r||t||e||n}class Ah{constructor(e){const t=yu(_u(e)),r=t.apiKey??null,s=t.oobCode??null,i=oB(t.mode??null);X(r&&s&&i,"argument-error"),this.apiKey=r,this.operation=i,this.code=s,this.continueUrl=t.continueUrl??null,this.languageCode=t.lang??null,this.tenantId=t.tenantId??null}static parseLink(e){const t=aB(e);try{return new Ah(t)}catch{return null}}}function SW(n){return Ah.parseLink(n)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Qa{constructor(){this.providerId=Qa.PROVIDER_ID}static credential(e,t){return zd._fromEmailAndPassword(e,t)}static credentialWithLink(e,t){const r=Ah.parseLink(t);return X(r,"argument-error"),zd._fromEmailAndCode(e,r.code,r.tenantId)}}Qa.PROVIDER_ID="password";Qa.EMAIL_PASSWORD_SIGN_IN_METHOD="password";Qa.EMAIL_LINK_SIGN_IN_METHOD="emailLink";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ti{constructor(e){this.providerId=e,this.defaultLanguageCode=null,this.customParameters={}}setDefaultLanguage(e){this.defaultLanguageCode=e}setCustomParameters(e){return this.customParameters=e,this}getCustomParameters(){return this.customParameters}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class $c extends Ti{constructor(){super(...arguments),this.scopes=[]}addScope(e){return this.scopes.includes(e)||this.scopes.push(e),this}getScopes(){return[...this.scopes]}}class em extends $c{static credentialFromJSON(e){const t=typeof e=="string"?JSON.parse(e):e;return X("providerId"in t&&"signInMethod"in t,"argument-error"),_i._fromParams(t)}credential(e){return this._credential({...e,nonce:e.rawNonce})}_credential(e){return X(e.idToken||e.accessToken,"argument-error"),_i._fromParams({...e,providerId:this.providerId,signInMethod:this.providerId})}static credentialFromResult(e){return em.oauthCredentialFromTaggedObject(e)}static credentialFromError(e){return em.oauthCredentialFromTaggedObject(e.customData||{})}static oauthCredentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthIdToken:t,oauthAccessToken:r,oauthTokenSecret:s,pendingToken:i,nonce:o,providerId:a}=e;if(!r&&!s&&!t&&!i||!a)return null;try{return new em(a)._credential({idToken:t,accessToken:r,nonce:o,pendingToken:i})}catch{return null}}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ui extends $c{constructor(){super("facebook.com")}static credential(e){return _i._fromParams({providerId:Ui.PROVIDER_ID,signInMethod:Ui.FACEBOOK_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return Ui.credentialFromTaggedObject(e)}static credentialFromError(e){return Ui.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return Ui.credential(e.oauthAccessToken)}catch{return null}}}Ui.FACEBOOK_SIGN_IN_METHOD="facebook.com";Ui.PROVIDER_ID="facebook.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Js extends $c{constructor(){super("google.com"),this.addScope("profile")}static credential(e,t){return _i._fromParams({providerId:Js.PROVIDER_ID,signInMethod:Js.GOOGLE_SIGN_IN_METHOD,idToken:e,accessToken:t})}static credentialFromResult(e){return Js.credentialFromTaggedObject(e)}static credentialFromError(e){return Js.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthIdToken:t,oauthAccessToken:r}=e;if(!t&&!r)return null;try{return Js.credential(t,r)}catch{return null}}}Js.GOOGLE_SIGN_IN_METHOD="google.com";Js.PROVIDER_ID="google.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Bi extends $c{constructor(){super("github.com")}static credential(e){return _i._fromParams({providerId:Bi.PROVIDER_ID,signInMethod:Bi.GITHUB_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return Bi.credentialFromTaggedObject(e)}static credentialFromError(e){return Bi.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return Bi.credential(e.oauthAccessToken)}catch{return null}}}Bi.GITHUB_SIGN_IN_METHOD="github.com";Bi.PROVIDER_ID="github.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const lB="http://localhost";class qd extends Th{constructor(e,t){super(e,e),this.pendingToken=t}_getIdTokenResponse(e){const t=this.buildRequest();return ai(e,t)}_linkToIdToken(e,t){const r=this.buildRequest();return r.idToken=t,ai(e,r)}_getReauthenticationResolver(e){const t=this.buildRequest();return t.autoCreate=!1,ai(e,t)}toJSON(){return{signInMethod:this.signInMethod,providerId:this.providerId,pendingToken:this.pendingToken}}static fromJSON(e){const t=typeof e=="string"?JSON.parse(e):e,{providerId:r,signInMethod:s,pendingToken:i}=t;return!r||!s||!i||r!==s?null:new qd(r,i)}static _create(e,t){return new qd(e,t)}buildRequest(){return{requestUri:lB,returnSecureToken:!0,pendingToken:this.pendingToken}}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const cB="saml.";class zv extends Ti{constructor(e){X(e.startsWith(cB),"argument-error"),super(e)}static credentialFromResult(e){return zv.samlCredentialFromTaggedObject(e)}static credentialFromError(e){return zv.samlCredentialFromTaggedObject(e.customData||{})}static credentialFromJSON(e){const t=qd.fromJSON(e);return X(t,"argument-error"),t}static samlCredentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{pendingToken:t,providerId:r}=e;if(!t||!r)return null;try{return qd._create(r,t)}catch{return null}}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class zi extends $c{constructor(){super("twitter.com")}static credential(e,t){return _i._fromParams({providerId:zi.PROVIDER_ID,signInMethod:zi.TWITTER_SIGN_IN_METHOD,oauthToken:e,oauthTokenSecret:t})}static credentialFromResult(e){return zi.credentialFromTaggedObject(e)}static credentialFromError(e){return zi.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthAccessToken:t,oauthTokenSecret:r}=e;if(!t||!r)return null;try{return zi.credential(t,r)}catch{return null}}}zi.TWITTER_SIGN_IN_METHOD="twitter.com";zi.PROVIDER_ID="twitter.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function uP(n,e){return bi(n,"POST","/v1/accounts:signUp",Vt(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Zr{constructor(e){this.user=e.user,this.providerId=e.providerId,this._tokenResponse=e._tokenResponse,this.operationType=e.operationType}static async _fromIdTokenResponse(e,t,r,s=!1){const i=await us._fromIdTokenResponse(e,r,s),o=ET(r);return new Zr({user:i,providerId:o,_tokenResponse:r,operationType:t})}static async _forOperation(e,t,r){await e._updateTokensIfNecessary(r,!0);const s=ET(r);return new Zr({user:e,providerId:s,_tokenResponse:r,operationType:t})}}function ET(n){return n.providerId?n.providerId:"phoneNumber"in n?"phone":null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function IW(n){var s;if(Bt(n.app))return Promise.reject(jn(n));const e=ln(n);if(await e._initializationPromise,(s=e.currentUser)!=null&&s.isAnonymous)return new Zr({user:e.currentUser,providerId:null,operationType:"signIn"});const t=await uP(e,{returnSecureToken:!0}),r=await Zr._fromIdTokenResponse(e,"signIn",t,!0);return await e._updateCurrentUser(r.user),r}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class cp extends ys{constructor(e,t,r,s){super(t.code,t.message),this.operationType=r,this.user=s,Object.setPrototypeOf(this,cp.prototype),this.customData={appName:e.name,tenantId:e.tenantId??void 0,_serverResponse:t.customData._serverResponse,operationType:r}}static _fromErrorAndOperation(e,t,r,s){return new cp(e,t,r,s)}}function dP(n,e,t,r){return(e==="reauthenticate"?t._getReauthenticationResolver(n):t._getIdTokenResponse(n)).catch(i=>{throw i.code==="auth/multi-factor-auth-required"?cp._fromErrorAndOperation(n,i,e,r):i})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function hP(n){return new Set(n.map(({providerId:e})=>e).filter(e=>!!e))}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function EW(n,e){const t=le(n);await Rg(!0,t,e);const{providerUserInfo:r}=await fU(t.auth,{idToken:await t.getIdToken(),deleteProvider:[e]}),s=hP(r||[]);return t.providerData=t.providerData.filter(i=>s.has(i.providerId)),s.has("phone")||(t.phoneNumber=null),await t.auth._persistUserIfCurrent(t),t}async function zx(n,e,t=!1){const r=await yi(n,e._linkToIdToken(n.auth,await n.getIdToken()),t);return Zr._forOperation(n,"link",r)}async function Rg(n,e,t){await Bd(e);const r=hP(e.providerData),s=n===!1?"provider-already-linked":"no-such-provider";X(r.has(t)===n,e.auth,s)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function fP(n,e,t=!1){const{auth:r}=n;if(Bt(r.app))return Promise.reject(jn(r));const s="reauthenticate";try{const i=await yi(n,dP(r,s,e,n),t);X(i.idToken,r,"internal-error");const o=kg(i.idToken);X(o,r,"internal-error");const{sub:a}=o;return X(n.uid===a,r,"user-mismatch"),Zr._forOperation(n,s,i)}catch(i){throw(i==null?void 0:i.code)==="auth/user-not-found"&&xr(r,"user-mismatch"),i}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function mP(n,e,t=!1){if(Bt(n.app))return Promise.reject(jn(n));const r="signIn",s=await dP(n,r,e),i=await Zr._fromIdTokenResponse(n,r,s);return t||await n._updateCurrentUser(i.user),i}async function qx(n,e){return mP(ln(n),e)}async function uB(n,e){const t=le(n);return await Rg(!1,t,e.providerId),zx(t,e)}async function dB(n,e){return fP(le(n),e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function hB(n,e){return bi(n,"POST","/v1/accounts:signInWithCustomToken",Vt(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function bW(n,e){if(Bt(n.app))return Promise.reject(jn(n));const t=ln(n),r=await hB(t,{token:e,returnSecureToken:!0}),s=await Zr._fromIdTokenResponse(t,"signIn",r);return await t._updateCurrentUser(s.user),s}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ch{constructor(e,t){this.factorId=e,this.uid=t.mfaEnrollmentId,this.enrollmentTime=new Date(t.enrolledAt).toUTCString(),this.displayName=t.displayName}static _fromServerResponse(e,t){return"phoneInfo"in t?Wx._fromServerResponse(e,t):"totpInfo"in t?Gx._fromServerResponse(e,t):xr(e,"internal-error")}}class Wx extends Ch{constructor(e){super("phone",e),this.phoneNumber=e.phoneInfo}static _fromServerResponse(e,t){return new Wx(t)}}class Gx extends Ch{constructor(e){super("totp",e)}static _fromServerResponse(e,t){return new Gx(t)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Dg(n,e,t){var r;X(((r=t.url)==null?void 0:r.length)>0,n,"invalid-continue-uri"),X(typeof t.dynamicLinkDomain>"u"||t.dynamicLinkDomain.length>0,n,"invalid-dynamic-link-domain"),X(typeof t.linkDomain>"u"||t.linkDomain.length>0,n,"invalid-hosting-link-domain"),e.continueUrl=t.url,e.dynamicLinkDomain=t.dynamicLinkDomain,e.linkDomain=t.linkDomain,e.canHandleCodeInApp=t.handleCodeInApp,t.iOS&&(X(t.iOS.bundleId.length>0,n,"missing-ios-bundle-id"),e.iOSBundleId=t.iOS.bundleId),t.android&&(X(t.android.packageName.length>0,n,"missing-android-pkg-name"),e.androidInstallApp=t.android.installApp,e.androidMinimumVersionCode=t.android.minimumVersion,e.androidPackageName=t.android.packageName)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Hx(n){const e=ln(n);e._getPasswordPolicyInternal()&&await e._updatePasswordPolicy()}async function fB(n,e,t){const r=ln(n),s={requestType:"PASSWORD_RESET",email:e,clientType:"CLIENT_TYPE_WEB"};t&&Dg(r,s,t),await ho(r,s,"getOobCode",YU,"EMAIL_PASSWORD_PROVIDER")}async function TW(n,e,t){await cP(le(n),{oobCode:e,newPassword:t}).catch(async r=>{throw r.code==="auth/password-does-not-meet-requirements"&&Hx(n),r})}async function AW(n,e){await HU(le(n),{oobCode:e})}async function mB(n,e){const t=le(n),r=await cP(t,{oobCode:e}),s=r.requestType;switch(X(s,t,"internal-error"),s){case"EMAIL_SIGNIN":break;case"VERIFY_AND_CHANGE_EMAIL":X(r.newEmail,t,"internal-error");break;case"REVERT_SECOND_FACTOR_ADDITION":X(r.mfaInfo,t,"internal-error");default:X(r.email,t,"internal-error")}let i=null;return r.mfaInfo&&(i=Ch._fromServerResponse(ln(t),r.mfaInfo)),{data:{email:(r.requestType==="VERIFY_AND_CHANGE_EMAIL"?r.newEmail:r.email)||null,previousEmail:(r.requestType==="VERIFY_AND_CHANGE_EMAIL"?r.email:r.newEmail)||null,multiFactorInfo:i},operation:s}}async function CW(n,e){const{data:t}=await mB(le(n),e);return t.email}async function pP(n,e,t){if(Bt(n.app))return Promise.reject(jn(n));const r=ln(n),o=await ho(r,{returnSecureToken:!0,email:e,password:t,clientType:"CLIENT_TYPE_WEB"},"signUpPassword",uP,"EMAIL_PASSWORD_PROVIDER").catch(c=>{throw c.code==="auth/password-does-not-meet-requirements"&&Hx(n),c}),a=await Zr._fromIdTokenResponse(r,"signIn",o);return await r._updateCurrentUser(a.user),a}function gP(n,e,t){return Bt(n.app)?Promise.reject(jn(n)):qx(le(n),Qa.credential(e,t)).catch(async r=>{throw r.code==="auth/password-does-not-meet-requirements"&&Hx(n),r})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function kW(n,e,t){const r=ln(n),s={requestType:"EMAIL_SIGNIN",email:e,clientType:"CLIENT_TYPE_WEB"};function i(o,a){X(a.handleCodeInApp,r,"argument-error"),a&&Dg(r,o,a)}i(s,t),await ho(r,s,"getOobCode",JU,"EMAIL_PASSWORD_PROVIDER")}function NW(n,e){const t=Ah.parseLink(e);return(t==null?void 0:t.operation)==="EMAIL_SIGNIN"}async function RW(n,e,t){if(Bt(n.app))return Promise.reject(jn(n));const r=le(n),s=Qa.credentialWithLink(e,t||Ud());return X(s._tenantId===(r.tenantId||null),r,"tenant-id-mismatch"),qx(r,s)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function pB(n,e){return Ft(n,"POST","/v1/accounts:createAuthUri",Vt(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function DW(n,e){const t=Fx()?Ud():"http://localhost",r={identifier:e,continueUri:t},{signinMethods:s}=await pB(le(n),r);return s||[]}async function gB(n,e){const t=le(n),s={requestType:"VERIFY_EMAIL",idToken:await n.getIdToken()};e&&Dg(t.auth,s,e);const{email:i}=await KU(t.auth,s);i!==n.email&&await n.reload()}async function PW(n,e,t){const r=le(n),i={requestType:"VERIFY_AND_CHANGE_EMAIL",idToken:await n.getIdToken(),newEmail:e};t&&Dg(r.auth,i,t);const{email:o}=await XU(r.auth,i);o!==n.email&&await n.reload()}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function yB(n,e){return Ft(n,"POST","/v1/accounts:update",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function OW(n,{displayName:e,photoURL:t}){if(e===void 0&&t===void 0)return;const r=le(n),i={idToken:await r.getIdToken(),displayName:e,photoUrl:t,returnSecureToken:!0},o=await yi(r,yB(r.auth,i));r.displayName=o.displayName||null,r.photoURL=o.photoUrl||null;const a=r.providerData.find(({providerId:c})=>c==="password");a&&(a.displayName=r.displayName,a.photoURL=r.photoURL),await r._updateTokensIfNecessary(o)}function jW(n,e){const t=le(n);return Bt(t.auth.app)?Promise.reject(jn(t.auth)):yP(t,e,null)}function LW(n,e){return yP(le(n),null,e)}async function yP(n,e,t){const{auth:r}=n,i={idToken:await n.getIdToken(),returnSecureToken:!0};e&&(i.email=e),t&&(i.password=t);const o=await yi(n,WU(r,i));await n._updateTokensIfNecessary(o,!0)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function _B(n){var s,i;if(!n)return null;const{providerId:e}=n,t=n.rawUserInfo?JSON.parse(n.rawUserInfo):{},r=n.isNewUser||n.kind==="identitytoolkit#SignupNewUserResponse";if(!e&&(n!=null&&n.idToken)){const o=(i=(s=kg(n.idToken))==null?void 0:s.firebase)==null?void 0:i.sign_in_provider;if(o){const a=o!=="anonymous"&&o!=="custom"?o:null;return new Fl(r,a)}}if(!e)return null;switch(e){case"facebook.com":return new vB(r,t);case"github.com":return new wB(r,t);case"google.com":return new xB(r,t);case"twitter.com":return new SB(r,t,n.screenName||null);case"custom":case"anonymous":return new Fl(r,null);default:return new Fl(r,e,t)}}class Fl{constructor(e,t,r={}){this.isNewUser=e,this.providerId=t,this.profile=r}}class _P extends Fl{constructor(e,t,r,s){super(e,t,r),this.username=s}}class vB extends Fl{constructor(e,t){super(e,"facebook.com",t)}}class wB extends _P{constructor(e,t){super(e,"github.com",t,typeof(t==null?void 0:t.login)=="string"?t==null?void 0:t.login:null)}}class xB extends Fl{constructor(e,t){super(e,"google.com",t)}}class SB extends _P{constructor(e,t,r){super(e,"twitter.com",t,r)}}function MW(n){const{user:e,_tokenResponse:t}=n;return e.isAnonymous&&!t?{providerId:null,isNewUser:!1,profile:null}:_B(t)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function vP(n,e){return le(n).setPersistence(e)}function VW(n){return aP(n)}async function FW(n,e){return ln(n).validatePassword(e)}function IB(n,e,t,r){return le(n).onIdTokenChanged(e,t,r)}function EB(n,e,t){return le(n).beforeAuthStateChanged(e,t)}function bB(n,e,t,r){return le(n).onAuthStateChanged(e,t,r)}function $W(n){le(n).useDeviceLanguage()}function UW(n,e){return le(n).updateCurrentUser(e)}function TB(n){return le(n).signOut()}function BW(n,e){return ln(n).revokeAccessToken(e)}async function zW(n){return le(n).delete()}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ra{constructor(e,t,r){this.type=e,this.credential=t,this.user=r}static _fromIdtoken(e,t){return new ra("enroll",e,t)}static _fromMfaPendingCredential(e){return new ra("signin",e)}toJSON(){return{multiFactorSession:{[this.type==="enroll"?"idToken":"pendingCredential"]:this.credential}}}static fromJSON(e){var t,r;if(e!=null&&e.multiFactorSession){if((t=e.multiFactorSession)!=null&&t.pendingCredential)return ra._fromMfaPendingCredential(e.multiFactorSession.pendingCredential);if((r=e.multiFactorSession)!=null&&r.idToken)return ra._fromIdtoken(e.multiFactorSession.idToken)}return null}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Qx{constructor(e,t,r){this.session=e,this.hints=t,this.signInResolver=r}static _fromError(e,t){const r=ln(e),s=t.customData._serverResponse,i=(s.mfaInfo||[]).map(a=>Ch._fromServerResponse(r,a));X(s.mfaPendingCredential,r,"internal-error");const o=ra._fromMfaPendingCredential(s.mfaPendingCredential);return new Qx(o,i,async a=>{const c=await a._process(r,o);delete s.mfaInfo,delete s.mfaPendingCredential;const u={...s,idToken:c.idToken,refreshToken:c.refreshToken};switch(t.operationType){case"signIn":const h=await Zr._fromIdTokenResponse(r,t.operationType,u);return await r._updateCurrentUser(h.user),h;case"reauthenticate":return X(t.user,r,"internal-error"),Zr._forOperation(t.user,t.operationType,u);default:xr(r,"internal-error")}})}async resolveSignIn(e){const t=e;return this.signInResolver(t)}}function qW(n,e){var s;const t=le(n),r=e;return X(e.customData.operationType,t,"argument-error"),X((s=r.customData._serverResponse)==null?void 0:s.mfaPendingCredential,t,"argument-error"),Qx._fromError(t,r)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function bT(n,e){return Ft(n,"POST","/v2/accounts/mfaEnrollment:start",Vt(n,e))}function AB(n,e){return Ft(n,"POST","/v2/accounts/mfaEnrollment:finalize",Vt(n,e))}function CB(n,e){return Ft(n,"POST","/v2/accounts/mfaEnrollment:start",Vt(n,e))}function kB(n,e){return Ft(n,"POST","/v2/accounts/mfaEnrollment:finalize",Vt(n,e))}function NB(n,e){return Ft(n,"POST","/v2/accounts/mfaEnrollment:withdraw",Vt(n,e))}class Kx{constructor(e){this.user=e,this.enrolledFactors=[],e._onReload(t=>{t.mfaInfo&&(this.enrolledFactors=t.mfaInfo.map(r=>Ch._fromServerResponse(e.auth,r)))})}static _fromUser(e){return new Kx(e)}async getSession(){return ra._fromIdtoken(await this.user.getIdToken(),this.user)}async enroll(e,t){const r=e,s=await this.getSession(),i=await yi(this.user,r._process(this.user.auth,s,t));return await this.user._updateTokensIfNecessary(i),this.user.reload()}async unenroll(e){const t=typeof e=="string"?e:e.uid,r=await this.user.getIdToken();try{const s=await yi(this.user,NB(this.user.auth,{idToken:r,mfaEnrollmentId:t}));this.enrolledFactors=this.enrolledFactors.filter(({uid:i})=>i!==t),await this.user._updateTokensIfNecessary(s),await this.user.reload()}catch(s){throw s}}}const By=new WeakMap;function WW(n){const e=le(n);return By.has(e)||By.set(e,Kx._fromUser(e)),By.get(e)}const up="__sak";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class wP{constructor(e,t){this.storageRetriever=e,this.type=t}_isAvailable(){try{return this.storage?(this.storage.setItem(up,"1"),this.storage.removeItem(up),Promise.resolve(!0)):Promise.resolve(!1)}catch{return Promise.resolve(!1)}}_set(e,t){return this.storage.setItem(e,JSON.stringify(t)),Promise.resolve()}_get(e){const t=this.storage.getItem(e);return Promise.resolve(t?JSON.parse(t):null)}_remove(e){return this.storage.removeItem(e),Promise.resolve()}get storage(){return this.storageRetriever()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const RB=1e3,DB=10;class xP extends wP{constructor(){super(()=>window.localStorage,"LOCAL"),this.boundEventHandler=(e,t)=>this.onStorageEvent(e,t),this.listeners={},this.localCache={},this.pollTimer=null,this.fallbackToPolling=rP(),this._shouldAllowMigration=!0}forAllChangedKeys(e){for(const t of Object.keys(this.listeners)){const r=this.storage.getItem(t),s=this.localCache[t];r!==s&&e(t,s,r)}}onStorageEvent(e,t=!1){if(!e.key){this.forAllChangedKeys((o,a,c)=>{this.notifyListeners(o,c)});return}const r=e.key;t?this.detachListener():this.stopPolling();const s=()=>{const o=this.storage.getItem(r);!t&&this.localCache[r]===o||this.notifyListeners(r,o)},i=this.storage.getItem(r);SU()&&i!==e.newValue&&e.newValue!==e.oldValue?setTimeout(s,DB):s()}notifyListeners(e,t){this.localCache[e]=t;const r=this.listeners[e];if(r)for(const s of Array.from(r))s(t&&JSON.parse(t))}startPolling(){this.stopPolling(),this.pollTimer=setInterval(()=>{this.forAllChangedKeys((e,t,r)=>{this.onStorageEvent(new StorageEvent("storage",{key:e,oldValue:t,newValue:r}),!0)})},RB)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}attachListener(){window.addEventListener("storage",this.boundEventHandler)}detachListener(){window.removeEventListener("storage",this.boundEventHandler)}_addListener(e,t){Object.keys(this.listeners).length===0&&(this.fallbackToPolling?this.startPolling():this.attachListener()),this.listeners[e]||(this.listeners[e]=new Set,this.localCache[e]=this.storage.getItem(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),this.listeners[e].size===0&&delete this.listeners[e]),Object.keys(this.listeners).length===0&&(this.detachListener(),this.stopPolling())}async _set(e,t){await super._set(e,t),this.localCache[e]=JSON.stringify(t)}async _get(e){const t=await super._get(e);return this.localCache[e]=JSON.stringify(t),t}async _remove(e){await super._remove(e),delete this.localCache[e]}}xP.type="LOCAL";const Yu=xP;/**
 * @license
 * Copyright 2025 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const PB=1e3;function zy(n){var r;const e=n.replace(/[\\^$.*+?()[\]{}|]/g,"\\$&"),t=RegExp(`${e}=([^;]+)`);return((r=document.cookie.match(t))==null?void 0:r[1])??null}function qy(n){return`${window.location.protocol==="http:"?"__dev_":"__HOST-"}FIREBASE_${n.split(":")[3]}`}class SP{constructor(){this.type="COOKIE",this.listenerUnsubscribes=new Map}_getFinalTarget(e){if(typeof window===void 0)return e;const t=new URL(`${window.location.origin}/__cookies__`);return t.searchParams.set("finalTarget",e),t}async _isAvailable(){return typeof isSecureContext=="boolean"&&!isSecureContext||typeof navigator>"u"||typeof document>"u"?!1:navigator.cookieEnabled??!0}async _set(e,t){}async _get(e){if(!this._isAvailable())return null;const t=qy(e);if(window.cookieStore){const r=await window.cookieStore.get(t);return r==null?void 0:r.value}return zy(t)}async _remove(e){if(!this._isAvailable()||!await this._get(e))return;const r=qy(e);document.cookie=`${r}=;Max-Age=34560000;Partitioned;Secure;SameSite=Strict;Path=/;Priority=High`,await fetch("/__cookies__",{method:"DELETE"}).catch(()=>{})}_addListener(e,t){if(!this._isAvailable())return;const r=qy(e);if(window.cookieStore){const a=u=>{const h=u.changed.find(m=>m.name===r);h&&t(h.value),u.deleted.find(m=>m.name===r)&&t(null)},c=()=>window.cookieStore.removeEventListener("change",a);return this.listenerUnsubscribes.set(t,c),window.cookieStore.addEventListener("change",a)}let s=zy(r);const i=setInterval(()=>{const a=zy(r);a!==s&&(t(a),s=a)},PB),o=()=>clearInterval(i);this.listenerUnsubscribes.set(t,o)}_removeListener(e,t){const r=this.listenerUnsubscribes.get(t);r&&(r(),this.listenerUnsubscribes.delete(t))}}SP.type="COOKIE";const GW=SP;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class IP extends wP{constructor(){super(()=>window.sessionStorage,"SESSION")}_addListener(e,t){}_removeListener(e,t){}}IP.type="SESSION";const Ju=IP;/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function OB(n){return Promise.all(n.map(async e=>{try{return{fulfilled:!0,value:await e}}catch(t){return{fulfilled:!1,reason:t}}}))}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Pg{constructor(e){this.eventTarget=e,this.handlersMap={},this.boundEventHandler=this.handleEvent.bind(this)}static _getInstance(e){const t=this.receivers.find(s=>s.isListeningto(e));if(t)return t;const r=new Pg(e);return this.receivers.push(r),r}isListeningto(e){return this.eventTarget===e}async handleEvent(e){const t=e,{eventId:r,eventType:s,data:i}=t.data,o=this.handlersMap[s];if(!(o!=null&&o.size))return;t.ports[0].postMessage({status:"ack",eventId:r,eventType:s});const a=Array.from(o).map(async u=>u(t.origin,i)),c=await OB(a);t.ports[0].postMessage({status:"done",eventId:r,eventType:s,response:c})}_subscribe(e,t){Object.keys(this.handlersMap).length===0&&this.eventTarget.addEventListener("message",this.boundEventHandler),this.handlersMap[e]||(this.handlersMap[e]=new Set),this.handlersMap[e].add(t)}_unsubscribe(e,t){this.handlersMap[e]&&t&&this.handlersMap[e].delete(t),(!t||this.handlersMap[e].size===0)&&delete this.handlersMap[e],Object.keys(this.handlersMap).length===0&&this.eventTarget.removeEventListener("message",this.boundEventHandler)}}Pg.receivers=[];/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Og(n="",e=10){let t="";for(let r=0;r<e;r++)t+=Math.floor(Math.random()*10);return n+t}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class jB{constructor(e){this.target=e,this.handlers=new Set}removeMessageHandler(e){e.messageChannel&&(e.messageChannel.port1.removeEventListener("message",e.onMessage),e.messageChannel.port1.close()),this.handlers.delete(e)}async _send(e,t,r=50){const s=typeof MessageChannel<"u"?new MessageChannel:null;if(!s)throw new Error("connection_unavailable");let i,o;return new Promise((a,c)=>{const u=Og("",20);s.port1.start();const h=setTimeout(()=>{c(new Error("unsupported_event"))},r);o={messageChannel:s,onMessage(f){const m=f;if(m.data.eventId===u)switch(m.data.status){case"ack":clearTimeout(h),i=setTimeout(()=>{c(new Error("timeout"))},3e3);break;case"done":clearTimeout(i),a(m.data.response);break;default:clearTimeout(h),clearTimeout(i),c(new Error("invalid_response"));break}}},this.handlers.add(o),s.port1.addEventListener("message",o.onMessage),this.target.postMessage({eventType:e,eventId:u,data:t},[s.port2])}).finally(()=>{o&&this.removeMessageHandler(o)})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function yn(){return window}function LB(n){yn().location.href=n}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Yx(){return typeof yn().WorkerGlobalScope<"u"&&typeof yn().importScripts=="function"}async function MB(){if(!(navigator!=null&&navigator.serviceWorker))return null;try{return(await navigator.serviceWorker.ready).active}catch{return null}}function VB(){var n;return((n=navigator==null?void 0:navigator.serviceWorker)==null?void 0:n.controller)||null}function FB(){return Yx()?self:null}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const EP="firebaseLocalStorageDb",$B=1,dp="firebaseLocalStorage",bP="fbase_key";class kh{constructor(e){this.request=e}toPromise(){return new Promise((e,t)=>{this.request.addEventListener("success",()=>{e(this.request.result)}),this.request.addEventListener("error",()=>{t(this.request.error)})})}}function jg(n,e){return n.transaction([dp],e?"readwrite":"readonly").objectStore(dp)}function UB(){const n=indexedDB.deleteDatabase(EP);return new kh(n).toPromise()}function qv(){const n=indexedDB.open(EP,$B);return new Promise((e,t)=>{n.addEventListener("error",()=>{t(n.error)}),n.addEventListener("upgradeneeded",()=>{const r=n.result;try{r.createObjectStore(dp,{keyPath:bP})}catch(s){t(s)}}),n.addEventListener("success",async()=>{const r=n.result;r.objectStoreNames.contains(dp)?e(r):(r.close(),await UB(),e(await qv()))})})}async function TT(n,e,t){const r=jg(n,!0).put({[bP]:e,value:t});return new kh(r).toPromise()}async function BB(n,e){const t=jg(n,!1).get(e),r=await new kh(t).toPromise();return r===void 0?null:r.value}function AT(n,e){const t=jg(n,!0).delete(e);return new kh(t).toPromise()}const zB=800,qB=3;class TP{constructor(){this.type="LOCAL",this._shouldAllowMigration=!0,this.listeners={},this.localCache={},this.pollTimer=null,this.pendingWrites=0,this.receiver=null,this.sender=null,this.serviceWorkerReceiverAvailable=!1,this.activeServiceWorker=null,this._workerInitializationPromise=this.initializeServiceWorkerMessaging().then(()=>{},()=>{})}async _openDb(){return this.db?this.db:(this.db=await qv(),this.db)}async _withRetries(e){let t=0;for(;;)try{const r=await this._openDb();return await e(r)}catch(r){if(t++>qB)throw r;this.db&&(this.db.close(),this.db=void 0)}}async initializeServiceWorkerMessaging(){return Yx()?this.initializeReceiver():this.initializeSender()}async initializeReceiver(){this.receiver=Pg._getInstance(FB()),this.receiver._subscribe("keyChanged",async(e,t)=>({keyProcessed:(await this._poll()).includes(t.key)})),this.receiver._subscribe("ping",async(e,t)=>["keyChanged"])}async initializeSender(){var t,r;if(this.activeServiceWorker=await MB(),!this.activeServiceWorker)return;this.sender=new jB(this.activeServiceWorker);const e=await this.sender._send("ping",{},800);e&&(t=e[0])!=null&&t.fulfilled&&(r=e[0])!=null&&r.value.includes("keyChanged")&&(this.serviceWorkerReceiverAvailable=!0)}async notifyServiceWorker(e){if(!(!this.sender||!this.activeServiceWorker||VB()!==this.activeServiceWorker))try{await this.sender._send("keyChanged",{key:e},this.serviceWorkerReceiverAvailable?800:50)}catch{}}async _isAvailable(){try{if(!indexedDB)return!1;const e=await qv();return await TT(e,up,"1"),await AT(e,up),!0}catch{}return!1}async _withPendingWrite(e){this.pendingWrites++;try{await e()}finally{this.pendingWrites--}}async _set(e,t){return this._withPendingWrite(async()=>(await this._withRetries(r=>TT(r,e,t)),this.localCache[e]=t,this.notifyServiceWorker(e)))}async _get(e){const t=await this._withRetries(r=>BB(r,e));return this.localCache[e]=t,t}async _remove(e){return this._withPendingWrite(async()=>(await this._withRetries(t=>AT(t,e)),delete this.localCache[e],this.notifyServiceWorker(e)))}async _poll(){const e=await this._withRetries(s=>{const i=jg(s,!1).getAll();return new kh(i).toPromise()});if(!e)return[];if(this.pendingWrites!==0)return[];const t=[],r=new Set;if(e.length!==0)for(const{fbase_key:s,value:i}of e)r.add(s),JSON.stringify(this.localCache[s])!==JSON.stringify(i)&&(this.notifyListeners(s,i),t.push(s));for(const s of Object.keys(this.localCache))this.localCache[s]&&!r.has(s)&&(this.notifyListeners(s,null),t.push(s));return t}notifyListeners(e,t){this.localCache[e]=t;const r=this.listeners[e];if(r)for(const s of Array.from(r))s(t)}startPolling(){this.stopPolling(),this.pollTimer=setInterval(async()=>this._poll(),zB)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}_addListener(e,t){Object.keys(this.listeners).length===0&&this.startPolling(),this.listeners[e]||(this.listeners[e]=new Set,this._get(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),this.listeners[e].size===0&&delete this.listeners[e]),Object.keys(this.listeners).length===0&&this.stopPolling()}}TP.type="LOCAL";const WB=TP;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function CT(n,e){return Ft(n,"POST","/v2/accounts/mfaSignIn:start",Vt(n,e))}function GB(n,e){return Ft(n,"POST","/v2/accounts/mfaSignIn:finalize",Vt(n,e))}function HB(n,e){return Ft(n,"POST","/v2/accounts/mfaSignIn:finalize",Vt(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Wy=iP("rcb"),QB=new Eh(3e4,6e4);class KB{constructor(){var e;this.hostLanguage="",this.counter=0,this.librarySeparatelyLoaded=!!((e=yn().grecaptcha)!=null&&e.render)}load(e,t=""){return X(YB(t),e,"argument-error"),this.shouldResolveImmediately(t)&&pT(yn().grecaptcha)?Promise.resolve(yn().grecaptcha):new Promise((r,s)=>{const i=yn().setTimeout(()=>{s(ar(e,"network-request-failed"))},QB.get());yn()[Wy]=()=>{yn().clearTimeout(i),delete yn()[Wy];const a=yn().grecaptcha;if(!a||!pT(a)){s(ar(e,"internal-error"));return}const c=a.render;a.render=(u,h)=>{const f=c(u,h);return this.counter++,f},this.hostLanguage=t,r(a)};const o=`${kU()}?${Ma({onload:Wy,render:"explicit",hl:t})}`;Bx(o).catch(()=>{clearTimeout(i),s(ar(e,"internal-error"))})})}clearedOneInstance(){this.counter--}shouldResolveImmediately(e){var t;return!!((t=yn().grecaptcha)!=null&&t.render)&&(e===this.hostLanguage||this.counter>0||this.librarySeparatelyLoaded)}}function YB(n){return n.length<=6&&/^\s*[a-zA-Z0-9\-]*\s*$/.test(n)}class JB{async load(e){return new OU(e)}clearedOneInstance(){}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Xu="recaptcha",XB={theme:"light",type:"image"};class HW{constructor(e,t,r={...XB}){this.parameters=r,this.type=Xu,this.destroyed=!1,this.widgetId=null,this.tokenChangeListeners=new Set,this.renderPromise=null,this.recaptcha=null,this.auth=ln(e),this.isInvisible=this.parameters.size==="invisible",X(typeof document<"u",this.auth,"operation-not-supported-in-this-environment");const s=typeof t=="string"?document.getElementById(t):t;X(s,this.auth,"argument-error"),this.container=s,this.parameters.callback=this.makeTokenCallback(this.parameters.callback),this._recaptchaLoader=this.auth.settings.appVerificationDisabledForTesting?new JB:new KB,this.validateStartingState()}async verify(){this.assertNotDestroyed();const e=await this.render(),t=this.getAssertedRecaptcha(),r=t.getResponse(e);return r||new Promise(s=>{const i=o=>{o&&(this.tokenChangeListeners.delete(i),s(o))};this.tokenChangeListeners.add(i),this.isInvisible&&t.execute(e)})}render(){try{this.assertNotDestroyed()}catch(e){return Promise.reject(e)}return this.renderPromise?this.renderPromise:(this.renderPromise=this.makeRenderPromise().catch(e=>{throw this.renderPromise=null,e}),this.renderPromise)}_reset(){this.assertNotDestroyed(),this.widgetId!==null&&this.getAssertedRecaptcha().reset(this.widgetId)}clear(){this.assertNotDestroyed(),this.destroyed=!0,this._recaptchaLoader.clearedOneInstance(),this.isInvisible||this.container.childNodes.forEach(e=>{this.container.removeChild(e)})}validateStartingState(){X(!this.parameters.sitekey,this.auth,"argument-error"),X(this.isInvisible||!this.container.hasChildNodes(),this.auth,"argument-error"),X(typeof document<"u",this.auth,"operation-not-supported-in-this-environment")}makeTokenCallback(e){return t=>{if(this.tokenChangeListeners.forEach(r=>r(t)),typeof e=="function")e(t);else if(typeof e=="string"){const r=yn()[e];typeof r=="function"&&r(t)}}}assertNotDestroyed(){X(!this.destroyed,this.auth,"internal-error")}async makeRenderPromise(){if(await this.init(),!this.widgetId){let e=this.container;if(!this.isInvisible){const t=document.createElement("div");e.appendChild(t),e=t}this.widgetId=this.getAssertedRecaptcha().render(e,this.parameters)}return this.widgetId}async init(){X(Fx()&&!Yx(),this.auth,"internal-error"),await ZB(),this.recaptcha=await this._recaptchaLoader.load(this.auth,this.auth.languageCode||void 0);const e=await dU(this.auth);X(e,this.auth,"internal-error"),this.parameters.sitekey=e}getAssertedRecaptcha(){return X(this.recaptcha,this.auth,"internal-error"),this.recaptcha}}function ZB(){let n=null;return new Promise(e=>{if(document.readyState==="complete"){e();return}n=()=>e(),window.addEventListener("load",n)}).catch(e=>{throw n&&window.removeEventListener("load",n),e})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Jx{constructor(e,t){this.verificationId=e,this.onConfirmation=t}confirm(e){const t=da._fromVerification(this.verificationId,e);return this.onConfirmation(t)}}async function QW(n,e,t){if(Bt(n.app))return Promise.reject(jn(n));const r=ln(n),s=await Lg(r,e,le(t));return new Jx(s,i=>qx(r,i))}async function KW(n,e,t){const r=le(n);await Rg(!1,r,"phone");const s=await Lg(r.auth,e,le(t));return new Jx(s,i=>uB(r,i))}async function YW(n,e,t){const r=le(n);if(Bt(r.auth.app))return Promise.reject(jn(r.auth));const s=await Lg(r.auth,e,le(t));return new Jx(s,i=>dB(r,i))}async function Lg(n,e,t){var r;if(!n._getRecaptchaConfig())try{await aP(n)}catch{console.log("Failed to initialize reCAPTCHA Enterprise config. Triggering the reCAPTCHA v2 verification.")}try{let s;if(typeof e=="string"?s={phoneNumber:e}:s=e,"session"in s){const i=s.session;if("phoneNumber"in s){X(i.type==="enroll",n,"internal-error");const o={idToken:i.credential,phoneEnrollmentInfo:{phoneNumber:s.phoneNumber,clientType:"CLIENT_TYPE_WEB"}};return(await ho(n,o,"mfaSmsEnrollment",async(h,f)=>{if(f.phoneEnrollmentInfo.captchaResponse===Ku){X((t==null?void 0:t.type)===Xu,h,"argument-error");const m=await Gy(h,f,t);return bT(h,m)}return bT(h,f)},"PHONE_PROVIDER").catch(h=>Promise.reject(h))).phoneSessionInfo.sessionInfo}else{X(i.type==="signin",n,"internal-error");const o=((r=s.multiFactorHint)==null?void 0:r.uid)||s.multiFactorUid;X(o,n,"missing-multi-factor-info");const a={mfaPendingCredential:i.credential,mfaEnrollmentId:o,phoneSignInInfo:{clientType:"CLIENT_TYPE_WEB"}};return(await ho(n,a,"mfaSmsSignIn",async(f,m)=>{if(m.phoneSignInInfo.captchaResponse===Ku){X((t==null?void 0:t.type)===Xu,f,"argument-error");const y=await Gy(f,m,t);return CT(f,y)}return CT(f,m)},"PHONE_PROVIDER").catch(f=>Promise.reject(f))).phoneResponseInfo.sessionInfo}}else{const i={phoneNumber:s.phoneNumber,clientType:"CLIENT_TYPE_WEB"};return(await ho(n,i,"sendVerificationCode",async(u,h)=>{if(h.captchaResponse===Ku){X((t==null?void 0:t.type)===Xu,u,"argument-error");const f=await Gy(u,h,t);return IT(u,f)}return IT(u,h)},"PHONE_PROVIDER").catch(u=>Promise.reject(u))).sessionInfo}}finally{t==null||t._reset()}}async function JW(n,e){const t=le(n);if(Bt(t.auth.app))return Promise.reject(jn(t.auth));await zx(t,e)}async function Gy(n,e,t){X(t.type===Xu,n,"argument-error");const r=await t.verify();X(typeof r=="string",n,"argument-error");const s={...e};if("phoneEnrollmentInfo"in s){const i=s.phoneEnrollmentInfo.phoneNumber,o=s.phoneEnrollmentInfo.captchaResponse,a=s.phoneEnrollmentInfo.clientType,c=s.phoneEnrollmentInfo.recaptchaVersion;return Object.assign(s,{phoneEnrollmentInfo:{phoneNumber:i,recaptchaToken:r,captchaResponse:o,clientType:a,recaptchaVersion:c}}),s}else if("phoneSignInInfo"in s){const i=s.phoneSignInInfo.captchaResponse,o=s.phoneSignInInfo.clientType,a=s.phoneSignInInfo.recaptchaVersion;return Object.assign(s,{phoneSignInInfo:{recaptchaToken:r,captchaResponse:i,clientType:o,recaptchaVersion:a}}),s}else return Object.assign(s,{recaptchaToken:r}),s}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class $l{constructor(e){this.providerId=$l.PROVIDER_ID,this.auth=ln(e)}verifyPhoneNumber(e,t){return Lg(this.auth,e,le(t))}static credential(e,t){return da._fromVerification(e,t)}static credentialFromResult(e){const t=e;return $l.credentialFromTaggedObject(t)}static credentialFromError(e){return $l.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{phoneNumber:t,temporaryProof:r}=e;return t&&r?da._fromTokenResponse(t,r):null}}$l.PROVIDER_ID="phone";$l.PHONE_SIGN_IN_METHOD="phone";/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ka(n,e){return e?ri(e):(X(n._popupRedirectResolver,n,"argument-error"),n._popupRedirectResolver)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Xx extends Th{constructor(e){super("custom","custom"),this.params=e}_getIdTokenResponse(e){return ai(e,this._buildIdpRequest())}_linkToIdToken(e,t){return ai(e,this._buildIdpRequest(t))}_getReauthenticationResolver(e){return ai(e,this._buildIdpRequest())}_buildIdpRequest(e){const t={requestUri:this.params.requestUri,sessionId:this.params.sessionId,postBody:this.params.postBody,tenantId:this.params.tenantId,pendingToken:this.params.pendingToken,returnSecureToken:!0,returnIdpCredential:!0};return e&&(t.idToken=e),t}}function ez(n){return mP(n.auth,new Xx(n),n.bypassAuthState)}function tz(n){const{auth:e,user:t}=n;return X(t,e,"internal-error"),fP(t,new Xx(n),n.bypassAuthState)}async function nz(n){const{auth:e,user:t}=n;return X(t,e,"internal-error"),zx(t,new Xx(n),n.bypassAuthState)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class AP{constructor(e,t,r,s,i=!1){this.auth=e,this.resolver=r,this.user=s,this.bypassAuthState=i,this.pendingPromise=null,this.eventManager=null,this.filter=Array.isArray(t)?t:[t]}execute(){return new Promise(async(e,t)=>{this.pendingPromise={resolve:e,reject:t};try{this.eventManager=await this.resolver._initialize(this.auth),await this.onExecution(),this.eventManager.registerConsumer(this)}catch(r){this.reject(r)}})}async onAuthEvent(e){const{urlResponse:t,sessionId:r,postBody:s,tenantId:i,error:o,type:a}=e;if(o){this.reject(o);return}const c={auth:this.auth,requestUri:t,sessionId:r,tenantId:i||void 0,postBody:s||void 0,user:this.user,bypassAuthState:this.bypassAuthState};try{this.resolve(await this.getIdpTask(a)(c))}catch(u){this.reject(u)}}onError(e){this.reject(e)}getIdpTask(e){switch(e){case"signInViaPopup":case"signInViaRedirect":return ez;case"linkViaPopup":case"linkViaRedirect":return nz;case"reauthViaPopup":case"reauthViaRedirect":return tz;default:xr(this.auth,"internal-error")}}resolve(e){gi(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.resolve(e),this.unregisterAndCleanUp()}reject(e){gi(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.reject(e),this.unregisterAndCleanUp()}unregisterAndCleanUp(){this.eventManager&&this.eventManager.unregisterConsumer(this),this.pendingPromise=null,this.cleanUp()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const rz=new Eh(2e3,1e4);async function sz(n,e,t){if(Bt(n.app))return Promise.reject(ar(n,"operation-not-supported-in-this-environment"));const r=ln(n);Fc(n,e,Ti);const s=Ka(r,t);return new si(r,"signInViaPopup",e,s).executeNotNull()}async function XW(n,e,t){const r=le(n);if(Bt(r.auth.app))return Promise.reject(ar(r.auth,"operation-not-supported-in-this-environment"));Fc(r.auth,e,Ti);const s=Ka(r.auth,t);return new si(r.auth,"reauthViaPopup",e,s,r).executeNotNull()}async function ZW(n,e,t){const r=le(n);Fc(r.auth,e,Ti);const s=Ka(r.auth,t);return new si(r.auth,"linkViaPopup",e,s,r).executeNotNull()}class si extends AP{constructor(e,t,r,s,i){super(e,t,s,i),this.provider=r,this.authWindow=null,this.pollId=null,si.currentPopupAction&&si.currentPopupAction.cancel(),si.currentPopupAction=this}async executeNotNull(){const e=await this.execute();return X(e,this.auth,"internal-error"),e}async onExecution(){gi(this.filter.length===1,"Popup operations only handle one event");const e=Og();this.authWindow=await this.resolver._openPopup(this.auth,this.provider,this.filter[0],e),this.authWindow.associatedEvent=e,this.resolver._originValidation(this.auth).catch(t=>{this.reject(t)}),this.resolver._isIframeWebStorageSupported(this.auth,t=>{t||this.reject(ar(this.auth,"web-storage-unsupported"))}),this.pollUserCancellation()}get eventId(){var e;return((e=this.authWindow)==null?void 0:e.associatedEvent)||null}cancel(){this.reject(ar(this.auth,"cancelled-popup-request"))}cleanUp(){this.authWindow&&this.authWindow.close(),this.pollId&&window.clearTimeout(this.pollId),this.authWindow=null,this.pollId=null,si.currentPopupAction=null}pollUserCancellation(){const e=()=>{var t,r;if((r=(t=this.authWindow)==null?void 0:t.window)!=null&&r.closed){this.pollId=window.setTimeout(()=>{this.pollId=null,this.reject(ar(this.auth,"popup-closed-by-user"))},8e3);return}this.pollId=window.setTimeout(e,rz.get())};e()}}si.currentPopupAction=null;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const iz="pendingRedirect",tm=new Map;class oz extends AP{constructor(e,t,r=!1){super(e,["signInViaRedirect","linkViaRedirect","reauthViaRedirect","unknown"],t,void 0,r),this.eventId=null}async execute(){let e=tm.get(this.auth._key());if(!e){try{const r=await az(this.resolver,this.auth)?await super.execute():null;e=()=>Promise.resolve(r)}catch(t){e=()=>Promise.reject(t)}tm.set(this.auth._key(),e)}return this.bypassAuthState||tm.set(this.auth._key(),()=>Promise.resolve(null)),e()}async onAuthEvent(e){if(e.type==="signInViaRedirect")return super.onAuthEvent(e);if(e.type==="unknown"){this.resolve(null);return}if(e.eventId){const t=await this.auth._redirectUserForId(e.eventId);if(t)return this.user=t,super.onAuthEvent(e);this.resolve(null)}}async onExecution(){}cleanUp(){}}async function az(n,e){const t=kP(e),r=CP(n);if(!await r._isAvailable())return!1;const s=await r._get(t)==="true";return await r._remove(t),s}async function Zx(n,e){return CP(n)._set(kP(e),"true")}function lz(n,e){tm.set(n._key(),e)}function CP(n){return ri(n._redirectPersistence)}function kP(n){return Zf(iz,n.config.apiKey,n.name)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function eG(n,e,t){return cz(n,e,t)}async function cz(n,e,t){if(Bt(n.app))return Promise.reject(jn(n));const r=ln(n);Fc(n,e,Ti),await r._initializationPromise;const s=Ka(r,t);return await Zx(s,r),s._openRedirect(r,e,"signInViaRedirect")}function tG(n,e,t){return uz(n,e,t)}async function uz(n,e,t){const r=le(n);if(Fc(r.auth,e,Ti),Bt(r.auth.app))return Promise.reject(jn(r.auth));await r.auth._initializationPromise;const s=Ka(r.auth,t);await Zx(s,r.auth);const i=await RP(r);return s._openRedirect(r.auth,e,"reauthViaRedirect",i)}function nG(n,e,t){return dz(n,e,t)}async function dz(n,e,t){const r=le(n);Fc(r.auth,e,Ti),await r.auth._initializationPromise;const s=Ka(r.auth,t);await Rg(!1,r,e.providerId),await Zx(s,r.auth);const i=await RP(r);return s._openRedirect(r.auth,e,"linkViaRedirect",i)}async function rG(n,e){return await ln(n)._initializationPromise,NP(n,e,!1)}async function NP(n,e,t=!1){if(Bt(n.app))return Promise.reject(jn(n));const r=ln(n),s=Ka(r,e),o=await new oz(r,s,t).execute();return o&&!t&&(delete o.user._redirectEventId,await r._persistUserIfCurrent(o.user),await r._setRedirectUser(null,e)),o}async function RP(n){const e=Og(`${n.uid}:::`);return n._redirectEventId=e,await n.auth._setRedirectUser(n),await n.auth._persistUserIfCurrent(n),e}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const hz=10*60*1e3;class fz{constructor(e){this.auth=e,this.cachedEventUids=new Set,this.consumers=new Set,this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1,this.lastProcessedEventTime=Date.now()}registerConsumer(e){this.consumers.add(e),this.queuedRedirectEvent&&this.isEventForConsumer(this.queuedRedirectEvent,e)&&(this.sendToConsumer(this.queuedRedirectEvent,e),this.saveEventToCache(this.queuedRedirectEvent),this.queuedRedirectEvent=null)}unregisterConsumer(e){this.consumers.delete(e)}onEvent(e){if(this.hasEventBeenHandled(e))return!1;let t=!1;return this.consumers.forEach(r=>{this.isEventForConsumer(e,r)&&(t=!0,this.sendToConsumer(e,r),this.saveEventToCache(e))}),this.hasHandledPotentialRedirect||!mz(e)||(this.hasHandledPotentialRedirect=!0,t||(this.queuedRedirectEvent=e,t=!0)),t}sendToConsumer(e,t){var r;if(e.error&&!DP(e)){const s=((r=e.error.code)==null?void 0:r.split("auth/")[1])||"internal-error";t.onError(ar(this.auth,s))}else t.onAuthEvent(e)}isEventForConsumer(e,t){const r=t.eventId===null||!!e.eventId&&e.eventId===t.eventId;return t.filter.includes(e.type)&&r}hasEventBeenHandled(e){return Date.now()-this.lastProcessedEventTime>=hz&&this.cachedEventUids.clear(),this.cachedEventUids.has(kT(e))}saveEventToCache(e){this.cachedEventUids.add(kT(e)),this.lastProcessedEventTime=Date.now()}}function kT(n){return[n.type,n.eventId,n.sessionId,n.tenantId].filter(e=>e).join("-")}function DP({type:n,error:e}){return n==="unknown"&&(e==null?void 0:e.code)==="auth/no-auth-event"}function mz(n){switch(n.type){case"signInViaRedirect":case"linkViaRedirect":case"reauthViaRedirect":return!0;case"unknown":return DP(n);default:return!1}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function pz(n,e={}){return Ft(n,"GET","/v1/projects",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const gz=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,yz=/^https?/;async function _z(n){if(n.config.emulator)return;const{authorizedDomains:e}=await pz(n);for(const t of e)try{if(vz(t))return}catch{}xr(n,"unauthorized-domain")}function vz(n){const e=Ud(),{protocol:t,hostname:r}=new URL(e);if(n.startsWith("chrome-extension://")){const o=new URL(n);return o.hostname===""&&r===""?t==="chrome-extension:"&&n.replace("chrome-extension://","")===e.replace("chrome-extension://",""):t==="chrome-extension:"&&o.hostname===r}if(!yz.test(t))return!1;if(gz.test(n))return r===n;const s=n.replace(/\./g,"\\.");return new RegExp("^(.+\\."+s+"|"+s+")$","i").test(r)}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const wz=new Eh(3e4,6e4);function NT(){const n=yn().___jsl;if(n!=null&&n.H){for(const e of Object.keys(n.H))if(n.H[e].r=n.H[e].r||[],n.H[e].L=n.H[e].L||[],n.H[e].r=[...n.H[e].L],n.CP)for(let t=0;t<n.CP.length;t++)n.CP[t]=null}}function xz(n){return new Promise((e,t)=>{var s,i,o;function r(){NT(),gapi.load("gapi.iframes",{callback:()=>{e(gapi.iframes.getContext())},ontimeout:()=>{NT(),t(ar(n,"network-request-failed"))},timeout:wz.get()})}if((i=(s=yn().gapi)==null?void 0:s.iframes)!=null&&i.Iframe)e(gapi.iframes.getContext());else if((o=yn().gapi)!=null&&o.load)r();else{const a=iP("iframefcb");return yn()[a]=()=>{gapi.load?r():t(ar(n,"network-request-failed"))},Bx(`${RU()}?onload=${a}`).catch(c=>t(c))}}).catch(e=>{throw nm=null,e})}let nm=null;function Sz(n){return nm=nm||xz(n),nm}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Iz=new Eh(5e3,15e3),Ez="__/auth/iframe",bz="emulator/auth/iframe",Tz={style:{position:"absolute",top:"-100px",width:"1px",height:"1px"},"aria-hidden":"true",tabindex:"-1"},Az=new Map([["identitytoolkit.googleapis.com","p"],["staging-identitytoolkit.sandbox.googleapis.com","s"],["test-identitytoolkit.sandbox.googleapis.com","t"]]);function Cz(n){const e=n.config;X(e.authDomain,n,"auth-domain-config-required");const t=e.emulator?$x(e,bz):`https://${n.config.authDomain}/${Ez}`,r={apiKey:e.apiKey,appName:n.name,v:Va},s=Az.get(n.config.apiHost);s&&(r.eid=s);const i=n._getFrameworks();return i.length&&(r.fw=i.join(",")),`${t}?${Ma(r).slice(1)}`}async function kz(n){const e=await Sz(n),t=yn().gapi;return X(t,n,"internal-error"),e.open({where:document.body,url:Cz(n),messageHandlersFilter:t.iframes.CROSS_ORIGIN_IFRAMES_FILTER,attributes:Tz,dontclear:!0},r=>new Promise(async(s,i)=>{await r.restyle({setHideOnLeave:!1});const o=ar(n,"network-request-failed"),a=yn().setTimeout(()=>{i(o)},Iz.get());function c(){yn().clearTimeout(a),s(r)}r.ping(c).then(c,()=>{i(o)})}))}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Nz={location:"yes",resizable:"yes",statusbar:"yes",toolbar:"no"},Rz=500,Dz=600,Pz="_blank",Oz="http://localhost";class RT{constructor(e){this.window=e,this.associatedEvent=null}close(){if(this.window)try{this.window.close()}catch{}}}function jz(n,e,t,r=Rz,s=Dz){const i=Math.max((window.screen.availHeight-s)/2,0).toString(),o=Math.max((window.screen.availWidth-r)/2,0).toString();let a="";const c={...Nz,width:r.toString(),height:s.toString(),top:i,left:o},u=En().toLowerCase();t&&(a=XD(u)?Pz:t),YD(u)&&(e=e||Oz,c.scrollbars="yes");const h=Object.entries(c).reduce((m,[y,w])=>`${m}${y}=${w},`,"");if(xU(u)&&a!=="_self")return Lz(e||"",a),new RT(null);const f=window.open(e||"",a,h);X(f,n,"popup-blocked");try{f.focus()}catch{}return new RT(f)}function Lz(n,e){const t=document.createElement("a");t.href=n,t.target=e;const r=document.createEvent("MouseEvent");r.initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,1,null),t.dispatchEvent(r)}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Mz="__/auth/handler",Vz="emulator/auth/handler",Fz=encodeURIComponent("fac");async function DT(n,e,t,r,s,i){X(n.config.authDomain,n,"auth-domain-config-required"),X(n.config.apiKey,n,"invalid-api-key");const o={apiKey:n.config.apiKey,appName:n.name,authType:t,redirectUrl:r,v:Va,eventId:s};if(e instanceof Ti){e.setDefaultLanguage(n.languageCode),o.providerId=e.providerId||"",km(e.getCustomParameters())||(o.customParameters=JSON.stringify(e.getCustomParameters()));for(const[h,f]of Object.entries(i||{}))o[h]=f}if(e instanceof $c){const h=e.getScopes().filter(f=>f!=="");h.length>0&&(o.scopes=h.join(","))}n.tenantId&&(o.tid=n.tenantId);const a=o;for(const h of Object.keys(a))a[h]===void 0&&delete a[h];const c=await n._getAppCheckToken(),u=c?`#${Fz}=${encodeURIComponent(c)}`:"";return`${$z(n)}?${Ma(a).slice(1)}${u}`}function $z({config:n}){return n.emulator?$x(n,Vz):`https://${n.authDomain}/${Mz}`}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Hy="webStorageSupport";class Uz{constructor(){this.eventManagers={},this.iframes={},this.originValidationPromises={},this._redirectPersistence=Ju,this._completeRedirectFn=NP,this._overrideRedirectResult=lz}async _openPopup(e,t,r,s){var o;gi((o=this.eventManagers[e._key()])==null?void 0:o.manager,"_initialize() not called before _openPopup()");const i=await DT(e,t,r,Ud(),s);return jz(e,i,Og())}async _openRedirect(e,t,r,s){await this._originValidation(e);const i=await DT(e,t,r,Ud(),s);return LB(i),new Promise(()=>{})}_initialize(e){const t=e._key();if(this.eventManagers[t]){const{manager:s,promise:i}=this.eventManagers[t];return s?Promise.resolve(s):(gi(i,"If manager is not set, promise should be"),i)}const r=this.initAndGetManager(e);return this.eventManagers[t]={promise:r},r.catch(()=>{delete this.eventManagers[t]}),r}async initAndGetManager(e){const t=await kz(e),r=new fz(e);return t.register("authEvent",s=>(X(s==null?void 0:s.authEvent,e,"invalid-auth-event"),{status:r.onEvent(s.authEvent)?"ACK":"ERROR"}),gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER),this.eventManagers[e._key()]={manager:r},this.iframes[e._key()]=t,r}_isIframeWebStorageSupported(e,t){this.iframes[e._key()].send(Hy,{type:Hy},s=>{var o;const i=(o=s==null?void 0:s[0])==null?void 0:o[Hy];i!==void 0&&t(!!i),xr(e,"internal-error")},gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER)}_originValidation(e){const t=e._key();return this.originValidationPromises[t]||(this.originValidationPromises[t]=_z(e)),this.originValidationPromises[t]}get _shouldInitProactively(){return rP()||JD()||Ux()}}const Bz=Uz;class PP{constructor(e){this.factorId=e}_process(e,t,r){switch(t.type){case"enroll":return this._finalizeEnroll(e,t.credential,r);case"signin":return this._finalizeSignIn(e,t.credential);default:return Rs("unexpected MultiFactorSessionType")}}}class eS extends PP{constructor(e){super("phone"),this.credential=e}static _fromCredential(e){return new eS(e)}_finalizeEnroll(e,t,r){return AB(e,{idToken:t,displayName:r,phoneVerificationInfo:this.credential._makeVerificationRequest()})}_finalizeSignIn(e,t){return GB(e,{mfaPendingCredential:t,phoneVerificationInfo:this.credential._makeVerificationRequest()})}}class zz{constructor(){}static assertion(e){return eS._fromCredential(e)}}zz.FACTOR_ID="phone";class qz{static assertionForEnrollment(e,t){return Wd._fromSecret(e,t)}static assertionForSignIn(e,t){return Wd._fromEnrollmentId(e,t)}static async generateSecret(e){var s;const t=e;X(typeof((s=t.user)==null?void 0:s.auth)<"u","internal-error");const r=await CB(t.user.auth,{idToken:t.credential,totpEnrollmentInfo:{}});return tS._fromStartTotpMfaEnrollmentResponse(r,t.user.auth)}}qz.FACTOR_ID="totp";class Wd extends PP{constructor(e,t,r){super("totp"),this.otp=e,this.enrollmentId=t,this.secret=r}static _fromSecret(e,t){return new Wd(t,void 0,e)}static _fromEnrollmentId(e,t){return new Wd(t,e)}async _finalizeEnroll(e,t,r){return X(typeof this.secret<"u",e,"argument-error"),kB(e,{idToken:t,displayName:r,totpVerificationInfo:this.secret._makeTotpVerificationInfo(this.otp)})}async _finalizeSignIn(e,t){X(this.enrollmentId!==void 0&&this.otp!==void 0,e,"argument-error");const r={verificationCode:this.otp};return HB(e,{mfaPendingCredential:t,mfaEnrollmentId:this.enrollmentId,totpVerificationInfo:r})}}class tS{constructor(e,t,r,s,i,o,a){this.sessionInfo=o,this.auth=a,this.secretKey=e,this.hashingAlgorithm=t,this.codeLength=r,this.codeIntervalSeconds=s,this.enrollmentCompletionDeadline=i}static _fromStartTotpMfaEnrollmentResponse(e,t){return new tS(e.totpSessionInfo.sharedSecretKey,e.totpSessionInfo.hashingAlgorithm,e.totpSessionInfo.verificationCodeLength,e.totpSessionInfo.periodSec,new Date(e.totpSessionInfo.finalizeEnrollmentTime).toUTCString(),e.totpSessionInfo.sessionInfo,t)}_makeTotpVerificationInfo(e){return{sessionInfo:this.sessionInfo,verificationCode:e}}generateQrCodeUrl(e,t){var s;let r=!1;return(wf(e)||wf(t))&&(r=!0),r&&(wf(e)&&(e=((s=this.auth.currentUser)==null?void 0:s.email)||"unknownuser"),wf(t)&&(t=this.auth.name)),`otpauth://totp/${t}:${e}?secret=${this.secretKey}&issuer=${t}&algorithm=${this.hashingAlgorithm}&digits=${this.codeLength}`}}function wf(n){return typeof n>"u"||(n==null?void 0:n.length)===0}var PT="@firebase/auth",OT="1.11.0";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Wz{constructor(e){this.auth=e,this.internalListeners=new Map}getUid(){var e;return this.assertAuthConfigured(),((e=this.auth.currentUser)==null?void 0:e.uid)||null}async getToken(e){return this.assertAuthConfigured(),await this.auth._initializationPromise,this.auth.currentUser?{accessToken:await this.auth.currentUser.getIdToken(e)}:null}addAuthTokenListener(e){if(this.assertAuthConfigured(),this.internalListeners.has(e))return;const t=this.auth.onIdTokenChanged(r=>{e((r==null?void 0:r.stsTokenManager.accessToken)||null)});this.internalListeners.set(e,t),this.updateProactiveRefresh()}removeAuthTokenListener(e){this.assertAuthConfigured();const t=this.internalListeners.get(e);t&&(this.internalListeners.delete(e),t(),this.updateProactiveRefresh())}assertAuthConfigured(){X(this.auth._initializationPromise,"dependent-sdk-initialized-before-auth")}updateProactiveRefresh(){this.internalListeners.size>0?this.auth._startProactiveRefresh():this.auth._stopProactiveRefresh()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Gz(n){switch(n){case"Node":return"node";case"ReactNative":return"rn";case"Worker":return"webworker";case"Cordova":return"cordova";case"WebExtension":return"web-extension";default:return}}function Hz(n){gs(new wr("auth",(e,{options:t})=>{const r=e.getProvider("app").getImmediate(),s=e.getProvider("heartbeat"),i=e.getProvider("app-check-internal"),{apiKey:o,authDomain:a}=r.options;X(o&&!o.includes(":"),"invalid-api-key",{appName:r.name});const c={apiKey:o,authDomain:a,clientPlatform:n,apiHost:"identitytoolkit.googleapis.com",tokenApiHost:"securetoken.googleapis.com",apiScheme:"https",sdkClientVersion:sP(n)},u=new AU(r,s,i,c);return UU(u,t),u},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((e,t,r)=>{e.getProvider("auth-internal").initialize()})),gs(new wr("auth-internal",e=>{const t=ln(e.getProvider("auth").getImmediate());return(r=>new Wz(r))(t)},"PRIVATE").setInstantiationMode("EXPLICIT")),_r(PT,OT,Gz(n)),_r(PT,OT,"esm2020")}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Qz=5*60,Kz=wC("authIdTokenMaxAge")||Qz;let jT=null;const Yz=n=>async e=>{const t=e&&await e.getIdTokenResult(),r=t&&(new Date().getTime()-Date.parse(t.issuedAtTime))/1e3;if(r&&r>Kz)return;const s=t==null?void 0:t.token;jT!==s&&(jT=s,await fetch(n,{method:s?"POST":"DELETE",headers:s?{Authorization:`Bearer ${s}`}:{}}))};function Jz(n=Zd()){const e=Ws(n,"auth");if(e.isInitialized())return e.getImmediate();const t=$U(n,{popupRedirectResolver:Bz,persistence:[WB,Yu,Ju]}),r=wC("authTokenSyncURL");if(r&&typeof isSecureContext=="boolean"&&isSecureContext){const i=new URL(r,location.origin);if(location.origin===i.origin){const o=Yz(i.toString());EB(t,o,()=>o(t.currentUser)),IB(t,a=>o(a))}}const s=yC("auth");return s&&BU(t,`http://${s}`),t}function Xz(){var n;return((n=document.getElementsByTagName("head"))==null?void 0:n[0])??document}CU({loadJS(n){return new Promise((e,t)=>{const r=document.createElement("script");r.setAttribute("src",n),r.onload=e,r.onerror=s=>{const i=ar("internal-error");i.customData=s,t(i)},r.type="text/javascript",r.charset="UTF-8",Xz().appendChild(r)})},gapiScript:"https://apis.google.com/js/api.js",recaptchaV2Script:"https://www.google.com/recaptcha/api.js",recaptchaEnterpriseScript:"https://www.google.com/recaptcha/enterprise.js?render="});Hz("Browser");const OP="@firebase/installations",nS="0.6.19";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const jP=1e4,LP=`w:${nS}`,MP="FIS_v2",Zz="https://firebaseinstallations.googleapis.com/v1",e9=60*60*1e3,t9="installations",n9="Installations";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const r9={"missing-app-config-values":'Missing App configuration value: "{$valueName}"',"not-registered":"Firebase Installation is not registered.","installation-not-found":"Firebase Installation not found.","request-failed":'{$requestName} request failed with error "{$serverCode} {$serverStatus}: {$serverMessage}"',"app-offline":"Could not process request. Application offline.","delete-pending-registration":"Can't delete installation while there is a pending registration request."},Da=new La(t9,n9,r9);function VP(n){return n instanceof ys&&n.code.includes("request-failed")}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function FP({projectId:n}){return`${Zz}/projects/${n}/installations`}function $P(n){return{token:n.token,requestStatus:2,expiresIn:i9(n.expiresIn),creationTime:Date.now()}}async function UP(n,e){const r=(await e.json()).error;return Da.create("request-failed",{requestName:n,serverCode:r.code,serverMessage:r.message,serverStatus:r.status})}function BP({apiKey:n}){return new Headers({"Content-Type":"application/json",Accept:"application/json","x-goog-api-key":n})}function s9(n,{refreshToken:e}){const t=BP(n);return t.append("Authorization",o9(e)),t}async function zP(n){const e=await n();return e.status>=500&&e.status<600?n():e}function i9(n){return Number(n.replace("s","000"))}function o9(n){return`${MP} ${n}`}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function a9({appConfig:n,heartbeatServiceProvider:e},{fid:t}){const r=FP(n),s=BP(n),i=e.getImmediate({optional:!0});if(i){const u=await i.getHeartbeatsHeader();u&&s.append("x-firebase-client",u)}const o={fid:t,authVersion:MP,appId:n.appId,sdkVersion:LP},a={method:"POST",headers:s,body:JSON.stringify(o)},c=await zP(()=>fetch(r,a));if(c.ok){const u=await c.json();return{fid:u.fid||t,registrationStatus:2,refreshToken:u.refreshToken,authToken:$P(u.authToken)}}else throw await UP("Create Installation",c)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function qP(n){return new Promise(e=>{setTimeout(e,n)})}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function l9(n){return btoa(String.fromCharCode(...n)).replace(/\+/g,"-").replace(/\//g,"_")}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const c9=/^[cdef][\w-]{21}$/,Wv="";function u9(){try{const n=new Uint8Array(17);(self.crypto||self.msCrypto).getRandomValues(n),n[0]=112+n[0]%16;const t=d9(n);return c9.test(t)?t:Wv}catch{return Wv}}function d9(n){return l9(n).substr(0,22)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Mg(n){return`${n.appName}!${n.appId}`}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const WP=new Map;function GP(n,e){const t=Mg(n);HP(t,e),h9(t,e)}function HP(n,e){const t=WP.get(n);if(t)for(const r of t)r(e)}function h9(n,e){const t=f9();t&&t.postMessage({key:n,fid:e}),m9()}let sa=null;function f9(){return!sa&&"BroadcastChannel"in self&&(sa=new BroadcastChannel("[Firebase] FID Change"),sa.onmessage=n=>{HP(n.data.key,n.data.fid)}),sa}function m9(){WP.size===0&&sa&&(sa.close(),sa=null)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const p9="firebase-installations-database",g9=1,Pa="firebase-installations-store";let Qy=null;function rS(){return Qy||(Qy=G0(p9,g9,{upgrade:(n,e)=>{switch(e){case 0:n.createObjectStore(Pa)}}})),Qy}async function hp(n,e){const t=Mg(n),s=(await rS()).transaction(Pa,"readwrite"),i=s.objectStore(Pa),o=await i.get(t);return await i.put(e,t),await s.done,(!o||o.fid!==e.fid)&&GP(n,e.fid),e}async function QP(n){const e=Mg(n),r=(await rS()).transaction(Pa,"readwrite");await r.objectStore(Pa).delete(e),await r.done}async function Vg(n,e){const t=Mg(n),s=(await rS()).transaction(Pa,"readwrite"),i=s.objectStore(Pa),o=await i.get(t),a=e(o);return a===void 0?await i.delete(t):await i.put(a,t),await s.done,a&&(!o||o.fid!==a.fid)&&GP(n,a.fid),a}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function sS(n){let e;const t=await Vg(n.appConfig,r=>{const s=y9(r),i=_9(n,s);return e=i.registrationPromise,i.installationEntry});return t.fid===Wv?{installationEntry:await e}:{installationEntry:t,registrationPromise:e}}function y9(n){const e=n||{fid:u9(),registrationStatus:0};return KP(e)}function _9(n,e){if(e.registrationStatus===0){if(!navigator.onLine){const s=Promise.reject(Da.create("app-offline"));return{installationEntry:e,registrationPromise:s}}const t={fid:e.fid,registrationStatus:1,registrationTime:Date.now()},r=v9(n,t);return{installationEntry:t,registrationPromise:r}}else return e.registrationStatus===1?{installationEntry:e,registrationPromise:w9(n)}:{installationEntry:e}}async function v9(n,e){try{const t=await a9(n,e);return hp(n.appConfig,t)}catch(t){throw VP(t)&&t.customData.serverCode===409?await QP(n.appConfig):await hp(n.appConfig,{fid:e.fid,registrationStatus:0}),t}}async function w9(n){let e=await LT(n.appConfig);for(;e.registrationStatus===1;)await qP(100),e=await LT(n.appConfig);if(e.registrationStatus===0){const{installationEntry:t,registrationPromise:r}=await sS(n);return r||t}return e}function LT(n){return Vg(n,e=>{if(!e)throw Da.create("installation-not-found");return KP(e)})}function KP(n){return x9(n)?{fid:n.fid,registrationStatus:0}:n}function x9(n){return n.registrationStatus===1&&n.registrationTime+jP<Date.now()}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function S9({appConfig:n,heartbeatServiceProvider:e},t){const r=I9(n,t),s=s9(n,t),i=e.getImmediate({optional:!0});if(i){const u=await i.getHeartbeatsHeader();u&&s.append("x-firebase-client",u)}const o={installation:{sdkVersion:LP,appId:n.appId}},a={method:"POST",headers:s,body:JSON.stringify(o)},c=await zP(()=>fetch(r,a));if(c.ok){const u=await c.json();return $P(u)}else throw await UP("Generate Auth Token",c)}function I9(n,{fid:e}){return`${FP(n)}/${e}/authTokens:generate`}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function iS(n,e=!1){let t;const r=await Vg(n.appConfig,i=>{if(!YP(i))throw Da.create("not-registered");const o=i.authToken;if(!e&&T9(o))return i;if(o.requestStatus===1)return t=E9(n,e),i;{if(!navigator.onLine)throw Da.create("app-offline");const a=C9(i);return t=b9(n,a),a}});return t?await t:r.authToken}async function E9(n,e){let t=await MT(n.appConfig);for(;t.authToken.requestStatus===1;)await qP(100),t=await MT(n.appConfig);const r=t.authToken;return r.requestStatus===0?iS(n,e):r}function MT(n){return Vg(n,e=>{if(!YP(e))throw Da.create("not-registered");const t=e.authToken;return k9(t)?{...e,authToken:{requestStatus:0}}:e})}async function b9(n,e){try{const t=await S9(n,e),r={...e,authToken:t};return await hp(n.appConfig,r),t}catch(t){if(VP(t)&&(t.customData.serverCode===401||t.customData.serverCode===404))await QP(n.appConfig);else{const r={...e,authToken:{requestStatus:0}};await hp(n.appConfig,r)}throw t}}function YP(n){return n!==void 0&&n.registrationStatus===2}function T9(n){return n.requestStatus===2&&!A9(n)}function A9(n){const e=Date.now();return e<n.creationTime||n.creationTime+n.expiresIn<e+e9}function C9(n){const e={requestStatus:1,requestTime:Date.now()};return{...n,authToken:e}}function k9(n){return n.requestStatus===1&&n.requestTime+jP<Date.now()}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function N9(n){const e=n,{installationEntry:t,registrationPromise:r}=await sS(e);return r?r.catch(console.error):iS(e).catch(console.error),t.fid}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function R9(n,e=!1){const t=n;return await D9(t),(await iS(t,e)).token}async function D9(n){const{registrationPromise:e}=await sS(n);e&&await e}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function P9(n){if(!n||!n.options)throw Ky("App Configuration");if(!n.name)throw Ky("App Name");const e=["projectId","apiKey","appId"];for(const t of e)if(!n.options[t])throw Ky(t);return{appName:n.name,projectId:n.options.projectId,apiKey:n.options.apiKey,appId:n.options.appId}}function Ky(n){return Da.create("missing-app-config-values",{valueName:n})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const JP="installations",O9="installations-internal",j9=n=>{const e=n.getProvider("app").getImmediate(),t=P9(e),r=Ws(e,"heartbeat");return{app:e,appConfig:t,heartbeatServiceProvider:r,_delete:()=>Promise.resolve()}},L9=n=>{const e=n.getProvider("app").getImmediate(),t=Ws(e,JP).getImmediate();return{getId:()=>N9(t),getToken:s=>R9(t,s)}};function M9(){gs(new wr(JP,j9,"PUBLIC")),gs(new wr(O9,L9,"PRIVATE"))}M9();_r(OP,nS);_r(OP,nS,"esm2020");/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const fp="analytics",V9="firebase_id",F9="origin",$9=60*1e3,U9="https://firebase.googleapis.com/v1alpha/projects/-/apps/{app-id}/webConfig",oS="https://www.googletagmanager.com/gtag/js";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const vr=new Xd("@firebase/analytics");/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const B9={"already-exists":"A Firebase Analytics instance with the appId {$id}  already exists. Only one Firebase Analytics instance can be created for each appId.","already-initialized":"initializeAnalytics() cannot be called again with different options than those it was initially called with. It can be called again with the same options to return the existing instance, or getAnalytics() can be used to get a reference to the already-initialized instance.","already-initialized-settings":"Firebase Analytics has already been initialized.settings() must be called before initializing any Analytics instanceor it will have no effect.","interop-component-reg-failed":"Firebase Analytics Interop Component failed to instantiate: {$reason}","invalid-analytics-context":"Firebase Analytics is not supported in this environment. Wrap initialization of analytics in analytics.isSupported() to prevent initialization in unsupported environments. Details: {$errorInfo}","indexeddb-unavailable":"IndexedDB unavailable or restricted in this environment. Wrap initialization of analytics in analytics.isSupported() to prevent initialization in unsupported environments. Details: {$errorInfo}","fetch-throttle":"The config fetch request timed out while in an exponential backoff state. Unix timestamp in milliseconds when fetch request throttling ends: {$throttleEndTimeMillis}.","config-fetch-failed":"Dynamic config fetch failed: [{$httpStatus}] {$responseMessage}","no-api-key":'The "apiKey" field is empty in the local Firebase config. Firebase Analytics requires this field tocontain a valid API key.',"no-app-id":'The "appId" field is empty in the local Firebase config. Firebase Analytics requires this field tocontain a valid app ID.',"no-client-id":'The "client_id" field is empty.',"invalid-gtag-resource":"Trusted Types detected an invalid gtag resource: {$gtagURL}."},Pr=new La("analytics","Analytics",B9);/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function z9(n){if(!n.startsWith(oS)){const e=Pr.create("invalid-gtag-resource",{gtagURL:n});return vr.warn(e.message),""}return n}function XP(n){return Promise.all(n.map(e=>e.catch(t=>t)))}function q9(n,e){let t;return window.trustedTypes&&(t=window.trustedTypes.createPolicy(n,e)),t}function W9(n,e){const t=q9("firebase-js-sdk-policy",{createScriptURL:z9}),r=document.createElement("script"),s=`${oS}?l=${n}&id=${e}`;r.src=t?t==null?void 0:t.createScriptURL(s):s,r.async=!0,document.head.appendChild(r)}function G9(n){let e=[];return Array.isArray(window[n])?e=window[n]:window[n]=e,e}async function H9(n,e,t,r,s,i){const o=r[s];try{if(o)await e[o];else{const c=(await XP(t)).find(u=>u.measurementId===s);c&&await e[c.appId]}}catch(a){vr.error(a)}n("config",s,i)}async function Q9(n,e,t,r,s){try{let i=[];if(s&&s.send_to){let o=s.send_to;Array.isArray(o)||(o=[o]);const a=await XP(t);for(const c of o){const u=a.find(f=>f.measurementId===c),h=u&&e[u.appId];if(h)i.push(h);else{i=[];break}}}i.length===0&&(i=Object.values(e)),await Promise.all(i),n("event",r,s||{})}catch(i){vr.error(i)}}function K9(n,e,t,r){async function s(i,...o){try{if(i==="event"){const[a,c]=o;await Q9(n,e,t,a,c)}else if(i==="config"){const[a,c]=o;await H9(n,e,t,r,a,c)}else if(i==="consent"){const[a,c]=o;n("consent",a,c)}else if(i==="get"){const[a,c,u]=o;n("get",a,c,u)}else if(i==="set"){const[a]=o;n("set",a)}else n(i,...o)}catch(a){vr.error(a)}}return s}function Y9(n,e,t,r,s){let i=function(...o){window[r].push(arguments)};return window[s]&&typeof window[s]=="function"&&(i=window[s]),window[s]=K9(i,n,e,t),{gtagCore:i,wrappedGtag:window[s]}}function J9(n){const e=window.document.getElementsByTagName("script");for(const t of Object.values(e))if(t.src&&t.src.includes(oS)&&t.src.includes(n))return t;return null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const X9=30,Z9=1e3;class e8{constructor(e={},t=Z9){this.throttleMetadata=e,this.intervalMillis=t}getThrottleMetadata(e){return this.throttleMetadata[e]}setThrottleMetadata(e,t){this.throttleMetadata[e]=t}deleteThrottleMetadata(e){delete this.throttleMetadata[e]}}const ZP=new e8;function t8(n){return new Headers({Accept:"application/json","x-goog-api-key":n})}async function n8(n){var o;const{appId:e,apiKey:t}=n,r={method:"GET",headers:t8(t)},s=U9.replace("{app-id}",e),i=await fetch(s,r);if(i.status!==200&&i.status!==304){let a="";try{const c=await i.json();(o=c.error)!=null&&o.message&&(a=c.error.message)}catch{}throw Pr.create("config-fetch-failed",{httpStatus:i.status,responseMessage:a})}return i.json()}async function r8(n,e=ZP,t){const{appId:r,apiKey:s,measurementId:i}=n.options;if(!r)throw Pr.create("no-app-id");if(!s){if(i)return{measurementId:i,appId:r};throw Pr.create("no-api-key")}const o=e.getThrottleMetadata(r)||{backoffCount:0,throttleEndTimeMillis:Date.now()},a=new o8;return setTimeout(async()=>{a.abort()},t!==void 0?t:$9),e2({appId:r,apiKey:s,measurementId:i},o,a,e)}async function e2(n,{throttleEndTimeMillis:e,backoffCount:t},r,s=ZP){var a;const{appId:i,measurementId:o}=n;try{await s8(r,e)}catch(c){if(o)return vr.warn(`Timed out fetching this Firebase app's measurement ID from the server. Falling back to the measurement ID ${o} provided in the "measurementId" field in the local Firebase config. [${c==null?void 0:c.message}]`),{appId:i,measurementId:o};throw c}try{const c=await n8(n);return s.deleteThrottleMetadata(i),c}catch(c){const u=c;if(!i8(u)){if(s.deleteThrottleMetadata(i),o)return vr.warn(`Failed to fetch this Firebase app's measurement ID from the server. Falling back to the measurement ID ${o} provided in the "measurementId" field in the local Firebase config. [${u==null?void 0:u.message}]`),{appId:i,measurementId:o};throw c}const h=Number((a=u==null?void 0:u.customData)==null?void 0:a.httpStatus)===503?eE(t,s.intervalMillis,X9):eE(t,s.intervalMillis),f={throttleEndTimeMillis:Date.now()+h,backoffCount:t+1};return s.setThrottleMetadata(i,f),vr.debug(`Calling attemptFetch again in ${h} millis`),e2(n,f,r,s)}}function s8(n,e){return new Promise((t,r)=>{const s=Math.max(e-Date.now(),0),i=setTimeout(t,s);n.addEventListener(()=>{clearTimeout(i),r(Pr.create("fetch-throttle",{throttleEndTimeMillis:e}))})})}function i8(n){if(!(n instanceof ys)||!n.customData)return!1;const e=Number(n.customData.httpStatus);return e===429||e===500||e===503||e===504}class o8{constructor(){this.listeners=[]}addEventListener(e){this.listeners.push(e)}abort(){this.listeners.forEach(e=>e())}}async function a8(n,e,t,r,s){if(s&&s.global){n("event",t,r);return}else{const i=await e,o={...r,send_to:i};n("event",t,o)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function l8(){if(jp())try{await q0()}catch(n){return vr.warn(Pr.create("indexeddb-unavailable",{errorInfo:n==null?void 0:n.toString()}).message),!1}else return vr.warn(Pr.create("indexeddb-unavailable",{errorInfo:"IndexedDB is not available in this environment."}).message),!1;return!0}async function c8(n,e,t,r,s,i,o){const a=r8(n);a.then(m=>{t[m.measurementId]=m.appId,n.options.measurementId&&m.measurementId!==n.options.measurementId&&vr.warn(`The measurement ID in the local Firebase config (${n.options.measurementId}) does not match the measurement ID fetched from the server (${m.measurementId}). To ensure analytics events are always sent to the correct Analytics property, update the measurement ID field in the local config or remove it from the local config.`)}).catch(m=>vr.error(m)),e.push(a);const c=l8().then(m=>{if(m)return r.getId()}),[u,h]=await Promise.all([a,c]);J9(i)||W9(i,u.measurementId),s("js",new Date);const f=(o==null?void 0:o.config)??{};return f[F9]="firebase",f.update=!0,h!=null&&(f[V9]=h),s("config",u.measurementId,f),u.measurementId}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class u8{constructor(e){this.app=e}_delete(){return delete Zu[this.app.options.appId],Promise.resolve()}}let Zu={},VT=[];const FT={};let Yy="dataLayer",d8="gtag",$T,t2,UT=!1;function h8(){const n=[];if(z0()&&n.push("This is a browser extension environment."),AC()||n.push("Cookies are not available."),n.length>0){const e=n.map((r,s)=>`(${s+1}) ${r}`).join(" "),t=Pr.create("invalid-analytics-context",{errorInfo:e});vr.warn(t.message)}}function f8(n,e,t){h8();const r=n.options.appId;if(!r)throw Pr.create("no-app-id");if(!n.options.apiKey)if(n.options.measurementId)vr.warn(`The "apiKey" field is empty in the local Firebase config. This is needed to fetch the latest measurement ID for this Firebase app. Falling back to the measurement ID ${n.options.measurementId} provided in the "measurementId" field in the local Firebase config.`);else throw Pr.create("no-api-key");if(Zu[r]!=null)throw Pr.create("already-exists",{id:r});if(!UT){G9(Yy);const{wrappedGtag:i,gtagCore:o}=Y9(Zu,VT,FT,Yy,d8);t2=i,$T=o,UT=!0}return Zu[r]=c8(n,VT,FT,e,$T,Yy,t),new u8(n)}function m8(n=Zd()){n=le(n);const e=Ws(n,fp);return e.isInitialized()?e.getImmediate():p8(n)}function p8(n,e={}){const t=Ws(n,fp);if(t.isInitialized()){const s=t.getImmediate();if(jr(e,t.getOptions()))return s;throw Pr.create("already-initialized")}return t.initialize({options:e})}async function g8(){if(z0()||!AC()||!jp())return!1;try{return await q0()}catch{return!1}}function y8(n,e,t,r){n=le(n),a8(t2,Zu[n.app.options.appId],e,t,r).catch(s=>vr.error(s))}const BT="@firebase/analytics",zT="0.10.18";function _8(){gs(new wr(fp,(e,{options:t})=>{const r=e.getProvider("app").getImmediate(),s=e.getProvider("installations-internal").getImmediate();return f8(r,s,t)},"PUBLIC")),gs(new wr("analytics-internal",n,"PRIVATE")),_r(BT,zT),_r(BT,zT,"esm2020");function n(e){try{const t=e.getProvider(fp).getImmediate();return{logEvent:(r,s,i)=>y8(t,r,s,i)}}catch(t){throw Pr.create("interop-component-reg-failed",{reason:t})}}}_8();const n2={apiKey:"AIzaSyAdJ3lRxhgZWhnqH8SNQsT1bTFB8E0-cDg",authDomain:"quitarena-a97de.firebaseapp.com",databaseURL:"https://quitarena-a97de-default-rtdb.europe-west1.firebasedatabase.app",projectId:"quitarena-a97de",storageBucket:"quitarena-a97de.firebasestorage.app",messagingSenderId:"693525963288",appId:"1:693525963288:web:a175e9a8bd56fffb35596d",measurementId:"G-H2CCRXYY74"},Nh=NM().length?Zd():DC(n2),H=s3(Nh,n2.databaseURL),Kr=N$(Nh),ii=Jz(Nh);console.log(" Firebase services initialized:",{db:!!H,firestore:!!Kr,auth:!!ii});vP(ii,Yu).then(()=>{console.log("Firebase Auth persistence configured for 30 days")}).catch(n=>{console.error("Error setting auth persistence:",n)});let r2=null;(async()=>{try{await g8()&&(r2=m8(Nh))}catch(n){console.debug("Analytics not initialized:",n==null?void 0:n.message)}})();const sG=Object.freeze(Object.defineProperty({__proto__:null,get analytics(){return r2},app:Nh,auth:ii,db:H,firestore:Kr},Symbol.toStringTag,{value:"Module"}));class Fg{constructor(e,t){this.db=e,this.userUID=t,this.userRef=K(e,`users/${t}`),this.statsRef=K(e,`users/${t}/stats`),this.profileRef=K(e,`users/${t}/profile`),this.behaviorLogRef=K(e,`users/${t}/behaviorLog`)}async updateStat(e,t,r=""){try{console.log(` StatManager: updateStat called - ${e}: ${t>0?"+":""}${t} (${r})`);const s=await ve(this.statsRef);if(!s.exists())return console.error(` StatManager: Stats don't exist for user ${this.userUID}`),!1;const i=s.val(),o=i[e]||0,a=Math.max(0,Math.min(100,o+t));console.log(` StatManager: ${e} change: ${o}  ${a} (${t>0?"+":""}${t})`),console.log(` StatManager: About to write to Firebase - ${e}: ${a}`),console.log(" StatManager: Writing to path:",this.statsRef.toString()),console.log(" StatManager: Full stats object to write:",{...i,[e]:a});try{await Te(this.statsRef,{...i,[e]:a}),console.log(` StatManager: Successfully updated ${e} in Firebase`)}catch(c){throw console.error(` StatManager: Firebase write failed for ${e}:`,c),c}return await this.logBehavior(e,t,r),this.showStatNotification(e,t,r),console.log(`${e}: ${t>0?"+":""}${t} (${r})`),!0}catch(s){return console.error(` StatManager: CRITICAL ERROR updating ${e}:`,s),console.error(" StatManager: Error details:",{message:s.message,code:s.code,stack:s.stack}),!1}}async updateAddictionFromCleanTime(){try{const e=await ve(K(this.db,`users/${this.userUID}/profile/lastRelapseDate`)),t=await ve(this.userRef);if(!t.exists())return;const r=t.val(),s=e.exists()?new Date(e.val()):new Date(r.quitDate||Date.now()),o=Math.floor((new Date-s)/(1e3*60*60*24*7));if(o>=1){const a=o*2;await this.updateStat("addictionLevel",-a,`Clean time: ${o} week(s)`),o>=1&&await this.resetRelapseEscalationLevel()}}catch(e){console.error("Error updating addiction from clean time:",e)}}async handleRelapse(){try{console.log(" StatManager: handleRelapse() called for user:",this.userUID);const e=new Date,t=await ve(K(this.db,`users/${this.userUID}/profile/lastRelapseDate`)),r=await ve(K(this.db,`users/${this.userUID}/profile/relapseEscalationLevel`));let s=1;if(console.log(" StatManager: Last relapse exists:",t.exists()),console.log(" StatManager: Current escalation level exists:",r.exists()),t.exists()){const o=new Date(t.val()),a=Math.floor((e-o)/(1e3*60*60*24)),c=r.exists()?r.val():1;console.log(` StatManager: Current escalation level from Firebase: ${c}`),console.log(` StatManager: Days since last relapse: ${a}`),a>=7?(s=1,console.log(` StatManager: After 7+ days clean  escalation level reset to: ${s}`)):(s=c+1,console.log(` StatManager: Within ${a} days  escalation level: ${c} + 1 = ${s}`))}let i=0;switch(s){case 1:i=4;break;case 2:i=6;break;default:i=8;break}console.log(` StatManager: Escalation level ${s}  addiction increase: +${i}`),console.log(" StatManager: Updating all stats in single write operation...");try{const o=await ve(this.statsRef);if(!o.exists())return console.error(" StatManager: No stats found for user"),!1;const a=o.val();console.log(" StatManager: Current stats before relapse:",a);const c=Math.max(0,Math.min(100,(a.addictionLevel||0)+i)),u=Math.max(0,Math.min(100,(a.mentalStrength||0)-3)),h=Math.max(0,Math.min(100,(a.triggerDefense||0)-3));console.log(` StatManager: addictionLevel change: ${a.addictionLevel}  ${c} (+${i})`),console.log(` StatManager: mentalStrength change: ${a.mentalStrength}  ${u} (-3)`),console.log(` StatManager: triggerDefense change: ${a.triggerDefense}  ${h} (-3)`);const f={...a,addictionLevel:c,mentalStrength:u,triggerDefense:h};console.log(" StatManager: Writing complete updated stats:",f),await Te(this.statsRef,f),console.log(" StatManager: Successfully updated ALL stats in single write"),await Promise.all([this.logBehavior("addictionLevel",i,`Relapse escalation level ${s}`),this.logBehavior("mentalStrength",-3,"Relapse setback"),this.logBehavior("triggerDefense",-3,"Relapse to known trigger")]),this.showStatNotification("addictionLevel",i,`Relapse escalation level ${s}`),this.showStatNotification("mentalStrength",-3,"Relapse setback"),this.showStatNotification("triggerDefense",-3,"Relapse to known trigger")}catch(o){throw console.error(" StatManager: CRITICAL ERROR updating relapse stats:",o),o}return await Promise.all([Te(K(this.db,`users/${this.userUID}/profile/lastRelapseDate`),e.toISOString()),Te(K(this.db,`users/${this.userUID}/profile/relapseDate`),e.toISOString()),Te(K(this.db,`users/${this.userUID}/profile/relapseEscalationLevel`),s)]),await this.logBehavior("relapse",s,`Escalation level ${s} - ${i} addiction, -3 mental, -3 trigger defense`),!0}catch(e){return console.error("Error handling relapse:",e),!1}}async resetRelapseEscalationLevel(){try{await Te(K(this.db,`users/${this.userUID}/profile/relapseEscalationLevel`),1),console.log("Relapse escalation level reset")}catch(e){console.error("Error resetting relapse escalation level:",e)}}async getAddictionStatus(){try{const e=await ve(K(this.db,`users/${this.userUID}/profile/lastRelapseDate`)),t=await ve(K(this.db,`users/${this.userUID}/profile/relapseEscalationLevel`)),r=await ve(this.userRef);if(!r.exists())return null;const s=r.val(),i=e.exists()?new Date(e.val()):new Date(s.quitDate||Date.now()),o=t.exists()?t.val():1,a=new Date,c=Math.floor((a-i)/(1e3*60*60*24)),u=Math.floor((a-i)/(1e3*60*60*24*7));return{lastRelapseDate:i,escalationLevel:o,daysSinceLastRelapse:c,cleanWeeks:u,isCleanFor7Days:c>=7}}catch(e){return console.error("Error getting addiction status:",e),null}}async getCurrentEscalationLevel(){try{const e=await ve(K(this.db,`users/${this.userUID}/profile/relapseEscalationLevel`));return e.exists()?e.val():1}catch(e){return console.error("Error getting current escalation level:",e),1}}async handleCravingResistance(){try{const e=new Date().toDateString(),t=await this.checkDailyCravingResistanceLimits(e);if(!t.canAwardMentalStrength&&!t.canAwardTriggerDefense)return console.log("Daily craving resistance limits reached for both stats"),await this.trackAppUsageDuringCravings(),!0;const r=[];return t.canAwardMentalStrength?r.push(this.updateStat("mentalStrength",1,"Successful craving resistance")):console.log("Daily mental strength limit reached for craving resistance"),t.canAwardTriggerDefense?r.push(this.updateStat("triggerDefense",3,"Surviving trigger situation")):console.log("Daily trigger defense limit reached for craving resistance"),r.length>0&&await Promise.all(r),await this.trackAppUsageDuringCravings(),await this.logDailyCravingResistance(e,t),!0}catch(e){return console.error("Error handling craving resistance:",e),!1}}async handleCravingLogged(){try{const e=new Date().toDateString(),t=await this.checkDailyCravingLoggingLimits(e);if(!t.canAwardMotivation&&!t.canAwardTriggerDefense)return console.log("Daily craving logging limits reached for both stats"),!0;const r=[];return t.canAwardMotivation?r.push(this.updateStat("motivation",.25,"Craving awareness and tracking")):console.log("Daily motivation limit reached for craving logging"),t.canAwardTriggerDefense?r.push(this.updateStat("triggerDefense",.25,"Craving awareness and tracking")):console.log("Daily trigger defense limit reached for craving logging"),r.length>0&&await Promise.all(r),await this.logDailyCravingLogging(e,t),!0}catch(e){return console.error("Error handling craving logged:",e),!1}}async handleBreathingExercise(){try{const e=new Date().toDateString();return await Te(K(this.db,`users/${this.userUID}/profile/daily/${e}/breathing`),!0),await this.checkBreathingStreak()>=3&&await this.updateStat("mentalStrength",1,"3-day breathing exercise streak"),!0}catch(e){return console.error("Error handling breathing exercise:",e),!1}}async handleHydrationUpdate(e){try{const t=new Date().toDateString();return await Te(K(this.db,`users/${this.userUID}/profile/daily/${t}/water`),e),await this.checkHydrationStreak()>=3&&await this.updateStat("mentalStrength",1,"3-day hydration streak"),!0}catch(t){return console.error("Error handling hydration update:",t),!1}}async checkMilestoneBonuses(){try{const e=await ve(K(this.db,`users/${this.userUID}/profile/relapseDate`)),t=await ve(this.userRef);if(!t.exists())return;const r=t.val(),s=e.exists()?new Date(e.val()):new Date(r.quitDate||Date.now()),o=Math.floor((new Date-s)/(1e3*60*60*24)),a=[{days:7,bonus:5,name:"First week"},{days:30,bonus:10,name:"First month"},{days:90,bonus:15,name:"Three months"}];for(const c of a)if(o>=c.days){const u=`milestone_${c.days}`;(await ve(K(this.db,`users/${this.userUID}/profile/${u}`))).exists()||await Promise.all([this.updateStat("mentalStrength",c.bonus,`${c.name} milestone bonus`),Te(K(this.db,`users/${this.userUID}/profile/${u}`),!0)])}}catch(e){console.error("Error checking milestone bonuses:",e)}}async trackLoggingActivity(){try{const e=new Date().toDateString(),t=new Date;return await Te(K(this.db,`users/${this.userUID}/profile/daily/${e}/logged`),!0),await Te(K(this.db,`users/${this.userUID}/profile/lastActivity`),t.toISOString()),await this.checkWeeklyLoggingFrequency()>=3&&await this.updateStat("motivation",2,"Regular logging (3+ days this week)"),!0}catch(e){return console.error("Error tracking logging activity:",e),!1}}async handleAchievementShare(){try{return await this.updateStat("motivation",3,"Sharing achievement"),!0}catch(e){return console.error("Error handling achievement share:",e),!1}}async handleTriggerPlanning(){try{return await this.updateStat("triggerDefense",1,"Pre-planning for known triggers"),!0}catch(e){return console.error("Error handling trigger planning:",e),!1}}async handleTriggerListUpdate(){try{return await this.updateStat("triggerDefense",1,"Updating trigger list"),!0}catch(e){return console.error("Error handling trigger list update:",e),!1}}async handleUnpreparedTrigger(){try{return await this.updateStat("triggerDefense",-1,"Entering trigger situation unprepared"),!0}catch(e){return console.error("Error handling unprepared trigger:",e),!1}}async checkBreathingStreak(){try{let e=0;for(let t=0;t<7;t++){const r=new Date;r.setDate(r.getDate()-t);const s=r.toDateString(),i=await ve(K(this.db,`users/${this.userUID}/profile/daily/${s}/breathing`));if(i.exists()&&i.val())e++;else break}return e}catch(e){return console.error("Error checking breathing streak:",e),0}}async checkHydrationStreak(){try{let e=0;for(let t=0;t<7;t++){const r=new Date;r.setDate(r.getDate()-t);const s=r.toDateString(),i=await ve(K(this.db,`users/${this.userUID}/profile/daily/${s}/water`));if(i.exists()&&i.val()>0)e++;else break}return e}catch(e){return console.error("Error checking hydration streak:",e),0}}async checkWeeklyLoggingFrequency(){try{let e=0;for(let t=0;t<7;t++){const r=new Date;r.setDate(r.getDate()-t);const s=r.toDateString(),i=await ve(K(this.db,`users/${this.userUID}/profile/daily/${s}/logged`));i.exists()&&i.val()&&e++}return e}catch(e){return console.error("Error checking weekly logging frequency:",e),0}}async checkInactivityPenalty(){try{const e=new Date().toDateString(),t=`lastInactivityCheck_${this.userUID}_${e}`;if(localStorage.getItem(t)){console.log(`Inactivity penalty already checked today for user ${this.userUID}, skipping...`);return}console.log(` Checking inactivity penalty for user ${this.userUID}...`);const s=await ve(this.userRef);if(!s.exists())return;const i=s.val(),o=new Date,a=i.createdAt?new Date(i.createdAt):i.quitStartDate?new Date(i.quitStartDate):o,c=Math.floor((o-a)/(1e3*60*60*24));if(c<1)return;const u=await ve(K(this.db,`users/${this.userUID}/profile/lastActivity`));if(u.exists()){const m=new Date(u.val()),y=Math.floor((o-m)/(1e3*60*60*24)),w=Math.floor((o-m)/(1e3*60*60));if(console.log(` User has lastActivity timestamp: ${m.toISOString()}, days since: ${y}, hours since: ${w}, days since registration: ${c}`),w<24){console.log(` User logged in today (${w} hours ago) - no inactivity penalty needed`),localStorage.setItem(t,"checked");return}if(w<2){console.log(` User logged in very recently (${w} hours ago) - no inactivity penalty needed`),localStorage.setItem(t,"checked");return}if(w<24){console.log(` User logged in today (${w} hours ago) - no inactivity penalty needed`),localStorage.setItem(t,"checked");return}if(y<7){console.log(` User logged in within last 7 days (${y} days ago) - no inactivity penalty needed`),localStorage.setItem(t,"checked");return}if(y>=7&&c>=7){await this.updateStat("motivation",-3,"Long period inactive (7+ days)"),console.log(`Inactivity penalty applied: ${y} days since last activity`),localStorage.setItem(t,"checked");return}else{console.log(`No inactivity penalty needed: last activity was ${y} days ago`),localStorage.setItem(t,"checked");return}}console.log(" No lastActivity timestamp found, checking daily activity records...");let h=!1,f=null;console.log(" Checking daily activity records for the last 10 days...");for(let m=0;m<10;m++){const y=new Date;y.setDate(y.getDate()-m);const w=y.toDateString(),S=await ve(K(this.db,`users/${this.userUID}/profile/daily/${w}/logged`));if(console.log(` Checking ${w}: ${S.exists()?"Activity found":"No activity"}`),S.exists()&&S.val()){h=!0,f=y,console.log(` Found activity on ${w}`);break}}if(!h)console.log(" No activity found in the last 10 days"),c>=7?(await this.updateStat("motivation",-3,"Long period inactive (7+ days)"),console.log(`Inactivity penalty applied: ${c} days since registration with no activity`)):console.log(`No penalty applied: user registered only ${c} days ago`);else if(f){const m=Math.floor((o-f)/864e5);console.log(` Activity found on ${f.toDateString()}, days since: ${m}, days since registration: ${c}`),m>=7&&c>=7?(await this.updateStat("motivation",-3,"Long period inactive (7+ days)"),console.log(`Inactivity penalty applied: ${m} days since last activity`)):console.log(`No inactivity penalty needed: last activity was ${m} days ago`)}localStorage.setItem(t,"checked")}catch(e){console.error("Error checking inactivity penalty:",e)}}async trackAppUsageDuringCravings(){try{const t=`appUsage_${new Date().toDateString()}`,r=await ve(K(this.db,`users/${this.userUID}/profile/daily/${t}`));let s=r.exists()?r.val():0;s++,await Te(K(this.db,`users/${this.userUID}/profile/daily/${t}`),s),s===3&&await this.updateStat("mentalStrength",1,"Using app during cravings (3 times, no relapse)")}catch(e){console.error("Error tracking app usage during cravings:",e)}}async logBehavior(e,t,r){try{const s={timestamp:Date.now(),statName:e,change:t,reason:r,date:new Date().toISOString()};await Kk(K(this.db,`users/${this.userUID}/behaviorLog`),s)}catch(s){console.error("Error logging behavior:",s)}}showStatNotification(e,t,r){const s=document.createElement("div");s.className=`fixed top-20 right-4 z-50 p-4 rounded-lg shadow-lg transition-all duration-500 transform translate-x-full ${t>0?"bg-green-500 text-white":"bg-red-500 text-white"}`,s.innerHTML=`
      <div class="flex items-center gap-2">
        <span class="text-lg">${t>0?"":""}</span>
        <span class="font-bold">${e}</span>
        <span class="text-xl">${t>0?"+":""}${t}</span>
      </div>
      <div class="text-sm opacity-90">${r}</div>
    `,document.body.appendChild(s),setTimeout(()=>{s.classList.remove("translate-x-full")},100),setTimeout(()=>{s.classList.add("translate-x-full"),setTimeout(()=>{s.parentNode&&s.parentNode.removeChild(s)},500)},3e3)}async runDailyUpdates(){try{const e=await ve(K(this.db,`users/${this.userUID}`));if(!e.exists())return;const t=e.val(),r=new Date,s=t.createdAt?new Date(t.createdAt):t.quitStartDate?new Date(t.quitStartDate):r;if(Math.floor((r-s)/(1e3*60*60*24))<1)return;await Promise.all([this.updateAddictionFromCleanTime(),this.checkMilestoneBonuses(),this.checkInactivityPenalty()])}catch(e){console.error("Error running daily updates:",e)}}async initialize(){try{await this.ensureActivityTrackingInitialized(),setInterval(()=>{this.runDailyUpdates()},24*60*60*1e3),await this.runDailyUpdates()}catch(e){console.error("Error initializing StatManager:",e)}}async ensureActivityTrackingInitialized(){try{const e=await ve(K(this.db,`users/${this.userUID}/profile/lastActivity`)),t=await ve(K(this.db,`users/${this.userUID}/createdAt`));if(!e.exists()){const i=new Date;await Te(K(this.db,`users/${this.userUID}/profile/lastActivity`),i.toISOString()),console.log("Initialized lastActivity timestamp for new user")}if(!t.exists()){const i=new Date;await Te(K(this.db,`users/${this.userUID}/createdAt`),i.toISOString()),console.log("Initialized createdAt timestamp for new user");return}const r=new Date().toDateString();(await ve(K(this.db,`users/${this.userUID}/profile/daily/${r}/logged`))).exists()||(await Te(K(this.db,`users/${this.userUID}/profile/daily/${r}/logged`),!0),console.log("Initialized today's activity tracking for new user"))}catch(e){console.error("Error ensuring activity tracking initialization:",e)}}async checkDailyCravingResistanceLimits(e){try{const t=await ve(K(this.db,`users/${this.userUID}/profile/daily/${e}/cravingResistanceStats`));if(!t.exists())return await Te(K(this.db,`users/${this.userUID}/profile/daily/${e}/cravingResistanceStats`),{mentalStrength:0,triggerDefense:0}),{canAwardMentalStrength:!0,canAwardTriggerDefense:!0};const r=t.val(),s=r.mentalStrength||0,i=r.triggerDefense||0;return{canAwardMentalStrength:s<3,canAwardTriggerDefense:i<5}}catch(t){return console.error("Error checking daily craving resistance limits:",t),{canAwardMentalStrength:!0,canAwardTriggerDefense:!0}}}async logDailyCravingResistance(e,t){try{const r=await ve(K(this.db,`users/${this.userUID}/profile/daily/${e}/cravingResistanceStats`));r.exists()||await Te(K(this.db,`users/${this.userUID}/profile/daily/${e}/cravingResistanceStats`),{mentalStrength:0,triggerDefense:0});const s=r.val(),i=s.mentalStrength||0,o=s.triggerDefense||0,a=t.canAwardMentalStrength?1:0,c=t.canAwardTriggerDefense?3:0;await Te(K(this.db,`users/${this.userUID}/profile/daily/${e}/cravingResistanceStats`),{mentalStrength:Math.min(3,i+a),triggerDefense:Math.min(5,o+c)})}catch(r){console.error("Error logging daily craving resistance:",r)}}async getDailyCravingResistanceStats(e=null){try{const t=e||new Date().toDateString(),r=await ve(K(this.db,`users/${this.userUID}/profile/daily/${t}/cravingResistanceStats`));if(!r.exists())return{mentalStrength:0,triggerDefense:0,mentalStrengthLimit:3,triggerDefenseLimit:5,mentalStrengthRemaining:3,triggerDefenseRemaining:5};const s=r.val(),i=s.mentalStrength||0,o=s.triggerDefense||0;return{mentalStrength:i,triggerDefense:o,mentalStrengthLimit:3,triggerDefenseLimit:5,mentalStrengthRemaining:Math.max(0,3-i),triggerDefenseRemaining:Math.max(0,5-o)}}catch(t){return console.error("Error getting daily craving resistance stats:",t),{mentalStrength:0,triggerDefense:0,mentalStrengthLimit:3,triggerDefenseLimit:5,mentalStrengthRemaining:3,triggerDefenseRemaining:5}}}async checkDailyCravingLoggingLimits(e){try{const t=await ve(K(this.db,`users/${this.userUID}/profile/daily/${e}/cravingLoggingStats`));if(!t.exists())return await Te(K(this.db,`users/${this.userUID}/profile/daily/${e}/cravingLoggingStats`),{motivation:0,triggerDefense:0}),{canAwardMotivation:!0,canAwardTriggerDefense:!0};const r=t.val(),s=r.motivation||0,i=r.triggerDefense||0;return{canAwardMotivation:s<.5,canAwardTriggerDefense:i<.5}}catch(t){return console.error("Error checking daily craving logging limits:",t),{canAwardMotivation:!0,canAwardTriggerDefense:!0}}}async logDailyCravingLogging(e,t){try{const r=await ve(K(this.db,`users/${this.userUID}/profile/daily/${e}/cravingLoggingStats`));r.exists()||await Te(K(this.db,`users/${this.userUID}/profile/daily/${e}/cravingLoggingStats`),{motivation:0,triggerDefense:0});const s=r.val(),i=s.motivation||0,o=s.triggerDefense||0,a=t.canAwardMotivation?.25:0,c=t.canAwardTriggerDefense?.25:0;await Te(K(this.db,`users/${this.userUID}/profile/daily/${e}/cravingLoggingStats`),{motivation:Math.min(.5,i+a),triggerDefense:Math.min(.5,o+c)})}catch(r){console.error("Error logging daily craving logging:",r)}}async getDailyCravingLoggingStats(e=null){try{const t=e||new Date().toDateString(),r=await ve(K(this.db,`users/${this.userUID}/profile/daily/${t}/cravingLoggingStats`));if(!r.exists())return{motivation:0,triggerDefense:0,motivationLimit:.5,triggerDefenseLimit:.5,motivationRemaining:.5,triggerDefenseRemaining:.5};const s=r.val(),i=s.motivation||0,o=s.triggerDefense||0;return{motivation:i,triggerDefense:o,motivationLimit:.5,triggerDefenseLimit:.5,motivationRemaining:Math.max(0,.5-i),triggerDefenseRemaining:Math.max(0,.5-o)}}catch(t){return console.error("Error getting daily craving logging stats:",t),{motivation:0,triggerDefense:0,motivationLimit:.5,triggerDefenseLimit:.5,motivationRemaining:.5,triggerDefenseRemaining:.5}}}}const v8=Object.freeze(Object.defineProperty({__proto__:null,default:Fg},Symbol.toStringTag,{value:"Module"}));class s2{constructor(e){this.firestore=e,this.collections={cravings:"behavioral_cravings",relapses:"behavioral_relapses",hydration:"behavioral_hydration",breathing:"behavioral_breathing",meditation:"behavioral_meditation",physicalActivity:"behavioral_physical_activity",moodTracking:"behavioral_mood",stressLevels:"behavioral_stress",sleepTracking:"behavioral_sleep",socialTriggers:"behavioral_social_triggers",environmentalFactors:"behavioral_environmental"},console.log(" FirestoreBehavioralService initialized for predictive analytics")}async logCraving(e,t){try{const r={userId:e,timestamp:Fe.now(),date:new Date().toISOString().split("T")[0],outcome:t.outcome,strength:t.strength||0,duration:t.duration||null,context:t.context||"unknown",triggers:t.triggers||[],location:t.location||null,mood:t.mood||null,stressLevel:t.stressLevel||null,copingStrategiesUsed:t.copingStrategiesUsed||[],helpfulStrategies:t.helpfulStrategies||[],socialSituation:t.socialSituation||null,timeOfDay:new Date().getHours(),dayOfWeek:new Date().getDay(),appVersion:"1.0.0",deviceType:navigator.userAgent.includes("Mobile")?"mobile":"desktop"},s=await Ur(Cn(this.firestore,this.collections.cravings),r);return console.log(" Craving logged to Firestore for analytics:",s.id),s.id}catch(r){throw console.error(" Error logging craving to Firestore:",r),r}}async logRelapse(e,t){try{const r={userId:e,timestamp:Fe.now(),date:new Date().toISOString().split("T")[0],escalationLevel:t.escalationLevel||1,daysSinceLastRelapse:t.daysSinceLastRelapse||0,triggers:t.triggers||[],mood:t.mood||null,stressLevel:t.stressLevel||null,location:t.location||null,socialSituation:t.socialSituation||null,timeToRelapse:t.timeToRelapse||null,copingAttempts:t.copingAttempts||[],addictionIncrease:t.addictionIncrease||0,mentalStrengthDecrease:t.mentalStrengthDecrease||0,triggerDefenseDecrease:t.triggerDefenseDecrease||0,timeOfDay:new Date().getHours(),dayOfWeek:new Date().getDay()},s=await Ur(Cn(this.firestore,this.collections.relapses),r);return console.log(" Relapse logged to Firestore for analytics:",s.id),s.id}catch(r){throw console.error(" Error logging relapse to Firestore:",r),r}}async logHydration(e,t){try{const r={userId:e,timestamp:Fe.now(),date:new Date().toISOString().split("T")[0],glassesConsumed:t.glassesConsumed||0,targetGlasses:t.targetGlasses||6,achievedTarget:(t.glassesConsumed||0)>=(t.targetGlasses||6),timeOfDay:new Date().getHours(),loggedAt:new Date().toISOString(),currentStreak:t.currentStreak||0,mood:t.mood||null,energyLevel:t.energyLevel||null},s=await Ur(Cn(this.firestore,this.collections.hydration),r);return console.log(" Hydration logged to Firestore for analytics:",s.id),s.id}catch(r){throw console.error(" Error logging hydration to Firestore:",r),r}}async logBreathingExercise(e,t){try{const r={userId:e,timestamp:Fe.now(),date:new Date().toISOString().split("T")[0],duration:t.duration||0,breathingRate:t.breathingRate||null,completed:t.completed||!0,triggerContext:t.triggerContext||null,moodBefore:t.moodBefore||null,moodAfter:t.moodAfter||null,stressLevelBefore:t.stressLevelBefore||null,stressLevelAfter:t.stressLevelAfter||null,helpfulness:t.helpfulness||null,timeOfDay:new Date().getHours(),currentStreak:t.currentStreak||0},s=await Ur(Cn(this.firestore,this.collections.breathing),r);return console.log(" Breathing exercise logged to Firestore for analytics:",s.id),s.id}catch(r){throw console.error(" Error logging breathing exercise to Firestore:",r),r}}async logMeditation(e,t){try{const r={userId:e,timestamp:Fe.now(),date:new Date().toISOString().split("T")[0],duration:t.duration||0,type:t.type||"mindfulness",completed:t.completed||!0,triggerContext:t.triggerContext||null,moodBefore:t.moodBefore||null,moodAfter:t.moodAfter||null,stressLevelBefore:t.stressLevelBefore||null,stressLevelAfter:t.stressLevelAfter||null,helpfulness:t.helpfulness||null,timeOfDay:new Date().getHours()},s=await Ur(Cn(this.firestore,this.collections.meditation),r);return console.log(" Meditation logged to Firestore for analytics:",s.id),s.id}catch(r){throw console.error(" Error logging meditation to Firestore:",r),r}}async logPhysicalActivity(e,t){try{const r={userId:e,timestamp:Fe.now(),date:new Date().toISOString().split("T")[0],type:t.type||"walk",duration:t.duration||0,intensity:t.intensity||"moderate",completed:t.completed||!0,triggerContext:t.triggerContext||null,moodBefore:t.moodBefore||null,moodAfter:t.moodAfter||null,energyBefore:t.energyBefore||null,energyAfter:t.energyAfter||null,helpfulness:t.helpfulness||null,cravingReduction:t.cravingReduction||null,timeOfDay:new Date().getHours(),location:t.location||null},s=await Ur(Cn(this.firestore,this.collections.physicalActivity),r);return console.log(" Physical activity logged to Firestore for analytics:",s.id),s.id}catch(r){throw console.error(" Error logging physical activity to Firestore:",r),r}}async logMood(e,t){try{const r={userId:e,timestamp:Fe.now(),date:new Date().toISOString().split("T")[0],mood:t.mood,intensity:t.intensity||5,triggers:t.triggers||[],activities:t.activities||[],socialContext:t.socialContext||null,timeOfDay:new Date().getHours(),copingStrategiesUsed:t.copingStrategiesUsed||[]},s=await Ur(Cn(this.firestore,this.collections.moodTracking),r);return console.log(" Mood logged to Firestore for analytics:",s.id),s.id}catch(r){throw console.error(" Error logging mood to Firestore:",r),r}}async getUserBehavioralData(e,t,r=null,s=null){try{if(!this.collections[t])throw new Error(`Unknown data type: ${t}`);let i=Ki(Cn(this.firestore,this.collections[t]),ni("userId","==",e),op("timestamp","desc"));r&&(i=Ki(i,ni("timestamp",">=",Fe.fromDate(new Date(r))))),s&&(i=Ki(i,ni("timestamp","<=",Fe.fromDate(new Date(s)))));const o=await wc(i),a=[];return o.forEach(c=>{var u;a.push({id:c.id,...c.data(),timestamp:((u=c.data().timestamp)==null?void 0:u.toDate())||new Date})}),console.log(` Retrieved ${a.length} ${t} records for analytics`),a}catch(i){throw console.error(` Error retrieving ${t} data:`,i),i}}async getUserAnalytics(e,t=30){try{const r=new Date,s=new Date;s.setDate(s.getDate()-t),console.log(` Generating behavioral analytics for user ${e} (last ${t} days)`);const[i,o,a,c,u,h,f]=await Promise.all([this.getUserBehavioralData(e,"cravings",s,r).catch(y=>(console.warn(" Cravings data not available yet (indexes building):",y.message),[])),this.getUserBehavioralData(e,"relapses",s,r).catch(y=>(console.warn(" Relapses data not available yet (indexes building):",y.message),[])),this.getUserBehavioralData(e,"hydration",s,r).catch(y=>(console.warn(" Hydration data not available yet (indexes building):",y.message),[])),this.getUserBehavioralData(e,"breathing",s,r).catch(y=>(console.warn(" Breathing data not available yet (indexes building):",y.message),[])),this.getUserBehavioralData(e,"meditation",s,r).catch(y=>(console.warn(" Meditation data not available yet (indexes building):",y.message),[])),this.getUserBehavioralData(e,"physicalActivity",s,r).catch(y=>(console.warn(" Physical activity data not available yet (indexes building):",y.message),[])),this.getUserBehavioralData(e,"moodTracking",s,r).catch(y=>(console.warn(" Mood data not available yet (indexes building):",y.message),[]))]),m={userId:e,period:{startDate:s,endDate:r,days:t},cravingStats:{total:i.length,resisted:i.filter(y=>y.outcome==="resisted").length,relapsed:i.filter(y=>y.outcome==="relapsed").length,averageStrength:i.length>0?i.reduce((y,w)=>y+(w.strength||0),0)/i.length:0,commonTriggers:this.getCommonTriggers(i),timePatterns:this.getTimePatterns(i)},relapseStats:{total:o.length,averageEscalationLevel:o.length>0?o.reduce((y,w)=>y+(w.escalationLevel||1),0)/o.length:0,commonTriggers:this.getCommonTriggers(o),recoveryTimes:o.map(y=>y.daysSinceLastRelapse||0)},wellnessStats:{hydrationDays:a.filter(y=>y.achievedTarget).length,breathingExercises:c.length,meditationSessions:u.length,physicalActivities:h.length,totalWellnessActivities:c.length+u.length+h.length},moodStats:{entries:f.length,averageMood:f.length>0?f.reduce((y,w)=>y+(w.intensity||5),0)/f.length:5,moodTrends:this.getMoodTrends(f)},insights:this.generateInsights(i,o,a,c,u,h,f),generatedAt:new Date};return console.log(" Behavioral analytics generated:",m),m}catch(r){throw console.error(" Error generating user analytics:",r),r}}getCommonTriggers(e){const t={};return e.forEach(r=>{r.triggers&&Array.isArray(r.triggers)&&r.triggers.forEach(s=>{t[s]=(t[s]||0)+1})}),Object.entries(t).sort(([,r],[,s])=>s-r).slice(0,5).map(([r,s])=>({trigger:r,count:s}))}getTimePatterns(e){const t={};return e.forEach(r=>{const s=r.timeOfDay||new Date(r.timestamp).getHours();t[s]=(t[s]||0)+1}),Object.entries(t).sort(([,r],[,s])=>s-r).slice(0,3).map(([r,s])=>({hour:parseInt(r),count:s}))}getMoodTrends(e){if(e.length<2)return[];const t=e.sort((s,i)=>new Date(s.timestamp)-new Date(i.timestamp)),r=[];for(let s=1;s<t.length;s++){const i=t[s],o=t[s-1],a=(i.intensity||5)-(o.intensity||5);Math.abs(a)>=2&&r.push({date:i.date,change:a,direction:a>0?"improved":"declined",from:o.mood,to:i.mood})}return r.slice(-5)}generateInsights(e,t,r,s,i,o,a){const c=[],u=e.filter(y=>y.outcome==="resisted").length,h=e.length;if(h>0){const y=u/h*100;c.push(`Craving resistance rate: ${y.toFixed(1)}%`)}const f=s.length+i.length+o.length;f>0&&t.length>0&&c.push(`${f} wellness activities vs ${t.length} relapses - wellness correlation analysis available`);const m=r.filter(y=>y.achievedTarget).length;return m>0&&c.push(`Achieved hydration target on ${m} days`),c}async migrateUserData(e,t){try{console.log(` Starting data migration for user ${e} from Realtime DB to Firestore...`);const{ref:r,get:s}=await Ve(()=>import("./index.esm-ebdb357d.js"),[]),i=r(t,`users/${e}/cravings`),o=await s(i);if(o.exists()){const a=o.val();let c=0;for(const[u,h]of Object.entries(a))try{const f={userId:e,timestamp:h.timestamp?Fe.fromDate(new Date(h.timestamp)):Z$(),date:h.date||new Date().toISOString().split("T")[0],outcome:h.outcome||"unknown",strength:h.strength||0,context:h.context||"migrated",mood:h.mood||null,triggers:[],timeOfDay:h.timestamp?new Date(h.timestamp).getHours():12,dayOfWeek:h.timestamp?new Date(h.timestamp).getDay():0,migrated:!0,originalId:u};await Ur(Cn(this.firestore,this.collections.cravings),f),c++}catch(f){console.error(` Error migrating craving ${u}:`,f)}console.log(` Migrated ${c} cravings to Firestore`)}return console.log(` Data migration completed for user ${e}`),!0}catch(r){throw console.error(" Error during data migration:",r),r}}async testConnectivity(){try{return console.log(" FirestoreBehavioralService: Testing connectivity..."),this.firestore&&typeof this.firestore.app<"u"?(console.log(" FirestoreBehavioralService: Ready for behavioral data logging"),!0):(console.warn(" FirestoreBehavioralService: Not properly initialized"),!1)}catch(e){return console.warn(" FirestoreBehavioralService: Connectivity test failed:",(e==null?void 0:e.message)||e),!1}}async getBasicAnalytics(e){try{console.log(` Getting basic analytics for user ${e} (no indexes required)`);const t=["behavioral_cravings","behavioral_relapses","behavioral_hydration","behavioral_breathing","behavioral_meditation","behavioral_physical_activity"],r={};for(const s of t)try{const i=Ki(Cn(this.db,s),ni("userId","==",e)),o=await wc(i);r[s]=o.size}catch(i){console.warn(` Could not get count for ${s}:`,i.message),r[s]=0}return{userId:e,cravingStats:{total:r.behavioral_cravings||0,resisted:Math.max(0,r.behavioral_cravings-r.behavioral_relapses),averageStrength:5,commonTriggers:[],timePatterns:[]},relapseStats:{total:r.behavioral_relapses||0},wellnessStats:{breathingExercises:r.behavioral_breathing||0,meditationSessions:r.behavioral_meditation||0,physicalActivities:r.behavioral_physical_activity||0,hydrationDays:r.behavioral_hydration||0,totalWellnessActivities:(r.behavioral_breathing||0)+(r.behavioral_meditation||0)+(r.behavioral_physical_activity||0)},insights:["Analytics dashboard is ready for behavioral tracking!","Indexes are being built for advanced analytics.","Start logging activities to see detailed insights."]}}catch(t){throw console.error(" Error generating basic analytics:",t),t}}}const iG=Object.freeze(Object.defineProperty({__proto__:null,default:s2},Symbol.toStringTag,{value:"Module"}));class qT{constructor(e,t,r=null){this.db=e,this.userId=t,this.authGuard=r,this.statsRef=K(e,`users/${t}/stats`),this.profileRef=K(e,`users/${t}/profile`),this.listeners=[]}async refreshAllStats(){try{let e,t,r;if(this.authGuard)[e,t,r]=await Promise.all([this.authGuard.databaseGet(`users/${this.userId}/profile`),this.authGuard.databaseGet(`users/${this.userId}/stats`),this.authGuard.databaseGet(`users/${this.userId}`)]);else{const[R,T,I]=await Promise.all([ve(this.profileRef),ve(this.statsRef),ve(K(this.db,`users/${this.userId}`))]);e=R.exists()?R.val():{},t=T.exists()?T.val():{},r=I.exists()?I.val():{}}const s={...e,createdAt:e.createdAt||r.createdAt||null,quitDate:e.quitDate||r.quitDate||r.quitStartDate||null,lastQuitDate:e.lastQuitDate||r.lastQuitDate||null};if(!s.lastRelapseDate&&!s.quitDate&&s.createdAt)try{await Te(K(this.db,`users/${this.userId}/profile/quitDate`),s.createdAt),s.quitDate=s.createdAt,console.log(` CentralizedStats: Seeded missing quitDate with createdAt for ${this.userId}: ${s.createdAt}`)}catch(R){console.warn(` CentralizedStats: Could not seed quitDate for ${this.userId}:`,R.message)}const i=t||this.getDefaultStats(),o=this.calculateEffectiveQuitDate(s),a=this.calculateStreakFromRelapse(s),c=await this.calculateCravingsResisted(),u=await this.calculateAddictionLevel(s,o),h=this.calculateMentalStrength(i,c),f=h.strength,m=h.cravingsApplied,y=await this.checkMilestonesFromRelapse(s,i),w=await this.generateSpecialFeatures(s),S={...i,...y,streakDays:a.value,streakUnit:a.unit,streakDisplayText:a.displayText,cravingsResisted:c,addictionLevel:u,mentalStrength:f,mentalStrengthCravingsApplied:m,specialFeatures:w,lastUpdated:new Date().toISOString()};return this.authGuard?await this.authGuard.databaseSet(`users/${this.userId}/stats`,S):await Te(this.statsRef,S),console.log(` CentralizedStats: Stats updated in Firebase for ${this.userId}:`,{streak:a.displayText,cravingsResisted:c,addictionLevel:u,mentalStrength:f,specialFeatures:(w==null?void 0:w.length)||0,effectiveQuitDate:o}),S}catch(e){throw console.error(` CentralizedStats: Error refreshing stats for ${this.userId}:`,e),e}}calculateEffectiveQuitDate(e){const t=e.quitDate||null;if(e.lastRelapseDate){const r=new Date(e.lastRelapseDate),s=new Date(t),i=r>s?e.lastRelapseDate:t;return console.log(` CentralizedStats: Effective quit date for ${this.userId}: ${i} (original: ${t}, lastRelapse: ${e.lastRelapseDate})`),i}return console.log(` CentralizedStats: Using base quit date for ${this.userId}: ${t}`),t}calculateStreak(e){const t=new Date,r=new Date(e),s=t-r,i=Math.floor(s/(1e3*60*60)),o=Math.floor(i/24);return o>=1?{value:o,unit:"days",displayText:`${o} day${o===1?"":"s"}`}:{value:i,unit:"hours",displayText:`${i} hour${i===1?"":"s"}`}}calculateStreakFromRelapse(e){const t=new Date,r=e.lastRelapseDate;if(!r){const c=e.lastQuitDate||e.originalQuitDate||e.quitDate||e.createdAt||null;return console.log(` CentralizedStats: No relapse date found for ${this.userId}, using quit date: ${c}`),c?this.calculateStreak(c):{value:0,unit:"hours",displayText:"0 hours",streakDays:0}}const s=new Date(r),i=t-s,o=Math.floor(i/(1e3*60*60)),a=Math.floor(o/24);return o<24?{value:o,unit:"hours",displayText:`${o} hour${o===1?"":"s"}`,streakDays:0}:{value:a,unit:"days",displayText:`${a} day${a===1?"":"s"}`,streakDays:a}}async calculateCravingsResisted(){try{const[e,t]=await Promise.all([ve(K(this.db,`users/${this.userId}/profile/cravingsResisted`)),ve(K(this.db,`users/${this.userId}/cravings`))]);let r=0;if(e.exists())r=Math.max(0,parseInt(e.val())||0),console.log(` CentralizedStats: Found cravings in profile: ${r}`);else if(t.exists()){const s=t.val();r=Object.values(s).filter(i=>i.outcome==="resisted").length}return r}catch(e){return console.warn(` CentralizedStats: Could not get cravings for ${this.userId}:`,e.message),0}}calculateMentalStrength(e,t){try{const r=e.mentalStrength||50,s=e.mentalStrengthCravingsApplied||0;return{strength:r,cravingsApplied:s}}catch(r){return console.warn(` CentralizedStats: Could not calculate mental strength for ${this.userId}:`,r.message),{strength:e.mentalStrength||50,cravingsApplied:e.mentalStrengthCravingsApplied||0}}}async calculateAddictionLevel(e,t){try{const[r,s,i]=await Promise.all([ve(this.statsRef),ve(K(this.db,`users/${this.userId}/profile/lastRelapseDate`)),ve(K(this.db,`users/${this.userId}/profile/relapseEscalationLevel`))]);let o=50;if(r.exists()&&(o=r.val().addictionLevel||50),!s.exists())return console.log(` CentralizedStats: No relapses found, returning base addiction: ${o}`),o;const a=new Date(s.val()),u=Math.floor((new Date-a)/(1e3*60*60*24)),h=i.exists()?i.val():1;console.log(` CentralizedStats: Last relapse: ${a.toISOString()}`),console.log(` CentralizedStats: Days since last relapse: ${u}`),console.log(` CentralizedStats: Current escalation level: ${h}`);let f=1;u>=7?(f=1,await Te(K(this.db,`users/${this.userId}/profile/relapseEscalationLevel`),1)):f=h;const m=Math.floor(u/7),y=m*2;let w=Math.max(30,o-y);return console.log(` CentralizedStats: Base addiction: ${o}, Weeks clean: ${m}, Decay: -${y}, Final: ${w}`),w}catch(r){return console.error(" CentralizedStats: Error calculating addiction level:",r),50}}async checkMilestones(e,t){try{const r=new Date,s=new Date(e),i=Math.floor((r-s)/(1e3*60*60*24));console.log(` CentralizedStats: Checking milestones for ${this.userId}, clean days: ${i}`);const o=[{days:7,bonus:5,name:"First week",key:"milestone_7"},{days:30,bonus:10,name:"First month",key:"milestone_30"},{days:90,bonus:15,name:"Three months",key:"milestone_90"}];let a={},c=!1;for(const u of o)if(i>=u.days){const h=K(this.db,`users/${this.userId}/profile/milestones/${u.key}`);if(!(await ve(h)).exists()){const m=Math.min(100,(t.mentalStrength||50)+u.bonus);a.mentalStrength=m,c=!0,await Te(h,{achieved:!0,achievedDate:new Date().toISOString(),bonus:u.bonus,cleanDaysAtAchievement:i}),console.log(` CentralizedStats: Milestone achieved for ${this.userId}! ${u.name} (+${u.bonus} Mental Strength)`),this.showMilestoneNotification(u,i);break}}return a}catch(r){return console.error(` CentralizedStats: Error checking milestones for ${this.userId}:`,r),{}}}async checkMilestonesFromRelapse(e,t){try{const r=new Date,s=e.lastRelapseDate;if(!s)return console.log(` CentralizedStats: No relapse date found for ${this.userId}, skipping milestones`),{};const i=new Date(s),o=Math.floor((r-i)/(1e3*60*60*24));console.log(` CentralizedStats: Checking milestones for ${this.userId}, clean days since relapse: ${o}`);const a=[{days:7,bonus:5,name:"First week",key:"milestone_7"},{days:30,bonus:10,name:"First month",key:"milestone_30"},{days:90,bonus:15,name:"Three months",key:"milestone_90"}];let c={},u=!1;for(const h of a)if(o>=h.days){const f=K(this.db,`users/${this.userId}/profile/milestones/${h.key}`);if(!(await ve(f)).exists()){const y=Math.min(100,(t.mentalStrength||50)+h.bonus);c.mentalStrength=y,u=!0,await Te(f,{achieved:!0,achievedDate:new Date().toISOString(),bonus:h.bonus,cleanDaysAtAchievement:o}),console.log(` CentralizedStats: Milestone achieved for ${this.userId}! ${h.name} (+${h.bonus} Mental Strength)`),this.showMilestoneNotification(h,o);break}}return c}catch(r){return console.error(` CentralizedStats: Error checking milestones from relapse for ${this.userId}:`,r),{}}}async generateSpecialFeatures(e){try{const t=await ve(K(this.db,`users/${this.userId}/specialFeatures`));if(t.exists()){const h=t.val();if(Array.isArray(h)&&h.length>0)return console.log(` CentralizedStats: Using existing Special Features for ${this.userId}:`,h),h}let r=e.triggers||[],s=e.dailyPatterns||[],i=e.copingStrategies||[];if(r.length===0||s.length===0||i.length===0)try{const h=await ve(K(this.db,`users/${this.userId}`));if(h.exists()){const f=h.val();r=r.length>0?r:f.triggers||[],s=s.length>0?s:f.dailyPatterns||[],i=i.length>0?i:f.copingStrategies||[],console.log(` CentralizedStats: Found onboarding data for ${this.userId}:`,{triggers:r.length,dailyPatterns:s.length,copingStrategies:i.length})}}catch(h){console.warn(` CentralizedStats: Could not read user onboarding data for ${this.userId}:`,h.message)}const o=[],a={triggers:["Stress Vaper","Social Smoker","Coffee Companion","Work Breaker","Gaming Buddy","Party Animal","Peer Pressure","Celebration Trigger","Anxiety Soother","Focus Enhancer","Boredom Fighter","Emotional Support"],dailyPatterns:["Night Owl","Morning Struggler","Weekend Warrior","Routine Builder","Habit Former","Work Breaker","Coffee Companion","Party Animal"],copingStrategies:["First Timer","Veteran Quitter","Cold Turkey","Gradual Reduction","Stress Reliever","Mood Stabilizer","Reward Seeker","Social Lubricant"]};console.log(` CentralizedStats: Generating features from onboarding data for ${this.userId}:`,{triggers:r,dailyPatterns:s,copingStrategies:i}),r.includes("Stress/anxiety")&&o.push("Stress Vaper"),r.includes("Social situations")&&o.push("Social Smoker"),r.includes("Boredom")&&o.push("Boredom Fighter"),r.includes("After meals")&&o.push("Coffee Companion"),r.includes("Work breaks")&&o.push("Work Breaker"),s.includes("Evening wind-down")&&o.push("Night Owl"),s.includes("Morning routine")&&o.push("Morning Struggler"),s.includes("Social events")&&o.push("Party Animal"),s.includes("Work breaks")&&o.push("Work Breaker"),i.includes("Breathing exercises")&&o.push("Stress Reliever"),i.includes("Exercise/physical activity")&&o.push("Health Seeker"),i.includes("Nicotine replacement therapy")&&o.push("Veteran Quitter"),i.includes("Nothing - this is new to me")&&o.push("First Timer"),console.log(` CentralizedStats: Generated ${o.length} personalized features:`,o);const c=["Freedom Chaser","Nicotine Fighter","Health Seeker","Willpower Warrior"];for(;o.length<4;){const h=c[Math.floor(Math.random()*c.length)];o.includes(h)||o.push(h)}const u=o.slice(0,4);return await Te(K(this.db,`users/${this.userId}/specialFeatures`),u),console.log(` CentralizedStats: Generated and stored Special Features for ${this.userId}:`,u),u}catch(t){return console.error(` CentralizedStats: Error generating Special Features for ${this.userId}:`,t),["Freedom Chaser","Nicotine Fighter","Health Seeker","Willpower Warrior"]}}setupRealTimeListener(e){const t=kw(this.statsRef,r=>{if(r.exists()){const s=r.val();console.log(` CentralizedStats: Real-time update for ${this.userId}:`,s),e(s)}});return this.listeners.push(t),t}getDefaultStats(){return{mentalStrength:50,motivation:50,triggerDefense:30,addictionLevel:50,streakDays:0,streakUnit:"hours",streakDisplayText:"0 hours",cravingsResisted:0,experiencePoints:0}}showMilestoneNotification(e,t){try{if(typeof window<"u"&&window.showQuickActionPopup){const s={7:{title:" First Week Milestone!",message:`Congratulations! You've been clean for 7 days!

 Mental Strength: +${e.bonus} points

You're building incredible willpower! Keep going! `},30:{title:" One Month Champion!",message:`Amazing! You've reached 30 days clean!

 Mental Strength: +${e.bonus} points

You're proving your strength every day! `},90:{title:" Three Month Legend!",message:`Incredible! You've achieved 90 days clean!

 Mental Strength: +${e.bonus} points

You're a true inspiration! `}}[e.days]||{title:" Milestone Achieved!",message:`You've reached ${t} days clean!

 Mental Strength: +${e.bonus} points`};window.showQuickActionPopup(s.title,s.message,"success")}else console.log(` Milestone achieved: ${e.name} (+${e.bonus} Mental Strength)`)}catch(r){console.error("Error showing milestone notification:",r)}}async resetMilestones(){try{console.log(` CentralizedStats: Resetting milestones for ${this.userId} after relapse`);const e=K(this.db,`users/${this.userId}/profile/milestones`);await Te(e,null),console.log(` CentralizedStats: Milestones reset for ${this.userId} - can be earned again`)}catch(e){console.error(` CentralizedStats: Error resetting milestones for ${this.userId}:`,e)}}cleanup(){this.listeners.forEach(e=>e()),this.listeners=[]}async handleRelapse(){try{console.log(` CentralizedStats: Handling relapse for ${this.userId}`);const e=new Date,t=e.toISOString(),[r,s,i]=await Promise.all([ve(K(this.db,`users/${this.userId}/profile/lastRelapseDate`)),ve(K(this.db,`users/${this.userId}/profile/relapseEscalationLevel`)),ve(this.statsRef)]);let o=1;if(r.exists()){const m=new Date(r.val()),y=Math.floor((e-m)/(1e3*60*60*24)),w=s.exists()?s.val():1;console.log(` CentralizedStats: Current escalation level: ${w}`),console.log(` CentralizedStats: Days since last relapse: ${y}`),y>=7?(o=1,console.log(` CentralizedStats: After 7+ days clean  escalation level reset to: ${o}`)):(o=w+1,console.log(` CentralizedStats: Within ${y} days  escalation level: ${w} + 1 = ${o}`))}let a=0;switch(o){case 1:a=4;break;case 2:a=6;break;default:a=8;break}console.log(` CentralizedStats: Escalation level ${o}  addiction increase: +${a}`);const c=i.exists()?i.val():this.getDefaultStats(),u=Math.max(0,Math.min(100,(c.addictionLevel||50)+a)),h=Math.max(0,Math.min(100,(c.mentalStrength||50)-3)),f=Math.max(0,Math.min(100,(c.triggerDefense||30)-3));console.log(` CentralizedStats: addictionLevel change: ${c.addictionLevel}  ${u} (+${a})`),console.log(` CentralizedStats: mentalStrength change: ${c.mentalStrength}  ${h} (-3)`),console.log(` CentralizedStats: triggerDefense change: ${c.triggerDefense}  ${f} (-3)`),await Promise.all([Te(K(this.db,`users/${this.userId}/profile/lastRelapseDate`),t),Te(K(this.db,`users/${this.userId}/profile/relapseDate`),t),Te(K(this.db,`users/${this.userId}/profile/relapseEscalationLevel`),o),Te(K(this.db,`users/${this.userId}/lastQuitDate`),t),Te(K(this.db,`users/${this.userId}/profile/lastQuitDate`),t),this.resetMilestones(),Te(this.statsRef,{...c,addictionLevel:u,mentalStrength:h,triggerDefense:f,lastUpdated:t})]),console.log(` CentralizedStats: Relapse handled with escalation level ${o}, addiction +${a} for ${this.userId}`)}catch(e){throw console.error(` CentralizedStats: Error handling relapse for ${this.userId}:`,e),e}}async getCurrentStats(){try{const e=await ve(this.statsRef);return e.exists()?e.val():this.getDefaultStats()}catch(e){return console.error(` CentralizedStats: Error getting current stats for ${this.userId}:`,e),this.getDefaultStats()}}async handleCravingResisted(){try{console.log(` CentralizedStats: Handling craving resisted for ${this.userId}`),await this.checkAndResetDailyCounter();const e=await this.getCurrentStats(),t=e.mentalStrengthCravingsApplied||0;if(console.log(` CentralizedStats: Current mental strength cravings applied: ${t}`),t<3){const r=Math.min(100,(e.mentalStrength||50)+1),s=t+1,i={...e,mentalStrength:r,mentalStrengthCravingsApplied:s,mentalStrengthCravingsAppliedDate:new Date().toISOString(),lastUpdated:new Date().toISOString()};return this.authGuard?await this.authGuard.databaseSet(`users/${this.userId}/stats`,i):await Te(this.statsRef,i),console.log(` CentralizedStats: Applied +1 mental strength (${e.mentalStrength}  ${r}), cravings applied: ${s}/3`),await this.refreshAllStats(),console.log(` CentralizedStats: Craving resistance updated for ${this.userId}`),{applied:!0,cravingsApplied:s,limitReached:s>=3}}else return console.log(` CentralizedStats: Daily mental strength limit reached (${t}/3), no bonus applied`),await this.refreshAllStats(),console.log(` CentralizedStats: Craving resistance updated for ${this.userId}`),{applied:!1,cravingsApplied:t,limitReached:!0}}catch(e){throw console.error(` CentralizedStats: Error handling craving resistance for ${this.userId}:`,e),e}}async checkAndResetDailyCounter(){try{const e=await this.getCurrentStats(),t=e.mentalStrengthCravingsAppliedDate,r=new Date,s=r.toDateString();if(!t){const o={...e,mentalStrengthCravingsApplied:0,mentalStrengthCravingsAppliedDate:r.toISOString(),lastUpdated:new Date().toISOString()};this.authGuard?await this.authGuard.databaseSet(`users/${this.userId}/stats`,o):await Te(this.statsRef,o),console.log(` CentralizedStats: Initialized daily counter for ${this.userId} (reset to 0)`);return}if(new Date(t).toDateString()!==s){console.log(` CentralizedStats: New day detected, resetting daily mental strength counter for ${this.userId}`);const o={...e,mentalStrengthCravingsApplied:0,mentalStrengthCravingsAppliedDate:r.toISOString(),lastUpdated:new Date().toISOString()};this.authGuard?await this.authGuard.databaseSet(`users/${this.userId}/stats`,o):await Te(this.statsRef,o),console.log(` CentralizedStats: Daily mental strength counter reset for ${this.userId}`)}}catch(e){console.warn(` CentralizedStats: Could not check/reset daily counter for ${this.userId}:`,e.message)}}}const aS=(n,e={})=>{const{threshold:t=100,velocity:r=.5,enabled:s=!0}=e,[i,o]=D.useState(!1),[a,c]=D.useState(null),[u,h]=D.useState(0),f=D.useRef(null),m=D.useRef(0),y=D.useRef(0),w=D.useRef(0),S=D.useRef(0),R=D.useRef(0);return D.useEffect(()=>{if(!s||!f.current)return;const T=f.current;let I=!1;const N=A=>{if(!s)return;const x=A.touches[0];m.current=x.clientY,y.current=x.clientX,w.current=Date.now(),S.current=x.clientY,R.current=Date.now(),I=!0,o(!0),T.classList.add("swiping")},P=A=>{if(!I||!s)return;A.preventDefault();const x=A.touches[0],E=x.clientY-m.current,k=x.clientX-y.current;Math.abs(k)>Math.abs(E)||(h(E),E>0?(c("down"),T.style.transform=`translateY(${Math.min(E,t*1.5)}px)`,T.style.opacity=Math.max(.3,1-E/(t*2))):E<0&&(c("up"),T.style.transform=`translateY(${Math.max(E,-t*1.5)}px)`,T.style.opacity=Math.max(.3,1-Math.abs(E)/(t*2))),S.current=x.clientY,R.current=Date.now())},B=A=>{if(!I||!s)return;I=!1,o(!1);const E=A.changedTouches[0].clientY-m.current,k=Date.now()-w.current,C=Math.abs(E)/k;T.style.transform="",T.style.opacity="",T.classList.remove("swiping"),(Math.abs(E)>t||C>r)&&(E>0&&a==="down"?F("down"):E<0&&a==="up"&&F("up")),c(null),h(0)},F=A=>{T.classList.add(`swipe-${A}`),setTimeout(()=>{typeof n=="function"&&n()},200)};return T.addEventListener("touchstart",N,{passive:!1}),T.addEventListener("touchmove",P,{passive:!1}),T.addEventListener("touchend",B,{passive:!0}),()=>{T.removeEventListener("touchstart",N),T.removeEventListener("touchmove",P),T.removeEventListener("touchend",B)}},[s,t,r,a]),{modalRef:f,isSwipping:i,swipeDirection:a,swipeDistance:u,classes:`modal-swipe-dismiss ${i?"swiping":""} ${a?`swipe-${a}`:""}`}};var w8={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};const x8=n=>n.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase(),S8=(n,e)=>{const t=D.forwardRef(({color:r="currentColor",size:s=24,strokeWidth:i=2,absoluteStrokeWidth:o,children:a,...c},u)=>D.createElement("svg",{ref:u,...w8,width:s,height:s,stroke:r,strokeWidth:o?Number(i)*24/Number(s):i,className:`lucide lucide-${x8(n)}`,...c},[...e.map(([h,f])=>D.createElement(h,f)),...(Array.isArray(a)?a:[a])||[]]));return t.displayName=`${n}`,t};var pt=S8;const mp=pt("Activity",[["path",{d:"M22 12h-4l-3 9L9 3l-3 9H2",key:"d5dnw9"}]]),Gd=pt("AlertTriangle",[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3Z",key:"c3ski4"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]]),I8=pt("ArrowRight",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"m12 5 7 7-7 7",key:"xquz4c"}]]),pp=pt("BarChart3",[["path",{d:"M3 3v18h18",key:"1s2lah"}],["path",{d:"M18 17V9",key:"2bz60n"}],["path",{d:"M13 17V5",key:"1frdt8"}],["path",{d:"M8 17v-3",key:"17ska0"}]]),E8=pt("Bug",[["rect",{width:"8",height:"14",x:"8",y:"6",rx:"4",key:"hq8nra"}],["path",{d:"m19 7-3 2",key:"fmg8ec"}],["path",{d:"m5 7 3 2",key:"dkxqes"}],["path",{d:"m19 19-3-2",key:"1hbhi4"}],["path",{d:"m5 19 3-2",key:"dvt2ee"}],["path",{d:"M20 13h-4",key:"1agfp2"}],["path",{d:"M4 13h4",key:"1bwh8b"}],["path",{d:"m10 4 1 2",key:"1pot59"}],["path",{d:"m14 4-1 2",key:"m8sn0o"}]]),i2=pt("Calendar",[["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",ry:"2",key:"eu3xkr"}],["line",{x1:"16",x2:"16",y1:"2",y2:"6",key:"m3sa8f"}],["line",{x1:"8",x2:"8",y1:"2",y2:"6",key:"18kwsl"}],["line",{x1:"3",x2:"21",y1:"10",y2:"10",key:"xt86sb"}]]),WT=pt("CheckCircle",[["path",{d:"M22 11.08V12a10 10 0 1 1-5.93-9.14",key:"g774vq"}],["polyline",{points:"22 4 12 14.01 9 11.01",key:"6xbx8j"}]]),b8=pt("Clock",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["polyline",{points:"12 6 12 12 16 14",key:"68esgv"}]]),gp=pt("Database",[["ellipse",{cx:"12",cy:"5",rx:"9",ry:"3",key:"msslwz"}],["path",{d:"M3 5V19A9 3 0 0 0 21 19V5",key:"1wlel7"}],["path",{d:"M3 12A9 3 0 0 0 21 12",key:"mv7ke4"}]]),o2=pt("DollarSign",[["line",{x1:"12",x2:"12",y1:"2",y2:"22",key:"7eqyqh"}],["path",{d:"M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6",key:"1b0p4s"}]]),T8=pt("Download",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"7 10 12 15 17 10",key:"2ggqvy"}],["line",{x1:"12",x2:"12",y1:"15",y2:"3",key:"1vk2je"}]]),a2=pt("Heart",[["path",{d:"M19 14c1.49-1.46 3-3.21 3-5.5A5.5 5.5 0 0 0 16.5 3c-1.76 0-3 .5-4.5 2-1.5-1.5-2.74-2-4.5-2A5.5 5.5 0 0 0 2 8.5c0 2.3 1.5 4.05 3 5.5l7 7Z",key:"c3ymky"}]]),l2=pt("Home",[["path",{d:"m3 9 9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z",key:"y5dka4"}],["polyline",{points:"9 22 9 12 15 12 15 22",key:"e2us08"}]]),GT=pt("Lock",[["rect",{width:"18",height:"11",x:"3",y:"11",rx:"2",ry:"2",key:"1w4ew1"}],["path",{d:"M7 11V7a5 5 0 0 1 10 0v4",key:"fwvmzm"}]]),xf=pt("Play",[["polygon",{points:"5 3 19 12 5 21 5 3",key:"191637"}]]),Ds=pt("RefreshCw",[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]]),c2=pt("Settings",[["path",{d:"M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.5a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z",key:"1qme2f"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]),Us=pt("Shield",[["path",{d:"M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z",key:"3xmgem"}]]),A8=pt("Sparkles",[["path",{d:"m12 3-1.912 5.813a2 2 0 0 1-1.275 1.275L3 12l5.813 1.912a2 2 0 0 1 1.275 1.275L12 21l1.912-5.813a2 2 0 0 1 1.275-1.275L21 12l-5.813-1.912a2 2 0 0 1-1.275-1.275L12 3Z",key:"17u4zn"}],["path",{d:"M5 3v4",key:"bklmnn"}],["path",{d:"M19 17v4",key:"iiml17"}],["path",{d:"M3 5h4",key:"nem4j1"}],["path",{d:"M17 19h4",key:"lbex7p"}]]),Sf=pt("Square",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}]]),u2=pt("Star",[["polygon",{points:"12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2",key:"8f66p6"}]]),C8=pt("Target",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["circle",{cx:"12",cy:"12",r:"6",key:"1vlfrh"}],["circle",{cx:"12",cy:"12",r:"2",key:"1c9p78"}]]),k8=pt("TrendingUp",[["polyline",{points:"22 7 13.5 15.5 8.5 10.5 2 17",key:"126l90"}],["polyline",{points:"16 7 22 7 22 13",key:"kwv8wd"}]]),N8=pt("Trophy",[["path",{d:"M6 9H4.5a2.5 2.5 0 0 1 0-5H6",key:"17hqa7"}],["path",{d:"M18 9h1.5a2.5 2.5 0 0 0 0-5H18",key:"lmptdp"}],["path",{d:"M4 22h16",key:"57wxv0"}],["path",{d:"M10 14.66V17c0 .55-.47.98-.97 1.21C7.85 18.75 7 20.24 7 22",key:"1nw9bq"}],["path",{d:"M14 14.66V17c0 .55.47.98.97 1.21C16.15 18.75 17 20.24 17 22",key:"1np0yb"}],["path",{d:"M18 2H6v7a6 6 0 0 0 12 0V2Z",key:"u46fv3"}]]),R8=pt("Unlock",[["rect",{width:"18",height:"11",x:"3",y:"11",rx:"2",ry:"2",key:"1w4ew1"}],["path",{d:"M7 11V7a5 5 0 0 1 9.9-1",key:"1mm8w8"}]]),d2=pt("User",[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]]),lS=pt("Users",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["path",{d:"M22 21v-2a4 4 0 0 0-3-3.87",key:"kshegd"}],["path",{d:"M16 3.13a4 4 0 0 1 0 7.75",key:"1da9ce"}]]),Jy=pt("Wifi",[["path",{d:"M5 13a10 10 0 0 1 14 0",key:"6v8j51"}],["path",{d:"M8.5 16.5a5 5 0 0 1 7 0",key:"sej527"}],["path",{d:"M2 8.82a15 15 0 0 1 20 0",key:"dnpr2z"}],["line",{x1:"12",x2:"12.01",y1:"20",y2:"20",key:"of4bc4"}]]),D8=pt("X",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]]),P8=({isOpen:n,onClose:e})=>{var R,T,I,N,P,B,F,A,x,E,k,C,_,v,V,U,ce,we,z,re;const[t,r]=D.useState(null),[s,i]=D.useState([]),[o,a]=D.useState(!1),[c,u]=D.useState("overview"),[h,f]=D.useState(!0);D.useEffect(()=>{if(!n)return;const W=()=>{if(window.performanceIntegrationService){const Q=window.performanceIntegrationService.getMetricsSummary(),ee=window.performanceIntegrationService.getRecentAlerts(20);r(Q),i(ee)}};if(W(),h){const Q=setInterval(W,5e3);return()=>clearInterval(Q)}},[n,h]);const m=async W=>{if(window.stressTestService){a(!0);try{let Q;switch(W){case"database":Q=await window.stressTestService.databaseLoadTest({concurrentUsers:5,operationsPerUser:3});break;case"auth":Q=await window.stressTestService.authLoadTest({concurrentAttempts:10});break;case"offline":Q=await window.stressTestService.offlineOnlineTest({transitionCount:3});break;case"memory":Q=await window.stressTestService.memoryUsageTest({iterations:50});break;default:throw new Error("Unknown test type")}console.log(" Stress test completed:",Q)}catch(Q){console.error(" Stress test failed:",Q)}finally{a(!1)}}},y=()=>{window.performanceIntegrationService&&(window.performanceIntegrationService.clearAllMetrics(),r(null),i([]))},w=W=>W.includes("slow")?l.jsx(b8,{className:"w-4 h-4 text-yellow-500"}):W.includes("failure")||W.includes("error")?l.jsx(Gd,{className:"w-4 h-4 text-red-500"}):l.jsx(WT,{className:"w-4 h-4 text-green-500"}),S=W=>W.includes("slow")?"bg-yellow-50 border-yellow-200":W.includes("failure")||W.includes("error")?"bg-red-50 border-red-200":"bg-green-50 border-green-200";return n?l.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:l.jsxs("div",{className:"bg-white rounded-lg shadow-xl max-w-6xl w-full max-h-[90vh] overflow-hidden",children:[l.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-gray-200",children:[l.jsxs("div",{className:"flex items-center space-x-3",children:[l.jsx(mp,{className:"w-6 h-6 text-blue-600"}),l.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:"Performance Dashboard"})]}),l.jsxs("div",{className:"flex items-center space-x-4",children:[l.jsxs("button",{onClick:()=>f(!h),className:`flex items-center space-x-2 px-3 py-1 rounded-md text-sm ${h?"bg-green-100 text-green-700":"bg-gray-100 text-gray-700"}`,children:[l.jsx(Ds,{className:`w-4 h-4 ${h?"animate-spin":""}`}),l.jsx("span",{children:"Auto Refresh"})]}),l.jsx("button",{onClick:e,className:"text-gray-400 hover:text-gray-600 transition-colors",children:l.jsx(D8,{className:"w-6 h-6"})})]})]}),l.jsx("div",{className:"flex border-b border-gray-200",children:[{id:"overview",label:"Overview",icon:pp},{id:"database",label:"Database",icon:gp},{id:"auth",label:"Authentication",icon:Us},{id:"offline",label:"Offline Queue",icon:Jy},{id:"alerts",label:"Alerts",icon:Gd}].map(W=>{const Q=W.icon;return l.jsxs("button",{onClick:()=>u(W.id),className:`flex items-center space-x-2 px-6 py-3 text-sm font-medium border-b-2 transition-colors ${c===W.id?"border-blue-500 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700"}`,children:[l.jsx(Q,{className:"w-4 h-4"}),l.jsx("span",{children:W.label})]},W.id)})}),l.jsxs("div",{className:"p-6 overflow-y-auto max-h-[calc(90vh-200px)]",children:[c==="overview"&&l.jsxs("div",{className:"space-y-6",children:[l.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[l.jsxs("div",{className:"bg-blue-50 p-4 rounded-lg",children:[l.jsxs("div",{className:"flex items-center justify-between",children:[l.jsxs("div",{children:[l.jsx("p",{className:"text-sm font-medium text-blue-600",children:"Database Queries"}),l.jsx("p",{className:"text-2xl font-bold text-blue-900",children:((R=t==null?void 0:t.database)==null?void 0:R.totalQueries)||0})]}),l.jsx(gp,{className:"w-8 h-8 text-blue-500"})]}),l.jsxs("p",{className:"text-xs text-blue-600 mt-1",children:["Avg: ",((T=t==null?void 0:t.database)==null?void 0:T.averageQueryTime)||0,"ms"]})]}),l.jsxs("div",{className:"bg-green-50 p-4 rounded-lg",children:[l.jsxs("div",{className:"flex items-center justify-between",children:[l.jsxs("div",{children:[l.jsx("p",{className:"text-sm font-medium text-green-600",children:"Auth Success Rate"}),l.jsxs("p",{className:"text-2xl font-bold text-green-900",children:[((I=t==null?void 0:t.authentication)==null?void 0:I.successRate)||0,"%"]})]}),l.jsx(Us,{className:"w-8 h-8 text-green-500"})]}),l.jsxs("p",{className:"text-xs text-green-600 mt-1",children:[((N=t==null?void 0:t.authentication)==null?void 0:N.totalAttempts)||0," attempts"]})]}),l.jsxs("div",{className:"bg-purple-50 p-4 rounded-lg",children:[l.jsxs("div",{className:"flex items-center justify-between",children:[l.jsxs("div",{children:[l.jsx("p",{className:"text-sm font-medium text-purple-600",children:"Offline Operations"}),l.jsx("p",{className:"text-2xl font-bold text-purple-900",children:((P=t==null?void 0:t.offlineQueue)==null?void 0:P.totalOperations)||0})]}),l.jsx(Jy,{className:"w-8 h-8 text-purple-500"})]}),l.jsxs("p",{className:"text-xs text-purple-600 mt-1",children:["Success: ",((B=t==null?void 0:t.offlineQueue)==null?void 0:B.successRate)||0,"%"]})]}),l.jsxs("div",{className:"bg-orange-50 p-4 rounded-lg",children:[l.jsxs("div",{className:"flex items-center justify-between",children:[l.jsxs("div",{children:[l.jsx("p",{className:"text-sm font-medium text-orange-600",children:"Page Loads"}),l.jsx("p",{className:"text-2xl font-bold text-orange-900",children:((F=t==null?void 0:t.general)==null?void 0:F.totalPageLoads)||0})]}),l.jsx(mp,{className:"w-8 h-8 text-orange-500"})]}),l.jsxs("p",{className:"text-xs text-orange-600 mt-1",children:["Avg: ",((A=t==null?void 0:t.general)==null?void 0:A.averagePageLoadTime)||0,"ms"]})]})]}),l.jsxs("div",{className:"bg-gray-50 p-6 rounded-lg",children:[l.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Stress Testing"}),l.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[l.jsxs("button",{onClick:()=>m("database"),disabled:o,className:"flex items-center justify-center space-x-2 px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed",children:[o?l.jsx(Sf,{className:"w-4 h-4"}):l.jsx(xf,{className:"w-4 h-4"}),l.jsx("span",{children:"Database Load"})]}),l.jsxs("button",{onClick:()=>m("auth"),disabled:o,className:"flex items-center justify-center space-x-2 px-4 py-2 bg-green-600 text-white rounded-md hover:bg-green-700 disabled:opacity-50 disabled:cursor-not-allowed",children:[o?l.jsx(Sf,{className:"w-4 h-4"}):l.jsx(xf,{className:"w-4 h-4"}),l.jsx("span",{children:"Auth Load"})]}),l.jsxs("button",{onClick:()=>m("offline"),disabled:o,className:"flex items-center justify-center space-x-2 px-4 py-2 bg-purple-600 text-white rounded-md hover:bg-purple-700 disabled:opacity-50 disabled:cursor-not-allowed",children:[o?l.jsx(Sf,{className:"w-4 h-4"}):l.jsx(xf,{className:"w-4 h-4"}),l.jsx("span",{children:"Offline/Online"})]}),l.jsxs("button",{onClick:()=>m("memory"),disabled:o,className:"flex items-center justify-center space-x-2 px-4 py-2 bg-orange-600 text-white rounded-md hover:bg-orange-700 disabled:opacity-50 disabled:cursor-not-allowed",children:[o?l.jsx(Sf,{className:"w-4 h-4"}):l.jsx(xf,{className:"w-4 h-4"}),l.jsx("span",{children:"Memory Usage"})]})]}),o&&l.jsx("div",{className:"mt-4 text-center",children:l.jsxs("div",{className:"inline-flex items-center space-x-2 text-blue-600",children:[l.jsx(Ds,{className:"w-4 h-4 animate-spin"}),l.jsx("span",{children:"Running stress test..."})]})})]}),l.jsxs("div",{className:"flex justify-between items-center",children:[l.jsx("button",{onClick:y,className:"px-4 py-2 bg-gray-600 text-white rounded-md hover:bg-gray-700",children:"Clear All Metrics"}),l.jsxs("div",{className:"text-sm text-gray-500",children:["Last updated: ",new Date().toLocaleTimeString()]})]})]}),c==="database"&&l.jsxs("div",{className:"space-y-4",children:[l.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Database Performance"}),l.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[l.jsxs("div",{className:"bg-white p-4 rounded-lg border border-gray-200",children:[l.jsx("h4",{className:"font-medium text-gray-900 mb-3",children:"Query Statistics"}),l.jsxs("div",{className:"space-y-2",children:[l.jsxs("div",{className:"flex justify-between",children:[l.jsx("span",{className:"text-sm text-gray-600",children:"Total Queries:"}),l.jsx("span",{className:"font-medium",children:((x=t==null?void 0:t.database)==null?void 0:x.totalQueries)||0})]}),l.jsxs("div",{className:"flex justify-between",children:[l.jsx("span",{className:"text-sm text-gray-600",children:"Average Time:"}),l.jsxs("span",{className:"font-medium",children:[((E=t==null?void 0:t.database)==null?void 0:E.averageQueryTime)||0,"ms"]})]}),l.jsxs("div",{className:"flex justify-between",children:[l.jsx("span",{className:"text-sm text-gray-600",children:"Slow Queries:"}),l.jsx("span",{className:"font-medium text-yellow-600",children:((k=t==null?void 0:t.database)==null?void 0:k.slowQueries)||0})]}),l.jsxs("div",{className:"flex justify-between",children:[l.jsx("span",{className:"text-sm text-gray-600",children:"Slow Query Rate:"}),l.jsxs("span",{className:"font-medium",children:[((C=t==null?void 0:t.database)==null?void 0:C.slowQueryRate)||0,"%"]})]})]})]}),l.jsxs("div",{className:"bg-white p-4 rounded-lg border border-gray-200",children:[l.jsx("h4",{className:"font-medium text-gray-900 mb-3",children:"Performance Trends"}),l.jsxs("div",{className:"text-center text-gray-500 py-8",children:[l.jsx(pp,{className:"w-12 h-12 mx-auto mb-2 text-gray-400"}),l.jsx("p",{children:"Performance trends will be displayed here"})]})]})]})]}),c==="auth"&&l.jsxs("div",{className:"space-y-4",children:[l.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Authentication Performance"}),l.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[l.jsxs("div",{className:"bg-white p-4 rounded-lg border border-gray-200",children:[l.jsx("h4",{className:"font-medium text-gray-900 mb-3",children:"Auth Statistics"}),l.jsxs("div",{className:"space-y-2",children:[l.jsxs("div",{className:"flex justify-between",children:[l.jsx("span",{className:"text-sm text-gray-600",children:"Total Attempts:"}),l.jsx("span",{className:"font-medium",children:((_=t==null?void 0:t.authentication)==null?void 0:_.totalAttempts)||0})]}),l.jsxs("div",{className:"flex justify-between",children:[l.jsx("span",{className:"text-sm text-gray-600",children:"Success Rate:"}),l.jsxs("span",{className:"font-medium text-green-600",children:[((v=t==null?void 0:t.authentication)==null?void 0:v.successRate)||0,"%"]})]}),l.jsxs("div",{className:"flex justify-between",children:[l.jsx("span",{className:"text-sm text-gray-600",children:"Failed Attempts:"}),l.jsx("span",{className:"font-medium text-red-600",children:((V=t==null?void 0:t.authentication)==null?void 0:V.failedAttempts)||0})]}),l.jsxs("div",{className:"flex justify-between",children:[l.jsx("span",{className:"text-sm text-gray-600",children:"Average Time:"}),l.jsxs("span",{className:"font-medium",children:[((U=t==null?void 0:t.authentication)==null?void 0:U.averageLoginTime)||0,"ms"]})]})]})]}),l.jsxs("div",{className:"bg-white p-4 rounded-lg border border-gray-200",children:[l.jsx("h4",{className:"font-medium text-gray-900 mb-3",children:"Recent Attempts"}),l.jsxs("div",{className:"text-center text-gray-500 py-8",children:[l.jsx(Us,{className:"w-12 h-12 mx-auto mb-2 text-gray-400"}),l.jsx("p",{children:"Recent authentication attempts will be displayed here"})]})]})]})]}),c==="offline"&&l.jsxs("div",{className:"space-y-4",children:[l.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Offline Queue Performance"}),l.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[l.jsxs("div",{className:"bg-white p-4 rounded-lg border border-gray-200",children:[l.jsx("h4",{className:"font-medium text-gray-900 mb-3",children:"Queue Statistics"}),l.jsxs("div",{className:"space-y-2",children:[l.jsxs("div",{className:"flex justify-between",children:[l.jsx("span",{className:"text-sm text-gray-600",children:"Total Operations:"}),l.jsx("span",{className:"font-medium",children:((ce=t==null?void 0:t.offlineQueue)==null?void 0:ce.totalOperations)||0})]}),l.jsxs("div",{className:"flex justify-between",children:[l.jsx("span",{className:"text-sm text-gray-600",children:"Success Rate:"}),l.jsxs("span",{className:"font-medium text-green-600",children:[((we=t==null?void 0:t.offlineQueue)==null?void 0:we.successRate)||0,"%"]})]}),l.jsxs("div",{className:"flex justify-between",children:[l.jsx("span",{className:"text-sm text-gray-600",children:"Failed Operations:"}),l.jsx("span",{className:"font-medium text-red-600",children:((z=t==null?void 0:t.offlineQueue)==null?void 0:z.failedOperations)||0})]}),l.jsxs("div",{className:"flex justify-between",children:[l.jsx("span",{className:"text-sm text-gray-600",children:"Average Time:"}),l.jsxs("span",{className:"font-medium",children:[((re=t==null?void 0:t.offlineQueue)==null?void 0:re.averageProcessTime)||0,"ms"]})]})]})]}),l.jsxs("div",{className:"bg-white p-4 rounded-lg border border-gray-200",children:[l.jsx("h4",{className:"font-medium text-gray-900 mb-3",children:"Queue Status"}),l.jsxs("div",{className:"text-center text-gray-500 py-8",children:[l.jsx(Jy,{className:"w-12 h-12 mx-auto mb-2 text-gray-400"}),l.jsx("p",{children:"Offline queue status will be displayed here"})]})]})]})]}),c==="alerts"&&l.jsxs("div",{className:"space-y-4",children:[l.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Performance Alerts"}),l.jsx("div",{className:"space-y-3",children:s.length===0?l.jsxs("div",{className:"text-center text-gray-500 py-8",children:[l.jsx(WT,{className:"w-12 h-12 mx-auto mb-2 text-green-400"}),l.jsx("p",{children:"No alerts at this time"})]}):s.map((W,Q)=>l.jsx("div",{className:`p-4 rounded-lg border ${S(W.type)}`,children:l.jsxs("div",{className:"flex items-start space-x-3",children:[w(W.type),l.jsxs("div",{className:"flex-1",children:[l.jsxs("div",{className:"flex items-center justify-between",children:[l.jsx("h4",{className:"font-medium text-gray-900 capitalize",children:W.type.replace(/_/g," ")}),l.jsx("span",{className:"text-xs text-gray-500",children:new Date(W.timestamp).toLocaleTimeString()})]}),l.jsx("p",{className:"text-sm text-gray-600 mt-1",children:JSON.stringify(W.data,null,2)})]})]})},Q))})]})]})]})}):null};class O8{constructor(){this.metrics={database:{queries:[],totalQueries:0,averageQueryTime:0,slowQueries:0},authentication:{loginAttempts:[],totalAttempts:0,averageLoginTime:0,failedAttempts:0},offlineQueue:{operations:[],totalOperations:0,averageProcessTime:0,failedOperations:0},general:{pageLoads:[],totalPageLoads:0,averagePageLoadTime:0}},this.alerts=[],this.thresholds={slowQuery:1e3,slowLogin:3e3,slowOperation:2e3,slowPageLoad:5e3},this.isEnabled=!0,this.maxMetricsHistory=1e3}startTimer(e){return{operationId:e,startTime:performance.now(),timestamp:new Date().toISOString()}}endTimer(e,t,r,s={}){if(!this.isEnabled)return;const o=performance.now()-e.startTime,a={operationId:e.operationId,operation:r,duration:o,timestamp:e.timestamp,endTime:new Date().toISOString(),metadata:s};if(this.metrics[t]){this.metrics[t].operations=this.metrics[t].operations||[],this.metrics[t].operations.push(a),this.metrics[t].totalOperations=(this.metrics[t].totalOperations||0)+1;const c=this.metrics[t].operations.reduce((h,f)=>h+f.duration,0);this.metrics[t].averageProcessTime=c/this.metrics[t].operations.length;const u=this.thresholds[`slow${t.charAt(0).toUpperCase()+t.slice(1)}`]||this.thresholds.slowOperation;o>u&&(this.metrics[t].slowOperations=(this.metrics[t].slowOperations||0)+1,this.createAlert("slow_operation",{category:t,operation:r,duration:o,threshold:u})),this.metrics[t].operations.length>this.maxMetricsHistory&&(this.metrics[t].operations=this.metrics[t].operations.slice(-this.maxMetricsHistory))}return a}recordDatabaseQuery(e,t,r={}){if(!this.isEnabled)return;const s={operation:e,duration:t,timestamp:new Date().toISOString(),metadata:r};this.metrics.database.queries.push(s),this.metrics.database.totalQueries++;const i=this.metrics.database.queries.reduce((o,a)=>o+a.duration,0);this.metrics.database.averageQueryTime=i/this.metrics.database.queries.length,t>this.thresholds.slowQuery&&(this.metrics.database.slowQueries++,this.createAlert("slow_query",{operation:e,duration:t,threshold:this.thresholds.slowQuery})),this.metrics.database.queries.length>this.maxMetricsHistory&&(this.metrics.database.queries=this.metrics.database.queries.slice(-this.maxMetricsHistory))}recordAuthAttempt(e,t,r,s={}){if(!this.isEnabled)return;const i={operation:e,duration:t,success:r,timestamp:new Date().toISOString(),metadata:s};this.metrics.authentication.loginAttempts.push(i),this.metrics.authentication.totalAttempts++,r||(this.metrics.authentication.failedAttempts++,this.createAlert("auth_failure",{operation:e,duration:t,metadata:s}));const o=this.metrics.authentication.loginAttempts.reduce((a,c)=>a+c.duration,0);this.metrics.authentication.averageLoginTime=o/this.metrics.authentication.loginAttempts.length,t>this.thresholds.slowLogin&&this.createAlert("slow_login",{operation:e,duration:t,threshold:this.thresholds.slowLogin}),this.metrics.authentication.loginAttempts.length>this.maxMetricsHistory&&(this.metrics.authentication.loginAttempts=this.metrics.authentication.loginAttempts.slice(-this.maxMetricsHistory))}recordOfflineOperation(e,t,r,s={}){if(!this.isEnabled)return;const i={operation:e,duration:t,success:r,timestamp:new Date().toISOString(),metadata:s};this.metrics.offlineQueue.operations.push(i),this.metrics.offlineQueue.totalOperations++,r||(this.metrics.offlineQueue.failedOperations++,this.createAlert("offline_failure",{operation:e,duration:t,metadata:s}));const o=this.metrics.offlineQueue.operations.reduce((a,c)=>a+c.duration,0);this.metrics.offlineQueue.averageProcessTime=o/this.metrics.offlineQueue.operations.length,t>this.thresholds.slowOperation&&this.createAlert("slow_offline_operation",{operation:e,duration:t,threshold:this.thresholds.slowOperation}),this.metrics.offlineQueue.operations.length>this.maxMetricsHistory&&(this.metrics.offlineQueue.operations=this.metrics.offlineQueue.operations.slice(-this.maxMetricsHistory))}recordPageLoad(e,t,r={}){if(!this.isEnabled)return;const s={page:e,duration:t,timestamp:new Date().toISOString(),metadata:r};this.metrics.general.pageLoads.push(s),this.metrics.general.totalPageLoads++;const i=this.metrics.general.pageLoads.reduce((o,a)=>o+a.duration,0);this.metrics.general.averagePageLoadTime=i/this.metrics.general.pageLoads.length,t>this.thresholds.slowPageLoad&&this.createAlert("slow_page_load",{page:e,duration:t,threshold:this.thresholds.slowPageLoad}),this.metrics.general.pageLoads.length>this.maxMetricsHistory&&(this.metrics.general.pageLoads=this.metrics.general.pageLoads.slice(-this.maxMetricsHistory))}createAlert(e,t){const r={id:Date.now()+Math.random(),type:e,data:t,timestamp:new Date().toISOString(),severity:this.getAlertSeverity(e)};return this.alerts.push(r),this.alerts.length>100&&(this.alerts=this.alerts.slice(-100)),r}getAlertSeverity(e){return{slow_query:"warning",slow_login:"warning",slow_operation:"warning",slow_offline_operation:"warning",slow_page_load:"warning",auth_failure:"error",offline_failure:"error"}[e]||"info"}getMetricsSummary(){return{database:{totalQueries:this.metrics.database.totalQueries,averageQueryTime:Math.round(this.metrics.database.averageQueryTime),slowQueries:this.metrics.database.slowQueries,slowQueryRate:this.metrics.database.totalQueries>0?(this.metrics.database.slowQueries/this.metrics.database.totalQueries*100).toFixed(2):0},authentication:{totalAttempts:this.metrics.authentication.totalAttempts,averageLoginTime:Math.round(this.metrics.authentication.averageLoginTime),failedAttempts:this.metrics.authentication.failedAttempts,successRate:this.metrics.authentication.totalAttempts>0?((this.metrics.authentication.totalAttempts-this.metrics.authentication.failedAttempts)/this.metrics.authentication.totalAttempts*100).toFixed(2):0},offlineQueue:{totalOperations:this.metrics.offlineQueue.totalOperations,averageProcessTime:Math.round(this.metrics.offlineQueue.averageProcessTime),failedOperations:this.metrics.offlineQueue.failedOperations,successRate:this.metrics.offlineQueue.totalOperations>0?((this.metrics.offlineQueue.totalOperations-this.metrics.offlineQueue.failedOperations)/this.metrics.offlineQueue.totalOperations*100).toFixed(2):0},general:{totalPageLoads:this.metrics.general.totalPageLoads,averagePageLoadTime:Math.round(this.metrics.general.averagePageLoadTime)},alerts:{total:this.alerts.length,recent:this.alerts.slice(-10),byType:this.getAlertsByType()}}}getAlertsByType(){const e={};return this.alerts.forEach(t=>{e[t.type]=(e[t.type]||0)+1}),e}clearMetrics(){this.metrics={database:{queries:[],totalQueries:0,averageQueryTime:0,slowQueries:0},authentication:{loginAttempts:[],totalAttempts:0,averageLoginTime:0,failedAttempts:0},offlineQueue:{operations:[],totalOperations:0,averageProcessTime:0,failedOperations:0},general:{pageLoads:[],totalPageLoads:0,averagePageLoadTime:0}},this.alerts=[]}setEnabled(e){this.isEnabled=e}updateThresholds(e){this.thresholds={...this.thresholds,...e}}exportMetrics(){return{metrics:this.metrics,alerts:this.alerts,thresholds:this.thresholds,exportedAt:new Date().toISOString()}}}const he=new O8;class j8{constructor(){this.originalMethods={ref:K,get:ve,set:Te,push:Kk,update:$F,remove:FF,onValue:kw,off:UF,query:JF}}ref(e,t){const r=he.startTimer(`ref_${t}`),s=this.originalMethods.ref(e,t);return he.endTimer(r,"database","ref",{path:t}),s}async get(e){const t=he.startTimer(`get_${e.key||"unknown"}`);try{const r=await this.originalMethods.get(e);return he.endTimer(t,"database","get",{path:e.key||"unknown",success:!0,hasData:r.exists()}),r}catch(r){throw he.endTimer(t,"database","get",{path:e.key||"unknown",success:!1,error:r.message}),r}}async set(e,t){const r=he.startTimer(`set_${e.key||"unknown"}`);try{const s=await this.originalMethods.set(e,t);return he.endTimer(r,"database","set",{path:e.key||"unknown",success:!0,dataSize:JSON.stringify(t).length}),s}catch(s){throw he.endTimer(r,"database","set",{path:e.key||"unknown",success:!1,error:s.message}),s}}push(e){const t=he.startTimer(`push_${e.key||"unknown"}`),r=this.originalMethods.push(e);return he.endTimer(t,"database","push",{path:e.key||"unknown",newKey:r.key}),r}async update(e,t){const r=he.startTimer(`update_${e.key||"unknown"}`);try{const s=await this.originalMethods.update(e,t);return he.endTimer(r,"database","update",{path:e.key||"unknown",success:!0,updateCount:Object.keys(t).length}),s}catch(s){throw he.endTimer(r,"database","update",{path:e.key||"unknown",success:!1,error:s.message}),s}}async remove(e){const t=he.startTimer(`remove_${e.key||"unknown"}`);try{const r=await this.originalMethods.remove(e);return he.endTimer(t,"database","remove",{path:e.key||"unknown",success:!0}),r}catch(r){throw he.endTimer(t,"database","remove",{path:e.key||"unknown",success:!1,error:r.message}),r}}onValue(e,t,r,s){const i=he.startTimer(`onValue_${e.key||"unknown"}`),o=a=>{he.endTimer(i,"database","onValue",{path:e.key||"unknown",success:!0,hasData:a.exists()}),t(a)};return this.originalMethods.onValue(e,o,r,s)}off(e,t){const r=he.startTimer(`off_${e.key||"unknown"}`),s=this.originalMethods.off(e,t);return he.endTimer(r,"database","off",{path:e.key||"unknown"}),s}query(e,...t){const r=he.startTimer(`query_${e.key||"unknown"}`),s=this.originalMethods.query(e,...t);return he.endTimer(r,"database","query",{path:e.key||"unknown",constraintCount:t.length}),s}async trackOperation(e,t,r={}){const s=he.startTimer(e);try{const i=await t();return he.endTimer(s,"database",e,{...r,success:!0}),i}catch(i){throw he.endTimer(s,"database",e,{...r,success:!1,error:i.message}),i}}getDatabaseMetrics(){return he.getMetricsSummary().database}getSlowQueries(e=10){return he.metrics.database.queries.filter(t=>t.duration>he.thresholds.slowQuery).sort((t,r)=>r.duration-t.duration).slice(0,e)}getRecentQueries(e=20){return he.metrics.database.queries.sort((t,r)=>new Date(r.timestamp)-new Date(t.timestamp)).slice(0,e)}}const If=new j8;class L8{constructor(){this.originalMethods={signInWithEmailAndPassword:gP,createUserWithEmailAndPassword:pP,signOut:TB,onAuthStateChanged:bB,setPersistence:vP,browserLocalPersistence:Yu,browserSessionPersistence:Ju}}async signInWithEmailAndPassword(e,t,r){const s=he.startTimer(`signIn_${t}`);try{const i=await this.originalMethods.signInWithEmailAndPassword(e,t,r);return he.recordAuthAttempt("signIn",s.duration,!0,{email:t,uid:i.user.uid,method:"email"}),i}catch(i){throw he.recordAuthAttempt("signIn",s.duration,!1,{email:t,error:i.code,method:"email"}),i}}async createUserWithEmailAndPassword(e,t,r){const s=he.startTimer(`createUser_${t}`);try{const i=await this.originalMethods.createUserWithEmailAndPassword(e,t,r);return he.recordAuthAttempt("createUser",s.duration,!0,{email:t,uid:i.user.uid,method:"email"}),i}catch(i){throw he.recordAuthAttempt("createUser",s.duration,!1,{email:t,error:i.code,method:"email"}),i}}async signOut(e){const t=he.startTimer("signOut");try{const r=await this.originalMethods.signOut(e);return he.recordAuthAttempt("signOut",t.duration,!0,{method:"signOut"}),r}catch(r){throw he.recordAuthAttempt("signOut",t.duration,!1,{error:r.code,method:"signOut"}),r}}onAuthStateChanged(e,t,r,s){const i=he.startTimer("onAuthStateChanged"),o=u=>{const h=performance.now()-i.startTime;he.recordAuthAttempt("authStateChange",h,!0,{hasUser:!!u,uid:u==null?void 0:u.uid,method:"onAuthStateChanged"}),typeof t=="function"?t(u):t&&t.next&&t.next(u)},a=u=>{const h=performance.now()-i.startTime;he.recordAuthAttempt("authStateChange",h,!1,{error:(u==null?void 0:u.code)||"unknown",method:"onAuthStateChanged"}),u&&typeof u=="function"?u(u):u&&u.error&&u.error(u)},c=()=>{const u=performance.now()-i.startTime;he.recordAuthAttempt("authStateChange",u,!0,{method:"onAuthStateChanged",completed:!0}),s&&typeof s=="function"?s():s&&s.complete&&s.complete()};return this.originalMethods.onAuthStateChanged(e,o,a,c)}async setPersistence(e,t){const r=he.startTimer("setPersistence");try{const s=await this.originalMethods.setPersistence(e,t);return he.recordAuthAttempt("setPersistence",r.duration,!0,{persistence:t===Yu?"local":t===Ju?"session":"unknown"}),s}catch(s){throw he.recordAuthAttempt("setPersistence",r.duration,!1,{error:s.code,persistence:t===Yu?"local":t===Ju?"session":"unknown"}),s}}async trackAuthOperation(e,t,r={}){const s=he.startTimer(e);try{const i=await t();return he.recordAuthAttempt(e,s.duration,!0,r),i}catch(i){throw he.recordAuthAttempt(e,s.duration,!1,{...r,error:i.code||i.message}),i}}getAuthMetrics(){return he.getMetricsSummary().authentication}getFailedAttempts(e=10){return he.metrics.authentication.loginAttempts.filter(t=>!t.success).sort((t,r)=>new Date(r.timestamp)-new Date(t.timestamp)).slice(0,e)}getRecentAttempts(e=20){return he.metrics.authentication.loginAttempts.sort((t,r)=>new Date(r.timestamp)-new Date(t.timestamp)).slice(0,e)}getSlowOperations(e=10){return he.metrics.authentication.loginAttempts.filter(t=>t.duration>he.thresholds.slowLogin).sort((t,r)=>r.duration-t.duration).slice(0,e)}getSuccessRateByOperation(){const e={};return he.metrics.authentication.loginAttempts.forEach(t=>{e[t.operation]||(e[t.operation]={total:0,successful:0}),e[t.operation].total++,t.success&&e[t.operation].successful++}),Object.keys(e).forEach(t=>{const r=e[t];r.successRate=r.total>0?(r.successful/r.total*100).toFixed(2):0}),e}}const ul=new L8;class M8{constructor(){this.isRunning=!1,this.activeTests=new Map,this.testResults=[]}async runStressTest(e,t={}){if(this.isRunning)throw new Error("Stress test already running");this.isRunning=!0;const r=Date.now().toString();try{console.log(` Starting stress test: ${e.name}`);const s=await this.executeScenario(e,t);return this.testResults.push({id:r,scenario:e.name,startTime:new Date().toISOString(),endTime:new Date().toISOString(),duration:s.duration,success:s.success,metrics:s.metrics,errors:s.errors}),console.log(` Stress test completed: ${e.name}`),s}catch(s){throw console.error(` Stress test failed: ${e.name}`,s),s}finally{this.isRunning=!1}}async executeScenario(e,t){const r=performance.now(),s=[],i={operations:0,successfulOperations:0,failedOperations:0,averageResponseTime:0,maxResponseTime:0,minResponseTime:1/0};try{await e.execute(t,{onOperation:(c,u,h)=>{i.operations++,h?i.successfulOperations++:i.failedOperations++,i.averageResponseTime=(i.averageResponseTime+u)/2,i.maxResponseTime=Math.max(i.maxResponseTime,u),i.minResponseTime=Math.min(i.minResponseTime,u)},onError:c=>{s.push({message:c.message,timestamp:new Date().toISOString(),stack:c.stack})}});const a=performance.now()-r;return{success:s.length===0,duration:a,metrics:i,errors:s}}catch(o){const c=performance.now()-r;return s.push({message:o.message,timestamp:new Date().toISOString(),stack:o.stack}),{success:!1,duration:c,metrics:i,errors:s}}}async databaseLoadTest(e={}){const{concurrentUsers:t=10,operationsPerUser:r=5,operationDelay:s=100}=e,i={name:"Database Load Test",execute:async(o,a)=>{const c=[];for(let u=0;u<t;u++){const h=this.simulateUserDatabaseOperations(`test_user_${u}`,r,s,a);c.push(h)}await Promise.all(c)}};return this.runStressTest(i,e)}async simulateUserDatabaseOperations(e,t,r,s){for(let i=0;i<t;i++)try{const o=performance.now(),a=[()=>this.simulateReadOperation(e,i),()=>this.simulateWriteOperation(e,i),()=>this.simulateUpdateOperation(e,i),()=>this.simulateQueryOperation(e,i)],c=a[i%a.length];await c();const u=performance.now()-o;s.onOperation(`db_operation_${i}`,u,!0),r>0&&await new Promise(h=>setTimeout(h,r))}catch(o){const a=performance.now()-startTime;s.onOperation(`db_operation_${i}`,a,!1),s.onError(o)}}async simulateReadOperation(e,t){const r=K(H,`stress_test/${e}/read_${t}`);await ve(r)}async simulateWriteOperation(e,t){const r=K(H,`stress_test/${e}/write_${t}`);await Te(r,{data:`test_data_${t}`,timestamp:Date.now(),index:t})}async simulateUpdateOperation(e,t){const r=K(H,`stress_test/${e}/update_${t}`);await Te(r,{data:`updated_data_${t}`,timestamp:Date.now(),index:t,updated:!0})}async simulateQueryOperation(e,t){const r=K(H,`stress_test/${e}`);await ve(r)}async authLoadTest(e={}){const{concurrentAttempts:t=20,delayBetweenAttempts:r=50}=e,s={name:"Authentication Load Test",execute:async(i,o)=>{const a=[];for(let c=0;c<t;c++){const u=this.simulateAuthAttempt(c,r,o);a.push(u)}await Promise.all(a)}};return this.runStressTest(s,e)}async simulateAuthAttempt(e,t,r){try{const s=performance.now();await new Promise(a=>setTimeout(a,Math.random()*1e3+100));const i=performance.now()-s,o=Math.random()>.1;r.onOperation(`auth_attempt_${e}`,i,o),o||r.onError(new Error(`Simulated auth failure ${e}`)),t>0&&await new Promise(a=>setTimeout(a,t))}catch(s){r.onError(s)}}async offlineOnlineTest(e={}){const{transitionCount:t=5,offlineDuration:r=2e3,onlineDuration:s=2e3}=e,i={name:"Offline/Online Transition Test",execute:async(o,a)=>{for(let c=0;c<t;c++)a.onOperation(`offline_transition_${c}`,0,!0),await new Promise(u=>setTimeout(u,r)),a.onOperation(`online_transition_${c}`,0,!0),await new Promise(u=>setTimeout(u,s))}};return this.runStressTest(i,e)}async memoryUsageTest(e={}){const{iterations:t=100,dataSize:r=1e3}=e,s={name:"Memory Usage Test",execute:async(i,o)=>{for(let a=0;a<t;a++){const c=performance.now();new Array(r).fill(0).map((h,f)=>({id:f,data:`test_data_${a}_${f}`,timestamp:Date.now()}));const u=performance.now()-c;o.onOperation(`memory_allocation_${a}`,u,!0)}}};return this.runStressTest(s,e)}getTestResults(e=10){return this.testResults.sort((t,r)=>new Date(r.startTime)-new Date(t.startTime)).slice(0,e)}clearTestResults(){this.testResults=[]}getPerformanceSummary(){return he.getMetricsSummary()}stopAllTests(){this.isRunning=!1,this.activeTests.clear()}isTestRunning(){return this.isRunning}}const hu=new M8;class V8{constructor(){this.isInitialized=!1,this.originalFirebaseMethods=null,this.originalAuthMethods=null}initialize(){if(this.isInitialized){console.log("Performance monitoring already initialized");return}try{this.storeOriginalMethods(),he.setEnabled(!0),typeof window<"u"&&(window.performanceMonitor=he,window.databasePerformanceWrapper=If,window.authPerformanceWrapper=ul,window.stressTestService=hu,window.performanceIntegrationService=this),this.isInitialized=!0,console.log(" Performance monitoring system initialized")}catch(e){throw console.error(" Failed to initialize performance monitoring:",e),e}}storeOriginalMethods(){}getMetricsSummary(){return he.getMetricsSummary()}getRecentAlerts(e=20){return he.alerts.slice(-e)}clearAllMetrics(){he.clearMetrics(),hu.clearTestResults()}getDatabaseMetrics(){return If.getDatabaseMetrics()}getAuthMetrics(){return ul.getAuthMetrics()}getStressTestResults(e=10){return hu.getTestResults(e)}async runStressTest(e,t={}){return await hu.runStressTest(e,t)}getAlertsByType(){return he.getAlertsByType()}getSlowOperations(e="database",t=10){switch(e){case"database":return If.getSlowQueries(t);case"auth":return ul.getSlowOperations(t);default:return[]}}getRecentOperations(e="database",t=20){switch(e){case"database":return If.getRecentQueries(t);case"auth":return ul.getRecentAttempts(t);default:return[]}}getFailedOperations(e="auth",t=10){switch(e){case"auth":return ul.getFailedAttempts(t);default:return[]}}getSuccessRatesByOperation(e="auth"){switch(e){case"auth":return ul.getSuccessRateByOperation();default:return{}}}setMonitoringEnabled(e){he.setEnabled(e)}updateThresholds(e){he.updateThresholds(e)}exportPerformanceData(){return{metrics:he.exportMetrics(),stressTests:hu.getTestResults(),exportedAt:new Date().toISOString(),version:"1.0.0"}}getPerformanceHealthScore(){const e=this.getMetricsSummary();let t=100;e.database.slowQueryRate>10?t-=20:e.database.slowQueryRate>5&&(t-=10),e.authentication.successRate<90?t-=15:e.authentication.successRate<95&&(t-=5),e.offlineQueue.successRate<90&&(t-=10),e.general.averagePageLoadTime>3e3?t-=15:e.general.averagePageLoadTime>2e3&&(t-=5);const s=this.getRecentAlerts(10).filter(i=>i.severity==="error").length;return t-=s*5,Math.max(0,Math.min(100,t))}getPerformanceRecommendations(){const e=[],t=this.getMetricsSummary();return this.getPerformanceHealthScore()<70&&e.push({type:"critical",message:"Performance health is below 70%. Consider optimizing database queries and reducing load.",action:"Review slow queries and optimize database operations"}),t.database.slowQueryRate>10&&e.push({type:"warning",message:`High slow query rate: ${t.database.slowQueryRate}%. Consider adding database indexes.`,action:"Add database indexes for frequently queried fields"}),t.authentication.successRate<95&&e.push({type:"warning",message:`Low authentication success rate: ${t.authentication.successRate}%. Check for auth issues.`,action:"Review authentication flow and error handling"}),t.general.averagePageLoadTime>2e3&&e.push({type:"info",message:`Slow page load times: ${t.general.averagePageLoadTime}ms average. Consider optimizing assets.`,action:"Optimize images, reduce bundle size, and implement lazy loading"}),t.offlineQueue.failedOperations>0&&e.push({type:"info",message:`${t.offlineQueue.failedOperations} offline operations failed. Check sync reliability.`,action:"Review offline queue error handling and retry logic"}),e}startContinuousMonitoring(e=3e4){this.monitoringInterval&&clearInterval(this.monitoringInterval),this.monitoringInterval=setInterval(()=>{const t=this.getPerformanceHealthScore(),r=this.getPerformanceRecommendations();t<50?console.warn(" Critical performance issues detected:",r):t<80&&console.warn(" Performance warnings:",r)},e)}stopContinuousMonitoring(){this.monitoringInterval&&(clearInterval(this.monitoringInterval),this.monitoringInterval=null)}getSystemStatus(){return{isInitialized:this.isInitialized,isMonitoring:he.isEnabled,healthScore:this.getPerformanceHealthScore(),lastUpdate:new Date().toISOString(),recommendations:this.getPerformanceRecommendations()}}}const F8=new V8;class $8 extends cA.Component{constructor(t){super(t);qh(this,"handleRetry",()=>{this.setState(t=>({hasError:!1,error:null,errorInfo:null,errorId:null,retryCount:t.retryCount+1}))});qh(this,"handleReset",()=>{this.setState({hasError:!1,error:null,errorInfo:null,errorId:null,retryCount:0}),window.location&&(window.location.href="/")});qh(this,"handleReportBug",()=>{var r,s,i;const t={errorId:this.state.errorId,message:(r=this.state.error)==null?void 0:r.message,stack:(s=this.state.error)==null?void 0:s.stack,componentStack:(i=this.state.errorInfo)==null?void 0:i.componentStack,userAgent:navigator.userAgent,url:window.location.href,timestamp:new Date().toISOString()};navigator.clipboard.writeText(JSON.stringify(t,null,2)).then(()=>{alert("Error details copied to clipboard. Please share this with the development team.")}).catch(()=>{alert(`Error ID: ${this.state.errorId}

Please report this error to the development team.`)})});this.state={hasError:!1,error:null,errorInfo:null,errorId:null,retryCount:0}}static getDerivedStateFromError(t){return{hasError:!0,error:t,errorId:`error_${Date.now()}_${Math.random().toString(36).substr(2,9)}`}}componentDidCatch(t,r){this.setState({error:t,errorInfo:r}),this.logError(t,r)}logError(t,r){window.errorLoggingService&&window.errorLoggingService.logError("react_error_boundary",{message:t.message,stack:t.stack,componentStack:r.componentStack,errorId:this.state.errorId,retryCount:this.state.retryCount,severity:"critical"})}render(){return this.state.hasError?this.props.fallback?this.props.fallback:l.jsx("div",{className:"min-h-screen bg-gradient-to-br from-red-900 via-red-800 to-red-900 flex items-center justify-center p-4",children:l.jsxs("div",{className:"bg-white rounded-lg shadow-xl max-w-md w-full p-6 text-center",children:[l.jsx("div",{className:"flex justify-center mb-4",children:l.jsx(Gd,{className:"w-16 h-16 text-red-500"})}),l.jsx("h1",{className:"text-2xl font-bold text-gray-900 mb-2",children:"Oops! Something went wrong"}),l.jsx("p",{className:"text-gray-600 mb-6",children:"We're sorry, but something unexpected happened. Don't worry, your data is safe."}),this.state.errorId&&l.jsxs("div",{className:"bg-gray-100 rounded-lg p-3 mb-6",children:[l.jsx("p",{className:"text-sm text-gray-600 mb-1",children:"Error ID:"}),l.jsx("p",{className:"font-mono text-xs text-gray-800 break-all",children:this.state.errorId})]}),l.jsxs("div",{className:"space-y-3",children:[l.jsxs("button",{onClick:this.handleRetry,className:"w-full bg-blue-600 hover:bg-blue-700 text-white py-3 px-4 rounded-lg transition-colors flex items-center justify-center space-x-2 min-h-[44px]",children:[l.jsx(Ds,{className:"w-4 h-4"}),l.jsx("span",{children:"Try Again"})]}),l.jsxs("button",{onClick:this.handleReset,className:"w-full bg-gray-600 hover:bg-gray-700 text-white py-3 px-4 rounded-lg transition-colors flex items-center justify-center space-x-2 min-h-[44px]",children:[l.jsx(l2,{className:"w-4 h-4"}),l.jsx("span",{children:"Go to Home"})]}),l.jsxs("button",{onClick:this.handleReportBug,className:"w-full bg-orange-600 hover:bg-orange-700 text-white py-3 px-4 rounded-lg transition-colors flex items-center justify-center space-x-2 min-h-[44px]",children:[l.jsx(E8,{className:"w-4 h-4"}),l.jsx("span",{children:"Report Bug"})]})]}),this.state.retryCount>0&&l.jsxs("p",{className:"text-xs text-gray-500 mt-4",children:["Retry attempt: ",this.state.retryCount]}),!1]})}):this.props.children}}const U8=({isOpen:n,onClose:e})=>{var F,A,x,E,k,C,_,v,V,U,ce,we,z,re,W,Q,ee,pe,xe,De,Re,_t,Ce,Ae,Pe,Ee,Je,Et,ut,te,Se,ge,Oe,be,ye,at,bt,dt,Xe,st,Me,fe,je,Gt,Tt,en,fn,Ht,wn,tn,mn,cn,Qt,Gn,qe,Qe,nn;const[t,r]=D.useState("overview"),[s,i]=D.useState(null),[o,a]=D.useState(!0),[c,u]=D.useState(!0),[h,f]=D.useState(!1),m=async()=>{if(n){f(!0);try{const ae=await y();i(ae)}catch(ae){console.error(" BetaMonitoringDashboard: Error refreshing data:",ae)}finally{f(!1)}}},y=async()=>({timestamp:new Date().toISOString(),userMetrics:await w(),systemHealth:await S(),errorStats:await R(),performanceMetrics:await T(),privacyCompliance:await I(),rateLimiting:await N(),dataBackup:await P()}),w=async()=>{var Dt;if(!window.privacyProtectionService)return null;const ae=window.privacyProtectionService.getPrivacySettings(),lt=window.privacyProtectionService.getAuditLog();return{hasConsent:ae.hasConsent,privacyMode:ae.isPrivacyModeEnabled,dataRetentionDays:ae.dataRetentionDays,auditEvents:lt.length,lastConsentUpdate:(Dt=lt.find(es=>es.eventType==="consent_granted"))==null?void 0:Dt.timestamp}},S=async()=>{if(!window.gracefulDegradationService)return null;const ae=window.gracefulDegradationService.getServiceStatus();return{firebase:ae.firebase,firestore:ae.firestore,offline:ae.offline,degradationMode:ae.degradationMode,fallbackDataCount:ae.fallbackDataCount}},R=async()=>{if(!window.errorLoggingService)return null;const ae=window.errorLoggingService.getErrorQueueStatus(),lt=await window.errorLoggingService.getRecentErrors(10);return{queueLength:ae.queueLength,isOnline:ae.isOnline,errorCounts:ae.errorCounts,recentErrors:lt.slice(0,5),criticalErrors:lt.filter(Dt=>Dt.severity==="critical").length}},T=async()=>{if(!window.performanceIntegrationService)return null;const ae=window.performanceIntegrationService.getMetricsSummary(),lt=window.performanceIntegrationService.getPerformanceHealthScore(),Dt=window.performanceIntegrationService.getPerformanceRecommendations();return{healthScore:lt,database:ae.database,authentication:ae.authentication,offlineQueue:ae.offlineQueue,general:ae.general,recommendations:Dt.slice(0,3)}},I=async()=>{if(!window.privacyProtectionService)return null;const ae=window.privacyProtectionService.getPrivacySettings();return{anonymizationEnabled:ae.anonymizationEnabled,encryptionEnabled:ae.encryptionEnabled,dataRetentionCompliant:ae.dataRetentionDays<=30,consentValid:ae.hasConsent,gdprCompliant:ae.hasConsent&&ae.anonymizationEnabled}},N=async()=>{if(!window.rateLimitingService)return null;const ae=window.rateLimitingService.getRateLimitStatus(),lt=window.rateLimitingService.getSuspiciousUsers(),Dt=window.rateLimitingService.getBlockedUsers();return{isBlocked:(ae==null?void 0:ae.isBlocked)||!1,isSuspicious:(ae==null?void 0:ae.isSuspicious)||!1,suspiciousUserCount:lt.length,blockedUserCount:Dt.length,limits:(ae==null?void 0:ae.limits)||{}}},P=async()=>{if(!window.dataBackupService)return null;const ae=window.dataBackupService.getBackupStatus(),lt=await window.dataBackupService.getBackupHistory(5);return{isEnabled:ae.isEnabled,lastBackupTime:ae.lastBackupTime,backupCount:ae.backupCount,nextBackupIn:ae.nextBackupIn,recentBackups:lt}};D.useEffect(()=>{if(n&&(m(),c)){const ae=setInterval(m,3e4);return()=>clearInterval(ae)}},[n,c]);const B=async()=>{try{const lt={...await y(),exportMetadata:{exportedAt:new Date().toISOString(),version:"1.0.0",privacyMode:o}},Dt=new Blob([JSON.stringify(lt,null,2)],{type:"application/json"}),es=URL.createObjectURL(Dt),Tn=document.createElement("a");Tn.href=es,Tn.download=`beta-monitoring-${new Date().toISOString().split("T")[0]}.json`,document.body.appendChild(Tn),Tn.click(),document.body.removeChild(Tn),URL.revokeObjectURL(es)}catch(ae){console.error(" BetaMonitoringDashboard: Error exporting data:",ae),alert("Error exporting data. Please try again.")}};return n?l.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:l.jsxs("div",{className:"bg-white rounded-lg shadow-xl max-w-6xl w-full max-h-[90vh] overflow-hidden",children:[l.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-gray-200",children:[l.jsxs("div",{className:"flex items-center space-x-3",children:[l.jsx(Us,{className:"w-6 h-6 text-blue-600"}),l.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:"Beta Monitoring Dashboard"}),o&&l.jsxs("div",{className:"flex items-center space-x-1 bg-green-100 text-green-800 px-2 py-1 rounded-full text-xs",children:[l.jsx(GT,{className:"w-3 h-3"}),l.jsx("span",{children:"Privacy Mode"})]})]}),l.jsxs("div",{className:"flex items-center space-x-4",children:[l.jsxs("button",{onClick:()=>a(!o),className:`flex items-center space-x-2 px-3 py-1 rounded-md text-sm ${o?"bg-green-100 text-green-700":"bg-gray-100 text-gray-700"}`,children:[o?l.jsx(GT,{className:"w-4 h-4"}):l.jsx(R8,{className:"w-4 h-4"}),l.jsx("span",{children:o?"Privacy On":"Privacy Off"})]}),l.jsxs("button",{onClick:()=>u(!c),className:`flex items-center space-x-2 px-3 py-1 rounded-md text-sm ${c?"bg-blue-100 text-blue-700":"bg-gray-100 text-gray-700"}`,children:[l.jsx(Ds,{className:`w-4 h-4 ${c?"animate-spin":""}`}),l.jsx("span",{children:"Auto Refresh"})]}),l.jsxs("button",{onClick:e,className:"text-gray-400 hover:text-gray-600 transition-colors",children:[l.jsx("span",{className:"sr-only",children:"Close"}),l.jsx("svg",{className:"w-6 h-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:l.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})]})]})]}),l.jsx("div",{className:"flex border-b border-gray-200",children:[{id:"overview",label:"Overview",icon:pp},{id:"users",label:"Users",icon:lS},{id:"system",label:"System",icon:mp},{id:"errors",label:"Errors",icon:Gd},{id:"privacy",label:"Privacy",icon:Us},{id:"performance",label:"Performance",icon:gp}].map(ae=>{const lt=ae.icon;return l.jsxs("button",{onClick:()=>r(ae.id),className:`flex items-center space-x-2 px-6 py-3 text-sm font-medium border-b-2 transition-colors ${t===ae.id?"border-blue-500 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700"}`,children:[l.jsx(lt,{className:"w-4 h-4"}),l.jsx("span",{children:ae.label})]},ae.id)})}),l.jsxs("div",{className:"p-6 overflow-y-auto max-h-[calc(90vh-200px)]",children:[h&&l.jsxs("div",{className:"flex items-center justify-center py-8",children:[l.jsx(Ds,{className:"w-6 h-6 animate-spin text-blue-600"}),l.jsx("span",{className:"ml-2 text-gray-600",children:"Loading monitoring data..."})]}),!h&&s&&l.jsxs(l.Fragment,{children:[t==="overview"&&l.jsxs("div",{className:"space-y-6",children:[l.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[l.jsx("div",{className:"bg-blue-50 p-4 rounded-lg",children:l.jsxs("div",{className:"flex items-center justify-between",children:[l.jsxs("div",{children:[l.jsx("p",{className:"text-sm font-medium text-blue-600",children:"System Health"}),l.jsxs("p",{className:"text-2xl font-bold text-blue-900",children:[((F=s.performanceMetrics)==null?void 0:F.healthScore)||0,"%"]})]}),l.jsx(mp,{className:"w-8 h-8 text-blue-500"})]})}),l.jsx("div",{className:"bg-green-50 p-4 rounded-lg",children:l.jsxs("div",{className:"flex items-center justify-between",children:[l.jsxs("div",{children:[l.jsx("p",{className:"text-sm font-medium text-green-600",children:"Privacy Compliance"}),l.jsx("p",{className:"text-2xl font-bold text-green-900",children:(A=s.privacyCompliance)!=null&&A.gdprCompliant?"100%":"0%"})]}),l.jsx(Us,{className:"w-8 h-8 text-green-500"})]})}),l.jsx("div",{className:"bg-orange-50 p-4 rounded-lg",children:l.jsxs("div",{className:"flex items-center justify-between",children:[l.jsxs("div",{children:[l.jsx("p",{className:"text-sm font-medium text-orange-600",children:"Error Rate"}),l.jsx("p",{className:"text-2xl font-bold text-orange-900",children:((x=s.errorStats)==null?void 0:x.criticalErrors)||0})]}),l.jsx(Gd,{className:"w-8 h-8 text-orange-500"})]})}),l.jsx("div",{className:"bg-purple-50 p-4 rounded-lg",children:l.jsxs("div",{className:"flex items-center justify-between",children:[l.jsxs("div",{children:[l.jsx("p",{className:"text-sm font-medium text-purple-600",children:"Backup Status"}),l.jsx("p",{className:"text-2xl font-bold text-purple-900",children:(E=s.dataBackup)!=null&&E.isEnabled?"Active":"Inactive"})]}),l.jsx(gp,{className:"w-8 h-8 text-purple-500"})]})})]}),l.jsxs("div",{className:"bg-gray-50 p-6 rounded-lg",children:[l.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Quick Actions"}),l.jsxs("div",{className:"flex flex-wrap gap-3",children:[l.jsxs("button",{onClick:m,className:"flex items-center space-x-2 px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700",children:[l.jsx(Ds,{className:"w-4 h-4"}),l.jsx("span",{children:"Refresh Data"})]}),l.jsxs("button",{onClick:B,className:"flex items-center space-x-2 px-4 py-2 bg-green-600 text-white rounded-md hover:bg-green-700",children:[l.jsx(T8,{className:"w-4 h-4"}),l.jsx("span",{children:"Export Data"})]})]})]})]}),t==="users"&&l.jsxs("div",{className:"space-y-4",children:[l.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"User Metrics"}),l.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[l.jsxs("div",{className:"bg-white p-4 rounded-lg border border-gray-200",children:[l.jsx("h4",{className:"font-medium text-gray-900 mb-3",children:"Privacy Status"}),l.jsxs("div",{className:"space-y-2",children:[l.jsxs("div",{className:"flex justify-between",children:[l.jsx("span",{className:"text-sm text-gray-600",children:"Consent Given:"}),l.jsx("span",{className:`font-medium ${(k=s.userMetrics)!=null&&k.hasConsent?"text-green-600":"text-red-600"}`,children:(C=s.userMetrics)!=null&&C.hasConsent?"Yes":"No"})]}),l.jsxs("div",{className:"flex justify-between",children:[l.jsx("span",{className:"text-sm text-gray-600",children:"Privacy Mode:"}),l.jsx("span",{className:`font-medium ${(_=s.userMetrics)!=null&&_.privacyMode?"text-green-600":"text-red-600"}`,children:(v=s.userMetrics)!=null&&v.privacyMode?"Enabled":"Disabled"})]}),l.jsxs("div",{className:"flex justify-between",children:[l.jsx("span",{className:"text-sm text-gray-600",children:"Data Retention:"}),l.jsxs("span",{className:"font-medium",children:[((V=s.userMetrics)==null?void 0:V.dataRetentionDays)||0," days"]})]})]})]}),l.jsxs("div",{className:"bg-white p-4 rounded-lg border border-gray-200",children:[l.jsx("h4",{className:"font-medium text-gray-900 mb-3",children:"Rate Limiting"}),l.jsxs("div",{className:"space-y-2",children:[l.jsxs("div",{className:"flex justify-between",children:[l.jsx("span",{className:"text-sm text-gray-600",children:"User Blocked:"}),l.jsx("span",{className:`font-medium ${(U=s.rateLimiting)!=null&&U.isBlocked?"text-red-600":"text-green-600"}`,children:(ce=s.rateLimiting)!=null&&ce.isBlocked?"Yes":"No"})]}),l.jsxs("div",{className:"flex justify-between",children:[l.jsx("span",{className:"text-sm text-gray-600",children:"Suspicious Activity:"}),l.jsx("span",{className:`font-medium ${(we=s.rateLimiting)!=null&&we.isSuspicious?"text-orange-600":"text-green-600"}`,children:(z=s.rateLimiting)!=null&&z.isSuspicious?"Yes":"No"})]}),l.jsxs("div",{className:"flex justify-between",children:[l.jsx("span",{className:"text-sm text-gray-600",children:"Suspicious Users:"}),l.jsx("span",{className:"font-medium",children:((re=s.rateLimiting)==null?void 0:re.suspiciousUserCount)||0})]})]})]})]})]}),t==="system"&&l.jsxs("div",{className:"space-y-4",children:[l.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"System Health"}),l.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[l.jsxs("div",{className:"bg-white p-4 rounded-lg border border-gray-200",children:[l.jsx("h4",{className:"font-medium text-gray-900 mb-3",children:"Service Status"}),l.jsxs("div",{className:"space-y-2",children:[l.jsxs("div",{className:"flex justify-between",children:[l.jsx("span",{className:"text-sm text-gray-600",children:"Firebase:"}),l.jsx("span",{className:`font-medium ${((W=s.systemHealth)==null?void 0:W.firebase)==="healthy"?"text-green-600":"text-red-600"}`,children:((Q=s.systemHealth)==null?void 0:Q.firebase)||"Unknown"})]}),l.jsxs("div",{className:"flex justify-between",children:[l.jsx("span",{className:"text-sm text-gray-600",children:"Firestore:"}),l.jsx("span",{className:`font-medium ${((ee=s.systemHealth)==null?void 0:ee.firestore)==="healthy"?"text-green-600":"text-red-600"}`,children:((pe=s.systemHealth)==null?void 0:pe.firestore)||"Unknown"})]}),l.jsxs("div",{className:"flex justify-between",children:[l.jsx("span",{className:"text-sm text-gray-600",children:"Offline Mode:"}),l.jsx("span",{className:`font-medium ${(xe=s.systemHealth)!=null&&xe.offline?"text-orange-600":"text-green-600"}`,children:(De=s.systemHealth)!=null&&De.offline?"Yes":"No"})]}),l.jsxs("div",{className:"flex justify-between",children:[l.jsx("span",{className:"text-sm text-gray-600",children:"Degradation Mode:"}),l.jsx("span",{className:`font-medium ${(Re=s.systemHealth)!=null&&Re.degradationMode?"text-orange-600":"text-green-600"}`,children:(_t=s.systemHealth)!=null&&_t.degradationMode?"Active":"Inactive"})]})]})]}),l.jsxs("div",{className:"bg-white p-4 rounded-lg border border-gray-200",children:[l.jsx("h4",{className:"font-medium text-gray-900 mb-3",children:"Data Backup"}),l.jsxs("div",{className:"space-y-2",children:[l.jsxs("div",{className:"flex justify-between",children:[l.jsx("span",{className:"text-sm text-gray-600",children:"Backup Enabled:"}),l.jsx("span",{className:`font-medium ${(Ce=s.dataBackup)!=null&&Ce.isEnabled?"text-green-600":"text-red-600"}`,children:(Ae=s.dataBackup)!=null&&Ae.isEnabled?"Yes":"No"})]}),l.jsxs("div",{className:"flex justify-between",children:[l.jsx("span",{className:"text-sm text-gray-600",children:"Backup Count:"}),l.jsx("span",{className:"font-medium",children:((Pe=s.dataBackup)==null?void 0:Pe.backupCount)||0})]}),l.jsxs("div",{className:"flex justify-between",children:[l.jsx("span",{className:"text-sm text-gray-600",children:"Last Backup:"}),l.jsx("span",{className:"font-medium text-xs",children:(Ee=s.dataBackup)!=null&&Ee.lastBackupTime?new Date(s.dataBackup.lastBackupTime).toLocaleString():"Never"})]})]})]})]})]}),t==="errors"&&l.jsxs("div",{className:"space-y-4",children:[l.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Error Statistics"}),l.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[l.jsxs("div",{className:"bg-white p-4 rounded-lg border border-gray-200",children:[l.jsx("h4",{className:"font-medium text-gray-900 mb-3",children:"Error Queue"}),l.jsxs("div",{className:"space-y-2",children:[l.jsxs("div",{className:"flex justify-between",children:[l.jsx("span",{className:"text-sm text-gray-600",children:"Queue Length:"}),l.jsx("span",{className:"font-medium",children:((Je=s.errorStats)==null?void 0:Je.queueLength)||0})]}),l.jsxs("div",{className:"flex justify-between",children:[l.jsx("span",{className:"text-sm text-gray-600",children:"Online Status:"}),l.jsx("span",{className:`font-medium ${(Et=s.errorStats)!=null&&Et.isOnline?"text-green-600":"text-red-600"}`,children:(ut=s.errorStats)!=null&&ut.isOnline?"Online":"Offline"})]}),l.jsxs("div",{className:"flex justify-between",children:[l.jsx("span",{className:"text-sm text-gray-600",children:"Critical Errors:"}),l.jsx("span",{className:"font-medium text-red-600",children:((te=s.errorStats)==null?void 0:te.criticalErrors)||0})]})]})]}),l.jsxs("div",{className:"bg-white p-4 rounded-lg border border-gray-200",children:[l.jsx("h4",{className:"font-medium text-gray-900 mb-3",children:"Recent Errors"}),l.jsx("div",{className:"space-y-2 max-h-40 overflow-y-auto",children:((ge=(Se=s.errorStats)==null?void 0:Se.recentErrors)==null?void 0:ge.length)>0?s.errorStats.recentErrors.map((ae,lt)=>l.jsxs("div",{className:"text-xs p-2 bg-gray-50 rounded",children:[l.jsx("div",{className:"font-medium",children:ae.type}),l.jsx("div",{className:"text-gray-600",children:ae.message}),l.jsx("div",{className:"text-gray-500",children:new Date(ae.timestamp).toLocaleString()})]},lt)):l.jsx("div",{className:"text-gray-500 text-sm",children:"No recent errors"})})]})]})]}),t==="privacy"&&l.jsxs("div",{className:"space-y-4",children:[l.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Privacy Compliance"}),l.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[l.jsxs("div",{className:"bg-white p-4 rounded-lg border border-gray-200",children:[l.jsx("h4",{className:"font-medium text-gray-900 mb-3",children:"Privacy Settings"}),l.jsxs("div",{className:"space-y-2",children:[l.jsxs("div",{className:"flex justify-between",children:[l.jsx("span",{className:"text-sm text-gray-600",children:"Anonymization:"}),l.jsx("span",{className:`font-medium ${(Oe=s.privacyCompliance)!=null&&Oe.anonymizationEnabled?"text-green-600":"text-red-600"}`,children:(be=s.privacyCompliance)!=null&&be.anonymizationEnabled?"Enabled":"Disabled"})]}),l.jsxs("div",{className:"flex justify-between",children:[l.jsx("span",{className:"text-sm text-gray-600",children:"Encryption:"}),l.jsx("span",{className:`font-medium ${(ye=s.privacyCompliance)!=null&&ye.encryptionEnabled?"text-green-600":"text-red-600"}`,children:(at=s.privacyCompliance)!=null&&at.encryptionEnabled?"Enabled":"Disabled"})]}),l.jsxs("div",{className:"flex justify-between",children:[l.jsx("span",{className:"text-sm text-gray-600",children:"Data Retention:"}),l.jsx("span",{className:`font-medium ${(bt=s.privacyCompliance)!=null&&bt.dataRetentionCompliant?"text-green-600":"text-red-600"}`,children:(dt=s.privacyCompliance)!=null&&dt.dataRetentionCompliant?"Compliant":"Non-compliant"})]}),l.jsxs("div",{className:"flex justify-between",children:[l.jsx("span",{className:"text-sm text-gray-600",children:"GDPR Compliant:"}),l.jsx("span",{className:`font-medium ${(Xe=s.privacyCompliance)!=null&&Xe.gdprCompliant?"text-green-600":"text-red-600"}`,children:(st=s.privacyCompliance)!=null&&st.gdprCompliant?"Yes":"No"})]})]})]}),l.jsxs("div",{className:"bg-white p-4 rounded-lg border border-gray-200",children:[l.jsx("h4",{className:"font-medium text-gray-900 mb-3",children:"User Consent"}),l.jsxs("div",{className:"space-y-2",children:[l.jsxs("div",{className:"flex justify-between",children:[l.jsx("span",{className:"text-sm text-gray-600",children:"Consent Valid:"}),l.jsx("span",{className:`font-medium ${(Me=s.privacyCompliance)!=null&&Me.consentValid?"text-green-600":"text-red-600"}`,children:(fe=s.privacyCompliance)!=null&&fe.consentValid?"Yes":"No"})]}),l.jsxs("div",{className:"flex justify-between",children:[l.jsx("span",{className:"text-sm text-gray-600",children:"Audit Events:"}),l.jsx("span",{className:"font-medium",children:((je=s.userMetrics)==null?void 0:je.auditEvents)||0})]})]})]})]})]}),t==="performance"&&l.jsxs("div",{className:"space-y-4",children:[l.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Performance Metrics"}),l.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[l.jsxs("div",{className:"bg-white p-4 rounded-lg border border-gray-200",children:[l.jsx("h4",{className:"font-medium text-gray-900 mb-3",children:"Database Performance"}),l.jsxs("div",{className:"space-y-2",children:[l.jsxs("div",{className:"flex justify-between",children:[l.jsx("span",{className:"text-sm text-gray-600",children:"Total Queries:"}),l.jsx("span",{className:"font-medium",children:((Tt=(Gt=s.performanceMetrics)==null?void 0:Gt.database)==null?void 0:Tt.totalQueries)||0})]}),l.jsxs("div",{className:"flex justify-between",children:[l.jsx("span",{className:"text-sm text-gray-600",children:"Average Time:"}),l.jsxs("span",{className:"font-medium",children:[((fn=(en=s.performanceMetrics)==null?void 0:en.database)==null?void 0:fn.averageQueryTime)||0,"ms"]})]}),l.jsxs("div",{className:"flex justify-between",children:[l.jsx("span",{className:"text-sm text-gray-600",children:"Slow Queries:"}),l.jsx("span",{className:"font-medium text-orange-600",children:((wn=(Ht=s.performanceMetrics)==null?void 0:Ht.database)==null?void 0:wn.slowQueries)||0})]})]})]}),l.jsxs("div",{className:"bg-white p-4 rounded-lg border border-gray-200",children:[l.jsx("h4",{className:"font-medium text-gray-900 mb-3",children:"Authentication Performance"}),l.jsxs("div",{className:"space-y-2",children:[l.jsxs("div",{className:"flex justify-between",children:[l.jsx("span",{className:"text-sm text-gray-600",children:"Total Attempts:"}),l.jsx("span",{className:"font-medium",children:((mn=(tn=s.performanceMetrics)==null?void 0:tn.authentication)==null?void 0:mn.totalAttempts)||0})]}),l.jsxs("div",{className:"flex justify-between",children:[l.jsx("span",{className:"text-sm text-gray-600",children:"Success Rate:"}),l.jsxs("span",{className:"font-medium text-green-600",children:[((Qt=(cn=s.performanceMetrics)==null?void 0:cn.authentication)==null?void 0:Qt.successRate)||0,"%"]})]}),l.jsxs("div",{className:"flex justify-between",children:[l.jsx("span",{className:"text-sm text-gray-600",children:"Average Time:"}),l.jsxs("span",{className:"font-medium",children:[((qe=(Gn=s.performanceMetrics)==null?void 0:Gn.authentication)==null?void 0:qe.averageLoginTime)||0,"ms"]})]})]})]})]}),((nn=(Qe=s.performanceMetrics)==null?void 0:Qe.recommendations)==null?void 0:nn.length)>0&&l.jsxs("div",{className:"bg-white p-4 rounded-lg border border-gray-200",children:[l.jsx("h4",{className:"font-medium text-gray-900 mb-3",children:"Performance Recommendations"}),l.jsx("div",{className:"space-y-2",children:s.performanceMetrics.recommendations.map((ae,lt)=>l.jsxs("div",{className:`p-3 rounded-lg ${ae.type==="critical"?"bg-red-50 border border-red-200":ae.type==="warning"?"bg-yellow-50 border border-yellow-200":"bg-blue-50 border border-blue-200"}`,children:[l.jsx("div",{className:"font-medium text-sm",children:ae.message}),l.jsx("div",{className:"text-xs text-gray-600 mt-1",children:ae.action})]},lt))})]})]})]})]})]})}):null};class B8{constructor(){this.backupInterval=null,this.isBackupEnabled=!0,this.maxBackupRetries=3,this.backupRetryDelay=5e3,this.lastBackupTime=null,this.backupHistory=[]}initialize(e){if(!e){console.error(" DataBackupService: User ID required for initialization");return}this.userId=e,this.startAutomaticBackups(),console.log(" DataBackupService: Initialized for user",e)}startAutomaticBackups(){this.backupInterval&&clearInterval(this.backupInterval),this.backupInterval=setInterval(()=>{this.performBackup("scheduled")},30*60*1e3),this.performBackup("initial")}stopAutomaticBackups(){this.backupInterval&&(clearInterval(this.backupInterval),this.backupInterval=null)}async performBackup(e="manual"){if(!this.userId)return console.error(" DataBackupService: User ID not set"),!1;const t=`backup_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,r=Date.now();try{console.log(` DataBackupService: Starting backup ${t} (trigger: ${e})`);const s=await this.collectUserData(),i={id:t,userId:this.userId,timestamp:new Date().toISOString(),trigger:e,dataSize:JSON.stringify(s).length,version:"1.0.0",status:"in_progress"};return await this.storeBackup(i,s),i.status="completed",i.duration=Date.now()-r,await this.updateBackupStatus(i),this.backupHistory.push(i),this.lastBackupTime=new Date,console.log(` DataBackupService: Backup ${t} completed in ${i.duration}ms`),!0}catch(s){console.error(` DataBackupService: Backup ${t} failed:`,s);const i={id:t,userId:this.userId,timestamp:new Date().toISOString(),trigger:e,status:"failed",error:s.message,duration:Date.now()-r};return this.backupHistory.push(i),!1}}async collectUserData(){if(!this.userId)throw new Error("User ID not set - cannot collect user data");const e={profile:null,stats:null,behavioralData:[],settings:null,backupMetadata:{collectedAt:new Date().toISOString(),version:"1.0.0"}};try{const t=K(H,`users/${this.userId}/profile`),r=await ve(t);r.exists()&&(e.profile=r.val());const s=K(H,`users/${this.userId}/stats`),i=await ve(s);i.exists()&&(e.stats=i.val());try{const c=Ki(Cn(Kr,"behavioral_cravings"),ni("userId","==",this.userId),op("timestamp","desc"),V$(100)),u=await wc(c);e.behavioralData=u.docs.map(h=>({id:h.id,...h.data()}))}catch(c){console.warn(" DataBackupService: Could not collect behavioral data from Firestore:",c.message),e.behavioralData=[]}const o=K(H,`users/${this.userId}/settings`),a=await ve(o);return a.exists()&&(e.settings=a.val()),e}catch(t){throw console.error(" DataBackupService: Error collecting user data:",t),t}}async storeBackup(e,t){try{const r=K(H,`backups/${this.userId}/${e.id}`);await Te(r,e);const s={...t,userId:this.userId,timestamp:new Date,backupId:e.id},i=K(H,`backup_data/${this.userId}/${e.id}`);await Te(i,s);try{await Ur(Cn(Kr,"backup_data"),s),console.log(` DataBackupService: Backup data stored in both databases for ${e.id}`)}catch(o){console.warn(" DataBackupService: Could not store backup in Firestore:",o.message),console.log(` DataBackupService: Backup data stored in Realtime Database for ${e.id}`)}}catch(r){throw console.error(" DataBackupService: Error storing backup:",r),r}}async updateBackupStatus(e){try{const t=K(H,`backups/${this.userId}/${e.id}`);await Te(t,e)}catch(t){console.error(" DataBackupService: Error updating backup status:",t)}}async restoreFromBackup(e){if(!this.userId)throw new Error("User ID not set");try{console.log(` DataBackupService: Restoring from backup ${e}`);const t=K(H,`backup_data/${this.userId}/${e}`),r=await ve(t);if(!r.exists())throw new Error("Backup data not found");const s=r.val();if(s.profile){const i=K(H,`users/${this.userId}/profile`);await Te(i,s.profile)}if(s.stats){const i=K(H,`users/${this.userId}/stats`);await Te(i,s.stats)}if(s.settings){const i=K(H,`users/${this.userId}/settings`);await Te(i,s.settings)}return console.log(` DataBackupService: Successfully restored from backup ${e}`),!0}catch(t){throw console.error(` DataBackupService: Error restoring from backup ${e}:`,t),t}}async getBackupHistory(e=10){if(!this.userId)return[];try{const t=K(H,`backups/${this.userId}`),r=await ve(t);return r.exists()?Object.values(r.val()).sort((i,o)=>new Date(o.timestamp)-new Date(i.timestamp)).slice(0,e):[]}catch(t){return console.error(" DataBackupService: Error getting backup history:",t),[]}}async cleanupOldBackups(){if(this.userId)try{const e=await this.getBackupHistory(50);if(e.length>10){const t=e.slice(10);for(const r of t){const s=K(H,`backups/${this.userId}/${r.id}`);await Te(s,null);const i=K(H,`backup_data/${this.userId}/${r.id}`);await Te(i,null)}console.log(` DataBackupService: Cleaned up ${t.length} old backups`)}}catch(e){console.error(" DataBackupService: Error cleaning up old backups:",e)}}getBackupStatus(){return{isEnabled:this.isBackupEnabled,lastBackupTime:this.lastBackupTime,backupCount:this.backupHistory.length,nextBackupIn:this.backupInterval?"30 minutes":"disabled"}}setBackupEnabled(e){this.isBackupEnabled=e,e&&this.userId?this.startAutomaticBackups():this.stopAutomaticBackups()}async exportBackupData(e){if(!this.userId)throw new Error("User ID not set");try{const t=K(H,`backup_data/${this.userId}/${e}`),r=await ve(t);if(!r.exists())throw new Error("Backup data not found");return{...r.val(),exportMetadata:{exportedAt:new Date().toISOString(),backupId:e,userId:this.userId,version:"1.0.0"}}}catch(t){throw console.error(" DataBackupService: Error exporting backup data:",t),t}}}const HT=new B8;class z8{constructor(){this.isPrivacyModeEnabled=!0,this.dataRetentionDays=30,this.anonymizationEnabled=!0,this.consentRequired=!0,this.encryptionEnabled=!0,this.auditLog=[]}initialize(e){this.userId=e,this.setupPrivacyControls(),console.log(" PrivacyProtectionService: Initialized for user",e)}setupPrivacyControls(){this.getUserConsent()||this.requestConsent(),this.setupDataRetentionTimer(),this.setupAnonymization()}getUserConsent(){const e=localStorage.getItem(`privacy_consent_${this.userId}`);return e?JSON.parse(e):null}requestConsent(){const e={dataCollection:!0,analytics:!0,behavioralTracking:!0,dataRetention:this.dataRetentionDays,anonymization:this.anonymizationEnabled,timestamp:new Date().toISOString(),version:"1.0.0"};return localStorage.setItem(`privacy_consent_request_${this.userId}`,JSON.stringify(e)),this.logPrivacyEvent("consent_requested",{userId:this.anonymizeUserId(this.userId),timestamp:new Date().toISOString()}),e}recordConsent(e){const t={...e,grantedAt:new Date().toISOString(),userId:this.userId};localStorage.setItem(`privacy_consent_${this.userId}`,JSON.stringify(t)),this.logPrivacyEvent("consent_granted",{userId:this.anonymizeUserId(this.userId),dataCollection:t.dataCollection,analytics:t.analytics,behavioralTracking:t.behavioralTracking}),console.log(" PrivacyProtectionService: User consent recorded")}anonymizeUserId(e){if(!this.anonymizationEnabled)return e;let t=0;for(let r=0;r<e.length;r++){const s=e.charCodeAt(r);t=(t<<5)-t+s,t=t&t}return`user_${Math.abs(t).toString(36)}`}anonymizeData(e,t=[]){if(!this.anonymizationEnabled)return e;const r={...e};return[...["email","name","phone","address"],...t].forEach(o=>{r[o]&&(r[o]=this.anonymizeString(r[o]))}),r}anonymizeString(e){return!e||typeof e!="string"?e:e.length<=3?"*".repeat(e.length):e.charAt(0)+"*".repeat(e.length-2)+e.charAt(e.length-1)}encryptData(e){if(!this.encryptionEnabled)return e;try{return{encrypted:!0,data:btoa(JSON.stringify(e)),timestamp:new Date().toISOString()}}catch(t){return console.error(" PrivacyProtectionService: Encryption failed:",t),e}}decryptData(e){if(!e.encrypted)return e;try{return JSON.parse(atob(e.data))}catch(t){return console.error(" PrivacyProtectionService: Decryption failed:",t),e}}sanitizeData(e){const t={...e};return["password","ssn","creditCard","bankAccount"].forEach(s=>{delete t[s]}),this.anonymizationEnabled?this.anonymizeData(t):t}setupDataRetentionTimer(){setInterval(()=>{this.cleanupExpiredData()},60*60*1e3)}async cleanupExpiredData(){try{const e=new Date;e.setDate(e.getDate()-this.dataRetentionDays),this.cleanupLocalStorage(e),this.logPrivacyEvent("data_cleanup",{userId:this.anonymizeUserId(this.userId),cutoffDate:e.toISOString(),retentionDays:this.dataRetentionDays}),console.log(" PrivacyProtectionService: Expired data cleaned up")}catch(e){console.error(" PrivacyProtectionService: Error cleaning up expired data:",e)}}cleanupLocalStorage(e){["offline_userData","offline_profileData","offline_cachedStats","behavioral_logs","session_data"].forEach(r=>{try{const s=localStorage.getItem(r);if(s){const i=JSON.parse(s);i.timestamp&&new Date(i.timestamp)<e&&(localStorage.removeItem(r),console.log(` PrivacyProtectionService: Cleaned up expired ${r}`))}}catch(s){console.warn(` PrivacyProtectionService: Error cleaning up ${r}:`,s)}})}setupAnonymization(){const e=console.log;console.log=(...t)=>{const r=t.map(s=>typeof s=="object"&&s!==null?this.anonymizeData(s):s);e.apply(console,r)}}logPrivacyEvent(e,t){const r={id:Date.now().toString(),eventType:e,data:this.anonymizeData(t),timestamp:new Date().toISOString(),userId:this.anonymizeUserId(this.userId)};this.auditLog.push(r),this.auditLog.length>100&&(this.auditLog=this.auditLog.slice(-100)),localStorage.setItem(`privacy_audit_${this.userId}`,JSON.stringify(this.auditLog))}getAuditLog(){return this.auditLog}async exportUserData(){if(!this.userId)throw new Error("User ID not set");try{return{profile:this.getStoredData("profile"),stats:this.getStoredData("stats"),behavioralData:this.getStoredData("behavioralData"),settings:this.getStoredData("settings"),auditLog:this.auditLog,exportMetadata:{exportedAt:new Date().toISOString(),userId:this.anonymizeUserId(this.userId),version:"1.0.0",dataRetentionDays:this.dataRetentionDays}}}catch(e){throw console.error(" PrivacyProtectionService: Error exporting user data:",e),e}}getStoredData(e){try{const t=localStorage.getItem(`offline_${e}`);return t?JSON.parse(t):null}catch(t){return console.warn(` PrivacyProtectionService: Error getting ${e}:`,t),null}}async deleteAllUserData(){if(!this.userId)throw new Error("User ID not set");try{return[`privacy_consent_${this.userId}`,`privacy_consent_request_${this.userId}`,`privacy_audit_${this.userId}`,"offline_userData","offline_profileData","offline_cachedStats","behavioral_logs","session_data"].forEach(t=>{localStorage.removeItem(t)}),this.logPrivacyEvent("data_deletion",{userId:this.anonymizeUserId(this.userId),deletedAt:new Date().toISOString()}),console.log(" PrivacyProtectionService: All user data deleted"),!0}catch(e){throw console.error(" PrivacyProtectionService: Error deleting user data:",e),e}}getPrivacySettings(){return{isPrivacyModeEnabled:this.isPrivacyModeEnabled,dataRetentionDays:this.dataRetentionDays,anonymizationEnabled:this.anonymizationEnabled,consentRequired:this.consentRequired,encryptionEnabled:this.encryptionEnabled,hasConsent:!!this.getUserConsent()}}updatePrivacySettings(e){e.dataRetentionDays&&(this.dataRetentionDays=e.dataRetentionDays),typeof e.anonymizationEnabled=="boolean"&&(this.anonymizationEnabled=e.anonymizationEnabled),typeof e.encryptionEnabled=="boolean"&&(this.encryptionEnabled=e.encryptionEnabled),this.logPrivacyEvent("settings_updated",{userId:this.anonymizeUserId(this.userId),settings:this.anonymizeData(e)})}isDataCollectionAllowed(){const e=this.getUserConsent();return e&&e.dataCollection}isAnalyticsAllowed(){const e=this.getUserConsent();return e&&e.analytics}isBehavioralTrackingAllowed(){const e=this.getUserConsent();return e&&e.behavioralTracking}}const QT=new z8;class q8{constructor(){this.errorQueue=[],this.isOnline=navigator.onLine,this.maxRetries=3,this.retryDelay=5e3,this.errorThresholds={critical:5,warning:20,info:100},this.errorCounts={critical:0,warning:0,info:0,lastReset:Date.now()},this.setupErrorHandlers()}initialize(e){this.userId=e,this.setupNetworkListeners(),this.startErrorProcessing(),console.log(" ErrorLoggingService: Initialized for user",e)}setupErrorHandlers(){window.addEventListener("error",e=>{var t;this.logError("javascript_error",{message:e.message,filename:e.filename,lineno:e.lineno,colno:e.colno,stack:(t=e.error)==null?void 0:t.stack,severity:"critical"})}),window.addEventListener("unhandledrejection",e=>{var t,r;this.logError("unhandled_promise_rejection",{reason:(t=e.reason)==null?void 0:t.toString(),stack:(r=e.reason)==null?void 0:r.stack,severity:"critical"})})}setupNetworkListeners(){window.addEventListener("online",()=>{this.isOnline=!0,this.processErrorQueue()}),window.addEventListener("offline",()=>{this.isOnline=!1})}startErrorProcessing(){setInterval(()=>{this.processErrorQueue()},3e4),setInterval(()=>{this.resetErrorCounts()},60*60*1e3)}logError(e,t){const r={id:this.generateErrorId(),type:e,userId:this.userId,timestamp:new Date().toISOString(),severity:t.severity||"info",data:this.sanitizeErrorData(t),userAgent:navigator.userAgent,url:window.location.href,sessionId:this.getSessionId(),version:"1.0.0"};this.shouldLogError(r)&&(this.errorQueue.push(r),this.isOnline&&this.processErrorQueue())}generateErrorId(){return`error_${Date.now()}_${Math.random().toString(36).substr(2,9)}`}sanitizeErrorData(e){const t={...e};return["password","token","key","secret","ssn","email"].forEach(s=>{t[s]&&(t[s]="[REDACTED]")}),Object.keys(t).forEach(s=>{typeof t[s]=="string"&&t[s].length>1e3&&(t[s]=t[s].substring(0,1e3)+"...[TRUNCATED]")}),t}shouldLogError(e){const t=e.severity,r=this.errorThresholds[t];return r?(Date.now()-this.errorCounts.lastReset>60*60*1e3&&this.resetErrorCounts(),this.errorCounts[t]<r):!0}resetErrorCounts(){this.errorCounts={critical:0,warning:0,info:0,lastReset:Date.now()}}async processErrorQueue(){if(!this.isOnline||this.errorQueue.length===0)return;const e=[...this.errorQueue];this.errorQueue=[];for(const t of e)try{await this.sendErrorToServer(t),this.errorCounts[t.severity]++}catch(r){console.error(" ErrorLoggingService: Failed to send error to server:",r),this.errorQueue.push(t)}}async sendErrorToServer(e){try{if(!this.userId){console.log(" ErrorLoggingService: Skipping error log - no user ID");return}const t={...e,userId:this.userId,timestamp:e.timestamp||new Date,type:e.type||"unknown_error",severity:e.severity||"info"},r=K(H,`error_logs/${this.userId}/${e.id}`);await Te(r,t);try{await Ur(Cn(Kr,"error_logs"),t),console.log(` ErrorLoggingService: Error ${e.id} sent to both databases`)}catch(s){console.warn(" ErrorLoggingService: Could not store error in Firestore:",s.message),console.log(` ErrorLoggingService: Error ${e.id} sent to Realtime Database`)}}catch(t){throw console.error(" ErrorLoggingService: Error sending to server:",t),t}}getSessionId(){let e=sessionStorage.getItem("session_id");return e||(e=`session_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,sessionStorage.setItem("session_id",e)),e}logCustomError(e,t,r="info",s={}){this.logError(e,{message:t,severity:r,...s})}logApiError(e,t,r,s,i={}){this.logError("api_error",{endpoint:e,method:t,status:r,response:this.sanitizeErrorData(s),requestData:this.sanitizeErrorData(i),severity:r>=500?"critical":r>=400?"warning":"info"})}logAuthError(e,t,r={}){this.logError("auth_error",{errorType:e,message:t,severity:"critical",...r})}logDatabaseError(e,t,r={}){this.logError("database_error",{operation:e,message:t.message,code:t.code,queryData:this.sanitizeErrorData(r),severity:"critical"})}logPerformanceError(e,t,r,s={}){this.logError("performance_error",{operation:e,duration:t,threshold:r,severity:"warning",...s})}async getErrorStatistics(e=24){try{const t=new Date;t.setHours(t.getHours()-e);const r=Ki(Cn(Kr,"error_logs"),ni("userId","==",this.userId),ni("timestamp",">=",t.toISOString()),op("timestamp","desc")),i=(await wc(r)).docs.map(a=>a.data()),o={total:i.length,bySeverity:{critical:i.filter(a=>a.severity==="critical").length,warning:i.filter(a=>a.severity==="warning").length,info:i.filter(a=>a.severity==="info").length},byType:{},recentErrors:i.slice(0,10),timeRange:`${e} hours`};return i.forEach(a=>{o.byType[a.type]=(o.byType[a.type]||0)+1}),o}catch(t){return console.error(" ErrorLoggingService: Error getting statistics:",t),null}}async getRecentErrors(e=20){try{const t=Ki(Cn(Kr,"error_logs"),ni("userId","==",this.userId),op("timestamp","desc"),e(e));return(await wc(t)).docs.map(s=>s.data())}catch(t){return console.error(" ErrorLoggingService: Error getting recent errors:",t),[]}}async clearOldErrors(e=7){try{const t=new Date;t.setDate(t.getDate()-e),console.log(` ErrorLoggingService: Would clear errors older than ${e} days`)}catch(t){console.error(" ErrorLoggingService: Error clearing old errors:",t)}}getErrorQueueStatus(){return{queueLength:this.errorQueue.length,isOnline:this.isOnline,errorCounts:this.errorCounts,thresholds:this.errorThresholds}}setErrorThresholds(e){this.errorThresholds={...this.errorThresholds,...e}}async exportErrorData(e=24){try{const t=await this.getRecentErrors(1e3),r=new Date;r.setHours(r.getHours()-e);const s=t.filter(i=>new Date(i.timestamp)>=r);return{errors:s,exportMetadata:{exportedAt:new Date().toISOString(),userId:this.userId,timeRange:`${e} hours`,totalErrors:s.length,version:"1.0.0"}}}catch(t){throw console.error(" ErrorLoggingService: Error exporting error data:",t),t}}}const KT=new q8;class W8{constructor(){this.serviceStatus={firebase:"unknown",firestore:"unknown",auth:"unknown",offline:!1},this.fallbackData=new Map,this.retryAttempts=new Map,this.maxRetries=3,this.retryDelay=2e3,this.degradationMode=!1,this.setupServiceMonitoring()}initialize(e){this.userId=e,this.setupFallbackData(),this.startServiceHealthChecks(),console.log(" GracefulDegradationService: Initialized for user",e)}setupServiceMonitoring(){window.addEventListener("online",()=>{this.serviceStatus.offline=!1,this.attemptServiceRecovery()}),window.addEventListener("offline",()=>{this.serviceStatus.offline=!0,this.enableDegradationMode()}),this.monitorFirebaseConnection()}monitorFirebaseConnection(){setInterval(async()=>{await this.checkFirebaseHealth()},3e4)}async checkFirebaseHealth(){try{const e=K(H,"health_check");await ve(e),this.serviceStatus.firebase="healthy"}catch(e){this.serviceStatus.firebase="unhealthy",this.handleServiceFailure("firebase",e)}try{if(!this.userId){console.log(" GracefulDegradationService: Skipping Firestore health check - no user ID"),this.serviceStatus.firestore="unknown";return}const e=Cn(Kr,"health_check"),t={userId:this.userId,timestamp:new Date,service:"health_check",status:"testing"};await(await Ur(e,t)).delete(),this.serviceStatus.firestore="healthy"}catch(e){e.code==="permission-denied"||e.message.includes("Missing or insufficient permissions")?(console.log(" GracefulDegradationService: Firestore health check skipped due to permissions"),this.serviceStatus.firestore="unknown"):(this.serviceStatus.firestore="unhealthy",this.handleServiceFailure("firestore",e))}}handleServiceFailure(e,t){if(t.code==="permission-denied"||t.message.includes("Missing or insufficient permissions")){console.log(` GracefulDegradationService: ${e} service access denied - not treating as failure`);return}console.warn(` GracefulDegradationService: ${e} service failure:`,t),(e==="firebase"||e==="firestore")&&this.enableDegradationMode(),window.errorLoggingService&&window.errorLoggingService.logError("service_failure",{service:e,error:t.message,severity:"warning"})}enableDegradationMode(){this.degradationMode=!0,console.log(" GracefulDegradationService: Degradation mode enabled"),this.notifyUserOfDegradation()}disableDegradationMode(){this.degradationMode=!1,console.log(" GracefulDegradationService: Degradation mode disabled")}notifyUserOfDegradation(){window.showQuickActionPopup&&window.showQuickActionPopup("Service Temporarily Unavailable","Some features may be limited while we restore full service. Your data is safe.","info")}setupFallbackData(){this.loadCachedData()}loadCachedData(){try{const e={profile:this.getCachedData("offline_profileData"),stats:this.getCachedData("offline_cachedStats"),userData:this.getCachedData("offline_userData")};Object.entries(e).forEach(([t,r])=>{r&&this.fallbackData.set(t,r)}),console.log(" GracefulDegradationService: Cached data loaded")}catch(e){console.error(" GracefulDegradationService: Error loading cached data:",e)}}getCachedData(e){try{const t=localStorage.getItem(e);return t?JSON.parse(t):null}catch(t){return console.warn(` GracefulDegradationService: Error getting cached ${e}:`,t),null}}startServiceHealthChecks(){this.checkFirebaseHealth(),setInterval(()=>{this.checkFirebaseHealth()},6e4)}async attemptServiceRecovery(){console.log(" GracefulDegradationService: Attempting service recovery..."),await this.checkFirebaseHealth(),this.serviceStatus.firebase==="healthy"&&this.serviceStatus.firestore==="healthy"&&(this.disableDegradationMode(),this.syncCachedData())}async syncCachedData(){if(console.log(" GracefulDegradationService: Syncing cached data..."),window.offlineManager)try{await window.offlineManager.syncOperations(),console.log(" GracefulDegradationService: Cached data synced")}catch(e){console.error(" GracefulDegradationService: Error syncing cached data:",e)}}async getDataWithFallback(e,t,r){try{if(!this.degradationMode&&this.serviceStatus.firebase==="healthy"){const i=K(H,t),o=await ve(i);if(o.exists()){const a=o.val();return this.fallbackData.set(r,a),a}}const s=this.fallbackData.get(r);return s?(console.log(` GracefulDegradationService: Using cached ${e} data`),s):this.getDefaultData(e)}catch(s){console.warn(` GracefulDegradationService: Error getting ${e}:`,s);const i=this.fallbackData.get(r);return i||this.getDefaultData(e)}}async setDataWithFallback(e,t,r,s){try{if(!this.degradationMode&&this.serviceStatus.firebase==="healthy"){const i=K(H,t);await Te(i,r),console.log(` GracefulDegradationService: ${e} data saved to Firebase`)}else console.log(` GracefulDegradationService: ${e} data cached (offline mode)`);return this.fallbackData.set(s,r),this.cacheData(s,r),!0}catch(i){return console.warn(` GracefulDegradationService: Error setting ${e}:`,i),this.fallbackData.set(s,r),this.cacheData(s,r),!1}}cacheData(e,t){try{localStorage.setItem(e,JSON.stringify(t))}catch(r){console.warn(` GracefulDegradationService: Error caching ${e}:`,r)}}getDefaultData(e){return{profile:{heroName:"Anonymous Hero",archetype:"DETERMINED",avatar:null,quitDate:new Date().toISOString(),triggers:[],dailyPatterns:[],copingStrategies:[]},stats:{mentalStrength:50,motivation:50,triggerDefense:30,addictionLevel:50,cravingsResisted:0,streakDays:0,experiencePoints:0},userData:{email:"",displayName:"Anonymous User",photoURL:null,lastLogin:new Date().toISOString()}}[e]||{}}getServiceStatus(){return{...this.serviceStatus,degradationMode:this.degradationMode,fallbackDataCount:this.fallbackData.size,retryAttempts:Object.fromEntries(this.retryAttempts)}}isServiceAvailable(e){return this.serviceStatus.offline?!1:this.serviceStatus[e]==="healthy"}async getUserProfile(){return this.getDataWithFallback("profile",`users/${this.userId}/profile`,"profile")}async setUserProfile(e){return this.setDataWithFallback("profile",`users/${this.userId}/profile`,e,"profile")}async getUserStats(){return this.getDataWithFallback("stats",`users/${this.userId}/stats`,"stats")}async setUserStats(e){return this.setDataWithFallback("stats",`users/${this.userId}/stats`,e,"stats")}async getBehavioralData(e=10){try{if(!this.degradationMode&&this.serviceStatus.firestore==="healthy"){const r=Ki(Cn(Kr,"behavioral_cravings"),ni("userId","==",this.userId),e(e));return(await wc(r)).docs.map(i=>({id:i.id,...i.data()}))}return(this.fallbackData.get("behavioralData")||[]).slice(0,e)}catch(t){return console.warn(" GracefulDegradationService: Error getting behavioral data:",t),this.fallbackData.get("behavioralData")||[]}}async setBehavioralData(e){try{if(!this.degradationMode&&this.serviceStatus.firestore==="healthy"){const r={...e,userId:this.userId,timestamp:e.timestamp||new Date};await Ur(Cn(Kr,"behavioral_cravings"),r),console.log(" GracefulDegradationService: Behavioral data saved to Firestore")}else console.log(" GracefulDegradationService: Behavioral data cached (offline mode)");const t=this.fallbackData.get("behavioralData")||[];return t.unshift(e),this.fallbackData.set("behavioralData",t.slice(0,100)),!0}catch(t){return console.warn(" GracefulDegradationService: Error setting behavioral data:",t),!1}}async forceRecovery(){console.log(" GracefulDegradationService: Forcing service recovery..."),await this.checkFirebaseHealth(),await this.attemptServiceRecovery()}}const YT=new W8;class G8{constructor(){this.rateLimits={apiCalls:{limit:60,window:6e4},authAttempts:{limit:5,window:6e4},databaseWrites:{limit:30,window:6e4},databaseReads:{limit:100,window:6e4},behavioralLogs:{limit:50,window:36e5},stressTests:{limit:3,window:36e5},errorReports:{limit:10,window:6e4},profileUpdates:{limit:10,window:36e5}},this.userLimits=new Map,this.globalLimits=new Map,this.blockedUsers=new Set,this.suspiciousActivity=new Map,this.setupRateLimitCleanup()}initialize(e){this.userId=e,this.initializeUserLimits(),console.log(" RateLimitingService: Initialized for user",e)}initializeUserLimits(){if(!this.userId)return;const e={apiCalls:[],authAttempts:[],databaseWrites:[],databaseReads:[],behavioralLogs:[],stressTests:[],errorReports:[],profileUpdates:[]};this.userLimits.set(this.userId,e)}isAllowed(e,t=null){const r=t||this.userId;if(!r)return console.error(" RateLimitingService: User ID required for rate limiting"),!1;if(this.blockedUsers.has(r))return console.warn(` RateLimitingService: User ${r} is blocked`),!1;if(this.isSuspiciousUser(r))return console.warn(` RateLimitingService: User ${r} has suspicious activity`),!1;const s=this.rateLimits[e];if(!s)return console.warn(` RateLimitingService: Unknown action: ${e}`),!0;const i=this.userLimits.get(r);if(!i)return this.initializeUserLimits(),!0;const o=Date.now(),a=o-s.window;return i[e]=i[e].filter(c=>c>a),i[e].length>=s.limit?(this.recordRateLimitExceeded(e,r),!1):(i[e].push(o),this.userLimits.set(r,i),!0)}recordRateLimitExceeded(e,t){console.warn(` RateLimitingService: Rate limit exceeded for ${e} by user ${t}`),window.errorLoggingService&&window.errorLoggingService.logError("rate_limit_exceeded",{action:e,userId:t,severity:"warning"}),this.trackSuspiciousActivity(t,e)}trackSuspiciousActivity(e,t){this.suspiciousActivity.has(e)||this.suspiciousActivity.set(e,[]);const r=this.suspiciousActivity.get(e);r.push({action:t,timestamp:Date.now()}),r.length>10&&r.splice(0,r.length-10),this.suspiciousActivity.set(e,r),this.checkForBlocking(e)}checkForBlocking(e){const t=this.suspiciousActivity.get(e)||[],r=Date.now();t.filter(i=>r-i.timestamp<3e5).length>5&&this.blockUser(e,"Excessive rate limit violations")}blockUser(e,t){this.blockedUsers.add(e),console.warn(` RateLimitingService: User ${e} blocked. Reason: ${t}`),window.errorLoggingService&&window.errorLoggingService.logError("user_blocked",{userId:e,reason:t,severity:"critical"});const r=JSON.parse(localStorage.getItem("blocked_users")||"[]");r.push({userId:e,reason:t,timestamp:Date.now()}),localStorage.setItem("blocked_users",JSON.stringify(r))}unblockUser(e){this.blockedUsers.delete(e),console.log(` RateLimitingService: User ${e} unblocked`);const r=JSON.parse(localStorage.getItem("blocked_users")||"[]").filter(s=>s.userId!==e);localStorage.setItem("blocked_users",JSON.stringify(r))}isSuspiciousUser(e){const t=this.suspiciousActivity.get(e)||[],r=Date.now();return t.filter(i=>r-i.timestamp<6e5).length>3}getRemainingAttempts(e,t=null){const r=t||this.userId;if(!r)return 0;const s=this.rateLimits[e];if(!s)return 0;const i=this.userLimits.get(r);if(!i)return s.limit;const a=Date.now()-s.window;return i[e]=i[e].filter(c=>c>a),Math.max(0,s.limit-i[e].length)}getTimeUntilReset(e,t=null){const r=t||this.userId;if(!r)return 0;const s=this.rateLimits[e];if(!s)return 0;const i=this.userLimits.get(r);if(!i||i[e].length===0)return 0;const a=Math.min(...i[e])+s.window;return Math.max(0,a-Date.now())}setupRateLimitCleanup(){setInterval(()=>{this.cleanupOldEntries()},5*60*1e3),this.loadBlockedUsers()}cleanupOldEntries(){const e=Date.now();this.userLimits.forEach((t,r)=>{Object.keys(t).forEach(s=>{const i=this.rateLimits[s];if(i){const o=e-i.window;t[s]=t[s].filter(a=>a>o)}})}),this.suspiciousActivity.forEach((t,r)=>{const s=t.filter(i=>e-i.timestamp<36e5);s.length===0?this.suspiciousActivity.delete(r):this.suspiciousActivity.set(r,s)})}loadBlockedUsers(){try{const e=JSON.parse(localStorage.getItem("blocked_users")||"[]"),t=Date.now();e.forEach(r=>{t-r.timestamp<24*60*60*1e3&&this.blockedUsers.add(r.userId)})}catch(e){console.error(" RateLimitingService: Error loading blocked users:",e)}}getRateLimitStatus(e=null){const t=e||this.userId;if(!t)return null;const r={userId:t,isBlocked:this.blockedUsers.has(t),isSuspicious:this.isSuspiciousUser(t),limits:{}};return Object.keys(this.rateLimits).forEach(s=>{r.limits[s]={remaining:this.getRemainingAttempts(s,t),resetIn:this.getTimeUntilReset(s,t),limit:this.rateLimits[s].limit,window:this.rateLimits[s].window}}),r}updateRateLimits(e){this.rateLimits={...this.rateLimits,...e},console.log(" RateLimitingService: Rate limits updated")}resetUserLimits(e=null){const t=e||this.userId;t&&(this.userLimits.delete(t),this.suspiciousActivity.delete(t),this.unblockUser(t),console.log(` RateLimitingService: Limits reset for user ${t}`))}getSuspiciousUsers(){const e=[];return this.suspiciousActivity.forEach((t,r)=>{t.length>0&&e.push({userId:r,activityCount:t.length,lastActivity:Math.max(...t.map(s=>s.timestamp)),activities:t.slice(-5)})}),e.sort((t,r)=>r.activityCount-t.activityCount)}getBlockedUsers(){return Array.from(this.blockedUsers)}canPerformAction(e,t=null){var a;const r=t||this.userId;if(!r)return{allowed:!1,reason:"User ID required",remaining:0,resetIn:0};const s=this.isAllowed(e,r),i=this.getRemainingAttempts(e,r),o=this.getTimeUntilReset(e,r);return{allowed:s,reason:s?"Allowed":"Rate limit exceeded",remaining:i,resetIn:o,limit:((a=this.rateLimits[e])==null?void 0:a.limit)||0}}}const JT=new G8,H8=({onAuthSuccess:n,isNewUser:e})=>{const[t,r]=D.useState("signin"),[s,i]=D.useState(""),[o,a]=D.useState(""),[c,u]=D.useState(""),[h,f]=D.useState(!1),[m,y]=D.useState(!1),[w,S]=D.useState(""),[R,T]=D.useState(""),[I,N]=D.useState(!1);D.useEffect(()=>()=>{m&&y(!1)},[m]);const P=new Js;P.addScope("email"),P.addScope("profile"),P.setCustomParameters({prompt:"select_account",access_type:"offline",include_granted_scopes:"true"});const B=()=>{i(""),a(""),u(""),S(""),T("")},F=async()=>{f(!0),y(!0),S("");try{console.log("Starting Google sign-in process..."),console.log("Opening Google authentication popup..."),console.log("Google provider configuration:",{scopes:P.scopes,customParameters:P.customParameters});const C=sz(ii,P),_=new Promise((V,U)=>{setTimeout(()=>U(new Error("Popup timeout - please try again")),6e4)}),v=await Promise.race([C,_]);if(v&&v.user){const V=v.user;console.log("Google sign-in successful for:",V.email,"UID:",V.uid),console.log("User display name:",V.displayName),console.log("User photo URL:",V.photoURL),await new Promise(U=>setTimeout(U,800)),n(V)}else throw new Error("No user data received from Google authentication")}catch(C){console.error("Google sign-in error:",C),C.code==="auth/popup-closed-by-user"?S("Google sign-in was cancelled. Please try again and complete the account selection in the popup window."):C.code==="auth/popup-blocked"?S("Google sign-in popup was blocked by your browser. Please allow popups for this site and try again."):C.code==="auth/cancelled-popup-request"?S("Google sign-in was cancelled. Please try again and complete the authentication process."):C.code==="auth/account-exists-with-different-credential"?S("An account already exists with this email using a different sign-in method. Please use email/password instead."):C.message==="Popup timeout - please try again"?S("Google sign-in popup timed out. Please try again and complete the account selection quickly."):C.code==="auth/network-request-failed"?S("Network error during Google sign-in. Please check your internet connection and try again."):C.code==="auth/operation-not-allowed"?S("Google sign-in is not enabled for this app. Please contact support."):S(k(C.code))}finally{f(!1),y(!1)}},A=async C=>{C.preventDefault(),f(!0),S("");try{const v=(await gP(ii,s,o)).user;console.log("Email sign-in successful for:",v.email),n(v)}catch(_){console.error("Email sign-in error:",_),S(k(_.code))}finally{f(!1)}},x=async C=>{if(C.preventDefault(),f(!0),S(""),o!==c){S("Passwords do not match"),f(!1);return}if(o.length<6){S("Password must be at least 6 characters long"),f(!1);return}try{const v=(await pP(ii,s,o)).user;console.log("Email sign-up successful for:",v.email),await gB(v),n(v)}catch(_){console.error("Email sign-up error:",_),S(k(_.code))}finally{f(!1)}},E=async C=>{if(C.preventDefault(),!s){S("Please enter your email address");return}f(!0),S("");try{await fB(ii,s),T("Password reset email sent! Check your inbox.")}catch(_){console.error("Password reset error:",_),S(k(_.code))}finally{f(!1)}},k=C=>{switch(C){case"auth/user-not-found":return"No account found with this email address";case"auth/wrong-password":return"Incorrect password";case"auth/email-already-in-use":return"An account with this email already exists";case"auth/weak-password":return"Password is too weak. Use at least 6 characters";case"auth/invalid-email":return"Invalid email address";case"auth/popup-closed-by-user":return"Google sign-in was cancelled. Please try again and complete the account selection.";case"auth/popup-blocked":return"Google sign-in popup was blocked. Please allow popups for this site and try again.";case"auth/cancelled-popup-request":return"Google sign-in was cancelled. Please try again.";case"auth/account-exists-with-different-credential":return"An account already exists with this email using a different sign-in method.";case"auth/network-request-failed":return"Network error. Please check your connection";case"auth/operation-not-allowed":return"Google sign-in is not enabled. Please contact support.";case"auth/too-many-requests":return"Too many sign-in attempts. Please try again later.";default:return"Authentication failed. Please try again"}};return I?l.jsx("div",{className:"min-h-screen bg-gray-900 flex items-center justify-center px-4",children:l.jsxs("div",{className:"max-w-md w-full space-y-8",children:[l.jsxs("div",{className:"text-center",children:[l.jsx("h2",{className:"text-3xl font-bold text-white",children:"Reset Password"}),l.jsx("p",{className:"mt-2 text-gray-400",children:"Enter your email to receive a reset link"})]}),l.jsxs("form",{onSubmit:E,className:"space-y-6",children:[l.jsxs("div",{children:[l.jsx("label",{htmlFor:"email",className:"block text-sm font-medium text-gray-300",children:"Email Address"}),l.jsx("input",{id:"email",type:"email",value:s,onChange:C=>i(C.target.value),required:!0,autoComplete:"email",className:"mt-1 block w-full px-3 py-2 bg-gray-800 border border-gray-600 rounded-md text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"Enter your email"})]}),w&&l.jsx("div",{className:"text-red-400 text-sm",children:w}),R&&l.jsx("div",{className:"text-green-400 text-sm",children:R}),l.jsxs("div",{className:"flex space-x-3",children:[l.jsx("button",{type:"button",onClick:()=>{N(!1),S(""),T("")},className:"flex-1 px-4 py-3 border border-gray-600 rounded-md text-gray-300 hover:bg-gray-700 focus:outline-none focus:ring-2 focus:ring-gray-500 min-h-[44px]",children:"Back to Login"}),l.jsx("button",{type:"submit",disabled:h,className:"flex-1 px-4 py-3 bg-blue-600 border border-transparent rounded-md text-white hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 disabled:opacity-50 min-h-[44px]",children:h?"Sending...":"Send Reset Link"})]})]})]})}):l.jsx("div",{className:"min-h-screen bg-gray-900 flex items-center justify-center px-4",children:l.jsxs("div",{className:"max-w-md w-full space-y-8",children:[l.jsxs("div",{className:"text-center",children:[l.jsx("h1",{className:"text-4xl font-bold text-white mb-2",children:"QuitCard Arena"}),l.jsx("p",{className:"text-gray-400",children:"Your journey to quit starts here"})]}),l.jsxs("div",{children:[m&&l.jsx("div",{className:"mb-3 p-3 bg-blue-900/20 border border-blue-500/30 rounded-lg",children:l.jsxs("div",{className:"flex items-center justify-center text-blue-300 text-sm",children:[l.jsx("div",{className:"animate-pulse mr-2",children:""}),"Google popup is open - please complete your account selection"]})}),l.jsx("button",{onClick:F,disabled:h,className:"w-full flex items-center justify-center px-4 py-3 border border-gray-600 rounded-md text-white bg-gray-800 hover:bg-gray-700 focus:outline-none focus:ring-2 focus:ring-blue-500 disabled:opacity-50",children:h?l.jsxs(l.Fragment,{children:[l.jsx("div",{className:"animate-spin rounded-full h-5 w-5 border-b-2 border-white mr-3"}),"Opening Google Sign-in..."]}):l.jsxs(l.Fragment,{children:[l.jsxs("svg",{className:"w-5 h-5 mr-3",viewBox:"0 0 24 24",children:[l.jsx("path",{fill:"currentColor",d:"M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z"}),l.jsx("path",{fill:"currentColor",d:"M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z"}),l.jsx("path",{fill:"currentColor",d:"M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z"}),l.jsx("path",{fill:"currentColor",d:"M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z"})]}),"Continue with Google"]})}),l.jsx("p",{className:"text-xs text-gray-500 mt-2 text-center",children:m?l.jsx("span",{className:"text-blue-400 font-medium",children:" Google popup is open - please complete account selection"}):"Click to open Google account selection popup"}),!1,w&&l.jsxs("div",{className:"mt-3 p-3 bg-red-900/20 border border-red-500/30 rounded-lg",children:[l.jsx("div",{className:"text-red-300 text-sm mb-2",children:w}),w.includes("Google sign-in")&&!m&&l.jsx("button",{onClick:F,disabled:h,className:"w-full px-3 py-3 bg-red-600 hover:bg-red-700 text-white text-sm rounded-md transition-colors disabled:opacity-50 min-h-[44px]",children:h?"Retrying...":"Try Google Sign-in Again"})]})]}),l.jsxs("div",{className:"relative",children:[l.jsx("div",{className:"absolute inset-0 flex items-center",children:l.jsx("div",{className:"w-full border-t border-gray-600"})}),l.jsx("div",{className:"relative flex justify-center text-sm",children:l.jsx("span",{className:"px-2 bg-gray-900 text-gray-400",children:"Or continue with email"})})]}),l.jsxs("div",{className:"flex space-x-1 bg-gray-800 p-1 rounded-lg",children:[l.jsx("button",{onClick:()=>{r("signin"),B()},className:`flex-1 py-3 px-4 rounded-md text-sm font-medium transition-colors min-h-[44px] ${t==="signin"?"bg-blue-600 text-white":"text-gray-400 hover:text-white"}`,children:"Sign In"}),l.jsx("button",{onClick:()=>{r("signup"),B()},className:`flex-1 py-3 px-4 rounded-md text-sm font-medium transition-colors min-h-[44px] ${t==="signup"?"bg-blue-600 text-white":"text-gray-400 hover:text-white"}`,children:"Sign Up"})]}),t==="signin"&&l.jsxs("form",{onSubmit:A,className:"space-y-6",children:[l.jsxs("div",{children:[l.jsx("label",{htmlFor:"signin-email",className:"block text-sm font-medium text-gray-300",children:"Email Address"}),l.jsx("input",{id:"signin-email",type:"email",value:s,onChange:C=>i(C.target.value),required:!0,autoComplete:"email",className:"mt-1 block w-full px-3 py-2 bg-gray-800 border border-gray-600 rounded-md text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"Enter your email"})]}),l.jsxs("div",{children:[l.jsx("label",{htmlFor:"signin-password",className:"block text-sm font-medium text-gray-300",children:"Password"}),l.jsx("input",{id:"signin-password",type:"password",value:o,onChange:C=>a(C.target.value),required:!0,autoComplete:"current-password",className:"mt-1 block w-full px-3 py-2 bg-gray-800 border border-gray-600 rounded-md text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"Enter your password"})]}),l.jsx("div",{className:"flex items-center justify-between",children:l.jsx("button",{type:"button",onClick:()=>N(!0),className:"text-sm text-blue-400 hover:text-blue-300 py-2 px-2 min-h-[44px] min-w-[44px]",children:"Forgot your password?"})}),w&&l.jsx("div",{className:"text-red-400 text-sm",children:w}),l.jsx("button",{type:"submit",disabled:h,className:"w-full flex justify-center py-3 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 disabled:opacity-50 min-h-[44px]",children:h?"Signing in...":"Sign In"})]}),t==="signup"&&l.jsxs("form",{onSubmit:x,className:"space-y-6",children:[l.jsxs("div",{children:[l.jsx("label",{htmlFor:"signup-email",className:"block text-sm font-medium text-gray-300",children:"Email Address"}),l.jsx("input",{id:"signup-email",type:"email",value:s,onChange:C=>i(C.target.value),required:!0,autoComplete:"email",className:"mt-1 block w-full px-3 py-2 bg-gray-800 border border-gray-600 rounded-md text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"Enter your email"})]}),l.jsxs("div",{children:[l.jsx("label",{htmlFor:"signup-password",className:"block text-sm font-medium text-gray-300",children:"Password"}),l.jsx("input",{id:"signup-password",type:"password",value:o,onChange:C=>a(C.target.value),required:!0,autoComplete:"new-password",className:"mt-1 block w-full px-3 py-2 bg-gray-800 border border-gray-600 rounded-md text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"Create a password (min 6 characters)"})]}),l.jsxs("div",{children:[l.jsx("label",{htmlFor:"confirm-password",className:"block text-sm font-medium text-gray-300",children:"Confirm Password"}),l.jsx("input",{id:"confirm-password",type:"password",value:c,onChange:C=>u(C.target.value),required:!0,autoComplete:"new-password",className:"mt-1 block w-full px-3 py-2 bg-gray-800 border border-gray-600 rounded-md text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"Confirm your password"})]}),w&&l.jsx("div",{className:"text-red-400 text-sm",children:w}),R&&l.jsx("div",{className:"text-green-400 text-sm",children:R}),l.jsx("button",{type:"submit",disabled:h,className:"w-full flex justify-center py-3 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 disabled:opacity-50 min-h-[44px]",children:h?"Creating account...":"Create Account"})]})]})})},Q8=({offlineManager:n})=>{const[e,t]=D.useState(navigator.onLine),[r,s]=D.useState(!1),[i,o]=D.useState(0),[a,c]=D.useState(!1);return D.useEffect(()=>{const u=()=>{t(!0),s(!1),console.log(" Connection restored"),n&&i>0&&(c(!0),setTimeout(()=>{c(!1),o(0)},2e3))},h=()=>{t(!1),s(!0),console.log(" Connection lost")};window.addEventListener("online",u),window.addEventListener("offline",h),t(navigator.onLine);const f=async()=>{if(n)try{const y=await n.getQueuedActionsCount();o(y)}catch(y){console.warn("Could not get queued actions count:",y)}};f();const m=setInterval(f,5e3);return()=>{window.removeEventListener("online",u),window.removeEventListener("offline",h),clearInterval(m)}},[n,i]),e&&a?l.jsx("div",{className:"fixed top-0 left-0 right-0 z-50 bg-blue-600 text-white p-3 text-center shadow-lg",children:l.jsxs("div",{className:"flex items-center justify-center space-x-2",children:[l.jsx("svg",{className:"w-5 h-5 animate-spin",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:l.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})}),l.jsxs("span",{className:"font-medium",children:["Syncing ",i," offline actions..."]})]})}):e&&!a&&i===0||e?null:l.jsxs("div",{className:"fixed top-0 left-0 right-0 z-50 bg-yellow-600 text-white p-3 text-center shadow-lg",children:[l.jsxs("div",{className:"flex items-center justify-center space-x-2",children:[l.jsx("svg",{className:"w-5 h-5 animate-pulse",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:l.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L3.732 16.5c-.77.833.192 2.5 1.732 2.5z"})}),l.jsxs("span",{className:"font-medium",children:["You're offline. Some features may be limited.",i>0&&` (${i} actions queued)`]}),l.jsx("button",{onClick:()=>s(!1),className:"ml-2 text-white hover:text-yellow-200 transition-colors w-11 h-11 flex items-center justify-center min-h-[44px] min-w-[44px]",children:l.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:l.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),r&&l.jsxs("div",{className:"mt-2 text-sm bg-yellow-700 p-2 rounded",children:[l.jsx("p",{className:"mb-2",children:"While offline, you can:"}),l.jsxs("ul",{className:"text-left space-y-1 ml-4",children:[l.jsx("li",{children:" View your current stats and progress"}),l.jsx("li",{children:" Track habits and cravings"}),l.jsx("li",{children:" Log water intake and breathing exercises"}),l.jsx("li",{children:" Record craving assessments and resistance"}),l.jsx("li",{children:" Play distraction games"}),l.jsx("li",{children:" View your profile information"})]}),l.jsxs("p",{className:"mt-2 text-yellow-200",children:["All changes will sync automatically when you're back online.",i>0&&l.jsxs("span",{className:"block mt-1 font-medium",children:[" ",i," action",i!==1?"s":""," queued for sync"]})]})]})]})},K8=({offlineManager:n})=>{const[e,t]=D.useState({isOnline:navigator.onLine,queuedOperations:0,failedOperations:0,syncInProgress:!1,lastSyncTime:null}),[r,s]=D.useState(!1),[i,o]=D.useState(0),[a,c]=D.useState(null);D.useEffect(()=>{if(!n||!n.progressManager)return;const S=N=>{o(N.progress),c(N.currentOperation)},R=N=>{t(P=>({...P,syncInProgress:N.status==="syncing",lastSyncTime:N.endTime||P.lastSyncTime}))};n.progressManager.addProgressCallback(S),n.progressManager.addStatusCallback(R);const T=()=>{const N=n.getStatus();t(P=>({...P,isOnline:N.isOnline,queuedOperations:N.queue.queuedOperations,failedOperations:N.queue.failedOperations,syncInProgress:N.queue.syncInProgress}))};T();const I=setInterval(T,1e3);return()=>{n&&n.progressManager&&(n.progressManager.removeProgressCallback(S),n.progressManager.removeStatusCallback(R)),clearInterval(I)}},[n]);const u=async()=>{n&&await n.retryFailedOperations()},h=async()=>{n&&await n.attemptSync()},f=S=>{if(!S)return"Never";const T=Date.now()-S,I=Math.floor(T/6e4),N=Math.floor(I/60),P=Math.floor(N/24);return P>0?`${P}d ago`:N>0?`${N}h ago`:I>0?`${I}m ago`:"Just now"},m=()=>e.isOnline?e.failedOperations>0?"text-red-600":e.queuedOperations>0?"text-blue-600":"text-green-600":"text-yellow-600",y=()=>e.isOnline?e.syncInProgress?"":e.failedOperations>0?"":e.queuedOperations>0?"":"":"",w=()=>e.isOnline?e.syncInProgress?"Syncing...":e.failedOperations>0?`${e.failedOperations} failed`:e.queuedOperations>0?`${e.queuedOperations} queued`:"Synced":"Offline";return n?l.jsxs("div",{className:"fixed top-4 right-4 z-50",children:[l.jsxs("div",{className:`bg-white rounded-lg shadow-lg p-3 cursor-pointer transition-all duration-200 hover:shadow-xl ${m()}`,onClick:()=>s(!r),children:[l.jsxs("div",{className:"flex items-center gap-2",children:[l.jsx("span",{className:"text-lg",children:y()}),l.jsx("div",{className:"text-sm font-medium",children:w()}),e.syncInProgress&&l.jsx("div",{className:"w-4 h-4 border-2 border-current border-t-transparent rounded-full animate-spin"})]}),e.syncInProgress&&l.jsx("div",{className:"mt-2 w-full bg-gray-200 rounded-full h-1",children:l.jsx("div",{className:"bg-current h-1 rounded-full transition-all duration-300",style:{width:`${i}%`}})})]}),r&&l.jsxs("div",{className:"absolute top-16 right-0 bg-white rounded-lg shadow-xl p-4 w-80 border",children:[l.jsxs("div",{className:"flex justify-between items-center mb-3",children:[l.jsx("h3",{className:"font-semibold text-gray-800",children:"Sync Status"}),l.jsx("button",{onClick:()=>s(!1),className:"text-gray-400 hover:text-gray-600",children:""})]}),l.jsxs("div",{className:"mb-3",children:[l.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[l.jsx("span",{className:`w-2 h-2 rounded-full ${e.isOnline?"bg-green-500":"bg-yellow-500"}`}),l.jsx("span",{className:"text-sm font-medium",children:e.isOnline?"Online":"Offline"})]}),l.jsxs("div",{className:"text-xs text-gray-500",children:["Last sync: ",f(e.lastSyncTime)]})]}),l.jsxs("div",{className:"mb-3",children:[l.jsx("div",{className:"text-sm font-medium text-gray-700 mb-1",children:"Queue Status"}),l.jsxs("div",{className:"space-y-1 text-xs",children:[l.jsxs("div",{className:"flex justify-between",children:[l.jsx("span",{children:"Queued:"}),l.jsx("span",{className:"text-blue-600",children:e.queuedOperations})]}),l.jsxs("div",{className:"flex justify-between",children:[l.jsx("span",{children:"Failed:"}),l.jsx("span",{className:"text-red-600",children:e.failedOperations})]})]})]}),a&&l.jsxs("div",{className:"mb-3",children:[l.jsx("div",{className:"text-sm font-medium text-gray-700 mb-1",children:"Current Operation"}),l.jsxs("div",{className:"text-xs text-gray-600",children:[a.type," - ",Math.round(i),"%"]})]}),l.jsxs("div",{className:"flex gap-2",children:[e.failedOperations>0&&l.jsx("button",{onClick:u,className:"flex-1 bg-red-500 hover:bg-red-600 text-white text-xs py-2 px-3 rounded transition-colors",children:"Retry Failed"}),e.queuedOperations>0&&e.isOnline&&l.jsx("button",{onClick:h,className:"flex-1 bg-blue-500 hover:bg-blue-600 text-white text-xs py-2 px-3 rounded transition-colors",children:"Sync Now"})]}),l.jsx("div",{className:"mt-3 pt-3 border-t border-gray-200",children:l.jsx("div",{className:"text-xs text-gray-500",children:l.jsxs("div",{className:"flex justify-between",children:[l.jsx("span",{children:"Success Rate:"}),l.jsxs("span",{children:[n.getStatus().sync.successRate,"%"]})]})})})]})]}):null},Y8=({sessionManager:n,authGuard:e})=>{const[t,r]=D.useState({isActive:!1,duration:0,timeUntilTimeout:0,timeUntilWarning:0}),[s,i]=D.useState(!1),[o,a]=D.useState(!1);D.useEffect(()=>{if(!n)return;const S=()=>{const T=n.getSessionInfo();r(T),a(T.timeUntilWarning<=0&&T.timeUntilTimeout>0)};S();const R=setInterval(S,1e3);return()=>clearInterval(R)},[n]);const c=S=>{if(S<=0)return"0:00";const R=Math.floor(S/60),T=S%60;return`${R}:${T.toString().padStart(2,"0")}`},u=S=>S<60?`${S}s`:S<3600?`${Math.floor(S/60)}m`:`${Math.floor(S/3600)}h ${Math.floor(S%3600/60)}m`,h=()=>t.isActive?o?"text-yellow-600":t.timeUntilTimeout<=60?"text-red-600":"text-green-600":"text-gray-500",f=()=>t.isActive?o?"":t.timeUntilTimeout<=60?"":"":"",m=()=>t.isActive?o?"Warning":t.timeUntilTimeout<=60?"Expiring":"Active":"Inactive",y=()=>{n&&n.extendSession()},w=async()=>{if(e)try{await e.logout()}catch(S){console.error("Logout failed:",S)}};return t.isActive?l.jsxs("div",{className:"fixed top-4 left-4 z-50",children:[l.jsxs("div",{className:`bg-white rounded-lg shadow-lg p-3 cursor-pointer transition-all duration-200 hover:shadow-xl ${h()}`,onClick:()=>i(!s),children:[l.jsxs("div",{className:"flex items-center gap-2",children:[l.jsx("span",{className:"text-lg",children:f()}),l.jsx("div",{className:"text-sm font-medium",children:m()}),t.timeUntilTimeout>0&&l.jsx("div",{className:"text-xs opacity-75",children:c(t.timeUntilTimeout)})]}),t.timeUntilTimeout>0&&l.jsx("div",{className:"mt-2 w-full bg-gray-200 rounded-full h-1",children:l.jsx("div",{className:`h-1 rounded-full transition-all duration-300 ${o?"bg-yellow-500":t.timeUntilTimeout<=60?"bg-red-500":"bg-green-500"}`,style:{width:`${Math.max(0,Math.min(100,t.timeUntilTimeout/1800*100))}%`}})})]}),s&&l.jsxs("div",{className:"absolute top-16 left-0 bg-white rounded-lg shadow-xl p-4 w-80 border",children:[l.jsxs("div",{className:"flex justify-between items-center mb-3",children:[l.jsx("h3",{className:"font-semibold text-gray-800",children:"Session Status"}),l.jsx("button",{onClick:()=>i(!1),className:"text-gray-400 hover:text-gray-600",children:""})]}),l.jsxs("div",{className:"mb-3",children:[l.jsx("div",{className:"text-sm font-medium text-gray-700 mb-1",children:"Session Duration"}),l.jsx("div",{className:"text-lg font-mono text-gray-900",children:u(t.duration)})]}),t.timeUntilTimeout>0&&l.jsxs("div",{className:"mb-3",children:[l.jsx("div",{className:"text-sm font-medium text-gray-700 mb-1",children:"Time Until Timeout"}),l.jsx("div",{className:`text-lg font-mono ${o?"text-yellow-600":t.timeUntilTimeout<=60?"text-red-600":"text-gray-900"}`,children:c(t.timeUntilTimeout)})]}),l.jsxs("div",{className:"mb-3",children:[l.jsx("div",{className:"text-sm font-medium text-gray-700 mb-1",children:"Status"}),l.jsx("div",{className:`text-sm font-medium ${o?"text-yellow-600":t.timeUntilTimeout<=60?"text-red-600":"text-green-600"}`,children:m()})]}),l.jsxs("div",{className:"flex gap-2",children:[o&&l.jsx("button",{onClick:y,className:"flex-1 bg-yellow-500 hover:bg-yellow-600 text-white text-sm py-2 px-3 rounded transition-colors",children:"Extend Session"}),l.jsx("button",{onClick:w,className:"flex-1 bg-red-500 hover:bg-red-600 text-white text-sm py-2 px-3 rounded transition-colors",children:"Logout"})]}),e&&l.jsx("div",{className:"mt-3 pt-3 border-t border-gray-200",children:l.jsxs("div",{className:"text-xs text-gray-500",children:[l.jsxs("div",{className:"flex justify-between",children:[l.jsx("span",{children:"Operations:"}),l.jsx("span",{children:e.getOperationStats().total})]}),l.jsxs("div",{className:"flex justify-between",children:[l.jsx("span",{children:"Success Rate:"}),l.jsxs("span",{children:[e.getOperationStats().successRate,"%"]})]})]})})]})]}):null},J8=({selectedRate:n,duration:e,onRateSelect:t,onDurationSelect:r,onStartExercise:s})=>l.jsxs("div",{className:"p-4 sm:p-6",children:[l.jsxs("div",{className:"text-center mb-6",children:[l.jsx("h2",{className:"text-xl sm:text-2xl font-bold text-white mb-2",children:"Breathing Exercise"}),l.jsx("p",{className:"text-slate-400 text-sm",children:"Configure your breathing session"})]}),l.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4 mb-8",children:[l.jsxs("div",{onClick:t,className:"bg-slate-800/50 hover:bg-slate-700/50 rounded-2xl p-4 border border-slate-600/30 cursor-pointer transition-all duration-300 hover:scale-[1.02] group",children:[l.jsxs("div",{className:"flex items-center space-x-3 mb-3",children:[l.jsx("div",{className:"w-8 h-8 bg-slate-700/50 rounded-lg flex items-center justify-center group-hover:bg-slate-600/50 transition-colors flex-shrink-0",children:l.jsx("span",{className:"text-lg",children:""})}),l.jsx("div",{className:"text-white font-semibold text-sm",children:"BREATHING RATE"})]}),l.jsx("div",{className:"text-white font-bold text-sm",children:n.name}),l.jsxs("div",{className:"text-slate-400 text-xs",children:[n.inhale,"s | ",n.exhale,"s"]})]}),l.jsxs("div",{onClick:r,className:"bg-slate-800/50 hover:bg-slate-700/50 rounded-2xl p-4 border border-slate-600/30 cursor-pointer transition-all duration-300 hover:scale-[1.02] group",children:[l.jsxs("div",{className:"flex items-center space-x-3 mb-3",children:[l.jsx("div",{className:"w-8 h-8 bg-slate-700/50 rounded-lg flex items-center justify-center group-hover:bg-slate-600/50 transition-colors flex-shrink-0",children:l.jsx("span",{className:"text-lg",children:""})}),l.jsx("div",{className:"text-white font-semibold text-sm",children:"DURATION"})]}),l.jsxs("div",{className:"text-white font-bold text-sm",children:[e,"min."]}),l.jsx("div",{className:"text-slate-400 text-xs",children:"Total time"})]})]}),l.jsx("button",{onClick:s,className:"w-full bg-gradient-to-r from-blue-600 to-purple-600 hover:from-blue-700 hover:to-purple-700 text-white font-bold text-base sm:text-lg py-3 sm:py-4 px-4 sm:px-6 rounded-2xl transition-all duration-300 hover:scale-105 shadow-lg hover:shadow-xl min-h-[44px]",children:"START EXERCISE"}),l.jsx("div",{className:"mt-4 sm:mt-6 text-center",children:l.jsx("p",{className:"text-slate-400 text-xs sm:text-sm",children:"Find a comfortable position and prepare to relax"})})]}),X8=({selectedRate:n,onSelect:e,onBack:t})=>{const r=[{name:"INTRO",inhale:3,exhale:6},{name:"BASIC",inhale:5,exhale:10},{name:"INTERMEDIATE",inhale:10,exhale:20},{name:"ADVANCED",inhale:20,exhale:40},{name:"ELITE",inhale:30,exhale:60}];return l.jsxs("div",{className:"p-8",children:[l.jsxs("div",{className:"text-center mb-8",children:[l.jsx("h2",{className:"text-2xl font-bold text-white mb-2",children:"BREATHING RATE"}),l.jsx("p",{className:"text-slate-400",children:"Choose your breathing pattern"})]}),l.jsx("div",{className:"space-y-4 mb-8",children:r.map(s=>l.jsx("div",{onClick:()=>e(s),className:`rounded-2xl p-6 border transition-all duration-300 cursor-pointer hover:scale-[1.02] ${n.name===s.name?"bg-white text-slate-900 border-white shadow-lg":"bg-slate-800/50 text-white border-slate-600/30 hover:bg-slate-700/50"}`,children:l.jsxs("div",{className:"flex items-center justify-between",children:[l.jsxs("div",{className:"text-left",children:[l.jsx("div",{className:`font-bold text-lg ${n.name===s.name?"text-slate-900":"text-white"}`,children:s.name}),l.jsxs("div",{className:`text-sm ${n.name===s.name?"text-slate-600":"text-slate-400"}`,children:[s.inhale,"s inhale | ",s.exhale,"s exhale"]})]}),n.name===s.name&&l.jsx("div",{className:"w-6 h-6 bg-slate-900 rounded-full flex items-center justify-center",children:l.jsx("svg",{className:"w-4 h-4 text-white",fill:"currentColor",viewBox:"0 0 20 20",children:l.jsx("path",{fillRule:"evenodd",d:"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z",clipRule:"evenodd"})})})]})},s.name))}),l.jsx("button",{onClick:t,className:"w-full bg-slate-700/50 hover:bg-slate-600/50 text-white font-medium py-3 px-6 rounded-2xl transition-all duration-300 border border-slate-600/30",children:"Back to Setup"})]})},Z8=({selectedDuration:n,onSelect:e,onBack:t})=>{const[r,s]=D.useState(n),i=2,o=10;D.useEffect(()=>{s(n)},[n]);const a=f=>{const m=parseInt(f.target.value);s(m),navigator.vibrate&&navigator.vibrate(50),console.log(` Duration picker: Selected ${m} minutes`)},c=()=>{e(r)},u=f=>f<=3?"Short Session":f<=6?"Medium Session":f<=8?"Long Session":"Extended Session",h=f=>f<=3?"text-green-400":f<=6?"text-blue-400":f<=8?"text-orange-400":"text-red-400";return l.jsxs("div",{className:"p-8",children:[l.jsxs("div",{className:"text-center mb-8",children:[l.jsx("h2",{className:"text-2xl font-bold text-white mb-2",children:"DURATION"}),l.jsx("p",{className:"text-slate-400",children:"Choose your session length"})]}),l.jsxs("div",{className:"text-center mb-8",children:[l.jsxs("div",{className:`text-8xl font-bold ${h(r)} mb-2`,children:[r," mins"]}),l.jsx("div",{className:`text-xl font-medium ${h(r)}`,children:u(r)})]}),l.jsx("div",{className:"mb-8",children:l.jsx("input",{type:"range",min:i,max:o,step:1,value:r,onChange:a,style:{background:`linear-gradient(to right, #3b82f6 0%, #3b82f6 ${(r-i)/(o-i)*100}%, #475569 ${(r-i)/(o-i)*100}%, #475569 100%)`},className:"w-full h-4 rounded-lg appearance-none cursor-pointer slider mb-4",autoComplete:"off"})}),l.jsx("button",{onClick:c,className:"w-full bg-gradient-to-r from-green-600 to-green-700 hover:from-green-700 hover:to-green-800 text-white font-bold text-lg py-4 px-6 rounded-2xl transition-all duration-300 hover:scale-105 shadow-lg transform active:scale-95",children:"SAVE"}),l.jsx("button",{onClick:t,className:"w-full mt-4 bg-slate-700/50 hover:bg-slate-600/50 text-white font-medium py-3 px-6 rounded-2xl transition-all duration-300 border border-slate-600/30 hover:border-slate-500/50",children:"Back to Setup"})]})},eq=({rate:n,duration:e,onComplete:t,onClose:r,onLeave:s})=>{const[h,f]=D.useState(e*60),[m,y]=D.useState("inhale"),[w,S]=D.useState(0),[R,T]=D.useState(!1),[I,N]=D.useState(.1),[P,B]=D.useState(!1),[F,A]=D.useState(!1),x=D.useRef(null),E=D.useRef(null);D.useEffect(()=>{h===0&&R&&!F&&(console.log(" Exercise completed, calling onComplete"),A(!0),t())},[h,R,F,t]);const k=()=>{console.log(` Starting main timer for ${e} minutes`),E.current&&(console.log(" Timer already exists, clearing previous timer"),clearInterval(E.current)),E.current=setInterval(()=>{f(ee=>{if(ee<=1)return console.log(` Main exercise timer completed! Total duration: ${e} minutes`),clearInterval(E.current),E.current=null,0;const pe=ee-1;return pe%10===0&&console.log(` Main timer: ${pe}s remaining`),pe})},1e3),console.log(" Main timer started successfully")},C=()=>{console.log(` Starting breathing cycle with rate: inhale=${n.inhale}s, exhale=${n.exhale}s`),x.current&&(console.log(" Animation already running, clearing previous animation"),cancelAnimationFrame(x.current));const ee=n.inhale+n.exhale;let pe=0,xe=0,De="inhale";console.log(` Cycle duration: ${ee}s, starting animation loop...`);const Re=()=>{if(pe+=16,pe>=ee*1e3&&(console.log(` Breathing cycle completed, resetting to 0ms. Current phase: ${De}, phaseTime: ${w}`),pe=0,xe=0,De="inhale",y("inhale"),S(0)),pe<n.inhale*1e3){De!=="inhale"&&(console.log(` Switching to INHALE phase at ${pe}ms`),De="inhale",y("inhale"),S(0),xe=0);const _t=pe/(n.inhale*1e3),Ae=.1+_(_t)*3.9;N(Ae);const Pe=Math.floor(_t*n.inhale);Pe!==xe&&(S(Pe),xe=Pe,console.log(` INHALE: ${Pe}/${n.inhale}s (phase: ${De}, scale: ${Ae.toFixed(3)})`))}else{De!=="exhale"&&(console.log(` Switching to EXHALE phase at ${pe}ms`),De="exhale",y("exhale"),S(0),xe=0);const _t=(pe-n.inhale*1e3)/(n.exhale*1e3),Ae=4-_(_t)*3.9;N(Ae);const Pe=Math.floor(_t*n.exhale);Pe!==xe&&(S(Pe),xe=Pe,console.log(` EXHALE: ${Pe}/${n.exhale}s (phase: ${De}, scale: ${Ae.toFixed(3)})`))}x.current=requestAnimationFrame(Re)};Re(),console.log(" Breathing cycle animation started successfully")},_=ee=>ee<.5?2*ee*ee:-1+(4-2*ee)*ee;D.useEffect(()=>(R&&(k(),C()),()=>{R&&Q()}),[R]);const v=ee=>{const pe=Math.floor(ee/60),xe=ee%60;return`${pe.toString().padStart(2,"0")}:${xe.toString().padStart(2,"0")}`},V=()=>w,U=()=>m==="inhale"?"from-orange-400 to-red-500":"from-blue-400 to-cyan-500",ce=()=>m==="inhale"?"Inhale through the nose":"Exhale slowly through the mouth and empty your lungs",we=()=>{console.log(" User clicked close button, showing confirmation popup"),B(!0)},z=()=>{console.log(" User confirmed leaving exercise, cleaning up..."),Q(),s?s():r()},re=()=>{B(!1)},W=()=>{if(R){console.log(" Exercise already active, ignoring start request");return}console.log(` Starting breathing exercise: ${e} minutes, rate: ${n.name}`),console.log(` Initial state - isActive: ${R}, progress: ${I}, currentPhase: ${m}`),N(.1),y("inhale"),S(0),f(e*60),T(!0),console.log(" isActive set to true, starting timers..."),setTimeout(()=>{console.log(" Starting main timer and breathing cycle..."),k(),C()},0)},Q=()=>{console.log(" Cleaning up breathing exercise resources"),x.current&&(cancelAnimationFrame(x.current),x.current=null),E.current&&(clearInterval(E.current),E.current=null),T(!1),f(0),N(.1),y("inhale"),S(0)};return D.useEffect(()=>{R||(console.log(" Component mounted, starting breathing exercise automatically"),W())},[]),l.jsxs("div",{className:"h-screen bg-slate-900 flex flex-col",children:[l.jsxs("div",{className:"flex items-center justify-between p-6",children:[l.jsx("button",{onClick:we,className:"w-11 h-11 flex items-center justify-center text-white hover:text-slate-300 transition-colors bg-slate-800/50 hover:bg-slate-700/50 rounded-lg border border-slate-600/30 hover:border-slate-500/50 z-50 min-h-[44px] min-w-[44px]",title:"End breathing exercise",children:l.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:l.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})}),l.jsx("div",{className:"text-center",children:l.jsx("div",{className:"text-white text-2xl font-mono",children:v(h)})}),l.jsx("div",{className:"w-11"})," "]}),l.jsxs("div",{className:"flex-1 flex items-center justify-center relative",children:[l.jsx("div",{className:"absolute w-80 h-80 border-2 border-dashed border-white/30 rounded-full"}),l.jsx("div",{className:`w-20 h-20 bg-gradient-to-br ${U()} rounded-full shadow-2xl`,style:{transform:`scale(${I})`,transition:"none",boxShadow:`0 0 ${Math.max(I*40,10)}px ${Math.max(I*15,5)}px ${m==="inhale"?"rgba(251, 146, 60, 0.5)":"rgba(59, 130, 246, 0.5)"}`}})]}),l.jsxs("div",{className:"p-6 text-center",children:[l.jsx("div",{className:"flex items-center justify-center mb-4 h-16",children:l.jsx("span",{className:"text-white text-lg leading-tight",children:ce()})}),l.jsxs("div",{className:"text-slate-400 text-sm",children:[V(),"/",m==="inhale"?n.inhale:n.exhale,"s"]})]}),l.jsx("div",{className:"px-6 pb-6",children:l.jsx("div",{className:"w-full bg-slate-700/30 rounded-full h-1",children:l.jsx("div",{className:"bg-gradient-to-r from-blue-500 to-purple-500 h-1 rounded-full transition-all duration-1000 ease-out",style:{width:`${(e*60-h)/(e*60)*100}%`}})})}),P&&l.jsx("div",{className:"modal-backdrop",children:l.jsx("div",{className:"modal-container",children:l.jsxs("div",{className:"modal-content bg-slate-800 border-slate-600/50 max-w-sm",children:[l.jsxs("div",{className:"text-center mb-6",children:[l.jsx("h3",{className:"text-white text-xl font-bold mb-2",children:"Want to stop now?"}),l.jsx("p",{className:"text-slate-300 text-sm leading-relaxed",children:"Stay strong - resist the craving? If you leave now, you will not get the bonus points"})]}),l.jsxs("div",{className:"flex space-x-3",children:[l.jsx("button",{onClick:z,className:"flex-1 bg-red-600 hover:bg-red-700 text-white font-medium py-3 px-4 rounded-xl transition-colors min-h-[44px]",children:"Leave"}),l.jsx("button",{onClick:re,className:"flex-1 bg-green-600 hover:bg-green-700 text-white font-medium py-3 px-4 rounded-xl transition-colors min-h-[44px]",children:"Stay"})]})]})})})]})},tq=({isOpen:n,onClose:e,onNavigateToCravingSupport:t,onComplete:r})=>{const[s,i]=D.useState("setup"),[o,a]=D.useState({name:"INTERMEDIATE",inhale:10,exhale:20}),[c,u]=D.useState(4),[h,f]=D.useState(!1);D.useEffect(()=>{n&&(i("setup"),f(!1))},[n]);const m=I=>{a(I),i("setup")},y=I=>{u(I),i("setup")},w=()=>{f(!0),i("exercise")},S=()=>{f(!1),i("setup"),r&&r(),e()},R=()=>{s==="exercise"&&h||e()},T=()=>{console.log(" User leaving breathing exercise via close button"),e(),t&&t()};return n?l.jsxs("div",{className:"modal-backdrop",children:[l.jsx("div",{className:"absolute inset-0 bg-black/80 backdrop-blur-sm",onClick:R}),l.jsx("div",{className:"modal-container",children:l.jsxs("div",{className:"modal-content bg-slate-900 border-slate-700/50 max-w-md sm:max-w-2xl mx-auto w-full",children:[!(s==="exercise"&&h)&&l.jsx("button",{onClick:R,className:"absolute top-4 left-4 z-10 w-11 h-11 flex items-center justify-center text-white hover:text-slate-300 transition-colors min-h-[44px] min-w-[44px]",children:l.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:l.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})}),s==="setup"&&l.jsx(J8,{selectedRate:o,duration:c,onRateSelect:()=>i("rate"),onDurationSelect:()=>i("duration"),onStartExercise:w}),s==="rate"&&l.jsx(X8,{selectedRate:o,onSelect:m,onBack:()=>i("setup")}),s==="duration"&&l.jsx(Z8,{selectedDuration:c,onSelect:y,onBack:()=>i("setup")}),s==="exercise"&&l.jsx(eq,{rate:o,duration:c,onComplete:S,onClose:R,onLeave:T})]})})]}):null},nq=({user:n,behavioralService:e,onClose:t})=>{const[r,s]=D.useState(null),[i,o]=D.useState(!0),[a,c]=D.useState(30);D.useEffect(()=>{e&&(n!=null&&n.uid)&&u()},[e,n==null?void 0:n.uid,a]);const u=async()=>{try{o(!0);try{const h=await e.getUserAnalytics(n.uid,a);s(h)}catch(h){console.warn("Full analytics not available (indexes building), using basic analytics:",h.message);const f=await e.getBasicAnalytics(n.uid);s(f)}}catch(h){console.error("Error loading analytics:",h)}finally{o(!1)}};return e?l.jsx("div",{className:"modal-backdrop",children:l.jsx("div",{className:"modal-container",children:l.jsx("div",{className:"modal-content bg-slate-800 max-w-4xl",children:l.jsxs("div",{className:"modal-scrollable",children:[l.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-slate-700",children:[l.jsxs("div",{className:"flex items-center gap-3",children:[l.jsx(pp,{className:"w-6 h-6 text-blue-400"}),l.jsx("h2",{className:"text-xl font-bold text-white",children:"Behavioral Analytics"})]}),l.jsxs("div",{className:"flex items-center gap-4",children:[l.jsxs("select",{value:a,onChange:h=>c(parseInt(h.target.value)),className:"bg-slate-700 text-white px-3 py-3 rounded border border-slate-600 min-h-[44px]",children:[l.jsx("option",{value:7,children:"Last 7 days"}),l.jsx("option",{value:30,children:"Last 30 days"}),l.jsx("option",{value:90,children:"Last 90 days"})]}),l.jsx("button",{onClick:t,className:"text-gray-400 hover:text-white w-11 h-11 flex items-center justify-center min-h-[44px] min-w-[44px]",children:""})]})]}),l.jsx("div",{className:"p-6",children:i?l.jsxs("div",{className:"text-center py-8",children:[l.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-400 mx-auto mb-4"}),l.jsx("p",{className:"text-gray-300",children:"Loading behavioral analytics..."})]}):r?l.jsxs("div",{className:"space-y-6",children:[l.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[l.jsx("div",{className:"bg-slate-700 rounded-lg p-4",children:l.jsxs("div",{className:"flex items-center gap-3",children:[l.jsx(C8,{className:"w-5 h-5 text-green-400"}),l.jsxs("div",{children:[l.jsx("p",{className:"text-gray-300 text-sm",children:"Craving Resistance"}),l.jsx("p",{className:"text-white font-bold",children:r.cravingStats.total>0?`${(r.cravingStats.resisted/r.cravingStats.total*100).toFixed(1)}%`:"No data"})]})]})}),l.jsx("div",{className:"bg-slate-700 rounded-lg p-4",children:l.jsxs("div",{className:"flex items-center gap-3",children:[l.jsx(k8,{className:"w-5 h-5 text-blue-400"}),l.jsxs("div",{children:[l.jsx("p",{className:"text-gray-300 text-sm",children:"Wellness Activities"}),l.jsx("p",{className:"text-white font-bold",children:r.wellnessStats.totalWellnessActivities})]})]})}),l.jsx("div",{className:"bg-slate-700 rounded-lg p-4",children:l.jsxs("div",{className:"flex items-center gap-3",children:[l.jsx(i2,{className:"w-5 h-5 text-purple-400"}),l.jsxs("div",{children:[l.jsx("p",{className:"text-gray-300 text-sm",children:"Relapses"}),l.jsx("p",{className:"text-white font-bold",children:r.relapseStats.total})]})]})}),l.jsx("div",{className:"bg-slate-700 rounded-lg p-4",children:l.jsxs("div",{className:"flex items-center gap-3",children:[l.jsx("span",{className:"text-orange-400",children:""}),l.jsxs("div",{children:[l.jsx("p",{className:"text-gray-300 text-sm",children:"Hydration Days"}),l.jsx("p",{className:"text-white font-bold",children:r.wellnessStats.hydrationDays})]})]})})]}),l.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[l.jsxs("div",{className:"bg-slate-700 rounded-lg p-4",children:[l.jsx("h3",{className:"text-lg font-semibold text-white mb-4",children:"Craving Patterns"}),l.jsxs("div",{className:"space-y-3",children:[l.jsxs("div",{children:[l.jsx("p",{className:"text-gray-300 text-sm",children:"Total Cravings"}),l.jsx("p",{className:"text-white font-bold",children:r.cravingStats.total})]}),l.jsxs("div",{children:[l.jsx("p",{className:"text-gray-300 text-sm",children:"Average Strength"}),l.jsxs("p",{className:"text-white font-bold",children:[r.cravingStats.averageStrength.toFixed(1),"/10"]})]}),l.jsxs("div",{children:[l.jsx("p",{className:"text-gray-300 text-sm",children:"Common Triggers"}),l.jsx("div",{className:"space-y-1",children:r.cravingStats.commonTriggers.slice(0,3).map((h,f)=>l.jsxs("p",{className:"text-blue-400 text-sm",children:[h.trigger," (",h.count,"x)"]},f))})]})]})]}),l.jsxs("div",{className:"bg-slate-700 rounded-lg p-4",children:[l.jsx("h3",{className:"text-lg font-semibold text-white mb-4",children:"Wellness Activities"}),l.jsxs("div",{className:"space-y-3",children:[l.jsxs("div",{className:"flex justify-between",children:[l.jsx("span",{className:"text-gray-300",children:" Breathing Exercises"}),l.jsx("span",{className:"text-white font-bold",children:r.wellnessStats.breathingExercises})]}),l.jsxs("div",{className:"flex justify-between",children:[l.jsx("span",{className:"text-gray-300",children:" Meditation Sessions"}),l.jsx("span",{className:"text-white font-bold",children:r.wellnessStats.meditationSessions})]}),l.jsxs("div",{className:"flex justify-between",children:[l.jsx("span",{className:"text-gray-300",children:" Physical Activities"}),l.jsx("span",{className:"text-white font-bold",children:r.wellnessStats.physicalActivities})]}),l.jsxs("div",{className:"flex justify-between",children:[l.jsx("span",{className:"text-gray-300",children:" Hydration Goals Met"}),l.jsx("span",{className:"text-white font-bold",children:r.wellnessStats.hydrationDays})]})]})]}),l.jsxs("div",{className:"bg-slate-700 rounded-lg p-4",children:[l.jsx("h3",{className:"text-lg font-semibold text-white mb-4",children:"Time Patterns"}),l.jsxs("div",{className:"space-y-2",children:[l.jsx("p",{className:"text-gray-300 text-sm",children:"Peak Craving Hours"}),r.cravingStats.timePatterns.map((h,f)=>l.jsxs("div",{className:"flex justify-between",children:[l.jsxs("span",{className:"text-blue-400",children:[h.hour,":00"]}),l.jsxs("span",{className:"text-white",children:[h.count," cravings"]})]},f))]})]}),l.jsxs("div",{className:"bg-slate-700 rounded-lg p-4",children:[l.jsx("h3",{className:"text-lg font-semibold text-white mb-4",children:"AI Insights"}),l.jsxs("div",{className:"space-y-2",children:[r.insights.map((h,f)=>l.jsxs("p",{className:"text-gray-300 text-sm",children:[" ",h]},f)),r.insights.length===0&&l.jsx("p",{className:"text-gray-400 text-sm italic",children:"More insights will appear as you track more activities."})]})]})]}),l.jsxs("div",{className:"bg-slate-700 rounded-lg p-4",children:[l.jsx("h3",{className:"text-lg font-semibold text-white mb-4",children:" System Status"}),l.jsxs("div",{className:"space-y-2 mb-4",children:[l.jsxs("div",{className:"flex items-center gap-2",children:[l.jsx("span",{className:"w-3 h-3 bg-green-500 rounded-full"}),l.jsx("span",{className:"text-gray-300 text-sm",children:"Behavioral Service Connected"})]}),l.jsxs("div",{className:"flex items-center gap-2",children:[l.jsx("span",{className:"w-3 h-3 bg-yellow-500 rounded-full animate-pulse"}),l.jsx("span",{className:"text-gray-300 text-sm",children:"Database Indexes Building (may take 5-10 minutes)"})]}),l.jsxs("div",{className:"flex items-center gap-2",children:[l.jsx("span",{className:"w-3 h-3 bg-blue-500 rounded-full"}),l.jsx("span",{className:"text-gray-300 text-sm",children:"Data Logging Active"})]})]}),l.jsx("p",{className:"text-gray-400 text-xs",children:"Full analytics will be available once indexes are built. Basic analytics are shown in the meantime."})]}),l.jsxs("div",{className:"bg-slate-700 rounded-lg p-4",children:[l.jsx("h3",{className:"text-lg font-semibold text-white mb-4",children:"Data Export"}),l.jsx("p",{className:"text-gray-300 text-sm mb-4",children:"All your behavioral data is stored in Firestore for predictive analytics and research purposes."}),l.jsx("button",{onClick:()=>{const h=new Blob([JSON.stringify(r,null,2)],{type:"application/json"}),f=URL.createObjectURL(h),m=document.createElement("a");m.href=f,m.download=`behavioral-analytics-${n.heroName}-${new Date().toISOString().split("T")[0]}.json`,m.click(),URL.revokeObjectURL(f)},className:"bg-green-600 hover:bg-green-700 text-white px-4 py-3 rounded transition-colors min-h-[44px]",children:"Export Analytics Data"})]})]}):l.jsxs("div",{className:"text-center py-8",children:[l.jsx("p",{className:"text-gray-300",children:"No analytics data available."}),l.jsx("p",{className:"text-gray-400 text-sm mt-2",children:"Start tracking activities to see insights!"})]})})]})})})}):l.jsx("div",{className:"modal-backdrop",children:l.jsx("div",{className:"modal-container",children:l.jsxs("div",{className:"modal-content bg-slate-800 p-6",children:[l.jsx("h2",{className:"text-xl font-bold text-white mb-4",children:"Analytics Dashboard"}),l.jsx("p",{className:"text-gray-300",children:"Behavioral service not available. Analytics require Firestore connection."}),l.jsx("button",{onClick:t,className:"mt-4 bg-blue-600 hover:bg-blue-700 text-white px-4 py-3 rounded transition-colors min-h-[44px]",children:"Close"})]})})})},Jo=(n,e="adventurer")=>{const t="https://api.dicebear.com/7.x",r={seed:n||Math.random().toString(36).substring(7),backgroundColor:["b6e3f4","c0aede","ffdfbf","ffd5dc"],radius:50,size:200},s=new URLSearchParams(r).toString();return`${t}/${e}/svg?${s}`},Ef=n=>{const e=["#3B82F6","#10B981","#F59E0B","#EF4444","#8B5CF6","#EC4899"],t=e[n.charCodeAt(0)%e.length],r=n.substring(0,2).toUpperCase();return`data:image/svg+xml,${encodeURIComponent(`
    <svg width="200" height="200" xmlns="http://www.w3.org/2000/svg">
      <rect width="200" height="200" fill="${t}"/>
      <text x="100" y="120" font-family="Arial, sans-serif" font-size="80" font-weight="bold" text-anchor="middle" fill="white">${r}</text>
    </svg>
  `)}`},bf=n=>n<=3?"#ef4444":n<=6?"#fbbf24":n<=9?"#84cc16":"#22c55e",Qs=(n,e=new Date)=>{const t=e.getTime()-n.getTime(),r=Math.floor(t/(1e3*3600)),s=Math.floor(t/(1e3*3600*24));return r<24?{value:Math.max(0,r),unit:"hours",displayText:`${Math.max(0,r)} hour${r===1?"":"s"}`}:{value:Math.max(0,s),unit:"days",displayText:`${Math.max(0,s)} day${s===1?"":"s"}`}},rq=({onComplete:n,authUser:e,pwaInstallAvailable:t,promptInstall:r})=>{const[s,i]=D.useState(1),[o,a]=D.useState({heroName:"",quitDate:new Date().toISOString().split("T")[0],archetype:"",avatar:null,avatarSeed:Math.random().toString(36).substring(7),triggers:[],dailyPatterns:[],copingStrategies:[],vapePodsPerWeek:0,nicotineStrength:"",quitAttempts:"",confidence:5}),[c,u]=D.useState(!1),[h,f]=D.useState(!1),[m,y]=D.useState(null),[w,S]=D.useState(null),R=[{id:"DETERMINED",name:"The Determined",description:"Unstoppable willpower and determination",color:"bg-red-500",icon:Us},{id:"SOCIAL_FIGHTER",name:"The Social Fighter",description:"Thrives on community support",color:"bg-blue-500",icon:lS},{id:"HEALTH_WARRIOR",name:"The Health Warrior",description:"Focused on physical and mental wellness",color:"bg-green-500",icon:a2},{id:"MONEY_SAVER",name:"The Money Saver",description:"Motivated by financial freedom",color:"bg-yellow-500",icon:o2}],T=["Stress/anxiety","Social situations","Boredom","After meals","Drinking alcohol","Work breaks","Driving"],I=["Morning routine","Work breaks","After meals","Evening wind-down","Social events","Throughout the day"],N=["Breathing exercises","Nicotine replacement therapy","Exercise/physical activity","Distraction techniques","Nothing - this is new to me"],P=()=>{console.log("Calculating stats with userData:",o);let _=40;o.vapePodsPerWeek<=1?_+=5:o.vapePodsPerWeek<=3?_+=15:o.vapePodsPerWeek<=5?_+=25:o.vapePodsPerWeek<=7?_+=35:_+=40;const v=o.nicotineStrength||"",V=parseInt(v.replace("mg",""))||0;V<=5?_+=0:V<=11?_+=10:V<=20?_+=20:_+=25,o.dailyPatterns.includes("Throughout the day")?_+=20:o.dailyPatterns.length>2?_+=10:_+=0,_=Math.min(_,100);let U=25;o.confidence>=9?U+=35:o.confidence>=7?U+=25:o.confidence>=4?U+=15:U+=0,o.quitAttempts==="first"?U+=15:parseInt(o.quitAttempts)<=3?U+=10:U+=5,o.copingStrategies.length>=3?U+=15:o.copingStrategies.length>=1?U+=10:U+=0,U=Math.min(U,80);let ce=35;ce+={DETERMINED:20,HEALTH_WARRIOR:15,SOCIAL_FIGHTER:15,MONEY_SAVER:10}[o.archetype]||0,o.confidence>=8?ce+=25:o.confidence>=5?ce+=15:ce+=0,o.quitAttempts==="first"?ce+=10:parseInt(o.quitAttempts)<=3?ce+=5:ce+=15,ce=Math.min(ce,90);let z=15;o.triggers.length<=2?z+=15:o.triggers.length<=4?z+=10:z+=5;const re=o.triggers.includes("Drinking alcohol"),W=o.triggers.includes("Social situations");return re&&W?z+=0:o.triggers.length>3?z+=5:z+=10,o.copingStrategies.length>=3?z+=25:o.copingStrategies.length>=1?z+=15:z+=0,o.dailyPatterns.includes("Throughout the day")?z+=0:o.dailyPatterns.length>2?z+=5:z+=10,z=Math.min(z,60),{addictionLevel:_,mentalStrength:U,motivation:ce,triggerDefense:z}},B=_=>{const v=_.target.files[0];if(v){y(v);const V=new FileReader;V.onload=U=>S(U.target.result),V.readAsDataURL(v)}},F=async()=>{if(m){f(!0);try{const _=document.createElement("canvas"),v=_.getContext("2d"),V=new Image;V.onload=()=>{_.width=200,_.height=200,v.filter="contrast(1.2) saturate(1.3) brightness(1.1)",v.drawImage(V,0,0,200,200),v.globalCompositeOperation="overlay",v.fillStyle="rgba(255, 200, 200, 0.1)",v.fillRect(0,0,200,200);const U=_.toDataURL("image/png"),ce={...o,avatar:U};a(ce),C(ce,3),f(!1)},V.src=w}catch(_){console.error("Photo processing failed:",_);const v=Ef(o.avatarSeed);a(V=>({...V,avatar:v})),f(!1)}}},A=()=>{u(!0);const _=Math.random().toString(36).substring(7);(async()=>{try{const V=Jo(_),U={...o,avatarSeed:_,avatar:V};a(U),C(U,3)}catch{const U=Ef(_),ce={...o,avatarSeed:_,avatar:U};a(ce),C(ce,3)}})(),setTimeout(()=>u(!1),500)},x=async()=>{if(s<11)await C(o,s),i(s+1);else try{console.log("Completing onboarding with userData:",o);const _=P();console.log("Calculated stats:",_);const v={...o,stats:{..._,streakDays:0,experiencePoints:0},achievements:[],quitDate:new Date};await C(v,10),console.log("Final user data:",v),n(v)}catch(_){console.error("Error completing onboarding:",_);const V={...o,stats:{...{addictionLevel:50,mentalStrength:50,motivation:50,triggerDefense:30},streakDays:0,experiencePoints:0},achievements:[],quitDate:new Date};try{await C(V,10)}catch(U){console.error("Failed to save fallback data to Firebase:",U)}console.log("Using fallback stats:",V),n(V)}},E=()=>{s>1&&i(s-1)},k=()=>{switch(s){case 1:return o.heroName.trim().length>0;case 2:return o.quitDate!=="";case 3:return o.archetype!=="";case 4:return o.avatar!==null;case 5:return o.triggers.length>0;case 6:return o.dailyPatterns.length>0;case 7:return o.copingStrategies.length>0;case 8:return o.vapePodsPerWeek>0;case 9:return o.nicotineStrength!=="";case 10:return o.quitAttempts!=="";case 11:return o.confidence>0;default:return!1}},C=async(_,v)=>{if(e)try{const{ref:V,set:U}=await Ve(()=>import("./index.esm-ebdb357d.js"),[]),ce=V(H,`users/${e.uid}/onboarding`);await U(V(H,`users/${e.uid}/onboarding/step${v}`),{..._,stepNumber:v,timestamp:Date.now()}),await U(V(H,`users/${e.uid}/onboarding/progress`),{currentStep:v,completedSteps:Array.from({length:v},(we,z)=>z+1),lastUpdated:Date.now()}),console.log(`Step ${v} saved to Firebase successfully`)}catch(V){console.error(`Error saving step ${v} to Firebase:`,V)}};return D.useEffect(()=>{if(!o.avatar){const _=Jo(o.avatarSeed);a(v=>({...v,avatar:_}))}},[]),l.jsx("div",{className:"min-h-screen bg-gradient-to-br from-slate-900 via-blue-900 to-slate-900 flex items-center justify-center p-4",children:l.jsxs("div",{className:"bg-slate-800/80 backdrop-blur-sm rounded-2xl p-8 max-w-md w-full shadow-2xl border border-slate-700",children:[t&&l.jsxs("div",{className:"mb-4 p-3 rounded-lg border border-blue-600 bg-blue-900/40 text-blue-100 flex items-center justify-between",children:[l.jsx("div",{className:"mr-3",children:"Install QuitArena for a faster, full-screen experience."}),l.jsx("button",{onClick:r,className:"px-4 py-3 rounded-md bg-blue-600 hover:bg-blue-500 text-white text-sm font-semibold min-h-[44px] min-w-[44px]",children:"Install"})]}),l.jsx("div",{className:"flex justify-between items-center mb-8 overflow-x-auto",children:[1,2,3,4,5,6,7,8,9,10,11].map(_=>l.jsxs("div",{className:"flex items-center flex-shrink-0",children:[l.jsx("div",{className:`w-6 h-6 rounded-full flex items-center justify-center text-xs font-bold ${_<=s?"bg-blue-500 text-white":"bg-slate-600 text-gray-400"}`,children:_<s?"":_}),_<11&&l.jsx("div",{className:`w-4 h-1 mx-1 ${_<s?"bg-blue-500":"bg-slate-600"}`})]},_))}),s===1&&l.jsxs("div",{className:"text-center",children:[l.jsx("div",{className:"w-20 h-20 bg-gradient-to-br from-blue-400 to-blue-600 rounded-full flex items-center justify-center mx-auto mb-6",children:l.jsx(A8,{className:"w-10 h-10 text-white"})}),l.jsx("h1",{className:"text-2xl font-bold text-white mb-4",children:"Welcome to QuitCard Arena"}),l.jsx("p",{className:"text-gray-300 mb-6",children:"Your journey to freedom starts here. Let's create your hero identity."}),l.jsxs("div",{className:"mb-6",children:[l.jsx("label",{className:"block text-left text-white text-sm font-medium mb-2",children:"What's your hero name?"}),l.jsx("input",{type:"text",value:o.heroName,onChange:_=>{const v={...o,heroName:_.target.value};a(v),_.target.value.trim().length>0&&C(v,1)},placeholder:"e.g., FreedomSeeker, HealthGuardian",autoComplete:"name",className:"w-full px-4 py-3 bg-slate-700 border border-slate-600 rounded-lg text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]})]}),s===2&&l.jsxs("div",{className:"text-center",children:[l.jsx("div",{className:"w-20 h-20 bg-gradient-to-br from-green-400 to-green-600 rounded-full flex items-center justify-center mx-auto mb-6",children:l.jsx("span",{className:"text-3xl",children:""})}),l.jsx("h1",{className:"text-2xl font-bold text-white mb-4",children:"When Did You Start Your Quit Journey?"}),l.jsx("p",{className:"text-gray-300 mb-6",children:"Select the date you began or plan to begin your vape-free life."}),l.jsxs("div",{className:"mb-6",children:[l.jsx("label",{className:"block text-left text-white text-sm font-medium mb-2",children:"Quit Date"}),l.jsx("input",{type:"date",value:o.quitDate,max:new Date().toISOString().split("T")[0],onChange:_=>{const v={...o,quitDate:_.target.value};a(v),_.target.value&&C(v,2)},className:"w-full px-4 py-3 bg-slate-700 border border-slate-600 rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-green-500 focus:border-transparent"}),l.jsx("p",{className:"text-gray-400 text-xs mt-2 text-left",children:" You can select today or a past date if you've already started"})]})]}),s===3&&l.jsxs("div",{className:"text-center",children:[l.jsx("div",{className:"w-20 h-20 bg-gradient-to-br from-purple-400 to-purple-600 rounded-full flex items-center justify-center mx-auto mb-6",children:l.jsx(Us,{className:"w-10 h-10 text-white"})}),l.jsx("h1",{className:"text-2xl font-bold text-white mb-4",children:"Choose Your Archetype"}),l.jsx("p",{className:"text-gray-300 mb-6",children:"Select the warrior type that resonates with your journey."}),l.jsx("div",{className:"space-y-3 mb-6",children:R.map(_=>{const v=_.icon;return l.jsx("button",{onClick:()=>{const V={...o,archetype:_.id};a(V),C(V,11)},className:`w-full p-4 rounded-lg border-2 transition-all duration-300 text-left ${o.archetype===_.id?"border-blue-500 bg-blue-500/20":"border-slate-600 bg-slate-700 hover:border-slate-500"}`,children:l.jsxs("div",{className:"flex items-center gap-3",children:[l.jsx("div",{className:`w-10 h-10 ${_.color} rounded-lg flex items-center justify-center`,children:l.jsx(v,{className:"w-5 h-5 text-white"})}),l.jsxs("div",{children:[l.jsx("h3",{className:"text-white font-semibold",children:_.name}),l.jsx("p",{className:"text-gray-400 text-sm",children:_.description})]})]})},_.id)})})]}),s===4&&l.jsxs("div",{className:"text-center",children:[l.jsx("div",{className:"w-20 h-20 bg-gradient-to-br from-purple-400 to-purple-600 rounded-full flex items-center justify-center mx-auto mb-6",children:l.jsx(d2,{className:"w-10 h-10 text-white"})}),l.jsx("h1",{className:"text-2xl font-bold text-white mb-4",children:"Create Your Avatar"}),l.jsx("p",{className:"text-gray-300 mb-6",children:"Choose your battle card identity in the arena."}),l.jsxs("div",{className:"mb-6",children:[l.jsx("div",{className:"w-32 h-32 mx-auto mb-4 rounded-full overflow-hidden border-4 border-slate-600 bg-slate-700",children:o.avatar?l.jsx("img",{src:o.avatar,alt:"Avatar",className:"w-full h-full object-cover",onError:()=>{a(_=>({..._,avatar:Ef(_.avatarSeed)}))}}):l.jsx("div",{className:"w-full h-full flex items-center justify-center",children:l.jsx(Ds,{className:"w-8 h-8 text-gray-400 animate-spin"})})}),l.jsxs("div",{className:"space-y-3",children:[l.jsxs("div",{className:"mb-4",children:[l.jsx("label",{className:"block text-white text-sm font-medium mb-2",children:"Upload Your Photo"}),l.jsx("input",{type:"file",accept:"image/*",onChange:B,className:"hidden",id:"photo-upload",autoComplete:"photo"}),l.jsx("label",{htmlFor:"photo-upload",className:"w-full px-6 py-3 bg-green-600 hover:bg-green-700 text-white rounded-lg transition-colors flex items-center gap-2 justify-center cursor-pointer",children:" Upload Photo"})]}),w&&l.jsx("div",{className:"mb-4",children:l.jsx("button",{onClick:F,disabled:h,className:"w-full px-6 py-3 bg-purple-600 hover:bg-purple-700 disabled:bg-purple-800 text-white rounded-lg transition-colors flex items-center gap-2 justify-center",children:h?l.jsxs(l.Fragment,{children:[l.jsx(Ds,{className:"w-4 h-4 animate-spin"}),"Converting to Anime..."]}):l.jsx(l.Fragment,{children:" Convert to Anime"})})}),l.jsx("div",{className:"text-gray-400 text-sm",children:"- OR -"}),l.jsx("button",{onClick:A,disabled:c,className:"w-full px-6 py-3 bg-slate-600 hover:bg-slate-500 disabled:bg-slate-700 text-white rounded-lg transition-colors flex items-center gap-2 justify-center",children:c?l.jsxs(l.Fragment,{children:[l.jsx(Ds,{className:"w-4 h-4 animate-spin"}),"Generate Random Avatar"]}):l.jsxs(l.Fragment,{children:[l.jsx(Ds,{className:"w-4 h-4"}),"Generate Random Avatar"]})}),l.jsx("button",{onClick:()=>{const _=Ef(o.avatarSeed),v={...o,avatar:_};a(v),C(v,3)},className:"w-full px-6 py-3 bg-blue-600 hover:bg-blue-700 text-white rounded-lg transition-colors",children:"Use Fallback Avatar"})]})]})]}),s===5&&l.jsxs("div",{className:"text-center",children:[l.jsx("div",{className:"w-20 h-20 bg-gradient-to-br from-orange-400 to-orange-600 rounded-full flex items-center justify-center mx-auto mb-6",children:l.jsx("span",{className:"text-2xl",children:""})}),l.jsx("h1",{className:"text-2xl font-bold text-white mb-4",children:"Trigger Identification"}),l.jsx("p",{className:"text-gray-300 mb-6",children:"What usually makes you want to vape? (Select all that apply)"}),l.jsx("div",{className:"space-y-3 mb-6",children:T.map(_=>l.jsx("button",{onClick:()=>{const v={...o,triggers:o.triggers.includes(_)?o.triggers.filter(V=>V!==_):[...o.triggers,_]};a(v),C(v,11)},className:`w-full p-4 rounded-lg border-2 transition-all duration-300 text-left ${o.triggers.includes(_)?"border-blue-500 bg-blue-500/20":"border-slate-600 bg-slate-700 hover:border-slate-500"}`,children:l.jsxs("div",{className:"flex items-center gap-3",children:[l.jsx("div",{className:`w-6 h-6 rounded border-2 flex items-center justify-center ${o.triggers.includes(_)?"bg-blue-500 border-blue-500":"border-gray-400"}`,children:o.triggers.includes(_)&&l.jsx("span",{className:"text-white text-sm",children:""})}),l.jsx("span",{className:"text-white font-semibold",children:_})]})},_))})]}),s===6&&l.jsxs("div",{className:"text-center",children:[l.jsx("div",{className:"w-20 h-20 bg-gradient-to-br from-indigo-400 to-indigo-600 rounded-full flex items-center justify-center mx-auto mb-6",children:l.jsx("span",{className:"text-2xl",children:""})}),l.jsx("h1",{className:"text-2xl font-bold text-white mb-4",children:"Daily Routine"}),l.jsx("p",{className:"text-gray-300 mb-6",children:"When do you vape most? (Select all that apply)"}),l.jsx("div",{className:"space-y-3 mb-6",children:I.map(_=>l.jsx("button",{onClick:()=>{const v={...o,dailyPatterns:o.dailyPatterns.includes(_)?o.dailyPatterns.filter(V=>V!==_):[...o.dailyPatterns,_]};a(v),C(v,11)},className:`w-full p-4 rounded-lg border-2 transition-all duration-300 text-left ${o.dailyPatterns.includes(_)?"border-blue-500 bg-blue-500/20":"border-slate-600 bg-slate-700 hover:border-slate-500"}`,children:l.jsxs("div",{className:"flex items-center gap-3",children:[l.jsx("div",{className:`w-6 h-6 rounded border-2 flex items-center justify-center ${o.dailyPatterns.includes(_)?"bg-blue-500 border-blue-500":"border-gray-400"}`,children:o.dailyPatterns.includes(_)&&l.jsx("span",{className:"text-white text-sm",children:""})}),l.jsx("span",{className:"text-white font-semibold",children:_})]})},_))})]}),s===7&&l.jsxs("div",{className:"text-center",children:[l.jsx("div",{className:"w-20 h-20 bg-gradient-to-br from-teal-400 to-teal-600 rounded-full flex items-center justify-center mx-auto mb-6",children:l.jsx("span",{className:"text-2xl",children:""})}),l.jsx("h1",{className:"text-2xl font-bold text-white mb-4",children:"Coping Experience"}),l.jsx("p",{className:"text-gray-300 mb-6",children:"Have you tried any of these strategies before? (Select all that apply)"}),l.jsx("div",{className:"space-y-3 mb-6",children:N.map(_=>l.jsx("button",{onClick:()=>{const v={...o,copingStrategies:o.copingStrategies.includes(_)?o.copingStrategies.filter(V=>V!==_):[...o.copingStrategies,_]};a(v),C(v,11)},className:`w-full p-4 rounded-lg border-2 transition-all duration-300 text-left ${o.copingStrategies.includes(_)?"border-blue-500 bg-blue-500/20":"border-slate-600 bg-slate-700 hover:border-slate-500"}`,children:l.jsxs("div",{className:"flex items-center gap-3",children:[l.jsx("div",{className:`w-6 h-6 rounded border-2 flex items-center justify-center ${o.copingStrategies.includes(_)?"bg-blue-500 border-blue-500":"border-gray-400"}`,children:o.copingStrategies.includes(_)&&l.jsx("span",{className:"text-white text-sm",children:""})}),l.jsx("span",{className:"text-white font-semibold",children:_})]})},_))})]}),s===8&&l.jsxs("div",{className:"text-center",children:[l.jsx("div",{className:"w-20 h-20 bg-gradient-to-br from-red-400 to-red-600 rounded-full flex items-center justify-center mx-auto mb-6",children:l.jsx("span",{className:"text-2xl",children:""})}),l.jsx("h1",{className:"text-2xl font-bold text-white mb-4",children:"Vape Usage"}),l.jsx("p",{className:"text-gray-300 mb-6",children:"How many vape pods do you typically use per week?"}),l.jsx("div",{className:"mb-6",children:l.jsxs("select",{value:o.vapePodsPerWeek,onChange:_=>{const v={...o,vapePodsPerWeek:parseFloat(_.target.value)||0};a(v),v.vapePodsPerWeek>0&&C(v,11)},className:"w-full px-4 py-3 bg-slate-700 border border-slate-600 rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-red-500 focus:border-transparent",children:[l.jsx("option",{value:"",children:"Select pods per week"}),l.jsx("option",{value:"0.5",children:"0.5 pods"}),l.jsx("option",{value:"1",children:"1 pod"}),l.jsx("option",{value:"2",children:"2 pods"}),l.jsx("option",{value:"3",children:"3 pods"}),l.jsx("option",{value:"4",children:"4 pods"}),l.jsx("option",{value:"5",children:"5 pods"}),l.jsx("option",{value:"6",children:"6 pods"}),l.jsx("option",{value:"7",children:"7 pods"}),l.jsx("option",{value:"8",children:"8+ pods"})]})})]}),s===9&&l.jsxs("div",{className:"text-center",children:[l.jsx("div",{className:"w-20 h-20 bg-gradient-to-br from-orange-400 to-orange-600 rounded-full flex items-center justify-center mx-auto mb-6",children:l.jsx("span",{className:"text-2xl",children:""})}),l.jsx("h1",{className:"text-2xl font-bold text-white mb-4",children:"Nicotine Strength"}),l.jsx("p",{className:"text-gray-300 mb-6",children:"What nicotine strength do you typically use?"}),l.jsx("div",{className:"mb-6",children:l.jsxs("select",{value:o.nicotineStrength,onChange:_=>{const v={...o,nicotineStrength:_.target.value};a(v),v.nicotineStrength&&C(v,11)},className:"w-full px-4 py-3 bg-slate-700 border border-slate-600 rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-orange-500 focus:border-transparent",children:[l.jsx("option",{value:"",children:"Select nicotine strength"}),l.jsx("option",{value:"3mg",children:"3mg"}),l.jsx("option",{value:"6mg",children:"6mg"}),l.jsx("option",{value:"12mg",children:"12mg"}),l.jsx("option",{value:"18mg",children:"18mg"}),l.jsx("option",{value:"20mg",children:"20mg"}),l.jsx("option",{value:"50mg",children:"50mg"})]})})]}),s===10&&l.jsxs("div",{className:"text-center",children:[l.jsx("div",{className:"w-20 h-20 bg-gradient-to-br from-blue-400 to-blue-600 rounded-full flex items-center justify-center mx-auto mb-6",children:l.jsx("span",{className:"text-2xl",children:""})}),l.jsx("h1",{className:"text-2xl font-bold text-white mb-4",children:"Previous Attempts"}),l.jsx("p",{className:"text-gray-300 mb-6",children:"How many times have you tried to quit before?"}),l.jsx("div",{className:"mb-6",children:l.jsxs("select",{value:o.quitAttempts,onChange:_=>{const v={...o,quitAttempts:_.target.value};a(v),v.quitAttempts&&C(v,11)},className:"w-full px-4 py-3 bg-slate-700 border border-slate-600 rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[l.jsx("option",{value:"",children:"Select option"}),l.jsx("option",{value:"first",children:"This is my first attempt"}),l.jsx("option",{value:"1",children:"Once before"}),l.jsx("option",{value:"2",children:"Twice before"}),l.jsx("option",{value:"3",children:"3-5 times"}),l.jsx("option",{value:"5",children:"More than 5 times"})]})})]}),s===11&&l.jsxs("div",{className:"text-center",children:[l.jsx("div",{className:"w-20 h-20 bg-gradient-to-br from-green-400 to-green-600 rounded-full flex items-center justify-center mx-auto mb-6",children:l.jsx("span",{className:"text-2xl",children:""})}),l.jsx("h1",{className:"text-2xl font-bold text-white mb-4",children:"Confidence Level"}),l.jsx("p",{className:"text-gray-300 mb-6",children:"How confident are you this time? (1-10 scale)"}),l.jsxs("div",{className:"mb-6",children:[l.jsxs("div",{className:"flex items-center gap-4",children:[l.jsx("span",{className:"text-gray-400 text-sm",children:"1"}),l.jsx("input",{type:"range",min:"1",max:"10",value:o.confidence,onChange:_=>{const v={...o,confidence:parseInt(_.target.value)};a(v),C(v,11)},className:"flex-1 h-2 rounded-lg appearance-none cursor-pointer slider",style:{background:`linear-gradient(to right, ${bf(o.confidence)} 0%, ${bf(o.confidence)} ${o.confidence/10*100}%, #475569 ${o.confidence/10*100}%, #475569 100%)`},autoComplete:"off"}),l.jsx("span",{className:"text-gray-400 text-sm",children:"10"})]}),l.jsxs("div",{className:"text-center mt-4",children:[l.jsx("span",{className:"font-bold text-4xl",style:{color:bf(o.confidence)},children:o.confidence}),l.jsx("span",{className:"text-gray-400 text-lg ml-2",children:"/ 10"})]}),l.jsx("div",{className:"text-center mt-2",children:l.jsx("span",{className:"text-sm font-medium",style:{color:bf(o.confidence)},children:o.confidence<=3?"You can do this! ":o.confidence<=6?"Good confidence! ":o.confidence<=9?"Great confidence! ":"Excellent confidence! "})})]})]}),l.jsxs("div",{className:"flex justify-between",children:[s>1&&l.jsx("button",{onClick:E,className:"px-6 py-3 bg-slate-600 hover:bg-slate-500 text-white rounded-lg transition-colors",children:"Back"}),l.jsxs("button",{onClick:x,disabled:!k(),className:`ml-auto px-6 py-3 rounded-lg transition-colors flex items-center gap-2 ${k()?"bg-blue-600 hover:bg-blue-700 text-white":"bg-slate-700 text-gray-400 cursor-not-allowed"}`,children:[s===11?"Start Journey":"Next",l.jsx(I8,{className:"w-4 h-4"})]})]})]})})},Xy={DETERMINED:{name:"The Determined",color:"bg-red-500",icon:Us},SOCIAL_FIGHTER:{name:"The Social Fighter",color:"bg-blue-500",icon:lS},HEALTH_WARRIOR:{name:"The Health Warrior",color:"bg-green-500",icon:a2},MONEY_SAVER:{name:"The Money Saver",color:"bg-yellow-500",icon:o2}},sq={COMMON:{name:"Common",color:"border-gray-400",glow:"",days:0},UNCOMMON:{name:"Uncommon",color:"border-gray-300",glow:"shadow-lg",days:7},RARE:{name:"Rare",color:"border-yellow-400",glow:"shadow-yellow-400/50 shadow-lg",days:14},EPIC:{name:"Epic",color:"border-purple-400",glow:"shadow-purple-400/50 shadow-xl",days:30},LEGENDARY:{name:"Legendary",color:"border-orange-400",glow:"shadow-orange-400/50 shadow-2xl animate-pulse",days:90}},XT={WEEK_WARRIOR:{name:"Week Warrior",icon:i2,description:"7 days clean"},MONTH_MASTER:{name:"Month Master",icon:N8,description:"30 days clean"},LEGEND:{name:"Legend",icon:u2,description:"90 days clean"}},iq=n=>n>=90?"LEGENDARY":n>=30?"EPIC":n>=14?"RARE":n>=7?"UNCOMMON":"COMMON",oq=({isOpen:n,onClose:e,statType:t})=>{if(!n)return null;const s={addiction:{title:"Addiction Freedom",description:"Your freedom from nicotine addiction - increases with clean time, decreases with relapses",impacts:["What increases it:"," Clean time: +2 points per week","","What decreases it:"," First relapse (after clean period): -4 points"," Second relapse (within 7 days): -6 additional points"," Third relapse and on (within 3 days): -8 additional points","","Note: Escalation level resets after 7 clean days"]},mentalStrength:{title:"Mental Strength",description:"Your ability to resist urges and stay strong",impacts:["What increases it:"," Successful craving resistance: +1 point"," Using app during cravings every 3 times with no relapse: +1 point"," Completing breathing exercises 3 days straight: +1 point"," Staying hydrated for 3 days straight: +1 point"," Milestone bonuses: First 7 days +5 points, 30 days +10 points, 90 days +15 points","","What decreases it:"," Giving in to cravings: -3 points"," Each relapse: -3 points"]},motivation:{title:"Motivation",description:"Your drive to quit - boosted by staying engaged",impacts:["What increases it:"," Regular logging (3+ days per week): +2 points (weekly)"," Sharing achievements: +3 points per share (weekly)","","What decreases it:"," Long periods inactive (7+ days no logging): -3 points"]},triggerDefense:{title:"Trigger Defense",description:"Protection against your personal vaping triggers",impacts:["What increases it:"," Surviving trigger situations without vaping: +3 points"," Pre-planning for known triggers: +1 point"," Updating your trigger list: +1 point","","What decreases it:"," Relapsing to known triggers: -3 points"," Entering trigger situations unprepared: -1 point"]}}[t];return s?l.jsxs("div",{className:"modal-backdrop",children:[l.jsx("div",{className:"absolute inset-0 bg-black/80 backdrop-blur-sm",onClick:e}),l.jsx("div",{className:"modal-container",children:l.jsxs("div",{className:"modal-content bg-slate-800 border-slate-700",children:[l.jsxs("div",{className:"text-center mb-4",children:[l.jsx("h3",{className:"text-xl font-bold text-white mb-2",children:s.title}),l.jsx("p",{className:"text-gray-300 text-sm",children:s.description})]}),l.jsxs("div",{className:"mb-6",children:[l.jsx("h4",{className:"text-white font-semibold mb-3 text-left",children:"What impacts it:"}),l.jsx("ul",{className:"space-y-2 text-left",children:s.impacts.map((i,o)=>l.jsxs("li",{className:"text-gray-300 text-sm flex items-start",children:[l.jsx("span",{className:"text-blue-400 mr-2",children:""}),i]},o))})]}),l.jsx("button",{onClick:e,className:"w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 rounded-lg transition-all duration-300 min-h-[44px]",children:"Got it"})]})})]}):null},Tf=({label:n,value:e,max:t,color:r,statType:s,onInfoClick:i})=>{const o=Math.min(e,t);return l.jsxs("div",{className:"mb-0.5 sm:mb-1",children:[l.jsxs("div",{className:"flex justify-between text-white text-xs mb-1",children:[l.jsxs("div",{className:"flex items-center gap-1",children:[l.jsx("span",{className:"text-xs sm:text-xs",children:n}),s&&i&&l.jsx("button",{onClick:()=>i(s),className:"info-button w-0.5 h-0.5 sm:w-1 sm:h-1 bg-blue-600 hover:bg-blue-700 rounded-full flex items-center justify-center text-white text-xs font-bold",style:{fontSize:"4px"},title:`Learn about ${n}`,children:"i"})]}),l.jsxs("span",{className:"text-xs",children:[o,"/",t]})]}),l.jsx("div",{className:"stat-bar-interactive w-full bg-gray-700 rounded-full h-1.5 sm:h-2",children:l.jsx("div",{className:`${r} h-1.5 sm:h-2 rounded-full transition-all duration-500`,style:{width:`${o/t*100}%`}})})]})},aq=({user:n,isNemesis:e=!1,showComparison:t=!1,nemesisUser:r=null,onInfoClick:s})=>{const[i,o]=D.useState(!1),[a,c]=D.useState(null),[u,h]=D.useState([]),[f,m]=D.useState({});if(D.useEffect(()=>{let A=!1;return(async()=>{try{if(n&&n.uid)if(n.specialFeatures)A||(Array.isArray(n.specialFeatures)?(h(n.specialFeatures),m({})):n.specialFeatures&&n.specialFeatures.features?(h(n.specialFeatures.features),m(n.specialFeatures.categories||{})):(h([]),m({})));else{const E=await R(n);A||(Array.isArray(E)?(h(E),m({})):E&&E.features?(h(E.features),m(E.categories||{})):(h([]),m({})))}else A||(h([]),m({}))}catch(E){console.error(" TradingCard: Error loading Special Features:",E),A||(h([]),m({}))}})(),()=>{A=!0}},[n==null?void 0:n.uid,n==null?void 0:n.specialFeatures,n==null?void 0:n.triggers,n==null?void 0:n.dailyPatterns,n==null?void 0:n.copingStrategies]),n.isEmpty)return l.jsx("div",{className:"w-80 h-[520px] bg-slate-800 rounded-xl border-2 border-slate-600 p-4 text-white text-center mx-auto flex items-center justify-center",children:l.jsxs("div",{className:"text-center",children:[l.jsx("div",{className:"w-24 h-24 bg-slate-700 rounded-full flex items-center justify-center mx-auto mb-4",children:l.jsx("span",{className:"text-4xl text-slate-400",children:""})}),l.jsx("h3",{className:"text-slate-300 text-lg font-semibold mb-2",children:"Looking for a buddy"}),l.jsx("p",{className:"text-slate-400 text-sm leading-relaxed",children:"We'll find you a match soon"})]})});if(!n||!n.archetype||!n.stats)return l.jsx("div",{className:"w-80 h-[520px] bg-slate-800 rounded-xl border-2 border-gray-400 p-4 text-white text-center mx-auto flex items-center justify-center",children:l.jsx("div",{className:"animate-pulse",children:"Loading Card..."})});let y=Xy[n.archetype];if(!y){const A=Object.entries(Xy).find(([x,E])=>E.name===n.archetype);A&&(y=A[1],console.log(` TradingCard: Converted archetype name "${n.archetype}" to ID format`))}if(!y)return console.error("Invalid archetype:",n.archetype,"Available:",Object.keys(Xy)),l.jsx("div",{className:"w-80 h-[520px] bg-slate-800 rounded-xl border-2 border-red-400 p-4 text-white text-center mx-auto flex items-center justify-center",children:l.jsxs("div",{children:[l.jsx("h3",{className:"text-red-400 mb-2",children:"Invalid Archetype"}),l.jsx("p",{className:"text-gray-300 text-sm",children:n.archetype})]})});const w=sq[iq(n.stats.streakDays)],S=y.icon;async function R(A){if(A!=null&&A.isRealBuddy){try{const{ref:V,get:U}=await Ve(()=>import("./index.esm-ebdb357d.js"),[]),ce=V(H,`users/${A.uid}/stats`),we=await U(ce);if(we.exists()){const W=we.val();if(W.specialFeatures&&Array.isArray(W.specialFeatures))return W.specialFeatures}const z=V(H,`users/${A.uid}/specialFeatures`),re=await U(z);if(re.exists())return re.val()}catch(V){console.warn(" TradingCard: Could not load centralized Special Features for buddy:",V.message)}return["Freedom Chaser","Nicotine Fighter","Health Seeker","Willpower Warrior"]}let x=null;if(A.uid)try{const{ref:V,get:U}=await Ve(()=>import("./index.esm-ebdb357d.js"),[]),ce=V(H,`users/${A.uid}/specialFeatures`),we=await U(ce);we.exists()&&(x=we.val())}catch(V){console.error("Error fetching special features from Firebase:",V)}if(!x){const V=`specialFeatures_${A.heroName||A.id||"default"}`,U=localStorage.getItem(V);U&&(x=JSON.parse(U))}if(x){if(Array.isArray(x))return x;if(x&&x.features)return x}const E=[],k={};for(A.triggers&&A.triggers.length>0&&A.triggers.forEach(V=>{let U="";switch(V){case"Stress/anxiety":U="Stress Vaper";break;case"Social situations":U="Social Vaper";break;case"Boredom":U="Boredom Fighter";break;case"After meals":U="Habit Former";break;case"Drinking alcohol":U="Party Animal";break;case"Work breaks":U="Work Breaker";break;case"Driving":U="Driving Vaper";break;default:U="Trigger Aware"}U&&!E.includes(U)&&(E.push(U),k[U]="triggers")}),A.dailyPatterns&&A.dailyPatterns.length>0&&A.dailyPatterns.forEach(V=>{let U="";switch(V){case"Morning routine":U="Morning Struggler";break;case"Evening wind-down":U="Night Owl";break;case"Throughout the day":U="All-Day Warrior";break;default:U="Routine Builder"}U&&!E.includes(U)&&(E.push(U),k[U]="dailyPatterns")}),A.copingStrategies&&A.copingStrategies.length>0&&(A.copingStrategies.includes("Nothing - this is new to me")?(E.push("First Timer"),k["First Timer"]="copingStrategies"):A.copingStrategies.length>2?(E.push("Veteran Quitter"),k["Veteran Quitter"]="copingStrategies"):(E.push("Cold Turkey"),k["Cold Turkey"]="copingStrategies"));E.length<4;){const V=[{name:"Nicotine Fighter",category:"copingStrategies"},{name:"Health Seeker",category:"copingStrategies"},{name:"Freedom Chaser",category:"copingStrategies"},{name:"Willpower Warrior",category:"copingStrategies"}],U=V[Math.floor(Math.random()*V.length)];E.includes(U.name)||(E.push(U.name),k[U.name]=U.category)}const C=E.slice(0,4),_={};C.forEach(V=>{_[V]=k[V]||"copingStrategies"});const v={features:C,categories:_};if(A.uid)try{const{ref:V,set:U}=await Ve(()=>import("./index.esm-ebdb357d.js"),[]),ce=V(H,`users/${A.uid}/specialFeatures`);await U(ce,v),console.log("Special features with categories saved to Firebase successfully")}catch(V){console.error("Error saving special features to Firebase:",V);const U=`specialFeatures_${A.heroName||A.id||"default"}`;localStorage.setItem(U,JSON.stringify(v))}else{const V=`specialFeatures_${A.heroName||A.id||"default"}`;localStorage.setItem(V,JSON.stringify(C))}return C}const I=100-(n.stats.addictionLevel||50),N=n.stats.mentalStrength||50,P=n.stats.motivation||50,B=n.stats.triggerDefense||30;n.stats.nemesisVictories||(Math.floor(Math.random()*8)+1,Math.floor(Math.random()*5)+1);const F=A=>{c(A),o(!0)};return l.jsxs(l.Fragment,{children:[l.jsxs("div",{className:`touch-card relative w-72 sm:w-80 min-h-[480px] sm:min-h-[520px] rounded-xl ${w.color} border-4 ${w.glow} bg-gradient-to-br from-slate-800 to-slate-900 p-3 sm:p-4 mx-auto`,children:[l.jsxs("div",{className:"text-center mb-3",children:[l.jsx("h3",{className:"text-white font-bold text-sm sm:text-lg leading-tight break-words px-1",children:n.heroName}),l.jsx("p",{className:"text-gray-300 text-xs sm:text-base",children:y.name})]}),l.jsx("div",{className:"w-20 h-20 sm:w-24 sm:h-24 mx-auto mb-3 sm:mb-4 rounded-full overflow-hidden bg-slate-700 flex items-center justify-center ring-2 ring-blue-400/50",children:n.avatar?l.jsx("img",{src:n.avatar,alt:"Avatar",className:"w-full h-full object-cover",onError:()=>{console.log("Avatar failed to load, using fallback")}}):l.jsx("div",{className:`w-full h-full ${y.color} flex items-center justify-center`,children:l.jsx(S,{className:"w-12 h-12 text-white"})})}),l.jsxs("div",{className:"mb-2 sm:mb-3",children:[l.jsx(Tf,{label:"Addiction Freedom",value:I,max:100,color:"bg-green-500",statType:e?null:"addiction",onInfoClick:e?null:F}),l.jsx(Tf,{label:"Mental Strength",value:N,max:100,color:"bg-blue-500",statType:e?null:"mentalStrength",onInfoClick:e?null:F}),l.jsx(Tf,{label:"Motivation",value:P,max:100,color:"bg-green-500",statType:e?null:"motivation",onInfoClick:e?null:F}),l.jsx(Tf,{label:"Trigger Defense",value:B,max:100,color:"bg-orange-500",statType:e?null:"triggerDefense",onInfoClick:e?null:F})]}),l.jsxs("div",{className:"mb-4",children:[l.jsx("h4",{className:"text-white text-xs font-semibold mb-2 text-center",children:"Special Features"}),l.jsx("div",{className:"flex flex-wrap gap-1 justify-center",children:u.map((A,x)=>{const E=f[A]||"copingStrategies",k=C=>{switch(C){case"triggers":return"bg-yellow-500/80";case"dailyPatterns":return"bg-orange-500/80";case"copingStrategies":default:return"bg-blue-600/80"}};return l.jsx("div",{className:`px-2 py-1 ${k(E)} text-white text-xs rounded-full font-medium`,title:`${A} (${E})`,children:A},x)})})]}),l.jsxs("div",{className:"absolute bottom-6 sm:bottom-8 left-2 sm:left-3 right-2 sm:right-3 bg-black/30 rounded-lg p-2 sm:p-3 space-y-2 sm:space-y-3 backdrop-blur-sm",children:[l.jsxs("div",{className:"flex justify-between text-white text-xs sm:text-sm",children:[l.jsx("span",{className:"text-gray-300",children:"Streak:"}),l.jsxs("span",{className:"font-bold text-green-400 flex items-center gap-1",children:[(()=>{if(n.stats.streakDisplayText)return n.stats.streakDisplayText;const A=n.stats.streakDays;return`${A} day${A===1?"":"s"}`})(),n.stats.streakDays>0&&l.jsx("span",{className:"text-xs",children:""})]})]}),l.jsxs("div",{className:"flex justify-between text-white text-xs sm:text-sm",children:[l.jsx("span",{className:"text-gray-300",children:"Cravings Resisted:"}),l.jsxs("span",{className:"font-bold text-blue-400 flex items-center gap-1",children:[n.stats.cravingsResisted||0,l.jsx("span",{className:"text-xs",children:""})]})]})]}),n.achievements&&n.achievements.length>0&&l.jsxs("div",{className:"flex flex-wrap gap-1 justify-center",children:[n.achievements.slice(0,4).map((A,x)=>{var k,C;const E=((k=XT[A])==null?void 0:k.icon)||u2;return l.jsx("div",{className:"w-5 h-5 sm:w-6 sm:h-6 bg-yellow-500 rounded-full flex items-center justify-center shadow-lg",title:(C=XT[A])==null?void 0:C.description,children:l.jsx(E,{className:"w-2.5 h-2.5 sm:w-3 sm:h-3 text-white"})},x)}),n.achievements.length>4&&l.jsxs("div",{className:"w-5 h-5 sm:w-6 sm:h-6 bg-gray-500 rounded-full flex items-center justify-center text-white text-xs font-bold",children:["+",n.achievements.length-4]})]})]}),l.jsx(oq,{isOpen:i,onClose:()=>o(!1),statType:a})]})},lq=({activeTab:n,onTabChange:e,dataLoadingState:t,onRefreshData:r,offlineManager:s})=>{const i=[{id:"arena",label:"My Card",icon:l2},{id:"craving-support",label:"Craving Support",icon:Us},{id:"profile",label:"Progress",icon:d2},{id:"settings",label:"Explore",icon:c2}];return l.jsx(l.Fragment,{children:l.jsx("div",{className:"fixed bottom-0 left-0 right-0 bg-slate-800 border-t border-slate-700 px-4 py-2 z-40",children:l.jsx("div",{className:"flex justify-around max-w-md mx-auto",children:i.map(o=>{const a=o.icon,c=n===o.id;return l.jsxs("button",{onClick:()=>e(o.id),className:`tab-interactive flex flex-col items-center min-h-[44px] min-w-[44px] justify-center ${c?"text-blue-400":"text-gray-400 hover:text-blue-300"}`,children:[l.jsx(a,{className:"w-5 h-5"}),l.jsx("span",{className:"text-xs",children:o.label})]},o.id)})})})})},cq=({user:n,userStats:e,nemesis:t,onBackToLogin:r,onResetForTesting:s,buddyLoading:i,buddyError:o,realBuddy:a,loadRealBuddy:c,buddyLoadAttempted:u})=>{if(!n)return console.warn("ArenaView: user prop is undefined"),l.jsx("div",{className:"min-h-screen bg-gradient-to-br from-slate-900 via-blue-900 to-slate-900 py-8 pb-20",children:l.jsx("div",{className:"max-w-7xl mx-auto px-4",children:l.jsxs("div",{className:"text-center text-white",children:[l.jsx("h1",{className:"text-2xl font-bold mb-4",children:"Loading User Data..."}),l.jsx("p",{children:"Please wait while we load your profile information."})]})})});if(!t)return console.warn("ArenaView: nemesis prop is undefined"),l.jsx("div",{className:"min-h-screen bg-gradient-to-br from-slate-900 via-blue-900 to-slate-900 py-8 pb-20",children:l.jsx("div",{className:"max-w-7xl mx-auto px-4",children:l.jsxs("div",{className:"text-center text-white",children:[l.jsx("h1",{className:"text-2xl font-bold mb-4",children:"Loading Nemesis Data..."}),l.jsx("p",{children:"Please wait while we load your nemesis information."})]})})});D.useState(!1);const[h,f]=D.useState(null),[m,y]=D.useState(null);D.useEffect(()=>{const _=()=>{const v=document.querySelector(".battle-cards-container");v&&(window.innerWidth<1024?(v.style.flexDirection="column",v.style.gap="1rem"):(v.style.flexDirection="row",v.style.gap="3rem"))};return _(),window.addEventListener("resize",_),()=>window.removeEventListener("resize",_)},[]),D.useEffect(()=>{m&&n&&(async()=>{if(m&&n)try{console.log(" App: Refreshing stats on page load for user:",n.uid),await m.refreshAllStats(),console.log(" App: Stats refreshed on page load")}catch(v){console.error(" App: Error refreshing stats on page load:",v)}})()},[m,n]);const w=async _=>{if((_==null?void 0:_.uid)==="uGZGbLUytbfu8W3mQPW0YAvXTQn1"&&(!_.quitDate||new Date(_.quitDate)>new Date("2025-09-19")))if(console.log(" TEMPORARY FIX: Restoring correct quit date for User 3 in calculateRealTimeStats (created 18/09)"),_.lastRelapseDate){const V=new Date(_.lastRelapseDate),U=new Date("2025-09-18T13:56:46.584Z");_.quitDate=V>U?_.lastRelapseDate:"2025-09-18T13:56:46.584Z",console.log(` TEMPORARY FIX: User 3 quit date set to ${_.quitDate} (considering relapse: ${_.lastRelapseDate})`)}else _.quitDate="2025-09-18T13:56:46.584Z";if((_==null?void 0:_.uid)==="AmwwlNyHD5T3WthUbyR6bFL0QkF2"&&(!_.quitDate||new Date(_.quitDate)>new Date("2025-09-19")))if(console.log(" TEMPORARY FIX: Restoring correct quit date for User 2 in calculateRealTimeStats (created 18/09)"),_.lastRelapseDate){const V=new Date(_.lastRelapseDate),U=new Date("2025-09-18T13:56:46.584Z");_.quitDate=V>U?_.lastRelapseDate:"2025-09-18T13:56:46.584Z",console.log(` TEMPORARY FIX: User 2 quit date set to ${_.quitDate} (considering relapse: ${_.lastRelapseDate})`)}else _.quitDate="2025-09-18T13:56:46.584Z";let v={addictionLevel:50,mentalStrength:50,motivation:50,triggerDefense:30,experiencePoints:0,streakDays:0,cravingsResisted:0};if(_!=null&&_.isRealBuddy){if(_.stats&&Object.assign(v,_.stats),_.quitDate){const V=new Date(_.quitDate),U=Qs(V);v.streakDays=U.value,v.streakUnit=U.unit,v.streakDisplayText=U.displayText}try{const{ref:V,get:U}=await Ve(()=>import("./index.esm-ebdb357d.js"),[]),ce=V(H,`users/${_.uid}/cravings`),we=await U(ce);let z=0;we.exists()&&(we.forEach(re=>{re.val().outcome==="resisted"&&z++}),v.cravingsResisted=z)}catch{console.log(" Arena: Could not read buddy cravings, using default"),v.cravingsResisted=0}return v}if(!(_!=null&&_.uid)){const V=localStorage.getItem("quitCoachRelapseDate");if(V){const we=new Date(V),re=new Date().getTime()-we.getTime(),W=Math.floor(re/(1e3*3600*24));v.streakDays=W,v.streakUnit="days",v.streakDisplayText=`${W} day${W===1?"":"s"}`}else{const we=_.quitDate?new Date(_.quitDate):new Date,z=Qs(we);v.streakDays=z.value,v.streakUnit=z.unit,v.streakDisplayText=z.displayText}const U=parseInt(localStorage.getItem("cravingWins")||0);v.cravingsResisted=U,new Date().toDateString();let ce=0;for(let we=0;we<7;we++){const z=new Date;z.setDate(z.getDate()-we);const re=z.toDateString(),W=localStorage.getItem(`water_${_.uid}_${re}`);if(W&&parseInt(W)>0)ce++;else break}return ce>=3&&(v.mentalStrength=Math.min(80,(v.mentalStrength||50)+1)),v}try{const{ref:V,get:U}=await Ve(()=>import("./index.esm-ebdb357d.js"),[]),ce=V(H,`users/${_.uid}/cravings`);try{const Q=await U(ce);let ee=0,pe=0;if(Q.exists()){const Re=Q.val();Q.forEach(_t=>{const Ce=_t.val();Ce.outcome==="resisted"?ee++:Ce.outcome==="relapsed"&&pe++})}v.cravingsResisted=ee;const xe=V(H,`users/${_.uid}/profile/cravingsResisted`),De=await U(xe);if(De.exists()){const Re=De.val();console.log(` Arena: Profile cravingsResisted field value: ${Re}`),v.cravingsResisted=Math.max(ee,Re)}}catch{console.log("Could not query cravings for Arena stats, using fallback");const ee=V(H,`users/${_.uid}/profile/cravingsResisted`),pe=await U(ee);v.cravingsResisted=pe.exists()?pe.val():0}let we=0;const z=V(H,`users/${_.uid}/profile/relapseDate`),re=await U(z);if(re.exists()){const Q=re.val(),ee=new Date(Q),xe=new Date().getTime()-ee.getTime();we=Math.floor(xe/(1e3*3600*24))}else{const Q=_.quitDate?new Date(_.quitDate):new Date,ee=Qs(Q);we=ee.value,v.streakUnit=ee.unit,v.streakDisplayText=ee.displayText,console.log(` Arena: Calculated streak from quit date: ${ee.displayText} (quit: ${Q.toISOString()})`),console.log(` Arena: Setting streak fields - streakDays: ${we}, streakUnit: ${v.streakUnit}, streakDisplayText: ${v.streakDisplayText}`)}v.streakDays=we;let W=0;for(let Q=0;Q<7;Q++){const ee=new Date;ee.setDate(ee.getDate()-Q);const pe=ee.toDateString(),xe=V(H,`users/${_.uid}/profile/daily/${pe}/water`),De=await U(xe);if(De.exists()&&De.val()>0)W++;else break}W>=3&&(v.mentalStrength=Math.min(80,(v.mentalStrength||50)+1))}catch(V){console.error("Error fetching profile data from Firebase:",V);const U=localStorage.getItem("quitCoachRelapseDate");if(U){const z=new Date(U),W=new Date().getTime()-z.getTime(),Q=Math.floor(W/(1e3*3600*24));v.streakDays=Q,v.streakUnit="days",v.streakDisplayText=`${Q} day${Q===1?"":"s"}`}else{const z=_.quitDate?new Date(_.quitDate):new Date,re=Qs(z);v.streakDays=re.value,v.streakUnit=re.unit,v.streakDisplayText=re.displayText}const ce=parseInt(localStorage.getItem("cravingWins")||0);v.cravingsResisted=ce,new Date().toDateString();let we=0;for(let z=0;z<7;z++){const re=new Date;re.setDate(re.getDate()-z);const W=re.toDateString(),Q=localStorage.getItem(`water_${_.uid}_${W}`);if(Q&&parseInt(Q)>0)we++;else break}we>=3&&(v.mentalStrength=Math.min(80,(v.mentalStrength||50)+1))}if(_!=null&&_.uid&&!(_!=null&&_.isRealBuddy))try{const{ref:V,get:U}=await Ve(()=>import("./index.esm-ebdb357d.js"),[]),ce=Date.now();await new Promise(z=>setTimeout(z,800));const we=await U(V(H,`users/${_.uid}/stats`));if(we.exists()){const z=we.val();Object.assign(v,z)}else Object.assign(v,_.stats),console.log(" Arena: Using user.stats as fallback:",v);if(h){await h.updateAddictionFromCleanTime();const z=await U(V(H,`users/${_.uid}/stats`));if(z.exists()){const re=z.val();if(Object.assign(v,re),_.uid==="uGZGbLUytbfu8W3mQPW0YAvXTQn1"||_.uid==="AmwwlNyHD5T3WthUbyR6bFL0QkF2")return console.log(` Arena: Using Firebase stats directly for ${_.uid} - no client-side calculation`),v}}}catch(V){console.error("Error reading/updating stats from Firebase:",V),Object.assign(v,_.stats)}return v},[S,R]=D.useState(()=>{const _={mentalStrength:50,motivation:50,triggerDefense:30,addictionLevel:50,cravingsResisted:0,streakDays:0};return n!=null&&n.stats?{..._,...n.stats}:_}),[T,I]=D.useState(()=>({mentalStrength:50,motivation:50,triggerDefense:30,addictionLevel:50,cravingsResisted:0,streakDays:0}));D.useEffect(()=>{e&&Object.keys(e).length>0&&R(e)},[e]);const[N,P]=D.useState({streakDisplayText:null,streakDays:0,streakUnit:"hours"}),[B,F]=D.useState({}),A=async()=>{if(n&&window.centralizedStatService)try{const _=await window.centralizedStatService.getCurrentStats();F(_),console.log(" Arena: Recalculating real-time stats to update streak...");const v=await w(n);return v&&(console.log(" Arena: Updated real-time stats with new streak:",v.streakDisplayText),R(v)),_}catch(_){return console.warn(" Arena: Could not fetch latest stats from CentralizedStatService:",_),null}return null},x=async()=>{if(n)try{if(console.log(" Arena: Comprehensive refresh after relapse..."),window.centralizedStatService){const v=await window.centralizedStatService.getCurrentStats();F(v)}const _=await w(n);_&&(console.log(" Arena: Updated real-time stats with new streak after relapse:",_.streakDisplayText),R(_)),typeof E=="function"&&E(),console.log(" Arena: Comprehensive refresh after relapse completed")}catch(_){console.error(" Arena: Error during comprehensive refresh after relapse:",_)}};D.useEffect(()=>{A();const _=setInterval(A,3e4);return()=>clearInterval(_)},[n]),D.useEffect(()=>{typeof window<"u"&&(window.refreshArenaStats=A,window.refreshAfterRelapse=x,window.setLatestUserStats=F)},[n]),D.useEffect(()=>{if(!(n!=null&&n.uid))return;let _=!0;return(async()=>{await(async()=>{if(_)try{const ce=new Fg(H,n.uid);await ce.initialize(),_&&f(ce)}catch(ce){console.error("Error initializing StatManager:",ce)}})(),await(async()=>{if(_){if(n&&_){const ce=await w(n);_&&R(ce)}t&&t.uid&&_&&console.log(` Arena: Skipping initial calculation for buddy ${t.uid} - will use centralized Firebase stats`)}})()})(),()=>{_=!1}},[n==null?void 0:n.uid,t==null?void 0:t.uid]),D.useEffect(()=>{if(!(t!=null&&t.uid)||!(t!=null&&t.isRealBuddy))return;if(t.uid==="uGZGbLUytbfu8W3mQPW0YAvXTQn1"||t.uid==="AmwwlNyHD5T3WthUbyR6bFL0QkF2"){console.log(` Arena: SKIPPING real-time listener for centralized buddy ${t.uid}`);return}let _=!0;const V=(async()=>{try{const{ref:U,onValue:ce}=await Ve(()=>import("./index.esm-ebdb357d.js"),[]),we=U(H,`users/${t.uid}/stats`),z=ce(we,Q=>{if(_&&Q.exists()){const ee=Q.val();if(ee.streakDisplayText&&ee.streakUnit){const pe={streakDays:ee.streakDays||0,streakUnit:ee.streakUnit,streakDisplayText:ee.streakDisplayText};P(pe)}else{let pe=(a==null?void 0:a.lastRelapseDate)||(t==null?void 0:t.lastRelapseDate)||(a==null?void 0:a.originalQuitDate)||(t==null?void 0:t.originalQuitDate)||(a==null?void 0:a.lastActivity)||(t==null?void 0:t.lastActivity)||null;if(pe){const xe=Qs(new Date(pe)),De={streakDays:xe.value,streakUnit:xe.unit,streakDisplayText:xe.displayText};P(De),ee.streakDays=xe.value,ee.streakUnit=xe.unit,ee.streakDisplayText=xe.displayText}else ee.streakUnit="hours",ee.streakDisplayText="0 hours"}I(pe=>({...pe,...ee}))}},Q=>{Q.code!=="PERMISSION_DENIED"&&console.error("Error listening to buddy stats:",Q)}),re=U(H,`users/${t.uid}/profile`),W=ce(re,async Q=>{if(_&&Q.exists()){const ee=Q.val(),pe=(t==null?void 0:t.uid)||(a==null?void 0:a.uid);if(!(pe==="uGZGbLUytbfu8W3mQPW0YAvXTQn1"||pe==="AmwwlNyHD5T3WthUbyR6bFL0QkF2")){if(T&&T.addictionLevel!==50){let xe={...T};if(ee.quitDate&&ee.quitDate!==t.quitDate){const De=new Date(ee.quitDate),Re=Qs(De);xe.streakDays=Re.value,xe.streakUnit=Re.unit,xe.streakDisplayText=Re.displayText}else if(ee.lastRelapseDate||ee.relapseDate){const De=new Date(ee.lastRelapseDate||ee.relapseDate),Re=Qs(De);xe.streakDays=Re.value,xe.streakUnit=Re.unit,xe.streakDisplayText=Re.displayText,P({streakDays:Re.value,streakUnit:Re.unit,streakDisplayText:Re.displayText})}else if(t!=null&&t.finalQuitDate||a!=null&&a.finalQuitDate){const De=new Date((t==null?void 0:t.finalQuitDate)||(a==null?void 0:a.finalQuitDate)),Re=Qs(De);xe.streakDays=Re.value,xe.streakUnit=Re.unit,xe.streakDisplayText=Re.displayText,P({streakDays:Re.value,streakUnit:Re.unit,streakDisplayText:Re.displayText})}I(De=>({...De,...xe,...N}))}}}},Q=>{Q.code!=="PERMISSION_DENIED"&&console.error("Error listening to buddy profile:",Q)});return()=>{z(),W()}}catch(U){console.error("Error setting up buddy stats listeners:",U)}})();return()=>{_=!1,V.then(U=>{U&&typeof U=="function"&&U()})}},[t==null?void 0:t.uid,t==null?void 0:t.isRealBuddy,a==null?void 0:a.quitDate]),D.useEffect(()=>{if(!(t!=null&&t.uid)||!(t!=null&&t.isRealBuddy))return;const _=setInterval(()=>{const v=(a==null?void 0:a.lastRelapseDate)||(t==null?void 0:t.lastRelapseDate)||(a==null?void 0:a.originalQuitDate)||(t==null?void 0:t.originalQuitDate)||(a==null?void 0:a.lastActivity)||(t==null?void 0:t.lastActivity)||null;if(!v)return;const V=Qs(new Date(v));P({streakDays:V.value,streakUnit:V.unit,streakDisplayText:V.displayText}),I(U=>({...U,streakDays:V.value,streakUnit:V.unit,streakDisplayText:V.displayText}))},60*1e3);return()=>clearInterval(_)},[t==null?void 0:t.uid,t==null?void 0:t.isRealBuddy,a==null?void 0:a.lastRelapseDate,a==null?void 0:a.originalQuitDate,a==null?void 0:a.lastActivity]);const E=async()=>{if(n){const _=await w(n);R(_)}if(t)if(t.uid==="uGZGbLUytbfu8W3mQPW0YAvXTQn1"||t.uid==="AmwwlNyHD5T3WthUbyR6bFL0QkF2")console.log(` Arena: Skipping refresh for centralized buddy ${t.uid} - using Firebase stats directly`);else{const _=await w(t);I(v=>(console.log(" Arena: Preserving locally calculated streak during stats calculation:",N),{...v,..._,...N}))}};D.useEffect(()=>{if(!(n!=null&&n.uid))return;const _=setInterval(E,3e4);return()=>clearInterval(_)},[n==null?void 0:n.uid,t==null?void 0:t.uid]),D.useEffect(()=>{t!=null&&t.uid&&(t.uid==="uGZGbLUytbfu8W3mQPW0YAvXTQn1"||t.uid==="AmwwlNyHD5T3WthUbyR6bFL0QkF2"||E())},[t==null?void 0:t.uid]),D.useEffect(()=>{a!=null&&a.quitDate&&(t!=null&&t.uid)&&(t.uid==="uGZGbLUytbfu8W3mQPW0YAvXTQn1"||t.uid==="AmwwlNyHD5T3WthUbyR6bFL0QkF2"||E())},[a==null?void 0:a.quitDate,t==null?void 0:t.uid]),D.useEffect(()=>{n!=null&&n.uid&&!a&&!i&&!u&&(console.log(" Arena: Loading buddy data for user:",n.uid),c(w,I,P))},[n==null?void 0:n.uid,a,i,u,P]),D.useEffect(()=>{const _=()=>{console.log(" Internet connection restored")},v=()=>{console.log(" Internet connection lost")};return window.addEventListener("online",_),window.addEventListener("offline",v),()=>{window.removeEventListener("online",_),window.removeEventListener("offline",v)}},[]);const k=_=>{if(!_||!_.stats)return console.warn("Player or player stats not available for battle score calculation"),0;const v=_.stats.mentalStrength||50,V=_.stats.motivation||50,U=_.stats.triggerDefense||30,ce=_.stats.addictionLevel||50;return v*1.5+V*1+U*1.2-ce*1};k({...n,stats:S}),k({...t,stats:T});const C=async()=>{const _=S.streakDisplayText||"0 hours",v=S.cravingsResisted||0,V=` ${_} vape-free!
My quit stats: ${_} | ${v} Cravings Resisted
#QuitVaping #VapeFree #QuitCoach`;try{navigator.share?(await navigator.share({title:"My Quit Journey",text:V}),console.log(" Card shared successfully")):(await navigator.clipboard.writeText(V),alert(" Card text copied to clipboard!"))}catch(U){console.error(" Error sharing:",U)}};return l.jsx("div",{className:"min-h-screen bg-gradient-to-br from-slate-900 via-blue-900 to-slate-900 py-4 pb-20",children:l.jsxs("div",{className:"max-w-4xl mx-auto px-4 sm:px-6 lg:px-8",children:[l.jsxs("div",{className:"text-center mb-6",children:[l.jsx("h1",{className:"text-3xl sm:text-4xl font-bold text-white mb-2",children:"My Progress Card"}),l.jsx("p",{className:"text-gray-400 text-sm sm:text-base",children:"Track your journey and share your achievements"})]}),l.jsx("div",{className:"flex justify-center mb-6",children:l.jsxs("button",{onClick:E,className:"touch-interactive ripple-effect px-6 py-3 bg-green-600 hover:bg-green-700 text-white rounded-full flex items-center gap-2 shadow-lg min-h-[44px] transition-all",title:"Refresh Stats",children:[l.jsx("span",{className:"text-lg",children:""}),l.jsx("span",{className:"font-semibold",children:"Refresh Stats"})]})}),l.jsxs("div",{className:"flex flex-col items-center space-y-6 mb-8",children:[l.jsx("div",{className:"w-full max-w-md",children:(()=>{if(!n||!S)return console.log(" TradingCard: Missing data, not rendering user card"),l.jsx("div",{className:"w-full h-[480px] sm:h-[520px] bg-slate-800 rounded-xl border-2 border-slate-600 p-4 text-white text-center mx-auto flex items-center justify-center",children:l.jsx("div",{className:"animate-pulse",children:"Loading Your Card..."})});const _=B&&Object.keys(B).length>0?{...n.stats,...B}:e&&Object.keys(e).length>0?{...n.stats,...e}:{...n.stats,...S};return l.jsx(aq,{user:{...n,stats:_},showComparison:!1,nemesisUser:null},`user-${n.uid}-${n.lastRelapseRefresh||Date.now()}`)})()}),l.jsxs("button",{onClick:C,className:"w-full max-w-md px-8 py-4 bg-gradient-to-r from-purple-600 to-blue-600 hover:from-purple-700 hover:to-blue-700 text-white rounded-xl font-bold text-lg shadow-2xl transition-all transform hover:scale-105 min-h-[56px] flex items-center justify-center gap-3",children:[l.jsx("span",{className:"text-2xl",children:""}),l.jsx("span",{children:"Share My Card"})]}),l.jsxs("div",{className:"w-full max-w-md grid grid-cols-2 gap-4 mt-6",children:[l.jsxs("div",{className:"bg-slate-800/50 rounded-lg p-4 border border-slate-700",children:[l.jsx("div",{className:"text-gray-400 text-sm mb-1",children:"Clean Streak"}),l.jsx("div",{className:"text-white text-2xl font-bold",children:S.streakDisplayText||"0 hours"})]}),l.jsxs("div",{className:"bg-slate-800/50 rounded-lg p-4 border border-slate-700",children:[l.jsx("div",{className:"text-gray-400 text-sm mb-1",children:"Cravings Resisted"}),l.jsx("div",{className:"text-white text-2xl font-bold",children:S.cravingsResisted||0})]})]})]})]})})},uq=({isOpen:n,onClose:e,title:t,message:r,type:s="info"})=>{if(!n)return null;const i=()=>{switch(s){case"success":return"";case"warning":return"";case"info":return"";default:return""}},o=()=>{switch(s){case"success":return"from-green-600 to-green-700";case"warning":return"from-yellow-600 to-yellow-700";case"info":return"from-blue-600 to-blue-700";default:return"from-slate-600 to-slate-700"}};return l.jsxs("div",{className:"modal-backdrop",children:[l.jsx("div",{className:"absolute inset-0 bg-black/80 backdrop-blur-sm",onClick:e}),l.jsx("div",{className:"modal-container",children:l.jsx("div",{className:"modal-content bg-slate-800 border-slate-600 shadow-2xl animate-in slide-in-from-bottom-4 duration-300",children:l.jsxs("div",{className:"text-center",children:[l.jsx("div",{className:"w-16 h-16 bg-gradient-to-br from-slate-600 to-slate-700 rounded-full flex items-center justify-center mx-auto mb-4",children:l.jsx("span",{className:"text-3xl",children:i()})}),l.jsx("h3",{className:"text-xl font-bold text-white mb-3",children:t}),l.jsx("div",{className:"text-gray-300 mb-6 whitespace-pre-line text-sm leading-relaxed",children:r}),l.jsx("button",{onClick:e,className:`w-full bg-gradient-to-r ${o()} hover:from-slate-700 hover:to-slate-800 text-white font-bold py-3 px-6 rounded-xl transition-all duration-300 transform hover:scale-105`,children:"Got it"})]})})})]})},dq=({gameType:n,onClose:e})=>{const[t,r]=D.useState(0),{modalRef:s,classes:i}=aS(e,{threshold:100,velocity:.5,enabled:!0}),o=()=>{const c=D.useRef(null),[u,h]=D.useState([{x:12,y:12}]),[f,m]=D.useState({x:1,y:0}),[y,w]=D.useState({x:1,y:0}),[S,R]=D.useState({x:15,y:15}),[T,I]=D.useState(!1),[N,P]=D.useState(0),[B,F]=D.useState(1),A={1:128,2:Math.round(128/1.25),3:Math.round(128/1.25/1.25)},x={1:5,2:5,3:10};return D.useEffect(()=>{const E=k=>{if(T){k.preventDefault(),h([{x:12,y:12}]),m({x:1,y:0}),w({x:1,y:0}),R({x:15,y:15}),I(!1),P(0),F(1);return}switch(k.key){case"ArrowUp":k.preventDefault(),f.y!==1&&w({x:0,y:-1});break;case"ArrowDown":k.preventDefault(),f.y!==-1&&w({x:0,y:1});break;case"ArrowLeft":k.preventDefault(),f.x!==1&&w({x:-1,y:0});break;case"ArrowRight":k.preventDefault(),f.x!==-1&&w({x:1,y:0});break}};return window.addEventListener("keydown",E),()=>window.removeEventListener("keydown",E)},[f,T]),D.useEffect(()=>{if(T)return;const E=setInterval(()=>{h(k=>{const C={x:k[0].x+f.x,y:k[0].y+f.y};if(C.x<0&&(C.x=24),C.x>=25&&(C.x=0),C.y<0&&(C.y=24),C.y>=25&&(C.y=0),k.slice(0,-1).some(U=>U.x===C.x&&U.y===C.y))return I(!0),k;const v=C.x===S.x&&C.y===S.y;let V;return v?(P(U=>U+x[B]),R({x:Math.floor(Math.random()*25),y:Math.floor(Math.random()*25)}),V=[C,...k]):V=[C,...k.slice(0,-1)],(y.x!==f.x||y.y!==f.y)&&setTimeout(()=>{m(y)},0),V})},A[B]);return()=>clearInterval(E)},[f,y,S,T]),D.useEffect(()=>{const E=c.current;if(!E)return;const k=E.getContext("2d"),C=15,_=25;k.fillStyle="#1f2937",k.fillRect(0,0,375,375),k.strokeStyle="#374151",k.lineWidth=1;for(let v=0;v<=_;v++)k.beginPath(),k.moveTo(v*C,0),k.lineTo(v*C,375),k.stroke(),k.beginPath(),k.moveTo(0,v*C),k.lineTo(375,v*C),k.stroke();u.forEach((v,V)=>{V===0?k.fillStyle="#fbbf24":k.fillStyle="#10b981",k.fillRect(v.x*C+1,v.y*C+1,C-2,C-2)}),k.fillStyle="#ef4444",k.fillRect(S.x*C+2,S.y*C+2,C-4,C-4)},[u,S]),l.jsxs("div",{className:"text-center",children:[l.jsx("div",{className:"mb-4",children:l.jsxs("div",{className:"flex justify-center gap-2 mb-3",children:[l.jsx("span",{className:"text-white mr-2 text-sm",children:"Level:"}),[1,2,3].map(E=>l.jsxs("button",{onClick:()=>F(E),className:`
                  px-4 py-3 text-sm font-mono border-2 border-green-500 transition-all min-h-[44px]
                  ${B===E?"bg-green-500 text-black":"bg-green-900 text-green-400"}
                  hover:bg-green-600 cursor-pointer
                `,style:{minWidth:"80px"},children:[l.jsxs("div",{children:["Level ",E]}),l.jsxs("div",{className:"text-xs mt-1",children:[E===1&&"Normal",E===2&&"Fast",E===3&&"Insane"]})]},E))]})}),l.jsx("canvas",{ref:c,width:"375",height:"375",className:"border-2 border-gray-300 mx-auto",style:{imageRendering:"pixelated"}}),l.jsxs("div",{className:"mt-4",children:[l.jsxs("p",{className:"text-lg font-bold text-gray-800",children:["Score: ",N," | Level: ",B]}),T&&l.jsxs("div",{className:"mt-2",children:[l.jsx("p",{className:"text-red-600 font-bold mb-2",children:"Game Over!"}),l.jsx("button",{onClick:()=>{h([{x:12,y:12}]),m({x:1,y:0}),w({x:1,y:0}),R({x:15,y:15}),I(!1),P(0),F(1)},className:"bg-blue-600 hover:bg-blue-700 text-white px-4 py-3 rounded text-sm min-h-[44px]",children:"Restart Game"})]})]})]})},a=()=>{try{return n==="snake"?l.jsx(o,{}):l.jsx("div",{className:"text-center text-red-600",children:"Game not found"})}catch(c){return console.error("Error rendering game:",c),l.jsxs("div",{className:"text-center text-red-600",children:[l.jsx("p",{className:"text-lg font-bold mb-2",children:" Game Error"}),l.jsx("p",{className:"text-sm",children:"Something went wrong loading the game."}),l.jsx("button",{onClick:()=>window.location.reload(),className:"mt-2 bg-red-600 hover:bg-red-700 text-white px-4 py-3 rounded text-sm min-h-[44px]",children:"Reload Game"})]})}};return l.jsx("div",{className:"modal-backdrop",children:l.jsx("div",{className:"modal-container",children:l.jsxs("div",{ref:s,className:`modal-content bg-white max-w-4xl ${i}`,role:"dialog","aria-modal":"true","aria-labelledby":"game-modal-title",children:[l.jsx("div",{className:"modal-swipe-indicator"}),l.jsxs("div",{className:"modal-scrollable",children:[l.jsxs("div",{className:"flex justify-between items-center mb-4 p-4",children:[l.jsx("h3",{id:"game-modal-title",className:"text-xl font-bold text-gray-800",children:" Snake Game"}),l.jsx("button",{onClick:e,className:"modal-close-button","aria-label":"Close game modal",children:""})]}),l.jsx("div",{className:"bg-gray-100 rounded-lg p-4 min-h-[400px] flex items-center justify-center relative mx-4",children:a()}),l.jsxs("div",{className:"p-4",children:[l.jsx("div",{className:"flex justify-center items-center gap-4 mb-4",children:l.jsxs("span",{className:"text-lg font-semibold text-gray-700",children:["Score: ",t]})}),l.jsx("div",{className:"modal-actions",children:l.jsx("button",{onClick:e,className:"modal-button modal-button-primary",children:"Close Game"})})]})]})]})})})},hq=({user:n,nemesis:e,onBackToLogin:t,onResetForTesting:r,onBreathingComplete:s,setActiveTab:i,behavioralService:o})=>{const[a,c]=D.useState(!1),[u,h]=D.useState(null),[f,m]=D.useState(!1),[y,w]=D.useState({title:"",message:"",type:"info"}),[S,R]=D.useState(null),[T,I]=D.useState(!1),[N,P]=D.useState(0),[B,F]=D.useState(!1),[A,x]=D.useState(!1),[E,k]=D.useState(1),[C,_]=D.useState({strength:5,mood:"",context:"",outcome:"",copingStrategy:"",location:"",timeOfDay:"",triggerType:""}),[v,V]=D.useState({resisted:0,relapses:0}),[U,ce]=D.useState(0),[we,z]=D.useState(!1),[re,W]=D.useState(""),Q=(te,Se,ge="info")=>{console.log(" showQuickActionPopup called:",{title:te,message:Se,type:ge}),w({title:te,message:Se,type:ge}),m(!0),console.log(" showQuickActionPopup: Popup data set and showCustomPopup set to true")};cA.useEffect(()=>(typeof window<"u"&&(window.showQuickActionPopup=Q),()=>{typeof window<"u"&&delete window.showQuickActionPopup}),[]),D.useEffect(()=>n!=null&&n.uid?(P(0),(async()=>{try{const be=new Fg(H,n.uid);await be.initialize(),R(be)}catch(be){console.error("Error initializing StatManager:",be)}})(),(async()=>{try{const be=new Date().toDateString(),{ref:ye,get:at}=await Ve(()=>import("./index.esm-ebdb357d.js"),[]);try{const bt=ye(H,`users/${n.uid}/profile/dailyCravingLogs/${be}`),dt=await at(bt);if(dt.exists()){const Xe=dt.val();ce(Xe.count||0)}else ce(0)}catch{const dt=`cravingLogs_${n.uid}_${be}`,Xe=localStorage.getItem(dt);if(Xe){const st=JSON.parse(Xe);ce(st.count||0)}else ce(0)}}catch(be){console.error("Error loading daily craving logs:",be),ce(0)}})(),(async()=>{try{const{ref:be,get:ye,onValue:at,query:bt,orderByChild:dt,startAt:Xe,endAt:st,set:Me}=await Ve(()=>import("./index.esm-ebdb357d.js"),[]),fe=new Date,je=new Date(fe.getTime()-7*24*60*60*1e3),Gt=je.toDateString(),Tt=fe.toDateString();try{const Qe=be(H,`users/${n.uid}/profile/cravingStats`),nn=await ye(Qe);if(nn.exists()){const ae=nn.val();if(ae.lastUpdated&&new Date(ae.lastUpdated)>je){V(ae);return}}}catch{console.log("Firebase stats not available, calculating from cravings data")}const{ref:en,get:fn,query:Ht,orderByChild:wn,startAt:tn,endAt:mn}=await Ve(()=>import("./index.esm-ebdb357d.js"),[]),cn=en(H,`users/${n.uid}/cravings`),Qt=Ht(cn,wn("date"),tn(Gt),mn(Tt));try{const Qe=await fn(Qt);let nn=0,ae=0;if(console.log(` Weekly Stats: Checking cravings for ${Gt} to ${Tt}`),console.log(` Weekly Stats: Cravings snapshot exists: ${Qe.exists()}`),Qe.exists()){const Dt=Qe.val();console.log(" Weekly Stats: Raw cravings data:",Dt),Qe.forEach(es=>{const Tn=es.val();console.log(" Weekly Stats: Individual craving:",Tn),Tn.outcome==="resisted"?nn++:Tn.outcome==="relapsed"&&ae++})}console.log(` Weekly Stats: Calculated - resisted: ${nn}, relapses: ${ae}`);const lt={resisted:nn,relapses:ae,lastUpdated:fe.toISOString()};V(lt);try{const Dt=be(H,`users/${n.uid}/profile/cravingStats`);await Me(Dt,lt)}catch{console.log("Could not save weekly stats to Firebase, using localStorage")}localStorage.setItem(`cravingStats_${n.uid}`,JSON.stringify(lt))}catch{console.log("Could not query cravings, using localStorage fallback");const nn=JSON.parse(localStorage.getItem(`cravingStats_${n.uid}`)||'{"resisted": 0, "relapses": 0}');V(nn)}const Gn=be(H,`users/${n.uid}/profile/cravingStats`);return at(Gn,Qe=>{Qe.exists()&&V(Qe.val())})}catch(be){console.error("Error loading weekly stats:",be);const ye=JSON.parse(localStorage.getItem(`cravingStats_${n.uid}`)||'{"resisted": 0, "relapses": 0}');V(ye)}})(),(async()=>{try{const{ref:be,get:ye,onValue:at}=await Ve(()=>import("./index.esm-ebdb357d.js"),[]),bt=new Date().toDateString(),dt=be(H,`users/${n.uid}/profile/daily/${bt}/water`),Xe=await ye(dt);if(Xe.exists())P(Xe.val()||0);else{const Me=parseInt(localStorage.getItem(`water_${n.uid}_${bt}`)||0);P(Me)}return at(dt,Me=>{Me.exists()&&P(Me.val()||0)})}catch(be){console.error("Error loading daily water from Firebase:",be);const ye=new Date().toDateString(),at=parseInt(localStorage.getItem(`water_${n.uid}_${ye}`)||0);P(at)}})(),()=>{P(0),I(!1),V({resisted:0,relapses:0}),x(!1),k(1),_({strength:5,mood:"",context:"",outcome:""}),ce(0),z(!1),W("")}):void 0,[n==null?void 0:n.uid]);const ee=()=>{h("snake"),c(!0)},pe=()=>{h(null),c(!1)},xe=async()=>{if(!(n!=null&&n.uid)){console.warn("Cannot log water: No authenticated user");return}try{const te=Math.min(N+1,6);P(te);const Se=new Date().toDateString();if(S){if(await S.handleHydrationUpdate(te),o)try{const ye=await S.checkHydrationStreak();await o.logHydration(n.uid,{glassesConsumed:te,targetGlasses:6,currentStreak:ye}),console.log(" Hydration also logged to Firestore for analytics")}catch(ye){console.warn(" Could not log hydration to Firestore:",ye.message),await Ce("hydration",{glassesConsumed:te,targetGlasses:6,currentStreak:await S.checkHydrationStreak()})}else await Ce("hydration",{glassesConsumed:te,targetGlasses:6,currentStreak:await S.checkHydrationStreak()});te===6&&N===5&&await S.checkHydrationStreak()>=3&&(await S.updateStat("mentalStrength",1,"3-day hydration streak"),console.log("Mental Strength +1 for 3-day hydration streak!"))}const{ref:ge,set:Oe}=await Ve(()=>import("./index.esm-ebdb357d.js"),[]),be=ge(H,`users/${n.uid}/profile/daily/${Se}/water`);await Oe(be,te),localStorage.setItem(`water_${n.uid}_${Se}`,te.toString()),console.log("Water intake updated:",te)}catch(te){console.error("Error updating water intake:",te);const Se=Math.min(N+1,6);P(Se);const ge=new Date().toDateString();localStorage.setItem(`water_${n.uid}_${ge}`,Se.toString())}},De=()=>{_({strength:5,mood:"",context:"",outcome:""}),k(1),x(!0)},Re=()=>{E<4&&k(E+1)},_t=()=>{E>1&&k(E-1)},Ce=async(te,Se)=>{if(!window.offlineManager||!(authUser!=null&&authUser.uid))return!1;const ge={...Se,userId:authUser.uid,timestamp:Date.now()};return await window.offlineManager.handleOfflineBehavioralLog(te,ge)},Ae=async te=>{let Se,ge,Oe;try{Oe=new Date().toISOString();const be=new Date().toDateString(),ye=new Date;Se={...C,outcome:te,timestamp:Oe,date:be,timeOfDay:ye.getHours()<12?"morning":ye.getHours()<17?"afternoon":"evening",dayOfWeek:ye.toLocaleDateString("en-US",{weekday:"long"}),weekOfYear:Math.ceil((ye.getDate()+new Date(ye.getFullYear(),0,1).getDay())/7),month:ye.toLocaleDateString("en-US",{month:"long"}),year:ye.getFullYear(),userId:n==null?void 0:n.uid,sessionId:Date.now().toString(),userAgent:navigator.userAgent.substring(0,100),outcomeDetails:{resisted:te==="resisted",relapsed:te==="relapsed",logged:te==="logged",usedPractices:te==="resistance_practices"}};const at=new Date().toDateString(),bt=U+1;ce(bt),ge={resisted:v.resisted,relapses:v.relapses,lastUpdated:Oe};let dt=!1;if(bt<=2&&S)try{const Qt=await S.handleCravingLogged();Qt&&Qt.applied&&(dt=!0,console.log(" Awareness bonus awarded for craving tracking"))}catch(Qt){console.warn(" Could not award awareness bonus:",Qt)}if(te==="resisted"){if(ge.resisted=v.resisted+1,S){console.log(" Detailed Craving: Calling StatManager.handleCravingResistance()...");const Qt=await S.handleCravingResistance();console.log(" Detailed Craving: StatManager.handleCravingResistance() result:",Qt)}window.centralizedStatService&&(console.log(" Detailed Craving: Using CentralizedStatService..."),await window.centralizedStatService.handleCravingResisted(),console.log(" Detailed Craving: Stats updated via CentralizedStatService"))}else if(te==="relapsed"){if(ge.relapses=v.relapses+1,S){console.log(" Detailed Craving: Calling StatManager.handleRelapse()...");const Qt=await S.handleRelapse();console.log(" Detailed Craving: StatManager.handleRelapse() result:",Qt)}window.centralizedStatService&&(console.log(" Detailed Craving: Using CentralizedStatService..."),await window.centralizedStatService.handleRelapse(),console.log(" Detailed Craving: Stats updated via CentralizedStatService")),typeof window.refreshAfterRelapse=="function"?(console.log(" Detailed Craving: Comprehensive Arena refresh after relapse..."),window.refreshAfterRelapse(),setTimeout(()=>{console.log(" Detailed Craving: Secondary comprehensive Arena refresh..."),window.refreshAfterRelapse()},2e3)):typeof window.refreshArenaStats=="function"?(console.log(" Detailed Craving: Fallback to regular Arena stats refresh..."),window.refreshArenaStats(),setTimeout(()=>{console.log(" Detailed Craving: Secondary Arena stats refresh..."),window.refreshArenaStats()},2e3)):console.warn(" Detailed Craving: No Arena refresh functions available")}const{ref:Xe,set:st,push:Me,get:fe}=await Ve(()=>import("./index.esm-ebdb357d.js"),[]),je=Xe(H,`users/${n.uid}/profile/cravingStats`);await st(je,ge);const Gt=Xe(H,`users/${n.uid}/cravings`),Tt=Me(Gt);if(await st(Tt,Se),o)try{await o.logCraving(n.uid,{outcome:te,strength:C.strength,duration:C.duration,context:"detailed_assessment",triggers:C.triggers||[],mood:C.mood,stressLevel:C.stressLevel,copingStrategiesUsed:C.copingStrategies||[],location:C.location,socialSituation:C.socialSituation}),console.log(" Craving also logged to Firestore for analytics")}catch(Qt){console.warn(" Could not log craving to Firestore:",Qt.message),Ce&&await Ce("craving",{outcome:te,strength:C.strength,duration:C.duration,context:"detailed_assessment",triggers:C.triggers||[],mood:C.mood,stressLevel:C.stressLevel,copingStrategiesUsed:C.copingStrategies||[],location:C.location,socialSituation:C.socialSituation})}const en=Xe(H,`users/${n.uid}/profile/cravingHistory/${at}`),fn=await fe(en);let Ht=fn.exists()?fn.val():[];Ht.push({...Se,id:Tt.key,timestamp:Oe}),Ht.length>30&&(Ht=Ht.slice(-30)),await st(en,Ht),console.log(` Daily history updated for ${at}:`,Ht.length,"records");const wn=ye.toISOString().substring(0,7),tn=Xe(H,`users/${n.uid}/profile/cravingTrends/${wn}`),mn=await fe(tn);let cn=mn.exists()?mn.val():[];cn.push({...Se,id:Tt.key,timestamp:Oe}),cn.length>365&&(cn=cn.slice(-365)),await st(tn,cn),console.log(` Monthly trends updated for ${wn}:`,cn.length,"records"),V(ge),w(te==="resisted"?{title:" Great Job!",message:`You successfully resisted that craving!

Your Mental Strength and Trigger Defense have increased significantly.

Plus, you earned awareness bonuses for tracking your craving!`,type:"success"}:te==="relapsed"?{title:" New Beginning",message:`Every relapse is a chance to learn and grow stronger. You're back on track and that takes courage!

Your awareness and tracking skills are improving with each experience. Keep going!`,type:"success"}:{title:" Progress Recorded",message:`Your craving has been logged successfully.

You earned awareness bonuses for tracking your craving!`,type:"info"}),m(!0),x(!1),k(1)}catch(be){if(console.error("Error saving craving assessment:",be),Se){const ye=JSON.parse(localStorage.getItem(`cravings_${n.uid}`)||"[]");ye.push(Se),localStorage.setItem(`cravings_${n.uid}`,JSON.stringify(ye))}if(ge){const ye=JSON.parse(localStorage.getItem(`cravingStats_${n.uid}`)||'{"resisted": 0, "relapses": 0}');ye.resisted=ge.resisted,ye.relapses=ge.relapses,ye.lastUpdated=Oe,localStorage.setItem(`cravingStats_${n.uid}`,JSON.stringify(ye))}w(te==="resisted"?{title:" Great Job!",message:`You successfully resisted that craving!

Your progress has been recorded locally and will sync when the connection is restored.`,type:"success"}:te==="relapsed"?{title:" New Beginning",message:`Every relapse is a chance to learn and grow stronger. You're back on track and that takes courage!

Your progress has been recorded locally and will sync when the connection is restored.`,type:"success"}:{title:" Progress Recorded",message:"Your progress has been recorded locally and will sync when the connection is restored.",type:"info"}),m(!0),x(!1),k(1)}},Pe=async()=>{try{const te=new Date().toISOString(),Se=new Date().toDateString();let ge=null;const{ref:Oe,set:be,push:ye,get:at}=await Ve(()=>import("./index.esm-ebdb357d.js"),[]);if(n&&n.uid){const bt=Oe(H,`users/${n.uid}/cravings`),dt=ye(bt);await be(dt,{strength:0,mood:"quick",context:"quick_action",outcome:"resisted",timestamp:te,date:Se});const Xe=Oe(H,`users/${n.uid}/profile/cravingStats`),st={resisted:v.resisted+1,relapses:v.relapses,lastUpdated:te};if(await be(Xe,st),V(st),window.centralizedStatService){console.log(" Quick Resistance: Using CentralizedStatService...");const je=await window.centralizedStatService.getCurrentStats(),Gt=(je==null?void 0:je.mentalStrengthCravingsApplied)||0;console.log(" Quick Resistance: Current mental strength bonus before processing:",Gt);const Tt=await window.centralizedStatService.handleCravingResisted();if(console.log(" Quick Resistance: Stats updated via CentralizedStatService"),Tt&&Tt.applied){const en=Tt.cravingsApplied||0,fn=Math.max(0,3-en);console.log(" Quick Resistance: Bonus applied, remaining:",fn),fn>0?Q("Craving Resisted! ",`Great job! You earned +1 mental strength point. You can still earn ${fn} more today.`,"success"):Q("Craving Resisted! ","Excellent! You've reached the daily maximum of 3 mental strength points from craving resistance.","success")}else console.log(" Quick Resistance: Daily limit reached, showing limit message"),Q("Daily Mental Strength Limit Reached","You've already earned the maximum 3 mental strength points from craving resistance today. Keep up the great work! Your resistance still counts for your overall progress.","info");typeof window.refreshArenaStats=="function"&&(console.log(" Quick Resistance: Refreshing Arena stats..."),window.refreshArenaStats(),setTimeout(()=>{console.log(" Quick Resistance: Secondary Arena stats refresh..."),window.refreshArenaStats()},1e3)),window.centralizedStatService&&window.centralizedStatService.getCurrentStats().then(en=>{window.dispatchEvent(new CustomEvent("statsUpdated",{detail:en}))});return}else S&&(ge=await S.checkDailyCravingResistanceLimits(Se),await S.handleCravingResistance());const Me=JSON.parse(localStorage.getItem(`cravings_${n.uid}`)||"[]");Me.push({strength:0,mood:"quick",context:"quick_action",outcome:"resisted",timestamp:te,date:Se}),localStorage.setItem(`cravings_${n.uid}`,JSON.stringify(Me));const fe={resisted:v.resisted+1,relapses:v.relapses,lastUpdated:te};localStorage.setItem(`cravingStats_${n.uid}`,JSON.stringify(fe)),V(fe),ge?!ge.canAwardMentalStrength&&!ge.canAwardTriggerDefense?w({title:" Daily Limits Reached",message:`You've reached your daily limits for Mental Strength (3 points) and Trigger Defense (5 points).

Great job staying consistent! Come back tomorrow for more opportunities to grow.`,type:"info"}):ge.canAwardMentalStrength?ge.canAwardTriggerDefense?w({title:" Quick Win!",message:`Great job resisting that craving!

Your Mental Strength increased by 1 point and Trigger Defense increased by 3 points!`,type:"success"}):w({title:" Trigger Defense Limit Reached",message:`You've reached your daily limit for Trigger Defense (5 points).

Your Mental Strength increased by 1 point!

Come back tomorrow for more Trigger Defense opportunities.`,type:"info"}):w({title:" Mental Strength Limit Reached",message:`You've reached your daily limit for Mental Strength (3 points).

Your Trigger Defense increased by 3 points!

Come back tomorrow for more Mental Strength opportunities.`,type:"info"}):w({title:" Quick Win!",message:`Great job resisting that craving!

Your Mental Strength and Trigger Defense have increased.`,type:"success"}),m(!0)}}catch(te){console.error("Error recording quick resistance:",te),w({title:"Progress Recorded",message:"Your progress has been recorded locally.",type:"info"}),m(!0)}},Ee=async()=>{try{const te=new Date().toISOString(),Se=new Date().toDateString();if(n&&n.uid){const{ref:be,set:ye,push:at}=await Ve(()=>import("./index.esm-ebdb357d.js"),[]),bt=be(H,`users/${n.uid}/cravings`),dt=at(bt);if(await ye(dt,{strength:0,mood:"quick",context:"quick_action",outcome:"relapsed",timestamp:te,date:Se}),window.centralizedStatService){if(console.log(" Quick Relapse: Using CentralizedStatService..."),await window.centralizedStatService.handleRelapse(),console.log(" Quick Relapse: Stats updated via CentralizedStatService"),console.log(" Quick Relapse: Resetting buddy streak data after relapse..."),typeof setBuddyStreakData=="function"&&(setBuddyStreakData({streakDisplayText:"0 hours",streakDays:0,streakUnit:"hours"}),console.log(" Quick Relapse: Buddy streak data reset to 0 hours")),console.log(" Quick Relapse: Refreshing user stats after relapse..."),typeof calculateRealTimeStats=="function"&&n)try{const Me=await calculateRealTimeStats(n);Me&&(console.log(" Quick Relapse: Updated user stats after relapse:",Me.streakDisplayText),typeof setRealTimeUserStats=="function"&&(setRealTimeUserStats(Me),console.log(" Quick Relapse: User stats refreshed after relapse")))}catch(Me){console.error(" Quick Relapse: Failed to refresh user stats:",Me)}Q(" Relapse Logged",`It's okay, setbacks happen. What matters is that you're getting back on track.

Your stats have been updated with escalation penalties.

Keep pushing forward! `,"warning")}else if(S){console.log(" Quick Relapse: Calling StatManager.handleRelapse()...");const Me=await S.handleRelapse();if(console.log(" Quick Relapse: StatManager.handleRelapse() result:",Me),o)try{const fe=await S.getCurrentEscalationLevel();await o.logRelapse(n.uid,{escalationLevel:fe,triggers:n.triggers||[],mood:"quick",context:"quick_action",addictionIncrease:fe===1?4:fe===2?6:8,mentalStrengthDecrease:3,triggerDefenseDecrease:3}),console.log(" Quick relapse also logged to Firestore for analytics")}catch(fe){console.warn(" Could not log quick relapse to Firestore:",fe.message),await Ce("relapse",{escalationLevel:await S.getCurrentEscalationLevel(),triggers:n.triggers||[],mood:"quick",context:"quick_action",addictionIncrease:escalationLevel===1?4:escalationLevel===2?6:8,mentalStrengthDecrease:3,triggerDefenseDecrease:3})}if(console.log(" Quick Relapse: Resetting buddy streak data after relapse (StatManager path)..."),typeof setBuddyStreakData=="function"&&(setBuddyStreakData({streakDisplayText:"0 hours",streakDays:0,streakUnit:"hours"}),console.log(" Quick Relapse: Buddy streak data reset to 0 hours (StatManager path)")),console.log(" Quick Relapse: Refreshing user stats after relapse (StatManager path)..."),typeof calculateRealTimeStats=="function"&&n)try{const fe=await calculateRealTimeStats(n);fe&&(console.log(" Quick Relapse: Updated user stats after relapse (StatManager path):",fe.streakDisplayText),typeof setRealTimeUserStats=="function"&&(setRealTimeUserStats(fe),console.log(" Quick Relapse: User stats refreshed after relapse (StatManager path)")))}catch(fe){console.error(" Quick Relapse: Failed to refresh user stats (StatManager path):",fe)}try{await new Promise(Tt=>setTimeout(Tt,100));const{ref:fe,get:je}=await Ve(()=>import("./index.esm-ebdb357d.js"),[]),Gt=await je(fe(H,`users/${n.uid}/stats`));if(Gt.exists()){const Tt=Gt.val();console.log(" Quick Relapse: VERIFICATION - Firebase stats immediately after StatManager:",Tt)}else console.log(" Quick Relapse: VERIFICATION - No stats found in Firebase!")}catch(fe){console.error(" Quick Relapse: VERIFICATION failed:",fe)}try{const fe=await S.getCurrentEscalationLevel();let je=0;switch(fe){case 1:je=4;break;case 2:je=6;break;default:je=8;break}Q(" Relapse Logged",`It's okay, setbacks happen. What matters is that you're getting back on track.

 Stat Changes:
 Addiction: +${je} points
 Mental Strength: -3 points
 Trigger Defense: -3 points

Your journey continues! `,"warning")}catch(fe){console.warn("Could not get escalation level for message:",fe),Q(" Relapse Logged",`It's okay, setbacks happen. What matters is that you're getting back on track.

Your stats have been updated. Keep pushing forward! `,"warning")}}else console.error(" Quick Relapse: StatManager not available!"),Q(" Service Unavailable","Stats service is not available. Your relapse has been recorded locally and will sync when the service is restored.","warning");const Xe=be(H,`users/${n.uid}/profile/cravingStats`),st={resisted:v.resisted,relapses:v.relapses+1,lastUpdated:te};await ye(Xe,st),V(st),console.log(" Quick Relapse: Triggering stats refresh..."),typeof refreshStats=="function"?(refreshStats(),setTimeout(()=>{console.log(" Quick Relapse: Secondary stats refresh..."),refreshStats()},1500)):console.log(" Quick Relapse: refreshStats function not available in this context (will refresh when returning to Arena)"),typeof window.refreshAfterRelapse=="function"?(console.log(" Quick Relapse: Comprehensive Arena refresh after relapse..."),window.refreshAfterRelapse(),setTimeout(()=>{console.log(" Quick Relapse: Secondary comprehensive Arena refresh..."),window.refreshAfterRelapse()},2e3)):typeof window.refreshArenaStats=="function"?(console.log(" Quick Relapse: Fallback to regular Arena stats refresh..."),window.refreshArenaStats(),setTimeout(()=>{console.log(" Quick Relapse: Secondary Arena stats refresh..."),window.refreshArenaStats()},2e3)):console.warn(" Quick Relapse: No Arena refresh functions available"),console.log(" Quick Relapse: Triggering immediate PWA refresh..."),typeof window.refreshArenaStats=="function"&&(console.log(" Quick Relapse: Immediate Arena stats refresh..."),window.refreshArenaStats()),typeof setUser=="function"&&setUser(Me=>({...Me,lastRelapseRefresh:Date.now()})),window.centralizedStatService&&window.centralizedStatService.getCurrentStats().then(Me=>{console.log(" Quick Relapse: Fetched latest stats after relapse:",Me),typeof window.setLatestUserStats=="function"&&window.setLatestUserStats(Me),window.dispatchEvent(new CustomEvent("statsUpdated",{detail:Me}))}).catch(Me=>{console.error(" Quick Relapse: Failed to fetch latest stats:",Me)}),setTimeout(()=>{console.log(" Quick Relapse: Secondary immediate refresh..."),typeof window.refreshArenaStats=="function"&&window.refreshArenaStats(),window.dispatchEvent(new Event("resize"))},100),setTimeout(()=>{console.log(" Quick Relapse: Tertiary immediate refresh..."),typeof window.refreshArenaStats=="function"&&window.refreshArenaStats()},500)}const ge=JSON.parse(localStorage.getItem(`cravings_${n.uid}`)||"[]");ge.push({strength:0,mood:"quick",context:"quick_action",outcome:"relapsed",timestamp:te,date:Se}),localStorage.setItem(`cravings_${n.uid}`,JSON.stringify(ge));const Oe={resisted:v.resisted,relapses:v.relapses+1,lastUpdated:te};localStorage.setItem(`cravingStats_${n.uid}`,JSON.stringify(Oe)),V(Oe)}catch(te){console.error("Error recording quick relapse:",te),Q(" Relapse Logged",`It's okay, setbacks happen. What matters is that you're getting back on track.

Your progress has been recorded locally and will sync when the connection is restored.

Keep pushing forward! `,"warning")}},Je=async(te,Se=30)=>{try{if(!te)return null;const{ref:ge,get:Oe,query:be,orderByChild:ye,startAt:at,endAt:bt}=await Ve(()=>import("./index.esm-ebdb357d.js"),[]),dt=new Date,Xe=new Date(dt.getTime()-Se*24*60*60*1e3),st=ge(H,`users/${te}/cravings`),Me=await Oe(st);if(!Me.exists())return{totalCravings:0,resistedCount:0,relapseCount:0,averageStrength:0,commonMoods:[],commonContexts:[],timeOfDayPatterns:{},weeklyTrends:{},insights:[]};const je=Object.values(Me.val()||{}).filter(qe=>{const Qe=new Date(qe.timestamp);return Qe>=Xe&&Qe<=dt});if(je.length===0)return{totalCravings:0,resistedCount:0,relapseCount:0,averageStrength:0,commonMoods:[],commonContexts:[],timeOfDayPatterns:{},weeklyTrends:{},insights:[]};const Gt=je.filter(qe=>qe.outcome==="resisted").length,Tt=je.filter(qe=>qe.outcome==="relapsed").length,en=je.length,fn=je.reduce((qe,Qe)=>qe+(Qe.strength||0),0)/en,Ht={},wn={},tn={},mn={};je.forEach(qe=>{qe.mood&&(Ht[qe.mood]=(Ht[qe.mood]||0)+1),qe.context&&(wn[qe.context]=(wn[qe.context]||0)+1),qe.timeOfDay&&(tn[qe.timeOfDay]=(tn[qe.timeOfDay]||0)+1);const Qe=new Date(qe.timestamp),nn=`${Qe.getFullYear()}-W${Math.ceil((Qe.getDate()+new Date(Qe.getFullYear(),0,1).getDay())/7)}`;mn[nn]=(mn[nn]||0)+1});const cn=Object.entries(Ht).sort(([,qe],[,Qe])=>Qe-qe).slice(0,3).map(([qe,Qe])=>({mood:qe,count:Qe})),Qt=Object.entries(wn).sort(([,qe],[,Qe])=>Qe-qe).slice(0,3).map(([qe,Qe])=>({context:qe,count:Qe})),Gn=[];return Gt>Tt&&Gn.push("You're successfully resisting more cravings than giving in - great job!"),fn>7&&Gn.push("Your cravings tend to be high intensity. Consider developing stronger coping strategies for intense moments."),tn.afternoon>tn.morning&&tn.afternoon>tn.evening&&Gn.push("Afternoons seem to be your most challenging time. Consider planning activities or support during this period."),cn.length>0&&cn[0].count>en*.4&&Gn.push(`You often experience cravings when feeling ${cn[0].mood}. This might be a key trigger to address.`),{totalCravings:en,resistedCount:Gt,relapseCount:Tt,averageStrength:Math.round(fn*10)/10,successRate:en>0?Math.round(Gt/en*100):0,commonMoods:cn,commonContexts:Qt,timeOfDayPatterns:tn,weeklyTrends:mn,insights:Gn,dateRange:{start:Xe.toDateString(),end:dt.toDateString(),days:Se}}}catch(ge){return console.error("Error getting craving insights:",ge),null}},Et=async(te,Se="json")=>{try{if(!te)return null;const{ref:ge,get:Oe}=await Ve(()=>import("./index.esm-ebdb357d.js"),[]),be=ge(H,`users/${n.uid}/cravings`),ye=await Oe(be);if(!ye.exists())return console.log("No craving data to export"),null;const at=Object.values(ye.val()||{});if(Se==="json"){const bt=JSON.stringify(at,null,2),dt=new Blob([bt],{type:"application/json"}),Xe=URL.createObjectURL(dt),st=document.createElement("a");return st.href=Xe,st.download=`craving-data-${te}-${new Date().toISOString().split("T")[0]}.json`,st.click(),URL.revokeObjectURL(Xe),console.log(`Exported ${at.length} craving records for user ${te}`),at.length}return at.length}catch(ge){return console.error("Error exporting craving data:",ge),null}},ut=async()=>{if(!(n!=null&&n.uid)){console.log("No user logged in");return}console.log(" Testing craving insights...");const te=await Je(n.uid,30);te?(console.log(" Craving Insights:",te),w({title:" Your Craving Insights",message:`Last 30 days:

Total cravings: ${te.totalCravings}
Successfully resisted: ${te.resistedCount}
Relapses: ${te.relapseCount}
Success rate: ${te.successRate}%
Average intensity: ${te.averageStrength}/10

Top mood triggers: ${te.commonMoods.map(Se=>`${Se.mood} (${Se.count})`).join(", ")}
Top contexts: ${te.commonContexts.map(Se=>`${Se.context} (${Se.count})`).join(", ")}

Insights:
${te.insights.join(`
`)}`,type:"info"}),m(!0)):(console.log("No insights available"),w({title:" No Data Yet",message:"Start logging cravings to see insights and patterns!",type:"info"}),m(!0))};return l.jsx("div",{className:"min-h-screen bg-gradient-to-br from-slate-900 via-blue-900 to-slate-900 py-8 pb-20",children:l.jsxs("div",{className:"max-w-2xl mx-auto px-4",children:[l.jsx("div",{className:"mb-8",children:l.jsxs("div",{className:"flex justify-start gap-3",children:[l.jsx("button",{onClick:t,className:"px-6 py-3 bg-slate-600 hover:bg-slate-500 text-white rounded-lg transition-colors flex items-center gap-2",children:" Back to Login"}),!1]})}),l.jsxs("div",{className:"bg-slate-800/30 rounded-2xl p-8 mb-8 border border-slate-600/30 shadow-xl",children:[l.jsx("div",{className:"mb-8",children:l.jsx("button",{onClick:De,className:"w-full bg-gradient-to-r from-orange-400 via-amber-500 to-orange-500 hover:from-orange-500 hover:via-amber-600 hover:to-orange-600 text-white font-semibold py-5 px-6 rounded-2xl text-lg transition-all duration-300 transform hover:scale-102 shadow-2xl border border-orange-300/30 hover:border-orange-300/50",children:l.jsxs("div",{className:"flex items-center justify-center gap-3",children:[l.jsx("span",{className:"text-xl",children:""}),l.jsx("span",{children:"I feel like vaping"})]})})}),l.jsxs("div",{className:"grid grid-cols-2 gap-6",children:[l.jsx("button",{onClick:Pe,className:"btn-success touch-interactive ripple-effect bg-slate-700/50 hover:bg-slate-600/50 text-slate-200 font-medium py-3 px-5 rounded-full shadow-lg border border-slate-500/30 hover:border-slate-400/50 min-h-[44px]",children:l.jsxs("div",{className:"flex items-center justify-center gap-2",children:[l.jsx("span",{className:"text-green-400",children:""}),l.jsx("span",{children:"I resisted craving"})]})}),l.jsx("button",{onClick:Ee,className:"btn-danger touch-interactive ripple-effect bg-slate-700/50 hover:bg-slate-600/50 text-slate-200 font-medium py-3 px-5 rounded-full shadow-lg border border-slate-500/30 hover:border-slate-400/50 min-h-[44px]",children:l.jsxs("div",{className:"flex items-center justify-center gap-2",children:[l.jsx("span",{className:"text-red-400",children:""}),l.jsx("span",{children:"I relapsed"})]})})]})]}),l.jsxs("div",{className:"bg-slate-800/30 rounded-2xl p-6 mb-8 border border-slate-600/30 shadow-lg",children:[l.jsx("h2",{className:"text-lg font-medium text-slate-200 mb-6 text-center",children:" This Week"}),l.jsxs("div",{className:"grid grid-cols-2 gap-6",children:[l.jsxs("div",{className:"text-center p-5 bg-slate-700/30 rounded-xl border border-slate-500/20 hover:border-slate-400/40 transition-all duration-300",children:[l.jsx("div",{className:"text-2xl mb-3 text-green-400",children:""}),l.jsx("p",{className:"text-2xl font-semibold text-white mb-1",children:v.resisted}),l.jsx("p",{className:"text-sm text-slate-300",children:"Cravings Resisted"})]}),l.jsxs("div",{className:"text-center p-5 bg-slate-700/30 rounded-xl border border-slate-500/20 hover:border-slate-400/40 transition-all duration-300",children:[l.jsx("div",{className:"text-2xl mb-3 text-red-400",children:""}),l.jsx("p",{className:"text-2xl font-semibold text-white mb-1",children:v.relapses}),l.jsx("p",{className:"text-sm text-slate-300",children:"Relapses"})]})]})]}),l.jsx("div",{className:"bg-slate-800/30 rounded-2xl p-6 mb-8 border border-slate-600/30 shadow-lg",children:l.jsxs("div",{className:"text-center",children:[l.jsx("h2",{className:"text-lg font-medium text-slate-200 mb-6",children:" Distract Yourself"}),l.jsx("div",{className:"flex justify-center",children:l.jsx("button",{onClick:ee,className:"w-full max-w-xs bg-slate-700/30 hover:bg-slate-600/40 text-slate-200 font-medium py-4 px-6 rounded-xl text-lg transition-all duration-300 transform hover:scale-105 border border-slate-500/20 hover:border-slate-400/40 shadow-lg min-h-[44px]",children:" Play Snake"})})]})}),l.jsx("div",{className:"bg-slate-800/30 rounded-2xl p-6 mb-8 border border-slate-600/30 shadow-lg",children:l.jsxs("div",{className:"text-center",children:[l.jsx("h2",{className:"text-lg font-medium text-slate-200 mb-6",children:" Data Analysis"}),l.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[l.jsx("button",{onClick:ut,className:"bg-blue-600/30 hover:bg-blue-500/40 text-blue-200 font-medium py-3 px-4 rounded-xl transition-all duration-300 transform hover:scale-105 border border-blue-500/20 hover:border-blue-400/40 shadow-lg min-h-[44px]",children:" View Insights"}),l.jsx("button",{onClick:()=>Et(n==null?void 0:n.uid,"json"),className:"bg-green-600/30 hover:bg-green-500/40 text-green-200 font-medium py-3 px-4 rounded-xl transition-all duration-300 transform hover:scale-105 border border-green-500/20 hover:border-green-400/40 shadow-lg min-h-[44px]",children:" Export Data"})]})]})}),l.jsxs("div",{className:"bg-slate-800/30 rounded-2xl p-6 border border-slate-600/30 shadow-lg",children:[l.jsx("h2",{className:"text-lg font-medium text-slate-200 mb-6 text-center",children:" Quick Actions"}),l.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[l.jsx("button",{onClick:()=>I(!0),className:"btn-primary touch-interactive ripple-effect bg-slate-700/30 hover:bg-slate-600/40 text-slate-200 font-medium py-4 px-4 rounded-xl border border-slate-500/20 hover:border-slate-400/40 shadow-lg min-h-[44px]",children:" Hydration"}),l.jsx("button",{onClick:()=>F(!0),className:"breathing-button touch-interactive ripple-effect bg-slate-700/30 hover:bg-slate-600/40 text-slate-200 font-medium py-4 px-4 rounded-xl border border-slate-500/20 hover:border-slate-400/40 shadow-lg min-h-[44px]",children:" Breathe"}),l.jsx("button",{onClick:async()=>{if(Q(" Walk",`Take a 5-minute walk:

Physical activity releases endorphins that can help reduce cravings.

Walk around your room or step outside if possible.`),o)try{await o.logPhysicalActivity(n.uid,{type:"walk",duration:5,intensity:"moderate",triggerContext:"craving-triggered",location:"indoor/outdoor"}),console.log(" Physical activity (walk) logged to Firestore for analytics")}catch(te){console.warn(" Could not log physical activity to Firestore:",te.message),await Ce("walk",{type:"walk",duration:5,intensity:"moderate",triggerContext:"craving-triggered",location:"indoor/outdoor"})}},className:"bg-slate-700/30 hover:bg-slate-600/40 text-slate-200 font-medium py-4 px-4 rounded-xl transition-all duration-300 border border-slate-500/20 hover:border-slate-400/40 hover:scale-105 shadow-lg min-h-[44px]",children:" Walk"}),l.jsx("button",{onClick:async()=>{if(Q(" Meditate",`Quick Meditation:

1. Close your eyes
2. Focus on your breath
3. Count to 10 slowly
4. Repeat 3 times

This helps calm your mind and reduce stress.`),o)try{await o.logMeditation(n.uid,{type:"mindfulness",duration:2,triggerContext:"craving-triggered",completed:!0}),console.log(" Meditation (quick) logged to Firestore for analytics")}catch(te){console.warn(" Could not log meditation to Firestore:",te.message)}},className:"bg-slate-700/30 hover:bg-slate-600/40 text-slate-200 font-medium py-4 px-4 rounded-xl transition-all duration-300 border border-slate-500/20 hover:border-slate-400/40 hover:scale-105 shadow-lg min-h-[44px]",children:" Meditate"})]})]}),a&&u&&l.jsx(dq,{gameType:u,onClose:pe}),l.jsx(uq,{isOpen:f,onClose:()=>m(!1),title:y.title,message:y.message,type:y.type}),T&&l.jsx(mq,{isOpen:T,onClose:()=>I(!1),onLogWater:xe,currentWater:N,userId:n.uid}),B&&l.jsx(tq,{isOpen:B,onClose:()=>F(!1),onComplete:s,onNavigateToCravingSupport:()=>i("craving-support")}),A&&l.jsx(fq,{isOpen:A,onClose:()=>x(!1),step:E,cravingData:C,setCravingData:_,onNext:Re,onPrev:_t,onComplete:Ae,dailyCravingLogs:U})]})})},fq=({isOpen:n,onClose:e,step:t,cravingData:r,setCravingData:s,onNext:i,onPrev:o,onComplete:a,dailyCravingLogs:c})=>{const u=y=>y<=3?{text:"text-green-400",slider:"#22c55e",shadow:"rgba(74, 222, 128, 0.5)",label:"Low",effect:"craving-low",thumbClass:"slider-thumb-green"}:y<=7?{text:"text-orange-400",slider:"#fbbf24",shadow:"rgba(249, 115, 22, 0.5)",label:"Medium",effect:"craving-medium",thumbClass:"slider-thumb-orange"}:{text:"text-red-400",slider:"#ef4444",shadow:"rgba(239, 68, 68, 0.5)",label:"High",effect:"craving-high",thumbClass:"slider-thumb-red"},h=[{id:"stressed",icon:"",label:"Stressed"},{id:"lonely",icon:"",label:"Lonely"},{id:"happy",icon:"",label:"Happy"},{id:"bored",icon:"",label:"Bored"},{id:"excited",icon:"",label:"Excited"},{id:"down",icon:"",label:"Down"},{id:"angry",icon:"",label:"Angry"},{id:"anxious",icon:"",label:"Anxious"}],f=[{id:"break",icon:"",label:"I'm taking a break"},{id:"partying",icon:"",label:"I'm partying"},{id:"drinking",icon:"",label:"I'm drinking alcohol"},{id:"car",icon:"",label:"I'm in a car"},{id:"coffee",icon:"",label:"I'm drinking coffee"},{id:"eating",icon:"",label:"I've just finished eating"},{id:"intimate",icon:"",label:"I've made love"},{id:"tv",icon:"",label:"I'm watching TV"},{id:"wake",icon:"",label:"I've just woken up"}],m=()=>{switch(t){case 1:return l.jsx("div",{className:"text-center",children:l.jsx("div",{className:"mb-8",children:(()=>{const y=u(r.strength);return l.jsxs(l.Fragment,{children:[l.jsx("div",{className:`text-6xl font-bold mb-2 ${y.text} ${y.effect}`,children:r.strength}),l.jsxs("div",{className:`text-lg font-medium mb-6 ${y.text}`,children:[y.label," Craving"]}),l.jsx("input",{type:"range",min:"0",max:"10",value:r.strength,onChange:w=>s({...r,strength:parseInt(w.target.value)}),style:{background:`linear-gradient(to right, ${y.slider} 0%, ${y.slider} ${r.strength/10*100}%, #475569 ${r.strength/10*100}%, #475569 100%)`},className:`w-full h-4 rounded-lg appearance-none cursor-pointer slider mb-4 ${y.thumbClass}`,autoComplete:"off"}),l.jsxs("div",{className:"flex justify-between text-sm text-gray-400",children:[l.jsx("span",{children:"Not at all"}),l.jsx("span",{children:"Extremely"})]})]})})()})});case 2:return l.jsx("div",{className:"text-center",children:l.jsx("div",{className:"grid grid-cols-4 gap-3",children:h.map(y=>l.jsxs("button",{onClick:()=>s({...r,mood:y.id}),className:`p-4 rounded-xl border-2 transition-all duration-300 min-h-[44px] ${r.mood===y.id?"border-blue-400 bg-blue-500/20":"border-slate-600 bg-slate-700/50 hover:border-slate-500"}`,children:[l.jsx("div",{className:"text-3xl mb-2",children:y.icon}),l.jsx("div",{className:"text-xs text-gray-300",children:y.label})]},y.id))})});case 3:return l.jsx("div",{className:"text-center",children:l.jsx("div",{className:"grid grid-cols-3 gap-3",children:f.map(y=>l.jsxs("button",{onClick:()=>s({...r,context:y.id}),className:`p-4 rounded-xl border-2 transition-all duration-300 min-h-[44px] ${r.context===y.id?"border-blue-400 bg-blue-500/20":"border-slate-600 bg-slate-700/50 hover:border-slate-500"}`,children:[l.jsx("div",{className:"text-2xl mb-2",children:y.icon}),l.jsx("div",{className:"text-xs text-gray-300 text-center",children:y.label})]},y.id))})});case 4:return l.jsx("div",{className:"text-center",children:l.jsxs("div",{className:"space-y-4",children:[l.jsx("button",{onClick:()=>a("resisted"),className:"w-full bg-gradient-to-r from-green-500 to-green-600 hover:from-green-600 hover:to-green-700 text-white font-bold py-4 px-6 rounded-xl transition-all duration-300 transform hover:scale-105 shadow-lg",children:" I successfully resisted"}),l.jsx("button",{onClick:()=>a("resistance_practices"),className:"w-full bg-gradient-to-r from-purple-500 to-purple-600 hover:from-purple-600 hover:to-purple-700 text-white font-bold py-4 px-6 rounded-xl transition-all duration-300 transform hover:scale-105 shadow-lg",children:" Use resistance practices"}),l.jsx("button",{onClick:()=>a("logged"),className:"w-full bg-gradient-to-r from-blue-500 to-blue-600 hover:from-blue-600 hover:to-blue-700 text-white font-bold py-4 px-6 rounded-xl transition-all duration-300 transform hover:scale-105 shadow-lg",children:" Just log this craving"}),l.jsx("button",{onClick:()=>a("relapsed"),className:"w-full bg-gradient-to-r from-red-500 to-red-600 hover:from-red-600 hover:to-red-700 text-white font-bold py-4 px-6 rounded-xl transition-all duration-300 transform hover:scale-105 shadow-lg",children:" I had a relapse"})]})});default:return null}};return n?l.jsx("div",{className:"modal-backdrop",children:l.jsx("div",{className:"modal-container",children:l.jsxs("div",{className:"modal-content bg-gradient-to-br from-slate-800 via-slate-700 to-slate-800 border-slate-600/50 relative overflow-hidden max-w-lg",children:[l.jsx("div",{className:"absolute inset-0 bg-orange-500/5 pointer-events-none"}),l.jsxs("div",{className:"relative z-10",children:[l.jsxs("div",{className:"text-center mb-6",children:[l.jsx("div",{className:"flex justify-center space-x-2 mb-3",children:[1,2,3,4].map(y=>l.jsx("div",{className:`w-3 h-3 rounded-full ${y<=t?"bg-orange-400":"bg-slate-600"}`},y))}),l.jsxs("p",{className:"text-gray-400 text-sm",children:["Step ",t," of 4"]}),l.jsxs("div",{className:"mt-2 text-xs text-gray-500",children:["Daily logs: ",c,"/2"]})]}),l.jsx("div",{className:"mb-8",children:m()}),l.jsxs("div",{className:"flex justify-between",children:[t>1&&l.jsx("button",{onClick:o,className:"px-6 py-3 bg-slate-600 hover:bg-slate-500 text-white rounded-xl transition-colors",children:" Back"}),t<4&&l.jsx("button",{onClick:i,disabled:t===1&&r.strength===void 0||t===2&&!r.mood||t===3&&!r.context,className:"px-6 py-3 bg-orange-500 hover:bg-orange-600 disabled:bg-slate-600 disabled:cursor-not-allowed text-white rounded-xl transition-colors ml-auto",children:"Next "})]}),l.jsx("button",{onClick:e,className:"absolute top-4 right-4 text-gray-400 hover:text-white text-2xl",children:""})]})]})})}):null},mq=({isOpen:n,onClose:e,onLogWater:t,currentWater:r,userId:s})=>{const[i,o]=D.useState(0),[a,c]=D.useState(0),[u,h]=D.useState(!1);D.useState(!1),D.useEffect(()=>{n&&s&&f()},[n,s,r]);const f=async()=>{try{const{ref:R,get:T}=await Ve(()=>import("./index.esm-ebdb357d.js"),[]),I=await m();o(I);const N=await y();c(N)}catch(R){console.error("Error loading hydration data:",R)}},m=async()=>{try{const{ref:R,get:T}=await Ve(()=>import("./index.esm-ebdb357d.js"),[]);let I=0;for(let N=0;N<7;N++){const P=new Date;P.setDate(P.getDate()-N);const B=P.toDateString(),F=await T(R(H,`users/${s}/profile/daily/${B}/water`));if(F.exists()&&F.val()>0)I++;else break}return I}catch(R){return console.error("Error checking hydration streak:",R),0}},y=async()=>{try{const{ref:R,get:T}=await Ve(()=>import("./index.esm-ebdb357d.js"),[]);let I=0;for(let N=0;N<7;N++){const P=new Date;P.setDate(P.getDate()-N);const B=P.toDateString(),F=await T(R(H,`users/${s}/profile/daily/${B}/water`));F.exists()&&F.val()>=6&&I++}return Math.min(I,3)}catch(R){return console.error("Error checking mental strength progress:",R),0}},w=()=>l.jsx("div",{className:"glasses-visual",children:[...Array(6)].map((R,T)=>{const I=T<r;return l.jsx("div",{className:`glass ${I?"filled":""}`},T)})}),S=async()=>{!s||u||r>=6||(h(!0),t(),setTimeout(async()=>{h(!1),await f()},1e3))};return!n||!s?null:l.jsx("div",{className:"modal-backdrop",children:l.jsx("div",{className:"modal-container",children:l.jsx("div",{className:"modal-content",children:l.jsxs("div",{className:"hydration-module",children:[l.jsxs("div",{className:"module-header",children:[l.jsxs("div",{className:"module-title",children:[l.jsx("div",{className:"water-icon",children:""}),"Hydration Tracker"]}),l.jsx("p",{className:"subtitle",children:"Stay hydrated, stay strong"})]}),l.jsxs("div",{className:"progress-container",children:[l.jsxs("div",{className:"progress-header",children:[l.jsx("span",{className:"progress-text",children:"Today's Progress"}),l.jsxs("span",{className:"progress-fraction",children:[r,"/6"]})]}),w(),l.jsx("div",{className:"progress-bar",children:l.jsx("div",{className:"progress-fill",style:{width:`${r/6*100}%`}})}),l.jsxs("div",{className:"progress-percentage",children:[Math.round(r/6*100),"% Complete"]})]}),l.jsxs("div",{className:"streak-section",children:[l.jsxs("div",{className:"streak-card",children:[l.jsx("span",{className:"streak-icon",children:""}),l.jsx("div",{className:"streak-label",children:"Hydration Streak"}),l.jsxs("div",{className:"streak-value",children:[i," days"]})]}),l.jsxs("div",{className:"streak-card",children:[l.jsx("span",{className:"streak-icon",children:""}),l.jsx("div",{className:"streak-label",children:"Mental Strength"}),l.jsxs("div",{className:"streak-value",children:[a,"/3"]})]})]}),r===6&&l.jsx("div",{className:"completion-message",children:" Congratulations! You've completed your daily hydration goal!"}),l.jsx("button",{onClick:S,disabled:r>=6||u,className:"log-button",children:r>=6?" Goal Complete!":u?" Logging...":" Log Water"}),l.jsx("button",{onClick:e,className:"done-button",children:"Done"})]})})})})},pq=({user:n,onNavigate:e})=>{const[t,r]=D.useState(null),[s,i]=D.useState(!1),[o,a]=D.useState(!1),[c,u]=D.useState(!1),[h,f]=D.useState(!1),[m,y]=D.useState(null),[w,S]=D.useState(0),[R,T]=D.useState(null),[I,N]=D.useState(!1),[P,B]=D.useState([]),[F,A]=D.useState(null);D.useEffect(()=>{if(!(n!=null&&n.uid))return;(async()=>{try{const Ee=new Fg(H,n.uid);await Ee.initialize(),A(Ee)}catch(Ee){console.error("Error initializing StatManager:",Ee)}})();const Ae=async()=>{try{const{ref:Ee,get:Je,onValue:Et}=await Ve(()=>import("./index.esm-ebdb357d.js"),[]),ut=Ee(H,`users/${n.uid}/profile/relapseDate`),te=await Je(ut);te.exists()&&r(new Date(te.val()));const Se=Ee(H,`users/${n.uid}/profile/scheduledTriggers`),ge=await Je(Se);ge.exists()&&B(ge.val());const Oe=new Date().toDateString(),be=Ee(H,`users/${n.uid}/profile/daily/${Oe}/water`),ye=Et(be,fe=>{fe.exists()&&S(fe.val()||0)}),at=Ee(H,`users/${n.uid}/profile/daily/${Oe}/mood`),bt=Et(at,fe=>{fe.exists()&&T(fe.val())}),dt=Ee(H,`users/${n.uid}/profile/daily/${Oe}/breathing`),Xe=Et(dt,fe=>{fe.exists()&&N(fe.val()||!1)}),st=Ee(H,`users/${n.uid}/profile/scheduledTriggers`),Me=Et(st,fe=>{fe.exists()&&B(fe.val()||[])});return()=>{ye(),bt(),Xe(),Me()}}catch(Ee){console.error("Error loading profile data from Firebase:",Ee),Pe()}},Pe=()=>{const Ee=localStorage.getItem("quitCoachRelapseDate");Ee&&r(new Date(Ee));const Je=new Date().toDateString(),Et=localStorage.getItem(`water_${n.uid}_${Je}`),ut=localStorage.getItem(`mood_${n.uid}_${Je}`),te=localStorage.getItem(`breathing_${n.uid}_${Je}`);Et&&S(parseInt(Et)),ut&&T(JSON.parse(ut)),te&&N(te==="true");const Se=localStorage.getItem("scheduledTriggers");Se&&B(JSON.parse(Se))};Ae()},[n==null?void 0:n.uid]),D.useEffect(()=>{F&&F.trackLoggingActivity()},[F]),D.useEffect(()=>{if(!(n!=null&&n.uid))return;(async()=>{try{const{ref:Ae,get:Pe,set:Ee}=await Ve(()=>import("./index.esm-ebdb357d.js"),[]),Je=Ae(H,`users/${n.uid}/profile`),Et=await Pe(Je);if(!Et.exists()||Object.keys(Et.val()).length===0){console.log("Migrating localStorage data to Firebase...");const ut=localStorage.getItem("quitCoachRelapseDate");ut&&(await Ee(Ae(H,`users/${n.uid}/profile/relapseDate`),ut),r(new Date(ut)));const te=parseInt(localStorage.getItem("cravingWins")||0);te>0&&await Ee(Ae(H,`users/${n.uid}/profile/cravingsResisted`),te);for(let ge=0;ge<7;ge++){const Oe=new Date;Oe.setDate(Oe.getDate()-ge);const be=Oe.toDateString(),ye=localStorage.getItem(`water_${n.uid}_${be}`);ye&&await Ee(Ae(H,`users/${n.uid}/profile/daily/${be}/water`),parseInt(ye))}for(let ge=0;ge<7;ge++){const Oe=new Date;Oe.setDate(Oe.getDate()-ge);const be=Oe.toDateString(),ye=localStorage.getItem(`mood_${n.uid}_${be}`);ye&&await Ee(Ae(H,`users/${n.uid}/profile/daily/${be}/mood`),JSON.parse(ye))}for(let ge=0;ge<7;ge++){const Oe=new Date;Oe.setDate(Oe.getDate()-ge);const be=Oe.toDateString(),ye=localStorage.getItem(`breathing_${n.uid}_${be}`);ye&&await Ee(Ae(H,`users/${n.uid}/profile/daily/${be}/breathing`),ye==="true")}const Se=localStorage.getItem("scheduledTriggers");if(Se){const ge=JSON.parse(Se);await Ee(Ae(H,`users/${n.uid}/profile/scheduledTriggers`),ge),B(ge)}console.log("localStorage data migration to Firebase completed")}}catch(Ae){console.error("Error migrating localStorage data to Firebase:",Ae)}})()},[n==null?void 0:n.uid]);const x=()=>t&&t>((n==null?void 0:n.quitDate)||new Date(0))?t:(n==null?void 0:n.quitDate)||new Date,E=()=>{const Ce=new Date,Ae=new Date(Ce);Ae.setHours(24,0,0,0);const Pe=Ae-Ce,Ee=Math.floor(Pe/(1e3*60*60)),Je=Math.floor(Pe%(1e3*60*60)/(1e3*60)),Et=Math.floor(Pe%(1e3*60)/1e3);return{hours:Ee,minutes:Je,seconds:Et}},[k,C]=D.useState(E()),[_,v]=D.useState(0),[V,U]=D.useState(0),[ce,we]=D.useState(0),[z,re]=D.useState(0);D.useEffect(()=>{const Ce=setInterval(()=>{C(E());const Ae=x(),Ee=new Date-Ae,Je=Math.floor(Ee/(1e3*60*60*24)),Et=Math.floor(Ee%(1e3*60*60*24)/(1e3*60*60)),ut=Math.floor(Ee%(1e3*60*60)/(1e3*60)),te=Math.floor(Ee%(1e3*60)/1e3);v(Je),U(Et),we(ut),re(te)},1e3);return()=>clearInterval(Ce)},[t,n==null?void 0:n.quitDate]);const W=async(Ce,Ae)=>{if(!(n!=null&&n.uid))return!1;try{const{ref:Pe,set:Ee}=await Ve(()=>import("./index.esm-ebdb357d.js"),[]),Je=Pe(H,`users/${n.uid}/profile/${Ce}`);return await Ee(Je,Ae),!0}catch(Pe){return console.error("Error saving to Firebase:",Pe),!1}},Q=async()=>{const Ce=new Date;r(Ce),F&&await F.handleRelapse();const Ae=Ce.toISOString(),Pe=await W("relapseDate",Ae),Ee=await W("lastQuitDate",Ae);Pe||localStorage.setItem("quitCoachRelapseDate",Ae),Ee||localStorage.setItem("quitCoachLastQuitDate",Ae),console.log(" Relapse logged - quit date reset to relapse time:",Ae)},pe=(()=>{const Ce=new Date,Ae=Ce.getDay(),Pe=Ae===0?6:Ae-1,Ee=[{name:"Mon",color:"bg-slate-700"},{name:"Tue",color:"bg-slate-700"},{name:"Wed",color:"bg-slate-700"},{name:"Thu",color:"bg-slate-700"},{name:"Fri",color:"bg-slate-700"},{name:"Sat",color:"bg-slate-700"},{name:"Sun",color:"bg-slate-700"}];for(let Je=0;Je<=Pe;Je++)Ee[Je].color="bg-green-500";return t&&t.toDateString()===Ce.toDateString()&&(Ee[Pe].color="bg-red-500"),Ee})(),xe=async Ce=>{S(Ce);const Ae=new Date().toDateString();F&&await F.handleHydrationUpdate(Ce),await W(`daily/${Ae}/water`,Ce)||localStorage.setItem(`water_${Ae}`,Ce.toString()),i(!1)},De=async Ce=>{T(Ce);const Ae=new Date().toDateString();await W(`daily/${Ae}/mood`,Ce)||localStorage.setItem(`mood_${Ae}`,JSON.stringify(Ce)),a(!1)},Re=async(Ce,Ae,Pe)=>{const Ee={day:Ce,triggerType:Ae,time:Pe,id:Date.now()},Je=[...P,Ee];B(Je),F&&await F.handleTriggerPlanning(),await W("scheduledTriggers",Je)||localStorage.setItem("scheduledTriggers",JSON.stringify(Je)),u(!1)},_t=async()=>{F&&await F.handleTriggerListUpdate()};return l.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-slate-900 via-blue-900 to-slate-900 pb-20",children:[l.jsxs("div",{className:"flex items-center justify-between p-4 pt-16",children:[l.jsxs("div",{className:"flex items-center gap-3",children:[l.jsx("div",{className:"w-12 h-12 bg-gradient-to-br from-blue-400 to-blue-600 rounded-full flex items-center justify-center",children:n!=null&&n.avatar?l.jsx("img",{src:n.avatar,alt:"Avatar",className:"w-full h-full object-cover rounded-full"}):l.jsx("span",{className:"text-white font-bold text-lg",children:n!=null&&n.heroName?n.heroName.charAt(0).toUpperCase():"H"})}),l.jsxs("div",{children:[l.jsx("p",{className:"text-white text-lg",children:"Hello,"}),l.jsx("p",{className:"text-white text-2xl font-bold",children:(n==null?void 0:n.heroName)||"Hero"})]})]}),l.jsx("div",{className:"bg-yellow-500 px-3 py-1 rounded-full",children:l.jsx("span",{className:"font-bold text-slate-900",children:_})})]}),l.jsxs("div",{className:"px-4 space-y-6",children:[l.jsx("div",{className:"mb-6",children:l.jsxs("button",{onClick:Q,className:"w-full bg-gradient-to-r from-red-600 to-orange-600 hover:from-red-700 hover:to-orange-700 text-white font-bold py-4 px-6 rounded-xl transition-all duration-300 shadow-lg hover:shadow-xl transform hover:scale-105",children:[l.jsxs("div",{className:"flex items-center justify-center gap-3",children:[l.jsx("span",{className:"text-2xl",children:""}),l.jsx("span",{className:"text-lg",children:"RELAPSE"}),l.jsx("span",{className:"text-2xl",children:""})]}),l.jsx("p",{className:"text-sm opacity-90 mt-1",children:"Reset progress and start over"})]})}),l.jsxs("div",{className:"bg-slate-800/50 rounded-xl p-4",children:[l.jsxs("div",{className:"flex items-center justify-between mb-4",children:[l.jsx("h2",{className:"text-white text-xl font-bold",children:"My week"}),l.jsxs("div",{className:"bg-green-500 px-3 py-1 rounded-full flex items-center gap-1",children:[l.jsx("span",{className:"text-white text-sm",children:""}),l.jsx("span",{className:"text-white font-bold",children:"0"})]})]}),l.jsx("div",{className:"flex justify-between items-center mb-4",children:pe.map((Ce,Ae)=>l.jsxs("div",{className:"text-center",children:[l.jsx("div",{className:`w-8 h-8 rounded-full mb-1 ${Ce.color}`}),l.jsx("p",{className:"text-gray-400 text-xs",children:Ce.name})]},Ce.name))})]}),l.jsxs("div",{className:"bg-slate-800/50 rounded-xl p-4",children:[l.jsx("h3",{className:"text-white text-lg font-semibold mb-2",children:"Remaining time for Today"}),l.jsxs("div",{className:"text-center",children:[l.jsxs("div",{className:"text-white text-3xl font-bold",children:[k.hours.toString().padStart(2,"0"),":",k.minutes.toString().padStart(2,"0"),":",k.seconds.toString().padStart(2,"0")]}),l.jsx("p",{className:"text-gray-400 text-sm",children:"Countdown to midnight"})]})]}),l.jsxs("div",{children:[l.jsx("h2",{className:"text-white text-2xl font-bold mb-4",children:"My progress"}),l.jsxs("div",{className:"bg-slate-800/50 rounded-xl p-4 mb-4",children:[l.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[l.jsx("span",{className:"text-yellow-400 text-lg",children:""}),l.jsx("span",{className:"text-gray-300",children:"Clean for"})]}),l.jsxs("div",{className:"flex items-baseline gap-4",children:[l.jsxs("div",{className:"text-center",children:[l.jsx("div",{className:"text-white text-3xl font-bold",children:_.toString().padStart(2,"0")}),l.jsx("div",{className:"text-gray-400 text-sm",children:"days"})]}),l.jsxs("div",{className:"text-center",children:[l.jsx("div",{className:"text-white text-3xl font-bold",children:V.toString().padStart(2,"0")}),l.jsx("div",{className:"text-gray-400 text-sm",children:"hours"})]}),l.jsxs("div",{className:"text-center",children:[l.jsx("div",{className:"text-white text-3xl font-bold",children:ce.toString().padStart(2,"0")}),l.jsx("div",{className:"text-gray-400 text-sm",children:"minutes"})]}),l.jsxs("div",{className:"text-center",children:[l.jsx("div",{className:"text-white text-2xl font-bold animate-pulse",children:z.toString().padStart(2,"0")}),l.jsx("div",{className:"text-gray-400 text-sm",children:"seconds"})]})]}),t&&l.jsx("div",{className:"mt-3 text-center",children:l.jsxs("p",{className:"text-red-400 text-sm",children:["Last relapse: ",t.toLocaleDateString()," at ",t.toLocaleTimeString()]})})]})]}),l.jsxs("div",{children:[l.jsx("h2",{className:"text-white text-2xl font-bold mb-4",children:"Habit Tracking"}),l.jsxs("div",{className:"space-y-4",children:[l.jsx("button",{onClick:()=>i(!0),className:"w-full bg-gradient-to-r from-blue-500/20 to-blue-600/20 bg-slate-800/50 rounded-xl p-4 text-left hover:scale-105 transition-all duration-300",children:l.jsxs("div",{className:"flex items-center gap-4",children:[l.jsx("div",{className:"w-12 h-12 bg-white rounded-lg flex items-center justify-center text-xl",children:""}),l.jsxs("div",{className:"flex-1",children:[l.jsx("h3",{className:"text-white font-bold text-lg",children:"Stay hydrated"}),l.jsx("p",{className:"text-gray-300 text-sm",children:w>0?`${w} glasses today`:"Tap to log water intake"})]}),l.jsx("div",{className:"text-blue-400 text-2xl",children:""})]})}),l.jsx("button",{onClick:()=>a(!0),className:"w-full bg-gradient-to-r from-green-500/20 to-green-600/20 bg-slate-800/50 rounded-xl p-4 text-left hover:scale-105 transition-all duration-300",children:l.jsxs("div",{className:"flex items-center gap-4",children:[l.jsx("div",{className:"w-12 h-12 bg-white rounded-lg flex items-center justify-center text-xl",children:""}),l.jsxs("div",{className:"flex-1",children:[l.jsx("h3",{className:"text-white font-bold text-lg",children:"Mood tracking"}),l.jsx("p",{className:"text-gray-300 text-sm",children:R?`You feel ${R.name.toLowerCase()}`:"How do you feel today?"})]}),l.jsx("div",{className:"text-green-400 text-2xl",children:""})]})})]})]}),l.jsxs("div",{children:[l.jsx("h2",{className:"text-white text-2xl font-bold mb-4",children:"This Week's Battle Plan"}),l.jsxs("div",{className:"space-y-3",children:[l.jsx("button",{onClick:()=>u(!0),className:"w-full bg-gradient-to-r from-orange-500/20 to-orange-600/20 bg-slate-800/50 rounded-xl p-4 text-left hover:scale-105 transition-all duration-300",children:l.jsxs("div",{className:"flex items-center gap-4",children:[l.jsx("div",{className:"w-12 h-12 bg-white rounded-lg flex items-center justify-center text-xl",children:""}),l.jsxs("div",{className:"flex-1",children:[l.jsx("h3",{className:"text-white font-bold text-lg",children:"Trigger defense planning"}),l.jsx("p",{className:"text-gray-300 text-sm",children:P.length>0?`${P.length} triggers planned`:"Plan your trigger defense strategy"})]}),l.jsx("div",{className:"text-orange-400 text-2xl",children:""})]})}),l.jsx("button",{onClick:_t,className:"w-full bg-gradient-to-r from-purple-500/20 to-purple-600/20 bg-slate-800/50 rounded-xl p-4 text-left hover:scale-105 transition-all duration-300",children:l.jsxs("div",{className:"flex items-center gap-4",children:[l.jsx("div",{className:"w-12 h-12 bg-white rounded-lg flex items-center justify-center text-xl",children:""}),l.jsxs("div",{className:"flex-1",children:[l.jsx("h3",{className:"text-white font-bold text-lg",children:"Update trigger list"}),l.jsx("p",{className:"text-gray-300 text-sm",children:"Review and update your personal triggers for +1 Trigger Defense"})]}),l.jsx("div",{className:"text-purple-400 text-2xl",children:""})]})})]})]}),l.jsx("div",{children:l.jsx("h2",{className:"text-white text-2xl font-bold mb-4",children:"Benefits Monitor"})}),l.jsxs("div",{children:[l.jsx("h2",{className:"text-white text-2xl font-bold mb-4",children:"Diary"}),l.jsx("button",{onClick:()=>f(!0),className:"w-full bg-gradient-to-r from-indigo-500/20 to-indigo-600/20 bg-slate-800/50 rounded-xl p-4 text-left hover:scale-105 transition-all duration-300",children:l.jsxs("div",{className:"flex items-center gap-4",children:[l.jsx("div",{className:"w-12 h-12 bg-white rounded-lg flex items-center justify-center text-xl",children:""}),l.jsxs("div",{className:"flex-1",children:[l.jsx("h3",{className:"text-white font-bold text-lg",children:"Monthly overview"}),l.jsx("p",{className:"text-gray-300 text-sm",children:"View your progress and daily activities"})]}),l.jsx("div",{className:"text-indigo-400 text-2xl",children:""})]})})]})]}),l.jsx(gq,{isOpen:s,onClose:()=>i(!1),onConfirm:xe,currentWater:w}),l.jsx(yq,{isOpen:o,onClose:()=>a(!1),onSelect:De,selectedMood:R}),l.jsx(_q,{isOpen:c,onClose:()=>u(!1),onSchedule:Re,scheduledTriggers:P}),l.jsx(vq,{isOpen:h,onClose:()=>f(!1),selectedDate:m,onDateSelect:y,dailyData:{water:w,mood:R,breathing:I,relapseDate:t}})]})},gq=({isOpen:n,onClose:e,onConfirm:t,currentWater:r})=>{const[s,i]=D.useState(r),{modalRef:o,classes:a}=aS(e,{threshold:80,velocity:.4,enabled:!0});return n?l.jsx("div",{className:"modal-backdrop",children:l.jsx("div",{className:"modal-container",children:l.jsxs("div",{ref:o,className:`modal-content bg-slate-800 border-slate-700 ${a}`,role:"dialog","aria-modal":"true","aria-labelledby":"water-modal-title",children:[l.jsx("div",{className:"modal-swipe-indicator"}),l.jsxs("div",{className:"modal-scrollable",children:[l.jsxs("div",{className:"text-center mb-6 p-4",children:[l.jsx("h3",{id:"water-modal-title",className:"text-xl font-bold text-white mb-2",children:" Water Intake"}),l.jsx("p",{className:"text-gray-300 text-sm",children:"How many glasses of water today?"})]}),l.jsx("div",{className:"mb-6 px-4",children:l.jsxs("div",{className:"form-group",children:[l.jsx("input",{type:"number",min:"0",max:"20",value:s,onChange:c=>i(parseInt(c.target.value)||0),className:"w-full bg-slate-700 text-white text-center text-2xl font-bold py-4 rounded-lg border border-slate-600 focus:border-blue-500 focus:outline-none",placeholder:"0",autoComplete:"off","aria-label":"Number of glasses of water"}),l.jsx("p",{className:"text-gray-400 text-sm text-center mt-2",children:"0-20 glasses"})]})}),l.jsxs("div",{className:"modal-actions px-4 pb-4",children:[l.jsx("button",{onClick:e,className:"modal-button modal-button-secondary",children:"Cancel"}),l.jsx("button",{onClick:()=>t(s),className:"modal-button modal-button-primary",children:"Confirm"})]})]})]})})}):null},yq=({isOpen:n,onClose:e,onSelect:t,selectedMood:r})=>{const s=[{name:"Anger",icon:"",color:"bg-red-500"},{name:"Disgust",icon:"",color:"bg-orange-500"},{name:"Enjoyment",icon:"",color:"bg-yellow-500"},{name:"Calm",icon:"",color:"bg-blue-500"},{name:"Fear",icon:"",color:"bg-purple-500"},{name:"Sadness",icon:"",color:"bg-indigo-500"},{name:"Indifferent",icon:"",color:"bg-gray-500"}],{modalRef:i,classes:o}=aS(e,{threshold:80,velocity:.4,enabled:!0});return n?l.jsx("div",{className:"modal-backdrop",children:l.jsx("div",{className:"modal-container",children:l.jsxs("div",{ref:i,className:`modal-content bg-slate-800 border-slate-700 ${o}`,role:"dialog","aria-modal":"true","aria-labelledby":"mood-modal-title",children:[l.jsx("div",{className:"modal-swipe-indicator"}),l.jsxs("div",{className:"modal-scrollable",children:[l.jsxs("div",{className:"text-center mb-6 p-4",children:[l.jsx("h3",{id:"mood-modal-title",className:"text-xl font-bold text-white mb-2",children:" How do you feel?"}),l.jsx("p",{className:"text-gray-300 text-sm",children:"Select your current mood"})]}),l.jsx("div",{className:"modal-grid modal-grid-2 gap-3 mb-6 px-4",children:s.map(a=>l.jsxs("button",{onClick:()=>t(a),className:`p-4 rounded-xl text-center transition-all duration-300 hover:scale-105 min-h-[44px] ${(r==null?void 0:r.name)===a.name?"ring-2 ring-blue-400 bg-blue-600":"bg-slate-700 hover:bg-slate-600"}`,"aria-pressed":(r==null?void 0:r.name)===a.name,"aria-label":`Select ${a.name} mood`,children:[l.jsx("div",{className:`w-12 h-12 ${a.color} rounded-full flex items-center justify-center text-2xl mx-auto mb-2`,children:a.icon}),l.jsx("p",{className:"text-white font-semibold",children:a.name})]},a.name))}),l.jsx("div",{className:"modal-actions px-4 pb-4",children:l.jsx("button",{onClick:e,className:"modal-button modal-button-secondary",children:"Cancel"})})]})]})})}):null},_q=({isOpen:n,onClose:e,onSchedule:t,scheduledTriggers:r})=>{const[s,i]=D.useState(""),[o,a]=D.useState(""),[c,u]=D.useState("12:00"),h=["Social event","Drinks","High-stress event","Social pressure"],f=["Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday"];return n?l.jsx("div",{className:"modal-backdrop",children:l.jsx("div",{className:"modal-container",children:l.jsxs("div",{className:"modal-content bg-slate-800 border-slate-700",children:[l.jsxs("div",{className:"text-center mb-6",children:[l.jsx("h3",{className:"text-xl font-bold text-white mb-2",children:" Trigger Defense Planning"}),l.jsx("p",{className:"text-gray-300 text-sm",children:"Schedule your trigger defense strategy"})]}),l.jsxs("div",{className:"space-y-4 mb-6",children:[l.jsxs("div",{children:[l.jsx("label",{className:"block text-white text-sm font-semibold mb-2",children:"Day of the week"}),l.jsxs("select",{value:s,onChange:m=>i(m.target.value),className:"w-full bg-slate-700 text-white p-3 rounded-lg border border-slate-600 focus:border-blue-500 focus:outline-none",children:[l.jsx("option",{value:"",children:"Select a day"}),f.map(m=>l.jsx("option",{value:m,children:m},m))]})]}),l.jsxs("div",{children:[l.jsx("label",{className:"block text-white text-sm font-semibold mb-2",children:"Trigger type"}),l.jsxs("select",{value:o,onChange:m=>a(m.target.value),className:"w-full bg-slate-700 text-white p-3 rounded-lg border border-slate-600 focus:border-blue-500 focus:outline-none",children:[l.jsx("option",{value:"",children:"Select trigger type"}),h.map(m=>l.jsx("option",{value:m,children:m},m))]})]}),l.jsxs("div",{children:[l.jsx("label",{className:"block text-white text-sm font-semibold mb-2",children:"Time"}),l.jsx("input",{type:"time",value:c,onChange:m=>u(m.target.value),className:"w-full bg-slate-700 text-white p-3 rounded-lg border border-slate-600 focus:border-blue-500 focus:outline-none",autoComplete:"off"})]})]}),l.jsxs("div",{className:"flex gap-3",children:[l.jsx("button",{onClick:e,className:"flex-1 bg-slate-600 hover:bg-slate-700 text-white font-bold py-3 rounded-lg transition-colors",children:"Cancel"}),l.jsx("button",{onClick:()=>{s&&o&&c&&t(s,o,c)},disabled:!s||!o||!c,className:"flex-1 bg-orange-600 hover:bg-orange-700 disabled:bg-slate-600 text-white font-bold py-3 rounded-lg transition-colors disabled:cursor-not-allowed",children:"Schedule"})]})]})})}):null},vq=({isOpen:n,onClose:e,selectedDate:t,onDateSelect:r,dailyData:s})=>n?l.jsx("div",{className:"modal-backdrop",children:l.jsx("div",{className:"modal-container",children:l.jsxs("div",{className:"modal-content bg-slate-800 border-slate-700",children:[l.jsxs("div",{className:"text-center mb-6",children:[l.jsx("h3",{className:"text-xl font-bold text-white mb-2",children:" Daily Summary"}),l.jsx("p",{className:"text-gray-300 text-sm",children:"Your activities and progress"})]}),l.jsxs("div",{className:"space-y-4 mb-6",children:[l.jsxs("div",{className:"bg-slate-700 rounded-lg p-4",children:[l.jsx("h4",{className:"text-white font-semibold mb-2",children:" Water Intake"}),l.jsxs("p",{className:"text-gray-300",children:[s.water," glasses"]})]}),l.jsxs("div",{className:"bg-slate-700 rounded-lg p-4",children:[l.jsx("h4",{className:"text-white font-semibold mb-2",children:" Mood"}),l.jsx("p",{className:"text-gray-300",children:s.mood?s.mood.name:"Not logged"})]}),l.jsxs("div",{className:"bg-slate-700 rounded-lg p-4",children:[l.jsx("h4",{className:"text-white font-semibold mb-2",children:" Breathing Exercise"}),l.jsx("p",{className:"text-gray-300",children:s.breathing?" Completed":" Not completed"})]}),s.relapseDate&&l.jsxs("div",{className:"bg-red-900/50 rounded-lg p-4 border border-red-500",children:[l.jsx("h4",{className:"text-red-300 font-semibold mb-2",children:" Relapse"}),l.jsxs("p",{className:"text-red-300",children:[s.relapseDate.toLocaleDateString()," at ",s.relapseDate.toLocaleTimeString()]})]})]}),l.jsx("button",{onClick:e,className:"w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 rounded-lg transition-colors min-h-[44px]",children:"Close"})]})})}):null,wq=({onResetApp:n,onBackToLogin:e,onResetForTesting:t,behavioralService:r,user:s,onShowAnalytics:i,onShowPerformanceDashboard:o,onShowBetaMonitoring:a})=>l.jsx("div",{className:"min-h-screen bg-gradient-to-br from-slate-900 via-blue-900 to-slate-900 pb-20",children:l.jsxs("div",{className:"max-w-md mx-auto px-4 pt-16",children:[l.jsxs("div",{className:"text-center mb-8",children:[l.jsx(c2,{className:"w-16 h-16 mx-auto mb-4 text-blue-400"}),l.jsx("h2",{className:"text-2xl font-bold text-white mb-2",children:"Settings"}),l.jsx("p",{className:"text-gray-300",children:"Manage your app preferences"})]}),l.jsxs("div",{className:"space-y-4",children:[l.jsxs("div",{className:"bg-slate-800/50 rounded-xl p-4",children:[l.jsx("h3",{className:"text-white font-semibold mb-2",children:" Behavioral Analytics"}),l.jsx("p",{className:"text-gray-400 text-sm mb-4",children:"View your behavioral patterns and insights"}),l.jsx("button",{onClick:i,disabled:!r,className:`w-full py-3 rounded-lg transition-colors mb-3 ${r?"bg-blue-600 hover:bg-blue-700 text-white":"bg-gray-600 text-gray-400 cursor-not-allowed"}`,children:r?" View Analytics Dashboard":" Analytics (Service Loading...)"}),r&&l.jsx("button",{onClick:async()=>{try{await r.logCraving(s.uid,{outcome:"resisted",strength:7,duration:5,context:"test_data",triggers:["stress","work"],mood:"anxious",stressLevel:6}),await r.logBreathingExercise(s.uid,{duration:5,completed:!0,triggerContext:"test_data"}),alert(" Test data added to Firestore for analytics demo!")}catch(c){alert(" Error adding test data: "+c.message)}},className:"w-full bg-green-600 hover:bg-green-700 text-white py-3 rounded-lg transition-colors text-sm min-h-[44px]",children:" Add Test Data"})]}),l.jsxs("div",{className:"bg-slate-800/50 rounded-xl p-4",children:[l.jsx("h3",{className:"text-white font-semibold mb-2",children:" Performance Monitoring"}),l.jsx("p",{className:"text-gray-400 text-sm mb-4",children:"Monitor app performance and run stress tests"}),l.jsx("button",{onClick:o,className:"w-full bg-purple-600 hover:bg-purple-700 text-white py-3 rounded-lg transition-colors mb-3 min-h-[44px]",children:" Open Performance Dashboard"}),l.jsx("p",{className:"text-gray-500 text-xs",children:"View database performance, authentication metrics, offline queue status, and run stress tests"})]}),l.jsxs("div",{className:"bg-slate-800/50 rounded-xl p-4",children:[l.jsx("h3",{className:"text-white font-semibold mb-2",children:" Beta Safety Monitoring"}),l.jsx("p",{className:"text-gray-400 text-sm mb-4",children:"Monitor safety measures and beta testing metrics"}),l.jsx("button",{onClick:a,className:"w-full bg-red-600 hover:bg-red-700 text-white py-3 rounded-lg transition-colors mb-3 min-h-[44px]",children:" Open Beta Monitoring Dashboard"}),l.jsx("p",{className:"text-gray-500 text-xs",children:"View data backup status, privacy compliance, error logs, rate limiting, and system health"})]}),l.jsxs("div",{className:"bg-slate-800/50 rounded-xl p-4",children:[l.jsx("h3",{className:"text-white font-semibold mb-2",children:"Session"}),l.jsx("p",{className:"text-gray-400 text-sm mb-4",children:"Manage your current session"}),l.jsx("button",{onClick:e,className:"w-full bg-slate-600 hover:bg-slate-500 text-white py-3 rounded-lg transition-colors mb-3",children:" Back to Login"})]}),l.jsxs("div",{className:"bg-slate-800/50 rounded-xl p-4",children:[l.jsx("h3",{className:"text-white font-semibold mb-2",children:"App Data"}),l.jsx("p",{className:"text-gray-400 text-sm mb-4",children:"Reset your progress and start over"}),l.jsx("button",{onClick:n,className:"w-full bg-red-600 hover:bg-red-700 text-white py-3 rounded-lg transition-colors",children:"Reset App & Start Over"})]}),!1,l.jsxs("div",{className:"bg-slate-800/50 rounded-xl p-4",children:[l.jsx("h3",{className:"text-white font-semibold mb-2",children:"About"}),l.jsx("p",{className:"text-gray-400 text-sm",children:"QuitCard Arena v1.0.0"}),l.jsx("p",{className:"text-gray-400 text-sm",children:"Your journey to freedom starts here"})]})]})]})}),xq=()=>{const[n,e]=D.useState("arena"),[t,r]=D.useState("auth"),[s,i]=D.useState(null),[o,a]=D.useState(null),[c,u]=D.useState(!1),[h,f]=D.useState(!1),[m,y]=D.useState(!1),[w,S]=D.useState(!1),[R,T]=D.useState(null),[I,N]=D.useState(!0),[P,B]=D.useState(!1),[F,A]=D.useState(0),[x,E]=D.useState(!1),[k,C]=D.useState(0),[_,v]=D.useState({isLoading:!1,progress:0,currentStep:"",error:null,isComplete:!1}),[V,U]=D.useState([]),[ce,we]=D.useState(null),[z,re]=D.useState(null),[W,Q]=D.useState(null);D.useEffect(()=>{const L=ne=>{window.deferredPrompt=ne,B(!0),console.log(" PWA: beforeinstallprompt captured (App state set)")},J=()=>{B(!1),console.log(" PWA installed (App state cleared)")};return window.addEventListener("beforeinstallprompt",L),window.addEventListener("appinstalled",J),()=>{window.removeEventListener("beforeinstallprompt",L),window.removeEventListener("appinstalled",J)}},[]),D.useEffect(()=>{let L=0,J=0,ne=!1;const et=80,vt=Ye=>{L=Ye.touches[0].clientY,ne=!1},pn=Ye=>{if(window.scrollY>0)return;J=Ye.touches[0].clientY;const it=J-L;it>0&&(ne=!0,Ye.preventDefault(),C(Math.min(it,et*1.5)))},Ie=async()=>{if(!ne)return;J-L>et?(E(!0),C(0),typeof window.refreshArenaStats=="function"&&(console.log(" Pull-to-refresh: Refreshing stats..."),await window.refreshArenaStats()),typeof refreshStats=="function"&&(console.log(" Pull-to-refresh: Calling main refresh..."),refreshStats()),setTimeout(()=>{E(!1)},1e3)):C(0),ne=!1};return document.addEventListener("touchstart",vt,{passive:!1}),document.addEventListener("touchmove",pn,{passive:!1}),document.addEventListener("touchend",Ie,{passive:!1}),()=>{document.removeEventListener("touchstart",vt),document.removeEventListener("touchmove",pn),document.removeEventListener("touchend",Ie)}},[]);const ee=async()=>{try{if(window.promptPWAInstall){const ne=await window.promptPWAInstall();ne&&ne.outcome==="accepted"&&B(!1);return}const L=window.deferredPrompt;if(!L)return;L.prompt();const J=await L.userChoice;window.deferredPrompt=null,J.outcome==="accepted"&&B(!1)}catch(L){console.warn("PWA install prompt failed:",L==null?void 0:L.message)}},pe=async()=>{try{if(!Kr){console.error(" Firestore instance is not available");return}const L=new s2(Kr);await L.testConnectivity()?(we(L),console.log(" FirestoreBehavioralService initialized successfully")):console.warn(" Firestore behavioral service connectivity test failed")}catch(L){console.error(" Error initializing behavioral service:",L)}},xe=()=>({mentalStrength:50,motivation:50,triggerDefense:30,addictionLevel:50,streakDays:0,streakUnit:"hours",streakDisplayText:"0 hours",cravingsResisted:0}),De=()=>({dailyWater:0,dailyMood:null,dailyBreathing:!1,scheduledTriggers:[],relapseDate:null,cravingsResisted:0}),Re=L=>{L.relapseDate&&ye(new Date(L.relapseDate)),L.dailyWater!==void 0&&bt(L.dailyWater),L.dailyMood!==void 0&&Xe(L.dailyMood),L.dailyBreathing!==void 0&&Me(L.dailyBreathing),L.scheduledTriggers&&je(L.scheduledTriggers)},_t=async()=>{const L=new Date().toDateString();try{const{ref:J,set:ne}=await Ve(()=>import("./index.esm-ebdb357d.js"),[]),et=J(H,`users/${R==null?void 0:R.uid}/profile/daily/${L}/breathing`);await ne(et,!0)}catch(J){console.error("Error saving breathing exercise to Firebase:",J),localStorage.setItem(`breathing_${R==null?void 0:R.uid}_${L}`,"true")}if(W)try{await W.handleBreathingExercise();const J=await W.checkBreathingStreak(),ne=Math.max(0,3-J%3),et=J>=3&&J%3===0?` Excellent! You've completed a ${J}-day breathing streak and earned +1 Mental Strength!`:` Breathing exercise completed! Current streak: ${J} days. Complete ${ne} more days to earn +1 Mental Strength.`;if(showQuickActionPopup(" Breathing Exercise Complete",`${et}

Keep up the great work! Regular breathing exercises help reduce stress and improve mental resilience.`,"success"),ce)try{await ce.logBreathingExercise(o.uid,{duration:5,completed:!0,triggerContext:"scheduled",currentStreak:J,mentalStrengthEarned:J>=3&&J%3===0}),console.log(" Breathing exercise also logged to Firestore for analytics")}catch(vt){console.warn(" Could not log breathing exercise to Firestore:",vt.message),await handleOfflineBehavioralLog("breathing",{duration:5,completed:!0,triggerContext:"scheduled",currentStreak:J,mentalStrengthEarned:J>=3&&J%3===0})}}catch(J){console.warn(" Error handling breathing exercise completion:",J.message),showQuickActionPopup(" Breathing Exercise Complete"," Breathing exercise completed! Keep practicing daily to build your mental strength.","success")}},Ce=(L,J)=>{const ne=document.createElement("div");ne.className="fixed top-20 right-4 z-50 p-4 rounded-lg shadow-lg bg-red-500 text-white max-w-sm",ne.innerHTML=`
      <div class="font-bold">${L}</div>
      <div class="text-sm opacity-90">${J}</div>
      <button class="mt-2 text-sm underline" onclick="this.parentElement.remove()">Dismiss</button>
    `,document.body.appendChild(ne),setTimeout(()=>{ne.parentNode&&ne.parentNode.removeChild(ne)},1e4)},Ae=async L=>{if(!L)return!1;v({isLoading:!0,progress:0,currentStep:"Initializing...",error:null,isComplete:!1});try{const{ref:J,get:ne,onValue:et}=await Ve(()=>import("./index.esm-ebdb357d.js"),[]);v(Pt=>({...Pt,currentStep:"Loading profile data...",progress:20}));const vt=J(H,`users/${L}`),pn=await ne(vt);if(!pn.exists())throw new Error("User profile not found");const Ie=pn.val(),Ye=Pe(Ie);v(Pt=>({...Pt,currentStep:"Loading battle stats...",progress:40}));const it=J(H,`users/${L}/stats`),At=await ne(it),gt=At.exists()?Ee(At.val()):xe();v(Pt=>({...Pt,currentStep:"Loading habits and progress...",progress:60}));const rn=J(H,`users/${L}/profile`),Ai=await ne(rn),Sr=Ai.exists()?Je(Ai.val()):De();v(Pt=>({...Pt,currentStep:"Loading achievements...",progress:80}));const ot=J(H,`users/${L}/profile/cravingsResisted`),wt=await ne(ot),Fn=wt.exists()?Math.max(0,parseInt(wt.val())||0):0;v(Pt=>({...Pt,currentStep:"Setting up live sync...",progress:90}));const Ja=et(it,Pt=>{if(Pt.exists()){const ts=Ee(Pt.val());if(console.log(" Firebase Listener: Stats changed, new stats:",ts),fn(ts),t==="arena"&&o){console.log(" Firebase Listener: Current user object:",o),console.log(" Firebase Listener: user.quitDate:",o.quitDate),console.log(" Firebase Listener: user.uid:",o.uid);const xs={...o,stats:ts};console.log(" Firebase Listener: Triggering calculateRealTimeStats for Arena with updatedUser:",xs),console.log(" Firebase Listener: updatedUser.quitDate:",xs.quitDate),console.log(" Firebase Listener: updatedUser.uid:",xs.uid),calculateRealTimeStats(xs).then(ns=>{console.log(" Firebase Listener: calculateRealTimeStats returned:",ns),console.log(" Firebase Listener: calculatedStats.streakDays:",ns.streakDays),setRealTimeUserStats(ns)})}}}),$g=et(rn,Pt=>{if(Pt.exists()){const ts=Je(Pt.val());t==="profile"&&Re(ts)}}),Xa=et(ot,Pt=>{if(Pt.exists()){const ts=Math.max(0,parseInt(Pt.val())||0);t==="craving-support"&&Tt(ts)}});return U([Ja,$g,Xa]),v(Pt=>({...Pt,currentStep:"Finalizing...",progress:100})),a(Pt=>({...Pt,...Ye,...Sr,stats:gt})),Re(Sr),Tt(Fn),Ye.onboardingCompleted&&S(!0),v({isLoading:!1,progress:100,currentStep:"Data loaded successfully!",error:null,isComplete:!0}),console.log(" All user data loaded successfully:",{profile:Ye,stats:gt,profileData:Sr,cravingsResisted:Fn}),!0}catch(J){return console.error(" Error loading user data:",J),v({isLoading:!1,progress:0,currentStep:"Failed to load data",error:J.message,isComplete:!1}),Ce("Failed to load user data",J.message),!1}},Pe=L=>L?{uid:L.uid||"",email:L.email||"",heroName:L.heroName||"Hero",archetype:L.archetype||"The Determined",avatar:L.avatar||Jo("default"),quitDate:L.quitDate,onboardingCompleted:!!L.onboardingCompleted,updatedAt:L.updatedAt||Date.now(),...L}:Et(),Ee=L=>L?{mentalStrength:Math.max(0,Math.min(100,parseInt(L.mentalStrength)||50)),motivation:Math.max(0,Math.min(100,parseInt(L.motivation)||50)),triggerDefense:Math.max(0,Math.min(100,parseInt(L.triggerDefense)||30)),addictionLevel:Math.max(0,Math.min(100,parseInt(L.addictionLevel)||50)),streakDays:Math.max(0,parseInt(L.streakDays)||0),streakUnit:L.streakUnit||"hours",streakDisplayText:L.streakDisplayText||"0 hours",cravingsResisted:Math.max(0,parseInt(L.cravingsResisted)||0),...L}:xe(),Je=L=>L?{dailyWater:Math.max(0,parseInt(L.dailyWater)||0),dailyMood:L.dailyMood||null,dailyBreathing:!!L.dailyBreathing,scheduledTriggers:Array.isArray(L.scheduledTriggers)?L.scheduledTriggers:[],relapseDate:L.relapseDate?new Date(L.relapseDate).toISOString():null,cravingsResisted:Math.max(0,parseInt(L.cravingsResisted)||0),...L}:De(),Et=()=>({uid:"",email:"",heroName:"Hero",archetype:"The Determined",avatar:Jo("default"),quitDate:new Date().toISOString(),onboardingCompleted:!1,updatedAt:Date.now()});D.useEffect(()=>()=>{V.forEach(L=>{typeof L=="function"&&L()})},[V]);const[ut,te]=D.useState(null);D.useEffect(()=>{const L=async()=>{try{const ne=(await Ve(()=>import("./offlineManager-06727835.js"),[])).default,et=new ne;te(et),window.offlineManager=et,window.refreshUserData=Oe,console.log(" Offline manager initialized")}catch(ne){console.error("Error initializing offline manager:",ne)}},J=async()=>{try{const ne=(await Ve(()=>import("./authGuard-a25e80a1.js"),[])).default,et=(await Ve(()=>import("./sessionManager-b6332f4f.js"),[])).default,vt=new ne,pn=new et;window.authGuard=vt,window.sessionManager=pn,console.log(" Auth services initialized")}catch(ne){console.error(" Failed to initialize auth services:",ne)}};L(),J()},[]);const Se=async L=>{if(!L)return!1;const J=await Ae(L);if(J&&ut&&(await ut.cacheUserData(o),await ut.cacheProfileData({dailyWater:at,dailyMood:dt,dailyBreathing:st,scheduledTriggers:fe,relapseDate:be,cravingsResisted:Gt})),!J&&ut){console.log(" Loading offline data...");const ne=await ut.getCachedUserData(),et=await ut.getCachedProfileData();if(ne)return console.log(" Using offline user data"),a(ne),S(ne.onboardingCompleted),et&&Re(et),!0}return J},ge=async()=>R!=null&&R.uid?(console.log(" Refreshing user data with offline support..."),await Se(R.uid)):!1,Oe=async()=>{if(!(R!=null&&R.uid)){Ce("Cannot Refresh","No authenticated user found");return}if(console.log(" Manually refreshing user data..."),await ge()){const J=document.createElement("div");J.className="fixed top-20 right-4 z-50 p-4 rounded-lg shadow-lg bg-green-500 text-white max-w-sm",J.innerHTML=`
        <div class="font-bold"> Data Refreshed!</div>
        <div class="text-sm opacity-90">Your data has been synced across all devices</div>
        <button class="mt-2 text-sm underline" onclick="this.parentElement.remove()">Dismiss</button>
      `,document.body.appendChild(J),setTimeout(()=>{J.parentNode&&J.parentNode.removeChild(J)},5e3)}else Ce("Refresh Failed","Could not refresh data. Please try again.")},[be,ye]=D.useState(null),[at,bt]=D.useState(0),[dt,Xe]=D.useState(null),[st,Me]=D.useState(!1),[fe,je]=D.useState([]),[Gt,Tt]=D.useState(0),[en,fn]=D.useState(xe());D.useEffect(()=>{const L=ne=>{if(ne.message&&ne.message.includes("content_script")){console.warn("Browser extension error (ignored):",ne.message);return}if(ne.message&&(ne.message.includes("FrameDoesNotExistError")||ne.message.includes("background.js"))){console.warn("Background frame error (ignored):",ne.message);return}if(ne.message&&ne.message.includes("deref")){console.warn("Browser extension deref error (ignored):",ne.message);return}if(ne.message&&ne.message.includes("chrome-extension://")){console.warn("Chrome extension URL error (ignored):",ne.message);return}console.error("Global error caught:",ne)},J=ne=>{if(ne.reason&&ne.reason.message&&ne.reason.message.includes("content_script")){console.warn("Browser extension promise rejection (ignored):",ne.reason.message);return}if(ne.reason&&ne.reason.message&&(ne.reason.message.includes("FrameDoesNotExistError")||ne.reason.message.includes("background.js"))){console.warn("Background frame promise rejection (ignored):",ne.reason.message);return}if(ne.reason&&ne.reason.message&&ne.reason.message.includes("deref")){console.warn("Browser extension deref promise rejection (ignored):",ne.reason.message);return}if(ne.reason&&ne.reason.message&&ne.reason.message.includes("chrome-extension://")){console.warn("Chrome extension URL promise rejection (ignored):",ne.reason.message);return}console.error("Unhandled promise rejection:",ne.reason)};return window.addEventListener("error",L),window.addEventListener("unhandledrejection",J),()=>{window.removeEventListener("error",L),window.removeEventListener("unhandledrejection",J)}},[]),D.useEffect(()=>{(()=>{try{H&&typeof H.app<"u"&&console.log(" Firebase RTDB initialized successfully")}catch(J){console.warn(" Firebase initialization check failed (non-critical):",(J==null?void 0:J.message)||J)}})()},[]),D.useEffect(()=>{let L=!0,J=null;return(async()=>{try{console.log("Initializing authentication state..."),N(!0);const et=async Ie=>{const Ye=`quitDateFixed_${Ie}_v2`;if(!localStorage.getItem(Ye)&&!(Ie!=="AmwwlNyHD5T3WthUbyR6bFL0QkF2"&&Ie!=="uGZGbLUytbfu8W3mQPW0YAvXTQn1"))try{const{ref:it,get:At,set:gt}=await Ve(()=>import("./index.esm-ebdb357d.js"),[]),rn="2025-09-18T13:56:46.584Z";console.log(` One-time fix: Setting proper quit date for ${Ie}...`);const Ai=it(H,`users/${Ie}/profile`),Sr=await At(Ai);let ot=rn;if(Sr.exists()){const wt=Sr.val();if(wt.lastRelapseDate){const Fn=new Date(wt.lastRelapseDate),Ja=new Date(rn);ot=Fn>Ja?wt.lastRelapseDate:rn,console.log(` ${Ie}: Using quit date ${ot} (considering relapse: ${wt.lastRelapseDate})`)}}await gt(it(H,`users/${Ie}/quitDate`),ot),await gt(it(H,`users/${Ie}/profile/quitDate`),ot),localStorage.setItem(Ye,"true"),console.log(` One-time fix: Quit date fixed for ${Ie} in Firebase database`)}catch(it){console.warn(` One-time fix failed for ${Ie}:`,it.message)}},{onAuthStateChanged:vt}=await Ve(()=>import("./index.esm-755c40a4.js"),[]);J=vt(ii,async Ie=>{if(L)if(console.log("Auth state changed:",Ie?`User: ${Ie.uid}`:"No user"),Ie){console.log(" onAuthStateChanged: User authenticated:",Ie.uid,Ie.email),T(Ie),console.log("User authenticated, checking database for user data..."),console.log(" onAuthStateChanged: Attempting to update lastActivity timestamp for user:",Ie.uid);try{const{ref:Ye,set:it}=await Ve(()=>import("./index.esm-ebdb357d.js"),[]),At=new Date,gt=Ye(H,`users/${Ie.uid}/profile/lastActivity`);await it(gt,At.toISOString()),console.log(" onAuthStateChanged: Updated lastActivity timestamp for user:",Ie.uid,"to:",At.toISOString()),await new Promise(rn=>setTimeout(rn,1e3)),console.log(" onAuthStateChanged: lastActivity update completed and propagated")}catch(Ye){console.warn(" onAuthStateChanged: Could not update lastActivity timestamp:",Ye.message)}(Ie.uid==="AmwwlNyHD5T3WthUbyR6bFL0QkF2"||Ie.uid==="uGZGbLUytbfu8W3mQPW0YAvXTQn1")&&(console.log(` Clearing cache for ${Ie.uid} to ensure fresh data loading...`),Object.keys(localStorage).forEach(Ye=>{(Ye.includes("quitCoach")||Ye.includes("quitDate")||Ye.includes("user")||Ye.includes("arena"))&&localStorage.removeItem(Ye)})),et(Ie.uid);try{const{ref:Ye,get:it}=await Ve(()=>import("./index.esm-ebdb357d.js"),[]),At=Ye(H,`users/${Ie.uid}`),gt=await it(At);if(gt.exists()){const rn=gt.val();console.log("Existing user data found - auto-login successful"),(()=>{const ot=[];for(let wt=0;wt<localStorage.length;wt++){const Fn=localStorage.key(wt);Fn&&(Fn.startsWith("water_")||Fn.startsWith("mood_")||Fn.startsWith("breathing_"))&&ot.push(Fn)}ot.forEach(wt=>localStorage.removeItem(wt)),console.log("Cleared previous user data from localStorage")})(),a(rn);const Sr=!!rn.onboardingCompleted;S(Sr),console.log(`Onboarding status: ${Sr?"completed":"not completed"}`),r(Sr?"arena":"auth");try{await new Promise(Fn=>setTimeout(Fn,2e3));const ot=await Ve(()=>Promise.resolve().then(()=>v8),void 0),wt=new ot.default(H,Ie.uid);await wt.initialize(),Q(wt),console.log(" StatManager initialized successfully")}catch(ot){console.error("Error initializing StatManager:",ot)}try{const ot=new qT(H,Ie.uid,window.authGuard);re(ot),window.centralizedStatService=ot,await ot.refreshAllStats(),console.log(" CentralizedStatService initialized and stats refreshed for user:",Ie.uid),ot.setupRealTimeListener(wt=>{if(console.log(" Real-time stats update received:",wt),fn(wt),wt.streakDisplayText&&typeof setBuddyStreakData=="function")try{setBuddyStreakData({streakDays:wt.streakDays||0,streakUnit:wt.streakUnit||"hours",streakDisplayText:wt.streakDisplayText})}catch(Fn){console.error("Error updating buddy streak data:",Fn)}})}catch(ot){console.error("Error initializing CentralizedStatService:",ot)}try{F8.initialize(),console.log(" Performance monitoring system initialized")}catch(ot){console.error("Error initializing performance monitoring:",ot)}setTimeout(async()=>{try{await new Promise(ot=>setTimeout(ot,3e3)),HT.initialize(Ie.uid),window.dataBackupService=HT,console.log(" Data backup service initialized"),QT.initialize(Ie.uid),window.privacyProtectionService=QT,console.log(" Privacy protection service initialized"),KT.initialize(Ie.uid),window.errorLoggingService=KT,console.log(" Error logging service initialized"),YT.initialize(Ie.uid),window.gracefulDegradationService=YT,console.log(" Graceful degradation service initialized"),JT.initialize(Ie.uid),window.rateLimitingService=JT,console.log(" Rate limiting service initialized")}catch(ot){console.error("Error initializing safety services:",ot)}},5e3),console.log("User auto-logged in - checking onboarding status")}else console.log("No user data found - new user needs onboarding"),r("onboarding")}catch(Ye){console.error("Error fetching user data during auto-login:",Ye),r("onboarding")}}else console.log("No authenticated user - showing login screen"),T(null),a(null),S(!1),r("auth"),(()=>{const it=[];for(let At=0;At<localStorage.length;At++){const gt=localStorage.key(At);gt&&(gt.startsWith("water_")||gt.startsWith("mood_")||gt.startsWith("breathing_"))&&it.push(gt)}it.forEach(At=>localStorage.removeItem(At)),console.log("Cleared user-specific data from localStorage")})()});const pn=setTimeout(()=>{L&&(console.warn("Auth initialization timeout - forcing to auth screen"),N(!1),r("auth"))},1e4);J&&clearTimeout(pn)}catch(et){console.error("Error initializing authentication:",et),L&&(N(!1),r("auth"))}finally{L&&N(!1)}})(),pe(),()=>{L=!1,J&&J()}},[]);const Ht=async L=>{console.log(" handleAuthSuccess called for user:",L==null?void 0:L.uid,L==null?void 0:L.email),console.log("Authentication successful, checking for existing user data...",{uid:L==null?void 0:L.uid,email:L==null?void 0:L.email});try{const{ref:J,get:ne,set:et}=await Ve(()=>import("./index.esm-ebdb357d.js"),[]);console.log("Checking database for existing user data..."),console.log(" Attempting to update lastActivity timestamp for user:",L.uid);try{const Ie=new Date,Ye=J(H,`users/${L.uid}/profile/lastActivity`);await et(Ye,Ie.toISOString()),console.log(" Updated lastActivity timestamp for user:",L.uid,"to:",Ie.toISOString()),await new Promise(it=>setTimeout(it,1e3)),console.log(" lastActivity update completed and propagated")}catch(Ie){console.warn(" Could not update lastActivity timestamp:",Ie.message)}const vt=J(H,`users/${L.uid}`),pn=await ne(vt);if(pn.exists()){const Ie=pn.val();if(console.log("Existing user data found - loading all user data..."),await Se(L.uid)){const it=!!Ie.onboardingCompleted;console.log(` All user data loaded successfully: ${it?"Onboarding completed, going to Arena":"Onboarding not completed, staying on auth"}`);try{const At=new qT(H,L.uid,window.authGuard);re(At),window.centralizedStatService=At,await At.refreshAllStats(),console.log(" CentralizedStatService initialized for existing user:",L.uid),At.setupRealTimeListener(gt=>{if(console.log(" Real-time stats update received:",gt),fn(gt),gt.streakDisplayText&&typeof setBuddyStreakData=="function")try{setBuddyStreakData({streakDays:gt.streakDays||0,streakUnit:gt.streakUnit||"hours",streakDisplayText:gt.streakDisplayText})}catch(rn){console.error("Error updating buddy streak data:",rn)}})}catch(At){console.error("Error initializing CentralizedStatService for existing user:",At)}S(it),r(it?"arena":"auth")}else{console.log(" Data loading failed, but proceeding with basic data"),a(Ie);const it=!!Ie.onboardingCompleted;S(it),console.log(`Onboarding status after failed load: ${it?"completed":"not completed"}`),r(it?"arena":"auth")}}else console.log("No user data found - starting onboarding"),r("onboarding")}catch(J){console.error("Database check failed:",J),r("onboarding")}},[wn,tn]=D.useState(null),[mn,cn]=D.useState(!1),[Qt,Gn]=D.useState(null),[qe,Qe]=D.useState(!1),nn=async(L,J,ne)=>{console.log(" loadRealBuddy called but buddy matching is disabled"),cn(!1),tn(null)};D.useEffect(()=>{Qe(!1),tn(null)},[o==null?void 0:o.uid]),D.useEffect(()=>{o!=null&&o.uid&&!wn&&!mn&&!qe&&console.log(" Buddy loading will be handled by Arena component")},[o==null?void 0:o.uid,wn,mn,qe]);const ae={heroName:"",stats:null,achievements:[],archetype:"",avatar:null,isEmpty:!0,message:"We are looking for a suitable buddy for you"},lt=()=>mn?{heroName:"Loading Buddy...",stats:{streakDays:0,addictionLevel:50,willpower:50,motivation:50,cravingResistance:50,triggerDefense:30,experiencePoints:0},achievements:[],archetype:"DETERMINED",avatar:Jo("loading","adventurer"),isLoading:!0}:Qt?{heroName:"Error Loading Buddy",stats:{streakDays:0,addictionLevel:50,willpower:50,motivation:50,cravingResistance:50,triggerDefense:30,experiencePoints:0},achievements:[],archetype:"DETERMINED",avatar:Jo("error","adventurer"),isError:!0,errorMessage:Qt}:wn||ae,Dt=async L=>{console.log("Onboarding completed with user data:",L);try{if(!L||!L.heroName||!L.stats)throw new Error("Invalid user data received from onboarding");if(!R)throw new Error("No authenticated user found");const J=new Date,ne={...L,uid:R.uid,email:R.email,displayName:R.displayName||L.heroName,photoURL:R.photoURL,onboardingCompleted:!0,createdAt:J.toISOString(),updatedAt:J.getTime(),originalQuitDate:J.toISOString(),lastQuitDate:J.toISOString(),lastRelapseDate:J.toISOString(),lastActivity:J.toISOString(),daily:{[J.toDateString()]:{logged:!0,onboarding:!0}}};console.log("Saving user data to Firebase:",ne);const{ref:et,set:vt}=await Ve(()=>import("./index.esm-ebdb357d.js"),[]),pn=et(H,`users/${R.uid}`);await vt(pn,ne),console.log("Firebase save successful, updating app state..."),a(ne),S(!0);const Ie=await Se(R.uid);console.log(" Onboarding complete, going to Arena"),r("arena")}catch(J){console.error("Error in handleOnboardingComplete:",J);const ne=new Date,et={heroName:(L==null?void 0:L.heroName)||"Hero",archetype:(L==null?void 0:L.archetype)||"The Determined",avatar:(L==null?void 0:L.avatar)||Jo("fallback"),stats:{addictionLevel:50,mentalStrength:50,motivation:50,triggerDefense:30,streakDays:0,experiencePoints:0},achievements:[],quitDate:ne,createdAt:ne.toISOString(),lastActivity:ne.toISOString(),lastRelapseDate:ne.toISOString(),uid:R==null?void 0:R.uid,email:R==null?void 0:R.email,onboardingCompleted:!0};if(R)try{const{ref:vt,set:pn}=await Ve(()=>import("./index.esm-ebdb357d.js"),[]),Ie=vt(H,`users/${R.uid}`);await pn(Ie,et)}catch(vt){console.error("Failed to save fallback data to Firebase:",vt)}a(et),S(!0),r("arena")}},es=()=>{a(null),S(!1),r("onboarding"),e("arena"),i(null),localStorage.removeItem("quitCoachUser")},Tn=async()=>{try{console.log("Logging out user...");const{signOut:L}=await Ve(()=>import("./index.esm-755c40a4.js"),[]);await L(ii),a(null),T(null),S(!1),r("auth"),localStorage.removeItem("cravingWins"),localStorage.removeItem("specialFeatures"),console.log("User successfully logged out and redirected to login screen")}catch(L){console.error("Error during logout:",L),a(null),T(null),S(!1),r("auth")}},Ya=async()=>{if(!R){console.error("No authenticated user to reset");return}try{console.log("Resetting ALL user data for testing...");const{ref:L,set:J,remove:ne}=await Ve(()=>import("./index.esm-ebdb357d.js"),[]),et=L(H,`users/${R.uid}`);await J(et,null);const vt=L(H,"users");await J(vt,null);const pn=L(H,"buddyPairs");await J(pn,null);const Ie=L(H,"matchingPool");await J(Ie,null),console.log("All user data and buddy matching data cleared from database"),a(null),S(!1),r("onboarding"),tn(null),cn(!1),Gn(null),console.log("Account reset successful - ready for fresh onboarding")}catch(L){console.error("Error resetting account for testing:",L)}},Mo=L=>{console.log("Tab changed to:",L),e(L),r(L),L==="arena"&&(o!=null&&o.uid)&&(console.log(" Tab: Returning to Arena, forcing fresh stats reload..."),setTimeout(()=>{typeof refreshStats=="function"&&(console.log(" Tab: Delayed refresh after tab switch..."),refreshStats())},1e3))},Rh=L=>{r(L==="mood-selector"?"mood-selector":"profile")},Vn=L=>{i(L),r("profile")},Dh=()=>{r("profile")};return I?l.jsx("div",{className:"min-h-screen bg-gradient-to-br from-slate-900 via-blue-900 to-slate-900 flex items-center justify-center",children:l.jsxs("div",{className:"text-center text-white",children:[l.jsx("div",{className:"animate-spin rounded-full h-16 w-16 border-b-2 border-white mx-auto mb-6"}),l.jsx("h2",{className:"text-3xl font-bold mb-4",children:" Restoring Session..."}),l.jsx("p",{className:"text-xl text-gray-300 mb-4",children:"Checking authentication state"}),l.jsx("div",{className:"bg-slate-800/50 rounded-lg p-4 max-w-md mx-auto",children:l.jsxs("div",{className:"text-sm text-gray-400 space-y-2",children:[l.jsxs("div",{className:"flex items-center gap-2",children:[l.jsx("span",{className:"text-blue-400",children:""}),"Checking Firebase Auth persistence"]}),l.jsxs("div",{className:"flex items-center gap-2",children:[l.jsx("span",{className:"text-blue-400",children:""}),"Verifying user session (30 days)"]}),l.jsxs("div",{className:"flex items-center gap-2",children:[l.jsx("span",{className:"text-blue-400",children:""}),"Loading user data from database"]})]})}),l.jsx("p",{className:"text-gray-400 text-sm mt-4",children:"This should take only a few seconds"})]})}):t==="auth"?l.jsx(H8,{onAuthSuccess:Ht}):_.isLoading?l.jsx("div",{className:"min-h-screen bg-gradient-to-br from-slate-900 via-blue-900 to-slate-900 flex items-center justify-center",children:l.jsxs("div",{className:"text-center text-white",children:[l.jsx("div",{className:"animate-spin rounded-full h-16 w-16 border-b-2 border-white mx-auto mb-6"}),l.jsx("h2",{className:"text-3xl font-bold mb-4",children:" Loading Your Data..."}),l.jsx("p",{className:"text-xl text-gray-300 mb-4",children:_.currentStep}),l.jsxs("div",{className:"bg-slate-800/50 rounded-lg p-4 max-w-md mx-auto mb-6",children:[l.jsx("div",{className:"w-full bg-slate-700 rounded-full h-3 mb-3",children:l.jsx("div",{className:"bg-blue-500 h-3 rounded-full transition-all duration-500 ease-out",style:{width:`${_.progress}%`}})}),l.jsxs("div",{className:"text-sm text-gray-400",children:[_.progress,"% Complete"]})]}),l.jsx("div",{className:"bg-slate-800/50 rounded-lg p-4 max-w-md mx-auto",children:l.jsxs("div",{className:"text-sm text-gray-400 space-y-2",children:[l.jsxs("div",{className:"flex items-center gap-2",children:[l.jsx("span",{className:"text-blue-400",children:""}),"Profile and onboarding data"]}),l.jsxs("div",{className:"flex items-center gap-2",children:[l.jsx("span",{className:"text-blue-400",children:""}),"Battle stats and progress"]}),l.jsxs("div",{className:"flex items-center gap-2",children:[l.jsx("span",{className:"text-blue-400",children:""}),"Habits and achievements"]}),l.jsxs("div",{className:"flex items-center gap-2",children:[l.jsx("span",{className:"text-blue-400",children:""}),"Setting up live sync"]})]})}),_.error&&l.jsxs("div",{className:"mt-4 p-3 bg-red-600/20 border border-red-500/30 rounded-lg max-w-md mx-auto",children:[l.jsxs("p",{className:"text-red-300 text-sm",children:[l.jsx("span",{className:"font-semibold",children:"Error:"})," ",_.error]}),l.jsx("p",{className:"text-red-400 text-xs mt-1",children:"Don't worry, you can still use the app with basic functionality"})]}),l.jsx("p",{className:"text-gray-400 text-sm mt-4",children:"Syncing your data across all devices..."})]})}):l.jsx($8,{children:l.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-slate-900 via-blue-900 to-slate-900 relative",children:[k>0&&l.jsx("div",{className:"fixed top-0 left-0 right-0 z-50 bg-blue-600 text-white text-center py-2 transition-transform duration-200",style:{transform:`translateY(${Math.max(0,k-60)}px)`},children:k>80?"Release to refresh":"Pull to refresh"}),x&&l.jsx("div",{className:"fixed top-0 left-0 right-0 z-50 bg-green-600 text-white text-center py-2",children:l.jsxs("div",{className:"flex items-center justify-center gap-2",children:[l.jsx("div",{className:"animate-spin w-4 h-4 border-2 border-white border-t-transparent rounded-full"}),l.jsx("span",{children:"Refreshing..."})]})}),l.jsx(Q8,{offlineManager:ut}),l.jsx(K8,{offlineManager:ut}),l.jsx(Y8,{sessionManager:window.sessionManager,authGuard:window.authGuard}),t==="onboarding"&&l.jsx("div",{children:l.jsx(rq,{onComplete:Dt,authUser:R,pwaInstallAvailable:P,promptInstall:ee})}),w&&o?l.jsxs(l.Fragment,{children:[t==="arena"&&l.jsx("div",{children:(()=>{try{const L=lt();return l.jsx(cq,{user:o,userStats:en,nemesis:L,onBackToLogin:Tn,onResetForTesting:Ya,buddyLoading:mn,buddyError:Qt,realBuddy:wn,loadRealBuddy:nn,buddyLoadAttempted:qe},`arena-${o.uid}-${F}`)}catch(L){return console.error("Error rendering ArenaView:",L),l.jsxs("div",{className:"text-white text-center p-8",children:[l.jsx("h2",{className:"text-2xl font-bold mb-4",children:"Error Loading Arena"}),l.jsx("p",{className:"text-gray-300 mb-4",children:L.message}),l.jsx("button",{onClick:()=>window.location.reload(),className:"bg-blue-600 px-4 py-3 rounded hover:bg-blue-700 min-h-[44px]",children:"Reload App"})]})}})()}),t==="craving-support"&&l.jsx("div",{children:l.jsx(hq,{user:o,nemesis:lt(),onBackToLogin:Tn,onResetForTesting:Ya,behavioralService:ce,onBreathingComplete:async L=>{await _t()},setActiveTab:e})}),t==="profile"&&l.jsx("div",{children:l.jsx(pq,{user:o,onNavigate:Rh})}),t==="mood-selector"&&l.jsx(MoodSelector,{onMoodSelect:Vn,onBack:Dh}),t==="settings"&&l.jsx(wq,{onResetApp:es,onBackToLogin:Tn,onResetForTesting:Ya,behavioralService:ce,user:o,onShowAnalytics:()=>u(!0),onShowPerformanceDashboard:()=>f(!0),onShowBetaMonitoring:()=>y(!0)}),c&&l.jsx(nq,{user:o,behavioralService:ce,onClose:()=>u(!1)}),h&&l.jsx(P8,{isOpen:h,onClose:()=>f(!1)}),m&&l.jsx(U8,{isOpen:m,onClose:()=>y(!1)}),l.jsx(lq,{activeTab:n,onTabChange:Mo,dataLoadingState:_,onRefreshData:Oe,offlineManager:ut})]}):l.jsx("div",{className:"flex items-center justify-center min-h-screen text-white",children:l.jsxs("div",{className:"text-center",children:[l.jsx("h2",{className:"text-2xl font-bold mb-4",children:"Loading..."}),l.jsx("p",{className:"text-gray-300",children:w?"User data missing":"Onboarding not completed"}),l.jsxs("p",{className:"text-gray-300",children:["Current view: ",t]}),l.jsxs("p",{className:"text-gray-300",children:["User data: ",o?JSON.stringify(o,null,2):"None"]}),l.jsx("button",{onClick:()=>{console.log("Debug button clicked"),console.log("Current state:",{hasCompletedOnboarding:w,user:o,currentView:t}),console.log("User data:",o)},className:"mt-4 px-4 py-3 bg-blue-600 text-white rounded hover:bg-blue-700 min-h-[44px]",children:"Debug State"})]})})]})})};Zy.createRoot(document.getElementById("root")).render(l.jsx(xq,{}));export{$F as $,Nq as A,Rq as B,Dq as C,xa as D,Tq as E,kw as F,Bq as G,zq as H,qq as I,Wq as J,Kk as K,JF as L,K as M,bq as N,VF as O,FF as P,ws as Q,vs as R,t7 as S,l3 as T,Zq as U,Te as V,Aq as W,Cq as X,Fq as Y,Vq as Z,s7 as _,r3 as a,fB as a$,_W as a0,Ah as a1,Th as a2,wW as a3,zd as a4,Qa as a5,Ui as a6,mW as a7,Bi as a8,Js as a9,MW as aA,Jz as aB,xW as aC,mU as aD,qW as aE,rG as aF,vT as aG,WB as aH,$U as aI,VW as aJ,NW as aK,uB as aL,KW as aM,ZW as aN,nG as aO,WW as aP,bB as aQ,IB as aR,SW as aS,nU as aT,dB as aU,YW as aV,XW as aW,tG as aX,yU as aY,BW as aZ,gB as a_,_i as aa,em as ab,yW as ac,da as ad,$l as ae,zz as af,pW as ag,HW as ah,zv as ai,gW as aj,qz as ak,tS as al,zi as am,AW as an,EB as ao,GW as ap,Yu as aq,Bz as ar,Ju as as,mB as at,TW as au,BU as av,pP as aw,vW as ax,zW as ay,DW as az,$r as b,u7 as b$,kW as b0,vP as b1,IW as b2,qx as b3,bW as b4,gP as b5,RW as b6,QW as b7,sz as b8,eG as b9,Mn as bA,Vc as bB,xh as bC,Jf as bD,Ag as bE,Sh as bF,bg as bG,Px as bH,Dr as bI,Tg as bJ,Yi as bK,Fe as bL,X$ as bM,ms as bN,Y$ as bO,Rw as bP,an as bQ,Sa as bR,se as bS,l7 as bT,c3 as bU,qt as bV,fW as bW,Ge as bX,a7 as bY,hW as bZ,dW as b_,TB as ba,EW as bb,UW as bc,jW as bd,LW as be,JW as bf,OW as bg,$W as bh,FW as bi,PW as bj,CW as bk,VD as bl,Vd as bm,D$ as bn,Cr as bo,f7 as bp,Fs as bq,yt as br,Rr as bs,qa as bt,Wa as bu,It as bv,q as bw,$s as bx,k$ as by,eU as bz,sw as c,B7 as c$,Xr as c0,v3 as c1,Ur as c2,D7 as c3,P7 as c4,E7 as c5,nW as c6,tW as c7,R7 as c8,y7 as c9,$7 as cA,U7 as cB,N$ as cC,aW as cD,rW as cE,m7 as cF,V$ as cG,b7 as cH,lT as cI,Q7 as cJ,Y7 as cK,K7 as cL,R$ as cM,dT as cN,W7 as cO,G7 as cP,I7 as cQ,op as cR,J7 as cS,X7 as cT,Q$ as cU,Ki as cV,ED as cW,j7 as cX,h7 as cY,Z7 as cZ,Z$ as c_,Cn as ca,d7 as cb,A$ as cc,F$ as cd,uW as ce,q7 as cf,eW as cg,w7 as ch,cW as ci,C$ as cj,S7 as ck,O7 as cl,p7 as cm,g7 as cn,v7 as co,lW as cp,k7 as cq,C7 as cr,Zt as cs,Ih as ct,U$ as cu,H7 as cv,M7 as cw,V7 as cx,F7 as cy,wc as cz,Cs as d,oW as d0,o7 as d1,L7 as d2,A7 as d3,T7 as d4,N7 as d5,x7 as d6,z7 as d7,sW as d8,_7 as d9,ni as da,iW as db,ii as dc,H as dd,Kr as de,Ve as df,Iq as dg,sG as dh,iG as di,Zl as e,r7 as f,i3 as g,n7 as h,Xq as i,jq as j,Lq as k,Gq as l,Kq as m,Qq as n,ve as o,s3 as p,Yq as q,Zk as r,LC as s,Jq as t,e7 as u,Iw as v,$q as w,Uq as x,UF as y,kq as z};
