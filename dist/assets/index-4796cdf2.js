(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))r(s);new MutationObserver(s=>{for(const i of s)if(i.type==="childList")for(const o of i.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&r(o)}).observe(document,{childList:!0,subtree:!0});function t(s){const i={};return s.integrity&&(i.integrity=s.integrity),s.referrerPolicy&&(i.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?i.credentials="include":s.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function r(s){if(s.ep)return;s.ep=!0;const i=t(s);fetch(s.href,i)}})();function c2(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}var jb={exports:{}},xg={},Vb={exports:{}},ot={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var sh=Symbol.for("react.element"),u2=Symbol.for("react.portal"),d2=Symbol.for("react.fragment"),h2=Symbol.for("react.strict_mode"),f2=Symbol.for("react.profiler"),p2=Symbol.for("react.provider"),g2=Symbol.for("react.context"),m2=Symbol.for("react.forward_ref"),y2=Symbol.for("react.suspense"),_2=Symbol.for("react.memo"),v2=Symbol.for("react.lazy"),kI=Symbol.iterator;function w2(n){return n===null||typeof n!="object"?null:(n=kI&&n[kI]||n["@@iterator"],typeof n=="function"?n:null)}var Fb={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},Ub=Object.assign,$b={};function Oc(n,e,t){this.props=n,this.context=e,this.refs=$b,this.updater=t||Fb}Oc.prototype.isReactComponent={};Oc.prototype.setState=function(n,e){if(typeof n!="object"&&typeof n!="function"&&n!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,n,e,"setState")};Oc.prototype.forceUpdate=function(n){this.updater.enqueueForceUpdate(this,n,"forceUpdate")};function Bb(){}Bb.prototype=Oc.prototype;function Wv(n,e,t){this.props=n,this.context=e,this.refs=$b,this.updater=t||Fb}var Gv=Wv.prototype=new Bb;Gv.constructor=Wv;Ub(Gv,Oc.prototype);Gv.isPureReactComponent=!0;var PI=Array.isArray,zb=Object.prototype.hasOwnProperty,Hv={current:null},qb={key:!0,ref:!0,__self:!0,__source:!0};function Wb(n,e,t){var r,s={},i=null,o=null;if(e!=null)for(r in e.ref!==void 0&&(o=e.ref),e.key!==void 0&&(i=""+e.key),e)zb.call(e,r)&&!qb.hasOwnProperty(r)&&(s[r]=e[r]);var a=arguments.length-2;if(a===1)s.children=t;else if(1<a){for(var l=Array(a),u=0;u<a;u++)l[u]=arguments[u+2];s.children=l}if(n&&n.defaultProps)for(r in a=n.defaultProps,a)s[r]===void 0&&(s[r]=a[r]);return{$$typeof:sh,type:n,key:i,ref:o,props:s,_owner:Hv.current}}function x2(n,e){return{$$typeof:sh,type:n.type,key:e,ref:n.ref,props:n.props,_owner:n._owner}}function Qv(n){return typeof n=="object"&&n!==null&&n.$$typeof===sh}function I2(n){var e={"=":"=0",":":"=2"};return"$"+n.replace(/[=:]/g,function(t){return e[t]})}var DI=/\/+/g;function Ym(n,e){return typeof n=="object"&&n!==null&&n.key!=null?I2(""+n.key):e.toString(36)}function Df(n,e,t,r,s){var i=typeof n;(i==="undefined"||i==="boolean")&&(n=null);var o=!1;if(n===null)o=!0;else switch(i){case"string":case"number":o=!0;break;case"object":switch(n.$$typeof){case sh:case u2:o=!0}}if(o)return o=n,s=s(o),n=r===""?"."+Ym(o,0):r,PI(s)?(t="",n!=null&&(t=n.replace(DI,"$&/")+"/"),Df(s,e,t,"",function(u){return u})):s!=null&&(Qv(s)&&(s=x2(s,t+(!s.key||o&&o.key===s.key?"":(""+s.key).replace(DI,"$&/")+"/")+n)),e.push(s)),1;if(o=0,r=r===""?".":r+":",PI(n))for(var a=0;a<n.length;a++){i=n[a];var l=r+Ym(i,a);o+=Df(i,e,t,l,s)}else if(l=w2(n),typeof l=="function")for(n=l.call(n),a=0;!(i=n.next()).done;)i=i.value,l=r+Ym(i,a++),o+=Df(i,e,t,l,s);else if(i==="object")throw e=String(n),Error("Objects are not valid as a React child (found: "+(e==="[object Object]"?"object with keys {"+Object.keys(n).join(", ")+"}":e)+"). If you meant to render a collection of children, use an array instead.");return o}function Zh(n,e,t){if(n==null)return n;var r=[],s=0;return Df(n,r,"","",function(i){return e.call(t,i,s++)}),r}function S2(n){if(n._status===-1){var e=n._result;e=e(),e.then(function(t){(n._status===0||n._status===-1)&&(n._status=1,n._result=t)},function(t){(n._status===0||n._status===-1)&&(n._status=2,n._result=t)}),n._status===-1&&(n._status=0,n._result=e)}if(n._status===1)return n._result.default;throw n._result}var yr={current:null},Of={transition:null},E2={ReactCurrentDispatcher:yr,ReactCurrentBatchConfig:Of,ReactCurrentOwner:Hv};function Gb(){throw Error("act(...) is not supported in production builds of React.")}ot.Children={map:Zh,forEach:function(n,e,t){Zh(n,function(){e.apply(this,arguments)},t)},count:function(n){var e=0;return Zh(n,function(){e++}),e},toArray:function(n){return Zh(n,function(e){return e})||[]},only:function(n){if(!Qv(n))throw Error("React.Children.only expected to receive a single React element child.");return n}};ot.Component=Oc;ot.Fragment=d2;ot.Profiler=f2;ot.PureComponent=Wv;ot.StrictMode=h2;ot.Suspense=y2;ot.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=E2;ot.act=Gb;ot.cloneElement=function(n,e,t){if(n==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+n+".");var r=Ub({},n.props),s=n.key,i=n.ref,o=n._owner;if(e!=null){if(e.ref!==void 0&&(i=e.ref,o=Hv.current),e.key!==void 0&&(s=""+e.key),n.type&&n.type.defaultProps)var a=n.type.defaultProps;for(l in e)zb.call(e,l)&&!qb.hasOwnProperty(l)&&(r[l]=e[l]===void 0&&a!==void 0?a[l]:e[l])}var l=arguments.length-2;if(l===1)r.children=t;else if(1<l){a=Array(l);for(var u=0;u<l;u++)a[u]=arguments[u+2];r.children=a}return{$$typeof:sh,type:n.type,key:s,ref:i,props:r,_owner:o}};ot.createContext=function(n){return n={$$typeof:g2,_currentValue:n,_currentValue2:n,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},n.Provider={$$typeof:p2,_context:n},n.Consumer=n};ot.createElement=Wb;ot.createFactory=function(n){var e=Wb.bind(null,n);return e.type=n,e};ot.createRef=function(){return{current:null}};ot.forwardRef=function(n){return{$$typeof:m2,render:n}};ot.isValidElement=Qv;ot.lazy=function(n){return{$$typeof:v2,_payload:{_status:-1,_result:n},_init:S2}};ot.memo=function(n,e){return{$$typeof:_2,type:n,compare:e===void 0?null:e}};ot.startTransition=function(n){var e=Of.transition;Of.transition={};try{n()}finally{Of.transition=e}};ot.unstable_act=Gb;ot.useCallback=function(n,e){return yr.current.useCallback(n,e)};ot.useContext=function(n){return yr.current.useContext(n)};ot.useDebugValue=function(){};ot.useDeferredValue=function(n){return yr.current.useDeferredValue(n)};ot.useEffect=function(n,e){return yr.current.useEffect(n,e)};ot.useId=function(){return yr.current.useId()};ot.useImperativeHandle=function(n,e,t){return yr.current.useImperativeHandle(n,e,t)};ot.useInsertionEffect=function(n,e){return yr.current.useInsertionEffect(n,e)};ot.useLayoutEffect=function(n,e){return yr.current.useLayoutEffect(n,e)};ot.useMemo=function(n,e){return yr.current.useMemo(n,e)};ot.useReducer=function(n,e,t){return yr.current.useReducer(n,e,t)};ot.useRef=function(n){return yr.current.useRef(n)};ot.useState=function(n){return yr.current.useState(n)};ot.useSyncExternalStore=function(n,e,t){return yr.current.useSyncExternalStore(n,e,t)};ot.useTransition=function(){return yr.current.useTransition()};ot.version="18.3.1";Vb.exports=ot;var O=Vb.exports;const T2=c2(O);/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var b2=O,A2=Symbol.for("react.element"),C2=Symbol.for("react.fragment"),R2=Object.prototype.hasOwnProperty,N2=b2.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,k2={key:!0,ref:!0,__self:!0,__source:!0};function Hb(n,e,t){var r,s={},i=null,o=null;t!==void 0&&(i=""+t),e.key!==void 0&&(i=""+e.key),e.ref!==void 0&&(o=e.ref);for(r in e)R2.call(e,r)&&!k2.hasOwnProperty(r)&&(s[r]=e[r]);if(n&&n.defaultProps)for(r in e=n.defaultProps,e)s[r]===void 0&&(s[r]=e[r]);return{$$typeof:A2,type:n,key:i,ref:o,props:s,_owner:N2.current}}xg.Fragment=C2;xg.jsx=Hb;xg.jsxs=Hb;jb.exports=xg;var d=jb.exports,Xy={},Qb={exports:{}},Hr={},Kb={exports:{}},Yb={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(n){function e(Q,we){var Se=Q.length;Q.push(we);e:for(;0<Se;){var qe=Se-1>>>1,De=Q[qe];if(0<s(De,we))Q[qe]=we,Q[Se]=De,Se=qe;else break e}}function t(Q){return Q.length===0?null:Q[0]}function r(Q){if(Q.length===0)return null;var we=Q[0],Se=Q.pop();if(Se!==we){Q[0]=Se;e:for(var qe=0,De=Q.length,D=De>>>1;qe<D;){var q=2*(qe+1)-1,ae=Q[q],pe=q+1,Te=Q[pe];if(0>s(ae,Se))pe<De&&0>s(Te,ae)?(Q[qe]=Te,Q[pe]=Se,qe=pe):(Q[qe]=ae,Q[q]=Se,qe=q);else if(pe<De&&0>s(Te,Se))Q[qe]=Te,Q[pe]=Se,qe=pe;else break e}}return we}function s(Q,we){var Se=Q.sortIndex-we.sortIndex;return Se!==0?Se:Q.id-we.id}if(typeof performance=="object"&&typeof performance.now=="function"){var i=performance;n.unstable_now=function(){return i.now()}}else{var o=Date,a=o.now();n.unstable_now=function(){return o.now()-a}}var l=[],u=[],h=1,f=null,p=3,y=!1,w=!1,S=!1,k=typeof setTimeout=="function"?setTimeout:null,E=typeof clearTimeout=="function"?clearTimeout:null,x=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function N(Q){for(var we=t(u);we!==null;){if(we.callback===null)r(u);else if(we.startTime<=Q)r(u),we.sortIndex=we.expirationTime,e(l,we);else break;we=t(u)}}function P(Q){if(S=!1,N(Q),!w)if(t(l)!==null)w=!0,Fe($);else{var we=t(u);we!==null&&It(P,we.startTime-Q)}}function $(Q,we){w=!1,S&&(S=!1,E(v),v=-1),y=!0;var Se=p;try{for(N(we),f=t(l);f!==null&&(!(f.expirationTime>we)||Q&&!A());){var qe=f.callback;if(typeof qe=="function"){f.callback=null,p=f.priorityLevel;var De=qe(f.expirationTime<=we);we=n.unstable_now(),typeof De=="function"?f.callback=De:f===t(l)&&r(l),N(we)}else r(l);f=t(l)}if(f!==null)var D=!0;else{var q=t(u);q!==null&&It(P,q.startTime-we),D=!1}return D}finally{f=null,p=Se,y=!1}}var L=!1,R=null,v=-1,T=5,C=-1;function A(){return!(n.unstable_now()-C<T)}function b(){if(R!==null){var Q=n.unstable_now();C=Q;var we=!0;try{we=R(!0,Q)}finally{we?_():(L=!1,R=null)}}else L=!1}var _;if(typeof x=="function")_=function(){x(b)};else if(typeof MessageChannel<"u"){var B=new MessageChannel,ve=B.port2;B.port1.onmessage=b,_=function(){ve.postMessage(null)}}else _=function(){k(b,0)};function Fe(Q){R=Q,L||(L=!0,_())}function It(Q,we){v=k(function(){Q(n.unstable_now())},we)}n.unstable_IdlePriority=5,n.unstable_ImmediatePriority=1,n.unstable_LowPriority=4,n.unstable_NormalPriority=3,n.unstable_Profiling=null,n.unstable_UserBlockingPriority=2,n.unstable_cancelCallback=function(Q){Q.callback=null},n.unstable_continueExecution=function(){w||y||(w=!0,Fe($))},n.unstable_forceFrameRate=function(Q){0>Q||125<Q?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):T=0<Q?Math.floor(1e3/Q):5},n.unstable_getCurrentPriorityLevel=function(){return p},n.unstable_getFirstCallbackNode=function(){return t(l)},n.unstable_next=function(Q){switch(p){case 1:case 2:case 3:var we=3;break;default:we=p}var Se=p;p=we;try{return Q()}finally{p=Se}},n.unstable_pauseExecution=function(){},n.unstable_requestPaint=function(){},n.unstable_runWithPriority=function(Q,we){switch(Q){case 1:case 2:case 3:case 4:case 5:break;default:Q=3}var Se=p;p=Q;try{return we()}finally{p=Se}},n.unstable_scheduleCallback=function(Q,we,Se){var qe=n.unstable_now();switch(typeof Se=="object"&&Se!==null?(Se=Se.delay,Se=typeof Se=="number"&&0<Se?qe+Se:qe):Se=qe,Q){case 1:var De=-1;break;case 2:De=250;break;case 5:De=1073741823;break;case 4:De=1e4;break;default:De=5e3}return De=Se+De,Q={id:h++,callback:we,priorityLevel:Q,startTime:Se,expirationTime:De,sortIndex:-1},Se>qe?(Q.sortIndex=Se,e(u,Q),t(l)===null&&Q===t(u)&&(S?(E(v),v=-1):S=!0,It(P,Se-qe))):(Q.sortIndex=De,e(l,Q),w||y||(w=!0,Fe($))),Q},n.unstable_shouldYield=A,n.unstable_wrapCallback=function(Q){var we=p;return function(){var Se=p;p=we;try{return Q.apply(this,arguments)}finally{p=Se}}}})(Yb);Kb.exports=Yb;var P2=Kb.exports;/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var D2=O,zr=P2;function X(n){for(var e="https://reactjs.org/docs/error-decoder.html?invariant="+n,t=1;t<arguments.length;t++)e+="&args[]="+encodeURIComponent(arguments[t]);return"Minified React error #"+n+"; visit "+e+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var Jb=new Set,dd={};function Wa(n,e){tc(n,e),tc(n+"Capture",e)}function tc(n,e){for(dd[n]=e,n=0;n<e.length;n++)Jb.add(e[n])}var vi=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),Zy=Object.prototype.hasOwnProperty,O2=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,OI={},LI={};function L2(n){return Zy.call(LI,n)?!0:Zy.call(OI,n)?!1:O2.test(n)?LI[n]=!0:(OI[n]=!0,!1)}function M2(n,e,t,r){if(t!==null&&t.type===0)return!1;switch(typeof e){case"function":case"symbol":return!0;case"boolean":return r?!1:t!==null?!t.acceptsBooleans:(n=n.toLowerCase().slice(0,5),n!=="data-"&&n!=="aria-");default:return!1}}function j2(n,e,t,r){if(e===null||typeof e>"u"||M2(n,e,t,r))return!0;if(r)return!1;if(t!==null)switch(t.type){case 3:return!e;case 4:return e===!1;case 5:return isNaN(e);case 6:return isNaN(e)||1>e}return!1}function _r(n,e,t,r,s,i,o){this.acceptsBooleans=e===2||e===3||e===4,this.attributeName=r,this.attributeNamespace=s,this.mustUseProperty=t,this.propertyName=n,this.type=e,this.sanitizeURL=i,this.removeEmptyString=o}var Kn={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(n){Kn[n]=new _r(n,0,!1,n,null,!1,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(n){var e=n[0];Kn[e]=new _r(e,1,!1,n[1],null,!1,!1)});["contentEditable","draggable","spellCheck","value"].forEach(function(n){Kn[n]=new _r(n,2,!1,n.toLowerCase(),null,!1,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(n){Kn[n]=new _r(n,2,!1,n,null,!1,!1)});"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(n){Kn[n]=new _r(n,3,!1,n.toLowerCase(),null,!1,!1)});["checked","multiple","muted","selected"].forEach(function(n){Kn[n]=new _r(n,3,!0,n,null,!1,!1)});["capture","download"].forEach(function(n){Kn[n]=new _r(n,4,!1,n,null,!1,!1)});["cols","rows","size","span"].forEach(function(n){Kn[n]=new _r(n,6,!1,n,null,!1,!1)});["rowSpan","start"].forEach(function(n){Kn[n]=new _r(n,5,!1,n.toLowerCase(),null,!1,!1)});var Kv=/[\-:]([a-z])/g;function Yv(n){return n[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(n){var e=n.replace(Kv,Yv);Kn[e]=new _r(e,1,!1,n,null,!1,!1)});"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(n){var e=n.replace(Kv,Yv);Kn[e]=new _r(e,1,!1,n,"http://www.w3.org/1999/xlink",!1,!1)});["xml:base","xml:lang","xml:space"].forEach(function(n){var e=n.replace(Kv,Yv);Kn[e]=new _r(e,1,!1,n,"http://www.w3.org/XML/1998/namespace",!1,!1)});["tabIndex","crossOrigin"].forEach(function(n){Kn[n]=new _r(n,1,!1,n.toLowerCase(),null,!1,!1)});Kn.xlinkHref=new _r("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1);["src","href","action","formAction"].forEach(function(n){Kn[n]=new _r(n,1,!1,n.toLowerCase(),null,!0,!0)});function Jv(n,e,t,r){var s=Kn.hasOwnProperty(e)?Kn[e]:null;(s!==null?s.type!==0:r||!(2<e.length)||e[0]!=="o"&&e[0]!=="O"||e[1]!=="n"&&e[1]!=="N")&&(j2(e,t,s,r)&&(t=null),r||s===null?L2(e)&&(t===null?n.removeAttribute(e):n.setAttribute(e,""+t)):s.mustUseProperty?n[s.propertyName]=t===null?s.type===3?!1:"":t:(e=s.attributeName,r=s.attributeNamespace,t===null?n.removeAttribute(e):(s=s.type,t=s===3||s===4&&t===!0?"":""+t,r?n.setAttributeNS(r,e,t):n.setAttribute(e,t))))}var Ni=D2.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,ef=Symbol.for("react.element"),bl=Symbol.for("react.portal"),Al=Symbol.for("react.fragment"),Xv=Symbol.for("react.strict_mode"),e_=Symbol.for("react.profiler"),Xb=Symbol.for("react.provider"),Zb=Symbol.for("react.context"),Zv=Symbol.for("react.forward_ref"),t_=Symbol.for("react.suspense"),n_=Symbol.for("react.suspense_list"),e0=Symbol.for("react.memo"),Gi=Symbol.for("react.lazy"),eA=Symbol.for("react.offscreen"),MI=Symbol.iterator;function au(n){return n===null||typeof n!="object"?null:(n=MI&&n[MI]||n["@@iterator"],typeof n=="function"?n:null)}var tn=Object.assign,Jm;function Tu(n){if(Jm===void 0)try{throw Error()}catch(t){var e=t.stack.trim().match(/\n( *(at )?)/);Jm=e&&e[1]||""}return`
`+Jm+n}var Xm=!1;function Zm(n,e){if(!n||Xm)return"";Xm=!0;var t=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(e)if(e=function(){throw Error()},Object.defineProperty(e.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(e,[])}catch(u){var r=u}Reflect.construct(n,[],e)}else{try{e.call()}catch(u){r=u}n.call(e.prototype)}else{try{throw Error()}catch(u){r=u}n()}}catch(u){if(u&&r&&typeof u.stack=="string"){for(var s=u.stack.split(`
`),i=r.stack.split(`
`),o=s.length-1,a=i.length-1;1<=o&&0<=a&&s[o]!==i[a];)a--;for(;1<=o&&0<=a;o--,a--)if(s[o]!==i[a]){if(o!==1||a!==1)do if(o--,a--,0>a||s[o]!==i[a]){var l=`
`+s[o].replace(" at new "," at ");return n.displayName&&l.includes("<anonymous>")&&(l=l.replace("<anonymous>",n.displayName)),l}while(1<=o&&0<=a);break}}}finally{Xm=!1,Error.prepareStackTrace=t}return(n=n?n.displayName||n.name:"")?Tu(n):""}function V2(n){switch(n.tag){case 5:return Tu(n.type);case 16:return Tu("Lazy");case 13:return Tu("Suspense");case 19:return Tu("SuspenseList");case 0:case 2:case 15:return n=Zm(n.type,!1),n;case 11:return n=Zm(n.type.render,!1),n;case 1:return n=Zm(n.type,!0),n;default:return""}}function r_(n){if(n==null)return null;if(typeof n=="function")return n.displayName||n.name||null;if(typeof n=="string")return n;switch(n){case Al:return"Fragment";case bl:return"Portal";case e_:return"Profiler";case Xv:return"StrictMode";case t_:return"Suspense";case n_:return"SuspenseList"}if(typeof n=="object")switch(n.$$typeof){case Zb:return(n.displayName||"Context")+".Consumer";case Xb:return(n._context.displayName||"Context")+".Provider";case Zv:var e=n.render;return n=n.displayName,n||(n=e.displayName||e.name||"",n=n!==""?"ForwardRef("+n+")":"ForwardRef"),n;case e0:return e=n.displayName||null,e!==null?e:r_(n.type)||"Memo";case Gi:e=n._payload,n=n._init;try{return r_(n(e))}catch{}}return null}function F2(n){var e=n.type;switch(n.tag){case 24:return"Cache";case 9:return(e.displayName||"Context")+".Consumer";case 10:return(e._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return n=e.render,n=n.displayName||n.name||"",e.displayName||(n!==""?"ForwardRef("+n+")":"ForwardRef");case 7:return"Fragment";case 5:return e;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return r_(e);case 8:return e===Xv?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof e=="function")return e.displayName||e.name||null;if(typeof e=="string")return e}return null}function So(n){switch(typeof n){case"boolean":case"number":case"string":case"undefined":return n;case"object":return n;default:return""}}function tA(n){var e=n.type;return(n=n.nodeName)&&n.toLowerCase()==="input"&&(e==="checkbox"||e==="radio")}function U2(n){var e=tA(n)?"checked":"value",t=Object.getOwnPropertyDescriptor(n.constructor.prototype,e),r=""+n[e];if(!n.hasOwnProperty(e)&&typeof t<"u"&&typeof t.get=="function"&&typeof t.set=="function"){var s=t.get,i=t.set;return Object.defineProperty(n,e,{configurable:!0,get:function(){return s.call(this)},set:function(o){r=""+o,i.call(this,o)}}),Object.defineProperty(n,e,{enumerable:t.enumerable}),{getValue:function(){return r},setValue:function(o){r=""+o},stopTracking:function(){n._valueTracker=null,delete n[e]}}}}function tf(n){n._valueTracker||(n._valueTracker=U2(n))}function nA(n){if(!n)return!1;var e=n._valueTracker;if(!e)return!0;var t=e.getValue(),r="";return n&&(r=tA(n)?n.checked?"true":"false":n.value),n=r,n!==t?(e.setValue(n),!0):!1}function dp(n){if(n=n||(typeof document<"u"?document:void 0),typeof n>"u")return null;try{return n.activeElement||n.body}catch{return n.body}}function s_(n,e){var t=e.checked;return tn({},e,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:t??n._wrapperState.initialChecked})}function jI(n,e){var t=e.defaultValue==null?"":e.defaultValue,r=e.checked!=null?e.checked:e.defaultChecked;t=So(e.value!=null?e.value:t),n._wrapperState={initialChecked:r,initialValue:t,controlled:e.type==="checkbox"||e.type==="radio"?e.checked!=null:e.value!=null}}function rA(n,e){e=e.checked,e!=null&&Jv(n,"checked",e,!1)}function i_(n,e){rA(n,e);var t=So(e.value),r=e.type;if(t!=null)r==="number"?(t===0&&n.value===""||n.value!=t)&&(n.value=""+t):n.value!==""+t&&(n.value=""+t);else if(r==="submit"||r==="reset"){n.removeAttribute("value");return}e.hasOwnProperty("value")?o_(n,e.type,t):e.hasOwnProperty("defaultValue")&&o_(n,e.type,So(e.defaultValue)),e.checked==null&&e.defaultChecked!=null&&(n.defaultChecked=!!e.defaultChecked)}function VI(n,e,t){if(e.hasOwnProperty("value")||e.hasOwnProperty("defaultValue")){var r=e.type;if(!(r!=="submit"&&r!=="reset"||e.value!==void 0&&e.value!==null))return;e=""+n._wrapperState.initialValue,t||e===n.value||(n.value=e),n.defaultValue=e}t=n.name,t!==""&&(n.name=""),n.defaultChecked=!!n._wrapperState.initialChecked,t!==""&&(n.name=t)}function o_(n,e,t){(e!=="number"||dp(n.ownerDocument)!==n)&&(t==null?n.defaultValue=""+n._wrapperState.initialValue:n.defaultValue!==""+t&&(n.defaultValue=""+t))}var bu=Array.isArray;function Ul(n,e,t,r){if(n=n.options,e){e={};for(var s=0;s<t.length;s++)e["$"+t[s]]=!0;for(t=0;t<n.length;t++)s=e.hasOwnProperty("$"+n[t].value),n[t].selected!==s&&(n[t].selected=s),s&&r&&(n[t].defaultSelected=!0)}else{for(t=""+So(t),e=null,s=0;s<n.length;s++){if(n[s].value===t){n[s].selected=!0,r&&(n[s].defaultSelected=!0);return}e!==null||n[s].disabled||(e=n[s])}e!==null&&(e.selected=!0)}}function a_(n,e){if(e.dangerouslySetInnerHTML!=null)throw Error(X(91));return tn({},e,{value:void 0,defaultValue:void 0,children:""+n._wrapperState.initialValue})}function FI(n,e){var t=e.value;if(t==null){if(t=e.children,e=e.defaultValue,t!=null){if(e!=null)throw Error(X(92));if(bu(t)){if(1<t.length)throw Error(X(93));t=t[0]}e=t}e==null&&(e=""),t=e}n._wrapperState={initialValue:So(t)}}function sA(n,e){var t=So(e.value),r=So(e.defaultValue);t!=null&&(t=""+t,t!==n.value&&(n.value=t),e.defaultValue==null&&n.defaultValue!==t&&(n.defaultValue=t)),r!=null&&(n.defaultValue=""+r)}function UI(n){var e=n.textContent;e===n._wrapperState.initialValue&&e!==""&&e!==null&&(n.value=e)}function iA(n){switch(n){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function l_(n,e){return n==null||n==="http://www.w3.org/1999/xhtml"?iA(e):n==="http://www.w3.org/2000/svg"&&e==="foreignObject"?"http://www.w3.org/1999/xhtml":n}var nf,oA=function(n){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(e,t,r,s){MSApp.execUnsafeLocalFunction(function(){return n(e,t,r,s)})}:n}(function(n,e){if(n.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in n)n.innerHTML=e;else{for(nf=nf||document.createElement("div"),nf.innerHTML="<svg>"+e.valueOf().toString()+"</svg>",e=nf.firstChild;n.firstChild;)n.removeChild(n.firstChild);for(;e.firstChild;)n.appendChild(e.firstChild)}});function hd(n,e){if(e){var t=n.firstChild;if(t&&t===n.lastChild&&t.nodeType===3){t.nodeValue=e;return}}n.textContent=e}var ju={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},$2=["Webkit","ms","Moz","O"];Object.keys(ju).forEach(function(n){$2.forEach(function(e){e=e+n.charAt(0).toUpperCase()+n.substring(1),ju[e]=ju[n]})});function aA(n,e,t){return e==null||typeof e=="boolean"||e===""?"":t||typeof e!="number"||e===0||ju.hasOwnProperty(n)&&ju[n]?(""+e).trim():e+"px"}function lA(n,e){n=n.style;for(var t in e)if(e.hasOwnProperty(t)){var r=t.indexOf("--")===0,s=aA(t,e[t],r);t==="float"&&(t="cssFloat"),r?n.setProperty(t,s):n[t]=s}}var B2=tn({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function c_(n,e){if(e){if(B2[n]&&(e.children!=null||e.dangerouslySetInnerHTML!=null))throw Error(X(137,n));if(e.dangerouslySetInnerHTML!=null){if(e.children!=null)throw Error(X(60));if(typeof e.dangerouslySetInnerHTML!="object"||!("__html"in e.dangerouslySetInnerHTML))throw Error(X(61))}if(e.style!=null&&typeof e.style!="object")throw Error(X(62))}}function u_(n,e){if(n.indexOf("-")===-1)return typeof e.is=="string";switch(n){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var d_=null;function t0(n){return n=n.target||n.srcElement||window,n.correspondingUseElement&&(n=n.correspondingUseElement),n.nodeType===3?n.parentNode:n}var h_=null,$l=null,Bl=null;function $I(n){if(n=ah(n)){if(typeof h_!="function")throw Error(X(280));var e=n.stateNode;e&&(e=bg(e),h_(n.stateNode,n.type,e))}}function cA(n){$l?Bl?Bl.push(n):Bl=[n]:$l=n}function uA(){if($l){var n=$l,e=Bl;if(Bl=$l=null,$I(n),e)for(n=0;n<e.length;n++)$I(e[n])}}function dA(n,e){return n(e)}function hA(){}var ey=!1;function fA(n,e,t){if(ey)return n(e,t);ey=!0;try{return dA(n,e,t)}finally{ey=!1,($l!==null||Bl!==null)&&(hA(),uA())}}function fd(n,e){var t=n.stateNode;if(t===null)return null;var r=bg(t);if(r===null)return null;t=r[e];e:switch(e){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(r=!r.disabled)||(n=n.type,r=!(n==="button"||n==="input"||n==="select"||n==="textarea")),n=!r;break e;default:n=!1}if(n)return null;if(t&&typeof t!="function")throw Error(X(231,e,typeof t));return t}var f_=!1;if(vi)try{var lu={};Object.defineProperty(lu,"passive",{get:function(){f_=!0}}),window.addEventListener("test",lu,lu),window.removeEventListener("test",lu,lu)}catch{f_=!1}function z2(n,e,t,r,s,i,o,a,l){var u=Array.prototype.slice.call(arguments,3);try{e.apply(t,u)}catch(h){this.onError(h)}}var Vu=!1,hp=null,fp=!1,p_=null,q2={onError:function(n){Vu=!0,hp=n}};function W2(n,e,t,r,s,i,o,a,l){Vu=!1,hp=null,z2.apply(q2,arguments)}function G2(n,e,t,r,s,i,o,a,l){if(W2.apply(this,arguments),Vu){if(Vu){var u=hp;Vu=!1,hp=null}else throw Error(X(198));fp||(fp=!0,p_=u)}}function Ga(n){var e=n,t=n;if(n.alternate)for(;e.return;)e=e.return;else{n=e;do e=n,e.flags&4098&&(t=e.return),n=e.return;while(n)}return e.tag===3?t:null}function pA(n){if(n.tag===13){var e=n.memoizedState;if(e===null&&(n=n.alternate,n!==null&&(e=n.memoizedState)),e!==null)return e.dehydrated}return null}function BI(n){if(Ga(n)!==n)throw Error(X(188))}function H2(n){var e=n.alternate;if(!e){if(e=Ga(n),e===null)throw Error(X(188));return e!==n?null:n}for(var t=n,r=e;;){var s=t.return;if(s===null)break;var i=s.alternate;if(i===null){if(r=s.return,r!==null){t=r;continue}break}if(s.child===i.child){for(i=s.child;i;){if(i===t)return BI(s),n;if(i===r)return BI(s),e;i=i.sibling}throw Error(X(188))}if(t.return!==r.return)t=s,r=i;else{for(var o=!1,a=s.child;a;){if(a===t){o=!0,t=s,r=i;break}if(a===r){o=!0,r=s,t=i;break}a=a.sibling}if(!o){for(a=i.child;a;){if(a===t){o=!0,t=i,r=s;break}if(a===r){o=!0,r=i,t=s;break}a=a.sibling}if(!o)throw Error(X(189))}}if(t.alternate!==r)throw Error(X(190))}if(t.tag!==3)throw Error(X(188));return t.stateNode.current===t?n:e}function gA(n){return n=H2(n),n!==null?mA(n):null}function mA(n){if(n.tag===5||n.tag===6)return n;for(n=n.child;n!==null;){var e=mA(n);if(e!==null)return e;n=n.sibling}return null}var yA=zr.unstable_scheduleCallback,zI=zr.unstable_cancelCallback,Q2=zr.unstable_shouldYield,K2=zr.unstable_requestPaint,fn=zr.unstable_now,Y2=zr.unstable_getCurrentPriorityLevel,n0=zr.unstable_ImmediatePriority,_A=zr.unstable_UserBlockingPriority,pp=zr.unstable_NormalPriority,J2=zr.unstable_LowPriority,vA=zr.unstable_IdlePriority,Ig=null,qs=null;function X2(n){if(qs&&typeof qs.onCommitFiberRoot=="function")try{qs.onCommitFiberRoot(Ig,n,void 0,(n.current.flags&128)===128)}catch{}}var _s=Math.clz32?Math.clz32:tO,Z2=Math.log,eO=Math.LN2;function tO(n){return n>>>=0,n===0?32:31-(Z2(n)/eO|0)|0}var rf=64,sf=4194304;function Au(n){switch(n&-n){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return n&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return n&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return n}}function gp(n,e){var t=n.pendingLanes;if(t===0)return 0;var r=0,s=n.suspendedLanes,i=n.pingedLanes,o=t&268435455;if(o!==0){var a=o&~s;a!==0?r=Au(a):(i&=o,i!==0&&(r=Au(i)))}else o=t&~s,o!==0?r=Au(o):i!==0&&(r=Au(i));if(r===0)return 0;if(e!==0&&e!==r&&!(e&s)&&(s=r&-r,i=e&-e,s>=i||s===16&&(i&4194240)!==0))return e;if(r&4&&(r|=t&16),e=n.entangledLanes,e!==0)for(n=n.entanglements,e&=r;0<e;)t=31-_s(e),s=1<<t,r|=n[t],e&=~s;return r}function nO(n,e){switch(n){case 1:case 2:case 4:return e+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return e+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function rO(n,e){for(var t=n.suspendedLanes,r=n.pingedLanes,s=n.expirationTimes,i=n.pendingLanes;0<i;){var o=31-_s(i),a=1<<o,l=s[o];l===-1?(!(a&t)||a&r)&&(s[o]=nO(a,e)):l<=e&&(n.expiredLanes|=a),i&=~a}}function g_(n){return n=n.pendingLanes&-1073741825,n!==0?n:n&1073741824?1073741824:0}function wA(){var n=rf;return rf<<=1,!(rf&4194240)&&(rf=64),n}function ty(n){for(var e=[],t=0;31>t;t++)e.push(n);return e}function ih(n,e,t){n.pendingLanes|=e,e!==536870912&&(n.suspendedLanes=0,n.pingedLanes=0),n=n.eventTimes,e=31-_s(e),n[e]=t}function sO(n,e){var t=n.pendingLanes&~e;n.pendingLanes=e,n.suspendedLanes=0,n.pingedLanes=0,n.expiredLanes&=e,n.mutableReadLanes&=e,n.entangledLanes&=e,e=n.entanglements;var r=n.eventTimes;for(n=n.expirationTimes;0<t;){var s=31-_s(t),i=1<<s;e[s]=0,r[s]=-1,n[s]=-1,t&=~i}}function r0(n,e){var t=n.entangledLanes|=e;for(n=n.entanglements;t;){var r=31-_s(t),s=1<<r;s&e|n[r]&e&&(n[r]|=e),t&=~s}}var Tt=0;function xA(n){return n&=-n,1<n?4<n?n&268435455?16:536870912:4:1}var IA,s0,SA,EA,TA,m_=!1,of=[],lo=null,co=null,uo=null,pd=new Map,gd=new Map,Qi=[],iO="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function qI(n,e){switch(n){case"focusin":case"focusout":lo=null;break;case"dragenter":case"dragleave":co=null;break;case"mouseover":case"mouseout":uo=null;break;case"pointerover":case"pointerout":pd.delete(e.pointerId);break;case"gotpointercapture":case"lostpointercapture":gd.delete(e.pointerId)}}function cu(n,e,t,r,s,i){return n===null||n.nativeEvent!==i?(n={blockedOn:e,domEventName:t,eventSystemFlags:r,nativeEvent:i,targetContainers:[s]},e!==null&&(e=ah(e),e!==null&&s0(e)),n):(n.eventSystemFlags|=r,e=n.targetContainers,s!==null&&e.indexOf(s)===-1&&e.push(s),n)}function oO(n,e,t,r,s){switch(e){case"focusin":return lo=cu(lo,n,e,t,r,s),!0;case"dragenter":return co=cu(co,n,e,t,r,s),!0;case"mouseover":return uo=cu(uo,n,e,t,r,s),!0;case"pointerover":var i=s.pointerId;return pd.set(i,cu(pd.get(i)||null,n,e,t,r,s)),!0;case"gotpointercapture":return i=s.pointerId,gd.set(i,cu(gd.get(i)||null,n,e,t,r,s)),!0}return!1}function bA(n){var e=ca(n.target);if(e!==null){var t=Ga(e);if(t!==null){if(e=t.tag,e===13){if(e=pA(t),e!==null){n.blockedOn=e,TA(n.priority,function(){SA(t)});return}}else if(e===3&&t.stateNode.current.memoizedState.isDehydrated){n.blockedOn=t.tag===3?t.stateNode.containerInfo:null;return}}}n.blockedOn=null}function Lf(n){if(n.blockedOn!==null)return!1;for(var e=n.targetContainers;0<e.length;){var t=y_(n.domEventName,n.eventSystemFlags,e[0],n.nativeEvent);if(t===null){t=n.nativeEvent;var r=new t.constructor(t.type,t);d_=r,t.target.dispatchEvent(r),d_=null}else return e=ah(t),e!==null&&s0(e),n.blockedOn=t,!1;e.shift()}return!0}function WI(n,e,t){Lf(n)&&t.delete(e)}function aO(){m_=!1,lo!==null&&Lf(lo)&&(lo=null),co!==null&&Lf(co)&&(co=null),uo!==null&&Lf(uo)&&(uo=null),pd.forEach(WI),gd.forEach(WI)}function uu(n,e){n.blockedOn===e&&(n.blockedOn=null,m_||(m_=!0,zr.unstable_scheduleCallback(zr.unstable_NormalPriority,aO)))}function md(n){function e(s){return uu(s,n)}if(0<of.length){uu(of[0],n);for(var t=1;t<of.length;t++){var r=of[t];r.blockedOn===n&&(r.blockedOn=null)}}for(lo!==null&&uu(lo,n),co!==null&&uu(co,n),uo!==null&&uu(uo,n),pd.forEach(e),gd.forEach(e),t=0;t<Qi.length;t++)r=Qi[t],r.blockedOn===n&&(r.blockedOn=null);for(;0<Qi.length&&(t=Qi[0],t.blockedOn===null);)bA(t),t.blockedOn===null&&Qi.shift()}var zl=Ni.ReactCurrentBatchConfig,mp=!0;function lO(n,e,t,r){var s=Tt,i=zl.transition;zl.transition=null;try{Tt=1,i0(n,e,t,r)}finally{Tt=s,zl.transition=i}}function cO(n,e,t,r){var s=Tt,i=zl.transition;zl.transition=null;try{Tt=4,i0(n,e,t,r)}finally{Tt=s,zl.transition=i}}function i0(n,e,t,r){if(mp){var s=y_(n,e,t,r);if(s===null)dy(n,e,r,yp,t),qI(n,r);else if(oO(s,n,e,t,r))r.stopPropagation();else if(qI(n,r),e&4&&-1<iO.indexOf(n)){for(;s!==null;){var i=ah(s);if(i!==null&&IA(i),i=y_(n,e,t,r),i===null&&dy(n,e,r,yp,t),i===s)break;s=i}s!==null&&r.stopPropagation()}else dy(n,e,r,null,t)}}var yp=null;function y_(n,e,t,r){if(yp=null,n=t0(r),n=ca(n),n!==null)if(e=Ga(n),e===null)n=null;else if(t=e.tag,t===13){if(n=pA(e),n!==null)return n;n=null}else if(t===3){if(e.stateNode.current.memoizedState.isDehydrated)return e.tag===3?e.stateNode.containerInfo:null;n=null}else e!==n&&(n=null);return yp=n,null}function AA(n){switch(n){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(Y2()){case n0:return 1;case _A:return 4;case pp:case J2:return 16;case vA:return 536870912;default:return 16}default:return 16}}var to=null,o0=null,Mf=null;function CA(){if(Mf)return Mf;var n,e=o0,t=e.length,r,s="value"in to?to.value:to.textContent,i=s.length;for(n=0;n<t&&e[n]===s[n];n++);var o=t-n;for(r=1;r<=o&&e[t-r]===s[i-r];r++);return Mf=s.slice(n,1<r?1-r:void 0)}function jf(n){var e=n.keyCode;return"charCode"in n?(n=n.charCode,n===0&&e===13&&(n=13)):n=e,n===10&&(n=13),32<=n||n===13?n:0}function af(){return!0}function GI(){return!1}function Qr(n){function e(t,r,s,i,o){this._reactName=t,this._targetInst=s,this.type=r,this.nativeEvent=i,this.target=o,this.currentTarget=null;for(var a in n)n.hasOwnProperty(a)&&(t=n[a],this[a]=t?t(i):i[a]);return this.isDefaultPrevented=(i.defaultPrevented!=null?i.defaultPrevented:i.returnValue===!1)?af:GI,this.isPropagationStopped=GI,this}return tn(e.prototype,{preventDefault:function(){this.defaultPrevented=!0;var t=this.nativeEvent;t&&(t.preventDefault?t.preventDefault():typeof t.returnValue!="unknown"&&(t.returnValue=!1),this.isDefaultPrevented=af)},stopPropagation:function(){var t=this.nativeEvent;t&&(t.stopPropagation?t.stopPropagation():typeof t.cancelBubble!="unknown"&&(t.cancelBubble=!0),this.isPropagationStopped=af)},persist:function(){},isPersistent:af}),e}var Lc={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(n){return n.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},a0=Qr(Lc),oh=tn({},Lc,{view:0,detail:0}),uO=Qr(oh),ny,ry,du,Sg=tn({},oh,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:l0,button:0,buttons:0,relatedTarget:function(n){return n.relatedTarget===void 0?n.fromElement===n.srcElement?n.toElement:n.fromElement:n.relatedTarget},movementX:function(n){return"movementX"in n?n.movementX:(n!==du&&(du&&n.type==="mousemove"?(ny=n.screenX-du.screenX,ry=n.screenY-du.screenY):ry=ny=0,du=n),ny)},movementY:function(n){return"movementY"in n?n.movementY:ry}}),HI=Qr(Sg),dO=tn({},Sg,{dataTransfer:0}),hO=Qr(dO),fO=tn({},oh,{relatedTarget:0}),sy=Qr(fO),pO=tn({},Lc,{animationName:0,elapsedTime:0,pseudoElement:0}),gO=Qr(pO),mO=tn({},Lc,{clipboardData:function(n){return"clipboardData"in n?n.clipboardData:window.clipboardData}}),yO=Qr(mO),_O=tn({},Lc,{data:0}),QI=Qr(_O),vO={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},wO={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},xO={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function IO(n){var e=this.nativeEvent;return e.getModifierState?e.getModifierState(n):(n=xO[n])?!!e[n]:!1}function l0(){return IO}var SO=tn({},oh,{key:function(n){if(n.key){var e=vO[n.key]||n.key;if(e!=="Unidentified")return e}return n.type==="keypress"?(n=jf(n),n===13?"Enter":String.fromCharCode(n)):n.type==="keydown"||n.type==="keyup"?wO[n.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:l0,charCode:function(n){return n.type==="keypress"?jf(n):0},keyCode:function(n){return n.type==="keydown"||n.type==="keyup"?n.keyCode:0},which:function(n){return n.type==="keypress"?jf(n):n.type==="keydown"||n.type==="keyup"?n.keyCode:0}}),EO=Qr(SO),TO=tn({},Sg,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),KI=Qr(TO),bO=tn({},oh,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:l0}),AO=Qr(bO),CO=tn({},Lc,{propertyName:0,elapsedTime:0,pseudoElement:0}),RO=Qr(CO),NO=tn({},Sg,{deltaX:function(n){return"deltaX"in n?n.deltaX:"wheelDeltaX"in n?-n.wheelDeltaX:0},deltaY:function(n){return"deltaY"in n?n.deltaY:"wheelDeltaY"in n?-n.wheelDeltaY:"wheelDelta"in n?-n.wheelDelta:0},deltaZ:0,deltaMode:0}),kO=Qr(NO),PO=[9,13,27,32],c0=vi&&"CompositionEvent"in window,Fu=null;vi&&"documentMode"in document&&(Fu=document.documentMode);var DO=vi&&"TextEvent"in window&&!Fu,RA=vi&&(!c0||Fu&&8<Fu&&11>=Fu),YI=String.fromCharCode(32),JI=!1;function NA(n,e){switch(n){case"keyup":return PO.indexOf(e.keyCode)!==-1;case"keydown":return e.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function kA(n){return n=n.detail,typeof n=="object"&&"data"in n?n.data:null}var Cl=!1;function OO(n,e){switch(n){case"compositionend":return kA(e);case"keypress":return e.which!==32?null:(JI=!0,YI);case"textInput":return n=e.data,n===YI&&JI?null:n;default:return null}}function LO(n,e){if(Cl)return n==="compositionend"||!c0&&NA(n,e)?(n=CA(),Mf=o0=to=null,Cl=!1,n):null;switch(n){case"paste":return null;case"keypress":if(!(e.ctrlKey||e.altKey||e.metaKey)||e.ctrlKey&&e.altKey){if(e.char&&1<e.char.length)return e.char;if(e.which)return String.fromCharCode(e.which)}return null;case"compositionend":return RA&&e.locale!=="ko"?null:e.data;default:return null}}var MO={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function XI(n){var e=n&&n.nodeName&&n.nodeName.toLowerCase();return e==="input"?!!MO[n.type]:e==="textarea"}function PA(n,e,t,r){cA(r),e=_p(e,"onChange"),0<e.length&&(t=new a0("onChange","change",null,t,r),n.push({event:t,listeners:e}))}var Uu=null,yd=null;function jO(n){zA(n,0)}function Eg(n){var e=kl(n);if(nA(e))return n}function VO(n,e){if(n==="change")return e}var DA=!1;if(vi){var iy;if(vi){var oy="oninput"in document;if(!oy){var ZI=document.createElement("div");ZI.setAttribute("oninput","return;"),oy=typeof ZI.oninput=="function"}iy=oy}else iy=!1;DA=iy&&(!document.documentMode||9<document.documentMode)}function eS(){Uu&&(Uu.detachEvent("onpropertychange",OA),yd=Uu=null)}function OA(n){if(n.propertyName==="value"&&Eg(yd)){var e=[];PA(e,yd,n,t0(n)),fA(jO,e)}}function FO(n,e,t){n==="focusin"?(eS(),Uu=e,yd=t,Uu.attachEvent("onpropertychange",OA)):n==="focusout"&&eS()}function UO(n){if(n==="selectionchange"||n==="keyup"||n==="keydown")return Eg(yd)}function $O(n,e){if(n==="click")return Eg(e)}function BO(n,e){if(n==="input"||n==="change")return Eg(e)}function zO(n,e){return n===e&&(n!==0||1/n===1/e)||n!==n&&e!==e}var Is=typeof Object.is=="function"?Object.is:zO;function _d(n,e){if(Is(n,e))return!0;if(typeof n!="object"||n===null||typeof e!="object"||e===null)return!1;var t=Object.keys(n),r=Object.keys(e);if(t.length!==r.length)return!1;for(r=0;r<t.length;r++){var s=t[r];if(!Zy.call(e,s)||!Is(n[s],e[s]))return!1}return!0}function tS(n){for(;n&&n.firstChild;)n=n.firstChild;return n}function nS(n,e){var t=tS(n);n=0;for(var r;t;){if(t.nodeType===3){if(r=n+t.textContent.length,n<=e&&r>=e)return{node:t,offset:e-n};n=r}e:{for(;t;){if(t.nextSibling){t=t.nextSibling;break e}t=t.parentNode}t=void 0}t=tS(t)}}function LA(n,e){return n&&e?n===e?!0:n&&n.nodeType===3?!1:e&&e.nodeType===3?LA(n,e.parentNode):"contains"in n?n.contains(e):n.compareDocumentPosition?!!(n.compareDocumentPosition(e)&16):!1:!1}function MA(){for(var n=window,e=dp();e instanceof n.HTMLIFrameElement;){try{var t=typeof e.contentWindow.location.href=="string"}catch{t=!1}if(t)n=e.contentWindow;else break;e=dp(n.document)}return e}function u0(n){var e=n&&n.nodeName&&n.nodeName.toLowerCase();return e&&(e==="input"&&(n.type==="text"||n.type==="search"||n.type==="tel"||n.type==="url"||n.type==="password")||e==="textarea"||n.contentEditable==="true")}function qO(n){var e=MA(),t=n.focusedElem,r=n.selectionRange;if(e!==t&&t&&t.ownerDocument&&LA(t.ownerDocument.documentElement,t)){if(r!==null&&u0(t)){if(e=r.start,n=r.end,n===void 0&&(n=e),"selectionStart"in t)t.selectionStart=e,t.selectionEnd=Math.min(n,t.value.length);else if(n=(e=t.ownerDocument||document)&&e.defaultView||window,n.getSelection){n=n.getSelection();var s=t.textContent.length,i=Math.min(r.start,s);r=r.end===void 0?i:Math.min(r.end,s),!n.extend&&i>r&&(s=r,r=i,i=s),s=nS(t,i);var o=nS(t,r);s&&o&&(n.rangeCount!==1||n.anchorNode!==s.node||n.anchorOffset!==s.offset||n.focusNode!==o.node||n.focusOffset!==o.offset)&&(e=e.createRange(),e.setStart(s.node,s.offset),n.removeAllRanges(),i>r?(n.addRange(e),n.extend(o.node,o.offset)):(e.setEnd(o.node,o.offset),n.addRange(e)))}}for(e=[],n=t;n=n.parentNode;)n.nodeType===1&&e.push({element:n,left:n.scrollLeft,top:n.scrollTop});for(typeof t.focus=="function"&&t.focus(),t=0;t<e.length;t++)n=e[t],n.element.scrollLeft=n.left,n.element.scrollTop=n.top}}var WO=vi&&"documentMode"in document&&11>=document.documentMode,Rl=null,__=null,$u=null,v_=!1;function rS(n,e,t){var r=t.window===t?t.document:t.nodeType===9?t:t.ownerDocument;v_||Rl==null||Rl!==dp(r)||(r=Rl,"selectionStart"in r&&u0(r)?r={start:r.selectionStart,end:r.selectionEnd}:(r=(r.ownerDocument&&r.ownerDocument.defaultView||window).getSelection(),r={anchorNode:r.anchorNode,anchorOffset:r.anchorOffset,focusNode:r.focusNode,focusOffset:r.focusOffset}),$u&&_d($u,r)||($u=r,r=_p(__,"onSelect"),0<r.length&&(e=new a0("onSelect","select",null,e,t),n.push({event:e,listeners:r}),e.target=Rl)))}function lf(n,e){var t={};return t[n.toLowerCase()]=e.toLowerCase(),t["Webkit"+n]="webkit"+e,t["Moz"+n]="moz"+e,t}var Nl={animationend:lf("Animation","AnimationEnd"),animationiteration:lf("Animation","AnimationIteration"),animationstart:lf("Animation","AnimationStart"),transitionend:lf("Transition","TransitionEnd")},ay={},jA={};vi&&(jA=document.createElement("div").style,"AnimationEvent"in window||(delete Nl.animationend.animation,delete Nl.animationiteration.animation,delete Nl.animationstart.animation),"TransitionEvent"in window||delete Nl.transitionend.transition);function Tg(n){if(ay[n])return ay[n];if(!Nl[n])return n;var e=Nl[n],t;for(t in e)if(e.hasOwnProperty(t)&&t in jA)return ay[n]=e[t];return n}var VA=Tg("animationend"),FA=Tg("animationiteration"),UA=Tg("animationstart"),$A=Tg("transitionend"),BA=new Map,sS="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function jo(n,e){BA.set(n,e),Wa(e,[n])}for(var ly=0;ly<sS.length;ly++){var cy=sS[ly],GO=cy.toLowerCase(),HO=cy[0].toUpperCase()+cy.slice(1);jo(GO,"on"+HO)}jo(VA,"onAnimationEnd");jo(FA,"onAnimationIteration");jo(UA,"onAnimationStart");jo("dblclick","onDoubleClick");jo("focusin","onFocus");jo("focusout","onBlur");jo($A,"onTransitionEnd");tc("onMouseEnter",["mouseout","mouseover"]);tc("onMouseLeave",["mouseout","mouseover"]);tc("onPointerEnter",["pointerout","pointerover"]);tc("onPointerLeave",["pointerout","pointerover"]);Wa("onChange","change click focusin focusout input keydown keyup selectionchange".split(" "));Wa("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" "));Wa("onBeforeInput",["compositionend","keypress","textInput","paste"]);Wa("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" "));Wa("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" "));Wa("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Cu="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),QO=new Set("cancel close invalid load scroll toggle".split(" ").concat(Cu));function iS(n,e,t){var r=n.type||"unknown-event";n.currentTarget=t,G2(r,e,void 0,n),n.currentTarget=null}function zA(n,e){e=(e&4)!==0;for(var t=0;t<n.length;t++){var r=n[t],s=r.event;r=r.listeners;e:{var i=void 0;if(e)for(var o=r.length-1;0<=o;o--){var a=r[o],l=a.instance,u=a.currentTarget;if(a=a.listener,l!==i&&s.isPropagationStopped())break e;iS(s,a,u),i=l}else for(o=0;o<r.length;o++){if(a=r[o],l=a.instance,u=a.currentTarget,a=a.listener,l!==i&&s.isPropagationStopped())break e;iS(s,a,u),i=l}}}if(fp)throw n=p_,fp=!1,p_=null,n}function Ft(n,e){var t=e[E_];t===void 0&&(t=e[E_]=new Set);var r=n+"__bubble";t.has(r)||(qA(e,n,2,!1),t.add(r))}function uy(n,e,t){var r=0;e&&(r|=4),qA(t,n,r,e)}var cf="_reactListening"+Math.random().toString(36).slice(2);function vd(n){if(!n[cf]){n[cf]=!0,Jb.forEach(function(t){t!=="selectionchange"&&(QO.has(t)||uy(t,!1,n),uy(t,!0,n))});var e=n.nodeType===9?n:n.ownerDocument;e===null||e[cf]||(e[cf]=!0,uy("selectionchange",!1,e))}}function qA(n,e,t,r){switch(AA(e)){case 1:var s=lO;break;case 4:s=cO;break;default:s=i0}t=s.bind(null,e,t,n),s=void 0,!f_||e!=="touchstart"&&e!=="touchmove"&&e!=="wheel"||(s=!0),r?s!==void 0?n.addEventListener(e,t,{capture:!0,passive:s}):n.addEventListener(e,t,!0):s!==void 0?n.addEventListener(e,t,{passive:s}):n.addEventListener(e,t,!1)}function dy(n,e,t,r,s){var i=r;if(!(e&1)&&!(e&2)&&r!==null)e:for(;;){if(r===null)return;var o=r.tag;if(o===3||o===4){var a=r.stateNode.containerInfo;if(a===s||a.nodeType===8&&a.parentNode===s)break;if(o===4)for(o=r.return;o!==null;){var l=o.tag;if((l===3||l===4)&&(l=o.stateNode.containerInfo,l===s||l.nodeType===8&&l.parentNode===s))return;o=o.return}for(;a!==null;){if(o=ca(a),o===null)return;if(l=o.tag,l===5||l===6){r=i=o;continue e}a=a.parentNode}}r=r.return}fA(function(){var u=i,h=t0(t),f=[];e:{var p=BA.get(n);if(p!==void 0){var y=a0,w=n;switch(n){case"keypress":if(jf(t)===0)break e;case"keydown":case"keyup":y=EO;break;case"focusin":w="focus",y=sy;break;case"focusout":w="blur",y=sy;break;case"beforeblur":case"afterblur":y=sy;break;case"click":if(t.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":y=HI;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":y=hO;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":y=AO;break;case VA:case FA:case UA:y=gO;break;case $A:y=RO;break;case"scroll":y=uO;break;case"wheel":y=kO;break;case"copy":case"cut":case"paste":y=yO;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":y=KI}var S=(e&4)!==0,k=!S&&n==="scroll",E=S?p!==null?p+"Capture":null:p;S=[];for(var x=u,N;x!==null;){N=x;var P=N.stateNode;if(N.tag===5&&P!==null&&(N=P,E!==null&&(P=fd(x,E),P!=null&&S.push(wd(x,P,N)))),k)break;x=x.return}0<S.length&&(p=new y(p,w,null,t,h),f.push({event:p,listeners:S}))}}if(!(e&7)){e:{if(p=n==="mouseover"||n==="pointerover",y=n==="mouseout"||n==="pointerout",p&&t!==d_&&(w=t.relatedTarget||t.fromElement)&&(ca(w)||w[wi]))break e;if((y||p)&&(p=h.window===h?h:(p=h.ownerDocument)?p.defaultView||p.parentWindow:window,y?(w=t.relatedTarget||t.toElement,y=u,w=w?ca(w):null,w!==null&&(k=Ga(w),w!==k||w.tag!==5&&w.tag!==6)&&(w=null)):(y=null,w=u),y!==w)){if(S=HI,P="onMouseLeave",E="onMouseEnter",x="mouse",(n==="pointerout"||n==="pointerover")&&(S=KI,P="onPointerLeave",E="onPointerEnter",x="pointer"),k=y==null?p:kl(y),N=w==null?p:kl(w),p=new S(P,x+"leave",y,t,h),p.target=k,p.relatedTarget=N,P=null,ca(h)===u&&(S=new S(E,x+"enter",w,t,h),S.target=N,S.relatedTarget=k,P=S),k=P,y&&w)t:{for(S=y,E=w,x=0,N=S;N;N=pl(N))x++;for(N=0,P=E;P;P=pl(P))N++;for(;0<x-N;)S=pl(S),x--;for(;0<N-x;)E=pl(E),N--;for(;x--;){if(S===E||E!==null&&S===E.alternate)break t;S=pl(S),E=pl(E)}S=null}else S=null;y!==null&&oS(f,p,y,S,!1),w!==null&&k!==null&&oS(f,k,w,S,!0)}}e:{if(p=u?kl(u):window,y=p.nodeName&&p.nodeName.toLowerCase(),y==="select"||y==="input"&&p.type==="file")var $=VO;else if(XI(p))if(DA)$=BO;else{$=UO;var L=FO}else(y=p.nodeName)&&y.toLowerCase()==="input"&&(p.type==="checkbox"||p.type==="radio")&&($=$O);if($&&($=$(n,u))){PA(f,$,t,h);break e}L&&L(n,p,u),n==="focusout"&&(L=p._wrapperState)&&L.controlled&&p.type==="number"&&o_(p,"number",p.value)}switch(L=u?kl(u):window,n){case"focusin":(XI(L)||L.contentEditable==="true")&&(Rl=L,__=u,$u=null);break;case"focusout":$u=__=Rl=null;break;case"mousedown":v_=!0;break;case"contextmenu":case"mouseup":case"dragend":v_=!1,rS(f,t,h);break;case"selectionchange":if(WO)break;case"keydown":case"keyup":rS(f,t,h)}var R;if(c0)e:{switch(n){case"compositionstart":var v="onCompositionStart";break e;case"compositionend":v="onCompositionEnd";break e;case"compositionupdate":v="onCompositionUpdate";break e}v=void 0}else Cl?NA(n,t)&&(v="onCompositionEnd"):n==="keydown"&&t.keyCode===229&&(v="onCompositionStart");v&&(RA&&t.locale!=="ko"&&(Cl||v!=="onCompositionStart"?v==="onCompositionEnd"&&Cl&&(R=CA()):(to=h,o0="value"in to?to.value:to.textContent,Cl=!0)),L=_p(u,v),0<L.length&&(v=new QI(v,n,null,t,h),f.push({event:v,listeners:L}),R?v.data=R:(R=kA(t),R!==null&&(v.data=R)))),(R=DO?OO(n,t):LO(n,t))&&(u=_p(u,"onBeforeInput"),0<u.length&&(h=new QI("onBeforeInput","beforeinput",null,t,h),f.push({event:h,listeners:u}),h.data=R))}zA(f,e)})}function wd(n,e,t){return{instance:n,listener:e,currentTarget:t}}function _p(n,e){for(var t=e+"Capture",r=[];n!==null;){var s=n,i=s.stateNode;s.tag===5&&i!==null&&(s=i,i=fd(n,t),i!=null&&r.unshift(wd(n,i,s)),i=fd(n,e),i!=null&&r.push(wd(n,i,s))),n=n.return}return r}function pl(n){if(n===null)return null;do n=n.return;while(n&&n.tag!==5);return n||null}function oS(n,e,t,r,s){for(var i=e._reactName,o=[];t!==null&&t!==r;){var a=t,l=a.alternate,u=a.stateNode;if(l!==null&&l===r)break;a.tag===5&&u!==null&&(a=u,s?(l=fd(t,i),l!=null&&o.unshift(wd(t,l,a))):s||(l=fd(t,i),l!=null&&o.push(wd(t,l,a)))),t=t.return}o.length!==0&&n.push({event:e,listeners:o})}var KO=/\r\n?/g,YO=/\u0000|\uFFFD/g;function aS(n){return(typeof n=="string"?n:""+n).replace(KO,`
`).replace(YO,"")}function uf(n,e,t){if(e=aS(e),aS(n)!==e&&t)throw Error(X(425))}function vp(){}var w_=null,x_=null;function I_(n,e){return n==="textarea"||n==="noscript"||typeof e.children=="string"||typeof e.children=="number"||typeof e.dangerouslySetInnerHTML=="object"&&e.dangerouslySetInnerHTML!==null&&e.dangerouslySetInnerHTML.__html!=null}var S_=typeof setTimeout=="function"?setTimeout:void 0,JO=typeof clearTimeout=="function"?clearTimeout:void 0,lS=typeof Promise=="function"?Promise:void 0,XO=typeof queueMicrotask=="function"?queueMicrotask:typeof lS<"u"?function(n){return lS.resolve(null).then(n).catch(ZO)}:S_;function ZO(n){setTimeout(function(){throw n})}function hy(n,e){var t=e,r=0;do{var s=t.nextSibling;if(n.removeChild(t),s&&s.nodeType===8)if(t=s.data,t==="/$"){if(r===0){n.removeChild(s),md(e);return}r--}else t!=="$"&&t!=="$?"&&t!=="$!"||r++;t=s}while(t);md(e)}function ho(n){for(;n!=null;n=n.nextSibling){var e=n.nodeType;if(e===1||e===3)break;if(e===8){if(e=n.data,e==="$"||e==="$!"||e==="$?")break;if(e==="/$")return null}}return n}function cS(n){n=n.previousSibling;for(var e=0;n;){if(n.nodeType===8){var t=n.data;if(t==="$"||t==="$!"||t==="$?"){if(e===0)return n;e--}else t==="/$"&&e++}n=n.previousSibling}return null}var Mc=Math.random().toString(36).slice(2),Vs="__reactFiber$"+Mc,xd="__reactProps$"+Mc,wi="__reactContainer$"+Mc,E_="__reactEvents$"+Mc,eL="__reactListeners$"+Mc,tL="__reactHandles$"+Mc;function ca(n){var e=n[Vs];if(e)return e;for(var t=n.parentNode;t;){if(e=t[wi]||t[Vs]){if(t=e.alternate,e.child!==null||t!==null&&t.child!==null)for(n=cS(n);n!==null;){if(t=n[Vs])return t;n=cS(n)}return e}n=t,t=n.parentNode}return null}function ah(n){return n=n[Vs]||n[wi],!n||n.tag!==5&&n.tag!==6&&n.tag!==13&&n.tag!==3?null:n}function kl(n){if(n.tag===5||n.tag===6)return n.stateNode;throw Error(X(33))}function bg(n){return n[xd]||null}var T_=[],Pl=-1;function Vo(n){return{current:n}}function $t(n){0>Pl||(n.current=T_[Pl],T_[Pl]=null,Pl--)}function Lt(n,e){Pl++,T_[Pl]=n.current,n.current=e}var Eo={},cr=Vo(Eo),Tr=Vo(!1),Sa=Eo;function nc(n,e){var t=n.type.contextTypes;if(!t)return Eo;var r=n.stateNode;if(r&&r.__reactInternalMemoizedUnmaskedChildContext===e)return r.__reactInternalMemoizedMaskedChildContext;var s={},i;for(i in t)s[i]=e[i];return r&&(n=n.stateNode,n.__reactInternalMemoizedUnmaskedChildContext=e,n.__reactInternalMemoizedMaskedChildContext=s),s}function br(n){return n=n.childContextTypes,n!=null}function wp(){$t(Tr),$t(cr)}function uS(n,e,t){if(cr.current!==Eo)throw Error(X(168));Lt(cr,e),Lt(Tr,t)}function WA(n,e,t){var r=n.stateNode;if(e=e.childContextTypes,typeof r.getChildContext!="function")return t;r=r.getChildContext();for(var s in r)if(!(s in e))throw Error(X(108,F2(n)||"Unknown",s));return tn({},t,r)}function xp(n){return n=(n=n.stateNode)&&n.__reactInternalMemoizedMergedChildContext||Eo,Sa=cr.current,Lt(cr,n),Lt(Tr,Tr.current),!0}function dS(n,e,t){var r=n.stateNode;if(!r)throw Error(X(169));t?(n=WA(n,e,Sa),r.__reactInternalMemoizedMergedChildContext=n,$t(Tr),$t(cr),Lt(cr,n)):$t(Tr),Lt(Tr,t)}var li=null,Ag=!1,fy=!1;function GA(n){li===null?li=[n]:li.push(n)}function nL(n){Ag=!0,GA(n)}function Fo(){if(!fy&&li!==null){fy=!0;var n=0,e=Tt;try{var t=li;for(Tt=1;n<t.length;n++){var r=t[n];do r=r(!0);while(r!==null)}li=null,Ag=!1}catch(s){throw li!==null&&(li=li.slice(n+1)),yA(n0,Fo),s}finally{Tt=e,fy=!1}}return null}var Dl=[],Ol=0,Ip=null,Sp=0,Xr=[],Zr=0,Ea=null,ui=1,di="";function Zo(n,e){Dl[Ol++]=Sp,Dl[Ol++]=Ip,Ip=n,Sp=e}function HA(n,e,t){Xr[Zr++]=ui,Xr[Zr++]=di,Xr[Zr++]=Ea,Ea=n;var r=ui;n=di;var s=32-_s(r)-1;r&=~(1<<s),t+=1;var i=32-_s(e)+s;if(30<i){var o=s-s%5;i=(r&(1<<o)-1).toString(32),r>>=o,s-=o,ui=1<<32-_s(e)+s|t<<s|r,di=i+n}else ui=1<<i|t<<s|r,di=n}function d0(n){n.return!==null&&(Zo(n,1),HA(n,1,0))}function h0(n){for(;n===Ip;)Ip=Dl[--Ol],Dl[Ol]=null,Sp=Dl[--Ol],Dl[Ol]=null;for(;n===Ea;)Ea=Xr[--Zr],Xr[Zr]=null,di=Xr[--Zr],Xr[Zr]=null,ui=Xr[--Zr],Xr[Zr]=null}var Fr=null,Vr=null,Ht=!1,gs=null;function QA(n,e){var t=ts(5,null,null,0);t.elementType="DELETED",t.stateNode=e,t.return=n,e=n.deletions,e===null?(n.deletions=[t],n.flags|=16):e.push(t)}function hS(n,e){switch(n.tag){case 5:var t=n.type;return e=e.nodeType!==1||t.toLowerCase()!==e.nodeName.toLowerCase()?null:e,e!==null?(n.stateNode=e,Fr=n,Vr=ho(e.firstChild),!0):!1;case 6:return e=n.pendingProps===""||e.nodeType!==3?null:e,e!==null?(n.stateNode=e,Fr=n,Vr=null,!0):!1;case 13:return e=e.nodeType!==8?null:e,e!==null?(t=Ea!==null?{id:ui,overflow:di}:null,n.memoizedState={dehydrated:e,treeContext:t,retryLane:1073741824},t=ts(18,null,null,0),t.stateNode=e,t.return=n,n.child=t,Fr=n,Vr=null,!0):!1;default:return!1}}function b_(n){return(n.mode&1)!==0&&(n.flags&128)===0}function A_(n){if(Ht){var e=Vr;if(e){var t=e;if(!hS(n,e)){if(b_(n))throw Error(X(418));e=ho(t.nextSibling);var r=Fr;e&&hS(n,e)?QA(r,t):(n.flags=n.flags&-4097|2,Ht=!1,Fr=n)}}else{if(b_(n))throw Error(X(418));n.flags=n.flags&-4097|2,Ht=!1,Fr=n}}}function fS(n){for(n=n.return;n!==null&&n.tag!==5&&n.tag!==3&&n.tag!==13;)n=n.return;Fr=n}function df(n){if(n!==Fr)return!1;if(!Ht)return fS(n),Ht=!0,!1;var e;if((e=n.tag!==3)&&!(e=n.tag!==5)&&(e=n.type,e=e!=="head"&&e!=="body"&&!I_(n.type,n.memoizedProps)),e&&(e=Vr)){if(b_(n))throw KA(),Error(X(418));for(;e;)QA(n,e),e=ho(e.nextSibling)}if(fS(n),n.tag===13){if(n=n.memoizedState,n=n!==null?n.dehydrated:null,!n)throw Error(X(317));e:{for(n=n.nextSibling,e=0;n;){if(n.nodeType===8){var t=n.data;if(t==="/$"){if(e===0){Vr=ho(n.nextSibling);break e}e--}else t!=="$"&&t!=="$!"&&t!=="$?"||e++}n=n.nextSibling}Vr=null}}else Vr=Fr?ho(n.stateNode.nextSibling):null;return!0}function KA(){for(var n=Vr;n;)n=ho(n.nextSibling)}function rc(){Vr=Fr=null,Ht=!1}function f0(n){gs===null?gs=[n]:gs.push(n)}var rL=Ni.ReactCurrentBatchConfig;function hu(n,e,t){if(n=t.ref,n!==null&&typeof n!="function"&&typeof n!="object"){if(t._owner){if(t=t._owner,t){if(t.tag!==1)throw Error(X(309));var r=t.stateNode}if(!r)throw Error(X(147,n));var s=r,i=""+n;return e!==null&&e.ref!==null&&typeof e.ref=="function"&&e.ref._stringRef===i?e.ref:(e=function(o){var a=s.refs;o===null?delete a[i]:a[i]=o},e._stringRef=i,e)}if(typeof n!="string")throw Error(X(284));if(!t._owner)throw Error(X(290,n))}return n}function hf(n,e){throw n=Object.prototype.toString.call(e),Error(X(31,n==="[object Object]"?"object with keys {"+Object.keys(e).join(", ")+"}":n))}function pS(n){var e=n._init;return e(n._payload)}function YA(n){function e(E,x){if(n){var N=E.deletions;N===null?(E.deletions=[x],E.flags|=16):N.push(x)}}function t(E,x){if(!n)return null;for(;x!==null;)e(E,x),x=x.sibling;return null}function r(E,x){for(E=new Map;x!==null;)x.key!==null?E.set(x.key,x):E.set(x.index,x),x=x.sibling;return E}function s(E,x){return E=mo(E,x),E.index=0,E.sibling=null,E}function i(E,x,N){return E.index=N,n?(N=E.alternate,N!==null?(N=N.index,N<x?(E.flags|=2,x):N):(E.flags|=2,x)):(E.flags|=1048576,x)}function o(E){return n&&E.alternate===null&&(E.flags|=2),E}function a(E,x,N,P){return x===null||x.tag!==6?(x=wy(N,E.mode,P),x.return=E,x):(x=s(x,N),x.return=E,x)}function l(E,x,N,P){var $=N.type;return $===Al?h(E,x,N.props.children,P,N.key):x!==null&&(x.elementType===$||typeof $=="object"&&$!==null&&$.$$typeof===Gi&&pS($)===x.type)?(P=s(x,N.props),P.ref=hu(E,x,N),P.return=E,P):(P=qf(N.type,N.key,N.props,null,E.mode,P),P.ref=hu(E,x,N),P.return=E,P)}function u(E,x,N,P){return x===null||x.tag!==4||x.stateNode.containerInfo!==N.containerInfo||x.stateNode.implementation!==N.implementation?(x=xy(N,E.mode,P),x.return=E,x):(x=s(x,N.children||[]),x.return=E,x)}function h(E,x,N,P,$){return x===null||x.tag!==7?(x=ya(N,E.mode,P,$),x.return=E,x):(x=s(x,N),x.return=E,x)}function f(E,x,N){if(typeof x=="string"&&x!==""||typeof x=="number")return x=wy(""+x,E.mode,N),x.return=E,x;if(typeof x=="object"&&x!==null){switch(x.$$typeof){case ef:return N=qf(x.type,x.key,x.props,null,E.mode,N),N.ref=hu(E,null,x),N.return=E,N;case bl:return x=xy(x,E.mode,N),x.return=E,x;case Gi:var P=x._init;return f(E,P(x._payload),N)}if(bu(x)||au(x))return x=ya(x,E.mode,N,null),x.return=E,x;hf(E,x)}return null}function p(E,x,N,P){var $=x!==null?x.key:null;if(typeof N=="string"&&N!==""||typeof N=="number")return $!==null?null:a(E,x,""+N,P);if(typeof N=="object"&&N!==null){switch(N.$$typeof){case ef:return N.key===$?l(E,x,N,P):null;case bl:return N.key===$?u(E,x,N,P):null;case Gi:return $=N._init,p(E,x,$(N._payload),P)}if(bu(N)||au(N))return $!==null?null:h(E,x,N,P,null);hf(E,N)}return null}function y(E,x,N,P,$){if(typeof P=="string"&&P!==""||typeof P=="number")return E=E.get(N)||null,a(x,E,""+P,$);if(typeof P=="object"&&P!==null){switch(P.$$typeof){case ef:return E=E.get(P.key===null?N:P.key)||null,l(x,E,P,$);case bl:return E=E.get(P.key===null?N:P.key)||null,u(x,E,P,$);case Gi:var L=P._init;return y(E,x,N,L(P._payload),$)}if(bu(P)||au(P))return E=E.get(N)||null,h(x,E,P,$,null);hf(x,P)}return null}function w(E,x,N,P){for(var $=null,L=null,R=x,v=x=0,T=null;R!==null&&v<N.length;v++){R.index>v?(T=R,R=null):T=R.sibling;var C=p(E,R,N[v],P);if(C===null){R===null&&(R=T);break}n&&R&&C.alternate===null&&e(E,R),x=i(C,x,v),L===null?$=C:L.sibling=C,L=C,R=T}if(v===N.length)return t(E,R),Ht&&Zo(E,v),$;if(R===null){for(;v<N.length;v++)R=f(E,N[v],P),R!==null&&(x=i(R,x,v),L===null?$=R:L.sibling=R,L=R);return Ht&&Zo(E,v),$}for(R=r(E,R);v<N.length;v++)T=y(R,E,v,N[v],P),T!==null&&(n&&T.alternate!==null&&R.delete(T.key===null?v:T.key),x=i(T,x,v),L===null?$=T:L.sibling=T,L=T);return n&&R.forEach(function(A){return e(E,A)}),Ht&&Zo(E,v),$}function S(E,x,N,P){var $=au(N);if(typeof $!="function")throw Error(X(150));if(N=$.call(N),N==null)throw Error(X(151));for(var L=$=null,R=x,v=x=0,T=null,C=N.next();R!==null&&!C.done;v++,C=N.next()){R.index>v?(T=R,R=null):T=R.sibling;var A=p(E,R,C.value,P);if(A===null){R===null&&(R=T);break}n&&R&&A.alternate===null&&e(E,R),x=i(A,x,v),L===null?$=A:L.sibling=A,L=A,R=T}if(C.done)return t(E,R),Ht&&Zo(E,v),$;if(R===null){for(;!C.done;v++,C=N.next())C=f(E,C.value,P),C!==null&&(x=i(C,x,v),L===null?$=C:L.sibling=C,L=C);return Ht&&Zo(E,v),$}for(R=r(E,R);!C.done;v++,C=N.next())C=y(R,E,v,C.value,P),C!==null&&(n&&C.alternate!==null&&R.delete(C.key===null?v:C.key),x=i(C,x,v),L===null?$=C:L.sibling=C,L=C);return n&&R.forEach(function(b){return e(E,b)}),Ht&&Zo(E,v),$}function k(E,x,N,P){if(typeof N=="object"&&N!==null&&N.type===Al&&N.key===null&&(N=N.props.children),typeof N=="object"&&N!==null){switch(N.$$typeof){case ef:e:{for(var $=N.key,L=x;L!==null;){if(L.key===$){if($=N.type,$===Al){if(L.tag===7){t(E,L.sibling),x=s(L,N.props.children),x.return=E,E=x;break e}}else if(L.elementType===$||typeof $=="object"&&$!==null&&$.$$typeof===Gi&&pS($)===L.type){t(E,L.sibling),x=s(L,N.props),x.ref=hu(E,L,N),x.return=E,E=x;break e}t(E,L);break}else e(E,L);L=L.sibling}N.type===Al?(x=ya(N.props.children,E.mode,P,N.key),x.return=E,E=x):(P=qf(N.type,N.key,N.props,null,E.mode,P),P.ref=hu(E,x,N),P.return=E,E=P)}return o(E);case bl:e:{for(L=N.key;x!==null;){if(x.key===L)if(x.tag===4&&x.stateNode.containerInfo===N.containerInfo&&x.stateNode.implementation===N.implementation){t(E,x.sibling),x=s(x,N.children||[]),x.return=E,E=x;break e}else{t(E,x);break}else e(E,x);x=x.sibling}x=xy(N,E.mode,P),x.return=E,E=x}return o(E);case Gi:return L=N._init,k(E,x,L(N._payload),P)}if(bu(N))return w(E,x,N,P);if(au(N))return S(E,x,N,P);hf(E,N)}return typeof N=="string"&&N!==""||typeof N=="number"?(N=""+N,x!==null&&x.tag===6?(t(E,x.sibling),x=s(x,N),x.return=E,E=x):(t(E,x),x=wy(N,E.mode,P),x.return=E,E=x),o(E)):t(E,x)}return k}var sc=YA(!0),JA=YA(!1),Ep=Vo(null),Tp=null,Ll=null,p0=null;function g0(){p0=Ll=Tp=null}function m0(n){var e=Ep.current;$t(Ep),n._currentValue=e}function C_(n,e,t){for(;n!==null;){var r=n.alternate;if((n.childLanes&e)!==e?(n.childLanes|=e,r!==null&&(r.childLanes|=e)):r!==null&&(r.childLanes&e)!==e&&(r.childLanes|=e),n===t)break;n=n.return}}function ql(n,e){Tp=n,p0=Ll=null,n=n.dependencies,n!==null&&n.firstContext!==null&&(n.lanes&e&&(xr=!0),n.firstContext=null)}function is(n){var e=n._currentValue;if(p0!==n)if(n={context:n,memoizedValue:e,next:null},Ll===null){if(Tp===null)throw Error(X(308));Ll=n,Tp.dependencies={lanes:0,firstContext:n}}else Ll=Ll.next=n;return e}var ua=null;function y0(n){ua===null?ua=[n]:ua.push(n)}function XA(n,e,t,r){var s=e.interleaved;return s===null?(t.next=t,y0(e)):(t.next=s.next,s.next=t),e.interleaved=t,xi(n,r)}function xi(n,e){n.lanes|=e;var t=n.alternate;for(t!==null&&(t.lanes|=e),t=n,n=n.return;n!==null;)n.childLanes|=e,t=n.alternate,t!==null&&(t.childLanes|=e),t=n,n=n.return;return t.tag===3?t.stateNode:null}var Hi=!1;function _0(n){n.updateQueue={baseState:n.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function ZA(n,e){n=n.updateQueue,e.updateQueue===n&&(e.updateQueue={baseState:n.baseState,firstBaseUpdate:n.firstBaseUpdate,lastBaseUpdate:n.lastBaseUpdate,shared:n.shared,effects:n.effects})}function yi(n,e){return{eventTime:n,lane:e,tag:0,payload:null,callback:null,next:null}}function fo(n,e,t){var r=n.updateQueue;if(r===null)return null;if(r=r.shared,pt&2){var s=r.pending;return s===null?e.next=e:(e.next=s.next,s.next=e),r.pending=e,xi(n,t)}return s=r.interleaved,s===null?(e.next=e,y0(r)):(e.next=s.next,s.next=e),r.interleaved=e,xi(n,t)}function Vf(n,e,t){if(e=e.updateQueue,e!==null&&(e=e.shared,(t&4194240)!==0)){var r=e.lanes;r&=n.pendingLanes,t|=r,e.lanes=t,r0(n,t)}}function gS(n,e){var t=n.updateQueue,r=n.alternate;if(r!==null&&(r=r.updateQueue,t===r)){var s=null,i=null;if(t=t.firstBaseUpdate,t!==null){do{var o={eventTime:t.eventTime,lane:t.lane,tag:t.tag,payload:t.payload,callback:t.callback,next:null};i===null?s=i=o:i=i.next=o,t=t.next}while(t!==null);i===null?s=i=e:i=i.next=e}else s=i=e;t={baseState:r.baseState,firstBaseUpdate:s,lastBaseUpdate:i,shared:r.shared,effects:r.effects},n.updateQueue=t;return}n=t.lastBaseUpdate,n===null?t.firstBaseUpdate=e:n.next=e,t.lastBaseUpdate=e}function bp(n,e,t,r){var s=n.updateQueue;Hi=!1;var i=s.firstBaseUpdate,o=s.lastBaseUpdate,a=s.shared.pending;if(a!==null){s.shared.pending=null;var l=a,u=l.next;l.next=null,o===null?i=u:o.next=u,o=l;var h=n.alternate;h!==null&&(h=h.updateQueue,a=h.lastBaseUpdate,a!==o&&(a===null?h.firstBaseUpdate=u:a.next=u,h.lastBaseUpdate=l))}if(i!==null){var f=s.baseState;o=0,h=u=l=null,a=i;do{var p=a.lane,y=a.eventTime;if((r&p)===p){h!==null&&(h=h.next={eventTime:y,lane:0,tag:a.tag,payload:a.payload,callback:a.callback,next:null});e:{var w=n,S=a;switch(p=e,y=t,S.tag){case 1:if(w=S.payload,typeof w=="function"){f=w.call(y,f,p);break e}f=w;break e;case 3:w.flags=w.flags&-65537|128;case 0:if(w=S.payload,p=typeof w=="function"?w.call(y,f,p):w,p==null)break e;f=tn({},f,p);break e;case 2:Hi=!0}}a.callback!==null&&a.lane!==0&&(n.flags|=64,p=s.effects,p===null?s.effects=[a]:p.push(a))}else y={eventTime:y,lane:p,tag:a.tag,payload:a.payload,callback:a.callback,next:null},h===null?(u=h=y,l=f):h=h.next=y,o|=p;if(a=a.next,a===null){if(a=s.shared.pending,a===null)break;p=a,a=p.next,p.next=null,s.lastBaseUpdate=p,s.shared.pending=null}}while(1);if(h===null&&(l=f),s.baseState=l,s.firstBaseUpdate=u,s.lastBaseUpdate=h,e=s.shared.interleaved,e!==null){s=e;do o|=s.lane,s=s.next;while(s!==e)}else i===null&&(s.shared.lanes=0);ba|=o,n.lanes=o,n.memoizedState=f}}function mS(n,e,t){if(n=e.effects,e.effects=null,n!==null)for(e=0;e<n.length;e++){var r=n[e],s=r.callback;if(s!==null){if(r.callback=null,r=t,typeof s!="function")throw Error(X(191,s));s.call(r)}}}var lh={},Ws=Vo(lh),Id=Vo(lh),Sd=Vo(lh);function da(n){if(n===lh)throw Error(X(174));return n}function v0(n,e){switch(Lt(Sd,e),Lt(Id,n),Lt(Ws,lh),n=e.nodeType,n){case 9:case 11:e=(e=e.documentElement)?e.namespaceURI:l_(null,"");break;default:n=n===8?e.parentNode:e,e=n.namespaceURI||null,n=n.tagName,e=l_(e,n)}$t(Ws),Lt(Ws,e)}function ic(){$t(Ws),$t(Id),$t(Sd)}function eC(n){da(Sd.current);var e=da(Ws.current),t=l_(e,n.type);e!==t&&(Lt(Id,n),Lt(Ws,t))}function w0(n){Id.current===n&&($t(Ws),$t(Id))}var Xt=Vo(0);function Ap(n){for(var e=n;e!==null;){if(e.tag===13){var t=e.memoizedState;if(t!==null&&(t=t.dehydrated,t===null||t.data==="$?"||t.data==="$!"))return e}else if(e.tag===19&&e.memoizedProps.revealOrder!==void 0){if(e.flags&128)return e}else if(e.child!==null){e.child.return=e,e=e.child;continue}if(e===n)break;for(;e.sibling===null;){if(e.return===null||e.return===n)return null;e=e.return}e.sibling.return=e.return,e=e.sibling}return null}var py=[];function x0(){for(var n=0;n<py.length;n++)py[n]._workInProgressVersionPrimary=null;py.length=0}var Ff=Ni.ReactCurrentDispatcher,gy=Ni.ReactCurrentBatchConfig,Ta=0,en=null,Tn=null,Dn=null,Cp=!1,Bu=!1,Ed=0,sL=0;function tr(){throw Error(X(321))}function I0(n,e){if(e===null)return!1;for(var t=0;t<e.length&&t<n.length;t++)if(!Is(n[t],e[t]))return!1;return!0}function S0(n,e,t,r,s,i){if(Ta=i,en=e,e.memoizedState=null,e.updateQueue=null,e.lanes=0,Ff.current=n===null||n.memoizedState===null?lL:cL,n=t(r,s),Bu){i=0;do{if(Bu=!1,Ed=0,25<=i)throw Error(X(301));i+=1,Dn=Tn=null,e.updateQueue=null,Ff.current=uL,n=t(r,s)}while(Bu)}if(Ff.current=Rp,e=Tn!==null&&Tn.next!==null,Ta=0,Dn=Tn=en=null,Cp=!1,e)throw Error(X(300));return n}function E0(){var n=Ed!==0;return Ed=0,n}function Ds(){var n={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return Dn===null?en.memoizedState=Dn=n:Dn=Dn.next=n,Dn}function os(){if(Tn===null){var n=en.alternate;n=n!==null?n.memoizedState:null}else n=Tn.next;var e=Dn===null?en.memoizedState:Dn.next;if(e!==null)Dn=e,Tn=n;else{if(n===null)throw Error(X(310));Tn=n,n={memoizedState:Tn.memoizedState,baseState:Tn.baseState,baseQueue:Tn.baseQueue,queue:Tn.queue,next:null},Dn===null?en.memoizedState=Dn=n:Dn=Dn.next=n}return Dn}function Td(n,e){return typeof e=="function"?e(n):e}function my(n){var e=os(),t=e.queue;if(t===null)throw Error(X(311));t.lastRenderedReducer=n;var r=Tn,s=r.baseQueue,i=t.pending;if(i!==null){if(s!==null){var o=s.next;s.next=i.next,i.next=o}r.baseQueue=s=i,t.pending=null}if(s!==null){i=s.next,r=r.baseState;var a=o=null,l=null,u=i;do{var h=u.lane;if((Ta&h)===h)l!==null&&(l=l.next={lane:0,action:u.action,hasEagerState:u.hasEagerState,eagerState:u.eagerState,next:null}),r=u.hasEagerState?u.eagerState:n(r,u.action);else{var f={lane:h,action:u.action,hasEagerState:u.hasEagerState,eagerState:u.eagerState,next:null};l===null?(a=l=f,o=r):l=l.next=f,en.lanes|=h,ba|=h}u=u.next}while(u!==null&&u!==i);l===null?o=r:l.next=a,Is(r,e.memoizedState)||(xr=!0),e.memoizedState=r,e.baseState=o,e.baseQueue=l,t.lastRenderedState=r}if(n=t.interleaved,n!==null){s=n;do i=s.lane,en.lanes|=i,ba|=i,s=s.next;while(s!==n)}else s===null&&(t.lanes=0);return[e.memoizedState,t.dispatch]}function yy(n){var e=os(),t=e.queue;if(t===null)throw Error(X(311));t.lastRenderedReducer=n;var r=t.dispatch,s=t.pending,i=e.memoizedState;if(s!==null){t.pending=null;var o=s=s.next;do i=n(i,o.action),o=o.next;while(o!==s);Is(i,e.memoizedState)||(xr=!0),e.memoizedState=i,e.baseQueue===null&&(e.baseState=i),t.lastRenderedState=i}return[i,r]}function tC(){}function nC(n,e){var t=en,r=os(),s=e(),i=!Is(r.memoizedState,s);if(i&&(r.memoizedState=s,xr=!0),r=r.queue,T0(iC.bind(null,t,r,n),[n]),r.getSnapshot!==e||i||Dn!==null&&Dn.memoizedState.tag&1){if(t.flags|=2048,bd(9,sC.bind(null,t,r,s,e),void 0,null),Mn===null)throw Error(X(349));Ta&30||rC(t,e,s)}return s}function rC(n,e,t){n.flags|=16384,n={getSnapshot:e,value:t},e=en.updateQueue,e===null?(e={lastEffect:null,stores:null},en.updateQueue=e,e.stores=[n]):(t=e.stores,t===null?e.stores=[n]:t.push(n))}function sC(n,e,t,r){e.value=t,e.getSnapshot=r,oC(e)&&aC(n)}function iC(n,e,t){return t(function(){oC(e)&&aC(n)})}function oC(n){var e=n.getSnapshot;n=n.value;try{var t=e();return!Is(n,t)}catch{return!0}}function aC(n){var e=xi(n,1);e!==null&&vs(e,n,1,-1)}function yS(n){var e=Ds();return typeof n=="function"&&(n=n()),e.memoizedState=e.baseState=n,n={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:Td,lastRenderedState:n},e.queue=n,n=n.dispatch=aL.bind(null,en,n),[e.memoizedState,n]}function bd(n,e,t,r){return n={tag:n,create:e,destroy:t,deps:r,next:null},e=en.updateQueue,e===null?(e={lastEffect:null,stores:null},en.updateQueue=e,e.lastEffect=n.next=n):(t=e.lastEffect,t===null?e.lastEffect=n.next=n:(r=t.next,t.next=n,n.next=r,e.lastEffect=n)),n}function lC(){return os().memoizedState}function Uf(n,e,t,r){var s=Ds();en.flags|=n,s.memoizedState=bd(1|e,t,void 0,r===void 0?null:r)}function Cg(n,e,t,r){var s=os();r=r===void 0?null:r;var i=void 0;if(Tn!==null){var o=Tn.memoizedState;if(i=o.destroy,r!==null&&I0(r,o.deps)){s.memoizedState=bd(e,t,i,r);return}}en.flags|=n,s.memoizedState=bd(1|e,t,i,r)}function _S(n,e){return Uf(8390656,8,n,e)}function T0(n,e){return Cg(2048,8,n,e)}function cC(n,e){return Cg(4,2,n,e)}function uC(n,e){return Cg(4,4,n,e)}function dC(n,e){if(typeof e=="function")return n=n(),e(n),function(){e(null)};if(e!=null)return n=n(),e.current=n,function(){e.current=null}}function hC(n,e,t){return t=t!=null?t.concat([n]):null,Cg(4,4,dC.bind(null,e,n),t)}function b0(){}function fC(n,e){var t=os();e=e===void 0?null:e;var r=t.memoizedState;return r!==null&&e!==null&&I0(e,r[1])?r[0]:(t.memoizedState=[n,e],n)}function pC(n,e){var t=os();e=e===void 0?null:e;var r=t.memoizedState;return r!==null&&e!==null&&I0(e,r[1])?r[0]:(n=n(),t.memoizedState=[n,e],n)}function gC(n,e,t){return Ta&21?(Is(t,e)||(t=wA(),en.lanes|=t,ba|=t,n.baseState=!0),e):(n.baseState&&(n.baseState=!1,xr=!0),n.memoizedState=t)}function iL(n,e){var t=Tt;Tt=t!==0&&4>t?t:4,n(!0);var r=gy.transition;gy.transition={};try{n(!1),e()}finally{Tt=t,gy.transition=r}}function mC(){return os().memoizedState}function oL(n,e,t){var r=go(n);if(t={lane:r,action:t,hasEagerState:!1,eagerState:null,next:null},yC(n))_C(e,t);else if(t=XA(n,e,t,r),t!==null){var s=gr();vs(t,n,r,s),vC(t,e,r)}}function aL(n,e,t){var r=go(n),s={lane:r,action:t,hasEagerState:!1,eagerState:null,next:null};if(yC(n))_C(e,s);else{var i=n.alternate;if(n.lanes===0&&(i===null||i.lanes===0)&&(i=e.lastRenderedReducer,i!==null))try{var o=e.lastRenderedState,a=i(o,t);if(s.hasEagerState=!0,s.eagerState=a,Is(a,o)){var l=e.interleaved;l===null?(s.next=s,y0(e)):(s.next=l.next,l.next=s),e.interleaved=s;return}}catch{}finally{}t=XA(n,e,s,r),t!==null&&(s=gr(),vs(t,n,r,s),vC(t,e,r))}}function yC(n){var e=n.alternate;return n===en||e!==null&&e===en}function _C(n,e){Bu=Cp=!0;var t=n.pending;t===null?e.next=e:(e.next=t.next,t.next=e),n.pending=e}function vC(n,e,t){if(t&4194240){var r=e.lanes;r&=n.pendingLanes,t|=r,e.lanes=t,r0(n,t)}}var Rp={readContext:is,useCallback:tr,useContext:tr,useEffect:tr,useImperativeHandle:tr,useInsertionEffect:tr,useLayoutEffect:tr,useMemo:tr,useReducer:tr,useRef:tr,useState:tr,useDebugValue:tr,useDeferredValue:tr,useTransition:tr,useMutableSource:tr,useSyncExternalStore:tr,useId:tr,unstable_isNewReconciler:!1},lL={readContext:is,useCallback:function(n,e){return Ds().memoizedState=[n,e===void 0?null:e],n},useContext:is,useEffect:_S,useImperativeHandle:function(n,e,t){return t=t!=null?t.concat([n]):null,Uf(4194308,4,dC.bind(null,e,n),t)},useLayoutEffect:function(n,e){return Uf(4194308,4,n,e)},useInsertionEffect:function(n,e){return Uf(4,2,n,e)},useMemo:function(n,e){var t=Ds();return e=e===void 0?null:e,n=n(),t.memoizedState=[n,e],n},useReducer:function(n,e,t){var r=Ds();return e=t!==void 0?t(e):e,r.memoizedState=r.baseState=e,n={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:n,lastRenderedState:e},r.queue=n,n=n.dispatch=oL.bind(null,en,n),[r.memoizedState,n]},useRef:function(n){var e=Ds();return n={current:n},e.memoizedState=n},useState:yS,useDebugValue:b0,useDeferredValue:function(n){return Ds().memoizedState=n},useTransition:function(){var n=yS(!1),e=n[0];return n=iL.bind(null,n[1]),Ds().memoizedState=n,[e,n]},useMutableSource:function(){},useSyncExternalStore:function(n,e,t){var r=en,s=Ds();if(Ht){if(t===void 0)throw Error(X(407));t=t()}else{if(t=e(),Mn===null)throw Error(X(349));Ta&30||rC(r,e,t)}s.memoizedState=t;var i={value:t,getSnapshot:e};return s.queue=i,_S(iC.bind(null,r,i,n),[n]),r.flags|=2048,bd(9,sC.bind(null,r,i,t,e),void 0,null),t},useId:function(){var n=Ds(),e=Mn.identifierPrefix;if(Ht){var t=di,r=ui;t=(r&~(1<<32-_s(r)-1)).toString(32)+t,e=":"+e+"R"+t,t=Ed++,0<t&&(e+="H"+t.toString(32)),e+=":"}else t=sL++,e=":"+e+"r"+t.toString(32)+":";return n.memoizedState=e},unstable_isNewReconciler:!1},cL={readContext:is,useCallback:fC,useContext:is,useEffect:T0,useImperativeHandle:hC,useInsertionEffect:cC,useLayoutEffect:uC,useMemo:pC,useReducer:my,useRef:lC,useState:function(){return my(Td)},useDebugValue:b0,useDeferredValue:function(n){var e=os();return gC(e,Tn.memoizedState,n)},useTransition:function(){var n=my(Td)[0],e=os().memoizedState;return[n,e]},useMutableSource:tC,useSyncExternalStore:nC,useId:mC,unstable_isNewReconciler:!1},uL={readContext:is,useCallback:fC,useContext:is,useEffect:T0,useImperativeHandle:hC,useInsertionEffect:cC,useLayoutEffect:uC,useMemo:pC,useReducer:yy,useRef:lC,useState:function(){return yy(Td)},useDebugValue:b0,useDeferredValue:function(n){var e=os();return Tn===null?e.memoizedState=n:gC(e,Tn.memoizedState,n)},useTransition:function(){var n=yy(Td)[0],e=os().memoizedState;return[n,e]},useMutableSource:tC,useSyncExternalStore:nC,useId:mC,unstable_isNewReconciler:!1};function hs(n,e){if(n&&n.defaultProps){e=tn({},e),n=n.defaultProps;for(var t in n)e[t]===void 0&&(e[t]=n[t]);return e}return e}function R_(n,e,t,r){e=n.memoizedState,t=t(r,e),t=t==null?e:tn({},e,t),n.memoizedState=t,n.lanes===0&&(n.updateQueue.baseState=t)}var Rg={isMounted:function(n){return(n=n._reactInternals)?Ga(n)===n:!1},enqueueSetState:function(n,e,t){n=n._reactInternals;var r=gr(),s=go(n),i=yi(r,s);i.payload=e,t!=null&&(i.callback=t),e=fo(n,i,s),e!==null&&(vs(e,n,s,r),Vf(e,n,s))},enqueueReplaceState:function(n,e,t){n=n._reactInternals;var r=gr(),s=go(n),i=yi(r,s);i.tag=1,i.payload=e,t!=null&&(i.callback=t),e=fo(n,i,s),e!==null&&(vs(e,n,s,r),Vf(e,n,s))},enqueueForceUpdate:function(n,e){n=n._reactInternals;var t=gr(),r=go(n),s=yi(t,r);s.tag=2,e!=null&&(s.callback=e),e=fo(n,s,r),e!==null&&(vs(e,n,r,t),Vf(e,n,r))}};function vS(n,e,t,r,s,i,o){return n=n.stateNode,typeof n.shouldComponentUpdate=="function"?n.shouldComponentUpdate(r,i,o):e.prototype&&e.prototype.isPureReactComponent?!_d(t,r)||!_d(s,i):!0}function wC(n,e,t){var r=!1,s=Eo,i=e.contextType;return typeof i=="object"&&i!==null?i=is(i):(s=br(e)?Sa:cr.current,r=e.contextTypes,i=(r=r!=null)?nc(n,s):Eo),e=new e(t,i),n.memoizedState=e.state!==null&&e.state!==void 0?e.state:null,e.updater=Rg,n.stateNode=e,e._reactInternals=n,r&&(n=n.stateNode,n.__reactInternalMemoizedUnmaskedChildContext=s,n.__reactInternalMemoizedMaskedChildContext=i),e}function wS(n,e,t,r){n=e.state,typeof e.componentWillReceiveProps=="function"&&e.componentWillReceiveProps(t,r),typeof e.UNSAFE_componentWillReceiveProps=="function"&&e.UNSAFE_componentWillReceiveProps(t,r),e.state!==n&&Rg.enqueueReplaceState(e,e.state,null)}function N_(n,e,t,r){var s=n.stateNode;s.props=t,s.state=n.memoizedState,s.refs={},_0(n);var i=e.contextType;typeof i=="object"&&i!==null?s.context=is(i):(i=br(e)?Sa:cr.current,s.context=nc(n,i)),s.state=n.memoizedState,i=e.getDerivedStateFromProps,typeof i=="function"&&(R_(n,e,i,t),s.state=n.memoizedState),typeof e.getDerivedStateFromProps=="function"||typeof s.getSnapshotBeforeUpdate=="function"||typeof s.UNSAFE_componentWillMount!="function"&&typeof s.componentWillMount!="function"||(e=s.state,typeof s.componentWillMount=="function"&&s.componentWillMount(),typeof s.UNSAFE_componentWillMount=="function"&&s.UNSAFE_componentWillMount(),e!==s.state&&Rg.enqueueReplaceState(s,s.state,null),bp(n,t,s,r),s.state=n.memoizedState),typeof s.componentDidMount=="function"&&(n.flags|=4194308)}function oc(n,e){try{var t="",r=e;do t+=V2(r),r=r.return;while(r);var s=t}catch(i){s=`
Error generating stack: `+i.message+`
`+i.stack}return{value:n,source:e,stack:s,digest:null}}function _y(n,e,t){return{value:n,source:null,stack:t??null,digest:e??null}}function k_(n,e){try{console.error(e.value)}catch(t){setTimeout(function(){throw t})}}var dL=typeof WeakMap=="function"?WeakMap:Map;function xC(n,e,t){t=yi(-1,t),t.tag=3,t.payload={element:null};var r=e.value;return t.callback=function(){kp||(kp=!0,$_=r),k_(n,e)},t}function IC(n,e,t){t=yi(-1,t),t.tag=3;var r=n.type.getDerivedStateFromError;if(typeof r=="function"){var s=e.value;t.payload=function(){return r(s)},t.callback=function(){k_(n,e)}}var i=n.stateNode;return i!==null&&typeof i.componentDidCatch=="function"&&(t.callback=function(){k_(n,e),typeof r!="function"&&(po===null?po=new Set([this]):po.add(this));var o=e.stack;this.componentDidCatch(e.value,{componentStack:o!==null?o:""})}),t}function xS(n,e,t){var r=n.pingCache;if(r===null){r=n.pingCache=new dL;var s=new Set;r.set(e,s)}else s=r.get(e),s===void 0&&(s=new Set,r.set(e,s));s.has(t)||(s.add(t),n=TL.bind(null,n,e,t),e.then(n,n))}function IS(n){do{var e;if((e=n.tag===13)&&(e=n.memoizedState,e=e!==null?e.dehydrated!==null:!0),e)return n;n=n.return}while(n!==null);return null}function SS(n,e,t,r,s){return n.mode&1?(n.flags|=65536,n.lanes=s,n):(n===e?n.flags|=65536:(n.flags|=128,t.flags|=131072,t.flags&=-52805,t.tag===1&&(t.alternate===null?t.tag=17:(e=yi(-1,1),e.tag=2,fo(t,e,1))),t.lanes|=1),n)}var hL=Ni.ReactCurrentOwner,xr=!1;function fr(n,e,t,r){e.child=n===null?JA(e,null,t,r):sc(e,n.child,t,r)}function ES(n,e,t,r,s){t=t.render;var i=e.ref;return ql(e,s),r=S0(n,e,t,r,i,s),t=E0(),n!==null&&!xr?(e.updateQueue=n.updateQueue,e.flags&=-2053,n.lanes&=~s,Ii(n,e,s)):(Ht&&t&&d0(e),e.flags|=1,fr(n,e,r,s),e.child)}function TS(n,e,t,r,s){if(n===null){var i=t.type;return typeof i=="function"&&!O0(i)&&i.defaultProps===void 0&&t.compare===null&&t.defaultProps===void 0?(e.tag=15,e.type=i,SC(n,e,i,r,s)):(n=qf(t.type,null,r,e,e.mode,s),n.ref=e.ref,n.return=e,e.child=n)}if(i=n.child,!(n.lanes&s)){var o=i.memoizedProps;if(t=t.compare,t=t!==null?t:_d,t(o,r)&&n.ref===e.ref)return Ii(n,e,s)}return e.flags|=1,n=mo(i,r),n.ref=e.ref,n.return=e,e.child=n}function SC(n,e,t,r,s){if(n!==null){var i=n.memoizedProps;if(_d(i,r)&&n.ref===e.ref)if(xr=!1,e.pendingProps=r=i,(n.lanes&s)!==0)n.flags&131072&&(xr=!0);else return e.lanes=n.lanes,Ii(n,e,s)}return P_(n,e,t,r,s)}function EC(n,e,t){var r=e.pendingProps,s=r.children,i=n!==null?n.memoizedState:null;if(r.mode==="hidden")if(!(e.mode&1))e.memoizedState={baseLanes:0,cachePool:null,transitions:null},Lt(jl,Dr),Dr|=t;else{if(!(t&1073741824))return n=i!==null?i.baseLanes|t:t,e.lanes=e.childLanes=1073741824,e.memoizedState={baseLanes:n,cachePool:null,transitions:null},e.updateQueue=null,Lt(jl,Dr),Dr|=n,null;e.memoizedState={baseLanes:0,cachePool:null,transitions:null},r=i!==null?i.baseLanes:t,Lt(jl,Dr),Dr|=r}else i!==null?(r=i.baseLanes|t,e.memoizedState=null):r=t,Lt(jl,Dr),Dr|=r;return fr(n,e,s,t),e.child}function TC(n,e){var t=e.ref;(n===null&&t!==null||n!==null&&n.ref!==t)&&(e.flags|=512,e.flags|=2097152)}function P_(n,e,t,r,s){var i=br(t)?Sa:cr.current;return i=nc(e,i),ql(e,s),t=S0(n,e,t,r,i,s),r=E0(),n!==null&&!xr?(e.updateQueue=n.updateQueue,e.flags&=-2053,n.lanes&=~s,Ii(n,e,s)):(Ht&&r&&d0(e),e.flags|=1,fr(n,e,t,s),e.child)}function bS(n,e,t,r,s){if(br(t)){var i=!0;xp(e)}else i=!1;if(ql(e,s),e.stateNode===null)$f(n,e),wC(e,t,r),N_(e,t,r,s),r=!0;else if(n===null){var o=e.stateNode,a=e.memoizedProps;o.props=a;var l=o.context,u=t.contextType;typeof u=="object"&&u!==null?u=is(u):(u=br(t)?Sa:cr.current,u=nc(e,u));var h=t.getDerivedStateFromProps,f=typeof h=="function"||typeof o.getSnapshotBeforeUpdate=="function";f||typeof o.UNSAFE_componentWillReceiveProps!="function"&&typeof o.componentWillReceiveProps!="function"||(a!==r||l!==u)&&wS(e,o,r,u),Hi=!1;var p=e.memoizedState;o.state=p,bp(e,r,o,s),l=e.memoizedState,a!==r||p!==l||Tr.current||Hi?(typeof h=="function"&&(R_(e,t,h,r),l=e.memoizedState),(a=Hi||vS(e,t,a,r,p,l,u))?(f||typeof o.UNSAFE_componentWillMount!="function"&&typeof o.componentWillMount!="function"||(typeof o.componentWillMount=="function"&&o.componentWillMount(),typeof o.UNSAFE_componentWillMount=="function"&&o.UNSAFE_componentWillMount()),typeof o.componentDidMount=="function"&&(e.flags|=4194308)):(typeof o.componentDidMount=="function"&&(e.flags|=4194308),e.memoizedProps=r,e.memoizedState=l),o.props=r,o.state=l,o.context=u,r=a):(typeof o.componentDidMount=="function"&&(e.flags|=4194308),r=!1)}else{o=e.stateNode,ZA(n,e),a=e.memoizedProps,u=e.type===e.elementType?a:hs(e.type,a),o.props=u,f=e.pendingProps,p=o.context,l=t.contextType,typeof l=="object"&&l!==null?l=is(l):(l=br(t)?Sa:cr.current,l=nc(e,l));var y=t.getDerivedStateFromProps;(h=typeof y=="function"||typeof o.getSnapshotBeforeUpdate=="function")||typeof o.UNSAFE_componentWillReceiveProps!="function"&&typeof o.componentWillReceiveProps!="function"||(a!==f||p!==l)&&wS(e,o,r,l),Hi=!1,p=e.memoizedState,o.state=p,bp(e,r,o,s);var w=e.memoizedState;a!==f||p!==w||Tr.current||Hi?(typeof y=="function"&&(R_(e,t,y,r),w=e.memoizedState),(u=Hi||vS(e,t,u,r,p,w,l)||!1)?(h||typeof o.UNSAFE_componentWillUpdate!="function"&&typeof o.componentWillUpdate!="function"||(typeof o.componentWillUpdate=="function"&&o.componentWillUpdate(r,w,l),typeof o.UNSAFE_componentWillUpdate=="function"&&o.UNSAFE_componentWillUpdate(r,w,l)),typeof o.componentDidUpdate=="function"&&(e.flags|=4),typeof o.getSnapshotBeforeUpdate=="function"&&(e.flags|=1024)):(typeof o.componentDidUpdate!="function"||a===n.memoizedProps&&p===n.memoizedState||(e.flags|=4),typeof o.getSnapshotBeforeUpdate!="function"||a===n.memoizedProps&&p===n.memoizedState||(e.flags|=1024),e.memoizedProps=r,e.memoizedState=w),o.props=r,o.state=w,o.context=l,r=u):(typeof o.componentDidUpdate!="function"||a===n.memoizedProps&&p===n.memoizedState||(e.flags|=4),typeof o.getSnapshotBeforeUpdate!="function"||a===n.memoizedProps&&p===n.memoizedState||(e.flags|=1024),r=!1)}return D_(n,e,t,r,i,s)}function D_(n,e,t,r,s,i){TC(n,e);var o=(e.flags&128)!==0;if(!r&&!o)return s&&dS(e,t,!1),Ii(n,e,i);r=e.stateNode,hL.current=e;var a=o&&typeof t.getDerivedStateFromError!="function"?null:r.render();return e.flags|=1,n!==null&&o?(e.child=sc(e,n.child,null,i),e.child=sc(e,null,a,i)):fr(n,e,a,i),e.memoizedState=r.state,s&&dS(e,t,!0),e.child}function bC(n){var e=n.stateNode;e.pendingContext?uS(n,e.pendingContext,e.pendingContext!==e.context):e.context&&uS(n,e.context,!1),v0(n,e.containerInfo)}function AS(n,e,t,r,s){return rc(),f0(s),e.flags|=256,fr(n,e,t,r),e.child}var O_={dehydrated:null,treeContext:null,retryLane:0};function L_(n){return{baseLanes:n,cachePool:null,transitions:null}}function AC(n,e,t){var r=e.pendingProps,s=Xt.current,i=!1,o=(e.flags&128)!==0,a;if((a=o)||(a=n!==null&&n.memoizedState===null?!1:(s&2)!==0),a?(i=!0,e.flags&=-129):(n===null||n.memoizedState!==null)&&(s|=1),Lt(Xt,s&1),n===null)return A_(e),n=e.memoizedState,n!==null&&(n=n.dehydrated,n!==null)?(e.mode&1?n.data==="$!"?e.lanes=8:e.lanes=1073741824:e.lanes=1,null):(o=r.children,n=r.fallback,i?(r=e.mode,i=e.child,o={mode:"hidden",children:o},!(r&1)&&i!==null?(i.childLanes=0,i.pendingProps=o):i=Pg(o,r,0,null),n=ya(n,r,t,null),i.return=e,n.return=e,i.sibling=n,e.child=i,e.child.memoizedState=L_(t),e.memoizedState=O_,n):A0(e,o));if(s=n.memoizedState,s!==null&&(a=s.dehydrated,a!==null))return fL(n,e,o,r,a,s,t);if(i){i=r.fallback,o=e.mode,s=n.child,a=s.sibling;var l={mode:"hidden",children:r.children};return!(o&1)&&e.child!==s?(r=e.child,r.childLanes=0,r.pendingProps=l,e.deletions=null):(r=mo(s,l),r.subtreeFlags=s.subtreeFlags&14680064),a!==null?i=mo(a,i):(i=ya(i,o,t,null),i.flags|=2),i.return=e,r.return=e,r.sibling=i,e.child=r,r=i,i=e.child,o=n.child.memoizedState,o=o===null?L_(t):{baseLanes:o.baseLanes|t,cachePool:null,transitions:o.transitions},i.memoizedState=o,i.childLanes=n.childLanes&~t,e.memoizedState=O_,r}return i=n.child,n=i.sibling,r=mo(i,{mode:"visible",children:r.children}),!(e.mode&1)&&(r.lanes=t),r.return=e,r.sibling=null,n!==null&&(t=e.deletions,t===null?(e.deletions=[n],e.flags|=16):t.push(n)),e.child=r,e.memoizedState=null,r}function A0(n,e){return e=Pg({mode:"visible",children:e},n.mode,0,null),e.return=n,n.child=e}function ff(n,e,t,r){return r!==null&&f0(r),sc(e,n.child,null,t),n=A0(e,e.pendingProps.children),n.flags|=2,e.memoizedState=null,n}function fL(n,e,t,r,s,i,o){if(t)return e.flags&256?(e.flags&=-257,r=_y(Error(X(422))),ff(n,e,o,r)):e.memoizedState!==null?(e.child=n.child,e.flags|=128,null):(i=r.fallback,s=e.mode,r=Pg({mode:"visible",children:r.children},s,0,null),i=ya(i,s,o,null),i.flags|=2,r.return=e,i.return=e,r.sibling=i,e.child=r,e.mode&1&&sc(e,n.child,null,o),e.child.memoizedState=L_(o),e.memoizedState=O_,i);if(!(e.mode&1))return ff(n,e,o,null);if(s.data==="$!"){if(r=s.nextSibling&&s.nextSibling.dataset,r)var a=r.dgst;return r=a,i=Error(X(419)),r=_y(i,r,void 0),ff(n,e,o,r)}if(a=(o&n.childLanes)!==0,xr||a){if(r=Mn,r!==null){switch(o&-o){case 4:s=2;break;case 16:s=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:s=32;break;case 536870912:s=268435456;break;default:s=0}s=s&(r.suspendedLanes|o)?0:s,s!==0&&s!==i.retryLane&&(i.retryLane=s,xi(n,s),vs(r,n,s,-1))}return D0(),r=_y(Error(X(421))),ff(n,e,o,r)}return s.data==="$?"?(e.flags|=128,e.child=n.child,e=bL.bind(null,n),s._reactRetry=e,null):(n=i.treeContext,Vr=ho(s.nextSibling),Fr=e,Ht=!0,gs=null,n!==null&&(Xr[Zr++]=ui,Xr[Zr++]=di,Xr[Zr++]=Ea,ui=n.id,di=n.overflow,Ea=e),e=A0(e,r.children),e.flags|=4096,e)}function CS(n,e,t){n.lanes|=e;var r=n.alternate;r!==null&&(r.lanes|=e),C_(n.return,e,t)}function vy(n,e,t,r,s){var i=n.memoizedState;i===null?n.memoizedState={isBackwards:e,rendering:null,renderingStartTime:0,last:r,tail:t,tailMode:s}:(i.isBackwards=e,i.rendering=null,i.renderingStartTime=0,i.last=r,i.tail=t,i.tailMode=s)}function CC(n,e,t){var r=e.pendingProps,s=r.revealOrder,i=r.tail;if(fr(n,e,r.children,t),r=Xt.current,r&2)r=r&1|2,e.flags|=128;else{if(n!==null&&n.flags&128)e:for(n=e.child;n!==null;){if(n.tag===13)n.memoizedState!==null&&CS(n,t,e);else if(n.tag===19)CS(n,t,e);else if(n.child!==null){n.child.return=n,n=n.child;continue}if(n===e)break e;for(;n.sibling===null;){if(n.return===null||n.return===e)break e;n=n.return}n.sibling.return=n.return,n=n.sibling}r&=1}if(Lt(Xt,r),!(e.mode&1))e.memoizedState=null;else switch(s){case"forwards":for(t=e.child,s=null;t!==null;)n=t.alternate,n!==null&&Ap(n)===null&&(s=t),t=t.sibling;t=s,t===null?(s=e.child,e.child=null):(s=t.sibling,t.sibling=null),vy(e,!1,s,t,i);break;case"backwards":for(t=null,s=e.child,e.child=null;s!==null;){if(n=s.alternate,n!==null&&Ap(n)===null){e.child=s;break}n=s.sibling,s.sibling=t,t=s,s=n}vy(e,!0,t,null,i);break;case"together":vy(e,!1,null,null,void 0);break;default:e.memoizedState=null}return e.child}function $f(n,e){!(e.mode&1)&&n!==null&&(n.alternate=null,e.alternate=null,e.flags|=2)}function Ii(n,e,t){if(n!==null&&(e.dependencies=n.dependencies),ba|=e.lanes,!(t&e.childLanes))return null;if(n!==null&&e.child!==n.child)throw Error(X(153));if(e.child!==null){for(n=e.child,t=mo(n,n.pendingProps),e.child=t,t.return=e;n.sibling!==null;)n=n.sibling,t=t.sibling=mo(n,n.pendingProps),t.return=e;t.sibling=null}return e.child}function pL(n,e,t){switch(e.tag){case 3:bC(e),rc();break;case 5:eC(e);break;case 1:br(e.type)&&xp(e);break;case 4:v0(e,e.stateNode.containerInfo);break;case 10:var r=e.type._context,s=e.memoizedProps.value;Lt(Ep,r._currentValue),r._currentValue=s;break;case 13:if(r=e.memoizedState,r!==null)return r.dehydrated!==null?(Lt(Xt,Xt.current&1),e.flags|=128,null):t&e.child.childLanes?AC(n,e,t):(Lt(Xt,Xt.current&1),n=Ii(n,e,t),n!==null?n.sibling:null);Lt(Xt,Xt.current&1);break;case 19:if(r=(t&e.childLanes)!==0,n.flags&128){if(r)return CC(n,e,t);e.flags|=128}if(s=e.memoizedState,s!==null&&(s.rendering=null,s.tail=null,s.lastEffect=null),Lt(Xt,Xt.current),r)break;return null;case 22:case 23:return e.lanes=0,EC(n,e,t)}return Ii(n,e,t)}var RC,M_,NC,kC;RC=function(n,e){for(var t=e.child;t!==null;){if(t.tag===5||t.tag===6)n.appendChild(t.stateNode);else if(t.tag!==4&&t.child!==null){t.child.return=t,t=t.child;continue}if(t===e)break;for(;t.sibling===null;){if(t.return===null||t.return===e)return;t=t.return}t.sibling.return=t.return,t=t.sibling}};M_=function(){};NC=function(n,e,t,r){var s=n.memoizedProps;if(s!==r){n=e.stateNode,da(Ws.current);var i=null;switch(t){case"input":s=s_(n,s),r=s_(n,r),i=[];break;case"select":s=tn({},s,{value:void 0}),r=tn({},r,{value:void 0}),i=[];break;case"textarea":s=a_(n,s),r=a_(n,r),i=[];break;default:typeof s.onClick!="function"&&typeof r.onClick=="function"&&(n.onclick=vp)}c_(t,r);var o;t=null;for(u in s)if(!r.hasOwnProperty(u)&&s.hasOwnProperty(u)&&s[u]!=null)if(u==="style"){var a=s[u];for(o in a)a.hasOwnProperty(o)&&(t||(t={}),t[o]="")}else u!=="dangerouslySetInnerHTML"&&u!=="children"&&u!=="suppressContentEditableWarning"&&u!=="suppressHydrationWarning"&&u!=="autoFocus"&&(dd.hasOwnProperty(u)?i||(i=[]):(i=i||[]).push(u,null));for(u in r){var l=r[u];if(a=s!=null?s[u]:void 0,r.hasOwnProperty(u)&&l!==a&&(l!=null||a!=null))if(u==="style")if(a){for(o in a)!a.hasOwnProperty(o)||l&&l.hasOwnProperty(o)||(t||(t={}),t[o]="");for(o in l)l.hasOwnProperty(o)&&a[o]!==l[o]&&(t||(t={}),t[o]=l[o])}else t||(i||(i=[]),i.push(u,t)),t=l;else u==="dangerouslySetInnerHTML"?(l=l?l.__html:void 0,a=a?a.__html:void 0,l!=null&&a!==l&&(i=i||[]).push(u,l)):u==="children"?typeof l!="string"&&typeof l!="number"||(i=i||[]).push(u,""+l):u!=="suppressContentEditableWarning"&&u!=="suppressHydrationWarning"&&(dd.hasOwnProperty(u)?(l!=null&&u==="onScroll"&&Ft("scroll",n),i||a===l||(i=[])):(i=i||[]).push(u,l))}t&&(i=i||[]).push("style",t);var u=i;(e.updateQueue=u)&&(e.flags|=4)}};kC=function(n,e,t,r){t!==r&&(e.flags|=4)};function fu(n,e){if(!Ht)switch(n.tailMode){case"hidden":e=n.tail;for(var t=null;e!==null;)e.alternate!==null&&(t=e),e=e.sibling;t===null?n.tail=null:t.sibling=null;break;case"collapsed":t=n.tail;for(var r=null;t!==null;)t.alternate!==null&&(r=t),t=t.sibling;r===null?e||n.tail===null?n.tail=null:n.tail.sibling=null:r.sibling=null}}function nr(n){var e=n.alternate!==null&&n.alternate.child===n.child,t=0,r=0;if(e)for(var s=n.child;s!==null;)t|=s.lanes|s.childLanes,r|=s.subtreeFlags&14680064,r|=s.flags&14680064,s.return=n,s=s.sibling;else for(s=n.child;s!==null;)t|=s.lanes|s.childLanes,r|=s.subtreeFlags,r|=s.flags,s.return=n,s=s.sibling;return n.subtreeFlags|=r,n.childLanes=t,e}function gL(n,e,t){var r=e.pendingProps;switch(h0(e),e.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return nr(e),null;case 1:return br(e.type)&&wp(),nr(e),null;case 3:return r=e.stateNode,ic(),$t(Tr),$t(cr),x0(),r.pendingContext&&(r.context=r.pendingContext,r.pendingContext=null),(n===null||n.child===null)&&(df(e)?e.flags|=4:n===null||n.memoizedState.isDehydrated&&!(e.flags&256)||(e.flags|=1024,gs!==null&&(q_(gs),gs=null))),M_(n,e),nr(e),null;case 5:w0(e);var s=da(Sd.current);if(t=e.type,n!==null&&e.stateNode!=null)NC(n,e,t,r,s),n.ref!==e.ref&&(e.flags|=512,e.flags|=2097152);else{if(!r){if(e.stateNode===null)throw Error(X(166));return nr(e),null}if(n=da(Ws.current),df(e)){r=e.stateNode,t=e.type;var i=e.memoizedProps;switch(r[Vs]=e,r[xd]=i,n=(e.mode&1)!==0,t){case"dialog":Ft("cancel",r),Ft("close",r);break;case"iframe":case"object":case"embed":Ft("load",r);break;case"video":case"audio":for(s=0;s<Cu.length;s++)Ft(Cu[s],r);break;case"source":Ft("error",r);break;case"img":case"image":case"link":Ft("error",r),Ft("load",r);break;case"details":Ft("toggle",r);break;case"input":jI(r,i),Ft("invalid",r);break;case"select":r._wrapperState={wasMultiple:!!i.multiple},Ft("invalid",r);break;case"textarea":FI(r,i),Ft("invalid",r)}c_(t,i),s=null;for(var o in i)if(i.hasOwnProperty(o)){var a=i[o];o==="children"?typeof a=="string"?r.textContent!==a&&(i.suppressHydrationWarning!==!0&&uf(r.textContent,a,n),s=["children",a]):typeof a=="number"&&r.textContent!==""+a&&(i.suppressHydrationWarning!==!0&&uf(r.textContent,a,n),s=["children",""+a]):dd.hasOwnProperty(o)&&a!=null&&o==="onScroll"&&Ft("scroll",r)}switch(t){case"input":tf(r),VI(r,i,!0);break;case"textarea":tf(r),UI(r);break;case"select":case"option":break;default:typeof i.onClick=="function"&&(r.onclick=vp)}r=s,e.updateQueue=r,r!==null&&(e.flags|=4)}else{o=s.nodeType===9?s:s.ownerDocument,n==="http://www.w3.org/1999/xhtml"&&(n=iA(t)),n==="http://www.w3.org/1999/xhtml"?t==="script"?(n=o.createElement("div"),n.innerHTML="<script><\/script>",n=n.removeChild(n.firstChild)):typeof r.is=="string"?n=o.createElement(t,{is:r.is}):(n=o.createElement(t),t==="select"&&(o=n,r.multiple?o.multiple=!0:r.size&&(o.size=r.size))):n=o.createElementNS(n,t),n[Vs]=e,n[xd]=r,RC(n,e,!1,!1),e.stateNode=n;e:{switch(o=u_(t,r),t){case"dialog":Ft("cancel",n),Ft("close",n),s=r;break;case"iframe":case"object":case"embed":Ft("load",n),s=r;break;case"video":case"audio":for(s=0;s<Cu.length;s++)Ft(Cu[s],n);s=r;break;case"source":Ft("error",n),s=r;break;case"img":case"image":case"link":Ft("error",n),Ft("load",n),s=r;break;case"details":Ft("toggle",n),s=r;break;case"input":jI(n,r),s=s_(n,r),Ft("invalid",n);break;case"option":s=r;break;case"select":n._wrapperState={wasMultiple:!!r.multiple},s=tn({},r,{value:void 0}),Ft("invalid",n);break;case"textarea":FI(n,r),s=a_(n,r),Ft("invalid",n);break;default:s=r}c_(t,s),a=s;for(i in a)if(a.hasOwnProperty(i)){var l=a[i];i==="style"?lA(n,l):i==="dangerouslySetInnerHTML"?(l=l?l.__html:void 0,l!=null&&oA(n,l)):i==="children"?typeof l=="string"?(t!=="textarea"||l!=="")&&hd(n,l):typeof l=="number"&&hd(n,""+l):i!=="suppressContentEditableWarning"&&i!=="suppressHydrationWarning"&&i!=="autoFocus"&&(dd.hasOwnProperty(i)?l!=null&&i==="onScroll"&&Ft("scroll",n):l!=null&&Jv(n,i,l,o))}switch(t){case"input":tf(n),VI(n,r,!1);break;case"textarea":tf(n),UI(n);break;case"option":r.value!=null&&n.setAttribute("value",""+So(r.value));break;case"select":n.multiple=!!r.multiple,i=r.value,i!=null?Ul(n,!!r.multiple,i,!1):r.defaultValue!=null&&Ul(n,!!r.multiple,r.defaultValue,!0);break;default:typeof s.onClick=="function"&&(n.onclick=vp)}switch(t){case"button":case"input":case"select":case"textarea":r=!!r.autoFocus;break e;case"img":r=!0;break e;default:r=!1}}r&&(e.flags|=4)}e.ref!==null&&(e.flags|=512,e.flags|=2097152)}return nr(e),null;case 6:if(n&&e.stateNode!=null)kC(n,e,n.memoizedProps,r);else{if(typeof r!="string"&&e.stateNode===null)throw Error(X(166));if(t=da(Sd.current),da(Ws.current),df(e)){if(r=e.stateNode,t=e.memoizedProps,r[Vs]=e,(i=r.nodeValue!==t)&&(n=Fr,n!==null))switch(n.tag){case 3:uf(r.nodeValue,t,(n.mode&1)!==0);break;case 5:n.memoizedProps.suppressHydrationWarning!==!0&&uf(r.nodeValue,t,(n.mode&1)!==0)}i&&(e.flags|=4)}else r=(t.nodeType===9?t:t.ownerDocument).createTextNode(r),r[Vs]=e,e.stateNode=r}return nr(e),null;case 13:if($t(Xt),r=e.memoizedState,n===null||n.memoizedState!==null&&n.memoizedState.dehydrated!==null){if(Ht&&Vr!==null&&e.mode&1&&!(e.flags&128))KA(),rc(),e.flags|=98560,i=!1;else if(i=df(e),r!==null&&r.dehydrated!==null){if(n===null){if(!i)throw Error(X(318));if(i=e.memoizedState,i=i!==null?i.dehydrated:null,!i)throw Error(X(317));i[Vs]=e}else rc(),!(e.flags&128)&&(e.memoizedState=null),e.flags|=4;nr(e),i=!1}else gs!==null&&(q_(gs),gs=null),i=!0;if(!i)return e.flags&65536?e:null}return e.flags&128?(e.lanes=t,e):(r=r!==null,r!==(n!==null&&n.memoizedState!==null)&&r&&(e.child.flags|=8192,e.mode&1&&(n===null||Xt.current&1?An===0&&(An=3):D0())),e.updateQueue!==null&&(e.flags|=4),nr(e),null);case 4:return ic(),M_(n,e),n===null&&vd(e.stateNode.containerInfo),nr(e),null;case 10:return m0(e.type._context),nr(e),null;case 17:return br(e.type)&&wp(),nr(e),null;case 19:if($t(Xt),i=e.memoizedState,i===null)return nr(e),null;if(r=(e.flags&128)!==0,o=i.rendering,o===null)if(r)fu(i,!1);else{if(An!==0||n!==null&&n.flags&128)for(n=e.child;n!==null;){if(o=Ap(n),o!==null){for(e.flags|=128,fu(i,!1),r=o.updateQueue,r!==null&&(e.updateQueue=r,e.flags|=4),e.subtreeFlags=0,r=t,t=e.child;t!==null;)i=t,n=r,i.flags&=14680066,o=i.alternate,o===null?(i.childLanes=0,i.lanes=n,i.child=null,i.subtreeFlags=0,i.memoizedProps=null,i.memoizedState=null,i.updateQueue=null,i.dependencies=null,i.stateNode=null):(i.childLanes=o.childLanes,i.lanes=o.lanes,i.child=o.child,i.subtreeFlags=0,i.deletions=null,i.memoizedProps=o.memoizedProps,i.memoizedState=o.memoizedState,i.updateQueue=o.updateQueue,i.type=o.type,n=o.dependencies,i.dependencies=n===null?null:{lanes:n.lanes,firstContext:n.firstContext}),t=t.sibling;return Lt(Xt,Xt.current&1|2),e.child}n=n.sibling}i.tail!==null&&fn()>ac&&(e.flags|=128,r=!0,fu(i,!1),e.lanes=4194304)}else{if(!r)if(n=Ap(o),n!==null){if(e.flags|=128,r=!0,t=n.updateQueue,t!==null&&(e.updateQueue=t,e.flags|=4),fu(i,!0),i.tail===null&&i.tailMode==="hidden"&&!o.alternate&&!Ht)return nr(e),null}else 2*fn()-i.renderingStartTime>ac&&t!==1073741824&&(e.flags|=128,r=!0,fu(i,!1),e.lanes=4194304);i.isBackwards?(o.sibling=e.child,e.child=o):(t=i.last,t!==null?t.sibling=o:e.child=o,i.last=o)}return i.tail!==null?(e=i.tail,i.rendering=e,i.tail=e.sibling,i.renderingStartTime=fn(),e.sibling=null,t=Xt.current,Lt(Xt,r?t&1|2:t&1),e):(nr(e),null);case 22:case 23:return P0(),r=e.memoizedState!==null,n!==null&&n.memoizedState!==null!==r&&(e.flags|=8192),r&&e.mode&1?Dr&1073741824&&(nr(e),e.subtreeFlags&6&&(e.flags|=8192)):nr(e),null;case 24:return null;case 25:return null}throw Error(X(156,e.tag))}function mL(n,e){switch(h0(e),e.tag){case 1:return br(e.type)&&wp(),n=e.flags,n&65536?(e.flags=n&-65537|128,e):null;case 3:return ic(),$t(Tr),$t(cr),x0(),n=e.flags,n&65536&&!(n&128)?(e.flags=n&-65537|128,e):null;case 5:return w0(e),null;case 13:if($t(Xt),n=e.memoizedState,n!==null&&n.dehydrated!==null){if(e.alternate===null)throw Error(X(340));rc()}return n=e.flags,n&65536?(e.flags=n&-65537|128,e):null;case 19:return $t(Xt),null;case 4:return ic(),null;case 10:return m0(e.type._context),null;case 22:case 23:return P0(),null;case 24:return null;default:return null}}var pf=!1,ir=!1,yL=typeof WeakSet=="function"?WeakSet:Set,ye=null;function Ml(n,e){var t=n.ref;if(t!==null)if(typeof t=="function")try{t(null)}catch(r){an(n,e,r)}else t.current=null}function j_(n,e,t){try{t()}catch(r){an(n,e,r)}}var RS=!1;function _L(n,e){if(w_=mp,n=MA(),u0(n)){if("selectionStart"in n)var t={start:n.selectionStart,end:n.selectionEnd};else e:{t=(t=n.ownerDocument)&&t.defaultView||window;var r=t.getSelection&&t.getSelection();if(r&&r.rangeCount!==0){t=r.anchorNode;var s=r.anchorOffset,i=r.focusNode;r=r.focusOffset;try{t.nodeType,i.nodeType}catch{t=null;break e}var o=0,a=-1,l=-1,u=0,h=0,f=n,p=null;t:for(;;){for(var y;f!==t||s!==0&&f.nodeType!==3||(a=o+s),f!==i||r!==0&&f.nodeType!==3||(l=o+r),f.nodeType===3&&(o+=f.nodeValue.length),(y=f.firstChild)!==null;)p=f,f=y;for(;;){if(f===n)break t;if(p===t&&++u===s&&(a=o),p===i&&++h===r&&(l=o),(y=f.nextSibling)!==null)break;f=p,p=f.parentNode}f=y}t=a===-1||l===-1?null:{start:a,end:l}}else t=null}t=t||{start:0,end:0}}else t=null;for(x_={focusedElem:n,selectionRange:t},mp=!1,ye=e;ye!==null;)if(e=ye,n=e.child,(e.subtreeFlags&1028)!==0&&n!==null)n.return=e,ye=n;else for(;ye!==null;){e=ye;try{var w=e.alternate;if(e.flags&1024)switch(e.tag){case 0:case 11:case 15:break;case 1:if(w!==null){var S=w.memoizedProps,k=w.memoizedState,E=e.stateNode,x=E.getSnapshotBeforeUpdate(e.elementType===e.type?S:hs(e.type,S),k);E.__reactInternalSnapshotBeforeUpdate=x}break;case 3:var N=e.stateNode.containerInfo;N.nodeType===1?N.textContent="":N.nodeType===9&&N.documentElement&&N.removeChild(N.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(X(163))}}catch(P){an(e,e.return,P)}if(n=e.sibling,n!==null){n.return=e.return,ye=n;break}ye=e.return}return w=RS,RS=!1,w}function zu(n,e,t){var r=e.updateQueue;if(r=r!==null?r.lastEffect:null,r!==null){var s=r=r.next;do{if((s.tag&n)===n){var i=s.destroy;s.destroy=void 0,i!==void 0&&j_(e,t,i)}s=s.next}while(s!==r)}}function Ng(n,e){if(e=e.updateQueue,e=e!==null?e.lastEffect:null,e!==null){var t=e=e.next;do{if((t.tag&n)===n){var r=t.create;t.destroy=r()}t=t.next}while(t!==e)}}function V_(n){var e=n.ref;if(e!==null){var t=n.stateNode;switch(n.tag){case 5:n=t;break;default:n=t}typeof e=="function"?e(n):e.current=n}}function PC(n){var e=n.alternate;e!==null&&(n.alternate=null,PC(e)),n.child=null,n.deletions=null,n.sibling=null,n.tag===5&&(e=n.stateNode,e!==null&&(delete e[Vs],delete e[xd],delete e[E_],delete e[eL],delete e[tL])),n.stateNode=null,n.return=null,n.dependencies=null,n.memoizedProps=null,n.memoizedState=null,n.pendingProps=null,n.stateNode=null,n.updateQueue=null}function DC(n){return n.tag===5||n.tag===3||n.tag===4}function NS(n){e:for(;;){for(;n.sibling===null;){if(n.return===null||DC(n.return))return null;n=n.return}for(n.sibling.return=n.return,n=n.sibling;n.tag!==5&&n.tag!==6&&n.tag!==18;){if(n.flags&2||n.child===null||n.tag===4)continue e;n.child.return=n,n=n.child}if(!(n.flags&2))return n.stateNode}}function F_(n,e,t){var r=n.tag;if(r===5||r===6)n=n.stateNode,e?t.nodeType===8?t.parentNode.insertBefore(n,e):t.insertBefore(n,e):(t.nodeType===8?(e=t.parentNode,e.insertBefore(n,t)):(e=t,e.appendChild(n)),t=t._reactRootContainer,t!=null||e.onclick!==null||(e.onclick=vp));else if(r!==4&&(n=n.child,n!==null))for(F_(n,e,t),n=n.sibling;n!==null;)F_(n,e,t),n=n.sibling}function U_(n,e,t){var r=n.tag;if(r===5||r===6)n=n.stateNode,e?t.insertBefore(n,e):t.appendChild(n);else if(r!==4&&(n=n.child,n!==null))for(U_(n,e,t),n=n.sibling;n!==null;)U_(n,e,t),n=n.sibling}var Wn=null,fs=!1;function $i(n,e,t){for(t=t.child;t!==null;)OC(n,e,t),t=t.sibling}function OC(n,e,t){if(qs&&typeof qs.onCommitFiberUnmount=="function")try{qs.onCommitFiberUnmount(Ig,t)}catch{}switch(t.tag){case 5:ir||Ml(t,e);case 6:var r=Wn,s=fs;Wn=null,$i(n,e,t),Wn=r,fs=s,Wn!==null&&(fs?(n=Wn,t=t.stateNode,n.nodeType===8?n.parentNode.removeChild(t):n.removeChild(t)):Wn.removeChild(t.stateNode));break;case 18:Wn!==null&&(fs?(n=Wn,t=t.stateNode,n.nodeType===8?hy(n.parentNode,t):n.nodeType===1&&hy(n,t),md(n)):hy(Wn,t.stateNode));break;case 4:r=Wn,s=fs,Wn=t.stateNode.containerInfo,fs=!0,$i(n,e,t),Wn=r,fs=s;break;case 0:case 11:case 14:case 15:if(!ir&&(r=t.updateQueue,r!==null&&(r=r.lastEffect,r!==null))){s=r=r.next;do{var i=s,o=i.destroy;i=i.tag,o!==void 0&&(i&2||i&4)&&j_(t,e,o),s=s.next}while(s!==r)}$i(n,e,t);break;case 1:if(!ir&&(Ml(t,e),r=t.stateNode,typeof r.componentWillUnmount=="function"))try{r.props=t.memoizedProps,r.state=t.memoizedState,r.componentWillUnmount()}catch(a){an(t,e,a)}$i(n,e,t);break;case 21:$i(n,e,t);break;case 22:t.mode&1?(ir=(r=ir)||t.memoizedState!==null,$i(n,e,t),ir=r):$i(n,e,t);break;default:$i(n,e,t)}}function kS(n){var e=n.updateQueue;if(e!==null){n.updateQueue=null;var t=n.stateNode;t===null&&(t=n.stateNode=new yL),e.forEach(function(r){var s=AL.bind(null,n,r);t.has(r)||(t.add(r),r.then(s,s))})}}function ds(n,e){var t=e.deletions;if(t!==null)for(var r=0;r<t.length;r++){var s=t[r];try{var i=n,o=e,a=o;e:for(;a!==null;){switch(a.tag){case 5:Wn=a.stateNode,fs=!1;break e;case 3:Wn=a.stateNode.containerInfo,fs=!0;break e;case 4:Wn=a.stateNode.containerInfo,fs=!0;break e}a=a.return}if(Wn===null)throw Error(X(160));OC(i,o,s),Wn=null,fs=!1;var l=s.alternate;l!==null&&(l.return=null),s.return=null}catch(u){an(s,e,u)}}if(e.subtreeFlags&12854)for(e=e.child;e!==null;)LC(e,n),e=e.sibling}function LC(n,e){var t=n.alternate,r=n.flags;switch(n.tag){case 0:case 11:case 14:case 15:if(ds(e,n),ks(n),r&4){try{zu(3,n,n.return),Ng(3,n)}catch(S){an(n,n.return,S)}try{zu(5,n,n.return)}catch(S){an(n,n.return,S)}}break;case 1:ds(e,n),ks(n),r&512&&t!==null&&Ml(t,t.return);break;case 5:if(ds(e,n),ks(n),r&512&&t!==null&&Ml(t,t.return),n.flags&32){var s=n.stateNode;try{hd(s,"")}catch(S){an(n,n.return,S)}}if(r&4&&(s=n.stateNode,s!=null)){var i=n.memoizedProps,o=t!==null?t.memoizedProps:i,a=n.type,l=n.updateQueue;if(n.updateQueue=null,l!==null)try{a==="input"&&i.type==="radio"&&i.name!=null&&rA(s,i),u_(a,o);var u=u_(a,i);for(o=0;o<l.length;o+=2){var h=l[o],f=l[o+1];h==="style"?lA(s,f):h==="dangerouslySetInnerHTML"?oA(s,f):h==="children"?hd(s,f):Jv(s,h,f,u)}switch(a){case"input":i_(s,i);break;case"textarea":sA(s,i);break;case"select":var p=s._wrapperState.wasMultiple;s._wrapperState.wasMultiple=!!i.multiple;var y=i.value;y!=null?Ul(s,!!i.multiple,y,!1):p!==!!i.multiple&&(i.defaultValue!=null?Ul(s,!!i.multiple,i.defaultValue,!0):Ul(s,!!i.multiple,i.multiple?[]:"",!1))}s[xd]=i}catch(S){an(n,n.return,S)}}break;case 6:if(ds(e,n),ks(n),r&4){if(n.stateNode===null)throw Error(X(162));s=n.stateNode,i=n.memoizedProps;try{s.nodeValue=i}catch(S){an(n,n.return,S)}}break;case 3:if(ds(e,n),ks(n),r&4&&t!==null&&t.memoizedState.isDehydrated)try{md(e.containerInfo)}catch(S){an(n,n.return,S)}break;case 4:ds(e,n),ks(n);break;case 13:ds(e,n),ks(n),s=n.child,s.flags&8192&&(i=s.memoizedState!==null,s.stateNode.isHidden=i,!i||s.alternate!==null&&s.alternate.memoizedState!==null||(N0=fn())),r&4&&kS(n);break;case 22:if(h=t!==null&&t.memoizedState!==null,n.mode&1?(ir=(u=ir)||h,ds(e,n),ir=u):ds(e,n),ks(n),r&8192){if(u=n.memoizedState!==null,(n.stateNode.isHidden=u)&&!h&&n.mode&1)for(ye=n,h=n.child;h!==null;){for(f=ye=h;ye!==null;){switch(p=ye,y=p.child,p.tag){case 0:case 11:case 14:case 15:zu(4,p,p.return);break;case 1:Ml(p,p.return);var w=p.stateNode;if(typeof w.componentWillUnmount=="function"){r=p,t=p.return;try{e=r,w.props=e.memoizedProps,w.state=e.memoizedState,w.componentWillUnmount()}catch(S){an(r,t,S)}}break;case 5:Ml(p,p.return);break;case 22:if(p.memoizedState!==null){DS(f);continue}}y!==null?(y.return=p,ye=y):DS(f)}h=h.sibling}e:for(h=null,f=n;;){if(f.tag===5){if(h===null){h=f;try{s=f.stateNode,u?(i=s.style,typeof i.setProperty=="function"?i.setProperty("display","none","important"):i.display="none"):(a=f.stateNode,l=f.memoizedProps.style,o=l!=null&&l.hasOwnProperty("display")?l.display:null,a.style.display=aA("display",o))}catch(S){an(n,n.return,S)}}}else if(f.tag===6){if(h===null)try{f.stateNode.nodeValue=u?"":f.memoizedProps}catch(S){an(n,n.return,S)}}else if((f.tag!==22&&f.tag!==23||f.memoizedState===null||f===n)&&f.child!==null){f.child.return=f,f=f.child;continue}if(f===n)break e;for(;f.sibling===null;){if(f.return===null||f.return===n)break e;h===f&&(h=null),f=f.return}h===f&&(h=null),f.sibling.return=f.return,f=f.sibling}}break;case 19:ds(e,n),ks(n),r&4&&kS(n);break;case 21:break;default:ds(e,n),ks(n)}}function ks(n){var e=n.flags;if(e&2){try{e:{for(var t=n.return;t!==null;){if(DC(t)){var r=t;break e}t=t.return}throw Error(X(160))}switch(r.tag){case 5:var s=r.stateNode;r.flags&32&&(hd(s,""),r.flags&=-33);var i=NS(n);U_(n,i,s);break;case 3:case 4:var o=r.stateNode.containerInfo,a=NS(n);F_(n,a,o);break;default:throw Error(X(161))}}catch(l){an(n,n.return,l)}n.flags&=-3}e&4096&&(n.flags&=-4097)}function vL(n,e,t){ye=n,MC(n)}function MC(n,e,t){for(var r=(n.mode&1)!==0;ye!==null;){var s=ye,i=s.child;if(s.tag===22&&r){var o=s.memoizedState!==null||pf;if(!o){var a=s.alternate,l=a!==null&&a.memoizedState!==null||ir;a=pf;var u=ir;if(pf=o,(ir=l)&&!u)for(ye=s;ye!==null;)o=ye,l=o.child,o.tag===22&&o.memoizedState!==null?OS(s):l!==null?(l.return=o,ye=l):OS(s);for(;i!==null;)ye=i,MC(i),i=i.sibling;ye=s,pf=a,ir=u}PS(n)}else s.subtreeFlags&8772&&i!==null?(i.return=s,ye=i):PS(n)}}function PS(n){for(;ye!==null;){var e=ye;if(e.flags&8772){var t=e.alternate;try{if(e.flags&8772)switch(e.tag){case 0:case 11:case 15:ir||Ng(5,e);break;case 1:var r=e.stateNode;if(e.flags&4&&!ir)if(t===null)r.componentDidMount();else{var s=e.elementType===e.type?t.memoizedProps:hs(e.type,t.memoizedProps);r.componentDidUpdate(s,t.memoizedState,r.__reactInternalSnapshotBeforeUpdate)}var i=e.updateQueue;i!==null&&mS(e,i,r);break;case 3:var o=e.updateQueue;if(o!==null){if(t=null,e.child!==null)switch(e.child.tag){case 5:t=e.child.stateNode;break;case 1:t=e.child.stateNode}mS(e,o,t)}break;case 5:var a=e.stateNode;if(t===null&&e.flags&4){t=a;var l=e.memoizedProps;switch(e.type){case"button":case"input":case"select":case"textarea":l.autoFocus&&t.focus();break;case"img":l.src&&(t.src=l.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(e.memoizedState===null){var u=e.alternate;if(u!==null){var h=u.memoizedState;if(h!==null){var f=h.dehydrated;f!==null&&md(f)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(X(163))}ir||e.flags&512&&V_(e)}catch(p){an(e,e.return,p)}}if(e===n){ye=null;break}if(t=e.sibling,t!==null){t.return=e.return,ye=t;break}ye=e.return}}function DS(n){for(;ye!==null;){var e=ye;if(e===n){ye=null;break}var t=e.sibling;if(t!==null){t.return=e.return,ye=t;break}ye=e.return}}function OS(n){for(;ye!==null;){var e=ye;try{switch(e.tag){case 0:case 11:case 15:var t=e.return;try{Ng(4,e)}catch(l){an(e,t,l)}break;case 1:var r=e.stateNode;if(typeof r.componentDidMount=="function"){var s=e.return;try{r.componentDidMount()}catch(l){an(e,s,l)}}var i=e.return;try{V_(e)}catch(l){an(e,i,l)}break;case 5:var o=e.return;try{V_(e)}catch(l){an(e,o,l)}}}catch(l){an(e,e.return,l)}if(e===n){ye=null;break}var a=e.sibling;if(a!==null){a.return=e.return,ye=a;break}ye=e.return}}var wL=Math.ceil,Np=Ni.ReactCurrentDispatcher,C0=Ni.ReactCurrentOwner,rs=Ni.ReactCurrentBatchConfig,pt=0,Mn=null,wn=null,Qn=0,Dr=0,jl=Vo(0),An=0,Ad=null,ba=0,kg=0,R0=0,qu=null,wr=null,N0=0,ac=1/0,ai=null,kp=!1,$_=null,po=null,gf=!1,no=null,Pp=0,Wu=0,B_=null,Bf=-1,zf=0;function gr(){return pt&6?fn():Bf!==-1?Bf:Bf=fn()}function go(n){return n.mode&1?pt&2&&Qn!==0?Qn&-Qn:rL.transition!==null?(zf===0&&(zf=wA()),zf):(n=Tt,n!==0||(n=window.event,n=n===void 0?16:AA(n.type)),n):1}function vs(n,e,t,r){if(50<Wu)throw Wu=0,B_=null,Error(X(185));ih(n,t,r),(!(pt&2)||n!==Mn)&&(n===Mn&&(!(pt&2)&&(kg|=t),An===4&&Ki(n,Qn)),Ar(n,r),t===1&&pt===0&&!(e.mode&1)&&(ac=fn()+500,Ag&&Fo()))}function Ar(n,e){var t=n.callbackNode;rO(n,e);var r=gp(n,n===Mn?Qn:0);if(r===0)t!==null&&zI(t),n.callbackNode=null,n.callbackPriority=0;else if(e=r&-r,n.callbackPriority!==e){if(t!=null&&zI(t),e===1)n.tag===0?nL(LS.bind(null,n)):GA(LS.bind(null,n)),XO(function(){!(pt&6)&&Fo()}),t=null;else{switch(xA(r)){case 1:t=n0;break;case 4:t=_A;break;case 16:t=pp;break;case 536870912:t=vA;break;default:t=pp}t=qC(t,jC.bind(null,n))}n.callbackPriority=e,n.callbackNode=t}}function jC(n,e){if(Bf=-1,zf=0,pt&6)throw Error(X(327));var t=n.callbackNode;if(Wl()&&n.callbackNode!==t)return null;var r=gp(n,n===Mn?Qn:0);if(r===0)return null;if(r&30||r&n.expiredLanes||e)e=Dp(n,r);else{e=r;var s=pt;pt|=2;var i=FC();(Mn!==n||Qn!==e)&&(ai=null,ac=fn()+500,ma(n,e));do try{SL();break}catch(a){VC(n,a)}while(1);g0(),Np.current=i,pt=s,wn!==null?e=0:(Mn=null,Qn=0,e=An)}if(e!==0){if(e===2&&(s=g_(n),s!==0&&(r=s,e=z_(n,s))),e===1)throw t=Ad,ma(n,0),Ki(n,r),Ar(n,fn()),t;if(e===6)Ki(n,r);else{if(s=n.current.alternate,!(r&30)&&!xL(s)&&(e=Dp(n,r),e===2&&(i=g_(n),i!==0&&(r=i,e=z_(n,i))),e===1))throw t=Ad,ma(n,0),Ki(n,r),Ar(n,fn()),t;switch(n.finishedWork=s,n.finishedLanes=r,e){case 0:case 1:throw Error(X(345));case 2:ea(n,wr,ai);break;case 3:if(Ki(n,r),(r&130023424)===r&&(e=N0+500-fn(),10<e)){if(gp(n,0)!==0)break;if(s=n.suspendedLanes,(s&r)!==r){gr(),n.pingedLanes|=n.suspendedLanes&s;break}n.timeoutHandle=S_(ea.bind(null,n,wr,ai),e);break}ea(n,wr,ai);break;case 4:if(Ki(n,r),(r&4194240)===r)break;for(e=n.eventTimes,s=-1;0<r;){var o=31-_s(r);i=1<<o,o=e[o],o>s&&(s=o),r&=~i}if(r=s,r=fn()-r,r=(120>r?120:480>r?480:1080>r?1080:1920>r?1920:3e3>r?3e3:4320>r?4320:1960*wL(r/1960))-r,10<r){n.timeoutHandle=S_(ea.bind(null,n,wr,ai),r);break}ea(n,wr,ai);break;case 5:ea(n,wr,ai);break;default:throw Error(X(329))}}}return Ar(n,fn()),n.callbackNode===t?jC.bind(null,n):null}function z_(n,e){var t=qu;return n.current.memoizedState.isDehydrated&&(ma(n,e).flags|=256),n=Dp(n,e),n!==2&&(e=wr,wr=t,e!==null&&q_(e)),n}function q_(n){wr===null?wr=n:wr.push.apply(wr,n)}function xL(n){for(var e=n;;){if(e.flags&16384){var t=e.updateQueue;if(t!==null&&(t=t.stores,t!==null))for(var r=0;r<t.length;r++){var s=t[r],i=s.getSnapshot;s=s.value;try{if(!Is(i(),s))return!1}catch{return!1}}}if(t=e.child,e.subtreeFlags&16384&&t!==null)t.return=e,e=t;else{if(e===n)break;for(;e.sibling===null;){if(e.return===null||e.return===n)return!0;e=e.return}e.sibling.return=e.return,e=e.sibling}}return!0}function Ki(n,e){for(e&=~R0,e&=~kg,n.suspendedLanes|=e,n.pingedLanes&=~e,n=n.expirationTimes;0<e;){var t=31-_s(e),r=1<<t;n[t]=-1,e&=~r}}function LS(n){if(pt&6)throw Error(X(327));Wl();var e=gp(n,0);if(!(e&1))return Ar(n,fn()),null;var t=Dp(n,e);if(n.tag!==0&&t===2){var r=g_(n);r!==0&&(e=r,t=z_(n,r))}if(t===1)throw t=Ad,ma(n,0),Ki(n,e),Ar(n,fn()),t;if(t===6)throw Error(X(345));return n.finishedWork=n.current.alternate,n.finishedLanes=e,ea(n,wr,ai),Ar(n,fn()),null}function k0(n,e){var t=pt;pt|=1;try{return n(e)}finally{pt=t,pt===0&&(ac=fn()+500,Ag&&Fo())}}function Aa(n){no!==null&&no.tag===0&&!(pt&6)&&Wl();var e=pt;pt|=1;var t=rs.transition,r=Tt;try{if(rs.transition=null,Tt=1,n)return n()}finally{Tt=r,rs.transition=t,pt=e,!(pt&6)&&Fo()}}function P0(){Dr=jl.current,$t(jl)}function ma(n,e){n.finishedWork=null,n.finishedLanes=0;var t=n.timeoutHandle;if(t!==-1&&(n.timeoutHandle=-1,JO(t)),wn!==null)for(t=wn.return;t!==null;){var r=t;switch(h0(r),r.tag){case 1:r=r.type.childContextTypes,r!=null&&wp();break;case 3:ic(),$t(Tr),$t(cr),x0();break;case 5:w0(r);break;case 4:ic();break;case 13:$t(Xt);break;case 19:$t(Xt);break;case 10:m0(r.type._context);break;case 22:case 23:P0()}t=t.return}if(Mn=n,wn=n=mo(n.current,null),Qn=Dr=e,An=0,Ad=null,R0=kg=ba=0,wr=qu=null,ua!==null){for(e=0;e<ua.length;e++)if(t=ua[e],r=t.interleaved,r!==null){t.interleaved=null;var s=r.next,i=t.pending;if(i!==null){var o=i.next;i.next=s,r.next=o}t.pending=r}ua=null}return n}function VC(n,e){do{var t=wn;try{if(g0(),Ff.current=Rp,Cp){for(var r=en.memoizedState;r!==null;){var s=r.queue;s!==null&&(s.pending=null),r=r.next}Cp=!1}if(Ta=0,Dn=Tn=en=null,Bu=!1,Ed=0,C0.current=null,t===null||t.return===null){An=1,Ad=e,wn=null;break}e:{var i=n,o=t.return,a=t,l=e;if(e=Qn,a.flags|=32768,l!==null&&typeof l=="object"&&typeof l.then=="function"){var u=l,h=a,f=h.tag;if(!(h.mode&1)&&(f===0||f===11||f===15)){var p=h.alternate;p?(h.updateQueue=p.updateQueue,h.memoizedState=p.memoizedState,h.lanes=p.lanes):(h.updateQueue=null,h.memoizedState=null)}var y=IS(o);if(y!==null){y.flags&=-257,SS(y,o,a,i,e),y.mode&1&&xS(i,u,e),e=y,l=u;var w=e.updateQueue;if(w===null){var S=new Set;S.add(l),e.updateQueue=S}else w.add(l);break e}else{if(!(e&1)){xS(i,u,e),D0();break e}l=Error(X(426))}}else if(Ht&&a.mode&1){var k=IS(o);if(k!==null){!(k.flags&65536)&&(k.flags|=256),SS(k,o,a,i,e),f0(oc(l,a));break e}}i=l=oc(l,a),An!==4&&(An=2),qu===null?qu=[i]:qu.push(i),i=o;do{switch(i.tag){case 3:i.flags|=65536,e&=-e,i.lanes|=e;var E=xC(i,l,e);gS(i,E);break e;case 1:a=l;var x=i.type,N=i.stateNode;if(!(i.flags&128)&&(typeof x.getDerivedStateFromError=="function"||N!==null&&typeof N.componentDidCatch=="function"&&(po===null||!po.has(N)))){i.flags|=65536,e&=-e,i.lanes|=e;var P=IC(i,a,e);gS(i,P);break e}}i=i.return}while(i!==null)}$C(t)}catch($){e=$,wn===t&&t!==null&&(wn=t=t.return);continue}break}while(1)}function FC(){var n=Np.current;return Np.current=Rp,n===null?Rp:n}function D0(){(An===0||An===3||An===2)&&(An=4),Mn===null||!(ba&268435455)&&!(kg&268435455)||Ki(Mn,Qn)}function Dp(n,e){var t=pt;pt|=2;var r=FC();(Mn!==n||Qn!==e)&&(ai=null,ma(n,e));do try{IL();break}catch(s){VC(n,s)}while(1);if(g0(),pt=t,Np.current=r,wn!==null)throw Error(X(261));return Mn=null,Qn=0,An}function IL(){for(;wn!==null;)UC(wn)}function SL(){for(;wn!==null&&!Q2();)UC(wn)}function UC(n){var e=zC(n.alternate,n,Dr);n.memoizedProps=n.pendingProps,e===null?$C(n):wn=e,C0.current=null}function $C(n){var e=n;do{var t=e.alternate;if(n=e.return,e.flags&32768){if(t=mL(t,e),t!==null){t.flags&=32767,wn=t;return}if(n!==null)n.flags|=32768,n.subtreeFlags=0,n.deletions=null;else{An=6,wn=null;return}}else if(t=gL(t,e,Dr),t!==null){wn=t;return}if(e=e.sibling,e!==null){wn=e;return}wn=e=n}while(e!==null);An===0&&(An=5)}function ea(n,e,t){var r=Tt,s=rs.transition;try{rs.transition=null,Tt=1,EL(n,e,t,r)}finally{rs.transition=s,Tt=r}return null}function EL(n,e,t,r){do Wl();while(no!==null);if(pt&6)throw Error(X(327));t=n.finishedWork;var s=n.finishedLanes;if(t===null)return null;if(n.finishedWork=null,n.finishedLanes=0,t===n.current)throw Error(X(177));n.callbackNode=null,n.callbackPriority=0;var i=t.lanes|t.childLanes;if(sO(n,i),n===Mn&&(wn=Mn=null,Qn=0),!(t.subtreeFlags&2064)&&!(t.flags&2064)||gf||(gf=!0,qC(pp,function(){return Wl(),null})),i=(t.flags&15990)!==0,t.subtreeFlags&15990||i){i=rs.transition,rs.transition=null;var o=Tt;Tt=1;var a=pt;pt|=4,C0.current=null,_L(n,t),LC(t,n),qO(x_),mp=!!w_,x_=w_=null,n.current=t,vL(t),K2(),pt=a,Tt=o,rs.transition=i}else n.current=t;if(gf&&(gf=!1,no=n,Pp=s),i=n.pendingLanes,i===0&&(po=null),X2(t.stateNode),Ar(n,fn()),e!==null)for(r=n.onRecoverableError,t=0;t<e.length;t++)s=e[t],r(s.value,{componentStack:s.stack,digest:s.digest});if(kp)throw kp=!1,n=$_,$_=null,n;return Pp&1&&n.tag!==0&&Wl(),i=n.pendingLanes,i&1?n===B_?Wu++:(Wu=0,B_=n):Wu=0,Fo(),null}function Wl(){if(no!==null){var n=xA(Pp),e=rs.transition,t=Tt;try{if(rs.transition=null,Tt=16>n?16:n,no===null)var r=!1;else{if(n=no,no=null,Pp=0,pt&6)throw Error(X(331));var s=pt;for(pt|=4,ye=n.current;ye!==null;){var i=ye,o=i.child;if(ye.flags&16){var a=i.deletions;if(a!==null){for(var l=0;l<a.length;l++){var u=a[l];for(ye=u;ye!==null;){var h=ye;switch(h.tag){case 0:case 11:case 15:zu(8,h,i)}var f=h.child;if(f!==null)f.return=h,ye=f;else for(;ye!==null;){h=ye;var p=h.sibling,y=h.return;if(PC(h),h===u){ye=null;break}if(p!==null){p.return=y,ye=p;break}ye=y}}}var w=i.alternate;if(w!==null){var S=w.child;if(S!==null){w.child=null;do{var k=S.sibling;S.sibling=null,S=k}while(S!==null)}}ye=i}}if(i.subtreeFlags&2064&&o!==null)o.return=i,ye=o;else e:for(;ye!==null;){if(i=ye,i.flags&2048)switch(i.tag){case 0:case 11:case 15:zu(9,i,i.return)}var E=i.sibling;if(E!==null){E.return=i.return,ye=E;break e}ye=i.return}}var x=n.current;for(ye=x;ye!==null;){o=ye;var N=o.child;if(o.subtreeFlags&2064&&N!==null)N.return=o,ye=N;else e:for(o=x;ye!==null;){if(a=ye,a.flags&2048)try{switch(a.tag){case 0:case 11:case 15:Ng(9,a)}}catch($){an(a,a.return,$)}if(a===o){ye=null;break e}var P=a.sibling;if(P!==null){P.return=a.return,ye=P;break e}ye=a.return}}if(pt=s,Fo(),qs&&typeof qs.onPostCommitFiberRoot=="function")try{qs.onPostCommitFiberRoot(Ig,n)}catch{}r=!0}return r}finally{Tt=t,rs.transition=e}}return!1}function MS(n,e,t){e=oc(t,e),e=xC(n,e,1),n=fo(n,e,1),e=gr(),n!==null&&(ih(n,1,e),Ar(n,e))}function an(n,e,t){if(n.tag===3)MS(n,n,t);else for(;e!==null;){if(e.tag===3){MS(e,n,t);break}else if(e.tag===1){var r=e.stateNode;if(typeof e.type.getDerivedStateFromError=="function"||typeof r.componentDidCatch=="function"&&(po===null||!po.has(r))){n=oc(t,n),n=IC(e,n,1),e=fo(e,n,1),n=gr(),e!==null&&(ih(e,1,n),Ar(e,n));break}}e=e.return}}function TL(n,e,t){var r=n.pingCache;r!==null&&r.delete(e),e=gr(),n.pingedLanes|=n.suspendedLanes&t,Mn===n&&(Qn&t)===t&&(An===4||An===3&&(Qn&130023424)===Qn&&500>fn()-N0?ma(n,0):R0|=t),Ar(n,e)}function BC(n,e){e===0&&(n.mode&1?(e=sf,sf<<=1,!(sf&130023424)&&(sf=4194304)):e=1);var t=gr();n=xi(n,e),n!==null&&(ih(n,e,t),Ar(n,t))}function bL(n){var e=n.memoizedState,t=0;e!==null&&(t=e.retryLane),BC(n,t)}function AL(n,e){var t=0;switch(n.tag){case 13:var r=n.stateNode,s=n.memoizedState;s!==null&&(t=s.retryLane);break;case 19:r=n.stateNode;break;default:throw Error(X(314))}r!==null&&r.delete(e),BC(n,t)}var zC;zC=function(n,e,t){if(n!==null)if(n.memoizedProps!==e.pendingProps||Tr.current)xr=!0;else{if(!(n.lanes&t)&&!(e.flags&128))return xr=!1,pL(n,e,t);xr=!!(n.flags&131072)}else xr=!1,Ht&&e.flags&1048576&&HA(e,Sp,e.index);switch(e.lanes=0,e.tag){case 2:var r=e.type;$f(n,e),n=e.pendingProps;var s=nc(e,cr.current);ql(e,t),s=S0(null,e,r,n,s,t);var i=E0();return e.flags|=1,typeof s=="object"&&s!==null&&typeof s.render=="function"&&s.$$typeof===void 0?(e.tag=1,e.memoizedState=null,e.updateQueue=null,br(r)?(i=!0,xp(e)):i=!1,e.memoizedState=s.state!==null&&s.state!==void 0?s.state:null,_0(e),s.updater=Rg,e.stateNode=s,s._reactInternals=e,N_(e,r,n,t),e=D_(null,e,r,!0,i,t)):(e.tag=0,Ht&&i&&d0(e),fr(null,e,s,t),e=e.child),e;case 16:r=e.elementType;e:{switch($f(n,e),n=e.pendingProps,s=r._init,r=s(r._payload),e.type=r,s=e.tag=RL(r),n=hs(r,n),s){case 0:e=P_(null,e,r,n,t);break e;case 1:e=bS(null,e,r,n,t);break e;case 11:e=ES(null,e,r,n,t);break e;case 14:e=TS(null,e,r,hs(r.type,n),t);break e}throw Error(X(306,r,""))}return e;case 0:return r=e.type,s=e.pendingProps,s=e.elementType===r?s:hs(r,s),P_(n,e,r,s,t);case 1:return r=e.type,s=e.pendingProps,s=e.elementType===r?s:hs(r,s),bS(n,e,r,s,t);case 3:e:{if(bC(e),n===null)throw Error(X(387));r=e.pendingProps,i=e.memoizedState,s=i.element,ZA(n,e),bp(e,r,null,t);var o=e.memoizedState;if(r=o.element,i.isDehydrated)if(i={element:r,isDehydrated:!1,cache:o.cache,pendingSuspenseBoundaries:o.pendingSuspenseBoundaries,transitions:o.transitions},e.updateQueue.baseState=i,e.memoizedState=i,e.flags&256){s=oc(Error(X(423)),e),e=AS(n,e,r,t,s);break e}else if(r!==s){s=oc(Error(X(424)),e),e=AS(n,e,r,t,s);break e}else for(Vr=ho(e.stateNode.containerInfo.firstChild),Fr=e,Ht=!0,gs=null,t=JA(e,null,r,t),e.child=t;t;)t.flags=t.flags&-3|4096,t=t.sibling;else{if(rc(),r===s){e=Ii(n,e,t);break e}fr(n,e,r,t)}e=e.child}return e;case 5:return eC(e),n===null&&A_(e),r=e.type,s=e.pendingProps,i=n!==null?n.memoizedProps:null,o=s.children,I_(r,s)?o=null:i!==null&&I_(r,i)&&(e.flags|=32),TC(n,e),fr(n,e,o,t),e.child;case 6:return n===null&&A_(e),null;case 13:return AC(n,e,t);case 4:return v0(e,e.stateNode.containerInfo),r=e.pendingProps,n===null?e.child=sc(e,null,r,t):fr(n,e,r,t),e.child;case 11:return r=e.type,s=e.pendingProps,s=e.elementType===r?s:hs(r,s),ES(n,e,r,s,t);case 7:return fr(n,e,e.pendingProps,t),e.child;case 8:return fr(n,e,e.pendingProps.children,t),e.child;case 12:return fr(n,e,e.pendingProps.children,t),e.child;case 10:e:{if(r=e.type._context,s=e.pendingProps,i=e.memoizedProps,o=s.value,Lt(Ep,r._currentValue),r._currentValue=o,i!==null)if(Is(i.value,o)){if(i.children===s.children&&!Tr.current){e=Ii(n,e,t);break e}}else for(i=e.child,i!==null&&(i.return=e);i!==null;){var a=i.dependencies;if(a!==null){o=i.child;for(var l=a.firstContext;l!==null;){if(l.context===r){if(i.tag===1){l=yi(-1,t&-t),l.tag=2;var u=i.updateQueue;if(u!==null){u=u.shared;var h=u.pending;h===null?l.next=l:(l.next=h.next,h.next=l),u.pending=l}}i.lanes|=t,l=i.alternate,l!==null&&(l.lanes|=t),C_(i.return,t,e),a.lanes|=t;break}l=l.next}}else if(i.tag===10)o=i.type===e.type?null:i.child;else if(i.tag===18){if(o=i.return,o===null)throw Error(X(341));o.lanes|=t,a=o.alternate,a!==null&&(a.lanes|=t),C_(o,t,e),o=i.sibling}else o=i.child;if(o!==null)o.return=i;else for(o=i;o!==null;){if(o===e){o=null;break}if(i=o.sibling,i!==null){i.return=o.return,o=i;break}o=o.return}i=o}fr(n,e,s.children,t),e=e.child}return e;case 9:return s=e.type,r=e.pendingProps.children,ql(e,t),s=is(s),r=r(s),e.flags|=1,fr(n,e,r,t),e.child;case 14:return r=e.type,s=hs(r,e.pendingProps),s=hs(r.type,s),TS(n,e,r,s,t);case 15:return SC(n,e,e.type,e.pendingProps,t);case 17:return r=e.type,s=e.pendingProps,s=e.elementType===r?s:hs(r,s),$f(n,e),e.tag=1,br(r)?(n=!0,xp(e)):n=!1,ql(e,t),wC(e,r,s),N_(e,r,s,t),D_(null,e,r,!0,n,t);case 19:return CC(n,e,t);case 22:return EC(n,e,t)}throw Error(X(156,e.tag))};function qC(n,e){return yA(n,e)}function CL(n,e,t,r){this.tag=n,this.key=t,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=e,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=r,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function ts(n,e,t,r){return new CL(n,e,t,r)}function O0(n){return n=n.prototype,!(!n||!n.isReactComponent)}function RL(n){if(typeof n=="function")return O0(n)?1:0;if(n!=null){if(n=n.$$typeof,n===Zv)return 11;if(n===e0)return 14}return 2}function mo(n,e){var t=n.alternate;return t===null?(t=ts(n.tag,e,n.key,n.mode),t.elementType=n.elementType,t.type=n.type,t.stateNode=n.stateNode,t.alternate=n,n.alternate=t):(t.pendingProps=e,t.type=n.type,t.flags=0,t.subtreeFlags=0,t.deletions=null),t.flags=n.flags&14680064,t.childLanes=n.childLanes,t.lanes=n.lanes,t.child=n.child,t.memoizedProps=n.memoizedProps,t.memoizedState=n.memoizedState,t.updateQueue=n.updateQueue,e=n.dependencies,t.dependencies=e===null?null:{lanes:e.lanes,firstContext:e.firstContext},t.sibling=n.sibling,t.index=n.index,t.ref=n.ref,t}function qf(n,e,t,r,s,i){var o=2;if(r=n,typeof n=="function")O0(n)&&(o=1);else if(typeof n=="string")o=5;else e:switch(n){case Al:return ya(t.children,s,i,e);case Xv:o=8,s|=8;break;case e_:return n=ts(12,t,e,s|2),n.elementType=e_,n.lanes=i,n;case t_:return n=ts(13,t,e,s),n.elementType=t_,n.lanes=i,n;case n_:return n=ts(19,t,e,s),n.elementType=n_,n.lanes=i,n;case eA:return Pg(t,s,i,e);default:if(typeof n=="object"&&n!==null)switch(n.$$typeof){case Xb:o=10;break e;case Zb:o=9;break e;case Zv:o=11;break e;case e0:o=14;break e;case Gi:o=16,r=null;break e}throw Error(X(130,n==null?n:typeof n,""))}return e=ts(o,t,e,s),e.elementType=n,e.type=r,e.lanes=i,e}function ya(n,e,t,r){return n=ts(7,n,r,e),n.lanes=t,n}function Pg(n,e,t,r){return n=ts(22,n,r,e),n.elementType=eA,n.lanes=t,n.stateNode={isHidden:!1},n}function wy(n,e,t){return n=ts(6,n,null,e),n.lanes=t,n}function xy(n,e,t){return e=ts(4,n.children!==null?n.children:[],n.key,e),e.lanes=t,e.stateNode={containerInfo:n.containerInfo,pendingChildren:null,implementation:n.implementation},e}function NL(n,e,t,r,s){this.tag=e,this.containerInfo=n,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=ty(0),this.expirationTimes=ty(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=ty(0),this.identifierPrefix=r,this.onRecoverableError=s,this.mutableSourceEagerHydrationData=null}function L0(n,e,t,r,s,i,o,a,l){return n=new NL(n,e,t,a,l),e===1?(e=1,i===!0&&(e|=8)):e=0,i=ts(3,null,null,e),n.current=i,i.stateNode=n,i.memoizedState={element:r,isDehydrated:t,cache:null,transitions:null,pendingSuspenseBoundaries:null},_0(i),n}function kL(n,e,t){var r=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:bl,key:r==null?null:""+r,children:n,containerInfo:e,implementation:t}}function WC(n){if(!n)return Eo;n=n._reactInternals;e:{if(Ga(n)!==n||n.tag!==1)throw Error(X(170));var e=n;do{switch(e.tag){case 3:e=e.stateNode.context;break e;case 1:if(br(e.type)){e=e.stateNode.__reactInternalMemoizedMergedChildContext;break e}}e=e.return}while(e!==null);throw Error(X(171))}if(n.tag===1){var t=n.type;if(br(t))return WA(n,t,e)}return e}function GC(n,e,t,r,s,i,o,a,l){return n=L0(t,r,!0,n,s,i,o,a,l),n.context=WC(null),t=n.current,r=gr(),s=go(t),i=yi(r,s),i.callback=e??null,fo(t,i,s),n.current.lanes=s,ih(n,s,r),Ar(n,r),n}function Dg(n,e,t,r){var s=e.current,i=gr(),o=go(s);return t=WC(t),e.context===null?e.context=t:e.pendingContext=t,e=yi(i,o),e.payload={element:n},r=r===void 0?null:r,r!==null&&(e.callback=r),n=fo(s,e,o),n!==null&&(vs(n,s,o,i),Vf(n,s,o)),o}function Op(n){if(n=n.current,!n.child)return null;switch(n.child.tag){case 5:return n.child.stateNode;default:return n.child.stateNode}}function jS(n,e){if(n=n.memoizedState,n!==null&&n.dehydrated!==null){var t=n.retryLane;n.retryLane=t!==0&&t<e?t:e}}function M0(n,e){jS(n,e),(n=n.alternate)&&jS(n,e)}function PL(){return null}var HC=typeof reportError=="function"?reportError:function(n){console.error(n)};function j0(n){this._internalRoot=n}Og.prototype.render=j0.prototype.render=function(n){var e=this._internalRoot;if(e===null)throw Error(X(409));Dg(n,e,null,null)};Og.prototype.unmount=j0.prototype.unmount=function(){var n=this._internalRoot;if(n!==null){this._internalRoot=null;var e=n.containerInfo;Aa(function(){Dg(null,n,null,null)}),e[wi]=null}};function Og(n){this._internalRoot=n}Og.prototype.unstable_scheduleHydration=function(n){if(n){var e=EA();n={blockedOn:null,target:n,priority:e};for(var t=0;t<Qi.length&&e!==0&&e<Qi[t].priority;t++);Qi.splice(t,0,n),t===0&&bA(n)}};function V0(n){return!(!n||n.nodeType!==1&&n.nodeType!==9&&n.nodeType!==11)}function Lg(n){return!(!n||n.nodeType!==1&&n.nodeType!==9&&n.nodeType!==11&&(n.nodeType!==8||n.nodeValue!==" react-mount-point-unstable "))}function VS(){}function DL(n,e,t,r,s){if(s){if(typeof r=="function"){var i=r;r=function(){var u=Op(o);i.call(u)}}var o=GC(e,r,n,0,null,!1,!1,"",VS);return n._reactRootContainer=o,n[wi]=o.current,vd(n.nodeType===8?n.parentNode:n),Aa(),o}for(;s=n.lastChild;)n.removeChild(s);if(typeof r=="function"){var a=r;r=function(){var u=Op(l);a.call(u)}}var l=L0(n,0,!1,null,null,!1,!1,"",VS);return n._reactRootContainer=l,n[wi]=l.current,vd(n.nodeType===8?n.parentNode:n),Aa(function(){Dg(e,l,t,r)}),l}function Mg(n,e,t,r,s){var i=t._reactRootContainer;if(i){var o=i;if(typeof s=="function"){var a=s;s=function(){var l=Op(o);a.call(l)}}Dg(e,o,n,s)}else o=DL(t,e,n,s,r);return Op(o)}IA=function(n){switch(n.tag){case 3:var e=n.stateNode;if(e.current.memoizedState.isDehydrated){var t=Au(e.pendingLanes);t!==0&&(r0(e,t|1),Ar(e,fn()),!(pt&6)&&(ac=fn()+500,Fo()))}break;case 13:Aa(function(){var r=xi(n,1);if(r!==null){var s=gr();vs(r,n,1,s)}}),M0(n,1)}};s0=function(n){if(n.tag===13){var e=xi(n,134217728);if(e!==null){var t=gr();vs(e,n,134217728,t)}M0(n,134217728)}};SA=function(n){if(n.tag===13){var e=go(n),t=xi(n,e);if(t!==null){var r=gr();vs(t,n,e,r)}M0(n,e)}};EA=function(){return Tt};TA=function(n,e){var t=Tt;try{return Tt=n,e()}finally{Tt=t}};h_=function(n,e,t){switch(e){case"input":if(i_(n,t),e=t.name,t.type==="radio"&&e!=null){for(t=n;t.parentNode;)t=t.parentNode;for(t=t.querySelectorAll("input[name="+JSON.stringify(""+e)+'][type="radio"]'),e=0;e<t.length;e++){var r=t[e];if(r!==n&&r.form===n.form){var s=bg(r);if(!s)throw Error(X(90));nA(r),i_(r,s)}}}break;case"textarea":sA(n,t);break;case"select":e=t.value,e!=null&&Ul(n,!!t.multiple,e,!1)}};dA=k0;hA=Aa;var OL={usingClientEntryPoint:!1,Events:[ah,kl,bg,cA,uA,k0]},pu={findFiberByHostInstance:ca,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},LL={bundleType:pu.bundleType,version:pu.version,rendererPackageName:pu.rendererPackageName,rendererConfig:pu.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:Ni.ReactCurrentDispatcher,findHostInstanceByFiber:function(n){return n=gA(n),n===null?null:n.stateNode},findFiberByHostInstance:pu.findFiberByHostInstance||PL,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var mf=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!mf.isDisabled&&mf.supportsFiber)try{Ig=mf.inject(LL),qs=mf}catch{}}Hr.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=OL;Hr.createPortal=function(n,e){var t=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!V0(e))throw Error(X(200));return kL(n,e,null,t)};Hr.createRoot=function(n,e){if(!V0(n))throw Error(X(299));var t=!1,r="",s=HC;return e!=null&&(e.unstable_strictMode===!0&&(t=!0),e.identifierPrefix!==void 0&&(r=e.identifierPrefix),e.onRecoverableError!==void 0&&(s=e.onRecoverableError)),e=L0(n,1,!1,null,null,t,!1,r,s),n[wi]=e.current,vd(n.nodeType===8?n.parentNode:n),new j0(e)};Hr.findDOMNode=function(n){if(n==null)return null;if(n.nodeType===1)return n;var e=n._reactInternals;if(e===void 0)throw typeof n.render=="function"?Error(X(188)):(n=Object.keys(n).join(","),Error(X(268,n)));return n=gA(e),n=n===null?null:n.stateNode,n};Hr.flushSync=function(n){return Aa(n)};Hr.hydrate=function(n,e,t){if(!Lg(e))throw Error(X(200));return Mg(null,n,e,!0,t)};Hr.hydrateRoot=function(n,e,t){if(!V0(n))throw Error(X(405));var r=t!=null&&t.hydratedSources||null,s=!1,i="",o=HC;if(t!=null&&(t.unstable_strictMode===!0&&(s=!0),t.identifierPrefix!==void 0&&(i=t.identifierPrefix),t.onRecoverableError!==void 0&&(o=t.onRecoverableError)),e=GC(e,null,n,1,t??null,s,!1,i,o),n[wi]=e.current,vd(n),r)for(n=0;n<r.length;n++)t=r[n],s=t._getVersion,s=s(t._source),e.mutableSourceEagerHydrationData==null?e.mutableSourceEagerHydrationData=[t,s]:e.mutableSourceEagerHydrationData.push(t,s);return new Og(e)};Hr.render=function(n,e,t){if(!Lg(e))throw Error(X(200));return Mg(null,n,e,!1,t)};Hr.unmountComponentAtNode=function(n){if(!Lg(n))throw Error(X(40));return n._reactRootContainer?(Aa(function(){Mg(null,null,n,!1,function(){n._reactRootContainer=null,n[wi]=null})}),!0):!1};Hr.unstable_batchedUpdates=k0;Hr.unstable_renderSubtreeIntoContainer=function(n,e,t,r){if(!Lg(t))throw Error(X(200));if(n==null||n._reactInternals===void 0)throw Error(X(38));return Mg(n,e,t,!1,r)};Hr.version="18.3.1-next-f1338f8080-20240426";function QC(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(QC)}catch(n){console.error(n)}}QC(),Qb.exports=Hr;var ML=Qb.exports,FS=ML;Xy.createRoot=FS.createRoot,Xy.hydrateRoot=FS.hydrateRoot;const jL="modulepreload",VL=function(n){return"/"+n},US={},ke=function(e,t,r){if(!t||t.length===0)return e();const s=document.getElementsByTagName("link");return Promise.all(t.map(i=>{if(i=VL(i),i in US)return;US[i]=!0;const o=i.endsWith(".css"),a=o?'[rel="stylesheet"]':"";if(!!r)for(let h=s.length-1;h>=0;h--){const f=s[h];if(f.href===i&&(!o||f.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${i}"]${a}`))return;const u=document.createElement("link");if(u.rel=o?"stylesheet":jL,o||(u.as="script",u.crossOrigin=""),u.href=i,document.head.appendChild(u),o)return new Promise((h,f)=>{u.addEventListener("load",h),u.addEventListener("error",()=>f(new Error(`Unable to preload CSS for ${i}`)))})})).then(()=>e()).catch(i=>{const o=new Event("vite:preloadError",{cancelable:!0});if(o.payload=i,window.dispatchEvent(o),!o.defaultPrevented)throw i})},FL=()=>{};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const KC={NODE_CLIENT:!1,NODE_ADMIN:!1,SDK_VERSION:"${JSCORE_VERSION}"};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const te=function(n,e){if(!n)throw jc(e)},jc=function(n){return new Error("Firebase Database ("+KC.SDK_VERSION+") INTERNAL ASSERT FAILED: "+n)};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const YC=function(n){const e=[];let t=0;for(let r=0;r<n.length;r++){let s=n.charCodeAt(r);s<128?e[t++]=s:s<2048?(e[t++]=s>>6|192,e[t++]=s&63|128):(s&64512)===55296&&r+1<n.length&&(n.charCodeAt(r+1)&64512)===56320?(s=65536+((s&1023)<<10)+(n.charCodeAt(++r)&1023),e[t++]=s>>18|240,e[t++]=s>>12&63|128,e[t++]=s>>6&63|128,e[t++]=s&63|128):(e[t++]=s>>12|224,e[t++]=s>>6&63|128,e[t++]=s&63|128)}return e},UL=function(n){const e=[];let t=0,r=0;for(;t<n.length;){const s=n[t++];if(s<128)e[r++]=String.fromCharCode(s);else if(s>191&&s<224){const i=n[t++];e[r++]=String.fromCharCode((s&31)<<6|i&63)}else if(s>239&&s<365){const i=n[t++],o=n[t++],a=n[t++],l=((s&7)<<18|(i&63)<<12|(o&63)<<6|a&63)-65536;e[r++]=String.fromCharCode(55296+(l>>10)),e[r++]=String.fromCharCode(56320+(l&1023))}else{const i=n[t++],o=n[t++];e[r++]=String.fromCharCode((s&15)<<12|(i&63)<<6|o&63)}}return e.join("")},F0={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:typeof atob=="function",encodeByteArray(n,e){if(!Array.isArray(n))throw Error("encodeByteArray takes an array as a parameter");this.init_();const t=e?this.byteToCharMapWebSafe_:this.byteToCharMap_,r=[];for(let s=0;s<n.length;s+=3){const i=n[s],o=s+1<n.length,a=o?n[s+1]:0,l=s+2<n.length,u=l?n[s+2]:0,h=i>>2,f=(i&3)<<4|a>>4;let p=(a&15)<<2|u>>6,y=u&63;l||(y=64,o||(p=64)),r.push(t[h],t[f],t[p],t[y])}return r.join("")},encodeString(n,e){return this.HAS_NATIVE_SUPPORT&&!e?btoa(n):this.encodeByteArray(YC(n),e)},decodeString(n,e){return this.HAS_NATIVE_SUPPORT&&!e?atob(n):UL(this.decodeStringToByteArray(n,e))},decodeStringToByteArray(n,e){this.init_();const t=e?this.charToByteMapWebSafe_:this.charToByteMap_,r=[];for(let s=0;s<n.length;){const i=t[n.charAt(s++)],a=s<n.length?t[n.charAt(s)]:0;++s;const u=s<n.length?t[n.charAt(s)]:64;++s;const f=s<n.length?t[n.charAt(s)]:64;if(++s,i==null||a==null||u==null||f==null)throw new $L;const p=i<<2|a>>4;if(r.push(p),u!==64){const y=a<<4&240|u>>2;if(r.push(y),f!==64){const w=u<<6&192|f;r.push(w)}}}return r},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let n=0;n<this.ENCODED_VALS.length;n++)this.byteToCharMap_[n]=this.ENCODED_VALS.charAt(n),this.charToByteMap_[this.byteToCharMap_[n]]=n,this.byteToCharMapWebSafe_[n]=this.ENCODED_VALS_WEBSAFE.charAt(n),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[n]]=n,n>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(n)]=n,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(n)]=n)}}};class $L extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}const JC=function(n){const e=YC(n);return F0.encodeByteArray(e,!0)},Lp=function(n){return JC(n).replace(/\./g,"")},Mp=function(n){try{return F0.decodeString(n,!0)}catch(e){console.error("base64Decode failed: ",e)}return null};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function BL(n){return XC(void 0,n)}function XC(n,e){if(!(e instanceof Object))return e;switch(e.constructor){case Date:const t=e;return new Date(t.getTime());case Object:n===void 0&&(n={});break;case Array:n=[];break;default:return e}for(const t in e)!e.hasOwnProperty(t)||!zL(t)||(n[t]=XC(n[t],e[t]));return n}function zL(n){return n!=="__proto__"}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ZC(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("Unable to locate global object.")}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const qL=()=>ZC().__FIREBASE_DEFAULTS__,WL=()=>{if(typeof process>"u"||typeof process.env>"u")return;const n={}.__FIREBASE_DEFAULTS__;if(n)return JSON.parse(n)},GL=()=>{if(typeof document>"u")return;let n;try{n=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch{return}const e=n&&Mp(n[1]);return e&&JSON.parse(e)},jg=()=>{try{return FL()||qL()||WL()||GL()}catch(n){console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${n}`);return}},e1=n=>{var e,t;return(t=(e=jg())==null?void 0:e.emulatorHosts)==null?void 0:t[n]},t1=n=>{const e=e1(n);if(!e)return;const t=e.lastIndexOf(":");if(t<=0||t+1===e.length)throw new Error(`Invalid host ${e} with no separate hostname and port!`);const r=parseInt(e.substring(t+1),10);return e[0]==="["?[e.substring(1,t-1),r]:[e.substring(0,t),r]},n1=()=>{var n;return(n=jg())==null?void 0:n.config},r1=n=>{var e;return(e=jg())==null?void 0:e[`_${n}`]};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Mr{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}wrapCallback(e){return(t,r)=>{t?this.reject(t):this.resolve(r),typeof e=="function"&&(this.promise.catch(()=>{}),e.length===1?e(t):e(t,r))}}}/**
 * @license
 * Copyright 2025 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ki(n){try{return(n.startsWith("http://")||n.startsWith("https://")?new URL(n).hostname:n).endsWith(".cloudworkstations.dev")}catch{return!1}}async function Vg(n){return(await fetch(n,{credentials:"include"})).ok}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function s1(n,e){if(n.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');const t={alg:"none",type:"JWT"},r=e||"demo-project",s=n.iat||0,i=n.sub||n.user_id;if(!i)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");const o={iss:`https://securetoken.google.com/${r}`,aud:r,iat:s,exp:s+3600,auth_time:s,sub:i,user_id:i,firebase:{sign_in_provider:"custom",identities:{}},...n},a="";return[Lp(JSON.stringify(t)),Lp(JSON.stringify(o)),a].join(".")}const Gu={};function HL(){const n={prod:[],emulator:[]};for(const e of Object.keys(Gu))Gu[e]?n.emulator.push(e):n.prod.push(e);return n}function QL(n){let e=document.getElementById(n),t=!1;return e||(e=document.createElement("div"),e.setAttribute("id",n),t=!0),{created:t,element:e}}let $S=!1;function U0(n,e){if(typeof window>"u"||typeof document>"u"||!ki(window.location.host)||Gu[n]===e||Gu[n]||$S)return;Gu[n]=e;function t(p){return`__firebase__banner__${p}`}const r="__firebase__banner",i=HL().prod.length>0;function o(){const p=document.getElementById(r);p&&p.remove()}function a(p){p.style.display="flex",p.style.background="#7faaf0",p.style.position="fixed",p.style.bottom="5px",p.style.left="5px",p.style.padding=".5em",p.style.borderRadius="5px",p.style.alignItems="center"}function l(p,y){p.setAttribute("width","24"),p.setAttribute("id",y),p.setAttribute("height","24"),p.setAttribute("viewBox","0 0 24 24"),p.setAttribute("fill","none"),p.style.marginLeft="-6px"}function u(){const p=document.createElement("span");return p.style.cursor="pointer",p.style.marginLeft="16px",p.style.fontSize="24px",p.innerHTML=" &times;",p.onclick=()=>{$S=!0,o()},p}function h(p,y){p.setAttribute("id",y),p.innerText="Learn more",p.href="https://firebase.google.com/docs/studio/preview-apps#preview-backend",p.setAttribute("target","__blank"),p.style.paddingLeft="5px",p.style.textDecoration="underline"}function f(){const p=QL(r),y=t("text"),w=document.getElementById(y)||document.createElement("span"),S=t("learnmore"),k=document.getElementById(S)||document.createElement("a"),E=t("preprendIcon"),x=document.getElementById(E)||document.createElementNS("http://www.w3.org/2000/svg","svg");if(p.created){const N=p.element;a(N),h(k,S);const P=u();l(x,E),N.append(x,w,k,P),document.body.appendChild(N)}i?(w.innerText="Preview backend disconnected.",x.innerHTML=`<g clip-path="url(#clip0_6013_33858)">
<path d="M4.8 17.6L12 5.6L19.2 17.6H4.8ZM6.91667 16.4H17.0833L12 7.93333L6.91667 16.4ZM12 15.6C12.1667 15.6 12.3056 15.5444 12.4167 15.4333C12.5389 15.3111 12.6 15.1667 12.6 15C12.6 14.8333 12.5389 14.6944 12.4167 14.5833C12.3056 14.4611 12.1667 14.4 12 14.4C11.8333 14.4 11.6889 14.4611 11.5667 14.5833C11.4556 14.6944 11.4 14.8333 11.4 15C11.4 15.1667 11.4556 15.3111 11.5667 15.4333C11.6889 15.5444 11.8333 15.6 12 15.6ZM11.4 13.6H12.6V10.4H11.4V13.6Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6013_33858">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`):(x.innerHTML=`<g clip-path="url(#clip0_6083_34804)">
<path d="M11.4 15.2H12.6V11.2H11.4V15.2ZM12 10C12.1667 10 12.3056 9.94444 12.4167 9.83333C12.5389 9.71111 12.6 9.56667 12.6 9.4C12.6 9.23333 12.5389 9.09444 12.4167 8.98333C12.3056 8.86111 12.1667 8.8 12 8.8C11.8333 8.8 11.6889 8.86111 11.5667 8.98333C11.4556 9.09444 11.4 9.23333 11.4 9.4C11.4 9.56667 11.4556 9.71111 11.5667 9.83333C11.6889 9.94444 11.8333 10 12 10ZM12 18.4C11.1222 18.4 10.2944 18.2333 9.51667 17.9C8.73889 17.5667 8.05556 17.1111 7.46667 16.5333C6.88889 15.9444 6.43333 15.2611 6.1 14.4833C5.76667 13.7056 5.6 12.8778 5.6 12C5.6 11.1111 5.76667 10.2833 6.1 9.51667C6.43333 8.73889 6.88889 8.06111 7.46667 7.48333C8.05556 6.89444 8.73889 6.43333 9.51667 6.1C10.2944 5.76667 11.1222 5.6 12 5.6C12.8889 5.6 13.7167 5.76667 14.4833 6.1C15.2611 6.43333 15.9389 6.89444 16.5167 7.48333C17.1056 8.06111 17.5667 8.73889 17.9 9.51667C18.2333 10.2833 18.4 11.1111 18.4 12C18.4 12.8778 18.2333 13.7056 17.9 14.4833C17.5667 15.2611 17.1056 15.9444 16.5167 16.5333C15.9389 17.1111 15.2611 17.5667 14.4833 17.9C13.7167 18.2333 12.8889 18.4 12 18.4ZM12 17.2C13.4444 17.2 14.6722 16.6944 15.6833 15.6833C16.6944 14.6722 17.2 13.4444 17.2 12C17.2 10.5556 16.6944 9.32778 15.6833 8.31667C14.6722 7.30555 13.4444 6.8 12 6.8C10.5556 6.8 9.32778 7.30555 8.31667 8.31667C7.30556 9.32778 6.8 10.5556 6.8 12C6.8 13.4444 7.30556 14.6722 8.31667 15.6833C9.32778 16.6944 10.5556 17.2 12 17.2Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6083_34804">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`,w.innerText="Preview backend running in this workspace."),w.setAttribute("id",y)}document.readyState==="loading"?window.addEventListener("DOMContentLoaded",f):f()}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Cn(){return typeof navigator<"u"&&typeof navigator.userAgent=="string"?navigator.userAgent:""}function $0(){return typeof window<"u"&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(Cn())}function i1(){var e;const n=(e=jg())==null?void 0:e.forceEnvironment;if(n==="node")return!0;if(n==="browser")return!1;try{return Object.prototype.toString.call(global.process)==="[object process]"}catch{return!1}}function KL(){return typeof navigator<"u"&&navigator.userAgent==="Cloudflare-Workers"}function B0(){const n=typeof chrome=="object"?chrome.runtime:typeof browser=="object"?browser.runtime:void 0;return typeof n=="object"&&n.id!==void 0}function o1(){return typeof navigator=="object"&&navigator.product==="ReactNative"}function YL(){const n=Cn();return n.indexOf("MSIE ")>=0||n.indexOf("Trident/")>=0}function a1(){return KC.NODE_ADMIN===!0}function l1(){return!i1()&&!!navigator.userAgent&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")}function c1(){return!i1()&&!!navigator.userAgent&&(navigator.userAgent.includes("Safari")||navigator.userAgent.includes("WebKit"))&&!navigator.userAgent.includes("Chrome")}function Fg(){try{return typeof indexedDB=="object"}catch{return!1}}function z0(){return new Promise((n,e)=>{try{let t=!0;const r="validate-browser-context-for-indexeddb-analytics-module",s=self.indexedDB.open(r);s.onsuccess=()=>{s.result.close(),t||self.indexedDB.deleteDatabase(r),n(!0)},s.onupgradeneeded=()=>{t=!1},s.onerror=()=>{var i;e(((i=s.error)==null?void 0:i.message)||"")}}catch(t){e(t)}})}function u1(){return!(typeof navigator>"u"||!navigator.cookieEnabled)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const JL="FirebaseError";class Es extends Error{constructor(e,t,r){super(t),this.code=e,this.customData=r,this.name=JL,Object.setPrototypeOf(this,Es.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,Ha.prototype.create)}}class Ha{constructor(e,t,r){this.service=e,this.serviceName=t,this.errors=r}create(e,...t){const r=t[0]||{},s=`${this.service}/${e}`,i=this.errors[e],o=i?XL(i,r):"Error",a=`${this.serviceName}: ${o} (${s}).`;return new Es(s,a,r)}}function XL(n,e){return n.replace(ZL,(t,r)=>{const s=e[r];return s!=null?String(s):`<${r}?>`})}const ZL=/\{\$([^}]+)}/g;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Cd(n){return JSON.parse(n)}function bn(n){return JSON.stringify(n)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const d1=function(n){let e={},t={},r={},s="";try{const i=n.split(".");e=Cd(Mp(i[0])||""),t=Cd(Mp(i[1])||""),s=i[2],r=t.d||{},delete t.d}catch{}return{header:e,claims:t,data:r,signature:s}},eM=function(n){const e=d1(n),t=e.claims;return!!t&&typeof t=="object"&&t.hasOwnProperty("iat")},tM=function(n){const e=d1(n).claims;return typeof e=="object"&&e.admin===!0};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ts(n,e){return Object.prototype.hasOwnProperty.call(n,e)}function Ca(n,e){if(Object.prototype.hasOwnProperty.call(n,e))return n[e]}function jp(n){for(const e in n)if(Object.prototype.hasOwnProperty.call(n,e))return!1;return!0}function Vp(n,e,t){const r={};for(const s in n)Object.prototype.hasOwnProperty.call(n,s)&&(r[s]=e.call(t,n[s],s,n));return r}function qr(n,e){if(n===e)return!0;const t=Object.keys(n),r=Object.keys(e);for(const s of t){if(!r.includes(s))return!1;const i=n[s],o=e[s];if(BS(i)&&BS(o)){if(!qr(i,o))return!1}else if(i!==o)return!1}for(const s of r)if(!t.includes(s))return!1;return!0}function BS(n){return n!==null&&typeof n=="object"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Qa(n){const e=[];for(const[t,r]of Object.entries(n))Array.isArray(r)?r.forEach(s=>{e.push(encodeURIComponent(t)+"="+encodeURIComponent(s))}):e.push(encodeURIComponent(t)+"="+encodeURIComponent(r));return e.length?"&"+e.join("&"):""}function Ru(n){const e={};return n.replace(/^\?/,"").split("&").forEach(r=>{if(r){const[s,i]=r.split("=");e[decodeURIComponent(s)]=decodeURIComponent(i)}}),e}function Nu(n){const e=n.indexOf("?");if(!e)return"";const t=n.indexOf("#",e);return n.substring(e,t>0?t:void 0)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class nM{constructor(){this.chain_=[],this.buf_=[],this.W_=[],this.pad_=[],this.inbuf_=0,this.total_=0,this.blockSize=512/8,this.pad_[0]=128;for(let e=1;e<this.blockSize;++e)this.pad_[e]=0;this.reset()}reset(){this.chain_[0]=1732584193,this.chain_[1]=4023233417,this.chain_[2]=2562383102,this.chain_[3]=271733878,this.chain_[4]=3285377520,this.inbuf_=0,this.total_=0}compress_(e,t){t||(t=0);const r=this.W_;if(typeof e=="string")for(let f=0;f<16;f++)r[f]=e.charCodeAt(t)<<24|e.charCodeAt(t+1)<<16|e.charCodeAt(t+2)<<8|e.charCodeAt(t+3),t+=4;else for(let f=0;f<16;f++)r[f]=e[t]<<24|e[t+1]<<16|e[t+2]<<8|e[t+3],t+=4;for(let f=16;f<80;f++){const p=r[f-3]^r[f-8]^r[f-14]^r[f-16];r[f]=(p<<1|p>>>31)&4294967295}let s=this.chain_[0],i=this.chain_[1],o=this.chain_[2],a=this.chain_[3],l=this.chain_[4],u,h;for(let f=0;f<80;f++){f<40?f<20?(u=a^i&(o^a),h=1518500249):(u=i^o^a,h=1859775393):f<60?(u=i&o|a&(i|o),h=2400959708):(u=i^o^a,h=3395469782);const p=(s<<5|s>>>27)+u+l+h+r[f]&4294967295;l=a,a=o,o=(i<<30|i>>>2)&4294967295,i=s,s=p}this.chain_[0]=this.chain_[0]+s&4294967295,this.chain_[1]=this.chain_[1]+i&4294967295,this.chain_[2]=this.chain_[2]+o&4294967295,this.chain_[3]=this.chain_[3]+a&4294967295,this.chain_[4]=this.chain_[4]+l&4294967295}update(e,t){if(e==null)return;t===void 0&&(t=e.length);const r=t-this.blockSize;let s=0;const i=this.buf_;let o=this.inbuf_;for(;s<t;){if(o===0)for(;s<=r;)this.compress_(e,s),s+=this.blockSize;if(typeof e=="string"){for(;s<t;)if(i[o]=e.charCodeAt(s),++o,++s,o===this.blockSize){this.compress_(i),o=0;break}}else for(;s<t;)if(i[o]=e[s],++o,++s,o===this.blockSize){this.compress_(i),o=0;break}}this.inbuf_=o,this.total_+=t}digest(){const e=[];let t=this.total_*8;this.inbuf_<56?this.update(this.pad_,56-this.inbuf_):this.update(this.pad_,this.blockSize-(this.inbuf_-56));for(let s=this.blockSize-1;s>=56;s--)this.buf_[s]=t&255,t/=256;this.compress_(this.buf_);let r=0;for(let s=0;s<5;s++)for(let i=24;i>=0;i-=8)e[r]=this.chain_[s]>>i&255,++r;return e}}function rM(n,e){const t=new sM(n,e);return t.subscribe.bind(t)}class sM{constructor(e,t){this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=t,this.task.then(()=>{e(this)}).catch(r=>{this.error(r)})}next(e){this.forEachObserver(t=>{t.next(e)})}error(e){this.forEachObserver(t=>{t.error(e)}),this.close(e)}complete(){this.forEachObserver(e=>{e.complete()}),this.close()}subscribe(e,t,r){let s;if(e===void 0&&t===void 0&&r===void 0)throw new Error("Missing Observer.");iM(e,["next","error","complete"])?s=e:s={next:e,error:t,complete:r},s.next===void 0&&(s.next=Iy),s.error===void 0&&(s.error=Iy),s.complete===void 0&&(s.complete=Iy);const i=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then(()=>{try{this.finalError?s.error(this.finalError):s.complete()}catch{}}),this.observers.push(s),i}unsubscribeOne(e){this.observers===void 0||this.observers[e]===void 0||(delete this.observers[e],this.observerCount-=1,this.observerCount===0&&this.onNoObservers!==void 0&&this.onNoObservers(this))}forEachObserver(e){if(!this.finalized)for(let t=0;t<this.observers.length;t++)this.sendOne(t,e)}sendOne(e,t){this.task.then(()=>{if(this.observers!==void 0&&this.observers[e]!==void 0)try{t(this.observers[e])}catch(r){typeof console<"u"&&console.error&&console.error(r)}})}close(e){this.finalized||(this.finalized=!0,e!==void 0&&(this.finalError=e),this.task.then(()=>{this.observers=void 0,this.onNoObservers=void 0}))}}function iM(n,e){if(typeof n!="object"||n===null)return!1;for(const t of e)if(t in n&&typeof n[t]=="function")return!0;return!1}function Iy(){}function Ra(n,e){return`${n} failed: ${e} argument `}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const oM=function(n){const e=[];let t=0;for(let r=0;r<n.length;r++){let s=n.charCodeAt(r);if(s>=55296&&s<=56319){const i=s-55296;r++,te(r<n.length,"Surrogate pair missing trail surrogate.");const o=n.charCodeAt(r)-56320;s=65536+(i<<10)+o}s<128?e[t++]=s:s<2048?(e[t++]=s>>6|192,e[t++]=s&63|128):s<65536?(e[t++]=s>>12|224,e[t++]=s>>6&63|128,e[t++]=s&63|128):(e[t++]=s>>18|240,e[t++]=s>>12&63|128,e[t++]=s>>6&63|128,e[t++]=s&63|128)}return e},Ug=function(n){let e=0;for(let t=0;t<n.length;t++){const r=n.charCodeAt(t);r<128?e++:r<2048?e+=2:r>=55296&&r<=56319?(e+=4,t++):e+=3}return e};/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const aM=1e3,lM=2,cM=4*60*60*1e3,uM=.5;function zS(n,e=aM,t=lM){const r=e*Math.pow(t,n),s=Math.round(uM*r*(Math.random()-.5)*2);return Math.min(cM,r+s)}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function oe(n){return n&&n._delegate?n._delegate:n}class Nr{constructor(e,t,r){this.name=e,this.instanceFactory=t,this.type=r,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ta="[DEFAULT]";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class W_{constructor(e,t){this.name=e,this.container=t,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(e){const t=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(t)){const r=new Mr;if(this.instancesDeferred.set(t,r),this.isInitialized(t)||this.shouldAutoInitialize())try{const s=this.getOrInitializeService({instanceIdentifier:t});s&&r.resolve(s)}catch{}}return this.instancesDeferred.get(t).promise}getImmediate(e){const t=this.normalizeInstanceIdentifier(e==null?void 0:e.identifier),r=(e==null?void 0:e.optional)??!1;if(this.isInitialized(t)||this.shouldAutoInitialize())try{return this.getOrInitializeService({instanceIdentifier:t})}catch(s){if(r)return null;throw s}else{if(r)return null;throw Error(`Service ${this.name} is not available`)}}getComponent(){return this.component}setComponent(e){if(e.name!==this.name)throw Error(`Mismatching Component ${e.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=e,!!this.shouldAutoInitialize()){if(hM(e))try{this.getOrInitializeService({instanceIdentifier:ta})}catch{}for(const[t,r]of this.instancesDeferred.entries()){const s=this.normalizeInstanceIdentifier(t);try{const i=this.getOrInitializeService({instanceIdentifier:s});r.resolve(i)}catch{}}}}clearInstance(e=ta){this.instancesDeferred.delete(e),this.instancesOptions.delete(e),this.instances.delete(e)}async delete(){const e=Array.from(this.instances.values());await Promise.all([...e.filter(t=>"INTERNAL"in t).map(t=>t.INTERNAL.delete()),...e.filter(t=>"_delete"in t).map(t=>t._delete())])}isComponentSet(){return this.component!=null}isInitialized(e=ta){return this.instances.has(e)}getOptions(e=ta){return this.instancesOptions.get(e)||{}}initialize(e={}){const{options:t={}}=e,r=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(r))throw Error(`${this.name}(${r}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const s=this.getOrInitializeService({instanceIdentifier:r,options:t});for(const[i,o]of this.instancesDeferred.entries()){const a=this.normalizeInstanceIdentifier(i);r===a&&o.resolve(s)}return s}onInit(e,t){const r=this.normalizeInstanceIdentifier(t),s=this.onInitCallbacks.get(r)??new Set;s.add(e),this.onInitCallbacks.set(r,s);const i=this.instances.get(r);return i&&e(i,r),()=>{s.delete(e)}}invokeOnInitCallbacks(e,t){const r=this.onInitCallbacks.get(t);if(r)for(const s of r)try{s(e,t)}catch{}}getOrInitializeService({instanceIdentifier:e,options:t={}}){let r=this.instances.get(e);if(!r&&this.component&&(r=this.component.instanceFactory(this.container,{instanceIdentifier:dM(e),options:t}),this.instances.set(e,r),this.instancesOptions.set(e,t),this.invokeOnInitCallbacks(r,e),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,e,r)}catch{}return r||null}normalizeInstanceIdentifier(e=ta){return this.component?this.component.multipleInstances?e:ta:e}shouldAutoInitialize(){return!!this.component&&this.component.instantiationMode!=="EXPLICIT"}}function dM(n){return n===ta?void 0:n}function hM(n){return n.instantiationMode==="EAGER"}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class h1{constructor(e){this.name=e,this.providers=new Map}addComponent(e){const t=this.getProvider(e.name);if(t.isComponentSet())throw new Error(`Component ${e.name} has already been registered with ${this.name}`);t.setComponent(e)}addOrOverwriteComponent(e){this.getProvider(e.name).isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)}getProvider(e){if(this.providers.has(e))return this.providers.get(e);const t=new W_(e,this);return this.providers.set(e,t),t}getProviders(){return Array.from(this.providers.values())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var st;(function(n){n[n.DEBUG=0]="DEBUG",n[n.VERBOSE=1]="VERBOSE",n[n.INFO=2]="INFO",n[n.WARN=3]="WARN",n[n.ERROR=4]="ERROR",n[n.SILENT=5]="SILENT"})(st||(st={}));const fM={debug:st.DEBUG,verbose:st.VERBOSE,info:st.INFO,warn:st.WARN,error:st.ERROR,silent:st.SILENT},pM=st.INFO,gM={[st.DEBUG]:"log",[st.VERBOSE]:"log",[st.INFO]:"info",[st.WARN]:"warn",[st.ERROR]:"error"},mM=(n,e,...t)=>{if(e<n.logLevel)return;const r=new Date().toISOString(),s=gM[e];if(s)console[s](`[${r}]  ${n.name}:`,...t);else throw new Error(`Attempted to log a message with an invalid logType (value: ${e})`)};class ch{constructor(e){this.name=e,this._logLevel=pM,this._logHandler=mM,this._userLogHandler=null}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in st))throw new TypeError(`Invalid value "${e}" assigned to \`logLevel\``);this._logLevel=e}setLogLevel(e){this._logLevel=typeof e=="string"?fM[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if(typeof e!="function")throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(...e){this._userLogHandler&&this._userLogHandler(this,st.DEBUG,...e),this._logHandler(this,st.DEBUG,...e)}log(...e){this._userLogHandler&&this._userLogHandler(this,st.VERBOSE,...e),this._logHandler(this,st.VERBOSE,...e)}info(...e){this._userLogHandler&&this._userLogHandler(this,st.INFO,...e),this._logHandler(this,st.INFO,...e)}warn(...e){this._userLogHandler&&this._userLogHandler(this,st.WARN,...e),this._logHandler(this,st.WARN,...e)}error(...e){this._userLogHandler&&this._userLogHandler(this,st.ERROR,...e),this._logHandler(this,st.ERROR,...e)}}const yM=(n,e)=>e.some(t=>n instanceof t);let qS,WS;function _M(){return qS||(qS=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function vM(){return WS||(WS=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const f1=new WeakMap,G_=new WeakMap,p1=new WeakMap,Sy=new WeakMap,q0=new WeakMap;function wM(n){const e=new Promise((t,r)=>{const s=()=>{n.removeEventListener("success",i),n.removeEventListener("error",o)},i=()=>{t(Gs(n.result)),s()},o=()=>{r(n.error),s()};n.addEventListener("success",i),n.addEventListener("error",o)});return e.then(t=>{t instanceof IDBCursor&&f1.set(t,n)}).catch(()=>{}),q0.set(e,n),e}function xM(n){if(G_.has(n))return;const e=new Promise((t,r)=>{const s=()=>{n.removeEventListener("complete",i),n.removeEventListener("error",o),n.removeEventListener("abort",o)},i=()=>{t(),s()},o=()=>{r(n.error||new DOMException("AbortError","AbortError")),s()};n.addEventListener("complete",i),n.addEventListener("error",o),n.addEventListener("abort",o)});G_.set(n,e)}let H_={get(n,e,t){if(n instanceof IDBTransaction){if(e==="done")return G_.get(n);if(e==="objectStoreNames")return n.objectStoreNames||p1.get(n);if(e==="store")return t.objectStoreNames[1]?void 0:t.objectStore(t.objectStoreNames[0])}return Gs(n[e])},set(n,e,t){return n[e]=t,!0},has(n,e){return n instanceof IDBTransaction&&(e==="done"||e==="store")?!0:e in n}};function IM(n){H_=n(H_)}function SM(n){return n===IDBDatabase.prototype.transaction&&!("objectStoreNames"in IDBTransaction.prototype)?function(e,...t){const r=n.call(Wf(this),e,...t);return p1.set(r,e.sort?e.sort():[e]),Gs(r)}:vM().includes(n)?function(...e){return n.apply(Wf(this),e),Gs(f1.get(this))}:function(...e){return Gs(n.apply(Wf(this),e))}}function EM(n){return typeof n=="function"?SM(n):(n instanceof IDBTransaction&&xM(n),yM(n,_M())?new Proxy(n,H_):n)}function Gs(n){if(n instanceof IDBRequest)return wM(n);if(Sy.has(n))return Sy.get(n);const e=EM(n);return e!==n&&(Sy.set(n,e),q0.set(e,n)),e}const Wf=n=>q0.get(n);function W0(n,e,{blocked:t,upgrade:r,blocking:s,terminated:i}={}){const o=indexedDB.open(n,e),a=Gs(o);return r&&o.addEventListener("upgradeneeded",l=>{r(Gs(o.result),l.oldVersion,l.newVersion,Gs(o.transaction),l)}),t&&o.addEventListener("blocked",l=>t(l.oldVersion,l.newVersion,l)),a.then(l=>{i&&l.addEventListener("close",()=>i()),s&&l.addEventListener("versionchange",u=>s(u.oldVersion,u.newVersion,u))}).catch(()=>{}),a}function TM(n,{blocked:e}={}){const t=indexedDB.deleteDatabase(n);return e&&t.addEventListener("blocked",r=>e(r.oldVersion,r)),Gs(t).then(()=>{})}const bM=["get","getKey","getAll","getAllKeys","count"],AM=["put","add","delete","clear"],Ey=new Map;function GS(n,e){if(!(n instanceof IDBDatabase&&!(e in n)&&typeof e=="string"))return;if(Ey.get(e))return Ey.get(e);const t=e.replace(/FromIndex$/,""),r=e!==t,s=AM.includes(t);if(!(t in(r?IDBIndex:IDBObjectStore).prototype)||!(s||bM.includes(t)))return;const i=async function(o,...a){const l=this.transaction(o,s?"readwrite":"readonly");let u=l.store;return r&&(u=u.index(a.shift())),(await Promise.all([u[t](...a),s&&l.done]))[0]};return Ey.set(e,i),i}IM(n=>({...n,get:(e,t,r)=>GS(e,t)||n.get(e,t,r),has:(e,t)=>!!GS(e,t)||n.has(e,t)}));const Lq=Object.freeze(Object.defineProperty({__proto__:null,deleteDB:TM,openDB:W0,unwrap:Wf,wrap:Gs},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class CM{constructor(e){this.container=e}getPlatformInfoString(){return this.container.getProviders().map(t=>{if(RM(t)){const r=t.getImmediate();return`${r.library}/${r.version}`}else return null}).filter(t=>t).join(" ")}}function RM(n){const e=n.getComponent();return(e==null?void 0:e.type)==="VERSION"}const Q_="@firebase/app",HS="0.14.1";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Si=new ch("@firebase/app"),NM="@firebase/app-compat",kM="@firebase/analytics-compat",PM="@firebase/analytics",DM="@firebase/app-check-compat",OM="@firebase/app-check",LM="@firebase/auth",MM="@firebase/auth-compat",jM="@firebase/database",VM="@firebase/data-connect",FM="@firebase/database-compat",UM="@firebase/functions",$M="@firebase/functions-compat",BM="@firebase/installations",zM="@firebase/installations-compat",qM="@firebase/messaging",WM="@firebase/messaging-compat",GM="@firebase/performance",HM="@firebase/performance-compat",QM="@firebase/remote-config",KM="@firebase/remote-config-compat",YM="@firebase/storage",JM="@firebase/storage-compat",XM="@firebase/firestore",ZM="@firebase/ai",ej="@firebase/firestore-compat",tj="firebase",nj="12.1.0";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Fp="[DEFAULT]",rj={[Q_]:"fire-core",[NM]:"fire-core-compat",[PM]:"fire-analytics",[kM]:"fire-analytics-compat",[OM]:"fire-app-check",[DM]:"fire-app-check-compat",[LM]:"fire-auth",[MM]:"fire-auth-compat",[jM]:"fire-rtdb",[VM]:"fire-data-connect",[FM]:"fire-rtdb-compat",[UM]:"fire-fn",[$M]:"fire-fn-compat",[BM]:"fire-iid",[zM]:"fire-iid-compat",[qM]:"fire-fcm",[WM]:"fire-fcm-compat",[GM]:"fire-perf",[HM]:"fire-perf-compat",[QM]:"fire-rc",[KM]:"fire-rc-compat",[YM]:"fire-gcs",[JM]:"fire-gcs-compat",[XM]:"fire-fst",[ej]:"fire-fst-compat",[ZM]:"fire-vertex","fire-js":"fire-js",[tj]:"fire-js-all"};/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Rd=new Map,sj=new Map,K_=new Map;function QS(n,e){try{n.container.addComponent(e)}catch(t){Si.debug(`Component ${e.name} failed to register with FirebaseApp ${n.name}`,t)}}function Ss(n){const e=n.name;if(K_.has(e))return Si.debug(`There were multiple attempts to register component ${e}.`),!1;K_.set(e,n);for(const t of Rd.values())QS(t,n);for(const t of sj.values())QS(t,n);return!0}function ti(n,e){const t=n.container.getProvider("heartbeat").getImmediate({optional:!0});return t&&t.triggerHeartbeat(),n.container.getProvider(e)}function ij(n,e,t=Fp){ti(n,e).clearInstance(t)}function Qt(n){return n==null?!1:n.settings!==void 0}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const oj={"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."},yo=new Ha("app","Firebase",oj);/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class aj{constructor(e,t,r){this._isDeleted=!1,this._options={...e},this._config={...t},this._name=t.name,this._automaticDataCollectionEnabled=t.automaticDataCollectionEnabled,this._container=r,this.container.addComponent(new Nr("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this.checkDestroyed(),this._automaticDataCollectionEnabled=e}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(e){this._isDeleted=e}checkDestroyed(){if(this.isDeleted)throw yo.create("app-deleted",{appName:this._name})}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ka=nj;function g1(n,e={}){let t=n;typeof e!="object"&&(e={name:e});const r={name:Fp,automaticDataCollectionEnabled:!0,...e},s=r.name;if(typeof s!="string"||!s)throw yo.create("bad-app-name",{appName:String(s)});if(t||(t=n1()),!t)throw yo.create("no-options");const i=Rd.get(s);if(i){if(qr(t,i.options)&&qr(r,i.config))return i;throw yo.create("duplicate-app",{appName:s})}const o=new h1(s);for(const l of K_.values())o.addComponent(l);const a=new aj(t,r,o);return Rd.set(s,a),a}function uh(n=Fp){const e=Rd.get(n);if(!e&&n===Fp&&n1())return g1();if(!e)throw yo.create("no-app",{appName:n});return e}function lj(){return Array.from(Rd.values())}function Cr(n,e,t){let r=rj[n]??n;t&&(r+=`-${t}`);const s=r.match(/\s|\//),i=e.match(/\s|\//);if(s||i){const o=[`Unable to register library "${r}" with version "${e}":`];s&&o.push(`library name "${r}" contains illegal characters (whitespace or "/")`),s&&i&&o.push("and"),i&&o.push(`version name "${e}" contains illegal characters (whitespace or "/")`),Si.warn(o.join(" "));return}Ss(new Nr(`${r}-version`,()=>({library:r,version:e}),"VERSION"))}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const cj="firebase-heartbeat-database",uj=1,Nd="firebase-heartbeat-store";let Ty=null;function m1(){return Ty||(Ty=W0(cj,uj,{upgrade:(n,e)=>{switch(e){case 0:try{n.createObjectStore(Nd)}catch(t){console.warn(t)}}}}).catch(n=>{throw yo.create("idb-open",{originalErrorMessage:n.message})})),Ty}async function dj(n){try{const t=(await m1()).transaction(Nd),r=await t.objectStore(Nd).get(y1(n));return await t.done,r}catch(e){if(e instanceof Es)Si.warn(e.message);else{const t=yo.create("idb-get",{originalErrorMessage:e==null?void 0:e.message});Si.warn(t.message)}}}async function KS(n,e){try{const r=(await m1()).transaction(Nd,"readwrite");await r.objectStore(Nd).put(e,y1(n)),await r.done}catch(t){if(t instanceof Es)Si.warn(t.message);else{const r=yo.create("idb-set",{originalErrorMessage:t==null?void 0:t.message});Si.warn(r.message)}}}function y1(n){return`${n.name}!${n.options.appId}`}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const hj=1024,fj=30;class pj{constructor(e){this.container=e,this._heartbeatsCache=null;const t=this.container.getProvider("app").getImmediate();this._storage=new mj(t),this._heartbeatsCachePromise=this._storage.read().then(r=>(this._heartbeatsCache=r,r))}async triggerHeartbeat(){var e,t;try{const s=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),i=YS();if(((e=this._heartbeatsCache)==null?void 0:e.heartbeats)==null&&(this._heartbeatsCache=await this._heartbeatsCachePromise,((t=this._heartbeatsCache)==null?void 0:t.heartbeats)==null)||this._heartbeatsCache.lastSentHeartbeatDate===i||this._heartbeatsCache.heartbeats.some(o=>o.date===i))return;if(this._heartbeatsCache.heartbeats.push({date:i,agent:s}),this._heartbeatsCache.heartbeats.length>fj){const o=yj(this._heartbeatsCache.heartbeats);this._heartbeatsCache.heartbeats.splice(o,1)}return this._storage.overwrite(this._heartbeatsCache)}catch(r){Si.warn(r)}}async getHeartbeatsHeader(){var e;try{if(this._heartbeatsCache===null&&await this._heartbeatsCachePromise,((e=this._heartbeatsCache)==null?void 0:e.heartbeats)==null||this._heartbeatsCache.heartbeats.length===0)return"";const t=YS(),{heartbeatsToSend:r,unsentEntries:s}=gj(this._heartbeatsCache.heartbeats),i=Lp(JSON.stringify({version:2,heartbeats:r}));return this._heartbeatsCache.lastSentHeartbeatDate=t,s.length>0?(this._heartbeatsCache.heartbeats=s,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),i}catch(t){return Si.warn(t),""}}}function YS(){return new Date().toISOString().substring(0,10)}function gj(n,e=hj){const t=[];let r=n.slice();for(const s of n){const i=t.find(o=>o.agent===s.agent);if(i){if(i.dates.push(s.date),JS(t)>e){i.dates.pop();break}}else if(t.push({agent:s.agent,dates:[s.date]}),JS(t)>e){t.pop();break}r=r.slice(1)}return{heartbeatsToSend:t,unsentEntries:r}}class mj{constructor(e){this.app=e,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return Fg()?z0().then(()=>!0).catch(()=>!1):!1}async read(){if(await this._canUseIndexedDBPromise){const t=await dj(this.app);return t!=null&&t.heartbeats?t:{heartbeats:[]}}else return{heartbeats:[]}}async overwrite(e){if(await this._canUseIndexedDBPromise){const r=await this.read();return KS(this.app,{lastSentHeartbeatDate:e.lastSentHeartbeatDate??r.lastSentHeartbeatDate,heartbeats:e.heartbeats})}else return}async add(e){if(await this._canUseIndexedDBPromise){const r=await this.read();return KS(this.app,{lastSentHeartbeatDate:e.lastSentHeartbeatDate??r.lastSentHeartbeatDate,heartbeats:[...r.heartbeats,...e.heartbeats]})}else return}}function JS(n){return Lp(JSON.stringify({version:2,heartbeats:n})).length}function yj(n){if(n.length===0)return-1;let e=0,t=n[0].date;for(let r=1;r<n.length;r++)n[r].date<t&&(t=n[r].date,e=r);return e}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function _j(n){Ss(new Nr("platform-logger",e=>new CM(e),"PRIVATE")),Ss(new Nr("heartbeat",e=>new pj(e),"PRIVATE")),Cr(Q_,HS,n),Cr(Q_,HS,"esm2020"),Cr("fire-js","")}_j("");var vj="firebase",wj="12.1.0";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */Cr(vj,wj,"app");const XS="@firebase/database",ZS="1.1.0";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let _1="";function v1(n){_1=n}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class xj{constructor(e){this.domStorage_=e,this.prefix_="firebase:"}set(e,t){t==null?this.domStorage_.removeItem(this.prefixedName_(e)):this.domStorage_.setItem(this.prefixedName_(e),bn(t))}get(e){const t=this.domStorage_.getItem(this.prefixedName_(e));return t==null?null:Cd(t)}remove(e){this.domStorage_.removeItem(this.prefixedName_(e))}prefixedName_(e){return this.prefix_+e}toString(){return this.domStorage_.toString()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ij{constructor(){this.cache_={},this.isInMemoryStorage=!0}set(e,t){t==null?delete this.cache_[e]:this.cache_[e]=t}get(e){return Ts(this.cache_,e)?this.cache_[e]:null}remove(e){delete this.cache_[e]}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const w1=function(n){try{if(typeof window<"u"&&typeof window[n]<"u"){const e=window[n];return e.setItem("firebase:sentinel","cache"),e.removeItem("firebase:sentinel"),new xj(e)}}catch{}return new Ij},ha=w1("localStorage"),Y_=w1("sessionStorage");/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Gl=new ch("@firebase/database"),x1=function(){let n=1;return function(){return n++}}(),I1=function(n){const e=oM(n),t=new nM;t.update(e);const r=t.digest();return F0.encodeByteArray(r)},dh=function(...n){let e="";for(let t=0;t<n.length;t++){const r=n[t];Array.isArray(r)||r&&typeof r=="object"&&typeof r.length=="number"?e+=dh.apply(null,r):typeof r=="object"?e+=bn(r):e+=r,e+=" "}return e};let _a=null,eE=!0;const S1=function(n,e){te(!e||n===!0||n===!1,"Can't turn on custom loggers persistently."),n===!0?(Gl.logLevel=st.VERBOSE,_a=Gl.log.bind(Gl),e&&Y_.set("logging_enabled",!0)):typeof n=="function"?_a=n:(_a=null,Y_.remove("logging_enabled"))},Ln=function(...n){if(eE===!0&&(eE=!1,_a===null&&Y_.get("logging_enabled")===!0&&S1(!0)),_a){const e=dh.apply(null,n);_a(e)}},hh=function(n){return function(...e){Ln(n,...e)}},J_=function(...n){const e="FIREBASE INTERNAL ERROR: "+dh(...n);Gl.error(e)},Xs=function(...n){const e=`FIREBASE FATAL ERROR: ${dh(...n)}`;throw Gl.error(e),new Error(e)},or=function(...n){const e="FIREBASE WARNING: "+dh(...n);Gl.warn(e)},Sj=function(){typeof window<"u"&&window.location&&window.location.protocol&&window.location.protocol.indexOf("https:")!==-1&&or("Insecure Firebase access from a secure page. Please use https in calls to new Firebase().")},$g=function(n){return typeof n=="number"&&(n!==n||n===Number.POSITIVE_INFINITY||n===Number.NEGATIVE_INFINITY)},Ej=function(n){if(document.readyState==="complete")n();else{let e=!1;const t=function(){if(!document.body){setTimeout(t,Math.floor(10));return}e||(e=!0,n())};document.addEventListener?(document.addEventListener("DOMContentLoaded",t,!1),window.addEventListener("load",t,!1)):document.attachEvent&&(document.attachEvent("onreadystatechange",()=>{document.readyState==="complete"&&t()}),window.attachEvent("onload",t))}},To="[MIN_NAME]",Ei="[MAX_NAME]",Ya=function(n,e){if(n===e)return 0;if(n===To||e===Ei)return-1;if(e===To||n===Ei)return 1;{const t=tE(n),r=tE(e);return t!==null?r!==null?t-r===0?n.length-e.length:t-r:-1:r!==null?1:n<e?-1:1}},Tj=function(n,e){return n===e?0:n<e?-1:1},gu=function(n,e){if(e&&n in e)return e[n];throw new Error("Missing required key ("+n+") in object: "+bn(e))},G0=function(n){if(typeof n!="object"||n===null)return bn(n);const e=[];for(const r in n)e.push(r);e.sort();let t="{";for(let r=0;r<e.length;r++)r!==0&&(t+=","),t+=bn(e[r]),t+=":",t+=G0(n[e[r]]);return t+="}",t},E1=function(n,e){const t=n.length;if(t<=e)return[n];const r=[];for(let s=0;s<t;s+=e)s+e>t?r.push(n.substring(s,t)):r.push(n.substring(s,s+e));return r};function Fn(n,e){for(const t in n)n.hasOwnProperty(t)&&e(t,n[t])}const T1=function(n){te(!$g(n),"Invalid JSON number");const e=11,t=52,r=(1<<e-1)-1;let s,i,o,a,l;n===0?(i=0,o=0,s=1/n===-1/0?1:0):(s=n<0,n=Math.abs(n),n>=Math.pow(2,1-r)?(a=Math.min(Math.floor(Math.log(n)/Math.LN2),r),i=a+r,o=Math.round(n*Math.pow(2,t-a)-Math.pow(2,t))):(i=0,o=Math.round(n/Math.pow(2,1-r-t))));const u=[];for(l=t;l;l-=1)u.push(o%2?1:0),o=Math.floor(o/2);for(l=e;l;l-=1)u.push(i%2?1:0),i=Math.floor(i/2);u.push(s?1:0),u.reverse();const h=u.join("");let f="";for(l=0;l<64;l+=8){let p=parseInt(h.substr(l,8),2).toString(16);p.length===1&&(p="0"+p),f=f+p}return f.toLowerCase()},bj=function(){return!!(typeof window=="object"&&window.chrome&&window.chrome.extension&&!/^chrome/.test(window.location.href))},Aj=function(){return typeof Windows=="object"&&typeof Windows.UI=="object"};function Cj(n,e){let t="Unknown Error";n==="too_big"?t="The data requested exceeds the maximum size that can be accessed with a single request.":n==="permission_denied"?t="Client doesn't have permission to access the desired data.":n==="unavailable"&&(t="The service is unavailable");const r=new Error(n+" at "+e._path.toString()+": "+t);return r.code=n.toUpperCase(),r}const Rj=new RegExp("^-?(0*)\\d{1,10}$"),Nj=-2147483648,kj=2147483647,tE=function(n){if(Rj.test(n)){const e=Number(n);if(e>=Nj&&e<=kj)return e}return null},Vc=function(n){try{n()}catch(e){setTimeout(()=>{const t=e.stack||"";throw or("Exception was thrown by user callback.",t),e},Math.floor(0))}},Pj=function(){return(typeof window=="object"&&window.navigator&&window.navigator.userAgent||"").search(/googlebot|google webmaster tools|bingbot|yahoo! slurp|baiduspider|yandexbot|duckduckbot/i)>=0},Hu=function(n,e){const t=setTimeout(n,e);return typeof t=="number"&&typeof Deno<"u"&&Deno.unrefTimer?Deno.unrefTimer(t):typeof t=="object"&&t.unref&&t.unref(),t};/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Dj{constructor(e,t){this.appCheckProvider=t,this.appName=e.name,Qt(e)&&e.settings.appCheckToken&&(this.serverAppAppCheckToken=e.settings.appCheckToken),this.appCheck=t==null?void 0:t.getImmediate({optional:!0}),this.appCheck||t==null||t.get().then(r=>this.appCheck=r)}getToken(e){if(this.serverAppAppCheckToken){if(e)throw new Error("Attempted reuse of `FirebaseServerApp.appCheckToken` after previous usage failed.");return Promise.resolve({token:this.serverAppAppCheckToken})}return this.appCheck?this.appCheck.getToken(e):new Promise((t,r)=>{setTimeout(()=>{this.appCheck?this.getToken(e).then(t,r):t(null)},0)})}addTokenChangeListener(e){var t;(t=this.appCheckProvider)==null||t.get().then(r=>r.addTokenListener(e))}notifyForInvalidToken(){or(`Provided AppCheck credentials for the app named "${this.appName}" are invalid. This usually indicates your app was not initialized correctly.`)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Oj{constructor(e,t,r){this.appName_=e,this.firebaseOptions_=t,this.authProvider_=r,this.auth_=null,this.auth_=r.getImmediate({optional:!0}),this.auth_||r.onInit(s=>this.auth_=s)}getToken(e){return this.auth_?this.auth_.getToken(e).catch(t=>t&&t.code==="auth/token-not-initialized"?(Ln("Got auth/token-not-initialized error.  Treating as null token."),null):Promise.reject(t)):new Promise((t,r)=>{setTimeout(()=>{this.auth_?this.getToken(e).then(t,r):t(null)},0)})}addTokenChangeListener(e){this.auth_?this.auth_.addAuthTokenListener(e):this.authProvider_.get().then(t=>t.addAuthTokenListener(e))}removeTokenChangeListener(e){this.authProvider_.get().then(t=>t.removeAuthTokenListener(e))}notifyForInvalidToken(){let e='Provided authentication credentials for the app named "'+this.appName_+'" are invalid. This usually indicates your app was not initialized correctly. ';"credential"in this.firebaseOptions_?e+='Make sure the "credential" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':"serviceAccount"in this.firebaseOptions_?e+='Make sure the "serviceAccount" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':e+='Make sure the "apiKey" and "databaseURL" properties provided to initializeApp() match the values provided for your app at https://console.firebase.google.com/.',or(e)}}class Hl{constructor(e){this.accessToken=e}getToken(e){return Promise.resolve({accessToken:this.accessToken})}addTokenChangeListener(e){e(this.accessToken)}removeTokenChangeListener(e){}notifyForInvalidToken(){}}Hl.OWNER="owner";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const H0="5",b1="v",A1="s",C1="r",R1="f",N1=/(console\.firebase|firebase-console-\w+\.corp|firebase\.corp)\.google\.com/,k1="ls",P1="p",X_="ac",D1="websocket",O1="long_polling";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class L1{constructor(e,t,r,s,i=!1,o="",a=!1,l=!1,u=null){this.secure=t,this.namespace=r,this.webSocketOnly=s,this.nodeAdmin=i,this.persistenceKey=o,this.includeNamespaceInQueryParams=a,this.isUsingEmulator=l,this.emulatorOptions=u,this._host=e.toLowerCase(),this._domain=this._host.substr(this._host.indexOf(".")+1),this.internalHost=ha.get("host:"+e)||this._host}isCacheableHost(){return this.internalHost.substr(0,2)==="s-"}isCustomHost(){return this._domain!=="firebaseio.com"&&this._domain!=="firebaseio-demo.com"}get host(){return this._host}set host(e){e!==this.internalHost&&(this.internalHost=e,this.isCacheableHost()&&ha.set("host:"+this._host,this.internalHost))}toString(){let e=this.toURLString();return this.persistenceKey&&(e+="<"+this.persistenceKey+">"),e}toURLString(){const e=this.secure?"https://":"http://",t=this.includeNamespaceInQueryParams?`?ns=${this.namespace}`:"";return`${e}${this.host}/${t}`}}function Lj(n){return n.host!==n.internalHost||n.isCustomHost()||n.includeNamespaceInQueryParams}function M1(n,e,t){te(typeof e=="string","typeof type must == string"),te(typeof t=="object","typeof params must == object");let r;if(e===D1)r=(n.secure?"wss://":"ws://")+n.internalHost+"/.ws?";else if(e===O1)r=(n.secure?"https://":"http://")+n.internalHost+"/.lp?";else throw new Error("Unknown connection type: "+e);Lj(n)&&(t.ns=n.namespace);const s=[];return Fn(t,(i,o)=>{s.push(i+"="+o)}),r+s.join("&")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Mj{constructor(){this.counters_={}}incrementCounter(e,t=1){Ts(this.counters_,e)||(this.counters_[e]=0),this.counters_[e]+=t}get(){return BL(this.counters_)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const by={},Ay={};function Q0(n){const e=n.toString();return by[e]||(by[e]=new Mj),by[e]}function jj(n,e){const t=n.toString();return Ay[t]||(Ay[t]=e()),Ay[t]}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Vj{constructor(e){this.onMessage_=e,this.pendingResponses=[],this.currentResponseNum=0,this.closeAfterResponse=-1,this.onClose=null}closeAfter(e,t){this.closeAfterResponse=e,this.onClose=t,this.closeAfterResponse<this.currentResponseNum&&(this.onClose(),this.onClose=null)}handleResponse(e,t){for(this.pendingResponses[e]=t;this.pendingResponses[this.currentResponseNum];){const r=this.pendingResponses[this.currentResponseNum];delete this.pendingResponses[this.currentResponseNum];for(let s=0;s<r.length;++s)r[s]&&Vc(()=>{this.onMessage_(r[s])});if(this.currentResponseNum===this.closeAfterResponse){this.onClose&&(this.onClose(),this.onClose=null);break}this.currentResponseNum++}}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const nE="start",Fj="close",Uj="pLPCommand",$j="pRTLPCB",j1="id",V1="pw",F1="ser",Bj="cb",zj="seg",qj="ts",Wj="d",Gj="dframe",U1=1870,$1=30,Hj=U1-$1,Qj=25e3,Kj=3e4;class ro{constructor(e,t,r,s,i,o,a){this.connId=e,this.repoInfo=t,this.applicationId=r,this.appCheckToken=s,this.authToken=i,this.transportSessionId=o,this.lastSessionId=a,this.bytesSent=0,this.bytesReceived=0,this.everConnected_=!1,this.log_=hh(e),this.stats_=Q0(t),this.urlFn=l=>(this.appCheckToken&&(l[X_]=this.appCheckToken),M1(t,O1,l))}open(e,t){this.curSegmentNum=0,this.onDisconnect_=t,this.myPacketOrderer=new Vj(e),this.isClosed_=!1,this.connectTimeoutTimer_=setTimeout(()=>{this.log_("Timed out trying to connect."),this.onClosed_(),this.connectTimeoutTimer_=null},Math.floor(Kj)),Ej(()=>{if(this.isClosed_)return;this.scriptTagHolder=new K0((...i)=>{const[o,a,l,u,h]=i;if(this.incrementIncomingBytes_(i),!!this.scriptTagHolder)if(this.connectTimeoutTimer_&&(clearTimeout(this.connectTimeoutTimer_),this.connectTimeoutTimer_=null),this.everConnected_=!0,o===nE)this.id=a,this.password=l;else if(o===Fj)a?(this.scriptTagHolder.sendNewPolls=!1,this.myPacketOrderer.closeAfter(a,()=>{this.onClosed_()})):this.onClosed_();else throw new Error("Unrecognized command received: "+o)},(...i)=>{const[o,a]=i;this.incrementIncomingBytes_(i),this.myPacketOrderer.handleResponse(o,a)},()=>{this.onClosed_()},this.urlFn);const r={};r[nE]="t",r[F1]=Math.floor(Math.random()*1e8),this.scriptTagHolder.uniqueCallbackIdentifier&&(r[Bj]=this.scriptTagHolder.uniqueCallbackIdentifier),r[b1]=H0,this.transportSessionId&&(r[A1]=this.transportSessionId),this.lastSessionId&&(r[k1]=this.lastSessionId),this.applicationId&&(r[P1]=this.applicationId),this.appCheckToken&&(r[X_]=this.appCheckToken),typeof location<"u"&&location.hostname&&N1.test(location.hostname)&&(r[C1]=R1);const s=this.urlFn(r);this.log_("Connecting via long-poll to "+s),this.scriptTagHolder.addTag(s,()=>{})})}start(){this.scriptTagHolder.startLongPoll(this.id,this.password),this.addDisconnectPingFrame(this.id,this.password)}static forceAllow(){ro.forceAllow_=!0}static forceDisallow(){ro.forceDisallow_=!0}static isAvailable(){return ro.forceAllow_?!0:!ro.forceDisallow_&&typeof document<"u"&&document.createElement!=null&&!bj()&&!Aj()}markConnectionHealthy(){}shutdown_(){this.isClosed_=!0,this.scriptTagHolder&&(this.scriptTagHolder.close(),this.scriptTagHolder=null),this.myDisconnFrame&&(document.body.removeChild(this.myDisconnFrame),this.myDisconnFrame=null),this.connectTimeoutTimer_&&(clearTimeout(this.connectTimeoutTimer_),this.connectTimeoutTimer_=null)}onClosed_(){this.isClosed_||(this.log_("Longpoll is closing itself"),this.shutdown_(),this.onDisconnect_&&(this.onDisconnect_(this.everConnected_),this.onDisconnect_=null))}close(){this.isClosed_||(this.log_("Longpoll is being closed."),this.shutdown_())}send(e){const t=bn(e);this.bytesSent+=t.length,this.stats_.incrementCounter("bytes_sent",t.length);const r=JC(t),s=E1(r,Hj);for(let i=0;i<s.length;i++)this.scriptTagHolder.enqueueSegment(this.curSegmentNum,s.length,s[i]),this.curSegmentNum++}addDisconnectPingFrame(e,t){this.myDisconnFrame=document.createElement("iframe");const r={};r[Gj]="t",r[j1]=e,r[V1]=t,this.myDisconnFrame.src=this.urlFn(r),this.myDisconnFrame.style.display="none",document.body.appendChild(this.myDisconnFrame)}incrementIncomingBytes_(e){const t=bn(e).length;this.bytesReceived+=t,this.stats_.incrementCounter("bytes_received",t)}}class K0{constructor(e,t,r,s){this.onDisconnect=r,this.urlFn=s,this.outstandingRequests=new Set,this.pendingSegs=[],this.currentSerial=Math.floor(Math.random()*1e8),this.sendNewPolls=!0;{this.uniqueCallbackIdentifier=x1(),window[Uj+this.uniqueCallbackIdentifier]=e,window[$j+this.uniqueCallbackIdentifier]=t,this.myIFrame=K0.createIFrame_();let i="";this.myIFrame.src&&this.myIFrame.src.substr(0,11)==="javascript:"&&(i='<script>document.domain="'+document.domain+'";<\/script>');const o="<html><body>"+i+"</body></html>";try{this.myIFrame.doc.open(),this.myIFrame.doc.write(o),this.myIFrame.doc.close()}catch(a){Ln("frame writing exception"),a.stack&&Ln(a.stack),Ln(a)}}}static createIFrame_(){const e=document.createElement("iframe");if(e.style.display="none",document.body){document.body.appendChild(e);try{e.contentWindow.document||Ln("No IE domain setting required")}catch{const r=document.domain;e.src="javascript:void((function(){document.open();document.domain='"+r+"';document.close();})())"}}else throw"Document body has not initialized. Wait to initialize Firebase until after the document is ready.";return e.contentDocument?e.doc=e.contentDocument:e.contentWindow?e.doc=e.contentWindow.document:e.document&&(e.doc=e.document),e}close(){this.alive=!1,this.myIFrame&&(this.myIFrame.doc.body.textContent="",setTimeout(()=>{this.myIFrame!==null&&(document.body.removeChild(this.myIFrame),this.myIFrame=null)},Math.floor(0)));const e=this.onDisconnect;e&&(this.onDisconnect=null,e())}startLongPoll(e,t){for(this.myID=e,this.myPW=t,this.alive=!0;this.newRequest_(););}newRequest_(){if(this.alive&&this.sendNewPolls&&this.outstandingRequests.size<(this.pendingSegs.length>0?2:1)){this.currentSerial++;const e={};e[j1]=this.myID,e[V1]=this.myPW,e[F1]=this.currentSerial;let t=this.urlFn(e),r="",s=0;for(;this.pendingSegs.length>0&&this.pendingSegs[0].d.length+$1+r.length<=U1;){const o=this.pendingSegs.shift();r=r+"&"+zj+s+"="+o.seg+"&"+qj+s+"="+o.ts+"&"+Wj+s+"="+o.d,s++}return t=t+r,this.addLongPollTag_(t,this.currentSerial),!0}else return!1}enqueueSegment(e,t,r){this.pendingSegs.push({seg:e,ts:t,d:r}),this.alive&&this.newRequest_()}addLongPollTag_(e,t){this.outstandingRequests.add(t);const r=()=>{this.outstandingRequests.delete(t),this.newRequest_()},s=setTimeout(r,Math.floor(Qj)),i=()=>{clearTimeout(s),r()};this.addTag(e,i)}addTag(e,t){setTimeout(()=>{try{if(!this.sendNewPolls)return;const r=this.myIFrame.doc.createElement("script");r.type="text/javascript",r.async=!0,r.src=e,r.onload=r.onreadystatechange=function(){const s=r.readyState;(!s||s==="loaded"||s==="complete")&&(r.onload=r.onreadystatechange=null,r.parentNode&&r.parentNode.removeChild(r),t())},r.onerror=()=>{Ln("Long-poll script failed to load: "+e),this.sendNewPolls=!1,this.close()},this.myIFrame.doc.body.appendChild(r)}catch{}},Math.floor(1))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Yj=16384,Jj=45e3;let Up=null;typeof MozWebSocket<"u"?Up=MozWebSocket:typeof WebSocket<"u"&&(Up=WebSocket);class es{constructor(e,t,r,s,i,o,a){this.connId=e,this.applicationId=r,this.appCheckToken=s,this.authToken=i,this.keepaliveTimer=null,this.frames=null,this.totalFrames=0,this.bytesSent=0,this.bytesReceived=0,this.log_=hh(this.connId),this.stats_=Q0(t),this.connURL=es.connectionURL_(t,o,a,s,r),this.nodeAdmin=t.nodeAdmin}static connectionURL_(e,t,r,s,i){const o={};return o[b1]=H0,typeof location<"u"&&location.hostname&&N1.test(location.hostname)&&(o[C1]=R1),t&&(o[A1]=t),r&&(o[k1]=r),s&&(o[X_]=s),i&&(o[P1]=i),M1(e,D1,o)}open(e,t){this.onDisconnect=t,this.onMessage=e,this.log_("Websocket connecting to "+this.connURL),this.everConnected_=!1,ha.set("previous_websocket_failure",!0);try{let r;a1(),this.mySock=new Up(this.connURL,[],r)}catch(r){this.log_("Error instantiating WebSocket.");const s=r.message||r.data;s&&this.log_(s),this.onClosed_();return}this.mySock.onopen=()=>{this.log_("Websocket connected."),this.everConnected_=!0},this.mySock.onclose=()=>{this.log_("Websocket connection was disconnected."),this.mySock=null,this.onClosed_()},this.mySock.onmessage=r=>{this.handleIncomingFrame(r)},this.mySock.onerror=r=>{this.log_("WebSocket error.  Closing connection.");const s=r.message||r.data;s&&this.log_(s),this.onClosed_()}}start(){}static forceDisallow(){es.forceDisallow_=!0}static isAvailable(){let e=!1;if(typeof navigator<"u"&&navigator.userAgent){const t=/Android ([0-9]{0,}\.[0-9]{0,})/,r=navigator.userAgent.match(t);r&&r.length>1&&parseFloat(r[1])<4.4&&(e=!0)}return!e&&Up!==null&&!es.forceDisallow_}static previouslyFailed(){return ha.isInMemoryStorage||ha.get("previous_websocket_failure")===!0}markConnectionHealthy(){ha.remove("previous_websocket_failure")}appendFrame_(e){if(this.frames.push(e),this.frames.length===this.totalFrames){const t=this.frames.join("");this.frames=null;const r=Cd(t);this.onMessage(r)}}handleNewFrameCount_(e){this.totalFrames=e,this.frames=[]}extractFrameCount_(e){if(te(this.frames===null,"We already have a frame buffer"),e.length<=6){const t=Number(e);if(!isNaN(t))return this.handleNewFrameCount_(t),null}return this.handleNewFrameCount_(1),e}handleIncomingFrame(e){if(this.mySock===null)return;const t=e.data;if(this.bytesReceived+=t.length,this.stats_.incrementCounter("bytes_received",t.length),this.resetKeepAlive(),this.frames!==null)this.appendFrame_(t);else{const r=this.extractFrameCount_(t);r!==null&&this.appendFrame_(r)}}send(e){this.resetKeepAlive();const t=bn(e);this.bytesSent+=t.length,this.stats_.incrementCounter("bytes_sent",t.length);const r=E1(t,Yj);r.length>1&&this.sendString_(String(r.length));for(let s=0;s<r.length;s++)this.sendString_(r[s])}shutdown_(){this.isClosed_=!0,this.keepaliveTimer&&(clearInterval(this.keepaliveTimer),this.keepaliveTimer=null),this.mySock&&(this.mySock.close(),this.mySock=null)}onClosed_(){this.isClosed_||(this.log_("WebSocket is closing itself"),this.shutdown_(),this.onDisconnect&&(this.onDisconnect(this.everConnected_),this.onDisconnect=null))}close(){this.isClosed_||(this.log_("WebSocket is being closed"),this.shutdown_())}resetKeepAlive(){clearInterval(this.keepaliveTimer),this.keepaliveTimer=setInterval(()=>{this.mySock&&this.sendString_("0"),this.resetKeepAlive()},Math.floor(Jj))}sendString_(e){try{this.mySock.send(e)}catch(t){this.log_("Exception thrown from WebSocket.send():",t.message||t.data,"Closing connection."),setTimeout(this.onClosed_.bind(this),0)}}}es.responsesRequiredToBeHealthy=2;es.healthyTimeout=3e4;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class lc{static get ALL_TRANSPORTS(){return[ro,es]}static get IS_TRANSPORT_INITIALIZED(){return this.globalTransportInitialized_}constructor(e){this.initTransports_(e)}initTransports_(e){const t=es&&es.isAvailable();let r=t&&!es.previouslyFailed();if(e.webSocketOnly&&(t||or("wss:// URL used, but browser isn't known to support websockets.  Trying anyway."),r=!0),r)this.transports_=[es];else{const s=this.transports_=[];for(const i of lc.ALL_TRANSPORTS)i&&i.isAvailable()&&s.push(i);lc.globalTransportInitialized_=!0}}initialTransport(){if(this.transports_.length>0)return this.transports_[0];throw new Error("No transports available")}upgradeTransport(){return this.transports_.length>1?this.transports_[1]:null}}lc.globalTransportInitialized_=!1;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Xj=6e4,Zj=5e3,eV=10*1024,tV=100*1024,Cy="t",rE="d",nV="s",sE="r",rV="e",iE="o",oE="a",aE="n",lE="p",sV="h";class iV{constructor(e,t,r,s,i,o,a,l,u,h){this.id=e,this.repoInfo_=t,this.applicationId_=r,this.appCheckToken_=s,this.authToken_=i,this.onMessage_=o,this.onReady_=a,this.onDisconnect_=l,this.onKill_=u,this.lastSessionId=h,this.connectionCount=0,this.pendingDataMessages=[],this.state_=0,this.log_=hh("c:"+this.id+":"),this.transportManager_=new lc(t),this.log_("Connection created"),this.start_()}start_(){const e=this.transportManager_.initialTransport();this.conn_=new e(this.nextTransportId_(),this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,null,this.lastSessionId),this.primaryResponsesRequired_=e.responsesRequiredToBeHealthy||0;const t=this.connReceiver_(this.conn_),r=this.disconnReceiver_(this.conn_);this.tx_=this.conn_,this.rx_=this.conn_,this.secondaryConn_=null,this.isHealthy_=!1,setTimeout(()=>{this.conn_&&this.conn_.open(t,r)},Math.floor(0));const s=e.healthyTimeout||0;s>0&&(this.healthyTimeout_=Hu(()=>{this.healthyTimeout_=null,this.isHealthy_||(this.conn_&&this.conn_.bytesReceived>tV?(this.log_("Connection exceeded healthy timeout but has received "+this.conn_.bytesReceived+" bytes.  Marking connection healthy."),this.isHealthy_=!0,this.conn_.markConnectionHealthy()):this.conn_&&this.conn_.bytesSent>eV?this.log_("Connection exceeded healthy timeout but has sent "+this.conn_.bytesSent+" bytes.  Leaving connection alive."):(this.log_("Closing unhealthy connection after timeout."),this.close()))},Math.floor(s)))}nextTransportId_(){return"c:"+this.id+":"+this.connectionCount++}disconnReceiver_(e){return t=>{e===this.conn_?this.onConnectionLost_(t):e===this.secondaryConn_?(this.log_("Secondary connection lost."),this.onSecondaryConnectionLost_()):this.log_("closing an old connection")}}connReceiver_(e){return t=>{this.state_!==2&&(e===this.rx_?this.onPrimaryMessageReceived_(t):e===this.secondaryConn_?this.onSecondaryMessageReceived_(t):this.log_("message on old connection"))}}sendRequest(e){const t={t:"d",d:e};this.sendData_(t)}tryCleanupConnection(){this.tx_===this.secondaryConn_&&this.rx_===this.secondaryConn_&&(this.log_("cleaning up and promoting a connection: "+this.secondaryConn_.connId),this.conn_=this.secondaryConn_,this.secondaryConn_=null)}onSecondaryControl_(e){if(Cy in e){const t=e[Cy];t===oE?this.upgradeIfSecondaryHealthy_():t===sE?(this.log_("Got a reset on secondary, closing it"),this.secondaryConn_.close(),(this.tx_===this.secondaryConn_||this.rx_===this.secondaryConn_)&&this.close()):t===iE&&(this.log_("got pong on secondary."),this.secondaryResponsesRequired_--,this.upgradeIfSecondaryHealthy_())}}onSecondaryMessageReceived_(e){const t=gu("t",e),r=gu("d",e);if(t==="c")this.onSecondaryControl_(r);else if(t==="d")this.pendingDataMessages.push(r);else throw new Error("Unknown protocol layer: "+t)}upgradeIfSecondaryHealthy_(){this.secondaryResponsesRequired_<=0?(this.log_("Secondary connection is healthy."),this.isHealthy_=!0,this.secondaryConn_.markConnectionHealthy(),this.proceedWithUpgrade_()):(this.log_("sending ping on secondary."),this.secondaryConn_.send({t:"c",d:{t:lE,d:{}}}))}proceedWithUpgrade_(){this.secondaryConn_.start(),this.log_("sending client ack on secondary"),this.secondaryConn_.send({t:"c",d:{t:oE,d:{}}}),this.log_("Ending transmission on primary"),this.conn_.send({t:"c",d:{t:aE,d:{}}}),this.tx_=this.secondaryConn_,this.tryCleanupConnection()}onPrimaryMessageReceived_(e){const t=gu("t",e),r=gu("d",e);t==="c"?this.onControl_(r):t==="d"&&this.onDataMessage_(r)}onDataMessage_(e){this.onPrimaryResponse_(),this.onMessage_(e)}onPrimaryResponse_(){this.isHealthy_||(this.primaryResponsesRequired_--,this.primaryResponsesRequired_<=0&&(this.log_("Primary connection is healthy."),this.isHealthy_=!0,this.conn_.markConnectionHealthy()))}onControl_(e){const t=gu(Cy,e);if(rE in e){const r=e[rE];if(t===sV){const s={...r};this.repoInfo_.isUsingEmulator&&(s.h=this.repoInfo_.host),this.onHandshake_(s)}else if(t===aE){this.log_("recvd end transmission on primary"),this.rx_=this.secondaryConn_;for(let s=0;s<this.pendingDataMessages.length;++s)this.onDataMessage_(this.pendingDataMessages[s]);this.pendingDataMessages=[],this.tryCleanupConnection()}else t===nV?this.onConnectionShutdown_(r):t===sE?this.onReset_(r):t===rV?J_("Server Error: "+r):t===iE?(this.log_("got pong on primary."),this.onPrimaryResponse_(),this.sendPingOnPrimaryIfNecessary_()):J_("Unknown control packet command: "+t)}}onHandshake_(e){const t=e.ts,r=e.v,s=e.h;this.sessionId=e.s,this.repoInfo_.host=s,this.state_===0&&(this.conn_.start(),this.onConnectionEstablished_(this.conn_,t),H0!==r&&or("Protocol version mismatch detected"),this.tryStartUpgrade_())}tryStartUpgrade_(){const e=this.transportManager_.upgradeTransport();e&&this.startUpgrade_(e)}startUpgrade_(e){this.secondaryConn_=new e(this.nextTransportId_(),this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,this.sessionId),this.secondaryResponsesRequired_=e.responsesRequiredToBeHealthy||0;const t=this.connReceiver_(this.secondaryConn_),r=this.disconnReceiver_(this.secondaryConn_);this.secondaryConn_.open(t,r),Hu(()=>{this.secondaryConn_&&(this.log_("Timed out trying to upgrade."),this.secondaryConn_.close())},Math.floor(Xj))}onReset_(e){this.log_("Reset packet received.  New host: "+e),this.repoInfo_.host=e,this.state_===1?this.close():(this.closeConnections_(),this.start_())}onConnectionEstablished_(e,t){this.log_("Realtime connection established."),this.conn_=e,this.state_=1,this.onReady_&&(this.onReady_(t,this.sessionId),this.onReady_=null),this.primaryResponsesRequired_===0?(this.log_("Primary connection is healthy."),this.isHealthy_=!0):Hu(()=>{this.sendPingOnPrimaryIfNecessary_()},Math.floor(Zj))}sendPingOnPrimaryIfNecessary_(){!this.isHealthy_&&this.state_===1&&(this.log_("sending ping on primary."),this.sendData_({t:"c",d:{t:lE,d:{}}}))}onSecondaryConnectionLost_(){const e=this.secondaryConn_;this.secondaryConn_=null,(this.tx_===e||this.rx_===e)&&this.close()}onConnectionLost_(e){this.conn_=null,!e&&this.state_===0?(this.log_("Realtime connection failed."),this.repoInfo_.isCacheableHost()&&(ha.remove("host:"+this.repoInfo_.host),this.repoInfo_.internalHost=this.repoInfo_.host)):this.state_===1&&this.log_("Realtime connection lost."),this.close()}onConnectionShutdown_(e){this.log_("Connection shutdown command received. Shutting down..."),this.onKill_&&(this.onKill_(e),this.onKill_=null),this.onDisconnect_=null,this.close()}sendData_(e){if(this.state_!==1)throw"Connection is not connected";this.tx_.send(e)}close(){this.state_!==2&&(this.log_("Closing realtime connection."),this.state_=2,this.closeConnections_(),this.onDisconnect_&&(this.onDisconnect_(),this.onDisconnect_=null))}closeConnections_(){this.log_("Shutting down all connections"),this.conn_&&(this.conn_.close(),this.conn_=null),this.secondaryConn_&&(this.secondaryConn_.close(),this.secondaryConn_=null),this.healthyTimeout_&&(clearTimeout(this.healthyTimeout_),this.healthyTimeout_=null)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class B1{put(e,t,r,s){}merge(e,t,r,s){}refreshAuthToken(e){}refreshAppCheckToken(e){}onDisconnectPut(e,t,r){}onDisconnectMerge(e,t,r){}onDisconnectCancel(e,t){}reportStats(e){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class z1{constructor(e){this.allowedEvents_=e,this.listeners_={},te(Array.isArray(e)&&e.length>0,"Requires a non-empty array")}trigger(e,...t){if(Array.isArray(this.listeners_[e])){const r=[...this.listeners_[e]];for(let s=0;s<r.length;s++)r[s].callback.apply(r[s].context,t)}}on(e,t,r){this.validateEventType_(e),this.listeners_[e]=this.listeners_[e]||[],this.listeners_[e].push({callback:t,context:r});const s=this.getInitialEvent(e);s&&t.apply(r,s)}off(e,t,r){this.validateEventType_(e);const s=this.listeners_[e]||[];for(let i=0;i<s.length;i++)if(s[i].callback===t&&(!r||r===s[i].context)){s.splice(i,1);return}}validateEventType_(e){te(this.allowedEvents_.find(t=>t===e),"Unknown event: "+e)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class $p extends z1{static getInstance(){return new $p}constructor(){super(["online"]),this.online_=!0,typeof window<"u"&&typeof window.addEventListener<"u"&&!$0()&&(window.addEventListener("online",()=>{this.online_||(this.online_=!0,this.trigger("online",!0))},!1),window.addEventListener("offline",()=>{this.online_&&(this.online_=!1,this.trigger("online",!1))},!1))}getInitialEvent(e){return te(e==="online","Unknown event type: "+e),[this.online_]}currentlyOnline(){return this.online_}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const cE=32,uE=768;class xt{constructor(e,t){if(t===void 0){this.pieces_=e.split("/");let r=0;for(let s=0;s<this.pieces_.length;s++)this.pieces_[s].length>0&&(this.pieces_[r]=this.pieces_[s],r++);this.pieces_.length=r,this.pieceNum_=0}else this.pieces_=e,this.pieceNum_=t}toString(){let e="";for(let t=this.pieceNum_;t<this.pieces_.length;t++)this.pieces_[t]!==""&&(e+="/"+this.pieces_[t]);return e||"/"}}function _t(){return new xt("")}function et(n){return n.pieceNum_>=n.pieces_.length?null:n.pieces_[n.pieceNum_]}function bo(n){return n.pieces_.length-n.pieceNum_}function Pt(n){let e=n.pieceNum_;return e<n.pieces_.length&&e++,new xt(n.pieces_,e)}function Y0(n){return n.pieceNum_<n.pieces_.length?n.pieces_[n.pieces_.length-1]:null}function oV(n){let e="";for(let t=n.pieceNum_;t<n.pieces_.length;t++)n.pieces_[t]!==""&&(e+="/"+encodeURIComponent(String(n.pieces_[t])));return e||"/"}function kd(n,e=0){return n.pieces_.slice(n.pieceNum_+e)}function q1(n){if(n.pieceNum_>=n.pieces_.length)return null;const e=[];for(let t=n.pieceNum_;t<n.pieces_.length-1;t++)e.push(n.pieces_[t]);return new xt(e,0)}function Kt(n,e){const t=[];for(let r=n.pieceNum_;r<n.pieces_.length;r++)t.push(n.pieces_[r]);if(e instanceof xt)for(let r=e.pieceNum_;r<e.pieces_.length;r++)t.push(e.pieces_[r]);else{const r=e.split("/");for(let s=0;s<r.length;s++)r[s].length>0&&t.push(r[s])}return new xt(t,0)}function tt(n){return n.pieceNum_>=n.pieces_.length}function pr(n,e){const t=et(n),r=et(e);if(t===null)return e;if(t===r)return pr(Pt(n),Pt(e));throw new Error("INTERNAL ERROR: innerPath ("+e+") is not within outerPath ("+n+")")}function aV(n,e){const t=kd(n,0),r=kd(e,0);for(let s=0;s<t.length&&s<r.length;s++){const i=Ya(t[s],r[s]);if(i!==0)return i}return t.length===r.length?0:t.length<r.length?-1:1}function J0(n,e){if(bo(n)!==bo(e))return!1;for(let t=n.pieceNum_,r=e.pieceNum_;t<=n.pieces_.length;t++,r++)if(n.pieces_[t]!==e.pieces_[r])return!1;return!0}function ns(n,e){let t=n.pieceNum_,r=e.pieceNum_;if(bo(n)>bo(e))return!1;for(;t<n.pieces_.length;){if(n.pieces_[t]!==e.pieces_[r])return!1;++t,++r}return!0}class lV{constructor(e,t){this.errorPrefix_=t,this.parts_=kd(e,0),this.byteLength_=Math.max(1,this.parts_.length);for(let r=0;r<this.parts_.length;r++)this.byteLength_+=Ug(this.parts_[r]);W1(this)}}function cV(n,e){n.parts_.length>0&&(n.byteLength_+=1),n.parts_.push(e),n.byteLength_+=Ug(e),W1(n)}function uV(n){const e=n.parts_.pop();n.byteLength_-=Ug(e),n.parts_.length>0&&(n.byteLength_-=1)}function W1(n){if(n.byteLength_>uE)throw new Error(n.errorPrefix_+"has a key path longer than "+uE+" bytes ("+n.byteLength_+").");if(n.parts_.length>cE)throw new Error(n.errorPrefix_+"path specified exceeds the maximum depth that can be written ("+cE+") or object contains a cycle "+na(n))}function na(n){return n.parts_.length===0?"":"in property '"+n.parts_.join(".")+"'"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class X0 extends z1{static getInstance(){return new X0}constructor(){super(["visible"]);let e,t;typeof document<"u"&&typeof document.addEventListener<"u"&&(typeof document.hidden<"u"?(t="visibilitychange",e="hidden"):typeof document.mozHidden<"u"?(t="mozvisibilitychange",e="mozHidden"):typeof document.msHidden<"u"?(t="msvisibilitychange",e="msHidden"):typeof document.webkitHidden<"u"&&(t="webkitvisibilitychange",e="webkitHidden")),this.visible_=!0,t&&document.addEventListener(t,()=>{const r=!document[e];r!==this.visible_&&(this.visible_=r,this.trigger("visible",r))},!1)}getInitialEvent(e){return te(e==="visible","Unknown event type: "+e),[this.visible_]}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const mu=1e3,dV=60*5*1e3,dE=30*1e3,hV=1.3,fV=3e4,pV="server_kill",hE=3;class ss extends B1{constructor(e,t,r,s,i,o,a,l){if(super(),this.repoInfo_=e,this.applicationId_=t,this.onDataUpdate_=r,this.onConnectStatus_=s,this.onServerInfoUpdate_=i,this.authTokenProvider_=o,this.appCheckTokenProvider_=a,this.authOverride_=l,this.id=ss.nextPersistentConnectionId_++,this.log_=hh("p:"+this.id+":"),this.interruptReasons_={},this.listens=new Map,this.outstandingPuts_=[],this.outstandingGets_=[],this.outstandingPutCount_=0,this.outstandingGetCount_=0,this.onDisconnectRequestQueue_=[],this.connected_=!1,this.reconnectDelay_=mu,this.maxReconnectDelay_=dV,this.securityDebugCallback_=null,this.lastSessionId=null,this.establishConnectionTimer_=null,this.visible_=!1,this.requestCBHash_={},this.requestNumber_=0,this.realtime_=null,this.authToken_=null,this.appCheckToken_=null,this.forceTokenRefresh_=!1,this.invalidAuthTokenCount_=0,this.invalidAppCheckTokenCount_=0,this.firstConnection_=!0,this.lastConnectionAttemptTime_=null,this.lastConnectionEstablishedTime_=null,l&&!a1())throw new Error("Auth override specified in options, but not supported on non Node.js platforms");X0.getInstance().on("visible",this.onVisible_,this),e.host.indexOf("fblocal")===-1&&$p.getInstance().on("online",this.onOnline_,this)}sendRequest(e,t,r){const s=++this.requestNumber_,i={r:s,a:e,b:t};this.log_(bn(i)),te(this.connected_,"sendRequest call when we're not connected not allowed."),this.realtime_.sendRequest(i),r&&(this.requestCBHash_[s]=r)}get(e){this.initConnection_();const t=new Mr,s={action:"g",request:{p:e._path.toString(),q:e._queryObject},onComplete:o=>{const a=o.d;o.s==="ok"?t.resolve(a):t.reject(a)}};this.outstandingGets_.push(s),this.outstandingGetCount_++;const i=this.outstandingGets_.length-1;return this.connected_&&this.sendGet_(i),t.promise}listen(e,t,r,s){this.initConnection_();const i=e._queryIdentifier,o=e._path.toString();this.log_("Listen called for "+o+" "+i),this.listens.has(o)||this.listens.set(o,new Map),te(e._queryParams.isDefault()||!e._queryParams.loadsAllData(),"listen() called for non-default but complete query"),te(!this.listens.get(o).has(i),"listen() called twice for same path/queryId.");const a={onComplete:s,hashFn:t,query:e,tag:r};this.listens.get(o).set(i,a),this.connected_&&this.sendListen_(a)}sendGet_(e){const t=this.outstandingGets_[e];this.sendRequest("g",t.request,r=>{delete this.outstandingGets_[e],this.outstandingGetCount_--,this.outstandingGetCount_===0&&(this.outstandingGets_=[]),t.onComplete&&t.onComplete(r)})}sendListen_(e){const t=e.query,r=t._path.toString(),s=t._queryIdentifier;this.log_("Listen on "+r+" for "+s);const i={p:r},o="q";e.tag&&(i.q=t._queryObject,i.t=e.tag),i.h=e.hashFn(),this.sendRequest(o,i,a=>{const l=a.d,u=a.s;ss.warnOnListenWarnings_(l,t),(this.listens.get(r)&&this.listens.get(r).get(s))===e&&(this.log_("listen response",a),u!=="ok"&&this.removeListen_(r,s),e.onComplete&&e.onComplete(u,l))})}static warnOnListenWarnings_(e,t){if(e&&typeof e=="object"&&Ts(e,"w")){const r=Ca(e,"w");if(Array.isArray(r)&&~r.indexOf("no_index")){const s='".indexOn": "'+t._queryParams.getIndex().toString()+'"',i=t._path.toString();or(`Using an unspecified index. Your data will be downloaded and filtered on the client. Consider adding ${s} at ${i} to your security rules for better performance.`)}}}refreshAuthToken(e){this.authToken_=e,this.log_("Auth token refreshed"),this.authToken_?this.tryAuth():this.connected_&&this.sendRequest("unauth",{},()=>{}),this.reduceReconnectDelayIfAdminCredential_(e)}reduceReconnectDelayIfAdminCredential_(e){(e&&e.length===40||tM(e))&&(this.log_("Admin auth credential detected.  Reducing max reconnect time."),this.maxReconnectDelay_=dE)}refreshAppCheckToken(e){this.appCheckToken_=e,this.log_("App check token refreshed"),this.appCheckToken_?this.tryAppCheck():this.connected_&&this.sendRequest("unappeck",{},()=>{})}tryAuth(){if(this.connected_&&this.authToken_){const e=this.authToken_,t=eM(e)?"auth":"gauth",r={cred:e};this.authOverride_===null?r.noauth=!0:typeof this.authOverride_=="object"&&(r.authvar=this.authOverride_),this.sendRequest(t,r,s=>{const i=s.s,o=s.d||"error";this.authToken_===e&&(i==="ok"?this.invalidAuthTokenCount_=0:this.onAuthRevoked_(i,o))})}}tryAppCheck(){this.connected_&&this.appCheckToken_&&this.sendRequest("appcheck",{token:this.appCheckToken_},e=>{const t=e.s,r=e.d||"error";t==="ok"?this.invalidAppCheckTokenCount_=0:this.onAppCheckRevoked_(t,r)})}unlisten(e,t){const r=e._path.toString(),s=e._queryIdentifier;this.log_("Unlisten called for "+r+" "+s),te(e._queryParams.isDefault()||!e._queryParams.loadsAllData(),"unlisten() called for non-default but complete query"),this.removeListen_(r,s)&&this.connected_&&this.sendUnlisten_(r,s,e._queryObject,t)}sendUnlisten_(e,t,r,s){this.log_("Unlisten on "+e+" for "+t);const i={p:e},o="n";s&&(i.q=r,i.t=s),this.sendRequest(o,i)}onDisconnectPut(e,t,r){this.initConnection_(),this.connected_?this.sendOnDisconnect_("o",e,t,r):this.onDisconnectRequestQueue_.push({pathString:e,action:"o",data:t,onComplete:r})}onDisconnectMerge(e,t,r){this.initConnection_(),this.connected_?this.sendOnDisconnect_("om",e,t,r):this.onDisconnectRequestQueue_.push({pathString:e,action:"om",data:t,onComplete:r})}onDisconnectCancel(e,t){this.initConnection_(),this.connected_?this.sendOnDisconnect_("oc",e,null,t):this.onDisconnectRequestQueue_.push({pathString:e,action:"oc",data:null,onComplete:t})}sendOnDisconnect_(e,t,r,s){const i={p:t,d:r};this.log_("onDisconnect "+e,i),this.sendRequest(e,i,o=>{s&&setTimeout(()=>{s(o.s,o.d)},Math.floor(0))})}put(e,t,r,s){this.putInternal("p",e,t,r,s)}merge(e,t,r,s){this.putInternal("m",e,t,r,s)}putInternal(e,t,r,s,i){this.initConnection_();const o={p:t,d:r};i!==void 0&&(o.h=i),this.outstandingPuts_.push({action:e,request:o,onComplete:s}),this.outstandingPutCount_++;const a=this.outstandingPuts_.length-1;this.connected_?this.sendPut_(a):this.log_("Buffering put: "+t)}sendPut_(e){const t=this.outstandingPuts_[e].action,r=this.outstandingPuts_[e].request,s=this.outstandingPuts_[e].onComplete;this.outstandingPuts_[e].queued=this.connected_,this.sendRequest(t,r,i=>{this.log_(t+" response",i),delete this.outstandingPuts_[e],this.outstandingPutCount_--,this.outstandingPutCount_===0&&(this.outstandingPuts_=[]),s&&s(i.s,i.d)})}reportStats(e){if(this.connected_){const t={c:e};this.log_("reportStats",t),this.sendRequest("s",t,r=>{if(r.s!=="ok"){const i=r.d;this.log_("reportStats","Error sending stats: "+i)}})}}onDataMessage_(e){if("r"in e){this.log_("from server: "+bn(e));const t=e.r,r=this.requestCBHash_[t];r&&(delete this.requestCBHash_[t],r(e.b))}else{if("error"in e)throw"A server-side error has occurred: "+e.error;"a"in e&&this.onDataPush_(e.a,e.b)}}onDataPush_(e,t){this.log_("handleServerMessage",e,t),e==="d"?this.onDataUpdate_(t.p,t.d,!1,t.t):e==="m"?this.onDataUpdate_(t.p,t.d,!0,t.t):e==="c"?this.onListenRevoked_(t.p,t.q):e==="ac"?this.onAuthRevoked_(t.s,t.d):e==="apc"?this.onAppCheckRevoked_(t.s,t.d):e==="sd"?this.onSecurityDebugPacket_(t):J_("Unrecognized action received from server: "+bn(e)+`
Are you using the latest client?`)}onReady_(e,t){this.log_("connection ready"),this.connected_=!0,this.lastConnectionEstablishedTime_=new Date().getTime(),this.handleTimestamp_(e),this.lastSessionId=t,this.firstConnection_&&this.sendConnectStats_(),this.restoreState_(),this.firstConnection_=!1,this.onConnectStatus_(!0)}scheduleConnect_(e){te(!this.realtime_,"Scheduling a connect when we're already connected/ing?"),this.establishConnectionTimer_&&clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=setTimeout(()=>{this.establishConnectionTimer_=null,this.establishConnection_()},Math.floor(e))}initConnection_(){!this.realtime_&&this.firstConnection_&&this.scheduleConnect_(0)}onVisible_(e){e&&!this.visible_&&this.reconnectDelay_===this.maxReconnectDelay_&&(this.log_("Window became visible.  Reducing delay."),this.reconnectDelay_=mu,this.realtime_||this.scheduleConnect_(0)),this.visible_=e}onOnline_(e){e?(this.log_("Browser went online."),this.reconnectDelay_=mu,this.realtime_||this.scheduleConnect_(0)):(this.log_("Browser went offline.  Killing connection."),this.realtime_&&this.realtime_.close())}onRealtimeDisconnect_(){if(this.log_("data client disconnected"),this.connected_=!1,this.realtime_=null,this.cancelSentTransactions_(),this.requestCBHash_={},this.shouldReconnect_()){this.visible_?this.lastConnectionEstablishedTime_&&(new Date().getTime()-this.lastConnectionEstablishedTime_>fV&&(this.reconnectDelay_=mu),this.lastConnectionEstablishedTime_=null):(this.log_("Window isn't visible.  Delaying reconnect."),this.reconnectDelay_=this.maxReconnectDelay_,this.lastConnectionAttemptTime_=new Date().getTime());const e=Math.max(0,new Date().getTime()-this.lastConnectionAttemptTime_);let t=Math.max(0,this.reconnectDelay_-e);t=Math.random()*t,this.log_("Trying to reconnect in "+t+"ms"),this.scheduleConnect_(t),this.reconnectDelay_=Math.min(this.maxReconnectDelay_,this.reconnectDelay_*hV)}this.onConnectStatus_(!1)}async establishConnection_(){if(this.shouldReconnect_()){this.log_("Making a connection attempt"),this.lastConnectionAttemptTime_=new Date().getTime(),this.lastConnectionEstablishedTime_=null;const e=this.onDataMessage_.bind(this),t=this.onReady_.bind(this),r=this.onRealtimeDisconnect_.bind(this),s=this.id+":"+ss.nextConnectionId_++,i=this.lastSessionId;let o=!1,a=null;const l=function(){a?a.close():(o=!0,r())},u=function(f){te(a,"sendRequest call when we're not connected not allowed."),a.sendRequest(f)};this.realtime_={close:l,sendRequest:u};const h=this.forceTokenRefresh_;this.forceTokenRefresh_=!1;try{const[f,p]=await Promise.all([this.authTokenProvider_.getToken(h),this.appCheckTokenProvider_.getToken(h)]);o?Ln("getToken() completed but was canceled"):(Ln("getToken() completed. Creating connection."),this.authToken_=f&&f.accessToken,this.appCheckToken_=p&&p.token,a=new iV(s,this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,e,t,r,y=>{or(y+" ("+this.repoInfo_.toString()+")"),this.interrupt(pV)},i))}catch(f){this.log_("Failed to get token: "+f),o||(this.repoInfo_.nodeAdmin&&or(f),l())}}}interrupt(e){Ln("Interrupting connection for reason: "+e),this.interruptReasons_[e]=!0,this.realtime_?this.realtime_.close():(this.establishConnectionTimer_&&(clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=null),this.connected_&&this.onRealtimeDisconnect_())}resume(e){Ln("Resuming connection for reason: "+e),delete this.interruptReasons_[e],jp(this.interruptReasons_)&&(this.reconnectDelay_=mu,this.realtime_||this.scheduleConnect_(0))}handleTimestamp_(e){const t=e-new Date().getTime();this.onServerInfoUpdate_({serverTimeOffset:t})}cancelSentTransactions_(){for(let e=0;e<this.outstandingPuts_.length;e++){const t=this.outstandingPuts_[e];t&&"h"in t.request&&t.queued&&(t.onComplete&&t.onComplete("disconnect"),delete this.outstandingPuts_[e],this.outstandingPutCount_--)}this.outstandingPutCount_===0&&(this.outstandingPuts_=[])}onListenRevoked_(e,t){let r;t?r=t.map(i=>G0(i)).join("$"):r="default";const s=this.removeListen_(e,r);s&&s.onComplete&&s.onComplete("permission_denied")}removeListen_(e,t){const r=new xt(e).toString();let s;if(this.listens.has(r)){const i=this.listens.get(r);s=i.get(t),i.delete(t),i.size===0&&this.listens.delete(r)}else s=void 0;return s}onAuthRevoked_(e,t){Ln("Auth token revoked: "+e+"/"+t),this.authToken_=null,this.forceTokenRefresh_=!0,this.realtime_.close(),(e==="invalid_token"||e==="permission_denied")&&(this.invalidAuthTokenCount_++,this.invalidAuthTokenCount_>=hE&&(this.reconnectDelay_=dE,this.authTokenProvider_.notifyForInvalidToken()))}onAppCheckRevoked_(e,t){Ln("App check token revoked: "+e+"/"+t),this.appCheckToken_=null,this.forceTokenRefresh_=!0,(e==="invalid_token"||e==="permission_denied")&&(this.invalidAppCheckTokenCount_++,this.invalidAppCheckTokenCount_>=hE&&this.appCheckTokenProvider_.notifyForInvalidToken())}onSecurityDebugPacket_(e){this.securityDebugCallback_?this.securityDebugCallback_(e):"msg"in e&&console.log("FIREBASE: "+e.msg.replace(`
`,`
FIREBASE: `))}restoreState_(){this.tryAuth(),this.tryAppCheck();for(const e of this.listens.values())for(const t of e.values())this.sendListen_(t);for(let e=0;e<this.outstandingPuts_.length;e++)this.outstandingPuts_[e]&&this.sendPut_(e);for(;this.onDisconnectRequestQueue_.length;){const e=this.onDisconnectRequestQueue_.shift();this.sendOnDisconnect_(e.action,e.pathString,e.data,e.onComplete)}for(let e=0;e<this.outstandingGets_.length;e++)this.outstandingGets_[e]&&this.sendGet_(e)}sendConnectStats_(){const e={};let t="js";e["sdk."+t+"."+_1.replace(/\./g,"-")]=1,$0()?e["framework.cordova"]=1:o1()&&(e["framework.reactnative"]=1),this.reportStats(e)}shouldReconnect_(){const e=$p.getInstance().currentlyOnline();return jp(this.interruptReasons_)&&e}}ss.nextPersistentConnectionId_=0;ss.nextConnectionId_=0;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class nt{constructor(e,t){this.name=e,this.node=t}static Wrap(e,t){return new nt(e,t)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Bg{getCompare(){return this.compare.bind(this)}indexedValueChanged(e,t){const r=new nt(To,e),s=new nt(To,t);return this.compare(r,s)!==0}minPost(){return nt.MIN}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let yf;class G1 extends Bg{static get __EMPTY_NODE(){return yf}static set __EMPTY_NODE(e){yf=e}compare(e,t){return Ya(e.name,t.name)}isDefinedOn(e){throw jc("KeyIndex.isDefinedOn not expected to be called.")}indexedValueChanged(e,t){return!1}minPost(){return nt.MIN}maxPost(){return new nt(Ei,yf)}makePost(e,t){return te(typeof e=="string","KeyIndex indexValue must always be a string."),new nt(e,yf)}toString(){return".key"}}const Hs=new G1;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let _f=class{constructor(e,t,r,s,i=null){this.isReverse_=s,this.resultGenerator_=i,this.nodeStack_=[];let o=1;for(;!e.isEmpty();)if(e=e,o=t?r(e.key,t):1,s&&(o*=-1),o<0)this.isReverse_?e=e.left:e=e.right;else if(o===0){this.nodeStack_.push(e);break}else this.nodeStack_.push(e),this.isReverse_?e=e.right:e=e.left}getNext(){if(this.nodeStack_.length===0)return null;let e=this.nodeStack_.pop(),t;if(this.resultGenerator_?t=this.resultGenerator_(e.key,e.value):t={key:e.key,value:e.value},this.isReverse_)for(e=e.left;!e.isEmpty();)this.nodeStack_.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack_.push(e),e=e.left;return t}hasNext(){return this.nodeStack_.length>0}peek(){if(this.nodeStack_.length===0)return null;const e=this.nodeStack_[this.nodeStack_.length-1];return this.resultGenerator_?this.resultGenerator_(e.key,e.value):{key:e.key,value:e.value}}},Or=class ku{constructor(e,t,r,s,i){this.key=e,this.value=t,this.color=r??ku.RED,this.left=s??Fs.EMPTY_NODE,this.right=i??Fs.EMPTY_NODE}copy(e,t,r,s,i){return new ku(e??this.key,t??this.value,r??this.color,s??this.left,i??this.right)}count(){return this.left.count()+1+this.right.count()}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||!!e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min_(){return this.left.isEmpty()?this:this.left.min_()}minKey(){return this.min_().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,r){let s=this;const i=r(e,s.key);return i<0?s=s.copy(null,null,null,s.left.insert(e,t,r),null):i===0?s=s.copy(null,t,null,null,null):s=s.copy(null,null,null,null,s.right.insert(e,t,r)),s.fixUp_()}removeMin_(){if(this.left.isEmpty())return Fs.EMPTY_NODE;let e=this;return!e.left.isRed_()&&!e.left.left.isRed_()&&(e=e.moveRedLeft_()),e=e.copy(null,null,null,e.left.removeMin_(),null),e.fixUp_()}remove(e,t){let r,s;if(r=this,t(e,r.key)<0)!r.left.isEmpty()&&!r.left.isRed_()&&!r.left.left.isRed_()&&(r=r.moveRedLeft_()),r=r.copy(null,null,null,r.left.remove(e,t),null);else{if(r.left.isRed_()&&(r=r.rotateRight_()),!r.right.isEmpty()&&!r.right.isRed_()&&!r.right.left.isRed_()&&(r=r.moveRedRight_()),t(e,r.key)===0){if(r.right.isEmpty())return Fs.EMPTY_NODE;s=r.right.min_(),r=r.copy(s.key,s.value,null,null,r.right.removeMin_())}r=r.copy(null,null,null,null,r.right.remove(e,t))}return r.fixUp_()}isRed_(){return this.color}fixUp_(){let e=this;return e.right.isRed_()&&!e.left.isRed_()&&(e=e.rotateLeft_()),e.left.isRed_()&&e.left.left.isRed_()&&(e=e.rotateRight_()),e.left.isRed_()&&e.right.isRed_()&&(e=e.colorFlip_()),e}moveRedLeft_(){let e=this.colorFlip_();return e.right.left.isRed_()&&(e=e.copy(null,null,null,null,e.right.rotateRight_()),e=e.rotateLeft_(),e=e.colorFlip_()),e}moveRedRight_(){let e=this.colorFlip_();return e.left.left.isRed_()&&(e=e.rotateRight_(),e=e.colorFlip_()),e}rotateLeft_(){const e=this.copy(null,null,ku.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight_(){const e=this.copy(null,null,ku.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip_(){const e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth_(){const e=this.check_();return Math.pow(2,e)<=this.count()+1}check_(){if(this.isRed_()&&this.left.isRed_())throw new Error("Red node has red child("+this.key+","+this.value+")");if(this.right.isRed_())throw new Error("Right child of ("+this.key+","+this.value+") is red");const e=this.left.check_();if(e!==this.right.check_())throw new Error("Black depths differ");return e+(this.isRed_()?0:1)}};Or.RED=!0;Or.BLACK=!1;class gV{copy(e,t,r,s,i){return this}insert(e,t,r){return new Or(e,t,null)}remove(e,t){return this}count(){return 0}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}check_(){return 0}isRed_(){return!1}}let Fs=class Gf{constructor(e,t=Gf.EMPTY_NODE){this.comparator_=e,this.root_=t}insert(e,t){return new Gf(this.comparator_,this.root_.insert(e,t,this.comparator_).copy(null,null,Or.BLACK,null,null))}remove(e){return new Gf(this.comparator_,this.root_.remove(e,this.comparator_).copy(null,null,Or.BLACK,null,null))}get(e){let t,r=this.root_;for(;!r.isEmpty();){if(t=this.comparator_(e,r.key),t===0)return r.value;t<0?r=r.left:t>0&&(r=r.right)}return null}getPredecessorKey(e){let t,r=this.root_,s=null;for(;!r.isEmpty();)if(t=this.comparator_(e,r.key),t===0){if(r.left.isEmpty())return s?s.key:null;for(r=r.left;!r.right.isEmpty();)r=r.right;return r.key}else t<0?r=r.left:t>0&&(s=r,r=r.right);throw new Error("Attempted to find predecessor key for a nonexistent key.  What gives?")}isEmpty(){return this.root_.isEmpty()}count(){return this.root_.count()}minKey(){return this.root_.minKey()}maxKey(){return this.root_.maxKey()}inorderTraversal(e){return this.root_.inorderTraversal(e)}reverseTraversal(e){return this.root_.reverseTraversal(e)}getIterator(e){return new _f(this.root_,null,this.comparator_,!1,e)}getIteratorFrom(e,t){return new _f(this.root_,e,this.comparator_,!1,t)}getReverseIteratorFrom(e,t){return new _f(this.root_,e,this.comparator_,!0,t)}getReverseIterator(e){return new _f(this.root_,null,this.comparator_,!0,e)}};Fs.EMPTY_NODE=new gV;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function mV(n,e){return Ya(n.name,e.name)}function Z0(n,e){return Ya(n,e)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Z_;function yV(n){Z_=n}const H1=function(n){return typeof n=="number"?"number:"+T1(n):"string:"+n},Q1=function(n){if(n.isLeafNode()){const e=n.val();te(typeof e=="string"||typeof e=="number"||typeof e=="object"&&Ts(e,".sv"),"Priority must be a string or number.")}else te(n===Z_||n.isEmpty(),"priority of unexpected type.");te(n===Z_||n.getPriority().isEmpty(),"Priority nodes can't have a priority of their own.")};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let fE;class kn{static set __childrenNodeConstructor(e){fE=e}static get __childrenNodeConstructor(){return fE}constructor(e,t=kn.__childrenNodeConstructor.EMPTY_NODE){this.value_=e,this.priorityNode_=t,this.lazyHash_=null,te(this.value_!==void 0&&this.value_!==null,"LeafNode shouldn't be created with null/undefined value."),Q1(this.priorityNode_)}isLeafNode(){return!0}getPriority(){return this.priorityNode_}updatePriority(e){return new kn(this.value_,e)}getImmediateChild(e){return e===".priority"?this.priorityNode_:kn.__childrenNodeConstructor.EMPTY_NODE}getChild(e){return tt(e)?this:et(e)===".priority"?this.priorityNode_:kn.__childrenNodeConstructor.EMPTY_NODE}hasChild(){return!1}getPredecessorChildName(e,t){return null}updateImmediateChild(e,t){return e===".priority"?this.updatePriority(t):t.isEmpty()&&e!==".priority"?this:kn.__childrenNodeConstructor.EMPTY_NODE.updateImmediateChild(e,t).updatePriority(this.priorityNode_)}updateChild(e,t){const r=et(e);return r===null?t:t.isEmpty()&&r!==".priority"?this:(te(r!==".priority"||bo(e)===1,".priority must be the last token in a path"),this.updateImmediateChild(r,kn.__childrenNodeConstructor.EMPTY_NODE.updateChild(Pt(e),t)))}isEmpty(){return!1}numChildren(){return 0}forEachChild(e,t){return!1}val(e){return e&&!this.getPriority().isEmpty()?{".value":this.getValue(),".priority":this.getPriority().val()}:this.getValue()}hash(){if(this.lazyHash_===null){let e="";this.priorityNode_.isEmpty()||(e+="priority:"+H1(this.priorityNode_.val())+":");const t=typeof this.value_;e+=t+":",t==="number"?e+=T1(this.value_):e+=this.value_,this.lazyHash_=I1(e)}return this.lazyHash_}getValue(){return this.value_}compareTo(e){return e===kn.__childrenNodeConstructor.EMPTY_NODE?1:e instanceof kn.__childrenNodeConstructor?-1:(te(e.isLeafNode(),"Unknown node type"),this.compareToLeafNode_(e))}compareToLeafNode_(e){const t=typeof e.value_,r=typeof this.value_,s=kn.VALUE_TYPE_ORDER.indexOf(t),i=kn.VALUE_TYPE_ORDER.indexOf(r);return te(s>=0,"Unknown leaf type: "+t),te(i>=0,"Unknown leaf type: "+r),s===i?r==="object"?0:this.value_<e.value_?-1:this.value_===e.value_?0:1:i-s}withIndex(){return this}isIndexed(){return!0}equals(e){if(e===this)return!0;if(e.isLeafNode()){const t=e;return this.value_===t.value_&&this.priorityNode_.equals(t.priorityNode_)}else return!1}}kn.VALUE_TYPE_ORDER=["object","boolean","number","string"];/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let K1,Y1;function _V(n){K1=n}function vV(n){Y1=n}class wV extends Bg{compare(e,t){const r=e.node.getPriority(),s=t.node.getPriority(),i=r.compareTo(s);return i===0?Ya(e.name,t.name):i}isDefinedOn(e){return!e.getPriority().isEmpty()}indexedValueChanged(e,t){return!e.getPriority().equals(t.getPriority())}minPost(){return nt.MIN}maxPost(){return new nt(Ei,new kn("[PRIORITY-POST]",Y1))}makePost(e,t){const r=K1(e);return new nt(t,new kn("[PRIORITY-POST]",r))}toString(){return".priority"}}const Mt=new wV;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const xV=Math.log(2);class IV{constructor(e){const t=i=>parseInt(Math.log(i)/xV,10),r=i=>parseInt(Array(i+1).join("1"),2);this.count=t(e+1),this.current_=this.count-1;const s=r(this.count);this.bits_=e+1&s}nextBitIsOne(){const e=!(this.bits_&1<<this.current_);return this.current_--,e}}const Bp=function(n,e,t,r){n.sort(e);const s=function(l,u){const h=u-l;let f,p;if(h===0)return null;if(h===1)return f=n[l],p=t?t(f):f,new Or(p,f.node,Or.BLACK,null,null);{const y=parseInt(h/2,10)+l,w=s(l,y),S=s(y+1,u);return f=n[y],p=t?t(f):f,new Or(p,f.node,Or.BLACK,w,S)}},i=function(l){let u=null,h=null,f=n.length;const p=function(w,S){const k=f-w,E=f;f-=w;const x=s(k+1,E),N=n[k],P=t?t(N):N;y(new Or(P,N.node,S,null,x))},y=function(w){u?(u.left=w,u=w):(h=w,u=w)};for(let w=0;w<l.count;++w){const S=l.nextBitIsOne(),k=Math.pow(2,l.count-(w+1));S?p(k,Or.BLACK):(p(k,Or.BLACK),p(k,Or.RED))}return h},o=new IV(n.length),a=i(o);return new Fs(r||e,a)};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Ry;const gl={};class hi{static get Default(){return te(gl&&Mt,"ChildrenNode.ts has not been loaded"),Ry=Ry||new hi({".priority":gl},{".priority":Mt}),Ry}constructor(e,t){this.indexes_=e,this.indexSet_=t}get(e){const t=Ca(this.indexes_,e);if(!t)throw new Error("No index defined for "+e);return t instanceof Fs?t:null}hasIndex(e){return Ts(this.indexSet_,e.toString())}addIndex(e,t){te(e!==Hs,"KeyIndex always exists and isn't meant to be added to the IndexMap.");const r=[];let s=!1;const i=t.getIterator(nt.Wrap);let o=i.getNext();for(;o;)s=s||e.isDefinedOn(o.node),r.push(o),o=i.getNext();let a;s?a=Bp(r,e.getCompare()):a=gl;const l=e.toString(),u={...this.indexSet_};u[l]=e;const h={...this.indexes_};return h[l]=a,new hi(h,u)}addToIndexes(e,t){const r=Vp(this.indexes_,(s,i)=>{const o=Ca(this.indexSet_,i);if(te(o,"Missing index implementation for "+i),s===gl)if(o.isDefinedOn(e.node)){const a=[],l=t.getIterator(nt.Wrap);let u=l.getNext();for(;u;)u.name!==e.name&&a.push(u),u=l.getNext();return a.push(e),Bp(a,o.getCompare())}else return gl;else{const a=t.get(e.name);let l=s;return a&&(l=l.remove(new nt(e.name,a))),l.insert(e,e.node)}});return new hi(r,this.indexSet_)}removeFromIndexes(e,t){const r=Vp(this.indexes_,s=>{if(s===gl)return s;{const i=t.get(e.name);return i?s.remove(new nt(e.name,i)):s}});return new hi(r,this.indexSet_)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let yu;class Le{static get EMPTY_NODE(){return yu||(yu=new Le(new Fs(Z0),null,hi.Default))}constructor(e,t,r){this.children_=e,this.priorityNode_=t,this.indexMap_=r,this.lazyHash_=null,this.priorityNode_&&Q1(this.priorityNode_),this.children_.isEmpty()&&te(!this.priorityNode_||this.priorityNode_.isEmpty(),"An empty node cannot have a priority")}isLeafNode(){return!1}getPriority(){return this.priorityNode_||yu}updatePriority(e){return this.children_.isEmpty()?this:new Le(this.children_,e,this.indexMap_)}getImmediateChild(e){if(e===".priority")return this.getPriority();{const t=this.children_.get(e);return t===null?yu:t}}getChild(e){const t=et(e);return t===null?this:this.getImmediateChild(t).getChild(Pt(e))}hasChild(e){return this.children_.get(e)!==null}updateImmediateChild(e,t){if(te(t,"We should always be passing snapshot nodes"),e===".priority")return this.updatePriority(t);{const r=new nt(e,t);let s,i;t.isEmpty()?(s=this.children_.remove(e),i=this.indexMap_.removeFromIndexes(r,this.children_)):(s=this.children_.insert(e,t),i=this.indexMap_.addToIndexes(r,this.children_));const o=s.isEmpty()?yu:this.priorityNode_;return new Le(s,o,i)}}updateChild(e,t){const r=et(e);if(r===null)return t;{te(et(e)!==".priority"||bo(e)===1,".priority must be the last token in a path");const s=this.getImmediateChild(r).updateChild(Pt(e),t);return this.updateImmediateChild(r,s)}}isEmpty(){return this.children_.isEmpty()}numChildren(){return this.children_.count()}val(e){if(this.isEmpty())return null;const t={};let r=0,s=0,i=!0;if(this.forEachChild(Mt,(o,a)=>{t[o]=a.val(e),r++,i&&Le.INTEGER_REGEXP_.test(o)?s=Math.max(s,Number(o)):i=!1}),!e&&i&&s<2*r){const o=[];for(const a in t)o[a]=t[a];return o}else return e&&!this.getPriority().isEmpty()&&(t[".priority"]=this.getPriority().val()),t}hash(){if(this.lazyHash_===null){let e="";this.getPriority().isEmpty()||(e+="priority:"+H1(this.getPriority().val())+":"),this.forEachChild(Mt,(t,r)=>{const s=r.hash();s!==""&&(e+=":"+t+":"+s)}),this.lazyHash_=e===""?"":I1(e)}return this.lazyHash_}getPredecessorChildName(e,t,r){const s=this.resolveIndex_(r);if(s){const i=s.getPredecessorKey(new nt(e,t));return i?i.name:null}else return this.children_.getPredecessorKey(e)}getFirstChildName(e){const t=this.resolveIndex_(e);if(t){const r=t.minKey();return r&&r.name}else return this.children_.minKey()}getFirstChild(e){const t=this.getFirstChildName(e);return t?new nt(t,this.children_.get(t)):null}getLastChildName(e){const t=this.resolveIndex_(e);if(t){const r=t.maxKey();return r&&r.name}else return this.children_.maxKey()}getLastChild(e){const t=this.getLastChildName(e);return t?new nt(t,this.children_.get(t)):null}forEachChild(e,t){const r=this.resolveIndex_(e);return r?r.inorderTraversal(s=>t(s.name,s.node)):this.children_.inorderTraversal(t)}getIterator(e){return this.getIteratorFrom(e.minPost(),e)}getIteratorFrom(e,t){const r=this.resolveIndex_(t);if(r)return r.getIteratorFrom(e,s=>s);{const s=this.children_.getIteratorFrom(e.name,nt.Wrap);let i=s.peek();for(;i!=null&&t.compare(i,e)<0;)s.getNext(),i=s.peek();return s}}getReverseIterator(e){return this.getReverseIteratorFrom(e.maxPost(),e)}getReverseIteratorFrom(e,t){const r=this.resolveIndex_(t);if(r)return r.getReverseIteratorFrom(e,s=>s);{const s=this.children_.getReverseIteratorFrom(e.name,nt.Wrap);let i=s.peek();for(;i!=null&&t.compare(i,e)>0;)s.getNext(),i=s.peek();return s}}compareTo(e){return this.isEmpty()?e.isEmpty()?0:-1:e.isLeafNode()||e.isEmpty()?1:e===fh?-1:0}withIndex(e){if(e===Hs||this.indexMap_.hasIndex(e))return this;{const t=this.indexMap_.addIndex(e,this.children_);return new Le(this.children_,this.priorityNode_,t)}}isIndexed(e){return e===Hs||this.indexMap_.hasIndex(e)}equals(e){if(e===this)return!0;if(e.isLeafNode())return!1;{const t=e;if(this.getPriority().equals(t.getPriority()))if(this.children_.count()===t.children_.count()){const r=this.getIterator(Mt),s=t.getIterator(Mt);let i=r.getNext(),o=s.getNext();for(;i&&o;){if(i.name!==o.name||!i.node.equals(o.node))return!1;i=r.getNext(),o=s.getNext()}return i===null&&o===null}else return!1;else return!1}}resolveIndex_(e){return e===Hs?null:this.indexMap_.get(e.toString())}}Le.INTEGER_REGEXP_=/^(0|[1-9]\d*)$/;class SV extends Le{constructor(){super(new Fs(Z0),Le.EMPTY_NODE,hi.Default)}compareTo(e){return e===this?0:1}equals(e){return e===this}getPriority(){return this}getImmediateChild(e){return Le.EMPTY_NODE}isEmpty(){return!1}}const fh=new SV;Object.defineProperties(nt,{MIN:{value:new nt(To,Le.EMPTY_NODE)},MAX:{value:new nt(Ei,fh)}});G1.__EMPTY_NODE=Le.EMPTY_NODE;kn.__childrenNodeConstructor=Le;yV(fh);vV(fh);/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const EV=!0;function Zt(n,e=null){if(n===null)return Le.EMPTY_NODE;if(typeof n=="object"&&".priority"in n&&(e=n[".priority"]),te(e===null||typeof e=="string"||typeof e=="number"||typeof e=="object"&&".sv"in e,"Invalid priority type found: "+typeof e),typeof n=="object"&&".value"in n&&n[".value"]!==null&&(n=n[".value"]),typeof n!="object"||".sv"in n){const t=n;return new kn(t,Zt(e))}if(!(n instanceof Array)&&EV){const t=[];let r=!1;if(Fn(n,(o,a)=>{if(o.substring(0,1)!=="."){const l=Zt(a);l.isEmpty()||(r=r||!l.getPriority().isEmpty(),t.push(new nt(o,l)))}}),t.length===0)return Le.EMPTY_NODE;const i=Bp(t,mV,o=>o.name,Z0);if(r){const o=Bp(t,Mt.getCompare());return new Le(i,Zt(e),new hi({".priority":o},{".priority":Mt}))}else return new Le(i,Zt(e),hi.Default)}else{let t=Le.EMPTY_NODE;return Fn(n,(r,s)=>{if(Ts(n,r)&&r.substring(0,1)!=="."){const i=Zt(s);(i.isLeafNode()||!i.isEmpty())&&(t=t.updateImmediateChild(r,i))}}),t.updatePriority(Zt(e))}}_V(Zt);/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ew extends Bg{constructor(e){super(),this.indexPath_=e,te(!tt(e)&&et(e)!==".priority","Can't create PathIndex with empty path or .priority key")}extractChild(e){return e.getChild(this.indexPath_)}isDefinedOn(e){return!e.getChild(this.indexPath_).isEmpty()}compare(e,t){const r=this.extractChild(e.node),s=this.extractChild(t.node),i=r.compareTo(s);return i===0?Ya(e.name,t.name):i}makePost(e,t){const r=Zt(e),s=Le.EMPTY_NODE.updateChild(this.indexPath_,r);return new nt(t,s)}maxPost(){const e=Le.EMPTY_NODE.updateChild(this.indexPath_,fh);return new nt(Ei,e)}toString(){return kd(this.indexPath_,0).join("/")}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class TV extends Bg{compare(e,t){const r=e.node.compareTo(t.node);return r===0?Ya(e.name,t.name):r}isDefinedOn(e){return!0}indexedValueChanged(e,t){return!e.equals(t)}minPost(){return nt.MIN}maxPost(){return nt.MAX}makePost(e,t){const r=Zt(e);return new nt(t,r)}toString(){return".value"}}const tw=new TV;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function J1(n){return{type:"value",snapshotNode:n}}function cc(n,e){return{type:"child_added",snapshotNode:e,childName:n}}function Pd(n,e){return{type:"child_removed",snapshotNode:e,childName:n}}function Dd(n,e,t){return{type:"child_changed",snapshotNode:e,childName:n,oldSnap:t}}function bV(n,e){return{type:"child_moved",snapshotNode:e,childName:n}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class nw{constructor(e){this.index_=e}updateChild(e,t,r,s,i,o){te(e.isIndexed(this.index_),"A node must be indexed if only a child is updated");const a=e.getImmediateChild(t);return a.getChild(s).equals(r.getChild(s))&&a.isEmpty()===r.isEmpty()||(o!=null&&(r.isEmpty()?e.hasChild(t)?o.trackChildChange(Pd(t,a)):te(e.isLeafNode(),"A child remove without an old child only makes sense on a leaf node"):a.isEmpty()?o.trackChildChange(cc(t,r)):o.trackChildChange(Dd(t,r,a))),e.isLeafNode()&&r.isEmpty())?e:e.updateImmediateChild(t,r).withIndex(this.index_)}updateFullNode(e,t,r){return r!=null&&(e.isLeafNode()||e.forEachChild(Mt,(s,i)=>{t.hasChild(s)||r.trackChildChange(Pd(s,i))}),t.isLeafNode()||t.forEachChild(Mt,(s,i)=>{if(e.hasChild(s)){const o=e.getImmediateChild(s);o.equals(i)||r.trackChildChange(Dd(s,i,o))}else r.trackChildChange(cc(s,i))})),t.withIndex(this.index_)}updatePriority(e,t){return e.isEmpty()?Le.EMPTY_NODE:e.updatePriority(t)}filtersNodes(){return!1}getIndexedFilter(){return this}getIndex(){return this.index_}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Od{constructor(e){this.indexedFilter_=new nw(e.getIndex()),this.index_=e.getIndex(),this.startPost_=Od.getStartPost_(e),this.endPost_=Od.getEndPost_(e),this.startIsInclusive_=!e.startAfterSet_,this.endIsInclusive_=!e.endBeforeSet_}getStartPost(){return this.startPost_}getEndPost(){return this.endPost_}matches(e){const t=this.startIsInclusive_?this.index_.compare(this.getStartPost(),e)<=0:this.index_.compare(this.getStartPost(),e)<0,r=this.endIsInclusive_?this.index_.compare(e,this.getEndPost())<=0:this.index_.compare(e,this.getEndPost())<0;return t&&r}updateChild(e,t,r,s,i,o){return this.matches(new nt(t,r))||(r=Le.EMPTY_NODE),this.indexedFilter_.updateChild(e,t,r,s,i,o)}updateFullNode(e,t,r){t.isLeafNode()&&(t=Le.EMPTY_NODE);let s=t.withIndex(this.index_);s=s.updatePriority(Le.EMPTY_NODE);const i=this;return t.forEachChild(Mt,(o,a)=>{i.matches(new nt(o,a))||(s=s.updateImmediateChild(o,Le.EMPTY_NODE))}),this.indexedFilter_.updateFullNode(e,s,r)}updatePriority(e,t){return e}filtersNodes(){return!0}getIndexedFilter(){return this.indexedFilter_}getIndex(){return this.index_}static getStartPost_(e){if(e.hasStart()){const t=e.getIndexStartName();return e.getIndex().makePost(e.getIndexStartValue(),t)}else return e.getIndex().minPost()}static getEndPost_(e){if(e.hasEnd()){const t=e.getIndexEndName();return e.getIndex().makePost(e.getIndexEndValue(),t)}else return e.getIndex().maxPost()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class AV{constructor(e){this.withinDirectionalStart=t=>this.reverse_?this.withinEndPost(t):this.withinStartPost(t),this.withinDirectionalEnd=t=>this.reverse_?this.withinStartPost(t):this.withinEndPost(t),this.withinStartPost=t=>{const r=this.index_.compare(this.rangedFilter_.getStartPost(),t);return this.startIsInclusive_?r<=0:r<0},this.withinEndPost=t=>{const r=this.index_.compare(t,this.rangedFilter_.getEndPost());return this.endIsInclusive_?r<=0:r<0},this.rangedFilter_=new Od(e),this.index_=e.getIndex(),this.limit_=e.getLimit(),this.reverse_=!e.isViewFromLeft(),this.startIsInclusive_=!e.startAfterSet_,this.endIsInclusive_=!e.endBeforeSet_}updateChild(e,t,r,s,i,o){return this.rangedFilter_.matches(new nt(t,r))||(r=Le.EMPTY_NODE),e.getImmediateChild(t).equals(r)?e:e.numChildren()<this.limit_?this.rangedFilter_.getIndexedFilter().updateChild(e,t,r,s,i,o):this.fullLimitUpdateChild_(e,t,r,i,o)}updateFullNode(e,t,r){let s;if(t.isLeafNode()||t.isEmpty())s=Le.EMPTY_NODE.withIndex(this.index_);else if(this.limit_*2<t.numChildren()&&t.isIndexed(this.index_)){s=Le.EMPTY_NODE.withIndex(this.index_);let i;this.reverse_?i=t.getReverseIteratorFrom(this.rangedFilter_.getEndPost(),this.index_):i=t.getIteratorFrom(this.rangedFilter_.getStartPost(),this.index_);let o=0;for(;i.hasNext()&&o<this.limit_;){const a=i.getNext();if(this.withinDirectionalStart(a))if(this.withinDirectionalEnd(a))s=s.updateImmediateChild(a.name,a.node),o++;else break;else continue}}else{s=t.withIndex(this.index_),s=s.updatePriority(Le.EMPTY_NODE);let i;this.reverse_?i=s.getReverseIterator(this.index_):i=s.getIterator(this.index_);let o=0;for(;i.hasNext();){const a=i.getNext();o<this.limit_&&this.withinDirectionalStart(a)&&this.withinDirectionalEnd(a)?o++:s=s.updateImmediateChild(a.name,Le.EMPTY_NODE)}}return this.rangedFilter_.getIndexedFilter().updateFullNode(e,s,r)}updatePriority(e,t){return e}filtersNodes(){return!0}getIndexedFilter(){return this.rangedFilter_.getIndexedFilter()}getIndex(){return this.index_}fullLimitUpdateChild_(e,t,r,s,i){let o;if(this.reverse_){const f=this.index_.getCompare();o=(p,y)=>f(y,p)}else o=this.index_.getCompare();const a=e;te(a.numChildren()===this.limit_,"");const l=new nt(t,r),u=this.reverse_?a.getFirstChild(this.index_):a.getLastChild(this.index_),h=this.rangedFilter_.matches(l);if(a.hasChild(t)){const f=a.getImmediateChild(t);let p=s.getChildAfterChild(this.index_,u,this.reverse_);for(;p!=null&&(p.name===t||a.hasChild(p.name));)p=s.getChildAfterChild(this.index_,p,this.reverse_);const y=p==null?1:o(p,l);if(h&&!r.isEmpty()&&y>=0)return i!=null&&i.trackChildChange(Dd(t,r,f)),a.updateImmediateChild(t,r);{i!=null&&i.trackChildChange(Pd(t,f));const S=a.updateImmediateChild(t,Le.EMPTY_NODE);return p!=null&&this.rangedFilter_.matches(p)?(i!=null&&i.trackChildChange(cc(p.name,p.node)),S.updateImmediateChild(p.name,p.node)):S}}else return r.isEmpty()?e:h&&o(u,l)>=0?(i!=null&&(i.trackChildChange(Pd(u.name,u.node)),i.trackChildChange(cc(t,r))),a.updateImmediateChild(t,r).updateImmediateChild(u.name,Le.EMPTY_NODE)):e}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class rw{constructor(){this.limitSet_=!1,this.startSet_=!1,this.startNameSet_=!1,this.startAfterSet_=!1,this.endSet_=!1,this.endNameSet_=!1,this.endBeforeSet_=!1,this.limit_=0,this.viewFrom_="",this.indexStartValue_=null,this.indexStartName_="",this.indexEndValue_=null,this.indexEndName_="",this.index_=Mt}hasStart(){return this.startSet_}isViewFromLeft(){return this.viewFrom_===""?this.startSet_:this.viewFrom_==="l"}getIndexStartValue(){return te(this.startSet_,"Only valid if start has been set"),this.indexStartValue_}getIndexStartName(){return te(this.startSet_,"Only valid if start has been set"),this.startNameSet_?this.indexStartName_:To}hasEnd(){return this.endSet_}getIndexEndValue(){return te(this.endSet_,"Only valid if end has been set"),this.indexEndValue_}getIndexEndName(){return te(this.endSet_,"Only valid if end has been set"),this.endNameSet_?this.indexEndName_:Ei}hasLimit(){return this.limitSet_}hasAnchoredLimit(){return this.limitSet_&&this.viewFrom_!==""}getLimit(){return te(this.limitSet_,"Only valid if limit has been set"),this.limit_}getIndex(){return this.index_}loadsAllData(){return!(this.startSet_||this.endSet_||this.limitSet_)}isDefault(){return this.loadsAllData()&&this.index_===Mt}copy(){const e=new rw;return e.limitSet_=this.limitSet_,e.limit_=this.limit_,e.startSet_=this.startSet_,e.startAfterSet_=this.startAfterSet_,e.indexStartValue_=this.indexStartValue_,e.startNameSet_=this.startNameSet_,e.indexStartName_=this.indexStartName_,e.endSet_=this.endSet_,e.endBeforeSet_=this.endBeforeSet_,e.indexEndValue_=this.indexEndValue_,e.endNameSet_=this.endNameSet_,e.indexEndName_=this.indexEndName_,e.index_=this.index_,e.viewFrom_=this.viewFrom_,e}}function CV(n){return n.loadsAllData()?new nw(n.getIndex()):n.hasLimit()?new AV(n):new Od(n)}function RV(n,e){const t=n.copy();return t.limitSet_=!0,t.limit_=e,t.viewFrom_="l",t}function NV(n,e){const t=n.copy();return t.limitSet_=!0,t.limit_=e,t.viewFrom_="r",t}function ev(n,e,t){const r=n.copy();return r.startSet_=!0,e===void 0&&(e=null),r.indexStartValue_=e,t!=null?(r.startNameSet_=!0,r.indexStartName_=t):(r.startNameSet_=!1,r.indexStartName_=""),r}function kV(n,e,t){let r;return n.index_===Hs||t?r=ev(n,e,t):r=ev(n,e,Ei),r.startAfterSet_=!0,r}function tv(n,e,t){const r=n.copy();return r.endSet_=!0,e===void 0&&(e=null),r.indexEndValue_=e,t!==void 0?(r.endNameSet_=!0,r.indexEndName_=t):(r.endNameSet_=!1,r.indexEndName_=""),r}function PV(n,e,t){let r;return n.index_===Hs||t?r=tv(n,e,t):r=tv(n,e,To),r.endBeforeSet_=!0,r}function zg(n,e){const t=n.copy();return t.index_=e,t}function pE(n){const e={};if(n.isDefault())return e;let t;if(n.index_===Mt?t="$priority":n.index_===tw?t="$value":n.index_===Hs?t="$key":(te(n.index_ instanceof ew,"Unrecognized index type!"),t=n.index_.toString()),e.orderBy=bn(t),n.startSet_){const r=n.startAfterSet_?"startAfter":"startAt";e[r]=bn(n.indexStartValue_),n.startNameSet_&&(e[r]+=","+bn(n.indexStartName_))}if(n.endSet_){const r=n.endBeforeSet_?"endBefore":"endAt";e[r]=bn(n.indexEndValue_),n.endNameSet_&&(e[r]+=","+bn(n.indexEndName_))}return n.limitSet_&&(n.isViewFromLeft()?e.limitToFirst=n.limit_:e.limitToLast=n.limit_),e}function gE(n){const e={};if(n.startSet_&&(e.sp=n.indexStartValue_,n.startNameSet_&&(e.sn=n.indexStartName_),e.sin=!n.startAfterSet_),n.endSet_&&(e.ep=n.indexEndValue_,n.endNameSet_&&(e.en=n.indexEndName_),e.ein=!n.endBeforeSet_),n.limitSet_){e.l=n.limit_;let t=n.viewFrom_;t===""&&(n.isViewFromLeft()?t="l":t="r"),e.vf=t}return n.index_!==Mt&&(e.i=n.index_.toString()),e}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class zp extends B1{reportStats(e){throw new Error("Method not implemented.")}static getListenId_(e,t){return t!==void 0?"tag$"+t:(te(e._queryParams.isDefault(),"should have a tag if it's not a default query."),e._path.toString())}constructor(e,t,r,s){super(),this.repoInfo_=e,this.onDataUpdate_=t,this.authTokenProvider_=r,this.appCheckTokenProvider_=s,this.log_=hh("p:rest:"),this.listens_={}}listen(e,t,r,s){const i=e._path.toString();this.log_("Listen called for "+i+" "+e._queryIdentifier);const o=zp.getListenId_(e,r),a={};this.listens_[o]=a;const l=pE(e._queryParams);this.restRequest_(i+".json",l,(u,h)=>{let f=h;if(u===404&&(f=null,u=null),u===null&&this.onDataUpdate_(i,f,!1,r),Ca(this.listens_,o)===a){let p;u?u===401?p="permission_denied":p="rest_error:"+u:p="ok",s(p,null)}})}unlisten(e,t){const r=zp.getListenId_(e,t);delete this.listens_[r]}get(e){const t=pE(e._queryParams),r=e._path.toString(),s=new Mr;return this.restRequest_(r+".json",t,(i,o)=>{let a=o;i===404&&(a=null,i=null),i===null?(this.onDataUpdate_(r,a,!1,null),s.resolve(a)):s.reject(new Error(a))}),s.promise}refreshAuthToken(e){}restRequest_(e,t={},r){return t.format="export",Promise.all([this.authTokenProvider_.getToken(!1),this.appCheckTokenProvider_.getToken(!1)]).then(([s,i])=>{s&&s.accessToken&&(t.auth=s.accessToken),i&&i.token&&(t.ac=i.token);const o=(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host+e+"?ns="+this.repoInfo_.namespace+Qa(t);this.log_("Sending REST request for "+o);const a=new XMLHttpRequest;a.onreadystatechange=()=>{if(r&&a.readyState===4){this.log_("REST Response for "+o+" received. status:",a.status,"response:",a.responseText);let l=null;if(a.status>=200&&a.status<300){try{l=Cd(a.responseText)}catch{or("Failed to parse JSON response for "+o+": "+a.responseText)}r(null,l)}else a.status!==401&&a.status!==404&&or("Got unsuccessful REST response for "+o+" Status: "+a.status),r(a.status);r=null}},a.open("GET",o,!0),a.send()})}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class DV{constructor(){this.rootNode_=Le.EMPTY_NODE}getNode(e){return this.rootNode_.getChild(e)}updateSnapshot(e,t){this.rootNode_=this.rootNode_.updateChild(e,t)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function qp(){return{value:null,children:new Map}}function Fc(n,e,t){if(tt(e))n.value=t,n.children.clear();else if(n.value!==null)n.value=n.value.updateChild(e,t);else{const r=et(e);n.children.has(r)||n.children.set(r,qp());const s=n.children.get(r);e=Pt(e),Fc(s,e,t)}}function nv(n,e){if(tt(e))return n.value=null,n.children.clear(),!0;if(n.value!==null){if(n.value.isLeafNode())return!1;{const t=n.value;return n.value=null,t.forEachChild(Mt,(r,s)=>{Fc(n,new xt(r),s)}),nv(n,e)}}else if(n.children.size>0){const t=et(e);return e=Pt(e),n.children.has(t)&&nv(n.children.get(t),e)&&n.children.delete(t),n.children.size===0}else return!0}function rv(n,e,t){n.value!==null?t(e,n.value):OV(n,(r,s)=>{const i=new xt(e.toString()+"/"+r);rv(s,i,t)})}function OV(n,e){n.children.forEach((t,r)=>{e(r,t)})}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class LV{constructor(e){this.collection_=e,this.last_=null}get(){const e=this.collection_.get(),t={...e};return this.last_&&Fn(this.last_,(r,s)=>{t[r]=t[r]-s}),this.last_=e,t}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const mE=10*1e3,MV=30*1e3,jV=5*60*1e3;class VV{constructor(e,t){this.server_=t,this.statsToReport_={},this.statsListener_=new LV(e);const r=mE+(MV-mE)*Math.random();Hu(this.reportStats_.bind(this),Math.floor(r))}reportStats_(){const e=this.statsListener_.get(),t={};let r=!1;Fn(e,(s,i)=>{i>0&&Ts(this.statsToReport_,s)&&(t[s]=i,r=!0)}),r&&this.server_.reportStats(t),Hu(this.reportStats_.bind(this),Math.floor(Math.random()*2*jV))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var ms;(function(n){n[n.OVERWRITE=0]="OVERWRITE",n[n.MERGE=1]="MERGE",n[n.ACK_USER_WRITE=2]="ACK_USER_WRITE",n[n.LISTEN_COMPLETE=3]="LISTEN_COMPLETE"})(ms||(ms={}));function sw(){return{fromUser:!0,fromServer:!1,queryId:null,tagged:!1}}function iw(){return{fromUser:!1,fromServer:!0,queryId:null,tagged:!1}}function ow(n){return{fromUser:!1,fromServer:!0,queryId:n,tagged:!0}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Wp{constructor(e,t,r){this.path=e,this.affectedTree=t,this.revert=r,this.type=ms.ACK_USER_WRITE,this.source=sw()}operationForChild(e){if(tt(this.path)){if(this.affectedTree.value!=null)return te(this.affectedTree.children.isEmpty(),"affectedTree should not have overlapping affected paths."),this;{const t=this.affectedTree.subtree(new xt(e));return new Wp(_t(),t,this.revert)}}else return te(et(this.path)===e,"operationForChild called for unrelated child."),new Wp(Pt(this.path),this.affectedTree,this.revert)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ld{constructor(e,t){this.source=e,this.path=t,this.type=ms.LISTEN_COMPLETE}operationForChild(e){return tt(this.path)?new Ld(this.source,_t()):new Ld(this.source,Pt(this.path))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Na{constructor(e,t,r){this.source=e,this.path=t,this.snap=r,this.type=ms.OVERWRITE}operationForChild(e){return tt(this.path)?new Na(this.source,_t(),this.snap.getImmediateChild(e)):new Na(this.source,Pt(this.path),this.snap)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class uc{constructor(e,t,r){this.source=e,this.path=t,this.children=r,this.type=ms.MERGE}operationForChild(e){if(tt(this.path)){const t=this.children.subtree(new xt(e));return t.isEmpty()?null:t.value?new Na(this.source,_t(),t.value):new uc(this.source,_t(),t)}else return te(et(this.path)===e,"Can't get a merge for a child not on the path of the operation"),new uc(this.source,Pt(this.path),this.children)}toString(){return"Operation("+this.path+": "+this.source.toString()+" merge: "+this.children.toString()+")"}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ao{constructor(e,t,r){this.node_=e,this.fullyInitialized_=t,this.filtered_=r}isFullyInitialized(){return this.fullyInitialized_}isFiltered(){return this.filtered_}isCompleteForPath(e){if(tt(e))return this.isFullyInitialized()&&!this.filtered_;const t=et(e);return this.isCompleteForChild(t)}isCompleteForChild(e){return this.isFullyInitialized()&&!this.filtered_||this.node_.hasChild(e)}getNode(){return this.node_}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class FV{constructor(e){this.query_=e,this.index_=this.query_._queryParams.getIndex()}}function UV(n,e,t,r){const s=[],i=[];return e.forEach(o=>{o.type==="child_changed"&&n.index_.indexedValueChanged(o.oldSnap,o.snapshotNode)&&i.push(bV(o.childName,o.snapshotNode))}),_u(n,s,"child_removed",e,r,t),_u(n,s,"child_added",e,r,t),_u(n,s,"child_moved",i,r,t),_u(n,s,"child_changed",e,r,t),_u(n,s,"value",e,r,t),s}function _u(n,e,t,r,s,i){const o=r.filter(a=>a.type===t);o.sort((a,l)=>BV(n,a,l)),o.forEach(a=>{const l=$V(n,a,i);s.forEach(u=>{u.respondsTo(a.type)&&e.push(u.createEvent(l,n.query_))})})}function $V(n,e,t){return e.type==="value"||e.type==="child_removed"||(e.prevName=t.getPredecessorChildName(e.childName,e.snapshotNode,n.index_)),e}function BV(n,e,t){if(e.childName==null||t.childName==null)throw jc("Should only compare child_ events.");const r=new nt(e.childName,e.snapshotNode),s=new nt(t.childName,t.snapshotNode);return n.index_.compare(r,s)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function qg(n,e){return{eventCache:n,serverCache:e}}function Qu(n,e,t,r){return qg(new Ao(e,t,r),n.serverCache)}function X1(n,e,t,r){return qg(n.eventCache,new Ao(e,t,r))}function Gp(n){return n.eventCache.isFullyInitialized()?n.eventCache.getNode():null}function ka(n){return n.serverCache.isFullyInitialized()?n.serverCache.getNode():null}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Ny;const zV=()=>(Ny||(Ny=new Fs(Tj)),Ny);class Ot{static fromObject(e){let t=new Ot(null);return Fn(e,(r,s)=>{t=t.set(new xt(r),s)}),t}constructor(e,t=zV()){this.value=e,this.children=t}isEmpty(){return this.value===null&&this.children.isEmpty()}findRootMostMatchingPathAndValue(e,t){if(this.value!=null&&t(this.value))return{path:_t(),value:this.value};if(tt(e))return null;{const r=et(e),s=this.children.get(r);if(s!==null){const i=s.findRootMostMatchingPathAndValue(Pt(e),t);return i!=null?{path:Kt(new xt(r),i.path),value:i.value}:null}else return null}}findRootMostValueAndPath(e){return this.findRootMostMatchingPathAndValue(e,()=>!0)}subtree(e){if(tt(e))return this;{const t=et(e),r=this.children.get(t);return r!==null?r.subtree(Pt(e)):new Ot(null)}}set(e,t){if(tt(e))return new Ot(t,this.children);{const r=et(e),i=(this.children.get(r)||new Ot(null)).set(Pt(e),t),o=this.children.insert(r,i);return new Ot(this.value,o)}}remove(e){if(tt(e))return this.children.isEmpty()?new Ot(null):new Ot(null,this.children);{const t=et(e),r=this.children.get(t);if(r){const s=r.remove(Pt(e));let i;return s.isEmpty()?i=this.children.remove(t):i=this.children.insert(t,s),this.value===null&&i.isEmpty()?new Ot(null):new Ot(this.value,i)}else return this}}get(e){if(tt(e))return this.value;{const t=et(e),r=this.children.get(t);return r?r.get(Pt(e)):null}}setTree(e,t){if(tt(e))return t;{const r=et(e),i=(this.children.get(r)||new Ot(null)).setTree(Pt(e),t);let o;return i.isEmpty()?o=this.children.remove(r):o=this.children.insert(r,i),new Ot(this.value,o)}}fold(e){return this.fold_(_t(),e)}fold_(e,t){const r={};return this.children.inorderTraversal((s,i)=>{r[s]=i.fold_(Kt(e,s),t)}),t(e,this.value,r)}findOnPath(e,t){return this.findOnPath_(e,_t(),t)}findOnPath_(e,t,r){const s=this.value?r(t,this.value):!1;if(s)return s;if(tt(e))return null;{const i=et(e),o=this.children.get(i);return o?o.findOnPath_(Pt(e),Kt(t,i),r):null}}foreachOnPath(e,t){return this.foreachOnPath_(e,_t(),t)}foreachOnPath_(e,t,r){if(tt(e))return this;{this.value&&r(t,this.value);const s=et(e),i=this.children.get(s);return i?i.foreachOnPath_(Pt(e),Kt(t,s),r):new Ot(null)}}foreach(e){this.foreach_(_t(),e)}foreach_(e,t){this.children.inorderTraversal((r,s)=>{s.foreach_(Kt(e,r),t)}),this.value&&t(e,this.value)}foreachChild(e){this.children.inorderTraversal((t,r)=>{r.value&&e(t,r.value)})}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ws{constructor(e){this.writeTree_=e}static empty(){return new ws(new Ot(null))}}function Ku(n,e,t){if(tt(e))return new ws(new Ot(t));{const r=n.writeTree_.findRootMostValueAndPath(e);if(r!=null){const s=r.path;let i=r.value;const o=pr(s,e);return i=i.updateChild(o,t),new ws(n.writeTree_.set(s,i))}else{const s=new Ot(t),i=n.writeTree_.setTree(e,s);return new ws(i)}}}function sv(n,e,t){let r=n;return Fn(t,(s,i)=>{r=Ku(r,Kt(e,s),i)}),r}function yE(n,e){if(tt(e))return ws.empty();{const t=n.writeTree_.setTree(e,new Ot(null));return new ws(t)}}function iv(n,e){return Ja(n,e)!=null}function Ja(n,e){const t=n.writeTree_.findRootMostValueAndPath(e);return t!=null?n.writeTree_.get(t.path).getChild(pr(t.path,e)):null}function _E(n){const e=[],t=n.writeTree_.value;return t!=null?t.isLeafNode()||t.forEachChild(Mt,(r,s)=>{e.push(new nt(r,s))}):n.writeTree_.children.inorderTraversal((r,s)=>{s.value!=null&&e.push(new nt(r,s.value))}),e}function _o(n,e){if(tt(e))return n;{const t=Ja(n,e);return t!=null?new ws(new Ot(t)):new ws(n.writeTree_.subtree(e))}}function ov(n){return n.writeTree_.isEmpty()}function dc(n,e){return Z1(_t(),n.writeTree_,e)}function Z1(n,e,t){if(e.value!=null)return t.updateChild(n,e.value);{let r=null;return e.children.inorderTraversal((s,i)=>{s===".priority"?(te(i.value!==null,"Priority writes must always be leaf nodes"),r=i.value):t=Z1(Kt(n,s),i,t)}),!t.getChild(n).isEmpty()&&r!==null&&(t=t.updateChild(Kt(n,".priority"),r)),t}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Wg(n,e){return rR(e,n)}function qV(n,e,t,r,s){te(r>n.lastWriteId,"Stacking an older write on top of newer ones"),s===void 0&&(s=!0),n.allWrites.push({path:e,snap:t,writeId:r,visible:s}),s&&(n.visibleWrites=Ku(n.visibleWrites,e,t)),n.lastWriteId=r}function WV(n,e,t,r){te(r>n.lastWriteId,"Stacking an older merge on top of newer ones"),n.allWrites.push({path:e,children:t,writeId:r,visible:!0}),n.visibleWrites=sv(n.visibleWrites,e,t),n.lastWriteId=r}function GV(n,e){for(let t=0;t<n.allWrites.length;t++){const r=n.allWrites[t];if(r.writeId===e)return r}return null}function HV(n,e){const t=n.allWrites.findIndex(a=>a.writeId===e);te(t>=0,"removeWrite called with nonexistent writeId.");const r=n.allWrites[t];n.allWrites.splice(t,1);let s=r.visible,i=!1,o=n.allWrites.length-1;for(;s&&o>=0;){const a=n.allWrites[o];a.visible&&(o>=t&&QV(a,r.path)?s=!1:ns(r.path,a.path)&&(i=!0)),o--}if(s){if(i)return KV(n),!0;if(r.snap)n.visibleWrites=yE(n.visibleWrites,r.path);else{const a=r.children;Fn(a,l=>{n.visibleWrites=yE(n.visibleWrites,Kt(r.path,l))})}return!0}else return!1}function QV(n,e){if(n.snap)return ns(n.path,e);for(const t in n.children)if(n.children.hasOwnProperty(t)&&ns(Kt(n.path,t),e))return!0;return!1}function KV(n){n.visibleWrites=eR(n.allWrites,YV,_t()),n.allWrites.length>0?n.lastWriteId=n.allWrites[n.allWrites.length-1].writeId:n.lastWriteId=-1}function YV(n){return n.visible}function eR(n,e,t){let r=ws.empty();for(let s=0;s<n.length;++s){const i=n[s];if(e(i)){const o=i.path;let a;if(i.snap)ns(t,o)?(a=pr(t,o),r=Ku(r,a,i.snap)):ns(o,t)&&(a=pr(o,t),r=Ku(r,_t(),i.snap.getChild(a)));else if(i.children){if(ns(t,o))a=pr(t,o),r=sv(r,a,i.children);else if(ns(o,t))if(a=pr(o,t),tt(a))r=sv(r,_t(),i.children);else{const l=Ca(i.children,et(a));if(l){const u=l.getChild(Pt(a));r=Ku(r,_t(),u)}}}else throw jc("WriteRecord should have .snap or .children")}}return r}function tR(n,e,t,r,s){if(!r&&!s){const i=Ja(n.visibleWrites,e);if(i!=null)return i;{const o=_o(n.visibleWrites,e);if(ov(o))return t;if(t==null&&!iv(o,_t()))return null;{const a=t||Le.EMPTY_NODE;return dc(o,a)}}}else{const i=_o(n.visibleWrites,e);if(!s&&ov(i))return t;if(!s&&t==null&&!iv(i,_t()))return null;{const o=function(u){return(u.visible||s)&&(!r||!~r.indexOf(u.writeId))&&(ns(u.path,e)||ns(e,u.path))},a=eR(n.allWrites,o,e),l=t||Le.EMPTY_NODE;return dc(a,l)}}}function JV(n,e,t){let r=Le.EMPTY_NODE;const s=Ja(n.visibleWrites,e);if(s)return s.isLeafNode()||s.forEachChild(Mt,(i,o)=>{r=r.updateImmediateChild(i,o)}),r;if(t){const i=_o(n.visibleWrites,e);return t.forEachChild(Mt,(o,a)=>{const l=dc(_o(i,new xt(o)),a);r=r.updateImmediateChild(o,l)}),_E(i).forEach(o=>{r=r.updateImmediateChild(o.name,o.node)}),r}else{const i=_o(n.visibleWrites,e);return _E(i).forEach(o=>{r=r.updateImmediateChild(o.name,o.node)}),r}}function XV(n,e,t,r,s){te(r||s,"Either existingEventSnap or existingServerSnap must exist");const i=Kt(e,t);if(iv(n.visibleWrites,i))return null;{const o=_o(n.visibleWrites,i);return ov(o)?s.getChild(t):dc(o,s.getChild(t))}}function ZV(n,e,t,r){const s=Kt(e,t),i=Ja(n.visibleWrites,s);if(i!=null)return i;if(r.isCompleteForChild(t)){const o=_o(n.visibleWrites,s);return dc(o,r.getNode().getImmediateChild(t))}else return null}function eF(n,e){return Ja(n.visibleWrites,e)}function tF(n,e,t,r,s,i,o){let a;const l=_o(n.visibleWrites,e),u=Ja(l,_t());if(u!=null)a=u;else if(t!=null)a=dc(l,t);else return[];if(a=a.withIndex(o),!a.isEmpty()&&!a.isLeafNode()){const h=[],f=o.getCompare(),p=i?a.getReverseIteratorFrom(r,o):a.getIteratorFrom(r,o);let y=p.getNext();for(;y&&h.length<s;)f(y,r)!==0&&h.push(y),y=p.getNext();return h}else return[]}function nF(){return{visibleWrites:ws.empty(),allWrites:[],lastWriteId:-1}}function Hp(n,e,t,r){return tR(n.writeTree,n.treePath,e,t,r)}function aw(n,e){return JV(n.writeTree,n.treePath,e)}function vE(n,e,t,r){return XV(n.writeTree,n.treePath,e,t,r)}function Qp(n,e){return eF(n.writeTree,Kt(n.treePath,e))}function rF(n,e,t,r,s,i){return tF(n.writeTree,n.treePath,e,t,r,s,i)}function lw(n,e,t){return ZV(n.writeTree,n.treePath,e,t)}function nR(n,e){return rR(Kt(n.treePath,e),n.writeTree)}function rR(n,e){return{treePath:n,writeTree:e}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class sF{constructor(){this.changeMap=new Map}trackChildChange(e){const t=e.type,r=e.childName;te(t==="child_added"||t==="child_changed"||t==="child_removed","Only child changes supported for tracking"),te(r!==".priority","Only non-priority child changes can be tracked.");const s=this.changeMap.get(r);if(s){const i=s.type;if(t==="child_added"&&i==="child_removed")this.changeMap.set(r,Dd(r,e.snapshotNode,s.snapshotNode));else if(t==="child_removed"&&i==="child_added")this.changeMap.delete(r);else if(t==="child_removed"&&i==="child_changed")this.changeMap.set(r,Pd(r,s.oldSnap));else if(t==="child_changed"&&i==="child_added")this.changeMap.set(r,cc(r,e.snapshotNode));else if(t==="child_changed"&&i==="child_changed")this.changeMap.set(r,Dd(r,e.snapshotNode,s.oldSnap));else throw jc("Illegal combination of changes: "+e+" occurred after "+s)}else this.changeMap.set(r,e)}getChanges(){return Array.from(this.changeMap.values())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class iF{getCompleteChild(e){return null}getChildAfterChild(e,t,r){return null}}const sR=new iF;class cw{constructor(e,t,r=null){this.writes_=e,this.viewCache_=t,this.optCompleteServerCache_=r}getCompleteChild(e){const t=this.viewCache_.eventCache;if(t.isCompleteForChild(e))return t.getNode().getImmediateChild(e);{const r=this.optCompleteServerCache_!=null?new Ao(this.optCompleteServerCache_,!0,!1):this.viewCache_.serverCache;return lw(this.writes_,e,r)}}getChildAfterChild(e,t,r){const s=this.optCompleteServerCache_!=null?this.optCompleteServerCache_:ka(this.viewCache_),i=rF(this.writes_,s,t,1,r,e);return i.length===0?null:i[0]}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function oF(n){return{filter:n}}function aF(n,e){te(e.eventCache.getNode().isIndexed(n.filter.getIndex()),"Event snap not indexed"),te(e.serverCache.getNode().isIndexed(n.filter.getIndex()),"Server snap not indexed")}function lF(n,e,t,r,s){const i=new sF;let o,a;if(t.type===ms.OVERWRITE){const u=t;u.source.fromUser?o=av(n,e,u.path,u.snap,r,s,i):(te(u.source.fromServer,"Unknown source."),a=u.source.tagged||e.serverCache.isFiltered()&&!tt(u.path),o=Kp(n,e,u.path,u.snap,r,s,a,i))}else if(t.type===ms.MERGE){const u=t;u.source.fromUser?o=uF(n,e,u.path,u.children,r,s,i):(te(u.source.fromServer,"Unknown source."),a=u.source.tagged||e.serverCache.isFiltered(),o=lv(n,e,u.path,u.children,r,s,a,i))}else if(t.type===ms.ACK_USER_WRITE){const u=t;u.revert?o=fF(n,e,u.path,r,s,i):o=dF(n,e,u.path,u.affectedTree,r,s,i)}else if(t.type===ms.LISTEN_COMPLETE)o=hF(n,e,t.path,r,i);else throw jc("Unknown operation type: "+t.type);const l=i.getChanges();return cF(e,o,l),{viewCache:o,changes:l}}function cF(n,e,t){const r=e.eventCache;if(r.isFullyInitialized()){const s=r.getNode().isLeafNode()||r.getNode().isEmpty(),i=Gp(n);(t.length>0||!n.eventCache.isFullyInitialized()||s&&!r.getNode().equals(i)||!r.getNode().getPriority().equals(i.getPriority()))&&t.push(J1(Gp(e)))}}function iR(n,e,t,r,s,i){const o=e.eventCache;if(Qp(r,t)!=null)return e;{let a,l;if(tt(t))if(te(e.serverCache.isFullyInitialized(),"If change path is empty, we must have complete server data"),e.serverCache.isFiltered()){const u=ka(e),h=u instanceof Le?u:Le.EMPTY_NODE,f=aw(r,h);a=n.filter.updateFullNode(e.eventCache.getNode(),f,i)}else{const u=Hp(r,ka(e));a=n.filter.updateFullNode(e.eventCache.getNode(),u,i)}else{const u=et(t);if(u===".priority"){te(bo(t)===1,"Can't have a priority with additional path components");const h=o.getNode();l=e.serverCache.getNode();const f=vE(r,t,h,l);f!=null?a=n.filter.updatePriority(h,f):a=o.getNode()}else{const h=Pt(t);let f;if(o.isCompleteForChild(u)){l=e.serverCache.getNode();const p=vE(r,t,o.getNode(),l);p!=null?f=o.getNode().getImmediateChild(u).updateChild(h,p):f=o.getNode().getImmediateChild(u)}else f=lw(r,u,e.serverCache);f!=null?a=n.filter.updateChild(o.getNode(),u,f,h,s,i):a=o.getNode()}}return Qu(e,a,o.isFullyInitialized()||tt(t),n.filter.filtersNodes())}}function Kp(n,e,t,r,s,i,o,a){const l=e.serverCache;let u;const h=o?n.filter:n.filter.getIndexedFilter();if(tt(t))u=h.updateFullNode(l.getNode(),r,null);else if(h.filtersNodes()&&!l.isFiltered()){const y=l.getNode().updateChild(t,r);u=h.updateFullNode(l.getNode(),y,null)}else{const y=et(t);if(!l.isCompleteForPath(t)&&bo(t)>1)return e;const w=Pt(t),k=l.getNode().getImmediateChild(y).updateChild(w,r);y===".priority"?u=h.updatePriority(l.getNode(),k):u=h.updateChild(l.getNode(),y,k,w,sR,null)}const f=X1(e,u,l.isFullyInitialized()||tt(t),h.filtersNodes()),p=new cw(s,f,i);return iR(n,f,t,s,p,a)}function av(n,e,t,r,s,i,o){const a=e.eventCache;let l,u;const h=new cw(s,e,i);if(tt(t))u=n.filter.updateFullNode(e.eventCache.getNode(),r,o),l=Qu(e,u,!0,n.filter.filtersNodes());else{const f=et(t);if(f===".priority")u=n.filter.updatePriority(e.eventCache.getNode(),r),l=Qu(e,u,a.isFullyInitialized(),a.isFiltered());else{const p=Pt(t),y=a.getNode().getImmediateChild(f);let w;if(tt(p))w=r;else{const S=h.getCompleteChild(f);S!=null?Y0(p)===".priority"&&S.getChild(q1(p)).isEmpty()?w=S:w=S.updateChild(p,r):w=Le.EMPTY_NODE}if(y.equals(w))l=e;else{const S=n.filter.updateChild(a.getNode(),f,w,p,h,o);l=Qu(e,S,a.isFullyInitialized(),n.filter.filtersNodes())}}}return l}function wE(n,e){return n.eventCache.isCompleteForChild(e)}function uF(n,e,t,r,s,i,o){let a=e;return r.foreach((l,u)=>{const h=Kt(t,l);wE(e,et(h))&&(a=av(n,a,h,u,s,i,o))}),r.foreach((l,u)=>{const h=Kt(t,l);wE(e,et(h))||(a=av(n,a,h,u,s,i,o))}),a}function xE(n,e,t){return t.foreach((r,s)=>{e=e.updateChild(r,s)}),e}function lv(n,e,t,r,s,i,o,a){if(e.serverCache.getNode().isEmpty()&&!e.serverCache.isFullyInitialized())return e;let l=e,u;tt(t)?u=r:u=new Ot(null).setTree(t,r);const h=e.serverCache.getNode();return u.children.inorderTraversal((f,p)=>{if(h.hasChild(f)){const y=e.serverCache.getNode().getImmediateChild(f),w=xE(n,y,p);l=Kp(n,l,new xt(f),w,s,i,o,a)}}),u.children.inorderTraversal((f,p)=>{const y=!e.serverCache.isCompleteForChild(f)&&p.value===null;if(!h.hasChild(f)&&!y){const w=e.serverCache.getNode().getImmediateChild(f),S=xE(n,w,p);l=Kp(n,l,new xt(f),S,s,i,o,a)}}),l}function dF(n,e,t,r,s,i,o){if(Qp(s,t)!=null)return e;const a=e.serverCache.isFiltered(),l=e.serverCache;if(r.value!=null){if(tt(t)&&l.isFullyInitialized()||l.isCompleteForPath(t))return Kp(n,e,t,l.getNode().getChild(t),s,i,a,o);if(tt(t)){let u=new Ot(null);return l.getNode().forEachChild(Hs,(h,f)=>{u=u.set(new xt(h),f)}),lv(n,e,t,u,s,i,a,o)}else return e}else{let u=new Ot(null);return r.foreach((h,f)=>{const p=Kt(t,h);l.isCompleteForPath(p)&&(u=u.set(h,l.getNode().getChild(p)))}),lv(n,e,t,u,s,i,a,o)}}function hF(n,e,t,r,s){const i=e.serverCache,o=X1(e,i.getNode(),i.isFullyInitialized()||tt(t),i.isFiltered());return iR(n,o,t,r,sR,s)}function fF(n,e,t,r,s,i){let o;if(Qp(r,t)!=null)return e;{const a=new cw(r,e,s),l=e.eventCache.getNode();let u;if(tt(t)||et(t)===".priority"){let h;if(e.serverCache.isFullyInitialized())h=Hp(r,ka(e));else{const f=e.serverCache.getNode();te(f instanceof Le,"serverChildren would be complete if leaf node"),h=aw(r,f)}h=h,u=n.filter.updateFullNode(l,h,i)}else{const h=et(t);let f=lw(r,h,e.serverCache);f==null&&e.serverCache.isCompleteForChild(h)&&(f=l.getImmediateChild(h)),f!=null?u=n.filter.updateChild(l,h,f,Pt(t),a,i):e.eventCache.getNode().hasChild(h)?u=n.filter.updateChild(l,h,Le.EMPTY_NODE,Pt(t),a,i):u=l,u.isEmpty()&&e.serverCache.isFullyInitialized()&&(o=Hp(r,ka(e)),o.isLeafNode()&&(u=n.filter.updateFullNode(u,o,i)))}return o=e.serverCache.isFullyInitialized()||Qp(r,_t())!=null,Qu(e,u,o,n.filter.filtersNodes())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class pF{constructor(e,t){this.query_=e,this.eventRegistrations_=[];const r=this.query_._queryParams,s=new nw(r.getIndex()),i=CV(r);this.processor_=oF(i);const o=t.serverCache,a=t.eventCache,l=s.updateFullNode(Le.EMPTY_NODE,o.getNode(),null),u=i.updateFullNode(Le.EMPTY_NODE,a.getNode(),null),h=new Ao(l,o.isFullyInitialized(),s.filtersNodes()),f=new Ao(u,a.isFullyInitialized(),i.filtersNodes());this.viewCache_=qg(f,h),this.eventGenerator_=new FV(this.query_)}get query(){return this.query_}}function gF(n){return n.viewCache_.serverCache.getNode()}function mF(n){return Gp(n.viewCache_)}function yF(n,e){const t=ka(n.viewCache_);return t&&(n.query._queryParams.loadsAllData()||!tt(e)&&!t.getImmediateChild(et(e)).isEmpty())?t.getChild(e):null}function IE(n){return n.eventRegistrations_.length===0}function _F(n,e){n.eventRegistrations_.push(e)}function SE(n,e,t){const r=[];if(t){te(e==null,"A cancel should cancel all event registrations.");const s=n.query._path;n.eventRegistrations_.forEach(i=>{const o=i.createCancelEvent(t,s);o&&r.push(o)})}if(e){let s=[];for(let i=0;i<n.eventRegistrations_.length;++i){const o=n.eventRegistrations_[i];if(!o.matches(e))s.push(o);else if(e.hasAnyCallback()){s=s.concat(n.eventRegistrations_.slice(i+1));break}}n.eventRegistrations_=s}else n.eventRegistrations_=[];return r}function EE(n,e,t,r){e.type===ms.MERGE&&e.source.queryId!==null&&(te(ka(n.viewCache_),"We should always have a full cache before handling merges"),te(Gp(n.viewCache_),"Missing event cache, even though we have a server cache"));const s=n.viewCache_,i=lF(n.processor_,s,e,t,r);return aF(n.processor_,i.viewCache),te(i.viewCache.serverCache.isFullyInitialized()||!s.serverCache.isFullyInitialized(),"Once a server snap is complete, it should never go back"),n.viewCache_=i.viewCache,oR(n,i.changes,i.viewCache.eventCache.getNode(),null)}function vF(n,e){const t=n.viewCache_.eventCache,r=[];return t.getNode().isLeafNode()||t.getNode().forEachChild(Mt,(i,o)=>{r.push(cc(i,o))}),t.isFullyInitialized()&&r.push(J1(t.getNode())),oR(n,r,t.getNode(),e)}function oR(n,e,t,r){const s=r?[r]:n.eventRegistrations_;return UV(n.eventGenerator_,e,t,s)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Yp;class aR{constructor(){this.views=new Map}}function wF(n){te(!Yp,"__referenceConstructor has already been defined"),Yp=n}function xF(){return te(Yp,"Reference.ts has not been loaded"),Yp}function IF(n){return n.views.size===0}function uw(n,e,t,r){const s=e.source.queryId;if(s!==null){const i=n.views.get(s);return te(i!=null,"SyncTree gave us an op for an invalid query."),EE(i,e,t,r)}else{let i=[];for(const o of n.views.values())i=i.concat(EE(o,e,t,r));return i}}function lR(n,e,t,r,s){const i=e._queryIdentifier,o=n.views.get(i);if(!o){let a=Hp(t,s?r:null),l=!1;a?l=!0:r instanceof Le?(a=aw(t,r),l=!1):(a=Le.EMPTY_NODE,l=!1);const u=qg(new Ao(a,l,!1),new Ao(r,s,!1));return new pF(e,u)}return o}function SF(n,e,t,r,s,i){const o=lR(n,e,r,s,i);return n.views.has(e._queryIdentifier)||n.views.set(e._queryIdentifier,o),_F(o,t),vF(o,t)}function EF(n,e,t,r){const s=e._queryIdentifier,i=[];let o=[];const a=Co(n);if(s==="default")for(const[l,u]of n.views.entries())o=o.concat(SE(u,t,r)),IE(u)&&(n.views.delete(l),u.query._queryParams.loadsAllData()||i.push(u.query));else{const l=n.views.get(s);l&&(o=o.concat(SE(l,t,r)),IE(l)&&(n.views.delete(s),l.query._queryParams.loadsAllData()||i.push(l.query)))}return a&&!Co(n)&&i.push(new(xF())(e._repo,e._path)),{removed:i,events:o}}function cR(n){const e=[];for(const t of n.views.values())t.query._queryParams.loadsAllData()||e.push(t);return e}function vo(n,e){let t=null;for(const r of n.views.values())t=t||yF(r,e);return t}function uR(n,e){if(e._queryParams.loadsAllData())return Gg(n);{const r=e._queryIdentifier;return n.views.get(r)}}function dR(n,e){return uR(n,e)!=null}function Co(n){return Gg(n)!=null}function Gg(n){for(const e of n.views.values())if(e.query._queryParams.loadsAllData())return e;return null}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Jp;function TF(n){te(!Jp,"__referenceConstructor has already been defined"),Jp=n}function bF(){return te(Jp,"Reference.ts has not been loaded"),Jp}let AF=1;class TE{constructor(e){this.listenProvider_=e,this.syncPointTree_=new Ot(null),this.pendingWriteTree_=nF(),this.tagToQueryMap=new Map,this.queryToTagMap=new Map}}function dw(n,e,t,r,s){return qV(n.pendingWriteTree_,e,t,r,s),s?Uc(n,new Na(sw(),e,t)):[]}function CF(n,e,t,r){WV(n.pendingWriteTree_,e,t,r);const s=Ot.fromObject(t);return Uc(n,new uc(sw(),e,s))}function so(n,e,t=!1){const r=GV(n.pendingWriteTree_,e);if(HV(n.pendingWriteTree_,e)){let i=new Ot(null);return r.snap!=null?i=i.set(_t(),!0):Fn(r.children,o=>{i=i.set(new xt(o),!0)}),Uc(n,new Wp(r.path,i,t))}else return[]}function ph(n,e,t){return Uc(n,new Na(iw(),e,t))}function RF(n,e,t){const r=Ot.fromObject(t);return Uc(n,new uc(iw(),e,r))}function NF(n,e){return Uc(n,new Ld(iw(),e))}function kF(n,e,t){const r=hw(n,t);if(r){const s=fw(r),i=s.path,o=s.queryId,a=pr(i,e),l=new Ld(ow(o),a);return pw(n,i,l)}else return[]}function Xp(n,e,t,r,s=!1){const i=e._path,o=n.syncPointTree_.get(i);let a=[];if(o&&(e._queryIdentifier==="default"||dR(o,e))){const l=EF(o,e,t,r);IF(o)&&(n.syncPointTree_=n.syncPointTree_.remove(i));const u=l.removed;if(a=l.events,!s){const h=u.findIndex(p=>p._queryParams.loadsAllData())!==-1,f=n.syncPointTree_.findOnPath(i,(p,y)=>Co(y));if(h&&!f){const p=n.syncPointTree_.subtree(i);if(!p.isEmpty()){const y=OF(p);for(let w=0;w<y.length;++w){const S=y[w],k=S.query,E=gR(n,S);n.listenProvider_.startListening(Yu(k),Md(n,k),E.hashFn,E.onComplete)}}}!f&&u.length>0&&!r&&(h?n.listenProvider_.stopListening(Yu(e),null):u.forEach(p=>{const y=n.queryToTagMap.get(Qg(p));n.listenProvider_.stopListening(Yu(p),y)}))}LF(n,u)}return a}function hR(n,e,t,r){const s=hw(n,r);if(s!=null){const i=fw(s),o=i.path,a=i.queryId,l=pr(o,e),u=new Na(ow(a),l,t);return pw(n,o,u)}else return[]}function PF(n,e,t,r){const s=hw(n,r);if(s){const i=fw(s),o=i.path,a=i.queryId,l=pr(o,e),u=Ot.fromObject(t),h=new uc(ow(a),l,u);return pw(n,o,h)}else return[]}function cv(n,e,t,r=!1){const s=e._path;let i=null,o=!1;n.syncPointTree_.foreachOnPath(s,(p,y)=>{const w=pr(p,s);i=i||vo(y,w),o=o||Co(y)});let a=n.syncPointTree_.get(s);a?(o=o||Co(a),i=i||vo(a,_t())):(a=new aR,n.syncPointTree_=n.syncPointTree_.set(s,a));let l;i!=null?l=!0:(l=!1,i=Le.EMPTY_NODE,n.syncPointTree_.subtree(s).foreachChild((y,w)=>{const S=vo(w,_t());S&&(i=i.updateImmediateChild(y,S))}));const u=dR(a,e);if(!u&&!e._queryParams.loadsAllData()){const p=Qg(e);te(!n.queryToTagMap.has(p),"View does not exist, but we have a tag");const y=MF();n.queryToTagMap.set(p,y),n.tagToQueryMap.set(y,p)}const h=Wg(n.pendingWriteTree_,s);let f=SF(a,e,t,h,i,l);if(!u&&!o&&!r){const p=uR(a,e);f=f.concat(jF(n,e,p))}return f}function Hg(n,e,t){const s=n.pendingWriteTree_,i=n.syncPointTree_.findOnPath(e,(o,a)=>{const l=pr(o,e),u=vo(a,l);if(u)return u});return tR(s,e,i,t,!0)}function DF(n,e){const t=e._path;let r=null;n.syncPointTree_.foreachOnPath(t,(u,h)=>{const f=pr(u,t);r=r||vo(h,f)});let s=n.syncPointTree_.get(t);s?r=r||vo(s,_t()):(s=new aR,n.syncPointTree_=n.syncPointTree_.set(t,s));const i=r!=null,o=i?new Ao(r,!0,!1):null,a=Wg(n.pendingWriteTree_,e._path),l=lR(s,e,a,i?o.getNode():Le.EMPTY_NODE,i);return mF(l)}function Uc(n,e){return fR(e,n.syncPointTree_,null,Wg(n.pendingWriteTree_,_t()))}function fR(n,e,t,r){if(tt(n.path))return pR(n,e,t,r);{const s=e.get(_t());t==null&&s!=null&&(t=vo(s,_t()));let i=[];const o=et(n.path),a=n.operationForChild(o),l=e.children.get(o);if(l&&a){const u=t?t.getImmediateChild(o):null,h=nR(r,o);i=i.concat(fR(a,l,u,h))}return s&&(i=i.concat(uw(s,n,r,t))),i}}function pR(n,e,t,r){const s=e.get(_t());t==null&&s!=null&&(t=vo(s,_t()));let i=[];return e.children.inorderTraversal((o,a)=>{const l=t?t.getImmediateChild(o):null,u=nR(r,o),h=n.operationForChild(o);h&&(i=i.concat(pR(h,a,l,u)))}),s&&(i=i.concat(uw(s,n,r,t))),i}function gR(n,e){const t=e.query,r=Md(n,t);return{hashFn:()=>(gF(e)||Le.EMPTY_NODE).hash(),onComplete:s=>{if(s==="ok")return r?kF(n,t._path,r):NF(n,t._path);{const i=Cj(s,t);return Xp(n,t,null,i)}}}}function Md(n,e){const t=Qg(e);return n.queryToTagMap.get(t)}function Qg(n){return n._path.toString()+"$"+n._queryIdentifier}function hw(n,e){return n.tagToQueryMap.get(e)}function fw(n){const e=n.indexOf("$");return te(e!==-1&&e<n.length-1,"Bad queryKey."),{queryId:n.substr(e+1),path:new xt(n.substr(0,e))}}function pw(n,e,t){const r=n.syncPointTree_.get(e);te(r,"Missing sync point for query tag that we're tracking");const s=Wg(n.pendingWriteTree_,e);return uw(r,t,s,null)}function OF(n){return n.fold((e,t,r)=>{if(t&&Co(t))return[Gg(t)];{let s=[];return t&&(s=cR(t)),Fn(r,(i,o)=>{s=s.concat(o)}),s}})}function Yu(n){return n._queryParams.loadsAllData()&&!n._queryParams.isDefault()?new(bF())(n._repo,n._path):n}function LF(n,e){for(let t=0;t<e.length;++t){const r=e[t];if(!r._queryParams.loadsAllData()){const s=Qg(r),i=n.queryToTagMap.get(s);n.queryToTagMap.delete(s),n.tagToQueryMap.delete(i)}}}function MF(){return AF++}function jF(n,e,t){const r=e._path,s=Md(n,e),i=gR(n,t),o=n.listenProvider_.startListening(Yu(e),s,i.hashFn,i.onComplete),a=n.syncPointTree_.subtree(r);if(s)te(!Co(a.value),"If we're adding a query, it shouldn't be shadowed");else{const l=a.fold((u,h,f)=>{if(!tt(u)&&h&&Co(h))return[Gg(h).query];{let p=[];return h&&(p=p.concat(cR(h).map(y=>y.query))),Fn(f,(y,w)=>{p=p.concat(w)}),p}});for(let u=0;u<l.length;++u){const h=l[u];n.listenProvider_.stopListening(Yu(h),Md(n,h))}}return o}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class gw{constructor(e){this.node_=e}getImmediateChild(e){const t=this.node_.getImmediateChild(e);return new gw(t)}node(){return this.node_}}class mw{constructor(e,t){this.syncTree_=e,this.path_=t}getImmediateChild(e){const t=Kt(this.path_,e);return new mw(this.syncTree_,t)}node(){return Hg(this.syncTree_,this.path_)}}const VF=function(n){return n=n||{},n.timestamp=n.timestamp||new Date().getTime(),n},bE=function(n,e,t){if(!n||typeof n!="object")return n;if(te(".sv"in n,"Unexpected leaf node or priority contents"),typeof n[".sv"]=="string")return FF(n[".sv"],e,t);if(typeof n[".sv"]=="object")return UF(n[".sv"],e);te(!1,"Unexpected server value: "+JSON.stringify(n,null,2))},FF=function(n,e,t){switch(n){case"timestamp":return t.timestamp;default:te(!1,"Unexpected server value: "+n)}},UF=function(n,e,t){n.hasOwnProperty("increment")||te(!1,"Unexpected server value: "+JSON.stringify(n,null,2));const r=n.increment;typeof r!="number"&&te(!1,"Unexpected increment value: "+r);const s=e.node();if(te(s!==null&&typeof s<"u","Expected ChildrenNode.EMPTY_NODE for nulls"),!s.isLeafNode())return r;const o=s.getValue();return typeof o!="number"?r:o+r},mR=function(n,e,t,r){return _w(e,new mw(t,n),r)},yw=function(n,e,t){return _w(n,new gw(e),t)};function _w(n,e,t){const r=n.getPriority().val(),s=bE(r,e.getImmediateChild(".priority"),t);let i;if(n.isLeafNode()){const o=n,a=bE(o.getValue(),e,t);return a!==o.getValue()||s!==o.getPriority().val()?new kn(a,Zt(s)):n}else{const o=n;return i=o,s!==o.getPriority().val()&&(i=i.updatePriority(new kn(s))),o.forEachChild(Mt,(a,l)=>{const u=_w(l,e.getImmediateChild(a),t);u!==l&&(i=i.updateImmediateChild(a,u))}),i}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class vw{constructor(e="",t=null,r={children:{},childCount:0}){this.name=e,this.parent=t,this.node=r}}function Kg(n,e){let t=e instanceof xt?e:new xt(e),r=n,s=et(t);for(;s!==null;){const i=Ca(r.node.children,s)||{children:{},childCount:0};r=new vw(s,r,i),t=Pt(t),s=et(t)}return r}function Xa(n){return n.node.value}function ww(n,e){n.node.value=e,uv(n)}function yR(n){return n.node.childCount>0}function $F(n){return Xa(n)===void 0&&!yR(n)}function Yg(n,e){Fn(n.node.children,(t,r)=>{e(new vw(t,n,r))})}function _R(n,e,t,r){t&&!r&&e(n),Yg(n,s=>{_R(s,e,!0,r)}),t&&r&&e(n)}function BF(n,e,t){let r=t?n:n.parent;for(;r!==null;){if(e(r))return!0;r=r.parent}return!1}function gh(n){return new xt(n.parent===null?n.name:gh(n.parent)+"/"+n.name)}function uv(n){n.parent!==null&&zF(n.parent,n.name,n)}function zF(n,e,t){const r=$F(t),s=Ts(n.node.children,e);r&&s?(delete n.node.children[e],n.node.childCount--,uv(n)):!r&&!s&&(n.node.children[e]=t.node,n.node.childCount++,uv(n))}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const qF=/[\[\].#$\/\u0000-\u001F\u007F]/,WF=/[\[\].#$\u0000-\u001F\u007F]/,ky=10*1024*1024,Jg=function(n){return typeof n=="string"&&n.length!==0&&!qF.test(n)},vR=function(n){return typeof n=="string"&&n.length!==0&&!WF.test(n)},GF=function(n){return n&&(n=n.replace(/^\/*\.info(\/|$)/,"/")),vR(n)},jd=function(n){return n===null||typeof n=="string"||typeof n=="number"&&!$g(n)||n&&typeof n=="object"&&Ts(n,".sv")},Zs=function(n,e,t,r){r&&e===void 0||mh(Ra(n,"value"),e,t)},mh=function(n,e,t){const r=t instanceof xt?new lV(t,n):t;if(e===void 0)throw new Error(n+"contains undefined "+na(r));if(typeof e=="function")throw new Error(n+"contains a function "+na(r)+" with contents = "+e.toString());if($g(e))throw new Error(n+"contains "+e.toString()+" "+na(r));if(typeof e=="string"&&e.length>ky/3&&Ug(e)>ky)throw new Error(n+"contains a string greater than "+ky+" utf8 bytes "+na(r)+" ('"+e.substring(0,50)+"...')");if(e&&typeof e=="object"){let s=!1,i=!1;if(Fn(e,(o,a)=>{if(o===".value")s=!0;else if(o!==".priority"&&o!==".sv"&&(i=!0,!Jg(o)))throw new Error(n+" contains an invalid key ("+o+") "+na(r)+`.  Keys must be non-empty strings and can't contain ".", "#", "$", "/", "[", or "]"`);cV(r,o),mh(n,a,r),uV(r)}),s&&i)throw new Error(n+' contains ".value" child '+na(r)+" in addition to actual children.")}},HF=function(n,e){let t,r;for(t=0;t<e.length;t++){r=e[t];const i=kd(r);for(let o=0;o<i.length;o++)if(!(i[o]===".priority"&&o===i.length-1)){if(!Jg(i[o]))throw new Error(n+"contains an invalid key ("+i[o]+") in path "+r.toString()+`. Keys must be non-empty strings and can't contain ".", "#", "$", "/", "[", or "]"`)}}e.sort(aV);let s=null;for(t=0;t<e.length;t++){if(r=e[t],s!==null&&ns(s,r))throw new Error(n+"contains a path "+s.toString()+" that is ancestor of another path "+r.toString());s=r}},wR=function(n,e,t,r){if(r&&e===void 0)return;const s=Ra(n,"values");if(!(e&&typeof e=="object")||Array.isArray(e))throw new Error(s+" must be an object containing the children to replace.");const i=[];Fn(e,(o,a)=>{const l=new xt(o);if(mh(s,a,Kt(t,l)),Y0(l)===".priority"&&!jd(a))throw new Error(s+"contains an invalid value for '"+l.toString()+"', which must be a valid Firebase priority (a string, finite number, server value, or null).");i.push(l)}),HF(s,i)},xw=function(n,e,t){if(!(t&&e===void 0)){if($g(e))throw new Error(Ra(n,"priority")+"is "+e.toString()+", but must be a valid Firebase priority (a string, finite number, server value, or null).");if(!jd(e))throw new Error(Ra(n,"priority")+"must be a valid Firebase priority (a string, finite number, server value, or null).")}},yh=function(n,e,t,r){if(!(r&&t===void 0)&&!Jg(t))throw new Error(Ra(n,e)+'was an invalid key = "'+t+`".  Firebase keys must be non-empty strings and can't contain ".", "#", "$", "/", "[", or "]").`)},Iw=function(n,e,t,r){if(!(r&&t===void 0)&&!vR(t))throw new Error(Ra(n,e)+'was an invalid path = "'+t+`". Paths must be non-empty strings and can't contain ".", "#", "$", "[", or "]"`)},QF=function(n,e,t,r){t&&(t=t.replace(/^\/*\.info(\/|$)/,"/")),Iw(n,e,t,r)},Us=function(n,e){if(et(e)===".info")throw new Error(n+" failed = Can't modify data under /.info/")},xR=function(n,e){const t=e.path.toString();if(typeof e.repoInfo.host!="string"||e.repoInfo.host.length===0||!Jg(e.repoInfo.namespace)&&e.repoInfo.host.split(":")[0]!=="localhost"||t.length!==0&&!GF(t))throw new Error(Ra(n,"url")+`must be a valid firebase URL and the path can't contain ".", "#", "$", "[", or "]".`)};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class KF{constructor(){this.eventLists_=[],this.recursionDepth_=0}}function Xg(n,e){let t=null;for(let r=0;r<e.length;r++){const s=e[r],i=s.getPath();t!==null&&!J0(i,t.path)&&(n.eventLists_.push(t),t=null),t===null&&(t={events:[],path:i}),t.events.push(s)}t&&n.eventLists_.push(t)}function IR(n,e,t){Xg(n,t),SR(n,r=>J0(r,e))}function Wr(n,e,t){Xg(n,t),SR(n,r=>ns(r,e)||ns(e,r))}function SR(n,e){n.recursionDepth_++;let t=!0;for(let r=0;r<n.eventLists_.length;r++){const s=n.eventLists_[r];if(s){const i=s.path;e(i)?(YF(n.eventLists_[r]),n.eventLists_[r]=null):t=!1}}t&&(n.eventLists_=[]),n.recursionDepth_--}function YF(n){for(let e=0;e<n.events.length;e++){const t=n.events[e];if(t!==null){n.events[e]=null;const r=t.getEventRunner();_a&&Ln("event: "+t.toString()),Vc(r)}}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ER="repo_interrupt",JF=25;class XF{constructor(e,t,r,s){this.repoInfo_=e,this.forceRestClient_=t,this.authTokenProvider_=r,this.appCheckProvider_=s,this.dataUpdateCount=0,this.statsListener_=null,this.eventQueue_=new KF,this.nextWriteId_=1,this.interceptServerDataCallback_=null,this.onDisconnect_=qp(),this.transactionQueueTree_=new vw,this.persistentConnection_=null,this.key=this.repoInfo_.toURLString()}toString(){return(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host}}function ZF(n,e,t){if(n.stats_=Q0(n.repoInfo_),n.forceRestClient_||Pj())n.server_=new zp(n.repoInfo_,(r,s,i,o)=>{AE(n,r,s,i,o)},n.authTokenProvider_,n.appCheckProvider_),setTimeout(()=>CE(n,!0),0);else{if(typeof t<"u"&&t!==null){if(typeof t!="object")throw new Error("Only objects are supported for option databaseAuthVariableOverride");try{bn(t)}catch(r){throw new Error("Invalid authOverride provided: "+r)}}n.persistentConnection_=new ss(n.repoInfo_,e,(r,s,i,o)=>{AE(n,r,s,i,o)},r=>{CE(n,r)},r=>{e4(n,r)},n.authTokenProvider_,n.appCheckProvider_,t),n.server_=n.persistentConnection_}n.authTokenProvider_.addTokenChangeListener(r=>{n.server_.refreshAuthToken(r)}),n.appCheckProvider_.addTokenChangeListener(r=>{n.server_.refreshAppCheckToken(r.token)}),n.statsReporter_=jj(n.repoInfo_,()=>new VV(n.stats_,n.server_)),n.infoData_=new DV,n.infoSyncTree_=new TE({startListening:(r,s,i,o)=>{let a=[];const l=n.infoData_.getNode(r._path);return l.isEmpty()||(a=ph(n.infoSyncTree_,r._path,l),setTimeout(()=>{o("ok")},0)),a},stopListening:()=>{}}),Sw(n,"connected",!1),n.serverSyncTree_=new TE({startListening:(r,s,i,o)=>(n.server_.listen(r,i,s,(a,l)=>{const u=o(a,l);Wr(n.eventQueue_,r._path,u)}),[]),stopListening:(r,s)=>{n.server_.unlisten(r,s)}})}function TR(n){const t=n.infoData_.getNode(new xt(".info/serverTimeOffset")).val()||0;return new Date().getTime()+t}function _h(n){return VF({timestamp:TR(n)})}function AE(n,e,t,r,s){n.dataUpdateCount++;const i=new xt(e);t=n.interceptServerDataCallback_?n.interceptServerDataCallback_(e,t):t;let o=[];if(s)if(r){const l=Vp(t,u=>Zt(u));o=PF(n.serverSyncTree_,i,l,s)}else{const l=Zt(t);o=hR(n.serverSyncTree_,i,l,s)}else if(r){const l=Vp(t,u=>Zt(u));o=RF(n.serverSyncTree_,i,l)}else{const l=Zt(t);o=ph(n.serverSyncTree_,i,l)}let a=i;o.length>0&&(a=hc(n,i)),Wr(n.eventQueue_,a,o)}function CE(n,e){Sw(n,"connected",e),e===!1&&r4(n)}function e4(n,e){Fn(e,(t,r)=>{Sw(n,t,r)})}function Sw(n,e,t){const r=new xt("/.info/"+e),s=Zt(t);n.infoData_.updateSnapshot(r,s);const i=ph(n.infoSyncTree_,r,s);Wr(n.eventQueue_,r,i)}function Zg(n){return n.nextWriteId_++}function t4(n,e,t){const r=DF(n.serverSyncTree_,e);return r!=null?Promise.resolve(r):n.server_.get(e).then(s=>{const i=Zt(s).withIndex(e._queryParams.getIndex());cv(n.serverSyncTree_,e,t,!0);let o;if(e._queryParams.loadsAllData())o=ph(n.serverSyncTree_,e._path,i);else{const a=Md(n.serverSyncTree_,e);o=hR(n.serverSyncTree_,e._path,i,a)}return Wr(n.eventQueue_,e._path,o),Xp(n.serverSyncTree_,e,t,null,!0),i},s=>($c(n,"get for query "+bn(e)+" failed: "+s),Promise.reject(new Error(s))))}function Ew(n,e,t,r,s){$c(n,"set",{path:e.toString(),value:t,priority:r});const i=_h(n),o=Zt(t,r),a=Hg(n.serverSyncTree_,e),l=yw(o,a,i),u=Zg(n),h=dw(n.serverSyncTree_,e,l,u,!0);Xg(n.eventQueue_,h),n.server_.put(e.toString(),o.val(!0),(p,y)=>{const w=p==="ok";w||or("set at "+e+" failed: "+p);const S=so(n.serverSyncTree_,u,!w);Wr(n.eventQueue_,e,S),Ro(n,s,p,y)});const f=bw(n,e);hc(n,f),Wr(n.eventQueue_,f,[])}function n4(n,e,t,r){$c(n,"update",{path:e.toString(),value:t});let s=!0;const i=_h(n),o={};if(Fn(t,(a,l)=>{s=!1,o[a]=mR(Kt(e,a),Zt(l),n.serverSyncTree_,i)}),s)Ln("update() called with empty data.  Don't do anything."),Ro(n,r,"ok",void 0);else{const a=Zg(n),l=CF(n.serverSyncTree_,e,o,a);Xg(n.eventQueue_,l),n.server_.merge(e.toString(),t,(u,h)=>{const f=u==="ok";f||or("update at "+e+" failed: "+u);const p=so(n.serverSyncTree_,a,!f),y=p.length>0?hc(n,e):e;Wr(n.eventQueue_,y,p),Ro(n,r,u,h)}),Fn(t,u=>{const h=bw(n,Kt(e,u));hc(n,h)}),Wr(n.eventQueue_,e,[])}}function r4(n){$c(n,"onDisconnectEvents");const e=_h(n),t=qp();rv(n.onDisconnect_,_t(),(s,i)=>{const o=mR(s,i,n.serverSyncTree_,e);Fc(t,s,o)});let r=[];rv(t,_t(),(s,i)=>{r=r.concat(ph(n.serverSyncTree_,s,i));const o=bw(n,s);hc(n,o)}),n.onDisconnect_=qp(),Wr(n.eventQueue_,_t(),r)}function s4(n,e,t){n.server_.onDisconnectCancel(e.toString(),(r,s)=>{r==="ok"&&nv(n.onDisconnect_,e),Ro(n,t,r,s)})}function RE(n,e,t,r){const s=Zt(t);n.server_.onDisconnectPut(e.toString(),s.val(!0),(i,o)=>{i==="ok"&&Fc(n.onDisconnect_,e,s),Ro(n,r,i,o)})}function i4(n,e,t,r,s){const i=Zt(t,r);n.server_.onDisconnectPut(e.toString(),i.val(!0),(o,a)=>{o==="ok"&&Fc(n.onDisconnect_,e,i),Ro(n,s,o,a)})}function o4(n,e,t,r){if(jp(t)){Ln("onDisconnect().update() called with empty data.  Don't do anything."),Ro(n,r,"ok",void 0);return}n.server_.onDisconnectMerge(e.toString(),t,(s,i)=>{s==="ok"&&Fn(t,(o,a)=>{const l=Zt(a);Fc(n.onDisconnect_,Kt(e,o),l)}),Ro(n,r,s,i)})}function a4(n,e,t){let r;et(e._path)===".info"?r=cv(n.infoSyncTree_,e,t):r=cv(n.serverSyncTree_,e,t),IR(n.eventQueue_,e._path,r)}function dv(n,e,t){let r;et(e._path)===".info"?r=Xp(n.infoSyncTree_,e,t):r=Xp(n.serverSyncTree_,e,t),IR(n.eventQueue_,e._path,r)}function bR(n){n.persistentConnection_&&n.persistentConnection_.interrupt(ER)}function l4(n){n.persistentConnection_&&n.persistentConnection_.resume(ER)}function $c(n,...e){let t="";n.persistentConnection_&&(t=n.persistentConnection_.id+":"),Ln(t,...e)}function Ro(n,e,t,r){e&&Vc(()=>{if(t==="ok")e(null);else{const s=(t||"error").toUpperCase();let i=s;r&&(i+=": "+r);const o=new Error(i);o.code=s,e(o)}})}function c4(n,e,t,r,s,i){$c(n,"transaction on "+e);const o={path:e,update:t,onComplete:r,status:null,order:x1(),applyLocally:i,retryCount:0,unwatcher:s,abortReason:null,currentWriteId:null,currentInputSnapshot:null,currentOutputSnapshotRaw:null,currentOutputSnapshotResolved:null},a=Tw(n,e,void 0);o.currentInputSnapshot=a;const l=o.update(a.val());if(l===void 0)o.unwatcher(),o.currentOutputSnapshotRaw=null,o.currentOutputSnapshotResolved=null,o.onComplete&&o.onComplete(null,!1,o.currentInputSnapshot);else{mh("transaction failed: Data returned ",l,o.path),o.status=0;const u=Kg(n.transactionQueueTree_,e),h=Xa(u)||[];h.push(o),ww(u,h);let f;typeof l=="object"&&l!==null&&Ts(l,".priority")?(f=Ca(l,".priority"),te(jd(f),"Invalid priority returned by transaction. Priority must be a valid string, finite number, server value, or null.")):f=(Hg(n.serverSyncTree_,e)||Le.EMPTY_NODE).getPriority().val();const p=_h(n),y=Zt(l,f),w=yw(y,a,p);o.currentOutputSnapshotRaw=y,o.currentOutputSnapshotResolved=w,o.currentWriteId=Zg(n);const S=dw(n.serverSyncTree_,e,w,o.currentWriteId,o.applyLocally);Wr(n.eventQueue_,e,S),em(n,n.transactionQueueTree_)}}function Tw(n,e,t){return Hg(n.serverSyncTree_,e,t)||Le.EMPTY_NODE}function em(n,e=n.transactionQueueTree_){if(e||tm(n,e),Xa(e)){const t=CR(n,e);te(t.length>0,"Sending zero length transaction queue"),t.every(s=>s.status===0)&&u4(n,gh(e),t)}else yR(e)&&Yg(e,t=>{em(n,t)})}function u4(n,e,t){const r=t.map(u=>u.currentWriteId),s=Tw(n,e,r);let i=s;const o=s.hash();for(let u=0;u<t.length;u++){const h=t[u];te(h.status===0,"tryToSendTransactionQueue_: items in queue should all be run."),h.status=1,h.retryCount++;const f=pr(e,h.path);i=i.updateChild(f,h.currentOutputSnapshotRaw)}const a=i.val(!0),l=e;n.server_.put(l.toString(),a,u=>{$c(n,"transaction put response",{path:l.toString(),status:u});let h=[];if(u==="ok"){const f=[];for(let p=0;p<t.length;p++)t[p].status=2,h=h.concat(so(n.serverSyncTree_,t[p].currentWriteId)),t[p].onComplete&&f.push(()=>t[p].onComplete(null,!0,t[p].currentOutputSnapshotResolved)),t[p].unwatcher();tm(n,Kg(n.transactionQueueTree_,e)),em(n,n.transactionQueueTree_),Wr(n.eventQueue_,e,h);for(let p=0;p<f.length;p++)Vc(f[p])}else{if(u==="datastale")for(let f=0;f<t.length;f++)t[f].status===3?t[f].status=4:t[f].status=0;else{or("transaction at "+l.toString()+" failed: "+u);for(let f=0;f<t.length;f++)t[f].status=4,t[f].abortReason=u}hc(n,e)}},o)}function hc(n,e){const t=AR(n,e),r=gh(t),s=CR(n,t);return d4(n,s,r),r}function d4(n,e,t){if(e.length===0)return;const r=[];let s=[];const o=e.filter(a=>a.status===0).map(a=>a.currentWriteId);for(let a=0;a<e.length;a++){const l=e[a],u=pr(t,l.path);let h=!1,f;if(te(u!==null,"rerunTransactionsUnderNode_: relativePath should not be null."),l.status===4)h=!0,f=l.abortReason,s=s.concat(so(n.serverSyncTree_,l.currentWriteId,!0));else if(l.status===0)if(l.retryCount>=JF)h=!0,f="maxretry",s=s.concat(so(n.serverSyncTree_,l.currentWriteId,!0));else{const p=Tw(n,l.path,o);l.currentInputSnapshot=p;const y=e[a].update(p.val());if(y!==void 0){mh("transaction failed: Data returned ",y,l.path);let w=Zt(y);typeof y=="object"&&y!=null&&Ts(y,".priority")||(w=w.updatePriority(p.getPriority()));const k=l.currentWriteId,E=_h(n),x=yw(w,p,E);l.currentOutputSnapshotRaw=w,l.currentOutputSnapshotResolved=x,l.currentWriteId=Zg(n),o.splice(o.indexOf(k),1),s=s.concat(dw(n.serverSyncTree_,l.path,x,l.currentWriteId,l.applyLocally)),s=s.concat(so(n.serverSyncTree_,k,!0))}else h=!0,f="nodata",s=s.concat(so(n.serverSyncTree_,l.currentWriteId,!0))}Wr(n.eventQueue_,t,s),s=[],h&&(e[a].status=2,function(p){setTimeout(p,Math.floor(0))}(e[a].unwatcher),e[a].onComplete&&(f==="nodata"?r.push(()=>e[a].onComplete(null,!1,e[a].currentInputSnapshot)):r.push(()=>e[a].onComplete(new Error(f),!1,null))))}tm(n,n.transactionQueueTree_);for(let a=0;a<r.length;a++)Vc(r[a]);em(n,n.transactionQueueTree_)}function AR(n,e){let t,r=n.transactionQueueTree_;for(t=et(e);t!==null&&Xa(r)===void 0;)r=Kg(r,t),e=Pt(e),t=et(e);return r}function CR(n,e){const t=[];return RR(n,e,t),t.sort((r,s)=>r.order-s.order),t}function RR(n,e,t){const r=Xa(e);if(r)for(let s=0;s<r.length;s++)t.push(r[s]);Yg(e,s=>{RR(n,s,t)})}function tm(n,e){const t=Xa(e);if(t){let r=0;for(let s=0;s<t.length;s++)t[s].status!==2&&(t[r]=t[s],r++);t.length=r,ww(e,t.length>0?t:void 0)}Yg(e,r=>{tm(n,r)})}function bw(n,e){const t=gh(AR(n,e)),r=Kg(n.transactionQueueTree_,e);return BF(r,s=>{Py(n,s)}),Py(n,r),_R(r,s=>{Py(n,s)}),t}function Py(n,e){const t=Xa(e);if(t){const r=[];let s=[],i=-1;for(let o=0;o<t.length;o++)t[o].status===3||(t[o].status===1?(te(i===o-1,"All SENT items should be at beginning of queue."),i=o,t[o].status=3,t[o].abortReason="set"):(te(t[o].status===0,"Unexpected transaction status in abort"),t[o].unwatcher(),s=s.concat(so(n.serverSyncTree_,t[o].currentWriteId,!0)),t[o].onComplete&&r.push(t[o].onComplete.bind(null,new Error("set"),!1,null))));i===-1?ww(e,void 0):t.length=i+1,Wr(n.eventQueue_,gh(e),s);for(let o=0;o<r.length;o++)Vc(r[o])}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function h4(n){let e="";const t=n.split("/");for(let r=0;r<t.length;r++)if(t[r].length>0){let s=t[r];try{s=decodeURIComponent(s.replace(/\+/g," "))}catch{}e+="/"+s}return e}function f4(n){const e={};n.charAt(0)==="?"&&(n=n.substring(1));for(const t of n.split("&")){if(t.length===0)continue;const r=t.split("=");r.length===2?e[decodeURIComponent(r[0])]=decodeURIComponent(r[1]):or(`Invalid query segment '${t}' in query '${n}'`)}return e}const hv=function(n,e){const t=p4(n),r=t.namespace;t.domain==="firebase.com"&&Xs(t.host+" is no longer supported. Please use <YOUR FIREBASE>.firebaseio.com instead"),(!r||r==="undefined")&&t.domain!=="localhost"&&Xs("Cannot parse Firebase url. Please use https://<YOUR FIREBASE>.firebaseio.com"),t.secure||Sj();const s=t.scheme==="ws"||t.scheme==="wss";return{repoInfo:new L1(t.host,t.secure,r,s,e,"",r!==t.subdomain),path:new xt(t.pathString)}},p4=function(n){let e="",t="",r="",s="",i="",o=!0,a="https",l=443;if(typeof n=="string"){let u=n.indexOf("//");u>=0&&(a=n.substring(0,u-1),n=n.substring(u+2));let h=n.indexOf("/");h===-1&&(h=n.length);let f=n.indexOf("?");f===-1&&(f=n.length),e=n.substring(0,Math.min(h,f)),h<f&&(s=h4(n.substring(h,f)));const p=f4(n.substring(Math.min(n.length,f)));u=e.indexOf(":"),u>=0?(o=a==="https"||a==="wss",l=parseInt(e.substring(u+1),10)):u=e.length;const y=e.slice(0,u);if(y.toLowerCase()==="localhost")t="localhost";else if(y.split(".").length<=2)t=y;else{const w=e.indexOf(".");r=e.substring(0,w).toLowerCase(),t=e.substring(w+1),i=r}"ns"in p&&(i=p.ns)}return{host:e,port:l,domain:t,subdomain:r,secure:o,scheme:a,pathString:s,namespace:i}};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const NE="-0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ_abcdefghijklmnopqrstuvwxyz",g4=function(){let n=0;const e=[];return function(t){const r=t===n;n=t;let s;const i=new Array(8);for(s=7;s>=0;s--)i[s]=NE.charAt(t%64),t=Math.floor(t/64);te(t===0,"Cannot push at time == 0");let o=i.join("");if(r){for(s=11;s>=0&&e[s]===63;s--)e[s]=0;e[s]++}else for(s=0;s<12;s++)e[s]=Math.floor(Math.random()*64);for(s=0;s<12;s++)o+=NE.charAt(e[s]);return te(o.length===20,"nextPushId: Length should be 20."),o}}();/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class NR{constructor(e,t,r,s){this.eventType=e,this.eventRegistration=t,this.snapshot=r,this.prevName=s}getPath(){const e=this.snapshot.ref;return this.eventType==="value"?e._path:e.parent._path}getEventType(){return this.eventType}getEventRunner(){return this.eventRegistration.getEventRunner(this)}toString(){return this.getPath().toString()+":"+this.eventType+":"+bn(this.snapshot.exportVal())}}class kR{constructor(e,t,r){this.eventRegistration=e,this.error=t,this.path=r}getPath(){return this.path}getEventType(){return"cancel"}getEventRunner(){return this.eventRegistration.getEventRunner(this)}toString(){return this.path.toString()+":cancel"}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Aw{constructor(e,t){this.snapshotCallback=e,this.cancelCallback=t}onValue(e,t){this.snapshotCallback.call(null,e,t)}onCancel(e){return te(this.hasCancelCallback,"Raising a cancel event on a listener with no cancel callback"),this.cancelCallback.call(null,e)}get hasCancelCallback(){return!!this.cancelCallback}matches(e){return this.snapshotCallback===e.snapshotCallback||this.snapshotCallback.userCallback!==void 0&&this.snapshotCallback.userCallback===e.snapshotCallback.userCallback&&this.snapshotCallback.context===e.snapshotCallback.context}}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class m4{constructor(e,t){this._repo=e,this._path=t}cancel(){const e=new Mr;return s4(this._repo,this._path,e.wrapCallback(()=>{})),e.promise}remove(){Us("OnDisconnect.remove",this._path);const e=new Mr;return RE(this._repo,this._path,null,e.wrapCallback(()=>{})),e.promise}set(e){Us("OnDisconnect.set",this._path),Zs("OnDisconnect.set",e,this._path,!1);const t=new Mr;return RE(this._repo,this._path,e,t.wrapCallback(()=>{})),t.promise}setWithPriority(e,t){Us("OnDisconnect.setWithPriority",this._path),Zs("OnDisconnect.setWithPriority",e,this._path,!1),xw("OnDisconnect.setWithPriority",t,!1);const r=new Mr;return i4(this._repo,this._path,e,t,r.wrapCallback(()=>{})),r.promise}update(e){Us("OnDisconnect.update",this._path),wR("OnDisconnect.update",e,this._path,!1);const t=new Mr;return o4(this._repo,this._path,e,t.wrapCallback(()=>{})),t.promise}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Kr{constructor(e,t,r,s){this._repo=e,this._path=t,this._queryParams=r,this._orderByCalled=s}get key(){return tt(this._path)?null:Y0(this._path)}get ref(){return new bs(this._repo,this._path)}get _queryIdentifier(){const e=gE(this._queryParams),t=G0(e);return t==="{}"?"default":t}get _queryObject(){return gE(this._queryParams)}isEqual(e){if(e=oe(e),!(e instanceof Kr))return!1;const t=this._repo===e._repo,r=J0(this._path,e._path),s=this._queryIdentifier===e._queryIdentifier;return t&&r&&s}toJSON(){return this.toString()}toString(){return this._repo.toString()+oV(this._path)}}function nm(n,e){if(n._orderByCalled===!0)throw new Error(e+": You can't combine multiple orderBy calls.")}function Uo(n){let e=null,t=null;if(n.hasStart()&&(e=n.getIndexStartValue()),n.hasEnd()&&(t=n.getIndexEndValue()),n.getIndex()===Hs){const r="Query: When ordering by key, you may only pass one argument to startAt(), endAt(), or equalTo().",s="Query: When ordering by key, the argument passed to startAt(), startAfter(), endAt(), endBefore(), or equalTo() must be a string.";if(n.hasStart()){if(n.getIndexStartName()!==To)throw new Error(r);if(typeof e!="string")throw new Error(s)}if(n.hasEnd()){if(n.getIndexEndName()!==Ei)throw new Error(r);if(typeof t!="string")throw new Error(s)}}else if(n.getIndex()===Mt){if(e!=null&&!jd(e)||t!=null&&!jd(t))throw new Error("Query: When ordering by priority, the first argument passed to startAt(), startAfter() endAt(), endBefore(), or equalTo() must be a valid priority value (null, a number, or a string).")}else if(te(n.getIndex()instanceof ew||n.getIndex()===tw,"unknown index type."),e!=null&&typeof e=="object"||t!=null&&typeof t=="object")throw new Error("Query: First argument passed to startAt(), startAfter(), endAt(), endBefore(), or equalTo() cannot be an object.")}function rm(n){if(n.hasStart()&&n.hasEnd()&&n.hasLimit()&&!n.hasAnchoredLimit())throw new Error("Query: Can't combine startAt(), startAfter(), endAt(), endBefore(), and limit(). Use limitToFirst() or limitToLast() instead.")}class bs extends Kr{constructor(e,t){super(e,t,new rw,!1)}get parent(){const e=q1(this._path);return e===null?null:new bs(this._repo,e)}get root(){let e=this;for(;e.parent!==null;)e=e.parent;return e}}class Pa{constructor(e,t,r){this._node=e,this.ref=t,this._index=r}get priority(){return this._node.getPriority().val()}get key(){return this.ref.key}get size(){return this._node.numChildren()}child(e){const t=new xt(e),r=fc(this.ref,e);return new Pa(this._node.getChild(t),r,Mt)}exists(){return!this._node.isEmpty()}exportVal(){return this._node.val(!0)}forEach(e){return this._node.isLeafNode()?!1:!!this._node.forEachChild(this._index,(r,s)=>e(new Pa(s,fc(this.ref,r),Mt)))}hasChild(e){const t=new xt(e);return!this._node.getChild(t).isEmpty()}hasChildren(){return this._node.isLeafNode()?!1:!this._node.isEmpty()}toJSON(){return this.exportVal()}val(){return this._node.val()}}function he(n,e){return n=oe(n),n._checkNotDeleted("ref"),e!==void 0?fc(n._root,e):n._root}function jq(n,e){n=oe(n),n._checkNotDeleted("refFromURL");const t=hv(e,n._repo.repoInfo_.nodeAdmin);xR("refFromURL",t);const r=t.repoInfo;return!n._repo.repoInfo_.isCustomHost()&&r.host!==n._repo.repoInfo_.host&&Xs("refFromURL: Host name does not match the current database: (found "+r.host+" but expected "+n._repo.repoInfo_.host+")"),he(n,t.path.toString())}function fc(n,e){return n=oe(n),et(n._path)===null?QF("child","path",e,!1):Iw("child","path",e,!1),new bs(n._repo,Kt(n._path,e))}function Vq(n){return n=oe(n),new m4(n._repo,n._path)}function y4(n,e){n=oe(n),Us("push",n._path),Zs("push",e,n._path,!0);const t=TR(n._repo),r=g4(t),s=fc(n,r),i=fc(n,r);let o;return e!=null?o=Xe(i,e).then(()=>i):o=Promise.resolve(i),s.then=o.then.bind(o),s.catch=o.then.bind(o,void 0),s}function Fq(n){return Us("remove",n._path),Xe(n,null)}function Xe(n,e){n=oe(n),Us("set",n._path),Zs("set",e,n._path,!1);const t=new Mr;return Ew(n._repo,n._path,e,null,t.wrapCallback(()=>{})),t.promise}function Uq(n,e){n=oe(n),Us("setPriority",n._path),xw("setPriority",e,!1);const t=new Mr;return Ew(n._repo,Kt(n._path,".priority"),e,null,t.wrapCallback(()=>{})),t.promise}function $q(n,e,t){if(Us("setWithPriority",n._path),Zs("setWithPriority",e,n._path,!1),xw("setWithPriority",t,!1),n.key===".length"||n.key===".keys")throw"setWithPriority failed: "+n.key+" is a read-only object.";const r=new Mr;return Ew(n._repo,n._path,e,t,r.wrapCallback(()=>{})),r.promise}function Bq(n,e){wR("update",e,n._path,!1);const t=new Mr;return n4(n._repo,n._path,e,t.wrapCallback(()=>{})),t.promise}function $e(n){n=oe(n);const e=new Aw(()=>{}),t=new vh(e);return t4(n._repo,n,t).then(r=>new Pa(r,new bs(n._repo,n._path),n._queryParams.getIndex()))}class vh{constructor(e){this.callbackContext=e}respondsTo(e){return e==="value"}createEvent(e,t){const r=t._queryParams.getIndex();return new NR("value",this,new Pa(e.snapshotNode,new bs(t._repo,t._path),r))}getEventRunner(e){return e.getEventType()==="cancel"?()=>this.callbackContext.onCancel(e.error):()=>this.callbackContext.onValue(e.snapshot,null)}createCancelEvent(e,t){return this.callbackContext.hasCancelCallback?new kR(this,e,t):null}matches(e){return e instanceof vh?!e.callbackContext||!this.callbackContext?!0:e.callbackContext.matches(this.callbackContext):!1}hasAnyCallback(){return this.callbackContext!==null}}class sm{constructor(e,t){this.eventType=e,this.callbackContext=t}respondsTo(e){let t=e==="children_added"?"child_added":e;return t=t==="children_removed"?"child_removed":t,this.eventType===t}createCancelEvent(e,t){return this.callbackContext.hasCancelCallback?new kR(this,e,t):null}createEvent(e,t){te(e.childName!=null,"Child events should have a childName.");const r=fc(new bs(t._repo,t._path),e.childName),s=t._queryParams.getIndex();return new NR(e.type,this,new Pa(e.snapshotNode,r,s),e.prevName)}getEventRunner(e){return e.getEventType()==="cancel"?()=>this.callbackContext.onCancel(e.error):()=>this.callbackContext.onValue(e.snapshot,e.prevName)}matches(e){return e instanceof sm?this.eventType===e.eventType&&(!this.callbackContext||!e.callbackContext||this.callbackContext.matches(e.callbackContext)):!1}hasAnyCallback(){return!!this.callbackContext}}function wh(n,e,t,r,s){let i;if(typeof r=="object"&&(i=void 0,s=r),typeof r=="function"&&(i=r),s&&s.onlyOnce){const l=t,u=(h,f)=>{dv(n._repo,n,a),l(h,f)};u.userCallback=t.userCallback,u.context=t.context,t=u}const o=new Aw(t,i||void 0),a=e==="value"?new vh(o):new sm(e,o);return a4(n._repo,n,a),()=>dv(n._repo,n,a)}function PR(n,e,t,r){return wh(n,"value",e,t,r)}function zq(n,e,t,r){return wh(n,"child_added",e,t,r)}function qq(n,e,t,r){return wh(n,"child_changed",e,t,r)}function Wq(n,e,t,r){return wh(n,"child_moved",e,t,r)}function Gq(n,e,t,r){return wh(n,"child_removed",e,t,r)}function Hq(n,e,t){let r=null;const s=t?new Aw(t):null;e==="value"?r=new vh(s):e&&(r=new sm(e,s)),dv(n._repo,n,r)}let As=class{},DR=class extends As{constructor(e,t){super(),this._value=e,this._key=t,this.type="endAt"}_apply(e){Zs("endAt",this._value,e._path,!0);const t=tv(e._queryParams,this._value,this._key);if(rm(t),Uo(t),e._queryParams.hasEnd())throw new Error("endAt: Starting point was already set (by another call to endAt, endBefore or equalTo).");return new Kr(e._repo,e._path,t,e._orderByCalled)}};function Yq(n,e){return yh("endAt","key",e,!0),new DR(n,e)}class _4 extends As{constructor(e,t){super(),this._value=e,this._key=t,this.type="endBefore"}_apply(e){Zs("endBefore",this._value,e._path,!1);const t=PV(e._queryParams,this._value,this._key);if(rm(t),Uo(t),e._queryParams.hasEnd())throw new Error("endBefore: Starting point was already set (by another call to endAt, endBefore or equalTo).");return new Kr(e._repo,e._path,t,e._orderByCalled)}}function Jq(n,e){return yh("endBefore","key",e,!0),new _4(n,e)}let OR=class extends As{constructor(e,t){super(),this._value=e,this._key=t,this.type="startAt"}_apply(e){Zs("startAt",this._value,e._path,!0);const t=ev(e._queryParams,this._value,this._key);if(rm(t),Uo(t),e._queryParams.hasStart())throw new Error("startAt: Starting point was already set (by another call to startAt, startBefore or equalTo).");return new Kr(e._repo,e._path,t,e._orderByCalled)}};function Zq(n=null,e){return yh("startAt","key",e,!0),new OR(n,e)}class v4 extends As{constructor(e,t){super(),this._value=e,this._key=t,this.type="startAfter"}_apply(e){Zs("startAfter",this._value,e._path,!1);const t=kV(e._queryParams,this._value,this._key);if(rm(t),Uo(t),e._queryParams.hasStart())throw new Error("startAfter: Starting point was already set (by another call to startAt, startAfter, or equalTo).");return new Kr(e._repo,e._path,t,e._orderByCalled)}}function e8(n,e){return yh("startAfter","key",e,!0),new v4(n,e)}class w4 extends As{constructor(e){super(),this._limit=e,this.type="limitToFirst"}_apply(e){if(e._queryParams.hasLimit())throw new Error("limitToFirst: Limit was already set (by another call to limitToFirst or limitToLast).");return new Kr(e._repo,e._path,RV(e._queryParams,this._limit),e._orderByCalled)}}function t8(n){if(typeof n!="number"||Math.floor(n)!==n||n<=0)throw new Error("limitToFirst: First argument must be a positive integer.");return new w4(n)}class x4 extends As{constructor(e){super(),this._limit=e,this.type="limitToLast"}_apply(e){if(e._queryParams.hasLimit())throw new Error("limitToLast: Limit was already set (by another call to limitToFirst or limitToLast).");return new Kr(e._repo,e._path,NV(e._queryParams,this._limit),e._orderByCalled)}}function n8(n){if(typeof n!="number"||Math.floor(n)!==n||n<=0)throw new Error("limitToLast: First argument must be a positive integer.");return new x4(n)}class I4 extends As{constructor(e){super(),this._path=e,this.type="orderByChild"}_apply(e){nm(e,"orderByChild");const t=new xt(this._path);if(tt(t))throw new Error("orderByChild: cannot pass in empty path. Use orderByValue() instead.");const r=new ew(t),s=zg(e._queryParams,r);return Uo(s),new Kr(e._repo,e._path,s,!0)}}function r8(n){if(n==="$key")throw new Error('orderByChild: "$key" is invalid.  Use orderByKey() instead.');if(n==="$priority")throw new Error('orderByChild: "$priority" is invalid.  Use orderByPriority() instead.');if(n==="$value")throw new Error('orderByChild: "$value" is invalid.  Use orderByValue() instead.');return Iw("orderByChild","path",n,!1),new I4(n)}class S4 extends As{constructor(){super(...arguments),this.type="orderByKey"}_apply(e){nm(e,"orderByKey");const t=zg(e._queryParams,Hs);return Uo(t),new Kr(e._repo,e._path,t,!0)}}function s8(){return new S4}class E4 extends As{constructor(){super(...arguments),this.type="orderByPriority"}_apply(e){nm(e,"orderByPriority");const t=zg(e._queryParams,Mt);return Uo(t),new Kr(e._repo,e._path,t,!0)}}function i8(){return new E4}class T4 extends As{constructor(){super(...arguments),this.type="orderByValue"}_apply(e){nm(e,"orderByValue");const t=zg(e._queryParams,tw);return Uo(t),new Kr(e._repo,e._path,t,!0)}}function o8(){return new T4}class b4 extends As{constructor(e,t){super(),this._value=e,this._key=t,this.type="equalTo"}_apply(e){if(Zs("equalTo",this._value,e._path,!1),e._queryParams.hasStart())throw new Error("equalTo: Starting point was already set (by another call to startAt/startAfter or equalTo).");if(e._queryParams.hasEnd())throw new Error("equalTo: Ending point was already set (by another call to endAt/endBefore or equalTo).");return new DR(this._value,this._key)._apply(new OR(this._value,this._key)._apply(e))}}function a8(n,e){return yh("equalTo","key",e,!0),new b4(n,e)}function l8(n,...e){let t=oe(n);for(const r of e)t=r._apply(t);return t}wF(bs);TF(bs);/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const A4="FIREBASE_DATABASE_EMULATOR_HOST",fv={};let LR=!1;function C4(n,e,t,r){const s=e.lastIndexOf(":"),i=e.substring(0,s),o=ki(i);n.repoInfo_=new L1(e,o,n.repoInfo_.namespace,n.repoInfo_.webSocketOnly,n.repoInfo_.nodeAdmin,n.repoInfo_.persistenceKey,n.repoInfo_.includeNamespaceInQueryParams,!0,t),r&&(n.authTokenProvider_=r)}function MR(n,e,t,r,s){let i=r||n.options.databaseURL;i===void 0&&(n.options.projectId||Xs("Can't determine Firebase Database URL. Be sure to include  a Project ID when calling firebase.initializeApp()."),Ln("Using default host for project ",n.options.projectId),i=`${n.options.projectId}-default-rtdb.firebaseio.com`);let o=hv(i,s),a=o.repoInfo,l,u;typeof process<"u"&&process.env&&(u=process.env[A4]),u?(l=!0,i=`http://${u}?ns=${a.namespace}`,o=hv(i,s),a=o.repoInfo):l=!o.repoInfo.secure;const h=s&&l?new Hl(Hl.OWNER):new Oj(n.name,n.options,e);xR("Invalid Firebase Database URL",o),tt(o.path)||Xs("Database URL must point to the root of a Firebase Database (not including a child path).");const f=N4(a,n,h,new Dj(n,t));return new P4(f,n)}function R4(n,e){const t=fv[e];(!t||t[n.key]!==n)&&Xs(`Database ${e}(${n.repoInfo_}) has already been deleted.`),bR(n),delete t[n.key]}function N4(n,e,t,r){let s=fv[e.name];s||(s={},fv[e.name]=s);let i=s[n.toURLString()];return i&&Xs("Database initialized multiple times. Please make sure the format of the database URL matches with each database() call."),i=new XF(n,LR,t,r),s[n.toURLString()]=i,i}function k4(n){LR=n}class P4{constructor(e,t){this._repoInternal=e,this.app=t,this.type="database",this._instanceStarted=!1}get _repo(){return this._instanceStarted||(ZF(this._repoInternal,this.app.options.appId,this.app.options.databaseAuthVariableOverride),this._instanceStarted=!0),this._repoInternal}get _root(){return this._rootInternal||(this._rootInternal=new bs(this._repo,_t())),this._rootInternal}_delete(){return this._rootInternal!==null&&(R4(this._repo,this.app.name),this._repoInternal=null,this._rootInternal=null),Promise.resolve()}_checkNotDeleted(e){this._rootInternal===null&&Xs("Cannot call "+e+" on a deleted database.")}}function jR(){lc.IS_TRANSPORT_INITIALIZED&&or("Transport has already been initialized. Please call this function before calling ref or setting up a listener")}function c8(){jR(),ro.forceDisallow()}function u8(){jR(),es.forceDisallow(),ro.forceAllow()}function D4(n=uh(),e){const t=ti(n,"database").getImmediate({identifier:e});if(!t._instanceStarted){const r=t1("database");r&&O4(t,...r)}return t}function O4(n,e,t,r={}){n=oe(n),n._checkNotDeleted("useEmulator");const s=`${e}:${t}`,i=n._repoInternal;if(n._instanceStarted){if(s===n._repoInternal.repoInfo_.host&&qr(r,i.repoInfo_.emulatorOptions))return;Xs("connectDatabaseEmulator() cannot initialize or alter the emulator configuration after the database instance has started.")}let o;if(i.repoInfo_.nodeAdmin)r.mockUserToken&&Xs('mockUserToken is not supported by the Admin SDK. For client access with mock users, please use the "firebase" package instead of "firebase-admin".'),o=new Hl(Hl.OWNER);else if(r.mockUserToken){const a=typeof r.mockUserToken=="string"?r.mockUserToken:s1(r.mockUserToken,n.app.options.projectId);o=new Hl(a)}ki(e)&&(Vg(e),U0("Database",!0)),C4(i,s,r,o)}function d8(n){n=oe(n),n._checkNotDeleted("goOffline"),bR(n._repo)}function h8(n){n=oe(n),n._checkNotDeleted("goOnline"),l4(n._repo)}function f8(n,e){S1(n,e)}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function L4(n){v1(Ka),Ss(new Nr("database",(e,{instanceIdentifier:t})=>{const r=e.getProvider("app").getImmediate(),s=e.getProvider("auth-internal"),i=e.getProvider("app-check-internal");return MR(r,s,i,t)},"PUBLIC").setMultipleInstances(!0)),Cr(XS,ZS,n),Cr(XS,ZS,"esm2020")}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const M4={".sv":"timestamp"};function p8(){return M4}function g8(n){return{".sv":{increment:n}}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class j4{constructor(e,t){this.committed=e,this.snapshot=t}toJSON(){return{committed:this.committed,snapshot:this.snapshot.toJSON()}}}function m8(n,e,t){if(n=oe(n),Us("Reference.transaction",n._path),n.key===".length"||n.key===".keys")throw"Reference.transaction failed: "+n.key+" is a read-only object.";const r=(t==null?void 0:t.applyLocally)??!0,s=new Mr,i=(a,l,u)=>{let h=null;a?s.reject(a):(h=new Pa(u,new bs(n._repo,n._path),Mt),s.resolve(new j4(l,h)))},o=PR(n,()=>{});return c4(n._repo,n._path,e,i,o,r),s.promise}ss.prototype.simpleListen=function(n,e){this.sendRequest("q",{p:n},e)};ss.prototype.echo=function(n,e){this.sendRequest("echo",{d:n},e)};const y8=function(n){const e=ss.prototype.put;return ss.prototype.put=function(t,r,s,i){i!==void 0&&(i=n()),e.call(this,t,r,s,i)},function(){ss.prototype.put=e}},_8=function(n){k4(n)};/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function v8({app:n,url:e,version:t,customAuthImpl:r,customAppCheckImpl:s,nodeAdmin:i=!1}){v1(t);const o=new h1("database-standalone"),a=new W_("auth-internal",o);let l;return s&&(l=new W_("app-check-internal",o),l.setComponent(new Nr("app-check-internal",()=>s,"PRIVATE"))),a.setComponent(new Nr("auth-internal",()=>r,"PRIVATE")),MR(n,a,l,e,i)}L4();var kE=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};/** @license
Copyright The Closure Library Authors.
SPDX-License-Identifier: Apache-2.0
*/var wo,VR;(function(){var n;/** @license

 Copyright The Closure Library Authors.
 SPDX-License-Identifier: Apache-2.0
*/function e(R,v){function T(){}T.prototype=v.prototype,R.D=v.prototype,R.prototype=new T,R.prototype.constructor=R,R.C=function(C,A,b){for(var _=Array(arguments.length-2),B=2;B<arguments.length;B++)_[B-2]=arguments[B];return v.prototype[A].apply(C,_)}}function t(){this.blockSize=-1}function r(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.B=Array(this.blockSize),this.o=this.h=0,this.s()}e(r,t),r.prototype.s=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.o=this.h=0};function s(R,v,T){T||(T=0);var C=Array(16);if(typeof v=="string")for(var A=0;16>A;++A)C[A]=v.charCodeAt(T++)|v.charCodeAt(T++)<<8|v.charCodeAt(T++)<<16|v.charCodeAt(T++)<<24;else for(A=0;16>A;++A)C[A]=v[T++]|v[T++]<<8|v[T++]<<16|v[T++]<<24;v=R.g[0],T=R.g[1],A=R.g[2];var b=R.g[3],_=v+(b^T&(A^b))+C[0]+3614090360&4294967295;v=T+(_<<7&4294967295|_>>>25),_=b+(A^v&(T^A))+C[1]+3905402710&4294967295,b=v+(_<<12&4294967295|_>>>20),_=A+(T^b&(v^T))+C[2]+606105819&4294967295,A=b+(_<<17&4294967295|_>>>15),_=T+(v^A&(b^v))+C[3]+3250441966&4294967295,T=A+(_<<22&4294967295|_>>>10),_=v+(b^T&(A^b))+C[4]+4118548399&4294967295,v=T+(_<<7&4294967295|_>>>25),_=b+(A^v&(T^A))+C[5]+1200080426&4294967295,b=v+(_<<12&4294967295|_>>>20),_=A+(T^b&(v^T))+C[6]+2821735955&4294967295,A=b+(_<<17&4294967295|_>>>15),_=T+(v^A&(b^v))+C[7]+4249261313&4294967295,T=A+(_<<22&4294967295|_>>>10),_=v+(b^T&(A^b))+C[8]+1770035416&4294967295,v=T+(_<<7&4294967295|_>>>25),_=b+(A^v&(T^A))+C[9]+2336552879&4294967295,b=v+(_<<12&4294967295|_>>>20),_=A+(T^b&(v^T))+C[10]+4294925233&4294967295,A=b+(_<<17&4294967295|_>>>15),_=T+(v^A&(b^v))+C[11]+2304563134&4294967295,T=A+(_<<22&4294967295|_>>>10),_=v+(b^T&(A^b))+C[12]+1804603682&4294967295,v=T+(_<<7&4294967295|_>>>25),_=b+(A^v&(T^A))+C[13]+4254626195&4294967295,b=v+(_<<12&4294967295|_>>>20),_=A+(T^b&(v^T))+C[14]+2792965006&4294967295,A=b+(_<<17&4294967295|_>>>15),_=T+(v^A&(b^v))+C[15]+1236535329&4294967295,T=A+(_<<22&4294967295|_>>>10),_=v+(A^b&(T^A))+C[1]+4129170786&4294967295,v=T+(_<<5&4294967295|_>>>27),_=b+(T^A&(v^T))+C[6]+3225465664&4294967295,b=v+(_<<9&4294967295|_>>>23),_=A+(v^T&(b^v))+C[11]+643717713&4294967295,A=b+(_<<14&4294967295|_>>>18),_=T+(b^v&(A^b))+C[0]+3921069994&4294967295,T=A+(_<<20&4294967295|_>>>12),_=v+(A^b&(T^A))+C[5]+3593408605&4294967295,v=T+(_<<5&4294967295|_>>>27),_=b+(T^A&(v^T))+C[10]+38016083&4294967295,b=v+(_<<9&4294967295|_>>>23),_=A+(v^T&(b^v))+C[15]+3634488961&4294967295,A=b+(_<<14&4294967295|_>>>18),_=T+(b^v&(A^b))+C[4]+3889429448&4294967295,T=A+(_<<20&4294967295|_>>>12),_=v+(A^b&(T^A))+C[9]+568446438&4294967295,v=T+(_<<5&4294967295|_>>>27),_=b+(T^A&(v^T))+C[14]+3275163606&4294967295,b=v+(_<<9&4294967295|_>>>23),_=A+(v^T&(b^v))+C[3]+4107603335&4294967295,A=b+(_<<14&4294967295|_>>>18),_=T+(b^v&(A^b))+C[8]+1163531501&4294967295,T=A+(_<<20&4294967295|_>>>12),_=v+(A^b&(T^A))+C[13]+2850285829&4294967295,v=T+(_<<5&4294967295|_>>>27),_=b+(T^A&(v^T))+C[2]+4243563512&4294967295,b=v+(_<<9&4294967295|_>>>23),_=A+(v^T&(b^v))+C[7]+1735328473&4294967295,A=b+(_<<14&4294967295|_>>>18),_=T+(b^v&(A^b))+C[12]+2368359562&4294967295,T=A+(_<<20&4294967295|_>>>12),_=v+(T^A^b)+C[5]+4294588738&4294967295,v=T+(_<<4&4294967295|_>>>28),_=b+(v^T^A)+C[8]+2272392833&4294967295,b=v+(_<<11&4294967295|_>>>21),_=A+(b^v^T)+C[11]+1839030562&4294967295,A=b+(_<<16&4294967295|_>>>16),_=T+(A^b^v)+C[14]+4259657740&4294967295,T=A+(_<<23&4294967295|_>>>9),_=v+(T^A^b)+C[1]+2763975236&4294967295,v=T+(_<<4&4294967295|_>>>28),_=b+(v^T^A)+C[4]+1272893353&4294967295,b=v+(_<<11&4294967295|_>>>21),_=A+(b^v^T)+C[7]+4139469664&4294967295,A=b+(_<<16&4294967295|_>>>16),_=T+(A^b^v)+C[10]+3200236656&4294967295,T=A+(_<<23&4294967295|_>>>9),_=v+(T^A^b)+C[13]+681279174&4294967295,v=T+(_<<4&4294967295|_>>>28),_=b+(v^T^A)+C[0]+3936430074&4294967295,b=v+(_<<11&4294967295|_>>>21),_=A+(b^v^T)+C[3]+3572445317&4294967295,A=b+(_<<16&4294967295|_>>>16),_=T+(A^b^v)+C[6]+76029189&4294967295,T=A+(_<<23&4294967295|_>>>9),_=v+(T^A^b)+C[9]+3654602809&4294967295,v=T+(_<<4&4294967295|_>>>28),_=b+(v^T^A)+C[12]+3873151461&4294967295,b=v+(_<<11&4294967295|_>>>21),_=A+(b^v^T)+C[15]+530742520&4294967295,A=b+(_<<16&4294967295|_>>>16),_=T+(A^b^v)+C[2]+3299628645&4294967295,T=A+(_<<23&4294967295|_>>>9),_=v+(A^(T|~b))+C[0]+4096336452&4294967295,v=T+(_<<6&4294967295|_>>>26),_=b+(T^(v|~A))+C[7]+1126891415&4294967295,b=v+(_<<10&4294967295|_>>>22),_=A+(v^(b|~T))+C[14]+2878612391&4294967295,A=b+(_<<15&4294967295|_>>>17),_=T+(b^(A|~v))+C[5]+4237533241&4294967295,T=A+(_<<21&4294967295|_>>>11),_=v+(A^(T|~b))+C[12]+1700485571&4294967295,v=T+(_<<6&4294967295|_>>>26),_=b+(T^(v|~A))+C[3]+2399980690&4294967295,b=v+(_<<10&4294967295|_>>>22),_=A+(v^(b|~T))+C[10]+4293915773&4294967295,A=b+(_<<15&4294967295|_>>>17),_=T+(b^(A|~v))+C[1]+2240044497&4294967295,T=A+(_<<21&4294967295|_>>>11),_=v+(A^(T|~b))+C[8]+1873313359&4294967295,v=T+(_<<6&4294967295|_>>>26),_=b+(T^(v|~A))+C[15]+4264355552&4294967295,b=v+(_<<10&4294967295|_>>>22),_=A+(v^(b|~T))+C[6]+2734768916&4294967295,A=b+(_<<15&4294967295|_>>>17),_=T+(b^(A|~v))+C[13]+1309151649&4294967295,T=A+(_<<21&4294967295|_>>>11),_=v+(A^(T|~b))+C[4]+4149444226&4294967295,v=T+(_<<6&4294967295|_>>>26),_=b+(T^(v|~A))+C[11]+3174756917&4294967295,b=v+(_<<10&4294967295|_>>>22),_=A+(v^(b|~T))+C[2]+718787259&4294967295,A=b+(_<<15&4294967295|_>>>17),_=T+(b^(A|~v))+C[9]+3951481745&4294967295,R.g[0]=R.g[0]+v&4294967295,R.g[1]=R.g[1]+(A+(_<<21&4294967295|_>>>11))&4294967295,R.g[2]=R.g[2]+A&4294967295,R.g[3]=R.g[3]+b&4294967295}r.prototype.u=function(R,v){v===void 0&&(v=R.length);for(var T=v-this.blockSize,C=this.B,A=this.h,b=0;b<v;){if(A==0)for(;b<=T;)s(this,R,b),b+=this.blockSize;if(typeof R=="string"){for(;b<v;)if(C[A++]=R.charCodeAt(b++),A==this.blockSize){s(this,C),A=0;break}}else for(;b<v;)if(C[A++]=R[b++],A==this.blockSize){s(this,C),A=0;break}}this.h=A,this.o+=v},r.prototype.v=function(){var R=Array((56>this.h?this.blockSize:2*this.blockSize)-this.h);R[0]=128;for(var v=1;v<R.length-8;++v)R[v]=0;var T=8*this.o;for(v=R.length-8;v<R.length;++v)R[v]=T&255,T/=256;for(this.u(R),R=Array(16),v=T=0;4>v;++v)for(var C=0;32>C;C+=8)R[T++]=this.g[v]>>>C&255;return R};function i(R,v){var T=a;return Object.prototype.hasOwnProperty.call(T,R)?T[R]:T[R]=v(R)}function o(R,v){this.h=v;for(var T=[],C=!0,A=R.length-1;0<=A;A--){var b=R[A]|0;C&&b==v||(T[A]=b,C=!1)}this.g=T}var a={};function l(R){return-128<=R&&128>R?i(R,function(v){return new o([v|0],0>v?-1:0)}):new o([R|0],0>R?-1:0)}function u(R){if(isNaN(R)||!isFinite(R))return f;if(0>R)return k(u(-R));for(var v=[],T=1,C=0;R>=T;C++)v[C]=R/T|0,T*=4294967296;return new o(v,0)}function h(R,v){if(R.length==0)throw Error("number format error: empty string");if(v=v||10,2>v||36<v)throw Error("radix out of range: "+v);if(R.charAt(0)=="-")return k(h(R.substring(1),v));if(0<=R.indexOf("-"))throw Error('number format error: interior "-" character');for(var T=u(Math.pow(v,8)),C=f,A=0;A<R.length;A+=8){var b=Math.min(8,R.length-A),_=parseInt(R.substring(A,A+b),v);8>b?(b=u(Math.pow(v,b)),C=C.j(b).add(u(_))):(C=C.j(T),C=C.add(u(_)))}return C}var f=l(0),p=l(1),y=l(16777216);n=o.prototype,n.m=function(){if(S(this))return-k(this).m();for(var R=0,v=1,T=0;T<this.g.length;T++){var C=this.i(T);R+=(0<=C?C:4294967296+C)*v,v*=4294967296}return R},n.toString=function(R){if(R=R||10,2>R||36<R)throw Error("radix out of range: "+R);if(w(this))return"0";if(S(this))return"-"+k(this).toString(R);for(var v=u(Math.pow(R,6)),T=this,C="";;){var A=P(T,v).g;T=E(T,A.j(v));var b=((0<T.g.length?T.g[0]:T.h)>>>0).toString(R);if(T=A,w(T))return b+C;for(;6>b.length;)b="0"+b;C=b+C}},n.i=function(R){return 0>R?0:R<this.g.length?this.g[R]:this.h};function w(R){if(R.h!=0)return!1;for(var v=0;v<R.g.length;v++)if(R.g[v]!=0)return!1;return!0}function S(R){return R.h==-1}n.l=function(R){return R=E(this,R),S(R)?-1:w(R)?0:1};function k(R){for(var v=R.g.length,T=[],C=0;C<v;C++)T[C]=~R.g[C];return new o(T,~R.h).add(p)}n.abs=function(){return S(this)?k(this):this},n.add=function(R){for(var v=Math.max(this.g.length,R.g.length),T=[],C=0,A=0;A<=v;A++){var b=C+(this.i(A)&65535)+(R.i(A)&65535),_=(b>>>16)+(this.i(A)>>>16)+(R.i(A)>>>16);C=_>>>16,b&=65535,_&=65535,T[A]=_<<16|b}return new o(T,T[T.length-1]&-2147483648?-1:0)};function E(R,v){return R.add(k(v))}n.j=function(R){if(w(this)||w(R))return f;if(S(this))return S(R)?k(this).j(k(R)):k(k(this).j(R));if(S(R))return k(this.j(k(R)));if(0>this.l(y)&&0>R.l(y))return u(this.m()*R.m());for(var v=this.g.length+R.g.length,T=[],C=0;C<2*v;C++)T[C]=0;for(C=0;C<this.g.length;C++)for(var A=0;A<R.g.length;A++){var b=this.i(C)>>>16,_=this.i(C)&65535,B=R.i(A)>>>16,ve=R.i(A)&65535;T[2*C+2*A]+=_*ve,x(T,2*C+2*A),T[2*C+2*A+1]+=b*ve,x(T,2*C+2*A+1),T[2*C+2*A+1]+=_*B,x(T,2*C+2*A+1),T[2*C+2*A+2]+=b*B,x(T,2*C+2*A+2)}for(C=0;C<v;C++)T[C]=T[2*C+1]<<16|T[2*C];for(C=v;C<2*v;C++)T[C]=0;return new o(T,0)};function x(R,v){for(;(R[v]&65535)!=R[v];)R[v+1]+=R[v]>>>16,R[v]&=65535,v++}function N(R,v){this.g=R,this.h=v}function P(R,v){if(w(v))throw Error("division by zero");if(w(R))return new N(f,f);if(S(R))return v=P(k(R),v),new N(k(v.g),k(v.h));if(S(v))return v=P(R,k(v)),new N(k(v.g),v.h);if(30<R.g.length){if(S(R)||S(v))throw Error("slowDivide_ only works with positive integers.");for(var T=p,C=v;0>=C.l(R);)T=$(T),C=$(C);var A=L(T,1),b=L(C,1);for(C=L(C,2),T=L(T,2);!w(C);){var _=b.add(C);0>=_.l(R)&&(A=A.add(T),b=_),C=L(C,1),T=L(T,1)}return v=E(R,A.j(v)),new N(A,v)}for(A=f;0<=R.l(v);){for(T=Math.max(1,Math.floor(R.m()/v.m())),C=Math.ceil(Math.log(T)/Math.LN2),C=48>=C?1:Math.pow(2,C-48),b=u(T),_=b.j(v);S(_)||0<_.l(R);)T-=C,b=u(T),_=b.j(v);w(b)&&(b=p),A=A.add(b),R=E(R,_)}return new N(A,R)}n.A=function(R){return P(this,R).h},n.and=function(R){for(var v=Math.max(this.g.length,R.g.length),T=[],C=0;C<v;C++)T[C]=this.i(C)&R.i(C);return new o(T,this.h&R.h)},n.or=function(R){for(var v=Math.max(this.g.length,R.g.length),T=[],C=0;C<v;C++)T[C]=this.i(C)|R.i(C);return new o(T,this.h|R.h)},n.xor=function(R){for(var v=Math.max(this.g.length,R.g.length),T=[],C=0;C<v;C++)T[C]=this.i(C)^R.i(C);return new o(T,this.h^R.h)};function $(R){for(var v=R.g.length+1,T=[],C=0;C<v;C++)T[C]=R.i(C)<<1|R.i(C-1)>>>31;return new o(T,R.h)}function L(R,v){var T=v>>5;v%=32;for(var C=R.g.length-T,A=[],b=0;b<C;b++)A[b]=0<v?R.i(b+T)>>>v|R.i(b+T+1)<<32-v:R.i(b+T);return new o(A,R.h)}r.prototype.digest=r.prototype.v,r.prototype.reset=r.prototype.s,r.prototype.update=r.prototype.u,VR=r,o.prototype.add=o.prototype.add,o.prototype.multiply=o.prototype.j,o.prototype.modulo=o.prototype.A,o.prototype.compare=o.prototype.l,o.prototype.toNumber=o.prototype.m,o.prototype.toString=o.prototype.toString,o.prototype.getBits=o.prototype.i,o.fromNumber=u,o.fromString=h,wo=o}).apply(typeof kE<"u"?kE:typeof self<"u"?self:typeof window<"u"?window:{});var vf=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};/** @license
Copyright The Closure Library Authors.
SPDX-License-Identifier: Apache-2.0
*/var FR,Pu,UR,Hf,pv,$R,BR,zR;(function(){var n,e=typeof Object.defineProperties=="function"?Object.defineProperty:function(c,g,m){return c==Array.prototype||c==Object.prototype||(c[g]=m.value),c};function t(c){c=[typeof globalThis=="object"&&globalThis,c,typeof window=="object"&&window,typeof self=="object"&&self,typeof vf=="object"&&vf];for(var g=0;g<c.length;++g){var m=c[g];if(m&&m.Math==Math)return m}throw Error("Cannot find global object")}var r=t(this);function s(c,g){if(g)e:{var m=r;c=c.split(".");for(var I=0;I<c.length-1;I++){var j=c[I];if(!(j in m))break e;m=m[j]}c=c[c.length-1],I=m[c],g=g(I),g!=I&&g!=null&&e(m,c,{configurable:!0,writable:!0,value:g})}}function i(c,g){c instanceof String&&(c+="");var m=0,I=!1,j={next:function(){if(!I&&m<c.length){var U=m++;return{value:g(U,c[U]),done:!1}}return I=!0,{done:!0,value:void 0}}};return j[Symbol.iterator]=function(){return j},j}s("Array.prototype.values",function(c){return c||function(){return i(this,function(g,m){return m})}});/** @license

 Copyright The Closure Library Authors.
 SPDX-License-Identifier: Apache-2.0
*/var o=o||{},a=this||self;function l(c){var g=typeof c;return g=g!="object"?g:c?Array.isArray(c)?"array":g:"null",g=="array"||g=="object"&&typeof c.length=="number"}function u(c){var g=typeof c;return g=="object"&&c!=null||g=="function"}function h(c,g,m){return c.call.apply(c.bind,arguments)}function f(c,g,m){if(!c)throw Error();if(2<arguments.length){var I=Array.prototype.slice.call(arguments,2);return function(){var j=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(j,I),c.apply(g,j)}}return function(){return c.apply(g,arguments)}}function p(c,g,m){return p=Function.prototype.bind&&Function.prototype.bind.toString().indexOf("native code")!=-1?h:f,p.apply(null,arguments)}function y(c,g){var m=Array.prototype.slice.call(arguments,1);return function(){var I=m.slice();return I.push.apply(I,arguments),c.apply(this,I)}}function w(c,g){function m(){}m.prototype=g.prototype,c.aa=g.prototype,c.prototype=new m,c.prototype.constructor=c,c.Qb=function(I,j,U){for(var ie=Array(arguments.length-2),kt=2;kt<arguments.length;kt++)ie[kt-2]=arguments[kt];return g.prototype[j].apply(I,ie)}}function S(c){const g=c.length;if(0<g){const m=Array(g);for(let I=0;I<g;I++)m[I]=c[I];return m}return[]}function k(c,g){for(let m=1;m<arguments.length;m++){const I=arguments[m];if(l(I)){const j=c.length||0,U=I.length||0;c.length=j+U;for(let ie=0;ie<U;ie++)c[j+ie]=I[ie]}else c.push(I)}}class E{constructor(g,m){this.i=g,this.j=m,this.h=0,this.g=null}get(){let g;return 0<this.h?(this.h--,g=this.g,this.g=g.next,g.next=null):g=this.i(),g}}function x(c){return/^[\s\xa0]*$/.test(c)}function N(){var c=a.navigator;return c&&(c=c.userAgent)?c:""}function P(c){return P[" "](c),c}P[" "]=function(){};var $=N().indexOf("Gecko")!=-1&&!(N().toLowerCase().indexOf("webkit")!=-1&&N().indexOf("Edge")==-1)&&!(N().indexOf("Trident")!=-1||N().indexOf("MSIE")!=-1)&&N().indexOf("Edge")==-1;function L(c,g,m){for(const I in c)g.call(m,c[I],I,c)}function R(c,g){for(const m in c)g.call(void 0,c[m],m,c)}function v(c){const g={};for(const m in c)g[m]=c[m];return g}const T="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function C(c,g){let m,I;for(let j=1;j<arguments.length;j++){I=arguments[j];for(m in I)c[m]=I[m];for(let U=0;U<T.length;U++)m=T[U],Object.prototype.hasOwnProperty.call(I,m)&&(c[m]=I[m])}}function A(c){var g=1;c=c.split(":");const m=[];for(;0<g&&c.length;)m.push(c.shift()),g--;return c.length&&m.push(c.join(":")),m}function b(c){a.setTimeout(()=>{throw c},0)}function _(){var c=we;let g=null;return c.g&&(g=c.g,c.g=c.g.next,c.g||(c.h=null),g.next=null),g}class B{constructor(){this.h=this.g=null}add(g,m){const I=ve.get();I.set(g,m),this.h?this.h.next=I:this.g=I,this.h=I}}var ve=new E(()=>new Fe,c=>c.reset());class Fe{constructor(){this.next=this.g=this.h=null}set(g,m){this.h=g,this.g=m,this.next=null}reset(){this.next=this.g=this.h=null}}let It,Q=!1,we=new B,Se=()=>{const c=a.Promise.resolve(void 0);It=()=>{c.then(qe)}};var qe=()=>{for(var c;c=_();){try{c.h.call(c.g)}catch(m){b(m)}var g=ve;g.j(c),100>g.h&&(g.h++,c.next=g.g,g.g=c)}Q=!1};function De(){this.s=this.s,this.C=this.C}De.prototype.s=!1,De.prototype.ma=function(){this.s||(this.s=!0,this.N())},De.prototype.N=function(){if(this.C)for(;this.C.length;)this.C.shift()()};function D(c,g){this.type=c,this.g=this.target=g,this.defaultPrevented=!1}D.prototype.h=function(){this.defaultPrevented=!0};var q=function(){if(!a.addEventListener||!Object.defineProperty)return!1;var c=!1,g=Object.defineProperty({},"passive",{get:function(){c=!0}});try{const m=()=>{};a.addEventListener("test",m,g),a.removeEventListener("test",m,g)}catch{}return c}();function ae(c,g){if(D.call(this,c?c.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,c){var m=this.type=c.type,I=c.changedTouches&&c.changedTouches.length?c.changedTouches[0]:null;if(this.target=c.target||c.srcElement,this.g=g,g=c.relatedTarget){if($){e:{try{P(g.nodeName);var j=!0;break e}catch{}j=!1}j||(g=null)}}else m=="mouseover"?g=c.fromElement:m=="mouseout"&&(g=c.toElement);this.relatedTarget=g,I?(this.clientX=I.clientX!==void 0?I.clientX:I.pageX,this.clientY=I.clientY!==void 0?I.clientY:I.pageY,this.screenX=I.screenX||0,this.screenY=I.screenY||0):(this.clientX=c.clientX!==void 0?c.clientX:c.pageX,this.clientY=c.clientY!==void 0?c.clientY:c.pageY,this.screenX=c.screenX||0,this.screenY=c.screenY||0),this.button=c.button,this.key=c.key||"",this.ctrlKey=c.ctrlKey,this.altKey=c.altKey,this.shiftKey=c.shiftKey,this.metaKey=c.metaKey,this.pointerId=c.pointerId||0,this.pointerType=typeof c.pointerType=="string"?c.pointerType:pe[c.pointerType]||"",this.state=c.state,this.i=c,c.defaultPrevented&&ae.aa.h.call(this)}}w(ae,D);var pe={2:"touch",3:"pen",4:"mouse"};ae.prototype.h=function(){ae.aa.h.call(this);var c=this.i;c.preventDefault?c.preventDefault():c.returnValue=!1};var Te="closure_listenable_"+(1e6*Math.random()|0),ce=0;function ne(c,g,m,I,j){this.listener=c,this.proxy=null,this.src=g,this.type=m,this.capture=!!I,this.ha=j,this.key=++ce,this.da=this.fa=!1}function ge(c){c.da=!0,c.listener=null,c.proxy=null,c.src=null,c.ha=null}function de(c){this.src=c,this.g={},this.h=0}de.prototype.add=function(c,g,m,I,j){var U=c.toString();c=this.g[U],c||(c=this.g[U]=[],this.h++);var ie=ue(c,g,I,j);return-1<ie?(g=c[ie],m||(g.fa=!1)):(g=new ne(g,this.src,U,!!I,j),g.fa=m,c.push(g)),g};function me(c,g){var m=g.type;if(m in c.g){var I=c.g[m],j=Array.prototype.indexOf.call(I,g,void 0),U;(U=0<=j)&&Array.prototype.splice.call(I,j,1),U&&(ge(g),c.g[m].length==0&&(delete c.g[m],c.h--))}}function ue(c,g,m,I){for(var j=0;j<c.length;++j){var U=c[j];if(!U.da&&U.listener==g&&U.capture==!!m&&U.ha==I)return j}return-1}var Be="closure_lm_"+(1e6*Math.random()|0),G={};function Z(c,g,m,I,j){if(I&&I.once)return Pe(c,g,m,I,j);if(Array.isArray(g)){for(var U=0;U<g.length;U++)Z(c,g[U],m,I,j);return null}return m=gt(m),c&&c[Te]?c.K(g,m,u(I)?!!I.capture:!!I,j):J(c,g,m,!1,I,j)}function J(c,g,m,I,j,U){if(!g)throw Error("Invalid event type");var ie=u(j)?!!j.capture:!!j,kt=vt(c);if(kt||(c[Be]=kt=new de(c)),m=kt.add(g,m,I,ie,U),m.proxy)return m;if(I=Me(),m.proxy=I,I.src=c,I.listener=m,c.addEventListener)q||(j=ie),j===void 0&&(j=!1),c.addEventListener(g.toString(),I,j);else if(c.attachEvent)c.attachEvent(qt(g.toString()),I);else if(c.addListener&&c.removeListener)c.addListener(I);else throw Error("addEventListener and attachEvent are unavailable.");return m}function Me(){function c(m){return g.call(c.src,c.listener,m)}const g=Rt;return c}function Pe(c,g,m,I,j){if(Array.isArray(g)){for(var U=0;U<g.length;U++)Pe(c,g[U],m,I,j);return null}return m=gt(m),c&&c[Te]?c.L(g,m,u(I)?!!I.capture:!!I,j):J(c,g,m,!0,I,j)}function be(c,g,m,I,j){if(Array.isArray(g))for(var U=0;U<g.length;U++)be(c,g[U],m,I,j);else I=u(I)?!!I.capture:!!I,m=gt(m),c&&c[Te]?(c=c.i,g=String(g).toString(),g in c.g&&(U=c.g[g],m=ue(U,m,I,j),-1<m&&(ge(U[m]),Array.prototype.splice.call(U,m,1),U.length==0&&(delete c.g[g],c.h--)))):c&&(c=vt(c))&&(g=c.g[g.toString()],c=-1,g&&(c=ue(g,m,I,j)),(m=-1<c?g[c]:null)&&Ct(m))}function Ct(c){if(typeof c!="number"&&c&&!c.da){var g=c.src;if(g&&g[Te])me(g.i,c);else{var m=c.type,I=c.proxy;g.removeEventListener?g.removeEventListener(m,I,c.capture):g.detachEvent?g.detachEvent(qt(m),I):g.addListener&&g.removeListener&&g.removeListener(I),(m=vt(g))?(me(m,c),m.h==0&&(m.src=null,g[Be]=null)):ge(c)}}}function qt(c){return c in G?G[c]:G[c]="on"+c}function Rt(c,g){if(c.da)c=!0;else{g=new ae(g,this);var m=c.listener,I=c.ha||c.src;c.fa&&Ct(c),c=m.call(I,g)}return c}function vt(c){return c=c[Be],c instanceof de?c:null}var Nt="__closure_events_fn_"+(1e9*Math.random()>>>0);function gt(c){return typeof c=="function"?c:(c[Nt]||(c[Nt]=function(g){return c.handleEvent(g)}),c[Nt])}function Ae(){De.call(this),this.i=new de(this),this.M=this,this.F=null}w(Ae,De),Ae.prototype[Te]=!0,Ae.prototype.removeEventListener=function(c,g,m,I){be(this,c,g,m,I)};function Ye(c,g){var m,I=c.F;if(I)for(m=[];I;I=I.F)m.push(I);if(c=c.M,I=g.type||g,typeof g=="string")g=new D(g,c);else if(g instanceof D)g.target=g.target||c;else{var j=g;g=new D(I,c),C(g,j)}if(j=!0,m)for(var U=m.length-1;0<=U;U--){var ie=g.g=m[U];j=un(ie,I,!0,g)&&j}if(ie=g.g=c,j=un(ie,I,!0,g)&&j,j=un(ie,I,!1,g)&&j,m)for(U=0;U<m.length;U++)ie=g.g=m[U],j=un(ie,I,!1,g)&&j}Ae.prototype.N=function(){if(Ae.aa.N.call(this),this.i){var c=this.i,g;for(g in c.g){for(var m=c.g[g],I=0;I<m.length;I++)ge(m[I]);delete c.g[g],c.h--}}this.F=null},Ae.prototype.K=function(c,g,m,I){return this.i.add(String(c),g,!1,m,I)},Ae.prototype.L=function(c,g,m,I){return this.i.add(String(c),g,!0,m,I)};function un(c,g,m,I){if(g=c.i.g[String(g)],!g)return!0;g=g.concat();for(var j=!0,U=0;U<g.length;++U){var ie=g[U];if(ie&&!ie.da&&ie.capture==m){var kt=ie.listener,qn=ie.ha||ie.src;ie.fa&&me(c.i,ie),j=kt.call(qn,I)!==!1&&j}}return j&&!I.defaultPrevented}function rn(c,g,m){if(typeof c=="function")m&&(c=p(c,m));else if(c&&typeof c.handleEvent=="function")c=p(c.handleEvent,c);else throw Error("Invalid listener argument");return 2147483647<Number(g)?-1:a.setTimeout(c,g||0)}function In(c){c.g=rn(()=>{c.g=null,c.i&&(c.i=!1,In(c))},c.l);const g=c.h;c.h=null,c.m.apply(null,g)}class ur extends De{constructor(g,m){super(),this.m=g,this.l=m,this.h=null,this.i=!1,this.g=null}j(g){this.h=arguments,this.g?this.i=!0:In(this)}N(){super.N(),this.g&&(a.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function mt(c){De.call(this),this.h=c,this.g={}}w(mt,De);var dn=[];function hn(c){L(c.g,function(g,m){this.g.hasOwnProperty(m)&&Ct(g)},c),c.g={}}mt.prototype.N=function(){mt.aa.N.call(this),hn(this)},mt.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var Jn=a.JSON.stringify,Sn=a.JSON.parse,mn=class{stringify(c){return a.JSON.stringify(c,void 0)}parse(c){return a.JSON.parse(c,void 0)}};function dr(){}dr.prototype.h=null;function ct(c){return c.h||(c.h=c.i())}function ut(){}var yn={OPEN:"a",kb:"b",Ja:"c",wb:"d"};function vr(){D.call(this,"d")}w(vr,D);function Cs(){D.call(this,"c")}w(Cs,D);var hr={},al=null;function cs(){return al=al||new Ae}hr.La="serverreachability";function Bh(c){D.call(this,hr.La,c)}w(Bh,D);function Ho(c){const g=cs();Ye(g,new Bh(g))}hr.STAT_EVENT="statevent";function ll(c,g){D.call(this,hr.STAT_EVENT,c),this.stat=g}w(ll,D);function En(c){const g=cs();Ye(g,new ll(g,c))}hr.Ma="timingevent";function zh(c,g){D.call(this,hr.Ma,c),this.size=g}w(zh,D);function Qo(c,g){if(typeof c!="function")throw Error("Fn must not be null and must be a function");return a.setTimeout(function(){c()},g)}function Ko(){this.g=!0}Ko.prototype.xa=function(){this.g=!1};function qm(c,g,m,I,j,U){c.info(function(){if(c.g)if(U)for(var ie="",kt=U.split("&"),qn=0;qn<kt.length;qn++){var yt=kt[qn].split("=");if(1<yt.length){var Zn=yt[0];yt=yt[1];var er=Zn.split("_");ie=2<=er.length&&er[1]=="type"?ie+(Zn+"="+yt+"&"):ie+(Zn+"=redacted&")}}else ie=null;else ie=U;return"XMLHTTP REQ ("+I+") [attempt "+j+"]: "+g+`
`+m+`
`+ie})}function M(c,g,m,I,j,U,ie){c.info(function(){return"XMLHTTP RESP ("+I+") [ attempt "+j+"]: "+g+`
`+m+`
`+U+" "+ie})}function H(c,g,m,I){c.info(function(){return"XMLHTTP TEXT ("+g+"): "+le(c,m)+(I?" "+I:"")})}function z(c,g){c.info(function(){return"TIMEOUT: "+g})}Ko.prototype.info=function(){};function le(c,g){if(!c.g)return g;if(!g)return null;try{var m=JSON.parse(g);if(m){for(c=0;c<m.length;c++)if(Array.isArray(m[c])){var I=m[c];if(!(2>I.length)){var j=I[1];if(Array.isArray(j)&&!(1>j.length)){var U=j[0];if(U!="noop"&&U!="stop"&&U!="close")for(var ie=1;ie<j.length;ie++)j[ie]=""}}}}return Jn(m)}catch{return g}}var Ee={NO_ERROR:0,gb:1,tb:2,sb:3,nb:4,rb:5,ub:6,Ia:7,TIMEOUT:8,xb:9},We={lb:"complete",Hb:"success",Ja:"error",Ia:"abort",zb:"ready",Ab:"readystatechange",TIMEOUT:"timeout",vb:"incrementaldata",yb:"progress",ob:"downloadprogress",Pb:"uploadprogress"},xe;function Re(){}w(Re,dr),Re.prototype.g=function(){return new XMLHttpRequest},Re.prototype.i=function(){return{}},xe=new Re;function Ce(c,g,m,I){this.j=c,this.i=g,this.l=m,this.R=I||1,this.U=new mt(this),this.I=45e3,this.H=null,this.o=!1,this.m=this.A=this.v=this.L=this.F=this.S=this.B=null,this.D=[],this.g=null,this.C=0,this.s=this.u=null,this.X=-1,this.J=!1,this.O=0,this.M=null,this.W=this.K=this.T=this.P=!1,this.h=new St}function St(){this.i=null,this.g="",this.h=!1}var Qe={},ze={};function Je(c,g,m){c.L=1,c.v=qh(zn(g)),c.m=m,c.P=!0,Ve(c,null)}function Ve(c,g){c.F=Date.now(),Ue(c),c.A=zn(c.v);var m=c.A,I=c.R;Array.isArray(I)||(I=[String(I)]),cI(m.i,"t",I),c.C=0,m=c.j.J,c.h=new St,c.g=AI(c.j,m?g:null,!c.m),0<c.O&&(c.M=new ur(p(c.Y,c,c.g),c.O)),g=c.U,m=c.g,I=c.ca;var j="readystatechange";Array.isArray(j)||(j&&(dn[0]=j.toString()),j=dn);for(var U=0;U<j.length;U++){var ie=Z(m,j[U],I||g.handleEvent,!1,g.h||g);if(!ie)break;g.g[ie.key]=ie}g=c.H?v(c.H):{},c.m?(c.u||(c.u="POST"),g["Content-Type"]="application/x-www-form-urlencoded",c.g.ea(c.A,c.u,c.m,g)):(c.u="GET",c.g.ea(c.A,c.u,null,g)),Ho(),qm(c.i,c.u,c.A,c.l,c.R,c.m)}Ce.prototype.ca=function(c){c=c.target;const g=this.M;g&&ii(c)==3?g.j():this.Y(c)},Ce.prototype.Y=function(c){try{if(c==this.g)e:{const er=ii(this.g);var g=this.g.Ba();const fl=this.g.Z();if(!(3>er)&&(er!=3||this.g&&(this.h.h||this.g.oa()||mI(this.g)))){this.J||er!=4||g==7||(g==8||0>=fl?Ho(3):Ho(2)),dt(this);var m=this.g.Z();this.X=m;t:if(Oe(this)){var I=mI(this.g);c="";var j=I.length,U=ii(this.g)==4;if(!this.h.i){if(typeof TextDecoder>"u"){Ke(this),ht(this);var ie="";break t}this.h.i=new a.TextDecoder}for(g=0;g<j;g++)this.h.h=!0,c+=this.h.i.decode(I[g],{stream:!(U&&g==j-1)});I.length=0,this.h.g+=c,this.C=0,ie=this.h.g}else ie=this.g.oa();if(this.o=m==200,M(this.i,this.u,this.A,this.l,this.R,er,m),this.o){if(this.T&&!this.K){t:{if(this.g){var kt,qn=this.g;if((kt=qn.g?qn.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!x(kt)){var yt=kt;break t}}yt=null}if(m=yt)H(this.i,this.l,m,"Initial handshake response via X-HTTP-Initial-Response"),this.K=!0,$n(this,m);else{this.o=!1,this.s=3,En(12),Ke(this),ht(this);break e}}if(this.P){m=!0;let us;for(;!this.J&&this.C<ie.length;)if(us=Ne(this,ie),us==ze){er==4&&(this.s=4,En(14),m=!1),H(this.i,this.l,null,"[Incomplete Response]");break}else if(us==Qe){this.s=4,En(15),H(this.i,this.l,ie,"[Invalid Chunk]"),m=!1;break}else H(this.i,this.l,us,null),$n(this,us);if(Oe(this)&&this.C!=0&&(this.h.g=this.h.g.slice(this.C),this.C=0),er!=4||ie.length!=0||this.h.h||(this.s=1,En(16),m=!1),this.o=this.o&&m,!m)H(this.i,this.l,ie,"[Invalid Chunked Response]"),Ke(this),ht(this);else if(0<ie.length&&!this.W){this.W=!0;var Zn=this.j;Zn.g==this&&Zn.ba&&!Zn.M&&(Zn.j.info("Great, no buffering proxy detected. Bytes received: "+ie.length),Qm(Zn),Zn.M=!0,En(11))}}else H(this.i,this.l,ie,null),$n(this,ie);er==4&&Ke(this),this.o&&!this.J&&(er==4?SI(this.j,this):(this.o=!1,Ue(this)))}else a2(this.g),m==400&&0<ie.indexOf("Unknown SID")?(this.s=3,En(12)):(this.s=0,En(13)),Ke(this),ht(this)}}}catch{}finally{}};function Oe(c){return c.g?c.u=="GET"&&c.L!=2&&c.j.Ca:!1}function Ne(c,g){var m=c.C,I=g.indexOf(`
`,m);return I==-1?ze:(m=Number(g.substring(m,I)),isNaN(m)?Qe:(I+=1,I+m>g.length?ze:(g=g.slice(I,I+m),c.C=I+m,g)))}Ce.prototype.cancel=function(){this.J=!0,Ke(this)};function Ue(c){c.S=Date.now()+c.I,Nn(c,c.I)}function Nn(c,g){if(c.B!=null)throw Error("WatchDog timer not null");c.B=Qo(p(c.ba,c),g)}function dt(c){c.B&&(a.clearTimeout(c.B),c.B=null)}Ce.prototype.ba=function(){this.B=null;const c=Date.now();0<=c-this.S?(z(this.i,this.A),this.L!=2&&(Ho(),En(17)),Ke(this),this.s=2,ht(this)):Nn(this,this.S-c)};function ht(c){c.j.G==0||c.J||SI(c.j,c)}function Ke(c){dt(c);var g=c.M;g&&typeof g.ma=="function"&&g.ma(),c.M=null,hn(c.U),c.g&&(g=c.g,c.g=null,g.abort(),g.ma())}function $n(c,g){try{var m=c.j;if(m.G!=0&&(m.g==c||Ge(m.h,c))){if(!c.K&&Ge(m.h,c)&&m.G==3){try{var I=m.Da.g.parse(g)}catch{I=null}if(Array.isArray(I)&&I.length==3){var j=I;if(j[0]==0){e:if(!m.u){if(m.g)if(m.g.F+3e3<c.F)Yh(m),Qh(m);else break e;Hm(m),En(18)}}else m.za=j[1],0<m.za-m.T&&37500>j[2]&&m.F&&m.v==0&&!m.C&&(m.C=Qo(p(m.Za,m),6e3));if(1>=Bn(m.h)&&m.ca){try{m.ca()}catch{}m.ca=void 0}}else Jo(m,11)}else if((c.K||m.g==c)&&Yh(m),!x(g))for(j=m.Da.g.parse(g),g=0;g<j.length;g++){let yt=j[g];if(m.T=yt[0],yt=yt[1],m.G==2)if(yt[0]=="c"){m.K=yt[1],m.ia=yt[2];const Zn=yt[3];Zn!=null&&(m.la=Zn,m.j.info("VER="+m.la));const er=yt[4];er!=null&&(m.Aa=er,m.j.info("SVER="+m.Aa));const fl=yt[5];fl!=null&&typeof fl=="number"&&0<fl&&(I=1.5*fl,m.L=I,m.j.info("backChannelRequestTimeoutMs_="+I)),I=m;const us=c.g;if(us){const Xh=us.g?us.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(Xh){var U=I.h;U.g||Xh.indexOf("spdy")==-1&&Xh.indexOf("quic")==-1&&Xh.indexOf("h2")==-1||(U.j=U.l,U.g=new Set,U.h&&(ft(U,U.h),U.h=null))}if(I.D){const Km=us.g?us.g.getResponseHeader("X-HTTP-Session-Id"):null;Km&&(I.ya=Km,Vt(I.I,I.D,Km))}}m.G=3,m.l&&m.l.ua(),m.ba&&(m.R=Date.now()-c.F,m.j.info("Handshake RTT: "+m.R+"ms")),I=m;var ie=c;if(I.qa=bI(I,I.J?I.ia:null,I.W),ie.K){sn(I.h,ie);var kt=ie,qn=I.L;qn&&(kt.I=qn),kt.B&&(dt(kt),Ue(kt)),I.g=ie}else xI(I);0<m.i.length&&Kh(m)}else yt[0]!="stop"&&yt[0]!="close"||Jo(m,7);else m.G==3&&(yt[0]=="stop"||yt[0]=="close"?yt[0]=="stop"?Jo(m,7):Gm(m):yt[0]!="noop"&&m.l&&m.l.ta(yt),m.v=0)}}Ho(4)}catch{}}var Rs=class{constructor(c,g){this.g=c,this.map=g}};function Ns(c){this.l=c||10,a.PerformanceNavigationTiming?(c=a.performance.getEntriesByType("navigation"),c=0<c.length&&(c[0].nextHopProtocol=="hq"||c[0].nextHopProtocol=="h2")):c=!!(a.chrome&&a.chrome.loadTimes&&a.chrome.loadTimes()&&a.chrome.loadTimes().wasFetchedViaSpdy),this.j=c?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}function cl(c){return c.h?!0:c.g?c.g.size>=c.j:!1}function Bn(c){return c.h?1:c.g?c.g.size:0}function Ge(c,g){return c.h?c.h==g:c.g?c.g.has(g):!1}function ft(c,g){c.g?c.g.add(g):c.h=g}function sn(c,g){c.h&&c.h==g?c.h=null:c.g&&c.g.has(g)&&c.g.delete(g)}Ns.prototype.cancel=function(){if(this.i=Wt(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&this.g.size!==0){for(const c of this.g.values())c.cancel();this.g.clear()}};function Wt(c){if(c.h!=null)return c.i.concat(c.h.D);if(c.g!=null&&c.g.size!==0){let g=c.i;for(const m of c.g.values())g=g.concat(m.D);return g}return S(c.i)}function Yr(c){if(c.V&&typeof c.V=="function")return c.V();if(typeof Map<"u"&&c instanceof Map||typeof Set<"u"&&c instanceof Set)return Array.from(c.values());if(typeof c=="string")return c.split("");if(l(c)){for(var g=[],m=c.length,I=0;I<m;I++)g.push(c[I]);return g}g=[],m=0;for(I in c)g[m++]=c[I];return g}function Yo(c){if(c.na&&typeof c.na=="function")return c.na();if(!c.V||typeof c.V!="function"){if(typeof Map<"u"&&c instanceof Map)return Array.from(c.keys());if(!(typeof Set<"u"&&c instanceof Set)){if(l(c)||typeof c=="string"){var g=[];c=c.length;for(var m=0;m<c;m++)g.push(m);return g}g=[],m=0;for(const I in c)g[m++]=I;return g}}}function ni(c,g){if(c.forEach&&typeof c.forEach=="function")c.forEach(g,void 0);else if(l(c)||typeof c=="string")Array.prototype.forEach.call(c,g,void 0);else for(var m=Yo(c),I=Yr(c),j=I.length,U=0;U<j;U++)g.call(void 0,I[U],m&&m[U],c)}var ri=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function Xn(c,g){if(c){c=c.split("&");for(var m=0;m<c.length;m++){var I=c[m].indexOf("="),j=null;if(0<=I){var U=c[m].substring(0,I);j=c[m].substring(I+1)}else U=c[m];g(U,j?decodeURIComponent(j.replace(/\+/g," ")):"")}}}function wt(c){if(this.g=this.o=this.j="",this.s=null,this.m=this.l="",this.h=!1,c instanceof wt){this.h=c.h,si(this,c.j),this.o=c.o,this.g=c.g,ul(this,c.s),this.l=c.l;var g=c.i,m=new nu;m.i=g.i,g.g&&(m.g=new Map(g.g),m.h=g.h),Vi(this,m),this.m=c.m}else c&&(g=String(c).match(ri))?(this.h=!1,si(this,g[1]||"",!0),this.o=eu(g[2]||""),this.g=eu(g[3]||"",!0),ul(this,g[4]),this.l=eu(g[5]||"",!0),Vi(this,g[6]||"",!0),this.m=eu(g[7]||"")):(this.h=!1,this.i=new nu(null,this.h))}wt.prototype.toString=function(){var c=[],g=this.j;g&&c.push(tu(g,oI,!0),":");var m=this.g;return(m||g=="file")&&(c.push("//"),(g=this.o)&&c.push(tu(g,oI,!0),"@"),c.push(encodeURIComponent(String(m)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),m=this.s,m!=null&&c.push(":",String(m))),(m=this.l)&&(this.g&&m.charAt(0)!="/"&&c.push("/"),c.push(tu(m,m.charAt(0)=="/"?JD:YD,!0))),(m=this.i.toString())&&c.push("?",m),(m=this.m)&&c.push("#",tu(m,ZD)),c.join("")};function zn(c){return new wt(c)}function si(c,g,m){c.j=m?eu(g,!0):g,c.j&&(c.j=c.j.replace(/:$/,""))}function ul(c,g){if(g){if(g=Number(g),isNaN(g)||0>g)throw Error("Bad port number "+g);c.s=g}else c.s=null}function Vi(c,g,m){g instanceof nu?(c.i=g,e2(c.i,c.h)):(m||(g=tu(g,XD)),c.i=new nu(g,c.h))}function Vt(c,g,m){c.i.set(g,m)}function qh(c){return Vt(c,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),c}function eu(c,g){return c?g?decodeURI(c.replace(/%25/g,"%2525")):decodeURIComponent(c):""}function tu(c,g,m){return typeof c=="string"?(c=encodeURI(c).replace(g,KD),m&&(c=c.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),c):null}function KD(c){return c=c.charCodeAt(0),"%"+(c>>4&15).toString(16)+(c&15).toString(16)}var oI=/[#\/\?@]/g,YD=/[#\?:]/g,JD=/[#\?]/g,XD=/[#\?@]/g,ZD=/#/g;function nu(c,g){this.h=this.g=null,this.i=c||null,this.j=!!g}function Fi(c){c.g||(c.g=new Map,c.h=0,c.i&&Xn(c.i,function(g,m){c.add(decodeURIComponent(g.replace(/\+/g," ")),m)}))}n=nu.prototype,n.add=function(c,g){Fi(this),this.i=null,c=dl(this,c);var m=this.g.get(c);return m||this.g.set(c,m=[]),m.push(g),this.h+=1,this};function aI(c,g){Fi(c),g=dl(c,g),c.g.has(g)&&(c.i=null,c.h-=c.g.get(g).length,c.g.delete(g))}function lI(c,g){return Fi(c),g=dl(c,g),c.g.has(g)}n.forEach=function(c,g){Fi(this),this.g.forEach(function(m,I){m.forEach(function(j){c.call(g,j,I,this)},this)},this)},n.na=function(){Fi(this);const c=Array.from(this.g.values()),g=Array.from(this.g.keys()),m=[];for(let I=0;I<g.length;I++){const j=c[I];for(let U=0;U<j.length;U++)m.push(g[I])}return m},n.V=function(c){Fi(this);let g=[];if(typeof c=="string")lI(this,c)&&(g=g.concat(this.g.get(dl(this,c))));else{c=Array.from(this.g.values());for(let m=0;m<c.length;m++)g=g.concat(c[m])}return g},n.set=function(c,g){return Fi(this),this.i=null,c=dl(this,c),lI(this,c)&&(this.h-=this.g.get(c).length),this.g.set(c,[g]),this.h+=1,this},n.get=function(c,g){return c?(c=this.V(c),0<c.length?String(c[0]):g):g};function cI(c,g,m){aI(c,g),0<m.length&&(c.i=null,c.g.set(dl(c,g),S(m)),c.h+=m.length)}n.toString=function(){if(this.i)return this.i;if(!this.g)return"";const c=[],g=Array.from(this.g.keys());for(var m=0;m<g.length;m++){var I=g[m];const U=encodeURIComponent(String(I)),ie=this.V(I);for(I=0;I<ie.length;I++){var j=U;ie[I]!==""&&(j+="="+encodeURIComponent(String(ie[I]))),c.push(j)}}return this.i=c.join("&")};function dl(c,g){return g=String(g),c.j&&(g=g.toLowerCase()),g}function e2(c,g){g&&!c.j&&(Fi(c),c.i=null,c.g.forEach(function(m,I){var j=I.toLowerCase();I!=j&&(aI(this,I),cI(this,j,m))},c)),c.j=g}function t2(c,g){const m=new Ko;if(a.Image){const I=new Image;I.onload=y(Ui,m,"TestLoadImage: loaded",!0,g,I),I.onerror=y(Ui,m,"TestLoadImage: error",!1,g,I),I.onabort=y(Ui,m,"TestLoadImage: abort",!1,g,I),I.ontimeout=y(Ui,m,"TestLoadImage: timeout",!1,g,I),a.setTimeout(function(){I.ontimeout&&I.ontimeout()},1e4),I.src=c}else g(!1)}function n2(c,g){const m=new Ko,I=new AbortController,j=setTimeout(()=>{I.abort(),Ui(m,"TestPingServer: timeout",!1,g)},1e4);fetch(c,{signal:I.signal}).then(U=>{clearTimeout(j),U.ok?Ui(m,"TestPingServer: ok",!0,g):Ui(m,"TestPingServer: server error",!1,g)}).catch(()=>{clearTimeout(j),Ui(m,"TestPingServer: error",!1,g)})}function Ui(c,g,m,I,j){try{j&&(j.onload=null,j.onerror=null,j.onabort=null,j.ontimeout=null),I(m)}catch{}}function r2(){this.g=new mn}function s2(c,g,m){const I=m||"";try{ni(c,function(j,U){let ie=j;u(j)&&(ie=Jn(j)),g.push(I+U+"="+encodeURIComponent(ie))})}catch(j){throw g.push(I+"type="+encodeURIComponent("_badmap")),j}}function Wh(c){this.l=c.Ub||null,this.j=c.eb||!1}w(Wh,dr),Wh.prototype.g=function(){return new Gh(this.l,this.j)},Wh.prototype.i=function(c){return function(){return c}}({});function Gh(c,g){Ae.call(this),this.D=c,this.o=g,this.m=void 0,this.status=this.readyState=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.u=new Headers,this.h=null,this.B="GET",this.A="",this.g=!1,this.v=this.j=this.l=null}w(Gh,Ae),n=Gh.prototype,n.open=function(c,g){if(this.readyState!=0)throw this.abort(),Error("Error reopening a connection");this.B=c,this.A=g,this.readyState=1,su(this)},n.send=function(c){if(this.readyState!=1)throw this.abort(),Error("need to call open() first. ");this.g=!0;const g={headers:this.u,method:this.B,credentials:this.m,cache:void 0};c&&(g.body=c),(this.D||a).fetch(new Request(this.A,g)).then(this.Sa.bind(this),this.ga.bind(this))},n.abort=function(){this.response=this.responseText="",this.u=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),1<=this.readyState&&this.g&&this.readyState!=4&&(this.g=!1,ru(this)),this.readyState=0},n.Sa=function(c){if(this.g&&(this.l=c,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=c.headers,this.readyState=2,su(this)),this.g&&(this.readyState=3,su(this),this.g)))if(this.responseType==="arraybuffer")c.arrayBuffer().then(this.Qa.bind(this),this.ga.bind(this));else if(typeof a.ReadableStream<"u"&&"body"in c){if(this.j=c.body.getReader(),this.o){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.v=new TextDecoder;uI(this)}else c.text().then(this.Ra.bind(this),this.ga.bind(this))};function uI(c){c.j.read().then(c.Pa.bind(c)).catch(c.ga.bind(c))}n.Pa=function(c){if(this.g){if(this.o&&c.value)this.response.push(c.value);else if(!this.o){var g=c.value?c.value:new Uint8Array(0);(g=this.v.decode(g,{stream:!c.done}))&&(this.response=this.responseText+=g)}c.done?ru(this):su(this),this.readyState==3&&uI(this)}},n.Ra=function(c){this.g&&(this.response=this.responseText=c,ru(this))},n.Qa=function(c){this.g&&(this.response=c,ru(this))},n.ga=function(){this.g&&ru(this)};function ru(c){c.readyState=4,c.l=null,c.j=null,c.v=null,su(c)}n.setRequestHeader=function(c,g){this.u.append(c,g)},n.getResponseHeader=function(c){return this.h&&this.h.get(c.toLowerCase())||""},n.getAllResponseHeaders=function(){if(!this.h)return"";const c=[],g=this.h.entries();for(var m=g.next();!m.done;)m=m.value,c.push(m[0]+": "+m[1]),m=g.next();return c.join(`\r
`)};function su(c){c.onreadystatechange&&c.onreadystatechange.call(c)}Object.defineProperty(Gh.prototype,"withCredentials",{get:function(){return this.m==="include"},set:function(c){this.m=c?"include":"same-origin"}});function dI(c){let g="";return L(c,function(m,I){g+=I,g+=":",g+=m,g+=`\r
`}),g}function Wm(c,g,m){e:{for(I in m){var I=!1;break e}I=!0}I||(m=dI(m),typeof c=="string"?m!=null&&encodeURIComponent(String(m)):Vt(c,g,m))}function on(c){Ae.call(this),this.headers=new Map,this.o=c||null,this.h=!1,this.v=this.g=null,this.D="",this.m=0,this.l="",this.j=this.B=this.u=this.A=!1,this.I=null,this.H="",this.J=!1}w(on,Ae);var i2=/^https?$/i,o2=["POST","PUT"];n=on.prototype,n.Ha=function(c){this.J=c},n.ea=function(c,g,m,I){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.D+"; newUri="+c);g=g?g.toUpperCase():"GET",this.D=c,this.l="",this.m=0,this.A=!1,this.h=!0,this.g=this.o?this.o.g():xe.g(),this.v=this.o?ct(this.o):ct(xe),this.g.onreadystatechange=p(this.Ea,this);try{this.B=!0,this.g.open(g,String(c),!0),this.B=!1}catch(U){hI(this,U);return}if(c=m||"",m=new Map(this.headers),I)if(Object.getPrototypeOf(I)===Object.prototype)for(var j in I)m.set(j,I[j]);else if(typeof I.keys=="function"&&typeof I.get=="function")for(const U of I.keys())m.set(U,I.get(U));else throw Error("Unknown input type for opt_headers: "+String(I));I=Array.from(m.keys()).find(U=>U.toLowerCase()=="content-type"),j=a.FormData&&c instanceof a.FormData,!(0<=Array.prototype.indexOf.call(o2,g,void 0))||I||j||m.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(const[U,ie]of m)this.g.setRequestHeader(U,ie);this.H&&(this.g.responseType=this.H),"withCredentials"in this.g&&this.g.withCredentials!==this.J&&(this.g.withCredentials=this.J);try{gI(this),this.u=!0,this.g.send(c),this.u=!1}catch(U){hI(this,U)}};function hI(c,g){c.h=!1,c.g&&(c.j=!0,c.g.abort(),c.j=!1),c.l=g,c.m=5,fI(c),Hh(c)}function fI(c){c.A||(c.A=!0,Ye(c,"complete"),Ye(c,"error"))}n.abort=function(c){this.g&&this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1,this.m=c||7,Ye(this,"complete"),Ye(this,"abort"),Hh(this))},n.N=function(){this.g&&(this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1),Hh(this,!0)),on.aa.N.call(this)},n.Ea=function(){this.s||(this.B||this.u||this.j?pI(this):this.bb())},n.bb=function(){pI(this)};function pI(c){if(c.h&&typeof o<"u"&&(!c.v[1]||ii(c)!=4||c.Z()!=2)){if(c.u&&ii(c)==4)rn(c.Ea,0,c);else if(Ye(c,"readystatechange"),ii(c)==4){c.h=!1;try{const ie=c.Z();e:switch(ie){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var g=!0;break e;default:g=!1}var m;if(!(m=g)){var I;if(I=ie===0){var j=String(c.D).match(ri)[1]||null;!j&&a.self&&a.self.location&&(j=a.self.location.protocol.slice(0,-1)),I=!i2.test(j?j.toLowerCase():"")}m=I}if(m)Ye(c,"complete"),Ye(c,"success");else{c.m=6;try{var U=2<ii(c)?c.g.statusText:""}catch{U=""}c.l=U+" ["+c.Z()+"]",fI(c)}}finally{Hh(c)}}}}function Hh(c,g){if(c.g){gI(c);const m=c.g,I=c.v[0]?()=>{}:null;c.g=null,c.v=null,g||Ye(c,"ready");try{m.onreadystatechange=I}catch{}}}function gI(c){c.I&&(a.clearTimeout(c.I),c.I=null)}n.isActive=function(){return!!this.g};function ii(c){return c.g?c.g.readyState:0}n.Z=function(){try{return 2<ii(this)?this.g.status:-1}catch{return-1}},n.oa=function(){try{return this.g?this.g.responseText:""}catch{return""}},n.Oa=function(c){if(this.g){var g=this.g.responseText;return c&&g.indexOf(c)==0&&(g=g.substring(c.length)),Sn(g)}};function mI(c){try{if(!c.g)return null;if("response"in c.g)return c.g.response;switch(c.H){case"":case"text":return c.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in c.g)return c.g.mozResponseArrayBuffer}return null}catch{return null}}function a2(c){const g={};c=(c.g&&2<=ii(c)&&c.g.getAllResponseHeaders()||"").split(`\r
`);for(let I=0;I<c.length;I++){if(x(c[I]))continue;var m=A(c[I]);const j=m[0];if(m=m[1],typeof m!="string")continue;m=m.trim();const U=g[j]||[];g[j]=U,U.push(m)}R(g,function(I){return I.join(", ")})}n.Ba=function(){return this.m},n.Ka=function(){return typeof this.l=="string"?this.l:String(this.l)};function iu(c,g,m){return m&&m.internalChannelParams&&m.internalChannelParams[c]||g}function yI(c){this.Aa=0,this.i=[],this.j=new Ko,this.ia=this.qa=this.I=this.W=this.g=this.ya=this.D=this.H=this.m=this.S=this.o=null,this.Ya=this.U=0,this.Va=iu("failFast",!1,c),this.F=this.C=this.u=this.s=this.l=null,this.X=!0,this.za=this.T=-1,this.Y=this.v=this.B=0,this.Ta=iu("baseRetryDelayMs",5e3,c),this.cb=iu("retryDelaySeedMs",1e4,c),this.Wa=iu("forwardChannelMaxRetries",2,c),this.wa=iu("forwardChannelRequestTimeoutMs",2e4,c),this.pa=c&&c.xmlHttpFactory||void 0,this.Xa=c&&c.Tb||void 0,this.Ca=c&&c.useFetchStreams||!1,this.L=void 0,this.J=c&&c.supportsCrossDomainXhr||!1,this.K="",this.h=new Ns(c&&c.concurrentRequestLimit),this.Da=new r2,this.P=c&&c.fastHandshake||!1,this.O=c&&c.encodeInitMessageHeaders||!1,this.P&&this.O&&(this.O=!1),this.Ua=c&&c.Rb||!1,c&&c.xa&&this.j.xa(),c&&c.forceLongPolling&&(this.X=!1),this.ba=!this.P&&this.X&&c&&c.detectBufferingProxy||!1,this.ja=void 0,c&&c.longPollingTimeout&&0<c.longPollingTimeout&&(this.ja=c.longPollingTimeout),this.ca=void 0,this.R=0,this.M=!1,this.ka=this.A=null}n=yI.prototype,n.la=8,n.G=1,n.connect=function(c,g,m,I){En(0),this.W=c,this.H=g||{},m&&I!==void 0&&(this.H.OSID=m,this.H.OAID=I),this.F=this.X,this.I=bI(this,null,this.W),Kh(this)};function Gm(c){if(_I(c),c.G==3){var g=c.U++,m=zn(c.I);if(Vt(m,"SID",c.K),Vt(m,"RID",g),Vt(m,"TYPE","terminate"),ou(c,m),g=new Ce(c,c.j,g),g.L=2,g.v=qh(zn(m)),m=!1,a.navigator&&a.navigator.sendBeacon)try{m=a.navigator.sendBeacon(g.v.toString(),"")}catch{}!m&&a.Image&&(new Image().src=g.v,m=!0),m||(g.g=AI(g.j,null),g.g.ea(g.v)),g.F=Date.now(),Ue(g)}TI(c)}function Qh(c){c.g&&(Qm(c),c.g.cancel(),c.g=null)}function _I(c){Qh(c),c.u&&(a.clearTimeout(c.u),c.u=null),Yh(c),c.h.cancel(),c.s&&(typeof c.s=="number"&&a.clearTimeout(c.s),c.s=null)}function Kh(c){if(!cl(c.h)&&!c.s){c.s=!0;var g=c.Ga;It||Se(),Q||(It(),Q=!0),we.add(g,c),c.B=0}}function l2(c,g){return Bn(c.h)>=c.h.j-(c.s?1:0)?!1:c.s?(c.i=g.D.concat(c.i),!0):c.G==1||c.G==2||c.B>=(c.Va?0:c.Wa)?!1:(c.s=Qo(p(c.Ga,c,g),EI(c,c.B)),c.B++,!0)}n.Ga=function(c){if(this.s)if(this.s=null,this.G==1){if(!c){this.U=Math.floor(1e5*Math.random()),c=this.U++;const j=new Ce(this,this.j,c);let U=this.o;if(this.S&&(U?(U=v(U),C(U,this.S)):U=this.S),this.m!==null||this.O||(j.H=U,U=null),this.P)e:{for(var g=0,m=0;m<this.i.length;m++){t:{var I=this.i[m];if("__data__"in I.map&&(I=I.map.__data__,typeof I=="string")){I=I.length;break t}I=void 0}if(I===void 0)break;if(g+=I,4096<g){g=m;break e}if(g===4096||m===this.i.length-1){g=m+1;break e}}g=1e3}else g=1e3;g=wI(this,j,g),m=zn(this.I),Vt(m,"RID",c),Vt(m,"CVER",22),this.D&&Vt(m,"X-HTTP-Session-Id",this.D),ou(this,m),U&&(this.O?g="headers="+encodeURIComponent(String(dI(U)))+"&"+g:this.m&&Wm(m,this.m,U)),ft(this.h,j),this.Ua&&Vt(m,"TYPE","init"),this.P?(Vt(m,"$req",g),Vt(m,"SID","null"),j.T=!0,Je(j,m,null)):Je(j,m,g),this.G=2}}else this.G==3&&(c?vI(this,c):this.i.length==0||cl(this.h)||vI(this))};function vI(c,g){var m;g?m=g.l:m=c.U++;const I=zn(c.I);Vt(I,"SID",c.K),Vt(I,"RID",m),Vt(I,"AID",c.T),ou(c,I),c.m&&c.o&&Wm(I,c.m,c.o),m=new Ce(c,c.j,m,c.B+1),c.m===null&&(m.H=c.o),g&&(c.i=g.D.concat(c.i)),g=wI(c,m,1e3),m.I=Math.round(.5*c.wa)+Math.round(.5*c.wa*Math.random()),ft(c.h,m),Je(m,I,g)}function ou(c,g){c.H&&L(c.H,function(m,I){Vt(g,I,m)}),c.l&&ni({},function(m,I){Vt(g,I,m)})}function wI(c,g,m){m=Math.min(c.i.length,m);var I=c.l?p(c.l.Na,c.l,c):null;e:{var j=c.i;let U=-1;for(;;){const ie=["count="+m];U==-1?0<m?(U=j[0].g,ie.push("ofs="+U)):U=0:ie.push("ofs="+U);let kt=!0;for(let qn=0;qn<m;qn++){let yt=j[qn].g;const Zn=j[qn].map;if(yt-=U,0>yt)U=Math.max(0,j[qn].g-100),kt=!1;else try{s2(Zn,ie,"req"+yt+"_")}catch{I&&I(Zn)}}if(kt){I=ie.join("&");break e}}}return c=c.i.splice(0,m),g.D=c,I}function xI(c){if(!c.g&&!c.u){c.Y=1;var g=c.Fa;It||Se(),Q||(It(),Q=!0),we.add(g,c),c.v=0}}function Hm(c){return c.g||c.u||3<=c.v?!1:(c.Y++,c.u=Qo(p(c.Fa,c),EI(c,c.v)),c.v++,!0)}n.Fa=function(){if(this.u=null,II(this),this.ba&&!(this.M||this.g==null||0>=this.R)){var c=2*this.R;this.j.info("BP detection timer enabled: "+c),this.A=Qo(p(this.ab,this),c)}},n.ab=function(){this.A&&(this.A=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.F=!1,this.M=!0,En(10),Qh(this),II(this))};function Qm(c){c.A!=null&&(a.clearTimeout(c.A),c.A=null)}function II(c){c.g=new Ce(c,c.j,"rpc",c.Y),c.m===null&&(c.g.H=c.o),c.g.O=0;var g=zn(c.qa);Vt(g,"RID","rpc"),Vt(g,"SID",c.K),Vt(g,"AID",c.T),Vt(g,"CI",c.F?"0":"1"),!c.F&&c.ja&&Vt(g,"TO",c.ja),Vt(g,"TYPE","xmlhttp"),ou(c,g),c.m&&c.o&&Wm(g,c.m,c.o),c.L&&(c.g.I=c.L);var m=c.g;c=c.ia,m.L=1,m.v=qh(zn(g)),m.m=null,m.P=!0,Ve(m,c)}n.Za=function(){this.C!=null&&(this.C=null,Qh(this),Hm(this),En(19))};function Yh(c){c.C!=null&&(a.clearTimeout(c.C),c.C=null)}function SI(c,g){var m=null;if(c.g==g){Yh(c),Qm(c),c.g=null;var I=2}else if(Ge(c.h,g))m=g.D,sn(c.h,g),I=1;else return;if(c.G!=0){if(g.o)if(I==1){m=g.m?g.m.length:0,g=Date.now()-g.F;var j=c.B;I=cs(),Ye(I,new zh(I,m)),Kh(c)}else xI(c);else if(j=g.s,j==3||j==0&&0<g.X||!(I==1&&l2(c,g)||I==2&&Hm(c)))switch(m&&0<m.length&&(g=c.h,g.i=g.i.concat(m)),j){case 1:Jo(c,5);break;case 4:Jo(c,10);break;case 3:Jo(c,6);break;default:Jo(c,2)}}}function EI(c,g){let m=c.Ta+Math.floor(Math.random()*c.cb);return c.isActive()||(m*=2),m*g}function Jo(c,g){if(c.j.info("Error code "+g),g==2){var m=p(c.fb,c),I=c.Xa;const j=!I;I=new wt(I||"//www.google.com/images/cleardot.gif"),a.location&&a.location.protocol=="http"||si(I,"https"),qh(I),j?t2(I.toString(),m):n2(I.toString(),m)}else En(2);c.G=0,c.l&&c.l.sa(g),TI(c),_I(c)}n.fb=function(c){c?(this.j.info("Successfully pinged google.com"),En(2)):(this.j.info("Failed to ping google.com"),En(1))};function TI(c){if(c.G=0,c.ka=[],c.l){const g=Wt(c.h);(g.length!=0||c.i.length!=0)&&(k(c.ka,g),k(c.ka,c.i),c.h.i.length=0,S(c.i),c.i.length=0),c.l.ra()}}function bI(c,g,m){var I=m instanceof wt?zn(m):new wt(m);if(I.g!="")g&&(I.g=g+"."+I.g),ul(I,I.s);else{var j=a.location;I=j.protocol,g=g?g+"."+j.hostname:j.hostname,j=+j.port;var U=new wt(null);I&&si(U,I),g&&(U.g=g),j&&ul(U,j),m&&(U.l=m),I=U}return m=c.D,g=c.ya,m&&g&&Vt(I,m,g),Vt(I,"VER",c.la),ou(c,I),I}function AI(c,g,m){if(g&&!c.J)throw Error("Can't create secondary domain capable XhrIo object.");return g=c.Ca&&!c.pa?new on(new Wh({eb:m})):new on(c.pa),g.Ha(c.J),g}n.isActive=function(){return!!this.l&&this.l.isActive(this)};function CI(){}n=CI.prototype,n.ua=function(){},n.ta=function(){},n.sa=function(){},n.ra=function(){},n.isActive=function(){return!0},n.Na=function(){};function Jh(){}Jh.prototype.g=function(c,g){return new Pr(c,g)};function Pr(c,g){Ae.call(this),this.g=new yI(g),this.l=c,this.h=g&&g.messageUrlParams||null,c=g&&g.messageHeaders||null,g&&g.clientProtocolHeaderRequired&&(c?c["X-Client-Protocol"]="webchannel":c={"X-Client-Protocol":"webchannel"}),this.g.o=c,c=g&&g.initMessageHeaders||null,g&&g.messageContentType&&(c?c["X-WebChannel-Content-Type"]=g.messageContentType:c={"X-WebChannel-Content-Type":g.messageContentType}),g&&g.va&&(c?c["X-WebChannel-Client-Profile"]=g.va:c={"X-WebChannel-Client-Profile":g.va}),this.g.S=c,(c=g&&g.Sb)&&!x(c)&&(this.g.m=c),this.v=g&&g.supportsCrossDomainXhr||!1,this.u=g&&g.sendRawJson||!1,(g=g&&g.httpSessionIdParam)&&!x(g)&&(this.g.D=g,c=this.h,c!==null&&g in c&&(c=this.h,g in c&&delete c[g])),this.j=new hl(this)}w(Pr,Ae),Pr.prototype.m=function(){this.g.l=this.j,this.v&&(this.g.J=!0),this.g.connect(this.l,this.h||void 0)},Pr.prototype.close=function(){Gm(this.g)},Pr.prototype.o=function(c){var g=this.g;if(typeof c=="string"){var m={};m.__data__=c,c=m}else this.u&&(m={},m.__data__=Jn(c),c=m);g.i.push(new Rs(g.Ya++,c)),g.G==3&&Kh(g)},Pr.prototype.N=function(){this.g.l=null,delete this.j,Gm(this.g),delete this.g,Pr.aa.N.call(this)};function RI(c){vr.call(this),c.__headers__&&(this.headers=c.__headers__,this.statusCode=c.__status__,delete c.__headers__,delete c.__status__);var g=c.__sm__;if(g){e:{for(const m in g){c=m;break e}c=void 0}(this.i=c)&&(c=this.i,g=g!==null&&c in g?g[c]:void 0),this.data=g}else this.data=c}w(RI,vr);function NI(){Cs.call(this),this.status=1}w(NI,Cs);function hl(c){this.g=c}w(hl,CI),hl.prototype.ua=function(){Ye(this.g,"a")},hl.prototype.ta=function(c){Ye(this.g,new RI(c))},hl.prototype.sa=function(c){Ye(this.g,new NI)},hl.prototype.ra=function(){Ye(this.g,"b")},Jh.prototype.createWebChannel=Jh.prototype.g,Pr.prototype.send=Pr.prototype.o,Pr.prototype.open=Pr.prototype.m,Pr.prototype.close=Pr.prototype.close,zR=function(){return new Jh},BR=function(){return cs()},$R=hr,pv={mb:0,pb:1,qb:2,Jb:3,Ob:4,Lb:5,Mb:6,Kb:7,Ib:8,Nb:9,PROXY:10,NOPROXY:11,Gb:12,Cb:13,Db:14,Bb:15,Eb:16,Fb:17,ib:18,hb:19,jb:20},Ee.NO_ERROR=0,Ee.TIMEOUT=8,Ee.HTTP_ERROR=6,Hf=Ee,We.COMPLETE="complete",UR=We,ut.EventType=yn,yn.OPEN="a",yn.CLOSE="b",yn.ERROR="c",yn.MESSAGE="d",Ae.prototype.listen=Ae.prototype.K,Pu=ut,on.prototype.listenOnce=on.prototype.L,on.prototype.getLastError=on.prototype.Ka,on.prototype.getLastErrorCode=on.prototype.Ba,on.prototype.getStatus=on.prototype.Z,on.prototype.getResponseJson=on.prototype.Oa,on.prototype.getResponseText=on.prototype.oa,on.prototype.send=on.prototype.ea,on.prototype.setWithCredentials=on.prototype.Ha,FR=on}).apply(typeof vf<"u"?vf:typeof self<"u"?self:typeof window<"u"?window:{});const PE="@firebase/firestore",DE="4.9.0";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let On=class{constructor(e){this.uid=e}isAuthenticated(){return this.uid!=null}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}};On.UNAUTHENTICATED=new On(null),On.GOOGLE_CREDENTIALS=new On("google-credentials-uid"),On.FIRST_PARTY=new On("first-party-uid"),On.MOCK_USER=new On("mock-user");/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Bc="12.0.0";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const No=new ch("@firebase/firestore");function Il(){return No.logLevel}function x8(n){No.setLogLevel(n)}function Y(n,...e){if(No.logLevel<=st.DEBUG){const t=e.map(Cw);No.debug(`Firestore (${Bc}): ${n}`,...t)}}function pn(n,...e){if(No.logLevel<=st.ERROR){const t=e.map(Cw);No.error(`Firestore (${Bc}): ${n}`,...t)}}function as(n,...e){if(No.logLevel<=st.WARN){const t=e.map(Cw);No.warn(`Firestore (${Bc}): ${n}`,...t)}}function Cw(n){if(typeof n=="string")return n;try{/**
* @license
* Copyright 2020 Google LLC
*
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
*   http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
*/return function(t){return JSON.stringify(t)}(n)}catch{return n}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function fe(n,e,t){let r="Unexpected state";typeof e=="string"?r=e:t=e,qR(n,r,t)}function qR(n,e,t){let r=`FIRESTORE (${Bc}) INTERNAL ASSERTION FAILED: ${e} (ID: ${n.toString(16)})`;if(t!==void 0)try{r+=" CONTEXT: "+JSON.stringify(t)}catch{r+=" CONTEXT: "+t}throw pn(r),new Error(r)}function _e(n,e,t,r){let s="Unexpected state";typeof t=="string"?s=t:r=t,n||qR(e,s,r)}function I8(n,e){n||fe(57014,e)}function se(n,e){return n}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const F={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class W extends Es{constructor(e,t){super(e,t),this.code=e,this.message=t,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class jn{constructor(){this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class WR{constructor(e,t){this.user=t,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}}class V4{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,t){e.enqueueRetryable(()=>t(On.UNAUTHENTICATED))}shutdown(){}}class F4{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,t){this.changeListener=t,e.enqueueRetryable(()=>t(this.token.user))}shutdown(){this.changeListener=null}}class U4{constructor(e){this.t=e,this.currentUser=On.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(e,t){_e(this.o===void 0,42304);let r=this.i;const s=l=>this.i!==r?(r=this.i,t(l)):Promise.resolve();let i=new jn;this.o=()=>{this.i++,this.currentUser=this.u(),i.resolve(),i=new jn,e.enqueueRetryable(()=>s(this.currentUser))};const o=()=>{const l=i;e.enqueueRetryable(async()=>{await l.promise,await s(this.currentUser)})},a=l=>{Y("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=l,this.o&&(this.auth.addAuthTokenListener(this.o),o())};this.t.onInit(l=>a(l)),setTimeout(()=>{if(!this.auth){const l=this.t.getImmediate({optional:!0});l?a(l):(Y("FirebaseAuthCredentialsProvider","Auth not yet detected"),i.resolve(),i=new jn)}},0),o()}getToken(){const e=this.i,t=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(t).then(r=>this.i!==e?(Y("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):r?(_e(typeof r.accessToken=="string",31837,{l:r}),new WR(r.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.o&&this.auth.removeAuthTokenListener(this.o),this.o=void 0}u(){const e=this.auth&&this.auth.getUid();return _e(e===null||typeof e=="string",2055,{h:e}),new On(e)}}class $4{constructor(e,t,r){this.P=e,this.T=t,this.I=r,this.type="FirstParty",this.user=On.FIRST_PARTY,this.A=new Map}R(){return this.I?this.I():null}get headers(){this.A.set("X-Goog-AuthUser",this.P);const e=this.R();return e&&this.A.set("Authorization",e),this.T&&this.A.set("X-Goog-Iam-Authorization-Token",this.T),this.A}}class B4{constructor(e,t,r){this.P=e,this.T=t,this.I=r}getToken(){return Promise.resolve(new $4(this.P,this.T,this.I))}start(e,t){e.enqueueRetryable(()=>t(On.FIRST_PARTY))}shutdown(){}invalidateToken(){}}class gv{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class z4{constructor(e,t){this.V=t,this.forceRefresh=!1,this.appCheck=null,this.m=null,this.p=null,Qt(e)&&e.settings.appCheckToken&&(this.p=e.settings.appCheckToken)}start(e,t){_e(this.o===void 0,3512);const r=i=>{i.error!=null&&Y("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${i.error.message}`);const o=i.token!==this.m;return this.m=i.token,Y("FirebaseAppCheckTokenProvider",`Received ${o?"new":"existing"} token.`),o?t(i.token):Promise.resolve()};this.o=i=>{e.enqueueRetryable(()=>r(i))};const s=i=>{Y("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=i,this.o&&this.appCheck.addTokenListener(this.o)};this.V.onInit(i=>s(i)),setTimeout(()=>{if(!this.appCheck){const i=this.V.getImmediate({optional:!0});i?s(i):Y("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}},0)}getToken(){if(this.p)return Promise.resolve(new gv(this.p));const e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then(t=>t?(_e(typeof t.token=="string",44558,{tokenResult:t}),this.m=t.token,new gv(t.token)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.o&&this.appCheck.removeTokenListener(this.o),this.o=void 0}}class S8{getToken(){return Promise.resolve(new gv(""))}invalidateToken(){}start(e,t){}shutdown(){}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function q4(n){const e=typeof self<"u"&&(self.crypto||self.msCrypto),t=new Uint8Array(n);if(e&&typeof e.getRandomValues=="function")e.getRandomValues(t);else for(let r=0;r<n;r++)t[r]=Math.floor(256*Math.random());return t}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Rw{static newId(){const e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",t=62*Math.floor(4.129032258064516);let r="";for(;r.length<20;){const s=q4(40);for(let i=0;i<s.length;++i)r.length<20&&s[i]<t&&(r+=e.charAt(s[i]%62))}return r}}function je(n,e){return n<e?-1:n>e?1:0}function mv(n,e){const t=Math.min(n.length,e.length);for(let r=0;r<t;r++){const s=n.charAt(r),i=e.charAt(r);if(s!==i)return Dy(s)===Dy(i)?je(s,i):Dy(s)?1:-1}return je(n.length,e.length)}const W4=55296,G4=57343;function Dy(n){const e=n.charCodeAt(0);return e>=W4&&e<=G4}function pc(n,e,t){return n.length===e.length&&n.every((r,s)=>t(r,e[s]))}function GR(n){return n+"\0"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const yv="__name__";class Ls{constructor(e,t,r){t===void 0?t=0:t>e.length&&fe(637,{offset:t,range:e.length}),r===void 0?r=e.length-t:r>e.length-t&&fe(1746,{length:r,range:e.length-t}),this.segments=e,this.offset=t,this.len=r}get length(){return this.len}isEqual(e){return Ls.comparator(this,e)===0}child(e){const t=this.segments.slice(this.offset,this.limit());return e instanceof Ls?e.forEach(r=>{t.push(r)}):t.push(e),this.construct(t)}limit(){return this.offset+this.length}popFirst(e){return e=e===void 0?1:e,this.construct(this.segments,this.offset+e,this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return this.length===0}isPrefixOf(e){if(e.length<this.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}forEach(e){for(let t=this.offset,r=this.limit();t<r;t++)e(this.segments[t])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,t){const r=Math.min(e.length,t.length);for(let s=0;s<r;s++){const i=Ls.compareSegments(e.get(s),t.get(s));if(i!==0)return i}return je(e.length,t.length)}static compareSegments(e,t){const r=Ls.isNumericId(e),s=Ls.isNumericId(t);return r&&!s?-1:!r&&s?1:r&&s?Ls.extractNumericId(e).compare(Ls.extractNumericId(t)):mv(e,t)}static isNumericId(e){return e.startsWith("__id")&&e.endsWith("__")}static extractNumericId(e){return wo.fromString(e.substring(4,e.length-2))}}class rt extends Ls{construct(e,t,r){return new rt(e,t,r)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...e){const t=[];for(const r of e){if(r.indexOf("//")>=0)throw new W(F.INVALID_ARGUMENT,`Invalid segment (${r}). Paths must not contain // in them.`);t.push(...r.split("/").filter(s=>s.length>0))}return new rt(t)}static emptyPath(){return new rt([])}}const H4=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class Yt extends Ls{construct(e,t,r){return new Yt(e,t,r)}static isValidIdentifier(e){return H4.test(e)}canonicalString(){return this.toArray().map(e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),Yt.isValidIdentifier(e)||(e="`"+e+"`"),e)).join(".")}toString(){return this.canonicalString()}isKeyField(){return this.length===1&&this.get(0)===yv}static keyField(){return new Yt([yv])}static fromServerFormat(e){const t=[];let r="",s=0;const i=()=>{if(r.length===0)throw new W(F.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);t.push(r),r=""};let o=!1;for(;s<e.length;){const a=e[s];if(a==="\\"){if(s+1===e.length)throw new W(F.INVALID_ARGUMENT,"Path has trailing escape character: "+e);const l=e[s+1];if(l!=="\\"&&l!=="."&&l!=="`")throw new W(F.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);r+=l,s+=2}else a==="`"?(o=!o,s++):a!=="."||o?(r+=a,s++):(i(),s++)}if(i(),o)throw new W(F.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new Yt(t)}static emptyPath(){return new Yt([])}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class re{constructor(e){this.path=e}static fromPath(e){return new re(rt.fromString(e))}static fromName(e){return new re(rt.fromString(e).popFirst(5))}static empty(){return new re(rt.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return e!==null&&rt.comparator(this.path,e.path)===0}toString(){return this.path.toString()}static comparator(e,t){return rt.comparator(e.path,t.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new re(new rt(e.slice()))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Nw(n,e,t){if(!t)throw new W(F.INVALID_ARGUMENT,`Function ${n}() cannot be called with an empty ${e}.`)}function Q4(n,e,t,r){if(e===!0&&r===!0)throw new W(F.INVALID_ARGUMENT,`${n} and ${t} cannot be used together.`)}function OE(n){if(!re.isDocumentKey(n))throw new W(F.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${n} has ${n.length}.`)}function LE(n){if(re.isDocumentKey(n))throw new W(F.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${n} has ${n.length}.`)}function HR(n){return typeof n=="object"&&n!==null&&(Object.getPrototypeOf(n)===Object.prototype||Object.getPrototypeOf(n)===null)}function im(n){if(n===void 0)return"undefined";if(n===null)return"null";if(typeof n=="string")return n.length>20&&(n=`${n.substring(0,20)}...`),JSON.stringify(n);if(typeof n=="number"||typeof n=="boolean")return""+n;if(typeof n=="object"){if(n instanceof Array)return"an array";{const e=function(r){return r.constructor?r.constructor.name:null}(n);return e?`a custom ${e} object`:"an object"}}return typeof n=="function"?"a function":fe(12329,{type:typeof n})}function it(n,e){if("_delegate"in n&&(n=n._delegate),!(n instanceof e)){if(e.name===n.constructor.name)throw new W(F.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{const t=im(n);throw new W(F.INVALID_ARGUMENT,`Expected type '${e.name}', but it was: ${t}`)}}return n}function QR(n,e){if(e<=0)throw new W(F.INVALID_ARGUMENT,`Function ${n}() requires a positive number, but it was: ${e}.`)}/**
 * @license
 * Copyright 2025 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function xn(n,e){const t={typeString:n};return e&&(t.value=e),t}function Za(n,e){if(!HR(n))throw new W(F.INVALID_ARGUMENT,"JSON must be an object");let t;for(const r in e)if(e[r]){const s=e[r].typeString,i="value"in e[r]?{value:e[r].value}:void 0;if(!(r in n)){t=`JSON missing required field: '${r}'`;break}const o=n[r];if(s&&typeof o!==s){t=`JSON field '${r}' must be a ${s}.`;break}if(i!==void 0&&o!==i.value){t=`Expected '${r}' field to equal '${i.value}'`;break}}if(t)throw new W(F.INVALID_ARGUMENT,t);return!0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ME=-62135596800,jE=1e6;class Ze{static now(){return Ze.fromMillis(Date.now())}static fromDate(e){return Ze.fromMillis(e.getTime())}static fromMillis(e){const t=Math.floor(e/1e3),r=Math.floor((e-1e3*t)*jE);return new Ze(t,r)}constructor(e,t){if(this.seconds=e,this.nanoseconds=t,t<0)throw new W(F.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(t>=1e9)throw new W(F.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(e<ME)throw new W(F.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e);if(e>=253402300800)throw new W(F.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/jE}_compareTo(e){return this.seconds===e.seconds?je(this.nanoseconds,e.nanoseconds):je(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{type:Ze._jsonSchemaVersion,seconds:this.seconds,nanoseconds:this.nanoseconds}}static fromJSON(e){if(Za(e,Ze._jsonSchema))return new Ze(e.seconds,e.nanoseconds)}valueOf(){const e=this.seconds-ME;return String(e).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}Ze._jsonSchemaVersion="firestore/timestamp/1.0",Ze._jsonSchema={type:xn("string",Ze._jsonSchemaVersion),seconds:xn("number"),nanoseconds:xn("number")};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ie{static fromTimestamp(e){return new Ie(e)}static min(){return new Ie(new Ze(0,0))}static max(){return new Ie(new Ze(253402300799,999999999))}constructor(e){this.timestamp=e}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const gc=-1;class mc{constructor(e,t,r,s){this.indexId=e,this.collectionGroup=t,this.fields=r,this.indexState=s}}function _v(n){return n.fields.find(e=>e.kind===2)}function ra(n){return n.fields.filter(e=>e.kind!==2)}function K4(n,e){let t=je(n.collectionGroup,e.collectionGroup);if(t!==0)return t;for(let r=0;r<Math.min(n.fields.length,e.fields.length);++r)if(t=Y4(n.fields[r],e.fields[r]),t!==0)return t;return je(n.fields.length,e.fields.length)}mc.UNKNOWN_ID=-1;class va{constructor(e,t){this.fieldPath=e,this.kind=t}}function Y4(n,e){const t=Yt.comparator(n.fieldPath,e.fieldPath);return t!==0?t:je(n.kind,e.kind)}class yc{constructor(e,t){this.sequenceNumber=e,this.offset=t}static empty(){return new yc(0,Gr.min())}}function KR(n,e){const t=n.toTimestamp().seconds,r=n.toTimestamp().nanoseconds+1,s=Ie.fromTimestamp(r===1e9?new Ze(t+1,0):new Ze(t,r));return new Gr(s,re.empty(),e)}function YR(n){return new Gr(n.readTime,n.key,gc)}class Gr{constructor(e,t,r){this.readTime=e,this.documentKey=t,this.largestBatchId=r}static min(){return new Gr(Ie.min(),re.empty(),gc)}static max(){return new Gr(Ie.max(),re.empty(),gc)}}function kw(n,e){let t=n.readTime.compareTo(e.readTime);return t!==0?t:(t=re.comparator(n.documentKey,e.documentKey),t!==0?t:je(n.largestBatchId,e.largestBatchId))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const JR="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class XR{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach(e=>e())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function $o(n){if(n.code!==F.FAILED_PRECONDITION||n.message!==JR)throw n;Y("LocalStore","Unexpectedly lost primary lease")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class V{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e(t=>{this.isDone=!0,this.result=t,this.nextCallback&&this.nextCallback(t)},t=>{this.isDone=!0,this.error=t,this.catchCallback&&this.catchCallback(t)})}catch(e){return this.next(void 0,e)}next(e,t){return this.callbackAttached&&fe(59440),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(t,this.error):this.wrapSuccess(e,this.result):new V((r,s)=>{this.nextCallback=i=>{this.wrapSuccess(e,i).next(r,s)},this.catchCallback=i=>{this.wrapFailure(t,i).next(r,s)}})}toPromise(){return new Promise((e,t)=>{this.next(e,t)})}wrapUserFunction(e){try{const t=e();return t instanceof V?t:V.resolve(t)}catch(t){return V.reject(t)}}wrapSuccess(e,t){return e?this.wrapUserFunction(()=>e(t)):V.resolve(t)}wrapFailure(e,t){return e?this.wrapUserFunction(()=>e(t)):V.reject(t)}static resolve(e){return new V((t,r)=>{t(e)})}static reject(e){return new V((t,r)=>{r(e)})}static waitFor(e){return new V((t,r)=>{let s=0,i=0,o=!1;e.forEach(a=>{++s,a.next(()=>{++i,o&&i===s&&t()},l=>r(l))}),o=!0,i===s&&t()})}static or(e){let t=V.resolve(!1);for(const r of e)t=t.next(s=>s?V.resolve(s):r());return t}static forEach(e,t){const r=[];return e.forEach((s,i)=>{r.push(t.call(this,s,i))}),this.waitFor(r)}static mapArray(e,t){return new V((r,s)=>{const i=e.length,o=new Array(i);let a=0;for(let l=0;l<i;l++){const u=l;t(e[u]).next(h=>{o[u]=h,++a,a===i&&r(o)},h=>s(h))}})}static doWhile(e,t){return new V((r,s)=>{const i=()=>{e()===!0?t().next(()=>{i()},s):r()};i()})}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Lr="SimpleDb";class om{static open(e,t,r,s){try{return new om(t,e.transaction(s,r))}catch(i){throw new Ju(t,i)}}constructor(e,t){this.action=e,this.transaction=t,this.aborted=!1,this.S=new jn,this.transaction.oncomplete=()=>{this.S.resolve()},this.transaction.onabort=()=>{t.error?this.S.reject(new Ju(e,t.error)):this.S.resolve()},this.transaction.onerror=r=>{const s=Pw(r.target.error);this.S.reject(new Ju(e,s))}}get D(){return this.S.promise}abort(e){e&&this.S.reject(e),this.aborted||(Y(Lr,"Aborting transaction:",e?e.message:"Client-initiated abort"),this.aborted=!0,this.transaction.abort())}C(){const e=this.transaction;this.aborted||typeof e.commit!="function"||e.commit()}store(e){const t=this.transaction.objectStore(e);return new X4(t)}}class Qs{static delete(e){return Y(Lr,"Removing database:",e),ia(ZC().indexedDB.deleteDatabase(e)).toPromise()}static v(){if(!Fg())return!1;if(Qs.F())return!0;const e=Cn(),t=Qs.M(e),r=0<t&&t<10,s=ZR(e),i=0<s&&s<4.5;return!(e.indexOf("MSIE ")>0||e.indexOf("Trident/")>0||e.indexOf("Edge/")>0||r||i)}static F(){var e;return typeof process<"u"&&((e=process.__PRIVATE_env)==null?void 0:e.__PRIVATE_USE_MOCK_PERSISTENCE)==="YES"}static O(e,t){return e.store(t)}static M(e){const t=e.match(/i(?:phone|pad|pod) os ([\d_]+)/i),r=t?t[1].split("_").slice(0,2).join("."):"-1";return Number(r)}constructor(e,t,r){this.name=e,this.version=t,this.N=r,this.B=null,Qs.M(Cn())===12.2&&pn("Firestore persistence suffers from a bug in iOS 12.2 Safari that may cause your app to stop working. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.")}async L(e){return this.db||(Y(Lr,"Opening database:",this.name),this.db=await new Promise((t,r)=>{const s=indexedDB.open(this.name,this.version);s.onsuccess=i=>{const o=i.target.result;t(o)},s.onblocked=()=>{r(new Ju(e,"Cannot upgrade IndexedDB schema while another tab is open. Close all tabs that access Firestore and reload this page to proceed."))},s.onerror=i=>{const o=i.target.error;o.name==="VersionError"?r(new W(F.FAILED_PRECONDITION,"A newer version of the Firestore SDK was previously used and so the persisted data is not compatible with the version of the SDK you are now using. The SDK will operate with persistence disabled. If you need persistence, please re-upgrade to a newer version of the SDK or else clear the persisted IndexedDB data for your app to start fresh.")):o.name==="InvalidStateError"?r(new W(F.FAILED_PRECONDITION,"Unable to open an IndexedDB connection. This could be due to running in a private browsing session on a browser whose private browsing sessions do not support IndexedDB: "+o)):r(new Ju(e,o))},s.onupgradeneeded=i=>{Y(Lr,'Database "'+this.name+'" requires upgrade from version:',i.oldVersion);const o=i.target.result;this.N.k(o,s.transaction,i.oldVersion,this.version).next(()=>{Y(Lr,"Database upgrade to version "+this.version+" complete")})}})),this.q&&(this.db.onversionchange=t=>this.q(t)),this.db}$(e){this.q=e,this.db&&(this.db.onversionchange=t=>e(t))}async runTransaction(e,t,r,s){const i=t==="readonly";let o=0;for(;;){++o;try{this.db=await this.L(e);const a=om.open(this.db,e,i?"readonly":"readwrite",r),l=s(a).next(u=>(a.C(),u)).catch(u=>(a.abort(u),V.reject(u))).toPromise();return l.catch(()=>{}),await a.D,l}catch(a){const l=a,u=l.name!=="FirebaseError"&&o<3;if(Y(Lr,"Transaction failed with error:",l.message,"Retrying:",u),this.close(),!u)return Promise.reject(l)}}}close(){this.db&&this.db.close(),this.db=void 0}}function ZR(n){const e=n.match(/Android ([\d.]+)/i),t=e?e[1].split(".").slice(0,2).join("."):"-1";return Number(t)}class J4{constructor(e){this.U=e,this.K=!1,this.W=null}get isDone(){return this.K}get G(){return this.W}set cursor(e){this.U=e}done(){this.K=!0}j(e){this.W=e}delete(){return ia(this.U.delete())}}class Ju extends W{constructor(e,t){super(F.UNAVAILABLE,`IndexedDB transaction '${e}' failed: ${t}`),this.name="IndexedDbTransactionError"}}function Bo(n){return n.name==="IndexedDbTransactionError"}class X4{constructor(e){this.store=e}put(e,t){let r;return t!==void 0?(Y(Lr,"PUT",this.store.name,e,t),r=this.store.put(t,e)):(Y(Lr,"PUT",this.store.name,"<auto-key>",e),r=this.store.put(e)),ia(r)}add(e){return Y(Lr,"ADD",this.store.name,e,e),ia(this.store.add(e))}get(e){return ia(this.store.get(e)).next(t=>(t===void 0&&(t=null),Y(Lr,"GET",this.store.name,e,t),t))}delete(e){return Y(Lr,"DELETE",this.store.name,e),ia(this.store.delete(e))}count(){return Y(Lr,"COUNT",this.store.name),ia(this.store.count())}J(e,t){const r=this.options(e,t),s=r.index?this.store.index(r.index):this.store;if(typeof s.getAll=="function"){const i=s.getAll(r.range);return new V((o,a)=>{i.onerror=l=>{a(l.target.error)},i.onsuccess=l=>{o(l.target.result)}})}{const i=this.cursor(r),o=[];return this.H(i,(a,l)=>{o.push(l)}).next(()=>o)}}Y(e,t){const r=this.store.getAll(e,t===null?void 0:t);return new V((s,i)=>{r.onerror=o=>{i(o.target.error)},r.onsuccess=o=>{s(o.target.result)}})}Z(e,t){Y(Lr,"DELETE ALL",this.store.name);const r=this.options(e,t);r.X=!1;const s=this.cursor(r);return this.H(s,(i,o,a)=>a.delete())}ee(e,t){let r;t?r=e:(r={},t=e);const s=this.cursor(r);return this.H(s,t)}te(e){const t=this.cursor({});return new V((r,s)=>{t.onerror=i=>{const o=Pw(i.target.error);s(o)},t.onsuccess=i=>{const o=i.target.result;o?e(o.primaryKey,o.value).next(a=>{a?o.continue():r()}):r()}})}H(e,t){const r=[];return new V((s,i)=>{e.onerror=o=>{i(o.target.error)},e.onsuccess=o=>{const a=o.target.result;if(!a)return void s();const l=new J4(a),u=t(a.primaryKey,a.value,l);if(u instanceof V){const h=u.catch(f=>(l.done(),V.reject(f)));r.push(h)}l.isDone?s():l.G===null?a.continue():a.continue(l.G)}}).next(()=>V.waitFor(r))}options(e,t){let r;return e!==void 0&&(typeof e=="string"?r=e:t=e),{index:r,range:t}}cursor(e){let t="next";if(e.reverse&&(t="prev"),e.index){const r=this.store.index(e.index);return e.X?r.openKeyCursor(e.range,t):r.openCursor(e.range,t)}return this.store.openCursor(e.range,t)}}function ia(n){return new V((e,t)=>{n.onsuccess=r=>{const s=r.target.result;e(s)},n.onerror=r=>{const s=Pw(r.target.error);t(s)}})}let VE=!1;function Pw(n){const e=Qs.M(Cn());if(e>=12.2&&e<13){const t="An internal error was encountered in the Indexed Database server";if(n.message.indexOf(t)>=0){const r=new W("internal",`IOS_INDEXEDDB_BUG1: IndexedDb has thrown '${t}'. This is likely due to an unavoidable bug in iOS. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.`);return VE||(VE=!0,setTimeout(()=>{throw r},0)),r}}return n}const Xu="IndexBackfiller";class Z4{constructor(e,t){this.asyncQueue=e,this.ne=t,this.task=null}start(){this.re(15e3)}stop(){this.task&&(this.task.cancel(),this.task=null)}get started(){return this.task!==null}re(e){Y(Xu,`Scheduled in ${e}ms`),this.task=this.asyncQueue.enqueueAfterDelay("index_backfill",e,async()=>{this.task=null;try{const t=await this.ne.ie();Y(Xu,`Documents written: ${t}`)}catch(t){Bo(t)?Y(Xu,"Ignoring IndexedDB error during index backfill: ",t):await $o(t)}await this.re(6e4)})}}class e3{constructor(e,t){this.localStore=e,this.persistence=t}async ie(e=50){return this.persistence.runTransaction("Backfill Indexes","readwrite-primary",t=>this.se(t,e))}se(e,t){const r=new Set;let s=t,i=!0;return V.doWhile(()=>i===!0&&s>0,()=>this.localStore.indexManager.getNextCollectionGroupToUpdate(e).next(o=>{if(o!==null&&!r.has(o))return Y(Xu,`Processing collection: ${o}`),this.oe(e,o,s).next(a=>{s-=a,r.add(o)});i=!1})).next(()=>t-s)}oe(e,t,r){return this.localStore.indexManager.getMinOffsetFromCollectionGroup(e,t).next(s=>this.localStore.localDocuments.getNextDocuments(e,t,s,r).next(i=>{const o=i.changes;return this.localStore.indexManager.updateIndexEntries(e,o).next(()=>this._e(s,i)).next(a=>(Y(Xu,`Updating offset: ${a}`),this.localStore.indexManager.updateCollectionGroup(e,t,a))).next(()=>o.size)}))}_e(e,t){let r=e;return t.changes.forEach((s,i)=>{const o=YR(i);kw(o,r)>0&&(r=o)}),new Gr(r.readTime,r.documentKey,Math.max(t.batchId,e.largestBatchId))}}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ir{constructor(e,t){this.previousValue=e,t&&(t.sequenceNumberHandler=r=>this.ae(r),this.ue=r=>t.writeSequenceNumber(r))}ae(e){return this.previousValue=Math.max(e,this.previousValue),this.previousValue}next(){const e=++this.previousValue;return this.ue&&this.ue(e),e}}Ir.ce=-1;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const xo=-1;function xh(n){return n==null}function Vd(n){return n===0&&1/n==-1/0}function eN(n){return typeof n=="number"&&Number.isInteger(n)&&!Vd(n)&&n<=Number.MAX_SAFE_INTEGER&&n>=Number.MIN_SAFE_INTEGER}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Zp="";function ar(n){let e="";for(let t=0;t<n.length;t++)e.length>0&&(e=FE(e)),e=t3(n.get(t),e);return FE(e)}function t3(n,e){let t=e;const r=n.length;for(let s=0;s<r;s++){const i=n.charAt(s);switch(i){case"\0":t+="";break;case Zp:t+="";break;default:t+=i}}return t}function FE(n){return n+Zp+""}function $s(n){const e=n.length;if(_e(e>=2,64408,{path:n}),e===2)return _e(n.charAt(0)===Zp&&n.charAt(1)==="",56145,{path:n}),rt.emptyPath();const t=e-2,r=[];let s="";for(let i=0;i<e;){const o=n.indexOf(Zp,i);switch((o<0||o>t)&&fe(50515,{path:n}),n.charAt(o+1)){case"":const a=n.substring(i,o);let l;s.length===0?l=a:(s+=a,l=s,s=""),r.push(l);break;case"":s+=n.substring(i,o),s+="\0";break;case"":s+=n.substring(i,o+1);break;default:fe(61167,{path:n})}i=o+2}return new rt(r)}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const sa="remoteDocuments",Ih="owner",ml="owner",Fd="mutationQueues",n3="userId",ps="mutations",UE="batchId",fa="userMutationsIndex",$E=["userId","batchId"];/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Qf(n,e){return[n,ar(e)]}function tN(n,e,t){return[n,ar(e),t]}const r3={},_c="documentMutations",eg="remoteDocumentsV14",s3=["prefixPath","collectionGroup","readTime","documentId"],Kf="documentKeyIndex",i3=["prefixPath","collectionGroup","documentId"],nN="collectionGroupIndex",o3=["collectionGroup","readTime","prefixPath","documentId"],Ud="remoteDocumentGlobal",vv="remoteDocumentGlobalKey",vc="targets",rN="queryTargetsIndex",a3=["canonicalId","targetId"],wc="targetDocuments",l3=["targetId","path"],Dw="documentTargetsIndex",c3=["path","targetId"],tg="targetGlobalKey",wa="targetGlobal",$d="collectionParents",u3=["collectionId","parent"],xc="clientMetadata",d3="clientId",am="bundles",h3="bundleId",lm="namedQueries",f3="name",Ow="indexConfiguration",p3="indexId",wv="collectionGroupIndex",g3="collectionGroup",Zu="indexState",m3=["indexId","uid"],sN="sequenceNumberIndex",y3=["uid","sequenceNumber"],ed="indexEntries",_3=["indexId","uid","arrayValue","directionalValue","orderedDocumentKey","documentKey"],iN="documentKeyIndex",v3=["indexId","uid","orderedDocumentKey"],cm="documentOverlays",w3=["userId","collectionPath","documentId"],xv="collectionPathOverlayIndex",x3=["userId","collectionPath","largestBatchId"],oN="collectionGroupOverlayIndex",I3=["userId","collectionGroup","largestBatchId"],Lw="globals",S3="name",aN=[Fd,ps,_c,sa,vc,Ih,wa,wc,xc,Ud,$d,am,lm],E3=[...aN,cm],lN=[Fd,ps,_c,eg,vc,Ih,wa,wc,xc,Ud,$d,am,lm,cm],cN=lN,Mw=[...cN,Ow,Zu,ed],T3=Mw,uN=[...Mw,Lw],b3=uN;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Iv extends XR{constructor(e,t){super(),this.le=e,this.currentSequenceNumber=t}}function Rn(n,e){const t=se(n);return Qs.O(t.le,e)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function BE(n){let e=0;for(const t in n)Object.prototype.hasOwnProperty.call(n,t)&&e++;return e}function zo(n,e){for(const t in n)Object.prototype.hasOwnProperty.call(n,t)&&e(t,n[t])}function dN(n,e){const t=[];for(const r in n)Object.prototype.hasOwnProperty.call(n,r)&&t.push(e(n[r],r,n));return t}function hN(n){for(const e in n)if(Object.prototype.hasOwnProperty.call(n,e))return!1;return!0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class jt{constructor(e,t){this.comparator=e,this.root=t||Gn.EMPTY}insert(e,t){return new jt(this.comparator,this.root.insert(e,t,this.comparator).copy(null,null,Gn.BLACK,null,null))}remove(e){return new jt(this.comparator,this.root.remove(e,this.comparator).copy(null,null,Gn.BLACK,null,null))}get(e){let t=this.root;for(;!t.isEmpty();){const r=this.comparator(e,t.key);if(r===0)return t.value;r<0?t=t.left:r>0&&(t=t.right)}return null}indexOf(e){let t=0,r=this.root;for(;!r.isEmpty();){const s=this.comparator(e,r.key);if(s===0)return t+r.left.size;s<0?r=r.left:(t+=r.left.size+1,r=r.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal((t,r)=>(e(t,r),!1))}toString(){const e=[];return this.inorderTraversal((t,r)=>(e.push(`${t}:${r}`),!1)),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new wf(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new wf(this.root,e,this.comparator,!1)}getReverseIterator(){return new wf(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new wf(this.root,e,this.comparator,!0)}}class wf{constructor(e,t,r,s){this.isReverse=s,this.nodeStack=[];let i=1;for(;!e.isEmpty();)if(i=t?r(e.key,t):1,t&&s&&(i*=-1),i<0)e=this.isReverse?e.left:e.right;else{if(i===0){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop();const t={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return t}hasNext(){return this.nodeStack.length>0}peek(){if(this.nodeStack.length===0)return null;const e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}}class Gn{constructor(e,t,r,s,i){this.key=e,this.value=t,this.color=r??Gn.RED,this.left=s??Gn.EMPTY,this.right=i??Gn.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,t,r,s,i){return new Gn(e??this.key,t??this.value,r??this.color,s??this.left,i??this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,r){let s=this;const i=r(e,s.key);return s=i<0?s.copy(null,null,null,s.left.insert(e,t,r),null):i===0?s.copy(null,t,null,null,null):s.copy(null,null,null,null,s.right.insert(e,t,r)),s.fixUp()}removeMin(){if(this.left.isEmpty())return Gn.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),e=e.copy(null,null,null,e.left.removeMin(),null),e.fixUp()}remove(e,t){let r,s=this;if(t(e,s.key)<0)s.left.isEmpty()||s.left.isRed()||s.left.left.isRed()||(s=s.moveRedLeft()),s=s.copy(null,null,null,s.left.remove(e,t),null);else{if(s.left.isRed()&&(s=s.rotateRight()),s.right.isEmpty()||s.right.isRed()||s.right.left.isRed()||(s=s.moveRedRight()),t(e,s.key)===0){if(s.right.isEmpty())return Gn.EMPTY;r=s.right.min(),s=s.copy(r.key,r.value,null,null,s.right.removeMin())}s=s.copy(null,null,null,null,s.right.remove(e,t))}return s.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=e.copy(null,null,null,null,e.right.rotateRight()),e=e.rotateLeft(),e=e.colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=e.rotateRight(),e=e.colorFlip()),e}rotateLeft(){const e=this.copy(null,null,Gn.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){const e=this.copy(null,null,Gn.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){const e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth(){const e=this.check();return Math.pow(2,e)<=this.size+1}check(){if(this.isRed()&&this.left.isRed())throw fe(43730,{key:this.key,value:this.value});if(this.right.isRed())throw fe(14113,{key:this.key,value:this.value});const e=this.left.check();if(e!==this.right.check())throw fe(27949);return e+(this.isRed()?0:1)}}Gn.EMPTY=null,Gn.RED=!0,Gn.BLACK=!1;Gn.EMPTY=new class{constructor(){this.size=0}get key(){throw fe(57766)}get value(){throw fe(16141)}get color(){throw fe(16727)}get left(){throw fe(29726)}get right(){throw fe(36894)}copy(e,t,r,s,i){return this}insert(e,t,r){return new Gn(e,t)}remove(e,t){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class bt{constructor(e){this.comparator=e,this.data=new jt(this.comparator)}has(e){return this.data.get(e)!==null}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal((t,r)=>(e(t),!1))}forEachInRange(e,t){const r=this.data.getIteratorFrom(e[0]);for(;r.hasNext();){const s=r.getNext();if(this.comparator(s.key,e[1])>=0)return;t(s.key)}}forEachWhile(e,t){let r;for(r=t!==void 0?this.data.getIteratorFrom(t):this.data.getIterator();r.hasNext();)if(!e(r.getNext().key))return}firstAfterOrEqual(e){const t=this.data.getIteratorFrom(e);return t.hasNext()?t.getNext().key:null}getIterator(){return new zE(this.data.getIterator())}getIteratorFrom(e){return new zE(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let t=this;return t.size<e.size&&(t=e,e=this),e.forEach(r=>{t=t.add(r)}),t}isEqual(e){if(!(e instanceof bt)||this.size!==e.size)return!1;const t=this.data.getIterator(),r=e.data.getIterator();for(;t.hasNext();){const s=t.getNext().key,i=r.getNext().key;if(this.comparator(s,i)!==0)return!1}return!0}toArray(){const e=[];return this.forEach(t=>{e.push(t)}),e}toString(){const e=[];return this.forEach(t=>e.push(t)),"SortedSet("+e.toString()+")"}copy(e){const t=new bt(this.comparator);return t.data=e,t}}class zE{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}function yl(n){return n.hasNext()?n.getNext():void 0}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Sr{constructor(e){this.fields=e,e.sort(Yt.comparator)}static empty(){return new Sr([])}unionWith(e){let t=new bt(Yt.comparator);for(const r of this.fields)t=t.add(r);for(const r of e)t=t.add(r);return new Sr(t.toArray())}covers(e){for(const t of this.fields)if(t.isPrefixOf(e))return!0;return!1}isEqual(e){return pc(this.fields,e.fields,(t,r)=>t.isEqual(r))}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class fN extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function T8(){return typeof atob<"u"}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ln{constructor(e){this.binaryString=e}static fromBase64String(e){const t=function(s){try{return atob(s)}catch(i){throw typeof DOMException<"u"&&i instanceof DOMException?new fN("Invalid base64 string: "+i):i}}(e);return new ln(t)}static fromUint8Array(e){const t=function(s){let i="";for(let o=0;o<s.length;++o)i+=String.fromCharCode(s[o]);return i}(e);return new ln(t)}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return function(t){return btoa(t)}(this.binaryString)}toUint8Array(){return function(t){const r=new Uint8Array(t.length);for(let s=0;s<t.length;s++)r[s]=t.charCodeAt(s);return r}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return je(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}}ln.EMPTY_BYTE_STRING=new ln("");const A3=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function Ti(n){if(_e(!!n,39018),typeof n=="string"){let e=0;const t=A3.exec(n);if(_e(!!t,46558,{timestamp:n}),t[1]){let s=t[1];s=(s+"000000000").substr(0,9),e=Number(s)}const r=new Date(n);return{seconds:Math.floor(r.getTime()/1e3),nanos:e}}return{seconds:Gt(n.seconds),nanos:Gt(n.nanos)}}function Gt(n){return typeof n=="number"?n:typeof n=="string"?Number(n):0}function bi(n){return typeof n=="string"?ln.fromBase64String(n):ln.fromUint8Array(n)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const pN="server_timestamp",gN="__type__",mN="__previous_value__",yN="__local_write_time__";function um(n){var t,r;return((r=(((t=n==null?void 0:n.mapValue)==null?void 0:t.fields)||{})[gN])==null?void 0:r.stringValue)===pN}function dm(n){const e=n.mapValue.fields[mN];return um(e)?dm(e):e}function Bd(n){const e=Ti(n.mapValue.fields[yN].timestampValue);return new Ze(e.seconds,e.nanos)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class C3{constructor(e,t,r,s,i,o,a,l,u,h){this.databaseId=e,this.appId=t,this.persistenceKey=r,this.host=s,this.ssl=i,this.forceLongPolling=o,this.autoDetectLongPolling=a,this.longPollingOptions=l,this.useFetchStreams=u,this.isUsingEmulator=h}}const zd="(default)";class Da{constructor(e,t){this.projectId=e,this.database=t||zd}static empty(){return new Da("","")}get isDefaultDatabase(){return this.database===zd}isEqual(e){return e instanceof Da&&e.projectId===this.projectId&&e.database===this.database}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const jw="__type__",_N="__max__",io={mapValue:{fields:{__type__:{stringValue:_N}}}},Vw="__vector__",Ic="value",Yf={nullValue:"NULL_VALUE"};function ko(n){return"nullValue"in n?0:"booleanValue"in n?1:"integerValue"in n||"doubleValue"in n?2:"timestampValue"in n?3:"stringValue"in n?5:"bytesValue"in n?6:"referenceValue"in n?7:"geoPointValue"in n?8:"arrayValue"in n?9:"mapValue"in n?um(n)?4:vN(n)?9007199254740991:hm(n)?10:11:fe(28295,{value:n})}function ei(n,e){if(n===e)return!0;const t=ko(n);if(t!==ko(e))return!1;switch(t){case 0:case 9007199254740991:return!0;case 1:return n.booleanValue===e.booleanValue;case 4:return Bd(n).isEqual(Bd(e));case 3:return function(s,i){if(typeof s.timestampValue=="string"&&typeof i.timestampValue=="string"&&s.timestampValue.length===i.timestampValue.length)return s.timestampValue===i.timestampValue;const o=Ti(s.timestampValue),a=Ti(i.timestampValue);return o.seconds===a.seconds&&o.nanos===a.nanos}(n,e);case 5:return n.stringValue===e.stringValue;case 6:return function(s,i){return bi(s.bytesValue).isEqual(bi(i.bytesValue))}(n,e);case 7:return n.referenceValue===e.referenceValue;case 8:return function(s,i){return Gt(s.geoPointValue.latitude)===Gt(i.geoPointValue.latitude)&&Gt(s.geoPointValue.longitude)===Gt(i.geoPointValue.longitude)}(n,e);case 2:return function(s,i){if("integerValue"in s&&"integerValue"in i)return Gt(s.integerValue)===Gt(i.integerValue);if("doubleValue"in s&&"doubleValue"in i){const o=Gt(s.doubleValue),a=Gt(i.doubleValue);return o===a?Vd(o)===Vd(a):isNaN(o)&&isNaN(a)}return!1}(n,e);case 9:return pc(n.arrayValue.values||[],e.arrayValue.values||[],ei);case 10:case 11:return function(s,i){const o=s.mapValue.fields||{},a=i.mapValue.fields||{};if(BE(o)!==BE(a))return!1;for(const l in o)if(o.hasOwnProperty(l)&&(a[l]===void 0||!ei(o[l],a[l])))return!1;return!0}(n,e);default:return fe(52216,{left:n})}}function qd(n,e){return(n.values||[]).find(t=>ei(t,e))!==void 0}function Po(n,e){if(n===e)return 0;const t=ko(n),r=ko(e);if(t!==r)return je(t,r);switch(t){case 0:case 9007199254740991:return 0;case 1:return je(n.booleanValue,e.booleanValue);case 2:return function(i,o){const a=Gt(i.integerValue||i.doubleValue),l=Gt(o.integerValue||o.doubleValue);return a<l?-1:a>l?1:a===l?0:isNaN(a)?isNaN(l)?0:-1:1}(n,e);case 3:return qE(n.timestampValue,e.timestampValue);case 4:return qE(Bd(n),Bd(e));case 5:return mv(n.stringValue,e.stringValue);case 6:return function(i,o){const a=bi(i),l=bi(o);return a.compareTo(l)}(n.bytesValue,e.bytesValue);case 7:return function(i,o){const a=i.split("/"),l=o.split("/");for(let u=0;u<a.length&&u<l.length;u++){const h=je(a[u],l[u]);if(h!==0)return h}return je(a.length,l.length)}(n.referenceValue,e.referenceValue);case 8:return function(i,o){const a=je(Gt(i.latitude),Gt(o.latitude));return a!==0?a:je(Gt(i.longitude),Gt(o.longitude))}(n.geoPointValue,e.geoPointValue);case 9:return WE(n.arrayValue,e.arrayValue);case 10:return function(i,o){var p,y,w,S;const a=i.fields||{},l=o.fields||{},u=(p=a[Ic])==null?void 0:p.arrayValue,h=(y=l[Ic])==null?void 0:y.arrayValue,f=je(((w=u==null?void 0:u.values)==null?void 0:w.length)||0,((S=h==null?void 0:h.values)==null?void 0:S.length)||0);return f!==0?f:WE(u,h)}(n.mapValue,e.mapValue);case 11:return function(i,o){if(i===io.mapValue&&o===io.mapValue)return 0;if(i===io.mapValue)return 1;if(o===io.mapValue)return-1;const a=i.fields||{},l=Object.keys(a),u=o.fields||{},h=Object.keys(u);l.sort(),h.sort();for(let f=0;f<l.length&&f<h.length;++f){const p=mv(l[f],h[f]);if(p!==0)return p;const y=Po(a[l[f]],u[h[f]]);if(y!==0)return y}return je(l.length,h.length)}(n.mapValue,e.mapValue);default:throw fe(23264,{he:t})}}function qE(n,e){if(typeof n=="string"&&typeof e=="string"&&n.length===e.length)return je(n,e);const t=Ti(n),r=Ti(e),s=je(t.seconds,r.seconds);return s!==0?s:je(t.nanos,r.nanos)}function WE(n,e){const t=n.values||[],r=e.values||[];for(let s=0;s<t.length&&s<r.length;++s){const i=Po(t[s],r[s]);if(i)return i}return je(t.length,r.length)}function Sc(n){return Sv(n)}function Sv(n){return"nullValue"in n?"null":"booleanValue"in n?""+n.booleanValue:"integerValue"in n?""+n.integerValue:"doubleValue"in n?""+n.doubleValue:"timestampValue"in n?function(t){const r=Ti(t);return`time(${r.seconds},${r.nanos})`}(n.timestampValue):"stringValue"in n?n.stringValue:"bytesValue"in n?function(t){return bi(t).toBase64()}(n.bytesValue):"referenceValue"in n?function(t){return re.fromName(t).toString()}(n.referenceValue):"geoPointValue"in n?function(t){return`geo(${t.latitude},${t.longitude})`}(n.geoPointValue):"arrayValue"in n?function(t){let r="[",s=!0;for(const i of t.values||[])s?s=!1:r+=",",r+=Sv(i);return r+"]"}(n.arrayValue):"mapValue"in n?function(t){const r=Object.keys(t.fields||{}).sort();let s="{",i=!0;for(const o of r)i?i=!1:s+=",",s+=`${o}:${Sv(t.fields[o])}`;return s+"}"}(n.mapValue):fe(61005,{value:n})}function Jf(n){switch(ko(n)){case 0:case 1:return 4;case 2:return 8;case 3:case 8:return 16;case 4:const e=dm(n);return e?16+Jf(e):16;case 5:return 2*n.stringValue.length;case 6:return bi(n.bytesValue).approximateByteSize();case 7:return n.referenceValue.length;case 9:return function(r){return(r.values||[]).reduce((s,i)=>s+Jf(i),0)}(n.arrayValue);case 10:case 11:return function(r){let s=0;return zo(r.fields,(i,o)=>{s+=i.length+Jf(o)}),s}(n.mapValue);default:throw fe(13486,{value:n})}}function Oa(n,e){return{referenceValue:`projects/${n.projectId}/databases/${n.database}/documents/${e.path.canonicalString()}`}}function Ev(n){return!!n&&"integerValue"in n}function Wd(n){return!!n&&"arrayValue"in n}function GE(n){return!!n&&"nullValue"in n}function HE(n){return!!n&&"doubleValue"in n&&isNaN(Number(n.doubleValue))}function Xf(n){return!!n&&"mapValue"in n}function hm(n){var t,r;return((r=(((t=n==null?void 0:n.mapValue)==null?void 0:t.fields)||{})[jw])==null?void 0:r.stringValue)===Vw}function td(n){if(n.geoPointValue)return{geoPointValue:{...n.geoPointValue}};if(n.timestampValue&&typeof n.timestampValue=="object")return{timestampValue:{...n.timestampValue}};if(n.mapValue){const e={mapValue:{fields:{}}};return zo(n.mapValue.fields,(t,r)=>e.mapValue.fields[t]=td(r)),e}if(n.arrayValue){const e={arrayValue:{values:[]}};for(let t=0;t<(n.arrayValue.values||[]).length;++t)e.arrayValue.values[t]=td(n.arrayValue.values[t]);return e}return{...n}}function vN(n){return(((n.mapValue||{}).fields||{}).__type__||{}).stringValue===_N}const wN={mapValue:{fields:{[jw]:{stringValue:Vw},[Ic]:{arrayValue:{}}}}};function R3(n){return"nullValue"in n?Yf:"booleanValue"in n?{booleanValue:!1}:"integerValue"in n||"doubleValue"in n?{doubleValue:NaN}:"timestampValue"in n?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"stringValue"in n?{stringValue:""}:"bytesValue"in n?{bytesValue:""}:"referenceValue"in n?Oa(Da.empty(),re.empty()):"geoPointValue"in n?{geoPointValue:{latitude:-90,longitude:-180}}:"arrayValue"in n?{arrayValue:{}}:"mapValue"in n?hm(n)?wN:{mapValue:{}}:fe(35942,{value:n})}function N3(n){return"nullValue"in n?{booleanValue:!1}:"booleanValue"in n?{doubleValue:NaN}:"integerValue"in n||"doubleValue"in n?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"timestampValue"in n?{stringValue:""}:"stringValue"in n?{bytesValue:""}:"bytesValue"in n?Oa(Da.empty(),re.empty()):"referenceValue"in n?{geoPointValue:{latitude:-90,longitude:-180}}:"geoPointValue"in n?{arrayValue:{}}:"arrayValue"in n?wN:"mapValue"in n?hm(n)?{mapValue:{}}:io:fe(61959,{value:n})}function QE(n,e){const t=Po(n.value,e.value);return t!==0?t:n.inclusive&&!e.inclusive?-1:!n.inclusive&&e.inclusive?1:0}function KE(n,e){const t=Po(n.value,e.value);return t!==0?t:n.inclusive&&!e.inclusive?1:!n.inclusive&&e.inclusive?-1:0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Hn{constructor(e){this.value=e}static empty(){return new Hn({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let t=this.value;for(let r=0;r<e.length-1;++r)if(t=(t.mapValue.fields||{})[e.get(r)],!Xf(t))return null;return t=(t.mapValue.fields||{})[e.lastSegment()],t||null}}set(e,t){this.getFieldsMap(e.popLast())[e.lastSegment()]=td(t)}setAll(e){let t=Yt.emptyPath(),r={},s=[];e.forEach((o,a)=>{if(!t.isImmediateParentOf(a)){const l=this.getFieldsMap(t);this.applyChanges(l,r,s),r={},s=[],t=a.popLast()}o?r[a.lastSegment()]=td(o):s.push(a.lastSegment())});const i=this.getFieldsMap(t);this.applyChanges(i,r,s)}delete(e){const t=this.field(e.popLast());Xf(t)&&t.mapValue.fields&&delete t.mapValue.fields[e.lastSegment()]}isEqual(e){return ei(this.value,e.value)}getFieldsMap(e){let t=this.value;t.mapValue.fields||(t.mapValue={fields:{}});for(let r=0;r<e.length;++r){let s=t.mapValue.fields[e.get(r)];Xf(s)&&s.mapValue.fields||(s={mapValue:{fields:{}}},t.mapValue.fields[e.get(r)]=s),t=s}return t.mapValue.fields}applyChanges(e,t,r){zo(t,(s,i)=>e[s]=i);for(const s of r)delete e[s]}clone(){return new Hn(td(this.value))}}function xN(n){const e=[];return zo(n.fields,(t,r)=>{const s=new Yt([t]);if(Xf(r)){const i=xN(r.mapValue).fields;if(i.length===0)e.push(s);else for(const o of i)e.push(s.child(o))}else e.push(s)}),new Sr(e)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ut{constructor(e,t,r,s,i,o,a){this.key=e,this.documentType=t,this.version=r,this.readTime=s,this.createTime=i,this.data=o,this.documentState=a}static newInvalidDocument(e){return new Ut(e,0,Ie.min(),Ie.min(),Ie.min(),Hn.empty(),0)}static newFoundDocument(e,t,r,s){return new Ut(e,1,t,Ie.min(),r,s,0)}static newNoDocument(e,t){return new Ut(e,2,t,Ie.min(),Ie.min(),Hn.empty(),0)}static newUnknownDocument(e,t){return new Ut(e,3,t,Ie.min(),Ie.min(),Hn.empty(),2)}convertToFoundDocument(e,t){return!this.createTime.isEqual(Ie.min())||this.documentType!==2&&this.documentType!==0||(this.createTime=e),this.version=e,this.documentType=1,this.data=t,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=Hn.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=Hn.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=Ie.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return this.documentState===1}get hasCommittedMutations(){return this.documentState===2}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return this.documentType!==0}isFoundDocument(){return this.documentType===1}isNoDocument(){return this.documentType===2}isUnknownDocument(){return this.documentType===3}isEqual(e){return e instanceof Ut&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new Ut(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Do{constructor(e,t){this.position=e,this.inclusive=t}}function YE(n,e,t){let r=0;for(let s=0;s<n.position.length;s++){const i=e[s],o=n.position[s];if(i.field.isKeyField()?r=re.comparator(re.fromName(o.referenceValue),t.key):r=Po(o,t.data.field(i.field)),i.dir==="desc"&&(r*=-1),r!==0)break}return r}function JE(n,e){if(n===null)return e===null;if(e===null||n.inclusive!==e.inclusive||n.position.length!==e.position.length)return!1;for(let t=0;t<n.position.length;t++)if(!ei(n.position[t],e.position[t]))return!1;return!0}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Gd{constructor(e,t="asc"){this.field=e,this.dir=t}}function k3(n,e){return n.dir===e.dir&&n.field.isEqual(e.field)}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class IN{}class at extends IN{constructor(e,t,r){super(),this.field=e,this.op=t,this.value=r}static create(e,t,r){return e.isKeyField()?t==="in"||t==="not-in"?this.createKeyFieldInFilter(e,t,r):new P3(e,t,r):t==="array-contains"?new L3(e,r):t==="in"?new CN(e,r):t==="not-in"?new M3(e,r):t==="array-contains-any"?new j3(e,r):new at(e,t,r)}static createKeyFieldInFilter(e,t,r){return t==="in"?new D3(e,r):new O3(e,r)}matches(e){const t=e.data.field(this.field);return this.op==="!="?t!==null&&t.nullValue===void 0&&this.matchesComparison(Po(t,this.value)):t!==null&&ko(this.value)===ko(t)&&this.matchesComparison(Po(t,this.value))}matchesComparison(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return e===0;case"!=":return e!==0;case">":return e>0;case">=":return e>=0;default:return fe(47266,{operator:this.op})}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}}class Et extends IN{constructor(e,t){super(),this.filters=e,this.op=t,this.Pe=null}static create(e,t){return new Et(e,t)}matches(e){return Ec(this)?this.filters.find(t=>!t.matches(e))===void 0:this.filters.find(t=>t.matches(e))!==void 0}getFlattenedFilters(){return this.Pe!==null||(this.Pe=this.filters.reduce((e,t)=>e.concat(t.getFlattenedFilters()),[])),this.Pe}getFilters(){return Object.assign([],this.filters)}}function Ec(n){return n.op==="and"}function Tv(n){return n.op==="or"}function Fw(n){return SN(n)&&Ec(n)}function SN(n){for(const e of n.filters)if(e instanceof Et)return!1;return!0}function bv(n){if(n instanceof at)return n.field.canonicalString()+n.op.toString()+Sc(n.value);if(Fw(n))return n.filters.map(e=>bv(e)).join(",");{const e=n.filters.map(t=>bv(t)).join(",");return`${n.op}(${e})`}}function EN(n,e){return n instanceof at?function(r,s){return s instanceof at&&r.op===s.op&&r.field.isEqual(s.field)&&ei(r.value,s.value)}(n,e):n instanceof Et?function(r,s){return s instanceof Et&&r.op===s.op&&r.filters.length===s.filters.length?r.filters.reduce((i,o,a)=>i&&EN(o,s.filters[a]),!0):!1}(n,e):void fe(19439)}function TN(n,e){const t=n.filters.concat(e);return Et.create(t,n.op)}function bN(n){return n instanceof at?function(t){return`${t.field.canonicalString()} ${t.op} ${Sc(t.value)}`}(n):n instanceof Et?function(t){return t.op.toString()+" {"+t.getFilters().map(bN).join(" ,")+"}"}(n):"Filter"}class P3 extends at{constructor(e,t,r){super(e,t,r),this.key=re.fromName(r.referenceValue)}matches(e){const t=re.comparator(e.key,this.key);return this.matchesComparison(t)}}class D3 extends at{constructor(e,t){super(e,"in",t),this.keys=AN("in",t)}matches(e){return this.keys.some(t=>t.isEqual(e.key))}}class O3 extends at{constructor(e,t){super(e,"not-in",t),this.keys=AN("not-in",t)}matches(e){return!this.keys.some(t=>t.isEqual(e.key))}}function AN(n,e){var t;return(((t=e.arrayValue)==null?void 0:t.values)||[]).map(r=>re.fromName(r.referenceValue))}class L3 extends at{constructor(e,t){super(e,"array-contains",t)}matches(e){const t=e.data.field(this.field);return Wd(t)&&qd(t.arrayValue,this.value)}}class CN extends at{constructor(e,t){super(e,"in",t)}matches(e){const t=e.data.field(this.field);return t!==null&&qd(this.value.arrayValue,t)}}class M3 extends at{constructor(e,t){super(e,"not-in",t)}matches(e){if(qd(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;const t=e.data.field(this.field);return t!==null&&t.nullValue===void 0&&!qd(this.value.arrayValue,t)}}class j3 extends at{constructor(e,t){super(e,"array-contains-any",t)}matches(e){const t=e.data.field(this.field);return!(!Wd(t)||!t.arrayValue.values)&&t.arrayValue.values.some(r=>qd(this.value.arrayValue,r))}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class V3{constructor(e,t=null,r=[],s=[],i=null,o=null,a=null){this.path=e,this.collectionGroup=t,this.orderBy=r,this.filters=s,this.limit=i,this.startAt=o,this.endAt=a,this.Te=null}}function Av(n,e=null,t=[],r=[],s=null,i=null,o=null){return new V3(n,e,t,r,s,i,o)}function La(n){const e=se(n);if(e.Te===null){let t=e.path.canonicalString();e.collectionGroup!==null&&(t+="|cg:"+e.collectionGroup),t+="|f:",t+=e.filters.map(r=>bv(r)).join(","),t+="|ob:",t+=e.orderBy.map(r=>function(i){return i.field.canonicalString()+i.dir}(r)).join(","),xh(e.limit)||(t+="|l:",t+=e.limit),e.startAt&&(t+="|lb:",t+=e.startAt.inclusive?"b:":"a:",t+=e.startAt.position.map(r=>Sc(r)).join(",")),e.endAt&&(t+="|ub:",t+=e.endAt.inclusive?"a:":"b:",t+=e.endAt.position.map(r=>Sc(r)).join(",")),e.Te=t}return e.Te}function Sh(n,e){if(n.limit!==e.limit||n.orderBy.length!==e.orderBy.length)return!1;for(let t=0;t<n.orderBy.length;t++)if(!k3(n.orderBy[t],e.orderBy[t]))return!1;if(n.filters.length!==e.filters.length)return!1;for(let t=0;t<n.filters.length;t++)if(!EN(n.filters[t],e.filters[t]))return!1;return n.collectionGroup===e.collectionGroup&&!!n.path.isEqual(e.path)&&!!JE(n.startAt,e.startAt)&&JE(n.endAt,e.endAt)}function ng(n){return re.isDocumentKey(n.path)&&n.collectionGroup===null&&n.filters.length===0}function rg(n,e){return n.filters.filter(t=>t instanceof at&&t.field.isEqual(e))}function XE(n,e,t){let r=Yf,s=!0;for(const i of rg(n,e)){let o=Yf,a=!0;switch(i.op){case"<":case"<=":o=R3(i.value);break;case"==":case"in":case">=":o=i.value;break;case">":o=i.value,a=!1;break;case"!=":case"not-in":o=Yf}QE({value:r,inclusive:s},{value:o,inclusive:a})<0&&(r=o,s=a)}if(t!==null){for(let i=0;i<n.orderBy.length;++i)if(n.orderBy[i].field.isEqual(e)){const o=t.position[i];QE({value:r,inclusive:s},{value:o,inclusive:t.inclusive})<0&&(r=o,s=t.inclusive);break}}return{value:r,inclusive:s}}function ZE(n,e,t){let r=io,s=!0;for(const i of rg(n,e)){let o=io,a=!0;switch(i.op){case">=":case">":o=N3(i.value),a=!1;break;case"==":case"in":case"<=":o=i.value;break;case"<":o=i.value,a=!1;break;case"!=":case"not-in":o=io}KE({value:r,inclusive:s},{value:o,inclusive:a})>0&&(r=o,s=a)}if(t!==null){for(let i=0;i<n.orderBy.length;++i)if(n.orderBy[i].field.isEqual(e)){const o=t.position[i];KE({value:r,inclusive:s},{value:o,inclusive:t.inclusive})>0&&(r=o,s=t.inclusive);break}}return{value:r,inclusive:s}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Pi{constructor(e,t=null,r=[],s=[],i=null,o="F",a=null,l=null){this.path=e,this.collectionGroup=t,this.explicitOrderBy=r,this.filters=s,this.limit=i,this.limitType=o,this.startAt=a,this.endAt=l,this.Ie=null,this.Ee=null,this.de=null,this.startAt,this.endAt}}function RN(n,e,t,r,s,i,o,a){return new Pi(n,e,t,r,s,i,o,a)}function zc(n){return new Pi(n)}function eT(n){return n.filters.length===0&&n.limit===null&&n.startAt==null&&n.endAt==null&&(n.explicitOrderBy.length===0||n.explicitOrderBy.length===1&&n.explicitOrderBy[0].field.isKeyField())}function Uw(n){return n.collectionGroup!==null}function Ql(n){const e=se(n);if(e.Ie===null){e.Ie=[];const t=new Set;for(const i of e.explicitOrderBy)e.Ie.push(i),t.add(i.field.canonicalString());const r=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc";(function(o){let a=new bt(Yt.comparator);return o.filters.forEach(l=>{l.getFlattenedFilters().forEach(u=>{u.isInequality()&&(a=a.add(u.field))})}),a})(e).forEach(i=>{t.has(i.canonicalString())||i.isKeyField()||e.Ie.push(new Gd(i,r))}),t.has(Yt.keyField().canonicalString())||e.Ie.push(new Gd(Yt.keyField(),r))}return e.Ie}function lr(n){const e=se(n);return e.Ee||(e.Ee=kN(e,Ql(n))),e.Ee}function NN(n){const e=se(n);return e.de||(e.de=kN(e,n.explicitOrderBy)),e.de}function kN(n,e){if(n.limitType==="F")return Av(n.path,n.collectionGroup,e,n.filters,n.limit,n.startAt,n.endAt);{e=e.map(s=>{const i=s.dir==="desc"?"asc":"desc";return new Gd(s.field,i)});const t=n.endAt?new Do(n.endAt.position,n.endAt.inclusive):null,r=n.startAt?new Do(n.startAt.position,n.startAt.inclusive):null;return Av(n.path,n.collectionGroup,e,n.filters,n.limit,t,r)}}function Cv(n,e){const t=n.filters.concat([e]);return new Pi(n.path,n.collectionGroup,n.explicitOrderBy.slice(),t,n.limit,n.limitType,n.startAt,n.endAt)}function sg(n,e,t){return new Pi(n.path,n.collectionGroup,n.explicitOrderBy.slice(),n.filters.slice(),e,t,n.startAt,n.endAt)}function Eh(n,e){return Sh(lr(n),lr(e))&&n.limitType===e.limitType}function PN(n){return`${La(lr(n))}|lt:${n.limitType}`}function Sl(n){return`Query(target=${function(t){let r=t.path.canonicalString();return t.collectionGroup!==null&&(r+=" collectionGroup="+t.collectionGroup),t.filters.length>0&&(r+=`, filters: [${t.filters.map(s=>bN(s)).join(", ")}]`),xh(t.limit)||(r+=", limit: "+t.limit),t.orderBy.length>0&&(r+=`, orderBy: [${t.orderBy.map(s=>function(o){return`${o.field.canonicalString()} (${o.dir})`}(s)).join(", ")}]`),t.startAt&&(r+=", startAt: ",r+=t.startAt.inclusive?"b:":"a:",r+=t.startAt.position.map(s=>Sc(s)).join(",")),t.endAt&&(r+=", endAt: ",r+=t.endAt.inclusive?"a:":"b:",r+=t.endAt.position.map(s=>Sc(s)).join(",")),`Target(${r})`}(lr(n))}; limitType=${n.limitType})`}function Th(n,e){return e.isFoundDocument()&&function(r,s){const i=s.key.path;return r.collectionGroup!==null?s.key.hasCollectionId(r.collectionGroup)&&r.path.isPrefixOf(i):re.isDocumentKey(r.path)?r.path.isEqual(i):r.path.isImmediateParentOf(i)}(n,e)&&function(r,s){for(const i of Ql(r))if(!i.field.isKeyField()&&s.data.field(i.field)===null)return!1;return!0}(n,e)&&function(r,s){for(const i of r.filters)if(!i.matches(s))return!1;return!0}(n,e)&&function(r,s){return!(r.startAt&&!function(o,a,l){const u=YE(o,a,l);return o.inclusive?u<=0:u<0}(r.startAt,Ql(r),s)||r.endAt&&!function(o,a,l){const u=YE(o,a,l);return o.inclusive?u>=0:u>0}(r.endAt,Ql(r),s))}(n,e)}function DN(n){return n.collectionGroup||(n.path.length%2==1?n.path.lastSegment():n.path.get(n.path.length-2))}function ON(n){return(e,t)=>{let r=!1;for(const s of Ql(n)){const i=F3(s,e,t);if(i!==0)return i;r=r||s.field.isKeyField()}return 0}}function F3(n,e,t){const r=n.field.isKeyField()?re.comparator(e.key,t.key):function(i,o,a){const l=o.data.field(i),u=a.data.field(i);return l!==null&&u!==null?Po(l,u):fe(42886)}(n.field,e,t);switch(n.dir){case"asc":return r;case"desc":return-1*r;default:return fe(19790,{direction:n.dir})}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Di{constructor(e,t){this.mapKeyFn=e,this.equalsFn=t,this.inner={},this.innerSize=0}get(e){const t=this.mapKeyFn(e),r=this.inner[t];if(r!==void 0){for(const[s,i]of r)if(this.equalsFn(s,e))return i}}has(e){return this.get(e)!==void 0}set(e,t){const r=this.mapKeyFn(e),s=this.inner[r];if(s===void 0)return this.inner[r]=[[e,t]],void this.innerSize++;for(let i=0;i<s.length;i++)if(this.equalsFn(s[i][0],e))return void(s[i]=[e,t]);s.push([e,t]),this.innerSize++}delete(e){const t=this.mapKeyFn(e),r=this.inner[t];if(r===void 0)return!1;for(let s=0;s<r.length;s++)if(this.equalsFn(r[s][0],e))return r.length===1?delete this.inner[t]:r.splice(s,1),this.innerSize--,!0;return!1}forEach(e){zo(this.inner,(t,r)=>{for(const[s,i]of r)e(s,i)})}isEmpty(){return hN(this.inner)}size(){return this.innerSize}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const U3=new jt(re.comparator);function Er(){return U3}const LN=new jt(re.comparator);function Du(...n){let e=LN;for(const t of n)e=e.insert(t.key,t);return e}function MN(n){let e=LN;return n.forEach((t,r)=>e=e.insert(t,r.overlayedDocument)),e}function Bs(){return nd()}function jN(){return nd()}function nd(){return new Di(n=>n.toString(),(n,e)=>n.isEqual(e))}const $3=new jt(re.comparator),B3=new bt(re.comparator);function He(...n){let e=B3;for(const t of n)e=e.add(t);return e}const z3=new bt(je);function $w(){return z3}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Bw(n,e){if(n.useProto3Json){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:Vd(e)?"-0":e}}function VN(n){return{integerValue:""+n}}function FN(n,e){return eN(e)?VN(e):Bw(n,e)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class fm{constructor(){this._=void 0}}function q3(n,e,t){return n instanceof Tc?function(s,i){const o={fields:{[gN]:{stringValue:pN},[yN]:{timestampValue:{seconds:s.seconds,nanos:s.nanoseconds}}}};return i&&um(i)&&(i=dm(i)),i&&(o.fields[mN]=i),{mapValue:o}}(t,e):n instanceof Ma?$N(n,e):n instanceof ja?BN(n,e):function(s,i){const o=UN(s,i),a=tT(o)+tT(s.Ae);return Ev(o)&&Ev(s.Ae)?VN(a):Bw(s.serializer,a)}(n,e)}function W3(n,e,t){return n instanceof Ma?$N(n,e):n instanceof ja?BN(n,e):t}function UN(n,e){return n instanceof bc?function(r){return Ev(r)||function(i){return!!i&&"doubleValue"in i}(r)}(e)?e:{integerValue:0}:null}class Tc extends fm{}class Ma extends fm{constructor(e){super(),this.elements=e}}function $N(n,e){const t=zN(e);for(const r of n.elements)t.some(s=>ei(s,r))||t.push(r);return{arrayValue:{values:t}}}class ja extends fm{constructor(e){super(),this.elements=e}}function BN(n,e){let t=zN(e);for(const r of n.elements)t=t.filter(s=>!ei(s,r));return{arrayValue:{values:t}}}class bc extends fm{constructor(e,t){super(),this.serializer=e,this.Ae=t}}function tT(n){return Gt(n.integerValue||n.doubleValue)}function zN(n){return Wd(n)&&n.arrayValue.values?n.arrayValue.values.slice():[]}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class bh{constructor(e,t){this.field=e,this.transform=t}}function G3(n,e){return n.field.isEqual(e.field)&&function(r,s){return r instanceof Ma&&s instanceof Ma||r instanceof ja&&s instanceof ja?pc(r.elements,s.elements,ei):r instanceof bc&&s instanceof bc?ei(r.Ae,s.Ae):r instanceof Tc&&s instanceof Tc}(n.transform,e.transform)}class H3{constructor(e,t){this.version=e,this.transformResults=t}}class Jt{constructor(e,t){this.updateTime=e,this.exists=t}static none(){return new Jt}static exists(e){return new Jt(void 0,e)}static updateTime(e){return new Jt(e)}get isNone(){return this.updateTime===void 0&&this.exists===void 0}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}}function Zf(n,e){return n.updateTime!==void 0?e.isFoundDocument()&&e.version.isEqual(n.updateTime):n.exists===void 0||n.exists===e.isFoundDocument()}class pm{}function qN(n,e){if(!n.hasLocalMutations||e&&e.fields.length===0)return null;if(e===null)return n.isNoDocument()?new Wc(n.key,Jt.none()):new qc(n.key,n.data,Jt.none());{const t=n.data,r=Hn.empty();let s=new bt(Yt.comparator);for(let i of e.fields)if(!s.has(i)){let o=t.field(i);o===null&&i.length>1&&(i=i.popLast(),o=t.field(i)),o===null?r.delete(i):r.set(i,o),s=s.add(i)}return new Oi(n.key,r,new Sr(s.toArray()),Jt.none())}}function Q3(n,e,t){n instanceof qc?function(s,i,o){const a=s.value.clone(),l=rT(s.fieldTransforms,i,o.transformResults);a.setAll(l),i.convertToFoundDocument(o.version,a).setHasCommittedMutations()}(n,e,t):n instanceof Oi?function(s,i,o){if(!Zf(s.precondition,i))return void i.convertToUnknownDocument(o.version);const a=rT(s.fieldTransforms,i,o.transformResults),l=i.data;l.setAll(WN(s)),l.setAll(a),i.convertToFoundDocument(o.version,l).setHasCommittedMutations()}(n,e,t):function(s,i,o){i.convertToNoDocument(o.version).setHasCommittedMutations()}(0,e,t)}function rd(n,e,t,r){return n instanceof qc?function(i,o,a,l){if(!Zf(i.precondition,o))return a;const u=i.value.clone(),h=sT(i.fieldTransforms,l,o);return u.setAll(h),o.convertToFoundDocument(o.version,u).setHasLocalMutations(),null}(n,e,t,r):n instanceof Oi?function(i,o,a,l){if(!Zf(i.precondition,o))return a;const u=sT(i.fieldTransforms,l,o),h=o.data;return h.setAll(WN(i)),h.setAll(u),o.convertToFoundDocument(o.version,h).setHasLocalMutations(),a===null?null:a.unionWith(i.fieldMask.fields).unionWith(i.fieldTransforms.map(f=>f.field))}(n,e,t,r):function(i,o,a){return Zf(i.precondition,o)?(o.convertToNoDocument(o.version).setHasLocalMutations(),null):a}(n,e,t)}function K3(n,e){let t=null;for(const r of n.fieldTransforms){const s=e.data.field(r.field),i=UN(r.transform,s||null);i!=null&&(t===null&&(t=Hn.empty()),t.set(r.field,i))}return t||null}function nT(n,e){return n.type===e.type&&!!n.key.isEqual(e.key)&&!!n.precondition.isEqual(e.precondition)&&!!function(r,s){return r===void 0&&s===void 0||!(!r||!s)&&pc(r,s,(i,o)=>G3(i,o))}(n.fieldTransforms,e.fieldTransforms)&&(n.type===0?n.value.isEqual(e.value):n.type!==1||n.data.isEqual(e.data)&&n.fieldMask.isEqual(e.fieldMask))}class qc extends pm{constructor(e,t,r,s=[]){super(),this.key=e,this.value=t,this.precondition=r,this.fieldTransforms=s,this.type=0}getFieldMask(){return null}}class Oi extends pm{constructor(e,t,r,s,i=[]){super(),this.key=e,this.data=t,this.fieldMask=r,this.precondition=s,this.fieldTransforms=i,this.type=1}getFieldMask(){return this.fieldMask}}function WN(n){const e=new Map;return n.fieldMask.fields.forEach(t=>{if(!t.isEmpty()){const r=n.data.field(t);e.set(t,r)}}),e}function rT(n,e,t){const r=new Map;_e(n.length===t.length,32656,{Re:t.length,Ve:n.length});for(let s=0;s<t.length;s++){const i=n[s],o=i.transform,a=e.data.field(i.field);r.set(i.field,W3(o,a,t[s]))}return r}function sT(n,e,t){const r=new Map;for(const s of n){const i=s.transform,o=t.data.field(s.field);r.set(s.field,q3(i,o,e))}return r}class Wc extends pm{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class zw extends pm{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class qw{constructor(e,t,r,s){this.batchId=e,this.localWriteTime=t,this.baseMutations=r,this.mutations=s}applyToRemoteDocument(e,t){const r=t.mutationResults;for(let s=0;s<this.mutations.length;s++){const i=this.mutations[s];i.key.isEqual(e.key)&&Q3(i,e,r[s])}}applyToLocalView(e,t){for(const r of this.baseMutations)r.key.isEqual(e.key)&&(t=rd(r,e,t,this.localWriteTime));for(const r of this.mutations)r.key.isEqual(e.key)&&(t=rd(r,e,t,this.localWriteTime));return t}applyToLocalDocumentSet(e,t){const r=jN();return this.mutations.forEach(s=>{const i=e.get(s.key),o=i.overlayedDocument;let a=this.applyToLocalView(o,i.mutatedFields);a=t.has(s.key)?null:a;const l=qN(o,a);l!==null&&r.set(s.key,l),o.isValidDocument()||o.convertToNoDocument(Ie.min())}),r}keys(){return this.mutations.reduce((e,t)=>e.add(t.key),He())}isEqual(e){return this.batchId===e.batchId&&pc(this.mutations,e.mutations,(t,r)=>nT(t,r))&&pc(this.baseMutations,e.baseMutations,(t,r)=>nT(t,r))}}class Ww{constructor(e,t,r,s){this.batch=e,this.commitVersion=t,this.mutationResults=r,this.docVersions=s}static from(e,t,r){_e(e.mutations.length===r.length,58842,{me:e.mutations.length,fe:r.length});let s=function(){return $3}();const i=e.mutations;for(let o=0;o<i.length;o++)s=s.insert(i[o].key,r[o].version);return new Ww(e,t,r,s)}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Gw{constructor(e,t){this.largestBatchId=e,this.mutation=t}getKey(){return this.mutation.key}isEqual(e){return e!==null&&this.mutation===e.mutation}toString(){return`Overlay{
      largestBatchId: ${this.largestBatchId},
      mutation: ${this.mutation.toString()}
    }`}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class GN{constructor(e,t,r){this.alias=e,this.aggregateType=t,this.fieldPath=r}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Y3{constructor(e,t){this.count=e,this.unchangedNames=t}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var _n,lt;function HN(n){switch(n){case F.OK:return fe(64938);case F.CANCELLED:case F.UNKNOWN:case F.DEADLINE_EXCEEDED:case F.RESOURCE_EXHAUSTED:case F.INTERNAL:case F.UNAVAILABLE:case F.UNAUTHENTICATED:return!1;case F.INVALID_ARGUMENT:case F.NOT_FOUND:case F.ALREADY_EXISTS:case F.PERMISSION_DENIED:case F.FAILED_PRECONDITION:case F.ABORTED:case F.OUT_OF_RANGE:case F.UNIMPLEMENTED:case F.DATA_LOSS:return!0;default:return fe(15467,{code:n})}}function QN(n){if(n===void 0)return pn("GRPC error has no .code"),F.UNKNOWN;switch(n){case _n.OK:return F.OK;case _n.CANCELLED:return F.CANCELLED;case _n.UNKNOWN:return F.UNKNOWN;case _n.DEADLINE_EXCEEDED:return F.DEADLINE_EXCEEDED;case _n.RESOURCE_EXHAUSTED:return F.RESOURCE_EXHAUSTED;case _n.INTERNAL:return F.INTERNAL;case _n.UNAVAILABLE:return F.UNAVAILABLE;case _n.UNAUTHENTICATED:return F.UNAUTHENTICATED;case _n.INVALID_ARGUMENT:return F.INVALID_ARGUMENT;case _n.NOT_FOUND:return F.NOT_FOUND;case _n.ALREADY_EXISTS:return F.ALREADY_EXISTS;case _n.PERMISSION_DENIED:return F.PERMISSION_DENIED;case _n.FAILED_PRECONDITION:return F.FAILED_PRECONDITION;case _n.ABORTED:return F.ABORTED;case _n.OUT_OF_RANGE:return F.OUT_OF_RANGE;case _n.UNIMPLEMENTED:return F.UNIMPLEMENTED;case _n.DATA_LOSS:return F.DATA_LOSS;default:return fe(39323,{code:n})}}(lt=_n||(_n={}))[lt.OK=0]="OK",lt[lt.CANCELLED=1]="CANCELLED",lt[lt.UNKNOWN=2]="UNKNOWN",lt[lt.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",lt[lt.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",lt[lt.NOT_FOUND=5]="NOT_FOUND",lt[lt.ALREADY_EXISTS=6]="ALREADY_EXISTS",lt[lt.PERMISSION_DENIED=7]="PERMISSION_DENIED",lt[lt.UNAUTHENTICATED=16]="UNAUTHENTICATED",lt[lt.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",lt[lt.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",lt[lt.ABORTED=10]="ABORTED",lt[lt.OUT_OF_RANGE=11]="OUT_OF_RANGE",lt[lt.UNIMPLEMENTED=12]="UNIMPLEMENTED",lt[lt.INTERNAL=13]="INTERNAL",lt[lt.UNAVAILABLE=14]="UNAVAILABLE",lt[lt.DATA_LOSS=15]="DATA_LOSS";/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let sd=null;/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function KN(){return new TextEncoder}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const J3=new wo([4294967295,4294967295],0);function iT(n){const e=KN().encode(n),t=new VR;return t.update(e),new Uint8Array(t.digest())}function oT(n){const e=new DataView(n.buffer),t=e.getUint32(0,!0),r=e.getUint32(4,!0),s=e.getUint32(8,!0),i=e.getUint32(12,!0);return[new wo([t,r],0),new wo([s,i],0)]}class Hw{constructor(e,t,r){if(this.bitmap=e,this.padding=t,this.hashCount=r,t<0||t>=8)throw new Ou(`Invalid padding: ${t}`);if(r<0)throw new Ou(`Invalid hash count: ${r}`);if(e.length>0&&this.hashCount===0)throw new Ou(`Invalid hash count: ${r}`);if(e.length===0&&t!==0)throw new Ou(`Invalid padding when bitmap length is 0: ${t}`);this.ge=8*e.length-t,this.pe=wo.fromNumber(this.ge)}ye(e,t,r){let s=e.add(t.multiply(wo.fromNumber(r)));return s.compare(J3)===1&&(s=new wo([s.getBits(0),s.getBits(1)],0)),s.modulo(this.pe).toNumber()}we(e){return!!(this.bitmap[Math.floor(e/8)]&1<<e%8)}mightContain(e){if(this.ge===0)return!1;const t=iT(e),[r,s]=oT(t);for(let i=0;i<this.hashCount;i++){const o=this.ye(r,s,i);if(!this.we(o))return!1}return!0}static create(e,t,r){const s=e%8==0?0:8-e%8,i=new Uint8Array(Math.ceil(e/8)),o=new Hw(i,s,t);return r.forEach(a=>o.insert(a)),o}insert(e){if(this.ge===0)return;const t=iT(e),[r,s]=oT(t);for(let i=0;i<this.hashCount;i++){const o=this.ye(r,s,i);this.Se(o)}}Se(e){const t=Math.floor(e/8),r=e%8;this.bitmap[t]|=1<<r}}class Ou extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ah{constructor(e,t,r,s,i){this.snapshotVersion=e,this.targetChanges=t,this.targetMismatches=r,this.documentUpdates=s,this.resolvedLimboDocuments=i}static createSynthesizedRemoteEventForCurrentChange(e,t,r){const s=new Map;return s.set(e,Ch.createSynthesizedTargetChangeForCurrentChange(e,t,r)),new Ah(Ie.min(),s,new jt(je),Er(),He())}}class Ch{constructor(e,t,r,s,i){this.resumeToken=e,this.current=t,this.addedDocuments=r,this.modifiedDocuments=s,this.removedDocuments=i}static createSynthesizedTargetChangeForCurrentChange(e,t,r){return new Ch(r,t,He(),He(),He())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ep{constructor(e,t,r,s){this.be=e,this.removedTargetIds=t,this.key=r,this.De=s}}class YN{constructor(e,t){this.targetId=e,this.Ce=t}}class JN{constructor(e,t,r=ln.EMPTY_BYTE_STRING,s=null){this.state=e,this.targetIds=t,this.resumeToken=r,this.cause=s}}class aT{constructor(){this.ve=0,this.Fe=lT(),this.Me=ln.EMPTY_BYTE_STRING,this.xe=!1,this.Oe=!0}get current(){return this.xe}get resumeToken(){return this.Me}get Ne(){return this.ve!==0}get Be(){return this.Oe}Le(e){e.approximateByteSize()>0&&(this.Oe=!0,this.Me=e)}ke(){let e=He(),t=He(),r=He();return this.Fe.forEach((s,i)=>{switch(i){case 0:e=e.add(s);break;case 2:t=t.add(s);break;case 1:r=r.add(s);break;default:fe(38017,{changeType:i})}}),new Ch(this.Me,this.xe,e,t,r)}qe(){this.Oe=!1,this.Fe=lT()}Qe(e,t){this.Oe=!0,this.Fe=this.Fe.insert(e,t)}$e(e){this.Oe=!0,this.Fe=this.Fe.remove(e)}Ue(){this.ve+=1}Ke(){this.ve-=1,_e(this.ve>=0,3241,{ve:this.ve})}We(){this.Oe=!0,this.xe=!0}}class X3{constructor(e){this.Ge=e,this.ze=new Map,this.je=Er(),this.Je=xf(),this.He=xf(),this.Ye=new jt(je)}Ze(e){for(const t of e.be)e.De&&e.De.isFoundDocument()?this.Xe(t,e.De):this.et(t,e.key,e.De);for(const t of e.removedTargetIds)this.et(t,e.key,e.De)}tt(e){this.forEachTarget(e,t=>{const r=this.nt(t);switch(e.state){case 0:this.rt(t)&&r.Le(e.resumeToken);break;case 1:r.Ke(),r.Ne||r.qe(),r.Le(e.resumeToken);break;case 2:r.Ke(),r.Ne||this.removeTarget(t);break;case 3:this.rt(t)&&(r.We(),r.Le(e.resumeToken));break;case 4:this.rt(t)&&(this.it(t),r.Le(e.resumeToken));break;default:fe(56790,{state:e.state})}})}forEachTarget(e,t){e.targetIds.length>0?e.targetIds.forEach(t):this.ze.forEach((r,s)=>{this.rt(s)&&t(s)})}st(e){const t=e.targetId,r=e.Ce.count,s=this.ot(t);if(s){const i=s.target;if(ng(i))if(r===0){const o=new re(i.path);this.et(t,o,Ut.newNoDocument(o,Ie.min()))}else _e(r===1,20013,{expectedCount:r});else{const o=this._t(t);if(o!==r){const a=this.ut(e),l=a?this.ct(a,e,o):1;if(l!==0){this.it(t);const u=l===2?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.Ye=this.Ye.insert(t,u)}sd==null||sd.lt(function(h,f,p,y,w){var E,x,N;const S={localCacheCount:h,existenceFilterCount:f.count,databaseId:p.database,projectId:p.projectId},k=f.unchangedNames;return k&&(S.bloomFilter={applied:w===0,hashCount:(k==null?void 0:k.hashCount)??0,bitmapLength:((x=(E=k==null?void 0:k.bits)==null?void 0:E.bitmap)==null?void 0:x.length)??0,padding:((N=k==null?void 0:k.bits)==null?void 0:N.padding)??0,mightContain:P=>(y==null?void 0:y.mightContain(P))??!1}),S}(o,e.Ce,this.Ge.ht(),a,l))}}}}ut(e){const t=e.Ce.unchangedNames;if(!t||!t.bits)return null;const{bits:{bitmap:r="",padding:s=0},hashCount:i=0}=t;let o,a;try{o=bi(r).toUint8Array()}catch(l){if(l instanceof fN)return as("Decoding the base64 bloom filter in existence filter failed ("+l.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw l}try{a=new Hw(o,s,i)}catch(l){return as(l instanceof Ou?"BloomFilter error: ":"Applying bloom filter failed: ",l),null}return a.ge===0?null:a}ct(e,t,r){return t.Ce.count===r-this.Pt(e,t.targetId)?0:2}Pt(e,t){const r=this.Ge.getRemoteKeysForTarget(t);let s=0;return r.forEach(i=>{const o=this.Ge.ht(),a=`projects/${o.projectId}/databases/${o.database}/documents/${i.path.canonicalString()}`;e.mightContain(a)||(this.et(t,i,null),s++)}),s}Tt(e){const t=new Map;this.ze.forEach((i,o)=>{const a=this.ot(o);if(a){if(i.current&&ng(a.target)){const l=new re(a.target.path);this.It(l).has(o)||this.Et(o,l)||this.et(o,l,Ut.newNoDocument(l,e))}i.Be&&(t.set(o,i.ke()),i.qe())}});let r=He();this.He.forEach((i,o)=>{let a=!0;o.forEachWhile(l=>{const u=this.ot(l);return!u||u.purpose==="TargetPurposeLimboResolution"||(a=!1,!1)}),a&&(r=r.add(i))}),this.je.forEach((i,o)=>o.setReadTime(e));const s=new Ah(e,t,this.Ye,this.je,r);return this.je=Er(),this.Je=xf(),this.He=xf(),this.Ye=new jt(je),s}Xe(e,t){if(!this.rt(e))return;const r=this.Et(e,t.key)?2:0;this.nt(e).Qe(t.key,r),this.je=this.je.insert(t.key,t),this.Je=this.Je.insert(t.key,this.It(t.key).add(e)),this.He=this.He.insert(t.key,this.dt(t.key).add(e))}et(e,t,r){if(!this.rt(e))return;const s=this.nt(e);this.Et(e,t)?s.Qe(t,1):s.$e(t),this.He=this.He.insert(t,this.dt(t).delete(e)),this.He=this.He.insert(t,this.dt(t).add(e)),r&&(this.je=this.je.insert(t,r))}removeTarget(e){this.ze.delete(e)}_t(e){const t=this.nt(e).ke();return this.Ge.getRemoteKeysForTarget(e).size+t.addedDocuments.size-t.removedDocuments.size}Ue(e){this.nt(e).Ue()}nt(e){let t=this.ze.get(e);return t||(t=new aT,this.ze.set(e,t)),t}dt(e){let t=this.He.get(e);return t||(t=new bt(je),this.He=this.He.insert(e,t)),t}It(e){let t=this.Je.get(e);return t||(t=new bt(je),this.Je=this.Je.insert(e,t)),t}rt(e){const t=this.ot(e)!==null;return t||Y("WatchChangeAggregator","Detected inactive target",e),t}ot(e){const t=this.ze.get(e);return t&&t.Ne?null:this.Ge.At(e)}it(e){this.ze.set(e,new aT),this.Ge.getRemoteKeysForTarget(e).forEach(t=>{this.et(e,t,null)})}Et(e,t){return this.Ge.getRemoteKeysForTarget(e).has(t)}}function xf(){return new jt(re.comparator)}function lT(){return new jt(re.comparator)}const Z3=(()=>({asc:"ASCENDING",desc:"DESCENDING"}))(),e6=(()=>({"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"}))(),t6=(()=>({and:"AND",or:"OR"}))();class n6{constructor(e,t){this.databaseId=e,this.useProto3Json=t}}function Rv(n,e){return n.useProto3Json||xh(e)?e:{value:e}}function Ac(n,e){return n.useProto3Json?`${new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+e.nanoseconds).slice(-9)}Z`:{seconds:""+e.seconds,nanos:e.nanoseconds}}function XN(n,e){return n.useProto3Json?e.toBase64():e.toUint8Array()}function r6(n,e){return Ac(n,e.toTimestamp())}function gn(n){return _e(!!n,49232),Ie.fromTimestamp(function(t){const r=Ti(t);return new Ze(r.seconds,r.nanos)}(n))}function Qw(n,e){return Nv(n,e).canonicalString()}function Nv(n,e){const t=function(s){return new rt(["projects",s.projectId,"databases",s.database])}(n).child("documents");return e===void 0?t:t.child(e)}function ZN(n){const e=rt.fromString(n);return _e(lk(e),10190,{key:e.toString()}),e}function Hd(n,e){return Qw(n.databaseId,e.path)}function Ks(n,e){const t=ZN(e);if(t.get(1)!==n.databaseId.projectId)throw new W(F.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+t.get(1)+" vs "+n.databaseId.projectId);if(t.get(3)!==n.databaseId.database)throw new W(F.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+t.get(3)+" vs "+n.databaseId.database);return new re(nk(t))}function ek(n,e){return Qw(n.databaseId,e)}function tk(n){const e=ZN(n);return e.length===4?rt.emptyPath():nk(e)}function kv(n){return new rt(["projects",n.databaseId.projectId,"databases",n.databaseId.database]).canonicalString()}function nk(n){return _e(n.length>4&&n.get(4)==="documents",29091,{key:n.toString()}),n.popFirst(5)}function cT(n,e,t){return{name:Hd(n,e),fields:t.value.mapValue.fields}}function gm(n,e,t){const r=Ks(n,e.name),s=gn(e.updateTime),i=e.createTime?gn(e.createTime):Ie.min(),o=new Hn({mapValue:{fields:e.fields}}),a=Ut.newFoundDocument(r,s,i,o);return t&&a.setHasCommittedMutations(),t?a.setHasCommittedMutations():a}function s6(n,e){return"found"in e?function(r,s){_e(!!s.found,43571),s.found.name,s.found.updateTime;const i=Ks(r,s.found.name),o=gn(s.found.updateTime),a=s.found.createTime?gn(s.found.createTime):Ie.min(),l=new Hn({mapValue:{fields:s.found.fields}});return Ut.newFoundDocument(i,o,a,l)}(n,e):"missing"in e?function(r,s){_e(!!s.missing,3894),_e(!!s.readTime,22933);const i=Ks(r,s.missing),o=gn(s.readTime);return Ut.newNoDocument(i,o)}(n,e):fe(7234,{result:e})}function i6(n,e){let t;if("targetChange"in e){e.targetChange;const r=function(u){return u==="NO_CHANGE"?0:u==="ADD"?1:u==="REMOVE"?2:u==="CURRENT"?3:u==="RESET"?4:fe(39313,{state:u})}(e.targetChange.targetChangeType||"NO_CHANGE"),s=e.targetChange.targetIds||[],i=function(u,h){return u.useProto3Json?(_e(h===void 0||typeof h=="string",58123),ln.fromBase64String(h||"")):(_e(h===void 0||h instanceof Buffer||h instanceof Uint8Array,16193),ln.fromUint8Array(h||new Uint8Array))}(n,e.targetChange.resumeToken),o=e.targetChange.cause,a=o&&function(u){const h=u.code===void 0?F.UNKNOWN:QN(u.code);return new W(h,u.message||"")}(o);t=new JN(r,s,i,a||null)}else if("documentChange"in e){e.documentChange;const r=e.documentChange;r.document,r.document.name,r.document.updateTime;const s=Ks(n,r.document.name),i=gn(r.document.updateTime),o=r.document.createTime?gn(r.document.createTime):Ie.min(),a=new Hn({mapValue:{fields:r.document.fields}}),l=Ut.newFoundDocument(s,i,o,a),u=r.targetIds||[],h=r.removedTargetIds||[];t=new ep(u,h,l.key,l)}else if("documentDelete"in e){e.documentDelete;const r=e.documentDelete;r.document;const s=Ks(n,r.document),i=r.readTime?gn(r.readTime):Ie.min(),o=Ut.newNoDocument(s,i),a=r.removedTargetIds||[];t=new ep([],a,o.key,o)}else if("documentRemove"in e){e.documentRemove;const r=e.documentRemove;r.document;const s=Ks(n,r.document),i=r.removedTargetIds||[];t=new ep([],i,s,null)}else{if(!("filter"in e))return fe(11601,{Rt:e});{e.filter;const r=e.filter;r.targetId;const{count:s=0,unchangedNames:i}=r,o=new Y3(s,i),a=r.targetId;t=new YN(a,o)}}return t}function Qd(n,e){let t;if(e instanceof qc)t={update:cT(n,e.key,e.value)};else if(e instanceof Wc)t={delete:Hd(n,e.key)};else if(e instanceof Oi)t={update:cT(n,e.key,e.data),updateMask:d6(e.fieldMask)};else{if(!(e instanceof zw))return fe(16599,{Vt:e.type});t={verify:Hd(n,e.key)}}return e.fieldTransforms.length>0&&(t.updateTransforms=e.fieldTransforms.map(r=>function(i,o){const a=o.transform;if(a instanceof Tc)return{fieldPath:o.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(a instanceof Ma)return{fieldPath:o.field.canonicalString(),appendMissingElements:{values:a.elements}};if(a instanceof ja)return{fieldPath:o.field.canonicalString(),removeAllFromArray:{values:a.elements}};if(a instanceof bc)return{fieldPath:o.field.canonicalString(),increment:a.Ae};throw fe(20930,{transform:o.transform})}(0,r))),e.precondition.isNone||(t.currentDocument=function(s,i){return i.updateTime!==void 0?{updateTime:r6(s,i.updateTime)}:i.exists!==void 0?{exists:i.exists}:fe(27497)}(n,e.precondition)),t}function Pv(n,e){const t=e.currentDocument?function(i){return i.updateTime!==void 0?Jt.updateTime(gn(i.updateTime)):i.exists!==void 0?Jt.exists(i.exists):Jt.none()}(e.currentDocument):Jt.none(),r=e.updateTransforms?e.updateTransforms.map(s=>function(o,a){let l=null;if("setToServerValue"in a)_e(a.setToServerValue==="REQUEST_TIME",16630,{proto:a}),l=new Tc;else if("appendMissingElements"in a){const h=a.appendMissingElements.values||[];l=new Ma(h)}else if("removeAllFromArray"in a){const h=a.removeAllFromArray.values||[];l=new ja(h)}else"increment"in a?l=new bc(o,a.increment):fe(16584,{proto:a});const u=Yt.fromServerFormat(a.fieldPath);return new bh(u,l)}(n,s)):[];if(e.update){e.update.name;const s=Ks(n,e.update.name),i=new Hn({mapValue:{fields:e.update.fields}});if(e.updateMask){const o=function(l){const u=l.fieldPaths||[];return new Sr(u.map(h=>Yt.fromServerFormat(h)))}(e.updateMask);return new Oi(s,i,o,t,r)}return new qc(s,i,t,r)}if(e.delete){const s=Ks(n,e.delete);return new Wc(s,t)}if(e.verify){const s=Ks(n,e.verify);return new zw(s,t)}return fe(1463,{proto:e})}function o6(n,e){return n&&n.length>0?(_e(e!==void 0,14353),n.map(t=>function(s,i){let o=s.updateTime?gn(s.updateTime):gn(i);return o.isEqual(Ie.min())&&(o=gn(i)),new H3(o,s.transformResults||[])}(t,e))):[]}function rk(n,e){return{documents:[ek(n,e.path)]}}function mm(n,e){const t={structuredQuery:{}},r=e.path;let s;e.collectionGroup!==null?(s=r,t.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(s=r.popLast(),t.structuredQuery.from=[{collectionId:r.lastSegment()}]),t.parent=ek(n,s);const i=function(u){if(u.length!==0)return ak(Et.create(u,"and"))}(e.filters);i&&(t.structuredQuery.where=i);const o=function(u){if(u.length!==0)return u.map(h=>function(p){return{field:Yi(p.field),direction:l6(p.dir)}}(h))}(e.orderBy);o&&(t.structuredQuery.orderBy=o);const a=Rv(n,e.limit);return a!==null&&(t.structuredQuery.limit=a),e.startAt&&(t.structuredQuery.startAt=function(u){return{before:u.inclusive,values:u.position}}(e.startAt)),e.endAt&&(t.structuredQuery.endAt=function(u){return{before:!u.inclusive,values:u.position}}(e.endAt)),{ft:t,parent:s}}function sk(n,e,t,r){const{ft:s,parent:i}=mm(n,e),o={},a=[];let l=0;return t.forEach(u=>{const h=r?u.alias:"aggregate_"+l++;o[h]=u.alias,u.aggregateType==="count"?a.push({alias:h,count:{}}):u.aggregateType==="avg"?a.push({alias:h,avg:{field:Yi(u.fieldPath)}}):u.aggregateType==="sum"&&a.push({alias:h,sum:{field:Yi(u.fieldPath)}})}),{request:{structuredAggregationQuery:{aggregations:a,structuredQuery:s.structuredQuery},parent:s.parent},gt:o,parent:i}}function ik(n){let e=tk(n.parent);const t=n.structuredQuery,r=t.from?t.from.length:0;let s=null;if(r>0){_e(r===1,65062);const h=t.from[0];h.allDescendants?s=h.collectionId:e=e.child(h.collectionId)}let i=[];t.where&&(i=function(f){const p=ok(f);return p instanceof Et&&Fw(p)?p.getFilters():[p]}(t.where));let o=[];t.orderBy&&(o=function(f){return f.map(p=>function(w){return new Gd(El(w.field),function(k){switch(k){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(w.direction))}(p))}(t.orderBy));let a=null;t.limit&&(a=function(f){let p;return p=typeof f=="object"?f.value:f,xh(p)?null:p}(t.limit));let l=null;t.startAt&&(l=function(f){const p=!!f.before,y=f.values||[];return new Do(y,p)}(t.startAt));let u=null;return t.endAt&&(u=function(f){const p=!f.before,y=f.values||[];return new Do(y,p)}(t.endAt)),RN(e,s,o,i,a,"F",l,u)}function a6(n,e){const t=function(s){switch(s){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return fe(28987,{purpose:s})}}(e.purpose);return t==null?null:{"goog-listen-tags":t}}function ok(n){return n.unaryFilter!==void 0?function(t){switch(t.unaryFilter.op){case"IS_NAN":const r=El(t.unaryFilter.field);return at.create(r,"==",{doubleValue:NaN});case"IS_NULL":const s=El(t.unaryFilter.field);return at.create(s,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const i=El(t.unaryFilter.field);return at.create(i,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const o=El(t.unaryFilter.field);return at.create(o,"!=",{nullValue:"NULL_VALUE"});case"OPERATOR_UNSPECIFIED":return fe(61313);default:return fe(60726)}}(n):n.fieldFilter!==void 0?function(t){return at.create(El(t.fieldFilter.field),function(s){switch(s){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";case"OPERATOR_UNSPECIFIED":return fe(58110);default:return fe(50506)}}(t.fieldFilter.op),t.fieldFilter.value)}(n):n.compositeFilter!==void 0?function(t){return Et.create(t.compositeFilter.filters.map(r=>ok(r)),function(s){switch(s){case"AND":return"and";case"OR":return"or";default:return fe(1026)}}(t.compositeFilter.op))}(n):fe(30097,{filter:n})}function l6(n){return Z3[n]}function c6(n){return e6[n]}function u6(n){return t6[n]}function Yi(n){return{fieldPath:n.canonicalString()}}function El(n){return Yt.fromServerFormat(n.fieldPath)}function ak(n){return n instanceof at?function(t){if(t.op==="=="){if(HE(t.value))return{unaryFilter:{field:Yi(t.field),op:"IS_NAN"}};if(GE(t.value))return{unaryFilter:{field:Yi(t.field),op:"IS_NULL"}}}else if(t.op==="!="){if(HE(t.value))return{unaryFilter:{field:Yi(t.field),op:"IS_NOT_NAN"}};if(GE(t.value))return{unaryFilter:{field:Yi(t.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:Yi(t.field),op:c6(t.op),value:t.value}}}(n):n instanceof Et?function(t){const r=t.getFilters().map(s=>ak(s));return r.length===1?r[0]:{compositeFilter:{op:u6(t.op),filters:r}}}(n):fe(54877,{filter:n})}function d6(n){const e=[];return n.fields.forEach(t=>e.push(t.canonicalString())),{fieldPaths:e}}function lk(n){return n.length>=4&&n.get(0)==="projects"&&n.get(2)==="databases"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class fi{constructor(e,t,r,s,i=Ie.min(),o=Ie.min(),a=ln.EMPTY_BYTE_STRING,l=null){this.target=e,this.targetId=t,this.purpose=r,this.sequenceNumber=s,this.snapshotVersion=i,this.lastLimboFreeSnapshotVersion=o,this.resumeToken=a,this.expectedCount=l}withSequenceNumber(e){return new fi(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(e,t){return new fi(this.target,this.targetId,this.purpose,this.sequenceNumber,t,this.lastLimboFreeSnapshotVersion,e,null)}withExpectedCount(e){return new fi(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,e)}withLastLimboFreeSnapshotVersion(e){return new fi(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken,this.expectedCount)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ck{constructor(e){this.yt=e}}function h6(n,e){let t;if(e.document)t=gm(n.yt,e.document,!!e.hasCommittedMutations);else if(e.noDocument){const r=re.fromSegments(e.noDocument.path),s=Fa(e.noDocument.readTime);t=Ut.newNoDocument(r,s),e.hasCommittedMutations&&t.setHasCommittedMutations()}else{if(!e.unknownDocument)return fe(56709);{const r=re.fromSegments(e.unknownDocument.path),s=Fa(e.unknownDocument.version);t=Ut.newUnknownDocument(r,s)}}return e.readTime&&t.setReadTime(function(s){const i=new Ze(s[0],s[1]);return Ie.fromTimestamp(i)}(e.readTime)),t}function uT(n,e){const t=e.key,r={prefixPath:t.getCollectionPath().popLast().toArray(),collectionGroup:t.collectionGroup,documentId:t.path.lastSegment(),readTime:ig(e.readTime),hasCommittedMutations:e.hasCommittedMutations};if(e.isFoundDocument())r.document=function(i,o){return{name:Hd(i,o.key),fields:o.data.value.mapValue.fields,updateTime:Ac(i,o.version.toTimestamp()),createTime:Ac(i,o.createTime.toTimestamp())}}(n.yt,e);else if(e.isNoDocument())r.noDocument={path:t.path.toArray(),readTime:Va(e.version)};else{if(!e.isUnknownDocument())return fe(57904,{document:e});r.unknownDocument={path:t.path.toArray(),version:Va(e.version)}}return r}function ig(n){const e=n.toTimestamp();return[e.seconds,e.nanoseconds]}function Va(n){const e=n.toTimestamp();return{seconds:e.seconds,nanoseconds:e.nanoseconds}}function Fa(n){const e=new Ze(n.seconds,n.nanoseconds);return Ie.fromTimestamp(e)}function oa(n,e){const t=(e.baseMutations||[]).map(i=>Pv(n.yt,i));for(let i=0;i<e.mutations.length-1;++i){const o=e.mutations[i];if(i+1<e.mutations.length&&e.mutations[i+1].transform!==void 0){const a=e.mutations[i+1];o.updateTransforms=a.transform.fieldTransforms,e.mutations.splice(i+1,1),++i}}const r=e.mutations.map(i=>Pv(n.yt,i)),s=Ze.fromMillis(e.localWriteTimeMs);return new qw(e.batchId,s,t,r)}function Lu(n){const e=Fa(n.readTime),t=n.lastLimboFreeSnapshotVersion!==void 0?Fa(n.lastLimboFreeSnapshotVersion):Ie.min();let r;return r=function(i){return i.documents!==void 0}(n.query)?function(i){const o=i.documents.length;return _e(o===1,1966,{count:o}),lr(zc(tk(i.documents[0])))}(n.query):function(i){return lr(ik(i))}(n.query),new fi(r,n.targetId,"TargetPurposeListen",n.lastListenSequenceNumber,e,t,ln.fromBase64String(n.resumeToken))}function uk(n,e){const t=Va(e.snapshotVersion),r=Va(e.lastLimboFreeSnapshotVersion);let s;s=ng(e.target)?rk(n.yt,e.target):mm(n.yt,e.target).ft;const i=e.resumeToken.toBase64();return{targetId:e.targetId,canonicalId:La(e.target),readTime:t,resumeToken:i,lastListenSequenceNumber:e.sequenceNumber,lastLimboFreeSnapshotVersion:r,query:s}}function ym(n){const e=ik({parent:n.parent,structuredQuery:n.structuredQuery});return n.limitType==="LAST"?sg(e,e.limit,"L"):e}function Oy(n,e){return new Gw(e.largestBatchId,Pv(n.yt,e.overlayMutation))}function dT(n,e){const t=e.path.lastSegment();return[n,ar(e.path.popLast()),t]}function hT(n,e,t,r){return{indexId:n,uid:e,sequenceNumber:t,readTime:Va(r.readTime),documentKey:ar(r.documentKey.path),largestBatchId:r.largestBatchId}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class f6{getBundleMetadata(e,t){return fT(e).get(t).next(r=>{if(r)return function(i){return{id:i.bundleId,createTime:Fa(i.createTime),version:i.version}}(r)})}saveBundleMetadata(e,t){return fT(e).put(function(s){return{bundleId:s.id,createTime:Va(gn(s.createTime)),version:s.version}}(t))}getNamedQuery(e,t){return pT(e).get(t).next(r=>{if(r)return function(i){return{name:i.name,query:ym(i.bundledQuery),readTime:Fa(i.readTime)}}(r)})}saveNamedQuery(e,t){return pT(e).put(function(s){return{name:s.name,readTime:Va(gn(s.readTime)),bundledQuery:s.bundledQuery}}(t))}}function fT(n){return Rn(n,am)}function pT(n){return Rn(n,lm)}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class _m{constructor(e,t){this.serializer=e,this.userId=t}static wt(e,t){const r=t.uid||"";return new _m(e,r)}getOverlay(e,t){return vu(e).get(dT(this.userId,t)).next(r=>r?Oy(this.serializer,r):null)}getOverlays(e,t){const r=Bs();return V.forEach(t,s=>this.getOverlay(e,s).next(i=>{i!==null&&r.set(s,i)})).next(()=>r)}saveOverlays(e,t,r){const s=[];return r.forEach((i,o)=>{const a=new Gw(t,o);s.push(this.St(e,a))}),V.waitFor(s)}removeOverlaysForBatchId(e,t,r){const s=new Set;t.forEach(o=>s.add(ar(o.getCollectionPath())));const i=[];return s.forEach(o=>{const a=IDBKeyRange.bound([this.userId,o,r],[this.userId,o,r+1],!1,!0);i.push(vu(e).Z(xv,a))}),V.waitFor(i)}getOverlaysForCollection(e,t,r){const s=Bs(),i=ar(t),o=IDBKeyRange.bound([this.userId,i,r],[this.userId,i,Number.POSITIVE_INFINITY],!0);return vu(e).J(xv,o).next(a=>{for(const l of a){const u=Oy(this.serializer,l);s.set(u.getKey(),u)}return s})}getOverlaysForCollectionGroup(e,t,r,s){const i=Bs();let o;const a=IDBKeyRange.bound([this.userId,t,r],[this.userId,t,Number.POSITIVE_INFINITY],!0);return vu(e).ee({index:oN,range:a},(l,u,h)=>{const f=Oy(this.serializer,u);i.size()<s||f.largestBatchId===o?(i.set(f.getKey(),f),o=f.largestBatchId):h.done()}).next(()=>i)}St(e,t){return vu(e).put(function(s,i,o){const[a,l,u]=dT(i,o.mutation.key);return{userId:i,collectionPath:l,documentId:u,collectionGroup:o.mutation.key.getCollectionGroup(),largestBatchId:o.largestBatchId,overlayMutation:Qd(s.yt,o.mutation)}}(this.serializer,this.userId,t))}}function vu(n){return Rn(n,cm)}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class p6{bt(e){return Rn(e,Lw)}getSessionToken(e){return this.bt(e).get("sessionToken").next(t=>{const r=t==null?void 0:t.value;return r?ln.fromUint8Array(r):ln.EMPTY_BYTE_STRING})}setSessionToken(e,t){return this.bt(e).put({name:"sessionToken",value:t.toUint8Array()})}}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class aa{constructor(){}Dt(e,t){this.Ct(e,t),t.vt()}Ct(e,t){if("nullValue"in e)this.Ft(t,5);else if("booleanValue"in e)this.Ft(t,10),t.Mt(e.booleanValue?1:0);else if("integerValue"in e)this.Ft(t,15),t.Mt(Gt(e.integerValue));else if("doubleValue"in e){const r=Gt(e.doubleValue);isNaN(r)?this.Ft(t,13):(this.Ft(t,15),Vd(r)?t.Mt(0):t.Mt(r))}else if("timestampValue"in e){let r=e.timestampValue;this.Ft(t,20),typeof r=="string"&&(r=Ti(r)),t.xt(`${r.seconds||""}`),t.Mt(r.nanos||0)}else if("stringValue"in e)this.Ot(e.stringValue,t),this.Nt(t);else if("bytesValue"in e)this.Ft(t,30),t.Bt(bi(e.bytesValue)),this.Nt(t);else if("referenceValue"in e)this.Lt(e.referenceValue,t);else if("geoPointValue"in e){const r=e.geoPointValue;this.Ft(t,45),t.Mt(r.latitude||0),t.Mt(r.longitude||0)}else"mapValue"in e?vN(e)?this.Ft(t,Number.MAX_SAFE_INTEGER):hm(e)?this.kt(e.mapValue,t):(this.qt(e.mapValue,t),this.Nt(t)):"arrayValue"in e?(this.Qt(e.arrayValue,t),this.Nt(t)):fe(19022,{$t:e})}Ot(e,t){this.Ft(t,25),this.Ut(e,t)}Ut(e,t){t.xt(e)}qt(e,t){const r=e.fields||{};this.Ft(t,55);for(const s of Object.keys(r))this.Ot(s,t),this.Ct(r[s],t)}kt(e,t){var o,a;const r=e.fields||{};this.Ft(t,53);const s=Ic,i=((a=(o=r[s].arrayValue)==null?void 0:o.values)==null?void 0:a.length)||0;this.Ft(t,15),t.Mt(Gt(i)),this.Ot(s,t),this.Ct(r[s],t)}Qt(e,t){const r=e.values||[];this.Ft(t,50);for(const s of r)this.Ct(s,t)}Lt(e,t){this.Ft(t,37),re.fromName(e).path.forEach(r=>{this.Ft(t,60),this.Ut(r,t)})}Ft(e,t){e.Mt(t)}Nt(e){e.Mt(2)}}aa.Kt=new aa;/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law | agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES | CONDITIONS OF ANY KIND, either express | implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const _l=255;function g6(n){if(n===0)return 8;let e=0;return n>>4||(e+=4,n<<=4),n>>6||(e+=2,n<<=2),n>>7||(e+=1),e}function gT(n){const e=64-function(r){let s=0;for(let i=0;i<8;++i){const o=g6(255&r[i]);if(s+=o,o!==8)break}return s}(n);return Math.ceil(e/8)}class m6{constructor(){this.buffer=new Uint8Array(1024),this.position=0}Wt(e){const t=e[Symbol.iterator]();let r=t.next();for(;!r.done;)this.Gt(r.value),r=t.next();this.zt()}jt(e){const t=e[Symbol.iterator]();let r=t.next();for(;!r.done;)this.Jt(r.value),r=t.next();this.Ht()}Yt(e){for(const t of e){const r=t.charCodeAt(0);if(r<128)this.Gt(r);else if(r<2048)this.Gt(960|r>>>6),this.Gt(128|63&r);else if(t<"\uD800"||"\uDBFF"<t)this.Gt(480|r>>>12),this.Gt(128|63&r>>>6),this.Gt(128|63&r);else{const s=t.codePointAt(0);this.Gt(240|s>>>18),this.Gt(128|63&s>>>12),this.Gt(128|63&s>>>6),this.Gt(128|63&s)}}this.zt()}Zt(e){for(const t of e){const r=t.charCodeAt(0);if(r<128)this.Jt(r);else if(r<2048)this.Jt(960|r>>>6),this.Jt(128|63&r);else if(t<"\uD800"||"\uDBFF"<t)this.Jt(480|r>>>12),this.Jt(128|63&r>>>6),this.Jt(128|63&r);else{const s=t.codePointAt(0);this.Jt(240|s>>>18),this.Jt(128|63&s>>>12),this.Jt(128|63&s>>>6),this.Jt(128|63&s)}}this.Ht()}Xt(e){const t=this.en(e),r=gT(t);this.tn(1+r),this.buffer[this.position++]=255&r;for(let s=t.length-r;s<t.length;++s)this.buffer[this.position++]=255&t[s]}nn(e){const t=this.en(e),r=gT(t);this.tn(1+r),this.buffer[this.position++]=~(255&r);for(let s=t.length-r;s<t.length;++s)this.buffer[this.position++]=~(255&t[s])}rn(){this.sn(_l),this.sn(255)}_n(){this.an(_l),this.an(255)}reset(){this.position=0}seed(e){this.tn(e.length),this.buffer.set(e,this.position),this.position+=e.length}un(){return this.buffer.slice(0,this.position)}en(e){const t=function(i){const o=new DataView(new ArrayBuffer(8));return o.setFloat64(0,i,!1),new Uint8Array(o.buffer)}(e),r=!!(128&t[0]);t[0]^=r?255:128;for(let s=1;s<t.length;++s)t[s]^=r?255:0;return t}Gt(e){const t=255&e;t===0?(this.sn(0),this.sn(255)):t===_l?(this.sn(_l),this.sn(0)):this.sn(t)}Jt(e){const t=255&e;t===0?(this.an(0),this.an(255)):t===_l?(this.an(_l),this.an(0)):this.an(e)}zt(){this.sn(0),this.sn(1)}Ht(){this.an(0),this.an(1)}sn(e){this.tn(1),this.buffer[this.position++]=e}an(e){this.tn(1),this.buffer[this.position++]=~e}tn(e){const t=e+this.position;if(t<=this.buffer.length)return;let r=2*this.buffer.length;r<t&&(r=t);const s=new Uint8Array(r);s.set(this.buffer),this.buffer=s}}class y6{constructor(e){this.cn=e}Bt(e){this.cn.Wt(e)}xt(e){this.cn.Yt(e)}Mt(e){this.cn.Xt(e)}vt(){this.cn.rn()}}class _6{constructor(e){this.cn=e}Bt(e){this.cn.jt(e)}xt(e){this.cn.Zt(e)}Mt(e){this.cn.nn(e)}vt(){this.cn._n()}}class wu{constructor(){this.cn=new m6,this.ln=new y6(this.cn),this.hn=new _6(this.cn)}seed(e){this.cn.seed(e)}Pn(e){return e===0?this.ln:this.hn}un(){return this.cn.un()}reset(){this.cn.reset()}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class la{constructor(e,t,r,s){this.Tn=e,this.In=t,this.En=r,this.dn=s}An(){const e=this.dn.length,t=e===0||this.dn[e-1]===255?e+1:e,r=new Uint8Array(t);return r.set(this.dn,0),t!==e?r.set([0],this.dn.length):++r[r.length-1],new la(this.Tn,this.In,this.En,r)}Rn(e,t,r){return{indexId:this.Tn,uid:e,arrayValue:tp(this.En),directionalValue:tp(this.dn),orderedDocumentKey:tp(t),documentKey:r.path.toArray()}}Vn(e,t,r){const s=this.Rn(e,t,r);return[s.indexId,s.uid,s.arrayValue,s.directionalValue,s.orderedDocumentKey,s.documentKey]}}function Bi(n,e){let t=n.Tn-e.Tn;return t!==0?t:(t=mT(n.En,e.En),t!==0?t:(t=mT(n.dn,e.dn),t!==0?t:re.comparator(n.In,e.In)))}function mT(n,e){for(let t=0;t<n.length&&t<e.length;++t){const r=n[t]-e[t];if(r!==0)return r}return n.length-e.length}function tp(n){return c1()?function(t){let r="";for(let s=0;s<t.length;s++)r+=String.fromCharCode(t[s]);return r}(n):n}function yT(n){return typeof n!="string"?n:function(t){const r=new Uint8Array(t.length);for(let s=0;s<t.length;s++)r[s]=t.charCodeAt(s);return r}(n)}class _T{constructor(e){this.mn=new bt((t,r)=>Yt.comparator(t.field,r.field)),this.collectionId=e.collectionGroup!=null?e.collectionGroup:e.path.lastSegment(),this.fn=e.orderBy,this.gn=[];for(const t of e.filters){const r=t;r.isInequality()?this.mn=this.mn.add(r):this.gn.push(r)}}get pn(){return this.mn.size>1}yn(e){if(_e(e.collectionGroup===this.collectionId,49279),this.pn)return!1;const t=_v(e);if(t!==void 0&&!this.wn(t))return!1;const r=ra(e);let s=new Set,i=0,o=0;for(;i<r.length&&this.wn(r[i]);++i)s=s.add(r[i].fieldPath.canonicalString());if(i===r.length)return!0;if(this.mn.size>0){const a=this.mn.getIterator().getNext();if(!s.has(a.field.canonicalString())){const l=r[i];if(!this.Sn(a,l)||!this.bn(this.fn[o++],l))return!1}++i}for(;i<r.length;++i){const a=r[i];if(o>=this.fn.length||!this.bn(this.fn[o++],a))return!1}return!0}Dn(){if(this.pn)return null;let e=new bt(Yt.comparator);const t=[];for(const r of this.gn)if(!r.field.isKeyField())if(r.op==="array-contains"||r.op==="array-contains-any")t.push(new va(r.field,2));else{if(e.has(r.field))continue;e=e.add(r.field),t.push(new va(r.field,0))}for(const r of this.fn)r.field.isKeyField()||e.has(r.field)||(e=e.add(r.field),t.push(new va(r.field,r.dir==="asc"?0:1)));return new mc(mc.UNKNOWN_ID,this.collectionId,t,yc.empty())}wn(e){for(const t of this.gn)if(this.Sn(t,e))return!0;return!1}Sn(e,t){if(e===void 0||!e.field.isEqual(t.fieldPath))return!1;const r=e.op==="array-contains"||e.op==="array-contains-any";return t.kind===2===r}bn(e,t){return!!e.field.isEqual(t.fieldPath)&&(t.kind===0&&e.dir==="asc"||t.kind===1&&e.dir==="desc")}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function dk(n){var t,r;if(_e(n instanceof at||n instanceof Et,20012),n instanceof at){if(n instanceof CN){const s=((r=(t=n.value.arrayValue)==null?void 0:t.values)==null?void 0:r.map(i=>at.create(n.field,"==",i)))||[];return Et.create(s,"or")}return n}const e=n.filters.map(s=>dk(s));return Et.create(e,n.op)}function v6(n){if(n.getFilters().length===0)return[];const e=Lv(dk(n));return _e(hk(e),7391),Dv(e)||Ov(e)?[e]:e.getFilters()}function Dv(n){return n instanceof at}function Ov(n){return n instanceof Et&&Fw(n)}function hk(n){return Dv(n)||Ov(n)||function(t){if(t instanceof Et&&Tv(t)){for(const r of t.getFilters())if(!Dv(r)&&!Ov(r))return!1;return!0}return!1}(n)}function Lv(n){if(_e(n instanceof at||n instanceof Et,34018),n instanceof at)return n;if(n.filters.length===1)return Lv(n.filters[0]);const e=n.filters.map(r=>Lv(r));let t=Et.create(e,n.op);return t=og(t),hk(t)?t:(_e(t instanceof Et,64498),_e(Ec(t),40251),_e(t.filters.length>1,57927),t.filters.reduce((r,s)=>Kw(r,s)))}function Kw(n,e){let t;return _e(n instanceof at||n instanceof Et,38388),_e(e instanceof at||e instanceof Et,25473),t=n instanceof at?e instanceof at?function(s,i){return Et.create([s,i],"and")}(n,e):vT(n,e):e instanceof at?vT(e,n):function(s,i){if(_e(s.filters.length>0&&i.filters.length>0,48005),Ec(s)&&Ec(i))return TN(s,i.getFilters());const o=Tv(s)?s:i,a=Tv(s)?i:s,l=o.filters.map(u=>Kw(u,a));return Et.create(l,"or")}(n,e),og(t)}function vT(n,e){if(Ec(e))return TN(e,n.getFilters());{const t=e.filters.map(r=>Kw(n,r));return Et.create(t,"or")}}function og(n){if(_e(n instanceof at||n instanceof Et,11850),n instanceof at)return n;const e=n.getFilters();if(e.length===1)return og(e[0]);if(SN(n))return n;const t=e.map(s=>og(s)),r=[];return t.forEach(s=>{s instanceof at?r.push(s):s instanceof Et&&(s.op===n.op?r.push(...s.filters):r.push(s))}),r.length===1?r[0]:Et.create(r,n.op)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class w6{constructor(){this.Cn=new Yw}addToCollectionParentIndex(e,t){return this.Cn.add(t),V.resolve()}getCollectionParents(e,t){return V.resolve(this.Cn.getEntries(t))}addFieldIndex(e,t){return V.resolve()}deleteFieldIndex(e,t){return V.resolve()}deleteAllFieldIndexes(e){return V.resolve()}createTargetIndexes(e,t){return V.resolve()}getDocumentsMatchingTarget(e,t){return V.resolve(null)}getIndexType(e,t){return V.resolve(0)}getFieldIndexes(e,t){return V.resolve([])}getNextCollectionGroupToUpdate(e){return V.resolve(null)}getMinOffset(e,t){return V.resolve(Gr.min())}getMinOffsetFromCollectionGroup(e,t){return V.resolve(Gr.min())}updateCollectionGroup(e,t,r){return V.resolve()}updateIndexEntries(e,t){return V.resolve()}}class Yw{constructor(){this.index={}}add(e){const t=e.lastSegment(),r=e.popLast(),s=this.index[t]||new bt(rt.comparator),i=!s.has(r);return this.index[t]=s.add(r),i}has(e){const t=e.lastSegment(),r=e.popLast(),s=this.index[t];return s&&s.has(r)}getEntries(e){return(this.index[e]||new bt(rt.comparator)).toArray()}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const wT="IndexedDbIndexManager",If=new Uint8Array(0);class x6{constructor(e,t){this.databaseId=t,this.vn=new Yw,this.Fn=new Di(r=>La(r),(r,s)=>Sh(r,s)),this.uid=e.uid||""}addToCollectionParentIndex(e,t){if(!this.vn.has(t)){const r=t.lastSegment(),s=t.popLast();e.addOnCommittedListener(()=>{this.vn.add(t)});const i={collectionId:r,parent:ar(s)};return xT(e).put(i)}return V.resolve()}getCollectionParents(e,t){const r=[],s=IDBKeyRange.bound([t,""],[GR(t),""],!1,!0);return xT(e).J(s).next(i=>{for(const o of i){if(o.collectionId!==t)break;r.push($s(o.parent))}return r})}addFieldIndex(e,t){const r=xu(e),s=function(a){return{indexId:a.indexId,collectionGroup:a.collectionGroup,fields:a.fields.map(l=>[l.fieldPath.canonicalString(),l.kind])}}(t);delete s.indexId;const i=r.add(s);if(t.indexState){const o=wl(e);return i.next(a=>{o.put(hT(a,this.uid,t.indexState.sequenceNumber,t.indexState.offset))})}return i.next()}deleteFieldIndex(e,t){const r=xu(e),s=wl(e),i=vl(e);return r.delete(t.indexId).next(()=>s.delete(IDBKeyRange.bound([t.indexId],[t.indexId+1],!1,!0))).next(()=>i.delete(IDBKeyRange.bound([t.indexId],[t.indexId+1],!1,!0)))}deleteAllFieldIndexes(e){const t=xu(e),r=vl(e),s=wl(e);return t.Z().next(()=>r.Z()).next(()=>s.Z())}createTargetIndexes(e,t){return V.forEach(this.Mn(t),r=>this.getIndexType(e,r).next(s=>{if(s===0||s===1){const i=new _T(r).Dn();if(i!=null)return this.addFieldIndex(e,i)}}))}getDocumentsMatchingTarget(e,t){const r=vl(e);let s=!0;const i=new Map;return V.forEach(this.Mn(t),o=>this.xn(e,o).next(a=>{s&&(s=!!a),i.set(o,a)})).next(()=>{if(s){let o=He();const a=[];return V.forEach(i,(l,u)=>{Y(wT,`Using index ${function(N){return`id=${N.indexId}|cg=${N.collectionGroup}|f=${N.fields.map(P=>`${P.fieldPath}:${P.kind}`).join(",")}`}(l)} to execute ${La(t)}`);const h=function(N,P){const $=_v(P);if($===void 0)return null;for(const L of rg(N,$.fieldPath))switch(L.op){case"array-contains-any":return L.value.arrayValue.values||[];case"array-contains":return[L.value]}return null}(u,l),f=function(N,P){const $=new Map;for(const L of ra(P))for(const R of rg(N,L.fieldPath))switch(R.op){case"==":case"in":$.set(L.fieldPath.canonicalString(),R.value);break;case"not-in":case"!=":return $.set(L.fieldPath.canonicalString(),R.value),Array.from($.values())}return null}(u,l),p=function(N,P){const $=[];let L=!0;for(const R of ra(P)){const v=R.kind===0?XE(N,R.fieldPath,N.startAt):ZE(N,R.fieldPath,N.startAt);$.push(v.value),L&&(L=v.inclusive)}return new Do($,L)}(u,l),y=function(N,P){const $=[];let L=!0;for(const R of ra(P)){const v=R.kind===0?ZE(N,R.fieldPath,N.endAt):XE(N,R.fieldPath,N.endAt);$.push(v.value),L&&(L=v.inclusive)}return new Do($,L)}(u,l),w=this.On(l,u,p),S=this.On(l,u,y),k=this.Nn(l,u,f),E=this.Bn(l.indexId,h,w,p.inclusive,S,y.inclusive,k);return V.forEach(E,x=>r.Y(x,t.limit).next(N=>{N.forEach(P=>{const $=re.fromSegments(P.documentKey);o.has($)||(o=o.add($),a.push($))})}))}).next(()=>a)}return V.resolve(null)})}Mn(e){let t=this.Fn.get(e);return t||(e.filters.length===0?t=[e]:t=v6(Et.create(e.filters,"and")).map(r=>Av(e.path,e.collectionGroup,e.orderBy,r.getFilters(),e.limit,e.startAt,e.endAt)),this.Fn.set(e,t),t)}Bn(e,t,r,s,i,o,a){const l=(t!=null?t.length:1)*Math.max(r.length,i.length),u=l/(t!=null?t.length:1),h=[];for(let f=0;f<l;++f){const p=t?this.Ln(t[f/u]):If,y=this.kn(e,p,r[f%u],s),w=this.qn(e,p,i[f%u],o),S=a.map(k=>this.kn(e,p,k,!0));h.push(...this.createRange(y,w,S))}return h}kn(e,t,r,s){const i=new la(e,re.empty(),t,r);return s?i:i.An()}qn(e,t,r,s){const i=new la(e,re.empty(),t,r);return s?i.An():i}xn(e,t){const r=new _T(t),s=t.collectionGroup!=null?t.collectionGroup:t.path.lastSegment();return this.getFieldIndexes(e,s).next(i=>{let o=null;for(const a of i)r.yn(a)&&(!o||a.fields.length>o.fields.length)&&(o=a);return o})}getIndexType(e,t){let r=2;const s=this.Mn(t);return V.forEach(s,i=>this.xn(e,i).next(o=>{o?r!==0&&o.fields.length<function(l){let u=new bt(Yt.comparator),h=!1;for(const f of l.filters)for(const p of f.getFlattenedFilters())p.field.isKeyField()||(p.op==="array-contains"||p.op==="array-contains-any"?h=!0:u=u.add(p.field));for(const f of l.orderBy)f.field.isKeyField()||(u=u.add(f.field));return u.size+(h?1:0)}(i)&&(r=1):r=0})).next(()=>function(o){return o.limit!==null}(t)&&s.length>1&&r===2?1:r)}Qn(e,t){const r=new wu;for(const s of ra(e)){const i=t.data.field(s.fieldPath);if(i==null)return null;const o=r.Pn(s.kind);aa.Kt.Dt(i,o)}return r.un()}Ln(e){const t=new wu;return aa.Kt.Dt(e,t.Pn(0)),t.un()}$n(e,t){const r=new wu;return aa.Kt.Dt(Oa(this.databaseId,t),r.Pn(function(i){const o=ra(i);return o.length===0?0:o[o.length-1].kind}(e))),r.un()}Nn(e,t,r){if(r===null)return[];let s=[];s.push(new wu);let i=0;for(const o of ra(e)){const a=r[i++];for(const l of s)if(this.Un(t,o.fieldPath)&&Wd(a))s=this.Kn(s,o,a);else{const u=l.Pn(o.kind);aa.Kt.Dt(a,u)}}return this.Wn(s)}On(e,t,r){return this.Nn(e,t,r.position)}Wn(e){const t=[];for(let r=0;r<e.length;++r)t[r]=e[r].un();return t}Kn(e,t,r){const s=[...e],i=[];for(const o of r.arrayValue.values||[])for(const a of s){const l=new wu;l.seed(a.un()),aa.Kt.Dt(o,l.Pn(t.kind)),i.push(l)}return i}Un(e,t){return!!e.filters.find(r=>r instanceof at&&r.field.isEqual(t)&&(r.op==="in"||r.op==="not-in"))}getFieldIndexes(e,t){const r=xu(e),s=wl(e);return(t?r.J(wv,IDBKeyRange.bound(t,t)):r.J()).next(i=>{const o=[];return V.forEach(i,a=>s.get([a.indexId,this.uid]).next(l=>{o.push(function(h,f){const p=f?new yc(f.sequenceNumber,new Gr(Fa(f.readTime),new re($s(f.documentKey)),f.largestBatchId)):yc.empty(),y=h.fields.map(([w,S])=>new va(Yt.fromServerFormat(w),S));return new mc(h.indexId,h.collectionGroup,y,p)}(a,l))})).next(()=>o)})}getNextCollectionGroupToUpdate(e){return this.getFieldIndexes(e).next(t=>t.length===0?null:(t.sort((r,s)=>{const i=r.indexState.sequenceNumber-s.indexState.sequenceNumber;return i!==0?i:je(r.collectionGroup,s.collectionGroup)}),t[0].collectionGroup))}updateCollectionGroup(e,t,r){const s=xu(e),i=wl(e);return this.Gn(e).next(o=>s.J(wv,IDBKeyRange.bound(t,t)).next(a=>V.forEach(a,l=>i.put(hT(l.indexId,this.uid,o,r)))))}updateIndexEntries(e,t){const r=new Map;return V.forEach(t,(s,i)=>{const o=r.get(s.collectionGroup);return(o?V.resolve(o):this.getFieldIndexes(e,s.collectionGroup)).next(a=>(r.set(s.collectionGroup,a),V.forEach(a,l=>this.zn(e,s,l).next(u=>{const h=this.jn(i,l);return u.isEqual(h)?V.resolve():this.Jn(e,i,l,u,h)}))))})}Hn(e,t,r,s){return vl(e).put(s.Rn(this.uid,this.$n(r,t.key),t.key))}Yn(e,t,r,s){return vl(e).delete(s.Vn(this.uid,this.$n(r,t.key),t.key))}zn(e,t,r){const s=vl(e);let i=new bt(Bi);return s.ee({index:iN,range:IDBKeyRange.only([r.indexId,this.uid,tp(this.$n(r,t))])},(o,a)=>{i=i.add(new la(r.indexId,t,yT(a.arrayValue),yT(a.directionalValue)))}).next(()=>i)}jn(e,t){let r=new bt(Bi);const s=this.Qn(t,e);if(s==null)return r;const i=_v(t);if(i!=null){const o=e.data.field(i.fieldPath);if(Wd(o))for(const a of o.arrayValue.values||[])r=r.add(new la(t.indexId,e.key,this.Ln(a),s))}else r=r.add(new la(t.indexId,e.key,If,s));return r}Jn(e,t,r,s,i){Y(wT,"Updating index entries for document '%s'",t.key);const o=[];return function(l,u,h,f,p){const y=l.getIterator(),w=u.getIterator();let S=yl(y),k=yl(w);for(;S||k;){let E=!1,x=!1;if(S&&k){const N=h(S,k);N<0?x=!0:N>0&&(E=!0)}else S!=null?x=!0:E=!0;E?(f(k),k=yl(w)):x?(p(S),S=yl(y)):(S=yl(y),k=yl(w))}}(s,i,Bi,a=>{o.push(this.Hn(e,t,r,a))},a=>{o.push(this.Yn(e,t,r,a))}),V.waitFor(o)}Gn(e){let t=1;return wl(e).ee({index:sN,reverse:!0,range:IDBKeyRange.upperBound([this.uid,Number.MAX_SAFE_INTEGER])},(r,s,i)=>{i.done(),t=s.sequenceNumber+1}).next(()=>t)}createRange(e,t,r){r=r.sort((o,a)=>Bi(o,a)).filter((o,a,l)=>!a||Bi(o,l[a-1])!==0);const s=[];s.push(e);for(const o of r){const a=Bi(o,e),l=Bi(o,t);if(a===0)s[0]=e.An();else if(a>0&&l<0)s.push(o),s.push(o.An());else if(l>0)break}s.push(t);const i=[];for(let o=0;o<s.length;o+=2){if(this.Zn(s[o],s[o+1]))return[];const a=s[o].Vn(this.uid,If,re.empty()),l=s[o+1].Vn(this.uid,If,re.empty());i.push(IDBKeyRange.bound(a,l))}return i}Zn(e,t){return Bi(e,t)>0}getMinOffsetFromCollectionGroup(e,t){return this.getFieldIndexes(e,t).next(IT)}getMinOffset(e,t){return V.mapArray(this.Mn(t),r=>this.xn(e,r).next(s=>s||fe(44426))).next(IT)}}function xT(n){return Rn(n,$d)}function vl(n){return Rn(n,ed)}function xu(n){return Rn(n,Ow)}function wl(n){return Rn(n,Zu)}function IT(n){_e(n.length!==0,28825);let e=n[0].indexState.offset,t=e.largestBatchId;for(let r=1;r<n.length;r++){const s=n[r].indexState.offset;kw(s,e)<0&&(e=s),t<s.largestBatchId&&(t=s.largestBatchId)}return new Gr(e.readTime,e.documentKey,t)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ST={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0},fk=41943040;class sr{static withCacheSize(e){return new sr(e,sr.DEFAULT_COLLECTION_PERCENTILE,sr.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}constructor(e,t,r){this.cacheSizeCollectionThreshold=e,this.percentileToCollect=t,this.maximumSequenceNumbersToCollect=r}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function pk(n,e,t){const r=n.store(ps),s=n.store(_c),i=[],o=IDBKeyRange.only(t.batchId);let a=0;const l=r.ee({range:o},(h,f,p)=>(a++,p.delete()));i.push(l.next(()=>{_e(a===1,47070,{batchId:t.batchId})}));const u=[];for(const h of t.mutations){const f=tN(e,h.key.path,t.batchId);i.push(s.delete(f)),u.push(h.key)}return V.waitFor(i).next(()=>u)}function ag(n){if(!n)return 0;let e;if(n.document)e=n.document;else if(n.unknownDocument)e=n.unknownDocument;else{if(!n.noDocument)throw fe(14731);e=n.noDocument}return JSON.stringify(e).length}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */sr.DEFAULT_COLLECTION_PERCENTILE=10,sr.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,sr.DEFAULT=new sr(fk,sr.DEFAULT_COLLECTION_PERCENTILE,sr.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),sr.DISABLED=new sr(-1,0,0);class vm{constructor(e,t,r,s){this.userId=e,this.serializer=t,this.indexManager=r,this.referenceDelegate=s,this.Xn={}}static wt(e,t,r,s){_e(e.uid!=="",64387);const i=e.isAuthenticated()?e.uid:"";return new vm(i,t,r,s)}checkEmpty(e){let t=!0;const r=IDBKeyRange.bound([this.userId,Number.NEGATIVE_INFINITY],[this.userId,Number.POSITIVE_INFINITY]);return zi(e).ee({index:fa,range:r},(s,i,o)=>{t=!1,o.done()}).next(()=>t)}addMutationBatch(e,t,r,s){const i=Tl(e),o=zi(e);return o.add({}).next(a=>{_e(typeof a=="number",49019);const l=new qw(a,t,r,s),u=function(y,w,S){const k=S.baseMutations.map(x=>Qd(y.yt,x)),E=S.mutations.map(x=>Qd(y.yt,x));return{userId:w,batchId:S.batchId,localWriteTimeMs:S.localWriteTime.toMillis(),baseMutations:k,mutations:E}}(this.serializer,this.userId,l),h=[];let f=new bt((p,y)=>je(p.canonicalString(),y.canonicalString()));for(const p of s){const y=tN(this.userId,p.key.path,a);f=f.add(p.key.path.popLast()),h.push(o.put(u)),h.push(i.put(y,r3))}return f.forEach(p=>{h.push(this.indexManager.addToCollectionParentIndex(e,p))}),e.addOnCommittedListener(()=>{this.Xn[a]=l.keys()}),V.waitFor(h).next(()=>l)})}lookupMutationBatch(e,t){return zi(e).get(t).next(r=>r?(_e(r.userId===this.userId,48,"Unexpected user for mutation batch",{userId:r.userId,batchId:t}),oa(this.serializer,r)):null)}er(e,t){return this.Xn[t]?V.resolve(this.Xn[t]):this.lookupMutationBatch(e,t).next(r=>{if(r){const s=r.keys();return this.Xn[t]=s,s}return null})}getNextMutationBatchAfterBatchId(e,t){const r=t+1,s=IDBKeyRange.lowerBound([this.userId,r]);let i=null;return zi(e).ee({index:fa,range:s},(o,a,l)=>{a.userId===this.userId&&(_e(a.batchId>=r,47524,{tr:r}),i=oa(this.serializer,a)),l.done()}).next(()=>i)}getHighestUnacknowledgedBatchId(e){const t=IDBKeyRange.upperBound([this.userId,Number.POSITIVE_INFINITY]);let r=xo;return zi(e).ee({index:fa,range:t,reverse:!0},(s,i,o)=>{r=i.batchId,o.done()}).next(()=>r)}getAllMutationBatches(e){const t=IDBKeyRange.bound([this.userId,xo],[this.userId,Number.POSITIVE_INFINITY]);return zi(e).J(fa,t).next(r=>r.map(s=>oa(this.serializer,s)))}getAllMutationBatchesAffectingDocumentKey(e,t){const r=Qf(this.userId,t.path),s=IDBKeyRange.lowerBound(r),i=[];return Tl(e).ee({range:s},(o,a,l)=>{const[u,h,f]=o,p=$s(h);if(u===this.userId&&t.path.isEqual(p))return zi(e).get(f).next(y=>{if(!y)throw fe(61480,{nr:o,batchId:f});_e(y.userId===this.userId,10503,"Unexpected user for mutation batch",{userId:y.userId,batchId:f}),i.push(oa(this.serializer,y))});l.done()}).next(()=>i)}getAllMutationBatchesAffectingDocumentKeys(e,t){let r=new bt(je);const s=[];return t.forEach(i=>{const o=Qf(this.userId,i.path),a=IDBKeyRange.lowerBound(o),l=Tl(e).ee({range:a},(u,h,f)=>{const[p,y,w]=u,S=$s(y);p===this.userId&&i.path.isEqual(S)?r=r.add(w):f.done()});s.push(l)}),V.waitFor(s).next(()=>this.rr(e,r))}getAllMutationBatchesAffectingQuery(e,t){const r=t.path,s=r.length+1,i=Qf(this.userId,r),o=IDBKeyRange.lowerBound(i);let a=new bt(je);return Tl(e).ee({range:o},(l,u,h)=>{const[f,p,y]=l,w=$s(p);f===this.userId&&r.isPrefixOf(w)?w.length===s&&(a=a.add(y)):h.done()}).next(()=>this.rr(e,a))}rr(e,t){const r=[],s=[];return t.forEach(i=>{s.push(zi(e).get(i).next(o=>{if(o===null)throw fe(35274,{batchId:i});_e(o.userId===this.userId,9748,"Unexpected user for mutation batch",{userId:o.userId,batchId:i}),r.push(oa(this.serializer,o))}))}),V.waitFor(s).next(()=>r)}removeMutationBatch(e,t){return pk(e.le,this.userId,t).next(r=>(e.addOnCommittedListener(()=>{this.ir(t.batchId)}),V.forEach(r,s=>this.referenceDelegate.markPotentiallyOrphaned(e,s))))}ir(e){delete this.Xn[e]}performConsistencyCheck(e){return this.checkEmpty(e).next(t=>{if(!t)return V.resolve();const r=IDBKeyRange.lowerBound(function(o){return[o]}(this.userId)),s=[];return Tl(e).ee({range:r},(i,o,a)=>{if(i[0]===this.userId){const l=$s(i[1]);s.push(l)}else a.done()}).next(()=>{_e(s.length===0,56720,{sr:s.map(i=>i.canonicalString())})})})}containsKey(e,t){return gk(e,this.userId,t)}_r(e){return mk(e).get(this.userId).next(t=>t||{userId:this.userId,lastAcknowledgedBatchId:xo,lastStreamToken:""})}}function gk(n,e,t){const r=Qf(e,t.path),s=r[1],i=IDBKeyRange.lowerBound(r);let o=!1;return Tl(n).ee({range:i,X:!0},(a,l,u)=>{const[h,f,p]=a;h===e&&f===s&&(o=!0),u.done()}).next(()=>o)}function zi(n){return Rn(n,ps)}function Tl(n){return Rn(n,_c)}function mk(n){return Rn(n,Fd)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ua{constructor(e){this.ar=e}next(){return this.ar+=2,this.ar}static ur(){return new Ua(0)}static cr(){return new Ua(-1)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class I6{constructor(e,t){this.referenceDelegate=e,this.serializer=t}allocateTargetId(e){return this.lr(e).next(t=>{const r=new Ua(t.highestTargetId);return t.highestTargetId=r.next(),this.hr(e,t).next(()=>t.highestTargetId)})}getLastRemoteSnapshotVersion(e){return this.lr(e).next(t=>Ie.fromTimestamp(new Ze(t.lastRemoteSnapshotVersion.seconds,t.lastRemoteSnapshotVersion.nanoseconds)))}getHighestSequenceNumber(e){return this.lr(e).next(t=>t.highestListenSequenceNumber)}setTargetsMetadata(e,t,r){return this.lr(e).next(s=>(s.highestListenSequenceNumber=t,r&&(s.lastRemoteSnapshotVersion=r.toTimestamp()),t>s.highestListenSequenceNumber&&(s.highestListenSequenceNumber=t),this.hr(e,s)))}addTargetData(e,t){return this.Pr(e,t).next(()=>this.lr(e).next(r=>(r.targetCount+=1,this.Tr(t,r),this.hr(e,r))))}updateTargetData(e,t){return this.Pr(e,t)}removeTargetData(e,t){return this.removeMatchingKeysForTargetId(e,t.targetId).next(()=>xl(e).delete(t.targetId)).next(()=>this.lr(e)).next(r=>(_e(r.targetCount>0,8065),r.targetCount-=1,this.hr(e,r)))}removeTargets(e,t,r){let s=0;const i=[];return xl(e).ee((o,a)=>{const l=Lu(a);l.sequenceNumber<=t&&r.get(l.targetId)===null&&(s++,i.push(this.removeTargetData(e,l)))}).next(()=>V.waitFor(i)).next(()=>s)}forEachTarget(e,t){return xl(e).ee((r,s)=>{const i=Lu(s);t(i)})}lr(e){return ET(e).get(tg).next(t=>(_e(t!==null,2888),t))}hr(e,t){return ET(e).put(tg,t)}Pr(e,t){return xl(e).put(uk(this.serializer,t))}Tr(e,t){let r=!1;return e.targetId>t.highestTargetId&&(t.highestTargetId=e.targetId,r=!0),e.sequenceNumber>t.highestListenSequenceNumber&&(t.highestListenSequenceNumber=e.sequenceNumber,r=!0),r}getTargetCount(e){return this.lr(e).next(t=>t.targetCount)}getTargetData(e,t){const r=La(t),s=IDBKeyRange.bound([r,Number.NEGATIVE_INFINITY],[r,Number.POSITIVE_INFINITY]);let i=null;return xl(e).ee({range:s,index:rN},(o,a,l)=>{const u=Lu(a);Sh(t,u.target)&&(i=u,l.done())}).next(()=>i)}addMatchingKeys(e,t,r){const s=[],i=Ji(e);return t.forEach(o=>{const a=ar(o.path);s.push(i.put({targetId:r,path:a})),s.push(this.referenceDelegate.addReference(e,r,o))}),V.waitFor(s)}removeMatchingKeys(e,t,r){const s=Ji(e);return V.forEach(t,i=>{const o=ar(i.path);return V.waitFor([s.delete([r,o]),this.referenceDelegate.removeReference(e,r,i)])})}removeMatchingKeysForTargetId(e,t){const r=Ji(e),s=IDBKeyRange.bound([t],[t+1],!1,!0);return r.delete(s)}getMatchingKeysForTargetId(e,t){const r=IDBKeyRange.bound([t],[t+1],!1,!0),s=Ji(e);let i=He();return s.ee({range:r,X:!0},(o,a,l)=>{const u=$s(o[1]),h=new re(u);i=i.add(h)}).next(()=>i)}containsKey(e,t){const r=ar(t.path),s=IDBKeyRange.bound([r],[GR(r)],!1,!0);let i=0;return Ji(e).ee({index:Dw,X:!0,range:s},([o,a],l,u)=>{o!==0&&(i++,u.done())}).next(()=>i>0)}At(e,t){return xl(e).get(t).next(r=>r?Lu(r):null)}}function xl(n){return Rn(n,vc)}function ET(n){return Rn(n,wa)}function Ji(n){return Rn(n,wc)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const TT="LruGarbageCollector",yk=1048576;function bT([n,e],[t,r]){const s=je(n,t);return s===0?je(e,r):s}class S6{constructor(e){this.Ir=e,this.buffer=new bt(bT),this.Er=0}dr(){return++this.Er}Ar(e){const t=[e,this.dr()];if(this.buffer.size<this.Ir)this.buffer=this.buffer.add(t);else{const r=this.buffer.last();bT(t,r)<0&&(this.buffer=this.buffer.delete(r).add(t))}}get maxValue(){return this.buffer.last()[0]}}class _k{constructor(e,t,r){this.garbageCollector=e,this.asyncQueue=t,this.localStore=r,this.Rr=null}start(){this.garbageCollector.params.cacheSizeCollectionThreshold!==-1&&this.Vr(6e4)}stop(){this.Rr&&(this.Rr.cancel(),this.Rr=null)}get started(){return this.Rr!==null}Vr(e){Y(TT,`Garbage collection scheduled in ${e}ms`),this.Rr=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",e,async()=>{this.Rr=null;try{await this.localStore.collectGarbage(this.garbageCollector)}catch(t){Bo(t)?Y(TT,"Ignoring IndexedDB error during garbage collection: ",t):await $o(t)}await this.Vr(3e5)})}}class E6{constructor(e,t){this.mr=e,this.params=t}calculateTargetCount(e,t){return this.mr.gr(e).next(r=>Math.floor(t/100*r))}nthSequenceNumber(e,t){if(t===0)return V.resolve(Ir.ce);const r=new S6(t);return this.mr.forEachTarget(e,s=>r.Ar(s.sequenceNumber)).next(()=>this.mr.pr(e,s=>r.Ar(s))).next(()=>r.maxValue)}removeTargets(e,t,r){return this.mr.removeTargets(e,t,r)}removeOrphanedDocuments(e,t){return this.mr.removeOrphanedDocuments(e,t)}collect(e,t){return this.params.cacheSizeCollectionThreshold===-1?(Y("LruGarbageCollector","Garbage collection skipped; disabled"),V.resolve(ST)):this.getCacheSize(e).next(r=>r<this.params.cacheSizeCollectionThreshold?(Y("LruGarbageCollector",`Garbage collection skipped; Cache size ${r} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),ST):this.yr(e,t))}getCacheSize(e){return this.mr.getCacheSize(e)}yr(e,t){let r,s,i,o,a,l,u;const h=Date.now();return this.calculateTargetCount(e,this.params.percentileToCollect).next(f=>(f>this.params.maximumSequenceNumbersToCollect?(Y("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${f}`),s=this.params.maximumSequenceNumbersToCollect):s=f,o=Date.now(),this.nthSequenceNumber(e,s))).next(f=>(r=f,a=Date.now(),this.removeTargets(e,r,t))).next(f=>(i=f,l=Date.now(),this.removeOrphanedDocuments(e,r))).next(f=>(u=Date.now(),Il()<=st.DEBUG&&Y("LruGarbageCollector",`LRU Garbage Collection
	Counted targets in ${o-h}ms
	Determined least recently used ${s} in `+(a-o)+`ms
	Removed ${i} targets in `+(l-a)+`ms
	Removed ${f} documents in `+(u-l)+`ms
Total Duration: ${u-h}ms`),V.resolve({didRun:!0,sequenceNumbersCollected:s,targetsRemoved:i,documentsRemoved:f})))}}function vk(n,e){return new E6(n,e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class T6{constructor(e,t){this.db=e,this.garbageCollector=vk(this,t)}gr(e){const t=this.wr(e);return this.db.getTargetCache().getTargetCount(e).next(r=>t.next(s=>r+s))}wr(e){let t=0;return this.pr(e,r=>{t++}).next(()=>t)}forEachTarget(e,t){return this.db.getTargetCache().forEachTarget(e,t)}pr(e,t){return this.Sr(e,(r,s)=>t(s))}addReference(e,t,r){return Sf(e,r)}removeReference(e,t,r){return Sf(e,r)}removeTargets(e,t,r){return this.db.getTargetCache().removeTargets(e,t,r)}markPotentiallyOrphaned(e,t){return Sf(e,t)}br(e,t){return function(s,i){let o=!1;return mk(s).te(a=>gk(s,a,i).next(l=>(l&&(o=!0),V.resolve(!l)))).next(()=>o)}(e,t)}removeOrphanedDocuments(e,t){const r=this.db.getRemoteDocumentCache().newChangeBuffer(),s=[];let i=0;return this.Sr(e,(o,a)=>{if(a<=t){const l=this.br(e,o).next(u=>{if(!u)return i++,r.getEntry(e,o).next(()=>(r.removeEntry(o,Ie.min()),Ji(e).delete(function(f){return[0,ar(f.path)]}(o))))});s.push(l)}}).next(()=>V.waitFor(s)).next(()=>r.apply(e)).next(()=>i)}removeTarget(e,t){const r=t.withSequenceNumber(e.currentSequenceNumber);return this.db.getTargetCache().updateTargetData(e,r)}updateLimboDocument(e,t){return Sf(e,t)}Sr(e,t){const r=Ji(e);let s,i=Ir.ce;return r.ee({index:Dw},([o,a],{path:l,sequenceNumber:u})=>{o===0?(i!==Ir.ce&&t(new re($s(s)),i),i=u,s=l):i=Ir.ce}).next(()=>{i!==Ir.ce&&t(new re($s(s)),i)})}getCacheSize(e){return this.db.getRemoteDocumentCache().getSize(e)}}function Sf(n,e){return Ji(n).put(function(r,s){return{targetId:0,path:ar(r.path),sequenceNumber:s}}(e,n.currentSequenceNumber))}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class wk{constructor(){this.changes=new Di(e=>e.toString(),(e,t)=>e.isEqual(t)),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,t){this.assertNotApplied(),this.changes.set(e,Ut.newInvalidDocument(e).setReadTime(t))}getEntry(e,t){this.assertNotApplied();const r=this.changes.get(t);return r!==void 0?V.resolve(r):this.getFromCache(e,t)}getEntries(e,t){return this.getAllFromCache(e,t)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class b6{constructor(e){this.serializer=e}setIndexManager(e){this.indexManager=e}addEntry(e,t,r){return Xo(e).put(r)}removeEntry(e,t,r){return Xo(e).delete(function(i,o){const a=i.path.toArray();return[a.slice(0,a.length-2),a[a.length-2],ig(o),a[a.length-1]]}(t,r))}updateMetadata(e,t){return this.getMetadata(e).next(r=>(r.byteSize+=t,this.Dr(e,r)))}getEntry(e,t){let r=Ut.newInvalidDocument(t);return Xo(e).ee({index:Kf,range:IDBKeyRange.only(Iu(t))},(s,i)=>{r=this.Cr(t,i)}).next(()=>r)}vr(e,t){let r={size:0,document:Ut.newInvalidDocument(t)};return Xo(e).ee({index:Kf,range:IDBKeyRange.only(Iu(t))},(s,i)=>{r={document:this.Cr(t,i),size:ag(i)}}).next(()=>r)}getEntries(e,t){let r=Er();return this.Fr(e,t,(s,i)=>{const o=this.Cr(s,i);r=r.insert(s,o)}).next(()=>r)}Mr(e,t){let r=Er(),s=new jt(re.comparator);return this.Fr(e,t,(i,o)=>{const a=this.Cr(i,o);r=r.insert(i,a),s=s.insert(i,ag(o))}).next(()=>({documents:r,Or:s}))}Fr(e,t,r){if(t.isEmpty())return V.resolve();let s=new bt(RT);t.forEach(l=>s=s.add(l));const i=IDBKeyRange.bound(Iu(s.first()),Iu(s.last())),o=s.getIterator();let a=o.getNext();return Xo(e).ee({index:Kf,range:i},(l,u,h)=>{const f=re.fromSegments([...u.prefixPath,u.collectionGroup,u.documentId]);for(;a&&RT(a,f)<0;)r(a,null),a=o.getNext();a&&a.isEqual(f)&&(r(a,u),a=o.hasNext()?o.getNext():null),a?h.j(Iu(a)):h.done()}).next(()=>{for(;a;)r(a,null),a=o.hasNext()?o.getNext():null})}getDocumentsMatchingQuery(e,t,r,s,i){const o=t.path,a=[o.popLast().toArray(),o.lastSegment(),ig(r.readTime),r.documentKey.path.isEmpty()?"":r.documentKey.path.lastSegment()],l=[o.popLast().toArray(),o.lastSegment(),[Number.MAX_SAFE_INTEGER,Number.MAX_SAFE_INTEGER],""];return Xo(e).J(IDBKeyRange.bound(a,l,!0)).next(u=>{i==null||i.incrementDocumentReadCount(u.length);let h=Er();for(const f of u){const p=this.Cr(re.fromSegments(f.prefixPath.concat(f.collectionGroup,f.documentId)),f);p.isFoundDocument()&&(Th(t,p)||s.has(p.key))&&(h=h.insert(p.key,p))}return h})}getAllFromCollectionGroup(e,t,r,s){let i=Er();const o=CT(t,r),a=CT(t,Gr.max());return Xo(e).ee({index:nN,range:IDBKeyRange.bound(o,a,!0)},(l,u,h)=>{const f=this.Cr(re.fromSegments(u.prefixPath.concat(u.collectionGroup,u.documentId)),u);i=i.insert(f.key,f),i.size===s&&h.done()}).next(()=>i)}newChangeBuffer(e){return new A6(this,!!e&&e.trackRemovals)}getSize(e){return this.getMetadata(e).next(t=>t.byteSize)}getMetadata(e){return AT(e).get(vv).next(t=>(_e(!!t,20021),t))}Dr(e,t){return AT(e).put(vv,t)}Cr(e,t){if(t){const r=h6(this.serializer,t);if(!(r.isNoDocument()&&r.version.isEqual(Ie.min())))return r}return Ut.newInvalidDocument(e)}}function xk(n){return new b6(n)}class A6 extends wk{constructor(e,t){super(),this.Nr=e,this.trackRemovals=t,this.Br=new Di(r=>r.toString(),(r,s)=>r.isEqual(s))}applyChanges(e){const t=[];let r=0,s=new bt((i,o)=>je(i.canonicalString(),o.canonicalString()));return this.changes.forEach((i,o)=>{const a=this.Br.get(i);if(t.push(this.Nr.removeEntry(e,i,a.readTime)),o.isValidDocument()){const l=uT(this.Nr.serializer,o);s=s.add(i.path.popLast());const u=ag(l);r+=u-a.size,t.push(this.Nr.addEntry(e,i,l))}else if(r-=a.size,this.trackRemovals){const l=uT(this.Nr.serializer,o.convertToNoDocument(Ie.min()));t.push(this.Nr.addEntry(e,i,l))}}),s.forEach(i=>{t.push(this.Nr.indexManager.addToCollectionParentIndex(e,i))}),t.push(this.Nr.updateMetadata(e,r)),V.waitFor(t)}getFromCache(e,t){return this.Nr.vr(e,t).next(r=>(this.Br.set(t,{size:r.size,readTime:r.document.readTime}),r.document))}getAllFromCache(e,t){return this.Nr.Mr(e,t).next(({documents:r,Or:s})=>(s.forEach((i,o)=>{this.Br.set(i,{size:o,readTime:r.get(i).readTime})}),r))}}function AT(n){return Rn(n,Ud)}function Xo(n){return Rn(n,eg)}function Iu(n){const e=n.path.toArray();return[e.slice(0,e.length-2),e[e.length-2],e[e.length-1]]}function CT(n,e){const t=e.documentKey.path.toArray();return[n,ig(e.readTime),t.slice(0,t.length-2),t.length>0?t[t.length-1]:""]}function RT(n,e){const t=n.path.toArray(),r=e.path.toArray();let s=0;for(let i=0;i<t.length-2&&i<r.length-2;++i)if(s=je(t[i],r[i]),s)return s;return s=je(t.length,r.length),s||(s=je(t[t.length-2],r[r.length-2]),s||je(t[t.length-1],r[r.length-1]))}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class C6{constructor(e,t){this.overlayedDocument=e,this.mutatedFields=t}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ik{constructor(e,t,r,s){this.remoteDocumentCache=e,this.mutationQueue=t,this.documentOverlayCache=r,this.indexManager=s}getDocument(e,t){let r=null;return this.documentOverlayCache.getOverlay(e,t).next(s=>(r=s,this.remoteDocumentCache.getEntry(e,t))).next(s=>(r!==null&&rd(r.mutation,s,Sr.empty(),Ze.now()),s))}getDocuments(e,t){return this.remoteDocumentCache.getEntries(e,t).next(r=>this.getLocalViewOfDocuments(e,r,He()).next(()=>r))}getLocalViewOfDocuments(e,t,r=He()){const s=Bs();return this.populateOverlays(e,s,t).next(()=>this.computeViews(e,t,s,r).next(i=>{let o=Du();return i.forEach((a,l)=>{o=o.insert(a,l.overlayedDocument)}),o}))}getOverlayedDocuments(e,t){const r=Bs();return this.populateOverlays(e,r,t).next(()=>this.computeViews(e,t,r,He()))}populateOverlays(e,t,r){const s=[];return r.forEach(i=>{t.has(i)||s.push(i)}),this.documentOverlayCache.getOverlays(e,s).next(i=>{i.forEach((o,a)=>{t.set(o,a)})})}computeViews(e,t,r,s){let i=Er();const o=nd(),a=function(){return nd()}();return t.forEach((l,u)=>{const h=r.get(u.key);s.has(u.key)&&(h===void 0||h.mutation instanceof Oi)?i=i.insert(u.key,u):h!==void 0?(o.set(u.key,h.mutation.getFieldMask()),rd(h.mutation,u,h.mutation.getFieldMask(),Ze.now())):o.set(u.key,Sr.empty())}),this.recalculateAndSaveOverlays(e,i).next(l=>(l.forEach((u,h)=>o.set(u,h)),t.forEach((u,h)=>a.set(u,new C6(h,o.get(u)??null))),a))}recalculateAndSaveOverlays(e,t){const r=nd();let s=new jt((o,a)=>o-a),i=He();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,t).next(o=>{for(const a of o)a.keys().forEach(l=>{const u=t.get(l);if(u===null)return;let h=r.get(l)||Sr.empty();h=a.applyToLocalView(u,h),r.set(l,h);const f=(s.get(a.batchId)||He()).add(l);s=s.insert(a.batchId,f)})}).next(()=>{const o=[],a=s.getReverseIterator();for(;a.hasNext();){const l=a.getNext(),u=l.key,h=l.value,f=jN();h.forEach(p=>{if(!i.has(p)){const y=qN(t.get(p),r.get(p));y!==null&&f.set(p,y),i=i.add(p)}}),o.push(this.documentOverlayCache.saveOverlays(e,u,f))}return V.waitFor(o)}).next(()=>r)}recalculateAndSaveOverlaysForDocumentKeys(e,t){return this.remoteDocumentCache.getEntries(e,t).next(r=>this.recalculateAndSaveOverlays(e,r))}getDocumentsMatchingQuery(e,t,r,s){return function(o){return re.isDocumentKey(o.path)&&o.collectionGroup===null&&o.filters.length===0}(t)?this.getDocumentsMatchingDocumentQuery(e,t.path):Uw(t)?this.getDocumentsMatchingCollectionGroupQuery(e,t,r,s):this.getDocumentsMatchingCollectionQuery(e,t,r,s)}getNextDocuments(e,t,r,s){return this.remoteDocumentCache.getAllFromCollectionGroup(e,t,r,s).next(i=>{const o=s-i.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(e,t,r.largestBatchId,s-i.size):V.resolve(Bs());let a=gc,l=i;return o.next(u=>V.forEach(u,(h,f)=>(a<f.largestBatchId&&(a=f.largestBatchId),i.get(h)?V.resolve():this.remoteDocumentCache.getEntry(e,h).next(p=>{l=l.insert(h,p)}))).next(()=>this.populateOverlays(e,u,i)).next(()=>this.computeViews(e,l,u,He())).next(h=>({batchId:a,changes:MN(h)})))})}getDocumentsMatchingDocumentQuery(e,t){return this.getDocument(e,new re(t)).next(r=>{let s=Du();return r.isFoundDocument()&&(s=s.insert(r.key,r)),s})}getDocumentsMatchingCollectionGroupQuery(e,t,r,s){const i=t.collectionGroup;let o=Du();return this.indexManager.getCollectionParents(e,i).next(a=>V.forEach(a,l=>{const u=function(f,p){return new Pi(p,null,f.explicitOrderBy.slice(),f.filters.slice(),f.limit,f.limitType,f.startAt,f.endAt)}(t,l.child(i));return this.getDocumentsMatchingCollectionQuery(e,u,r,s).next(h=>{h.forEach((f,p)=>{o=o.insert(f,p)})})}).next(()=>o))}getDocumentsMatchingCollectionQuery(e,t,r,s){let i;return this.documentOverlayCache.getOverlaysForCollection(e,t.path,r.largestBatchId).next(o=>(i=o,this.remoteDocumentCache.getDocumentsMatchingQuery(e,t,r,i,s))).next(o=>{i.forEach((l,u)=>{const h=u.getKey();o.get(h)===null&&(o=o.insert(h,Ut.newInvalidDocument(h)))});let a=Du();return o.forEach((l,u)=>{const h=i.get(l);h!==void 0&&rd(h.mutation,u,Sr.empty(),Ze.now()),Th(t,u)&&(a=a.insert(l,u))}),a})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class R6{constructor(e){this.serializer=e,this.Lr=new Map,this.kr=new Map}getBundleMetadata(e,t){return V.resolve(this.Lr.get(t))}saveBundleMetadata(e,t){return this.Lr.set(t.id,function(s){return{id:s.id,version:s.version,createTime:gn(s.createTime)}}(t)),V.resolve()}getNamedQuery(e,t){return V.resolve(this.kr.get(t))}saveNamedQuery(e,t){return this.kr.set(t.name,function(s){return{name:s.name,query:ym(s.bundledQuery),readTime:gn(s.readTime)}}(t)),V.resolve()}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class N6{constructor(){this.overlays=new jt(re.comparator),this.qr=new Map}getOverlay(e,t){return V.resolve(this.overlays.get(t))}getOverlays(e,t){const r=Bs();return V.forEach(t,s=>this.getOverlay(e,s).next(i=>{i!==null&&r.set(s,i)})).next(()=>r)}saveOverlays(e,t,r){return r.forEach((s,i)=>{this.St(e,t,i)}),V.resolve()}removeOverlaysForBatchId(e,t,r){const s=this.qr.get(r);return s!==void 0&&(s.forEach(i=>this.overlays=this.overlays.remove(i)),this.qr.delete(r)),V.resolve()}getOverlaysForCollection(e,t,r){const s=Bs(),i=t.length+1,o=new re(t.child("")),a=this.overlays.getIteratorFrom(o);for(;a.hasNext();){const l=a.getNext().value,u=l.getKey();if(!t.isPrefixOf(u.path))break;u.path.length===i&&l.largestBatchId>r&&s.set(l.getKey(),l)}return V.resolve(s)}getOverlaysForCollectionGroup(e,t,r,s){let i=new jt((u,h)=>u-h);const o=this.overlays.getIterator();for(;o.hasNext();){const u=o.getNext().value;if(u.getKey().getCollectionGroup()===t&&u.largestBatchId>r){let h=i.get(u.largestBatchId);h===null&&(h=Bs(),i=i.insert(u.largestBatchId,h)),h.set(u.getKey(),u)}}const a=Bs(),l=i.getIterator();for(;l.hasNext()&&(l.getNext().value.forEach((u,h)=>a.set(u,h)),!(a.size()>=s)););return V.resolve(a)}St(e,t,r){const s=this.overlays.get(r.key);if(s!==null){const o=this.qr.get(s.largestBatchId).delete(r.key);this.qr.set(s.largestBatchId,o)}this.overlays=this.overlays.insert(r.key,new Gw(t,r));let i=this.qr.get(t);i===void 0&&(i=He(),this.qr.set(t,i)),this.qr.set(t,i.add(r.key))}}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class k6{constructor(){this.sessionToken=ln.EMPTY_BYTE_STRING}getSessionToken(e){return V.resolve(this.sessionToken)}setSessionToken(e,t){return this.sessionToken=t,V.resolve()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Jw{constructor(){this.Qr=new bt(Pn.$r),this.Ur=new bt(Pn.Kr)}isEmpty(){return this.Qr.isEmpty()}addReference(e,t){const r=new Pn(e,t);this.Qr=this.Qr.add(r),this.Ur=this.Ur.add(r)}Wr(e,t){e.forEach(r=>this.addReference(r,t))}removeReference(e,t){this.Gr(new Pn(e,t))}zr(e,t){e.forEach(r=>this.removeReference(r,t))}jr(e){const t=new re(new rt([])),r=new Pn(t,e),s=new Pn(t,e+1),i=[];return this.Ur.forEachInRange([r,s],o=>{this.Gr(o),i.push(o.key)}),i}Jr(){this.Qr.forEach(e=>this.Gr(e))}Gr(e){this.Qr=this.Qr.delete(e),this.Ur=this.Ur.delete(e)}Hr(e){const t=new re(new rt([])),r=new Pn(t,e),s=new Pn(t,e+1);let i=He();return this.Ur.forEachInRange([r,s],o=>{i=i.add(o.key)}),i}containsKey(e){const t=new Pn(e,0),r=this.Qr.firstAfterOrEqual(t);return r!==null&&e.isEqual(r.key)}}class Pn{constructor(e,t){this.key=e,this.Yr=t}static $r(e,t){return re.comparator(e.key,t.key)||je(e.Yr,t.Yr)}static Kr(e,t){return je(e.Yr,t.Yr)||re.comparator(e.key,t.key)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class P6{constructor(e,t){this.indexManager=e,this.referenceDelegate=t,this.mutationQueue=[],this.tr=1,this.Zr=new bt(Pn.$r)}checkEmpty(e){return V.resolve(this.mutationQueue.length===0)}addMutationBatch(e,t,r,s){const i=this.tr;this.tr++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];const o=new qw(i,t,r,s);this.mutationQueue.push(o);for(const a of s)this.Zr=this.Zr.add(new Pn(a.key,i)),this.indexManager.addToCollectionParentIndex(e,a.key.path.popLast());return V.resolve(o)}lookupMutationBatch(e,t){return V.resolve(this.Xr(t))}getNextMutationBatchAfterBatchId(e,t){const r=t+1,s=this.ei(r),i=s<0?0:s;return V.resolve(this.mutationQueue.length>i?this.mutationQueue[i]:null)}getHighestUnacknowledgedBatchId(){return V.resolve(this.mutationQueue.length===0?xo:this.tr-1)}getAllMutationBatches(e){return V.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,t){const r=new Pn(t,0),s=new Pn(t,Number.POSITIVE_INFINITY),i=[];return this.Zr.forEachInRange([r,s],o=>{const a=this.Xr(o.Yr);i.push(a)}),V.resolve(i)}getAllMutationBatchesAffectingDocumentKeys(e,t){let r=new bt(je);return t.forEach(s=>{const i=new Pn(s,0),o=new Pn(s,Number.POSITIVE_INFINITY);this.Zr.forEachInRange([i,o],a=>{r=r.add(a.Yr)})}),V.resolve(this.ti(r))}getAllMutationBatchesAffectingQuery(e,t){const r=t.path,s=r.length+1;let i=r;re.isDocumentKey(i)||(i=i.child(""));const o=new Pn(new re(i),0);let a=new bt(je);return this.Zr.forEachWhile(l=>{const u=l.key.path;return!!r.isPrefixOf(u)&&(u.length===s&&(a=a.add(l.Yr)),!0)},o),V.resolve(this.ti(a))}ti(e){const t=[];return e.forEach(r=>{const s=this.Xr(r);s!==null&&t.push(s)}),t}removeMutationBatch(e,t){_e(this.ni(t.batchId,"removed")===0,55003),this.mutationQueue.shift();let r=this.Zr;return V.forEach(t.mutations,s=>{const i=new Pn(s.key,t.batchId);return r=r.delete(i),this.referenceDelegate.markPotentiallyOrphaned(e,s.key)}).next(()=>{this.Zr=r})}ir(e){}containsKey(e,t){const r=new Pn(t,0),s=this.Zr.firstAfterOrEqual(r);return V.resolve(t.isEqual(s&&s.key))}performConsistencyCheck(e){return this.mutationQueue.length,V.resolve()}ni(e,t){return this.ei(e)}ei(e){return this.mutationQueue.length===0?0:e-this.mutationQueue[0].batchId}Xr(e){const t=this.ei(e);return t<0||t>=this.mutationQueue.length?null:this.mutationQueue[t]}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class D6{constructor(e){this.ri=e,this.docs=function(){return new jt(re.comparator)}(),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,t){const r=t.key,s=this.docs.get(r),i=s?s.size:0,o=this.ri(t);return this.docs=this.docs.insert(r,{document:t.mutableCopy(),size:o}),this.size+=o-i,this.indexManager.addToCollectionParentIndex(e,r.path.popLast())}removeEntry(e){const t=this.docs.get(e);t&&(this.docs=this.docs.remove(e),this.size-=t.size)}getEntry(e,t){const r=this.docs.get(t);return V.resolve(r?r.document.mutableCopy():Ut.newInvalidDocument(t))}getEntries(e,t){let r=Er();return t.forEach(s=>{const i=this.docs.get(s);r=r.insert(s,i?i.document.mutableCopy():Ut.newInvalidDocument(s))}),V.resolve(r)}getDocumentsMatchingQuery(e,t,r,s){let i=Er();const o=t.path,a=new re(o.child("__id-9223372036854775808__")),l=this.docs.getIteratorFrom(a);for(;l.hasNext();){const{key:u,value:{document:h}}=l.getNext();if(!o.isPrefixOf(u.path))break;u.path.length>o.length+1||kw(YR(h),r)<=0||(s.has(h.key)||Th(t,h))&&(i=i.insert(h.key,h.mutableCopy()))}return V.resolve(i)}getAllFromCollectionGroup(e,t,r,s){fe(9500)}ii(e,t){return V.forEach(this.docs,r=>t(r))}newChangeBuffer(e){return new O6(this)}getSize(e){return V.resolve(this.size)}}class O6 extends wk{constructor(e){super(),this.Nr=e}applyChanges(e){const t=[];return this.changes.forEach((r,s)=>{s.isValidDocument()?t.push(this.Nr.addEntry(e,s)):this.Nr.removeEntry(r)}),V.waitFor(t)}getFromCache(e,t){return this.Nr.getEntry(e,t)}getAllFromCache(e,t){return this.Nr.getEntries(e,t)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class L6{constructor(e){this.persistence=e,this.si=new Di(t=>La(t),Sh),this.lastRemoteSnapshotVersion=Ie.min(),this.highestTargetId=0,this.oi=0,this._i=new Jw,this.targetCount=0,this.ai=Ua.ur()}forEachTarget(e,t){return this.si.forEach((r,s)=>t(s)),V.resolve()}getLastRemoteSnapshotVersion(e){return V.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return V.resolve(this.oi)}allocateTargetId(e){return this.highestTargetId=this.ai.next(),V.resolve(this.highestTargetId)}setTargetsMetadata(e,t,r){return r&&(this.lastRemoteSnapshotVersion=r),t>this.oi&&(this.oi=t),V.resolve()}Pr(e){this.si.set(e.target,e);const t=e.targetId;t>this.highestTargetId&&(this.ai=new Ua(t),this.highestTargetId=t),e.sequenceNumber>this.oi&&(this.oi=e.sequenceNumber)}addTargetData(e,t){return this.Pr(t),this.targetCount+=1,V.resolve()}updateTargetData(e,t){return this.Pr(t),V.resolve()}removeTargetData(e,t){return this.si.delete(t.target),this._i.jr(t.targetId),this.targetCount-=1,V.resolve()}removeTargets(e,t,r){let s=0;const i=[];return this.si.forEach((o,a)=>{a.sequenceNumber<=t&&r.get(a.targetId)===null&&(this.si.delete(o),i.push(this.removeMatchingKeysForTargetId(e,a.targetId)),s++)}),V.waitFor(i).next(()=>s)}getTargetCount(e){return V.resolve(this.targetCount)}getTargetData(e,t){const r=this.si.get(t)||null;return V.resolve(r)}addMatchingKeys(e,t,r){return this._i.Wr(t,r),V.resolve()}removeMatchingKeys(e,t,r){this._i.zr(t,r);const s=this.persistence.referenceDelegate,i=[];return s&&t.forEach(o=>{i.push(s.markPotentiallyOrphaned(e,o))}),V.waitFor(i)}removeMatchingKeysForTargetId(e,t){return this._i.jr(t),V.resolve()}getMatchingKeysForTargetId(e,t){const r=this._i.Hr(t);return V.resolve(r)}containsKey(e,t){return V.resolve(this._i.containsKey(t))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Xw{constructor(e,t){this.ui={},this.overlays={},this.ci=new Ir(0),this.li=!1,this.li=!0,this.hi=new k6,this.referenceDelegate=e(this),this.Pi=new L6(this),this.indexManager=new w6,this.remoteDocumentCache=function(s){return new D6(s)}(r=>this.referenceDelegate.Ti(r)),this.serializer=new ck(t),this.Ii=new R6(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.li=!1,Promise.resolve()}get started(){return this.li}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let t=this.overlays[e.toKey()];return t||(t=new N6,this.overlays[e.toKey()]=t),t}getMutationQueue(e,t){let r=this.ui[e.toKey()];return r||(r=new P6(t,this.referenceDelegate),this.ui[e.toKey()]=r),r}getGlobalsCache(){return this.hi}getTargetCache(){return this.Pi}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.Ii}runTransaction(e,t,r){Y("MemoryPersistence","Starting transaction:",e);const s=new M6(this.ci.next());return this.referenceDelegate.Ei(),r(s).next(i=>this.referenceDelegate.di(s).next(()=>i)).toPromise().then(i=>(s.raiseOnCommittedEvent(),i))}Ai(e,t){return V.or(Object.values(this.ui).map(r=>()=>r.containsKey(e,t)))}}class M6 extends XR{constructor(e){super(),this.currentSequenceNumber=e}}class wm{constructor(e){this.persistence=e,this.Ri=new Jw,this.Vi=null}static mi(e){return new wm(e)}get fi(){if(this.Vi)return this.Vi;throw fe(60996)}addReference(e,t,r){return this.Ri.addReference(r,t),this.fi.delete(r.toString()),V.resolve()}removeReference(e,t,r){return this.Ri.removeReference(r,t),this.fi.add(r.toString()),V.resolve()}markPotentiallyOrphaned(e,t){return this.fi.add(t.toString()),V.resolve()}removeTarget(e,t){this.Ri.jr(t.targetId).forEach(s=>this.fi.add(s.toString()));const r=this.persistence.getTargetCache();return r.getMatchingKeysForTargetId(e,t.targetId).next(s=>{s.forEach(i=>this.fi.add(i.toString()))}).next(()=>r.removeTargetData(e,t))}Ei(){this.Vi=new Set}di(e){const t=this.persistence.getRemoteDocumentCache().newChangeBuffer();return V.forEach(this.fi,r=>{const s=re.fromPath(r);return this.gi(e,s).next(i=>{i||t.removeEntry(s,Ie.min())})}).next(()=>(this.Vi=null,t.apply(e)))}updateLimboDocument(e,t){return this.gi(e,t).next(r=>{r?this.fi.delete(t.toString()):this.fi.add(t.toString())})}Ti(e){return 0}gi(e,t){return V.or([()=>V.resolve(this.Ri.containsKey(t)),()=>this.persistence.getTargetCache().containsKey(e,t),()=>this.persistence.Ai(e,t)])}}class lg{constructor(e,t){this.persistence=e,this.pi=new Di(r=>ar(r.path),(r,s)=>r.isEqual(s)),this.garbageCollector=vk(this,t)}static mi(e,t){return new lg(e,t)}Ei(){}di(e){return V.resolve()}forEachTarget(e,t){return this.persistence.getTargetCache().forEachTarget(e,t)}gr(e){const t=this.wr(e);return this.persistence.getTargetCache().getTargetCount(e).next(r=>t.next(s=>r+s))}wr(e){let t=0;return this.pr(e,r=>{t++}).next(()=>t)}pr(e,t){return V.forEach(this.pi,(r,s)=>this.br(e,r,s).next(i=>i?V.resolve():t(s)))}removeTargets(e,t,r){return this.persistence.getTargetCache().removeTargets(e,t,r)}removeOrphanedDocuments(e,t){let r=0;const s=this.persistence.getRemoteDocumentCache(),i=s.newChangeBuffer();return s.ii(e,o=>this.br(e,o,t).next(a=>{a||(r++,i.removeEntry(o,Ie.min()))})).next(()=>i.apply(e)).next(()=>r)}markPotentiallyOrphaned(e,t){return this.pi.set(t,e.currentSequenceNumber),V.resolve()}removeTarget(e,t){const r=t.withSequenceNumber(e.currentSequenceNumber);return this.persistence.getTargetCache().updateTargetData(e,r)}addReference(e,t,r){return this.pi.set(r,e.currentSequenceNumber),V.resolve()}removeReference(e,t,r){return this.pi.set(r,e.currentSequenceNumber),V.resolve()}updateLimboDocument(e,t){return this.pi.set(t,e.currentSequenceNumber),V.resolve()}Ti(e){let t=e.key.toString().length;return e.isFoundDocument()&&(t+=Jf(e.data.value)),t}br(e,t,r){return V.or([()=>this.persistence.Ai(e,t),()=>this.persistence.getTargetCache().containsKey(e,t),()=>{const s=this.pi.get(t);return V.resolve(s!==void 0&&s>r)}])}getCacheSize(e){return this.persistence.getRemoteDocumentCache().getSize(e)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class j6{constructor(e){this.serializer=e}k(e,t,r,s){const i=new om("createOrUpgrade",t);r<1&&s>=1&&(function(l){l.createObjectStore(Ih)}(e),function(l){l.createObjectStore(Fd,{keyPath:n3}),l.createObjectStore(ps,{keyPath:UE,autoIncrement:!0}).createIndex(fa,$E,{unique:!0}),l.createObjectStore(_c)}(e),NT(e),function(l){l.createObjectStore(sa)}(e));let o=V.resolve();return r<3&&s>=3&&(r!==0&&(function(l){l.deleteObjectStore(wc),l.deleteObjectStore(vc),l.deleteObjectStore(wa)}(e),NT(e)),o=o.next(()=>function(l){const u=l.store(wa),h={highestTargetId:0,highestListenSequenceNumber:0,lastRemoteSnapshotVersion:Ie.min().toTimestamp(),targetCount:0};return u.put(tg,h)}(i))),r<4&&s>=4&&(r!==0&&(o=o.next(()=>function(l,u){return u.store(ps).J().next(f=>{l.deleteObjectStore(ps),l.createObjectStore(ps,{keyPath:UE,autoIncrement:!0}).createIndex(fa,$E,{unique:!0});const p=u.store(ps),y=f.map(w=>p.put(w));return V.waitFor(y)})}(e,i))),o=o.next(()=>{(function(l){l.createObjectStore(xc,{keyPath:d3})})(e)})),r<5&&s>=5&&(o=o.next(()=>this.yi(i))),r<6&&s>=6&&(o=o.next(()=>(function(l){l.createObjectStore(Ud)}(e),this.wi(i)))),r<7&&s>=7&&(o=o.next(()=>this.Si(i))),r<8&&s>=8&&(o=o.next(()=>this.bi(e,i))),r<9&&s>=9&&(o=o.next(()=>{(function(l){l.objectStoreNames.contains("remoteDocumentChanges")&&l.deleteObjectStore("remoteDocumentChanges")})(e)})),r<10&&s>=10&&(o=o.next(()=>this.Di(i))),r<11&&s>=11&&(o=o.next(()=>{(function(l){l.createObjectStore(am,{keyPath:h3})})(e),function(l){l.createObjectStore(lm,{keyPath:f3})}(e)})),r<12&&s>=12&&(o=o.next(()=>{(function(l){const u=l.createObjectStore(cm,{keyPath:w3});u.createIndex(xv,x3,{unique:!1}),u.createIndex(oN,I3,{unique:!1})})(e)})),r<13&&s>=13&&(o=o.next(()=>function(l){const u=l.createObjectStore(eg,{keyPath:s3});u.createIndex(Kf,i3),u.createIndex(nN,o3)}(e)).next(()=>this.Ci(e,i)).next(()=>e.deleteObjectStore(sa))),r<14&&s>=14&&(o=o.next(()=>this.Fi(e,i))),r<15&&s>=15&&(o=o.next(()=>function(l){l.createObjectStore(Ow,{keyPath:p3,autoIncrement:!0}).createIndex(wv,g3,{unique:!1}),l.createObjectStore(Zu,{keyPath:m3}).createIndex(sN,y3,{unique:!1}),l.createObjectStore(ed,{keyPath:_3}).createIndex(iN,v3,{unique:!1})}(e))),r<16&&s>=16&&(o=o.next(()=>{t.objectStore(Zu).clear()}).next(()=>{t.objectStore(ed).clear()})),r<17&&s>=17&&(o=o.next(()=>{(function(l){l.createObjectStore(Lw,{keyPath:S3})})(e)})),r<18&&s>=18&&c1()&&(o=o.next(()=>{t.objectStore(Zu).clear()}).next(()=>{t.objectStore(ed).clear()})),o}wi(e){let t=0;return e.store(sa).ee((r,s)=>{t+=ag(s)}).next(()=>{const r={byteSize:t};return e.store(Ud).put(vv,r)})}yi(e){const t=e.store(Fd),r=e.store(ps);return t.J().next(s=>V.forEach(s,i=>{const o=IDBKeyRange.bound([i.userId,xo],[i.userId,i.lastAcknowledgedBatchId]);return r.J(fa,o).next(a=>V.forEach(a,l=>{_e(l.userId===i.userId,18650,"Cannot process batch from unexpected user",{batchId:l.batchId});const u=oa(this.serializer,l);return pk(e,i.userId,u).next(()=>{})}))}))}Si(e){const t=e.store(wc),r=e.store(sa);return e.store(wa).get(tg).next(s=>{const i=[];return r.ee((o,a)=>{const l=new rt(o),u=function(f){return[0,ar(f)]}(l);i.push(t.get(u).next(h=>h?V.resolve():(f=>t.put({targetId:0,path:ar(f),sequenceNumber:s.highestListenSequenceNumber}))(l)))}).next(()=>V.waitFor(i))})}bi(e,t){e.createObjectStore($d,{keyPath:u3});const r=t.store($d),s=new Yw,i=o=>{if(s.add(o)){const a=o.lastSegment(),l=o.popLast();return r.put({collectionId:a,parent:ar(l)})}};return t.store(sa).ee({X:!0},(o,a)=>{const l=new rt(o);return i(l.popLast())}).next(()=>t.store(_c).ee({X:!0},([o,a,l],u)=>{const h=$s(a);return i(h.popLast())}))}Di(e){const t=e.store(vc);return t.ee((r,s)=>{const i=Lu(s),o=uk(this.serializer,i);return t.put(o)})}Ci(e,t){const r=t.store(sa),s=[];return r.ee((i,o)=>{const a=t.store(eg),l=function(f){return f.document?new re(rt.fromString(f.document.name).popFirst(5)):f.noDocument?re.fromSegments(f.noDocument.path):f.unknownDocument?re.fromSegments(f.unknownDocument.path):fe(36783)}(o).path.toArray(),u={prefixPath:l.slice(0,l.length-2),collectionGroup:l[l.length-2],documentId:l[l.length-1],readTime:o.readTime||[0,0],unknownDocument:o.unknownDocument,noDocument:o.noDocument,document:o.document,hasCommittedMutations:!!o.hasCommittedMutations};s.push(a.put(u))}).next(()=>V.waitFor(s))}Fi(e,t){const r=t.store(ps),s=xk(this.serializer),i=new Xw(wm.mi,this.serializer.yt);return r.J().next(o=>{const a=new Map;return o.forEach(l=>{let u=a.get(l.userId)??He();oa(this.serializer,l).keys().forEach(h=>u=u.add(h)),a.set(l.userId,u)}),V.forEach(a,(l,u)=>{const h=new On(u),f=_m.wt(this.serializer,h),p=i.getIndexManager(h),y=vm.wt(h,this.serializer,p,i.referenceDelegate);return new Ik(s,y,f,p).recalculateAndSaveOverlaysForDocumentKeys(new Iv(t,Ir.ce),l).next()})})}}function NT(n){n.createObjectStore(wc,{keyPath:l3}).createIndex(Dw,c3,{unique:!0}),n.createObjectStore(vc,{keyPath:"targetId"}).createIndex(rN,a3,{unique:!0}),n.createObjectStore(wa)}const qi="IndexedDbPersistence",Ly=18e5,My=5e3,jy="Failed to obtain exclusive access to the persistence layer. To allow shared access, multi-tab synchronization has to be enabled in all tabs. If you are using `experimentalForceOwningTab:true`, make sure that only one tab has persistence enabled at any given time.",Sk="main";class Zw{constructor(e,t,r,s,i,o,a,l,u,h,f=18){if(this.allowTabSynchronization=e,this.persistenceKey=t,this.clientId=r,this.Mi=i,this.window=o,this.document=a,this.xi=u,this.Oi=h,this.Ni=f,this.ci=null,this.li=!1,this.isPrimary=!1,this.networkEnabled=!0,this.Bi=null,this.inForeground=!1,this.Li=null,this.ki=null,this.qi=Number.NEGATIVE_INFINITY,this.Qi=p=>Promise.resolve(),!Zw.v())throw new W(F.UNIMPLEMENTED,"This platform is either missing IndexedDB or is known to have an incomplete implementation. Offline persistence has been disabled.");this.referenceDelegate=new T6(this,s),this.$i=t+Sk,this.serializer=new ck(l),this.Ui=new Qs(this.$i,this.Ni,new j6(this.serializer)),this.hi=new p6,this.Pi=new I6(this.referenceDelegate,this.serializer),this.remoteDocumentCache=xk(this.serializer),this.Ii=new f6,this.window&&this.window.localStorage?this.Ki=this.window.localStorage:(this.Ki=null,h===!1&&pn(qi,"LocalStorage is unavailable. As a result, persistence may not work reliably. In particular enablePersistence() could fail immediately after refreshing the page."))}start(){return this.Wi().then(()=>{if(!this.isPrimary&&!this.allowTabSynchronization)throw new W(F.FAILED_PRECONDITION,jy);return this.Gi(),this.zi(),this.ji(),this.runTransaction("getHighestListenSequenceNumber","readonly",e=>this.Pi.getHighestSequenceNumber(e))}).then(e=>{this.ci=new Ir(e,this.xi)}).then(()=>{this.li=!0}).catch(e=>(this.Ui&&this.Ui.close(),Promise.reject(e)))}Ji(e){return this.Qi=async t=>{if(this.started)return e(t)},e(this.isPrimary)}setDatabaseDeletedListener(e){this.Ui.$(async t=>{t.newVersion===null&&await e()})}setNetworkEnabled(e){this.networkEnabled!==e&&(this.networkEnabled=e,this.Mi.enqueueAndForget(async()=>{this.started&&await this.Wi()}))}Wi(){return this.runTransaction("updateClientMetadataAndTryBecomePrimary","readwrite",e=>Ef(e).put({clientId:this.clientId,updateTimeMs:Date.now(),networkEnabled:this.networkEnabled,inForeground:this.inForeground}).next(()=>{if(this.isPrimary)return this.Hi(e).next(t=>{t||(this.isPrimary=!1,this.Mi.enqueueRetryable(()=>this.Qi(!1)))})}).next(()=>this.Yi(e)).next(t=>this.isPrimary&&!t?this.Zi(e).next(()=>!1):!!t&&this.Xi(e).next(()=>!0))).catch(e=>{if(Bo(e))return Y(qi,"Failed to extend owner lease: ",e),this.isPrimary;if(!this.allowTabSynchronization)throw e;return Y(qi,"Releasing owner lease after error during lease refresh",e),!1}).then(e=>{this.isPrimary!==e&&this.Mi.enqueueRetryable(()=>this.Qi(e)),this.isPrimary=e})}Hi(e){return Su(e).get(ml).next(t=>V.resolve(this.es(t)))}ts(e){return Ef(e).delete(this.clientId)}async ns(){if(this.isPrimary&&!this.rs(this.qi,Ly)){this.qi=Date.now();const e=await this.runTransaction("maybeGarbageCollectMultiClientState","readwrite-primary",t=>{const r=Rn(t,xc);return r.J().next(s=>{const i=this.ss(s,Ly),o=s.filter(a=>i.indexOf(a)===-1);return V.forEach(o,a=>r.delete(a.clientId)).next(()=>o)})}).catch(()=>[]);if(this.Ki)for(const t of e)this.Ki.removeItem(this._s(t.clientId))}}ji(){this.ki=this.Mi.enqueueAfterDelay("client_metadata_refresh",4e3,()=>this.Wi().then(()=>this.ns()).then(()=>this.ji()))}es(e){return!!e&&e.ownerId===this.clientId}Yi(e){return this.Oi?V.resolve(!0):Su(e).get(ml).next(t=>{if(t!==null&&this.rs(t.leaseTimestampMs,My)&&!this.us(t.ownerId)){if(this.es(t)&&this.networkEnabled)return!0;if(!this.es(t)){if(!t.allowTabSynchronization)throw new W(F.FAILED_PRECONDITION,jy);return!1}}return!(!this.networkEnabled||!this.inForeground)||Ef(e).J().next(r=>this.ss(r,My).find(s=>{if(this.clientId!==s.clientId){const i=!this.networkEnabled&&s.networkEnabled,o=!this.inForeground&&s.inForeground,a=this.networkEnabled===s.networkEnabled;if(i||o&&a)return!0}return!1})===void 0)}).next(t=>(this.isPrimary!==t&&Y(qi,`Client ${t?"is":"is not"} eligible for a primary lease.`),t))}async shutdown(){this.li=!1,this.cs(),this.ki&&(this.ki.cancel(),this.ki=null),this.ls(),this.hs(),await this.Ui.runTransaction("shutdown","readwrite",[Ih,xc],e=>{const t=new Iv(e,Ir.ce);return this.Zi(t).next(()=>this.ts(t))}),this.Ui.close(),this.Ps()}ss(e,t){return e.filter(r=>this.rs(r.updateTimeMs,t)&&!this.us(r.clientId))}Ts(){return this.runTransaction("getActiveClients","readonly",e=>Ef(e).J().next(t=>this.ss(t,Ly).map(r=>r.clientId)))}get started(){return this.li}getGlobalsCache(){return this.hi}getMutationQueue(e,t){return vm.wt(e,this.serializer,t,this.referenceDelegate)}getTargetCache(){return this.Pi}getRemoteDocumentCache(){return this.remoteDocumentCache}getIndexManager(e){return new x6(e,this.serializer.yt.databaseId)}getDocumentOverlayCache(e){return _m.wt(this.serializer,e)}getBundleCache(){return this.Ii}runTransaction(e,t,r){Y(qi,"Starting transaction:",e);const s=t==="readonly"?"readonly":"readwrite",i=function(l){return l===18?b3:l===17?uN:l===16?T3:l===15?Mw:l===14?cN:l===13?lN:l===12?E3:l===11?aN:void fe(60245)}(this.Ni);let o;return this.Ui.runTransaction(e,s,i,a=>(o=new Iv(a,this.ci?this.ci.next():Ir.ce),t==="readwrite-primary"?this.Hi(o).next(l=>!!l||this.Yi(o)).next(l=>{if(!l)throw pn(`Failed to obtain primary lease for action '${e}'.`),this.isPrimary=!1,this.Mi.enqueueRetryable(()=>this.Qi(!1)),new W(F.FAILED_PRECONDITION,JR);return r(o)}).next(l=>this.Xi(o).next(()=>l)):this.Is(o).next(()=>r(o)))).then(a=>(o.raiseOnCommittedEvent(),a))}Is(e){return Su(e).get(ml).next(t=>{if(t!==null&&this.rs(t.leaseTimestampMs,My)&&!this.us(t.ownerId)&&!this.es(t)&&!(this.Oi||this.allowTabSynchronization&&t.allowTabSynchronization))throw new W(F.FAILED_PRECONDITION,jy)})}Xi(e){const t={ownerId:this.clientId,allowTabSynchronization:this.allowTabSynchronization,leaseTimestampMs:Date.now()};return Su(e).put(ml,t)}static v(){return Qs.v()}Zi(e){const t=Su(e);return t.get(ml).next(r=>this.es(r)?(Y(qi,"Releasing primary lease."),t.delete(ml)):V.resolve())}rs(e,t){const r=Date.now();return!(e<r-t)&&(!(e>r)||(pn(`Detected an update time that is in the future: ${e} > ${r}`),!1))}Gi(){this.document!==null&&typeof this.document.addEventListener=="function"&&(this.Li=()=>{this.Mi.enqueueAndForget(()=>(this.inForeground=this.document.visibilityState==="visible",this.Wi()))},this.document.addEventListener("visibilitychange",this.Li),this.inForeground=this.document.visibilityState==="visible")}ls(){this.Li&&(this.document.removeEventListener("visibilitychange",this.Li),this.Li=null)}zi(){var e;typeof((e=this.window)==null?void 0:e.addEventListener)=="function"&&(this.Bi=()=>{this.cs();const t=/(?:Version|Mobile)\/1[456]/;l1()&&(navigator.appVersion.match(t)||navigator.userAgent.match(t))&&this.Mi.enterRestrictedMode(!0),this.Mi.enqueueAndForget(()=>this.shutdown())},this.window.addEventListener("pagehide",this.Bi))}hs(){this.Bi&&(this.window.removeEventListener("pagehide",this.Bi),this.Bi=null)}us(e){var t;try{const r=((t=this.Ki)==null?void 0:t.getItem(this._s(e)))!==null;return Y(qi,`Client '${e}' ${r?"is":"is not"} zombied in LocalStorage`),r}catch(r){return pn(qi,"Failed to get zombied client id.",r),!1}}cs(){if(this.Ki)try{this.Ki.setItem(this._s(this.clientId),String(Date.now()))}catch(e){pn("Failed to set zombie client id.",e)}}Ps(){if(this.Ki)try{this.Ki.removeItem(this._s(this.clientId))}catch{}}_s(e){return`firestore_zombie_${this.persistenceKey}_${e}`}}function Su(n){return Rn(n,Ih)}function Ef(n){return Rn(n,xc)}function ex(n,e){let t=n.projectId;return n.isDefaultDatabase||(t+="."+n.database),"firestore/"+e+"/"+t+"/"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class tx{constructor(e,t,r,s){this.targetId=e,this.fromCache=t,this.Es=r,this.ds=s}static As(e,t){let r=He(),s=He();for(const i of t.docChanges)switch(i.type){case 0:r=r.add(i.doc.key);break;case 1:s=s.add(i.doc.key)}return new tx(e,t.fromCache,r,s)}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class V6{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(e){this._documentReadCount+=e}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ek{constructor(){this.Rs=!1,this.Vs=!1,this.fs=100,this.gs=function(){return l1()?8:ZR(Cn())>0?6:4}()}initialize(e,t){this.ps=e,this.indexManager=t,this.Rs=!0}getDocumentsMatchingQuery(e,t,r,s){const i={result:null};return this.ys(e,t).next(o=>{i.result=o}).next(()=>{if(!i.result)return this.ws(e,t,s,r).next(o=>{i.result=o})}).next(()=>{if(i.result)return;const o=new V6;return this.Ss(e,t,o).next(a=>{if(i.result=a,this.Vs)return this.bs(e,t,o,a.size)})}).next(()=>i.result)}bs(e,t,r,s){return r.documentReadCount<this.fs?(Il()<=st.DEBUG&&Y("QueryEngine","SDK will not create cache indexes for query:",Sl(t),"since it only creates cache indexes for collection contains","more than or equal to",this.fs,"documents"),V.resolve()):(Il()<=st.DEBUG&&Y("QueryEngine","Query:",Sl(t),"scans",r.documentReadCount,"local documents and returns",s,"documents as results."),r.documentReadCount>this.gs*s?(Il()<=st.DEBUG&&Y("QueryEngine","The SDK decides to create cache indexes for query:",Sl(t),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(e,lr(t))):V.resolve())}ys(e,t){if(eT(t))return V.resolve(null);let r=lr(t);return this.indexManager.getIndexType(e,r).next(s=>s===0?null:(t.limit!==null&&s===1&&(t=sg(t,null,"F"),r=lr(t)),this.indexManager.getDocumentsMatchingTarget(e,r).next(i=>{const o=He(...i);return this.ps.getDocuments(e,o).next(a=>this.indexManager.getMinOffset(e,r).next(l=>{const u=this.Ds(t,a);return this.Cs(t,u,o,l.readTime)?this.ys(e,sg(t,null,"F")):this.vs(e,u,t,l)}))})))}ws(e,t,r,s){return eT(t)||s.isEqual(Ie.min())?V.resolve(null):this.ps.getDocuments(e,r).next(i=>{const o=this.Ds(t,i);return this.Cs(t,o,r,s)?V.resolve(null):(Il()<=st.DEBUG&&Y("QueryEngine","Re-using previous result from %s to execute query: %s",s.toString(),Sl(t)),this.vs(e,o,t,KR(s,gc)).next(a=>a))})}Ds(e,t){let r=new bt(ON(e));return t.forEach((s,i)=>{Th(e,i)&&(r=r.add(i))}),r}Cs(e,t,r,s){if(e.limit===null)return!1;if(r.size!==t.size)return!0;const i=e.limitType==="F"?t.last():t.first();return!!i&&(i.hasPendingWrites||i.version.compareTo(s)>0)}Ss(e,t,r){return Il()<=st.DEBUG&&Y("QueryEngine","Using full collection scan to execute query:",Sl(t)),this.ps.getDocumentsMatchingQuery(e,t,Gr.min(),r)}vs(e,t,r,s){return this.ps.getDocumentsMatchingQuery(e,r,s).next(i=>(t.forEach(o=>{i=i.insert(o.key,o)}),i))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const nx="LocalStore",F6=3e8;class U6{constructor(e,t,r,s){this.persistence=e,this.Fs=t,this.serializer=s,this.Ms=new jt(je),this.xs=new Di(i=>La(i),Sh),this.Os=new Map,this.Ns=e.getRemoteDocumentCache(),this.Pi=e.getTargetCache(),this.Ii=e.getBundleCache(),this.Bs(r)}Bs(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new Ik(this.Ns,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.Ns.setIndexManager(this.indexManager),this.Fs.initialize(this.localDocuments,this.indexManager)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",t=>e.collect(t,this.Ms))}}function Tk(n,e,t,r){return new U6(n,e,t,r)}async function bk(n,e){const t=se(n);return await t.persistence.runTransaction("Handle user change","readonly",r=>{let s;return t.mutationQueue.getAllMutationBatches(r).next(i=>(s=i,t.Bs(e),t.mutationQueue.getAllMutationBatches(r))).next(i=>{const o=[],a=[];let l=He();for(const u of s){o.push(u.batchId);for(const h of u.mutations)l=l.add(h.key)}for(const u of i){a.push(u.batchId);for(const h of u.mutations)l=l.add(h.key)}return t.localDocuments.getDocuments(r,l).next(u=>({Ls:u,removedBatchIds:o,addedBatchIds:a}))})})}function $6(n,e){const t=se(n);return t.persistence.runTransaction("Acknowledge batch","readwrite-primary",r=>{const s=e.batch.keys(),i=t.Ns.newChangeBuffer({trackRemovals:!0});return function(a,l,u,h){const f=u.batch,p=f.keys();let y=V.resolve();return p.forEach(w=>{y=y.next(()=>h.getEntry(l,w)).next(S=>{const k=u.docVersions.get(w);_e(k!==null,48541),S.version.compareTo(k)<0&&(f.applyToRemoteDocument(S,u),S.isValidDocument()&&(S.setReadTime(u.commitVersion),h.addEntry(S)))})}),y.next(()=>a.mutationQueue.removeMutationBatch(l,f))}(t,r,e,i).next(()=>i.apply(r)).next(()=>t.mutationQueue.performConsistencyCheck(r)).next(()=>t.documentOverlayCache.removeOverlaysForBatchId(r,s,e.batch.batchId)).next(()=>t.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(r,function(a){let l=He();for(let u=0;u<a.mutationResults.length;++u)a.mutationResults[u].transformResults.length>0&&(l=l.add(a.batch.mutations[u].key));return l}(e))).next(()=>t.localDocuments.getDocuments(r,s))})}function Ak(n){const e=se(n);return e.persistence.runTransaction("Get last remote snapshot version","readonly",t=>e.Pi.getLastRemoteSnapshotVersion(t))}function B6(n,e){const t=se(n),r=e.snapshotVersion;let s=t.Ms;return t.persistence.runTransaction("Apply remote event","readwrite-primary",i=>{const o=t.Ns.newChangeBuffer({trackRemovals:!0});s=t.Ms;const a=[];e.targetChanges.forEach((h,f)=>{const p=s.get(f);if(!p)return;a.push(t.Pi.removeMatchingKeys(i,h.removedDocuments,f).next(()=>t.Pi.addMatchingKeys(i,h.addedDocuments,f)));let y=p.withSequenceNumber(i.currentSequenceNumber);e.targetMismatches.get(f)!==null?y=y.withResumeToken(ln.EMPTY_BYTE_STRING,Ie.min()).withLastLimboFreeSnapshotVersion(Ie.min()):h.resumeToken.approximateByteSize()>0&&(y=y.withResumeToken(h.resumeToken,r)),s=s.insert(f,y),function(S,k,E){return S.resumeToken.approximateByteSize()===0||k.snapshotVersion.toMicroseconds()-S.snapshotVersion.toMicroseconds()>=F6?!0:E.addedDocuments.size+E.modifiedDocuments.size+E.removedDocuments.size>0}(p,y,h)&&a.push(t.Pi.updateTargetData(i,y))});let l=Er(),u=He();if(e.documentUpdates.forEach(h=>{e.resolvedLimboDocuments.has(h)&&a.push(t.persistence.referenceDelegate.updateLimboDocument(i,h))}),a.push(Ck(i,o,e.documentUpdates).next(h=>{l=h.ks,u=h.qs})),!r.isEqual(Ie.min())){const h=t.Pi.getLastRemoteSnapshotVersion(i).next(f=>t.Pi.setTargetsMetadata(i,i.currentSequenceNumber,r));a.push(h)}return V.waitFor(a).next(()=>o.apply(i)).next(()=>t.localDocuments.getLocalViewOfDocuments(i,l,u)).next(()=>l)}).then(i=>(t.Ms=s,i))}function Ck(n,e,t){let r=He(),s=He();return t.forEach(i=>r=r.add(i)),e.getEntries(n,r).next(i=>{let o=Er();return t.forEach((a,l)=>{const u=i.get(a);l.isFoundDocument()!==u.isFoundDocument()&&(s=s.add(a)),l.isNoDocument()&&l.version.isEqual(Ie.min())?(e.removeEntry(a,l.readTime),o=o.insert(a,l)):!u.isValidDocument()||l.version.compareTo(u.version)>0||l.version.compareTo(u.version)===0&&u.hasPendingWrites?(e.addEntry(l),o=o.insert(a,l)):Y(nx,"Ignoring outdated watch update for ",a,". Current version:",u.version," Watch version:",l.version)}),{ks:o,qs:s}})}function z6(n,e){const t=se(n);return t.persistence.runTransaction("Get next mutation batch","readonly",r=>(e===void 0&&(e=xo),t.mutationQueue.getNextMutationBatchAfterBatchId(r,e)))}function Cc(n,e){const t=se(n);return t.persistence.runTransaction("Allocate target","readwrite",r=>{let s;return t.Pi.getTargetData(r,e).next(i=>i?(s=i,V.resolve(s)):t.Pi.allocateTargetId(r).next(o=>(s=new fi(e,o,"TargetPurposeListen",r.currentSequenceNumber),t.Pi.addTargetData(r,s).next(()=>s))))}).then(r=>{const s=t.Ms.get(r.targetId);return(s===null||r.snapshotVersion.compareTo(s.snapshotVersion)>0)&&(t.Ms=t.Ms.insert(r.targetId,r),t.xs.set(e,r.targetId)),r})}async function Rc(n,e,t){const r=se(n),s=r.Ms.get(e),i=t?"readwrite":"readwrite-primary";try{t||await r.persistence.runTransaction("Release target",i,o=>r.persistence.referenceDelegate.removeTarget(o,s))}catch(o){if(!Bo(o))throw o;Y(nx,`Failed to update sequence numbers for target ${e}: ${o}`)}r.Ms=r.Ms.remove(e),r.xs.delete(s.target)}function cg(n,e,t){const r=se(n);let s=Ie.min(),i=He();return r.persistence.runTransaction("Execute query","readwrite",o=>function(l,u,h){const f=se(l),p=f.xs.get(h);return p!==void 0?V.resolve(f.Ms.get(p)):f.Pi.getTargetData(u,h)}(r,o,lr(e)).next(a=>{if(a)return s=a.lastLimboFreeSnapshotVersion,r.Pi.getMatchingKeysForTargetId(o,a.targetId).next(l=>{i=l})}).next(()=>r.Fs.getDocumentsMatchingQuery(o,e,t?s:Ie.min(),t?i:He())).next(a=>(kk(r,DN(e),a),{documents:a,Qs:i})))}function Rk(n,e){const t=se(n),r=se(t.Pi),s=t.Ms.get(e);return s?Promise.resolve(s.target):t.persistence.runTransaction("Get target data","readonly",i=>r.At(i,e).next(o=>o?o.target:null))}function Nk(n,e){const t=se(n),r=t.Os.get(e)||Ie.min();return t.persistence.runTransaction("Get new document changes","readonly",s=>t.Ns.getAllFromCollectionGroup(s,e,KR(r,gc),Number.MAX_SAFE_INTEGER)).then(s=>(kk(t,e,s),s))}function kk(n,e,t){let r=n.Os.get(e)||Ie.min();t.forEach((s,i)=>{i.readTime.compareTo(r)>0&&(r=i.readTime)}),n.Os.set(e,r)}async function q6(n,e,t,r){const s=se(n);let i=He(),o=Er();for(const u of t){const h=e.$s(u.metadata.name);u.document&&(i=i.add(h));const f=e.Us(u);f.setReadTime(e.Ks(u.metadata.readTime)),o=o.insert(h,f)}const a=s.Ns.newChangeBuffer({trackRemovals:!0}),l=await Cc(s,function(h){return lr(zc(rt.fromString(`__bundle__/docs/${h}`)))}(r));return s.persistence.runTransaction("Apply bundle documents","readwrite",u=>Ck(u,a,o).next(h=>(a.apply(u),h)).next(h=>s.Pi.removeMatchingKeysForTargetId(u,l.targetId).next(()=>s.Pi.addMatchingKeys(u,i,l.targetId)).next(()=>s.localDocuments.getLocalViewOfDocuments(u,h.ks,h.qs)).next(()=>h.ks)))}async function W6(n,e,t=He()){const r=await Cc(n,lr(ym(e.bundledQuery))),s=se(n);return s.persistence.runTransaction("Save named query","readwrite",i=>{const o=gn(e.readTime);if(r.snapshotVersion.compareTo(o)>=0)return s.Ii.saveNamedQuery(i,e);const a=r.withResumeToken(ln.EMPTY_BYTE_STRING,o);return s.Ms=s.Ms.insert(a.targetId,a),s.Pi.updateTargetData(i,a).next(()=>s.Pi.removeMatchingKeysForTargetId(i,r.targetId)).next(()=>s.Pi.addMatchingKeys(i,t,r.targetId)).next(()=>s.Ii.saveNamedQuery(i,e))})}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Pk="firestore_clients";function kT(n,e){return`${Pk}_${n}_${e}`}const Dk="firestore_mutations";function PT(n,e,t){let r=`${Dk}_${n}_${t}`;return e.isAuthenticated()&&(r+=`_${e.uid}`),r}const Ok="firestore_targets";function Vy(n,e){return`${Ok}_${n}_${e}`}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ms="SharedClientState";class ug{constructor(e,t,r,s){this.user=e,this.batchId=t,this.state=r,this.error=s}static Ws(e,t,r){const s=JSON.parse(r);let i,o=typeof s=="object"&&["pending","acknowledged","rejected"].indexOf(s.state)!==-1&&(s.error===void 0||typeof s.error=="object");return o&&s.error&&(o=typeof s.error.message=="string"&&typeof s.error.code=="string",o&&(i=new W(s.error.code,s.error.message))),o?new ug(e,t,s.state,i):(pn(Ms,`Failed to parse mutation state for ID '${t}': ${r}`),null)}Gs(){const e={state:this.state,updateTimeMs:Date.now()};return this.error&&(e.error={code:this.error.code,message:this.error.message}),JSON.stringify(e)}}class id{constructor(e,t,r){this.targetId=e,this.state=t,this.error=r}static Ws(e,t){const r=JSON.parse(t);let s,i=typeof r=="object"&&["not-current","current","rejected"].indexOf(r.state)!==-1&&(r.error===void 0||typeof r.error=="object");return i&&r.error&&(i=typeof r.error.message=="string"&&typeof r.error.code=="string",i&&(s=new W(r.error.code,r.error.message))),i?new id(e,r.state,s):(pn(Ms,`Failed to parse target state for ID '${e}': ${t}`),null)}Gs(){const e={state:this.state,updateTimeMs:Date.now()};return this.error&&(e.error={code:this.error.code,message:this.error.message}),JSON.stringify(e)}}class dg{constructor(e,t){this.clientId=e,this.activeTargetIds=t}static Ws(e,t){const r=JSON.parse(t);let s=typeof r=="object"&&r.activeTargetIds instanceof Array,i=$w();for(let o=0;s&&o<r.activeTargetIds.length;++o)s=eN(r.activeTargetIds[o]),i=i.add(r.activeTargetIds[o]);return s?new dg(e,i):(pn(Ms,`Failed to parse client data for instance '${e}': ${t}`),null)}}class rx{constructor(e,t){this.clientId=e,this.onlineState=t}static Ws(e){const t=JSON.parse(e);return typeof t=="object"&&["Unknown","Online","Offline"].indexOf(t.onlineState)!==-1&&typeof t.clientId=="string"?new rx(t.clientId,t.onlineState):(pn(Ms,`Failed to parse online state: ${e}`),null)}}class Mv{constructor(){this.activeTargetIds=$w()}zs(e){this.activeTargetIds=this.activeTargetIds.add(e)}js(e){this.activeTargetIds=this.activeTargetIds.delete(e)}Gs(){const e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}}class Fy{constructor(e,t,r,s,i){this.window=e,this.Mi=t,this.persistenceKey=r,this.Js=s,this.syncEngine=null,this.onlineStateHandler=null,this.sequenceNumberHandler=null,this.Hs=this.Ys.bind(this),this.Zs=new jt(je),this.started=!1,this.Xs=[];const o=r.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");this.storage=this.window.localStorage,this.currentUser=i,this.eo=kT(this.persistenceKey,this.Js),this.no=function(l){return`firestore_sequence_number_${l}`}(this.persistenceKey),this.Zs=this.Zs.insert(this.Js,new Mv),this.ro=new RegExp(`^${Pk}_${o}_([^_]*)$`),this.io=new RegExp(`^${Dk}_${o}_(\\d+)(?:_(.*))?$`),this.so=new RegExp(`^${Ok}_${o}_(\\d+)$`),this.oo=function(l){return`firestore_online_state_${l}`}(this.persistenceKey),this._o=function(l){return`firestore_bundle_loaded_v2_${l}`}(this.persistenceKey),this.window.addEventListener("storage",this.Hs)}static v(e){return!(!e||!e.localStorage)}async start(){const e=await this.syncEngine.Ts();for(const r of e){if(r===this.Js)continue;const s=this.getItem(kT(this.persistenceKey,r));if(s){const i=dg.Ws(r,s);i&&(this.Zs=this.Zs.insert(i.clientId,i))}}this.ao();const t=this.storage.getItem(this.oo);if(t){const r=this.uo(t);r&&this.co(r)}for(const r of this.Xs)this.Ys(r);this.Xs=[],this.window.addEventListener("pagehide",()=>this.shutdown()),this.started=!0}writeSequenceNumber(e){this.setItem(this.no,JSON.stringify(e))}getAllActiveQueryTargets(){return this.lo(this.Zs)}isActiveQueryTarget(e){let t=!1;return this.Zs.forEach((r,s)=>{s.activeTargetIds.has(e)&&(t=!0)}),t}addPendingMutation(e){this.ho(e,"pending")}updateMutationState(e,t,r){this.ho(e,t,r),this.Po(e)}addLocalQueryTarget(e,t=!0){let r="not-current";if(this.isActiveQueryTarget(e)){const s=this.storage.getItem(Vy(this.persistenceKey,e));if(s){const i=id.Ws(e,s);i&&(r=i.state)}}return t&&this.To.zs(e),this.ao(),r}removeLocalQueryTarget(e){this.To.js(e),this.ao()}isLocalQueryTarget(e){return this.To.activeTargetIds.has(e)}clearQueryState(e){this.removeItem(Vy(this.persistenceKey,e))}updateQueryState(e,t,r){this.Io(e,t,r)}handleUserChange(e,t,r){t.forEach(s=>{this.Po(s)}),this.currentUser=e,r.forEach(s=>{this.addPendingMutation(s)})}setOnlineState(e){this.Eo(e)}notifyBundleLoaded(e){this.Ao(e)}shutdown(){this.started&&(this.window.removeEventListener("storage",this.Hs),this.removeItem(this.eo),this.started=!1)}getItem(e){const t=this.storage.getItem(e);return Y(Ms,"READ",e,t),t}setItem(e,t){Y(Ms,"SET",e,t),this.storage.setItem(e,t)}removeItem(e){Y(Ms,"REMOVE",e),this.storage.removeItem(e)}Ys(e){const t=e;if(t.storageArea===this.storage){if(Y(Ms,"EVENT",t.key,t.newValue),t.key===this.eo)return void pn("Received WebStorage notification for local change. Another client might have garbage-collected our state");this.Mi.enqueueRetryable(async()=>{if(this.started){if(t.key!==null){if(this.ro.test(t.key)){if(t.newValue==null){const r=this.Ro(t.key);return this.Vo(r,null)}{const r=this.mo(t.key,t.newValue);if(r)return this.Vo(r.clientId,r)}}else if(this.io.test(t.key)){if(t.newValue!==null){const r=this.fo(t.key,t.newValue);if(r)return this.po(r)}}else if(this.so.test(t.key)){if(t.newValue!==null){const r=this.yo(t.key,t.newValue);if(r)return this.wo(r)}}else if(t.key===this.oo){if(t.newValue!==null){const r=this.uo(t.newValue);if(r)return this.co(r)}}else if(t.key===this.no){const r=function(i){let o=Ir.ce;if(i!=null)try{const a=JSON.parse(i);_e(typeof a=="number",30636,{So:i}),o=a}catch(a){pn(Ms,"Failed to read sequence number from WebStorage",a)}return o}(t.newValue);r!==Ir.ce&&this.sequenceNumberHandler(r)}else if(t.key===this._o){const r=this.bo(t.newValue);await Promise.all(r.map(s=>this.syncEngine.Do(s)))}}}else this.Xs.push(t)})}}get To(){return this.Zs.get(this.Js)}ao(){this.setItem(this.eo,this.To.Gs())}ho(e,t,r){const s=new ug(this.currentUser,e,t,r),i=PT(this.persistenceKey,this.currentUser,e);this.setItem(i,s.Gs())}Po(e){const t=PT(this.persistenceKey,this.currentUser,e);this.removeItem(t)}Eo(e){const t={clientId:this.Js,onlineState:e};this.storage.setItem(this.oo,JSON.stringify(t))}Io(e,t,r){const s=Vy(this.persistenceKey,e),i=new id(e,t,r);this.setItem(s,i.Gs())}Ao(e){const t=JSON.stringify(Array.from(e));this.setItem(this._o,t)}Ro(e){const t=this.ro.exec(e);return t?t[1]:null}mo(e,t){const r=this.Ro(e);return dg.Ws(r,t)}fo(e,t){const r=this.io.exec(e),s=Number(r[1]),i=r[2]!==void 0?r[2]:null;return ug.Ws(new On(i),s,t)}yo(e,t){const r=this.so.exec(e),s=Number(r[1]);return id.Ws(s,t)}uo(e){return rx.Ws(e)}bo(e){return JSON.parse(e)}async po(e){if(e.user.uid===this.currentUser.uid)return this.syncEngine.Co(e.batchId,e.state,e.error);Y(Ms,`Ignoring mutation for non-active user ${e.user.uid}`)}wo(e){return this.syncEngine.vo(e.targetId,e.state,e.error)}Vo(e,t){const r=t?this.Zs.insert(e,t):this.Zs.remove(e),s=this.lo(this.Zs),i=this.lo(r),o=[],a=[];return i.forEach(l=>{s.has(l)||o.push(l)}),s.forEach(l=>{i.has(l)||a.push(l)}),this.syncEngine.Fo(o,a).then(()=>{this.Zs=r})}co(e){this.Zs.get(e.clientId)&&this.onlineStateHandler(e.onlineState)}lo(e){let t=$w();return e.forEach((r,s)=>{t=t.unionWith(s.activeTargetIds)}),t}}class Lk{constructor(){this.Mo=new Mv,this.xo={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,t,r){}addLocalQueryTarget(e,t=!0){return t&&this.Mo.zs(e),this.xo[e]||"not-current"}updateQueryState(e,t,r){this.xo[e]=t}removeLocalQueryTarget(e){this.Mo.js(e)}isLocalQueryTarget(e){return this.Mo.activeTargetIds.has(e)}clearQueryState(e){delete this.xo[e]}getAllActiveQueryTargets(){return this.Mo.activeTargetIds}isActiveQueryTarget(e){return this.Mo.activeTargetIds.has(e)}start(){return this.Mo=new Mv,Promise.resolve()}handleUserChange(e,t,r){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class G6{Oo(e){}shutdown(){}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const DT="ConnectivityMonitor";class OT{constructor(){this.No=()=>this.Bo(),this.Lo=()=>this.ko(),this.qo=[],this.Qo()}Oo(e){this.qo.push(e)}shutdown(){window.removeEventListener("online",this.No),window.removeEventListener("offline",this.Lo)}Qo(){window.addEventListener("online",this.No),window.addEventListener("offline",this.Lo)}Bo(){Y(DT,"Network connectivity changed: AVAILABLE");for(const e of this.qo)e(0)}ko(){Y(DT,"Network connectivity changed: UNAVAILABLE");for(const e of this.qo)e(1)}static v(){return typeof window<"u"&&window.addEventListener!==void 0&&window.removeEventListener!==void 0}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Tf=null;function jv(){return Tf===null?Tf=function(){return 268435456+Math.round(2147483648*Math.random())}():Tf++,"0x"+Tf.toString(16)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Uy="RestConnection",H6={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};class Q6{get $o(){return!1}constructor(e){this.databaseInfo=e,this.databaseId=e.databaseId;const t=e.ssl?"https":"http",r=encodeURIComponent(this.databaseId.projectId),s=encodeURIComponent(this.databaseId.database);this.Uo=t+"://"+e.host,this.Ko=`projects/${r}/databases/${s}`,this.Wo=this.databaseId.database===zd?`project_id=${r}`:`project_id=${r}&database_id=${s}`}Go(e,t,r,s,i){const o=jv(),a=this.zo(e,t.toUriEncodedString());Y(Uy,`Sending RPC '${e}' ${o}:`,a,r);const l={"google-cloud-resource-prefix":this.Ko,"x-goog-request-params":this.Wo};this.jo(l,s,i);const{host:u}=new URL(a),h=ki(u);return this.Jo(e,a,l,r,h).then(f=>(Y(Uy,`Received RPC '${e}' ${o}: `,f),f),f=>{throw as(Uy,`RPC '${e}' ${o} failed with error: `,f,"url: ",a,"request:",r),f})}Ho(e,t,r,s,i,o){return this.Go(e,t,r,s,i)}jo(e,t,r){e["X-Goog-Api-Client"]=function(){return"gl-js/ fire/"+Bc}(),e["Content-Type"]="text/plain",this.databaseInfo.appId&&(e["X-Firebase-GMPID"]=this.databaseInfo.appId),t&&t.headers.forEach((s,i)=>e[i]=s),r&&r.headers.forEach((s,i)=>e[i]=s)}zo(e,t){const r=H6[e];return`${this.Uo}/v1/${t}:${r}`}terminate(){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class K6{constructor(e){this.Yo=e.Yo,this.Zo=e.Zo}Xo(e){this.e_=e}t_(e){this.n_=e}r_(e){this.i_=e}onMessage(e){this.s_=e}close(){this.Zo()}send(e){this.Yo(e)}o_(){this.e_()}__(){this.n_()}a_(e){this.i_(e)}u_(e){this.s_(e)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const rr="WebChannelConnection";class Y6 extends Q6{constructor(e){super(e),this.c_=[],this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams,this.longPollingOptions=e.longPollingOptions}Jo(e,t,r,s,i){const o=jv();return new Promise((a,l)=>{const u=new FR;u.setWithCredentials(!0),u.listenOnce(UR.COMPLETE,()=>{try{switch(u.getLastErrorCode()){case Hf.NO_ERROR:const f=u.getResponseJson();Y(rr,`XHR for RPC '${e}' ${o} received:`,JSON.stringify(f)),a(f);break;case Hf.TIMEOUT:Y(rr,`RPC '${e}' ${o} timed out`),l(new W(F.DEADLINE_EXCEEDED,"Request time out"));break;case Hf.HTTP_ERROR:const p=u.getStatus();if(Y(rr,`RPC '${e}' ${o} failed with status:`,p,"response text:",u.getResponseText()),p>0){let y=u.getResponseJson();Array.isArray(y)&&(y=y[0]);const w=y==null?void 0:y.error;if(w&&w.status&&w.message){const S=function(E){const x=E.toLowerCase().replace(/_/g,"-");return Object.values(F).indexOf(x)>=0?x:F.UNKNOWN}(w.status);l(new W(S,w.message))}else l(new W(F.UNKNOWN,"Server responded with status "+u.getStatus()))}else l(new W(F.UNAVAILABLE,"Connection failed."));break;default:fe(9055,{l_:e,streamId:o,h_:u.getLastErrorCode(),P_:u.getLastError()})}}finally{Y(rr,`RPC '${e}' ${o} completed.`)}});const h=JSON.stringify(s);Y(rr,`RPC '${e}' ${o} sending request:`,s),u.send(t,"POST",h,r,15)})}T_(e,t,r){const s=jv(),i=[this.Uo,"/","google.firestore.v1.Firestore","/",e,"/channel"],o=zR(),a=BR(),l={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},u=this.longPollingOptions.timeoutSeconds;u!==void 0&&(l.longPollingTimeout=Math.round(1e3*u)),this.useFetchStreams&&(l.useFetchStreams=!0),this.jo(l.initMessageHeaders,t,r),l.encodeInitMessageHeaders=!0;const h=i.join("");Y(rr,`Creating RPC '${e}' stream ${s}: ${h}`,l);const f=o.createWebChannel(h,l);this.I_(f);let p=!1,y=!1;const w=new K6({Yo:k=>{y?Y(rr,`Not sending because RPC '${e}' stream ${s} is closed:`,k):(p||(Y(rr,`Opening RPC '${e}' stream ${s} transport.`),f.open(),p=!0),Y(rr,`RPC '${e}' stream ${s} sending:`,k),f.send(k))},Zo:()=>f.close()}),S=(k,E,x)=>{k.listen(E,N=>{try{x(N)}catch(P){setTimeout(()=>{throw P},0)}})};return S(f,Pu.EventType.OPEN,()=>{y||(Y(rr,`RPC '${e}' stream ${s} transport opened.`),w.o_())}),S(f,Pu.EventType.CLOSE,()=>{y||(y=!0,Y(rr,`RPC '${e}' stream ${s} transport closed`),w.a_(),this.E_(f))}),S(f,Pu.EventType.ERROR,k=>{y||(y=!0,as(rr,`RPC '${e}' stream ${s} transport errored. Name:`,k.name,"Message:",k.message),w.a_(new W(F.UNAVAILABLE,"The operation could not be completed")))}),S(f,Pu.EventType.MESSAGE,k=>{var E;if(!y){const x=k.data[0];_e(!!x,16349);const N=x,P=(N==null?void 0:N.error)||((E=N[0])==null?void 0:E.error);if(P){Y(rr,`RPC '${e}' stream ${s} received error:`,P);const $=P.status;let L=function(T){const C=_n[T];if(C!==void 0)return QN(C)}($),R=P.message;L===void 0&&(L=F.INTERNAL,R="Unknown error status: "+$+" with message "+P.message),y=!0,w.a_(new W(L,R)),f.close()}else Y(rr,`RPC '${e}' stream ${s} received:`,x),w.u_(x)}}),S(a,$R.STAT_EVENT,k=>{k.stat===pv.PROXY?Y(rr,`RPC '${e}' stream ${s} detected buffering proxy`):k.stat===pv.NOPROXY&&Y(rr,`RPC '${e}' stream ${s} detected no buffering proxy`)}),setTimeout(()=>{w.__()},0),w}terminate(){this.c_.forEach(e=>e.close()),this.c_=[]}I_(e){this.c_.push(e)}E_(e){this.c_=this.c_.filter(t=>t===e)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Mk(){return typeof window<"u"?window:null}function np(){return typeof document<"u"?document:null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function el(n){return new n6(n,!0)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class sx{constructor(e,t,r=1e3,s=1.5,i=6e4){this.Mi=e,this.timerId=t,this.d_=r,this.A_=s,this.R_=i,this.V_=0,this.m_=null,this.f_=Date.now(),this.reset()}reset(){this.V_=0}g_(){this.V_=this.R_}p_(e){this.cancel();const t=Math.floor(this.V_+this.y_()),r=Math.max(0,Date.now()-this.f_),s=Math.max(0,t-r);s>0&&Y("ExponentialBackoff",`Backing off for ${s} ms (base delay: ${this.V_} ms, delay with jitter: ${t} ms, last attempt: ${r} ms ago)`),this.m_=this.Mi.enqueueAfterDelay(this.timerId,s,()=>(this.f_=Date.now(),e())),this.V_*=this.A_,this.V_<this.d_&&(this.V_=this.d_),this.V_>this.R_&&(this.V_=this.R_)}w_(){this.m_!==null&&(this.m_.skipDelay(),this.m_=null)}cancel(){this.m_!==null&&(this.m_.cancel(),this.m_=null)}y_(){return(Math.random()-.5)*this.V_}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const LT="PersistentStream";class jk{constructor(e,t,r,s,i,o,a,l){this.Mi=e,this.S_=r,this.b_=s,this.connection=i,this.authCredentialsProvider=o,this.appCheckCredentialsProvider=a,this.listener=l,this.state=0,this.D_=0,this.C_=null,this.v_=null,this.stream=null,this.F_=0,this.M_=new sx(e,t)}x_(){return this.state===1||this.state===5||this.O_()}O_(){return this.state===2||this.state===3}start(){this.F_=0,this.state!==4?this.auth():this.N_()}async stop(){this.x_()&&await this.close(0)}B_(){this.state=0,this.M_.reset()}L_(){this.O_()&&this.C_===null&&(this.C_=this.Mi.enqueueAfterDelay(this.S_,6e4,()=>this.k_()))}q_(e){this.Q_(),this.stream.send(e)}async k_(){if(this.O_())return this.close(0)}Q_(){this.C_&&(this.C_.cancel(),this.C_=null)}U_(){this.v_&&(this.v_.cancel(),this.v_=null)}async close(e,t){this.Q_(),this.U_(),this.M_.cancel(),this.D_++,e!==4?this.M_.reset():t&&t.code===F.RESOURCE_EXHAUSTED?(pn(t.toString()),pn("Using maximum backoff delay to prevent overloading the backend."),this.M_.g_()):t&&t.code===F.UNAUTHENTICATED&&this.state!==3&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),this.stream!==null&&(this.K_(),this.stream.close(),this.stream=null),this.state=e,await this.listener.r_(t)}K_(){}auth(){this.state=1;const e=this.W_(this.D_),t=this.D_;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then(([r,s])=>{this.D_===t&&this.G_(r,s)},r=>{e(()=>{const s=new W(F.UNKNOWN,"Fetching auth token failed: "+r.message);return this.z_(s)})})}G_(e,t){const r=this.W_(this.D_);this.stream=this.j_(e,t),this.stream.Xo(()=>{r(()=>this.listener.Xo())}),this.stream.t_(()=>{r(()=>(this.state=2,this.v_=this.Mi.enqueueAfterDelay(this.b_,1e4,()=>(this.O_()&&(this.state=3),Promise.resolve())),this.listener.t_()))}),this.stream.r_(s=>{r(()=>this.z_(s))}),this.stream.onMessage(s=>{r(()=>++this.F_==1?this.J_(s):this.onNext(s))})}N_(){this.state=5,this.M_.p_(async()=>{this.state=0,this.start()})}z_(e){return Y(LT,`close with error: ${e}`),this.stream=null,this.close(4,e)}W_(e){return t=>{this.Mi.enqueueAndForget(()=>this.D_===e?t():(Y(LT,"stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve()))}}}class J6 extends jk{constructor(e,t,r,s,i,o){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",t,r,s,o),this.serializer=i}j_(e,t){return this.connection.T_("Listen",e,t)}J_(e){return this.onNext(e)}onNext(e){this.M_.reset();const t=i6(this.serializer,e),r=function(i){if(!("targetChange"in i))return Ie.min();const o=i.targetChange;return o.targetIds&&o.targetIds.length?Ie.min():o.readTime?gn(o.readTime):Ie.min()}(e);return this.listener.H_(t,r)}Y_(e){const t={};t.database=kv(this.serializer),t.addTarget=function(i,o){let a;const l=o.target;if(a=ng(l)?{documents:rk(i,l)}:{query:mm(i,l).ft},a.targetId=o.targetId,o.resumeToken.approximateByteSize()>0){a.resumeToken=XN(i,o.resumeToken);const u=Rv(i,o.expectedCount);u!==null&&(a.expectedCount=u)}else if(o.snapshotVersion.compareTo(Ie.min())>0){a.readTime=Ac(i,o.snapshotVersion.toTimestamp());const u=Rv(i,o.expectedCount);u!==null&&(a.expectedCount=u)}return a}(this.serializer,e);const r=a6(this.serializer,e);r&&(t.labels=r),this.q_(t)}Z_(e){const t={};t.database=kv(this.serializer),t.removeTarget=e,this.q_(t)}}class X6 extends jk{constructor(e,t,r,s,i,o){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",t,r,s,o),this.serializer=i}get X_(){return this.F_>0}start(){this.lastStreamToken=void 0,super.start()}K_(){this.X_&&this.ea([])}j_(e,t){return this.connection.T_("Write",e,t)}J_(e){return _e(!!e.streamToken,31322),this.lastStreamToken=e.streamToken,_e(!e.writeResults||e.writeResults.length===0,55816),this.listener.ta()}onNext(e){_e(!!e.streamToken,12678),this.lastStreamToken=e.streamToken,this.M_.reset();const t=o6(e.writeResults,e.commitTime),r=gn(e.commitTime);return this.listener.na(r,t)}ra(){const e={};e.database=kv(this.serializer),this.q_(e)}ea(e){const t={streamToken:this.lastStreamToken,writes:e.map(r=>Qd(this.serializer,r))};this.q_(t)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Z6{}class e5 extends Z6{constructor(e,t,r,s){super(),this.authCredentials=e,this.appCheckCredentials=t,this.connection=r,this.serializer=s,this.ia=!1}sa(){if(this.ia)throw new W(F.FAILED_PRECONDITION,"The client has already been terminated.")}Go(e,t,r,s){return this.sa(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([i,o])=>this.connection.Go(e,Nv(t,r),s,i,o)).catch(i=>{throw i.name==="FirebaseError"?(i.code===F.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),i):new W(F.UNKNOWN,i.toString())})}Ho(e,t,r,s,i){return this.sa(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([o,a])=>this.connection.Ho(e,Nv(t,r),s,o,a,i)).catch(o=>{throw o.name==="FirebaseError"?(o.code===F.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),o):new W(F.UNKNOWN,o.toString())})}terminate(){this.ia=!0,this.connection.terminate()}}class t5{constructor(e,t){this.asyncQueue=e,this.onlineStateHandler=t,this.state="Unknown",this.oa=0,this._a=null,this.aa=!0}ua(){this.oa===0&&(this.ca("Unknown"),this._a=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,()=>(this._a=null,this.la("Backend didn't respond within 10 seconds."),this.ca("Offline"),Promise.resolve())))}ha(e){this.state==="Online"?this.ca("Unknown"):(this.oa++,this.oa>=1&&(this.Pa(),this.la(`Connection failed 1 times. Most recent error: ${e.toString()}`),this.ca("Offline")))}set(e){this.Pa(),this.oa=0,e==="Online"&&(this.aa=!1),this.ca(e)}ca(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}la(e){const t=`Could not reach Cloud Firestore backend. ${e}
This typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.aa?(pn(t),this.aa=!1):Y("OnlineStateTracker",t)}Pa(){this._a!==null&&(this._a.cancel(),this._a=null)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const $a="RemoteStore";class n5{constructor(e,t,r,s,i){this.localStore=e,this.datastore=t,this.asyncQueue=r,this.remoteSyncer={},this.Ta=[],this.Ia=new Map,this.Ea=new Set,this.da=[],this.Aa=i,this.Aa.Oo(o=>{r.enqueueAndForget(async()=>{qo(this)&&(Y($a,"Restarting streams for network reachability change."),await async function(l){const u=se(l);u.Ea.add(4),await Gc(u),u.Ra.set("Unknown"),u.Ea.delete(4),await Rh(u)}(this))})}),this.Ra=new t5(r,s)}}async function Rh(n){if(qo(n))for(const e of n.da)await e(!0)}async function Gc(n){for(const e of n.da)await e(!1)}function xm(n,e){const t=se(n);t.Ia.has(e.targetId)||(t.Ia.set(e.targetId,e),ax(t)?ox(t):Qc(t).O_()&&ix(t,e))}function Nc(n,e){const t=se(n),r=Qc(t);t.Ia.delete(e),r.O_()&&Vk(t,e),t.Ia.size===0&&(r.O_()?r.L_():qo(t)&&t.Ra.set("Unknown"))}function ix(n,e){if(n.Va.Ue(e.targetId),e.resumeToken.approximateByteSize()>0||e.snapshotVersion.compareTo(Ie.min())>0){const t=n.remoteSyncer.getRemoteKeysForTarget(e.targetId).size;e=e.withExpectedCount(t)}Qc(n).Y_(e)}function Vk(n,e){n.Va.Ue(e),Qc(n).Z_(e)}function ox(n){n.Va=new X3({getRemoteKeysForTarget:e=>n.remoteSyncer.getRemoteKeysForTarget(e),At:e=>n.Ia.get(e)||null,ht:()=>n.datastore.serializer.databaseId}),Qc(n).start(),n.Ra.ua()}function ax(n){return qo(n)&&!Qc(n).x_()&&n.Ia.size>0}function qo(n){return se(n).Ea.size===0}function Fk(n){n.Va=void 0}async function r5(n){n.Ra.set("Online")}async function s5(n){n.Ia.forEach((e,t)=>{ix(n,e)})}async function i5(n,e){Fk(n),ax(n)?(n.Ra.ha(e),ox(n)):n.Ra.set("Unknown")}async function o5(n,e,t){if(n.Ra.set("Online"),e instanceof JN&&e.state===2&&e.cause)try{await async function(s,i){const o=i.cause;for(const a of i.targetIds)s.Ia.has(a)&&(await s.remoteSyncer.rejectListen(a,o),s.Ia.delete(a),s.Va.removeTarget(a))}(n,e)}catch(r){Y($a,"Failed to remove targets %s: %s ",e.targetIds.join(","),r),await hg(n,r)}else if(e instanceof ep?n.Va.Ze(e):e instanceof YN?n.Va.st(e):n.Va.tt(e),!t.isEqual(Ie.min()))try{const r=await Ak(n.localStore);t.compareTo(r)>=0&&await function(i,o){const a=i.Va.Tt(o);return a.targetChanges.forEach((l,u)=>{if(l.resumeToken.approximateByteSize()>0){const h=i.Ia.get(u);h&&i.Ia.set(u,h.withResumeToken(l.resumeToken,o))}}),a.targetMismatches.forEach((l,u)=>{const h=i.Ia.get(l);if(!h)return;i.Ia.set(l,h.withResumeToken(ln.EMPTY_BYTE_STRING,h.snapshotVersion)),Vk(i,l);const f=new fi(h.target,l,u,h.sequenceNumber);ix(i,f)}),i.remoteSyncer.applyRemoteEvent(a)}(n,t)}catch(r){Y($a,"Failed to raise snapshot:",r),await hg(n,r)}}async function hg(n,e,t){if(!Bo(e))throw e;n.Ea.add(1),await Gc(n),n.Ra.set("Offline"),t||(t=()=>Ak(n.localStore)),n.asyncQueue.enqueueRetryable(async()=>{Y($a,"Retrying IndexedDB access"),await t(),n.Ea.delete(1),await Rh(n)})}function Uk(n,e){return e().catch(t=>hg(n,t,e))}async function Hc(n){const e=se(n),t=Oo(e);let r=e.Ta.length>0?e.Ta[e.Ta.length-1].batchId:xo;for(;a5(e);)try{const s=await z6(e.localStore,r);if(s===null){e.Ta.length===0&&t.L_();break}r=s.batchId,l5(e,s)}catch(s){await hg(e,s)}$k(e)&&Bk(e)}function a5(n){return qo(n)&&n.Ta.length<10}function l5(n,e){n.Ta.push(e);const t=Oo(n);t.O_()&&t.X_&&t.ea(e.mutations)}function $k(n){return qo(n)&&!Oo(n).x_()&&n.Ta.length>0}function Bk(n){Oo(n).start()}async function c5(n){Oo(n).ra()}async function u5(n){const e=Oo(n);for(const t of n.Ta)e.ea(t.mutations)}async function d5(n,e,t){const r=n.Ta.shift(),s=Ww.from(r,e,t);await Uk(n,()=>n.remoteSyncer.applySuccessfulWrite(s)),await Hc(n)}async function h5(n,e){e&&Oo(n).X_&&await async function(r,s){if(function(o){return HN(o)&&o!==F.ABORTED}(s.code)){const i=r.Ta.shift();Oo(r).B_(),await Uk(r,()=>r.remoteSyncer.rejectFailedWrite(i.batchId,s)),await Hc(r)}}(n,e),$k(n)&&Bk(n)}async function MT(n,e){const t=se(n);t.asyncQueue.verifyOperationInProgress(),Y($a,"RemoteStore received new credentials");const r=qo(t);t.Ea.add(3),await Gc(t),r&&t.Ra.set("Unknown"),await t.remoteSyncer.handleCredentialChange(e),t.Ea.delete(3),await Rh(t)}async function Vv(n,e){const t=se(n);e?(t.Ea.delete(2),await Rh(t)):e||(t.Ea.add(2),await Gc(t),t.Ra.set("Unknown"))}function Qc(n){return n.ma||(n.ma=function(t,r,s){const i=se(t);return i.sa(),new J6(r,i.connection,i.authCredentials,i.appCheckCredentials,i.serializer,s)}(n.datastore,n.asyncQueue,{Xo:r5.bind(null,n),t_:s5.bind(null,n),r_:i5.bind(null,n),H_:o5.bind(null,n)}),n.da.push(async e=>{e?(n.ma.B_(),ax(n)?ox(n):n.Ra.set("Unknown")):(await n.ma.stop(),Fk(n))})),n.ma}function Oo(n){return n.fa||(n.fa=function(t,r,s){const i=se(t);return i.sa(),new X6(r,i.connection,i.authCredentials,i.appCheckCredentials,i.serializer,s)}(n.datastore,n.asyncQueue,{Xo:()=>Promise.resolve(),t_:c5.bind(null,n),r_:h5.bind(null,n),ta:u5.bind(null,n),na:d5.bind(null,n)}),n.da.push(async e=>{e?(n.fa.B_(),await Hc(n)):(await n.fa.stop(),n.Ta.length>0&&(Y($a,`Stopping write stream with ${n.Ta.length} pending writes`),n.Ta=[]))})),n.fa}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class lx{constructor(e,t,r,s,i){this.asyncQueue=e,this.timerId=t,this.targetTimeMs=r,this.op=s,this.removalCallback=i,this.deferred=new jn,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(o=>{})}get promise(){return this.deferred.promise}static createAndSchedule(e,t,r,s,i){const o=Date.now()+r,a=new lx(e,t,o,s,i);return a.start(r),a}start(e){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){this.timerHandle!==null&&(this.clearTimeout(),this.deferred.reject(new W(F.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>this.timerHandle!==null?(this.clearTimeout(),this.op().then(e=>this.deferred.resolve(e))):Promise.resolve())}clearTimeout(){this.timerHandle!==null&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function Kc(n,e){if(pn("AsyncQueue",`${e}: ${n}`),Bo(n))return new W(F.UNAVAILABLE,`${e}: ${n}`);throw n}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class xa{static emptySet(e){return new xa(e.comparator)}constructor(e){this.comparator=e?(t,r)=>e(t,r)||re.comparator(t.key,r.key):(t,r)=>re.comparator(t.key,r.key),this.keyedMap=Du(),this.sortedSet=new jt(this.comparator)}has(e){return this.keyedMap.get(e)!=null}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){const t=this.keyedMap.get(e);return t?this.sortedSet.indexOf(t):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal((t,r)=>(e(t),!1))}add(e){const t=this.delete(e.key);return t.copy(t.keyedMap.insert(e.key,e),t.sortedSet.insert(e,null))}delete(e){const t=this.get(e);return t?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(t)):this}isEqual(e){if(!(e instanceof xa)||this.size!==e.size)return!1;const t=this.sortedSet.getIterator(),r=e.sortedSet.getIterator();for(;t.hasNext();){const s=t.getNext().key,i=r.getNext().key;if(!s.isEqual(i))return!1}return!0}toString(){const e=[];return this.forEach(t=>{e.push(t.toString())}),e.length===0?"DocumentSet ()":`DocumentSet (
  `+e.join(`  
`)+`
)`}copy(e,t){const r=new xa;return r.comparator=this.comparator,r.keyedMap=e,r.sortedSet=t,r}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class jT{constructor(){this.ga=new jt(re.comparator)}track(e){const t=e.doc.key,r=this.ga.get(t);r?e.type!==0&&r.type===3?this.ga=this.ga.insert(t,e):e.type===3&&r.type!==1?this.ga=this.ga.insert(t,{type:r.type,doc:e.doc}):e.type===2&&r.type===2?this.ga=this.ga.insert(t,{type:2,doc:e.doc}):e.type===2&&r.type===0?this.ga=this.ga.insert(t,{type:0,doc:e.doc}):e.type===1&&r.type===0?this.ga=this.ga.remove(t):e.type===1&&r.type===2?this.ga=this.ga.insert(t,{type:1,doc:r.doc}):e.type===0&&r.type===1?this.ga=this.ga.insert(t,{type:2,doc:e.doc}):fe(63341,{Rt:e,pa:r}):this.ga=this.ga.insert(t,e)}ya(){const e=[];return this.ga.inorderTraversal((t,r)=>{e.push(r)}),e}}class Ba{constructor(e,t,r,s,i,o,a,l,u){this.query=e,this.docs=t,this.oldDocs=r,this.docChanges=s,this.mutatedKeys=i,this.fromCache=o,this.syncStateChanged=a,this.excludesMetadataChanges=l,this.hasCachedResults=u}static fromInitialDocuments(e,t,r,s,i){const o=[];return t.forEach(a=>{o.push({type:0,doc:a})}),new Ba(e,t,xa.emptySet(t),o,r,s,!0,!1,i)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(!(this.fromCache===e.fromCache&&this.hasCachedResults===e.hasCachedResults&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&Eh(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;const t=this.docChanges,r=e.docChanges;if(t.length!==r.length)return!1;for(let s=0;s<t.length;s++)if(t[s].type!==r[s].type||!t[s].doc.isEqual(r[s].doc))return!1;return!0}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class f5{constructor(){this.wa=void 0,this.Sa=[]}ba(){return this.Sa.some(e=>e.Da())}}class p5{constructor(){this.queries=VT(),this.onlineState="Unknown",this.Ca=new Set}terminate(){(function(t,r){const s=se(t),i=s.queries;s.queries=VT(),i.forEach((o,a)=>{for(const l of a.Sa)l.onError(r)})})(this,new W(F.ABORTED,"Firestore shutting down"))}}function VT(){return new Di(n=>PN(n),Eh)}async function cx(n,e){const t=se(n);let r=3;const s=e.query;let i=t.queries.get(s);i?!i.ba()&&e.Da()&&(r=2):(i=new f5,r=e.Da()?0:1);try{switch(r){case 0:i.wa=await t.onListen(s,!0);break;case 1:i.wa=await t.onListen(s,!1);break;case 2:await t.onFirstRemoteStoreListen(s)}}catch(o){const a=Kc(o,`Initialization of query '${Sl(e.query)}' failed`);return void e.onError(a)}t.queries.set(s,i),i.Sa.push(e),e.va(t.onlineState),i.wa&&e.Fa(i.wa)&&dx(t)}async function ux(n,e){const t=se(n),r=e.query;let s=3;const i=t.queries.get(r);if(i){const o=i.Sa.indexOf(e);o>=0&&(i.Sa.splice(o,1),i.Sa.length===0?s=e.Da()?0:1:!i.ba()&&e.Da()&&(s=2))}switch(s){case 0:return t.queries.delete(r),t.onUnlisten(r,!0);case 1:return t.queries.delete(r),t.onUnlisten(r,!1);case 2:return t.onLastRemoteStoreUnlisten(r);default:return}}function g5(n,e){const t=se(n);let r=!1;for(const s of e){const i=s.query,o=t.queries.get(i);if(o){for(const a of o.Sa)a.Fa(s)&&(r=!0);o.wa=s}}r&&dx(t)}function m5(n,e,t){const r=se(n),s=r.queries.get(e);if(s)for(const i of s.Sa)i.onError(t);r.queries.delete(e)}function dx(n){n.Ca.forEach(e=>{e.next()})}var Fv,FT;(FT=Fv||(Fv={})).Ma="default",FT.Cache="cache";class hx{constructor(e,t,r){this.query=e,this.xa=t,this.Oa=!1,this.Na=null,this.onlineState="Unknown",this.options=r||{}}Fa(e){if(!this.options.includeMetadataChanges){const r=[];for(const s of e.docChanges)s.type!==3&&r.push(s);e=new Ba(e.query,e.docs,e.oldDocs,r,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0,e.hasCachedResults)}let t=!1;return this.Oa?this.Ba(e)&&(this.xa.next(e),t=!0):this.La(e,this.onlineState)&&(this.ka(e),t=!0),this.Na=e,t}onError(e){this.xa.error(e)}va(e){this.onlineState=e;let t=!1;return this.Na&&!this.Oa&&this.La(this.Na,e)&&(this.ka(this.Na),t=!0),t}La(e,t){if(!e.fromCache||!this.Da())return!0;const r=t!=="Offline";return(!this.options.qa||!r)&&(!e.docs.isEmpty()||e.hasCachedResults||t==="Offline")}Ba(e){if(e.docChanges.length>0)return!0;const t=this.Na&&this.Na.hasPendingWrites!==e.hasPendingWrites;return!(!e.syncStateChanged&&!t)&&this.options.includeMetadataChanges===!0}ka(e){e=Ba.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache,e.hasCachedResults),this.Oa=!0,this.xa.next(e)}Da(){return this.options.source!==Fv.Cache}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class zk{constructor(e,t){this.Qa=e,this.byteLength=t}$a(){return"metadata"in this.Qa}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class UT{constructor(e){this.serializer=e}$s(e){return Ks(this.serializer,e)}Us(e){return e.metadata.exists?gm(this.serializer,e.document,!1):Ut.newNoDocument(this.$s(e.metadata.name),this.Ks(e.metadata.readTime))}Ks(e){return gn(e)}}class fx{constructor(e,t){this.Ua=e,this.serializer=t,this.Ka=[],this.Wa=[],this.collectionGroups=new Set,this.progress=qk(e)}get queries(){return this.Ka}get documents(){return this.Wa}Ga(e){this.progress.bytesLoaded+=e.byteLength;let t=this.progress.documentsLoaded;if(e.Qa.namedQuery)this.Ka.push(e.Qa.namedQuery);else if(e.Qa.documentMetadata){this.Wa.push({metadata:e.Qa.documentMetadata}),e.Qa.documentMetadata.exists||++t;const r=rt.fromString(e.Qa.documentMetadata.name);this.collectionGroups.add(r.get(r.length-2))}else e.Qa.document&&(this.Wa[this.Wa.length-1].document=e.Qa.document,++t);return t!==this.progress.documentsLoaded?(this.progress.documentsLoaded=t,{...this.progress}):null}za(e){const t=new Map,r=new UT(this.serializer);for(const s of e)if(s.metadata.queries){const i=r.$s(s.metadata.name);for(const o of s.metadata.queries){const a=(t.get(o)||He()).add(i);t.set(o,a)}}return t}async ja(e){const t=await q6(e,new UT(this.serializer),this.Wa,this.Ua.id),r=this.za(this.documents);for(const s of this.Ka)await W6(e,s,r.get(s.name));return this.progress.taskState="Success",{progress:this.progress,Ja:this.collectionGroups,Ha:t}}}function qk(n){return{taskState:"Running",documentsLoaded:0,bytesLoaded:0,totalDocuments:n.totalDocuments,totalBytes:n.totalBytes}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Wk{constructor(e){this.key=e}}class Gk{constructor(e){this.key=e}}class Hk{constructor(e,t){this.query=e,this.Ya=t,this.Za=null,this.hasCachedResults=!1,this.current=!1,this.Xa=He(),this.mutatedKeys=He(),this.eu=ON(e),this.tu=new xa(this.eu)}get nu(){return this.Ya}ru(e,t){const r=t?t.iu:new jT,s=t?t.tu:this.tu;let i=t?t.mutatedKeys:this.mutatedKeys,o=s,a=!1;const l=this.query.limitType==="F"&&s.size===this.query.limit?s.last():null,u=this.query.limitType==="L"&&s.size===this.query.limit?s.first():null;if(e.inorderTraversal((h,f)=>{const p=s.get(h),y=Th(this.query,f)?f:null,w=!!p&&this.mutatedKeys.has(p.key),S=!!y&&(y.hasLocalMutations||this.mutatedKeys.has(y.key)&&y.hasCommittedMutations);let k=!1;p&&y?p.data.isEqual(y.data)?w!==S&&(r.track({type:3,doc:y}),k=!0):this.su(p,y)||(r.track({type:2,doc:y}),k=!0,(l&&this.eu(y,l)>0||u&&this.eu(y,u)<0)&&(a=!0)):!p&&y?(r.track({type:0,doc:y}),k=!0):p&&!y&&(r.track({type:1,doc:p}),k=!0,(l||u)&&(a=!0)),k&&(y?(o=o.add(y),i=S?i.add(h):i.delete(h)):(o=o.delete(h),i=i.delete(h)))}),this.query.limit!==null)for(;o.size>this.query.limit;){const h=this.query.limitType==="F"?o.last():o.first();o=o.delete(h.key),i=i.delete(h.key),r.track({type:1,doc:h})}return{tu:o,iu:r,Cs:a,mutatedKeys:i}}su(e,t){return e.hasLocalMutations&&t.hasCommittedMutations&&!t.hasLocalMutations}applyChanges(e,t,r,s){const i=this.tu;this.tu=e.tu,this.mutatedKeys=e.mutatedKeys;const o=e.iu.ya();o.sort((h,f)=>function(y,w){const S=k=>{switch(k){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return fe(20277,{Rt:k})}};return S(y)-S(w)}(h.type,f.type)||this.eu(h.doc,f.doc)),this.ou(r),s=s??!1;const a=t&&!s?this._u():[],l=this.Xa.size===0&&this.current&&!s?1:0,u=l!==this.Za;return this.Za=l,o.length!==0||u?{snapshot:new Ba(this.query,e.tu,i,o,e.mutatedKeys,l===0,u,!1,!!r&&r.resumeToken.approximateByteSize()>0),au:a}:{au:a}}va(e){return this.current&&e==="Offline"?(this.current=!1,this.applyChanges({tu:this.tu,iu:new jT,mutatedKeys:this.mutatedKeys,Cs:!1},!1)):{au:[]}}uu(e){return!this.Ya.has(e)&&!!this.tu.has(e)&&!this.tu.get(e).hasLocalMutations}ou(e){e&&(e.addedDocuments.forEach(t=>this.Ya=this.Ya.add(t)),e.modifiedDocuments.forEach(t=>{}),e.removedDocuments.forEach(t=>this.Ya=this.Ya.delete(t)),this.current=e.current)}_u(){if(!this.current)return[];const e=this.Xa;this.Xa=He(),this.tu.forEach(r=>{this.uu(r.key)&&(this.Xa=this.Xa.add(r.key))});const t=[];return e.forEach(r=>{this.Xa.has(r)||t.push(new Gk(r))}),this.Xa.forEach(r=>{e.has(r)||t.push(new Wk(r))}),t}cu(e){this.Ya=e.Qs,this.Xa=He();const t=this.ru(e.documents);return this.applyChanges(t,!0)}lu(){return Ba.fromInitialDocuments(this.query,this.tu,this.mutatedKeys,this.Za===0,this.hasCachedResults)}}const Wo="SyncEngine";class y5{constructor(e,t,r){this.query=e,this.targetId=t,this.view=r}}class _5{constructor(e){this.key=e,this.hu=!1}}class v5{constructor(e,t,r,s,i,o){this.localStore=e,this.remoteStore=t,this.eventManager=r,this.sharedClientState=s,this.currentUser=i,this.maxConcurrentLimboResolutions=o,this.Pu={},this.Tu=new Di(a=>PN(a),Eh),this.Iu=new Map,this.Eu=new Set,this.du=new jt(re.comparator),this.Au=new Map,this.Ru=new Jw,this.Vu={},this.mu=new Map,this.fu=Ua.cr(),this.onlineState="Unknown",this.gu=void 0}get isPrimaryClient(){return this.gu===!0}}async function w5(n,e,t=!0){const r=Im(n);let s;const i=r.Tu.get(e);return i?(r.sharedClientState.addLocalQueryTarget(i.targetId),s=i.view.lu()):s=await Qk(r,e,t,!0),s}async function x5(n,e){const t=Im(n);await Qk(t,e,!0,!1)}async function Qk(n,e,t,r){const s=await Cc(n.localStore,lr(e)),i=s.targetId,o=n.sharedClientState.addLocalQueryTarget(i,t);let a;return r&&(a=await px(n,e,i,o==="current",s.resumeToken)),n.isPrimaryClient&&t&&xm(n.remoteStore,s),a}async function px(n,e,t,r,s){n.pu=(f,p,y)=>async function(S,k,E,x){let N=k.view.ru(E);N.Cs&&(N=await cg(S.localStore,k.query,!1).then(({documents:R})=>k.view.ru(R,N)));const P=x&&x.targetChanges.get(k.targetId),$=x&&x.targetMismatches.get(k.targetId)!=null,L=k.view.applyChanges(N,S.isPrimaryClient,P,$);return Uv(S,k.targetId,L.au),L.snapshot}(n,f,p,y);const i=await cg(n.localStore,e,!0),o=new Hk(e,i.Qs),a=o.ru(i.documents),l=Ch.createSynthesizedTargetChangeForCurrentChange(t,r&&n.onlineState!=="Offline",s),u=o.applyChanges(a,n.isPrimaryClient,l);Uv(n,t,u.au);const h=new y5(e,t,o);return n.Tu.set(e,h),n.Iu.has(t)?n.Iu.get(t).push(e):n.Iu.set(t,[e]),u.snapshot}async function I5(n,e,t){const r=se(n),s=r.Tu.get(e),i=r.Iu.get(s.targetId);if(i.length>1)return r.Iu.set(s.targetId,i.filter(o=>!Eh(o,e))),void r.Tu.delete(e);r.isPrimaryClient?(r.sharedClientState.removeLocalQueryTarget(s.targetId),r.sharedClientState.isActiveQueryTarget(s.targetId)||await Rc(r.localStore,s.targetId,!1).then(()=>{r.sharedClientState.clearQueryState(s.targetId),t&&Nc(r.remoteStore,s.targetId),kc(r,s.targetId)}).catch($o)):(kc(r,s.targetId),await Rc(r.localStore,s.targetId,!0))}async function S5(n,e){const t=se(n),r=t.Tu.get(e),s=t.Iu.get(r.targetId);t.isPrimaryClient&&s.length===1&&(t.sharedClientState.removeLocalQueryTarget(r.targetId),Nc(t.remoteStore,r.targetId))}async function E5(n,e,t){const r=_x(n);try{const s=await function(o,a){const l=se(o),u=Ze.now(),h=a.reduce((y,w)=>y.add(w.key),He());let f,p;return l.persistence.runTransaction("Locally write mutations","readwrite",y=>{let w=Er(),S=He();return l.Ns.getEntries(y,h).next(k=>{w=k,w.forEach((E,x)=>{x.isValidDocument()||(S=S.add(E))})}).next(()=>l.localDocuments.getOverlayedDocuments(y,w)).next(k=>{f=k;const E=[];for(const x of a){const N=K3(x,f.get(x.key).overlayedDocument);N!=null&&E.push(new Oi(x.key,N,xN(N.value.mapValue),Jt.exists(!0)))}return l.mutationQueue.addMutationBatch(y,u,E,a)}).next(k=>{p=k;const E=k.applyToLocalDocumentSet(f,S);return l.documentOverlayCache.saveOverlays(y,k.batchId,E)})}).then(()=>({batchId:p.batchId,changes:MN(f)}))}(r.localStore,e);r.sharedClientState.addPendingMutation(s.batchId),function(o,a,l){let u=o.Vu[o.currentUser.toKey()];u||(u=new jt(je)),u=u.insert(a,l),o.Vu[o.currentUser.toKey()]=u}(r,s.batchId,t),await Li(r,s.changes),await Hc(r.remoteStore)}catch(s){const i=Kc(s,"Failed to persist write");t.reject(i)}}async function Kk(n,e){const t=se(n);try{const r=await B6(t.localStore,e);e.targetChanges.forEach((s,i)=>{const o=t.Au.get(i);o&&(_e(s.addedDocuments.size+s.modifiedDocuments.size+s.removedDocuments.size<=1,22616),s.addedDocuments.size>0?o.hu=!0:s.modifiedDocuments.size>0?_e(o.hu,14607):s.removedDocuments.size>0&&(_e(o.hu,42227),o.hu=!1))}),await Li(t,r,e)}catch(r){await $o(r)}}function $T(n,e,t){const r=se(n);if(r.isPrimaryClient&&t===0||!r.isPrimaryClient&&t===1){const s=[];r.Tu.forEach((i,o)=>{const a=o.view.va(e);a.snapshot&&s.push(a.snapshot)}),function(o,a){const l=se(o);l.onlineState=a;let u=!1;l.queries.forEach((h,f)=>{for(const p of f.Sa)p.va(a)&&(u=!0)}),u&&dx(l)}(r.eventManager,e),s.length&&r.Pu.H_(s),r.onlineState=e,r.isPrimaryClient&&r.sharedClientState.setOnlineState(e)}}async function T5(n,e,t){const r=se(n);r.sharedClientState.updateQueryState(e,"rejected",t);const s=r.Au.get(e),i=s&&s.key;if(i){let o=new jt(re.comparator);o=o.insert(i,Ut.newNoDocument(i,Ie.min()));const a=He().add(i),l=new Ah(Ie.min(),new Map,new jt(je),o,a);await Kk(r,l),r.du=r.du.remove(i),r.Au.delete(e),yx(r)}else await Rc(r.localStore,e,!1).then(()=>kc(r,e,t)).catch($o)}async function b5(n,e){const t=se(n),r=e.batch.batchId;try{const s=await $6(t.localStore,e);mx(t,r,null),gx(t,r),t.sharedClientState.updateMutationState(r,"acknowledged"),await Li(t,s)}catch(s){await $o(s)}}async function A5(n,e,t){const r=se(n);try{const s=await function(o,a){const l=se(o);return l.persistence.runTransaction("Reject batch","readwrite-primary",u=>{let h;return l.mutationQueue.lookupMutationBatch(u,a).next(f=>(_e(f!==null,37113),h=f.keys(),l.mutationQueue.removeMutationBatch(u,f))).next(()=>l.mutationQueue.performConsistencyCheck(u)).next(()=>l.documentOverlayCache.removeOverlaysForBatchId(u,h,a)).next(()=>l.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(u,h)).next(()=>l.localDocuments.getDocuments(u,h))})}(r.localStore,e);mx(r,e,t),gx(r,e),r.sharedClientState.updateMutationState(e,"rejected",t),await Li(r,s)}catch(s){await $o(s)}}async function C5(n,e){const t=se(n);qo(t.remoteStore)||Y(Wo,"The network is disabled. The task returned by 'awaitPendingWrites()' will not complete until the network is enabled.");try{const r=await function(o){const a=se(o);return a.persistence.runTransaction("Get highest unacknowledged batch id","readonly",l=>a.mutationQueue.getHighestUnacknowledgedBatchId(l))}(t.localStore);if(r===xo)return void e.resolve();const s=t.mu.get(r)||[];s.push(e),t.mu.set(r,s)}catch(r){const s=Kc(r,"Initialization of waitForPendingWrites() operation failed");e.reject(s)}}function gx(n,e){(n.mu.get(e)||[]).forEach(t=>{t.resolve()}),n.mu.delete(e)}function mx(n,e,t){const r=se(n);let s=r.Vu[r.currentUser.toKey()];if(s){const i=s.get(e);i&&(t?i.reject(t):i.resolve(),s=s.remove(e)),r.Vu[r.currentUser.toKey()]=s}}function kc(n,e,t=null){n.sharedClientState.removeLocalQueryTarget(e);for(const r of n.Iu.get(e))n.Tu.delete(r),t&&n.Pu.yu(r,t);n.Iu.delete(e),n.isPrimaryClient&&n.Ru.jr(e).forEach(r=>{n.Ru.containsKey(r)||Yk(n,r)})}function Yk(n,e){n.Eu.delete(e.path.canonicalString());const t=n.du.get(e);t!==null&&(Nc(n.remoteStore,t),n.du=n.du.remove(e),n.Au.delete(t),yx(n))}function Uv(n,e,t){for(const r of t)r instanceof Wk?(n.Ru.addReference(r.key,e),R5(n,r)):r instanceof Gk?(Y(Wo,"Document no longer in limbo: "+r.key),n.Ru.removeReference(r.key,e),n.Ru.containsKey(r.key)||Yk(n,r.key)):fe(19791,{wu:r})}function R5(n,e){const t=e.key,r=t.path.canonicalString();n.du.get(t)||n.Eu.has(r)||(Y(Wo,"New document in limbo: "+t),n.Eu.add(r),yx(n))}function yx(n){for(;n.Eu.size>0&&n.du.size<n.maxConcurrentLimboResolutions;){const e=n.Eu.values().next().value;n.Eu.delete(e);const t=new re(rt.fromString(e)),r=n.fu.next();n.Au.set(r,new _5(t)),n.du=n.du.insert(t,r),xm(n.remoteStore,new fi(lr(zc(t.path)),r,"TargetPurposeLimboResolution",Ir.ce))}}async function Li(n,e,t){const r=se(n),s=[],i=[],o=[];r.Tu.isEmpty()||(r.Tu.forEach((a,l)=>{o.push(r.pu(l,e,t).then(u=>{var h;if((u||t)&&r.isPrimaryClient){const f=u?!u.fromCache:(h=t==null?void 0:t.targetChanges.get(l.targetId))==null?void 0:h.current;r.sharedClientState.updateQueryState(l.targetId,f?"current":"not-current")}if(u){s.push(u);const f=tx.As(l.targetId,u);i.push(f)}}))}),await Promise.all(o),r.Pu.H_(s),await async function(l,u){const h=se(l);try{await h.persistence.runTransaction("notifyLocalViewChanges","readwrite",f=>V.forEach(u,p=>V.forEach(p.Es,y=>h.persistence.referenceDelegate.addReference(f,p.targetId,y)).next(()=>V.forEach(p.ds,y=>h.persistence.referenceDelegate.removeReference(f,p.targetId,y)))))}catch(f){if(!Bo(f))throw f;Y(nx,"Failed to update sequence numbers: "+f)}for(const f of u){const p=f.targetId;if(!f.fromCache){const y=h.Ms.get(p),w=y.snapshotVersion,S=y.withLastLimboFreeSnapshotVersion(w);h.Ms=h.Ms.insert(p,S)}}}(r.localStore,i))}async function N5(n,e){const t=se(n);if(!t.currentUser.isEqual(e)){Y(Wo,"User change. New user:",e.toKey());const r=await bk(t.localStore,e);t.currentUser=e,function(i,o){i.mu.forEach(a=>{a.forEach(l=>{l.reject(new W(F.CANCELLED,o))})}),i.mu.clear()}(t,"'waitForPendingWrites' promise is rejected due to a user change."),t.sharedClientState.handleUserChange(e,r.removedBatchIds,r.addedBatchIds),await Li(t,r.Ls)}}function k5(n,e){const t=se(n),r=t.Au.get(e);if(r&&r.hu)return He().add(r.key);{let s=He();const i=t.Iu.get(e);if(!i)return s;for(const o of i){const a=t.Tu.get(o);s=s.unionWith(a.view.nu)}return s}}async function P5(n,e){const t=se(n),r=await cg(t.localStore,e.query,!0),s=e.view.cu(r);return t.isPrimaryClient&&Uv(t,e.targetId,s.au),s}async function D5(n,e){const t=se(n);return Nk(t.localStore,e).then(r=>Li(t,r))}async function O5(n,e,t,r){const s=se(n),i=await function(a,l){const u=se(a),h=se(u.mutationQueue);return u.persistence.runTransaction("Lookup mutation documents","readonly",f=>h.er(f,l).next(p=>p?u.localDocuments.getDocuments(f,p):V.resolve(null)))}(s.localStore,e);i!==null?(t==="pending"?await Hc(s.remoteStore):t==="acknowledged"||t==="rejected"?(mx(s,e,r||null),gx(s,e),function(a,l){se(se(a).mutationQueue).ir(l)}(s.localStore,e)):fe(6720,"Unknown batchState",{Su:t}),await Li(s,i)):Y(Wo,"Cannot apply mutation batch with id: "+e)}async function L5(n,e){const t=se(n);if(Im(t),_x(t),e===!0&&t.gu!==!0){const r=t.sharedClientState.getAllActiveQueryTargets(),s=await BT(t,r.toArray());t.gu=!0,await Vv(t.remoteStore,!0);for(const i of s)xm(t.remoteStore,i)}else if(e===!1&&t.gu!==!1){const r=[];let s=Promise.resolve();t.Iu.forEach((i,o)=>{t.sharedClientState.isLocalQueryTarget(o)?r.push(o):s=s.then(()=>(kc(t,o),Rc(t.localStore,o,!0))),Nc(t.remoteStore,o)}),await s,await BT(t,r),function(o){const a=se(o);a.Au.forEach((l,u)=>{Nc(a.remoteStore,u)}),a.Ru.Jr(),a.Au=new Map,a.du=new jt(re.comparator)}(t),t.gu=!1,await Vv(t.remoteStore,!1)}}async function BT(n,e,t){const r=se(n),s=[],i=[];for(const o of e){let a;const l=r.Iu.get(o);if(l&&l.length!==0){a=await Cc(r.localStore,lr(l[0]));for(const u of l){const h=r.Tu.get(u),f=await P5(r,h);f.snapshot&&i.push(f.snapshot)}}else{const u=await Rk(r.localStore,o);a=await Cc(r.localStore,u),await px(r,Jk(u),o,!1,a.resumeToken)}s.push(a)}return r.Pu.H_(i),s}function Jk(n){return RN(n.path,n.collectionGroup,n.orderBy,n.filters,n.limit,"F",n.startAt,n.endAt)}function M5(n){return function(t){return se(se(t).persistence).Ts()}(se(n).localStore)}async function j5(n,e,t,r){const s=se(n);if(s.gu)return void Y(Wo,"Ignoring unexpected query state notification.");const i=s.Iu.get(e);if(i&&i.length>0)switch(t){case"current":case"not-current":{const o=await Nk(s.localStore,DN(i[0])),a=Ah.createSynthesizedRemoteEventForCurrentChange(e,t==="current",ln.EMPTY_BYTE_STRING);await Li(s,o,a);break}case"rejected":await Rc(s.localStore,e,!0),kc(s,e,r);break;default:fe(64155,t)}}async function V5(n,e,t){const r=Im(n);if(r.gu){for(const s of e){if(r.Iu.has(s)&&r.sharedClientState.isActiveQueryTarget(s)){Y(Wo,"Adding an already active target "+s);continue}const i=await Rk(r.localStore,s),o=await Cc(r.localStore,i);await px(r,Jk(i),o.targetId,!1,o.resumeToken),xm(r.remoteStore,o)}for(const s of t)r.Iu.has(s)&&await Rc(r.localStore,s,!1).then(()=>{Nc(r.remoteStore,s),kc(r,s)}).catch($o)}}function Im(n){const e=se(n);return e.remoteStore.remoteSyncer.applyRemoteEvent=Kk.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=k5.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=T5.bind(null,e),e.Pu.H_=g5.bind(null,e.eventManager),e.Pu.yu=m5.bind(null,e.eventManager),e}function _x(n){const e=se(n);return e.remoteStore.remoteSyncer.applySuccessfulWrite=b5.bind(null,e),e.remoteStore.remoteSyncer.rejectFailedWrite=A5.bind(null,e),e}function F5(n,e,t){const r=se(n);(async function(i,o,a){try{const l=await o.getMetadata();if(await function(y,w){const S=se(y),k=gn(w.createTime);return S.persistence.runTransaction("hasNewerBundle","readonly",E=>S.Ii.getBundleMetadata(E,w.id)).then(E=>!!E&&E.createTime.compareTo(k)>=0)}(i.localStore,l))return await o.close(),a._completeWith(function(y){return{taskState:"Success",documentsLoaded:y.totalDocuments,bytesLoaded:y.totalBytes,totalDocuments:y.totalDocuments,totalBytes:y.totalBytes}}(l)),Promise.resolve(new Set);a._updateProgress(qk(l));const u=new fx(l,o.serializer);let h=await o.bu();for(;h;){const p=await u.Ga(h);p&&a._updateProgress(p),h=await o.bu()}const f=await u.ja(i.localStore);return await Li(i,f.Ha,void 0),await function(y,w){const S=se(y);return S.persistence.runTransaction("Save bundle","readwrite",k=>S.Ii.saveBundleMetadata(k,w))}(i.localStore,l),a._completeWith(f.progress),Promise.resolve(f.Ja)}catch(l){return as(Wo,`Loading bundle failed with ${l}`),a._failWith(l),Promise.resolve(new Set)}})(r,e,t).then(s=>{r.sharedClientState.notifyBundleLoaded(s)})}class Pc{constructor(){this.kind="memory",this.synchronizeTabs=!1}async initialize(e){this.serializer=el(e.databaseInfo.databaseId),this.sharedClientState=this.Du(e),this.persistence=this.Cu(e),await this.persistence.start(),this.localStore=this.vu(e),this.gcScheduler=this.Fu(e,this.localStore),this.indexBackfillerScheduler=this.Mu(e,this.localStore)}Fu(e,t){return null}Mu(e,t){return null}vu(e){return Tk(this.persistence,new Ek,e.initialUser,this.serializer)}Cu(e){return new Xw(wm.mi,this.serializer)}Du(e){return new Lk}async terminate(){var e,t;(e=this.gcScheduler)==null||e.stop(),(t=this.indexBackfillerScheduler)==null||t.stop(),this.sharedClientState.shutdown(),await this.persistence.shutdown()}}Pc.provider={build:()=>new Pc};class vx extends Pc{constructor(e){super(),this.cacheSizeBytes=e}Fu(e,t){_e(this.persistence.referenceDelegate instanceof lg,46915);const r=this.persistence.referenceDelegate.garbageCollector;return new _k(r,e.asyncQueue,t)}Cu(e){const t=this.cacheSizeBytes!==void 0?sr.withCacheSize(this.cacheSizeBytes):sr.DEFAULT;return new Xw(r=>lg.mi(r,t),this.serializer)}}class wx extends Pc{constructor(e,t,r){super(),this.xu=e,this.cacheSizeBytes=t,this.forceOwnership=r,this.kind="persistent",this.synchronizeTabs=!1}async initialize(e){await super.initialize(e),await this.xu.initialize(this,e),await _x(this.xu.syncEngine),await Hc(this.xu.remoteStore),await this.persistence.Ji(()=>(this.gcScheduler&&!this.gcScheduler.started&&this.gcScheduler.start(),this.indexBackfillerScheduler&&!this.indexBackfillerScheduler.started&&this.indexBackfillerScheduler.start(),Promise.resolve()))}vu(e){return Tk(this.persistence,new Ek,e.initialUser,this.serializer)}Fu(e,t){const r=this.persistence.referenceDelegate.garbageCollector;return new _k(r,e.asyncQueue,t)}Mu(e,t){const r=new e3(t,this.persistence);return new Z4(e.asyncQueue,r)}Cu(e){const t=ex(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey),r=this.cacheSizeBytes!==void 0?sr.withCacheSize(this.cacheSizeBytes):sr.DEFAULT;return new Zw(this.synchronizeTabs,t,e.clientId,r,e.asyncQueue,Mk(),np(),this.serializer,this.sharedClientState,!!this.forceOwnership)}Du(e){return new Lk}}class Xk extends wx{constructor(e,t){super(e,t,!1),this.xu=e,this.cacheSizeBytes=t,this.synchronizeTabs=!0}async initialize(e){await super.initialize(e);const t=this.xu.syncEngine;this.sharedClientState instanceof Fy&&(this.sharedClientState.syncEngine={Co:O5.bind(null,t),vo:j5.bind(null,t),Fo:V5.bind(null,t),Ts:M5.bind(null,t),Do:D5.bind(null,t)},await this.sharedClientState.start()),await this.persistence.Ji(async r=>{await L5(this.xu.syncEngine,r),this.gcScheduler&&(r&&!this.gcScheduler.started?this.gcScheduler.start():r||this.gcScheduler.stop()),this.indexBackfillerScheduler&&(r&&!this.indexBackfillerScheduler.started?this.indexBackfillerScheduler.start():r||this.indexBackfillerScheduler.stop())})}Du(e){const t=Mk();if(!Fy.v(t))throw new W(F.UNIMPLEMENTED,"IndexedDB persistence is only available on platforms that support LocalStorage.");const r=ex(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey);return new Fy(t,e.asyncQueue,r,e.clientId,e.initialUser)}}class Lo{async initialize(e,t){this.localStore||(this.localStore=e.localStore,this.sharedClientState=e.sharedClientState,this.datastore=this.createDatastore(t),this.remoteStore=this.createRemoteStore(t),this.eventManager=this.createEventManager(t),this.syncEngine=this.createSyncEngine(t,!e.synchronizeTabs),this.sharedClientState.onlineStateHandler=r=>$T(this.syncEngine,r,1),this.remoteStore.remoteSyncer.handleCredentialChange=N5.bind(null,this.syncEngine),await Vv(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(e){return function(){return new p5}()}createDatastore(e){const t=el(e.databaseInfo.databaseId),r=function(i){return new Y6(i)}(e.databaseInfo);return function(i,o,a,l){return new e5(i,o,a,l)}(e.authCredentials,e.appCheckCredentials,r,t)}createRemoteStore(e){return function(r,s,i,o,a){return new n5(r,s,i,o,a)}(this.localStore,this.datastore,e.asyncQueue,t=>$T(this.syncEngine,t,0),function(){return OT.v()?new OT:new G6}())}createSyncEngine(e,t){return function(s,i,o,a,l,u,h){const f=new v5(s,i,o,a,l,u);return h&&(f.gu=!0),f}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,e.initialUser,e.maxConcurrentLimboResolutions,t)}async terminate(){var e,t;await async function(s){const i=se(s);Y($a,"RemoteStore shutting down."),i.Ea.add(5),await Gc(i),i.Aa.shutdown(),i.Ra.set("Unknown")}(this.remoteStore),(e=this.datastore)==null||e.terminate(),(t=this.eventManager)==null||t.terminate()}}Lo.provider={build:()=>new Lo};function zT(n,e=10240){let t=0;return{async read(){if(t<n.byteLength){const r={value:n.slice(t,t+e),done:!1};return t+=e,r}return{done:!0}},async cancel(){},releaseLock(){},closed:Promise.resolve()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Sm{constructor(e){this.observer=e,this.muted=!1}next(e){this.muted||this.observer.next&&this.Ou(this.observer.next,e)}error(e){this.muted||(this.observer.error?this.Ou(this.observer.error,e):pn("Uncaught Error in snapshot listener:",e.toString()))}Nu(){this.muted=!0}Ou(e,t){setTimeout(()=>{this.muted||e(t)},0)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class U5{constructor(e,t){this.Bu=e,this.serializer=t,this.metadata=new jn,this.buffer=new Uint8Array,this.Lu=function(){return new TextDecoder("utf-8")}(),this.ku().then(r=>{r&&r.$a()?this.metadata.resolve(r.Qa.metadata):this.metadata.reject(new Error(`The first element of the bundle is not a metadata, it is
             ${JSON.stringify(r==null?void 0:r.Qa)}`))},r=>this.metadata.reject(r))}close(){return this.Bu.cancel()}async getMetadata(){return this.metadata.promise}async bu(){return await this.getMetadata(),this.ku()}async ku(){const e=await this.qu();if(e===null)return null;const t=this.Lu.decode(e),r=Number(t);isNaN(r)&&this.Qu(`length string (${t}) is not valid number`);const s=await this.$u(r);return new zk(JSON.parse(s),e.length+r)}Uu(){return this.buffer.findIndex(e=>e==="{".charCodeAt(0))}async qu(){for(;this.Uu()<0&&!await this.Ku(););if(this.buffer.length===0)return null;const e=this.Uu();e<0&&this.Qu("Reached the end of bundle when a length string is expected.");const t=this.buffer.slice(0,e);return this.buffer=this.buffer.slice(e),t}async $u(e){for(;this.buffer.length<e;)await this.Ku()&&this.Qu("Reached the end of bundle when more is expected.");const t=this.Lu.decode(this.buffer.slice(0,e));return this.buffer=this.buffer.slice(e),t}Qu(e){throw this.Bu.cancel(),new Error(`Invalid bundle format: ${e}`)}async Ku(){const e=await this.Bu.read();if(!e.done){const t=new Uint8Array(this.buffer.length+e.value.length);t.set(this.buffer),t.set(e.value,this.buffer.length),this.buffer=t}return e.done}}/**
 * @license
 * Copyright 2025 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class $5{constructor(e,t){this.bundleData=e,this.serializer=t,this.cursor=0,this.elements=[];let r=this.bu();if(!r||!r.$a())throw new Error(`The first element of the bundle is not a metadata object, it is
         ${JSON.stringify(r==null?void 0:r.Qa)}`);this.metadata=r;do r=this.bu(),r!==null&&this.elements.push(r);while(r!==null)}getMetadata(){return this.metadata}Wu(){return this.elements}bu(){if(this.cursor===this.bundleData.length)return null;const e=this.qu(),t=this.$u(e);return new zk(JSON.parse(t),e)}$u(e){if(this.cursor+e>this.bundleData.length)throw new W(F.INTERNAL,"Reached the end of bundle when more is expected.");return this.bundleData.slice(this.cursor,this.cursor+=e)}qu(){const e=this.cursor;let t=this.cursor;for(;t<this.bundleData.length;){if(this.bundleData[t]==="{"){if(t===e)throw new Error("First character is a bracket and not a number");return this.cursor=t,Number(this.bundleData.slice(e,t))}t++}throw new Error("Reached the end of bundle when more is expected.")}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class B5{constructor(e){this.datastore=e,this.readVersions=new Map,this.mutations=[],this.committed=!1,this.lastTransactionError=null,this.writtenDocs=new Set}async lookup(e){if(this.ensureCommitNotCalled(),this.mutations.length>0)throw this.lastTransactionError=new W(F.INVALID_ARGUMENT,"Firestore transactions require all reads to be executed before all writes."),this.lastTransactionError;const t=await async function(s,i){const o=se(s),a={documents:i.map(f=>Hd(o.serializer,f))},l=await o.Ho("BatchGetDocuments",o.serializer.databaseId,rt.emptyPath(),a,i.length),u=new Map;l.forEach(f=>{const p=s6(o.serializer,f);u.set(p.key.toString(),p)});const h=[];return i.forEach(f=>{const p=u.get(f.toString());_e(!!p,55234,{key:f}),h.push(p)}),h}(this.datastore,e);return t.forEach(r=>this.recordVersion(r)),t}set(e,t){this.write(t.toMutation(e,this.precondition(e))),this.writtenDocs.add(e.toString())}update(e,t){try{this.write(t.toMutation(e,this.preconditionForUpdate(e)))}catch(r){this.lastTransactionError=r}this.writtenDocs.add(e.toString())}delete(e){this.write(new Wc(e,this.precondition(e))),this.writtenDocs.add(e.toString())}async commit(){if(this.ensureCommitNotCalled(),this.lastTransactionError)throw this.lastTransactionError;const e=this.readVersions;this.mutations.forEach(t=>{e.delete(t.key.toString())}),e.forEach((t,r)=>{const s=re.fromPath(r);this.mutations.push(new zw(s,this.precondition(s)))}),await async function(r,s){const i=se(r),o={writes:s.map(a=>Qd(i.serializer,a))};await i.Go("Commit",i.serializer.databaseId,rt.emptyPath(),o)}(this.datastore,this.mutations),this.committed=!0}recordVersion(e){let t;if(e.isFoundDocument())t=e.version;else{if(!e.isNoDocument())throw fe(50498,{Gu:e.constructor.name});t=Ie.min()}const r=this.readVersions.get(e.key.toString());if(r){if(!t.isEqual(r))throw new W(F.ABORTED,"Document version changed between two reads.")}else this.readVersions.set(e.key.toString(),t)}precondition(e){const t=this.readVersions.get(e.toString());return!this.writtenDocs.has(e.toString())&&t?t.isEqual(Ie.min())?Jt.exists(!1):Jt.updateTime(t):Jt.none()}preconditionForUpdate(e){const t=this.readVersions.get(e.toString());if(!this.writtenDocs.has(e.toString())&&t){if(t.isEqual(Ie.min()))throw new W(F.INVALID_ARGUMENT,"Can't update a document that doesn't exist.");return Jt.updateTime(t)}return Jt.exists(!0)}write(e){this.ensureCommitNotCalled(),this.mutations.push(e)}ensureCommitNotCalled(){}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class z5{constructor(e,t,r,s,i){this.asyncQueue=e,this.datastore=t,this.options=r,this.updateFunction=s,this.deferred=i,this.zu=r.maxAttempts,this.M_=new sx(this.asyncQueue,"transaction_retry")}ju(){this.zu-=1,this.Ju()}Ju(){this.M_.p_(async()=>{const e=new B5(this.datastore),t=this.Hu(e);t&&t.then(r=>{this.asyncQueue.enqueueAndForget(()=>e.commit().then(()=>{this.deferred.resolve(r)}).catch(s=>{this.Yu(s)}))}).catch(r=>{this.Yu(r)})})}Hu(e){try{const t=this.updateFunction(e);return!xh(t)&&t.catch&&t.then?t:(this.deferred.reject(Error("Transaction callback must return a Promise")),null)}catch(t){return this.deferred.reject(t),null}}Yu(e){this.zu>0&&this.Zu(e)?(this.zu-=1,this.asyncQueue.enqueueAndForget(()=>(this.Ju(),Promise.resolve()))):this.deferred.reject(e)}Zu(e){if(e.name==="FirebaseError"){const t=e.code;return t==="aborted"||t==="failed-precondition"||t==="already-exists"||!HN(t)}return!1}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Mo="FirestoreClient";class q5{constructor(e,t,r,s,i){this.authCredentials=e,this.appCheckCredentials=t,this.asyncQueue=r,this.databaseInfo=s,this.user=On.UNAUTHENTICATED,this.clientId=Rw.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this._uninitializedComponentsProvider=i,this.authCredentials.start(r,async o=>{Y(Mo,"Received user=",o.uid),await this.authCredentialListener(o),this.user=o}),this.appCheckCredentials.start(r,o=>(Y(Mo,"Received new app check token=",o),this.appCheckCredentialListener(o,this.user)))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}terminate(){this.asyncQueue.enterRestrictedMode();const e=new jn;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted(async()=>{try{this._onlineComponents&&await this._onlineComponents.terminate(),this._offlineComponents&&await this._offlineComponents.terminate(),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),e.resolve()}catch(t){const r=Kc(t,"Failed to shutdown persistence");e.reject(r)}}),e.promise}}async function $y(n,e){n.asyncQueue.verifyOperationInProgress(),Y(Mo,"Initializing OfflineComponentProvider");const t=n.configuration;await e.initialize(t);let r=t.initialUser;n.setCredentialChangeListener(async s=>{r.isEqual(s)||(await bk(e.localStore,s),r=s)}),e.persistence.setDatabaseDeletedListener(()=>n.terminate()),n._offlineComponents=e}async function qT(n,e){n.asyncQueue.verifyOperationInProgress();const t=await xx(n);Y(Mo,"Initializing OnlineComponentProvider"),await e.initialize(t,n.configuration),n.setCredentialChangeListener(r=>MT(e.remoteStore,r)),n.setAppCheckTokenChangeListener((r,s)=>MT(e.remoteStore,s)),n._onlineComponents=e}async function xx(n){if(!n._offlineComponents)if(n._uninitializedComponentsProvider){Y(Mo,"Using user provided OfflineComponentProvider");try{await $y(n,n._uninitializedComponentsProvider._offline)}catch(e){const t=e;if(!function(s){return s.name==="FirebaseError"?s.code===F.FAILED_PRECONDITION||s.code===F.UNIMPLEMENTED:!(typeof DOMException<"u"&&s instanceof DOMException)||s.code===22||s.code===20||s.code===11}(t))throw t;as("Error using user provided cache. Falling back to memory cache: "+t),await $y(n,new Pc)}}else Y(Mo,"Using default OfflineComponentProvider"),await $y(n,new vx(void 0));return n._offlineComponents}async function Em(n){return n._onlineComponents||(n._uninitializedComponentsProvider?(Y(Mo,"Using user provided OnlineComponentProvider"),await qT(n,n._uninitializedComponentsProvider._online)):(Y(Mo,"Using default OnlineComponentProvider"),await qT(n,new Lo))),n._onlineComponents}function Zk(n){return xx(n).then(e=>e.persistence)}function Yc(n){return xx(n).then(e=>e.localStore)}function eP(n){return Em(n).then(e=>e.remoteStore)}function Ix(n){return Em(n).then(e=>e.syncEngine)}function tP(n){return Em(n).then(e=>e.datastore)}async function Dc(n){const e=await Em(n),t=e.eventManager;return t.onListen=w5.bind(null,e.syncEngine),t.onUnlisten=I5.bind(null,e.syncEngine),t.onFirstRemoteStoreListen=x5.bind(null,e.syncEngine),t.onLastRemoteStoreUnlisten=S5.bind(null,e.syncEngine),t}function W5(n){return n.asyncQueue.enqueue(async()=>{const e=await Zk(n),t=await eP(n);return e.setNetworkEnabled(!0),function(s){const i=se(s);return i.Ea.delete(0),Rh(i)}(t)})}function G5(n){return n.asyncQueue.enqueue(async()=>{const e=await Zk(n),t=await eP(n);return e.setNetworkEnabled(!1),async function(s){const i=se(s);i.Ea.add(0),await Gc(i),i.Ra.set("Offline")}(t)})}function H5(n,e){const t=new jn;return n.asyncQueue.enqueueAndForget(async()=>async function(s,i,o){try{const a=await function(u,h){const f=se(u);return f.persistence.runTransaction("read document","readonly",p=>f.localDocuments.getDocument(p,h))}(s,i);a.isFoundDocument()?o.resolve(a):a.isNoDocument()?o.resolve(null):o.reject(new W(F.UNAVAILABLE,"Failed to get document from cache. (However, this document may exist on the server. Run again without setting 'source' in the GetOptions to attempt to retrieve the document from the server.)"))}catch(a){const l=Kc(a,`Failed to get document '${i} from cache`);o.reject(l)}}(await Yc(n),e,t)),t.promise}function nP(n,e,t={}){const r=new jn;return n.asyncQueue.enqueueAndForget(async()=>function(i,o,a,l,u){const h=new Sm({next:p=>{h.Nu(),o.enqueueAndForget(()=>ux(i,f));const y=p.docs.has(a);!y&&p.fromCache?u.reject(new W(F.UNAVAILABLE,"Failed to get document because the client is offline.")):y&&p.fromCache&&l&&l.source==="server"?u.reject(new W(F.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):u.resolve(p)},error:p=>u.reject(p)}),f=new hx(zc(a.path),h,{includeMetadataChanges:!0,qa:!0});return cx(i,f)}(await Dc(n),n.asyncQueue,e,t,r)),r.promise}function Q5(n,e){const t=new jn;return n.asyncQueue.enqueueAndForget(async()=>async function(s,i,o){try{const a=await cg(s,i,!0),l=new Hk(i,a.Qs),u=l.ru(a.documents),h=l.applyChanges(u,!1);o.resolve(h.snapshot)}catch(a){const l=Kc(a,`Failed to execute query '${i} against cache`);o.reject(l)}}(await Yc(n),e,t)),t.promise}function rP(n,e,t={}){const r=new jn;return n.asyncQueue.enqueueAndForget(async()=>function(i,o,a,l,u){const h=new Sm({next:p=>{h.Nu(),o.enqueueAndForget(()=>ux(i,f)),p.fromCache&&l.source==="server"?u.reject(new W(F.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):u.resolve(p)},error:p=>u.reject(p)}),f=new hx(a,h,{includeMetadataChanges:!0,qa:!0});return cx(i,f)}(await Dc(n),n.asyncQueue,e,t,r)),r.promise}function K5(n,e,t){const r=new jn;return n.asyncQueue.enqueueAndForget(async()=>{try{const s=await tP(n);r.resolve(async function(o,a,l){var S;const u=se(o),{request:h,gt:f,parent:p}=sk(u.serializer,NN(a),l);u.connection.$o||delete h.parent;const y=(await u.Ho("RunAggregationQuery",u.serializer.databaseId,p,h,1)).filter(k=>!!k.result);_e(y.length===1,64727);const w=(S=y[0].result)==null?void 0:S.aggregateFields;return Object.keys(w).reduce((k,E)=>(k[f[E]]=w[E],k),{})}(s,e,t))}catch(s){r.reject(s)}}),r.promise}function Y5(n,e){const t=new Sm(e);return n.asyncQueue.enqueueAndForget(async()=>function(s,i){se(s).Ca.add(i),i.next()}(await Dc(n),t)),()=>{t.Nu(),n.asyncQueue.enqueueAndForget(async()=>function(s,i){se(s).Ca.delete(i)}(await Dc(n),t))}}function J5(n,e,t,r){const s=function(o,a){let l;return l=typeof o=="string"?KN().encode(o):o,function(h,f){return new U5(h,f)}(function(h,f){if(h instanceof Uint8Array)return zT(h,f);if(h instanceof ArrayBuffer)return zT(new Uint8Array(h),f);if(h instanceof ReadableStream)return h.getReader();throw new Error("Source of `toByteStreamReader` has to be a ArrayBuffer or ReadableStream")}(l),a)}(t,el(e));n.asyncQueue.enqueueAndForget(async()=>{F5(await Ix(n),s,r)})}function X5(n,e){return n.asyncQueue.enqueue(async()=>function(r,s){const i=se(r);return i.persistence.runTransaction("Get named query","readonly",o=>i.Ii.getNamedQuery(o,s))}(await Yc(n),e))}function sP(n,e){return function(r,s){return new $5(r,s)}(n,e)}function Z5(n,e){return n.asyncQueue.enqueue(async()=>async function(r,s){const i=se(r),o=i.indexManager,a=[];return i.persistence.runTransaction("Configure indexes","readwrite",l=>o.getFieldIndexes(l).next(u=>function(f,p,y,w,S){f=[...f],p=[...p],f.sort(y),p.sort(y);const k=f.length,E=p.length;let x=0,N=0;for(;x<E&&N<k;){const P=y(f[N],p[x]);P<0?S(f[N++]):P>0?w(p[x++]):(x++,N++)}for(;x<E;)w(p[x++]);for(;N<k;)S(f[N++])}(u,s,K4,h=>{a.push(o.addFieldIndex(l,h))},h=>{a.push(o.deleteFieldIndex(l,h))})).next(()=>V.waitFor(a)))}(await Yc(n),e))}function eU(n,e){return n.asyncQueue.enqueue(async()=>function(r,s){se(r).Fs.Vs=s}(await Yc(n),e))}function tU(n){return n.asyncQueue.enqueue(async()=>function(t){const r=se(t),s=r.indexManager;return r.persistence.runTransaction("Delete All Indexes","readwrite",i=>s.deleteAllFieldIndexes(i))}(await Yc(n)))}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function iP(n){const e={};return n.timeoutSeconds!==void 0&&(e.timeoutSeconds=n.timeoutSeconds),e}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const WT=new Map;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const oP="firestore.googleapis.com",GT=!0;class HT{constructor(e){if(e.host===void 0){if(e.ssl!==void 0)throw new W(F.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host=oP,this.ssl=GT}else this.host=e.host,this.ssl=e.ssl??GT;if(this.isUsingEmulator=e.emulatorOptions!==void 0,this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,this.localCache=e.localCache,e.cacheSizeBytes===void 0)this.cacheSizeBytes=fk;else{if(e.cacheSizeBytes!==-1&&e.cacheSizeBytes<yk)throw new W(F.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}Q4("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:e.experimentalAutoDetectLongPolling===void 0?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=iP(e.experimentalLongPollingOptions??{}),function(r){if(r.timeoutSeconds!==void 0){if(isNaN(r.timeoutSeconds))throw new W(F.INVALID_ARGUMENT,`invalid long polling timeout: ${r.timeoutSeconds} (must not be NaN)`);if(r.timeoutSeconds<5)throw new W(F.INVALID_ARGUMENT,`invalid long polling timeout: ${r.timeoutSeconds} (minimum allowed value is 5)`);if(r.timeoutSeconds>30)throw new W(F.INVALID_ARGUMENT,`invalid long polling timeout: ${r.timeoutSeconds} (maximum allowed value is 30)`)}}(this.experimentalLongPollingOptions),this.useFetchStreams=!!e.useFetchStreams}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&function(r,s){return r.timeoutSeconds===s.timeoutSeconds}(this.experimentalLongPollingOptions,e.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}}class Nh{constructor(e,t,r,s){this._authCredentials=e,this._appCheckCredentials=t,this._databaseId=r,this._app=s,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new HT({}),this._settingsFrozen=!1,this._emulatorOptions={},this._terminateTask="notTerminated"}get app(){if(!this._app)throw new W(F.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return this._terminateTask!=="notTerminated"}_setSettings(e){if(this._settingsFrozen)throw new W(F.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new HT(e),this._emulatorOptions=e.emulatorOptions||{},e.credentials!==void 0&&(this._authCredentials=function(r){if(!r)return new V4;switch(r.type){case"firstParty":return new B4(r.sessionIndex||"0",r.iamToken||null,r.authTokenFactory||null);case"provider":return r.client;default:throw new W(F.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(e.credentials))}_getSettings(){return this._settings}_getEmulatorOptions(){return this._emulatorOptions}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask==="notTerminated"&&(this._terminateTask=this._terminate()),this._terminateTask}async _restart(){this._terminateTask==="notTerminated"?await this._terminate():this._terminateTask="notTerminated"}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(t){const r=WT.get(t);r&&(Y("ComponentProvider","Removing Datastore"),WT.delete(t),r.terminate())}(this),Promise.resolve()}}function nU(n,e,t,r={}){var u;n=it(n,Nh);const s=ki(e),i=n._getSettings(),o={...i,emulatorOptions:n._getEmulatorOptions()},a=`${e}:${t}`;s&&(Vg(`https://${a}`),U0("Firestore",!0)),i.host!==oP&&i.host!==a&&as("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used.");const l={...i,host:a,ssl:s,emulatorOptions:r};if(!qr(l,o)&&(n._setSettings(l),r.mockUserToken)){let h,f;if(typeof r.mockUserToken=="string")h=r.mockUserToken,f=On.MOCK_USER;else{h=s1(r.mockUserToken,(u=n._app)==null?void 0:u.options.projectId);const p=r.mockUserToken.sub||r.mockUserToken.user_id;if(!p)throw new W(F.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");f=new On(p)}n._authCredentials=new F4(new WR(h,f))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Un{constructor(e,t,r){this.converter=t,this._query=r,this.type="query",this.firestore=e}withConverter(e){return new Un(this.firestore,e,this._query)}}class At{constructor(e,t,r){this.converter=t,this._key=r,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new Ys(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new At(this.firestore,e,this._key)}toJSON(){return{type:At._jsonSchemaVersion,referencePath:this._key.toString()}}static fromJSON(e,t,r){if(Za(t,At._jsonSchema))return new At(e,r||null,new re(rt.fromString(t.referencePath)))}}At._jsonSchemaVersion="firestore/documentReference/1.0",At._jsonSchema={type:xn("string",At._jsonSchemaVersion),referencePath:xn("string")};class Ys extends Un{constructor(e,t,r){super(e,t,zc(r)),this._path=r,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const e=this._path.popLast();return e.isEmpty()?null:new At(this.firestore,null,new re(e))}withConverter(e){return new Ys(this.firestore,e,this._path)}}function Jr(n,e,...t){if(n=oe(n),Nw("collection","path",e),n instanceof Nh){const r=rt.fromString(e,...t);return LE(r),new Ys(n,null,r)}{if(!(n instanceof At||n instanceof Ys))throw new W(F.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const r=n._path.child(rt.fromString(e,...t));return LE(r),new Ys(n.firestore,null,r)}}function b8(n,e){if(n=it(n,Nh),Nw("collectionGroup","collection id",e),e.indexOf("/")>=0)throw new W(F.INVALID_ARGUMENT,`Invalid collection ID '${e}' passed to function collectionGroup(). Collection IDs must not contain '/'.`);return new Un(n,null,function(r){return new Pi(rt.emptyPath(),r)}(e))}function rp(n,e,...t){if(n=oe(n),arguments.length===1&&(e=Rw.newId()),Nw("doc","path",e),n instanceof Nh){const r=rt.fromString(e,...t);return OE(r),new At(n,null,new re(r))}{if(!(n instanceof At||n instanceof Ys))throw new W(F.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const r=n._path.child(rt.fromString(e,...t));return OE(r),new At(n.firestore,n instanceof Ys?n.converter:null,new re(r))}}function A8(n,e){return n=oe(n),e=oe(e),(n instanceof At||n instanceof Ys)&&(e instanceof At||e instanceof Ys)&&n.firestore===e.firestore&&n.path===e.path&&n.converter===e.converter}function aP(n,e){return n=oe(n),e=oe(e),n instanceof Un&&e instanceof Un&&n.firestore===e.firestore&&Eh(n._query,e._query)&&n.converter===e.converter}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const QT="AsyncQueue";class KT{constructor(e=Promise.resolve()){this.Xu=[],this.ec=!1,this.tc=[],this.nc=null,this.rc=!1,this.sc=!1,this.oc=[],this.M_=new sx(this,"async_queue_retry"),this._c=()=>{const r=np();r&&Y(QT,"Visibility state changed to "+r.visibilityState),this.M_.w_()},this.ac=e;const t=np();t&&typeof t.addEventListener=="function"&&t.addEventListener("visibilitychange",this._c)}get isShuttingDown(){return this.ec}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.uc(),this.cc(e)}enterRestrictedMode(e){if(!this.ec){this.ec=!0,this.sc=e||!1;const t=np();t&&typeof t.removeEventListener=="function"&&t.removeEventListener("visibilitychange",this._c)}}enqueue(e){if(this.uc(),this.ec)return new Promise(()=>{});const t=new jn;return this.cc(()=>this.ec&&this.sc?Promise.resolve():(e().then(t.resolve,t.reject),t.promise)).then(()=>t.promise)}enqueueRetryable(e){this.enqueueAndForget(()=>(this.Xu.push(e),this.lc()))}async lc(){if(this.Xu.length!==0){try{await this.Xu[0](),this.Xu.shift(),this.M_.reset()}catch(e){if(!Bo(e))throw e;Y(QT,"Operation failed with retryable error: "+e)}this.Xu.length>0&&this.M_.p_(()=>this.lc())}}cc(e){const t=this.ac.then(()=>(this.rc=!0,e().catch(r=>{throw this.nc=r,this.rc=!1,pn("INTERNAL UNHANDLED ERROR: ",YT(r)),r}).then(r=>(this.rc=!1,r))));return this.ac=t,t}enqueueAfterDelay(e,t,r){this.uc(),this.oc.indexOf(e)>-1&&(t=0);const s=lx.createAndSchedule(this,e,t,r,i=>this.hc(i));return this.tc.push(s),s}uc(){this.nc&&fe(47125,{Pc:YT(this.nc)})}verifyOperationInProgress(){}async Tc(){let e;do e=this.ac,await e;while(e!==this.ac)}Ic(e){for(const t of this.tc)if(t.timerId===e)return!0;return!1}Ec(e){return this.Tc().then(()=>{this.tc.sort((t,r)=>t.targetTimeMs-r.targetTimeMs);for(const t of this.tc)if(t.skipDelay(),e!=="all"&&t.timerId===e)break;return this.Tc()})}dc(e){this.oc.push(e)}hc(e){const t=this.tc.indexOf(e);this.tc.splice(t,1)}}function YT(n){let e=n.message||"";return n.stack&&(e=n.stack.includes(n.message)?n.stack:n.message+`
`+n.stack),e}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Kl(n){return function(t,r){if(typeof t!="object"||t===null)return!1;const s=t;for(const i of r)if(i in s&&typeof s[i]=="function")return!0;return!1}(n,["next","error","complete"])}class rU{constructor(){this._progressObserver={},this._taskCompletionResolver=new jn,this._lastProgress={taskState:"Running",totalBytes:0,totalDocuments:0,bytesLoaded:0,documentsLoaded:0}}onProgress(e,t,r){this._progressObserver={next:e,error:t,complete:r}}catch(e){return this._taskCompletionResolver.promise.catch(e)}then(e,t){return this._taskCompletionResolver.promise.then(e,t)}_completeWith(e){this._updateProgress(e),this._progressObserver.complete&&this._progressObserver.complete(),this._taskCompletionResolver.resolve(e)}_failWith(e){this._lastProgress.taskState="Error",this._progressObserver.next&&this._progressObserver.next(this._lastProgress),this._progressObserver.error&&this._progressObserver.error(e),this._taskCompletionResolver.reject(e)}_updateProgress(e){this._lastProgress=e,this._progressObserver.next&&this._progressObserver.next(e)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const C8=-1;class Dt extends Nh{constructor(e,t,r,s){super(e,t,r,s),this.type="firestore",this._queue=new KT,this._persistenceKey=(s==null?void 0:s.name)||"[DEFAULT]"}async _terminate(){if(this._firestoreClient){const e=this._firestoreClient.terminate();this._queue=new KT(e),this._firestoreClient=void 0,await e}}}function R8(n,e,t){t||(t=zd);const r=ti(n,"firestore");if(r.isInitialized(t)){const s=r.getImmediate({identifier:t}),i=r.getOptions(t);if(qr(i,e))return s;throw new W(F.FAILED_PRECONDITION,"initializeFirestore() has already been called with different options. To avoid this error, call initializeFirestore() with the same options as when it was originally called, or call getFirestore() to return the already initialized instance.")}if(e.cacheSizeBytes!==void 0&&e.localCache!==void 0)throw new W(F.INVALID_ARGUMENT,"cache and cacheSizeBytes cannot be specified at the same time as cacheSizeBytes willbe deprecated. Instead, specify the cache size in the cache object");if(e.cacheSizeBytes!==void 0&&e.cacheSizeBytes!==-1&&e.cacheSizeBytes<yk)throw new W(F.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");return e.host&&ki(e.host)&&Vg(e.host),r.initialize({options:e,instanceIdentifier:t})}function sU(n,e){const t=typeof n=="object"?n:uh(),r=typeof n=="string"?n:e||zd,s=ti(t,"firestore").getImmediate({identifier:r});if(!s._initialized){const i=t1("firestore");i&&nU(s,...i)}return s}function nn(n){if(n._terminated)throw new W(F.FAILED_PRECONDITION,"The client has already been terminated.");return n._firestoreClient||lP(n),n._firestoreClient}function lP(n){var r,s,i;const e=n._freezeSettings(),t=function(a,l,u,h){return new C3(a,l,u,h.host,h.ssl,h.experimentalForceLongPolling,h.experimentalAutoDetectLongPolling,iP(h.experimentalLongPollingOptions),h.useFetchStreams,h.isUsingEmulator)}(n._databaseId,((r=n._app)==null?void 0:r.options.appId)||"",n._persistenceKey,e);n._componentsProvider||(s=e.localCache)!=null&&s._offlineComponentProvider&&((i=e.localCache)!=null&&i._onlineComponentProvider)&&(n._componentsProvider={_offline:e.localCache._offlineComponentProvider,_online:e.localCache._onlineComponentProvider}),n._firestoreClient=new q5(n._authCredentials,n._appCheckCredentials,n._queue,t,n._componentsProvider&&function(a){const l=a==null?void 0:a._online.build();return{_offline:a==null?void 0:a._offline.build(l),_online:l}}(n._componentsProvider))}function N8(n,e){as("enableIndexedDbPersistence() will be deprecated in the future, you can use `FirestoreSettings.cache` instead.");const t=n._freezeSettings();return cP(n,Lo.provider,{build:r=>new wx(r,t.cacheSizeBytes,e==null?void 0:e.forceOwnership)}),Promise.resolve()}async function k8(n){as("enableMultiTabIndexedDbPersistence() will be deprecated in the future, you can use `FirestoreSettings.cache` instead.");const e=n._freezeSettings();cP(n,Lo.provider,{build:t=>new Xk(t,e.cacheSizeBytes)})}function cP(n,e,t){if((n=it(n,Dt))._firestoreClient||n._terminated)throw new W(F.FAILED_PRECONDITION,"Firestore has already been started and persistence can no longer be enabled. You can only enable persistence before calling any other methods on a Firestore object.");if(n._componentsProvider||n._getSettings().localCache)throw new W(F.FAILED_PRECONDITION,"SDK cache is already specified.");n._componentsProvider={_online:e,_offline:t},lP(n)}function P8(n){if(n._initialized&&!n._terminated)throw new W(F.FAILED_PRECONDITION,"Persistence can only be cleared before a Firestore instance is initialized or after it is terminated.");const e=new jn;return n._queue.enqueueAndForgetEvenWhileRestricted(async()=>{try{await async function(r){if(!Qs.v())return Promise.resolve();const s=r+Sk;await Qs.delete(s)}(ex(n._databaseId,n._persistenceKey)),e.resolve()}catch(t){e.reject(t)}}),e.promise}function D8(n){return function(t){const r=new jn;return t.asyncQueue.enqueueAndForget(async()=>C5(await Ix(t),r)),r.promise}(nn(n=it(n,Dt)))}function O8(n){return W5(nn(n=it(n,Dt)))}function L8(n){return G5(nn(n=it(n,Dt)))}function M8(n){return ij(n.app,"firestore",n._databaseId.database),n._delete()}function JT(n,e){const t=nn(n=it(n,Dt)),r=new rU;return J5(t,n._databaseId,e,r),r}function iU(n,e){return X5(nn(n=it(n,Dt)),e).then(t=>t?new Un(n,null,t.query):null)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Kd{constructor(e="count",t){this._internalFieldPath=t,this.type="AggregateField",this.aggregateType=e}}class oU{constructor(e,t,r){this._userDataWriter=t,this._data=r,this.type="AggregateQuerySnapshot",this.query=e}data(){return this._userDataWriter.convertObjectMap(this._data)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class jr{constructor(e){this._byteString=e}static fromBase64String(e){try{return new jr(ln.fromBase64String(e))}catch(t){throw new W(F.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+t)}}static fromUint8Array(e){return new jr(ln.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}toJSON(){return{type:jr._jsonSchemaVersion,bytes:this.toBase64()}}static fromJSON(e){if(Za(e,jr._jsonSchema))return jr.fromBase64String(e.bytes)}}jr._jsonSchemaVersion="firestore/bytes/1.0",jr._jsonSchema={type:xn("string",jr._jsonSchemaVersion),bytes:xn("string")};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class tl{constructor(...e){for(let t=0;t<e.length;++t)if(e[t].length===0)throw new W(F.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new Yt(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}}function j8(){return new tl(yv)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class nl{constructor(e){this._methodName=e}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Js{constructor(e,t){if(!isFinite(e)||e<-90||e>90)throw new W(F.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(t)||t<-180||t>180)throw new W(F.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+t);this._lat=e,this._long=t}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}_compareTo(e){return je(this._lat,e._lat)||je(this._long,e._long)}toJSON(){return{latitude:this._lat,longitude:this._long,type:Js._jsonSchemaVersion}}static fromJSON(e){if(Za(e,Js._jsonSchema))return new Js(e.latitude,e.longitude)}}Js._jsonSchemaVersion="firestore/geoPoint/1.0",Js._jsonSchema={type:xn("string",Js._jsonSchemaVersion),latitude:xn("number"),longitude:xn("number")};/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class xs{constructor(e){this._values=(e||[]).map(t=>t)}toArray(){return this._values.map(e=>e)}isEqual(e){return function(r,s){if(r.length!==s.length)return!1;for(let i=0;i<r.length;++i)if(r[i]!==s[i])return!1;return!0}(this._values,e._values)}toJSON(){return{type:xs._jsonSchemaVersion,vectorValues:this._values}}static fromJSON(e){if(Za(e,xs._jsonSchema)){if(Array.isArray(e.vectorValues)&&e.vectorValues.every(t=>typeof t=="number"))return new xs(e.vectorValues);throw new W(F.INVALID_ARGUMENT,"Expected 'vectorValues' field to be a number array")}}}xs._jsonSchemaVersion="firestore/vectorValue/1.0",xs._jsonSchema={type:xn("string",xs._jsonSchemaVersion),vectorValues:xn("object")};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const aU=/^__.*__$/;class lU{constructor(e,t,r){this.data=e,this.fieldMask=t,this.fieldTransforms=r}toMutation(e,t){return this.fieldMask!==null?new Oi(e,this.data,this.fieldMask,t,this.fieldTransforms):new qc(e,this.data,t,this.fieldTransforms)}}class uP{constructor(e,t,r){this.data=e,this.fieldMask=t,this.fieldTransforms=r}toMutation(e,t){return new Oi(e,this.data,this.fieldMask,t,this.fieldTransforms)}}function dP(n){switch(n){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw fe(40011,{Ac:n})}}class Tm{constructor(e,t,r,s,i,o){this.settings=e,this.databaseId=t,this.serializer=r,this.ignoreUndefinedProperties=s,i===void 0&&this.Rc(),this.fieldTransforms=i||[],this.fieldMask=o||[]}get path(){return this.settings.path}get Ac(){return this.settings.Ac}Vc(e){return new Tm({...this.settings,...e},this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}mc(e){var s;const t=(s=this.path)==null?void 0:s.child(e),r=this.Vc({path:t,fc:!1});return r.gc(e),r}yc(e){var s;const t=(s=this.path)==null?void 0:s.child(e),r=this.Vc({path:t,fc:!1});return r.Rc(),r}wc(e){return this.Vc({path:void 0,fc:!0})}Sc(e){return fg(e,this.settings.methodName,this.settings.bc||!1,this.path,this.settings.Dc)}contains(e){return this.fieldMask.find(t=>e.isPrefixOf(t))!==void 0||this.fieldTransforms.find(t=>e.isPrefixOf(t.field))!==void 0}Rc(){if(this.path)for(let e=0;e<this.path.length;e++)this.gc(this.path.get(e))}gc(e){if(e.length===0)throw this.Sc("Document fields must not be empty");if(dP(this.Ac)&&aU.test(e))throw this.Sc('Document fields cannot begin and end with "__"')}}class cU{constructor(e,t,r){this.databaseId=e,this.ignoreUndefinedProperties=t,this.serializer=r||el(e)}Cc(e,t,r,s=!1){return new Tm({Ac:e,methodName:t,Dc:r,path:Yt.emptyPath(),fc:!1,bc:s},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}}function rl(n){const e=n._freezeSettings(),t=el(n._databaseId);return new cU(n._databaseId,!!e.ignoreUndefinedProperties,t)}function bm(n,e,t,r,s,i={}){const o=n.Cc(i.merge||i.mergeFields?2:0,e,t,s);Rx("Data must be an object, but it was:",o,r);const a=pP(r,o);let l,u;if(i.merge)l=new Sr(o.fieldMask),u=o.fieldTransforms;else if(i.mergeFields){const h=[];for(const f of i.mergeFields){const p=Yd(e,f,t);if(!o.contains(p))throw new W(F.INVALID_ARGUMENT,`Field '${p}' is specified in your field mask but missing from your input data.`);mP(h,p)||h.push(p)}l=new Sr(h),u=o.fieldTransforms.filter(f=>l.covers(f.field))}else l=null,u=o.fieldTransforms;return new lU(new Hn(a),l,u)}class kh extends nl{_toFieldTransform(e){if(e.Ac!==2)throw e.Ac===1?e.Sc(`${this._methodName}() can only appear at the top level of your update data`):e.Sc(`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return e.fieldMask.push(e.path),null}isEqual(e){return e instanceof kh}}function hP(n,e,t){return new Tm({Ac:3,Dc:e.settings.Dc,methodName:n._methodName,fc:t},e.databaseId,e.serializer,e.ignoreUndefinedProperties)}class Sx extends nl{_toFieldTransform(e){return new bh(e.path,new Tc)}isEqual(e){return e instanceof Sx}}class Ex extends nl{constructor(e,t){super(e),this.vc=t}_toFieldTransform(e){const t=hP(this,e,!0),r=this.vc.map(i=>sl(i,t)),s=new Ma(r);return new bh(e.path,s)}isEqual(e){return e instanceof Ex&&qr(this.vc,e.vc)}}class Tx extends nl{constructor(e,t){super(e),this.vc=t}_toFieldTransform(e){const t=hP(this,e,!0),r=this.vc.map(i=>sl(i,t)),s=new ja(r);return new bh(e.path,s)}isEqual(e){return e instanceof Tx&&qr(this.vc,e.vc)}}class bx extends nl{constructor(e,t){super(e),this.Fc=t}_toFieldTransform(e){const t=new bc(e.serializer,FN(e.serializer,this.Fc));return new bh(e.path,t)}isEqual(e){return e instanceof bx&&this.Fc===e.Fc}}function Ax(n,e,t,r){const s=n.Cc(1,e,t);Rx("Data must be an object, but it was:",s,r);const i=[],o=Hn.empty();zo(r,(l,u)=>{const h=Am(e,l,t);u=oe(u);const f=s.yc(h);if(u instanceof kh)i.push(h);else{const p=sl(u,f);p!=null&&(i.push(h),o.set(h,p))}});const a=new Sr(i);return new uP(o,a,s.fieldTransforms)}function Cx(n,e,t,r,s,i){const o=n.Cc(1,e,t),a=[Yd(e,r,t)],l=[s];if(i.length%2!=0)throw new W(F.INVALID_ARGUMENT,`Function ${e}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let p=0;p<i.length;p+=2)a.push(Yd(e,i[p])),l.push(i[p+1]);const u=[],h=Hn.empty();for(let p=a.length-1;p>=0;--p)if(!mP(u,a[p])){const y=a[p];let w=l[p];w=oe(w);const S=o.yc(y);if(w instanceof kh)u.push(y);else{const k=sl(w,S);k!=null&&(u.push(y),h.set(y,k))}}const f=new Sr(u);return new uP(h,f,o.fieldTransforms)}function fP(n,e,t,r=!1){return sl(t,n.Cc(r?4:3,e))}function sl(n,e){if(gP(n=oe(n)))return Rx("Unsupported field value:",e,n),pP(n,e);if(n instanceof nl)return function(r,s){if(!dP(s.Ac))throw s.Sc(`${r._methodName}() can only be used with update() and set()`);if(!s.path)throw s.Sc(`${r._methodName}() is not currently supported inside arrays`);const i=r._toFieldTransform(s);i&&s.fieldTransforms.push(i)}(n,e),null;if(n===void 0&&e.ignoreUndefinedProperties)return null;if(e.path&&e.fieldMask.push(e.path),n instanceof Array){if(e.settings.fc&&e.Ac!==4)throw e.Sc("Nested arrays are not supported");return function(r,s){const i=[];let o=0;for(const a of r){let l=sl(a,s.wc(o));l==null&&(l={nullValue:"NULL_VALUE"}),i.push(l),o++}return{arrayValue:{values:i}}}(n,e)}return function(r,s){if((r=oe(r))===null)return{nullValue:"NULL_VALUE"};if(typeof r=="number")return FN(s.serializer,r);if(typeof r=="boolean")return{booleanValue:r};if(typeof r=="string")return{stringValue:r};if(r instanceof Date){const i=Ze.fromDate(r);return{timestampValue:Ac(s.serializer,i)}}if(r instanceof Ze){const i=new Ze(r.seconds,1e3*Math.floor(r.nanoseconds/1e3));return{timestampValue:Ac(s.serializer,i)}}if(r instanceof Js)return{geoPointValue:{latitude:r.latitude,longitude:r.longitude}};if(r instanceof jr)return{bytesValue:XN(s.serializer,r._byteString)};if(r instanceof At){const i=s.databaseId,o=r.firestore._databaseId;if(!o.isEqual(i))throw s.Sc(`Document reference is for database ${o.projectId}/${o.database} but should be for database ${i.projectId}/${i.database}`);return{referenceValue:Qw(r.firestore._databaseId||s.databaseId,r._key.path)}}if(r instanceof xs)return function(o,a){return{mapValue:{fields:{[jw]:{stringValue:Vw},[Ic]:{arrayValue:{values:o.toArray().map(u=>{if(typeof u!="number")throw a.Sc("VectorValues must only contain numeric values.");return Bw(a.serializer,u)})}}}}}}(r,s);throw s.Sc(`Unsupported field value: ${im(r)}`)}(n,e)}function pP(n,e){const t={};return hN(n)?e.path&&e.path.length>0&&e.fieldMask.push(e.path):zo(n,(r,s)=>{const i=sl(s,e.mc(r));i!=null&&(t[r]=i)}),{mapValue:{fields:t}}}function gP(n){return!(typeof n!="object"||n===null||n instanceof Array||n instanceof Date||n instanceof Ze||n instanceof Js||n instanceof jr||n instanceof At||n instanceof nl||n instanceof xs)}function Rx(n,e,t){if(!gP(t)||!HR(t)){const r=im(t);throw r==="an object"?e.Sc(n+" a custom object"):e.Sc(n+" "+r)}}function Yd(n,e,t){if((e=oe(e))instanceof tl)return e._internalPath;if(typeof e=="string")return Am(n,e);throw fg("Field path arguments must be of type string or ",n,!1,void 0,t)}const uU=new RegExp("[~\\*/\\[\\]]");function Am(n,e,t){if(e.search(uU)>=0)throw fg(`Invalid field path (${e}). Paths must not contain '~', '*', '/', '[', or ']'`,n,!1,void 0,t);try{return new tl(...e.split("."))._internalPath}catch{throw fg(`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,n,!1,void 0,t)}}function fg(n,e,t,r,s){const i=r&&!r.isEmpty(),o=s!==void 0;let a=`Function ${e}() called with invalid data`;t&&(a+=" (via `toFirestore()`)"),a+=". ";let l="";return(i||o)&&(l+=" (found",i&&(l+=` in field ${r}`),o&&(l+=` in document ${s}`),l+=")"),new W(F.INVALID_ARGUMENT,a+n+l)}function mP(n,e){return n.some(t=>t.isEqual(e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Jd{constructor(e,t,r,s,i){this._firestore=e,this._userDataWriter=t,this._key=r,this._document=s,this._converter=i}get id(){return this._key.path.lastSegment()}get ref(){return new At(this._firestore,this._converter,this._key)}exists(){return this._document!==null}data(){if(this._document){if(this._converter){const e=new dU(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}get(e){if(this._document){const t=this._document.data.field(Cm("DocumentSnapshot.get",e));if(t!==null)return this._userDataWriter.convertValue(t)}}}class dU extends Jd{data(){return super.data()}}function Cm(n,e){return typeof e=="string"?Am(n,e):e instanceof tl?e._internalPath:e._delegate._internalPath}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function yP(n){if(n.limitType==="L"&&n.explicitOrderBy.length===0)throw new W(F.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}class Nx{}class Ph extends Nx{}function Vl(n,e,...t){let r=[];e instanceof Nx&&r.push(e),r=r.concat(t),function(i){const o=i.filter(l=>l instanceof Jc).length,a=i.filter(l=>l instanceof Dh).length;if(o>1||o>0&&a>0)throw new W(F.INVALID_ARGUMENT,"InvalidQuery. When using composite filters, you cannot use more than one filter at the top level. Consider nesting the multiple filters within an `and(...)` statement. For example: change `query(query, where(...), or(...))` to `query(query, and(where(...), or(...)))`.")}(r);for(const s of r)n=s._apply(n);return n}class Dh extends Ph{constructor(e,t,r){super(),this._field=e,this._op=t,this._value=r,this.type="where"}static _create(e,t,r){return new Dh(e,t,r)}_apply(e){const t=this._parse(e);return vP(e._query,t),new Un(e.firestore,e.converter,Cv(e._query,t))}_parse(e){const t=rl(e.firestore);return function(i,o,a,l,u,h,f){let p;if(u.isKeyField()){if(h==="array-contains"||h==="array-contains-any")throw new W(F.INVALID_ARGUMENT,`Invalid Query. You can't perform '${h}' queries on documentId().`);if(h==="in"||h==="not-in"){ZT(f,h);const w=[];for(const S of f)w.push(XT(l,i,S));p={arrayValue:{values:w}}}else p=XT(l,i,f)}else h!=="in"&&h!=="not-in"&&h!=="array-contains-any"||ZT(f,h),p=fP(a,o,f,h==="in"||h==="not-in");return at.create(u,h,p)}(e._query,"where",t,e.firestore._databaseId,this._field,this._op,this._value)}}function Fl(n,e,t){const r=e,s=Cm("where",n);return Dh._create(s,r,t)}class Jc extends Nx{constructor(e,t){super(),this.type=e,this._queryConstraints=t}static _create(e,t){return new Jc(e,t)}_parse(e){const t=this._queryConstraints.map(r=>r._parse(e)).filter(r=>r.getFilters().length>0);return t.length===1?t[0]:Et.create(t,this._getOperator())}_apply(e){const t=this._parse(e);return t.getFilters().length===0?e:(function(s,i){let o=s;const a=i.getFlattenedFilters();for(const l of a)vP(o,l),o=Cv(o,l)}(e._query,t),new Un(e.firestore,e.converter,Cv(e._query,t)))}_getQueryConstraints(){return this._queryConstraints}_getOperator(){return this.type==="and"?"and":"or"}}function V8(...n){return n.forEach(e=>wP("or",e)),Jc._create("or",n)}function F8(...n){return n.forEach(e=>wP("and",e)),Jc._create("and",n)}class kx extends Ph{constructor(e,t){super(),this._field=e,this._direction=t,this.type="orderBy"}static _create(e,t){return new kx(e,t)}_apply(e){const t=function(s,i,o){if(s.startAt!==null)throw new W(F.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(s.endAt!==null)throw new W(F.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");return new Gd(i,o)}(e._query,this._field,this._direction);return new Un(e.firestore,e.converter,function(s,i){const o=s.explicitOrderBy.concat([i]);return new Pi(s.path,s.collectionGroup,o,s.filters.slice(),s.limit,s.limitType,s.startAt,s.endAt)}(e._query,t))}}function hU(n,e="asc"){const t=e,r=Cm("orderBy",n);return kx._create(r,t)}class Rm extends Ph{constructor(e,t,r){super(),this.type=e,this._limit=t,this._limitType=r}static _create(e,t,r){return new Rm(e,t,r)}_apply(e){return new Un(e.firestore,e.converter,sg(e._query,this._limit,this._limitType))}}function U8(n){return QR("limit",n),Rm._create("limit",n,"F")}function $8(n){return QR("limitToLast",n),Rm._create("limitToLast",n,"L")}class Nm extends Ph{constructor(e,t,r){super(),this.type=e,this._docOrFields=t,this._inclusive=r}static _create(e,t,r){return new Nm(e,t,r)}_apply(e){const t=_P(e,this.type,this._docOrFields,this._inclusive);return new Un(e.firestore,e.converter,function(s,i){return new Pi(s.path,s.collectionGroup,s.explicitOrderBy.slice(),s.filters.slice(),s.limit,s.limitType,i,s.endAt)}(e._query,t))}}function B8(...n){return Nm._create("startAt",n,!0)}function z8(...n){return Nm._create("startAfter",n,!1)}class km extends Ph{constructor(e,t,r){super(),this.type=e,this._docOrFields=t,this._inclusive=r}static _create(e,t,r){return new km(e,t,r)}_apply(e){const t=_P(e,this.type,this._docOrFields,this._inclusive);return new Un(e.firestore,e.converter,function(s,i){return new Pi(s.path,s.collectionGroup,s.explicitOrderBy.slice(),s.filters.slice(),s.limit,s.limitType,s.startAt,i)}(e._query,t))}}function q8(...n){return km._create("endBefore",n,!1)}function W8(...n){return km._create("endAt",n,!0)}function _P(n,e,t,r){if(t[0]=oe(t[0]),t[0]instanceof Jd)return function(i,o,a,l,u){if(!l)throw new W(F.NOT_FOUND,`Can't use a DocumentSnapshot that doesn't exist for ${a}().`);const h=[];for(const f of Ql(i))if(f.field.isKeyField())h.push(Oa(o,l.key));else{const p=l.data.field(f.field);if(um(p))throw new W(F.INVALID_ARGUMENT,'Invalid query. You are trying to start or end a query using a document for which the field "'+f.field+'" is an uncommitted server timestamp. (Since the value of this field is unknown, you cannot start/end a query with it.)');if(p===null){const y=f.field.canonicalString();throw new W(F.INVALID_ARGUMENT,`Invalid query. You are trying to start or end a query using a document for which the field '${y}' (used as the orderBy) does not exist.`)}h.push(p)}return new Do(h,u)}(n._query,n.firestore._databaseId,e,t[0]._document,r);{const s=rl(n.firestore);return function(o,a,l,u,h,f){const p=o.explicitOrderBy;if(h.length>p.length)throw new W(F.INVALID_ARGUMENT,`Too many arguments provided to ${u}(). The number of arguments must be less than or equal to the number of orderBy() clauses`);const y=[];for(let w=0;w<h.length;w++){const S=h[w];if(p[w].field.isKeyField()){if(typeof S!="string")throw new W(F.INVALID_ARGUMENT,`Invalid query. Expected a string for document ID in ${u}(), but got a ${typeof S}`);if(!Uw(o)&&S.indexOf("/")!==-1)throw new W(F.INVALID_ARGUMENT,`Invalid query. When querying a collection and ordering by documentId(), the value passed to ${u}() must be a plain document ID, but '${S}' contains a slash.`);const k=o.path.child(rt.fromString(S));if(!re.isDocumentKey(k))throw new W(F.INVALID_ARGUMENT,`Invalid query. When querying a collection group and ordering by documentId(), the value passed to ${u}() must result in a valid document path, but '${k}' is not because it contains an odd number of segments.`);const E=new re(k);y.push(Oa(a,E))}else{const k=fP(l,u,S);y.push(k)}}return new Do(y,f)}(n._query,n.firestore._databaseId,s,e,t,r)}}function XT(n,e,t){if(typeof(t=oe(t))=="string"){if(t==="")throw new W(F.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!Uw(e)&&t.indexOf("/")!==-1)throw new W(F.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${t}' contains a '/' character.`);const r=e.path.child(rt.fromString(t));if(!re.isDocumentKey(r))throw new W(F.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${r}' is not because it has an odd number of segments (${r.length}).`);return Oa(n,new re(r))}if(t instanceof At)return Oa(n,t._key);throw new W(F.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${im(t)}.`)}function ZT(n,e){if(!Array.isArray(n)||n.length===0)throw new W(F.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${e.toString()}' filters.`)}function vP(n,e){const t=function(s,i){for(const o of s)for(const a of o.getFlattenedFilters())if(i.indexOf(a.op)>=0)return a.op;return null}(n.filters,function(s){switch(s){case"!=":return["!=","not-in"];case"array-contains-any":case"in":return["not-in"];case"not-in":return["array-contains-any","in","not-in","!="];default:return[]}}(e.op));if(t!==null)throw t===e.op?new W(F.INVALID_ARGUMENT,`Invalid query. You cannot use more than one '${e.op.toString()}' filter.`):new W(F.INVALID_ARGUMENT,`Invalid query. You cannot use '${e.op.toString()}' filters with '${t.toString()}' filters.`)}function wP(n,e){if(!(e instanceof Dh||e instanceof Jc))throw new W(F.INVALID_ARGUMENT,`Function ${n}() requires AppliableConstraints created with a call to 'where(...)', 'or(...)', or 'and(...)'.`)}class xP{convertValue(e,t="none"){switch(ko(e)){case 0:return null;case 1:return e.booleanValue;case 2:return Gt(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,t);case 5:return e.stringValue;case 6:return this.convertBytes(bi(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,t);case 11:return this.convertObject(e.mapValue,t);case 10:return this.convertVectorValue(e.mapValue);default:throw fe(62114,{value:e})}}convertObject(e,t){return this.convertObjectMap(e.fields,t)}convertObjectMap(e,t="none"){const r={};return zo(e,(s,i)=>{r[s]=this.convertValue(i,t)}),r}convertVectorValue(e){var r,s,i;const t=(i=(s=(r=e.fields)==null?void 0:r[Ic].arrayValue)==null?void 0:s.values)==null?void 0:i.map(o=>Gt(o.doubleValue));return new xs(t)}convertGeoPoint(e){return new Js(Gt(e.latitude),Gt(e.longitude))}convertArray(e,t){return(e.values||[]).map(r=>this.convertValue(r,t))}convertServerTimestamp(e,t){switch(t){case"previous":const r=dm(e);return r==null?null:this.convertValue(r,t);case"estimate":return this.convertTimestamp(Bd(e));default:return null}}convertTimestamp(e){const t=Ti(e);return new Ze(t.seconds,t.nanos)}convertDocumentKey(e,t){const r=rt.fromString(e);_e(lk(r),9688,{name:e});const s=new Da(r.get(1),r.get(3)),i=new re(r.popFirst(5));return s.isEqual(t)||pn(`Document ${i} contains a document reference within a different database (${s.projectId}/${s.database}) which is not supported. It will be treated as a reference in the current database (${t.projectId}/${t.database}) instead.`),i}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Pm(n,e,t){let r;return r=n?t&&(t.merge||t.mergeFields)?n.toFirestore(e,t):n.toFirestore(e):e,r}class Px extends xP{constructor(e){super(),this.firestore=e}convertBytes(e){return new jr(e)}convertReference(e){const t=this.convertDocumentKey(e,this.firestore._databaseId);return new At(this.firestore,null,t)}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function G8(n){return new Kd("sum",Yd("sum",n))}function H8(n){return new Kd("avg",Yd("average",n))}function fU(){return new Kd("count")}function Q8(n,e){var t,r;return n instanceof Kd&&e instanceof Kd&&n.aggregateType===e.aggregateType&&((t=n._internalFieldPath)==null?void 0:t.canonicalString())===((r=e._internalFieldPath)==null?void 0:r.canonicalString())}function K8(n,e){return aP(n.query,e.query)&&qr(n.data(),e.data())}/**
 * @license
 * Copyright 2025 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const IP="NOT SUPPORTED";class oo{constructor(e,t){this.hasPendingWrites=e,this.fromCache=t}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}}class Ur extends Jd{constructor(e,t,r,s,i,o){super(e,t,r,s,o),this._firestore=e,this._firestoreImpl=e,this.metadata=i}exists(){return super.exists()}data(e={}){if(this._document){if(this._converter){const t=new sp(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(t,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}get(e,t={}){if(this._document){const r=this._document.data.field(Cm("DocumentSnapshot.get",e));if(r!==null)return this._userDataWriter.convertValue(r,t.serverTimestamps)}}toJSON(){if(this.metadata.hasPendingWrites)throw new W(F.FAILED_PRECONDITION,"DocumentSnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");const e=this._document,t={};return t.type=Ur._jsonSchemaVersion,t.bundle="",t.bundleSource="DocumentSnapshot",t.bundleName=this._key.toString(),!e||!e.isValidDocument()||!e.isFoundDocument()?t:(this._userDataWriter.convertObjectMap(e.data.value.mapValue.fields,"previous"),t.bundle=(this._firestore,this.ref.path,"NOT SUPPORTED"),t)}}function Y8(n,e,t){if(Za(e,Ur._jsonSchema)){if(e.bundle===IP)throw new W(F.INVALID_ARGUMENT,"The provided JSON object was created in a client environment, which is not supported.");const r=el(n._databaseId),s=sP(e.bundle,r),i=s.Wu(),o=new fx(s.getMetadata(),r);for(const h of i)o.Ga(h);const a=o.documents;if(a.length!==1)throw new W(F.INVALID_ARGUMENT,`Expected bundle data to contain 1 document, but it contains ${a.length} documents.`);const l=gm(r,a[0].document),u=new re(rt.fromString(e.bundleName));return new Ur(n,new Px(n),u,l,new oo(!1,!1),t||null)}}Ur._jsonSchemaVersion="firestore/documentSnapshot/1.0",Ur._jsonSchema={type:xn("string",Ur._jsonSchemaVersion),bundleSource:xn("string","DocumentSnapshot"),bundleName:xn("string"),bundle:xn("string")};class sp extends Ur{data(e={}){return super.data(e)}}class $r{constructor(e,t,r,s){this._firestore=e,this._userDataWriter=t,this._snapshot=s,this.metadata=new oo(s.hasPendingWrites,s.fromCache),this.query=r}get docs(){const e=[];return this.forEach(t=>e.push(t)),e}get size(){return this._snapshot.docs.size}get empty(){return this.size===0}forEach(e,t){this._snapshot.docs.forEach(r=>{e.call(t,new sp(this._firestore,this._userDataWriter,r.key,r,new oo(this._snapshot.mutatedKeys.has(r.key),this._snapshot.fromCache),this.query.converter))})}docChanges(e={}){const t=!!e.includeMetadataChanges;if(t&&this._snapshot.excludesMetadataChanges)throw new W(F.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===t||(this._cachedChanges=function(s,i){if(s._snapshot.oldDocs.isEmpty()){let o=0;return s._snapshot.docChanges.map(a=>{const l=new sp(s._firestore,s._userDataWriter,a.doc.key,a.doc,new oo(s._snapshot.mutatedKeys.has(a.doc.key),s._snapshot.fromCache),s.query.converter);return a.doc,{type:"added",doc:l,oldIndex:-1,newIndex:o++}})}{let o=s._snapshot.oldDocs;return s._snapshot.docChanges.filter(a=>i||a.type!==3).map(a=>{const l=new sp(s._firestore,s._userDataWriter,a.doc.key,a.doc,new oo(s._snapshot.mutatedKeys.has(a.doc.key),s._snapshot.fromCache),s.query.converter);let u=-1,h=-1;return a.type!==0&&(u=o.indexOf(a.doc.key),o=o.delete(a.doc.key)),a.type!==1&&(o=o.add(a.doc),h=o.indexOf(a.doc.key)),{type:pU(a.type),doc:l,oldIndex:u,newIndex:h}})}}(this,t),this._cachedChangesIncludeMetadataChanges=t),this._cachedChanges}toJSON(){if(this.metadata.hasPendingWrites)throw new W(F.FAILED_PRECONDITION,"QuerySnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");const e={};e.type=$r._jsonSchemaVersion,e.bundleSource="QuerySnapshot",e.bundleName=Rw.newId(),this._firestore._databaseId.database,this._firestore._databaseId.projectId;const t=[],r=[],s=[];return this.docs.forEach(i=>{i._document!==null&&(t.push(i._document),r.push(this._userDataWriter.convertObjectMap(i._document.data.value.mapValue.fields,"previous")),s.push(i.ref.path))}),e.bundle=(this._firestore,this.query._query,e.bundleName,"NOT SUPPORTED"),e}}function J8(n,e,t){if(Za(e,$r._jsonSchema)){if(e.bundle===IP)throw new W(F.INVALID_ARGUMENT,"The provided JSON object was created in a client environment, which is not supported.");const r=el(n._databaseId),s=sP(e.bundle,r),i=s.Wu(),o=new fx(s.getMetadata(),r);for(const p of i)o.Ga(p);if(o.queries.length!==1)throw new W(F.INVALID_ARGUMENT,`Snapshot data expected 1 query but found ${o.queries.length} queries.`);const a=ym(o.queries[0].bundledQuery),l=o.documents;let u=new xa;l.map(p=>{const y=gm(r,p.document);u=u.add(y)});const h=Ba.fromInitialDocuments(a,u,He(),!1,!1),f=new Un(n,t||null,a);return new $r(n,new Px(n),f,h)}}function pU(n){switch(n){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return fe(61501,{type:n})}}function X8(n,e){return n instanceof Ur&&e instanceof Ur?n._firestore===e._firestore&&n._key.isEqual(e._key)&&(n._document===null?e._document===null:n._document.isEqual(e._document))&&n._converter===e._converter:n instanceof $r&&e instanceof $r&&n._firestore===e._firestore&&aP(n.query,e.query)&&n.metadata.isEqual(e.metadata)&&n._snapshot.isEqual(e._snapshot)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function gU(n){n=it(n,At);const e=it(n.firestore,Dt);return nP(nn(e),n._key).then(t=>Dx(e,n,t))}$r._jsonSchemaVersion="firestore/querySnapshot/1.0",$r._jsonSchema={type:xn("string",$r._jsonSchemaVersion),bundleSource:xn("string","QuerySnapshot"),bundleName:xn("string"),bundle:xn("string")};class Go extends xP{constructor(e){super(),this.firestore=e}convertBytes(e){return new jr(e)}convertReference(e){const t=this.convertDocumentKey(e,this.firestore._databaseId);return new At(this.firestore,null,t)}}function Z8(n){n=it(n,At);const e=it(n.firestore,Dt),t=nn(e),r=new Go(e);return H5(t,n._key).then(s=>new Ur(e,r,n._key,s,new oo(s!==null&&s.hasLocalMutations,!0),n.converter))}function eW(n){n=it(n,At);const e=it(n.firestore,Dt);return nP(nn(e),n._key,{source:"server"}).then(t=>Dx(e,n,t))}function od(n){n=it(n,Un);const e=it(n.firestore,Dt),t=nn(e),r=new Go(e);return yP(n._query),rP(t,n._query).then(s=>new $r(e,r,n,s))}function tW(n){n=it(n,Un);const e=it(n.firestore,Dt),t=nn(e),r=new Go(e);return Q5(t,n._query).then(s=>new $r(e,r,n,s))}function nW(n){n=it(n,Un);const e=it(n.firestore,Dt),t=nn(e),r=new Go(e);return rP(t,n._query,{source:"server"}).then(s=>new $r(e,r,n,s))}function mU(n,e,t){n=it(n,At);const r=it(n.firestore,Dt),s=Pm(n.converter,e,t);return Oh(r,[bm(rl(r),"setDoc",n._key,s,n.converter!==null,t).toMutation(n._key,Jt.none())])}function rW(n,e,t,...r){n=it(n,At);const s=it(n.firestore,Dt),i=rl(s);let o;return o=typeof(e=oe(e))=="string"||e instanceof tl?Cx(i,"updateDoc",n._key,e,t,r):Ax(i,"updateDoc",n._key,e),Oh(s,[o.toMutation(n._key,Jt.exists(!0))])}function yU(n){return Oh(it(n.firestore,Dt),[new Wc(n._key,Jt.none())])}function oi(n,e){const t=it(n.firestore,Dt),r=rp(n),s=Pm(n.converter,e);return Oh(t,[bm(rl(n.firestore),"addDoc",r._key,s,n.converter!==null,{}).toMutation(r._key,Jt.exists(!1))]).then(()=>r)}function eb(n,...e){var l,u,h;n=oe(n);let t={includeMetadataChanges:!1,source:"default"},r=0;typeof e[r]!="object"||Kl(e[r])||(t=e[r++]);const s={includeMetadataChanges:t.includeMetadataChanges,source:t.source};if(Kl(e[r])){const f=e[r];e[r]=(l=f.next)==null?void 0:l.bind(f),e[r+1]=(u=f.error)==null?void 0:u.bind(f),e[r+2]=(h=f.complete)==null?void 0:h.bind(f)}let i,o,a;if(n instanceof At)o=it(n.firestore,Dt),a=zc(n._key.path),i={next:f=>{e[r]&&e[r](Dx(o,n,f))},error:e[r+1],complete:e[r+2]};else{const f=it(n,Un);o=it(f.firestore,Dt),a=f._query;const p=new Go(o);i={next:y=>{e[r]&&e[r](new $r(o,p,f,y))},error:e[r+1],complete:e[r+2]},yP(n._query)}return function(p,y,w,S){const k=new Sm(S),E=new hx(y,k,w);return p.asyncQueue.enqueueAndForget(async()=>cx(await Dc(p),E)),()=>{k.Nu(),p.asyncQueue.enqueueAndForget(async()=>ux(await Dc(p),E))}}(nn(o),a,s,i)}function sW(n,e,...t){const r=oe(n),s=function(l){const u={bundle:"",bundleName:"",bundleSource:""},h=["bundle","bundleName","bundleSource"];for(const f of h){if(!(f in l)){u.error=`snapshotJson missing required field: ${f}`;break}const p=l[f];if(typeof p!="string"){u.error=`snapshotJson field '${f}' must be a string.`;break}if(p.length===0){u.error=`snapshotJson field '${f}' cannot be an empty string.`;break}f==="bundle"?u.bundle=p:f==="bundleName"?u.bundleName=p:f==="bundleSource"&&(u.bundleSource=p)}return u}(e);if(s.error)throw new W(F.INVALID_ARGUMENT,s.error);let i,o=0;if(typeof t[o]!="object"||Kl(t[o])||(i=t[o++]),s.bundleSource==="QuerySnapshot"){let a=null;if(typeof t[o]=="object"&&Kl(t[o])){const l=t[o++];a={next:l.next,error:l.error,complete:l.complete}}else a={next:t[o++],error:t[o++],complete:t[o++]};return function(u,h,f,p,y){let w,S=!1;return JT(u,h.bundle).then(()=>iU(u,h.bundleName)).then(E=>{E&&!S&&(y&&E.withConverter(y),w=eb(E,f||{},p))}).catch(E=>(p.error&&p.error(E),()=>{})),()=>{S||(S=!0,w&&w())}}(r,s,i,a,t[o])}if(s.bundleSource==="DocumentSnapshot"){let a=null;if(typeof t[o]=="object"&&Kl(t[o])){const l=t[o++];a={next:l.next,error:l.error,complete:l.complete}}else a={next:t[o++],error:t[o++],complete:t[o++]};return function(u,h,f,p,y){let w,S=!1;return JT(u,h.bundle).then(()=>{if(!S){const E=new At(u,y||null,re.fromPath(h.bundleName));w=eb(E,f||{},p)}}).catch(E=>(p.error&&p.error(E),()=>{})),()=>{S||(S=!0,w&&w())}}(r,s,i,a,t[o])}throw new W(F.INVALID_ARGUMENT,`unsupported bundle source: ${s.bundleSource}`)}function iW(n,e){return Y5(nn(n=it(n,Dt)),Kl(e)?e:{next:e})}function Oh(n,e){return function(r,s){const i=new jn;return r.asyncQueue.enqueueAndForget(async()=>E5(await Ix(r),s,i)),i.promise}(nn(n),e)}function Dx(n,e,t){const r=t.docs.get(e._key),s=new Go(n);return new Ur(n,s,e._key,r,new oo(t.hasPendingWrites,t.fromCache),e.converter)}function oW(n){return _U(n,{count:fU()})}function _U(n,e){const t=it(n.firestore,Dt),r=nn(t),s=dN(e,(i,o)=>new GN(o,i.aggregateType,i._internalFieldPath));return K5(r,n._query,s).then(i=>function(a,l,u){const h=new Go(a);return new oU(l,h,u)}(t,n,i))}class vU{constructor(e){this.kind="memory",this._onlineComponentProvider=Lo.provider,this._offlineComponentProvider=e!=null&&e.garbageCollector?e.garbageCollector._offlineComponentProvider:{build:()=>new vx(void 0)}}toJSON(){return{kind:this.kind}}}class wU{constructor(e){let t;this.kind="persistent",e!=null&&e.tabManager?(e.tabManager._initialize(e),t=e.tabManager):(t=TU(void 0),t._initialize(e)),this._onlineComponentProvider=t._onlineComponentProvider,this._offlineComponentProvider=t._offlineComponentProvider}toJSON(){return{kind:this.kind}}}class xU{constructor(){this.kind="memoryEager",this._offlineComponentProvider=Pc.provider}toJSON(){return{kind:this.kind}}}class IU{constructor(e){this.kind="memoryLru",this._offlineComponentProvider={build:()=>new vx(e)}}toJSON(){return{kind:this.kind}}}function aW(){return new xU}function lW(n){return new IU(n==null?void 0:n.cacheSizeBytes)}function cW(n){return new vU(n)}function uW(n){return new wU(n)}class SU{constructor(e){this.forceOwnership=e,this.kind="persistentSingleTab"}toJSON(){return{kind:this.kind}}_initialize(e){this._onlineComponentProvider=Lo.provider,this._offlineComponentProvider={build:t=>new wx(t,e==null?void 0:e.cacheSizeBytes,this.forceOwnership)}}}class EU{constructor(){this.kind="PersistentMultipleTab"}toJSON(){return{kind:this.kind}}_initialize(e){this._onlineComponentProvider=Lo.provider,this._offlineComponentProvider={build:t=>new Xk(t,e==null?void 0:e.cacheSizeBytes)}}}function TU(n){return new SU(n==null?void 0:n.forceOwnership)}function dW(){return new EU}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const bU={maxAttempts:5};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class AU{constructor(e,t){this._firestore=e,this._commitHandler=t,this._mutations=[],this._committed=!1,this._dataReader=rl(e)}set(e,t,r){this._verifyNotCommitted();const s=ao(e,this._firestore),i=Pm(s.converter,t,r),o=bm(this._dataReader,"WriteBatch.set",s._key,i,s.converter!==null,r);return this._mutations.push(o.toMutation(s._key,Jt.none())),this}update(e,t,r,...s){this._verifyNotCommitted();const i=ao(e,this._firestore);let o;return o=typeof(t=oe(t))=="string"||t instanceof tl?Cx(this._dataReader,"WriteBatch.update",i._key,t,r,s):Ax(this._dataReader,"WriteBatch.update",i._key,t),this._mutations.push(o.toMutation(i._key,Jt.exists(!0))),this}delete(e){this._verifyNotCommitted();const t=ao(e,this._firestore);return this._mutations=this._mutations.concat(new Wc(t._key,Jt.none())),this}commit(){return this._verifyNotCommitted(),this._committed=!0,this._mutations.length>0?this._commitHandler(this._mutations):Promise.resolve()}_verifyNotCommitted(){if(this._committed)throw new W(F.FAILED_PRECONDITION,"A write batch can no longer be used after commit() has been called.")}}function ao(n,e){if((n=oe(n)).firestore!==e)throw new W(F.INVALID_ARGUMENT,"Provided document reference is from a different Firestore instance.");return n}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class CU{constructor(e,t){this._firestore=e,this._transaction=t,this._dataReader=rl(e)}get(e){const t=ao(e,this._firestore),r=new Px(this._firestore);return this._transaction.lookup([t._key]).then(s=>{if(!s||s.length!==1)return fe(24041);const i=s[0];if(i.isFoundDocument())return new Jd(this._firestore,r,i.key,i,t.converter);if(i.isNoDocument())return new Jd(this._firestore,r,t._key,null,t.converter);throw fe(18433,{doc:i})})}set(e,t,r){const s=ao(e,this._firestore),i=Pm(s.converter,t,r),o=bm(this._dataReader,"Transaction.set",s._key,i,s.converter!==null,r);return this._transaction.set(s._key,o),this}update(e,t,r,...s){const i=ao(e,this._firestore);let o;return o=typeof(t=oe(t))=="string"||t instanceof tl?Cx(this._dataReader,"Transaction.update",i._key,t,r,s):Ax(this._dataReader,"Transaction.update",i._key,t),this._transaction.update(i._key,o),this}delete(e){const t=ao(e,this._firestore);return this._transaction.delete(t._key),this}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class RU extends CU{constructor(e,t){super(e,t),this._firestore=e}get(e){const t=ao(e,this._firestore),r=new Go(this._firestore);return super.get(e).then(s=>new Ur(this._firestore,r,t._key,s._document,new oo(!1,!1),t.converter))}}function hW(n,e,t){n=it(n,Dt);const r={...bU,...t};return function(i){if(i.maxAttempts<1)throw new W(F.INVALID_ARGUMENT,"Max attempts must be at least 1")}(r),function(i,o,a){const l=new jn;return i.asyncQueue.enqueueAndForget(async()=>{const u=await tP(i);new z5(i.asyncQueue,u,a,o,l).ju()}),l.promise}(nn(n),s=>e(new RU(n,s)),r)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function fW(){return new kh("deleteField")}function ip(){return new Sx("serverTimestamp")}function pW(...n){return new Ex("arrayUnion",n)}function gW(...n){return new Tx("arrayRemove",n)}function mW(n){return new bx("increment",n)}function yW(n){return new xs(n)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function _W(n){return nn(n=it(n,Dt)),new AU(n,e=>Oh(n,e))}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function vW(n,e){const t=nn(n=it(n,Dt));if(!t._uninitializedComponentsProvider||t._uninitializedComponentsProvider._offline.kind==="memory")return as("Cannot enable indexes when persistence is disabled"),Promise.resolve();const r=function(i){const o=typeof i=="string"?function(u){try{return JSON.parse(u)}catch(h){throw new W(F.INVALID_ARGUMENT,"Failed to parse JSON: "+(h==null?void 0:h.message))}}(i):i,a=[];if(Array.isArray(o.indexes))for(const l of o.indexes){const u=tb(l,"collectionGroup"),h=[];if(Array.isArray(l.fields))for(const f of l.fields){const p=Am("setIndexConfiguration",tb(f,"fieldPath"));f.arrayConfig==="CONTAINS"?h.push(new va(p,2)):f.order==="ASCENDING"?h.push(new va(p,0)):f.order==="DESCENDING"&&h.push(new va(p,1))}a.push(new mc(mc.UNKNOWN_ID,u,h,yc.empty()))}return a}(e);return Z5(t,r)}function tb(n,e){if(typeof n[e]!="string")throw new W(F.INVALID_ARGUMENT,"Missing string value for: "+e);return n[e]}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class NU{constructor(e){this._firestore=e,this.type="PersistentCacheIndexManager"}}function wW(n){var s;n=it(n,Dt);const e=nb.get(n);if(e)return e;if(((s=nn(n)._uninitializedComponentsProvider)==null?void 0:s._offline.kind)!=="persistent")return null;const r=new NU(n);return nb.set(n,r),r}function xW(n){SP(n,!0)}function IW(n){SP(n,!1)}function SW(n){tU(nn(n._firestore)).then(e=>Y("deleting all persistent cache indexes succeeded")).catch(e=>as("deleting all persistent cache indexes failed",e))}function SP(n,e){eU(nn(n._firestore),e).then(t=>Y(`setting persistent cache index auto creation isEnabled=${e} succeeded`)).catch(t=>as(`setting persistent cache index auto creation isEnabled=${e} failed`,t))}const nb=new WeakMap;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function EW(n){var r;const e=nn(it(n.firestore,Dt)),t=(r=e._onlineComponents)==null?void 0:r.datastore.serializer;return t===void 0?null:mm(t,lr(n._query)).ft}function TW(n,e){var i;const t=dN(e,(o,a)=>new GN(a,o.aggregateType,o._internalFieldPath)),r=nn(it(n.firestore,Dt)),s=(i=r._onlineComponents)==null?void 0:i.datastore.serializer;return s===void 0?null:sk(s,NN(n._query),t,!0).request}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class bW{constructor(){throw new Error("instances of this class should not be created")}static onExistenceFilterMismatch(e){return Ox.instance.onExistenceFilterMismatch(e)}}class Ox{constructor(){this.Mc=new Map}static get instance(){return bf||(bf=new Ox,function(t){if(sd)throw new Error("a TestingHooksSpi instance is already set");sd=t}(bf)),bf}lt(e){this.Mc.forEach(t=>t(e))}onExistenceFilterMismatch(e){const t=Symbol(),r=this.Mc;return r.set(t,e),()=>r.delete(t)}}let bf=null;(function(e,t=!0){(function(s){Bc=s})(Ka),Ss(new Nr("firestore",(r,{instanceIdentifier:s,options:i})=>{const o=r.getProvider("app").getImmediate(),a=new Dt(new U4(r.getProvider("auth-internal")),new z4(o,r.getProvider("app-check-internal")),function(u,h){if(!Object.prototype.hasOwnProperty.apply(u.options,["projectId"]))throw new W(F.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new Da(u.options.projectId,h)}(o,s),o);return i={useFetchStreams:t,...i},a._setSettings(i),a},"PUBLIC").setMultipleInstances(!0)),Cr(PE,DE,e),Cr(PE,DE,"esm2020")})();/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const AW={PHONE:"phone",TOTP:"totp"},CW={FACEBOOK:"facebook.com",GITHUB:"github.com",GOOGLE:"google.com",PASSWORD:"password",PHONE:"phone",TWITTER:"twitter.com"},RW={EMAIL_LINK:"emailLink",EMAIL_PASSWORD:"password",FACEBOOK:"facebook.com",GITHUB:"github.com",GOOGLE:"google.com",PHONE:"phone",TWITTER:"twitter.com"},NW={LINK:"link",REAUTHENTICATE:"reauthenticate",SIGN_IN:"signIn"},kW={EMAIL_SIGNIN:"EMAIL_SIGNIN",PASSWORD_RESET:"PASSWORD_RESET",RECOVER_EMAIL:"RECOVER_EMAIL",REVERT_SECOND_FACTOR_ADDITION:"REVERT_SECOND_FACTOR_ADDITION",VERIFY_AND_CHANGE_EMAIL:"VERIFY_AND_CHANGE_EMAIL",VERIFY_EMAIL:"VERIFY_EMAIL"};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function kU(){return{"admin-restricted-operation":"This operation is restricted to administrators only.","argument-error":"","app-not-authorized":"This app, identified by the domain where it's hosted, is not authorized to use Firebase Authentication with the provided API key. Review your key configuration in the Google API console.","app-not-installed":"The requested mobile application corresponding to the identifier (Android package name or iOS bundle ID) provided is not installed on this device.","captcha-check-failed":"The reCAPTCHA response token provided is either invalid, expired, already used or the domain associated with it does not match the list of whitelisted domains.","code-expired":"The SMS code has expired. Please re-send the verification code to try again.","cordova-not-ready":"Cordova framework is not ready.","cors-unsupported":"This browser is not supported.","credential-already-in-use":"This credential is already associated with a different user account.","custom-token-mismatch":"The custom token corresponds to a different audience.","requires-recent-login":"This operation is sensitive and requires recent authentication. Log in again before retrying this request.","dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK.","dynamic-link-not-activated":"Please activate Dynamic Links in the Firebase Console and agree to the terms and conditions.","email-change-needs-verification":"Multi-factor users must always have a verified email.","email-already-in-use":"The email address is already in use by another account.","emulator-config-failed":'Auth instance has already been used to make a network call. Auth can no longer be configured to use the emulator. Try calling "connectAuthEmulator()" sooner.',"expired-action-code":"The action code has expired.","cancelled-popup-request":"This operation has been cancelled due to another conflicting popup being opened.","internal-error":"An internal AuthError has occurred.","invalid-app-credential":"The phone verification request contains an invalid application verifier. The reCAPTCHA token response is either invalid or expired.","invalid-app-id":"The mobile app identifier is not registered for the current project.","invalid-user-token":"This user's credential isn't valid for this project. This can happen if the user's token has been tampered with, or if the user isn't for the project associated with this API key.","invalid-auth-event":"An internal AuthError has occurred.","invalid-verification-code":"The SMS verification code used to create the phone auth credential is invalid. Please resend the verification code sms and be sure to use the verification code provided by the user.","invalid-continue-uri":"The continue URL provided in the request is invalid.","invalid-cordova-configuration":"The following Cordova plugins must be installed to enable OAuth sign-in: cordova-plugin-buildinfo, cordova-universal-links-plugin, cordova-plugin-browsertab, cordova-plugin-inappbrowser and cordova-plugin-customurlscheme.","invalid-custom-token":"The custom token format is incorrect. Please check the documentation.","invalid-dynamic-link-domain":"The provided dynamic link domain is not configured or authorized for the current project.","invalid-email":"The email address is badly formatted.","invalid-emulator-scheme":"Emulator URL must start with a valid scheme (http:// or https://).","invalid-api-key":"Your API key is invalid, please check you have copied it correctly.","invalid-cert-hash":"The SHA-1 certificate hash provided is invalid.","invalid-credential":"The supplied auth credential is incorrect, malformed or has expired.","invalid-message-payload":"The email template corresponding to this action contains invalid characters in its message. Please fix by going to the Auth email templates section in the Firebase Console.","invalid-multi-factor-session":"The request does not contain a valid proof of first factor successful sign-in.","invalid-oauth-provider":"EmailAuthProvider is not supported for this operation. This operation only supports OAuth providers.","invalid-oauth-client-id":"The OAuth client ID provided is either invalid or does not match the specified API key.","unauthorized-domain":"This domain is not authorized for OAuth operations for your Firebase project. Edit the list of authorized domains from the Firebase console.","invalid-action-code":"The action code is invalid. This can happen if the code is malformed, expired, or has already been used.","wrong-password":"The password is invalid or the user does not have a password.","invalid-persistence-type":"The specified persistence type is invalid. It can only be local, session or none.","invalid-phone-number":"The format of the phone number provided is incorrect. Please enter the phone number in a format that can be parsed into E.164 format. E.164 phone numbers are written in the format [+][country code][subscriber number including area code].","invalid-provider-id":"The specified provider ID is invalid.","invalid-recipient-email":"The email corresponding to this action failed to send as the provided recipient email address is invalid.","invalid-sender":"The email template corresponding to this action contains an invalid sender email or name. Please fix by going to the Auth email templates section in the Firebase Console.","invalid-verification-id":"The verification ID used to create the phone auth credential is invalid.","invalid-tenant-id":"The Auth instance's tenant ID is invalid.","login-blocked":"Login blocked by user-provided method: {$originalMessage}","missing-android-pkg-name":"An Android Package Name must be provided if the Android App is required to be installed.","auth-domain-config-required":"Be sure to include authDomain when calling firebase.initializeApp(), by following the instructions in the Firebase console.","missing-app-credential":"The phone verification request is missing an application verifier assertion. A reCAPTCHA response token needs to be provided.","missing-verification-code":"The phone auth credential was created with an empty SMS verification code.","missing-continue-uri":"A continue URL must be provided in the request.","missing-iframe-start":"An internal AuthError has occurred.","missing-ios-bundle-id":"An iOS Bundle ID must be provided if an App Store ID is provided.","missing-or-invalid-nonce":"The request does not contain a valid nonce. This can occur if the SHA-256 hash of the provided raw nonce does not match the hashed nonce in the ID token payload.","missing-password":"A non-empty password must be provided","missing-multi-factor-info":"No second factor identifier is provided.","missing-multi-factor-session":"The request is missing proof of first factor successful sign-in.","missing-phone-number":"To send verification codes, provide a phone number for the recipient.","missing-verification-id":"The phone auth credential was created with an empty verification ID.","app-deleted":"This instance of FirebaseApp has been deleted.","multi-factor-info-not-found":"The user does not have a second factor matching the identifier provided.","multi-factor-auth-required":"Proof of ownership of a second factor is required to complete sign-in.","account-exists-with-different-credential":"An account already exists with the same email address but different sign-in credentials. Sign in using a provider associated with this email address.","network-request-failed":"A network AuthError (such as timeout, interrupted connection or unreachable host) has occurred.","no-auth-event":"An internal AuthError has occurred.","no-such-provider":"User was not linked to an account with the given provider.","null-user":"A null user object was provided as the argument for an operation which requires a non-null user object.","operation-not-allowed":"The given sign-in provider is disabled for this Firebase project. Enable it in the Firebase console, under the sign-in method tab of the Auth section.","operation-not-supported-in-this-environment":'This operation is not supported in the environment this application is running on. "location.protocol" must be http, https or chrome-extension and web storage must be enabled.',"popup-blocked":"Unable to establish a connection with the popup. It may have been blocked by the browser.","popup-closed-by-user":"The popup has been closed by the user before finalizing the operation.","provider-already-linked":"User can only be linked to one identity for the given provider.","quota-exceeded":"The project's quota for this operation has been exceeded.","redirect-cancelled-by-user":"The redirect operation has been cancelled by the user before finalizing.","redirect-operation-pending":"A redirect sign-in operation is already pending.","rejected-credential":"The request contains malformed or mismatching credentials.","second-factor-already-in-use":"The second factor is already enrolled on this account.","maximum-second-factor-count-exceeded":"The maximum allowed number of second factors on a user has been exceeded.","tenant-id-mismatch":"The provided tenant ID does not match the Auth instance's tenant ID",timeout:"The operation has timed out.","user-token-expired":"The user's credential is no longer valid. The user must sign in again.","too-many-requests":"We have blocked all requests from this device due to unusual activity. Try again later.","unauthorized-continue-uri":"The domain of the continue URL is not whitelisted.  Please whitelist the domain in the Firebase console.","unsupported-first-factor":"Enrolling a second factor or signing in with a multi-factor account requires sign-in with a supported first factor.","unsupported-persistence-type":"The current environment does not support the specified persistence type.","unsupported-tenant-operation":"This operation is not supported in a multi-tenant context.","unverified-email":"The operation requires a verified email.","user-cancelled":"The user did not grant your application the permissions it requested.","user-not-found":"There is no user record corresponding to this identifier. The user may have been deleted.","user-disabled":"The user account has been disabled by an administrator.","user-mismatch":"The supplied credentials do not correspond to the previously signed in user.","user-signed-out":"","weak-password":"The password must be 6 characters long or more.","web-storage-unsupported":"This browser is not supported or 3rd party cookies and data may be disabled.","already-initialized":"initializeAuth() has already been called with different options. To avoid this error, call initializeAuth() with the same options as when it was originally called, or call getAuth() to return the already initialized instance.","missing-recaptcha-token":"The reCAPTCHA token is missing when sending request to the backend.","invalid-recaptcha-token":"The reCAPTCHA token is invalid when sending request to the backend.","invalid-recaptcha-action":"The reCAPTCHA action is invalid when sending request to the backend.","recaptcha-not-enabled":"reCAPTCHA Enterprise integration is not enabled for this project.","missing-client-type":"The reCAPTCHA client type is missing when sending request to the backend.","missing-recaptcha-version":"The reCAPTCHA version is missing when sending request to the backend.","invalid-req-type":"Invalid request parameters.","invalid-recaptcha-version":"The reCAPTCHA version is invalid when sending request to the backend.","unsupported-password-policy-schema-version":"The password policy received from the backend uses a schema version that is not supported by this version of the Firebase SDK.","password-does-not-meet-requirements":"The password does not meet the requirements.","invalid-hosting-link-domain":"The provided Hosting link domain is not configured in Firebase Hosting or is not owned by the current project. This cannot be a default Hosting domain (`web.app` or `firebaseapp.com`)."}}function EP(){return{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}}const PW=kU,PU=EP,TP=new Ha("auth","Firebase",EP()),DW={ADMIN_ONLY_OPERATION:"auth/admin-restricted-operation",ARGUMENT_ERROR:"auth/argument-error",APP_NOT_AUTHORIZED:"auth/app-not-authorized",APP_NOT_INSTALLED:"auth/app-not-installed",CAPTCHA_CHECK_FAILED:"auth/captcha-check-failed",CODE_EXPIRED:"auth/code-expired",CORDOVA_NOT_READY:"auth/cordova-not-ready",CORS_UNSUPPORTED:"auth/cors-unsupported",CREDENTIAL_ALREADY_IN_USE:"auth/credential-already-in-use",CREDENTIAL_MISMATCH:"auth/custom-token-mismatch",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"auth/requires-recent-login",DEPENDENT_SDK_INIT_BEFORE_AUTH:"auth/dependent-sdk-initialized-before-auth",DYNAMIC_LINK_NOT_ACTIVATED:"auth/dynamic-link-not-activated",EMAIL_CHANGE_NEEDS_VERIFICATION:"auth/email-change-needs-verification",EMAIL_EXISTS:"auth/email-already-in-use",EMULATOR_CONFIG_FAILED:"auth/emulator-config-failed",EXPIRED_OOB_CODE:"auth/expired-action-code",EXPIRED_POPUP_REQUEST:"auth/cancelled-popup-request",INTERNAL_ERROR:"auth/internal-error",INVALID_API_KEY:"auth/invalid-api-key",INVALID_APP_CREDENTIAL:"auth/invalid-app-credential",INVALID_APP_ID:"auth/invalid-app-id",INVALID_AUTH:"auth/invalid-user-token",INVALID_AUTH_EVENT:"auth/invalid-auth-event",INVALID_CERT_HASH:"auth/invalid-cert-hash",INVALID_CODE:"auth/invalid-verification-code",INVALID_CONTINUE_URI:"auth/invalid-continue-uri",INVALID_CORDOVA_CONFIGURATION:"auth/invalid-cordova-configuration",INVALID_CUSTOM_TOKEN:"auth/invalid-custom-token",INVALID_DYNAMIC_LINK_DOMAIN:"auth/invalid-dynamic-link-domain",INVALID_EMAIL:"auth/invalid-email",INVALID_EMULATOR_SCHEME:"auth/invalid-emulator-scheme",INVALID_IDP_RESPONSE:"auth/invalid-credential",INVALID_LOGIN_CREDENTIALS:"auth/invalid-credential",INVALID_MESSAGE_PAYLOAD:"auth/invalid-message-payload",INVALID_MFA_SESSION:"auth/invalid-multi-factor-session",INVALID_OAUTH_CLIENT_ID:"auth/invalid-oauth-client-id",INVALID_OAUTH_PROVIDER:"auth/invalid-oauth-provider",INVALID_OOB_CODE:"auth/invalid-action-code",INVALID_ORIGIN:"auth/unauthorized-domain",INVALID_PASSWORD:"auth/wrong-password",INVALID_PERSISTENCE:"auth/invalid-persistence-type",INVALID_PHONE_NUMBER:"auth/invalid-phone-number",INVALID_PROVIDER_ID:"auth/invalid-provider-id",INVALID_RECIPIENT_EMAIL:"auth/invalid-recipient-email",INVALID_SENDER:"auth/invalid-sender",INVALID_SESSION_INFO:"auth/invalid-verification-id",INVALID_TENANT_ID:"auth/invalid-tenant-id",MFA_INFO_NOT_FOUND:"auth/multi-factor-info-not-found",MFA_REQUIRED:"auth/multi-factor-auth-required",MISSING_ANDROID_PACKAGE_NAME:"auth/missing-android-pkg-name",MISSING_APP_CREDENTIAL:"auth/missing-app-credential",MISSING_AUTH_DOMAIN:"auth/auth-domain-config-required",MISSING_CODE:"auth/missing-verification-code",MISSING_CONTINUE_URI:"auth/missing-continue-uri",MISSING_IFRAME_START:"auth/missing-iframe-start",MISSING_IOS_BUNDLE_ID:"auth/missing-ios-bundle-id",MISSING_OR_INVALID_NONCE:"auth/missing-or-invalid-nonce",MISSING_MFA_INFO:"auth/missing-multi-factor-info",MISSING_MFA_SESSION:"auth/missing-multi-factor-session",MISSING_PHONE_NUMBER:"auth/missing-phone-number",MISSING_SESSION_INFO:"auth/missing-verification-id",MODULE_DESTROYED:"auth/app-deleted",NEED_CONFIRMATION:"auth/account-exists-with-different-credential",NETWORK_REQUEST_FAILED:"auth/network-request-failed",NULL_USER:"auth/null-user",NO_AUTH_EVENT:"auth/no-auth-event",NO_SUCH_PROVIDER:"auth/no-such-provider",OPERATION_NOT_ALLOWED:"auth/operation-not-allowed",OPERATION_NOT_SUPPORTED:"auth/operation-not-supported-in-this-environment",POPUP_BLOCKED:"auth/popup-blocked",POPUP_CLOSED_BY_USER:"auth/popup-closed-by-user",PROVIDER_ALREADY_LINKED:"auth/provider-already-linked",QUOTA_EXCEEDED:"auth/quota-exceeded",REDIRECT_CANCELLED_BY_USER:"auth/redirect-cancelled-by-user",REDIRECT_OPERATION_PENDING:"auth/redirect-operation-pending",REJECTED_CREDENTIAL:"auth/rejected-credential",SECOND_FACTOR_ALREADY_ENROLLED:"auth/second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"auth/maximum-second-factor-count-exceeded",TENANT_ID_MISMATCH:"auth/tenant-id-mismatch",TIMEOUT:"auth/timeout",TOKEN_EXPIRED:"auth/user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"auth/too-many-requests",UNAUTHORIZED_DOMAIN:"auth/unauthorized-continue-uri",UNSUPPORTED_FIRST_FACTOR:"auth/unsupported-first-factor",UNSUPPORTED_PERSISTENCE:"auth/unsupported-persistence-type",UNSUPPORTED_TENANT_OPERATION:"auth/unsupported-tenant-operation",UNVERIFIED_EMAIL:"auth/unverified-email",USER_CANCELLED:"auth/user-cancelled",USER_DELETED:"auth/user-not-found",USER_DISABLED:"auth/user-disabled",USER_MISMATCH:"auth/user-mismatch",USER_SIGNED_OUT:"auth/user-signed-out",WEAK_PASSWORD:"auth/weak-password",WEB_STORAGE_UNSUPPORTED:"auth/web-storage-unsupported",ALREADY_INITIALIZED:"auth/already-initialized",RECAPTCHA_NOT_ENABLED:"auth/recaptcha-not-enabled",MISSING_RECAPTCHA_TOKEN:"auth/missing-recaptcha-token",INVALID_RECAPTCHA_TOKEN:"auth/invalid-recaptcha-token",INVALID_RECAPTCHA_ACTION:"auth/invalid-recaptcha-action",MISSING_CLIENT_TYPE:"auth/missing-client-type",MISSING_RECAPTCHA_VERSION:"auth/missing-recaptcha-version",INVALID_RECAPTCHA_VERSION:"auth/invalid-recaptcha-version",INVALID_REQ_TYPE:"auth/invalid-req-type",INVALID_HOSTING_LINK_DOMAIN:"auth/invalid-hosting-link-domain"};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const pg=new ch("@firebase/auth");function DU(n,...e){pg.logLevel<=st.WARN&&pg.warn(`Auth (${Ka}): ${n}`,...e)}function op(n,...e){pg.logLevel<=st.ERROR&&pg.error(`Auth (${Ka}): ${n}`,...e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function kr(n,...e){throw Mx(n,...e)}function mr(n,...e){return Mx(n,...e)}function Lx(n,e,t){const r={...PU(),[e]:t};return new Ha("auth","Firebase",r).create(e,{appName:n.name})}function Vn(n){return Lx(n,"operation-not-supported-in-this-environment","Operations that alter the current user are not supported in conjunction with FirebaseServerApp")}function Xc(n,e,t){const r=t;if(!(e instanceof r))throw r.name!==e.constructor.name&&kr(n,"argument-error"),Lx(n,"argument-error",`Type of ${e.constructor.name} does not match expected instance.Did you pass a reference from a different Auth SDK?`)}function Mx(n,...e){if(typeof n!="string"){const t=e[0],r=[...e.slice(1)];return r[0]&&(r[0].appName=n.name),n._errorFactory.create(t,...r)}return TP.create(n,...e)}function ee(n,e,...t){if(!n)throw Mx(e,...t)}function zs(n){const e="INTERNAL ASSERTION FAILED: "+n;throw op(e),new Error(e)}function Ai(n,e){n||zs(e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Xd(){var n;return typeof self<"u"&&((n=self.location)==null?void 0:n.href)||""}function jx(){return rb()==="http:"||rb()==="https:"}function rb(){var n;return typeof self<"u"&&((n=self.location)==null?void 0:n.protocol)||null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function OU(){return typeof navigator<"u"&&navigator&&"onLine"in navigator&&typeof navigator.onLine=="boolean"&&(jx()||B0()||"connection"in navigator)?navigator.onLine:!0}function LU(){if(typeof navigator>"u")return null;const n=navigator;return n.languages&&n.languages[0]||n.language||null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Lh{constructor(e,t){this.shortDelay=e,this.longDelay=t,Ai(t>e,"Short delay should be less than long delay!"),this.isMobile=$0()||o1()}get(){return OU()?this.isMobile?this.longDelay:this.shortDelay:Math.min(5e3,this.shortDelay)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Vx(n,e){Ai(n.emulator,"Emulator should always be set here");const{url:t}=n.emulator;return e?`${t}${e.startsWith("/")?e.slice(1):e}`:t}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class bP{static initialize(e,t,r){this.fetchImpl=e,t&&(this.headersImpl=t),r&&(this.responseImpl=r)}static fetch(){if(this.fetchImpl)return this.fetchImpl;if(typeof self<"u"&&"fetch"in self)return self.fetch;if(typeof globalThis<"u"&&globalThis.fetch)return globalThis.fetch;if(typeof fetch<"u")return fetch;zs("Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static headers(){if(this.headersImpl)return this.headersImpl;if(typeof self<"u"&&"Headers"in self)return self.Headers;if(typeof globalThis<"u"&&globalThis.Headers)return globalThis.Headers;if(typeof Headers<"u")return Headers;zs("Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static response(){if(this.responseImpl)return this.responseImpl;if(typeof self<"u"&&"Response"in self)return self.Response;if(typeof globalThis<"u"&&globalThis.Response)return globalThis.Response;if(typeof Response<"u")return Response;zs("Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const MU={CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_PASSWORD:"wrong-password",MISSING_PASSWORD:"missing-password",INVALID_LOGIN_CREDENTIALS:"invalid-credential",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_REQ_TYPE:"internal-error",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",PASSWORD_DOES_NOT_MEET_REQUIREMENTS:"password-does-not-meet-requirements",INVALID_CODE:"invalid-verification-code",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_SESSION_INFO:"missing-verification-id",SESSION_EXPIRED:"code-expired",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",ADMIN_ONLY_OPERATION:"admin-restricted-operation",INVALID_MFA_PENDING_CREDENTIAL:"invalid-multi-factor-session",MFA_ENROLLMENT_NOT_FOUND:"multi-factor-info-not-found",MISSING_MFA_ENROLLMENT_ID:"missing-multi-factor-info",MISSING_MFA_PENDING_CREDENTIAL:"missing-multi-factor-session",SECOND_FACTOR_EXISTS:"second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"maximum-second-factor-count-exceeded",BLOCKING_FUNCTION_ERROR_RESPONSE:"internal-error",RECAPTCHA_NOT_ENABLED:"recaptcha-not-enabled",MISSING_RECAPTCHA_TOKEN:"missing-recaptcha-token",INVALID_RECAPTCHA_TOKEN:"invalid-recaptcha-token",INVALID_RECAPTCHA_ACTION:"invalid-recaptcha-action",MISSING_CLIENT_TYPE:"missing-client-type",MISSING_RECAPTCHA_VERSION:"missing-recaptcha-version",INVALID_RECAPTCHA_VERSION:"invalid-recaptcha-version",INVALID_REQ_TYPE:"invalid-req-type"};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const jU=["/v1/accounts:signInWithCustomToken","/v1/accounts:signInWithEmailLink","/v1/accounts:signInWithIdp","/v1/accounts:signInWithPassword","/v1/accounts:signInWithPhoneNumber","/v1/token"],VU=new Lh(3e4,6e4);function Bt(n,e){return n.tenantId&&!e.tenantId?{...e,tenantId:n.tenantId}:e}async function zt(n,e,t,r,s={}){return AP(n,s,async()=>{let i={},o={};r&&(e==="GET"?o=r:i={body:JSON.stringify(r)});const a=Qa({key:n.config.apiKey,...o}).slice(1),l=await n._getAdditionalHeaders();l["Content-Type"]="application/json",n.languageCode&&(l["X-Firebase-Locale"]=n.languageCode);const u={method:e,headers:l,...i};return KL()||(u.referrerPolicy="no-referrer"),n.emulatorConfig&&ki(n.emulatorConfig.host)&&(u.credentials="include"),bP.fetch()(await CP(n,n.config.apiHost,t,a),u)})}async function AP(n,e,t){n._canInitEmulator=!1;const r={...MU,...e};try{const s=new UU(n),i=await Promise.race([t(),s.promise]);s.clearNetworkTimeout();const o=await i.json();if("needConfirmation"in o)throw Mu(n,"account-exists-with-different-credential",o);if(i.ok&&!("errorMessage"in o))return o;{const a=i.ok?o.errorMessage:o.error.message,[l,u]=a.split(" : ");if(l==="FEDERATED_USER_ID_ALREADY_LINKED")throw Mu(n,"credential-already-in-use",o);if(l==="EMAIL_EXISTS")throw Mu(n,"email-already-in-use",o);if(l==="USER_DISABLED")throw Mu(n,"user-disabled",o);const h=r[l]||l.toLowerCase().replace(/[_\s]+/g,"-");if(u)throw Lx(n,h,u);kr(n,h)}}catch(s){if(s instanceof Es)throw s;kr(n,"network-request-failed",{message:String(s)})}}async function Mi(n,e,t,r,s={}){const i=await zt(n,e,t,r,s);return"mfaPendingCredential"in i&&kr(n,"multi-factor-auth-required",{_serverResponse:i}),i}async function CP(n,e,t,r){const s=`${e}${t}?${r}`,i=n,o=i.config.emulator?Vx(n.config,s):`${n.config.apiScheme}://${s}`;return jU.includes(t)&&(await i._persistenceManagerAvailable,i._getPersistenceType()==="COOKIE")?i._getPersistence()._getFinalTarget(o).toString():o}function FU(n){switch(n){case"ENFORCE":return"ENFORCE";case"AUDIT":return"AUDIT";case"OFF":return"OFF";default:return"ENFORCEMENT_STATE_UNSPECIFIED"}}class UU{clearNetworkTimeout(){clearTimeout(this.timer)}constructor(e){this.auth=e,this.timer=null,this.promise=new Promise((t,r)=>{this.timer=setTimeout(()=>r(mr(this.auth,"network-request-failed")),VU.get())})}}function Mu(n,e,t){const r={appName:n.name};t.email&&(r.email=t.email),t.phoneNumber&&(r.phoneNumber=t.phoneNumber);const s=mr(n,e,r);return s.customData._tokenResponse=t,s}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function sb(n){return n!==void 0&&n.getResponse!==void 0}function ib(n){return n!==void 0&&n.enterprise!==void 0}class RP{constructor(e){if(this.siteKey="",this.recaptchaEnforcementState=[],e.recaptchaKey===void 0)throw new Error("recaptchaKey undefined");this.siteKey=e.recaptchaKey.split("/")[3],this.recaptchaEnforcementState=e.recaptchaEnforcementState}getProviderEnforcementState(e){if(!this.recaptchaEnforcementState||this.recaptchaEnforcementState.length===0)return null;for(const t of this.recaptchaEnforcementState)if(t.provider&&t.provider===e)return FU(t.enforcementState);return null}isProviderEnabled(e){return this.getProviderEnforcementState(e)==="ENFORCE"||this.getProviderEnforcementState(e)==="AUDIT"}isAnyProviderEnabled(){return this.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")||this.isProviderEnabled("PHONE_PROVIDER")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function $U(n){return(await zt(n,"GET","/v1/recaptchaParams")).recaptchaSiteKey||""}async function NP(n,e){return zt(n,"GET","/v2/recaptchaConfig",Bt(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function BU(n,e){return zt(n,"POST","/v1/accounts:delete",e)}async function zU(n,e){return zt(n,"POST","/v1/accounts:update",e)}async function gg(n,e){return zt(n,"POST","/v1/accounts:lookup",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ad(n){if(n)try{const e=new Date(Number(n));if(!isNaN(e.getTime()))return e.toUTCString()}catch{}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function OW(n,e=!1){return oe(n).getIdToken(e)}async function qU(n,e=!1){const t=oe(n),r=await t.getIdToken(e),s=Dm(r);ee(s&&s.exp&&s.auth_time&&s.iat,t.auth,"internal-error");const i=typeof s.firebase=="object"?s.firebase:void 0,o=i==null?void 0:i.sign_in_provider;return{claims:s,token:r,authTime:ad(By(s.auth_time)),issuedAtTime:ad(By(s.iat)),expirationTime:ad(By(s.exp)),signInProvider:o||null,signInSecondFactor:(i==null?void 0:i.sign_in_second_factor)||null}}function By(n){return Number(n)*1e3}function Dm(n){const[e,t,r]=n.split(".");if(e===void 0||t===void 0||r===void 0)return op("JWT malformed, contained fewer than 3 sections"),null;try{const s=Mp(t);return s?JSON.parse(s):(op("Failed to decode base64 JWT payload"),null)}catch(s){return op("Caught error parsing JWT payload as JSON",s==null?void 0:s.toString()),null}}function ob(n){const e=Dm(n);return ee(e,"internal-error"),ee(typeof e.exp<"u","internal-error"),ee(typeof e.iat<"u","internal-error"),Number(e.exp)-Number(e.iat)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Ci(n,e,t=!1){if(t)return e;try{return await e}catch(r){throw r instanceof Es&&WU(r)&&n.auth.currentUser===n&&await n.auth.signOut(),r}}function WU({code:n}){return n==="auth/user-disabled"||n==="auth/user-token-expired"}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class GU{constructor(e){this.user=e,this.isRunning=!1,this.timerId=null,this.errorBackoff=3e4}_start(){this.isRunning||(this.isRunning=!0,this.schedule())}_stop(){this.isRunning&&(this.isRunning=!1,this.timerId!==null&&clearTimeout(this.timerId))}getInterval(e){if(e){const t=this.errorBackoff;return this.errorBackoff=Math.min(this.errorBackoff*2,96e4),t}else{this.errorBackoff=3e4;const r=(this.user.stsTokenManager.expirationTime??0)-Date.now()-3e5;return Math.max(0,r)}}schedule(e=!1){if(!this.isRunning)return;const t=this.getInterval(e);this.timerId=setTimeout(async()=>{await this.iteration()},t)}async iteration(){try{await this.user.getIdToken(!0)}catch(e){(e==null?void 0:e.code)==="auth/network-request-failed"&&this.schedule(!0);return}this.schedule()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class $v{constructor(e,t){this.createdAt=e,this.lastLoginAt=t,this._initializeTime()}_initializeTime(){this.lastSignInTime=ad(this.lastLoginAt),this.creationTime=ad(this.createdAt)}_copy(e){this.createdAt=e.createdAt,this.lastLoginAt=e.lastLoginAt,this._initializeTime()}toJSON(){return{createdAt:this.createdAt,lastLoginAt:this.lastLoginAt}}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Zd(n){var f;const e=n.auth,t=await n.getIdToken(),r=await Ci(n,gg(e,{idToken:t}));ee(r==null?void 0:r.users.length,e,"internal-error");const s=r.users[0];n._notifyReloadListener(s);const i=(f=s.providerUserInfo)!=null&&f.length?kP(s.providerUserInfo):[],o=QU(n.providerData,i),a=n.isAnonymous,l=!(n.email&&s.passwordHash)&&!(o!=null&&o.length),u=a?l:!1,h={uid:s.localId,displayName:s.displayName||null,photoURL:s.photoUrl||null,email:s.email||null,emailVerified:s.emailVerified||!1,phoneNumber:s.phoneNumber||null,tenantId:s.tenantId||null,providerData:o,metadata:new $v(s.createdAt,s.lastLoginAt),isAnonymous:u};Object.assign(n,h)}async function HU(n){const e=oe(n);await Zd(e),await e.auth._persistUserIfCurrent(e),e.auth._notifyListenersIfCurrent(e)}function QU(n,e){return[...n.filter(r=>!e.some(s=>s.providerId===r.providerId)),...e]}function kP(n){return n.map(({providerId:e,...t})=>({providerId:e,uid:t.rawId||"",displayName:t.displayName||null,email:t.email||null,phoneNumber:t.phoneNumber||null,photoURL:t.photoUrl||null}))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function KU(n,e){const t=await AP(n,{},async()=>{const r=Qa({grant_type:"refresh_token",refresh_token:e}).slice(1),{tokenApiHost:s,apiKey:i}=n.config,o=await CP(n,s,"/v1/token",`key=${i}`),a=await n._getAdditionalHeaders();a["Content-Type"]="application/x-www-form-urlencoded";const l={method:"POST",headers:a,body:r};return n.emulatorConfig&&ki(n.emulatorConfig.host)&&(l.credentials="include"),bP.fetch()(o,l)});return{accessToken:t.access_token,expiresIn:t.expires_in,refreshToken:t.refresh_token}}async function YU(n,e){return zt(n,"POST","/v2/accounts:revokeToken",Bt(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Yl{constructor(){this.refreshToken=null,this.accessToken=null,this.expirationTime=null}get isExpired(){return!this.expirationTime||Date.now()>this.expirationTime-3e4}updateFromServerResponse(e){ee(e.idToken,"internal-error"),ee(typeof e.idToken<"u","internal-error"),ee(typeof e.refreshToken<"u","internal-error");const t="expiresIn"in e&&typeof e.expiresIn<"u"?Number(e.expiresIn):ob(e.idToken);this.updateTokensAndExpiration(e.idToken,e.refreshToken,t)}updateFromIdToken(e){ee(e.length!==0,"internal-error");const t=ob(e);this.updateTokensAndExpiration(e,null,t)}async getToken(e,t=!1){return!t&&this.accessToken&&!this.isExpired?this.accessToken:(ee(this.refreshToken,e,"user-token-expired"),this.refreshToken?(await this.refresh(e,this.refreshToken),this.accessToken):null)}clearRefreshToken(){this.refreshToken=null}async refresh(e,t){const{accessToken:r,refreshToken:s,expiresIn:i}=await KU(e,t);this.updateTokensAndExpiration(r,s,Number(i))}updateTokensAndExpiration(e,t,r){this.refreshToken=t||null,this.accessToken=e||null,this.expirationTime=Date.now()+r*1e3}static fromJSON(e,t){const{refreshToken:r,accessToken:s,expirationTime:i}=t,o=new Yl;return r&&(ee(typeof r=="string","internal-error",{appName:e}),o.refreshToken=r),s&&(ee(typeof s=="string","internal-error",{appName:e}),o.accessToken=s),i&&(ee(typeof i=="number","internal-error",{appName:e}),o.expirationTime=i),o}toJSON(){return{refreshToken:this.refreshToken,accessToken:this.accessToken,expirationTime:this.expirationTime}}_assign(e){this.accessToken=e.accessToken,this.refreshToken=e.refreshToken,this.expirationTime=e.expirationTime}_clone(){return Object.assign(new Yl,this.toJSON())}_performRefresh(){return zs("not implemented")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Wi(n,e){ee(typeof n=="string"||typeof n>"u","internal-error",{appName:e})}class ys{constructor({uid:e,auth:t,stsTokenManager:r,...s}){this.providerId="firebase",this.proactiveRefresh=new GU(this),this.reloadUserInfo=null,this.reloadListener=null,this.uid=e,this.auth=t,this.stsTokenManager=r,this.accessToken=r.accessToken,this.displayName=s.displayName||null,this.email=s.email||null,this.emailVerified=s.emailVerified||!1,this.phoneNumber=s.phoneNumber||null,this.photoURL=s.photoURL||null,this.isAnonymous=s.isAnonymous||!1,this.tenantId=s.tenantId||null,this.providerData=s.providerData?[...s.providerData]:[],this.metadata=new $v(s.createdAt||void 0,s.lastLoginAt||void 0)}async getIdToken(e){const t=await Ci(this,this.stsTokenManager.getToken(this.auth,e));return ee(t,this.auth,"internal-error"),this.accessToken!==t&&(this.accessToken=t,await this.auth._persistUserIfCurrent(this),this.auth._notifyListenersIfCurrent(this)),t}getIdTokenResult(e){return qU(this,e)}reload(){return HU(this)}_assign(e){this!==e&&(ee(this.uid===e.uid,this.auth,"internal-error"),this.displayName=e.displayName,this.photoURL=e.photoURL,this.email=e.email,this.emailVerified=e.emailVerified,this.phoneNumber=e.phoneNumber,this.isAnonymous=e.isAnonymous,this.tenantId=e.tenantId,this.providerData=e.providerData.map(t=>({...t})),this.metadata._copy(e.metadata),this.stsTokenManager._assign(e.stsTokenManager))}_clone(e){const t=new ys({...this,auth:e,stsTokenManager:this.stsTokenManager._clone()});return t.metadata._copy(this.metadata),t}_onReload(e){ee(!this.reloadListener,this.auth,"internal-error"),this.reloadListener=e,this.reloadUserInfo&&(this._notifyReloadListener(this.reloadUserInfo),this.reloadUserInfo=null)}_notifyReloadListener(e){this.reloadListener?this.reloadListener(e):this.reloadUserInfo=e}_startProactiveRefresh(){this.proactiveRefresh._start()}_stopProactiveRefresh(){this.proactiveRefresh._stop()}async _updateTokensIfNecessary(e,t=!1){let r=!1;e.idToken&&e.idToken!==this.stsTokenManager.accessToken&&(this.stsTokenManager.updateFromServerResponse(e),r=!0),t&&await Zd(this),await this.auth._persistUserIfCurrent(this),r&&this.auth._notifyListenersIfCurrent(this)}async delete(){if(Qt(this.auth.app))return Promise.reject(Vn(this.auth));const e=await this.getIdToken();return await Ci(this,BU(this.auth,{idToken:e})),this.stsTokenManager.clearRefreshToken(),this.auth.signOut()}toJSON(){return{uid:this.uid,email:this.email||void 0,emailVerified:this.emailVerified,displayName:this.displayName||void 0,isAnonymous:this.isAnonymous,photoURL:this.photoURL||void 0,phoneNumber:this.phoneNumber||void 0,tenantId:this.tenantId||void 0,providerData:this.providerData.map(e=>({...e})),stsTokenManager:this.stsTokenManager.toJSON(),_redirectEventId:this._redirectEventId,...this.metadata.toJSON(),apiKey:this.auth.config.apiKey,appName:this.auth.name}}get refreshToken(){return this.stsTokenManager.refreshToken||""}static _fromJSON(e,t){const r=t.displayName??void 0,s=t.email??void 0,i=t.phoneNumber??void 0,o=t.photoURL??void 0,a=t.tenantId??void 0,l=t._redirectEventId??void 0,u=t.createdAt??void 0,h=t.lastLoginAt??void 0,{uid:f,emailVerified:p,isAnonymous:y,providerData:w,stsTokenManager:S}=t;ee(f&&S,e,"internal-error");const k=Yl.fromJSON(this.name,S);ee(typeof f=="string",e,"internal-error"),Wi(r,e.name),Wi(s,e.name),ee(typeof p=="boolean",e,"internal-error"),ee(typeof y=="boolean",e,"internal-error"),Wi(i,e.name),Wi(o,e.name),Wi(a,e.name),Wi(l,e.name),Wi(u,e.name),Wi(h,e.name);const E=new ys({uid:f,auth:e,email:s,emailVerified:p,displayName:r,isAnonymous:y,photoURL:o,phoneNumber:i,tenantId:a,stsTokenManager:k,createdAt:u,lastLoginAt:h});return w&&Array.isArray(w)&&(E.providerData=w.map(x=>({...x}))),l&&(E._redirectEventId=l),E}static async _fromIdTokenResponse(e,t,r=!1){const s=new Yl;s.updateFromServerResponse(t);const i=new ys({uid:t.localId,auth:e,stsTokenManager:s,isAnonymous:r});return await Zd(i),i}static async _fromGetAccountInfoResponse(e,t,r){const s=t.users[0];ee(s.localId!==void 0,"internal-error");const i=s.providerUserInfo!==void 0?kP(s.providerUserInfo):[],o=!(s.email&&s.passwordHash)&&!(i!=null&&i.length),a=new Yl;a.updateFromIdToken(r);const l=new ys({uid:s.localId,auth:e,stsTokenManager:a,isAnonymous:o}),u={uid:s.localId,displayName:s.displayName||null,photoURL:s.photoUrl||null,email:s.email||null,emailVerified:s.emailVerified||!1,phoneNumber:s.phoneNumber||null,tenantId:s.tenantId||null,providerData:i,metadata:new $v(s.createdAt,s.lastLoginAt),isAnonymous:!(s.email&&s.passwordHash)&&!(i!=null&&i.length)};return Object.assign(l,u),l}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ab=new Map;function pi(n){Ai(n instanceof Function,"Expected a class definition");let e=ab.get(n);return e?(Ai(e instanceof n,"Instance stored in cache mismatched with class"),e):(e=new n,ab.set(n,e),e)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class PP{constructor(){this.type="NONE",this.storage={}}async _isAvailable(){return!0}async _set(e,t){this.storage[e]=t}async _get(e){const t=this.storage[e];return t===void 0?null:t}async _remove(e){delete this.storage[e]}_addListener(e,t){}_removeListener(e,t){}}PP.type="NONE";const lb=PP;/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ap(n,e,t){return`firebase:${n}:${e}:${t}`}class Jl{constructor(e,t,r){this.persistence=e,this.auth=t,this.userKey=r;const{config:s,name:i}=this.auth;this.fullUserKey=ap(this.userKey,s.apiKey,i),this.fullPersistenceKey=ap("persistence",s.apiKey,i),this.boundEventHandler=t._onStorageEvent.bind(t),this.persistence._addListener(this.fullUserKey,this.boundEventHandler)}setCurrentUser(e){return this.persistence._set(this.fullUserKey,e.toJSON())}async getCurrentUser(){const e=await this.persistence._get(this.fullUserKey);if(!e)return null;if(typeof e=="string"){const t=await gg(this.auth,{idToken:e}).catch(()=>{});return t?ys._fromGetAccountInfoResponse(this.auth,t,e):null}return ys._fromJSON(this.auth,e)}removeCurrentUser(){return this.persistence._remove(this.fullUserKey)}savePersistenceForRedirect(){return this.persistence._set(this.fullPersistenceKey,this.persistence.type)}async setPersistence(e){if(this.persistence===e)return;const t=await this.getCurrentUser();if(await this.removeCurrentUser(),this.persistence=e,t)return this.setCurrentUser(t)}delete(){this.persistence._removeListener(this.fullUserKey,this.boundEventHandler)}static async create(e,t,r="authUser"){if(!t.length)return new Jl(pi(lb),e,r);const s=(await Promise.all(t.map(async u=>{if(await u._isAvailable())return u}))).filter(u=>u);let i=s[0]||pi(lb);const o=ap(r,e.config.apiKey,e.name);let a=null;for(const u of t)try{const h=await u._get(o);if(h){let f;if(typeof h=="string"){const p=await gg(e,{idToken:h}).catch(()=>{});if(!p)break;f=await ys._fromGetAccountInfoResponse(e,p,h)}else f=ys._fromJSON(e,h);u!==i&&(a=f),i=u;break}}catch{}const l=s.filter(u=>u._shouldAllowMigration);return!i._shouldAllowMigration||!l.length?new Jl(i,e,r):(i=l[0],a&&await i._set(o,a.toJSON()),await Promise.all(t.map(async u=>{if(u!==i)try{await u._remove(o)}catch{}})),new Jl(i,e,r))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function cb(n){const e=n.toLowerCase();if(e.includes("opera/")||e.includes("opr/")||e.includes("opios/"))return"Opera";if(MP(e))return"IEMobile";if(e.includes("msie")||e.includes("trident/"))return"IE";if(e.includes("edge/"))return"Edge";if(DP(e))return"Firefox";if(e.includes("silk/"))return"Silk";if(VP(e))return"Blackberry";if(FP(e))return"Webos";if(OP(e))return"Safari";if((e.includes("chrome/")||LP(e))&&!e.includes("edge/"))return"Chrome";if(jP(e))return"Android";{const t=/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/,r=n.match(t);if((r==null?void 0:r.length)===2)return r[1]}return"Other"}function DP(n=Cn()){return/firefox\//i.test(n)}function OP(n=Cn()){const e=n.toLowerCase();return e.includes("safari/")&&!e.includes("chrome/")&&!e.includes("crios/")&&!e.includes("android")}function LP(n=Cn()){return/crios\//i.test(n)}function MP(n=Cn()){return/iemobile/i.test(n)}function jP(n=Cn()){return/android/i.test(n)}function VP(n=Cn()){return/blackberry/i.test(n)}function FP(n=Cn()){return/webos/i.test(n)}function Fx(n=Cn()){return/iphone|ipad|ipod/i.test(n)||/macintosh/i.test(n)&&/mobile/i.test(n)}function JU(n=Cn()){var e;return Fx(n)&&!!((e=window.navigator)!=null&&e.standalone)}function XU(){return YL()&&document.documentMode===10}function UP(n=Cn()){return Fx(n)||jP(n)||FP(n)||VP(n)||/windows phone/i.test(n)||MP(n)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function $P(n,e=[]){let t;switch(n){case"Browser":t=cb(Cn());break;case"Worker":t=`${cb(Cn())}-${n}`;break;default:t=n}const r=e.length?e.join(","):"FirebaseCore-web";return`${t}/JsCore/${Ka}/${r}`}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ZU{constructor(e){this.auth=e,this.queue=[]}pushCallback(e,t){const r=i=>new Promise((o,a)=>{try{const l=e(i);o(l)}catch(l){a(l)}});r.onAbort=t,this.queue.push(r);const s=this.queue.length-1;return()=>{this.queue[s]=()=>Promise.resolve()}}async runMiddleware(e){if(this.auth.currentUser===e)return;const t=[];try{for(const r of this.queue)await r(e),r.onAbort&&t.push(r.onAbort)}catch(r){t.reverse();for(const s of t)try{s()}catch{}throw this.auth._errorFactory.create("login-blocked",{originalMessage:r==null?void 0:r.message})}}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function e$(n,e={}){return zt(n,"GET","/v2/passwordPolicy",Bt(n,e))}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const t$=6;class n${constructor(e){var r;const t=e.customStrengthOptions;this.customStrengthOptions={},this.customStrengthOptions.minPasswordLength=t.minPasswordLength??t$,t.maxPasswordLength&&(this.customStrengthOptions.maxPasswordLength=t.maxPasswordLength),t.containsLowercaseCharacter!==void 0&&(this.customStrengthOptions.containsLowercaseLetter=t.containsLowercaseCharacter),t.containsUppercaseCharacter!==void 0&&(this.customStrengthOptions.containsUppercaseLetter=t.containsUppercaseCharacter),t.containsNumericCharacter!==void 0&&(this.customStrengthOptions.containsNumericCharacter=t.containsNumericCharacter),t.containsNonAlphanumericCharacter!==void 0&&(this.customStrengthOptions.containsNonAlphanumericCharacter=t.containsNonAlphanumericCharacter),this.enforcementState=e.enforcementState,this.enforcementState==="ENFORCEMENT_STATE_UNSPECIFIED"&&(this.enforcementState="OFF"),this.allowedNonAlphanumericCharacters=((r=e.allowedNonAlphanumericCharacters)==null?void 0:r.join(""))??"",this.forceUpgradeOnSignin=e.forceUpgradeOnSignin??!1,this.schemaVersion=e.schemaVersion}validatePassword(e){const t={isValid:!0,passwordPolicy:this};return this.validatePasswordLengthOptions(e,t),this.validatePasswordCharacterOptions(e,t),t.isValid&&(t.isValid=t.meetsMinPasswordLength??!0),t.isValid&&(t.isValid=t.meetsMaxPasswordLength??!0),t.isValid&&(t.isValid=t.containsLowercaseLetter??!0),t.isValid&&(t.isValid=t.containsUppercaseLetter??!0),t.isValid&&(t.isValid=t.containsNumericCharacter??!0),t.isValid&&(t.isValid=t.containsNonAlphanumericCharacter??!0),t}validatePasswordLengthOptions(e,t){const r=this.customStrengthOptions.minPasswordLength,s=this.customStrengthOptions.maxPasswordLength;r&&(t.meetsMinPasswordLength=e.length>=r),s&&(t.meetsMaxPasswordLength=e.length<=s)}validatePasswordCharacterOptions(e,t){this.updatePasswordCharacterOptionsStatuses(t,!1,!1,!1,!1);let r;for(let s=0;s<e.length;s++)r=e.charAt(s),this.updatePasswordCharacterOptionsStatuses(t,r>="a"&&r<="z",r>="A"&&r<="Z",r>="0"&&r<="9",this.allowedNonAlphanumericCharacters.includes(r))}updatePasswordCharacterOptionsStatuses(e,t,r,s,i){this.customStrengthOptions.containsLowercaseLetter&&(e.containsLowercaseLetter||(e.containsLowercaseLetter=t)),this.customStrengthOptions.containsUppercaseLetter&&(e.containsUppercaseLetter||(e.containsUppercaseLetter=r)),this.customStrengthOptions.containsNumericCharacter&&(e.containsNumericCharacter||(e.containsNumericCharacter=s)),this.customStrengthOptions.containsNonAlphanumericCharacter&&(e.containsNonAlphanumericCharacter||(e.containsNonAlphanumericCharacter=i))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class r${constructor(e,t,r,s){this.app=e,this.heartbeatServiceProvider=t,this.appCheckServiceProvider=r,this.config=s,this.currentUser=null,this.emulatorConfig=null,this.operations=Promise.resolve(),this.authStateSubscription=new ub(this),this.idTokenSubscription=new ub(this),this.beforeStateQueue=new ZU(this),this.redirectUser=null,this.isProactiveRefreshEnabled=!1,this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION=1,this._canInitEmulator=!0,this._isInitialized=!1,this._deleted=!1,this._initializationPromise=null,this._popupRedirectResolver=null,this._errorFactory=TP,this._agentRecaptchaConfig=null,this._tenantRecaptchaConfigs={},this._projectPasswordPolicy=null,this._tenantPasswordPolicies={},this._resolvePersistenceManagerAvailable=void 0,this.lastNotifiedUid=void 0,this.languageCode=null,this.tenantId=null,this.settings={appVerificationDisabledForTesting:!1},this.frameworks=[],this.name=e.name,this.clientVersion=s.sdkClientVersion,this._persistenceManagerAvailable=new Promise(i=>this._resolvePersistenceManagerAvailable=i)}_initializeWithPersistence(e,t){return t&&(this._popupRedirectResolver=pi(t)),this._initializationPromise=this.queue(async()=>{var r,s,i;if(!this._deleted&&(this.persistenceManager=await Jl.create(this,e),(r=this._resolvePersistenceManagerAvailable)==null||r.call(this),!this._deleted)){if((s=this._popupRedirectResolver)!=null&&s._shouldInitProactively)try{await this._popupRedirectResolver._initialize(this)}catch{}await this.initializeCurrentUser(t),this.lastNotifiedUid=((i=this.currentUser)==null?void 0:i.uid)||null,!this._deleted&&(this._isInitialized=!0)}}),this._initializationPromise}async _onStorageEvent(){if(this._deleted)return;const e=await this.assertedPersistence.getCurrentUser();if(!(!this.currentUser&&!e)){if(this.currentUser&&e&&this.currentUser.uid===e.uid){this._currentUser._assign(e),await this.currentUser.getIdToken();return}await this._updateCurrentUser(e,!0)}}async initializeCurrentUserFromIdToken(e){try{const t=await gg(this,{idToken:e}),r=await ys._fromGetAccountInfoResponse(this,t,e);await this.directlySetCurrentUser(r)}catch(t){console.warn("FirebaseServerApp could not login user with provided authIdToken: ",t),await this.directlySetCurrentUser(null)}}async initializeCurrentUser(e){var i;if(Qt(this.app)){const o=this.app.settings.authIdToken;return o?new Promise(a=>{setTimeout(()=>this.initializeCurrentUserFromIdToken(o).then(a,a))}):this.directlySetCurrentUser(null)}const t=await this.assertedPersistence.getCurrentUser();let r=t,s=!1;if(e&&this.config.authDomain){await this.getOrInitRedirectPersistenceManager();const o=(i=this.redirectUser)==null?void 0:i._redirectEventId,a=r==null?void 0:r._redirectEventId,l=await this.tryRedirectSignIn(e);(!o||o===a)&&(l!=null&&l.user)&&(r=l.user,s=!0)}if(!r)return this.directlySetCurrentUser(null);if(!r._redirectEventId){if(s)try{await this.beforeStateQueue.runMiddleware(r)}catch(o){r=t,this._popupRedirectResolver._overrideRedirectResult(this,()=>Promise.reject(o))}return r?this.reloadAndSetCurrentUserOrClear(r):this.directlySetCurrentUser(null)}return ee(this._popupRedirectResolver,this,"argument-error"),await this.getOrInitRedirectPersistenceManager(),this.redirectUser&&this.redirectUser._redirectEventId===r._redirectEventId?this.directlySetCurrentUser(r):this.reloadAndSetCurrentUserOrClear(r)}async tryRedirectSignIn(e){let t=null;try{t=await this._popupRedirectResolver._completeRedirectFn(this,e,!0)}catch{await this._setRedirectUser(null)}return t}async reloadAndSetCurrentUserOrClear(e){try{await Zd(e)}catch(t){if((t==null?void 0:t.code)!=="auth/network-request-failed")return this.directlySetCurrentUser(null)}return this.directlySetCurrentUser(e)}useDeviceLanguage(){this.languageCode=LU()}async _delete(){this._deleted=!0}async updateCurrentUser(e){if(Qt(this.app))return Promise.reject(Vn(this));const t=e?oe(e):null;return t&&ee(t.auth.config.apiKey===this.config.apiKey,this,"invalid-user-token"),this._updateCurrentUser(t&&t._clone(this))}async _updateCurrentUser(e,t=!1){if(!this._deleted)return e&&ee(this.tenantId===e.tenantId,this,"tenant-id-mismatch"),t||await this.beforeStateQueue.runMiddleware(e),this.queue(async()=>{await this.directlySetCurrentUser(e),this.notifyAuthListeners()})}async signOut(){return Qt(this.app)?Promise.reject(Vn(this)):(await this.beforeStateQueue.runMiddleware(null),(this.redirectPersistenceManager||this._popupRedirectResolver)&&await this._setRedirectUser(null),this._updateCurrentUser(null,!0))}setPersistence(e){return Qt(this.app)?Promise.reject(Vn(this)):this.queue(async()=>{await this.assertedPersistence.setPersistence(pi(e))})}_getRecaptchaConfig(){return this.tenantId==null?this._agentRecaptchaConfig:this._tenantRecaptchaConfigs[this.tenantId]}async validatePassword(e){this._getPasswordPolicyInternal()||await this._updatePasswordPolicy();const t=this._getPasswordPolicyInternal();return t.schemaVersion!==this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION?Promise.reject(this._errorFactory.create("unsupported-password-policy-schema-version",{})):t.validatePassword(e)}_getPasswordPolicyInternal(){return this.tenantId===null?this._projectPasswordPolicy:this._tenantPasswordPolicies[this.tenantId]}async _updatePasswordPolicy(){const e=await e$(this),t=new n$(e);this.tenantId===null?this._projectPasswordPolicy=t:this._tenantPasswordPolicies[this.tenantId]=t}_getPersistenceType(){return this.assertedPersistence.persistence.type}_getPersistence(){return this.assertedPersistence.persistence}_updateErrorMap(e){this._errorFactory=new Ha("auth","Firebase",e())}onAuthStateChanged(e,t,r){return this.registerStateListener(this.authStateSubscription,e,t,r)}beforeAuthStateChanged(e,t){return this.beforeStateQueue.pushCallback(e,t)}onIdTokenChanged(e,t,r){return this.registerStateListener(this.idTokenSubscription,e,t,r)}authStateReady(){return new Promise((e,t)=>{if(this.currentUser)e();else{const r=this.onAuthStateChanged(()=>{r(),e()},t)}})}async revokeAccessToken(e){if(this.currentUser){const t=await this.currentUser.getIdToken(),r={providerId:"apple.com",tokenType:"ACCESS_TOKEN",token:e,idToken:t};this.tenantId!=null&&(r.tenantId=this.tenantId),await YU(this,r)}}toJSON(){var e;return{apiKey:this.config.apiKey,authDomain:this.config.authDomain,appName:this.name,currentUser:(e=this._currentUser)==null?void 0:e.toJSON()}}async _setRedirectUser(e,t){const r=await this.getOrInitRedirectPersistenceManager(t);return e===null?r.removeCurrentUser():r.setCurrentUser(e)}async getOrInitRedirectPersistenceManager(e){if(!this.redirectPersistenceManager){const t=e&&pi(e)||this._popupRedirectResolver;ee(t,this,"argument-error"),this.redirectPersistenceManager=await Jl.create(this,[pi(t._redirectPersistence)],"redirectUser"),this.redirectUser=await this.redirectPersistenceManager.getCurrentUser()}return this.redirectPersistenceManager}async _redirectUserForId(e){var t,r;return this._isInitialized&&await this.queue(async()=>{}),((t=this._currentUser)==null?void 0:t._redirectEventId)===e?this._currentUser:((r=this.redirectUser)==null?void 0:r._redirectEventId)===e?this.redirectUser:null}async _persistUserIfCurrent(e){if(e===this.currentUser)return this.queue(async()=>this.directlySetCurrentUser(e))}_notifyListenersIfCurrent(e){e===this.currentUser&&this.notifyAuthListeners()}_key(){return`${this.config.authDomain}:${this.config.apiKey}:${this.name}`}_startProactiveRefresh(){this.isProactiveRefreshEnabled=!0,this.currentUser&&this._currentUser._startProactiveRefresh()}_stopProactiveRefresh(){this.isProactiveRefreshEnabled=!1,this.currentUser&&this._currentUser._stopProactiveRefresh()}get _currentUser(){return this.currentUser}notifyAuthListeners(){var t;if(!this._isInitialized)return;this.idTokenSubscription.next(this.currentUser);const e=((t=this.currentUser)==null?void 0:t.uid)??null;this.lastNotifiedUid!==e&&(this.lastNotifiedUid=e,this.authStateSubscription.next(this.currentUser))}registerStateListener(e,t,r,s){if(this._deleted)return()=>{};const i=typeof t=="function"?t:t.next.bind(t);let o=!1;const a=this._isInitialized?Promise.resolve():this._initializationPromise;if(ee(a,this,"internal-error"),a.then(()=>{o||i(this.currentUser)}),typeof t=="function"){const l=e.addObserver(t,r,s);return()=>{o=!0,l()}}else{const l=e.addObserver(t);return()=>{o=!0,l()}}}async directlySetCurrentUser(e){this.currentUser&&this.currentUser!==e&&this._currentUser._stopProactiveRefresh(),e&&this.isProactiveRefreshEnabled&&e._startProactiveRefresh(),this.currentUser=e,e?await this.assertedPersistence.setCurrentUser(e):await this.assertedPersistence.removeCurrentUser()}queue(e){return this.operations=this.operations.then(e,e),this.operations}get assertedPersistence(){return ee(this.persistenceManager,this,"internal-error"),this.persistenceManager}_logFramework(e){!e||this.frameworks.includes(e)||(this.frameworks.push(e),this.frameworks.sort(),this.clientVersion=$P(this.config.clientPlatform,this._getFrameworks()))}_getFrameworks(){return this.frameworks}async _getAdditionalHeaders(){var s;const e={"X-Client-Version":this.clientVersion};this.app.options.appId&&(e["X-Firebase-gmpid"]=this.app.options.appId);const t=await((s=this.heartbeatServiceProvider.getImmediate({optional:!0}))==null?void 0:s.getHeartbeatsHeader());t&&(e["X-Firebase-Client"]=t);const r=await this._getAppCheckToken();return r&&(e["X-Firebase-AppCheck"]=r),e}async _getAppCheckToken(){var t;if(Qt(this.app)&&this.app.settings.appCheckToken)return this.app.settings.appCheckToken;const e=await((t=this.appCheckServiceProvider.getImmediate({optional:!0}))==null?void 0:t.getToken());return e!=null&&e.error&&DU(`Error while retrieving App Check token: ${e.error}`),e==null?void 0:e.token}}function cn(n){return oe(n)}class ub{constructor(e){this.auth=e,this.observer=null,this.addObserver=rM(t=>this.observer=t)}get next(){return ee(this.observer,this.auth,"internal-error"),this.observer.next.bind(this.observer)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Mh={async loadJS(){throw new Error("Unable to load external scripts")},recaptchaV2Script:"",recaptchaEnterpriseScript:"",gapiScript:""};function s$(n){Mh=n}function Ux(n){return Mh.loadJS(n)}function i$(){return Mh.recaptchaV2Script}function o$(){return Mh.recaptchaEnterpriseScript}function a$(){return Mh.gapiScript}function BP(n){return`__${n}${Math.floor(Math.random()*1e6)}`}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const l$=500,c$=6e4,Af=1e12;class u${constructor(e){this.auth=e,this.counter=Af,this._widgets=new Map}render(e,t){const r=this.counter;return this._widgets.set(r,new f$(e,this.auth.name,t||{})),this.counter++,r}reset(e){var r;const t=e||Af;(r=this._widgets.get(t))==null||r.delete(),this._widgets.delete(t)}getResponse(e){var r;const t=e||Af;return((r=this._widgets.get(t))==null?void 0:r.getResponse())||""}async execute(e){var r;const t=e||Af;return(r=this._widgets.get(t))==null||r.execute(),""}}class d${constructor(){this.enterprise=new h$}ready(e){e()}execute(e,t){return Promise.resolve("token")}render(e,t){return""}}class h${ready(e){e()}execute(e,t){return Promise.resolve("token")}render(e,t){return""}}class f${constructor(e,t,r){this.params=r,this.timerId=null,this.deleted=!1,this.responseToken=null,this.clickHandler=()=>{this.execute()};const s=typeof e=="string"?document.getElementById(e):e;ee(s,"argument-error",{appName:t}),this.container=s,this.isVisible=this.params.size!=="invisible",this.isVisible?this.execute():this.container.addEventListener("click",this.clickHandler)}getResponse(){return this.checkIfDeleted(),this.responseToken}delete(){this.checkIfDeleted(),this.deleted=!0,this.timerId&&(clearTimeout(this.timerId),this.timerId=null),this.container.removeEventListener("click",this.clickHandler)}execute(){this.checkIfDeleted(),!this.timerId&&(this.timerId=window.setTimeout(()=>{this.responseToken=p$(50);const{callback:e,"expired-callback":t}=this.params;if(e)try{e(this.responseToken)}catch{}this.timerId=window.setTimeout(()=>{if(this.timerId=null,this.responseToken=null,t)try{t()}catch{}this.isVisible&&this.execute()},c$)},l$))}checkIfDeleted(){if(this.deleted)throw new Error("reCAPTCHA mock was already deleted!")}}function p$(n){const e=[],t="1234567890abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ";for(let r=0;r<n;r++)e.push(t.charAt(Math.floor(Math.random()*t.length)));return e.join("")}const g$="recaptcha-enterprise",ld="NO_RECAPTCHA";class zP{constructor(e){this.type=g$,this.auth=cn(e)}async verify(e="verify",t=!1){async function r(i){if(!t){if(i.tenantId==null&&i._agentRecaptchaConfig!=null)return i._agentRecaptchaConfig.siteKey;if(i.tenantId!=null&&i._tenantRecaptchaConfigs[i.tenantId]!==void 0)return i._tenantRecaptchaConfigs[i.tenantId].siteKey}return new Promise(async(o,a)=>{NP(i,{clientType:"CLIENT_TYPE_WEB",version:"RECAPTCHA_ENTERPRISE"}).then(l=>{if(l.recaptchaKey===void 0)a(new Error("recaptcha Enterprise site key undefined"));else{const u=new RP(l);return i.tenantId==null?i._agentRecaptchaConfig=u:i._tenantRecaptchaConfigs[i.tenantId]=u,o(u.siteKey)}}).catch(l=>{a(l)})})}function s(i,o,a){const l=window.grecaptcha;ib(l)?l.enterprise.ready(()=>{l.enterprise.execute(i,{action:e}).then(u=>{o(u)}).catch(()=>{o(ld)})}):a(Error("No reCAPTCHA enterprise script loaded."))}return this.auth.settings.appVerificationDisabledForTesting?new d$().execute("siteKey",{action:"verify"}):new Promise((i,o)=>{r(this.auth).then(a=>{if(!t&&ib(window.grecaptcha))s(a,i,o);else{if(typeof window>"u"){o(new Error("RecaptchaVerifier is only supported in browser"));return}let l=o$();l.length!==0&&(l+=a),Ux(l).then(()=>{s(a,i,o)}).catch(u=>{o(u)})}}).catch(a=>{o(a)})})}}async function Eu(n,e,t,r=!1,s=!1){const i=new zP(n);let o;if(s)o=ld;else try{o=await i.verify(t)}catch{o=await i.verify(t,!0)}const a={...e};if(t==="mfaSmsEnrollment"||t==="mfaSmsSignIn"){if("phoneEnrollmentInfo"in a){const l=a.phoneEnrollmentInfo.phoneNumber,u=a.phoneEnrollmentInfo.recaptchaToken;Object.assign(a,{phoneEnrollmentInfo:{phoneNumber:l,recaptchaToken:u,captchaResponse:o,clientType:"CLIENT_TYPE_WEB",recaptchaVersion:"RECAPTCHA_ENTERPRISE"}})}else if("phoneSignInInfo"in a){const l=a.phoneSignInInfo.recaptchaToken;Object.assign(a,{phoneSignInInfo:{recaptchaToken:l,captchaResponse:o,clientType:"CLIENT_TYPE_WEB",recaptchaVersion:"RECAPTCHA_ENTERPRISE"}})}return a}return r?Object.assign(a,{captchaResp:o}):Object.assign(a,{captchaResponse:o}),Object.assign(a,{clientType:"CLIENT_TYPE_WEB"}),Object.assign(a,{recaptchaVersion:"RECAPTCHA_ENTERPRISE"}),a}async function Io(n,e,t,r,s){var i,o;if(s==="EMAIL_PASSWORD_PROVIDER")if((i=n._getRecaptchaConfig())!=null&&i.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")){const a=await Eu(n,e,t,t==="getOobCode");return r(n,a)}else return r(n,e).catch(async a=>{if(a.code==="auth/missing-recaptcha-token"){console.log(`${t} is protected by reCAPTCHA Enterprise for this project. Automatically triggering the reCAPTCHA flow and restarting the flow.`);const l=await Eu(n,e,t,t==="getOobCode");return r(n,l)}else return Promise.reject(a)});else if(s==="PHONE_PROVIDER")if((o=n._getRecaptchaConfig())!=null&&o.isProviderEnabled("PHONE_PROVIDER")){const a=await Eu(n,e,t);return r(n,a).catch(async l=>{var u;if(((u=n._getRecaptchaConfig())==null?void 0:u.getProviderEnforcementState("PHONE_PROVIDER"))==="AUDIT"&&(l.code==="auth/missing-recaptcha-token"||l.code==="auth/invalid-app-credential")){console.log(`Failed to verify with reCAPTCHA Enterprise. Automatically triggering the reCAPTCHA v2 flow to complete the ${t} flow.`);const h=await Eu(n,e,t,!1,!0);return r(n,h)}return Promise.reject(l)})}else{const a=await Eu(n,e,t,!1,!0);return r(n,a)}else return Promise.reject(s+" provider is not supported.")}async function qP(n){const e=cn(n),t=await NP(e,{clientType:"CLIENT_TYPE_WEB",version:"RECAPTCHA_ENTERPRISE"}),r=new RP(t);e.tenantId==null?e._agentRecaptchaConfig=r:e._tenantRecaptchaConfigs[e.tenantId]=r,r.isAnyProviderEnabled()&&new zP(e).verify()}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function m$(n,e){const t=ti(n,"auth");if(t.isInitialized()){const s=t.getImmediate(),i=t.getOptions();if(qr(i,e??{}))return s;kr(s,"already-initialized")}return t.initialize({options:e})}function y$(n,e){const t=(e==null?void 0:e.persistence)||[],r=(Array.isArray(t)?t:[t]).map(pi);e!=null&&e.errorMap&&n._updateErrorMap(e.errorMap),n._initializeWithPersistence(r,e==null?void 0:e.popupRedirectResolver)}function _$(n,e,t){const r=cn(n);ee(/^https?:\/\//.test(e),r,"invalid-emulator-scheme");const s=!!(t!=null&&t.disableWarnings),i=WP(e),{host:o,port:a}=v$(e),l=a===null?"":`:${a}`,u={url:`${i}//${o}${l}/`},h=Object.freeze({host:o,port:a,protocol:i.replace(":",""),options:Object.freeze({disableWarnings:s})});if(!r._canInitEmulator){ee(r.config.emulator&&r.emulatorConfig,r,"emulator-config-failed"),ee(qr(u,r.config.emulator)&&qr(h,r.emulatorConfig),r,"emulator-config-failed");return}r.config.emulator=u,r.emulatorConfig=h,r.settings.appVerificationDisabledForTesting=!0,ki(o)?(Vg(`${i}//${o}${l}`),U0("Auth",!0)):s||w$()}function WP(n){const e=n.indexOf(":");return e<0?"":n.substr(0,e+1)}function v$(n){const e=WP(n),t=/(\/\/)?([^?#/]+)/.exec(n.substr(e.length));if(!t)return{host:"",port:null};const r=t[2].split("@").pop()||"",s=/^(\[[^\]]+\])(:|$)/.exec(r);if(s){const i=s[1];return{host:i,port:db(r.substr(i.length+1))}}else{const[i,o]=r.split(":");return{host:i,port:db(o)}}}function db(n){if(!n)return null;const e=Number(n);return isNaN(e)?null:e}function w$(){function n(){const e=document.createElement("p"),t=e.style;e.innerText="Running in emulator mode. Do not use with production credentials.",t.position="fixed",t.width="100%",t.backgroundColor="#ffffff",t.border=".1em solid #000000",t.color="#b50000",t.bottom="0px",t.left="0px",t.margin="0px",t.zIndex="10000",t.textAlign="center",e.classList.add("firebase-emulator-warning"),document.body.appendChild(e)}typeof console<"u"&&typeof console.info=="function"&&console.info("WARNING: You are using the Auth Emulator, which is intended for local testing only.  Do not use with production credentials."),typeof window<"u"&&typeof document<"u"&&(document.readyState==="loading"?window.addEventListener("DOMContentLoaded",n):n())}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class jh{constructor(e,t){this.providerId=e,this.signInMethod=t}toJSON(){return zs("not implemented")}_getIdTokenResponse(e){return zs("not implemented")}_linkToIdToken(e,t){return zs("not implemented")}_getReauthenticationResolver(e){return zs("not implemented")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function GP(n,e){return zt(n,"POST","/v1/accounts:resetPassword",Bt(n,e))}async function x$(n,e){return zt(n,"POST","/v1/accounts:update",e)}async function I$(n,e){return zt(n,"POST","/v1/accounts:signUp",e)}async function S$(n,e){return zt(n,"POST","/v1/accounts:update",Bt(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function E$(n,e){return Mi(n,"POST","/v1/accounts:signInWithPassword",Bt(n,e))}async function Om(n,e){return zt(n,"POST","/v1/accounts:sendOobCode",Bt(n,e))}async function T$(n,e){return Om(n,e)}async function b$(n,e){return Om(n,e)}async function A$(n,e){return Om(n,e)}async function C$(n,e){return Om(n,e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function R$(n,e){return Mi(n,"POST","/v1/accounts:signInWithEmailLink",Bt(n,e))}async function N$(n,e){return Mi(n,"POST","/v1/accounts:signInWithEmailLink",Bt(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class eh extends jh{constructor(e,t,r,s=null){super("password",r),this._email=e,this._password=t,this._tenantId=s}static _fromEmailAndPassword(e,t){return new eh(e,t,"password")}static _fromEmailAndCode(e,t,r=null){return new eh(e,t,"emailLink",r)}toJSON(){return{email:this._email,password:this._password,signInMethod:this.signInMethod,tenantId:this._tenantId}}static fromJSON(e){const t=typeof e=="string"?JSON.parse(e):e;if(t!=null&&t.email&&(t!=null&&t.password)){if(t.signInMethod==="password")return this._fromEmailAndPassword(t.email,t.password);if(t.signInMethod==="emailLink")return this._fromEmailAndCode(t.email,t.password,t.tenantId)}return null}async _getIdTokenResponse(e){switch(this.signInMethod){case"password":const t={returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"};return Io(e,t,"signInWithPassword",E$,"EMAIL_PASSWORD_PROVIDER");case"emailLink":return R$(e,{email:this._email,oobCode:this._password});default:kr(e,"internal-error")}}async _linkToIdToken(e,t){switch(this.signInMethod){case"password":const r={idToken:t,returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"};return Io(e,r,"signUpPassword",I$,"EMAIL_PASSWORD_PROVIDER");case"emailLink":return N$(e,{idToken:t,email:this._email,oobCode:this._password});default:kr(e,"internal-error")}}_getReauthenticationResolver(e){return this._getIdTokenResponse(e)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function _i(n,e){return Mi(n,"POST","/v1/accounts:signInWithIdp",Bt(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const k$="http://localhost";class Ri extends jh{constructor(){super(...arguments),this.pendingToken=null}static _fromParams(e){const t=new Ri(e.providerId,e.signInMethod);return e.idToken||e.accessToken?(e.idToken&&(t.idToken=e.idToken),e.accessToken&&(t.accessToken=e.accessToken),e.nonce&&!e.pendingToken&&(t.nonce=e.nonce),e.pendingToken&&(t.pendingToken=e.pendingToken)):e.oauthToken&&e.oauthTokenSecret?(t.accessToken=e.oauthToken,t.secret=e.oauthTokenSecret):kr("argument-error"),t}toJSON(){return{idToken:this.idToken,accessToken:this.accessToken,secret:this.secret,nonce:this.nonce,pendingToken:this.pendingToken,providerId:this.providerId,signInMethod:this.signInMethod}}static fromJSON(e){const t=typeof e=="string"?JSON.parse(e):e,{providerId:r,signInMethod:s,...i}=t;if(!r||!s)return null;const o=new Ri(r,s);return o.idToken=i.idToken||void 0,o.accessToken=i.accessToken||void 0,o.secret=i.secret,o.nonce=i.nonce,o.pendingToken=i.pendingToken||null,o}_getIdTokenResponse(e){const t=this.buildRequest();return _i(e,t)}_linkToIdToken(e,t){const r=this.buildRequest();return r.idToken=t,_i(e,r)}_getReauthenticationResolver(e){const t=this.buildRequest();return t.autoCreate=!1,_i(e,t)}buildRequest(){const e={requestUri:k$,returnSecureToken:!0};if(this.pendingToken)e.pendingToken=this.pendingToken;else{const t={};this.idToken&&(t.id_token=this.idToken),this.accessToken&&(t.access_token=this.accessToken),this.secret&&(t.oauth_token_secret=this.secret),t.providerId=this.providerId,this.nonce&&!this.pendingToken&&(t.nonce=this.nonce),e.postBody=Qa(t)}return e}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function hb(n,e){return zt(n,"POST","/v1/accounts:sendVerificationCode",Bt(n,e))}async function P$(n,e){return Mi(n,"POST","/v1/accounts:signInWithPhoneNumber",Bt(n,e))}async function D$(n,e){const t=await Mi(n,"POST","/v1/accounts:signInWithPhoneNumber",Bt(n,e));if(t.temporaryProof)throw Mu(n,"account-exists-with-different-credential",t);return t}const O$={USER_NOT_FOUND:"user-not-found"};async function L$(n,e){const t={...e,operation:"REAUTH"};return Mi(n,"POST","/v1/accounts:signInWithPhoneNumber",Bt(n,t),O$)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ia extends jh{constructor(e){super("phone","phone"),this.params=e}static _fromVerification(e,t){return new Ia({verificationId:e,verificationCode:t})}static _fromTokenResponse(e,t){return new Ia({phoneNumber:e,temporaryProof:t})}_getIdTokenResponse(e){return P$(e,this._makeVerificationRequest())}_linkToIdToken(e,t){return D$(e,{idToken:t,...this._makeVerificationRequest()})}_getReauthenticationResolver(e){return L$(e,this._makeVerificationRequest())}_makeVerificationRequest(){const{temporaryProof:e,phoneNumber:t,verificationId:r,verificationCode:s}=this.params;return e&&t?{temporaryProof:e,phoneNumber:t}:{sessionInfo:r,code:s}}toJSON(){const e={providerId:this.providerId};return this.params.phoneNumber&&(e.phoneNumber=this.params.phoneNumber),this.params.temporaryProof&&(e.temporaryProof=this.params.temporaryProof),this.params.verificationCode&&(e.verificationCode=this.params.verificationCode),this.params.verificationId&&(e.verificationId=this.params.verificationId),e}static fromJSON(e){typeof e=="string"&&(e=JSON.parse(e));const{verificationId:t,verificationCode:r,phoneNumber:s,temporaryProof:i}=e;return!r&&!t&&!s&&!i?null:new Ia({verificationId:t,verificationCode:r,phoneNumber:s,temporaryProof:i})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function M$(n){switch(n){case"recoverEmail":return"RECOVER_EMAIL";case"resetPassword":return"PASSWORD_RESET";case"signIn":return"EMAIL_SIGNIN";case"verifyEmail":return"VERIFY_EMAIL";case"verifyAndChangeEmail":return"VERIFY_AND_CHANGE_EMAIL";case"revertSecondFactorAddition":return"REVERT_SECOND_FACTOR_ADDITION";default:return null}}function j$(n){const e=Ru(Nu(n)).link,t=e?Ru(Nu(e)).deep_link_id:null,r=Ru(Nu(n)).deep_link_id;return(r?Ru(Nu(r)).link:null)||r||t||e||n}class Vh{constructor(e){const t=Ru(Nu(e)),r=t.apiKey??null,s=t.oobCode??null,i=M$(t.mode??null);ee(r&&s&&i,"argument-error"),this.apiKey=r,this.operation=i,this.code=s,this.continueUrl=t.continueUrl??null,this.languageCode=t.lang??null,this.tenantId=t.tenantId??null}static parseLink(e){const t=j$(e);try{return new Vh(t)}catch{return null}}}function LW(n){return Vh.parseLink(n)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class il{constructor(){this.providerId=il.PROVIDER_ID}static credential(e,t){return eh._fromEmailAndPassword(e,t)}static credentialWithLink(e,t){const r=Vh.parseLink(t);return ee(r,"argument-error"),eh._fromEmailAndCode(e,r.code,r.tenantId)}}il.PROVIDER_ID="password";il.EMAIL_PASSWORD_SIGN_IN_METHOD="password";il.EMAIL_LINK_SIGN_IN_METHOD="emailLink";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ji{constructor(e){this.providerId=e,this.defaultLanguageCode=null,this.customParameters={}}setDefaultLanguage(e){this.defaultLanguageCode=e}setCustomParameters(e){return this.customParameters=e,this}getCustomParameters(){return this.customParameters}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Zc extends ji{constructor(){super(...arguments),this.scopes=[]}addScope(e){return this.scopes.includes(e)||this.scopes.push(e),this}getScopes(){return[...this.scopes]}}class lp extends Zc{static credentialFromJSON(e){const t=typeof e=="string"?JSON.parse(e):e;return ee("providerId"in t&&"signInMethod"in t,"argument-error"),Ri._fromParams(t)}credential(e){return this._credential({...e,nonce:e.rawNonce})}_credential(e){return ee(e.idToken||e.accessToken,"argument-error"),Ri._fromParams({...e,providerId:this.providerId,signInMethod:this.providerId})}static credentialFromResult(e){return lp.oauthCredentialFromTaggedObject(e)}static credentialFromError(e){return lp.oauthCredentialFromTaggedObject(e.customData||{})}static oauthCredentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthIdToken:t,oauthAccessToken:r,oauthTokenSecret:s,pendingToken:i,nonce:o,providerId:a}=e;if(!r&&!s&&!t&&!i||!a)return null;try{return new lp(a)._credential({idToken:t,accessToken:r,nonce:o,pendingToken:i})}catch{return null}}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Xi extends Zc{constructor(){super("facebook.com")}static credential(e){return Ri._fromParams({providerId:Xi.PROVIDER_ID,signInMethod:Xi.FACEBOOK_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return Xi.credentialFromTaggedObject(e)}static credentialFromError(e){return Xi.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return Xi.credential(e.oauthAccessToken)}catch{return null}}}Xi.FACEBOOK_SIGN_IN_METHOD="facebook.com";Xi.PROVIDER_ID="facebook.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ci extends Zc{constructor(){super("google.com"),this.addScope("profile")}static credential(e,t){return Ri._fromParams({providerId:ci.PROVIDER_ID,signInMethod:ci.GOOGLE_SIGN_IN_METHOD,idToken:e,accessToken:t})}static credentialFromResult(e){return ci.credentialFromTaggedObject(e)}static credentialFromError(e){return ci.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthIdToken:t,oauthAccessToken:r}=e;if(!t&&!r)return null;try{return ci.credential(t,r)}catch{return null}}}ci.GOOGLE_SIGN_IN_METHOD="google.com";ci.PROVIDER_ID="google.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Zi extends Zc{constructor(){super("github.com")}static credential(e){return Ri._fromParams({providerId:Zi.PROVIDER_ID,signInMethod:Zi.GITHUB_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return Zi.credentialFromTaggedObject(e)}static credentialFromError(e){return Zi.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return Zi.credential(e.oauthAccessToken)}catch{return null}}}Zi.GITHUB_SIGN_IN_METHOD="github.com";Zi.PROVIDER_ID="github.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const V$="http://localhost";class th extends jh{constructor(e,t){super(e,e),this.pendingToken=t}_getIdTokenResponse(e){const t=this.buildRequest();return _i(e,t)}_linkToIdToken(e,t){const r=this.buildRequest();return r.idToken=t,_i(e,r)}_getReauthenticationResolver(e){const t=this.buildRequest();return t.autoCreate=!1,_i(e,t)}toJSON(){return{signInMethod:this.signInMethod,providerId:this.providerId,pendingToken:this.pendingToken}}static fromJSON(e){const t=typeof e=="string"?JSON.parse(e):e,{providerId:r,signInMethod:s,pendingToken:i}=t;return!r||!s||!i||r!==s?null:new th(r,i)}static _create(e,t){return new th(e,t)}buildRequest(){return{requestUri:V$,returnSecureToken:!0,pendingToken:this.pendingToken}}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const F$="saml.";class Bv extends ji{constructor(e){ee(e.startsWith(F$),"argument-error"),super(e)}static credentialFromResult(e){return Bv.samlCredentialFromTaggedObject(e)}static credentialFromError(e){return Bv.samlCredentialFromTaggedObject(e.customData||{})}static credentialFromJSON(e){const t=th.fromJSON(e);return ee(t,"argument-error"),t}static samlCredentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{pendingToken:t,providerId:r}=e;if(!t||!r)return null;try{return th._create(r,t)}catch{return null}}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class eo extends Zc{constructor(){super("twitter.com")}static credential(e,t){return Ri._fromParams({providerId:eo.PROVIDER_ID,signInMethod:eo.TWITTER_SIGN_IN_METHOD,oauthToken:e,oauthTokenSecret:t})}static credentialFromResult(e){return eo.credentialFromTaggedObject(e)}static credentialFromError(e){return eo.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthAccessToken:t,oauthTokenSecret:r}=e;if(!t||!r)return null;try{return eo.credential(t,r)}catch{return null}}}eo.TWITTER_SIGN_IN_METHOD="twitter.com";eo.PROVIDER_ID="twitter.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function HP(n,e){return Mi(n,"POST","/v1/accounts:signUp",Bt(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ls{constructor(e){this.user=e.user,this.providerId=e.providerId,this._tokenResponse=e._tokenResponse,this.operationType=e.operationType}static async _fromIdTokenResponse(e,t,r,s=!1){const i=await ys._fromIdTokenResponse(e,r,s),o=fb(r);return new ls({user:i,providerId:o,_tokenResponse:r,operationType:t})}static async _forOperation(e,t,r){await e._updateTokensIfNecessary(r,!0);const s=fb(r);return new ls({user:e,providerId:s,_tokenResponse:r,operationType:t})}}function fb(n){return n.providerId?n.providerId:"phoneNumber"in n?"phone":null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function MW(n){var s;if(Qt(n.app))return Promise.reject(Vn(n));const e=cn(n);if(await e._initializationPromise,(s=e.currentUser)!=null&&s.isAnonymous)return new ls({user:e.currentUser,providerId:null,operationType:"signIn"});const t=await HP(e,{returnSecureToken:!0}),r=await ls._fromIdTokenResponse(e,"signIn",t,!0);return await e._updateCurrentUser(r.user),r}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class mg extends Es{constructor(e,t,r,s){super(t.code,t.message),this.operationType=r,this.user=s,Object.setPrototypeOf(this,mg.prototype),this.customData={appName:e.name,tenantId:e.tenantId??void 0,_serverResponse:t.customData._serverResponse,operationType:r}}static _fromErrorAndOperation(e,t,r,s){return new mg(e,t,r,s)}}function QP(n,e,t,r){return(e==="reauthenticate"?t._getReauthenticationResolver(n):t._getIdTokenResponse(n)).catch(i=>{throw i.code==="auth/multi-factor-auth-required"?mg._fromErrorAndOperation(n,i,e,r):i})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function KP(n){return new Set(n.map(({providerId:e})=>e).filter(e=>!!e))}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function jW(n,e){const t=oe(n);await Lm(!0,t,e);const{providerUserInfo:r}=await zU(t.auth,{idToken:await t.getIdToken(),deleteProvider:[e]}),s=KP(r||[]);return t.providerData=t.providerData.filter(i=>s.has(i.providerId)),s.has("phone")||(t.phoneNumber=null),await t.auth._persistUserIfCurrent(t),t}async function $x(n,e,t=!1){const r=await Ci(n,e._linkToIdToken(n.auth,await n.getIdToken()),t);return ls._forOperation(n,"link",r)}async function Lm(n,e,t){await Zd(e);const r=KP(e.providerData),s=n===!1?"provider-already-linked":"no-such-provider";ee(r.has(t)===n,e.auth,s)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function YP(n,e,t=!1){const{auth:r}=n;if(Qt(r.app))return Promise.reject(Vn(r));const s="reauthenticate";try{const i=await Ci(n,QP(r,s,e,n),t);ee(i.idToken,r,"internal-error");const o=Dm(i.idToken);ee(o,r,"internal-error");const{sub:a}=o;return ee(n.uid===a,r,"user-mismatch"),ls._forOperation(n,s,i)}catch(i){throw(i==null?void 0:i.code)==="auth/user-not-found"&&kr(r,"user-mismatch"),i}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function JP(n,e,t=!1){if(Qt(n.app))return Promise.reject(Vn(n));const r="signIn",s=await QP(n,r,e),i=await ls._fromIdTokenResponse(n,r,s);return t||await n._updateCurrentUser(i.user),i}async function Bx(n,e){return JP(cn(n),e)}async function U$(n,e){const t=oe(n);return await Lm(!1,t,e.providerId),$x(t,e)}async function $$(n,e){return YP(oe(n),e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function B$(n,e){return Mi(n,"POST","/v1/accounts:signInWithCustomToken",Bt(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function VW(n,e){if(Qt(n.app))return Promise.reject(Vn(n));const t=cn(n),r=await B$(t,{token:e,returnSecureToken:!0}),s=await ls._fromIdTokenResponse(t,"signIn",r);return await t._updateCurrentUser(s.user),s}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Fh{constructor(e,t){this.factorId=e,this.uid=t.mfaEnrollmentId,this.enrollmentTime=new Date(t.enrolledAt).toUTCString(),this.displayName=t.displayName}static _fromServerResponse(e,t){return"phoneInfo"in t?zx._fromServerResponse(e,t):"totpInfo"in t?qx._fromServerResponse(e,t):kr(e,"internal-error")}}class zx extends Fh{constructor(e){super("phone",e),this.phoneNumber=e.phoneInfo}static _fromServerResponse(e,t){return new zx(t)}}class qx extends Fh{constructor(e){super("totp",e)}static _fromServerResponse(e,t){return new qx(t)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Mm(n,e,t){var r;ee(((r=t.url)==null?void 0:r.length)>0,n,"invalid-continue-uri"),ee(typeof t.dynamicLinkDomain>"u"||t.dynamicLinkDomain.length>0,n,"invalid-dynamic-link-domain"),ee(typeof t.linkDomain>"u"||t.linkDomain.length>0,n,"invalid-hosting-link-domain"),e.continueUrl=t.url,e.dynamicLinkDomain=t.dynamicLinkDomain,e.linkDomain=t.linkDomain,e.canHandleCodeInApp=t.handleCodeInApp,t.iOS&&(ee(t.iOS.bundleId.length>0,n,"missing-ios-bundle-id"),e.iOSBundleId=t.iOS.bundleId),t.android&&(ee(t.android.packageName.length>0,n,"missing-android-pkg-name"),e.androidInstallApp=t.android.installApp,e.androidMinimumVersionCode=t.android.minimumVersion,e.androidPackageName=t.android.packageName)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Wx(n){const e=cn(n);e._getPasswordPolicyInternal()&&await e._updatePasswordPolicy()}async function z$(n,e,t){const r=cn(n),s={requestType:"PASSWORD_RESET",email:e,clientType:"CLIENT_TYPE_WEB"};t&&Mm(r,s,t),await Io(r,s,"getOobCode",b$,"EMAIL_PASSWORD_PROVIDER")}async function FW(n,e,t){await GP(oe(n),{oobCode:e,newPassword:t}).catch(async r=>{throw r.code==="auth/password-does-not-meet-requirements"&&Wx(n),r})}async function UW(n,e){await S$(oe(n),{oobCode:e})}async function q$(n,e){const t=oe(n),r=await GP(t,{oobCode:e}),s=r.requestType;switch(ee(s,t,"internal-error"),s){case"EMAIL_SIGNIN":break;case"VERIFY_AND_CHANGE_EMAIL":ee(r.newEmail,t,"internal-error");break;case"REVERT_SECOND_FACTOR_ADDITION":ee(r.mfaInfo,t,"internal-error");default:ee(r.email,t,"internal-error")}let i=null;return r.mfaInfo&&(i=Fh._fromServerResponse(cn(t),r.mfaInfo)),{data:{email:(r.requestType==="VERIFY_AND_CHANGE_EMAIL"?r.newEmail:r.email)||null,previousEmail:(r.requestType==="VERIFY_AND_CHANGE_EMAIL"?r.email:r.newEmail)||null,multiFactorInfo:i},operation:s}}async function $W(n,e){const{data:t}=await q$(oe(n),e);return t.email}async function W$(n,e,t){if(Qt(n.app))return Promise.reject(Vn(n));const r=cn(n),o=await Io(r,{returnSecureToken:!0,email:e,password:t,clientType:"CLIENT_TYPE_WEB"},"signUpPassword",HP,"EMAIL_PASSWORD_PROVIDER").catch(l=>{throw l.code==="auth/password-does-not-meet-requirements"&&Wx(n),l}),a=await ls._fromIdTokenResponse(r,"signIn",o);return await r._updateCurrentUser(a.user),a}function G$(n,e,t){return Qt(n.app)?Promise.reject(Vn(n)):Bx(oe(n),il.credential(e,t)).catch(async r=>{throw r.code==="auth/password-does-not-meet-requirements"&&Wx(n),r})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function BW(n,e,t){const r=cn(n),s={requestType:"EMAIL_SIGNIN",email:e,clientType:"CLIENT_TYPE_WEB"};function i(o,a){ee(a.handleCodeInApp,r,"argument-error"),a&&Mm(r,o,a)}i(s,t),await Io(r,s,"getOobCode",A$,"EMAIL_PASSWORD_PROVIDER")}function zW(n,e){const t=Vh.parseLink(e);return(t==null?void 0:t.operation)==="EMAIL_SIGNIN"}async function qW(n,e,t){if(Qt(n.app))return Promise.reject(Vn(n));const r=oe(n),s=il.credentialWithLink(e,t||Xd());return ee(s._tenantId===(r.tenantId||null),r,"tenant-id-mismatch"),Bx(r,s)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function H$(n,e){return zt(n,"POST","/v1/accounts:createAuthUri",Bt(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function WW(n,e){const t=jx()?Xd():"http://localhost",r={identifier:e,continueUri:t},{signinMethods:s}=await H$(oe(n),r);return s||[]}async function Q$(n,e){const t=oe(n),s={requestType:"VERIFY_EMAIL",idToken:await n.getIdToken()};e&&Mm(t.auth,s,e);const{email:i}=await T$(t.auth,s);i!==n.email&&await n.reload()}async function GW(n,e,t){const r=oe(n),i={requestType:"VERIFY_AND_CHANGE_EMAIL",idToken:await n.getIdToken(),newEmail:e};t&&Mm(r.auth,i,t);const{email:o}=await C$(r.auth,i);o!==n.email&&await n.reload()}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function K$(n,e){return zt(n,"POST","/v1/accounts:update",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function HW(n,{displayName:e,photoURL:t}){if(e===void 0&&t===void 0)return;const r=oe(n),i={idToken:await r.getIdToken(),displayName:e,photoUrl:t,returnSecureToken:!0},o=await Ci(r,K$(r.auth,i));r.displayName=o.displayName||null,r.photoURL=o.photoUrl||null;const a=r.providerData.find(({providerId:l})=>l==="password");a&&(a.displayName=r.displayName,a.photoURL=r.photoURL),await r._updateTokensIfNecessary(o)}function QW(n,e){const t=oe(n);return Qt(t.auth.app)?Promise.reject(Vn(t.auth)):XP(t,e,null)}function KW(n,e){return XP(oe(n),null,e)}async function XP(n,e,t){const{auth:r}=n,i={idToken:await n.getIdToken(),returnSecureToken:!0};e&&(i.email=e),t&&(i.password=t);const o=await Ci(n,x$(r,i));await n._updateTokensIfNecessary(o,!0)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Y$(n){var s,i;if(!n)return null;const{providerId:e}=n,t=n.rawUserInfo?JSON.parse(n.rawUserInfo):{},r=n.isNewUser||n.kind==="identitytoolkit#SignupNewUserResponse";if(!e&&(n!=null&&n.idToken)){const o=(i=(s=Dm(n.idToken))==null?void 0:s.firebase)==null?void 0:i.sign_in_provider;if(o){const a=o!=="anonymous"&&o!=="custom"?o:null;return new Xl(r,a)}}if(!e)return null;switch(e){case"facebook.com":return new J$(r,t);case"github.com":return new X$(r,t);case"google.com":return new Z$(r,t);case"twitter.com":return new eB(r,t,n.screenName||null);case"custom":case"anonymous":return new Xl(r,null);default:return new Xl(r,e,t)}}class Xl{constructor(e,t,r={}){this.isNewUser=e,this.providerId=t,this.profile=r}}class ZP extends Xl{constructor(e,t,r,s){super(e,t,r),this.username=s}}class J$ extends Xl{constructor(e,t){super(e,"facebook.com",t)}}class X$ extends ZP{constructor(e,t){super(e,"github.com",t,typeof(t==null?void 0:t.login)=="string"?t==null?void 0:t.login:null)}}class Z$ extends Xl{constructor(e,t){super(e,"google.com",t)}}class eB extends ZP{constructor(e,t,r){super(e,"twitter.com",t,r)}}function YW(n){const{user:e,_tokenResponse:t}=n;return e.isAnonymous&&!t?{providerId:null,isNewUser:!1,profile:null}:Y$(t)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function tB(n,e){return oe(n).setPersistence(e)}function JW(n){return qP(n)}async function XW(n,e){return cn(n).validatePassword(e)}function nB(n,e,t,r){return oe(n).onIdTokenChanged(e,t,r)}function rB(n,e,t){return oe(n).beforeAuthStateChanged(e,t)}function ZW(n,e,t,r){return oe(n).onAuthStateChanged(e,t,r)}function e7(n){oe(n).useDeviceLanguage()}function t7(n,e){return oe(n).updateCurrentUser(e)}function n7(n){return oe(n).signOut()}function r7(n,e){return cn(n).revokeAccessToken(e)}async function s7(n){return oe(n).delete()}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class pa{constructor(e,t,r){this.type=e,this.credential=t,this.user=r}static _fromIdtoken(e,t){return new pa("enroll",e,t)}static _fromMfaPendingCredential(e){return new pa("signin",e)}toJSON(){return{multiFactorSession:{[this.type==="enroll"?"idToken":"pendingCredential"]:this.credential}}}static fromJSON(e){var t,r;if(e!=null&&e.multiFactorSession){if((t=e.multiFactorSession)!=null&&t.pendingCredential)return pa._fromMfaPendingCredential(e.multiFactorSession.pendingCredential);if((r=e.multiFactorSession)!=null&&r.idToken)return pa._fromIdtoken(e.multiFactorSession.idToken)}return null}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Gx{constructor(e,t,r){this.session=e,this.hints=t,this.signInResolver=r}static _fromError(e,t){const r=cn(e),s=t.customData._serverResponse,i=(s.mfaInfo||[]).map(a=>Fh._fromServerResponse(r,a));ee(s.mfaPendingCredential,r,"internal-error");const o=pa._fromMfaPendingCredential(s.mfaPendingCredential);return new Gx(o,i,async a=>{const l=await a._process(r,o);delete s.mfaInfo,delete s.mfaPendingCredential;const u={...s,idToken:l.idToken,refreshToken:l.refreshToken};switch(t.operationType){case"signIn":const h=await ls._fromIdTokenResponse(r,t.operationType,u);return await r._updateCurrentUser(h.user),h;case"reauthenticate":return ee(t.user,r,"internal-error"),ls._forOperation(t.user,t.operationType,u);default:kr(r,"internal-error")}})}async resolveSignIn(e){const t=e;return this.signInResolver(t)}}function i7(n,e){var s;const t=oe(n),r=e;return ee(e.customData.operationType,t,"argument-error"),ee((s=r.customData._serverResponse)==null?void 0:s.mfaPendingCredential,t,"argument-error"),Gx._fromError(t,r)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function pb(n,e){return zt(n,"POST","/v2/accounts/mfaEnrollment:start",Bt(n,e))}function sB(n,e){return zt(n,"POST","/v2/accounts/mfaEnrollment:finalize",Bt(n,e))}function iB(n,e){return zt(n,"POST","/v2/accounts/mfaEnrollment:start",Bt(n,e))}function oB(n,e){return zt(n,"POST","/v2/accounts/mfaEnrollment:finalize",Bt(n,e))}function aB(n,e){return zt(n,"POST","/v2/accounts/mfaEnrollment:withdraw",Bt(n,e))}class Hx{constructor(e){this.user=e,this.enrolledFactors=[],e._onReload(t=>{t.mfaInfo&&(this.enrolledFactors=t.mfaInfo.map(r=>Fh._fromServerResponse(e.auth,r)))})}static _fromUser(e){return new Hx(e)}async getSession(){return pa._fromIdtoken(await this.user.getIdToken(),this.user)}async enroll(e,t){const r=e,s=await this.getSession(),i=await Ci(this.user,r._process(this.user.auth,s,t));return await this.user._updateTokensIfNecessary(i),this.user.reload()}async unenroll(e){const t=typeof e=="string"?e:e.uid,r=await this.user.getIdToken();try{const s=await Ci(this.user,aB(this.user.auth,{idToken:r,mfaEnrollmentId:t}));this.enrolledFactors=this.enrolledFactors.filter(({uid:i})=>i!==t),await this.user._updateTokensIfNecessary(s),await this.user.reload()}catch(s){throw s}}}const zy=new WeakMap;function o7(n){const e=oe(n);return zy.has(e)||zy.set(e,Hx._fromUser(e)),zy.get(e)}const yg="__sak";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class eD{constructor(e,t){this.storageRetriever=e,this.type=t}_isAvailable(){try{return this.storage?(this.storage.setItem(yg,"1"),this.storage.removeItem(yg),Promise.resolve(!0)):Promise.resolve(!1)}catch{return Promise.resolve(!1)}}_set(e,t){return this.storage.setItem(e,JSON.stringify(t)),Promise.resolve()}_get(e){const t=this.storage.getItem(e);return Promise.resolve(t?JSON.parse(t):null)}_remove(e){return this.storage.removeItem(e),Promise.resolve()}get storage(){return this.storageRetriever()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const lB=1e3,cB=10;class tD extends eD{constructor(){super(()=>window.localStorage,"LOCAL"),this.boundEventHandler=(e,t)=>this.onStorageEvent(e,t),this.listeners={},this.localCache={},this.pollTimer=null,this.fallbackToPolling=UP(),this._shouldAllowMigration=!0}forAllChangedKeys(e){for(const t of Object.keys(this.listeners)){const r=this.storage.getItem(t),s=this.localCache[t];r!==s&&e(t,s,r)}}onStorageEvent(e,t=!1){if(!e.key){this.forAllChangedKeys((o,a,l)=>{this.notifyListeners(o,l)});return}const r=e.key;t?this.detachListener():this.stopPolling();const s=()=>{const o=this.storage.getItem(r);!t&&this.localCache[r]===o||this.notifyListeners(r,o)},i=this.storage.getItem(r);XU()&&i!==e.newValue&&e.newValue!==e.oldValue?setTimeout(s,cB):s()}notifyListeners(e,t){this.localCache[e]=t;const r=this.listeners[e];if(r)for(const s of Array.from(r))s(t&&JSON.parse(t))}startPolling(){this.stopPolling(),this.pollTimer=setInterval(()=>{this.forAllChangedKeys((e,t,r)=>{this.onStorageEvent(new StorageEvent("storage",{key:e,oldValue:t,newValue:r}),!0)})},lB)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}attachListener(){window.addEventListener("storage",this.boundEventHandler)}detachListener(){window.removeEventListener("storage",this.boundEventHandler)}_addListener(e,t){Object.keys(this.listeners).length===0&&(this.fallbackToPolling?this.startPolling():this.attachListener()),this.listeners[e]||(this.listeners[e]=new Set,this.localCache[e]=this.storage.getItem(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),this.listeners[e].size===0&&delete this.listeners[e]),Object.keys(this.listeners).length===0&&(this.detachListener(),this.stopPolling())}async _set(e,t){await super._set(e,t),this.localCache[e]=JSON.stringify(t)}async _get(e){const t=await super._get(e);return this.localCache[e]=JSON.stringify(t),t}async _remove(e){await super._remove(e),delete this.localCache[e]}}tD.type="LOCAL";const nD=tD;/**
 * @license
 * Copyright 2025 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const uB=1e3;function qy(n){var r;const e=n.replace(/[\\^$.*+?()[\]{}|]/g,"\\$&"),t=RegExp(`${e}=([^;]+)`);return((r=document.cookie.match(t))==null?void 0:r[1])??null}function Wy(n){return`${window.location.protocol==="http:"?"__dev_":"__HOST-"}FIREBASE_${n.split(":")[3]}`}class rD{constructor(){this.type="COOKIE",this.listenerUnsubscribes=new Map}_getFinalTarget(e){if(typeof window===void 0)return e;const t=new URL(`${window.location.origin}/__cookies__`);return t.searchParams.set("finalTarget",e),t}async _isAvailable(){return typeof isSecureContext=="boolean"&&!isSecureContext||typeof navigator>"u"||typeof document>"u"?!1:navigator.cookieEnabled??!0}async _set(e,t){}async _get(e){if(!this._isAvailable())return null;const t=Wy(e);if(window.cookieStore){const r=await window.cookieStore.get(t);return r==null?void 0:r.value}return qy(t)}async _remove(e){if(!this._isAvailable()||!await this._get(e))return;const r=Wy(e);document.cookie=`${r}=;Max-Age=34560000;Partitioned;Secure;SameSite=Strict;Path=/;Priority=High`,await fetch("/__cookies__",{method:"DELETE"}).catch(()=>{})}_addListener(e,t){if(!this._isAvailable())return;const r=Wy(e);if(window.cookieStore){const a=u=>{const h=u.changed.find(p=>p.name===r);h&&t(h.value),u.deleted.find(p=>p.name===r)&&t(null)},l=()=>window.cookieStore.removeEventListener("change",a);return this.listenerUnsubscribes.set(t,l),window.cookieStore.addEventListener("change",a)}let s=qy(r);const i=setInterval(()=>{const a=qy(r);a!==s&&(t(a),s=a)},uB),o=()=>clearInterval(i);this.listenerUnsubscribes.set(t,o)}_removeListener(e,t){const r=this.listenerUnsubscribes.get(t);r&&(r(),this.listenerUnsubscribes.delete(t))}}rD.type="COOKIE";const a7=rD;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class sD extends eD{constructor(){super(()=>window.sessionStorage,"SESSION")}_addListener(e,t){}_removeListener(e,t){}}sD.type="SESSION";const iD=sD;/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function dB(n){return Promise.all(n.map(async e=>{try{return{fulfilled:!0,value:await e}}catch(t){return{fulfilled:!1,reason:t}}}))}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class jm{constructor(e){this.eventTarget=e,this.handlersMap={},this.boundEventHandler=this.handleEvent.bind(this)}static _getInstance(e){const t=this.receivers.find(s=>s.isListeningto(e));if(t)return t;const r=new jm(e);return this.receivers.push(r),r}isListeningto(e){return this.eventTarget===e}async handleEvent(e){const t=e,{eventId:r,eventType:s,data:i}=t.data,o=this.handlersMap[s];if(!(o!=null&&o.size))return;t.ports[0].postMessage({status:"ack",eventId:r,eventType:s});const a=Array.from(o).map(async u=>u(t.origin,i)),l=await dB(a);t.ports[0].postMessage({status:"done",eventId:r,eventType:s,response:l})}_subscribe(e,t){Object.keys(this.handlersMap).length===0&&this.eventTarget.addEventListener("message",this.boundEventHandler),this.handlersMap[e]||(this.handlersMap[e]=new Set),this.handlersMap[e].add(t)}_unsubscribe(e,t){this.handlersMap[e]&&t&&this.handlersMap[e].delete(t),(!t||this.handlersMap[e].size===0)&&delete this.handlersMap[e],Object.keys(this.handlersMap).length===0&&this.eventTarget.removeEventListener("message",this.boundEventHandler)}}jm.receivers=[];/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Vm(n="",e=10){let t="";for(let r=0;r<e;r++)t+=Math.floor(Math.random()*10);return n+t}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class hB{constructor(e){this.target=e,this.handlers=new Set}removeMessageHandler(e){e.messageChannel&&(e.messageChannel.port1.removeEventListener("message",e.onMessage),e.messageChannel.port1.close()),this.handlers.delete(e)}async _send(e,t,r=50){const s=typeof MessageChannel<"u"?new MessageChannel:null;if(!s)throw new Error("connection_unavailable");let i,o;return new Promise((a,l)=>{const u=Vm("",20);s.port1.start();const h=setTimeout(()=>{l(new Error("unsupported_event"))},r);o={messageChannel:s,onMessage(f){const p=f;if(p.data.eventId===u)switch(p.data.status){case"ack":clearTimeout(h),i=setTimeout(()=>{l(new Error("timeout"))},3e3);break;case"done":clearTimeout(i),a(p.data.response);break;default:clearTimeout(h),clearTimeout(i),l(new Error("invalid_response"));break}}},this.handlers.add(o),s.port1.addEventListener("message",o.onMessage),this.target.postMessage({eventType:e,eventId:u,data:t},[s.port2])}).finally(()=>{o&&this.removeMessageHandler(o)})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function vn(){return window}function fB(n){vn().location.href=n}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Qx(){return typeof vn().WorkerGlobalScope<"u"&&typeof vn().importScripts=="function"}async function pB(){if(!(navigator!=null&&navigator.serviceWorker))return null;try{return(await navigator.serviceWorker.ready).active}catch{return null}}function gB(){var n;return((n=navigator==null?void 0:navigator.serviceWorker)==null?void 0:n.controller)||null}function mB(){return Qx()?self:null}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const oD="firebaseLocalStorageDb",yB=1,_g="firebaseLocalStorage",aD="fbase_key";class Uh{constructor(e){this.request=e}toPromise(){return new Promise((e,t)=>{this.request.addEventListener("success",()=>{e(this.request.result)}),this.request.addEventListener("error",()=>{t(this.request.error)})})}}function Fm(n,e){return n.transaction([_g],e?"readwrite":"readonly").objectStore(_g)}function _B(){const n=indexedDB.deleteDatabase(oD);return new Uh(n).toPromise()}function zv(){const n=indexedDB.open(oD,yB);return new Promise((e,t)=>{n.addEventListener("error",()=>{t(n.error)}),n.addEventListener("upgradeneeded",()=>{const r=n.result;try{r.createObjectStore(_g,{keyPath:aD})}catch(s){t(s)}}),n.addEventListener("success",async()=>{const r=n.result;r.objectStoreNames.contains(_g)?e(r):(r.close(),await _B(),e(await zv()))})})}async function gb(n,e,t){const r=Fm(n,!0).put({[aD]:e,value:t});return new Uh(r).toPromise()}async function vB(n,e){const t=Fm(n,!1).get(e),r=await new Uh(t).toPromise();return r===void 0?null:r.value}function mb(n,e){const t=Fm(n,!0).delete(e);return new Uh(t).toPromise()}const wB=800,xB=3;class lD{constructor(){this.type="LOCAL",this._shouldAllowMigration=!0,this.listeners={},this.localCache={},this.pollTimer=null,this.pendingWrites=0,this.receiver=null,this.sender=null,this.serviceWorkerReceiverAvailable=!1,this.activeServiceWorker=null,this._workerInitializationPromise=this.initializeServiceWorkerMessaging().then(()=>{},()=>{})}async _openDb(){return this.db?this.db:(this.db=await zv(),this.db)}async _withRetries(e){let t=0;for(;;)try{const r=await this._openDb();return await e(r)}catch(r){if(t++>xB)throw r;this.db&&(this.db.close(),this.db=void 0)}}async initializeServiceWorkerMessaging(){return Qx()?this.initializeReceiver():this.initializeSender()}async initializeReceiver(){this.receiver=jm._getInstance(mB()),this.receiver._subscribe("keyChanged",async(e,t)=>({keyProcessed:(await this._poll()).includes(t.key)})),this.receiver._subscribe("ping",async(e,t)=>["keyChanged"])}async initializeSender(){var t,r;if(this.activeServiceWorker=await pB(),!this.activeServiceWorker)return;this.sender=new hB(this.activeServiceWorker);const e=await this.sender._send("ping",{},800);e&&(t=e[0])!=null&&t.fulfilled&&(r=e[0])!=null&&r.value.includes("keyChanged")&&(this.serviceWorkerReceiverAvailable=!0)}async notifyServiceWorker(e){if(!(!this.sender||!this.activeServiceWorker||gB()!==this.activeServiceWorker))try{await this.sender._send("keyChanged",{key:e},this.serviceWorkerReceiverAvailable?800:50)}catch{}}async _isAvailable(){try{if(!indexedDB)return!1;const e=await zv();return await gb(e,yg,"1"),await mb(e,yg),!0}catch{}return!1}async _withPendingWrite(e){this.pendingWrites++;try{await e()}finally{this.pendingWrites--}}async _set(e,t){return this._withPendingWrite(async()=>(await this._withRetries(r=>gb(r,e,t)),this.localCache[e]=t,this.notifyServiceWorker(e)))}async _get(e){const t=await this._withRetries(r=>vB(r,e));return this.localCache[e]=t,t}async _remove(e){return this._withPendingWrite(async()=>(await this._withRetries(t=>mb(t,e)),delete this.localCache[e],this.notifyServiceWorker(e)))}async _poll(){const e=await this._withRetries(s=>{const i=Fm(s,!1).getAll();return new Uh(i).toPromise()});if(!e)return[];if(this.pendingWrites!==0)return[];const t=[],r=new Set;if(e.length!==0)for(const{fbase_key:s,value:i}of e)r.add(s),JSON.stringify(this.localCache[s])!==JSON.stringify(i)&&(this.notifyListeners(s,i),t.push(s));for(const s of Object.keys(this.localCache))this.localCache[s]&&!r.has(s)&&(this.notifyListeners(s,null),t.push(s));return t}notifyListeners(e,t){this.localCache[e]=t;const r=this.listeners[e];if(r)for(const s of Array.from(r))s(t)}startPolling(){this.stopPolling(),this.pollTimer=setInterval(async()=>this._poll(),wB)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}_addListener(e,t){Object.keys(this.listeners).length===0&&this.startPolling(),this.listeners[e]||(this.listeners[e]=new Set,this._get(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),this.listeners[e].size===0&&delete this.listeners[e]),Object.keys(this.listeners).length===0&&this.stopPolling()}}lD.type="LOCAL";const IB=lD;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function yb(n,e){return zt(n,"POST","/v2/accounts/mfaSignIn:start",Bt(n,e))}function SB(n,e){return zt(n,"POST","/v2/accounts/mfaSignIn:finalize",Bt(n,e))}function EB(n,e){return zt(n,"POST","/v2/accounts/mfaSignIn:finalize",Bt(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Gy=BP("rcb"),TB=new Lh(3e4,6e4);class bB{constructor(){var e;this.hostLanguage="",this.counter=0,this.librarySeparatelyLoaded=!!((e=vn().grecaptcha)!=null&&e.render)}load(e,t=""){return ee(AB(t),e,"argument-error"),this.shouldResolveImmediately(t)&&sb(vn().grecaptcha)?Promise.resolve(vn().grecaptcha):new Promise((r,s)=>{const i=vn().setTimeout(()=>{s(mr(e,"network-request-failed"))},TB.get());vn()[Gy]=()=>{vn().clearTimeout(i),delete vn()[Gy];const a=vn().grecaptcha;if(!a||!sb(a)){s(mr(e,"internal-error"));return}const l=a.render;a.render=(u,h)=>{const f=l(u,h);return this.counter++,f},this.hostLanguage=t,r(a)};const o=`${i$()}?${Qa({onload:Gy,render:"explicit",hl:t})}`;Ux(o).catch(()=>{clearTimeout(i),s(mr(e,"internal-error"))})})}clearedOneInstance(){this.counter--}shouldResolveImmediately(e){var t;return!!((t=vn().grecaptcha)!=null&&t.render)&&(e===this.hostLanguage||this.counter>0||this.librarySeparatelyLoaded)}}function AB(n){return n.length<=6&&/^\s*[a-zA-Z0-9\-]*\s*$/.test(n)}class CB{async load(e){return new u$(e)}clearedOneInstance(){}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const cd="recaptcha",RB={theme:"light",type:"image"};class l7{constructor(e,t,r={...RB}){this.parameters=r,this.type=cd,this.destroyed=!1,this.widgetId=null,this.tokenChangeListeners=new Set,this.renderPromise=null,this.recaptcha=null,this.auth=cn(e),this.isInvisible=this.parameters.size==="invisible",ee(typeof document<"u",this.auth,"operation-not-supported-in-this-environment");const s=typeof t=="string"?document.getElementById(t):t;ee(s,this.auth,"argument-error"),this.container=s,this.parameters.callback=this.makeTokenCallback(this.parameters.callback),this._recaptchaLoader=this.auth.settings.appVerificationDisabledForTesting?new CB:new bB,this.validateStartingState()}async verify(){this.assertNotDestroyed();const e=await this.render(),t=this.getAssertedRecaptcha(),r=t.getResponse(e);return r||new Promise(s=>{const i=o=>{o&&(this.tokenChangeListeners.delete(i),s(o))};this.tokenChangeListeners.add(i),this.isInvisible&&t.execute(e)})}render(){try{this.assertNotDestroyed()}catch(e){return Promise.reject(e)}return this.renderPromise?this.renderPromise:(this.renderPromise=this.makeRenderPromise().catch(e=>{throw this.renderPromise=null,e}),this.renderPromise)}_reset(){this.assertNotDestroyed(),this.widgetId!==null&&this.getAssertedRecaptcha().reset(this.widgetId)}clear(){this.assertNotDestroyed(),this.destroyed=!0,this._recaptchaLoader.clearedOneInstance(),this.isInvisible||this.container.childNodes.forEach(e=>{this.container.removeChild(e)})}validateStartingState(){ee(!this.parameters.sitekey,this.auth,"argument-error"),ee(this.isInvisible||!this.container.hasChildNodes(),this.auth,"argument-error"),ee(typeof document<"u",this.auth,"operation-not-supported-in-this-environment")}makeTokenCallback(e){return t=>{if(this.tokenChangeListeners.forEach(r=>r(t)),typeof e=="function")e(t);else if(typeof e=="string"){const r=vn()[e];typeof r=="function"&&r(t)}}}assertNotDestroyed(){ee(!this.destroyed,this.auth,"internal-error")}async makeRenderPromise(){if(await this.init(),!this.widgetId){let e=this.container;if(!this.isInvisible){const t=document.createElement("div");e.appendChild(t),e=t}this.widgetId=this.getAssertedRecaptcha().render(e,this.parameters)}return this.widgetId}async init(){ee(jx()&&!Qx(),this.auth,"internal-error"),await NB(),this.recaptcha=await this._recaptchaLoader.load(this.auth,this.auth.languageCode||void 0);const e=await $U(this.auth);ee(e,this.auth,"internal-error"),this.parameters.sitekey=e}getAssertedRecaptcha(){return ee(this.recaptcha,this.auth,"internal-error"),this.recaptcha}}function NB(){let n=null;return new Promise(e=>{if(document.readyState==="complete"){e();return}n=()=>e(),window.addEventListener("load",n)}).catch(e=>{throw n&&window.removeEventListener("load",n),e})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Kx{constructor(e,t){this.verificationId=e,this.onConfirmation=t}confirm(e){const t=Ia._fromVerification(this.verificationId,e);return this.onConfirmation(t)}}async function c7(n,e,t){if(Qt(n.app))return Promise.reject(Vn(n));const r=cn(n),s=await Um(r,e,oe(t));return new Kx(s,i=>Bx(r,i))}async function u7(n,e,t){const r=oe(n);await Lm(!1,r,"phone");const s=await Um(r.auth,e,oe(t));return new Kx(s,i=>U$(r,i))}async function d7(n,e,t){const r=oe(n);if(Qt(r.auth.app))return Promise.reject(Vn(r.auth));const s=await Um(r.auth,e,oe(t));return new Kx(s,i=>$$(r,i))}async function Um(n,e,t){var r;if(!n._getRecaptchaConfig())try{await qP(n)}catch{console.log("Failed to initialize reCAPTCHA Enterprise config. Triggering the reCAPTCHA v2 verification.")}try{let s;if(typeof e=="string"?s={phoneNumber:e}:s=e,"session"in s){const i=s.session;if("phoneNumber"in s){ee(i.type==="enroll",n,"internal-error");const o={idToken:i.credential,phoneEnrollmentInfo:{phoneNumber:s.phoneNumber,clientType:"CLIENT_TYPE_WEB"}};return(await Io(n,o,"mfaSmsEnrollment",async(h,f)=>{if(f.phoneEnrollmentInfo.captchaResponse===ld){ee((t==null?void 0:t.type)===cd,h,"argument-error");const p=await Hy(h,f,t);return pb(h,p)}return pb(h,f)},"PHONE_PROVIDER").catch(h=>Promise.reject(h))).phoneSessionInfo.sessionInfo}else{ee(i.type==="signin",n,"internal-error");const o=((r=s.multiFactorHint)==null?void 0:r.uid)||s.multiFactorUid;ee(o,n,"missing-multi-factor-info");const a={mfaPendingCredential:i.credential,mfaEnrollmentId:o,phoneSignInInfo:{clientType:"CLIENT_TYPE_WEB"}};return(await Io(n,a,"mfaSmsSignIn",async(f,p)=>{if(p.phoneSignInInfo.captchaResponse===ld){ee((t==null?void 0:t.type)===cd,f,"argument-error");const y=await Hy(f,p,t);return yb(f,y)}return yb(f,p)},"PHONE_PROVIDER").catch(f=>Promise.reject(f))).phoneResponseInfo.sessionInfo}}else{const i={phoneNumber:s.phoneNumber,clientType:"CLIENT_TYPE_WEB"};return(await Io(n,i,"sendVerificationCode",async(u,h)=>{if(h.captchaResponse===ld){ee((t==null?void 0:t.type)===cd,u,"argument-error");const f=await Hy(u,h,t);return hb(u,f)}return hb(u,h)},"PHONE_PROVIDER").catch(u=>Promise.reject(u))).sessionInfo}}finally{t==null||t._reset()}}async function h7(n,e){const t=oe(n);if(Qt(t.auth.app))return Promise.reject(Vn(t.auth));await $x(t,e)}async function Hy(n,e,t){ee(t.type===cd,n,"argument-error");const r=await t.verify();ee(typeof r=="string",n,"argument-error");const s={...e};if("phoneEnrollmentInfo"in s){const i=s.phoneEnrollmentInfo.phoneNumber,o=s.phoneEnrollmentInfo.captchaResponse,a=s.phoneEnrollmentInfo.clientType,l=s.phoneEnrollmentInfo.recaptchaVersion;return Object.assign(s,{phoneEnrollmentInfo:{phoneNumber:i,recaptchaToken:r,captchaResponse:o,clientType:a,recaptchaVersion:l}}),s}else if("phoneSignInInfo"in s){const i=s.phoneSignInInfo.captchaResponse,o=s.phoneSignInInfo.clientType,a=s.phoneSignInInfo.recaptchaVersion;return Object.assign(s,{phoneSignInInfo:{recaptchaToken:r,captchaResponse:i,clientType:o,recaptchaVersion:a}}),s}else return Object.assign(s,{recaptchaToken:r}),s}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Zl{constructor(e){this.providerId=Zl.PROVIDER_ID,this.auth=cn(e)}verifyPhoneNumber(e,t){return Um(this.auth,e,oe(t))}static credential(e,t){return Ia._fromVerification(e,t)}static credentialFromResult(e){const t=e;return Zl.credentialFromTaggedObject(t)}static credentialFromError(e){return Zl.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{phoneNumber:t,temporaryProof:r}=e;return t&&r?Ia._fromTokenResponse(t,r):null}}Zl.PROVIDER_ID="phone";Zl.PHONE_SIGN_IN_METHOD="phone";/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ol(n,e){return e?pi(e):(ee(n._popupRedirectResolver,n,"argument-error"),n._popupRedirectResolver)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Yx extends jh{constructor(e){super("custom","custom"),this.params=e}_getIdTokenResponse(e){return _i(e,this._buildIdpRequest())}_linkToIdToken(e,t){return _i(e,this._buildIdpRequest(t))}_getReauthenticationResolver(e){return _i(e,this._buildIdpRequest())}_buildIdpRequest(e){const t={requestUri:this.params.requestUri,sessionId:this.params.sessionId,postBody:this.params.postBody,tenantId:this.params.tenantId,pendingToken:this.params.pendingToken,returnSecureToken:!0,returnIdpCredential:!0};return e&&(t.idToken=e),t}}function kB(n){return JP(n.auth,new Yx(n),n.bypassAuthState)}function PB(n){const{auth:e,user:t}=n;return ee(t,e,"internal-error"),YP(t,new Yx(n),n.bypassAuthState)}async function DB(n){const{auth:e,user:t}=n;return ee(t,e,"internal-error"),$x(t,new Yx(n),n.bypassAuthState)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class cD{constructor(e,t,r,s,i=!1){this.auth=e,this.resolver=r,this.user=s,this.bypassAuthState=i,this.pendingPromise=null,this.eventManager=null,this.filter=Array.isArray(t)?t:[t]}execute(){return new Promise(async(e,t)=>{this.pendingPromise={resolve:e,reject:t};try{this.eventManager=await this.resolver._initialize(this.auth),await this.onExecution(),this.eventManager.registerConsumer(this)}catch(r){this.reject(r)}})}async onAuthEvent(e){const{urlResponse:t,sessionId:r,postBody:s,tenantId:i,error:o,type:a}=e;if(o){this.reject(o);return}const l={auth:this.auth,requestUri:t,sessionId:r,tenantId:i||void 0,postBody:s||void 0,user:this.user,bypassAuthState:this.bypassAuthState};try{this.resolve(await this.getIdpTask(a)(l))}catch(u){this.reject(u)}}onError(e){this.reject(e)}getIdpTask(e){switch(e){case"signInViaPopup":case"signInViaRedirect":return kB;case"linkViaPopup":case"linkViaRedirect":return DB;case"reauthViaPopup":case"reauthViaRedirect":return PB;default:kr(this.auth,"internal-error")}}resolve(e){Ai(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.resolve(e),this.unregisterAndCleanUp()}reject(e){Ai(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.reject(e),this.unregisterAndCleanUp()}unregisterAndCleanUp(){this.eventManager&&this.eventManager.unregisterConsumer(this),this.pendingPromise=null,this.cleanUp()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const OB=new Lh(2e3,1e4);async function LB(n,e,t){if(Qt(n.app))return Promise.reject(mr(n,"operation-not-supported-in-this-environment"));const r=cn(n);Xc(n,e,ji);const s=ol(r,t);return new gi(r,"signInViaPopup",e,s).executeNotNull()}async function f7(n,e,t){const r=oe(n);if(Qt(r.auth.app))return Promise.reject(mr(r.auth,"operation-not-supported-in-this-environment"));Xc(r.auth,e,ji);const s=ol(r.auth,t);return new gi(r.auth,"reauthViaPopup",e,s,r).executeNotNull()}async function p7(n,e,t){const r=oe(n);Xc(r.auth,e,ji);const s=ol(r.auth,t);return new gi(r.auth,"linkViaPopup",e,s,r).executeNotNull()}class gi extends cD{constructor(e,t,r,s,i){super(e,t,s,i),this.provider=r,this.authWindow=null,this.pollId=null,gi.currentPopupAction&&gi.currentPopupAction.cancel(),gi.currentPopupAction=this}async executeNotNull(){const e=await this.execute();return ee(e,this.auth,"internal-error"),e}async onExecution(){Ai(this.filter.length===1,"Popup operations only handle one event");const e=Vm();this.authWindow=await this.resolver._openPopup(this.auth,this.provider,this.filter[0],e),this.authWindow.associatedEvent=e,this.resolver._originValidation(this.auth).catch(t=>{this.reject(t)}),this.resolver._isIframeWebStorageSupported(this.auth,t=>{t||this.reject(mr(this.auth,"web-storage-unsupported"))}),this.pollUserCancellation()}get eventId(){var e;return((e=this.authWindow)==null?void 0:e.associatedEvent)||null}cancel(){this.reject(mr(this.auth,"cancelled-popup-request"))}cleanUp(){this.authWindow&&this.authWindow.close(),this.pollId&&window.clearTimeout(this.pollId),this.authWindow=null,this.pollId=null,gi.currentPopupAction=null}pollUserCancellation(){const e=()=>{var t,r;if((r=(t=this.authWindow)==null?void 0:t.window)!=null&&r.closed){this.pollId=window.setTimeout(()=>{this.pollId=null,this.reject(mr(this.auth,"popup-closed-by-user"))},8e3);return}this.pollId=window.setTimeout(e,OB.get())};e()}}gi.currentPopupAction=null;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const MB="pendingRedirect",cp=new Map;class jB extends cD{constructor(e,t,r=!1){super(e,["signInViaRedirect","linkViaRedirect","reauthViaRedirect","unknown"],t,void 0,r),this.eventId=null}async execute(){let e=cp.get(this.auth._key());if(!e){try{const r=await VB(this.resolver,this.auth)?await super.execute():null;e=()=>Promise.resolve(r)}catch(t){e=()=>Promise.reject(t)}cp.set(this.auth._key(),e)}return this.bypassAuthState||cp.set(this.auth._key(),()=>Promise.resolve(null)),e()}async onAuthEvent(e){if(e.type==="signInViaRedirect")return super.onAuthEvent(e);if(e.type==="unknown"){this.resolve(null);return}if(e.eventId){const t=await this.auth._redirectUserForId(e.eventId);if(t)return this.user=t,super.onAuthEvent(e);this.resolve(null)}}async onExecution(){}cleanUp(){}}async function VB(n,e){const t=dD(e),r=uD(n);if(!await r._isAvailable())return!1;const s=await r._get(t)==="true";return await r._remove(t),s}async function Jx(n,e){return uD(n)._set(dD(e),"true")}function FB(n,e){cp.set(n._key(),e)}function uD(n){return pi(n._redirectPersistence)}function dD(n){return ap(MB,n.config.apiKey,n.name)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function g7(n,e,t){return UB(n,e,t)}async function UB(n,e,t){if(Qt(n.app))return Promise.reject(Vn(n));const r=cn(n);Xc(n,e,ji),await r._initializationPromise;const s=ol(r,t);return await Jx(s,r),s._openRedirect(r,e,"signInViaRedirect")}function m7(n,e,t){return $B(n,e,t)}async function $B(n,e,t){const r=oe(n);if(Xc(r.auth,e,ji),Qt(r.auth.app))return Promise.reject(Vn(r.auth));await r.auth._initializationPromise;const s=ol(r.auth,t);await Jx(s,r.auth);const i=await fD(r);return s._openRedirect(r.auth,e,"reauthViaRedirect",i)}function y7(n,e,t){return BB(n,e,t)}async function BB(n,e,t){const r=oe(n);Xc(r.auth,e,ji),await r.auth._initializationPromise;const s=ol(r.auth,t);await Lm(!1,r,e.providerId),await Jx(s,r.auth);const i=await fD(r);return s._openRedirect(r.auth,e,"linkViaRedirect",i)}async function _7(n,e){return await cn(n)._initializationPromise,hD(n,e,!1)}async function hD(n,e,t=!1){if(Qt(n.app))return Promise.reject(Vn(n));const r=cn(n),s=ol(r,e),o=await new jB(r,s,t).execute();return o&&!t&&(delete o.user._redirectEventId,await r._persistUserIfCurrent(o.user),await r._setRedirectUser(null,e)),o}async function fD(n){const e=Vm(`${n.uid}:::`);return n._redirectEventId=e,await n.auth._setRedirectUser(n),await n.auth._persistUserIfCurrent(n),e}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const zB=10*60*1e3;class qB{constructor(e){this.auth=e,this.cachedEventUids=new Set,this.consumers=new Set,this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1,this.lastProcessedEventTime=Date.now()}registerConsumer(e){this.consumers.add(e),this.queuedRedirectEvent&&this.isEventForConsumer(this.queuedRedirectEvent,e)&&(this.sendToConsumer(this.queuedRedirectEvent,e),this.saveEventToCache(this.queuedRedirectEvent),this.queuedRedirectEvent=null)}unregisterConsumer(e){this.consumers.delete(e)}onEvent(e){if(this.hasEventBeenHandled(e))return!1;let t=!1;return this.consumers.forEach(r=>{this.isEventForConsumer(e,r)&&(t=!0,this.sendToConsumer(e,r),this.saveEventToCache(e))}),this.hasHandledPotentialRedirect||!WB(e)||(this.hasHandledPotentialRedirect=!0,t||(this.queuedRedirectEvent=e,t=!0)),t}sendToConsumer(e,t){var r;if(e.error&&!pD(e)){const s=((r=e.error.code)==null?void 0:r.split("auth/")[1])||"internal-error";t.onError(mr(this.auth,s))}else t.onAuthEvent(e)}isEventForConsumer(e,t){const r=t.eventId===null||!!e.eventId&&e.eventId===t.eventId;return t.filter.includes(e.type)&&r}hasEventBeenHandled(e){return Date.now()-this.lastProcessedEventTime>=zB&&this.cachedEventUids.clear(),this.cachedEventUids.has(_b(e))}saveEventToCache(e){this.cachedEventUids.add(_b(e)),this.lastProcessedEventTime=Date.now()}}function _b(n){return[n.type,n.eventId,n.sessionId,n.tenantId].filter(e=>e).join("-")}function pD({type:n,error:e}){return n==="unknown"&&(e==null?void 0:e.code)==="auth/no-auth-event"}function WB(n){switch(n.type){case"signInViaRedirect":case"linkViaRedirect":case"reauthViaRedirect":return!0;case"unknown":return pD(n);default:return!1}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function GB(n,e={}){return zt(n,"GET","/v1/projects",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const HB=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,QB=/^https?/;async function KB(n){if(n.config.emulator)return;const{authorizedDomains:e}=await GB(n);for(const t of e)try{if(YB(t))return}catch{}kr(n,"unauthorized-domain")}function YB(n){const e=Xd(),{protocol:t,hostname:r}=new URL(e);if(n.startsWith("chrome-extension://")){const o=new URL(n);return o.hostname===""&&r===""?t==="chrome-extension:"&&n.replace("chrome-extension://","")===e.replace("chrome-extension://",""):t==="chrome-extension:"&&o.hostname===r}if(!QB.test(t))return!1;if(HB.test(n))return r===n;const s=n.replace(/\./g,"\\.");return new RegExp("^(.+\\."+s+"|"+s+")$","i").test(r)}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const JB=new Lh(3e4,6e4);function vb(){const n=vn().___jsl;if(n!=null&&n.H){for(const e of Object.keys(n.H))if(n.H[e].r=n.H[e].r||[],n.H[e].L=n.H[e].L||[],n.H[e].r=[...n.H[e].L],n.CP)for(let t=0;t<n.CP.length;t++)n.CP[t]=null}}function XB(n){return new Promise((e,t)=>{var s,i,o;function r(){vb(),gapi.load("gapi.iframes",{callback:()=>{e(gapi.iframes.getContext())},ontimeout:()=>{vb(),t(mr(n,"network-request-failed"))},timeout:JB.get()})}if((i=(s=vn().gapi)==null?void 0:s.iframes)!=null&&i.Iframe)e(gapi.iframes.getContext());else if((o=vn().gapi)!=null&&o.load)r();else{const a=BP("iframefcb");return vn()[a]=()=>{gapi.load?r():t(mr(n,"network-request-failed"))},Ux(`${a$()}?onload=${a}`).catch(l=>t(l))}}).catch(e=>{throw up=null,e})}let up=null;function ZB(n){return up=up||XB(n),up}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ez=new Lh(5e3,15e3),tz="__/auth/iframe",nz="emulator/auth/iframe",rz={style:{position:"absolute",top:"-100px",width:"1px",height:"1px"},"aria-hidden":"true",tabindex:"-1"},sz=new Map([["identitytoolkit.googleapis.com","p"],["staging-identitytoolkit.sandbox.googleapis.com","s"],["test-identitytoolkit.sandbox.googleapis.com","t"]]);function iz(n){const e=n.config;ee(e.authDomain,n,"auth-domain-config-required");const t=e.emulator?Vx(e,nz):`https://${n.config.authDomain}/${tz}`,r={apiKey:e.apiKey,appName:n.name,v:Ka},s=sz.get(n.config.apiHost);s&&(r.eid=s);const i=n._getFrameworks();return i.length&&(r.fw=i.join(",")),`${t}?${Qa(r).slice(1)}`}async function oz(n){const e=await ZB(n),t=vn().gapi;return ee(t,n,"internal-error"),e.open({where:document.body,url:iz(n),messageHandlersFilter:t.iframes.CROSS_ORIGIN_IFRAMES_FILTER,attributes:rz,dontclear:!0},r=>new Promise(async(s,i)=>{await r.restyle({setHideOnLeave:!1});const o=mr(n,"network-request-failed"),a=vn().setTimeout(()=>{i(o)},ez.get());function l(){vn().clearTimeout(a),s(r)}r.ping(l).then(l,()=>{i(o)})}))}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const az={location:"yes",resizable:"yes",statusbar:"yes",toolbar:"no"},lz=500,cz=600,uz="_blank",dz="http://localhost";class wb{constructor(e){this.window=e,this.associatedEvent=null}close(){if(this.window)try{this.window.close()}catch{}}}function hz(n,e,t,r=lz,s=cz){const i=Math.max((window.screen.availHeight-s)/2,0).toString(),o=Math.max((window.screen.availWidth-r)/2,0).toString();let a="";const l={...az,width:r.toString(),height:s.toString(),top:i,left:o},u=Cn().toLowerCase();t&&(a=LP(u)?uz:t),DP(u)&&(e=e||dz,l.scrollbars="yes");const h=Object.entries(l).reduce((p,[y,w])=>`${p}${y}=${w},`,"");if(JU(u)&&a!=="_self")return fz(e||"",a),new wb(null);const f=window.open(e||"",a,h);ee(f,n,"popup-blocked");try{f.focus()}catch{}return new wb(f)}function fz(n,e){const t=document.createElement("a");t.href=n,t.target=e;const r=document.createEvent("MouseEvent");r.initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,1,null),t.dispatchEvent(r)}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const pz="__/auth/handler",gz="emulator/auth/handler",mz=encodeURIComponent("fac");async function xb(n,e,t,r,s,i){ee(n.config.authDomain,n,"auth-domain-config-required"),ee(n.config.apiKey,n,"invalid-api-key");const o={apiKey:n.config.apiKey,appName:n.name,authType:t,redirectUrl:r,v:Ka,eventId:s};if(e instanceof ji){e.setDefaultLanguage(n.languageCode),o.providerId=e.providerId||"",jp(e.getCustomParameters())||(o.customParameters=JSON.stringify(e.getCustomParameters()));for(const[h,f]of Object.entries(i||{}))o[h]=f}if(e instanceof Zc){const h=e.getScopes().filter(f=>f!=="");h.length>0&&(o.scopes=h.join(","))}n.tenantId&&(o.tid=n.tenantId);const a=o;for(const h of Object.keys(a))a[h]===void 0&&delete a[h];const l=await n._getAppCheckToken(),u=l?`#${mz}=${encodeURIComponent(l)}`:"";return`${yz(n)}?${Qa(a).slice(1)}${u}`}function yz({config:n}){return n.emulator?Vx(n,gz):`https://${n.authDomain}/${pz}`}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Qy="webStorageSupport";class _z{constructor(){this.eventManagers={},this.iframes={},this.originValidationPromises={},this._redirectPersistence=iD,this._completeRedirectFn=hD,this._overrideRedirectResult=FB}async _openPopup(e,t,r,s){var o;Ai((o=this.eventManagers[e._key()])==null?void 0:o.manager,"_initialize() not called before _openPopup()");const i=await xb(e,t,r,Xd(),s);return hz(e,i,Vm())}async _openRedirect(e,t,r,s){await this._originValidation(e);const i=await xb(e,t,r,Xd(),s);return fB(i),new Promise(()=>{})}_initialize(e){const t=e._key();if(this.eventManagers[t]){const{manager:s,promise:i}=this.eventManagers[t];return s?Promise.resolve(s):(Ai(i,"If manager is not set, promise should be"),i)}const r=this.initAndGetManager(e);return this.eventManagers[t]={promise:r},r.catch(()=>{delete this.eventManagers[t]}),r}async initAndGetManager(e){const t=await oz(e),r=new qB(e);return t.register("authEvent",s=>(ee(s==null?void 0:s.authEvent,e,"invalid-auth-event"),{status:r.onEvent(s.authEvent)?"ACK":"ERROR"}),gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER),this.eventManagers[e._key()]={manager:r},this.iframes[e._key()]=t,r}_isIframeWebStorageSupported(e,t){this.iframes[e._key()].send(Qy,{type:Qy},s=>{var o;const i=(o=s==null?void 0:s[0])==null?void 0:o[Qy];i!==void 0&&t(!!i),kr(e,"internal-error")},gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER)}_originValidation(e){const t=e._key();return this.originValidationPromises[t]||(this.originValidationPromises[t]=KB(e)),this.originValidationPromises[t]}get _shouldInitProactively(){return UP()||OP()||Fx()}}const vz=_z;class gD{constructor(e){this.factorId=e}_process(e,t,r){switch(t.type){case"enroll":return this._finalizeEnroll(e,t.credential,r);case"signin":return this._finalizeSignIn(e,t.credential);default:return zs("unexpected MultiFactorSessionType")}}}class Xx extends gD{constructor(e){super("phone"),this.credential=e}static _fromCredential(e){return new Xx(e)}_finalizeEnroll(e,t,r){return sB(e,{idToken:t,displayName:r,phoneVerificationInfo:this.credential._makeVerificationRequest()})}_finalizeSignIn(e,t){return SB(e,{mfaPendingCredential:t,phoneVerificationInfo:this.credential._makeVerificationRequest()})}}class wz{constructor(){}static assertion(e){return Xx._fromCredential(e)}}wz.FACTOR_ID="phone";class xz{static assertionForEnrollment(e,t){return nh._fromSecret(e,t)}static assertionForSignIn(e,t){return nh._fromEnrollmentId(e,t)}static async generateSecret(e){var s;const t=e;ee(typeof((s=t.user)==null?void 0:s.auth)<"u","internal-error");const r=await iB(t.user.auth,{idToken:t.credential,totpEnrollmentInfo:{}});return Zx._fromStartTotpMfaEnrollmentResponse(r,t.user.auth)}}xz.FACTOR_ID="totp";class nh extends gD{constructor(e,t,r){super("totp"),this.otp=e,this.enrollmentId=t,this.secret=r}static _fromSecret(e,t){return new nh(t,void 0,e)}static _fromEnrollmentId(e,t){return new nh(t,e)}async _finalizeEnroll(e,t,r){return ee(typeof this.secret<"u",e,"argument-error"),oB(e,{idToken:t,displayName:r,totpVerificationInfo:this.secret._makeTotpVerificationInfo(this.otp)})}async _finalizeSignIn(e,t){ee(this.enrollmentId!==void 0&&this.otp!==void 0,e,"argument-error");const r={verificationCode:this.otp};return EB(e,{mfaPendingCredential:t,mfaEnrollmentId:this.enrollmentId,totpVerificationInfo:r})}}class Zx{constructor(e,t,r,s,i,o,a){this.sessionInfo=o,this.auth=a,this.secretKey=e,this.hashingAlgorithm=t,this.codeLength=r,this.codeIntervalSeconds=s,this.enrollmentCompletionDeadline=i}static _fromStartTotpMfaEnrollmentResponse(e,t){return new Zx(e.totpSessionInfo.sharedSecretKey,e.totpSessionInfo.hashingAlgorithm,e.totpSessionInfo.verificationCodeLength,e.totpSessionInfo.periodSec,new Date(e.totpSessionInfo.finalizeEnrollmentTime).toUTCString(),e.totpSessionInfo.sessionInfo,t)}_makeTotpVerificationInfo(e){return{sessionInfo:this.sessionInfo,verificationCode:e}}generateQrCodeUrl(e,t){var s;let r=!1;return(Cf(e)||Cf(t))&&(r=!0),r&&(Cf(e)&&(e=((s=this.auth.currentUser)==null?void 0:s.email)||"unknownuser"),Cf(t)&&(t=this.auth.name)),`otpauth://totp/${t}:${e}?secret=${this.secretKey}&issuer=${t}&algorithm=${this.hashingAlgorithm}&digits=${this.codeLength}`}}function Cf(n){return typeof n>"u"||(n==null?void 0:n.length)===0}var Ib="@firebase/auth",Sb="1.11.0";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Iz{constructor(e){this.auth=e,this.internalListeners=new Map}getUid(){var e;return this.assertAuthConfigured(),((e=this.auth.currentUser)==null?void 0:e.uid)||null}async getToken(e){return this.assertAuthConfigured(),await this.auth._initializationPromise,this.auth.currentUser?{accessToken:await this.auth.currentUser.getIdToken(e)}:null}addAuthTokenListener(e){if(this.assertAuthConfigured(),this.internalListeners.has(e))return;const t=this.auth.onIdTokenChanged(r=>{e((r==null?void 0:r.stsTokenManager.accessToken)||null)});this.internalListeners.set(e,t),this.updateProactiveRefresh()}removeAuthTokenListener(e){this.assertAuthConfigured();const t=this.internalListeners.get(e);t&&(this.internalListeners.delete(e),t(),this.updateProactiveRefresh())}assertAuthConfigured(){ee(this.auth._initializationPromise,"dependent-sdk-initialized-before-auth")}updateProactiveRefresh(){this.internalListeners.size>0?this.auth._startProactiveRefresh():this.auth._stopProactiveRefresh()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Sz(n){switch(n){case"Node":return"node";case"ReactNative":return"rn";case"Worker":return"webworker";case"Cordova":return"cordova";case"WebExtension":return"web-extension";default:return}}function Ez(n){Ss(new Nr("auth",(e,{options:t})=>{const r=e.getProvider("app").getImmediate(),s=e.getProvider("heartbeat"),i=e.getProvider("app-check-internal"),{apiKey:o,authDomain:a}=r.options;ee(o&&!o.includes(":"),"invalid-api-key",{appName:r.name});const l={apiKey:o,authDomain:a,clientPlatform:n,apiHost:"identitytoolkit.googleapis.com",tokenApiHost:"securetoken.googleapis.com",apiScheme:"https",sdkClientVersion:$P(n)},u=new r$(r,s,i,l);return y$(u,t),u},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((e,t,r)=>{e.getProvider("auth-internal").initialize()})),Ss(new Nr("auth-internal",e=>{const t=cn(e.getProvider("auth").getImmediate());return(r=>new Iz(r))(t)},"PRIVATE").setInstantiationMode("EXPLICIT")),Cr(Ib,Sb,Sz(n)),Cr(Ib,Sb,"esm2020")}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Tz=5*60,bz=r1("authIdTokenMaxAge")||Tz;let Eb=null;const Az=n=>async e=>{const t=e&&await e.getIdTokenResult(),r=t&&(new Date().getTime()-Date.parse(t.issuedAtTime))/1e3;if(r&&r>bz)return;const s=t==null?void 0:t.token;Eb!==s&&(Eb=s,await fetch(n,{method:s?"POST":"DELETE",headers:s?{Authorization:`Bearer ${s}`}:{}}))};function Cz(n=uh()){const e=ti(n,"auth");if(e.isInitialized())return e.getImmediate();const t=m$(n,{popupRedirectResolver:vz,persistence:[IB,nD,iD]}),r=r1("authTokenSyncURL");if(r&&typeof isSecureContext=="boolean"&&isSecureContext){const i=new URL(r,location.origin);if(location.origin===i.origin){const o=Az(i.toString());rB(t,o,()=>o(t.currentUser)),nB(t,a=>o(a))}}const s=e1("auth");return s&&_$(t,`http://${s}`),t}function Rz(){var n;return((n=document.getElementsByTagName("head"))==null?void 0:n[0])??document}s$({loadJS(n){return new Promise((e,t)=>{const r=document.createElement("script");r.setAttribute("src",n),r.onload=e,r.onerror=s=>{const i=mr("internal-error");i.customData=s,t(i)},r.type="text/javascript",r.charset="UTF-8",Rz().appendChild(r)})},gapiScript:"https://apis.google.com/js/api.js",recaptchaV2Script:"https://www.google.com/recaptcha/api.js",recaptchaEnterpriseScript:"https://www.google.com/recaptcha/enterprise.js?render="});Ez("Browser");const mD="@firebase/installations",eI="0.6.19";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const yD=1e4,_D=`w:${eI}`,vD="FIS_v2",Nz="https://firebaseinstallations.googleapis.com/v1",kz=60*60*1e3,Pz="installations",Dz="Installations";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Oz={"missing-app-config-values":'Missing App configuration value: "{$valueName}"',"not-registered":"Firebase Installation is not registered.","installation-not-found":"Firebase Installation not found.","request-failed":'{$requestName} request failed with error "{$serverCode} {$serverStatus}: {$serverMessage}"',"app-offline":"Could not process request. Application offline.","delete-pending-registration":"Can't delete installation while there is a pending registration request."},za=new Ha(Pz,Dz,Oz);function wD(n){return n instanceof Es&&n.code.includes("request-failed")}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function xD({projectId:n}){return`${Nz}/projects/${n}/installations`}function ID(n){return{token:n.token,requestStatus:2,expiresIn:Mz(n.expiresIn),creationTime:Date.now()}}async function SD(n,e){const r=(await e.json()).error;return za.create("request-failed",{requestName:n,serverCode:r.code,serverMessage:r.message,serverStatus:r.status})}function ED({apiKey:n}){return new Headers({"Content-Type":"application/json",Accept:"application/json","x-goog-api-key":n})}function Lz(n,{refreshToken:e}){const t=ED(n);return t.append("Authorization",jz(e)),t}async function TD(n){const e=await n();return e.status>=500&&e.status<600?n():e}function Mz(n){return Number(n.replace("s","000"))}function jz(n){return`${vD} ${n}`}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Vz({appConfig:n,heartbeatServiceProvider:e},{fid:t}){const r=xD(n),s=ED(n),i=e.getImmediate({optional:!0});if(i){const u=await i.getHeartbeatsHeader();u&&s.append("x-firebase-client",u)}const o={fid:t,authVersion:vD,appId:n.appId,sdkVersion:_D},a={method:"POST",headers:s,body:JSON.stringify(o)},l=await TD(()=>fetch(r,a));if(l.ok){const u=await l.json();return{fid:u.fid||t,registrationStatus:2,refreshToken:u.refreshToken,authToken:ID(u.authToken)}}else throw await SD("Create Installation",l)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function bD(n){return new Promise(e=>{setTimeout(e,n)})}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Fz(n){return btoa(String.fromCharCode(...n)).replace(/\+/g,"-").replace(/\//g,"_")}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Uz=/^[cdef][\w-]{21}$/,qv="";function $z(){try{const n=new Uint8Array(17);(self.crypto||self.msCrypto).getRandomValues(n),n[0]=112+n[0]%16;const t=Bz(n);return Uz.test(t)?t:qv}catch{return qv}}function Bz(n){return Fz(n).substr(0,22)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function $m(n){return`${n.appName}!${n.appId}`}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const AD=new Map;function CD(n,e){const t=$m(n);RD(t,e),zz(t,e)}function RD(n,e){const t=AD.get(n);if(t)for(const r of t)r(e)}function zz(n,e){const t=qz();t&&t.postMessage({key:n,fid:e}),Wz()}let ga=null;function qz(){return!ga&&"BroadcastChannel"in self&&(ga=new BroadcastChannel("[Firebase] FID Change"),ga.onmessage=n=>{RD(n.data.key,n.data.fid)}),ga}function Wz(){AD.size===0&&ga&&(ga.close(),ga=null)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Gz="firebase-installations-database",Hz=1,qa="firebase-installations-store";let Ky=null;function tI(){return Ky||(Ky=W0(Gz,Hz,{upgrade:(n,e)=>{switch(e){case 0:n.createObjectStore(qa)}}})),Ky}async function vg(n,e){const t=$m(n),s=(await tI()).transaction(qa,"readwrite"),i=s.objectStore(qa),o=await i.get(t);return await i.put(e,t),await s.done,(!o||o.fid!==e.fid)&&CD(n,e.fid),e}async function ND(n){const e=$m(n),r=(await tI()).transaction(qa,"readwrite");await r.objectStore(qa).delete(e),await r.done}async function Bm(n,e){const t=$m(n),s=(await tI()).transaction(qa,"readwrite"),i=s.objectStore(qa),o=await i.get(t),a=e(o);return a===void 0?await i.delete(t):await i.put(a,t),await s.done,a&&(!o||o.fid!==a.fid)&&CD(n,a.fid),a}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function nI(n){let e;const t=await Bm(n.appConfig,r=>{const s=Qz(r),i=Kz(n,s);return e=i.registrationPromise,i.installationEntry});return t.fid===qv?{installationEntry:await e}:{installationEntry:t,registrationPromise:e}}function Qz(n){const e=n||{fid:$z(),registrationStatus:0};return kD(e)}function Kz(n,e){if(e.registrationStatus===0){if(!navigator.onLine){const s=Promise.reject(za.create("app-offline"));return{installationEntry:e,registrationPromise:s}}const t={fid:e.fid,registrationStatus:1,registrationTime:Date.now()},r=Yz(n,t);return{installationEntry:t,registrationPromise:r}}else return e.registrationStatus===1?{installationEntry:e,registrationPromise:Jz(n)}:{installationEntry:e}}async function Yz(n,e){try{const t=await Vz(n,e);return vg(n.appConfig,t)}catch(t){throw wD(t)&&t.customData.serverCode===409?await ND(n.appConfig):await vg(n.appConfig,{fid:e.fid,registrationStatus:0}),t}}async function Jz(n){let e=await Tb(n.appConfig);for(;e.registrationStatus===1;)await bD(100),e=await Tb(n.appConfig);if(e.registrationStatus===0){const{installationEntry:t,registrationPromise:r}=await nI(n);return r||t}return e}function Tb(n){return Bm(n,e=>{if(!e)throw za.create("installation-not-found");return kD(e)})}function kD(n){return Xz(n)?{fid:n.fid,registrationStatus:0}:n}function Xz(n){return n.registrationStatus===1&&n.registrationTime+yD<Date.now()}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Zz({appConfig:n,heartbeatServiceProvider:e},t){const r=e9(n,t),s=Lz(n,t),i=e.getImmediate({optional:!0});if(i){const u=await i.getHeartbeatsHeader();u&&s.append("x-firebase-client",u)}const o={installation:{sdkVersion:_D,appId:n.appId}},a={method:"POST",headers:s,body:JSON.stringify(o)},l=await TD(()=>fetch(r,a));if(l.ok){const u=await l.json();return ID(u)}else throw await SD("Generate Auth Token",l)}function e9(n,{fid:e}){return`${xD(n)}/${e}/authTokens:generate`}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function rI(n,e=!1){let t;const r=await Bm(n.appConfig,i=>{if(!PD(i))throw za.create("not-registered");const o=i.authToken;if(!e&&r9(o))return i;if(o.requestStatus===1)return t=t9(n,e),i;{if(!navigator.onLine)throw za.create("app-offline");const a=i9(i);return t=n9(n,a),a}});return t?await t:r.authToken}async function t9(n,e){let t=await bb(n.appConfig);for(;t.authToken.requestStatus===1;)await bD(100),t=await bb(n.appConfig);const r=t.authToken;return r.requestStatus===0?rI(n,e):r}function bb(n){return Bm(n,e=>{if(!PD(e))throw za.create("not-registered");const t=e.authToken;return o9(t)?{...e,authToken:{requestStatus:0}}:e})}async function n9(n,e){try{const t=await Zz(n,e),r={...e,authToken:t};return await vg(n.appConfig,r),t}catch(t){if(wD(t)&&(t.customData.serverCode===401||t.customData.serverCode===404))await ND(n.appConfig);else{const r={...e,authToken:{requestStatus:0}};await vg(n.appConfig,r)}throw t}}function PD(n){return n!==void 0&&n.registrationStatus===2}function r9(n){return n.requestStatus===2&&!s9(n)}function s9(n){const e=Date.now();return e<n.creationTime||n.creationTime+n.expiresIn<e+kz}function i9(n){const e={requestStatus:1,requestTime:Date.now()};return{...n,authToken:e}}function o9(n){return n.requestStatus===1&&n.requestTime+yD<Date.now()}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function a9(n){const e=n,{installationEntry:t,registrationPromise:r}=await nI(e);return r?r.catch(console.error):rI(e).catch(console.error),t.fid}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function l9(n,e=!1){const t=n;return await c9(t),(await rI(t,e)).token}async function c9(n){const{registrationPromise:e}=await nI(n);e&&await e}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function u9(n){if(!n||!n.options)throw Yy("App Configuration");if(!n.name)throw Yy("App Name");const e=["projectId","apiKey","appId"];for(const t of e)if(!n.options[t])throw Yy(t);return{appName:n.name,projectId:n.options.projectId,apiKey:n.options.apiKey,appId:n.options.appId}}function Yy(n){return za.create("missing-app-config-values",{valueName:n})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const DD="installations",d9="installations-internal",h9=n=>{const e=n.getProvider("app").getImmediate(),t=u9(e),r=ti(e,"heartbeat");return{app:e,appConfig:t,heartbeatServiceProvider:r,_delete:()=>Promise.resolve()}},f9=n=>{const e=n.getProvider("app").getImmediate(),t=ti(e,DD).getImmediate();return{getId:()=>a9(t),getToken:s=>l9(t,s)}};function p9(){Ss(new Nr(DD,h9,"PUBLIC")),Ss(new Nr(d9,f9,"PRIVATE"))}p9();Cr(mD,eI);Cr(mD,eI,"esm2020");/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const wg="analytics",g9="firebase_id",m9="origin",y9=60*1e3,_9="https://firebase.googleapis.com/v1alpha/projects/-/apps/{app-id}/webConfig",sI="https://www.googletagmanager.com/gtag/js";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Rr=new ch("@firebase/analytics");/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const v9={"already-exists":"A Firebase Analytics instance with the appId {$id}  already exists. Only one Firebase Analytics instance can be created for each appId.","already-initialized":"initializeAnalytics() cannot be called again with different options than those it was initially called with. It can be called again with the same options to return the existing instance, or getAnalytics() can be used to get a reference to the already-initialized instance.","already-initialized-settings":"Firebase Analytics has already been initialized.settings() must be called before initializing any Analytics instanceor it will have no effect.","interop-component-reg-failed":"Firebase Analytics Interop Component failed to instantiate: {$reason}","invalid-analytics-context":"Firebase Analytics is not supported in this environment. Wrap initialization of analytics in analytics.isSupported() to prevent initialization in unsupported environments. Details: {$errorInfo}","indexeddb-unavailable":"IndexedDB unavailable or restricted in this environment. Wrap initialization of analytics in analytics.isSupported() to prevent initialization in unsupported environments. Details: {$errorInfo}","fetch-throttle":"The config fetch request timed out while in an exponential backoff state. Unix timestamp in milliseconds when fetch request throttling ends: {$throttleEndTimeMillis}.","config-fetch-failed":"Dynamic config fetch failed: [{$httpStatus}] {$responseMessage}","no-api-key":'The "apiKey" field is empty in the local Firebase config. Firebase Analytics requires this field tocontain a valid API key.',"no-app-id":'The "appId" field is empty in the local Firebase config. Firebase Analytics requires this field tocontain a valid app ID.',"no-client-id":'The "client_id" field is empty.',"invalid-gtag-resource":"Trusted Types detected an invalid gtag resource: {$gtagURL}."},Br=new Ha("analytics","Analytics",v9);/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function w9(n){if(!n.startsWith(sI)){const e=Br.create("invalid-gtag-resource",{gtagURL:n});return Rr.warn(e.message),""}return n}function OD(n){return Promise.all(n.map(e=>e.catch(t=>t)))}function x9(n,e){let t;return window.trustedTypes&&(t=window.trustedTypes.createPolicy(n,e)),t}function I9(n,e){const t=x9("firebase-js-sdk-policy",{createScriptURL:w9}),r=document.createElement("script"),s=`${sI}?l=${n}&id=${e}`;r.src=t?t==null?void 0:t.createScriptURL(s):s,r.async=!0,document.head.appendChild(r)}function S9(n){let e=[];return Array.isArray(window[n])?e=window[n]:window[n]=e,e}async function E9(n,e,t,r,s,i){const o=r[s];try{if(o)await e[o];else{const l=(await OD(t)).find(u=>u.measurementId===s);l&&await e[l.appId]}}catch(a){Rr.error(a)}n("config",s,i)}async function T9(n,e,t,r,s){try{let i=[];if(s&&s.send_to){let o=s.send_to;Array.isArray(o)||(o=[o]);const a=await OD(t);for(const l of o){const u=a.find(f=>f.measurementId===l),h=u&&e[u.appId];if(h)i.push(h);else{i=[];break}}}i.length===0&&(i=Object.values(e)),await Promise.all(i),n("event",r,s||{})}catch(i){Rr.error(i)}}function b9(n,e,t,r){async function s(i,...o){try{if(i==="event"){const[a,l]=o;await T9(n,e,t,a,l)}else if(i==="config"){const[a,l]=o;await E9(n,e,t,r,a,l)}else if(i==="consent"){const[a,l]=o;n("consent",a,l)}else if(i==="get"){const[a,l,u]=o;n("get",a,l,u)}else if(i==="set"){const[a]=o;n("set",a)}else n(i,...o)}catch(a){Rr.error(a)}}return s}function A9(n,e,t,r,s){let i=function(...o){window[r].push(arguments)};return window[s]&&typeof window[s]=="function"&&(i=window[s]),window[s]=b9(i,n,e,t),{gtagCore:i,wrappedGtag:window[s]}}function C9(n){const e=window.document.getElementsByTagName("script");for(const t of Object.values(e))if(t.src&&t.src.includes(sI)&&t.src.includes(n))return t;return null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const R9=30,N9=1e3;class k9{constructor(e={},t=N9){this.throttleMetadata=e,this.intervalMillis=t}getThrottleMetadata(e){return this.throttleMetadata[e]}setThrottleMetadata(e,t){this.throttleMetadata[e]=t}deleteThrottleMetadata(e){delete this.throttleMetadata[e]}}const LD=new k9;function P9(n){return new Headers({Accept:"application/json","x-goog-api-key":n})}async function D9(n){var o;const{appId:e,apiKey:t}=n,r={method:"GET",headers:P9(t)},s=_9.replace("{app-id}",e),i=await fetch(s,r);if(i.status!==200&&i.status!==304){let a="";try{const l=await i.json();(o=l.error)!=null&&o.message&&(a=l.error.message)}catch{}throw Br.create("config-fetch-failed",{httpStatus:i.status,responseMessage:a})}return i.json()}async function O9(n,e=LD,t){const{appId:r,apiKey:s,measurementId:i}=n.options;if(!r)throw Br.create("no-app-id");if(!s){if(i)return{measurementId:i,appId:r};throw Br.create("no-api-key")}const o=e.getThrottleMetadata(r)||{backoffCount:0,throttleEndTimeMillis:Date.now()},a=new j9;return setTimeout(async()=>{a.abort()},t!==void 0?t:y9),MD({appId:r,apiKey:s,measurementId:i},o,a,e)}async function MD(n,{throttleEndTimeMillis:e,backoffCount:t},r,s=LD){var a;const{appId:i,measurementId:o}=n;try{await L9(r,e)}catch(l){if(o)return Rr.warn(`Timed out fetching this Firebase app's measurement ID from the server. Falling back to the measurement ID ${o} provided in the "measurementId" field in the local Firebase config. [${l==null?void 0:l.message}]`),{appId:i,measurementId:o};throw l}try{const l=await D9(n);return s.deleteThrottleMetadata(i),l}catch(l){const u=l;if(!M9(u)){if(s.deleteThrottleMetadata(i),o)return Rr.warn(`Failed to fetch this Firebase app's measurement ID from the server. Falling back to the measurement ID ${o} provided in the "measurementId" field in the local Firebase config. [${u==null?void 0:u.message}]`),{appId:i,measurementId:o};throw l}const h=Number((a=u==null?void 0:u.customData)==null?void 0:a.httpStatus)===503?zS(t,s.intervalMillis,R9):zS(t,s.intervalMillis),f={throttleEndTimeMillis:Date.now()+h,backoffCount:t+1};return s.setThrottleMetadata(i,f),Rr.debug(`Calling attemptFetch again in ${h} millis`),MD(n,f,r,s)}}function L9(n,e){return new Promise((t,r)=>{const s=Math.max(e-Date.now(),0),i=setTimeout(t,s);n.addEventListener(()=>{clearTimeout(i),r(Br.create("fetch-throttle",{throttleEndTimeMillis:e}))})})}function M9(n){if(!(n instanceof Es)||!n.customData)return!1;const e=Number(n.customData.httpStatus);return e===429||e===500||e===503||e===504}class j9{constructor(){this.listeners=[]}addEventListener(e){this.listeners.push(e)}abort(){this.listeners.forEach(e=>e())}}async function V9(n,e,t,r,s){if(s&&s.global){n("event",t,r);return}else{const i=await e,o={...r,send_to:i};n("event",t,o)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function F9(){if(Fg())try{await z0()}catch(n){return Rr.warn(Br.create("indexeddb-unavailable",{errorInfo:n==null?void 0:n.toString()}).message),!1}else return Rr.warn(Br.create("indexeddb-unavailable",{errorInfo:"IndexedDB is not available in this environment."}).message),!1;return!0}async function U9(n,e,t,r,s,i,o){const a=O9(n);a.then(p=>{t[p.measurementId]=p.appId,n.options.measurementId&&p.measurementId!==n.options.measurementId&&Rr.warn(`The measurement ID in the local Firebase config (${n.options.measurementId}) does not match the measurement ID fetched from the server (${p.measurementId}). To ensure analytics events are always sent to the correct Analytics property, update the measurement ID field in the local config or remove it from the local config.`)}).catch(p=>Rr.error(p)),e.push(a);const l=F9().then(p=>{if(p)return r.getId()}),[u,h]=await Promise.all([a,l]);C9(i)||I9(i,u.measurementId),s("js",new Date);const f=(o==null?void 0:o.config)??{};return f[m9]="firebase",f.update=!0,h!=null&&(f[g9]=h),s("config",u.measurementId,f),u.measurementId}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class $9{constructor(e){this.app=e}_delete(){return delete ud[this.app.options.appId],Promise.resolve()}}let ud={},Ab=[];const Cb={};let Jy="dataLayer",B9="gtag",Rb,jD,Nb=!1;function z9(){const n=[];if(B0()&&n.push("This is a browser extension environment."),u1()||n.push("Cookies are not available."),n.length>0){const e=n.map((r,s)=>`(${s+1}) ${r}`).join(" "),t=Br.create("invalid-analytics-context",{errorInfo:e});Rr.warn(t.message)}}function q9(n,e,t){z9();const r=n.options.appId;if(!r)throw Br.create("no-app-id");if(!n.options.apiKey)if(n.options.measurementId)Rr.warn(`The "apiKey" field is empty in the local Firebase config. This is needed to fetch the latest measurement ID for this Firebase app. Falling back to the measurement ID ${n.options.measurementId} provided in the "measurementId" field in the local Firebase config.`);else throw Br.create("no-api-key");if(ud[r]!=null)throw Br.create("already-exists",{id:r});if(!Nb){S9(Jy);const{wrappedGtag:i,gtagCore:o}=A9(ud,Ab,Cb,Jy,B9);jD=i,Rb=o,Nb=!0}return ud[r]=U9(n,Ab,Cb,e,Rb,Jy,t),new $9(n)}function W9(n=uh()){n=oe(n);const e=ti(n,wg);return e.isInitialized()?e.getImmediate():G9(n)}function G9(n,e={}){const t=ti(n,wg);if(t.isInitialized()){const s=t.getImmediate();if(qr(e,t.getOptions()))return s;throw Br.create("already-initialized")}return t.initialize({options:e})}async function H9(){if(B0()||!u1()||!Fg())return!1;try{return await z0()}catch{return!1}}function Q9(n,e,t,r){n=oe(n),V9(jD,ud[n.app.options.appId],e,t,r).catch(s=>Rr.error(s))}const kb="@firebase/analytics",Pb="0.10.18";function K9(){Ss(new Nr(wg,(e,{options:t})=>{const r=e.getProvider("app").getImmediate(),s=e.getProvider("installations-internal").getImmediate();return q9(r,s,t)},"PUBLIC")),Ss(new Nr("analytics-internal",n,"PRIVATE")),Cr(kb,Pb),Cr(kb,Pb,"esm2020");function n(e){try{const t=e.getProvider(wg).getImmediate();return{logEvent:(r,s,i)=>Q9(t,r,s,i)}}catch(t){throw Br.create("interop-component-reg-failed",{reason:t})}}}K9();const VD={apiKey:"AIzaSyAdJ3lRxhgZWhnqH8SNQsT1bTFB8E0-cDg",authDomain:"quitarena-a97de.firebaseapp.com",databaseURL:"https://quitarena-a97de-default-rtdb.europe-west1.firebasedatabase.app",projectId:"quitarena-a97de",storageBucket:"quitarena-a97de.firebasestorage.app",messagingSenderId:"693525963288",appId:"1:693525963288:web:a175e9a8bd56fffb35596d",measurementId:"G-H2CCRXYY74"},$h=lj().length?uh():g1(VD),K=D4($h,VD.databaseURL),js=sU($h),mi=Cz($h);console.log("✅ Firebase services initialized:",{db:!!K,firestore:!!js,auth:!!mi});tB(mi,nD).then(()=>{console.log("Firebase Auth persistence configured for 30 days")}).catch(n=>{console.error("Error setting auth persistence:",n)});let FD=null;(async()=>{try{await H9()&&(FD=W9($h))}catch(n){console.debug("Analytics not initialized:",n==null?void 0:n.message)}})();const v7=Object.freeze(Object.defineProperty({__proto__:null,get analytics(){return FD},app:$h,auth:mi,db:K,firestore:js},Symbol.toStringTag,{value:"Module"}));class zm{constructor(e,t){this.db=e,this.userUID=t,this.userRef=he(e,`users/${t}`),this.statsRef=he(e,`users/${t}/stats`),this.profileRef=he(e,`users/${t}/profile`),this.behaviorLogRef=he(e,`users/${t}/behaviorLog`)}async updateStat(e,t,r=""){try{console.log(`🔄 StatManager: updateStat called - ${e}: ${t>0?"+":""}${t} (${r})`);const s=await $e(this.statsRef);if(!s.exists())return console.error(`❌ StatManager: Stats don't exist for user ${this.userUID}`),!1;const i=s.val(),o=i[e]||0,a=Math.max(0,Math.min(100,o+t));console.log(`🔄 StatManager: ${e} change: ${o} → ${a} (${t>0?"+":""}${t})`),console.log(`🔄 StatManager: About to write to Firebase - ${e}: ${a}`),console.log("🔄 StatManager: Writing to path:",this.statsRef.toString()),console.log("🔄 StatManager: Full stats object to write:",{...i,[e]:a});try{await Xe(this.statsRef,{...i,[e]:a}),console.log(`✅ StatManager: Successfully updated ${e} in Firebase`)}catch(l){throw console.error(`❌ StatManager: Firebase write failed for ${e}:`,l),l}return await this.logBehavior(e,t,r),this.showStatNotification(e,t,r),console.log(`${e}: ${t>0?"+":""}${t} (${r})`),!0}catch(s){return console.error(`❌ StatManager: CRITICAL ERROR updating ${e}:`,s),console.error("❌ StatManager: Error details:",{message:s.message,code:s.code,stack:s.stack}),!1}}async updateAddictionFromCleanTime(){try{const e=await $e(he(this.db,`users/${this.userUID}/profile/lastRelapseDate`)),t=await $e(this.userRef);if(!t.exists())return;const r=t.val(),s=e.exists()?new Date(e.val()):new Date(r.quitDate||Date.now()),o=Math.floor((new Date-s)/(1e3*60*60*24*7));if(o>=1){const a=o*2;await this.updateStat("addictionLevel",-a,`Clean time: ${o} week(s)`),o>=1&&await this.resetRelapseEscalationLevel()}}catch(e){console.error("Error updating addiction from clean time:",e)}}async handleRelapse(){try{console.log("🔄 StatManager: handleRelapse() called for user:",this.userUID);const e=new Date,t=await $e(he(this.db,`users/${this.userUID}/profile/lastRelapseDate`)),r=await $e(he(this.db,`users/${this.userUID}/profile/relapseEscalationLevel`));let s=1;if(console.log("🔄 StatManager: Last relapse exists:",t.exists()),console.log("🔄 StatManager: Current escalation level exists:",r.exists()),t.exists()){const o=new Date(t.val()),a=Math.floor((e-o)/(1e3*60*60*24)),l=r.exists()?r.val():1;console.log(`🔄 StatManager: Current escalation level from Firebase: ${l}`),console.log(`🔄 StatManager: Days since last relapse: ${a}`),a>=7?(s=1,console.log(`🔄 StatManager: After 7+ days clean → escalation level reset to: ${s}`)):(s=l+1,console.log(`🔄 StatManager: Within ${a} days → escalation level: ${l} + 1 = ${s}`))}let i=0;switch(s){case 1:i=4;break;case 2:i=6;break;default:i=8;break}console.log(`🔄 StatManager: Escalation level ${s} → addiction increase: +${i}`),console.log("🔄 StatManager: Updating all stats in single write operation...");try{const o=await $e(this.statsRef);if(!o.exists())return console.error("❌ StatManager: No stats found for user"),!1;const a=o.val();console.log("🔄 StatManager: Current stats before relapse:",a);const l=Math.max(0,Math.min(100,(a.addictionLevel||0)+i)),u=Math.max(0,Math.min(100,(a.mentalStrength||0)-3)),h=Math.max(0,Math.min(100,(a.triggerDefense||0)-3));console.log(`🔄 StatManager: addictionLevel change: ${a.addictionLevel} → ${l} (+${i})`),console.log(`🔄 StatManager: mentalStrength change: ${a.mentalStrength} → ${u} (-3)`),console.log(`🔄 StatManager: triggerDefense change: ${a.triggerDefense} → ${h} (-3)`);const f={...a,addictionLevel:l,mentalStrength:u,triggerDefense:h};console.log("🔄 StatManager: Writing complete updated stats:",f),await Xe(this.statsRef,f),console.log("✅ StatManager: Successfully updated ALL stats in single write"),await Promise.all([this.logBehavior("addictionLevel",i,`Relapse escalation level ${s}`),this.logBehavior("mentalStrength",-3,"Relapse setback"),this.logBehavior("triggerDefense",-3,"Relapse to known trigger")]),this.showStatNotification("addictionLevel",i,`Relapse escalation level ${s}`),this.showStatNotification("mentalStrength",-3,"Relapse setback"),this.showStatNotification("triggerDefense",-3,"Relapse to known trigger")}catch(o){throw console.error("❌ StatManager: CRITICAL ERROR updating relapse stats:",o),o}return await Promise.all([Xe(he(this.db,`users/${this.userUID}/profile/lastRelapseDate`),e.toISOString()),Xe(he(this.db,`users/${this.userUID}/profile/relapseDate`),e.toISOString()),Xe(he(this.db,`users/${this.userUID}/profile/relapseEscalationLevel`),s)]),await this.logBehavior("relapse",s,`Escalation level ${s} - ${i} addiction, -3 mental, -3 trigger defense`),!0}catch(e){return console.error("Error handling relapse:",e),!1}}async resetRelapseEscalationLevel(){try{await Xe(he(this.db,`users/${this.userUID}/profile/relapseEscalationLevel`),1),console.log("Relapse escalation level reset")}catch(e){console.error("Error resetting relapse escalation level:",e)}}async getAddictionStatus(){try{const e=await $e(he(this.db,`users/${this.userUID}/profile/lastRelapseDate`)),t=await $e(he(this.db,`users/${this.userUID}/profile/relapseEscalationLevel`)),r=await $e(this.userRef);if(!r.exists())return null;const s=r.val(),i=e.exists()?new Date(e.val()):new Date(s.quitDate||Date.now()),o=t.exists()?t.val():1,a=new Date,l=Math.floor((a-i)/(1e3*60*60*24)),u=Math.floor((a-i)/(1e3*60*60*24*7));return{lastRelapseDate:i,escalationLevel:o,daysSinceLastRelapse:l,cleanWeeks:u,isCleanFor7Days:l>=7}}catch(e){return console.error("Error getting addiction status:",e),null}}async getCurrentEscalationLevel(){try{const e=await $e(he(this.db,`users/${this.userUID}/profile/relapseEscalationLevel`));return e.exists()?e.val():1}catch(e){return console.error("Error getting current escalation level:",e),1}}async handleCravingResistance(){try{const e=new Date().toDateString(),t=await this.checkDailyCravingResistanceLimits(e);if(!t.canAwardMentalStrength&&!t.canAwardTriggerDefense)return console.log("Daily craving resistance limits reached for both stats"),await this.trackAppUsageDuringCravings(),!0;const r=[];return t.canAwardMentalStrength?r.push(this.updateStat("mentalStrength",1,"Successful craving resistance")):console.log("Daily mental strength limit reached for craving resistance"),t.canAwardTriggerDefense?r.push(this.updateStat("triggerDefense",3,"Surviving trigger situation")):console.log("Daily trigger defense limit reached for craving resistance"),r.length>0&&await Promise.all(r),await this.trackAppUsageDuringCravings(),await this.logDailyCravingResistance(e,t),!0}catch(e){return console.error("Error handling craving resistance:",e),!1}}async handleCravingLogged(){try{const e=new Date().toDateString(),t=await this.checkDailyCravingLoggingLimits(e);if(!t.canAwardMotivation&&!t.canAwardTriggerDefense)return console.log("Daily craving logging limits reached for both stats"),!0;const r=[];return t.canAwardMotivation?r.push(this.updateStat("motivation",.25,"Craving awareness and tracking")):console.log("Daily motivation limit reached for craving logging"),t.canAwardTriggerDefense?r.push(this.updateStat("triggerDefense",.25,"Craving awareness and tracking")):console.log("Daily trigger defense limit reached for craving logging"),r.length>0&&await Promise.all(r),await this.logDailyCravingLogging(e,t),!0}catch(e){return console.error("Error handling craving logged:",e),!1}}async handleBreathingExercise(){try{const e=new Date().toDateString();return await Xe(he(this.db,`users/${this.userUID}/profile/daily/${e}/breathing`),!0),await this.checkBreathingStreak()>=3&&await this.updateStat("mentalStrength",1,"3-day breathing exercise streak"),!0}catch(e){return console.error("Error handling breathing exercise:",e),!1}}async handleHydrationUpdate(e){try{const t=new Date().toDateString();return await Xe(he(this.db,`users/${this.userUID}/profile/daily/${t}/water`),e),await this.checkHydrationStreak()>=3&&await this.updateStat("mentalStrength",1,"3-day hydration streak"),!0}catch(t){return console.error("Error handling hydration update:",t),!1}}async checkMilestoneBonuses(){try{const e=await $e(he(this.db,`users/${this.userUID}/profile/relapseDate`)),t=await $e(this.userRef);if(!t.exists())return;const r=t.val(),s=e.exists()?new Date(e.val()):new Date(r.quitDate||Date.now()),o=Math.floor((new Date-s)/(1e3*60*60*24)),a=[{days:7,bonus:5,name:"First week"},{days:30,bonus:10,name:"First month"},{days:90,bonus:15,name:"Three months"}];for(const l of a)if(o>=l.days){const u=`milestone_${l.days}`;(await $e(he(this.db,`users/${this.userUID}/profile/${u}`))).exists()||await Promise.all([this.updateStat("mentalStrength",l.bonus,`${l.name} milestone bonus`),Xe(he(this.db,`users/${this.userUID}/profile/${u}`),!0)])}}catch(e){console.error("Error checking milestone bonuses:",e)}}async trackLoggingActivity(){try{const e=new Date().toDateString(),t=new Date;return await Xe(he(this.db,`users/${this.userUID}/profile/daily/${e}/logged`),!0),await Xe(he(this.db,`users/${this.userUID}/profile/lastActivity`),t.toISOString()),await this.checkWeeklyLoggingFrequency()>=3&&await this.updateStat("motivation",2,"Regular logging (3+ days this week)"),!0}catch(e){return console.error("Error tracking logging activity:",e),!1}}async handleAchievementShare(){try{return await this.updateStat("motivation",3,"Sharing achievement"),!0}catch(e){return console.error("Error handling achievement share:",e),!1}}async handleTriggerPlanning(){try{return await this.updateStat("triggerDefense",1,"Pre-planning for known triggers"),!0}catch(e){return console.error("Error handling trigger planning:",e),!1}}async handleTriggerListUpdate(){try{return await this.updateStat("triggerDefense",1,"Updating trigger list"),!0}catch(e){return console.error("Error handling trigger list update:",e),!1}}async handleUnpreparedTrigger(){try{return await this.updateStat("triggerDefense",-1,"Entering trigger situation unprepared"),!0}catch(e){return console.error("Error handling unprepared trigger:",e),!1}}async checkBreathingStreak(){try{let e=0;for(let t=0;t<7;t++){const r=new Date;r.setDate(r.getDate()-t);const s=r.toDateString(),i=await $e(he(this.db,`users/${this.userUID}/profile/daily/${s}/breathing`));if(i.exists()&&i.val())e++;else break}return e}catch(e){return console.error("Error checking breathing streak:",e),0}}async checkHydrationStreak(){try{let e=0;for(let t=0;t<7;t++){const r=new Date;r.setDate(r.getDate()-t);const s=r.toDateString(),i=await $e(he(this.db,`users/${this.userUID}/profile/daily/${s}/water`));if(i.exists()&&i.val()>0)e++;else break}return e}catch(e){return console.error("Error checking hydration streak:",e),0}}async checkWeeklyLoggingFrequency(){try{let e=0;for(let t=0;t<7;t++){const r=new Date;r.setDate(r.getDate()-t);const s=r.toDateString(),i=await $e(he(this.db,`users/${this.userUID}/profile/daily/${s}/logged`));i.exists()&&i.val()&&e++}return e}catch(e){return console.error("Error checking weekly logging frequency:",e),0}}async checkInactivityPenalty(){try{const e=await $e(this.userRef);if(!e.exists())return;const t=e.val(),r=new Date,s=t.createdAt?new Date(t.createdAt):t.quitStartDate?new Date(t.quitStartDate):r,i=Math.floor((r-s)/(1e3*60*60*24));if(i<1)return;const o=await $e(he(this.db,`users/${this.userUID}/profile/lastActivity`));if(o.exists()){const u=new Date(o.val()),h=Math.floor((r-u)/(1e3*60*60*24));if(h>=7&&i>=7){await this.updateStat("motivation",-3,"Long period inactive (7+ days)"),console.log(`Inactivity penalty applied: ${h} days since last activity`);return}}let a=null,l=null;for(let u=0;u<10;u++){const h=new Date;h.setDate(h.getDate()-u);const f=h.toDateString(),p=await $e(he(this.db,`users/${this.userUID}/profile/daily/${f}/logged`));if(p.exists()&&p.val()){a=u,l=h;break}}if(a===null||a>=7)if(l){const u=Math.floor((r-l)/864e5);u>=7&&i>=7&&(await this.updateStat("motivation",-3,"Long period inactive (7+ days)"),console.log(`Inactivity penalty applied: ${u} days since last activity`))}else i>=7&&(await this.updateStat("motivation",1,"Long period inactive (7+ days)"),console.log(`Inactivity penalty applied: ${i} days since registration with no activity`))}catch(e){console.error("Error checking inactivity penalty:",e)}}async trackAppUsageDuringCravings(){try{const t=`appUsage_${new Date().toDateString()}`,r=await $e(he(this.db,`users/${this.userUID}/profile/daily/${t}`));let s=r.exists()?r.val():0;s++,await Xe(he(this.db,`users/${this.userUID}/profile/daily/${t}`),s),s===3&&await this.updateStat("mentalStrength",1,"Using app during cravings (3 times, no relapse)")}catch(e){console.error("Error tracking app usage during cravings:",e)}}async logBehavior(e,t,r){try{const s={timestamp:Date.now(),statName:e,change:t,reason:r,date:new Date().toISOString()};await y4(he(this.db,`users/${this.userUID}/behaviorLog`),s)}catch(s){console.error("Error logging behavior:",s)}}showStatNotification(e,t,r){const s=document.createElement("div");s.className=`fixed top-20 right-4 z-50 p-4 rounded-lg shadow-lg transition-all duration-500 transform translate-x-full ${t>0?"bg-green-500 text-white":"bg-red-500 text-white"}`,s.innerHTML=`
      <div class="flex items-center gap-2">
        <span class="text-lg">${t>0?"↗":"↘"}</span>
        <span class="font-bold">${e}</span>
        <span class="text-xl">${t>0?"+":""}${t}</span>
      </div>
      <div class="text-sm opacity-90">${r}</div>
    `,document.body.appendChild(s),setTimeout(()=>{s.classList.remove("translate-x-full")},100),setTimeout(()=>{s.classList.add("translate-x-full"),setTimeout(()=>{s.parentNode&&s.parentNode.removeChild(s)},500)},3e3)}async runDailyUpdates(){try{const e=await $e(he(this.db,`users/${this.userUID}`));if(!e.exists())return;const t=e.val(),r=new Date,s=t.createdAt?new Date(t.createdAt):t.quitStartDate?new Date(t.quitStartDate):r;if(Math.floor((r-s)/(1e3*60*60*24))<1)return;await Promise.all([this.updateAddictionFromCleanTime(),this.checkMilestoneBonuses(),this.checkInactivityPenalty()])}catch(e){console.error("Error running daily updates:",e)}}async initialize(){try{await this.ensureActivityTrackingInitialized(),setInterval(()=>{this.runDailyUpdates()},24*60*60*1e3),await this.runDailyUpdates()}catch(e){console.error("Error initializing StatManager:",e)}}async ensureActivityTrackingInitialized(){try{const e=await $e(he(this.db,`users/${this.userUID}/profile/lastActivity`)),t=await $e(he(this.db,`users/${this.userUID}/createdAt`));if(!e.exists()){const i=new Date;await Xe(he(this.db,`users/${this.userUID}/profile/lastActivity`),i.toISOString()),console.log("Initialized lastActivity timestamp for new user")}if(!t.exists()){const i=new Date;await Xe(he(this.db,`users/${this.userUID}/createdAt`),i.toISOString()),console.log("Initialized createdAt timestamp for new user");return}const r=new Date().toDateString();(await $e(he(this.db,`users/${this.userUID}/profile/daily/${r}/logged`))).exists()||(await Xe(he(this.db,`users/${this.userUID}/profile/daily/${r}/logged`),!0),console.log("Initialized today's activity tracking for new user"))}catch(e){console.error("Error ensuring activity tracking initialization:",e)}}async checkDailyCravingResistanceLimits(e){try{const t=await $e(he(this.db,`users/${this.userUID}/profile/daily/${e}/cravingResistanceStats`));if(!t.exists())return await Xe(he(this.db,`users/${this.userUID}/profile/daily/${e}/cravingResistanceStats`),{mentalStrength:0,triggerDefense:0}),{canAwardMentalStrength:!0,canAwardTriggerDefense:!0};const r=t.val(),s=r.mentalStrength||0,i=r.triggerDefense||0;return{canAwardMentalStrength:s<3,canAwardTriggerDefense:i<5}}catch(t){return console.error("Error checking daily craving resistance limits:",t),{canAwardMentalStrength:!0,canAwardTriggerDefense:!0}}}async logDailyCravingResistance(e,t){try{const r=await $e(he(this.db,`users/${this.userUID}/profile/daily/${e}/cravingResistanceStats`));r.exists()||await Xe(he(this.db,`users/${this.userUID}/profile/daily/${e}/cravingResistanceStats`),{mentalStrength:0,triggerDefense:0});const s=r.val(),i=s.mentalStrength||0,o=s.triggerDefense||0,a=t.canAwardMentalStrength?1:0,l=t.canAwardTriggerDefense?3:0;await Xe(he(this.db,`users/${this.userUID}/profile/daily/${e}/cravingResistanceStats`),{mentalStrength:Math.min(3,i+a),triggerDefense:Math.min(5,o+l)})}catch(r){console.error("Error logging daily craving resistance:",r)}}async getDailyCravingResistanceStats(e=null){try{const t=e||new Date().toDateString(),r=await $e(he(this.db,`users/${this.userUID}/profile/daily/${t}/cravingResistanceStats`));if(!r.exists())return{mentalStrength:0,triggerDefense:0,mentalStrengthLimit:3,triggerDefenseLimit:5,mentalStrengthRemaining:3,triggerDefenseRemaining:5};const s=r.val(),i=s.mentalStrength||0,o=s.triggerDefense||0;return{mentalStrength:i,triggerDefense:o,mentalStrengthLimit:3,triggerDefenseLimit:5,mentalStrengthRemaining:Math.max(0,3-i),triggerDefenseRemaining:Math.max(0,5-o)}}catch(t){return console.error("Error getting daily craving resistance stats:",t),{mentalStrength:0,triggerDefense:0,mentalStrengthLimit:3,triggerDefenseLimit:5,mentalStrengthRemaining:3,triggerDefenseRemaining:5}}}async checkDailyCravingLoggingLimits(e){try{const t=await $e(he(this.db,`users/${this.userUID}/profile/daily/${e}/cravingLoggingStats`));if(!t.exists())return await Xe(he(this.db,`users/${this.userUID}/profile/daily/${e}/cravingLoggingStats`),{motivation:0,triggerDefense:0}),{canAwardMotivation:!0,canAwardTriggerDefense:!0};const r=t.val(),s=r.motivation||0,i=r.triggerDefense||0;return{canAwardMotivation:s<.5,canAwardTriggerDefense:i<.5}}catch(t){return console.error("Error checking daily craving logging limits:",t),{canAwardMotivation:!0,canAwardTriggerDefense:!0}}}async logDailyCravingLogging(e,t){try{const r=await $e(he(this.db,`users/${this.userUID}/profile/daily/${e}/cravingLoggingStats`));r.exists()||await Xe(he(this.db,`users/${this.userUID}/profile/daily/${e}/cravingLoggingStats`),{motivation:0,triggerDefense:0});const s=r.val(),i=s.motivation||0,o=s.triggerDefense||0,a=t.canAwardMotivation?.25:0,l=t.canAwardTriggerDefense?.25:0;await Xe(he(this.db,`users/${this.userUID}/profile/daily/${e}/cravingLoggingStats`),{motivation:Math.min(.5,i+a),triggerDefense:Math.min(.5,o+l)})}catch(r){console.error("Error logging daily craving logging:",r)}}async getDailyCravingLoggingStats(e=null){try{const t=e||new Date().toDateString(),r=await $e(he(this.db,`users/${this.userUID}/profile/daily/${t}/cravingLoggingStats`));if(!r.exists())return{motivation:0,triggerDefense:0,motivationLimit:.5,triggerDefenseLimit:.5,motivationRemaining:.5,triggerDefenseRemaining:.5};const s=r.val(),i=s.motivation||0,o=s.triggerDefense||0;return{motivation:i,triggerDefense:o,motivationLimit:.5,triggerDefenseLimit:.5,motivationRemaining:Math.max(0,.5-i),triggerDefenseRemaining:Math.max(0,.5-o)}}catch(t){return console.error("Error getting daily craving logging stats:",t),{motivation:0,triggerDefense:0,motivationLimit:.5,triggerDefenseLimit:.5,motivationRemaining:.5,triggerDefenseRemaining:.5}}}}const Y9=Object.freeze(Object.defineProperty({__proto__:null,default:zm},Symbol.toStringTag,{value:"Module"}));class ec{constructor(e){if(!e)throw new Error("Firestore instance is required for FirestoreBuddyService");this.firestore=e,this.matchingPoolCollection=Jr(e,"matchingPool"),this.buddyPairsCollection=Jr(e,"buddyPairs"),console.log("🚀 FirestoreBuddyService initialized with Firestore instance:",!!e),console.log("📁 Collections configured:",{matchingPool:this.matchingPoolCollection.path,buddyPairs:this.buddyPairsCollection.path})}async addToMatchingPool(e,t){try{console.log("🔄 Firestore: Adding user to matching pool:",e);const r={userId:e,...t,createdAt:ip(),lastActive:ip(),status:"waiting"};return await mU(rp(this.matchingPoolCollection,e),r),console.log("✅ Firestore: User successfully added to matching pool:",e),!0}catch(r){return console.error("❌ Firestore: Failed to add user to matching pool:",r),console.error("❌ Error details:",{code:r.code,message:r.message,userId:e,userData:Object.keys(t||{})}),!1}}async removeFromMatchingPool(e){try{return console.log("🔄 Firestore: Removing user from matching pool:",e),await yU(rp(this.matchingPoolCollection,e)),console.log("✅ Firestore: User successfully removed from matching pool:",e),!0}catch(t){return console.error("❌ Firestore: Failed to remove user from matching pool:",t),console.error("❌ Error details:",{code:t.code,message:t.message,userId:e}),!1}}async createBuddyPair(e,t,r={}){try{console.log("🔄 Firestore: Creating buddy pair:",{user1Id:e,user2Id:t});const s={user1Id:e,user2Id:t,createdAt:ip(),status:"active",...r},i=await oi(this.buddyPairsCollection,s);return console.log("✅ Firestore: Buddy pair created successfully:",i.id),i.id}catch(s){return console.error("❌ Firestore: Failed to create buddy pair:",s),console.error("❌ Error details:",{code:s.code,message:s.message,user1Id:e,user2Id:t}),null}}async getAllMatchingPoolUsers(){try{console.log("🔄 Firestore: Fetching all matching pool users");const e=await od(this.matchingPoolCollection),t=[];return e.forEach(r=>{t.push({id:r.id,...r.data()})}),console.log("✅ Firestore: Retrieved",t.length,"users from matching pool"),t}catch(e){return console.error("❌ Firestore: Failed to fetch matching pool users:",e),console.error("❌ Error details:",{code:e.code,message:e.message}),[]}}async getMatchingPoolUser(e){try{console.log("🔄 Firestore: Fetching user from matching pool:",e);const t=rp(this.matchingPoolCollection,e),r=await gU(t);if(r.exists()){const s={id:r.id,...r.data()};return console.log("✅ Firestore: User found in matching pool:",e),s}else return console.log("ℹ️ Firestore: User not found in matching pool:",e),null}catch(t){return console.error("❌ Firestore: Failed to fetch user from matching pool:",t),console.error("❌ Error details:",{code:t.code,message:t.message,userId:e}),null}}async getUserBuddyPair(e){try{console.log("🔄 Firestore: Getting buddy pair for user:",e);const t=Vl(this.buddyPairsCollection,Fl("user1Id","==",e)),r=Vl(this.buddyPairsCollection,Fl("user2Id","==",e)),[s,i]=await Promise.all([od(t),od(r)]);let o=null;if(s.empty?i.empty||(o=i.docs[0]):o=s.docs[0],o){const a=o.data();return console.log("✅ Firestore: Found buddy pair:",o.id),{id:o.id,...a}}else return console.log("ℹ️ Firestore: No buddy pair found for user"),null}catch(t){return console.error("❌ Firestore: Error getting buddy pair:",t),null}}async testConnectivity(){try{return console.log("🧪 Firestore: Testing connectivity..."),this.firestore&&typeof this.firestore.app<"u"?(console.log("✅ Firestore: Service available and initialized"),!0):(console.warn("⚠️ Firestore: Service not properly initialized"),!1)}catch(e){return console.warn("⚠️ Firestore: Connectivity check failed (non-critical):",(e==null?void 0:e.message)||e),!1}}getServiceStatus(){var e,t;return{firestore:!!this.firestore,matchingPoolCollection:((e=this.matchingPoolCollection)==null?void 0:e.path)||"not configured",buddyPairsCollection:((t=this.buddyPairsCollection)==null?void 0:t.path)||"not configured",timestamp:new Date().toISOString()}}}class UD{constructor(e){this.firestore=e,this.collections={cravings:"behavioral_cravings",relapses:"behavioral_relapses",hydration:"behavioral_hydration",breathing:"behavioral_breathing",meditation:"behavioral_meditation",physicalActivity:"behavioral_physical_activity",moodTracking:"behavioral_mood",stressLevels:"behavioral_stress",sleepTracking:"behavioral_sleep",socialTriggers:"behavioral_social_triggers",environmentalFactors:"behavioral_environmental"},console.log("🚀 FirestoreBehavioralService initialized for predictive analytics")}async logCraving(e,t){try{const r={userId:e,timestamp:Ze.now(),date:new Date().toISOString().split("T")[0],outcome:t.outcome,strength:t.strength||0,duration:t.duration||null,context:t.context||"unknown",triggers:t.triggers||[],location:t.location||null,mood:t.mood||null,stressLevel:t.stressLevel||null,copingStrategiesUsed:t.copingStrategiesUsed||[],helpfulStrategies:t.helpfulStrategies||[],socialSituation:t.socialSituation||null,timeOfDay:new Date().getHours(),dayOfWeek:new Date().getDay(),appVersion:"1.0.0",deviceType:navigator.userAgent.includes("Mobile")?"mobile":"desktop"},s=await oi(Jr(this.firestore,this.collections.cravings),r);return console.log("✅ Craving logged to Firestore for analytics:",s.id),s.id}catch(r){throw console.error("❌ Error logging craving to Firestore:",r),r}}async logRelapse(e,t){try{const r={userId:e,timestamp:Ze.now(),date:new Date().toISOString().split("T")[0],escalationLevel:t.escalationLevel||1,daysSinceLastRelapse:t.daysSinceLastRelapse||0,triggers:t.triggers||[],mood:t.mood||null,stressLevel:t.stressLevel||null,location:t.location||null,socialSituation:t.socialSituation||null,timeToRelapse:t.timeToRelapse||null,copingAttempts:t.copingAttempts||[],addictionIncrease:t.addictionIncrease||0,mentalStrengthDecrease:t.mentalStrengthDecrease||0,triggerDefenseDecrease:t.triggerDefenseDecrease||0,timeOfDay:new Date().getHours(),dayOfWeek:new Date().getDay()},s=await oi(Jr(this.firestore,this.collections.relapses),r);return console.log("✅ Relapse logged to Firestore for analytics:",s.id),s.id}catch(r){throw console.error("❌ Error logging relapse to Firestore:",r),r}}async logHydration(e,t){try{const r={userId:e,timestamp:Ze.now(),date:new Date().toISOString().split("T")[0],glassesConsumed:t.glassesConsumed||0,targetGlasses:t.targetGlasses||6,achievedTarget:(t.glassesConsumed||0)>=(t.targetGlasses||6),timeOfDay:new Date().getHours(),loggedAt:new Date().toISOString(),currentStreak:t.currentStreak||0,mood:t.mood||null,energyLevel:t.energyLevel||null},s=await oi(Jr(this.firestore,this.collections.hydration),r);return console.log("✅ Hydration logged to Firestore for analytics:",s.id),s.id}catch(r){throw console.error("❌ Error logging hydration to Firestore:",r),r}}async logBreathingExercise(e,t){try{const r={userId:e,timestamp:Ze.now(),date:new Date().toISOString().split("T")[0],duration:t.duration||0,breathingRate:t.breathingRate||null,completed:t.completed||!0,triggerContext:t.triggerContext||null,moodBefore:t.moodBefore||null,moodAfter:t.moodAfter||null,stressLevelBefore:t.stressLevelBefore||null,stressLevelAfter:t.stressLevelAfter||null,helpfulness:t.helpfulness||null,timeOfDay:new Date().getHours(),currentStreak:t.currentStreak||0},s=await oi(Jr(this.firestore,this.collections.breathing),r);return console.log("✅ Breathing exercise logged to Firestore for analytics:",s.id),s.id}catch(r){throw console.error("❌ Error logging breathing exercise to Firestore:",r),r}}async logMeditation(e,t){try{const r={userId:e,timestamp:Ze.now(),date:new Date().toISOString().split("T")[0],duration:t.duration||0,type:t.type||"mindfulness",completed:t.completed||!0,triggerContext:t.triggerContext||null,moodBefore:t.moodBefore||null,moodAfter:t.moodAfter||null,stressLevelBefore:t.stressLevelBefore||null,stressLevelAfter:t.stressLevelAfter||null,helpfulness:t.helpfulness||null,timeOfDay:new Date().getHours()},s=await oi(Jr(this.firestore,this.collections.meditation),r);return console.log("✅ Meditation logged to Firestore for analytics:",s.id),s.id}catch(r){throw console.error("❌ Error logging meditation to Firestore:",r),r}}async logPhysicalActivity(e,t){try{const r={userId:e,timestamp:Ze.now(),date:new Date().toISOString().split("T")[0],type:t.type||"walk",duration:t.duration||0,intensity:t.intensity||"moderate",completed:t.completed||!0,triggerContext:t.triggerContext||null,moodBefore:t.moodBefore||null,moodAfter:t.moodAfter||null,energyBefore:t.energyBefore||null,energyAfter:t.energyAfter||null,helpfulness:t.helpfulness||null,cravingReduction:t.cravingReduction||null,timeOfDay:new Date().getHours(),location:t.location||null},s=await oi(Jr(this.firestore,this.collections.physicalActivity),r);return console.log("✅ Physical activity logged to Firestore for analytics:",s.id),s.id}catch(r){throw console.error("❌ Error logging physical activity to Firestore:",r),r}}async logMood(e,t){try{const r={userId:e,timestamp:Ze.now(),date:new Date().toISOString().split("T")[0],mood:t.mood,intensity:t.intensity||5,triggers:t.triggers||[],activities:t.activities||[],socialContext:t.socialContext||null,timeOfDay:new Date().getHours(),copingStrategiesUsed:t.copingStrategiesUsed||[]},s=await oi(Jr(this.firestore,this.collections.moodTracking),r);return console.log("✅ Mood logged to Firestore for analytics:",s.id),s.id}catch(r){throw console.error("❌ Error logging mood to Firestore:",r),r}}async getUserBehavioralData(e,t,r=null,s=null){try{if(!this.collections[t])throw new Error(`Unknown data type: ${t}`);let i=Vl(Jr(this.firestore,this.collections[t]),Fl("userId","==",e),hU("timestamp","desc"));r&&(i=Vl(i,Fl("timestamp",">=",Ze.fromDate(new Date(r))))),s&&(i=Vl(i,Fl("timestamp","<=",Ze.fromDate(new Date(s)))));const o=await od(i),a=[];return o.forEach(l=>{var u;a.push({id:l.id,...l.data(),timestamp:((u=l.data().timestamp)==null?void 0:u.toDate())||new Date})}),console.log(`✅ Retrieved ${a.length} ${t} records for analytics`),a}catch(i){throw console.error(`❌ Error retrieving ${t} data:`,i),i}}async getUserAnalytics(e,t=30){try{const r=new Date,s=new Date;s.setDate(s.getDate()-t),console.log(`📊 Generating behavioral analytics for user ${e} (last ${t} days)`);const[i,o,a,l,u,h,f]=await Promise.all([this.getUserBehavioralData(e,"cravings",s,r).catch(y=>(console.warn("⚠️ Cravings data not available yet (indexes building):",y.message),[])),this.getUserBehavioralData(e,"relapses",s,r).catch(y=>(console.warn("⚠️ Relapses data not available yet (indexes building):",y.message),[])),this.getUserBehavioralData(e,"hydration",s,r).catch(y=>(console.warn("⚠️ Hydration data not available yet (indexes building):",y.message),[])),this.getUserBehavioralData(e,"breathing",s,r).catch(y=>(console.warn("⚠️ Breathing data not available yet (indexes building):",y.message),[])),this.getUserBehavioralData(e,"meditation",s,r).catch(y=>(console.warn("⚠️ Meditation data not available yet (indexes building):",y.message),[])),this.getUserBehavioralData(e,"physicalActivity",s,r).catch(y=>(console.warn("⚠️ Physical activity data not available yet (indexes building):",y.message),[])),this.getUserBehavioralData(e,"moodTracking",s,r).catch(y=>(console.warn("⚠️ Mood data not available yet (indexes building):",y.message),[]))]),p={userId:e,period:{startDate:s,endDate:r,days:t},cravingStats:{total:i.length,resisted:i.filter(y=>y.outcome==="resisted").length,relapsed:i.filter(y=>y.outcome==="relapsed").length,averageStrength:i.length>0?i.reduce((y,w)=>y+(w.strength||0),0)/i.length:0,commonTriggers:this.getCommonTriggers(i),timePatterns:this.getTimePatterns(i)},relapseStats:{total:o.length,averageEscalationLevel:o.length>0?o.reduce((y,w)=>y+(w.escalationLevel||1),0)/o.length:0,commonTriggers:this.getCommonTriggers(o),recoveryTimes:o.map(y=>y.daysSinceLastRelapse||0)},wellnessStats:{hydrationDays:a.filter(y=>y.achievedTarget).length,breathingExercises:l.length,meditationSessions:u.length,physicalActivities:h.length,totalWellnessActivities:l.length+u.length+h.length},moodStats:{entries:f.length,averageMood:f.length>0?f.reduce((y,w)=>y+(w.intensity||5),0)/f.length:5,moodTrends:this.getMoodTrends(f)},insights:this.generateInsights(i,o,a,l,u,h,f),generatedAt:new Date};return console.log("📊 Behavioral analytics generated:",p),p}catch(r){throw console.error("❌ Error generating user analytics:",r),r}}getCommonTriggers(e){const t={};return e.forEach(r=>{r.triggers&&Array.isArray(r.triggers)&&r.triggers.forEach(s=>{t[s]=(t[s]||0)+1})}),Object.entries(t).sort(([,r],[,s])=>s-r).slice(0,5).map(([r,s])=>({trigger:r,count:s}))}getTimePatterns(e){const t={};return e.forEach(r=>{const s=r.timeOfDay||new Date(r.timestamp).getHours();t[s]=(t[s]||0)+1}),Object.entries(t).sort(([,r],[,s])=>s-r).slice(0,3).map(([r,s])=>({hour:parseInt(r),count:s}))}getMoodTrends(e){if(e.length<2)return[];const t=e.sort((s,i)=>new Date(s.timestamp)-new Date(i.timestamp)),r=[];for(let s=1;s<t.length;s++){const i=t[s],o=t[s-1],a=(i.intensity||5)-(o.intensity||5);Math.abs(a)>=2&&r.push({date:i.date,change:a,direction:a>0?"improved":"declined",from:o.mood,to:i.mood})}return r.slice(-5)}generateInsights(e,t,r,s,i,o,a){const l=[],u=e.filter(y=>y.outcome==="resisted").length,h=e.length;if(h>0){const y=u/h*100;l.push(`Craving resistance rate: ${y.toFixed(1)}%`)}const f=s.length+i.length+o.length;f>0&&t.length>0&&l.push(`${f} wellness activities vs ${t.length} relapses - wellness correlation analysis available`);const p=r.filter(y=>y.achievedTarget).length;return p>0&&l.push(`Achieved hydration target on ${p} days`),l}async migrateUserData(e,t){try{console.log(`🔄 Starting data migration for user ${e} from Realtime DB to Firestore...`);const{ref:r,get:s}=await ke(()=>import("./index.esm-25d69fbc.js"),[]),i=r(t,`users/${e}/cravings`),o=await s(i);if(o.exists()){const a=o.val();let l=0;for(const[u,h]of Object.entries(a))try{const f={userId:e,timestamp:h.timestamp?Ze.fromDate(new Date(h.timestamp)):ip(),date:h.date||new Date().toISOString().split("T")[0],outcome:h.outcome||"unknown",strength:h.strength||0,context:h.context||"migrated",mood:h.mood||null,triggers:[],timeOfDay:h.timestamp?new Date(h.timestamp).getHours():12,dayOfWeek:h.timestamp?new Date(h.timestamp).getDay():0,migrated:!0,originalId:u};await oi(Jr(this.firestore,this.collections.cravings),f),l++}catch(f){console.error(`❌ Error migrating craving ${u}:`,f)}console.log(`✅ Migrated ${l} cravings to Firestore`)}return console.log(`✅ Data migration completed for user ${e}`),!0}catch(r){throw console.error("❌ Error during data migration:",r),r}}async testConnectivity(){try{return console.log("🧪 FirestoreBehavioralService: Testing connectivity..."),this.firestore&&typeof this.firestore.app<"u"?(console.log("✅ FirestoreBehavioralService: Ready for behavioral data logging"),!0):(console.warn("⚠️ FirestoreBehavioralService: Not properly initialized"),!1)}catch(e){return console.warn("⚠️ FirestoreBehavioralService: Connectivity test failed:",(e==null?void 0:e.message)||e),!1}}async getBasicAnalytics(e){try{console.log(`📊 Getting basic analytics for user ${e} (no indexes required)`);const t=["behavioral_cravings","behavioral_relapses","behavioral_hydration","behavioral_breathing","behavioral_meditation","behavioral_physical_activity"],r={};for(const s of t)try{const i=Vl(Jr(this.db,s),Fl("userId","==",e)),o=await od(i);r[s]=o.size}catch(i){console.warn(`⚠️ Could not get count for ${s}:`,i.message),r[s]=0}return{userId:e,cravingStats:{total:r.behavioral_cravings||0,resisted:Math.max(0,r.behavioral_cravings-r.behavioral_relapses),averageStrength:5,commonTriggers:[],timePatterns:[]},relapseStats:{total:r.behavioral_relapses||0},wellnessStats:{breathingExercises:r.behavioral_breathing||0,meditationSessions:r.behavioral_meditation||0,physicalActivities:r.behavioral_physical_activity||0,hydrationDays:r.behavioral_hydration||0,totalWellnessActivities:(r.behavioral_breathing||0)+(r.behavioral_meditation||0)+(r.behavioral_physical_activity||0)},insights:["Analytics dashboard is ready for behavioral tracking!","Indexes are being built for advanced analytics.","Start logging activities to see detailed insights."]}}catch(t){throw console.error("❌ Error generating basic analytics:",t),t}}}const w7=Object.freeze(Object.defineProperty({__proto__:null,default:UD},Symbol.toStringTag,{value:"Module"}));class Db{constructor(e,t,r=null){this.db=e,this.userId=t,this.authGuard=r,this.statsRef=he(e,`users/${t}/stats`),this.profileRef=he(e,`users/${t}/profile`),this.listeners=[]}async refreshAllStats(){try{let e,t,r;if(this.authGuard)[e,t,r]=await Promise.all([this.authGuard.databaseGet(`users/${this.userId}/profile`),this.authGuard.databaseGet(`users/${this.userId}/stats`),this.authGuard.databaseGet(`users/${this.userId}`)]);else{const[k,E,x]=await Promise.all([$e(this.profileRef),$e(this.statsRef),$e(he(this.db,`users/${this.userId}`))]);e=k.exists()?k.val():{},t=E.exists()?E.val():{},r=x.exists()?x.val():{}}const s={...e,createdAt:e.createdAt||r.createdAt||null,quitDate:e.quitDate||r.quitDate||r.quitStartDate||null,lastQuitDate:e.lastQuitDate||r.lastQuitDate||null};if(!s.lastRelapseDate&&!s.quitDate&&s.createdAt)try{await Xe(he(this.db,`users/${this.userId}/profile/quitDate`),s.createdAt),s.quitDate=s.createdAt,console.log(`📊 CentralizedStats: Seeded missing quitDate with createdAt for ${this.userId}: ${s.createdAt}`)}catch(k){console.warn(`⚠️ CentralizedStats: Could not seed quitDate for ${this.userId}:`,k.message)}const i=t||this.getDefaultStats(),o=this.calculateEffectiveQuitDate(s),a=this.calculateStreakFromRelapse(s),l=await this.calculateCravingsResisted(),u=await this.calculateAddictionLevel(s,o),h=this.calculateMentalStrength(i,l),f=h.strength,p=h.cravingsApplied,y=await this.checkMilestonesFromRelapse(s,i),w=await this.generateSpecialFeatures(s),S={...i,...y,streakDays:a.value,streakUnit:a.unit,streakDisplayText:a.displayText,cravingsResisted:l,addictionLevel:u,mentalStrength:f,mentalStrengthCravingsApplied:p,specialFeatures:w,lastUpdated:new Date().toISOString()};return this.authGuard?await this.authGuard.databaseSet(`users/${this.userId}/stats`,S):await Xe(this.statsRef,S),console.log(`✅ CentralizedStats: Stats updated in Firebase for ${this.userId}:`,{streak:a.displayText,cravingsResisted:l,addictionLevel:u,mentalStrength:f,specialFeatures:(w==null?void 0:w.length)||0,effectiveQuitDate:o}),S}catch(e){throw console.error(`❌ CentralizedStats: Error refreshing stats for ${this.userId}:`,e),e}}calculateEffectiveQuitDate(e){const t=e.quitDate||null;if(e.lastRelapseDate){const r=new Date(e.lastRelapseDate),s=new Date(t),i=r>s?e.lastRelapseDate:t;return console.log(`📊 CentralizedStats: Effective quit date for ${this.userId}: ${i} (original: ${t}, lastRelapse: ${e.lastRelapseDate})`),i}return console.log(`📊 CentralizedStats: Using base quit date for ${this.userId}: ${t}`),t}calculateStreak(e){const t=new Date,r=new Date(e),s=t-r,i=Math.floor(s/(1e3*60*60)),o=Math.floor(i/24);return o>=1?{value:o,unit:"days",displayText:`${o} day${o===1?"":"s"}`}:{value:i,unit:"hours",displayText:`${i} hour${i===1?"":"s"}`}}calculateStreakFromRelapse(e){const t=new Date,r=e.lastRelapseDate;if(!r){const l=e.lastQuitDate||e.originalQuitDate||e.quitDate||e.createdAt||null;return console.log(`📊 CentralizedStats: No relapse date found for ${this.userId}, using quit date: ${l}`),l?this.calculateStreak(l):{value:0,unit:"hours",displayText:"0 hours",streakDays:0}}const s=new Date(r),i=t-s,o=Math.floor(i/(1e3*60*60)),a=Math.floor(o/24);return o<24?{value:o,unit:"hours",displayText:`${o} hour${o===1?"":"s"}`,streakDays:0}:{value:a,unit:"days",displayText:`${a} day${a===1?"":"s"}`,streakDays:a}}async calculateCravingsResisted(){try{const[e,t]=await Promise.all([$e(he(this.db,`users/${this.userId}/profile/cravingsResisted`)),$e(he(this.db,`users/${this.userId}/cravings`))]);let r=0;if(e.exists())r=Math.max(0,parseInt(e.val())||0),console.log(`📊 CentralizedStats: Found cravings in profile: ${r}`);else if(t.exists()){const s=t.val();r=Object.values(s).filter(i=>i.outcome==="resisted").length}return r}catch(e){return console.warn(`⚠️ CentralizedStats: Could not get cravings for ${this.userId}:`,e.message),0}}calculateMentalStrength(e,t){try{const r=e.mentalStrength||50,s=e.mentalStrengthCravingsApplied||0;return{strength:r,cravingsApplied:s}}catch(r){return console.warn(`⚠️ CentralizedStats: Could not calculate mental strength for ${this.userId}:`,r.message),{strength:e.mentalStrength||50,cravingsApplied:e.mentalStrengthCravingsApplied||0}}}async calculateAddictionLevel(e,t){try{const[r,s,i]=await Promise.all([$e(this.statsRef),$e(he(this.db,`users/${this.userId}/profile/lastRelapseDate`)),$e(he(this.db,`users/${this.userId}/profile/relapseEscalationLevel`))]);let o=50;if(r.exists()&&(o=r.val().addictionLevel||50),!s.exists())return console.log(`📊 CentralizedStats: No relapses found, returning base addiction: ${o}`),o;const a=new Date(s.val()),u=Math.floor((new Date-a)/(1e3*60*60*24)),h=i.exists()?i.val():1;console.log(`📊 CentralizedStats: Last relapse: ${a.toISOString()}`),console.log(`📊 CentralizedStats: Days since last relapse: ${u}`),console.log(`📊 CentralizedStats: Current escalation level: ${h}`);let f=1;u>=7?(f=1,await Xe(he(this.db,`users/${this.userId}/profile/relapseEscalationLevel`),1)):f=h;const p=Math.floor(u/7),y=p*2;let w=Math.max(30,o-y);return console.log(`📊 CentralizedStats: Base addiction: ${o}, Weeks clean: ${p}, Decay: -${y}, Final: ${w}`),w}catch(r){return console.error("❌ CentralizedStats: Error calculating addiction level:",r),50}}async checkMilestones(e,t){try{const r=new Date,s=new Date(e),i=Math.floor((r-s)/(1e3*60*60*24));console.log(`📊 CentralizedStats: Checking milestones for ${this.userId}, clean days: ${i}`);const o=[{days:7,bonus:5,name:"First week",key:"milestone_7"},{days:30,bonus:10,name:"First month",key:"milestone_30"},{days:90,bonus:15,name:"Three months",key:"milestone_90"}];let a={},l=!1;for(const u of o)if(i>=u.days){const h=he(this.db,`users/${this.userId}/profile/milestones/${u.key}`);if(!(await $e(h)).exists()){const p=Math.min(100,(t.mentalStrength||50)+u.bonus);a.mentalStrength=p,l=!0,await Xe(h,{achieved:!0,achievedDate:new Date().toISOString(),bonus:u.bonus,cleanDaysAtAchievement:i}),console.log(`🎉 CentralizedStats: Milestone achieved for ${this.userId}! ${u.name} (+${u.bonus} Mental Strength)`),this.showMilestoneNotification(u,i);break}}return a}catch(r){return console.error(`❌ CentralizedStats: Error checking milestones for ${this.userId}:`,r),{}}}async checkMilestonesFromRelapse(e,t){try{const r=new Date,s=e.lastRelapseDate;if(!s)return console.log(`📊 CentralizedStats: No relapse date found for ${this.userId}, skipping milestones`),{};const i=new Date(s),o=Math.floor((r-i)/(1e3*60*60*24));console.log(`📊 CentralizedStats: Checking milestones for ${this.userId}, clean days since relapse: ${o}`);const a=[{days:7,bonus:5,name:"First week",key:"milestone_7"},{days:30,bonus:10,name:"First month",key:"milestone_30"},{days:90,bonus:15,name:"Three months",key:"milestone_90"}];let l={},u=!1;for(const h of a)if(o>=h.days){const f=he(this.db,`users/${this.userId}/profile/milestones/${h.key}`);if(!(await $e(f)).exists()){const y=Math.min(100,(t.mentalStrength||50)+h.bonus);l.mentalStrength=y,u=!0,await Xe(f,{achieved:!0,achievedDate:new Date().toISOString(),bonus:h.bonus,cleanDaysAtAchievement:o}),console.log(`🎉 CentralizedStats: Milestone achieved for ${this.userId}! ${h.name} (+${h.bonus} Mental Strength)`),this.showMilestoneNotification(h,o);break}}return l}catch(r){return console.error(`❌ CentralizedStats: Error checking milestones from relapse for ${this.userId}:`,r),{}}}async generateSpecialFeatures(e){try{const t=await $e(he(this.db,`users/${this.userId}/specialFeatures`));if(t.exists()){const h=t.val();if(Array.isArray(h)&&h.length>0)return console.log(`📊 CentralizedStats: Using existing Special Features for ${this.userId}:`,h),h}let r=e.triggers||[],s=e.dailyPatterns||[],i=e.copingStrategies||[];if(r.length===0||s.length===0||i.length===0)try{const h=await $e(he(this.db,`users/${this.userId}`));if(h.exists()){const f=h.val();r=r.length>0?r:f.triggers||[],s=s.length>0?s:f.dailyPatterns||[],i=i.length>0?i:f.copingStrategies||[],console.log(`📊 CentralizedStats: Found onboarding data for ${this.userId}:`,{triggers:r.length,dailyPatterns:s.length,copingStrategies:i.length})}}catch(h){console.warn(`⚠️ CentralizedStats: Could not read user onboarding data for ${this.userId}:`,h.message)}const o=[],a={triggers:["Stress Vaper","Social Smoker","Coffee Companion","Work Breaker","Gaming Buddy","Party Animal","Peer Pressure","Celebration Trigger","Anxiety Soother","Focus Enhancer","Boredom Fighter","Emotional Support"],dailyPatterns:["Night Owl","Morning Struggler","Weekend Warrior","Routine Builder","Habit Former","Work Breaker","Coffee Companion","Party Animal"],copingStrategies:["First Timer","Veteran Quitter","Cold Turkey","Gradual Reduction","Stress Reliever","Mood Stabilizer","Reward Seeker","Social Lubricant"]};console.log(`📊 CentralizedStats: Generating features from onboarding data for ${this.userId}:`,{triggers:r,dailyPatterns:s,copingStrategies:i}),r.includes("Stress/anxiety")&&o.push("Stress Vaper"),r.includes("Social situations")&&o.push("Social Smoker"),r.includes("Boredom")&&o.push("Boredom Fighter"),r.includes("After meals")&&o.push("Coffee Companion"),r.includes("Work breaks")&&o.push("Work Breaker"),s.includes("Evening wind-down")&&o.push("Night Owl"),s.includes("Morning routine")&&o.push("Morning Struggler"),s.includes("Social events")&&o.push("Party Animal"),s.includes("Work breaks")&&o.push("Work Breaker"),i.includes("Breathing exercises")&&o.push("Stress Reliever"),i.includes("Exercise/physical activity")&&o.push("Health Seeker"),i.includes("Nicotine replacement therapy")&&o.push("Veteran Quitter"),i.includes("Nothing - this is new to me")&&o.push("First Timer"),console.log(`📊 CentralizedStats: Generated ${o.length} personalized features:`,o);const l=["Freedom Chaser","Nicotine Fighter","Health Seeker","Willpower Warrior"];for(;o.length<4;){const h=l[Math.floor(Math.random()*l.length)];o.includes(h)||o.push(h)}const u=o.slice(0,4);return await Xe(he(this.db,`users/${this.userId}/specialFeatures`),u),console.log(`📊 CentralizedStats: Generated and stored Special Features for ${this.userId}:`,u),u}catch(t){return console.error(`❌ CentralizedStats: Error generating Special Features for ${this.userId}:`,t),["Freedom Chaser","Nicotine Fighter","Health Seeker","Willpower Warrior"]}}setupRealTimeListener(e){const t=PR(this.statsRef,r=>{if(r.exists()){const s=r.val();console.log(`🔄 CentralizedStats: Real-time update for ${this.userId}:`,s),e(s)}});return this.listeners.push(t),t}getDefaultStats(){return{mentalStrength:50,motivation:50,triggerDefense:30,addictionLevel:50,streakDays:0,streakUnit:"hours",streakDisplayText:"0 hours",cravingsResisted:0,experiencePoints:0}}showMilestoneNotification(e,t){try{if(typeof window<"u"&&window.showQuickActionPopup){const s={7:{title:"🎉 First Week Milestone!",message:`Congratulations! You've been clean for 7 days!

🧠 Mental Strength: +${e.bonus} points

You're building incredible willpower! Keep going! 💪`},30:{title:"🏆 One Month Champion!",message:`Amazing! You've reached 30 days clean!

🧠 Mental Strength: +${e.bonus} points

You're proving your strength every day! 🌟`},90:{title:"👑 Three Month Legend!",message:`Incredible! You've achieved 90 days clean!

🧠 Mental Strength: +${e.bonus} points

You're a true inspiration! 🎯✨`}}[e.days]||{title:"🎉 Milestone Achieved!",message:`You've reached ${t} days clean!

🧠 Mental Strength: +${e.bonus} points`};window.showQuickActionPopup(s.title,s.message,"success")}else console.log(`🎉 Milestone achieved: ${e.name} (+${e.bonus} Mental Strength)`)}catch(r){console.error("Error showing milestone notification:",r)}}async resetMilestones(){try{console.log(`🔄 CentralizedStats: Resetting milestones for ${this.userId} after relapse`);const e=he(this.db,`users/${this.userId}/profile/milestones`);await Xe(e,null),console.log(`✅ CentralizedStats: Milestones reset for ${this.userId} - can be earned again`)}catch(e){console.error(`❌ CentralizedStats: Error resetting milestones for ${this.userId}:`,e)}}cleanup(){this.listeners.forEach(e=>e()),this.listeners=[]}async handleRelapse(){try{console.log(`🔄 CentralizedStats: Handling relapse for ${this.userId}`);const e=new Date,t=e.toISOString(),[r,s,i]=await Promise.all([$e(he(this.db,`users/${this.userId}/profile/lastRelapseDate`)),$e(he(this.db,`users/${this.userId}/profile/relapseEscalationLevel`)),$e(this.statsRef)]);let o=1;if(r.exists()){const p=new Date(r.val()),y=Math.floor((e-p)/(1e3*60*60*24)),w=s.exists()?s.val():1;console.log(`🔄 CentralizedStats: Current escalation level: ${w}`),console.log(`🔄 CentralizedStats: Days since last relapse: ${y}`),y>=7?(o=1,console.log(`🔄 CentralizedStats: After 7+ days clean → escalation level reset to: ${o}`)):(o=w+1,console.log(`🔄 CentralizedStats: Within ${y} days → escalation level: ${w} + 1 = ${o}`))}let a=0;switch(o){case 1:a=4;break;case 2:a=6;break;default:a=8;break}console.log(`🔄 CentralizedStats: Escalation level ${o} → addiction increase: +${a}`);const l=i.exists()?i.val():this.getDefaultStats(),u=Math.max(0,Math.min(100,(l.addictionLevel||50)+a)),h=Math.max(0,Math.min(100,(l.mentalStrength||50)-3)),f=Math.max(0,Math.min(100,(l.triggerDefense||30)-3));console.log(`🔄 CentralizedStats: addictionLevel change: ${l.addictionLevel} → ${u} (+${a})`),console.log(`🔄 CentralizedStats: mentalStrength change: ${l.mentalStrength} → ${h} (-3)`),console.log(`🔄 CentralizedStats: triggerDefense change: ${l.triggerDefense} → ${f} (-3)`),await Promise.all([Xe(he(this.db,`users/${this.userId}/profile/lastRelapseDate`),t),Xe(he(this.db,`users/${this.userId}/profile/relapseDate`),t),Xe(he(this.db,`users/${this.userId}/profile/relapseEscalationLevel`),o),Xe(he(this.db,`users/${this.userId}/lastQuitDate`),t),Xe(he(this.db,`users/${this.userId}/profile/lastQuitDate`),t),this.resetMilestones(),Xe(this.statsRef,{...l,addictionLevel:u,mentalStrength:h,triggerDefense:f,lastUpdated:t})]),console.log(`✅ CentralizedStats: Relapse handled with escalation level ${o}, addiction +${a} for ${this.userId}`)}catch(e){throw console.error(`❌ CentralizedStats: Error handling relapse for ${this.userId}:`,e),e}}async getCurrentStats(){try{const e=await $e(this.statsRef);return e.exists()?e.val():this.getDefaultStats()}catch(e){return console.error(`❌ CentralizedStats: Error getting current stats for ${this.userId}:`,e),this.getDefaultStats()}}async handleCravingResisted(){try{console.log(`🔄 CentralizedStats: Handling craving resisted for ${this.userId}`),await this.checkAndResetDailyCounter();const e=await this.getCurrentStats(),t=e.mentalStrengthCravingsApplied||0;if(console.log(`🔄 CentralizedStats: Current mental strength cravings applied: ${t}`),t<3){const r=Math.min(100,(e.mentalStrength||50)+1),s=t+1,i={...e,mentalStrength:r,mentalStrengthCravingsApplied:s,mentalStrengthCravingsAppliedDate:new Date().toISOString(),lastUpdated:new Date().toISOString()};return this.authGuard?await this.authGuard.databaseSet(`users/${this.userId}/stats`,i):await Xe(this.statsRef,i),console.log(`✅ CentralizedStats: Applied +1 mental strength (${e.mentalStrength} → ${r}), cravings applied: ${s}/3`),await this.refreshAllStats(),console.log(`✅ CentralizedStats: Craving resistance updated for ${this.userId}`),{applied:!0,cravingsApplied:s,limitReached:s>=3}}else return console.log(`📊 CentralizedStats: Daily mental strength limit reached (${t}/3), no bonus applied`),await this.refreshAllStats(),console.log(`✅ CentralizedStats: Craving resistance updated for ${this.userId}`),{applied:!1,cravingsApplied:t,limitReached:!0}}catch(e){throw console.error(`❌ CentralizedStats: Error handling craving resistance for ${this.userId}:`,e),e}}async checkAndResetDailyCounter(){try{const e=await this.getCurrentStats(),t=e.mentalStrengthCravingsAppliedDate,r=new Date,s=r.toDateString();if(!t){const o={...e,mentalStrengthCravingsApplied:0,mentalStrengthCravingsAppliedDate:r.toISOString(),lastUpdated:new Date().toISOString()};this.authGuard?await this.authGuard.databaseSet(`users/${this.userId}/stats`,o):await Xe(this.statsRef,o),console.log(`✅ CentralizedStats: Initialized daily counter for ${this.userId} (reset to 0)`);return}if(new Date(t).toDateString()!==s){console.log(`🔄 CentralizedStats: New day detected, resetting daily mental strength counter for ${this.userId}`);const o={...e,mentalStrengthCravingsApplied:0,mentalStrengthCravingsAppliedDate:r.toISOString(),lastUpdated:new Date().toISOString()};this.authGuard?await this.authGuard.databaseSet(`users/${this.userId}/stats`,o):await Xe(this.statsRef,o),console.log(`✅ CentralizedStats: Daily mental strength counter reset for ${this.userId}`)}}catch(e){console.warn(`⚠️ CentralizedStats: Could not check/reset daily counter for ${this.userId}:`,e.message)}}}const iI=(n,e={})=>{const{threshold:t=100,velocity:r=.5,enabled:s=!0}=e,[i,o]=O.useState(!1),[a,l]=O.useState(null),[u,h]=O.useState(0),f=O.useRef(null),p=O.useRef(0),y=O.useRef(0),w=O.useRef(0),S=O.useRef(0),k=O.useRef(0);return O.useEffect(()=>{if(!s||!f.current)return;const E=f.current;let x=!1;const N=R=>{if(!s)return;const v=R.touches[0];p.current=v.clientY,y.current=v.clientX,w.current=Date.now(),S.current=v.clientY,k.current=Date.now(),x=!0,o(!0),E.classList.add("swiping")},P=R=>{if(!x||!s)return;R.preventDefault();const v=R.touches[0],T=v.clientY-p.current,C=v.clientX-y.current;Math.abs(C)>Math.abs(T)||(h(T),T>0?(l("down"),E.style.transform=`translateY(${Math.min(T,t*1.5)}px)`,E.style.opacity=Math.max(.3,1-T/(t*2))):T<0&&(l("up"),E.style.transform=`translateY(${Math.max(T,-t*1.5)}px)`,E.style.opacity=Math.max(.3,1-Math.abs(T)/(t*2))),S.current=v.clientY,k.current=Date.now())},$=R=>{if(!x||!s)return;x=!1,o(!1);const T=R.changedTouches[0].clientY-p.current,C=Date.now()-w.current,A=Math.abs(T)/C;E.style.transform="",E.style.opacity="",E.classList.remove("swiping"),(Math.abs(T)>t||A>r)&&(T>0&&a==="down"?L("down"):T<0&&a==="up"&&L("up")),l(null),h(0)},L=R=>{E.classList.add(`swipe-${R}`),setTimeout(()=>{typeof n=="function"&&n()},200)};return E.addEventListener("touchstart",N,{passive:!1}),E.addEventListener("touchmove",P,{passive:!1}),E.addEventListener("touchend",$,{passive:!0}),()=>{E.removeEventListener("touchstart",N),E.removeEventListener("touchmove",P),E.removeEventListener("touchend",$)}},[s,t,r,a]),{modalRef:f,isSwipping:i,swipeDirection:a,swipeDistance:u,classes:`modal-swipe-dismiss ${i?"swiping":""} ${a?`swipe-${a}`:""}`}},J9=({onAuthSuccess:n,isNewUser:e})=>{const[t,r]=O.useState("signin"),[s,i]=O.useState(""),[o,a]=O.useState(""),[l,u]=O.useState(""),[h,f]=O.useState(!1),[p,y]=O.useState(!1),[w,S]=O.useState(""),[k,E]=O.useState(""),[x,N]=O.useState(!1);O.useEffect(()=>()=>{p&&y(!1)},[p]);const P=new ci;P.addScope("email"),P.addScope("profile"),P.setCustomParameters({prompt:"select_account",access_type:"offline",include_granted_scopes:"true"});const $=()=>{i(""),a(""),u(""),S(""),E("")},L=async()=>{f(!0),y(!0),S("");try{console.log("Starting Google sign-in process..."),console.log("Opening Google authentication popup..."),console.log("Google provider configuration:",{scopes:P.scopes,customParameters:P.customParameters});const A=LB(mi,P),b=new Promise((B,ve)=>{setTimeout(()=>ve(new Error("Popup timeout - please try again")),6e4)}),_=await Promise.race([A,b]);if(_&&_.user){const B=_.user;console.log("Google sign-in successful for:",B.email,"UID:",B.uid),console.log("User display name:",B.displayName),console.log("User photo URL:",B.photoURL),await new Promise(ve=>setTimeout(ve,800)),n(B)}else throw new Error("No user data received from Google authentication")}catch(A){console.error("Google sign-in error:",A),A.code==="auth/popup-closed-by-user"?S("Google sign-in was cancelled. Please try again and complete the account selection in the popup window."):A.code==="auth/popup-blocked"?S("Google sign-in popup was blocked by your browser. Please allow popups for this site and try again."):A.code==="auth/cancelled-popup-request"?S("Google sign-in was cancelled. Please try again and complete the authentication process."):A.code==="auth/account-exists-with-different-credential"?S("An account already exists with this email using a different sign-in method. Please use email/password instead."):A.message==="Popup timeout - please try again"?S("Google sign-in popup timed out. Please try again and complete the account selection quickly."):A.code==="auth/network-request-failed"?S("Network error during Google sign-in. Please check your internet connection and try again."):A.code==="auth/operation-not-allowed"?S("Google sign-in is not enabled for this app. Please contact support."):S(C(A.code))}finally{f(!1),y(!1)}},R=async A=>{A.preventDefault(),f(!0),S("");try{const _=(await G$(mi,s,o)).user;console.log("Email sign-in successful for:",_.email),n(_)}catch(b){console.error("Email sign-in error:",b),S(C(b.code))}finally{f(!1)}},v=async A=>{if(A.preventDefault(),f(!0),S(""),o!==l){S("Passwords do not match"),f(!1);return}if(o.length<6){S("Password must be at least 6 characters long"),f(!1);return}try{const _=(await W$(mi,s,o)).user;console.log("Email sign-up successful for:",_.email),await Q$(_),n(_)}catch(b){console.error("Email sign-up error:",b),S(C(b.code))}finally{f(!1)}},T=async A=>{if(A.preventDefault(),!s){S("Please enter your email address");return}f(!0),S("");try{await z$(mi,s),E("Password reset email sent! Check your inbox.")}catch(b){console.error("Password reset error:",b),S(C(b.code))}finally{f(!1)}},C=A=>{switch(A){case"auth/user-not-found":return"No account found with this email address";case"auth/wrong-password":return"Incorrect password";case"auth/email-already-in-use":return"An account with this email already exists";case"auth/weak-password":return"Password is too weak. Use at least 6 characters";case"auth/invalid-email":return"Invalid email address";case"auth/popup-closed-by-user":return"Google sign-in was cancelled. Please try again and complete the account selection.";case"auth/popup-blocked":return"Google sign-in popup was blocked. Please allow popups for this site and try again.";case"auth/cancelled-popup-request":return"Google sign-in was cancelled. Please try again.";case"auth/account-exists-with-different-credential":return"An account already exists with this email using a different sign-in method.";case"auth/network-request-failed":return"Network error. Please check your connection";case"auth/operation-not-allowed":return"Google sign-in is not enabled. Please contact support.";case"auth/too-many-requests":return"Too many sign-in attempts. Please try again later.";default:return"Authentication failed. Please try again"}};return x?d.jsx("div",{className:"min-h-screen bg-gray-900 flex items-center justify-center px-4",children:d.jsxs("div",{className:"max-w-md w-full space-y-8",children:[d.jsxs("div",{className:"text-center",children:[d.jsx("h2",{className:"text-3xl font-bold text-white",children:"Reset Password"}),d.jsx("p",{className:"mt-2 text-gray-400",children:"Enter your email to receive a reset link"})]}),d.jsxs("form",{onSubmit:T,className:"space-y-6",children:[d.jsxs("div",{children:[d.jsx("label",{htmlFor:"email",className:"block text-sm font-medium text-gray-300",children:"Email Address"}),d.jsx("input",{id:"email",type:"email",value:s,onChange:A=>i(A.target.value),required:!0,autoComplete:"email",className:"mt-1 block w-full px-3 py-2 bg-gray-800 border border-gray-600 rounded-md text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"Enter your email"})]}),w&&d.jsx("div",{className:"text-red-400 text-sm",children:w}),k&&d.jsx("div",{className:"text-green-400 text-sm",children:k}),d.jsxs("div",{className:"flex space-x-3",children:[d.jsx("button",{type:"button",onClick:()=>{N(!1),S(""),E("")},className:"flex-1 px-4 py-3 border border-gray-600 rounded-md text-gray-300 hover:bg-gray-700 focus:outline-none focus:ring-2 focus:ring-gray-500 min-h-[44px]",children:"Back to Login"}),d.jsx("button",{type:"submit",disabled:h,className:"flex-1 px-4 py-3 bg-blue-600 border border-transparent rounded-md text-white hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 disabled:opacity-50 min-h-[44px]",children:h?"Sending...":"Send Reset Link"})]})]})]})}):d.jsx("div",{className:"min-h-screen bg-gray-900 flex items-center justify-center px-4",children:d.jsxs("div",{className:"max-w-md w-full space-y-8",children:[d.jsxs("div",{className:"text-center",children:[d.jsx("h1",{className:"text-4xl font-bold text-white mb-2",children:"QuitCard Arena"}),d.jsx("p",{className:"text-gray-400",children:"Your journey to quit starts here"})]}),d.jsxs("div",{children:[p&&d.jsx("div",{className:"mb-3 p-3 bg-blue-900/20 border border-blue-500/30 rounded-lg",children:d.jsxs("div",{className:"flex items-center justify-center text-blue-300 text-sm",children:[d.jsx("div",{className:"animate-pulse mr-2",children:"🔐"}),"Google popup is open - please complete your account selection"]})}),d.jsx("button",{onClick:L,disabled:h,className:"w-full flex items-center justify-center px-4 py-3 border border-gray-600 rounded-md text-white bg-gray-800 hover:bg-gray-700 focus:outline-none focus:ring-2 focus:ring-blue-500 disabled:opacity-50",children:h?d.jsxs(d.Fragment,{children:[d.jsx("div",{className:"animate-spin rounded-full h-5 w-5 border-b-2 border-white mr-3"}),"Opening Google Sign-in..."]}):d.jsxs(d.Fragment,{children:[d.jsxs("svg",{className:"w-5 h-5 mr-3",viewBox:"0 0 24 24",children:[d.jsx("path",{fill:"currentColor",d:"M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z"}),d.jsx("path",{fill:"currentColor",d:"M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z"}),d.jsx("path",{fill:"currentColor",d:"M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z"}),d.jsx("path",{fill:"currentColor",d:"M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z"})]}),"Continue with Google"]})}),d.jsx("p",{className:"text-xs text-gray-500 mt-2 text-center",children:p?d.jsx("span",{className:"text-blue-400 font-medium",children:"🔐 Google popup is open - please complete account selection"}):"Click to open Google account selection popup"}),!1,w&&d.jsxs("div",{className:"mt-3 p-3 bg-red-900/20 border border-red-500/30 rounded-lg",children:[d.jsx("div",{className:"text-red-300 text-sm mb-2",children:w}),w.includes("Google sign-in")&&!p&&d.jsx("button",{onClick:L,disabled:h,className:"w-full px-3 py-3 bg-red-600 hover:bg-red-700 text-white text-sm rounded-md transition-colors disabled:opacity-50 min-h-[44px]",children:h?"Retrying...":"Try Google Sign-in Again"})]})]}),d.jsxs("div",{className:"relative",children:[d.jsx("div",{className:"absolute inset-0 flex items-center",children:d.jsx("div",{className:"w-full border-t border-gray-600"})}),d.jsx("div",{className:"relative flex justify-center text-sm",children:d.jsx("span",{className:"px-2 bg-gray-900 text-gray-400",children:"Or continue with email"})})]}),d.jsxs("div",{className:"flex space-x-1 bg-gray-800 p-1 rounded-lg",children:[d.jsx("button",{onClick:()=>{r("signin"),$()},className:`flex-1 py-3 px-4 rounded-md text-sm font-medium transition-colors min-h-[44px] ${t==="signin"?"bg-blue-600 text-white":"text-gray-400 hover:text-white"}`,children:"Sign In"}),d.jsx("button",{onClick:()=>{r("signup"),$()},className:`flex-1 py-3 px-4 rounded-md text-sm font-medium transition-colors min-h-[44px] ${t==="signup"?"bg-blue-600 text-white":"text-gray-400 hover:text-white"}`,children:"Sign Up"})]}),t==="signin"&&d.jsxs("form",{onSubmit:R,className:"space-y-6",children:[d.jsxs("div",{children:[d.jsx("label",{htmlFor:"signin-email",className:"block text-sm font-medium text-gray-300",children:"Email Address"}),d.jsx("input",{id:"signin-email",type:"email",value:s,onChange:A=>i(A.target.value),required:!0,autoComplete:"email",className:"mt-1 block w-full px-3 py-2 bg-gray-800 border border-gray-600 rounded-md text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"Enter your email"})]}),d.jsxs("div",{children:[d.jsx("label",{htmlFor:"signin-password",className:"block text-sm font-medium text-gray-300",children:"Password"}),d.jsx("input",{id:"signin-password",type:"password",value:o,onChange:A=>a(A.target.value),required:!0,autoComplete:"current-password",className:"mt-1 block w-full px-3 py-2 bg-gray-800 border border-gray-600 rounded-md text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"Enter your password"})]}),d.jsx("div",{className:"flex items-center justify-between",children:d.jsx("button",{type:"button",onClick:()=>N(!0),className:"text-sm text-blue-400 hover:text-blue-300 py-2 px-2 min-h-[44px] min-w-[44px]",children:"Forgot your password?"})}),w&&d.jsx("div",{className:"text-red-400 text-sm",children:w}),d.jsx("button",{type:"submit",disabled:h,className:"w-full flex justify-center py-3 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 disabled:opacity-50 min-h-[44px]",children:h?"Signing in...":"Sign In"})]}),t==="signup"&&d.jsxs("form",{onSubmit:v,className:"space-y-6",children:[d.jsxs("div",{children:[d.jsx("label",{htmlFor:"signup-email",className:"block text-sm font-medium text-gray-300",children:"Email Address"}),d.jsx("input",{id:"signup-email",type:"email",value:s,onChange:A=>i(A.target.value),required:!0,autoComplete:"email",className:"mt-1 block w-full px-3 py-2 bg-gray-800 border border-gray-600 rounded-md text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"Enter your email"})]}),d.jsxs("div",{children:[d.jsx("label",{htmlFor:"signup-password",className:"block text-sm font-medium text-gray-300",children:"Password"}),d.jsx("input",{id:"signup-password",type:"password",value:o,onChange:A=>a(A.target.value),required:!0,autoComplete:"new-password",className:"mt-1 block w-full px-3 py-2 bg-gray-800 border border-gray-600 rounded-md text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"Create a password (min 6 characters)"})]}),d.jsxs("div",{children:[d.jsx("label",{htmlFor:"confirm-password",className:"block text-sm font-medium text-gray-300",children:"Confirm Password"}),d.jsx("input",{id:"confirm-password",type:"password",value:l,onChange:A=>u(A.target.value),required:!0,autoComplete:"new-password",className:"mt-1 block w-full px-3 py-2 bg-gray-800 border border-gray-600 rounded-md text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"Confirm your password"})]}),w&&d.jsx("div",{className:"text-red-400 text-sm",children:w}),k&&d.jsx("div",{className:"text-green-400 text-sm",children:k}),d.jsx("button",{type:"submit",disabled:h,className:"w-full flex justify-center py-3 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 disabled:opacity-50 min-h-[44px]",children:h?"Creating account...":"Create Account"})]})]})})},X9=({offlineManager:n})=>{const[e,t]=O.useState(navigator.onLine),[r,s]=O.useState(!1),[i,o]=O.useState(0),[a,l]=O.useState(!1);return O.useEffect(()=>{const u=()=>{t(!0),s(!1),console.log("🌐 Connection restored"),n&&i>0&&(l(!0),setTimeout(()=>{l(!1),o(0)},2e3))},h=()=>{t(!1),s(!0),console.log("📡 Connection lost")};window.addEventListener("online",u),window.addEventListener("offline",h),t(navigator.onLine);const f=async()=>{if(n)try{const y=await n.getQueuedActionsCount();o(y)}catch(y){console.warn("Could not get queued actions count:",y)}};f();const p=setInterval(f,5e3);return()=>{window.removeEventListener("online",u),window.removeEventListener("offline",h),clearInterval(p)}},[n,i]),e&&a?d.jsx("div",{className:"fixed top-0 left-0 right-0 z-50 bg-blue-600 text-white p-3 text-center shadow-lg",children:d.jsxs("div",{className:"flex items-center justify-center space-x-2",children:[d.jsx("svg",{className:"w-5 h-5 animate-spin",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:d.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})}),d.jsxs("span",{className:"font-medium",children:["Syncing ",i," offline actions..."]})]})}):e&&!a&&i===0||e?null:d.jsxs("div",{className:"fixed top-0 left-0 right-0 z-50 bg-yellow-600 text-white p-3 text-center shadow-lg",children:[d.jsxs("div",{className:"flex items-center justify-center space-x-2",children:[d.jsx("svg",{className:"w-5 h-5 animate-pulse",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:d.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L3.732 16.5c-.77.833.192 2.5 1.732 2.5z"})}),d.jsxs("span",{className:"font-medium",children:["You're offline. Some features may be limited.",i>0&&` (${i} actions queued)`]}),d.jsx("button",{onClick:()=>s(!1),className:"ml-2 text-white hover:text-yellow-200 transition-colors w-11 h-11 flex items-center justify-center min-h-[44px] min-w-[44px]",children:d.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:d.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),r&&d.jsxs("div",{className:"mt-2 text-sm bg-yellow-700 p-2 rounded",children:[d.jsx("p",{className:"mb-2",children:"While offline, you can:"}),d.jsxs("ul",{className:"text-left space-y-1 ml-4",children:[d.jsx("li",{children:"• View your current stats and progress"}),d.jsx("li",{children:"• Track habits and cravings"}),d.jsx("li",{children:"• Log water intake and breathing exercises"}),d.jsx("li",{children:"• Record craving assessments and resistance"}),d.jsx("li",{children:"• Play distraction games"}),d.jsx("li",{children:"• View your profile information"})]}),d.jsxs("p",{className:"mt-2 text-yellow-200",children:["All changes will sync automatically when you're back online.",i>0&&d.jsxs("span",{className:"block mt-1 font-medium",children:["💾 ",i," action",i!==1?"s":""," queued for sync"]})]})]})]})},Z9=({offlineManager:n})=>{const[e,t]=O.useState({isOnline:navigator.onLine,queuedOperations:0,failedOperations:0,syncInProgress:!1,lastSyncTime:null}),[r,s]=O.useState(!1),[i,o]=O.useState(0),[a,l]=O.useState(null);O.useEffect(()=>{if(!n||!n.progressManager)return;const S=N=>{o(N.progress),l(N.currentOperation)},k=N=>{t(P=>({...P,syncInProgress:N.status==="syncing",lastSyncTime:N.endTime||P.lastSyncTime}))};n.progressManager.addProgressCallback(S),n.progressManager.addStatusCallback(k);const E=()=>{const N=n.getStatus();t(P=>({...P,isOnline:N.isOnline,queuedOperations:N.queue.queuedOperations,failedOperations:N.queue.failedOperations,syncInProgress:N.queue.syncInProgress}))};E();const x=setInterval(E,1e3);return()=>{n&&n.progressManager&&(n.progressManager.removeProgressCallback(S),n.progressManager.removeStatusCallback(k)),clearInterval(x)}},[n]);const u=async()=>{n&&await n.retryFailedOperations()},h=async()=>{n&&await n.attemptSync()},f=S=>{if(!S)return"Never";const E=Date.now()-S,x=Math.floor(E/6e4),N=Math.floor(x/60),P=Math.floor(N/24);return P>0?`${P}d ago`:N>0?`${N}h ago`:x>0?`${x}m ago`:"Just now"},p=()=>e.isOnline?e.failedOperations>0?"text-red-600":e.queuedOperations>0?"text-blue-600":"text-green-600":"text-yellow-600",y=()=>e.isOnline?e.syncInProgress?"🔄":e.failedOperations>0?"⚠️":e.queuedOperations>0?"⏳":"✅":"📡",w=()=>e.isOnline?e.syncInProgress?"Syncing...":e.failedOperations>0?`${e.failedOperations} failed`:e.queuedOperations>0?`${e.queuedOperations} queued`:"Synced":"Offline";return n?d.jsxs("div",{className:"fixed top-4 right-4 z-50",children:[d.jsxs("div",{className:`bg-white rounded-lg shadow-lg p-3 cursor-pointer transition-all duration-200 hover:shadow-xl ${p()}`,onClick:()=>s(!r),children:[d.jsxs("div",{className:"flex items-center gap-2",children:[d.jsx("span",{className:"text-lg",children:y()}),d.jsx("div",{className:"text-sm font-medium",children:w()}),e.syncInProgress&&d.jsx("div",{className:"w-4 h-4 border-2 border-current border-t-transparent rounded-full animate-spin"})]}),e.syncInProgress&&d.jsx("div",{className:"mt-2 w-full bg-gray-200 rounded-full h-1",children:d.jsx("div",{className:"bg-current h-1 rounded-full transition-all duration-300",style:{width:`${i}%`}})})]}),r&&d.jsxs("div",{className:"absolute top-16 right-0 bg-white rounded-lg shadow-xl p-4 w-80 border",children:[d.jsxs("div",{className:"flex justify-between items-center mb-3",children:[d.jsx("h3",{className:"font-semibold text-gray-800",children:"Sync Status"}),d.jsx("button",{onClick:()=>s(!1),className:"text-gray-400 hover:text-gray-600",children:"✕"})]}),d.jsxs("div",{className:"mb-3",children:[d.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[d.jsx("span",{className:`w-2 h-2 rounded-full ${e.isOnline?"bg-green-500":"bg-yellow-500"}`}),d.jsx("span",{className:"text-sm font-medium",children:e.isOnline?"Online":"Offline"})]}),d.jsxs("div",{className:"text-xs text-gray-500",children:["Last sync: ",f(e.lastSyncTime)]})]}),d.jsxs("div",{className:"mb-3",children:[d.jsx("div",{className:"text-sm font-medium text-gray-700 mb-1",children:"Queue Status"}),d.jsxs("div",{className:"space-y-1 text-xs",children:[d.jsxs("div",{className:"flex justify-between",children:[d.jsx("span",{children:"Queued:"}),d.jsx("span",{className:"text-blue-600",children:e.queuedOperations})]}),d.jsxs("div",{className:"flex justify-between",children:[d.jsx("span",{children:"Failed:"}),d.jsx("span",{className:"text-red-600",children:e.failedOperations})]})]})]}),a&&d.jsxs("div",{className:"mb-3",children:[d.jsx("div",{className:"text-sm font-medium text-gray-700 mb-1",children:"Current Operation"}),d.jsxs("div",{className:"text-xs text-gray-600",children:[a.type," - ",Math.round(i),"%"]})]}),d.jsxs("div",{className:"flex gap-2",children:[e.failedOperations>0&&d.jsx("button",{onClick:u,className:"flex-1 bg-red-500 hover:bg-red-600 text-white text-xs py-2 px-3 rounded transition-colors",children:"Retry Failed"}),e.queuedOperations>0&&e.isOnline&&d.jsx("button",{onClick:h,className:"flex-1 bg-blue-500 hover:bg-blue-600 text-white text-xs py-2 px-3 rounded transition-colors",children:"Sync Now"})]}),d.jsx("div",{className:"mt-3 pt-3 border-t border-gray-200",children:d.jsx("div",{className:"text-xs text-gray-500",children:d.jsxs("div",{className:"flex justify-between",children:[d.jsx("span",{children:"Success Rate:"}),d.jsxs("span",{children:[n.getStatus().sync.successRate,"%"]})]})})})]})]}):null},eq=({sessionManager:n,authGuard:e})=>{const[t,r]=O.useState({isActive:!1,duration:0,timeUntilTimeout:0,timeUntilWarning:0}),[s,i]=O.useState(!1),[o,a]=O.useState(!1);O.useEffect(()=>{if(!n)return;const S=()=>{const E=n.getSessionInfo();r(E),a(E.timeUntilWarning<=0&&E.timeUntilTimeout>0)};S();const k=setInterval(S,1e3);return()=>clearInterval(k)},[n]);const l=S=>{if(S<=0)return"0:00";const k=Math.floor(S/60),E=S%60;return`${k}:${E.toString().padStart(2,"0")}`},u=S=>S<60?`${S}s`:S<3600?`${Math.floor(S/60)}m`:`${Math.floor(S/3600)}h ${Math.floor(S%3600/60)}m`,h=()=>t.isActive?o?"text-yellow-600":t.timeUntilTimeout<=60?"text-red-600":"text-green-600":"text-gray-500",f=()=>t.isActive?o?"⚠️":t.timeUntilTimeout<=60?"🔴":"🟢":"⏸️",p=()=>t.isActive?o?"Warning":t.timeUntilTimeout<=60?"Expiring":"Active":"Inactive",y=()=>{n&&n.extendSession()},w=async()=>{if(e)try{await e.logout()}catch(S){console.error("Logout failed:",S)}};return t.isActive?d.jsxs("div",{className:"fixed top-4 left-4 z-50",children:[d.jsxs("div",{className:`bg-white rounded-lg shadow-lg p-3 cursor-pointer transition-all duration-200 hover:shadow-xl ${h()}`,onClick:()=>i(!s),children:[d.jsxs("div",{className:"flex items-center gap-2",children:[d.jsx("span",{className:"text-lg",children:f()}),d.jsx("div",{className:"text-sm font-medium",children:p()}),t.timeUntilTimeout>0&&d.jsx("div",{className:"text-xs opacity-75",children:l(t.timeUntilTimeout)})]}),t.timeUntilTimeout>0&&d.jsx("div",{className:"mt-2 w-full bg-gray-200 rounded-full h-1",children:d.jsx("div",{className:`h-1 rounded-full transition-all duration-300 ${o?"bg-yellow-500":t.timeUntilTimeout<=60?"bg-red-500":"bg-green-500"}`,style:{width:`${Math.max(0,Math.min(100,t.timeUntilTimeout/1800*100))}%`}})})]}),s&&d.jsxs("div",{className:"absolute top-16 left-0 bg-white rounded-lg shadow-xl p-4 w-80 border",children:[d.jsxs("div",{className:"flex justify-between items-center mb-3",children:[d.jsx("h3",{className:"font-semibold text-gray-800",children:"Session Status"}),d.jsx("button",{onClick:()=>i(!1),className:"text-gray-400 hover:text-gray-600",children:"✕"})]}),d.jsxs("div",{className:"mb-3",children:[d.jsx("div",{className:"text-sm font-medium text-gray-700 mb-1",children:"Session Duration"}),d.jsx("div",{className:"text-lg font-mono text-gray-900",children:u(t.duration)})]}),t.timeUntilTimeout>0&&d.jsxs("div",{className:"mb-3",children:[d.jsx("div",{className:"text-sm font-medium text-gray-700 mb-1",children:"Time Until Timeout"}),d.jsx("div",{className:`text-lg font-mono ${o?"text-yellow-600":t.timeUntilTimeout<=60?"text-red-600":"text-gray-900"}`,children:l(t.timeUntilTimeout)})]}),d.jsxs("div",{className:"mb-3",children:[d.jsx("div",{className:"text-sm font-medium text-gray-700 mb-1",children:"Status"}),d.jsx("div",{className:`text-sm font-medium ${o?"text-yellow-600":t.timeUntilTimeout<=60?"text-red-600":"text-green-600"}`,children:p()})]}),d.jsxs("div",{className:"flex gap-2",children:[o&&d.jsx("button",{onClick:y,className:"flex-1 bg-yellow-500 hover:bg-yellow-600 text-white text-sm py-2 px-3 rounded transition-colors",children:"Extend Session"}),d.jsx("button",{onClick:w,className:"flex-1 bg-red-500 hover:bg-red-600 text-white text-sm py-2 px-3 rounded transition-colors",children:"Logout"})]}),e&&d.jsx("div",{className:"mt-3 pt-3 border-t border-gray-200",children:d.jsxs("div",{className:"text-xs text-gray-500",children:[d.jsxs("div",{className:"flex justify-between",children:[d.jsx("span",{children:"Operations:"}),d.jsx("span",{children:e.getOperationStats().total})]}),d.jsxs("div",{className:"flex justify-between",children:[d.jsx("span",{children:"Success Rate:"}),d.jsxs("span",{children:[e.getOperationStats().successRate,"%"]})]})]})})]})]}):null},tq=({selectedRate:n,duration:e,onRateSelect:t,onDurationSelect:r,onStartExercise:s})=>d.jsxs("div",{className:"p-4 sm:p-6",children:[d.jsxs("div",{className:"text-center mb-6",children:[d.jsx("h2",{className:"text-xl sm:text-2xl font-bold text-white mb-2",children:"Breathing Exercise"}),d.jsx("p",{className:"text-slate-400 text-sm",children:"Configure your breathing session"})]}),d.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4 mb-8",children:[d.jsxs("div",{onClick:t,className:"bg-slate-800/50 hover:bg-slate-700/50 rounded-2xl p-4 border border-slate-600/30 cursor-pointer transition-all duration-300 hover:scale-[1.02] group",children:[d.jsxs("div",{className:"flex items-center space-x-3 mb-3",children:[d.jsx("div",{className:"w-8 h-8 bg-slate-700/50 rounded-lg flex items-center justify-center group-hover:bg-slate-600/50 transition-colors flex-shrink-0",children:d.jsx("span",{className:"text-lg",children:"🫁"})}),d.jsx("div",{className:"text-white font-semibold text-sm",children:"BREATHING RATE"})]}),d.jsx("div",{className:"text-white font-bold text-sm",children:n.name}),d.jsxs("div",{className:"text-slate-400 text-xs",children:[n.inhale,"s | ",n.exhale,"s"]})]}),d.jsxs("div",{onClick:r,className:"bg-slate-800/50 hover:bg-slate-700/50 rounded-2xl p-4 border border-slate-600/30 cursor-pointer transition-all duration-300 hover:scale-[1.02] group",children:[d.jsxs("div",{className:"flex items-center space-x-3 mb-3",children:[d.jsx("div",{className:"w-8 h-8 bg-slate-700/50 rounded-lg flex items-center justify-center group-hover:bg-slate-600/50 transition-colors flex-shrink-0",children:d.jsx("span",{className:"text-lg",children:"⏱️"})}),d.jsx("div",{className:"text-white font-semibold text-sm",children:"DURATION"})]}),d.jsxs("div",{className:"text-white font-bold text-sm",children:[e,"min."]}),d.jsx("div",{className:"text-slate-400 text-xs",children:"Total time"})]})]}),d.jsx("button",{onClick:s,className:"w-full bg-gradient-to-r from-blue-600 to-purple-600 hover:from-blue-700 hover:to-purple-700 text-white font-bold text-base sm:text-lg py-3 sm:py-4 px-4 sm:px-6 rounded-2xl transition-all duration-300 hover:scale-105 shadow-lg hover:shadow-xl min-h-[44px]",children:"START EXERCISE"}),d.jsx("div",{className:"mt-4 sm:mt-6 text-center",children:d.jsx("p",{className:"text-slate-400 text-xs sm:text-sm",children:"Find a comfortable position and prepare to relax"})})]}),nq=({selectedRate:n,onSelect:e,onBack:t})=>{const r=[{name:"INTRO",inhale:3,exhale:6},{name:"BASIC",inhale:5,exhale:10},{name:"INTERMEDIATE",inhale:10,exhale:20},{name:"ADVANCED",inhale:20,exhale:40},{name:"ELITE",inhale:30,exhale:60}];return d.jsxs("div",{className:"p-8",children:[d.jsxs("div",{className:"text-center mb-8",children:[d.jsx("h2",{className:"text-2xl font-bold text-white mb-2",children:"BREATHING RATE"}),d.jsx("p",{className:"text-slate-400",children:"Choose your breathing pattern"})]}),d.jsx("div",{className:"space-y-4 mb-8",children:r.map(s=>d.jsx("div",{onClick:()=>e(s),className:`rounded-2xl p-6 border transition-all duration-300 cursor-pointer hover:scale-[1.02] ${n.name===s.name?"bg-white text-slate-900 border-white shadow-lg":"bg-slate-800/50 text-white border-slate-600/30 hover:bg-slate-700/50"}`,children:d.jsxs("div",{className:"flex items-center justify-between",children:[d.jsxs("div",{className:"text-left",children:[d.jsx("div",{className:`font-bold text-lg ${n.name===s.name?"text-slate-900":"text-white"}`,children:s.name}),d.jsxs("div",{className:`text-sm ${n.name===s.name?"text-slate-600":"text-slate-400"}`,children:[s.inhale,"s inhale | ",s.exhale,"s exhale"]})]}),n.name===s.name&&d.jsx("div",{className:"w-6 h-6 bg-slate-900 rounded-full flex items-center justify-center",children:d.jsx("svg",{className:"w-4 h-4 text-white",fill:"currentColor",viewBox:"0 0 20 20",children:d.jsx("path",{fillRule:"evenodd",d:"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z",clipRule:"evenodd"})})})]})},s.name))}),d.jsx("button",{onClick:t,className:"w-full bg-slate-700/50 hover:bg-slate-600/50 text-white font-medium py-3 px-6 rounded-2xl transition-all duration-300 border border-slate-600/30",children:"Back to Setup"})]})},rq=({selectedDuration:n,onSelect:e,onBack:t})=>{const[r,s]=O.useState(n),i=2,o=10;O.useEffect(()=>{s(n)},[n]);const a=f=>{const p=parseInt(f.target.value);s(p),navigator.vibrate&&navigator.vibrate(50),console.log(`🎯 Duration picker: Selected ${p} minutes`)},l=()=>{e(r)},u=f=>f<=3?"Short Session":f<=6?"Medium Session":f<=8?"Long Session":"Extended Session",h=f=>f<=3?"text-green-400":f<=6?"text-blue-400":f<=8?"text-orange-400":"text-red-400";return d.jsxs("div",{className:"p-8",children:[d.jsxs("div",{className:"text-center mb-8",children:[d.jsx("h2",{className:"text-2xl font-bold text-white mb-2",children:"DURATION"}),d.jsx("p",{className:"text-slate-400",children:"Choose your session length"})]}),d.jsxs("div",{className:"text-center mb-8",children:[d.jsxs("div",{className:`text-8xl font-bold ${h(r)} mb-2`,children:[r," mins"]}),d.jsx("div",{className:`text-xl font-medium ${h(r)}`,children:u(r)})]}),d.jsx("div",{className:"mb-8",children:d.jsx("input",{type:"range",min:i,max:o,step:1,value:r,onChange:a,style:{background:`linear-gradient(to right, #3b82f6 0%, #3b82f6 ${(r-i)/(o-i)*100}%, #475569 ${(r-i)/(o-i)*100}%, #475569 100%)`},className:"w-full h-4 rounded-lg appearance-none cursor-pointer slider mb-4",autoComplete:"off"})}),d.jsx("button",{onClick:l,className:"w-full bg-gradient-to-r from-green-600 to-green-700 hover:from-green-700 hover:to-green-800 text-white font-bold text-lg py-4 px-6 rounded-2xl transition-all duration-300 hover:scale-105 shadow-lg transform active:scale-95",children:"SAVE"}),d.jsx("button",{onClick:t,className:"w-full mt-4 bg-slate-700/50 hover:bg-slate-600/50 text-white font-medium py-3 px-6 rounded-2xl transition-all duration-300 border border-slate-600/30 hover:border-slate-500/50",children:"Back to Setup"})]})},sq=({rate:n,duration:e,onComplete:t,onClose:r,onLeave:s})=>{const[h,f]=O.useState(e*60),[p,y]=O.useState("inhale"),[w,S]=O.useState(0),[k,E]=O.useState(!1),[x,N]=O.useState(.1),[P,$]=O.useState(!1),[L,R]=O.useState(!1),v=O.useRef(null),T=O.useRef(null);O.useEffect(()=>{h===0&&k&&!L&&(console.log("🎯 Exercise completed, calling onComplete"),R(!0),t())},[h,k,L,t]);const C=()=>{console.log(`⏰ Starting main timer for ${e} minutes`),T.current&&(console.log("⚠️ Timer already exists, clearing previous timer"),clearInterval(T.current)),T.current=setInterval(()=>{f(De=>{if(De<=1)return console.log(`⏰ Main exercise timer completed! Total duration: ${e} minutes`),clearInterval(T.current),T.current=null,0;const D=De-1;return D%10===0&&console.log(`⏰ Main timer: ${D}s remaining`),D})},1e3),console.log("✅ Main timer started successfully")},A=()=>{console.log(`🚀 Starting breathing cycle with rate: inhale=${n.inhale}s, exhale=${n.exhale}s`),v.current&&(console.log("⚠️ Animation already running, clearing previous animation"),cancelAnimationFrame(v.current));const De=n.inhale+n.exhale;let D=0,q=0,ae="inhale";console.log(`📊 Cycle duration: ${De}s, starting animation loop...`);const pe=()=>{if(D+=16,D>=De*1e3&&(console.log(`🔄 Breathing cycle completed, resetting to 0ms. Current phase: ${ae}, phaseTime: ${w}`),D=0,q=0,ae="inhale",y("inhale"),S(0)),D<n.inhale*1e3){ae!=="inhale"&&(console.log(`🔄 Switching to INHALE phase at ${D}ms`),ae="inhale",y("inhale"),S(0),q=0);const Te=D/(n.inhale*1e3),ne=.1+b(Te)*3.9;N(ne);const ge=Math.floor(Te*n.inhale);ge!==q&&(S(ge),q=ge,console.log(`⏱️ INHALE: ${ge}/${n.inhale}s (phase: ${ae}, scale: ${ne.toFixed(3)})`))}else{ae!=="exhale"&&(console.log(`🔄 Switching to EXHALE phase at ${D}ms`),ae="exhale",y("exhale"),S(0),q=0);const Te=(D-n.inhale*1e3)/(n.exhale*1e3),ne=4-b(Te)*3.9;N(ne);const ge=Math.floor(Te*n.exhale);ge!==q&&(S(ge),q=ge,console.log(`⏱️ EXHALE: ${ge}/${n.exhale}s (phase: ${ae}, scale: ${ne.toFixed(3)})`))}v.current=requestAnimationFrame(pe)};pe(),console.log("✅ Breathing cycle animation started successfully")},b=De=>De<.5?2*De*De:-1+(4-2*De)*De;O.useEffect(()=>(k&&(C(),A()),()=>{k&&qe()}),[k]);const _=De=>{const D=Math.floor(De/60),q=De%60;return`${D.toString().padStart(2,"0")}:${q.toString().padStart(2,"0")}`},B=()=>w,ve=()=>p==="inhale"?"from-orange-400 to-red-500":"from-blue-400 to-cyan-500",Fe=()=>p==="inhale"?"Inhale through the nose":"Exhale slowly through the mouth and empty your lungs",It=()=>{console.log("🔄 User clicked close button, showing confirmation popup"),$(!0)},Q=()=>{console.log("🚪 User confirmed leaving exercise, cleaning up..."),qe(),s?s():r()},we=()=>{$(!1)},Se=()=>{if(k){console.log("⚠️ Exercise already active, ignoring start request");return}console.log(`🎬 Starting breathing exercise: ${e} minutes, rate: ${n.name}`),console.log(`📊 Initial state - isActive: ${k}, progress: ${x}, currentPhase: ${p}`),N(.1),y("inhale"),S(0),f(e*60),E(!0),console.log("✅ isActive set to true, starting timers..."),setTimeout(()=>{console.log("🚀 Starting main timer and breathing cycle..."),C(),A()},0)},qe=()=>{console.log("🧹 Cleaning up breathing exercise resources"),v.current&&(cancelAnimationFrame(v.current),v.current=null),T.current&&(clearInterval(T.current),T.current=null),E(!1),f(0),N(.1),y("inhale"),S(0)};return O.useEffect(()=>{k||(console.log("🎬 Component mounted, starting breathing exercise automatically"),Se())},[]),d.jsxs("div",{className:"h-screen bg-slate-900 flex flex-col",children:[d.jsxs("div",{className:"flex items-center justify-between p-6",children:[d.jsx("button",{onClick:It,className:"w-11 h-11 flex items-center justify-center text-white hover:text-slate-300 transition-colors bg-slate-800/50 hover:bg-slate-700/50 rounded-lg border border-slate-600/30 hover:border-slate-500/50 z-50 min-h-[44px] min-w-[44px]",title:"End breathing exercise",children:d.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:d.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})}),d.jsx("div",{className:"text-center",children:d.jsx("div",{className:"text-white text-2xl font-mono",children:_(h)})}),d.jsx("div",{className:"w-11"})," "]}),d.jsxs("div",{className:"flex-1 flex items-center justify-center relative",children:[d.jsx("div",{className:"absolute w-80 h-80 border-2 border-dashed border-white/30 rounded-full"}),d.jsx("div",{className:`w-20 h-20 bg-gradient-to-br ${ve()} rounded-full shadow-2xl`,style:{transform:`scale(${x})`,transition:"none",boxShadow:`0 0 ${Math.max(x*40,10)}px ${Math.max(x*15,5)}px ${p==="inhale"?"rgba(251, 146, 60, 0.5)":"rgba(59, 130, 246, 0.5)"}`}})]}),d.jsxs("div",{className:"p-6 text-center",children:[d.jsx("div",{className:"flex items-center justify-center mb-4 h-16",children:d.jsx("span",{className:"text-white text-lg leading-tight",children:Fe()})}),d.jsxs("div",{className:"text-slate-400 text-sm",children:[B(),"/",p==="inhale"?n.inhale:n.exhale,"s"]})]}),d.jsx("div",{className:"px-6 pb-6",children:d.jsx("div",{className:"w-full bg-slate-700/30 rounded-full h-1",children:d.jsx("div",{className:"bg-gradient-to-r from-blue-500 to-purple-500 h-1 rounded-full transition-all duration-1000 ease-out",style:{width:`${(e*60-h)/(e*60)*100}%`}})})}),P&&d.jsx("div",{className:"modal-backdrop",children:d.jsx("div",{className:"modal-container",children:d.jsxs("div",{className:"modal-content bg-slate-800 border-slate-600/50 max-w-sm",children:[d.jsxs("div",{className:"text-center mb-6",children:[d.jsx("h3",{className:"text-white text-xl font-bold mb-2",children:"Want to stop now?"}),d.jsx("p",{className:"text-slate-300 text-sm leading-relaxed",children:"Stay strong - resist the craving? If you leave now, you will not get the bonus points"})]}),d.jsxs("div",{className:"flex space-x-3",children:[d.jsx("button",{onClick:Q,className:"flex-1 bg-red-600 hover:bg-red-700 text-white font-medium py-3 px-4 rounded-xl transition-colors min-h-[44px]",children:"Leave"}),d.jsx("button",{onClick:we,className:"flex-1 bg-green-600 hover:bg-green-700 text-white font-medium py-3 px-4 rounded-xl transition-colors min-h-[44px]",children:"Stay"})]})]})})})]})},iq=({isOpen:n,onClose:e,onNavigateToCravingSupport:t,onComplete:r})=>{const[s,i]=O.useState("setup"),[o,a]=O.useState({name:"INTERMEDIATE",inhale:10,exhale:20}),[l,u]=O.useState(4),[h,f]=O.useState(!1);O.useEffect(()=>{n&&(i("setup"),f(!1))},[n]);const p=x=>{a(x),i("setup")},y=x=>{u(x),i("setup")},w=()=>{f(!0),i("exercise")},S=()=>{f(!1),i("setup"),r&&r(),e()},k=()=>{s==="exercise"&&h||e()},E=()=>{console.log("🚪 User leaving breathing exercise via close button"),e(),t&&t()};return n?d.jsxs("div",{className:"modal-backdrop",children:[d.jsx("div",{className:"absolute inset-0 bg-black/80 backdrop-blur-sm",onClick:k}),d.jsx("div",{className:"modal-container",children:d.jsxs("div",{className:"modal-content bg-slate-900 border-slate-700/50 max-w-md sm:max-w-2xl mx-auto w-full",children:[!(s==="exercise"&&h)&&d.jsx("button",{onClick:k,className:"absolute top-4 left-4 z-10 w-11 h-11 flex items-center justify-center text-white hover:text-slate-300 transition-colors min-h-[44px] min-w-[44px]",children:d.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:d.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})}),s==="setup"&&d.jsx(tq,{selectedRate:o,duration:l,onRateSelect:()=>i("rate"),onDurationSelect:()=>i("duration"),onStartExercise:w}),s==="rate"&&d.jsx(nq,{selectedRate:o,onSelect:p,onBack:()=>i("setup")}),s==="duration"&&d.jsx(rq,{selectedDuration:l,onSelect:y,onBack:()=>i("setup")}),s==="exercise"&&d.jsx(sq,{rate:o,duration:l,onComplete:S,onClose:k,onLeave:E})]})})]}):null};var oq={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};const aq=n=>n.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase(),lq=(n,e)=>{const t=O.forwardRef(({color:r="currentColor",size:s=24,strokeWidth:i=2,absoluteStrokeWidth:o,children:a,...l},u)=>O.createElement("svg",{ref:u,...oq,width:s,height:s,stroke:r,strokeWidth:o?Number(i)*24/Number(s):i,className:`lucide lucide-${aq(n)}`,...l},[...e.map(([h,f])=>O.createElement(h,f)),...(Array.isArray(a)?a:[a])||[]]));return t.displayName=`${n}`,t};var Yn=lq;const cq=Yn("ArrowRight",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"m12 5 7 7-7 7",key:"xquz4c"}]]),uq=Yn("BarChart3",[["path",{d:"M3 3v18h18",key:"1s2lah"}],["path",{d:"M18 17V9",key:"2bz60n"}],["path",{d:"M13 17V5",key:"1frdt8"}],["path",{d:"M8 17v-3",key:"17ska0"}]]),$D=Yn("Calendar",[["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",ry:"2",key:"eu3xkr"}],["line",{x1:"16",x2:"16",y1:"2",y2:"6",key:"m3sa8f"}],["line",{x1:"8",x2:"8",y1:"2",y2:"6",key:"18kwsl"}],["line",{x1:"3",x2:"21",y1:"10",y2:"10",key:"xt86sb"}]]),BD=Yn("DollarSign",[["line",{x1:"12",x2:"12",y1:"2",y2:"22",key:"7eqyqh"}],["path",{d:"M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6",key:"1b0p4s"}]]),zD=Yn("Heart",[["path",{d:"M19 14c1.49-1.46 3-3.21 3-5.5A5.5 5.5 0 0 0 16.5 3c-1.76 0-3 .5-4.5 2-1.5-1.5-2.74-2-4.5-2A5.5 5.5 0 0 0 2 8.5c0 2.3 1.5 4.05 3 5.5l7 7Z",key:"c3ymky"}]]),dq=Yn("Home",[["path",{d:"m3 9 9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z",key:"y5dka4"}],["polyline",{points:"9 22 9 12 15 12 15 22",key:"e2us08"}]]),Rf=Yn("RefreshCw",[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]]),qD=Yn("Settings",[["path",{d:"M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.5a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z",key:"1qme2f"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]),rh=Yn("Shield",[["path",{d:"M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z",key:"3xmgem"}]]),hq=Yn("Sparkles",[["path",{d:"m12 3-1.912 5.813a2 2 0 0 1-1.275 1.275L3 12l5.813 1.912a2 2 0 0 1 1.275 1.275L12 21l1.912-5.813a2 2 0 0 1 1.275-1.275L21 12l-5.813-1.912a2 2 0 0 1-1.275-1.275L12 3Z",key:"17u4zn"}],["path",{d:"M5 3v4",key:"bklmnn"}],["path",{d:"M19 17v4",key:"iiml17"}],["path",{d:"M3 5h4",key:"nem4j1"}],["path",{d:"M17 19h4",key:"lbex7p"}]]),WD=Yn("Star",[["polygon",{points:"12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2",key:"8f66p6"}]]),fq=Yn("Sword",[["polyline",{points:"14.5 17.5 3 6 3 3 6 3 17.5 14.5",key:"1hfsw2"}],["line",{x1:"13",x2:"19",y1:"19",y2:"13",key:"1vrmhu"}],["line",{x1:"16",x2:"20",y1:"16",y2:"20",key:"1bron3"}],["line",{x1:"19",x2:"21",y1:"21",y2:"19",key:"13pww6"}]]),pq=Yn("Target",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["circle",{cx:"12",cy:"12",r:"6",key:"1vlfrh"}],["circle",{cx:"12",cy:"12",r:"2",key:"1c9p78"}]]),gq=Yn("TrendingUp",[["polyline",{points:"22 7 13.5 15.5 8.5 10.5 2 17",key:"126l90"}],["polyline",{points:"16 7 22 7 22 13",key:"kwv8wd"}]]),GD=Yn("Trophy",[["path",{d:"M6 9H4.5a2.5 2.5 0 0 1 0-5H6",key:"17hqa7"}],["path",{d:"M18 9h1.5a2.5 2.5 0 0 0 0-5H18",key:"lmptdp"}],["path",{d:"M4 22h16",key:"57wxv0"}],["path",{d:"M10 14.66V17c0 .55-.47.98-.97 1.21C7.85 18.75 7 20.24 7 22",key:"1nw9bq"}],["path",{d:"M14 14.66V17c0 .55.47.98.97 1.21C16.15 18.75 17 20.24 17 22",key:"1np0yb"}],["path",{d:"M18 2H6v7a6 6 0 0 0 12 0V2Z",key:"u46fv3"}]]),HD=Yn("User",[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]]),QD=Yn("Users",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["path",{d:"M22 21v-2a4 4 0 0 0-3-3.87",key:"kshegd"}],["path",{d:"M16 3.13a4 4 0 0 1 0 7.75",key:"1da9ce"}]]),mq=({user:n,behavioralService:e,onClose:t})=>{const[r,s]=O.useState(null),[i,o]=O.useState(!0),[a,l]=O.useState(30);O.useEffect(()=>{e&&(n!=null&&n.uid)&&u()},[e,n==null?void 0:n.uid,a]);const u=async()=>{try{o(!0);try{const h=await e.getUserAnalytics(n.uid,a);s(h)}catch(h){console.warn("Full analytics not available (indexes building), using basic analytics:",h.message);const f=await e.getBasicAnalytics(n.uid);s(f)}}catch(h){console.error("Error loading analytics:",h)}finally{o(!1)}};return e?d.jsx("div",{className:"modal-backdrop",children:d.jsx("div",{className:"modal-container",children:d.jsx("div",{className:"modal-content bg-slate-800 max-w-4xl",children:d.jsxs("div",{className:"modal-scrollable",children:[d.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-slate-700",children:[d.jsxs("div",{className:"flex items-center gap-3",children:[d.jsx(uq,{className:"w-6 h-6 text-blue-400"}),d.jsx("h2",{className:"text-xl font-bold text-white",children:"Behavioral Analytics"})]}),d.jsxs("div",{className:"flex items-center gap-4",children:[d.jsxs("select",{value:a,onChange:h=>l(parseInt(h.target.value)),className:"bg-slate-700 text-white px-3 py-3 rounded border border-slate-600 min-h-[44px]",children:[d.jsx("option",{value:7,children:"Last 7 days"}),d.jsx("option",{value:30,children:"Last 30 days"}),d.jsx("option",{value:90,children:"Last 90 days"})]}),d.jsx("button",{onClick:t,className:"text-gray-400 hover:text-white w-11 h-11 flex items-center justify-center min-h-[44px] min-w-[44px]",children:"✕"})]})]}),d.jsx("div",{className:"p-6",children:i?d.jsxs("div",{className:"text-center py-8",children:[d.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-400 mx-auto mb-4"}),d.jsx("p",{className:"text-gray-300",children:"Loading behavioral analytics..."})]}):r?d.jsxs("div",{className:"space-y-6",children:[d.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[d.jsx("div",{className:"bg-slate-700 rounded-lg p-4",children:d.jsxs("div",{className:"flex items-center gap-3",children:[d.jsx(pq,{className:"w-5 h-5 text-green-400"}),d.jsxs("div",{children:[d.jsx("p",{className:"text-gray-300 text-sm",children:"Craving Resistance"}),d.jsx("p",{className:"text-white font-bold",children:r.cravingStats.total>0?`${(r.cravingStats.resisted/r.cravingStats.total*100).toFixed(1)}%`:"No data"})]})]})}),d.jsx("div",{className:"bg-slate-700 rounded-lg p-4",children:d.jsxs("div",{className:"flex items-center gap-3",children:[d.jsx(gq,{className:"w-5 h-5 text-blue-400"}),d.jsxs("div",{children:[d.jsx("p",{className:"text-gray-300 text-sm",children:"Wellness Activities"}),d.jsx("p",{className:"text-white font-bold",children:r.wellnessStats.totalWellnessActivities})]})]})}),d.jsx("div",{className:"bg-slate-700 rounded-lg p-4",children:d.jsxs("div",{className:"flex items-center gap-3",children:[d.jsx($D,{className:"w-5 h-5 text-purple-400"}),d.jsxs("div",{children:[d.jsx("p",{className:"text-gray-300 text-sm",children:"Relapses"}),d.jsx("p",{className:"text-white font-bold",children:r.relapseStats.total})]})]})}),d.jsx("div",{className:"bg-slate-700 rounded-lg p-4",children:d.jsxs("div",{className:"flex items-center gap-3",children:[d.jsx("span",{className:"text-orange-400",children:"💧"}),d.jsxs("div",{children:[d.jsx("p",{className:"text-gray-300 text-sm",children:"Hydration Days"}),d.jsx("p",{className:"text-white font-bold",children:r.wellnessStats.hydrationDays})]})]})})]}),d.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[d.jsxs("div",{className:"bg-slate-700 rounded-lg p-4",children:[d.jsx("h3",{className:"text-lg font-semibold text-white mb-4",children:"Craving Patterns"}),d.jsxs("div",{className:"space-y-3",children:[d.jsxs("div",{children:[d.jsx("p",{className:"text-gray-300 text-sm",children:"Total Cravings"}),d.jsx("p",{className:"text-white font-bold",children:r.cravingStats.total})]}),d.jsxs("div",{children:[d.jsx("p",{className:"text-gray-300 text-sm",children:"Average Strength"}),d.jsxs("p",{className:"text-white font-bold",children:[r.cravingStats.averageStrength.toFixed(1),"/10"]})]}),d.jsxs("div",{children:[d.jsx("p",{className:"text-gray-300 text-sm",children:"Common Triggers"}),d.jsx("div",{className:"space-y-1",children:r.cravingStats.commonTriggers.slice(0,3).map((h,f)=>d.jsxs("p",{className:"text-blue-400 text-sm",children:[h.trigger," (",h.count,"x)"]},f))})]})]})]}),d.jsxs("div",{className:"bg-slate-700 rounded-lg p-4",children:[d.jsx("h3",{className:"text-lg font-semibold text-white mb-4",children:"Wellness Activities"}),d.jsxs("div",{className:"space-y-3",children:[d.jsxs("div",{className:"flex justify-between",children:[d.jsx("span",{className:"text-gray-300",children:"🫁 Breathing Exercises"}),d.jsx("span",{className:"text-white font-bold",children:r.wellnessStats.breathingExercises})]}),d.jsxs("div",{className:"flex justify-between",children:[d.jsx("span",{className:"text-gray-300",children:"🧘‍♀️ Meditation Sessions"}),d.jsx("span",{className:"text-white font-bold",children:r.wellnessStats.meditationSessions})]}),d.jsxs("div",{className:"flex justify-between",children:[d.jsx("span",{className:"text-gray-300",children:"🚶‍♂️ Physical Activities"}),d.jsx("span",{className:"text-white font-bold",children:r.wellnessStats.physicalActivities})]}),d.jsxs("div",{className:"flex justify-between",children:[d.jsx("span",{className:"text-gray-300",children:"💧 Hydration Goals Met"}),d.jsx("span",{className:"text-white font-bold",children:r.wellnessStats.hydrationDays})]})]})]}),d.jsxs("div",{className:"bg-slate-700 rounded-lg p-4",children:[d.jsx("h3",{className:"text-lg font-semibold text-white mb-4",children:"Time Patterns"}),d.jsxs("div",{className:"space-y-2",children:[d.jsx("p",{className:"text-gray-300 text-sm",children:"Peak Craving Hours"}),r.cravingStats.timePatterns.map((h,f)=>d.jsxs("div",{className:"flex justify-between",children:[d.jsxs("span",{className:"text-blue-400",children:[h.hour,":00"]}),d.jsxs("span",{className:"text-white",children:[h.count," cravings"]})]},f))]})]}),d.jsxs("div",{className:"bg-slate-700 rounded-lg p-4",children:[d.jsx("h3",{className:"text-lg font-semibold text-white mb-4",children:"AI Insights"}),d.jsxs("div",{className:"space-y-2",children:[r.insights.map((h,f)=>d.jsxs("p",{className:"text-gray-300 text-sm",children:["• ",h]},f)),r.insights.length===0&&d.jsx("p",{className:"text-gray-400 text-sm italic",children:"More insights will appear as you track more activities."})]})]})]}),d.jsxs("div",{className:"bg-slate-700 rounded-lg p-4",children:[d.jsx("h3",{className:"text-lg font-semibold text-white mb-4",children:"📡 System Status"}),d.jsxs("div",{className:"space-y-2 mb-4",children:[d.jsxs("div",{className:"flex items-center gap-2",children:[d.jsx("span",{className:"w-3 h-3 bg-green-500 rounded-full"}),d.jsx("span",{className:"text-gray-300 text-sm",children:"Behavioral Service Connected"})]}),d.jsxs("div",{className:"flex items-center gap-2",children:[d.jsx("span",{className:"w-3 h-3 bg-yellow-500 rounded-full animate-pulse"}),d.jsx("span",{className:"text-gray-300 text-sm",children:"Database Indexes Building (may take 5-10 minutes)"})]}),d.jsxs("div",{className:"flex items-center gap-2",children:[d.jsx("span",{className:"w-3 h-3 bg-blue-500 rounded-full"}),d.jsx("span",{className:"text-gray-300 text-sm",children:"Data Logging Active"})]})]}),d.jsx("p",{className:"text-gray-400 text-xs",children:"Full analytics will be available once indexes are built. Basic analytics are shown in the meantime."})]}),d.jsxs("div",{className:"bg-slate-700 rounded-lg p-4",children:[d.jsx("h3",{className:"text-lg font-semibold text-white mb-4",children:"Data Export"}),d.jsx("p",{className:"text-gray-300 text-sm mb-4",children:"All your behavioral data is stored in Firestore for predictive analytics and research purposes."}),d.jsx("button",{onClick:()=>{const h=new Blob([JSON.stringify(r,null,2)],{type:"application/json"}),f=URL.createObjectURL(h),p=document.createElement("a");p.href=f,p.download=`behavioral-analytics-${n.heroName}-${new Date().toISOString().split("T")[0]}.json`,p.click(),URL.revokeObjectURL(f)},className:"bg-green-600 hover:bg-green-700 text-white px-4 py-3 rounded transition-colors min-h-[44px]",children:"Export Analytics Data"})]})]}):d.jsxs("div",{className:"text-center py-8",children:[d.jsx("p",{className:"text-gray-300",children:"No analytics data available."}),d.jsx("p",{className:"text-gray-400 text-sm mt-2",children:"Start tracking activities to see insights!"})]})})]})})})}):d.jsx("div",{className:"modal-backdrop",children:d.jsx("div",{className:"modal-container",children:d.jsxs("div",{className:"modal-content bg-slate-800 p-6",children:[d.jsx("h2",{className:"text-xl font-bold text-white mb-4",children:"Analytics Dashboard"}),d.jsx("p",{className:"text-gray-300",children:"Behavioral service not available. Analytics require Firestore connection."}),d.jsx("button",{onClick:t,className:"mt-4 bg-blue-600 hover:bg-blue-700 text-white px-4 py-3 rounded transition-colors min-h-[44px]",children:"Close"})]})})})};console.log("🧪 FirestoreBuddyService import check:",!!ec);console.log("🧪 FirestoreBuddyService type:",typeof ec);console.log("🧪 FirestoreBuddyService constructor:",ec==null?void 0:ec.name);const Os=(n,e="adventurer")=>{const t="https://api.dicebear.com/7.x",r={seed:n||Math.random().toString(36).substring(7),backgroundColor:["b6e3f4","c0aede","ffdfbf","ffd5dc"],radius:50,size:200},s=new URLSearchParams(r).toString();return`${t}/${e}/svg?${s}`},Nf=n=>{const e=["#3B82F6","#10B981","#F59E0B","#EF4444","#8B5CF6","#EC4899"],t=e[n.charCodeAt(0)%e.length],r=n.substring(0,2).toUpperCase();return`data:image/svg+xml,${encodeURIComponent(`
    <svg width="200" height="200" xmlns="http://www.w3.org/2000/svg">
      <rect width="200" height="200" fill="${t}"/>
      <text x="100" y="120" font-family="Arial, sans-serif" font-size="80" font-weight="bold" text-anchor="middle" fill="white">${r}</text>
    </svg>
  `)}`},kf=n=>n<=3?"#ef4444":n<=6?"#fbbf24":n<=9?"#84cc16":"#22c55e",Ps=(n,e=new Date)=>{const t=e.getTime()-n.getTime(),r=Math.floor(t/(1e3*3600)),s=Math.floor(t/(1e3*3600*24));return r<24?{value:Math.max(0,r),unit:"hours",displayText:`${Math.max(0,r)} hour${r===1?"":"s"}`}:{value:Math.max(0,s),unit:"days",displayText:`${Math.max(0,s)} day${s===1?"":"s"}`}},yq=({onComplete:n,authUser:e,pwaInstallAvailable:t,promptInstall:r})=>{const[s,i]=O.useState(1),[o,a]=O.useState({heroName:"",archetype:"",avatar:null,avatarSeed:Math.random().toString(36).substring(7),triggers:[],dailyPatterns:[],copingStrategies:[],vapePodsPerWeek:0,nicotineStrength:"",quitAttempts:"",confidence:5}),[l,u]=O.useState(!1),[h,f]=O.useState(!1),[p,y]=O.useState(null),[w,S]=O.useState(null),k=[{id:"DETERMINED",name:"The Determined",description:"Unstoppable willpower and determination",color:"bg-red-500",icon:rh},{id:"SOCIAL_FIGHTER",name:"The Social Fighter",description:"Thrives on community support",color:"bg-blue-500",icon:QD},{id:"HEALTH_WARRIOR",name:"The Health Warrior",description:"Focused on physical and mental wellness",color:"bg-green-500",icon:zD},{id:"MONEY_SAVER",name:"The Money Saver",description:"Motivated by financial freedom",color:"bg-yellow-500",icon:BD}],E=["Stress/anxiety","Social situations","Boredom","After meals","Drinking alcohol","Work breaks","Driving"],x=["Morning routine","Work breaks","After meals","Evening wind-down","Social events","Throughout the day"],N=["Breathing exercises","Nicotine replacement therapy","Exercise/physical activity","Distraction techniques","Nothing - this is new to me"],P=()=>{console.log("Calculating stats with userData:",o);let b=40;o.vapePodsPerWeek<=1?b+=5:o.vapePodsPerWeek<=3?b+=15:o.vapePodsPerWeek<=5?b+=25:o.vapePodsPerWeek<=7?b+=35:b+=40;const _=o.nicotineStrength||"",B=parseInt(_.replace("mg",""))||0;B<=5?b+=0:B<=11?b+=10:B<=20?b+=20:b+=25,o.dailyPatterns.includes("Throughout the day")?b+=20:o.dailyPatterns.length>2?b+=10:b+=0,b=Math.min(b,100);let ve=25;o.confidence>=9?ve+=35:o.confidence>=7?ve+=25:o.confidence>=4?ve+=15:ve+=0,o.quitAttempts==="first"?ve+=15:parseInt(o.quitAttempts)<=3?ve+=10:ve+=5,o.copingStrategies.length>=3?ve+=15:o.copingStrategies.length>=1?ve+=10:ve+=0,ve=Math.min(ve,80);let Fe=35;Fe+={DETERMINED:20,HEALTH_WARRIOR:15,SOCIAL_FIGHTER:15,MONEY_SAVER:10}[o.archetype]||0,o.confidence>=8?Fe+=25:o.confidence>=5?Fe+=15:Fe+=0,o.quitAttempts==="first"?Fe+=10:parseInt(o.quitAttempts)<=3?Fe+=5:Fe+=15,Fe=Math.min(Fe,90);let Q=15;o.triggers.length<=2?Q+=15:o.triggers.length<=4?Q+=10:Q+=5;const we=o.triggers.includes("Drinking alcohol"),Se=o.triggers.includes("Social situations");return we&&Se?Q+=0:o.triggers.length>3?Q+=5:Q+=10,o.copingStrategies.length>=3?Q+=25:o.copingStrategies.length>=1?Q+=15:Q+=0,o.dailyPatterns.includes("Throughout the day")?Q+=0:o.dailyPatterns.length>2?Q+=5:Q+=10,Q=Math.min(Q,60),{addictionLevel:b,mentalStrength:ve,motivation:Fe,triggerDefense:Q}},$=b=>{const _=b.target.files[0];if(_){y(_);const B=new FileReader;B.onload=ve=>S(ve.target.result),B.readAsDataURL(_)}},L=async()=>{if(p){f(!0);try{const b=document.createElement("canvas"),_=b.getContext("2d"),B=new Image;B.onload=()=>{b.width=200,b.height=200,_.filter="contrast(1.2) saturate(1.3) brightness(1.1)",_.drawImage(B,0,0,200,200),_.globalCompositeOperation="overlay",_.fillStyle="rgba(255, 200, 200, 0.1)",_.fillRect(0,0,200,200);const ve=b.toDataURL("image/png"),Fe={...o,avatar:ve};a(Fe),A(Fe,3),f(!1)},B.src=w}catch(b){console.error("Photo processing failed:",b);const _=Nf(o.avatarSeed);a(B=>({...B,avatar:_})),f(!1)}}},R=()=>{u(!0);const b=Math.random().toString(36).substring(7);(async()=>{try{const B=Os(b),ve={...o,avatarSeed:b,avatar:B};a(ve),A(ve,3)}catch{const ve=Nf(b),Fe={...o,avatarSeed:b,avatar:ve};a(Fe),A(Fe,3)}})(),setTimeout(()=>u(!1),500)},v=async()=>{if(s<10)await A(o,s),i(s+1);else try{console.log("Completing onboarding with userData:",o);const b=P();console.log("Calculated stats:",b);const _={...o,stats:{...b,streakDays:0,experiencePoints:0},achievements:[],quitDate:new Date};await A(_,10),console.log("Final user data:",_),n(_)}catch(b){console.error("Error completing onboarding:",b);const B={...o,stats:{...{addictionLevel:50,mentalStrength:50,motivation:50,triggerDefense:30},streakDays:0,experiencePoints:0},achievements:[],quitDate:new Date};try{await A(B,10)}catch(ve){console.error("Failed to save fallback data to Firebase:",ve)}console.log("Using fallback stats:",B),n(B)}},T=()=>{s>1&&i(s-1)},C=()=>{switch(s){case 1:return o.heroName.trim().length>0;case 2:return o.archetype!=="";case 3:return o.avatar!==null;case 4:return o.triggers.length>0;case 5:return o.dailyPatterns.length>0;case 6:return o.copingStrategies.length>0;case 7:return o.vapePodsPerWeek>0;case 8:return o.nicotineStrength!=="";case 9:return o.quitAttempts!=="";case 10:return o.confidence>0;default:return!1}},A=async(b,_)=>{if(e)try{const{ref:B,set:ve}=await ke(()=>import("./index.esm-25d69fbc.js"),[]),Fe=B(K,`users/${e.uid}/onboarding`);await ve(B(K,`users/${e.uid}/onboarding/step${_}`),{...b,stepNumber:_,timestamp:Date.now()}),await ve(B(K,`users/${e.uid}/onboarding/progress`),{currentStep:_,completedSteps:Array.from({length:_},(It,Q)=>Q+1),lastUpdated:Date.now()}),console.log(`Step ${_} saved to Firebase successfully`)}catch(B){console.error(`Error saving step ${_} to Firebase:`,B)}};return O.useEffect(()=>{if(!o.avatar){const b=Os(o.avatarSeed);a(_=>({..._,avatar:b}))}},[]),d.jsx("div",{className:"min-h-screen bg-gradient-to-br from-slate-900 via-blue-900 to-slate-900 flex items-center justify-center p-4",children:d.jsxs("div",{className:"bg-slate-800/80 backdrop-blur-sm rounded-2xl p-8 max-w-md w-full shadow-2xl border border-slate-700",children:[t&&d.jsxs("div",{className:"mb-4 p-3 rounded-lg border border-blue-600 bg-blue-900/40 text-blue-100 flex items-center justify-between",children:[d.jsx("div",{className:"mr-3",children:"Install QuitArena for a faster, full-screen experience."}),d.jsx("button",{onClick:r,className:"px-4 py-3 rounded-md bg-blue-600 hover:bg-blue-500 text-white text-sm font-semibold min-h-[44px] min-w-[44px]",children:"Install"})]}),d.jsx("div",{className:"flex justify-between items-center mb-8 overflow-x-auto",children:[1,2,3,4,5,6,7,8,9,10].map(b=>d.jsxs("div",{className:"flex items-center flex-shrink-0",children:[d.jsx("div",{className:`w-6 h-6 rounded-full flex items-center justify-center text-xs font-bold ${b<=s?"bg-blue-500 text-white":"bg-slate-600 text-gray-400"}`,children:b<s?"✓":b}),b<10&&d.jsx("div",{className:`w-4 h-1 mx-1 ${b<s?"bg-blue-500":"bg-slate-600"}`})]},b))}),s===1&&d.jsxs("div",{className:"text-center",children:[d.jsx("div",{className:"w-20 h-20 bg-gradient-to-br from-blue-400 to-blue-600 rounded-full flex items-center justify-center mx-auto mb-6",children:d.jsx(hq,{className:"w-10 h-10 text-white"})}),d.jsx("h1",{className:"text-2xl font-bold text-white mb-4",children:"Welcome to QuitCard Arena"}),d.jsx("p",{className:"text-gray-300 mb-6",children:"Your journey to freedom starts here. Let's create your hero identity."}),d.jsxs("div",{className:"mb-6",children:[d.jsx("label",{className:"block text-left text-white text-sm font-medium mb-2",children:"What's your hero name?"}),d.jsx("input",{type:"text",value:o.heroName,onChange:b=>{const _={...o,heroName:b.target.value};a(_),b.target.value.trim().length>0&&A(_,1)},placeholder:"e.g., FreedomSeeker, HealthGuardian",autoComplete:"name",className:"w-full px-4 py-3 bg-slate-700 border border-slate-600 rounded-lg text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]})]}),s===2&&d.jsxs("div",{className:"text-center",children:[d.jsx("div",{className:"w-20 h-20 bg-gradient-to-br from-green-400 to-green-600 rounded-full flex items-center justify-center mx-auto mb-6",children:d.jsx(rh,{className:"w-10 h-10 text-white"})}),d.jsx("h1",{className:"text-2xl font-bold text-white mb-4",children:"Choose Your Archetype"}),d.jsx("p",{className:"text-gray-300 mb-6",children:"Select the warrior type that resonates with your journey."}),d.jsx("div",{className:"space-y-3 mb-6",children:k.map(b=>{const _=b.icon;return d.jsx("button",{onClick:()=>{const B={...o,archetype:b.id};a(B),A(B,2)},className:`w-full p-4 rounded-lg border-2 transition-all duration-300 text-left ${o.archetype===b.id?"border-blue-500 bg-blue-500/20":"border-slate-600 bg-slate-700 hover:border-slate-500"}`,children:d.jsxs("div",{className:"flex items-center gap-3",children:[d.jsx("div",{className:`w-10 h-10 ${b.color} rounded-lg flex items-center justify-center`,children:d.jsx(_,{className:"w-5 h-5 text-white"})}),d.jsxs("div",{children:[d.jsx("h3",{className:"text-white font-semibold",children:b.name}),d.jsx("p",{className:"text-gray-400 text-sm",children:b.description})]})]})},b.id)})})]}),s===3&&d.jsxs("div",{className:"text-center",children:[d.jsx("div",{className:"w-20 h-20 bg-gradient-to-br from-purple-400 to-purple-600 rounded-full flex items-center justify-center mx-auto mb-6",children:d.jsx(HD,{className:"w-10 h-10 text-white"})}),d.jsx("h1",{className:"text-2xl font-bold text-white mb-4",children:"Create Your Avatar"}),d.jsx("p",{className:"text-gray-300 mb-6",children:"Choose your battle card identity in the arena."}),d.jsxs("div",{className:"mb-6",children:[d.jsx("div",{className:"w-32 h-32 mx-auto mb-4 rounded-full overflow-hidden border-4 border-slate-600 bg-slate-700",children:o.avatar?d.jsx("img",{src:o.avatar,alt:"Avatar",className:"w-full h-full object-cover",onError:()=>{a(b=>({...b,avatar:Nf(b.avatarSeed)}))}}):d.jsx("div",{className:"w-full h-full flex items-center justify-center",children:d.jsx(Rf,{className:"w-8 h-8 text-gray-400 animate-spin"})})}),d.jsxs("div",{className:"space-y-3",children:[d.jsxs("div",{className:"mb-4",children:[d.jsx("label",{className:"block text-white text-sm font-medium mb-2",children:"Upload Your Photo"}),d.jsx("input",{type:"file",accept:"image/*",onChange:$,className:"hidden",id:"photo-upload",autoComplete:"photo"}),d.jsx("label",{htmlFor:"photo-upload",className:"w-full px-6 py-3 bg-green-600 hover:bg-green-700 text-white rounded-lg transition-colors flex items-center gap-2 justify-center cursor-pointer",children:"📷 Upload Photo"})]}),w&&d.jsx("div",{className:"mb-4",children:d.jsx("button",{onClick:L,disabled:h,className:"w-full px-6 py-3 bg-purple-600 hover:bg-purple-700 disabled:bg-purple-800 text-white rounded-lg transition-colors flex items-center gap-2 justify-center",children:h?d.jsxs(d.Fragment,{children:[d.jsx(Rf,{className:"w-4 h-4 animate-spin"}),"Converting to Anime..."]}):d.jsx(d.Fragment,{children:"✨ Convert to Anime"})})}),d.jsx("div",{className:"text-gray-400 text-sm",children:"- OR -"}),d.jsx("button",{onClick:R,disabled:l,className:"w-full px-6 py-3 bg-slate-600 hover:bg-slate-500 disabled:bg-slate-700 text-white rounded-lg transition-colors flex items-center gap-2 justify-center",children:l?d.jsxs(d.Fragment,{children:[d.jsx(Rf,{className:"w-4 h-4 animate-spin"}),"Generate Random Avatar"]}):d.jsxs(d.Fragment,{children:[d.jsx(Rf,{className:"w-4 h-4"}),"Generate Random Avatar"]})}),d.jsx("button",{onClick:()=>{const b=Nf(o.avatarSeed),_={...o,avatar:b};a(_),A(_,3)},className:"w-full px-6 py-3 bg-blue-600 hover:bg-blue-700 text-white rounded-lg transition-colors",children:"Use Fallback Avatar"})]})]})]}),s===4&&d.jsxs("div",{className:"text-center",children:[d.jsx("div",{className:"w-20 h-20 bg-gradient-to-br from-orange-400 to-orange-600 rounded-full flex items-center justify-center mx-auto mb-6",children:d.jsx("span",{className:"text-2xl",children:"🎯"})}),d.jsx("h1",{className:"text-2xl font-bold text-white mb-4",children:"Trigger Identification"}),d.jsx("p",{className:"text-gray-300 mb-6",children:"What usually makes you want to vape? (Select all that apply)"}),d.jsx("div",{className:"space-y-3 mb-6",children:E.map(b=>d.jsx("button",{onClick:()=>{const _={...o,triggers:o.triggers.includes(b)?o.triggers.filter(B=>B!==b):[...o.triggers,b]};a(_),A(_,4)},className:`w-full p-4 rounded-lg border-2 transition-all duration-300 text-left ${o.triggers.includes(b)?"border-blue-500 bg-blue-500/20":"border-slate-600 bg-slate-700 hover:border-slate-500"}`,children:d.jsxs("div",{className:"flex items-center gap-3",children:[d.jsx("div",{className:`w-6 h-6 rounded border-2 flex items-center justify-center ${o.triggers.includes(b)?"bg-blue-500 border-blue-500":"border-gray-400"}`,children:o.triggers.includes(b)&&d.jsx("span",{className:"text-white text-sm",children:"✓"})}),d.jsx("span",{className:"text-white font-semibold",children:b})]})},b))})]}),s===5&&d.jsxs("div",{className:"text-center",children:[d.jsx("div",{className:"w-20 h-20 bg-gradient-to-br from-indigo-400 to-indigo-600 rounded-full flex items-center justify-center mx-auto mb-6",children:d.jsx("span",{className:"text-2xl",children:"📅"})}),d.jsx("h1",{className:"text-2xl font-bold text-white mb-4",children:"Daily Routine"}),d.jsx("p",{className:"text-gray-300 mb-6",children:"When do you vape most? (Select all that apply)"}),d.jsx("div",{className:"space-y-3 mb-6",children:x.map(b=>d.jsx("button",{onClick:()=>{const _={...o,dailyPatterns:o.dailyPatterns.includes(b)?o.dailyPatterns.filter(B=>B!==b):[...o.dailyPatterns,b]};a(_),A(_,5)},className:`w-full p-4 rounded-lg border-2 transition-all duration-300 text-left ${o.dailyPatterns.includes(b)?"border-blue-500 bg-blue-500/20":"border-slate-600 bg-slate-700 hover:border-slate-500"}`,children:d.jsxs("div",{className:"flex items-center gap-3",children:[d.jsx("div",{className:`w-6 h-6 rounded border-2 flex items-center justify-center ${o.dailyPatterns.includes(b)?"bg-blue-500 border-blue-500":"border-gray-400"}`,children:o.dailyPatterns.includes(b)&&d.jsx("span",{className:"text-white text-sm",children:"✓"})}),d.jsx("span",{className:"text-white font-semibold",children:b})]})},b))})]}),s===6&&d.jsxs("div",{className:"text-center",children:[d.jsx("div",{className:"w-20 h-20 bg-gradient-to-br from-teal-400 to-teal-600 rounded-full flex items-center justify-center mx-auto mb-6",children:d.jsx("span",{className:"text-2xl",children:"🛡️"})}),d.jsx("h1",{className:"text-2xl font-bold text-white mb-4",children:"Coping Experience"}),d.jsx("p",{className:"text-gray-300 mb-6",children:"Have you tried any of these strategies before? (Select all that apply)"}),d.jsx("div",{className:"space-y-3 mb-6",children:N.map(b=>d.jsx("button",{onClick:()=>{const _={...o,copingStrategies:o.copingStrategies.includes(b)?o.copingStrategies.filter(B=>B!==b):[...o.copingStrategies,b]};a(_),A(_,6)},className:`w-full p-4 rounded-lg border-2 transition-all duration-300 text-left ${o.copingStrategies.includes(b)?"border-blue-500 bg-blue-500/20":"border-slate-600 bg-slate-700 hover:border-slate-500"}`,children:d.jsxs("div",{className:"flex items-center gap-3",children:[d.jsx("div",{className:`w-6 h-6 rounded border-2 flex items-center justify-center ${o.copingStrategies.includes(b)?"bg-blue-500 border-blue-500":"border-gray-400"}`,children:o.copingStrategies.includes(b)&&d.jsx("span",{className:"text-white text-sm",children:"✓"})}),d.jsx("span",{className:"text-white font-semibold",children:b})]})},b))})]}),s===7&&d.jsxs("div",{className:"text-center",children:[d.jsx("div",{className:"w-20 h-20 bg-gradient-to-br from-red-400 to-red-600 rounded-full flex items-center justify-center mx-auto mb-6",children:d.jsx("span",{className:"text-2xl",children:"🚬"})}),d.jsx("h1",{className:"text-2xl font-bold text-white mb-4",children:"Vape Usage"}),d.jsx("p",{className:"text-gray-300 mb-6",children:"How many vape pods do you typically use per week?"}),d.jsx("div",{className:"mb-6",children:d.jsxs("select",{value:o.vapePodsPerWeek,onChange:b=>{const _={...o,vapePodsPerWeek:parseFloat(b.target.value)||0};a(_),_.vapePodsPerWeek>0&&A(_,7)},className:"w-full px-4 py-3 bg-slate-700 border border-slate-600 rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-red-500 focus:border-transparent",children:[d.jsx("option",{value:"",children:"Select pods per week"}),d.jsx("option",{value:"0.5",children:"0.5 pods"}),d.jsx("option",{value:"1",children:"1 pod"}),d.jsx("option",{value:"2",children:"2 pods"}),d.jsx("option",{value:"3",children:"3 pods"}),d.jsx("option",{value:"4",children:"4 pods"}),d.jsx("option",{value:"5",children:"5 pods"}),d.jsx("option",{value:"6",children:"6 pods"}),d.jsx("option",{value:"7",children:"7 pods"}),d.jsx("option",{value:"8",children:"8+ pods"})]})})]}),s===8&&d.jsxs("div",{className:"text-center",children:[d.jsx("div",{className:"w-20 h-20 bg-gradient-to-br from-orange-400 to-orange-600 rounded-full flex items-center justify-center mx-auto mb-6",children:d.jsx("span",{className:"text-2xl",children:"⚡"})}),d.jsx("h1",{className:"text-2xl font-bold text-white mb-4",children:"Nicotine Strength"}),d.jsx("p",{className:"text-gray-300 mb-6",children:"What nicotine strength do you typically use?"}),d.jsx("div",{className:"mb-6",children:d.jsxs("select",{value:o.nicotineStrength,onChange:b=>{const _={...o,nicotineStrength:b.target.value};a(_),_.nicotineStrength&&A(_,8)},className:"w-full px-4 py-3 bg-slate-700 border border-slate-600 rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-orange-500 focus:border-transparent",children:[d.jsx("option",{value:"",children:"Select nicotine strength"}),d.jsx("option",{value:"3mg",children:"3mg"}),d.jsx("option",{value:"6mg",children:"6mg"}),d.jsx("option",{value:"12mg",children:"12mg"}),d.jsx("option",{value:"18mg",children:"18mg"}),d.jsx("option",{value:"20mg",children:"20mg"}),d.jsx("option",{value:"50mg",children:"50mg"})]})})]}),s===9&&d.jsxs("div",{className:"text-center",children:[d.jsx("div",{className:"w-20 h-20 bg-gradient-to-br from-blue-400 to-blue-600 rounded-full flex items-center justify-center mx-auto mb-6",children:d.jsx("span",{className:"text-2xl",children:"📚"})}),d.jsx("h1",{className:"text-2xl font-bold text-white mb-4",children:"Previous Attempts"}),d.jsx("p",{className:"text-gray-300 mb-6",children:"How many times have you tried to quit before?"}),d.jsx("div",{className:"mb-6",children:d.jsxs("select",{value:o.quitAttempts,onChange:b=>{const _={...o,quitAttempts:b.target.value};a(_),_.quitAttempts&&A(_,9)},className:"w-full px-4 py-3 bg-slate-700 border border-slate-600 rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[d.jsx("option",{value:"",children:"Select option"}),d.jsx("option",{value:"first",children:"This is my first attempt"}),d.jsx("option",{value:"1",children:"Once before"}),d.jsx("option",{value:"2",children:"Twice before"}),d.jsx("option",{value:"3",children:"3-5 times"}),d.jsx("option",{value:"5",children:"More than 5 times"})]})})]}),s===10&&d.jsxs("div",{className:"text-center",children:[d.jsx("div",{className:"w-20 h-20 bg-gradient-to-br from-green-400 to-green-600 rounded-full flex items-center justify-center mx-auto mb-6",children:d.jsx("span",{className:"text-2xl",children:"🎯"})}),d.jsx("h1",{className:"text-2xl font-bold text-white mb-4",children:"Confidence Level"}),d.jsx("p",{className:"text-gray-300 mb-6",children:"How confident are you this time? (1-10 scale)"}),d.jsxs("div",{className:"mb-6",children:[d.jsxs("div",{className:"flex items-center gap-4",children:[d.jsx("span",{className:"text-gray-400 text-sm",children:"1"}),d.jsx("input",{type:"range",min:"1",max:"10",value:o.confidence,onChange:b=>{const _={...o,confidence:parseInt(b.target.value)};a(_),A(_,10)},className:"flex-1 h-2 rounded-lg appearance-none cursor-pointer slider",style:{background:`linear-gradient(to right, ${kf(o.confidence)} 0%, ${kf(o.confidence)} ${o.confidence/10*100}%, #475569 ${o.confidence/10*100}%, #475569 100%)`},autoComplete:"off"}),d.jsx("span",{className:"text-gray-400 text-sm",children:"10"})]}),d.jsxs("div",{className:"text-center mt-4",children:[d.jsx("span",{className:"font-bold text-4xl",style:{color:kf(o.confidence)},children:o.confidence}),d.jsx("span",{className:"text-gray-400 text-lg ml-2",children:"/ 10"})]}),d.jsx("div",{className:"text-center mt-2",children:d.jsx("span",{className:"text-sm font-medium",style:{color:kf(o.confidence)},children:o.confidence<=3?"You can do this! 💪":o.confidence<=6?"Good confidence! 🎯":o.confidence<=9?"Great confidence! 🚀":"Excellent confidence! 🌟"})})]})]}),d.jsxs("div",{className:"flex justify-between",children:[s>1&&d.jsx("button",{onClick:T,className:"px-6 py-3 bg-slate-600 hover:bg-slate-500 text-white rounded-lg transition-colors",children:"Back"}),d.jsxs("button",{onClick:v,disabled:!C(),className:`ml-auto px-6 py-3 rounded-lg transition-colors flex items-center gap-2 ${C()?"bg-blue-600 hover:bg-blue-700 text-white":"bg-slate-700 text-gray-400 cursor-not-allowed"}`,children:[s===10?"Start Journey":"Next",d.jsx(cq,{className:"w-4 h-4"})]})]})]})})},Ob={DETERMINED:{name:"The Determined",color:"bg-red-500",icon:rh},SOCIAL_FIGHTER:{name:"The Social Fighter",color:"bg-blue-500",icon:QD},HEALTH_WARRIOR:{name:"The Health Warrior",color:"bg-green-500",icon:zD},MONEY_SAVER:{name:"The Money Saver",color:"bg-yellow-500",icon:BD}},_q={COMMON:{name:"Common",color:"border-gray-400",glow:"",days:0},UNCOMMON:{name:"Uncommon",color:"border-gray-300",glow:"shadow-lg",days:7},RARE:{name:"Rare",color:"border-yellow-400",glow:"shadow-yellow-400/50 shadow-lg",days:14},EPIC:{name:"Epic",color:"border-purple-400",glow:"shadow-purple-400/50 shadow-xl",days:30},LEGENDARY:{name:"Legendary",color:"border-orange-400",glow:"shadow-orange-400/50 shadow-2xl animate-pulse",days:90}},Lb={WEEK_WARRIOR:{name:"Week Warrior",icon:$D,description:"7 days clean"},MONTH_MASTER:{name:"Month Master",icon:GD,description:"30 days clean"},LEGEND:{name:"Legend",icon:WD,description:"90 days clean"}},vq=n=>n>=90?"LEGENDARY":n>=30?"EPIC":n>=14?"RARE":n>=7?"UNCOMMON":"COMMON",wq=({isOpen:n,onClose:e,statType:t})=>{if(!n)return null;const s={addiction:{title:"Addiction",description:"Your body's dependence level - decreases with clean time, increases with relapses",impacts:["What decreases it:","• Clean time: -2 points per week","","What increases it:","• First relapse (after clean period): +4 points","• Second relapse (within 7 days): +6 additional points","• Third relapse and on (within 3 days): +8 additional points","","Note: Escalation level resets after 7 clean days"]},mentalStrength:{title:"Mental Strength",description:"Your ability to resist urges and stay strong",impacts:["What increases it:","• Successful craving resistance: +1 point","• Using app during cravings every 3 times with no relapse: +1 point","• Completing breathing exercises 3 days straight: +1 point","• Staying hydrated for 3 days straight: +1 point","• Milestone bonuses: First 7 days +5 points, 30 days +10 points, 90 days +15 points","","What decreases it:","• Giving in to cravings: -3 points","• Each relapse: -3 points"]},motivation:{title:"Motivation",description:"Your drive to quit - boosted by staying engaged",impacts:["What increases it:","• Regular logging (3+ days per week): +2 points (weekly)","• Sharing achievements: +3 points per share (weekly)","","What decreases it:","• Long periods inactive (7+ days no logging): -3 points"]},triggerDefense:{title:"Trigger Defense",description:"Protection against your personal vaping triggers",impacts:["What increases it:","• Surviving trigger situations without vaping: +3 points","• Pre-planning for known triggers: +1 point","• Updating your trigger list: +1 point","","What decreases it:","• Relapsing to known triggers: -3 points","• Entering trigger situations unprepared: -1 point"]}}[t];return s?d.jsxs("div",{className:"modal-backdrop",children:[d.jsx("div",{className:"absolute inset-0 bg-black/80 backdrop-blur-sm",onClick:e}),d.jsx("div",{className:"modal-container",children:d.jsxs("div",{className:"modal-content bg-slate-800 border-slate-700",children:[d.jsxs("div",{className:"text-center mb-4",children:[d.jsx("h3",{className:"text-xl font-bold text-white mb-2",children:s.title}),d.jsx("p",{className:"text-gray-300 text-sm",children:s.description})]}),d.jsxs("div",{className:"mb-6",children:[d.jsx("h4",{className:"text-white font-semibold mb-3 text-left",children:"What impacts it:"}),d.jsx("ul",{className:"space-y-2 text-left",children:s.impacts.map((i,o)=>d.jsxs("li",{className:"text-gray-300 text-sm flex items-start",children:[d.jsx("span",{className:"text-blue-400 mr-2",children:"•"}),i]},o))})]}),d.jsx("button",{onClick:e,className:"w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 rounded-lg transition-all duration-300 min-h-[44px]",children:"Got it"})]})})]}):null},Pf=({label:n,value:e,max:t,color:r,statType:s,onInfoClick:i})=>{const o=Math.min(e,t);return d.jsxs("div",{className:"mb-0.5 sm:mb-1",children:[d.jsxs("div",{className:"flex justify-between text-white text-xs mb-1",children:[d.jsxs("div",{className:"flex items-center gap-1",children:[d.jsx("span",{className:"text-xs sm:text-xs",children:n}),s&&i&&d.jsx("button",{onClick:()=>i(s),className:"info-button w-0.5 h-0.5 sm:w-1 sm:h-1 bg-blue-600 hover:bg-blue-700 rounded-full flex items-center justify-center text-white text-xs font-bold",style:{fontSize:"4px"},title:`Learn about ${n}`,children:"i"})]}),d.jsxs("span",{className:"text-xs",children:[o,"/",t]})]}),d.jsx("div",{className:"stat-bar-interactive w-full bg-gray-700 rounded-full h-1.5 sm:h-2",children:d.jsx("div",{className:`${r} h-1.5 sm:h-2 rounded-full transition-all duration-500`,style:{width:`${o/t*100}%`}})})]})},Mb=({user:n,isNemesis:e=!1,showComparison:t=!1,nemesisUser:r=null,onInfoClick:s})=>{const[i,o]=O.useState(!1),[a,l]=O.useState(null),[u,h]=O.useState([]),[f,p]=O.useState({});if(O.useEffect(()=>{let L=!1;return(async()=>{try{if(n&&n.uid)if(n.specialFeatures)L||(Array.isArray(n.specialFeatures)?(h(n.specialFeatures),p({})):n.specialFeatures&&n.specialFeatures.features?(h(n.specialFeatures.features),p(n.specialFeatures.categories||{})):(h([]),p({})));else{const v=await k(n);L||(Array.isArray(v)?(h(v),p({})):v&&v.features?(h(v.features),p(v.categories||{})):(h([]),p({})))}else L||(h([]),p({}))}catch(v){console.error("❌ TradingCard: Error loading Special Features:",v),L||(h([]),p({}))}})(),()=>{L=!0}},[n==null?void 0:n.uid,n==null?void 0:n.specialFeatures,n==null?void 0:n.triggers,n==null?void 0:n.dailyPatterns,n==null?void 0:n.copingStrategies]),n.isEmpty)return d.jsx("div",{className:"w-80 h-[520px] bg-slate-800 rounded-xl border-2 border-slate-600 p-4 text-white text-center mx-auto flex items-center justify-center",children:d.jsxs("div",{className:"text-center",children:[d.jsx("div",{className:"w-24 h-24 bg-slate-700 rounded-full flex items-center justify-center mx-auto mb-4",children:d.jsx("span",{className:"text-4xl text-slate-400",children:"🔍"})}),d.jsx("h3",{className:"text-slate-300 text-lg font-semibold mb-2",children:"Looking for a buddy"}),d.jsx("p",{className:"text-slate-400 text-sm leading-relaxed",children:"We'll find you a match soon"})]})});if(!n||!n.archetype||!n.stats)return d.jsx("div",{className:"w-80 h-[520px] bg-slate-800 rounded-xl border-2 border-gray-400 p-4 text-white text-center mx-auto flex items-center justify-center",children:d.jsx("div",{className:"animate-pulse",children:"Loading Card..."})});const y=Ob[n.archetype];if(!y)return console.error("Invalid archetype:",n.archetype,"Available:",Object.keys(Ob)),d.jsx("div",{className:"w-80 h-[520px] bg-slate-800 rounded-xl border-2 border-red-400 p-4 text-white text-center mx-auto flex items-center justify-center",children:d.jsxs("div",{children:[d.jsx("h3",{className:"text-red-400 mb-2",children:"Invalid Archetype"}),d.jsx("p",{className:"text-gray-300 text-sm",children:n.archetype})]})});const w=_q[vq(n.stats.streakDays)],S=y.icon;async function k(L){if(L!=null&&L.isRealBuddy){try{const{ref:_,get:B}=await ke(()=>import("./index.esm-25d69fbc.js"),[]),ve=_(K,`users/${L.uid}/stats`),Fe=await B(ve);if(Fe.exists()){const we=Fe.val();if(we.specialFeatures&&Array.isArray(we.specialFeatures))return we.specialFeatures}const It=_(K,`users/${L.uid}/specialFeatures`),Q=await B(It);if(Q.exists())return Q.val()}catch(_){console.warn("⚠️ TradingCard: Could not load centralized Special Features for buddy:",_.message)}return["Freedom Chaser","Nicotine Fighter","Health Seeker","Willpower Warrior"]}let R=null;if(L.uid)try{const{ref:_,get:B}=await ke(()=>import("./index.esm-25d69fbc.js"),[]),ve=_(K,`users/${L.uid}/specialFeatures`),Fe=await B(ve);Fe.exists()&&(R=Fe.val())}catch(_){console.error("Error fetching special features from Firebase:",_)}if(!R){const _=`specialFeatures_${L.heroName||L.id||"default"}`,B=localStorage.getItem(_);B&&(R=JSON.parse(B))}if(R){if(Array.isArray(R))return R;if(R&&R.features)return R}const v=[],T={};for(L.triggers&&L.triggers.length>0&&L.triggers.forEach(_=>{let B="";switch(_){case"Stress/anxiety":B="Stress Vaper";break;case"Social situations":B="Social Vaper";break;case"Boredom":B="Boredom Fighter";break;case"After meals":B="Habit Former";break;case"Drinking alcohol":B="Party Animal";break;case"Work breaks":B="Work Breaker";break;case"Driving":B="Driving Vaper";break;default:B="Trigger Aware"}B&&!v.includes(B)&&(v.push(B),T[B]="triggers")}),L.dailyPatterns&&L.dailyPatterns.length>0&&L.dailyPatterns.forEach(_=>{let B="";switch(_){case"Morning routine":B="Morning Struggler";break;case"Evening wind-down":B="Night Owl";break;case"Throughout the day":B="All-Day Warrior";break;default:B="Routine Builder"}B&&!v.includes(B)&&(v.push(B),T[B]="dailyPatterns")}),L.copingStrategies&&L.copingStrategies.length>0&&(L.copingStrategies.includes("Nothing - this is new to me")?(v.push("First Timer"),T["First Timer"]="copingStrategies"):L.copingStrategies.length>2?(v.push("Veteran Quitter"),T["Veteran Quitter"]="copingStrategies"):(v.push("Cold Turkey"),T["Cold Turkey"]="copingStrategies"));v.length<4;){const _=[{name:"Nicotine Fighter",category:"copingStrategies"},{name:"Health Seeker",category:"copingStrategies"},{name:"Freedom Chaser",category:"copingStrategies"},{name:"Willpower Warrior",category:"copingStrategies"}],B=_[Math.floor(Math.random()*_.length)];v.includes(B.name)||(v.push(B.name),T[B.name]=B.category)}const C=v.slice(0,4),A={};C.forEach(_=>{A[_]=T[_]||"copingStrategies"});const b={features:C,categories:A};if(L.uid)try{const{ref:_,set:B}=await ke(()=>import("./index.esm-25d69fbc.js"),[]),ve=_(K,`users/${L.uid}/specialFeatures`);await B(ve,b),console.log("Special features with categories saved to Firebase successfully")}catch(_){console.error("Error saving special features to Firebase:",_);const B=`specialFeatures_${L.heroName||L.id||"default"}`;localStorage.setItem(B,JSON.stringify(b))}else{const _=`specialFeatures_${L.heroName||L.id||"default"}`;localStorage.setItem(_,JSON.stringify(C))}return C}const E=n.stats.addictionLevel||50,x=n.stats.mentalStrength||50,N=n.stats.motivation||50,P=n.stats.triggerDefense||30;n.stats.nemesisVictories||(Math.floor(Math.random()*8)+1,Math.floor(Math.random()*5)+1);const $=L=>{l(L),o(!0)};return d.jsxs(d.Fragment,{children:[d.jsxs("div",{className:`touch-card relative w-72 sm:w-80 min-h-[480px] sm:min-h-[520px] rounded-xl ${w.color} border-4 ${w.glow} bg-gradient-to-br from-slate-800 to-slate-900 p-3 sm:p-4 mx-auto`,children:[d.jsxs("div",{className:"text-center mb-3",children:[d.jsx("h3",{className:"text-white font-bold text-sm sm:text-lg leading-tight break-words px-1",children:n.heroName}),d.jsx("p",{className:"text-gray-300 text-xs sm:text-base",children:y.name})]}),d.jsx("div",{className:"w-20 h-20 sm:w-24 sm:h-24 mx-auto mb-3 sm:mb-4 rounded-full overflow-hidden bg-slate-700 flex items-center justify-center ring-2 ring-blue-400/50",children:n.avatar?d.jsx("img",{src:n.avatar,alt:"Avatar",className:"w-full h-full object-cover",onError:()=>{console.log("Avatar failed to load, using fallback")}}):d.jsx("div",{className:`w-full h-full ${y.color} flex items-center justify-center`,children:d.jsx(S,{className:"w-12 h-12 text-white"})})}),d.jsxs("div",{className:"mb-2 sm:mb-3",children:[d.jsx(Pf,{label:"Addiction",value:E,max:100,color:"bg-red-500",statType:e?null:"addiction",onInfoClick:e?null:$}),d.jsx(Pf,{label:"Mental Strength",value:x,max:100,color:"bg-blue-500",statType:e?null:"mentalStrength",onInfoClick:e?null:$}),d.jsx(Pf,{label:"Motivation",value:N,max:100,color:"bg-green-500",statType:e?null:"motivation",onInfoClick:e?null:$}),d.jsx(Pf,{label:"Trigger Defense",value:P,max:100,color:"bg-orange-500",statType:e?null:"triggerDefense",onInfoClick:e?null:$})]}),d.jsxs("div",{className:"mb-4",children:[d.jsx("h4",{className:"text-white text-xs font-semibold mb-2 text-center",children:"Special Features"}),d.jsx("div",{className:"flex flex-wrap gap-1 justify-center",children:u.map((L,R)=>{const v=f[L]||"copingStrategies",T=C=>{switch(C){case"triggers":return"bg-yellow-500/80";case"dailyPatterns":return"bg-orange-500/80";case"copingStrategies":default:return"bg-blue-600/80"}};return d.jsx("div",{className:`px-2 py-1 ${T(v)} text-white text-xs rounded-full font-medium`,title:`${L} (${v})`,children:L},R)})})]}),d.jsxs("div",{className:"absolute bottom-6 sm:bottom-8 left-2 sm:left-3 right-2 sm:right-3 bg-black/30 rounded-lg p-2 sm:p-3 space-y-2 sm:space-y-3 backdrop-blur-sm",children:[d.jsxs("div",{className:"flex justify-between text-white text-xs sm:text-sm",children:[d.jsx("span",{className:"text-gray-300",children:"Streak:"}),d.jsxs("span",{className:"font-bold text-green-400 flex items-center gap-1",children:[(()=>{if(n.stats.streakDisplayText)return n.stats.streakDisplayText;const L=n.stats.streakDays;return`${L} day${L===1?"":"s"}`})(),n.stats.streakDays>0&&d.jsx("span",{className:"text-xs",children:"🔥"})]})]}),d.jsxs("div",{className:"flex justify-between text-white text-xs sm:text-sm",children:[d.jsx("span",{className:"text-gray-300",children:"Cravings Resisted:"}),d.jsxs("span",{className:"font-bold text-blue-400 flex items-center gap-1",children:[n.stats.cravingsResisted||0,d.jsx("span",{className:"text-xs",children:"💪"})]})]})]}),n.achievements&&n.achievements.length>0&&d.jsxs("div",{className:"flex flex-wrap gap-1 justify-center",children:[n.achievements.slice(0,4).map((L,R)=>{var T,C;const v=((T=Lb[L])==null?void 0:T.icon)||WD;return d.jsx("div",{className:"w-5 h-5 sm:w-6 sm:h-6 bg-yellow-500 rounded-full flex items-center justify-center shadow-lg",title:(C=Lb[L])==null?void 0:C.description,children:d.jsx(v,{className:"w-2.5 h-2.5 sm:w-3 sm:h-3 text-white"})},R)}),n.achievements.length>4&&d.jsxs("div",{className:"w-5 h-5 sm:w-6 sm:h-6 bg-gray-500 rounded-full flex items-center justify-center text-white text-xs font-bold",children:["+",n.achievements.length-4]})]})]}),d.jsx(wq,{isOpen:i,onClose:()=>o(!1),statType:a})]})},xq=({activeTab:n,onTabChange:e,dataLoadingState:t,onRefreshData:r,offlineManager:s})=>{const i=[{id:"arena",label:"Arena",icon:dq},{id:"craving-support",label:"Craving Support",icon:rh},{id:"profile",label:"Profile",icon:HD},{id:"settings",label:"Explore",icon:qD}];return d.jsx(d.Fragment,{children:d.jsx("div",{className:"fixed bottom-0 left-0 right-0 bg-slate-800 border-t border-slate-700 px-4 py-2 z-40",children:d.jsx("div",{className:"flex justify-around max-w-md mx-auto",children:i.map(o=>{const a=o.icon,l=n===o.id;return d.jsxs("button",{onClick:()=>e(o.id),className:`tab-interactive flex flex-col items-center min-h-[44px] min-w-[44px] justify-center ${l?"text-blue-400":"text-gray-400 hover:text-blue-300"}`,children:[d.jsx(a,{className:"w-5 h-5"}),d.jsx("span",{className:"text-xs",children:o.label})]},o.id)})})})})},Iq=({user:n,userStats:e,nemesis:t,onBackToLogin:r,onResetForTesting:s,buddyLoading:i,buddyError:o,realBuddy:a,loadRealBuddy:l,buddyLoadAttempted:u})=>{if(!n)return console.warn("ArenaView: user prop is undefined"),d.jsx("div",{className:"min-h-screen bg-gradient-to-br from-slate-900 via-blue-900 to-slate-900 py-8 pb-20",children:d.jsx("div",{className:"max-w-7xl mx-auto px-4",children:d.jsxs("div",{className:"text-center text-white",children:[d.jsx("h1",{className:"text-2xl font-bold mb-4",children:"Loading User Data..."}),d.jsx("p",{children:"Please wait while we load your profile information."})]})})});if(!t)return console.warn("ArenaView: nemesis prop is undefined"),d.jsx("div",{className:"min-h-screen bg-gradient-to-br from-slate-900 via-blue-900 to-slate-900 py-8 pb-20",children:d.jsx("div",{className:"max-w-7xl mx-auto px-4",children:d.jsxs("div",{className:"text-center text-white",children:[d.jsx("h1",{className:"text-2xl font-bold mb-4",children:"Loading Nemesis Data..."}),d.jsx("p",{children:"Please wait while we load your nemesis information."})]})})});const[h,f]=O.useState(!1),[p,y]=O.useState(null),[w,S]=O.useState(null);O.useEffect(()=>{const D=()=>{const q=document.querySelector(".battle-cards-container");q&&(window.innerWidth<1024?(q.style.flexDirection="column",q.style.gap="1rem"):(q.style.flexDirection="row",q.style.gap="3rem"))};return D(),window.addEventListener("resize",D),()=>window.removeEventListener("resize",D)},[]),O.useEffect(()=>{w&&n&&(async()=>{if(w&&n)try{console.log("🔄 App: Refreshing stats on page load for user:",n.uid),await w.refreshAllStats(),console.log("✅ App: Stats refreshed on page load")}catch(q){console.error("❌ App: Error refreshing stats on page load:",q)}})()},[w,n]);const k=async()=>{p&&await p.handleAchievementShare()},E=async D=>{if((D==null?void 0:D.uid)==="uGZGbLUytbfu8W3mQPW0YAvXTQn1"&&(!D.quitDate||new Date(D.quitDate)>new Date("2025-09-19")))if(console.log("🔧 TEMPORARY FIX: Restoring correct quit date for User 3 in calculateRealTimeStats (created 18/09)"),D.lastRelapseDate){const ae=new Date(D.lastRelapseDate),pe=new Date("2025-09-18T13:56:46.584Z");D.quitDate=ae>pe?D.lastRelapseDate:"2025-09-18T13:56:46.584Z",console.log(`🔧 TEMPORARY FIX: User 3 quit date set to ${D.quitDate} (considering relapse: ${D.lastRelapseDate})`)}else D.quitDate="2025-09-18T13:56:46.584Z";if((D==null?void 0:D.uid)==="AmwwlNyHD5T3WthUbyR6bFL0QkF2"&&(!D.quitDate||new Date(D.quitDate)>new Date("2025-09-19")))if(console.log("🔧 TEMPORARY FIX: Restoring correct quit date for User 2 in calculateRealTimeStats (created 18/09)"),D.lastRelapseDate){const ae=new Date(D.lastRelapseDate),pe=new Date("2025-09-18T13:56:46.584Z");D.quitDate=ae>pe?D.lastRelapseDate:"2025-09-18T13:56:46.584Z",console.log(`🔧 TEMPORARY FIX: User 2 quit date set to ${D.quitDate} (considering relapse: ${D.lastRelapseDate})`)}else D.quitDate="2025-09-18T13:56:46.584Z";let q={addictionLevel:50,mentalStrength:50,motivation:50,triggerDefense:30,experiencePoints:0,streakDays:0,cravingsResisted:0};if(D!=null&&D.isRealBuddy){if(D.stats&&Object.assign(q,D.stats),D.quitDate){const ae=new Date(D.quitDate),pe=Ps(ae);q.streakDays=pe.value,q.streakUnit=pe.unit,q.streakDisplayText=pe.displayText}try{const{ref:ae,get:pe}=await ke(()=>import("./index.esm-25d69fbc.js"),[]),Te=ae(K,`users/${D.uid}/cravings`),ce=await pe(Te);let ne=0;ce.exists()&&(ce.forEach(ge=>{ge.val().outcome==="resisted"&&ne++}),q.cravingsResisted=ne)}catch{console.log("⚠️ Arena: Could not read buddy cravings, using default"),q.cravingsResisted=0}return q}if(!(D!=null&&D.uid)){const ae=localStorage.getItem("quitCoachRelapseDate");if(ae){const ce=new Date(ae),ge=new Date().getTime()-ce.getTime(),de=Math.floor(ge/(1e3*3600*24));q.streakDays=de,q.streakUnit="days",q.streakDisplayText=`${de} day${de===1?"":"s"}`}else{const ce=D.quitDate?new Date(D.quitDate):new Date,ne=Ps(ce);q.streakDays=ne.value,q.streakUnit=ne.unit,q.streakDisplayText=ne.displayText}const pe=parseInt(localStorage.getItem("cravingWins")||0);q.cravingsResisted=pe,new Date().toDateString();let Te=0;for(let ce=0;ce<7;ce++){const ne=new Date;ne.setDate(ne.getDate()-ce);const ge=ne.toDateString(),de=localStorage.getItem(`water_${D.uid}_${ge}`);if(de&&parseInt(de)>0)Te++;else break}return Te>=3&&(q.mentalStrength=Math.min(80,(q.mentalStrength||50)+1)),q}try{const{ref:ae,get:pe}=await ke(()=>import("./index.esm-25d69fbc.js"),[]),Te=ae(K,`users/${D.uid}/cravings`);try{const me=await pe(Te);let ue=0,Be=0;if(me.exists()){const J=me.val();me.forEach(Me=>{const Pe=Me.val();Pe.outcome==="resisted"?ue++:Pe.outcome==="relapsed"&&Be++})}q.cravingsResisted=ue;const G=ae(K,`users/${D.uid}/profile/cravingsResisted`),Z=await pe(G);if(Z.exists()){const J=Z.val();console.log(`🔍 Arena: Profile cravingsResisted field value: ${J}`),q.cravingsResisted=Math.max(ue,J)}}catch{console.log("Could not query cravings for Arena stats, using fallback");const ue=ae(K,`users/${D.uid}/profile/cravingsResisted`),Be=await pe(ue);q.cravingsResisted=Be.exists()?Be.val():0}let ce=0;const ne=ae(K,`users/${D.uid}/profile/relapseDate`),ge=await pe(ne);if(ge.exists()){const me=ge.val(),ue=new Date(me),G=new Date().getTime()-ue.getTime();ce=Math.floor(G/(1e3*3600*24))}else{const me=D.quitDate?new Date(D.quitDate):new Date,ue=Ps(me);ce=ue.value,q.streakUnit=ue.unit,q.streakDisplayText=ue.displayText,console.log(`🔍 Arena: Calculated streak from quit date: ${ue.displayText} (quit: ${me.toISOString()})`),console.log(`🔍 Arena: Setting streak fields - streakDays: ${ce}, streakUnit: ${q.streakUnit}, streakDisplayText: ${q.streakDisplayText}`)}q.streakDays=ce;let de=0;for(let me=0;me<7;me++){const ue=new Date;ue.setDate(ue.getDate()-me);const Be=ue.toDateString(),G=ae(K,`users/${D.uid}/profile/daily/${Be}/water`),Z=await pe(G);if(Z.exists()&&Z.val()>0)de++;else break}de>=3&&(q.mentalStrength=Math.min(80,(q.mentalStrength||50)+1))}catch(ae){console.error("Error fetching profile data from Firebase:",ae);const pe=localStorage.getItem("quitCoachRelapseDate");if(pe){const ne=new Date(pe),de=new Date().getTime()-ne.getTime(),me=Math.floor(de/(1e3*3600*24));q.streakDays=me,q.streakUnit="days",q.streakDisplayText=`${me} day${me===1?"":"s"}`}else{const ne=D.quitDate?new Date(D.quitDate):new Date,ge=Ps(ne);q.streakDays=ge.value,q.streakUnit=ge.unit,q.streakDisplayText=ge.displayText}const Te=parseInt(localStorage.getItem("cravingWins")||0);q.cravingsResisted=Te,new Date().toDateString();let ce=0;for(let ne=0;ne<7;ne++){const ge=new Date;ge.setDate(ge.getDate()-ne);const de=ge.toDateString(),me=localStorage.getItem(`water_${D.uid}_${de}`);if(me&&parseInt(me)>0)ce++;else break}ce>=3&&(q.mentalStrength=Math.min(80,(q.mentalStrength||50)+1))}if(D!=null&&D.uid&&!(D!=null&&D.isRealBuddy))try{const{ref:ae,get:pe}=await ke(()=>import("./index.esm-25d69fbc.js"),[]),Te=Date.now();await new Promise(ne=>setTimeout(ne,800));const ce=await pe(ae(K,`users/${D.uid}/stats`));if(ce.exists()){const ne=ce.val();Object.assign(q,ne)}else Object.assign(q,D.stats),console.log("🔄 Arena: Using user.stats as fallback:",q);if(p){await p.updateAddictionFromCleanTime();const ne=await pe(ae(K,`users/${D.uid}/stats`));if(ne.exists()){const ge=ne.val();if(Object.assign(q,ge),D.uid==="uGZGbLUytbfu8W3mQPW0YAvXTQn1"||D.uid==="AmwwlNyHD5T3WthUbyR6bFL0QkF2")return console.log(`🔄 Arena: Using Firebase stats directly for ${D.uid} - no client-side calculation`),q}}}catch(ae){console.error("Error reading/updating stats from Firebase:",ae),Object.assign(q,D.stats)}return q},[x,N]=O.useState(()=>{const D={mentalStrength:50,motivation:50,triggerDefense:30,addictionLevel:50,cravingsResisted:0,streakDays:0};return n!=null&&n.stats?{...D,...n.stats}:D}),[P,$]=O.useState(()=>({mentalStrength:50,motivation:50,triggerDefense:30,addictionLevel:50,cravingsResisted:0,streakDays:0}));O.useEffect(()=>{e&&Object.keys(e).length>0&&N(e)},[e]);const[L,R]=O.useState({streakDisplayText:null,streakDays:0,streakUnit:"hours"}),[v,T]=O.useState({}),C=async()=>{if(n&&window.centralizedStatService)try{const D=await window.centralizedStatService.getCurrentStats();return T(D),D}catch(D){return console.warn("🔄 Arena: Could not fetch latest stats from CentralizedStatService:",D),null}return null};O.useEffect(()=>{C();const D=setInterval(C,3e4);return()=>clearInterval(D)},[n]),O.useEffect(()=>{typeof window<"u"&&(window.refreshArenaStats=C,window.setLatestUserStats=T)},[n]),O.useEffect(()=>{if(!(n!=null&&n.uid))return;let D=!0;return(async()=>{await(async()=>{if(D)try{const Te=new zm(K,n.uid);await Te.initialize(),D&&y(Te)}catch(Te){console.error("Error initializing StatManager:",Te)}})(),await(async()=>{if(D){if(n&&D){const Te=await E(n);D&&N(Te)}t&&t.uid&&D&&console.log(`🔄 Arena: Skipping initial calculation for buddy ${t.uid} - will use centralized Firebase stats`)}})()})(),()=>{D=!1}},[n==null?void 0:n.uid,t==null?void 0:t.uid]),O.useEffect(()=>{if(!(t!=null&&t.uid)||!(t!=null&&t.isRealBuddy))return;if(t.uid==="uGZGbLUytbfu8W3mQPW0YAvXTQn1"||t.uid==="AmwwlNyHD5T3WthUbyR6bFL0QkF2"){console.log(`🚫 Arena: SKIPPING real-time listener for centralized buddy ${t.uid}`);return}let D=!0;const ae=(async()=>{try{const{ref:pe,onValue:Te}=await ke(()=>import("./index.esm-25d69fbc.js"),[]),ce=pe(K,`users/${t.uid}/stats`),ne=Te(ce,me=>{if(D&&me.exists()){const ue=me.val();if(ue.streakDisplayText&&ue.streakUnit){const Be={streakDays:ue.streakDays||0,streakUnit:ue.streakUnit,streakDisplayText:ue.streakDisplayText};R(Be)}else{let Be=(a==null?void 0:a.lastRelapseDate)||(t==null?void 0:t.lastRelapseDate)||(a==null?void 0:a.originalQuitDate)||(t==null?void 0:t.originalQuitDate)||(a==null?void 0:a.lastActivity)||(t==null?void 0:t.lastActivity)||null;if(Be){const G=Ps(new Date(Be)),Z={streakDays:G.value,streakUnit:G.unit,streakDisplayText:G.displayText};R(Z),ue.streakDays=G.value,ue.streakUnit=G.unit,ue.streakDisplayText=G.displayText}else ue.streakUnit="hours",ue.streakDisplayText="0 hours"}$(Be=>({...Be,...ue}))}},me=>{me.code!=="PERMISSION_DENIED"&&console.error("Error listening to buddy stats:",me)}),ge=pe(K,`users/${t.uid}/profile`),de=Te(ge,async me=>{if(D&&me.exists()){const ue=me.val(),Be=(t==null?void 0:t.uid)||(a==null?void 0:a.uid);if(!(Be==="uGZGbLUytbfu8W3mQPW0YAvXTQn1"||Be==="AmwwlNyHD5T3WthUbyR6bFL0QkF2")){if(P&&P.addictionLevel!==50){let G={...P};if(ue.quitDate&&ue.quitDate!==t.quitDate){const Z=new Date(ue.quitDate),J=Ps(Z);G.streakDays=J.value,G.streakUnit=J.unit,G.streakDisplayText=J.displayText}else if(ue.lastRelapseDate||ue.relapseDate){const Z=new Date(ue.lastRelapseDate||ue.relapseDate),J=Ps(Z);G.streakDays=J.value,G.streakUnit=J.unit,G.streakDisplayText=J.displayText,R({streakDays:J.value,streakUnit:J.unit,streakDisplayText:J.displayText})}else if(t!=null&&t.finalQuitDate||a!=null&&a.finalQuitDate){const Z=new Date((t==null?void 0:t.finalQuitDate)||(a==null?void 0:a.finalQuitDate)),J=Ps(Z);G.streakDays=J.value,G.streakUnit=J.unit,G.streakDisplayText=J.displayText,R({streakDays:J.value,streakUnit:J.unit,streakDisplayText:J.displayText})}$(Z=>({...Z,...G,...L}))}}}},me=>{me.code!=="PERMISSION_DENIED"&&console.error("Error listening to buddy profile:",me)});return()=>{ne(),de()}}catch(pe){console.error("Error setting up buddy stats listeners:",pe)}})();return()=>{D=!1,ae.then(pe=>{pe&&typeof pe=="function"&&pe()})}},[t==null?void 0:t.uid,t==null?void 0:t.isRealBuddy,a==null?void 0:a.quitDate]),O.useEffect(()=>{if(!(t!=null&&t.uid)||!(t!=null&&t.isRealBuddy))return;const D=setInterval(()=>{const q=(a==null?void 0:a.lastRelapseDate)||(t==null?void 0:t.lastRelapseDate)||(a==null?void 0:a.originalQuitDate)||(t==null?void 0:t.originalQuitDate)||(a==null?void 0:a.lastActivity)||(t==null?void 0:t.lastActivity)||null;if(!q)return;const ae=Ps(new Date(q));R({streakDays:ae.value,streakUnit:ae.unit,streakDisplayText:ae.displayText}),$(pe=>({...pe,streakDays:ae.value,streakUnit:ae.unit,streakDisplayText:ae.displayText}))},60*1e3);return()=>clearInterval(D)},[t==null?void 0:t.uid,t==null?void 0:t.isRealBuddy,a==null?void 0:a.lastRelapseDate,a==null?void 0:a.originalQuitDate,a==null?void 0:a.lastActivity]);const A=async()=>{if(n){const D=await E(n);N(D)}if(t)if(t.uid==="uGZGbLUytbfu8W3mQPW0YAvXTQn1"||t.uid==="AmwwlNyHD5T3WthUbyR6bFL0QkF2")console.log(`🔄 Arena: Skipping refresh for centralized buddy ${t.uid} - using Firebase stats directly`);else{const D=await E(t);$(q=>(console.log("🔄 Arena: Preserving locally calculated streak during stats calculation:",L),{...q,...D,...L}))}};O.useEffect(()=>{if(!(n!=null&&n.uid))return;const D=setInterval(A,3e4);return()=>clearInterval(D)},[n==null?void 0:n.uid,t==null?void 0:t.uid]),O.useEffect(()=>{t!=null&&t.uid&&(t.uid==="uGZGbLUytbfu8W3mQPW0YAvXTQn1"||t.uid==="AmwwlNyHD5T3WthUbyR6bFL0QkF2"||A())},[t==null?void 0:t.uid]),O.useEffect(()=>{a!=null&&a.quitDate&&(t!=null&&t.uid)&&(t.uid==="uGZGbLUytbfu8W3mQPW0YAvXTQn1"||t.uid==="AmwwlNyHD5T3WthUbyR6bFL0QkF2"||A())},[a==null?void 0:a.quitDate,t==null?void 0:t.uid]),O.useEffect(()=>{n!=null&&n.uid&&!a&&!i&&!u&&(console.log("🔄 Arena: Loading buddy data for user:",n.uid),l(E,$,R))},[n==null?void 0:n.uid,a,i,u,R]),O.useEffect(()=>{const D=()=>{console.log("🌐 Internet connection restored")},q=()=>{console.log("📡 Internet connection lost")};return window.addEventListener("online",D),window.addEventListener("offline",q),()=>{window.removeEventListener("online",D),window.removeEventListener("offline",q)}},[]);const b=D=>{if(!D||!D.stats)return console.warn("Player or player stats not available for battle score calculation"),0;const q=D.stats.mentalStrength||50,ae=D.stats.motivation||50,pe=D.stats.triggerDefense||30,Te=D.stats.addictionLevel||50;return q*1.5+ae*1+pe*1.2-Te*1},_=b({...n,stats:x}),B=b({...t,stats:P}),ve=typeof _=="number"&&!isNaN(_)?_:0,Fe=typeof B=="number"&&!isNaN(B)?B:0,It=ve>Fe?"WINNING":ve===Fe?"TIED":"LOSING",Q=()=>{if(It==="WINNING")return null;if(!x||!P)return console.warn("Stats not available for recommendations calculation"),[];const D=Fe-ve+1,q=[],ae=(x==null?void 0:x.mentalStrength)||50,pe=(x==null?void 0:x.motivation)||50,Te=(x==null?void 0:x.triggerDefense)||30,ce=(x==null?void 0:x.addictionLevel)||50,ne=(P==null?void 0:P.mentalStrength)||50,ge=(P==null?void 0:P.motivation)||50;P!=null&&P.triggerDefense;const de=(P==null?void 0:P.addictionLevel)||50,me=ne-ae,ue=ge-pe,Be=ce-de,G=[{name:"Mental Strength",multiplier:1.5,gap:me,current:ae,max:100},{name:"Trigger Defense",multiplier:1.2,gap:ue,current:Te,max:100},{name:"Motivation",multiplier:1,gap:ue,current:pe,max:100},{name:"Addiction",multiplier:1,gap:Be,current:ce,min:0,isReduction:!0}];if(G.sort((Z,J)=>Z.multiplier!==J.multiplier?J.multiplier-Z.multiplier:Math.abs(J.gap)-Math.abs(Z.gap)),G.forEach(Z=>{if(Z.isReduction){const J=Math.min(Z.current-Z.min,50),Me=J*Z.multiplier;Me>0&&q.push({stat:Z.name,change:J,action:we(J),priority:Me,canWin:Me>=D,isReduction:!0,efficiency:Z.multiplier,gap:Z.gap})}else{const J=Math.min(Z.max-Z.current,50),Me=J*Z.multiplier;Me>0&&q.push({stat:Z.name,change:J,action:Se(Z.name,J),priority:Me,canWin:Me>=D,efficiency:Z.multiplier,gap:Z.gap})}}),q.sort((Z,J)=>J.priority-Z.priority),q.length>0&&!q.some(Z=>Z.canWin)){const Z=qe(q,D);Z&&q.unshift(Z)}return q.slice(0,3)},we=D=>D>=30?"Stay completely clean, avoid all triggers, use nicotine replacement therapy":D>=20?"Reduce nicotine intake significantly, avoid high-risk situations":D>=10?"Cut back on vaping frequency, identify and avoid main triggers":"Small reduction in nicotine intake, practice trigger avoidance",Se=(D,q)=>{switch(D){case"Mental Strength":return q>=30?"Complete daily breathing exercises, stay hydrated for 3+ days, practice meditation":q>=20?"Complete breathing exercises 3 days straight, stay hydrated, use stress management":"Complete breathing exercises, stay hydrated for 3 days straight";case"Motivation":return q>=30?"Log progress daily, share achievements weekly":q>=20?"Log progress 5+ days per week, share achievements, track progress":"Regular logging (3+ days per week), share achievements, reach milestones";case"Trigger Defense":return q>=30?"Survive multiple trigger situations, pre-plan for all triggers, update trigger list":q>=20?"Survive trigger situations, pre-plan for known triggers, practice coping":"Survive trigger situations without vaping, pre-plan for known triggers";default:return"Focus on improving this stat through consistent practice"}},qe=(D,q)=>{let ae=0;const pe=[];for(const Te of D){if(ae>=q)break;const ce=q-ae,ne=Math.min(Te.priority,ce);ne>0&&(pe.push({stat:Te.stat,change:Math.ceil(ne/Te.efficiency),contribution:ne}),ae+=ne)}return pe.length>0?{stat:"Combination Strategy",change:Math.ceil(q),action:`Focus on: ${pe.map(Te=>`${Te.stat} (+${Te.change})`).join(", ")}`,priority:ae,canWin:ae>=q,isCombination:!0,strategy:pe}:null},De=Q()||[];return d.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-slate-900 via-blue-900 to-slate-900 py-4 pb-20",children:[d.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:[d.jsx("div",{className:"text-center mb-6",children:d.jsxs("div",{className:"flex flex-col sm:flex-row items-center justify-center gap-2 sm:gap-4",children:[d.jsxs("div",{className:`inline-flex items-center px-4 py-2 sm:px-6 sm:py-3 rounded-full font-bold text-sm sm:text-lg shadow-xl ${It==="WINNING"?"bg-green-600":It==="TIED"?"bg-yellow-600":"bg-red-600"} text-white`,children:[It==="WINNING"?d.jsx(GD,{className:"w-5 h-5 mr-2"}):It==="TIED"?d.jsx(rh,{className:"w-5 h-5 mr-2"}):d.jsx("span",{className:"mr-2",children:"📉"}),"You are ",It]}),d.jsx("button",{onClick:()=>f(!0),className:"info-button w-0.5 h-0.5 sm:w-1 sm:h-1 bg-blue-600 hover:bg-blue-700 text-white rounded-full flex items-center justify-center shadow-lg",style:{fontSize:"4px"},title:"Battle Algorithm Info",children:d.jsx("span",{className:"text-sm sm:text-lg font-bold",children:"i"})}),d.jsx("button",{onClick:A,className:"touch-interactive ripple-effect w-11 h-11 sm:w-12 sm:h-12 bg-green-600 hover:bg-green-700 text-white rounded-full flex items-center justify-center shadow-lg min-h-[44px] min-w-[44px]",title:"Refresh Stats",children:d.jsx("span",{className:"text-sm sm:text-lg font-bold",children:"🔄"})}),d.jsxs("div",{className:"text-xs text-gray-400 bg-gray-800 p-2 rounded",children:[d.jsxs("div",{children:["User Stats: ",JSON.stringify(x)]}),d.jsxs("div",{children:["Base Stats: ",JSON.stringify(n==null?void 0:n.stats)]})]}),d.jsx("button",{onClick:A,className:"mt-2 px-4 py-3 bg-blue-600 hover:bg-blue-700 text-white rounded-lg transition-colors min-h-[44px]",children:"🔄 Refresh Stats"}),d.jsx("button",{onClick:async()=>{console.log("🧪 Manual buddy matching test triggered...");try{await autoMatchUsers(),console.log("✅ Manual buddy matching completed")}catch(D){console.error("❌ Manual buddy matching failed:",D)}},className:"mt-2 ml-2 px-4 py-3 bg-purple-600 hover:bg-purple-700 text-white rounded-lg transition-colors min-h-[44px]",children:"🔗 Test Matching"}),d.jsx("button",{onClick:async()=>{console.log("🧪 Manual buddy reload test triggered...");try{setBuddyLoadAttempted(!1),setRealBuddy(null),await l(E,$,R),console.log("✅ Manual buddy reload completed")}catch(D){console.error("❌ Manual buddy reload failed:",D)}},className:"mt-2 ml-2 px-4 py-3 bg-green-600 hover:bg-green-700 text-white rounded-lg transition-colors min-h-[44px]",children:"👥 Reload Buddy"}),d.jsx("button",{onClick:async()=>{console.log("🧪 Resetting matching system...");try{const D=firestoreBuddyServiceRef.current||firestoreBuddyService;if(D){const{getDocs:q,deleteDoc:ae,doc:pe}=await ke(()=>import("./index.esm-3368cc70.js"),[]),ce=(await q(D.buddyPairsCollection)).docs.map(Be=>ae(pe(js,"buddyPairs",Be.id)));await Promise.all(ce);const ge=(await q(D.matchingPoolCollection)).docs.map(Be=>ae(pe(js,"matchingPool",Be.id)));await Promise.all(ge);const{ref:de,remove:me}=await ke(()=>import("./index.esm-25d69fbc.js"),[]),ue=["5uSH8SA6y4eZ7jkoLEZCRJZmTGW2","KB67Yg17rkZmCa8UV1N5xIUWoK12","o4mW4BmLWOOVBybTrYcvGJ4nimA3"];for(const Be of ue)try{await me(de(K,`users/${Be}/buddyInfo`))}catch{console.log("Could not remove buddy info for:",Be)}console.log("✅ Matching system reset completed"),setRealBuddy(null),setBuddyLoadAttempted(!1)}}catch(D){console.error("❌ Reset failed:",D)}},className:"mt-2 ml-2 px-4 py-3 bg-red-600 hover:bg-red-700 text-white rounded-lg transition-colors min-h-[44px]",children:"🔄 Reset Matching"})]})}),d.jsxs("div",{className:"battle-cards-container flex flex-col lg:flex-row items-center justify-center gap-4 lg:gap-12 mb-8 w-full",children:[d.jsx("div",{className:"battle-card flex flex-col items-center space-y-4 flex-shrink-0",children:(()=>{if(!n||!x)return console.log("🎯 TradingCard: Missing data, not rendering user card"),d.jsx("div",{className:"w-72 sm:w-80 h-[480px] sm:h-[520px] bg-slate-800 rounded-xl border-2 border-slate-600 p-4 text-white text-center mx-auto flex items-center justify-center",children:d.jsx("div",{className:"animate-pulse",children:"Loading User..."})});const D=v&&Object.keys(v).length>0?{...n.stats,...v}:e&&Object.keys(e).length>0?{...n.stats,...e}:{...n.stats,...x};return d.jsx(Mb,{user:{...n,stats:D},showComparison:!1,nemesisUser:t},`user-${n.uid}-${n.lastRelapseRefresh||Date.now()}`)})()}),d.jsxs("div",{className:"vs-section flex flex-row lg:flex-col items-center justify-center space-x-4 lg:space-x-0 space-y-0 lg:space-y-4 flex-shrink-0",children:[d.jsx("div",{className:"vs-icon w-16 h-16 lg:w-24 lg:h-24 bg-gradient-to-br from-red-500 to-purple-600 rounded-full flex items-center justify-center shadow-xl animate-pulse",children:d.jsx(fq,{className:"w-8 h-8 lg:w-12 lg:h-12 text-white"})}),d.jsx("div",{className:"bg-red-600 px-4 py-2 lg:px-8 lg:py-3 rounded-full",children:d.jsx("p",{className:"vs-text text-white font-bold text-lg lg:text-2xl",children:"VS"})})]}),d.jsx("div",{className:"battle-card flex flex-col items-center space-y-4 flex-shrink-0",children:(()=>{if(!t||!P)return console.log("🎯 TradingCard: Missing data, not rendering nemesis card"),d.jsx("div",{className:"w-72 sm:w-80 h-[480px] sm:h-[520px] bg-slate-800 rounded-xl border-2 border-slate-600 p-4 text-white text-center mx-auto flex items-center justify-center",children:d.jsx("div",{className:"animate-pulse",children:"Loading Nemesis..."})});const D={...t,stats:{...t.stats,...P}};return L.streakDisplayText&&(D.stats.streakDisplayText=L.streakDisplayText,D.stats.streakDays=L.streakDays,D.stats.streakUnit=L.streakUnit),d.jsx(Mb,{user:D,isNemesis:!0,showComparison:!1,nemesisUser:n},`buddy-${t.uid}-${n.lastRelapseRefresh||Date.now()}`)})()})]}),It==="LOSING"&&De&&De.length>0&&d.jsxs("div",{className:"w-full max-w-4xl mx-auto bg-slate-800/50 rounded-xl p-4 sm:p-6 border border-slate-700",children:[d.jsx("h3",{className:"text-xl font-bold text-white mb-4 text-center",children:"🎯 Quick Win Strategy"}),d.jsx("div",{className:"space-y-4",children:De.slice(0,3).map((D,q)=>d.jsx("div",{className:"bg-slate-700/50 rounded-lg p-3 sm:p-4 border-l-4 border-blue-500",children:d.jsxs("div",{className:"flex flex-col sm:flex-row items-start sm:items-center justify-between gap-2 sm:gap-0",children:[d.jsxs("div",{className:"flex-1",children:[d.jsx("h4",{className:"text-white font-semibold mb-2",children:D.isReduction?d.jsxs(d.Fragment,{children:["🎯 Reduce your ",D.stat," by ",D.change," points!"]}):D.isCombination?d.jsxs(d.Fragment,{children:["🎯 Best Strategy: Improve multiple stats by ",D.change," total points!"]}):D.isMajor?d.jsxs(d.Fragment,{children:["🎯 Major improvement needed: ",D.change," total points!"]}):d.jsxs(d.Fragment,{children:["🎯 Increase your ",D.stat," by ",D.change," points!"]})}),d.jsxs("p",{className:"text-gray-300 text-sm",children:["💡 ",D.action]})]}),d.jsxs("div",{className:`font-bold text-xl sm:text-2xl sm:ml-4 ${D.isReduction?"text-green-400":D.isCombination?"text-purple-400":D.isMajor?"text-orange-400":"text-blue-400"}`,children:[D.isReduction?"-":"+",D.change]})]})},q))}),d.jsx("div",{className:"text-center mt-4",children:d.jsx("p",{className:"text-gray-400 text-sm",children:"Focus on the top recommendation for the fastest path to victory!"})})]})]}),h&&d.jsxs("div",{className:"modal-backdrop",children:[d.jsx("div",{className:"absolute inset-0 bg-black/80 backdrop-blur-sm",onClick:()=>f(!1)}),d.jsx("div",{className:"modal-container",children:d.jsxs("div",{className:"modal-content bg-slate-800 border-slate-600 p-6",children:[d.jsxs("div",{className:"flex justify-between items-center mb-4",children:[d.jsx("h3",{className:"text-xl font-bold text-white",children:"Battle Algorithm"}),d.jsxs("div",{className:"flex items-center gap-2",children:[d.jsx("button",{onClick:k,className:"bg-blue-600 hover:bg-blue-700 text-white px-4 py-3 rounded-lg text-sm transition-colors min-h-[44px] min-w-[44px]",title:"Share achievement for Motivation bonus",children:"📤 Share"}),d.jsx("button",{onClick:()=>f(!1),className:"modal-close-enhanced text-gray-400 hover:text-white text-2xl w-11 h-11 flex items-center justify-center min-h-[44px] min-w-[44px]",children:"×"})]})]}),d.jsxs("div",{className:"space-y-4 text-sm",children:[d.jsxs("div",{children:[d.jsx("h4",{className:"text-white font-semibold mb-2",children:"Formula:"}),d.jsx("p",{className:"text-gray-300 font-mono",children:"(Mental Strength × 1.5) + (Motivation × 1.0) + (Trigger Defense × 1.2) - (Addiction × 1.0)"})]}),d.jsxs("div",{children:[d.jsx("h4",{className:"text-white font-semibold mb-2",children:"Your Score:"}),d.jsxs("p",{className:"text-green-400 font-mono",children:["(",x.mentalStrength||50," × 1.5) + (",x.motivation||50," × 1.0) + (",x.triggerDefense||30," × 1.2) - (",x.addictionLevel||50," × 1.0) = ",_.toFixed(1)]})]}),d.jsxs("div",{children:[d.jsx("h4",{className:"text-white font-semibold mb-2",children:"Nemesis Score:"}),d.jsxs("p",{className:"text-red-400 font-mono",children:["(",P.mentalStrength||50," × 1.5) + (",P.motivation||50," × 1.0) + (",P.triggerDefense||30," × 1.2) - (",P.addictionLevel||50," × 1.0) = ",B.toFixed(1)]})]}),d.jsx("div",{className:"bg-slate-700/50 rounded-lg p-3",children:d.jsxs("p",{className:"text-gray-300 text-xs",children:[d.jsx("strong",{children:"Mental Strength (×1.5):"})," Your resilience and coping ability",d.jsx("br",{}),d.jsx("strong",{children:"Motivation (×1.0):"})," Your drive to quit",d.jsx("br",{}),d.jsx("strong",{children:"Trigger Defense (×1.2):"})," Your ability to resist triggers",d.jsx("br",{}),d.jsx("strong",{children:"Addiction (×1.0):"})," Your nicotine dependence level"]})})]})]})})]})]})},Sq=({isOpen:n,onClose:e,title:t,message:r,type:s="info"})=>{if(!n)return null;const i=()=>{switch(s){case"success":return"🎉";case"warning":return"⚠️";case"info":return"ℹ️";default:return"💡"}},o=()=>{switch(s){case"success":return"from-green-600 to-green-700";case"warning":return"from-yellow-600 to-yellow-700";case"info":return"from-blue-600 to-blue-700";default:return"from-slate-600 to-slate-700"}};return d.jsxs("div",{className:"modal-backdrop",children:[d.jsx("div",{className:"absolute inset-0 bg-black/80 backdrop-blur-sm",onClick:e}),d.jsx("div",{className:"modal-container",children:d.jsx("div",{className:"modal-content bg-slate-800 border-slate-600 shadow-2xl animate-in slide-in-from-bottom-4 duration-300",children:d.jsxs("div",{className:"text-center",children:[d.jsx("div",{className:"w-16 h-16 bg-gradient-to-br from-slate-600 to-slate-700 rounded-full flex items-center justify-center mx-auto mb-4",children:d.jsx("span",{className:"text-3xl",children:i()})}),d.jsx("h3",{className:"text-xl font-bold text-white mb-3",children:t}),d.jsx("div",{className:"text-gray-300 mb-6 whitespace-pre-line text-sm leading-relaxed",children:r}),d.jsx("button",{onClick:e,className:`w-full bg-gradient-to-r ${o()} hover:from-slate-700 hover:to-slate-800 text-white font-bold py-3 px-6 rounded-xl transition-all duration-300 transform hover:scale-105`,children:"Got it"})]})})})]})},Eq=({gameType:n,onClose:e})=>{const[t,r]=O.useState(0),{modalRef:s,classes:i}=iI(e,{threshold:100,velocity:.5,enabled:!0}),o=()=>{const l=O.useRef(null),[u,h]=O.useState([{x:12,y:12}]),[f,p]=O.useState({x:1,y:0}),[y,w]=O.useState({x:1,y:0}),[S,k]=O.useState({x:15,y:15}),[E,x]=O.useState(!1),[N,P]=O.useState(0),[$,L]=O.useState(1),R={1:128,2:Math.round(128/1.25),3:Math.round(128/1.25/1.25)},v={1:5,2:5,3:10};return O.useEffect(()=>{const T=C=>{if(E){C.preventDefault(),h([{x:12,y:12}]),p({x:1,y:0}),w({x:1,y:0}),k({x:15,y:15}),x(!1),P(0),L(1);return}switch(C.key){case"ArrowUp":C.preventDefault(),f.y!==1&&w({x:0,y:-1});break;case"ArrowDown":C.preventDefault(),f.y!==-1&&w({x:0,y:1});break;case"ArrowLeft":C.preventDefault(),f.x!==1&&w({x:-1,y:0});break;case"ArrowRight":C.preventDefault(),f.x!==-1&&w({x:1,y:0});break}};return window.addEventListener("keydown",T),()=>window.removeEventListener("keydown",T)},[f,E]),O.useEffect(()=>{if(E)return;const T=setInterval(()=>{h(C=>{const A={x:C[0].x+f.x,y:C[0].y+f.y};if(A.x<0&&(A.x=24),A.x>=25&&(A.x=0),A.y<0&&(A.y=24),A.y>=25&&(A.y=0),C.slice(0,-1).some(ve=>ve.x===A.x&&ve.y===A.y))return x(!0),C;const _=A.x===S.x&&A.y===S.y;let B;return _?(P(ve=>ve+v[$]),k({x:Math.floor(Math.random()*25),y:Math.floor(Math.random()*25)}),B=[A,...C]):B=[A,...C.slice(0,-1)],(y.x!==f.x||y.y!==f.y)&&setTimeout(()=>{p(y)},0),B})},R[$]);return()=>clearInterval(T)},[f,y,S,E]),O.useEffect(()=>{const T=l.current;if(!T)return;const C=T.getContext("2d"),A=15,b=25;C.fillStyle="#1f2937",C.fillRect(0,0,375,375),C.strokeStyle="#374151",C.lineWidth=1;for(let _=0;_<=b;_++)C.beginPath(),C.moveTo(_*A,0),C.lineTo(_*A,375),C.stroke(),C.beginPath(),C.moveTo(0,_*A),C.lineTo(375,_*A),C.stroke();u.forEach((_,B)=>{B===0?C.fillStyle="#fbbf24":C.fillStyle="#10b981",C.fillRect(_.x*A+1,_.y*A+1,A-2,A-2)}),C.fillStyle="#ef4444",C.fillRect(S.x*A+2,S.y*A+2,A-4,A-4)},[u,S]),d.jsxs("div",{className:"text-center",children:[d.jsx("div",{className:"mb-4",children:d.jsxs("div",{className:"flex justify-center gap-2 mb-3",children:[d.jsx("span",{className:"text-white mr-2 text-sm",children:"Level:"}),[1,2,3].map(T=>d.jsxs("button",{onClick:()=>L(T),className:`
                  px-4 py-3 text-sm font-mono border-2 border-green-500 transition-all min-h-[44px]
                  ${$===T?"bg-green-500 text-black":"bg-green-900 text-green-400"}
                  hover:bg-green-600 cursor-pointer
                `,style:{minWidth:"80px"},children:[d.jsxs("div",{children:["Level ",T]}),d.jsxs("div",{className:"text-xs mt-1",children:[T===1&&"Normal",T===2&&"Fast",T===3&&"Insane"]})]},T))]})}),d.jsx("canvas",{ref:l,width:"375",height:"375",className:"border-2 border-gray-300 mx-auto",style:{imageRendering:"pixelated"}}),d.jsxs("div",{className:"mt-4",children:[d.jsxs("p",{className:"text-lg font-bold text-gray-800",children:["Score: ",N," | Level: ",$]}),E&&d.jsxs("div",{className:"mt-2",children:[d.jsx("p",{className:"text-red-600 font-bold mb-2",children:"Game Over!"}),d.jsx("button",{onClick:()=>{h([{x:12,y:12}]),p({x:1,y:0}),w({x:1,y:0}),k({x:15,y:15}),x(!1),P(0),L(1)},className:"bg-blue-600 hover:bg-blue-700 text-white px-4 py-3 rounded text-sm min-h-[44px]",children:"Restart Game"})]})]})]})},a=()=>{try{return n==="snake"?d.jsx(o,{}):d.jsx("div",{className:"text-center text-red-600",children:"Game not found"})}catch(l){return console.error("Error rendering game:",l),d.jsxs("div",{className:"text-center text-red-600",children:[d.jsx("p",{className:"text-lg font-bold mb-2",children:"⚠️ Game Error"}),d.jsx("p",{className:"text-sm",children:"Something went wrong loading the game."}),d.jsx("button",{onClick:()=>window.location.reload(),className:"mt-2 bg-red-600 hover:bg-red-700 text-white px-4 py-3 rounded text-sm min-h-[44px]",children:"Reload Game"})]})}};return d.jsx("div",{className:"modal-backdrop",children:d.jsx("div",{className:"modal-container",children:d.jsxs("div",{ref:s,className:`modal-content bg-white max-w-4xl ${i}`,role:"dialog","aria-modal":"true","aria-labelledby":"game-modal-title",children:[d.jsx("div",{className:"modal-swipe-indicator"}),d.jsxs("div",{className:"modal-scrollable",children:[d.jsxs("div",{className:"flex justify-between items-center mb-4 p-4",children:[d.jsx("h3",{id:"game-modal-title",className:"text-xl font-bold text-gray-800",children:"🐍 Snake Game"}),d.jsx("button",{onClick:e,className:"modal-close-button","aria-label":"Close game modal",children:"×"})]}),d.jsx("div",{className:"bg-gray-100 rounded-lg p-4 min-h-[400px] flex items-center justify-center relative mx-4",children:a()}),d.jsxs("div",{className:"p-4",children:[d.jsx("div",{className:"flex justify-center items-center gap-4 mb-4",children:d.jsxs("span",{className:"text-lg font-semibold text-gray-700",children:["Score: ",t]})}),d.jsx("div",{className:"modal-actions",children:d.jsx("button",{onClick:e,className:"modal-button modal-button-primary",children:"Close Game"})})]})]})]})})})},Tq=({user:n,nemesis:e,onBackToLogin:t,onResetForTesting:r,onBreathingComplete:s,setActiveTab:i,behavioralService:o})=>{const[a,l]=O.useState(!1),[u,h]=O.useState(null),[f,p]=O.useState(!1),[y,w]=O.useState({title:"",message:"",type:"info"}),[S,k]=O.useState(null),[E,x]=O.useState(!1),[N,P]=O.useState(0),[$,L]=O.useState(!1),[R,v]=O.useState(!1),[T,C]=O.useState(1),[A,b]=O.useState({strength:5,mood:"",context:"",outcome:"",copingStrategy:"",location:"",timeOfDay:"",triggerType:""}),[_,B]=O.useState({resisted:0,relapses:0}),[ve,Fe]=O.useState(0),[It,Q]=O.useState(!1),[we,Se]=O.useState(""),qe=(G,Z,J="info")=>{console.log("🔄 showQuickActionPopup called:",{title:G,message:Z,type:J}),w({title:G,message:Z,type:J}),p(!0),console.log("✅ showQuickActionPopup: Popup data set and showCustomPopup set to true")};T2.useEffect(()=>(typeof window<"u"&&(window.showQuickActionPopup=qe),()=>{typeof window<"u"&&delete window.showQuickActionPopup}),[]),O.useEffect(()=>n!=null&&n.uid?(P(0),(async()=>{try{const Pe=new zm(K,n.uid);await Pe.initialize(),k(Pe)}catch(Pe){console.error("Error initializing StatManager:",Pe)}})(),(async()=>{try{const Pe=new Date().toDateString(),{ref:be,get:Ct}=await ke(()=>import("./index.esm-25d69fbc.js"),[]);try{const qt=be(K,`users/${n.uid}/profile/dailyCravingLogs/${Pe}`),Rt=await Ct(qt);if(Rt.exists()){const vt=Rt.val();Fe(vt.count||0)}else Fe(0)}catch{const Rt=`cravingLogs_${n.uid}_${Pe}`,vt=localStorage.getItem(Rt);if(vt){const Nt=JSON.parse(vt);Fe(Nt.count||0)}else Fe(0)}}catch(Pe){console.error("Error loading daily craving logs:",Pe),Fe(0)}})(),(async()=>{try{const{ref:Pe,get:be,onValue:Ct,query:qt,orderByChild:Rt,startAt:vt,endAt:Nt,set:gt}=await ke(()=>import("./index.esm-25d69fbc.js"),[]),Ae=new Date,Ye=new Date(Ae.getTime()-7*24*60*60*1e3),un=Ye.toDateString(),rn=Ae.toDateString();try{const ut=Pe(K,`users/${n.uid}/profile/cravingStats`),yn=await be(ut);if(yn.exists()){const vr=yn.val();if(vr.lastUpdated&&new Date(vr.lastUpdated)>Ye){B(vr);return}}}catch{console.log("Firebase stats not available, calculating from cravings data")}const{ref:In,get:ur,query:mt,orderByChild:dn,startAt:hn,endAt:Jn}=await ke(()=>import("./index.esm-25d69fbc.js"),[]),Sn=In(K,`users/${n.uid}/cravings`),mn=mt(Sn,dn("date"),hn(un),Jn(rn));try{const ut=await ur(mn);let yn=0,vr=0;if(console.log(`🔍 Weekly Stats: Checking cravings for ${un} to ${rn}`),console.log(`🔍 Weekly Stats: Cravings snapshot exists: ${ut.exists()}`),ut.exists()){const hr=ut.val();console.log("🔍 Weekly Stats: Raw cravings data:",hr),ut.forEach(al=>{const cs=al.val();console.log("🔍 Weekly Stats: Individual craving:",cs),cs.outcome==="resisted"?yn++:cs.outcome==="relapsed"&&vr++})}console.log(`🔍 Weekly Stats: Calculated - resisted: ${yn}, relapses: ${vr}`);const Cs={resisted:yn,relapses:vr,lastUpdated:Ae.toISOString()};B(Cs);try{const hr=Pe(K,`users/${n.uid}/profile/cravingStats`);await gt(hr,Cs)}catch{console.log("Could not save weekly stats to Firebase, using localStorage")}localStorage.setItem(`cravingStats_${n.uid}`,JSON.stringify(Cs))}catch{console.log("Could not query cravings, using localStorage fallback");const yn=JSON.parse(localStorage.getItem(`cravingStats_${n.uid}`)||'{"resisted": 0, "relapses": 0}');B(yn)}const dr=Pe(K,`users/${n.uid}/profile/cravingStats`);return Ct(dr,ut=>{ut.exists()&&B(ut.val())})}catch(Pe){console.error("Error loading weekly stats:",Pe);const be=JSON.parse(localStorage.getItem(`cravingStats_${n.uid}`)||'{"resisted": 0, "relapses": 0}');B(be)}})(),(async()=>{try{const{ref:Pe,get:be,onValue:Ct}=await ke(()=>import("./index.esm-25d69fbc.js"),[]),qt=new Date().toDateString(),Rt=Pe(K,`users/${n.uid}/profile/daily/${qt}/water`),vt=await be(Rt);if(vt.exists())P(vt.val()||0);else{const gt=parseInt(localStorage.getItem(`water_${n.uid}_${qt}`)||0);P(gt)}return Ct(Rt,gt=>{gt.exists()&&P(gt.val()||0)})}catch(Pe){console.error("Error loading daily water from Firebase:",Pe);const be=new Date().toDateString(),Ct=parseInt(localStorage.getItem(`water_${n.uid}_${be}`)||0);P(Ct)}})(),()=>{P(0),x(!1),B({resisted:0,relapses:0}),v(!1),C(1),b({strength:5,mood:"",context:"",outcome:""}),Fe(0),Q(!1),Se("")}):void 0,[n==null?void 0:n.uid]);const De=()=>{h("snake"),l(!0)},D=()=>{h(null),l(!1)},q=async()=>{if(!(n!=null&&n.uid)){console.warn("Cannot log water: No authenticated user");return}try{const G=Math.min(N+1,6);P(G);const Z=new Date().toDateString();if(S){if(await S.handleHydrationUpdate(G),o)try{const be=await S.checkHydrationStreak();await o.logHydration(n.uid,{glassesConsumed:G,targetGlasses:6,currentStreak:be}),console.log("✅ Hydration also logged to Firestore for analytics")}catch(be){console.warn("⚠️ Could not log hydration to Firestore:",be.message),await ce("hydration",{glassesConsumed:G,targetGlasses:6,currentStreak:await S.checkHydrationStreak()})}else await ce("hydration",{glassesConsumed:G,targetGlasses:6,currentStreak:await S.checkHydrationStreak()});G===6&&N===5&&await S.checkHydrationStreak()>=3&&(await S.updateStat("mentalStrength",1,"3-day hydration streak"),console.log("Mental Strength +1 for 3-day hydration streak!"))}const{ref:J,set:Me}=await ke(()=>import("./index.esm-25d69fbc.js"),[]),Pe=J(K,`users/${n.uid}/profile/daily/${Z}/water`);await Me(Pe,G),localStorage.setItem(`water_${n.uid}_${Z}`,G.toString()),console.log("Water intake updated:",G)}catch(G){console.error("Error updating water intake:",G);const Z=Math.min(N+1,6);P(Z);const J=new Date().toDateString();localStorage.setItem(`water_${n.uid}_${J}`,Z.toString())}},ae=()=>{b({strength:5,mood:"",context:"",outcome:""}),C(1),v(!0)},pe=()=>{T<4&&C(T+1)},Te=()=>{T>1&&C(T-1)},ce=async(G,Z)=>{if(!window.offlineManager||!(authUser!=null&&authUser.uid))return!1;const J={...Z,userId:authUser.uid,timestamp:Date.now()};return await window.offlineManager.handleOfflineBehavioralLog(G,J)},ne=async G=>{let Z,J,Me;try{Me=new Date().toISOString();const Pe=new Date().toDateString(),be=new Date;Z={...A,outcome:G,timestamp:Me,date:Pe,timeOfDay:be.getHours()<12?"morning":be.getHours()<17?"afternoon":"evening",dayOfWeek:be.toLocaleDateString("en-US",{weekday:"long"}),weekOfYear:Math.ceil((be.getDate()+new Date(be.getFullYear(),0,1).getDay())/7),month:be.toLocaleDateString("en-US",{month:"long"}),year:be.getFullYear(),userId:n==null?void 0:n.uid,sessionId:Date.now().toString(),userAgent:navigator.userAgent.substring(0,100),outcomeDetails:{resisted:G==="resisted",relapsed:G==="relapsed",logged:G==="logged",usedPractices:G==="resistance_practices"}};const Ct=new Date().toDateString(),qt=ve+1;Fe(qt),J={resisted:_.resisted,relapses:_.relapses,lastUpdated:Me};let Rt=!1;if(qt<=2&&S)try{const mn=await S.handleCravingLogged();mn&&mn.applied&&(Rt=!0,console.log("✅ Awareness bonus awarded for craving tracking"))}catch(mn){console.warn("⚠️ Could not award awareness bonus:",mn)}if(G==="resisted"){if(J.resisted=_.resisted+1,S){console.log("🔄 Detailed Craving: Calling StatManager.handleCravingResistance()...");const mn=await S.handleCravingResistance();console.log("🔄 Detailed Craving: StatManager.handleCravingResistance() result:",mn)}window.centralizedStatService&&(console.log("🔄 Detailed Craving: Using CentralizedStatService..."),await window.centralizedStatService.handleCravingResisted(),console.log("✅ Detailed Craving: Stats updated via CentralizedStatService"))}else if(G==="relapsed"){if(J.relapses=_.relapses+1,S){console.log("🔄 Detailed Craving: Calling StatManager.handleRelapse()...");const mn=await S.handleRelapse();console.log("🔄 Detailed Craving: StatManager.handleRelapse() result:",mn)}window.centralizedStatService&&(console.log("🔄 Detailed Craving: Using CentralizedStatService..."),await window.centralizedStatService.handleRelapse(),console.log("✅ Detailed Craving: Stats updated via CentralizedStatService"))}const{ref:vt,set:Nt,push:gt,get:Ae}=await ke(()=>import("./index.esm-25d69fbc.js"),[]),Ye=vt(K,`users/${n.uid}/profile/cravingStats`);await Nt(Ye,J);const un=vt(K,`users/${n.uid}/cravings`),rn=gt(un);if(await Nt(rn,Z),o)try{await o.logCraving(n.uid,{outcome:G,strength:A.strength,duration:A.duration,context:"detailed_assessment",triggers:A.triggers||[],mood:A.mood,stressLevel:A.stressLevel,copingStrategiesUsed:A.copingStrategies||[],location:A.location,socialSituation:A.socialSituation}),console.log("✅ Craving also logged to Firestore for analytics")}catch(mn){console.warn("⚠️ Could not log craving to Firestore:",mn.message),ce&&await ce("craving",{outcome:G,strength:A.strength,duration:A.duration,context:"detailed_assessment",triggers:A.triggers||[],mood:A.mood,stressLevel:A.stressLevel,copingStrategiesUsed:A.copingStrategies||[],location:A.location,socialSituation:A.socialSituation})}const In=vt(K,`users/${n.uid}/profile/cravingHistory/${Ct}`),ur=await Ae(In);let mt=ur.exists()?ur.val():[];mt.push({...Z,id:rn.key,timestamp:Me}),mt.length>30&&(mt=mt.slice(-30)),await Nt(In,mt),console.log(`📅 Daily history updated for ${Ct}:`,mt.length,"records");const dn=be.toISOString().substring(0,7),hn=vt(K,`users/${n.uid}/profile/cravingTrends/${dn}`),Jn=await Ae(hn);let Sn=Jn.exists()?Jn.val():[];Sn.push({...Z,id:rn.key,timestamp:Me}),Sn.length>365&&(Sn=Sn.slice(-365)),await Nt(hn,Sn),console.log(`📊 Monthly trends updated for ${dn}:`,Sn.length,"records"),B(J),w(G==="resisted"?{title:"🎉 Great Job!",message:`You successfully resisted that craving!

Your Mental Strength and Trigger Defense have increased significantly.

Plus, you earned awareness bonuses for tracking your craving!`,type:"success"}:G==="relapsed"?{title:"🌟 New Beginning",message:`Every relapse is a chance to learn and grow stronger. You're back on track and that takes courage!

Your awareness and tracking skills are improving with each experience. Keep going!`,type:"success"}:{title:"📝 Progress Recorded",message:`Your craving has been logged successfully.

You earned awareness bonuses for tracking your craving!`,type:"info"}),p(!0),v(!1),C(1)}catch(Pe){if(console.error("Error saving craving assessment:",Pe),Z){const be=JSON.parse(localStorage.getItem(`cravings_${n.uid}`)||"[]");be.push(Z),localStorage.setItem(`cravings_${n.uid}`,JSON.stringify(be))}if(J){const be=JSON.parse(localStorage.getItem(`cravingStats_${n.uid}`)||'{"resisted": 0, "relapses": 0}');be.resisted=J.resisted,be.relapses=J.relapses,be.lastUpdated=Me,localStorage.setItem(`cravingStats_${n.uid}`,JSON.stringify(be))}w(G==="resisted"?{title:"🎉 Great Job!",message:`You successfully resisted that craving!

Your progress has been recorded locally and will sync when the connection is restored.`,type:"success"}:G==="relapsed"?{title:"🌟 New Beginning",message:`Every relapse is a chance to learn and grow stronger. You're back on track and that takes courage!

Your progress has been recorded locally and will sync when the connection is restored.`,type:"success"}:{title:"📝 Progress Recorded",message:"Your progress has been recorded locally and will sync when the connection is restored.",type:"info"}),p(!0),v(!1),C(1)}},ge=async()=>{try{const G=new Date().toISOString(),Z=new Date().toDateString();let J=null;const{ref:Me,set:Pe,push:be,get:Ct}=await ke(()=>import("./index.esm-25d69fbc.js"),[]);if(n&&n.uid){const vt=Me(K,`users/${n.uid}/cravings`),Nt=be(vt);await Pe(Nt,{strength:0,mood:"quick",context:"quick_action",outcome:"resisted",timestamp:G,date:Z});const gt=Me(K,`users/${n.uid}/profile/cravingStats`),Ae={resisted:_.resisted+1,relapses:_.relapses,lastUpdated:G};if(await Pe(gt,Ae),B(Ae),window.centralizedStatService){console.log("🔄 Quick Resistance: Using CentralizedStatService...");const Ye=await window.centralizedStatService.getCurrentStats(),un=(Ye==null?void 0:Ye.mentalStrengthCravingsApplied)||0;console.log("🔄 Quick Resistance: Current mental strength bonus before processing:",un);const rn=await window.centralizedStatService.handleCravingResisted();if(console.log("✅ Quick Resistance: Stats updated via CentralizedStatService"),rn&&rn.applied){const In=rn.cravingsApplied||0,ur=Math.max(0,3-In);console.log("🔄 Quick Resistance: Bonus applied, remaining:",ur),ur>0?qe("Craving Resisted! 💪",`Great job! You earned +1 mental strength point. You can still earn ${ur} more today.`,"success"):qe("Craving Resisted! 💪","Excellent! You've reached the daily maximum of 3 mental strength points from craving resistance.","success")}else console.log("🔄 Quick Resistance: Daily limit reached, showing limit message"),qe("Daily Mental Strength Limit Reached","You've already earned the maximum 3 mental strength points from craving resistance today. Keep up the great work! Your resistance still counts for your overall progress.","info");typeof window.refreshArenaStats=="function"&&(console.log("🔄 Quick Resistance: Refreshing Arena stats..."),window.refreshArenaStats(),setTimeout(()=>{console.log("🔄 Quick Resistance: Secondary Arena stats refresh..."),window.refreshArenaStats()},1e3));return}else S&&(J=await S.checkDailyCravingResistanceLimits(Z),await S.handleCravingResistance())}const qt=JSON.parse(localStorage.getItem(`cravings_${n.uid}`)||"[]");qt.push({strength:0,mood:"quick",context:"quick_action",outcome:"resisted",timestamp:G,date:Z}),localStorage.setItem(`cravings_${n.uid}`,JSON.stringify(qt));const Rt={resisted:_.resisted+1,relapses:_.relapses,lastUpdated:G};localStorage.setItem(`cravingStats_${n.uid}`,JSON.stringify(Rt)),B(Rt),J?!J.canAwardMentalStrength&&!J.canAwardTriggerDefense?w({title:"🎯 Daily Limits Reached",message:`You've reached your daily limits for Mental Strength (3 points) and Trigger Defense (5 points).

Great job staying consistent! Come back tomorrow for more opportunities to grow.`,type:"info"}):J.canAwardMentalStrength?J.canAwardTriggerDefense?w({title:"🎉 Quick Win!",message:`Great job resisting that craving!

Your Mental Strength increased by 1 point and Trigger Defense increased by 3 points!`,type:"success"}):w({title:"🎯 Trigger Defense Limit Reached",message:`You've reached your daily limit for Trigger Defense (5 points).

Your Mental Strength increased by 1 point!

Come back tomorrow for more Trigger Defense opportunities.`,type:"info"}):w({title:"🎯 Mental Strength Limit Reached",message:`You've reached your daily limit for Mental Strength (3 points).

Your Trigger Defense increased by 3 points!

Come back tomorrow for more Mental Strength opportunities.`,type:"info"}):w({title:"🎉 Quick Win!",message:`Great job resisting that craving!

Your Mental Strength and Trigger Defense have increased.`,type:"success"}),p(!0)}catch(G){console.error("Error recording quick resistance:",G),w({title:"Progress Recorded",message:"Your progress has been recorded locally.",type:"info"}),p(!0)}},de=async()=>{try{const G=new Date().toISOString(),Z=new Date().toDateString();if(n&&n.uid){const{ref:Pe,set:be,push:Ct}=await ke(()=>import("./index.esm-25d69fbc.js"),[]),qt=Pe(K,`users/${n.uid}/cravings`),Rt=Ct(qt);if(await be(Rt,{strength:0,mood:"quick",context:"quick_action",outcome:"relapsed",timestamp:G,date:Z}),window.centralizedStatService)console.log("🔄 Quick Relapse: Using CentralizedStatService..."),await window.centralizedStatService.handleRelapse(),console.log("✅ Quick Relapse: Stats updated via CentralizedStatService"),qe("💔 Relapse Logged",`It's okay, setbacks happen. What matters is that you're getting back on track.

Your stats have been updated with escalation penalties.

Keep pushing forward! 💪`,"warning");else if(S){console.log("🔄 Quick Relapse: Calling StatManager.handleRelapse()...");const gt=await S.handleRelapse();if(console.log("🔄 Quick Relapse: StatManager.handleRelapse() result:",gt),o)try{const Ae=await S.getCurrentEscalationLevel();await o.logRelapse(n.uid,{escalationLevel:Ae,triggers:n.triggers||[],mood:"quick",context:"quick_action",addictionIncrease:Ae===1?4:Ae===2?6:8,mentalStrengthDecrease:3,triggerDefenseDecrease:3}),console.log("✅ Quick relapse also logged to Firestore for analytics")}catch(Ae){console.warn("⚠️ Could not log quick relapse to Firestore:",Ae.message),await ce("relapse",{escalationLevel:await S.getCurrentEscalationLevel(),triggers:n.triggers||[],mood:"quick",context:"quick_action",addictionIncrease:escalationLevel===1?4:escalationLevel===2?6:8,mentalStrengthDecrease:3,triggerDefenseDecrease:3})}try{await new Promise(rn=>setTimeout(rn,100));const{ref:Ae,get:Ye}=await ke(()=>import("./index.esm-25d69fbc.js"),[]),un=await Ye(Ae(K,`users/${n.uid}/stats`));if(un.exists()){const rn=un.val();console.log("🔍 Quick Relapse: VERIFICATION - Firebase stats immediately after StatManager:",rn)}else console.log("❌ Quick Relapse: VERIFICATION - No stats found in Firebase!")}catch(Ae){console.error("❌ Quick Relapse: VERIFICATION failed:",Ae)}try{const Ae=await S.getCurrentEscalationLevel();let Ye=0;switch(Ae){case 1:Ye=4;break;case 2:Ye=6;break;default:Ye=8;break}qe("💔 Relapse Logged",`It's okay, setbacks happen. What matters is that you're getting back on track.

📊 Stat Changes:
• Addiction: +${Ye} points
• Mental Strength: -3 points
• Trigger Defense: -3 points

Your journey continues! 💪`,"warning")}catch(Ae){console.warn("Could not get escalation level for message:",Ae),qe("💔 Relapse Logged",`It's okay, setbacks happen. What matters is that you're getting back on track.

Your stats have been updated. Keep pushing forward! 💪`,"warning")}}else console.error("❌ Quick Relapse: StatManager not available!"),qe("⚠️ Service Unavailable","Stats service is not available. Your relapse has been recorded locally and will sync when the service is restored.","warning");const vt=Pe(K,`users/${n.uid}/profile/cravingStats`),Nt={resisted:_.resisted,relapses:_.relapses+1,lastUpdated:G};await be(vt,Nt),B(Nt),console.log("🔄 Quick Relapse: Triggering stats refresh..."),typeof refreshStats=="function"?(refreshStats(),setTimeout(()=>{console.log("🔄 Quick Relapse: Secondary stats refresh..."),refreshStats()},1500)):console.log("ℹ️ Quick Relapse: refreshStats function not available in this context (will refresh when returning to Arena)"),typeof window.refreshArenaStats=="function"?(console.log("🔄 Quick Relapse: Refreshing Arena stats..."),window.refreshArenaStats(),setTimeout(()=>{console.log("🔄 Quick Relapse: Secondary Arena stats refresh..."),window.refreshArenaStats()},2e3)):console.warn("⚠️ Quick Relapse: window.refreshArenaStats not available"),console.log("🔄 Quick Relapse: Triggering immediate PWA refresh..."),typeof window.refreshArenaStats=="function"&&(console.log("🔄 Quick Relapse: Immediate Arena stats refresh..."),window.refreshArenaStats()),typeof setUser=="function"&&setUser(gt=>({...gt,lastRelapseRefresh:Date.now()})),setStatsUpdateTrigger(gt=>gt+1),window.centralizedStatService&&window.centralizedStatService.getCurrentStats().then(gt=>{console.log("🔄 Quick Relapse: Fetched latest stats after relapse:",gt),typeof window.setLatestUserStats=="function"&&window.setLatestUserStats(gt)}).catch(gt=>{console.error("❌ Quick Relapse: Failed to fetch latest stats:",gt)}),setTimeout(()=>{console.log("🔄 Quick Relapse: Secondary immediate refresh..."),typeof window.refreshArenaStats=="function"&&window.refreshArenaStats(),window.dispatchEvent(new Event("resize"))},100),setTimeout(()=>{console.log("🔄 Quick Relapse: Tertiary immediate refresh..."),typeof window.refreshArenaStats=="function"&&window.refreshArenaStats()},500)}const J=JSON.parse(localStorage.getItem(`cravings_${n.uid}`)||"[]");J.push({strength:0,mood:"quick",context:"quick_action",outcome:"relapsed",timestamp:G,date:Z}),localStorage.setItem(`cravings_${n.uid}`,JSON.stringify(J));const Me={resisted:_.resisted,relapses:_.relapses+1,lastUpdated:G};localStorage.setItem(`cravingStats_${n.uid}`,JSON.stringify(Me)),B(Me)}catch(G){console.error("Error recording quick relapse:",G),qe("💔 Relapse Logged",`It's okay, setbacks happen. What matters is that you're getting back on track.

Your progress has been recorded locally and will sync when the connection is restored.

Keep pushing forward! 💪`,"warning")}},me=async(G,Z=30)=>{try{if(!G)return null;const{ref:J,get:Me,query:Pe,orderByChild:be,startAt:Ct,endAt:qt}=await ke(()=>import("./index.esm-25d69fbc.js"),[]),Rt=new Date,vt=new Date(Rt.getTime()-Z*24*60*60*1e3),Nt=J(K,`users/${G}/cravings`),gt=await Me(Nt);if(!gt.exists())return{totalCravings:0,resistedCount:0,relapseCount:0,averageStrength:0,commonMoods:[],commonContexts:[],timeOfDayPatterns:{},weeklyTrends:{},insights:[]};const Ye=Object.values(gt.val()||{}).filter(ct=>{const ut=new Date(ct.timestamp);return ut>=vt&&ut<=Rt});if(Ye.length===0)return{totalCravings:0,resistedCount:0,relapseCount:0,averageStrength:0,commonMoods:[],commonContexts:[],timeOfDayPatterns:{},weeklyTrends:{},insights:[]};const un=Ye.filter(ct=>ct.outcome==="resisted").length,rn=Ye.filter(ct=>ct.outcome==="relapsed").length,In=Ye.length,ur=Ye.reduce((ct,ut)=>ct+(ut.strength||0),0)/In,mt={},dn={},hn={},Jn={};Ye.forEach(ct=>{ct.mood&&(mt[ct.mood]=(mt[ct.mood]||0)+1),ct.context&&(dn[ct.context]=(dn[ct.context]||0)+1),ct.timeOfDay&&(hn[ct.timeOfDay]=(hn[ct.timeOfDay]||0)+1);const ut=new Date(ct.timestamp),yn=`${ut.getFullYear()}-W${Math.ceil((ut.getDate()+new Date(ut.getFullYear(),0,1).getDay())/7)}`;Jn[yn]=(Jn[yn]||0)+1});const Sn=Object.entries(mt).sort(([,ct],[,ut])=>ut-ct).slice(0,3).map(([ct,ut])=>({mood:ct,count:ut})),mn=Object.entries(dn).sort(([,ct],[,ut])=>ut-ct).slice(0,3).map(([ct,ut])=>({context:ct,count:ut})),dr=[];return un>rn&&dr.push("You're successfully resisting more cravings than giving in - great job!"),ur>7&&dr.push("Your cravings tend to be high intensity. Consider developing stronger coping strategies for intense moments."),hn.afternoon>hn.morning&&hn.afternoon>hn.evening&&dr.push("Afternoons seem to be your most challenging time. Consider planning activities or support during this period."),Sn.length>0&&Sn[0].count>In*.4&&dr.push(`You often experience cravings when feeling ${Sn[0].mood}. This might be a key trigger to address.`),{totalCravings:In,resistedCount:un,relapseCount:rn,averageStrength:Math.round(ur*10)/10,successRate:In>0?Math.round(un/In*100):0,commonMoods:Sn,commonContexts:mn,timeOfDayPatterns:hn,weeklyTrends:Jn,insights:dr,dateRange:{start:vt.toDateString(),end:Rt.toDateString(),days:Z}}}catch(J){return console.error("Error getting craving insights:",J),null}},ue=async(G,Z="json")=>{try{if(!G)return null;const{ref:J,get:Me}=await ke(()=>import("./index.esm-25d69fbc.js"),[]),Pe=J(K,`users/${n.uid}/cravings`),be=await Me(Pe);if(!be.exists())return console.log("No craving data to export"),null;const Ct=Object.values(be.val()||{});if(Z==="json"){const qt=JSON.stringify(Ct,null,2),Rt=new Blob([qt],{type:"application/json"}),vt=URL.createObjectURL(Rt),Nt=document.createElement("a");return Nt.href=vt,Nt.download=`craving-data-${G}-${new Date().toISOString().split("T")[0]}.json`,Nt.click(),URL.revokeObjectURL(vt),console.log(`Exported ${Ct.length} craving records for user ${G}`),Ct.length}return Ct.length}catch(J){return console.error("Error exporting craving data:",J),null}},Be=async()=>{if(!(n!=null&&n.uid)){console.log("No user logged in");return}console.log("🧪 Testing craving insights...");const G=await me(n.uid,30);G?(console.log("📊 Craving Insights:",G),w({title:"📊 Your Craving Insights",message:`Last 30 days:

Total cravings: ${G.totalCravings}
Successfully resisted: ${G.resistedCount}
Relapses: ${G.relapseCount}
Success rate: ${G.successRate}%
Average intensity: ${G.averageStrength}/10

Top mood triggers: ${G.commonMoods.map(Z=>`${Z.mood} (${Z.count})`).join(", ")}
Top contexts: ${G.commonContexts.map(Z=>`${Z.context} (${Z.count})`).join(", ")}

Insights:
${G.insights.join(`
`)}`,type:"info"}),p(!0)):(console.log("No insights available"),w({title:"📊 No Data Yet",message:"Start logging cravings to see insights and patterns!",type:"info"}),p(!0))};return d.jsx("div",{className:"min-h-screen bg-gradient-to-br from-slate-900 via-blue-900 to-slate-900 py-8 pb-20",children:d.jsxs("div",{className:"max-w-2xl mx-auto px-4",children:[d.jsx("div",{className:"mb-8",children:d.jsxs("div",{className:"flex justify-start gap-3",children:[d.jsx("button",{onClick:t,className:"px-6 py-3 bg-slate-600 hover:bg-slate-500 text-white rounded-lg transition-colors flex items-center gap-2",children:"← Back to Login"}),!1]})}),d.jsxs("div",{className:"bg-slate-800/30 rounded-2xl p-8 mb-8 border border-slate-600/30 shadow-xl",children:[d.jsx("div",{className:"mb-8",children:d.jsx("button",{onClick:ae,className:"w-full bg-gradient-to-r from-orange-400 via-amber-500 to-orange-500 hover:from-orange-500 hover:via-amber-600 hover:to-orange-600 text-white font-semibold py-5 px-6 rounded-2xl text-lg transition-all duration-300 transform hover:scale-102 shadow-2xl border border-orange-300/30 hover:border-orange-300/50",children:d.jsxs("div",{className:"flex items-center justify-center gap-3",children:[d.jsx("span",{className:"text-xl",children:"⚠️"}),d.jsx("span",{children:"I feel like vaping"})]})})}),d.jsxs("div",{className:"grid grid-cols-2 gap-6",children:[d.jsx("button",{onClick:ge,className:"btn-success touch-interactive ripple-effect bg-slate-700/50 hover:bg-slate-600/50 text-slate-200 font-medium py-3 px-5 rounded-full shadow-lg border border-slate-500/30 hover:border-slate-400/50 min-h-[44px]",children:d.jsxs("div",{className:"flex items-center justify-center gap-2",children:[d.jsx("span",{className:"text-green-400",children:"✅"}),d.jsx("span",{children:"I resisted craving"})]})}),d.jsx("button",{onClick:de,className:"btn-danger touch-interactive ripple-effect bg-slate-700/50 hover:bg-slate-600/50 text-slate-200 font-medium py-3 px-5 rounded-full shadow-lg border border-slate-500/30 hover:border-slate-400/50 min-h-[44px]",children:d.jsxs("div",{className:"flex items-center justify-center gap-2",children:[d.jsx("span",{className:"text-red-400",children:"❌"}),d.jsx("span",{children:"I relapsed"})]})})]})]}),d.jsxs("div",{className:"bg-slate-800/30 rounded-2xl p-6 mb-8 border border-slate-600/30 shadow-lg",children:[d.jsx("h2",{className:"text-lg font-medium text-slate-200 mb-6 text-center",children:"📊 This Week"}),d.jsxs("div",{className:"grid grid-cols-2 gap-6",children:[d.jsxs("div",{className:"text-center p-5 bg-slate-700/30 rounded-xl border border-slate-500/20 hover:border-slate-400/40 transition-all duration-300",children:[d.jsx("div",{className:"text-2xl mb-3 text-green-400",children:"🎯"}),d.jsx("p",{className:"text-2xl font-semibold text-white mb-1",children:_.resisted}),d.jsx("p",{className:"text-sm text-slate-300",children:"Cravings Resisted"})]}),d.jsxs("div",{className:"text-center p-5 bg-slate-700/30 rounded-xl border border-slate-500/20 hover:border-slate-400/40 transition-all duration-300",children:[d.jsx("div",{className:"text-2xl mb-3 text-red-400",children:"💔"}),d.jsx("p",{className:"text-2xl font-semibold text-white mb-1",children:_.relapses}),d.jsx("p",{className:"text-sm text-slate-300",children:"Relapses"})]})]})]}),d.jsx("div",{className:"bg-slate-800/30 rounded-2xl p-6 mb-8 border border-slate-600/30 shadow-lg",children:d.jsxs("div",{className:"text-center",children:[d.jsx("h2",{className:"text-lg font-medium text-slate-200 mb-6",children:"🎮 Distract Yourself"}),d.jsx("div",{className:"flex justify-center",children:d.jsx("button",{onClick:De,className:"w-full max-w-xs bg-slate-700/30 hover:bg-slate-600/40 text-slate-200 font-medium py-4 px-6 rounded-xl text-lg transition-all duration-300 transform hover:scale-105 border border-slate-500/20 hover:border-slate-400/40 shadow-lg min-h-[44px]",children:"🐍 Play Snake"})})]})}),d.jsx("div",{className:"bg-slate-800/30 rounded-2xl p-6 mb-8 border border-slate-600/30 shadow-lg",children:d.jsxs("div",{className:"text-center",children:[d.jsx("h2",{className:"text-lg font-medium text-slate-200 mb-6",children:"📊 Data Analysis"}),d.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[d.jsx("button",{onClick:Be,className:"bg-blue-600/30 hover:bg-blue-500/40 text-blue-200 font-medium py-3 px-4 rounded-xl transition-all duration-300 transform hover:scale-105 border border-blue-500/20 hover:border-blue-400/40 shadow-lg min-h-[44px]",children:"🔍 View Insights"}),d.jsx("button",{onClick:()=>ue(n==null?void 0:n.uid,"json"),className:"bg-green-600/30 hover:bg-green-500/40 text-green-200 font-medium py-3 px-4 rounded-xl transition-all duration-300 transform hover:scale-105 border border-green-500/20 hover:border-green-400/40 shadow-lg min-h-[44px]",children:"📥 Export Data"})]})]})}),d.jsxs("div",{className:"bg-slate-800/30 rounded-2xl p-6 border border-slate-600/30 shadow-lg",children:[d.jsx("h2",{className:"text-lg font-medium text-slate-200 mb-6 text-center",children:"⚡ Quick Actions"}),d.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[d.jsx("button",{onClick:()=>x(!0),className:"btn-primary touch-interactive ripple-effect bg-slate-700/30 hover:bg-slate-600/40 text-slate-200 font-medium py-4 px-4 rounded-xl border border-slate-500/20 hover:border-slate-400/40 shadow-lg min-h-[44px]",children:"💧 Hydration"}),d.jsx("button",{onClick:()=>L(!0),className:"breathing-button touch-interactive ripple-effect bg-slate-700/30 hover:bg-slate-600/40 text-slate-200 font-medium py-4 px-4 rounded-xl border border-slate-500/20 hover:border-slate-400/40 shadow-lg min-h-[44px]",children:"🫁 Breathe"}),d.jsx("button",{onClick:async()=>{if(qe("🚶‍♂️ Walk",`Take a 5-minute walk:

Physical activity releases endorphins that can help reduce cravings.

Walk around your room or step outside if possible.`),o)try{await o.logPhysicalActivity(n.uid,{type:"walk",duration:5,intensity:"moderate",triggerContext:"craving-triggered",location:"indoor/outdoor"}),console.log("✅ Physical activity (walk) logged to Firestore for analytics")}catch(G){console.warn("⚠️ Could not log physical activity to Firestore:",G.message),await ce("walk",{type:"walk",duration:5,intensity:"moderate",triggerContext:"craving-triggered",location:"indoor/outdoor"})}},className:"bg-slate-700/30 hover:bg-slate-600/40 text-slate-200 font-medium py-4 px-4 rounded-xl transition-all duration-300 border border-slate-500/20 hover:border-slate-400/40 hover:scale-105 shadow-lg min-h-[44px]",children:"🚶‍♂️ Walk"}),d.jsx("button",{onClick:async()=>{if(qe("🧘‍♀️ Meditate",`Quick Meditation:

1. Close your eyes
2. Focus on your breath
3. Count to 10 slowly
4. Repeat 3 times

This helps calm your mind and reduce stress.`),o)try{await o.logMeditation(n.uid,{type:"mindfulness",duration:2,triggerContext:"craving-triggered",completed:!0}),console.log("✅ Meditation (quick) logged to Firestore for analytics")}catch(G){console.warn("⚠️ Could not log meditation to Firestore:",G.message)}},className:"bg-slate-700/30 hover:bg-slate-600/40 text-slate-200 font-medium py-4 px-4 rounded-xl transition-all duration-300 border border-slate-500/20 hover:border-slate-400/40 hover:scale-105 shadow-lg min-h-[44px]",children:"🧘‍♀️ Meditate"})]})]}),a&&u&&d.jsx(Eq,{gameType:u,onClose:D}),d.jsx(Sq,{isOpen:f,onClose:()=>p(!1),title:y.title,message:y.message,type:y.type}),E&&d.jsx(Aq,{isOpen:E,onClose:()=>x(!1),onLogWater:q,currentWater:N,userId:n.uid}),$&&d.jsx(iq,{isOpen:$,onClose:()=>L(!1),onComplete:s,onNavigateToCravingSupport:()=>i("craving-support")}),R&&d.jsx(bq,{isOpen:R,onClose:()=>v(!1),step:T,cravingData:A,setCravingData:b,onNext:pe,onPrev:Te,onComplete:ne,dailyCravingLogs:ve})]})})},bq=({isOpen:n,onClose:e,step:t,cravingData:r,setCravingData:s,onNext:i,onPrev:o,onComplete:a,dailyCravingLogs:l})=>{const u=y=>y<=3?{text:"text-green-400",slider:"#22c55e",shadow:"rgba(74, 222, 128, 0.5)",label:"Low",effect:"craving-low",thumbClass:"slider-thumb-green"}:y<=7?{text:"text-orange-400",slider:"#fbbf24",shadow:"rgba(249, 115, 22, 0.5)",label:"Medium",effect:"craving-medium",thumbClass:"slider-thumb-orange"}:{text:"text-red-400",slider:"#ef4444",shadow:"rgba(239, 68, 68, 0.5)",label:"High",effect:"craving-high",thumbClass:"slider-thumb-red"},h=[{id:"stressed",icon:"😰",label:"Stressed"},{id:"lonely",icon:"😔",label:"Lonely"},{id:"happy",icon:"😊",label:"Happy"},{id:"bored",icon:"😐",label:"Bored"},{id:"excited",icon:"🤩",label:"Excited"},{id:"down",icon:"😞",label:"Down"},{id:"angry",icon:"😠",label:"Angry"},{id:"anxious",icon:"😰",label:"Anxious"}],f=[{id:"break",icon:"☕",label:"I'm taking a break"},{id:"partying",icon:"🎉",label:"I'm partying"},{id:"drinking",icon:"🍺",label:"I'm drinking alcohol"},{id:"car",icon:"🚗",label:"I'm in a car"},{id:"coffee",icon:"☕",label:"I'm drinking coffee"},{id:"eating",icon:"🍽️",label:"I've just finished eating"},{id:"intimate",icon:"💕",label:"I've made love"},{id:"tv",icon:"📺",label:"I'm watching TV"},{id:"wake",icon:"🌅",label:"I've just woken up"}],p=()=>{switch(t){case 1:return d.jsx("div",{className:"text-center",children:d.jsx("div",{className:"mb-8",children:(()=>{const y=u(r.strength);return d.jsxs(d.Fragment,{children:[d.jsx("div",{className:`text-6xl font-bold mb-2 ${y.text} ${y.effect}`,children:r.strength}),d.jsxs("div",{className:`text-lg font-medium mb-6 ${y.text}`,children:[y.label," Craving"]}),d.jsx("input",{type:"range",min:"0",max:"10",value:r.strength,onChange:w=>s({...r,strength:parseInt(w.target.value)}),style:{background:`linear-gradient(to right, ${y.slider} 0%, ${y.slider} ${r.strength/10*100}%, #475569 ${r.strength/10*100}%, #475569 100%)`},className:`w-full h-4 rounded-lg appearance-none cursor-pointer slider mb-4 ${y.thumbClass}`,autoComplete:"off"}),d.jsxs("div",{className:"flex justify-between text-sm text-gray-400",children:[d.jsx("span",{children:"Not at all"}),d.jsx("span",{children:"Extremely"})]})]})})()})});case 2:return d.jsx("div",{className:"text-center",children:d.jsx("div",{className:"grid grid-cols-4 gap-3",children:h.map(y=>d.jsxs("button",{onClick:()=>s({...r,mood:y.id}),className:`p-4 rounded-xl border-2 transition-all duration-300 min-h-[44px] ${r.mood===y.id?"border-blue-400 bg-blue-500/20":"border-slate-600 bg-slate-700/50 hover:border-slate-500"}`,children:[d.jsx("div",{className:"text-3xl mb-2",children:y.icon}),d.jsx("div",{className:"text-xs text-gray-300",children:y.label})]},y.id))})});case 3:return d.jsx("div",{className:"text-center",children:d.jsx("div",{className:"grid grid-cols-3 gap-3",children:f.map(y=>d.jsxs("button",{onClick:()=>s({...r,context:y.id}),className:`p-4 rounded-xl border-2 transition-all duration-300 min-h-[44px] ${r.context===y.id?"border-blue-400 bg-blue-500/20":"border-slate-600 bg-slate-700/50 hover:border-slate-500"}`,children:[d.jsx("div",{className:"text-2xl mb-2",children:y.icon}),d.jsx("div",{className:"text-xs text-gray-300 text-center",children:y.label})]},y.id))})});case 4:return d.jsx("div",{className:"text-center",children:d.jsxs("div",{className:"space-y-4",children:[d.jsx("button",{onClick:()=>a("resisted"),className:"w-full bg-gradient-to-r from-green-500 to-green-600 hover:from-green-600 hover:to-green-700 text-white font-bold py-4 px-6 rounded-xl transition-all duration-300 transform hover:scale-105 shadow-lg",children:"💪 I successfully resisted"}),d.jsx("button",{onClick:()=>a("resistance_practices"),className:"w-full bg-gradient-to-r from-purple-500 to-purple-600 hover:from-purple-600 hover:to-purple-700 text-white font-bold py-4 px-6 rounded-xl transition-all duration-300 transform hover:scale-105 shadow-lg",children:"🛡️ Use resistance practices"}),d.jsx("button",{onClick:()=>a("logged"),className:"w-full bg-gradient-to-r from-blue-500 to-blue-600 hover:from-blue-600 hover:to-blue-700 text-white font-bold py-4 px-6 rounded-xl transition-all duration-300 transform hover:scale-105 shadow-lg",children:"📝 Just log this craving"}),d.jsx("button",{onClick:()=>a("relapsed"),className:"w-full bg-gradient-to-r from-red-500 to-red-600 hover:from-red-600 hover:to-red-700 text-white font-bold py-4 px-6 rounded-xl transition-all duration-300 transform hover:scale-105 shadow-lg",children:"💔 I had a relapse"})]})});default:return null}};return n?d.jsx("div",{className:"modal-backdrop",children:d.jsx("div",{className:"modal-container",children:d.jsxs("div",{className:"modal-content bg-gradient-to-br from-slate-800 via-slate-700 to-slate-800 border-slate-600/50 relative overflow-hidden max-w-lg",children:[d.jsx("div",{className:"absolute inset-0 bg-orange-500/5 pointer-events-none"}),d.jsxs("div",{className:"relative z-10",children:[d.jsxs("div",{className:"text-center mb-6",children:[d.jsx("div",{className:"flex justify-center space-x-2 mb-3",children:[1,2,3,4].map(y=>d.jsx("div",{className:`w-3 h-3 rounded-full ${y<=t?"bg-orange-400":"bg-slate-600"}`},y))}),d.jsxs("p",{className:"text-gray-400 text-sm",children:["Step ",t," of 4"]}),d.jsxs("div",{className:"mt-2 text-xs text-gray-500",children:["Daily logs: ",l,"/2"]})]}),d.jsx("div",{className:"mb-8",children:p()}),d.jsxs("div",{className:"flex justify-between",children:[t>1&&d.jsx("button",{onClick:o,className:"px-6 py-3 bg-slate-600 hover:bg-slate-500 text-white rounded-xl transition-colors",children:"← Back"}),t<4&&d.jsx("button",{onClick:i,disabled:t===1&&r.strength===void 0||t===2&&!r.mood||t===3&&!r.context,className:"px-6 py-3 bg-orange-500 hover:bg-orange-600 disabled:bg-slate-600 disabled:cursor-not-allowed text-white rounded-xl transition-colors ml-auto",children:"Next →"})]}),d.jsx("button",{onClick:e,className:"absolute top-4 right-4 text-gray-400 hover:text-white text-2xl",children:"×"})]})]})})}):null},Aq=({isOpen:n,onClose:e,onLogWater:t,currentWater:r,userId:s})=>{const[i,o]=O.useState(0),[a,l]=O.useState(0),[u,h]=O.useState(!1);O.useState(!1),O.useEffect(()=>{n&&s&&f()},[n,s,r]);const f=async()=>{try{const{ref:k,get:E}=await ke(()=>import("./index.esm-25d69fbc.js"),[]),x=await p();o(x);const N=await y();l(N)}catch(k){console.error("Error loading hydration data:",k)}},p=async()=>{try{const{ref:k,get:E}=await ke(()=>import("./index.esm-25d69fbc.js"),[]);let x=0;for(let N=0;N<7;N++){const P=new Date;P.setDate(P.getDate()-N);const $=P.toDateString(),L=await E(k(K,`users/${s}/profile/daily/${$}/water`));if(L.exists()&&L.val()>0)x++;else break}return x}catch(k){return console.error("Error checking hydration streak:",k),0}},y=async()=>{try{const{ref:k,get:E}=await ke(()=>import("./index.esm-25d69fbc.js"),[]);let x=0;for(let N=0;N<7;N++){const P=new Date;P.setDate(P.getDate()-N);const $=P.toDateString(),L=await E(k(K,`users/${s}/profile/daily/${$}/water`));L.exists()&&L.val()>=6&&x++}return Math.min(x,3)}catch(k){return console.error("Error checking mental strength progress:",k),0}},w=()=>d.jsx("div",{className:"glasses-visual",children:[...Array(6)].map((k,E)=>{const x=E<r;return d.jsx("div",{className:`glass ${x?"filled":""}`},E)})}),S=async()=>{!s||u||r>=6||(h(!0),t(),setTimeout(async()=>{h(!1),await f()},1e3))};return!n||!s?null:d.jsx("div",{className:"modal-backdrop",children:d.jsx("div",{className:"modal-container",children:d.jsx("div",{className:"modal-content",children:d.jsxs("div",{className:"hydration-module",children:[d.jsxs("div",{className:"module-header",children:[d.jsxs("div",{className:"module-title",children:[d.jsx("div",{className:"water-icon",children:"💧"}),"Hydration Tracker"]}),d.jsx("p",{className:"subtitle",children:"Stay hydrated, stay strong"})]}),d.jsxs("div",{className:"progress-container",children:[d.jsxs("div",{className:"progress-header",children:[d.jsx("span",{className:"progress-text",children:"Today's Progress"}),d.jsxs("span",{className:"progress-fraction",children:[r,"/6"]})]}),w(),d.jsx("div",{className:"progress-bar",children:d.jsx("div",{className:"progress-fill",style:{width:`${r/6*100}%`}})}),d.jsxs("div",{className:"progress-percentage",children:[Math.round(r/6*100),"% Complete"]})]}),d.jsxs("div",{className:"streak-section",children:[d.jsxs("div",{className:"streak-card",children:[d.jsx("span",{className:"streak-icon",children:"🔥"}),d.jsx("div",{className:"streak-label",children:"Hydration Streak"}),d.jsxs("div",{className:"streak-value",children:[i," days"]})]}),d.jsxs("div",{className:"streak-card",children:[d.jsx("span",{className:"streak-icon",children:"💪"}),d.jsx("div",{className:"streak-label",children:"Mental Strength"}),d.jsxs("div",{className:"streak-value",children:[a,"/3"]})]})]}),r===6&&d.jsx("div",{className:"completion-message",children:"🎉 Congratulations! You've completed your daily hydration goal!"}),d.jsx("button",{onClick:S,disabled:r>=6||u,className:"log-button",children:r>=6?"🎉 Goal Complete!":u?"💧 Logging...":"💧 Log Water"}),d.jsx("button",{onClick:e,className:"done-button",children:"Done"})]})})})})},Cq=({user:n,onNavigate:e})=>{const[t,r]=O.useState(null),[s,i]=O.useState(!1),[o,a]=O.useState(!1),[l,u]=O.useState(!1),[h,f]=O.useState(!1),[p,y]=O.useState(null),[w,S]=O.useState(0),[k,E]=O.useState(null),[x,N]=O.useState(!1),[P,$]=O.useState([]),[L,R]=O.useState(null);O.useEffect(()=>{if(!(n!=null&&n.uid))return;(async()=>{try{const de=new zm(K,n.uid);await de.initialize(),R(de)}catch(de){console.error("Error initializing StatManager:",de)}})();const ne=async()=>{try{const{ref:de,get:me,onValue:ue}=await ke(()=>import("./index.esm-25d69fbc.js"),[]),Be=de(K,`users/${n.uid}/profile/relapseDate`),G=await me(Be);G.exists()&&r(new Date(G.val()));const Z=de(K,`users/${n.uid}/profile/scheduledTriggers`),J=await me(Z);J.exists()&&$(J.val());const Me=new Date().toDateString(),Pe=de(K,`users/${n.uid}/profile/daily/${Me}/water`),be=ue(Pe,Ae=>{Ae.exists()&&S(Ae.val()||0)}),Ct=de(K,`users/${n.uid}/profile/daily/${Me}/mood`),qt=ue(Ct,Ae=>{Ae.exists()&&E(Ae.val())}),Rt=de(K,`users/${n.uid}/profile/daily/${Me}/breathing`),vt=ue(Rt,Ae=>{Ae.exists()&&N(Ae.val()||!1)}),Nt=de(K,`users/${n.uid}/profile/scheduledTriggers`),gt=ue(Nt,Ae=>{Ae.exists()&&$(Ae.val()||[])});return()=>{be(),qt(),vt(),gt()}}catch(de){console.error("Error loading profile data from Firebase:",de),ge()}},ge=()=>{const de=localStorage.getItem("quitCoachRelapseDate");de&&r(new Date(de));const me=new Date().toDateString(),ue=localStorage.getItem(`water_${n.uid}_${me}`),Be=localStorage.getItem(`mood_${n.uid}_${me}`),G=localStorage.getItem(`breathing_${n.uid}_${me}`);ue&&S(parseInt(ue)),Be&&E(JSON.parse(Be)),G&&N(G==="true");const Z=localStorage.getItem("scheduledTriggers");Z&&$(JSON.parse(Z))};ne()},[n==null?void 0:n.uid]),O.useEffect(()=>{L&&L.trackLoggingActivity()},[L]),O.useEffect(()=>{if(!(n!=null&&n.uid))return;(async()=>{try{const{ref:ne,get:ge,set:de}=await ke(()=>import("./index.esm-25d69fbc.js"),[]),me=ne(K,`users/${n.uid}/profile`),ue=await ge(me);if(!ue.exists()||Object.keys(ue.val()).length===0){console.log("Migrating localStorage data to Firebase...");const Be=localStorage.getItem("quitCoachRelapseDate");Be&&(await de(ne(K,`users/${n.uid}/profile/relapseDate`),Be),r(new Date(Be)));const G=parseInt(localStorage.getItem("cravingWins")||0);G>0&&await de(ne(K,`users/${n.uid}/profile/cravingsResisted`),G);for(let J=0;J<7;J++){const Me=new Date;Me.setDate(Me.getDate()-J);const Pe=Me.toDateString(),be=localStorage.getItem(`water_${n.uid}_${Pe}`);be&&await de(ne(K,`users/${n.uid}/profile/daily/${Pe}/water`),parseInt(be))}for(let J=0;J<7;J++){const Me=new Date;Me.setDate(Me.getDate()-J);const Pe=Me.toDateString(),be=localStorage.getItem(`mood_${n.uid}_${Pe}`);be&&await de(ne(K,`users/${n.uid}/profile/daily/${Pe}/mood`),JSON.parse(be))}for(let J=0;J<7;J++){const Me=new Date;Me.setDate(Me.getDate()-J);const Pe=Me.toDateString(),be=localStorage.getItem(`breathing_${n.uid}_${Pe}`);be&&await de(ne(K,`users/${n.uid}/profile/daily/${Pe}/breathing`),be==="true")}const Z=localStorage.getItem("scheduledTriggers");if(Z){const J=JSON.parse(Z);await de(ne(K,`users/${n.uid}/profile/scheduledTriggers`),J),$(J)}console.log("localStorage data migration to Firebase completed")}}catch(ne){console.error("Error migrating localStorage data to Firebase:",ne)}})()},[n==null?void 0:n.uid]);const v=()=>t&&t>((n==null?void 0:n.quitDate)||new Date(0))?t:(n==null?void 0:n.quitDate)||new Date,T=()=>{const ce=new Date,ne=new Date(ce);ne.setHours(24,0,0,0);const ge=ne-ce,de=Math.floor(ge/(1e3*60*60)),me=Math.floor(ge%(1e3*60*60)/(1e3*60)),ue=Math.floor(ge%(1e3*60)/1e3);return{hours:de,minutes:me,seconds:ue}},[C,A]=O.useState(T()),[b,_]=O.useState(0),[B,ve]=O.useState(0),[Fe,It]=O.useState(0),[Q,we]=O.useState(0);O.useEffect(()=>{const ce=setInterval(()=>{A(T());const ne=v(),de=new Date-ne,me=Math.floor(de/(1e3*60*60*24)),ue=Math.floor(de%(1e3*60*60*24)/(1e3*60*60)),Be=Math.floor(de%(1e3*60*60)/(1e3*60)),G=Math.floor(de%(1e3*60)/1e3);_(me),ve(ue),It(Be),we(G)},1e3);return()=>clearInterval(ce)},[t,n==null?void 0:n.quitDate]);const Se=async(ce,ne)=>{if(!(n!=null&&n.uid))return!1;try{const{ref:ge,set:de}=await ke(()=>import("./index.esm-25d69fbc.js"),[]),me=ge(K,`users/${n.uid}/profile/${ce}`);return await de(me,ne),!0}catch(ge){return console.error("Error saving to Firebase:",ge),!1}},qe=async()=>{const ce=new Date;r(ce),L&&await L.handleRelapse();const ne=ce.toISOString(),ge=await Se("relapseDate",ne),de=await Se("lastQuitDate",ne);ge||localStorage.setItem("quitCoachRelapseDate",ne),de||localStorage.setItem("quitCoachLastQuitDate",ne),console.log("🔄 Relapse logged - quit date reset to relapse time:",ne)},D=(()=>{const ce=new Date,ne=ce.getDay(),ge=ne===0?6:ne-1,de=[{name:"Mon",color:"bg-slate-700"},{name:"Tue",color:"bg-slate-700"},{name:"Wed",color:"bg-slate-700"},{name:"Thu",color:"bg-slate-700"},{name:"Fri",color:"bg-slate-700"},{name:"Sat",color:"bg-slate-700"},{name:"Sun",color:"bg-slate-700"}];for(let me=0;me<=ge;me++)de[me].color="bg-green-500";return t&&t.toDateString()===ce.toDateString()&&(de[ge].color="bg-red-500"),de})(),q=async ce=>{S(ce);const ne=new Date().toDateString();L&&await L.handleHydrationUpdate(ce),await Se(`daily/${ne}/water`,ce)||localStorage.setItem(`water_${ne}`,ce.toString()),i(!1)},ae=async ce=>{E(ce);const ne=new Date().toDateString();await Se(`daily/${ne}/mood`,ce)||localStorage.setItem(`mood_${ne}`,JSON.stringify(ce)),a(!1)},pe=async(ce,ne,ge)=>{const de={day:ce,triggerType:ne,time:ge,id:Date.now()},me=[...P,de];$(me),L&&await L.handleTriggerPlanning(),await Se("scheduledTriggers",me)||localStorage.setItem("scheduledTriggers",JSON.stringify(me)),u(!1)},Te=async()=>{L&&await L.handleTriggerListUpdate()};return d.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-slate-900 via-blue-900 to-slate-900 pb-20",children:[d.jsxs("div",{className:"flex items-center justify-between p-4 pt-16",children:[d.jsxs("div",{className:"flex items-center gap-3",children:[d.jsx("div",{className:"w-12 h-12 bg-gradient-to-br from-blue-400 to-blue-600 rounded-full flex items-center justify-center",children:n!=null&&n.avatar?d.jsx("img",{src:n.avatar,alt:"Avatar",className:"w-full h-full object-cover rounded-full"}):d.jsx("span",{className:"text-white font-bold text-lg",children:n!=null&&n.heroName?n.heroName.charAt(0).toUpperCase():"H"})}),d.jsxs("div",{children:[d.jsx("p",{className:"text-white text-lg",children:"Hello,"}),d.jsx("p",{className:"text-white text-2xl font-bold",children:(n==null?void 0:n.heroName)||"Hero"})]})]}),d.jsx("div",{className:"bg-yellow-500 px-3 py-1 rounded-full",children:d.jsx("span",{className:"font-bold text-slate-900",children:b})})]}),d.jsxs("div",{className:"px-4 space-y-6",children:[d.jsx("div",{className:"mb-6",children:d.jsxs("button",{onClick:qe,className:"w-full bg-gradient-to-r from-red-600 to-orange-600 hover:from-red-700 hover:to-orange-700 text-white font-bold py-4 px-6 rounded-xl transition-all duration-300 shadow-lg hover:shadow-xl transform hover:scale-105",children:[d.jsxs("div",{className:"flex items-center justify-center gap-3",children:[d.jsx("span",{className:"text-2xl",children:"⚠️"}),d.jsx("span",{className:"text-lg",children:"RELAPSE"}),d.jsx("span",{className:"text-2xl",children:"⚠️"})]}),d.jsx("p",{className:"text-sm opacity-90 mt-1",children:"Reset progress and start over"})]})}),d.jsxs("div",{className:"bg-slate-800/50 rounded-xl p-4",children:[d.jsxs("div",{className:"flex items-center justify-between mb-4",children:[d.jsx("h2",{className:"text-white text-xl font-bold",children:"My week"}),d.jsxs("div",{className:"bg-green-500 px-3 py-1 rounded-full flex items-center gap-1",children:[d.jsx("span",{className:"text-white text-sm",children:"✓"}),d.jsx("span",{className:"text-white font-bold",children:"0"})]})]}),d.jsx("div",{className:"flex justify-between items-center mb-4",children:D.map((ce,ne)=>d.jsxs("div",{className:"text-center",children:[d.jsx("div",{className:`w-8 h-8 rounded-full mb-1 ${ce.color}`}),d.jsx("p",{className:"text-gray-400 text-xs",children:ce.name})]},ce.name))})]}),d.jsxs("div",{className:"bg-slate-800/50 rounded-xl p-4",children:[d.jsx("h3",{className:"text-white text-lg font-semibold mb-2",children:"Remaining time for Today"}),d.jsxs("div",{className:"text-center",children:[d.jsxs("div",{className:"text-white text-3xl font-bold",children:[C.hours.toString().padStart(2,"0"),":",C.minutes.toString().padStart(2,"0"),":",C.seconds.toString().padStart(2,"0")]}),d.jsx("p",{className:"text-gray-400 text-sm",children:"Countdown to midnight"})]})]}),d.jsxs("div",{children:[d.jsx("h2",{className:"text-white text-2xl font-bold mb-4",children:"My progress"}),d.jsxs("div",{className:"bg-slate-800/50 rounded-xl p-4 mb-4",children:[d.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[d.jsx("span",{className:"text-yellow-400 text-lg",children:"⏰"}),d.jsx("span",{className:"text-gray-300",children:"Clean for"})]}),d.jsxs("div",{className:"flex items-baseline gap-4",children:[d.jsxs("div",{className:"text-center",children:[d.jsx("div",{className:"text-white text-3xl font-bold",children:b.toString().padStart(2,"0")}),d.jsx("div",{className:"text-gray-400 text-sm",children:"days"})]}),d.jsxs("div",{className:"text-center",children:[d.jsx("div",{className:"text-white text-3xl font-bold",children:B.toString().padStart(2,"0")}),d.jsx("div",{className:"text-gray-400 text-sm",children:"hours"})]}),d.jsxs("div",{className:"text-center",children:[d.jsx("div",{className:"text-white text-3xl font-bold",children:Fe.toString().padStart(2,"0")}),d.jsx("div",{className:"text-gray-400 text-sm",children:"minutes"})]}),d.jsxs("div",{className:"text-center",children:[d.jsx("div",{className:"text-white text-2xl font-bold animate-pulse",children:Q.toString().padStart(2,"0")}),d.jsx("div",{className:"text-gray-400 text-sm",children:"seconds"})]})]}),t&&d.jsx("div",{className:"mt-3 text-center",children:d.jsxs("p",{className:"text-red-400 text-sm",children:["Last relapse: ",t.toLocaleDateString()," at ",t.toLocaleTimeString()]})})]})]}),d.jsxs("div",{children:[d.jsx("h2",{className:"text-white text-2xl font-bold mb-4",children:"Habit Tracking"}),d.jsxs("div",{className:"space-y-4",children:[d.jsx("button",{onClick:()=>i(!0),className:"w-full bg-gradient-to-r from-blue-500/20 to-blue-600/20 bg-slate-800/50 rounded-xl p-4 text-left hover:scale-105 transition-all duration-300",children:d.jsxs("div",{className:"flex items-center gap-4",children:[d.jsx("div",{className:"w-12 h-12 bg-white rounded-lg flex items-center justify-center text-xl",children:"💧"}),d.jsxs("div",{className:"flex-1",children:[d.jsx("h3",{className:"text-white font-bold text-lg",children:"Stay hydrated"}),d.jsx("p",{className:"text-gray-300 text-sm",children:w>0?`${w} glasses today`:"Tap to log water intake"})]}),d.jsx("div",{className:"text-blue-400 text-2xl",children:"→"})]})}),d.jsx("button",{onClick:()=>a(!0),className:"w-full bg-gradient-to-r from-green-500/20 to-green-600/20 bg-slate-800/50 rounded-xl p-4 text-left hover:scale-105 transition-all duration-300",children:d.jsxs("div",{className:"flex items-center gap-4",children:[d.jsx("div",{className:"w-12 h-12 bg-white rounded-lg flex items-center justify-center text-xl",children:"🌤️"}),d.jsxs("div",{className:"flex-1",children:[d.jsx("h3",{className:"text-white font-bold text-lg",children:"Mood tracking"}),d.jsx("p",{className:"text-gray-300 text-sm",children:k?`You feel ${k.name.toLowerCase()}`:"How do you feel today?"})]}),d.jsx("div",{className:"text-green-400 text-2xl",children:"→"})]})})]})]}),d.jsxs("div",{children:[d.jsx("h2",{className:"text-white text-2xl font-bold mb-4",children:"This Week's Battle Plan"}),d.jsxs("div",{className:"space-y-3",children:[d.jsx("button",{onClick:()=>u(!0),className:"w-full bg-gradient-to-r from-orange-500/20 to-orange-600/20 bg-slate-800/50 rounded-xl p-4 text-left hover:scale-105 transition-all duration-300",children:d.jsxs("div",{className:"flex items-center gap-4",children:[d.jsx("div",{className:"w-12 h-12 bg-white rounded-lg flex items-center justify-center text-xl",children:"🛡️"}),d.jsxs("div",{className:"flex-1",children:[d.jsx("h3",{className:"text-white font-bold text-lg",children:"Trigger defense planning"}),d.jsx("p",{className:"text-gray-300 text-sm",children:P.length>0?`${P.length} triggers planned`:"Plan your trigger defense strategy"})]}),d.jsx("div",{className:"text-orange-400 text-2xl",children:"→"})]})}),d.jsx("button",{onClick:Te,className:"w-full bg-gradient-to-r from-purple-500/20 to-purple-600/20 bg-slate-800/50 rounded-xl p-4 text-left hover:scale-105 transition-all duration-300",children:d.jsxs("div",{className:"flex items-center gap-4",children:[d.jsx("div",{className:"w-12 h-12 bg-white rounded-lg flex items-center justify-center text-xl",children:"📝"}),d.jsxs("div",{className:"flex-1",children:[d.jsx("h3",{className:"text-white font-bold text-lg",children:"Update trigger list"}),d.jsx("p",{className:"text-gray-300 text-sm",children:"Review and update your personal triggers for +1 Trigger Defense"})]}),d.jsx("div",{className:"text-purple-400 text-2xl",children:"→"})]})})]})]}),d.jsx("div",{children:d.jsx("h2",{className:"text-white text-2xl font-bold mb-4",children:"Benefits Monitor"})}),d.jsxs("div",{children:[d.jsx("h2",{className:"text-white text-2xl font-bold mb-4",children:"Diary"}),d.jsx("button",{onClick:()=>f(!0),className:"w-full bg-gradient-to-r from-indigo-500/20 to-indigo-600/20 bg-slate-800/50 rounded-xl p-4 text-left hover:scale-105 transition-all duration-300",children:d.jsxs("div",{className:"flex items-center gap-4",children:[d.jsx("div",{className:"w-12 h-12 bg-white rounded-lg flex items-center justify-center text-xl",children:"📅"}),d.jsxs("div",{className:"flex-1",children:[d.jsx("h3",{className:"text-white font-bold text-lg",children:"Monthly overview"}),d.jsx("p",{className:"text-gray-300 text-sm",children:"View your progress and daily activities"})]}),d.jsx("div",{className:"text-indigo-400 text-2xl",children:"→"})]})})]})]}),d.jsx(Rq,{isOpen:s,onClose:()=>i(!1),onConfirm:q,currentWater:w}),d.jsx(Nq,{isOpen:o,onClose:()=>a(!1),onSelect:ae,selectedMood:k}),d.jsx(kq,{isOpen:l,onClose:()=>u(!1),onSchedule:pe,scheduledTriggers:P}),d.jsx(Pq,{isOpen:h,onClose:()=>f(!1),selectedDate:p,onDateSelect:y,dailyData:{water:w,mood:k,breathing:x,relapseDate:t}})]})},Rq=({isOpen:n,onClose:e,onConfirm:t,currentWater:r})=>{const[s,i]=O.useState(r),{modalRef:o,classes:a}=iI(e,{threshold:80,velocity:.4,enabled:!0});return n?d.jsx("div",{className:"modal-backdrop",children:d.jsx("div",{className:"modal-container",children:d.jsxs("div",{ref:o,className:`modal-content bg-slate-800 border-slate-700 ${a}`,role:"dialog","aria-modal":"true","aria-labelledby":"water-modal-title",children:[d.jsx("div",{className:"modal-swipe-indicator"}),d.jsxs("div",{className:"modal-scrollable",children:[d.jsxs("div",{className:"text-center mb-6 p-4",children:[d.jsx("h3",{id:"water-modal-title",className:"text-xl font-bold text-white mb-2",children:"💧 Water Intake"}),d.jsx("p",{className:"text-gray-300 text-sm",children:"How many glasses of water today?"})]}),d.jsx("div",{className:"mb-6 px-4",children:d.jsxs("div",{className:"form-group",children:[d.jsx("input",{type:"number",min:"0",max:"20",value:s,onChange:l=>i(parseInt(l.target.value)||0),className:"w-full bg-slate-700 text-white text-center text-2xl font-bold py-4 rounded-lg border border-slate-600 focus:border-blue-500 focus:outline-none",placeholder:"0",autoComplete:"off","aria-label":"Number of glasses of water"}),d.jsx("p",{className:"text-gray-400 text-sm text-center mt-2",children:"0-20 glasses"})]})}),d.jsxs("div",{className:"modal-actions px-4 pb-4",children:[d.jsx("button",{onClick:e,className:"modal-button modal-button-secondary",children:"Cancel"}),d.jsx("button",{onClick:()=>t(s),className:"modal-button modal-button-primary",children:"Confirm"})]})]})]})})}):null},Nq=({isOpen:n,onClose:e,onSelect:t,selectedMood:r})=>{const s=[{name:"Anger",icon:"😠",color:"bg-red-500"},{name:"Disgust",icon:"🤢",color:"bg-orange-500"},{name:"Enjoyment",icon:"😊",color:"bg-yellow-500"},{name:"Calm",icon:"😌",color:"bg-blue-500"},{name:"Fear",icon:"😨",color:"bg-purple-500"},{name:"Sadness",icon:"😢",color:"bg-indigo-500"},{name:"Indifferent",icon:"😐",color:"bg-gray-500"}],{modalRef:i,classes:o}=iI(e,{threshold:80,velocity:.4,enabled:!0});return n?d.jsx("div",{className:"modal-backdrop",children:d.jsx("div",{className:"modal-container",children:d.jsxs("div",{ref:i,className:`modal-content bg-slate-800 border-slate-700 ${o}`,role:"dialog","aria-modal":"true","aria-labelledby":"mood-modal-title",children:[d.jsx("div",{className:"modal-swipe-indicator"}),d.jsxs("div",{className:"modal-scrollable",children:[d.jsxs("div",{className:"text-center mb-6 p-4",children:[d.jsx("h3",{id:"mood-modal-title",className:"text-xl font-bold text-white mb-2",children:"🌤️ How do you feel?"}),d.jsx("p",{className:"text-gray-300 text-sm",children:"Select your current mood"})]}),d.jsx("div",{className:"modal-grid modal-grid-2 gap-3 mb-6 px-4",children:s.map(a=>d.jsxs("button",{onClick:()=>t(a),className:`p-4 rounded-xl text-center transition-all duration-300 hover:scale-105 min-h-[44px] ${(r==null?void 0:r.name)===a.name?"ring-2 ring-blue-400 bg-blue-600":"bg-slate-700 hover:bg-slate-600"}`,"aria-pressed":(r==null?void 0:r.name)===a.name,"aria-label":`Select ${a.name} mood`,children:[d.jsx("div",{className:`w-12 h-12 ${a.color} rounded-full flex items-center justify-center text-2xl mx-auto mb-2`,children:a.icon}),d.jsx("p",{className:"text-white font-semibold",children:a.name})]},a.name))}),d.jsx("div",{className:"modal-actions px-4 pb-4",children:d.jsx("button",{onClick:e,className:"modal-button modal-button-secondary",children:"Cancel"})})]})]})})}):null},kq=({isOpen:n,onClose:e,onSchedule:t,scheduledTriggers:r})=>{const[s,i]=O.useState(""),[o,a]=O.useState(""),[l,u]=O.useState("12:00"),h=["Social event","Drinks","High-stress event","Social pressure"],f=["Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday"];return n?d.jsx("div",{className:"modal-backdrop",children:d.jsx("div",{className:"modal-container",children:d.jsxs("div",{className:"modal-content bg-slate-800 border-slate-700",children:[d.jsxs("div",{className:"text-center mb-6",children:[d.jsx("h3",{className:"text-xl font-bold text-white mb-2",children:"🛡️ Trigger Defense Planning"}),d.jsx("p",{className:"text-gray-300 text-sm",children:"Schedule your trigger defense strategy"})]}),d.jsxs("div",{className:"space-y-4 mb-6",children:[d.jsxs("div",{children:[d.jsx("label",{className:"block text-white text-sm font-semibold mb-2",children:"Day of the week"}),d.jsxs("select",{value:s,onChange:p=>i(p.target.value),className:"w-full bg-slate-700 text-white p-3 rounded-lg border border-slate-600 focus:border-blue-500 focus:outline-none",children:[d.jsx("option",{value:"",children:"Select a day"}),f.map(p=>d.jsx("option",{value:p,children:p},p))]})]}),d.jsxs("div",{children:[d.jsx("label",{className:"block text-white text-sm font-semibold mb-2",children:"Trigger type"}),d.jsxs("select",{value:o,onChange:p=>a(p.target.value),className:"w-full bg-slate-700 text-white p-3 rounded-lg border border-slate-600 focus:border-blue-500 focus:outline-none",children:[d.jsx("option",{value:"",children:"Select trigger type"}),h.map(p=>d.jsx("option",{value:p,children:p},p))]})]}),d.jsxs("div",{children:[d.jsx("label",{className:"block text-white text-sm font-semibold mb-2",children:"Time"}),d.jsx("input",{type:"time",value:l,onChange:p=>u(p.target.value),className:"w-full bg-slate-700 text-white p-3 rounded-lg border border-slate-600 focus:border-blue-500 focus:outline-none",autoComplete:"off"})]})]}),d.jsxs("div",{className:"flex gap-3",children:[d.jsx("button",{onClick:e,className:"flex-1 bg-slate-600 hover:bg-slate-700 text-white font-bold py-3 rounded-lg transition-colors",children:"Cancel"}),d.jsx("button",{onClick:()=>{s&&o&&l&&t(s,o,l)},disabled:!s||!o||!l,className:"flex-1 bg-orange-600 hover:bg-orange-700 disabled:bg-slate-600 text-white font-bold py-3 rounded-lg transition-colors disabled:cursor-not-allowed",children:"Schedule"})]})]})})}):null},Pq=({isOpen:n,onClose:e,selectedDate:t,onDateSelect:r,dailyData:s})=>n?d.jsx("div",{className:"modal-backdrop",children:d.jsx("div",{className:"modal-container",children:d.jsxs("div",{className:"modal-content bg-slate-800 border-slate-700",children:[d.jsxs("div",{className:"text-center mb-6",children:[d.jsx("h3",{className:"text-xl font-bold text-white mb-2",children:"📅 Daily Summary"}),d.jsx("p",{className:"text-gray-300 text-sm",children:"Your activities and progress"})]}),d.jsxs("div",{className:"space-y-4 mb-6",children:[d.jsxs("div",{className:"bg-slate-700 rounded-lg p-4",children:[d.jsx("h4",{className:"text-white font-semibold mb-2",children:"💧 Water Intake"}),d.jsxs("p",{className:"text-gray-300",children:[s.water," glasses"]})]}),d.jsxs("div",{className:"bg-slate-700 rounded-lg p-4",children:[d.jsx("h4",{className:"text-white font-semibold mb-2",children:"🌤️ Mood"}),d.jsx("p",{className:"text-gray-300",children:s.mood?s.mood.name:"Not logged"})]}),d.jsxs("div",{className:"bg-slate-700 rounded-lg p-4",children:[d.jsx("h4",{className:"text-white font-semibold mb-2",children:"🫁 Breathing Exercise"}),d.jsx("p",{className:"text-gray-300",children:s.breathing?"✓ Completed":"✗ Not completed"})]}),s.relapseDate&&d.jsxs("div",{className:"bg-red-900/50 rounded-lg p-4 border border-red-500",children:[d.jsx("h4",{className:"text-red-300 font-semibold mb-2",children:"⚠️ Relapse"}),d.jsxs("p",{className:"text-red-300",children:[s.relapseDate.toLocaleDateString()," at ",s.relapseDate.toLocaleTimeString()]})]})]}),d.jsx("button",{onClick:e,className:"w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 rounded-lg transition-colors min-h-[44px]",children:"Close"})]})})}):null,Dq=({onResetApp:n,onBackToLogin:e,onResetForTesting:t,firestoreBuddyService:r,firestoreBuddyServiceRef:s,initializeFirestoreBuddyService:i,behavioralService:o,user:a,onShowAnalytics:l})=>d.jsx("div",{className:"min-h-screen bg-gradient-to-br from-slate-900 via-blue-900 to-slate-900 pb-20",children:d.jsxs("div",{className:"max-w-md mx-auto px-4 pt-16",children:[d.jsxs("div",{className:"text-center mb-8",children:[d.jsx(qD,{className:"w-16 h-16 mx-auto mb-4 text-blue-400"}),d.jsx("h2",{className:"text-2xl font-bold text-white mb-2",children:"Settings"}),d.jsx("p",{className:"text-gray-300",children:"Manage your app preferences"})]}),d.jsxs("div",{className:"space-y-4",children:[d.jsxs("div",{className:"bg-slate-800/50 rounded-xl p-4",children:[d.jsx("h3",{className:"text-white font-semibold mb-2",children:"📊 Behavioral Analytics"}),d.jsx("p",{className:"text-gray-400 text-sm mb-4",children:"View your behavioral patterns and insights"}),d.jsx("button",{onClick:l,disabled:!o,className:`w-full py-3 rounded-lg transition-colors mb-3 ${o?"bg-blue-600 hover:bg-blue-700 text-white":"bg-gray-600 text-gray-400 cursor-not-allowed"}`,children:o?"📈 View Analytics Dashboard":"📈 Analytics (Service Loading...)"}),o&&d.jsx("button",{onClick:async()=>{try{await o.logCraving(a.uid,{outcome:"resisted",strength:7,duration:5,context:"test_data",triggers:["stress","work"],mood:"anxious",stressLevel:6}),await o.logBreathingExercise(a.uid,{duration:5,completed:!0,triggerContext:"test_data"}),alert("✅ Test data added to Firestore for analytics demo!")}catch(u){alert("❌ Error adding test data: "+u.message)}},className:"w-full bg-green-600 hover:bg-green-700 text-white py-3 rounded-lg transition-colors text-sm min-h-[44px]",children:"🧪 Add Test Data"})]}),d.jsxs("div",{className:"bg-slate-800/50 rounded-xl p-4",children:[d.jsx("h3",{className:"text-white font-semibold mb-2",children:"Session"}),d.jsx("p",{className:"text-gray-400 text-sm mb-4",children:"Manage your current session"}),d.jsx("button",{onClick:e,className:"w-full bg-slate-600 hover:bg-slate-500 text-white py-3 rounded-lg transition-colors mb-3",children:"← Back to Login"})]}),d.jsxs("div",{className:"bg-slate-800/50 rounded-xl p-4",children:[d.jsx("h3",{className:"text-white font-semibold mb-2",children:"App Data"}),d.jsx("p",{className:"text-gray-400 text-sm mb-4",children:"Reset your progress and start over"}),d.jsx("button",{onClick:n,className:"w-full bg-red-600 hover:bg-red-700 text-white py-3 rounded-lg transition-colors",children:"Reset App & Start Over"})]}),!1,d.jsxs("div",{className:"bg-slate-800/50 rounded-xl p-4",children:[d.jsx("h3",{className:"text-white font-semibold mb-2",children:"About"}),d.jsx("p",{className:"text-gray-400 text-sm",children:"QuitCard Arena v1.0.0"}),d.jsx("p",{className:"text-gray-400 text-sm",children:"Your journey to freedom starts here"})]})]})]})}),Oq=()=>{const[n,e]=O.useState("arena"),[t,r]=O.useState("auth"),[s,i]=O.useState(null),[o,a]=O.useState(null),[l,u]=O.useState(!1),[h,f]=O.useState(!1),[p,y]=O.useState(null),[w,S]=O.useState(!0),[k,E]=O.useState(!1),[x,N]=O.useState(0),[P,$]=O.useState(!1),[L,R]=O.useState(0),[v,T]=O.useState({isLoading:!1,progress:0,currentStep:"",error:null,isComplete:!1}),[C,A]=O.useState([]);O.useState(null);const[b,_]=O.useState(null),[B,ve]=O.useState(null),[Fe,It]=O.useState(null),Q=O.useRef(null),[we,Se]=O.useState(null);O.useEffect(()=>{const M=z=>{window.deferredPrompt=z,E(!0),console.log("📲 PWA: beforeinstallprompt captured (App state set)")},H=()=>{E(!1),console.log("✅ PWA installed (App state cleared)")};return window.addEventListener("beforeinstallprompt",M),window.addEventListener("appinstalled",H),()=>{window.removeEventListener("beforeinstallprompt",M),window.removeEventListener("appinstalled",H)}},[]),O.useEffect(()=>{let M=0,H=0,z=!1;const le=80,Ee=Re=>{M=Re.touches[0].clientY,z=!1},We=Re=>{if(window.scrollY>0)return;H=Re.touches[0].clientY;const Ce=H-M;Ce>0&&(z=!0,Re.preventDefault(),R(Math.min(Ce,le*1.5)))},xe=async()=>{if(!z)return;H-M>le?($(!0),R(0),typeof window.refreshArenaStats=="function"&&(console.log("🔄 Pull-to-refresh: Refreshing stats..."),await window.refreshArenaStats()),typeof refreshStats=="function"&&(console.log("🔄 Pull-to-refresh: Calling main refresh..."),refreshStats()),setTimeout(()=>{$(!1)},1e3)):R(0),z=!1};return document.addEventListener("touchstart",Ee,{passive:!1}),document.addEventListener("touchmove",We,{passive:!1}),document.addEventListener("touchend",xe,{passive:!1}),()=>{document.removeEventListener("touchstart",Ee),document.removeEventListener("touchmove",We),document.removeEventListener("touchend",xe)}},[]);const qe=async()=>{try{if(window.promptPWAInstall){const z=await window.promptPWAInstall();z&&z.outcome==="accepted"&&E(!1);return}const M=window.deferredPrompt;if(!M)return;M.prompt();const H=await M.userChoice;window.deferredPrompt=null,H.outcome==="accepted"&&E(!1)}catch(M){console.warn("PWA install prompt failed:",M==null?void 0:M.message)}},De=async()=>{try{if(!js){console.error("❌ Firestore instance is not available");return}const M=new ec(js),H=new UD(js),z=await M.testConnectivity(),le=await H.testConnectivity();z?(_(M),Q.current=M,console.log("✅ FirestoreBuddyService initialized successfully")):console.warn("⚠️ Firestore connectivity test failed - service not initialized"),le?(ve(H),console.log("✅ FirestoreBehavioralService initialized successfully")):console.warn("⚠️ Firestore behavioral service connectivity test failed")}catch(M){console.error("❌ Error initializing FirestoreBuddyService:",M)}},D=()=>({mentalStrength:50,motivation:50,triggerDefense:30,addictionLevel:50,streakDays:0,streakUnit:"hours",streakDisplayText:"0 hours",cravingsResisted:0}),q=()=>({dailyWater:0,dailyMood:null,dailyBreathing:!1,scheduledTriggers:[],relapseDate:null,cravingsResisted:0}),ae=M=>{M.relapseDate&&Pe(new Date(M.relapseDate)),M.dailyWater!==void 0&&Ct(M.dailyWater),M.dailyMood!==void 0&&Rt(M.dailyMood),M.dailyBreathing!==void 0&&Nt(M.dailyBreathing),M.scheduledTriggers&&Ae(M.scheduledTriggers)},pe=async()=>{const M=new Date().toDateString();try{const{ref:H,set:z}=await ke(()=>import("./index.esm-25d69fbc.js"),[]),le=H(K,`users/${p==null?void 0:p.uid}/profile/daily/${M}/breathing`);await z(le,!0)}catch(H){console.error("Error saving breathing exercise to Firebase:",H),localStorage.setItem(`breathing_${p==null?void 0:p.uid}_${M}`,"true")}if(we)try{await we.handleBreathingExercise();const H=await we.checkBreathingStreak(),z=Math.max(0,3-H%3),le=H>=3&&H%3===0?`🎉 Excellent! You've completed a ${H}-day breathing streak and earned +1 Mental Strength!`:`✅ Breathing exercise completed! Current streak: ${H} days. Complete ${z} more days to earn +1 Mental Strength.`;if(showQuickActionPopup("🫁 Breathing Exercise Complete",`${le}

Keep up the great work! Regular breathing exercises help reduce stress and improve mental resilience.`,"success"),B)try{await B.logBreathingExercise(o.uid,{duration:5,completed:!0,triggerContext:"scheduled",currentStreak:H,mentalStrengthEarned:H>=3&&H%3===0}),console.log("✅ Breathing exercise also logged to Firestore for analytics")}catch(Ee){console.warn("⚠️ Could not log breathing exercise to Firestore:",Ee.message),await handleOfflineBehavioralLog("breathing",{duration:5,completed:!0,triggerContext:"scheduled",currentStreak:H,mentalStrengthEarned:H>=3&&H%3===0})}}catch(H){console.warn("⚠️ Error handling breathing exercise completion:",H.message),showQuickActionPopup("🫁 Breathing Exercise Complete","✅ Breathing exercise completed! Keep practicing daily to build your mental strength.","success")}},Te=(M,H)=>{const z=document.createElement("div");z.className="fixed top-20 right-4 z-50 p-4 rounded-lg shadow-lg bg-red-500 text-white max-w-sm",z.innerHTML=`
      <div class="font-bold">${M}</div>
      <div class="text-sm opacity-90">${H}</div>
      <button class="mt-2 text-sm underline" onclick="this.parentElement.remove()">Dismiss</button>
    `,document.body.appendChild(z),setTimeout(()=>{z.parentNode&&z.parentNode.removeChild(z)},1e4)},ce=async M=>{if(!M)return!1;T({isLoading:!0,progress:0,currentStep:"Initializing...",error:null,isComplete:!1});try{const{ref:H,get:z,onValue:le}=await ke(()=>import("./index.esm-25d69fbc.js"),[]);T(Ke=>({...Ke,currentStep:"Loading profile data...",progress:20}));const Ee=H(K,`users/${M}`),We=await z(Ee);if(!We.exists())throw new Error("User profile not found");const xe=We.val(),Re=ne(xe);T(Ke=>({...Ke,currentStep:"Loading battle stats...",progress:40}));const Ce=H(K,`users/${M}/stats`),St=await z(Ce),Qe=St.exists()?ge(St.val()):D();T(Ke=>({...Ke,currentStep:"Loading habits and progress...",progress:60}));const ze=H(K,`users/${M}/profile`),Je=await z(ze),Ve=Je.exists()?de(Je.val()):q();T(Ke=>({...Ke,currentStep:"Loading achievements...",progress:80}));const Oe=H(K,`users/${M}/profile/cravingsResisted`),Ne=await z(Oe),Ue=Ne.exists()?Math.max(0,parseInt(Ne.val())||0):0;T(Ke=>({...Ke,currentStep:"Setting up live sync...",progress:90}));const Nn=le(Ce,Ke=>{if(Ke.exists()){const $n=ge(Ke.val());if(console.log("🔄 Firebase Listener: Stats changed, new stats:",$n),In($n),t==="arena"&&o){console.log("🔄 Firebase Listener: Current user object:",o),console.log("🔄 Firebase Listener: user.quitDate:",o.quitDate),console.log("🔄 Firebase Listener: user.uid:",o.uid);const Rs={...o,stats:$n};console.log("🔄 Firebase Listener: Triggering calculateRealTimeStats for Arena with updatedUser:",Rs),console.log("🔄 Firebase Listener: updatedUser.quitDate:",Rs.quitDate),console.log("🔄 Firebase Listener: updatedUser.uid:",Rs.uid),calculateRealTimeStats(Rs).then(Ns=>{console.log("🔄 Firebase Listener: calculateRealTimeStats returned:",Ns),console.log("🔄 Firebase Listener: calculatedStats.streakDays:",Ns.streakDays),setRealTimeUserStats(Ns)})}}}),dt=le(ze,Ke=>{if(Ke.exists()){const $n=de(Ke.val());t==="profile"&&ae($n)}}),ht=le(Oe,Ke=>{if(Ke.exists()){const $n=Math.max(0,parseInt(Ke.val())||0);t==="craving-support"&&un($n)}});return A([Nn,dt,ht]),T(Ke=>({...Ke,currentStep:"Finalizing...",progress:100})),a(Ke=>({...Ke,...Re,...Ve,stats:Qe})),ae(Ve),un(Ue),Re.onboardingCompleted&&f(!0),T({isLoading:!1,progress:100,currentStep:"Data loaded successfully!",error:null,isComplete:!0}),console.log("✅ All user data loaded successfully:",{profile:Re,stats:Qe,profileData:Ve,cravingsResisted:Ue}),!0}catch(H){return console.error("❌ Error loading user data:",H),T({isLoading:!1,progress:0,currentStep:"Failed to load data",error:H.message,isComplete:!1}),Te("Failed to load user data",H.message),!1}},ne=M=>M?{uid:M.uid||"",email:M.email||"",heroName:M.heroName||"Hero",archetype:M.archetype||"The Determined",avatar:M.avatar||Os("default"),quitDate:M.quitDate,onboardingCompleted:!!M.onboardingCompleted,updatedAt:M.updatedAt||Date.now(),...M}:me(),ge=M=>M?{mentalStrength:Math.max(0,Math.min(100,parseInt(M.mentalStrength)||50)),motivation:Math.max(0,Math.min(100,parseInt(M.motivation)||50)),triggerDefense:Math.max(0,Math.min(100,parseInt(M.triggerDefense)||30)),addictionLevel:Math.max(0,Math.min(100,parseInt(M.addictionLevel)||50)),streakDays:Math.max(0,parseInt(M.streakDays)||0),streakUnit:M.streakUnit||"hours",streakDisplayText:M.streakDisplayText||"0 hours",cravingsResisted:Math.max(0,parseInt(M.cravingsResisted)||0),...M}:D(),de=M=>M?{dailyWater:Math.max(0,parseInt(M.dailyWater)||0),dailyMood:M.dailyMood||null,dailyBreathing:!!M.dailyBreathing,scheduledTriggers:Array.isArray(M.scheduledTriggers)?M.scheduledTriggers:[],relapseDate:M.relapseDate?new Date(M.relapseDate).toISOString():null,cravingsResisted:Math.max(0,parseInt(M.cravingsResisted)||0),...M}:q(),me=()=>({uid:"",email:"",heroName:"Hero",archetype:"The Determined",avatar:Os("default"),quitDate:new Date().toISOString(),onboardingCompleted:!1,updatedAt:Date.now()});O.useEffect(()=>()=>{C.forEach(M=>{typeof M=="function"&&M()})},[C]);const[ue,Be]=O.useState(null);O.useEffect(()=>{const M=async()=>{try{const z=(await ke(()=>import("./offlineManager-34bcc8d8.js"),[])).default,le=new z;Be(le),window.offlineManager=le,window.refreshUserData=J,console.log("✅ Offline manager initialized")}catch(z){console.error("Error initializing offline manager:",z)}},H=async()=>{try{const z=(await ke(()=>import("./authGuard-1958aa62.js"),[])).default,le=(await ke(()=>import("./sessionManager-a23c7c0e.js"),[])).default,Ee=new z,We=new le;window.authGuard=Ee,window.sessionManager=We,console.log("✅ Auth services initialized")}catch(z){console.error("❌ Failed to initialize auth services:",z)}};M(),H()},[]);const G=async M=>{if(!M)return!1;const H=await ce(M);if(H&&ue&&(await ue.cacheUserData(o),await ue.cacheProfileData({dailyWater:be,dailyMood:qt,dailyBreathing:vt,scheduledTriggers:gt,relapseDate:Me,cravingsResisted:Ye})),!H&&ue){console.log("📱 Loading offline data...");const z=await ue.getCachedUserData(),le=await ue.getCachedProfileData();if(z)return console.log("📱 Using offline user data"),a(z),f(z.onboardingCompleted),le&&ae(le),!0}return H},Z=async()=>p!=null&&p.uid?(console.log("🔄 Refreshing user data with offline support..."),await G(p.uid)):!1,J=async()=>{if(!(p!=null&&p.uid)){Te("Cannot Refresh","No authenticated user found");return}if(console.log("🔄 Manually refreshing user data..."),await Z()){const H=document.createElement("div");H.className="fixed top-20 right-4 z-50 p-4 rounded-lg shadow-lg bg-green-500 text-white max-w-sm",H.innerHTML=`
        <div class="font-bold">✅ Data Refreshed!</div>
        <div class="text-sm opacity-90">Your data has been synced across all devices</div>
        <button class="mt-2 text-sm underline" onclick="this.parentElement.remove()">Dismiss</button>
      `,document.body.appendChild(H),setTimeout(()=>{H.parentNode&&H.parentNode.removeChild(H)},5e3)}else Te("Refresh Failed","Could not refresh data. Please try again.")},[Me,Pe]=O.useState(null),[be,Ct]=O.useState(0),[qt,Rt]=O.useState(null),[vt,Nt]=O.useState(!1),[gt,Ae]=O.useState([]),[Ye,un]=O.useState(0),[rn,In]=O.useState(D());O.useEffect(()=>{const M=z=>{if(z.message&&z.message.includes("content_script")){console.warn("Browser extension error (ignored):",z.message);return}if(z.message&&(z.message.includes("FrameDoesNotExistError")||z.message.includes("background.js"))){console.warn("Background frame error (ignored):",z.message);return}if(z.message&&z.message.includes("deref")){console.warn("Browser extension deref error (ignored):",z.message);return}if(z.message&&z.message.includes("chrome-extension://")){console.warn("Chrome extension URL error (ignored):",z.message);return}console.error("Global error caught:",z)},H=z=>{if(z.reason&&z.reason.message&&z.reason.message.includes("content_script")){console.warn("Browser extension promise rejection (ignored):",z.reason.message);return}if(z.reason&&z.reason.message&&(z.reason.message.includes("FrameDoesNotExistError")||z.reason.message.includes("background.js"))){console.warn("Background frame promise rejection (ignored):",z.reason.message);return}if(z.reason&&z.reason.message&&z.reason.message.includes("deref")){console.warn("Browser extension deref promise rejection (ignored):",z.reason.message);return}if(z.reason&&z.reason.message&&z.reason.message.includes("chrome-extension://")){console.warn("Chrome extension URL promise rejection (ignored):",z.reason.message);return}console.error("Unhandled promise rejection:",z.reason)};return window.addEventListener("error",M),window.addEventListener("unhandledrejection",H),()=>{window.removeEventListener("error",M),window.removeEventListener("unhandledrejection",H)}},[]),O.useEffect(()=>{(()=>{try{K&&typeof K.app<"u"&&console.log("🔥 Firebase RTDB initialized successfully")}catch(H){console.warn("⚠️ Firebase initialization check failed (non-critical):",(H==null?void 0:H.message)||H)}})()},[]),O.useEffect(()=>{let M=!0,H=null;return(async()=>{try{console.log("Initializing authentication state..."),S(!0);const le=async xe=>{const Re=`quitDateFixed_${xe}_v2`;if(!localStorage.getItem(Re)&&!(xe!=="AmwwlNyHD5T3WthUbyR6bFL0QkF2"&&xe!=="uGZGbLUytbfu8W3mQPW0YAvXTQn1"))try{const{ref:Ce,get:St,set:Qe}=await ke(()=>import("./index.esm-25d69fbc.js"),[]),ze="2025-09-18T13:56:46.584Z";console.log(`🔧 One-time fix: Setting proper quit date for ${xe}...`);const Je=Ce(K,`users/${xe}/profile`),Ve=await St(Je);let Oe=ze;if(Ve.exists()){const Ne=Ve.val();if(Ne.lastRelapseDate){const Ue=new Date(Ne.lastRelapseDate),Nn=new Date(ze);Oe=Ue>Nn?Ne.lastRelapseDate:ze,console.log(`📅 ${xe}: Using quit date ${Oe} (considering relapse: ${Ne.lastRelapseDate})`)}}await Qe(Ce(K,`users/${xe}/quitDate`),Oe),await Qe(Ce(K,`users/${xe}/profile/quitDate`),Oe),localStorage.setItem(Re,"true"),console.log(`✅ One-time fix: Quit date fixed for ${xe} in Firebase database`)}catch(Ce){console.warn(`⚠️ One-time fix failed for ${xe}:`,Ce.message)}},{onAuthStateChanged:Ee}=await ke(()=>import("./index.esm-e9addb65.js"),[]);H=Ee(mi,async xe=>{if(M)if(console.log("Auth state changed:",xe?`User: ${xe.uid}`:"No user"),xe){y(xe),console.log("User authenticated, checking database for user data..."),(xe.uid==="AmwwlNyHD5T3WthUbyR6bFL0QkF2"||xe.uid==="uGZGbLUytbfu8W3mQPW0YAvXTQn1")&&(console.log(`🧹 Clearing cache for ${xe.uid} to ensure fresh data loading...`),Object.keys(localStorage).forEach(Re=>{(Re.includes("quitCoach")||Re.includes("quitDate")||Re.includes("user")||Re.includes("arena"))&&localStorage.removeItem(Re)})),le(xe.uid);try{const{ref:Re,get:Ce}=await ke(()=>import("./index.esm-25d69fbc.js"),[]),St=Re(K,`users/${xe.uid}`),Qe=await Ce(St);if(Qe.exists()){const ze=Qe.val();console.log("Existing user data found - auto-login successful"),(()=>{const Ve=[];for(let Oe=0;Oe<localStorage.length;Oe++){const Ne=localStorage.key(Oe);Ne&&(Ne.startsWith("water_")||Ne.startsWith("mood_")||Ne.startsWith("breathing_"))&&Ve.push(Ne)}Ve.forEach(Oe=>localStorage.removeItem(Oe)),console.log("Cleared previous user data from localStorage")})(),a(ze),f(!0),r("arena");try{const Ve=await ke(()=>Promise.resolve().then(()=>Y9),void 0),Oe=new Ve.default(K,xe.uid);await Oe.initialize(),Se(Oe),console.log("✅ StatManager initialized successfully")}catch(Ve){console.error("Error initializing StatManager:",Ve)}try{const Ve=new Db(K,xe.uid,window.authGuard);It(Ve),window.centralizedStatService=Ve,await Ve.refreshAllStats(),console.log("✅ CentralizedStatService initialized and stats refreshed for user:",xe.uid),Ve.setupRealTimeListener(Oe=>{console.log("🔄 Real-time stats update received:",Oe),In(Oe)})}catch(Ve){console.error("Error initializing CentralizedStatService:",Ve)}try{console.log("🔍 Checking if existing user needs buddy matching...");const Ve=Q.current||b;if(Ve)if(await Ve.getUserBuddyPair(xe.uid))console.log("✅ Existing user already has a buddy pair");else{console.log("🔄 Existing user has no buddy - adding to matching pool...");const Ne={userId:xe.uid,heroName:ze.heroName,archetype:ze.archetype,joinedAt:new Date().toISOString(),stats:ze.stats};await Ve.addToMatchingPool(Ne),console.log("✅ Added existing user to matching pool"),setTimeout(async()=>{try{console.log("⏳ Triggering auto-matching for existing user..."),await Cs()}catch(Ue){console.error("Auto-matching failed for existing user:",Ue)}},2e3)}else console.log("⚠️ FirestoreBuddyService not available for existing user buddy check")}catch(Ve){console.error("Error checking existing user buddy status:",Ve)}console.log("User auto-logged in and redirected to Arena")}else console.log("No user data found - new user needs onboarding"),r("onboarding")}catch(Re){console.error("Error fetching user data during auto-login:",Re),r("onboarding")}}else console.log("No authenticated user - showing login screen"),y(null),a(null),f(!1),r("auth"),(()=>{const Ce=[];for(let St=0;St<localStorage.length;St++){const Qe=localStorage.key(St);Qe&&(Qe.startsWith("water_")||Qe.startsWith("mood_")||Qe.startsWith("breathing_"))&&Ce.push(Qe)}Ce.forEach(St=>localStorage.removeItem(St)),console.log("Cleared user-specific data from localStorage")})()});const We=setTimeout(()=>{M&&(console.warn("Auth initialization timeout - forcing to auth screen"),S(!1),r("auth"))},1e4);H&&clearTimeout(We)}catch(le){console.error("Error initializing authentication:",le),M&&(S(!1),r("auth"))}finally{M&&S(!1)}})(),De(),()=>{M=!1,H&&H()}},[]);const ur=async M=>{console.log("Authentication successful, checking for existing user data...",{uid:M==null?void 0:M.uid,email:M==null?void 0:M.email});try{const{ref:H,get:z}=await ke(()=>import("./index.esm-25d69fbc.js"),[]);console.log("Checking database for existing user data...");const le=H(K,`users/${M.uid}`),Ee=await z(le);if(Ee.exists()){const We=Ee.val();if(console.log("Existing user data found - loading all user data..."),await G(M.uid)){console.log("✅ All user data loaded successfully, going to Arena");try{const Re=new Db(K,M.uid,window.authGuard);It(Re),window.centralizedStatService=Re,await Re.refreshAllStats(),console.log("✅ CentralizedStatService initialized for existing user:",M.uid),Re.setupRealTimeListener(Ce=>{console.log("🔄 Real-time stats update received:",Ce),In(Ce)})}catch(Re){console.error("Error initializing CentralizedStatService for existing user:",Re)}r("arena")}else{console.log("⚠️ Data loading failed, but proceeding to Arena with basic data"),a(We);const Re=!!We.onboardingCompleted;f(Re),r("arena")}}else console.log("No user data found - starting onboarding"),r("onboarding")}catch(H){console.error("Database check failed:",H),r("onboarding")}},[mt,dn]=O.useState(null),[hn,Jn]=O.useState(!1),[Sn,mn]=O.useState(null),[dr,ct]=O.useState(!1),ut=async(M,H,z)=>{var le,Ee,We;if(!(!(o!=null&&o.uid)||hn)){Jn(!0),mn(null),ct(!0);try{console.log("🔄 Starting loadRealBuddy function..."),console.log("🔄 FirestoreBuddyService available:",!!b),console.log("🔄 FirestoreBuddyService type:",typeof b);const xe=Q.current||b;if(!xe){console.log("⚠️ FirestoreBuddyService not available, falling back to Realtime Database"),await yn();return}console.log("✅ Using Firestore for buddy loading"),console.log("🔄 Firestore: Loading real buddy data...");const{collection:Re,query:Ce,where:St,getDocs:Qe}=await ke(()=>import("./index.esm-3368cc70.js"),[]),ze=Re(js,"buddyPairs"),Je=Ce(ze,St("user1Id","==",o.uid)),Ve=await Qe(Je);let Oe=null,Ne=null;if(Ve.empty){const Ue=Ce(ze,St("user2Id","==",o.uid)),Nn=await Qe(Ue);if(!Nn.empty){const dt=Nn.docs[0];Oe={id:dt.id,...dt.data()},Ne=Oe.user1Id}}else{const Ue=Ve.docs[0];Oe={id:Ue.id,...Ue.data()},Ne=Oe.user2Id}if(Oe&&Ne){console.log("✅ Firestore: Found buddy pair:",Oe.id),console.log("🔍 Buddy pair data:",{user1Id:Oe.user1Id,user2Id:Oe.user2Id,user1Name:Oe.user1Name,user2Name:Oe.user2Name,currentUserId:o.uid,buddyUserId:Ne});let Ue="Your Buddy";if(Oe.user1Id===o.uid?Ue=Oe.user2Name||"Your Buddy":Ue=Oe.user1Name||"Your Buddy",Ue==="Your Buddy")try{const ft=(await xe.getAllMatchingPoolUsers()).find(sn=>sn.userId===Ne);ft&&ft.heroName&&(Ue=ft.heroName,console.log("🔍 Found buddy name from matching pool:",Ue))}catch(Ge){console.log("⚠️ Could not get buddy name from matching pool:",Ge.message)}if(Ue==="Your Buddy"&&(Ue=`Buddy ${Ne.slice(-4)}`),console.log("🔍 Selected buddy name:",Ue),Ue!=="Your Buddy"&&Ue.startsWith("Buddy ")===!1)try{console.log("🔄 Updating buddy pair with correct names...");const{doc:Ge,updateDoc:ft}=await ke(()=>import("./index.esm-3368cc70.js"),[]),sn=Ge(js,"buddyPairs",Oe.id),Wt={};Oe.user1Id===o.uid?(Wt.user1Name=o.heroName,Wt.user2Name=Ue):(Wt.user1Name=Ue,Wt.user2Name=o.heroName),await ft(sn,Wt),console.log("✅ Updated buddy pair with names:",Wt)}catch(Ge){console.log("⚠️ Could not update buddy pair names:",Ge.message)}let Nn={streakDays:0,addictionLevel:50,willpower:50,motivation:50,cravingResistance:50,triggerDefense:30,experiencePoints:0};try{console.log("🔄 Attempting to get real buddy stats from Firebase...");const{ref:Ge,get:ft}=await ke(()=>import("./index.esm-25d69fbc.js"),[]),sn=Ge(K,`users/${Ne}/stats`),Wt=await ft(sn);if(Wt.exists()){const Yr=Wt.val();Nn={...Nn,...Yr},console.log("✅ Got real buddy stats from Firebase:",Yr)}else console.log("⚠️ Buddy stats not found in Firebase, using defaults")}catch(Ge){console.log("⚠️ Could not read buddy stats (permission), using defaults:",Ge.message)}let dt=null,ht=null,Ke=null,$n=Os("buddy","adventurer"),Rs="DETERMINED";try{console.log("🔄 Loading Firebase imports for buddy profile...");const{ref:Ge,get:ft}=await ke(()=>import("./index.esm-25d69fbc.js"),[]);console.log("✅ Firebase imports loaded successfully"),console.log("🔍 Reading buddy profile fields from path:",`users/${Ne}`),console.log("🔄 Firestore: Attempting to read buddy quit date from multiple locations...");const[sn,Wt,Yr,Yo,ni,ri,Xn]=await Promise.all([ft(Ge(K,`users/${Ne}/avatar`)),ft(Ge(K,`users/${Ne}/avatarSeed`)),ft(Ge(K,`users/${Ne}/archetype`)),ft(Ge(K,`users/${Ne}/heroName`)),ft(Ge(K,`users/${Ne}/quitDate`)),ft(Ge(K,`users/${Ne}/profile/quitDate`)),ft(Ge(K,`users/${Ne}/profile`))]);if(console.log("🔍 Firestore: Quit date snapshots - root exists:",ni.exists(),"profile exists:",ri.exists()),sn.exists())$n=sn.val(),console.log("✅ Got buddy avatar from Firebase");else if(Wt.exists()){const wt=Wt.val(),zn=Yr.exists()?Yr.val():"adventurer";$n=Os(wt,zn),console.log("✅ Generated buddy avatar from seed:",wt)}if(Yr.exists()&&(Rs=Yr.val(),console.log("✅ Got buddy archetype:",Rs)),Yo.exists()){const wt=Yo.val();console.log("✅ Got buddy hero name:",wt),Ue=wt}if(ni.exists())dt=ni.val(),console.log("✅ Got buddy quit date from Firebase (root):",dt);else if(ri.exists())dt=ri.val(),console.log("✅ Got buddy quit date from Firebase (profile):",dt);else{if(console.log("⚠️ No buddy quit date found in Firebase (neither root nor profile)"),console.log("🔍 quitDateSnapshot exists:",ni.exists()),console.log("🔍 profileQuitDateSnapshot exists:",ri.exists()),Xn.exists()){const wt=Xn.val();console.log("🔍 Full profile data available:",wt),wt&&wt.quitDate?(dt=wt.quitDate,console.log("✅ Found buddy quit date in profile data:",dt)):console.log("⚠️ Profile exists but has no quit date field"),wt&&wt.lastActivity&&(Ke=wt.lastActivity,console.log("🔍 Captured buddy lastActivity for fallback:",Ke))}else console.log("⚠️ No profile data available at all");if(Xn.exists()){const wt=Xn.val();ht=wt.lastRelapseDate||wt.relapseDate,console.log("🔍 Found buddy relapse date:",ht)}if(!dt){if(console.log("⚠️ No quit date found, checking for createdAt timestamp..."),console.log("🔍 Buddy user ID:",Ne),Xn.exists()){const wt=Xn.val();wt.createdAt?(dt=wt.createdAt,console.log("✅ Using buddy createdAt as quit date:",dt)):(console.log("⚠️ No createdAt timestamp found either - not assigning fallback quit date"),dt=void 0)}else console.log("⚠️ No profile data available - not assigning fallback quit date"),dt=void 0;Ne==="AmwwlNyHD5T3WthUbyR6bFL0QkF2"?console.log("🔄 Arena: User 2 uses centralized stats - no hardcoded quit date needed"):Ne==="uGZGbLUytbfu8W3mQPW0YAvXTQn1"&&console.log("🔄 Arena: User 3 uses centralized stats - no hardcoded quit date needed")}}}catch(Ge){console.log("⚠️ Could not read buddy profile (permission):",Ge.message),console.log("🔍 Full profile error details:",Ge),console.log("🔍 Trying to access path:",`users/${Ne}`),console.log("🔍 Current user can read own profile, but not buddy profile")}const Ns=dt||Ke||null;let cl=Ns;(Ne==="uGZGbLUytbfu8W3mQPW0YAvXTQn1"||Ne==="AmwwlNyHD5T3WthUbyR6bFL0QkF2")&&(console.log(`🔄 Arena: Not setting quit date for centralized buddy ${Ne} - using null to prevent calculations`),cl=null);const Bn={heroName:Ue,uid:Ne,stats:Nn,quitDate:cl,originalQuitDate:cl,finalQuitDate:Ns,lastActivity:Ke||null,lastRelapseDate:ht,achievements:[],archetype:Rs,avatar:$n,userId:Ne,isRealBuddy:!0,pairId:Oe.id,triggers:[],dailyPatterns:[],copingStrategies:[],specialFeatures:null};console.log("🔍 Firestore: Final buddy object with quit date:",{heroName:Ue,originalQuitDate:dt,finalQuitDate:Ns,lastRelapseDate:ht,hasOriginalQuitDate:!!dt,usingDefaultQuitDate:!dt,hasRelapseDate:!!ht}),dn(Bn),console.log("✅ Firestore: Buddy data loaded successfully"),console.log("🔍 Firestore: Buddy Special Features data:",{hasSpecialFeatures:!!Bn.specialFeatures,hasTriggers:!!((le=Bn.triggers)!=null&&le.length),hasDailyPatterns:!!((Ee=Bn.dailyPatterns)!=null&&Ee.length),hasCopingStrategies:!!((We=Bn.copingStrategies)!=null&&We.length),uid:Bn.uid});try{let Ge=Bn.lastRelapseDate||null;if(!Ge){const ft=Bn.finalQuitDate;if(ft){const sn=new Date(ft).getTime(),Wt=Date.now();Math.abs(Wt-sn)<2*60*1e3||(Ge=ft)}}if(!Ge&&Bn.lastActivity&&(Ge=Bn.lastActivity),Ge){const ft=Ps(new Date(Ge)),sn={streakDays:ft.value,streakUnit:ft.unit,streakDisplayText:ft.displayText};typeof setBuddyStreakData=="function"&&setBuddyStreakData(sn),typeof setRealTimeNemesisStats=="function"&&setRealTimeNemesisStats(Wt=>({...Wt,streakDays:sn.streakDays,streakUnit:sn.streakUnit,streakDisplayText:sn.streakDisplayText})),console.log("🔄 Arena: Primed buddy streak from loaded data:",sn.streakDisplayText)}}catch(Ge){console.log("⚠️ Arena: Could not prime buddy streak:",Ge==null?void 0:Ge.message)}console.log(`🔄 Firestore: Reading centralized buddy stats for ${Ne} (read-only)`);try{try{const{ref:Ge,get:ft}=await ke(()=>import("./index.esm-25d69fbc.js"),[]),sn=await ft(Ge(K,`users/${Ne}/stats`));if(sn.exists()){const Wt=sn.val(),Yr=new Date,Yo=Bn.lastRelapseDate;if(Yo){const ni=new Date(Yo),ri=Yr-ni,Xn=Math.floor(ri/(1e3*60*60)),wt=Math.floor(Xn/24);let zn,si;Xn<24?(zn=`${Xn} hour${Xn===1?"":"s"}`,si=0):(zn=`${wt} day${wt===1?"":"s"}`,si=wt),console.log(`🔄 Firestore: Calculated buddy streak locally: ${zn} (${Xn} hours since relapse)`);const ul={streakDays:si,streakUnit:Xn<24?"hours":"days",streakDisplayText:zn};z(ul);const Vi={...Wt,streakDays:si,streakUnit:Xn<24?"hours":"days",streakDisplayText:zn};console.log("🔄 Firestore: Using buddy stats with locally calculated streak:",Vi),console.log("🔄 Firestore: Buddy streak fields:",{streakDays:Vi.streakDays,streakUnit:Vi.streakUnit,streakDisplayText:Vi.streakDisplayText}),H(Vi)}else console.log("🔄 Firestore: No relapse date found for buddy, using existing stats"),H(Wt)}else{console.log("⚠️ Firestore: No centralized stats found for buddy, using fallback calculation");const Wt=await M(Bn);H(Wt)}}catch(Ge){console.error("❌ Error reading buddy stats:",Ge);const ft=await M(Bn);H(ft)}}catch(Ge){console.error("❌ Error reading centralized buddy stats:",Ge);const ft=await M(Bn);H(ft)}await vr(o.uid,Ne)}else console.log("ℹ️ Firestore: No buddy pair found for user"),dn(null)}catch(xe){console.error("❌ Firestore: Error loading buddy:",xe),console.log("🔄 Falling back to Realtime Database buddy loading..."),await yn()}finally{Jn(!1)}}},yn=async()=>{var M,H,z,le,Ee,We,xe,Re,Ce,St;try{console.log("🔄 Realtime Database: Loading buddy data...");const{ref:Qe,get:ze}=await ke(()=>import("./index.esm-25d69fbc.js"),[]),Je=Qe(K,"buddyPairs"),Ve=await ze(Je);if(!Ve.exists()){dn(null);return}const Oe=Ve.val();let Ne=null,Ue=null;for(const[Nn,dt]of Object.entries(Oe))if(dt.users&&Array.isArray(dt.users)&&dt.users.includes(o.uid)){Ne={...dt,pairId:Nn},Ue=dt.users.find(ht=>ht!==o.uid);break}if(Ne&&Ue){const Nn=Qe(K,`users/${Ue}`),dt=await ze(Nn);if(!dt.exists()){const{remove:$n}=await ke(()=>import("./index.esm-25d69fbc.js"),[]);await $n(Qe(K,`buddyPairs/${Ne.pairId}`)),dn(null);return}const ht=dt.val(),Ke={heroName:ht.heroName||"Buddy",stats:{streakDays:((M=ht.stats)==null?void 0:M.streakDays)||0,addictionLevel:((H=ht.stats)==null?void 0:H.addictionLevel)||50,willpower:((z=ht.stats)==null?void 0:z.mentalStrength)||50,motivation:((le=ht.stats)==null?void 0:le.mentalStrength)||50,cravingResistance:((Ee=ht.stats)==null?void 0:Ee.mentalStrength)||50,triggerDefense:((We=ht.stats)==null?void 0:We.triggerDefense)||30,experiencePoints:((xe=ht.stats)==null?void 0:xe.experiencePoints)||0},achievements:ht.achievements||[],archetype:ht.archetype||"The Determined",avatar:ht.avatar||Os(ht.heroName||"buddy","adventurer"),uid:Ue,userId:Ue,lastRelapseDate:ht.lastRelapseDate,isRealBuddy:!0,pairId:Ne.pairId,triggers:ht.triggers||[],dailyPatterns:ht.dailyPatterns||[],copingStrategies:ht.copingStrategies||[],specialFeatures:ht.specialFeatures||null};dn(Ke),console.log("🔍 RealtimeDB: Buddy Special Features data:",{hasSpecialFeatures:!!Ke.specialFeatures,hasTriggers:!!((Re=Ke.triggers)!=null&&Re.length),hasDailyPatterns:!!((Ce=Ke.dailyPatterns)!=null&&Ce.length),hasCopingStrategies:!!((St=Ke.copingStrategies)!=null&&St.length),uid:Ke.uid}),await vr(o.uid,Ue)}else dn(null)}catch(Qe){console.error("Error loading buddy from Realtime Database:",Qe),mn("Failed to load buddy data"),dn(null)}},vr=async(M,H)=>{try{const z=Q.current||b;if(z&&(mt!=null&&mt.pairId)){console.log("🔄 Firestore: Removing users from matching pool"),await z.removeFromMatchingPool(M),await z.removeFromMatchingPool(H);const{doc:le,updateDoc:Ee}=await ke(()=>import("./index.esm-3368cc70.js"),[]),We=le(js,"buddyPairs",mt.pairId);await Ee(We,{user1RemovedFromPool:!0,user2RemovedFromPool:!0}),console.log("✅ Firestore: Users removed from matching pool and pair updated")}else{console.log("🔄 Realtime Database: Removing users from matching pool");const{ref:le,remove:Ee,set:We}=await ke(()=>import("./index.esm-25d69fbc.js"),[]);await Ee(le(K,`matchingPool/${M}`)),await Ee(le(K,`matchingPool/${H}`)),mt!=null&&mt.pairId&&(await We(le(K,`buddyPairs/${mt.pairId}/user1RemovedFromPool`),!0),await We(le(K,`buddyPairs/${mt.pairId}/user2RemovedFromPool`),!0)),console.log("✅ Realtime Database: Users removed from matching pool and pair updated")}}catch(z){console.error("❌ Error removing users from matching pool:",z)}};O.useEffect(()=>{ct(!1),dn(null)},[o==null?void 0:o.uid]),O.useEffect(()=>{o!=null&&o.uid&&!mt&&!hn&&!dr&&console.log("🔄 Buddy loading will be handled by Arena component")},[o==null?void 0:o.uid,mt,hn,dr]),O.useEffect(()=>{b&&console.log("✅ FirestoreBuddyService is now available")},[b]);const Cs=async()=>{try{const M=Q.current||b;if(!M){console.log("⚠️ FirestoreBuddyService not available, falling back to Realtime Database"),await hr();return}console.log("✅ Using Firestore for auto-matching"),console.log("🔄 Firestore: Starting NEW CHAIN PAIRING algorithm...");const H=await M.getAllMatchingPoolUsers();if(console.log("🔍 Firestore: Current matching pool state:",{totalUsers:H.length,userIds:H.map(le=>({id:le.userId,name:le.heroName,joinedAt:le.joinedAt}))}),H.length<2){console.log("ℹ️ Firestore: Not enough users in matching pool for pairing (need 2, have",H.length,")");return}console.log(`🔄 Firestore: Found ${H.length} users in matching pool`);const z=H;if(console.log("ℹ️ Firestore: Skipping user validation to avoid permission errors"),z.sort((le,Ee)=>{const We=le.joinedAt?new Date(le.joinedAt).getTime():0,xe=Ee.joinedAt?new Date(Ee.joinedAt).getTime():0;return We-xe}),console.log("🔄 Firestore: Sorted users by join time (oldest first):",z.map(le=>({userId:le.userId,joinedAt:le.joinedAt}))),z.length>=2){const le=z[z.length-1],Ee=z[z.length-2];if(le.userId!==Ee.userId)try{console.log(`🔄 Firestore: SEQUENTIAL PAIRING: ${le.userId} (${le.heroName}) pairs with ${Ee.userId} (${Ee.heroName})`);const We={matchedAt:new Date().toISOString(),compatibilityScore:.85,matchReasons:["Chain pairing algorithm","Arriving user paired with waiting user"],status:"active",lastMessageAt:new Date().toISOString(),user1RemovedFromPool:!1,user2RemovedFromPool:!1,user1Name:le.heroName||"User 1",user2Name:Ee.heroName||"User 2"};console.log("🔄 Firestore: About to call createBuddyPair with data:",{arrivingUserId:le.userId,targetUserId:Ee.userId,pairData:We});const xe=await M.createBuddyPair(le.userId,Ee.userId,We);if(console.log("🔄 Firestore: createBuddyPair returned:",xe),xe){const{ref:Re,set:Ce}=await ke(()=>import("./index.esm-25d69fbc.js"),[]);if(await Ce(Re(K,`users/${Ee.userId}/buddyInfo`),{hasBuddy:!0,buddyId:le.userId,pairId:xe,matchedAt:We.matchedAt}),await Ce(Re(K,`users/${le.userId}/buddyInfo`),{hasBuddy:!0,buddyId:Ee.userId,pairId:xe,matchedAt:We.matchedAt}),await M.removeFromMatchingPool(Ee.userId),console.log(`✅ Firestore: SEQUENTIAL PAIRING: Created buddy pair ${xe}`),console.log(`✅ Firestore: SEQUENTIAL PAIRING: Removed ${Ee.userId} (${Ee.heroName}) from matching pool`),console.log(`✅ Firestore: SEQUENTIAL PAIRING: Kept ${le.userId} (${le.heroName}) in matching pool for next pairing`),o!=null&&o.uid&&[le.userId,Ee.userId].includes(o.uid))try{console.log("🔄 Buddy reloading will be handled by Arena component after matching")}catch(Qe){console.error("Error reloading buddy data:",Qe)}}else console.error(`❌ Firestore: Failed to create buddy pair between ${le.userId} and ${Ee.userId}`)}catch(We){console.error(`❌ Firestore: Failed to create buddy pair between ${le.userId} and ${Ee.userId}:`,We)}else console.log("ℹ️ Firestore: Same user in pool, cannot pair")}else console.log("ℹ️ Firestore: Not enough users in pool for pairing (need 2, have",z.length,")")}catch(M){console.error("❌ Firestore: Auto-matching failed:",M),console.log("🔄 Falling back to Realtime Database auto-matching..."),await hr()}},hr=async()=>{try{console.log("🔄 Realtime Database: Starting fallback auto-matching...");const{ref:M,get:H,set:z,push:le,remove:Ee}=await ke(()=>import("./index.esm-25d69fbc.js"),[]),We=M(K,"matchingPool"),xe=await H(We);if(!xe.exists()){console.log("ℹ️ Realtime Database: No users in matching pool");return}const Re=xe.val(),Ce=[];if(Object.entries(Re).forEach(([ze,Je])=>{typeof Je=="string"?Ce.push(Je):Je&&typeof Je=="object"?Je.uid?Ce.push(Je.uid):Je.userId?Ce.push(Je.userId):Ce.push(ze):Ce.push(ze)}),console.log(`🔄 Realtime Database: Found ${Ce.length} users in matching pool`),Ce.length<2){console.log("ℹ️ Realtime Database: Not enough users for pairing (need 2, have",Ce.length,")");return}const St=Ce;console.log("ℹ️ Realtime Database: Skipping user validation to avoid permission errors"),console.log(`🔄 Realtime Database: Valid users for pairing: ${St.join(", ")}`);const Qe=St.map((ze,Je)=>({userId:ze,joinedAt:new Date(Date.now()-(St.length-Je)*1e3).toISOString()}));if(Qe.sort((ze,Je)=>{const Ve=ze.joinedAt?new Date(ze.joinedAt).getTime():0,Oe=Je.joinedAt?new Date(Je.joinedAt).getTime():0;return Ve-Oe}),console.log("🔄 Realtime Database: Sorted users by join time (oldest first):",Qe.map(ze=>({userId:ze.userId,joinedAt:ze.joinedAt}))),Qe.length>=2){const ze=Qe[0],Je=Qe[Qe.length-1];if(ze&&Je&&ze.userId!==Je.userId){console.log(`🔄 Realtime Database: CHAIN PAIRING: ${Je.userId} (arriving) pairs with ${ze.userId} (waiting)`);try{const Ve=le(M(K,"buddyPairs")).key,Oe={pairId:Ve,users:[Je.userId,ze.userId],matchedAt:new Date().toISOString(),compatibilityScore:.85,matchReasons:["Chain pairing algorithm","Arriving user paired with waiting user"],status:"active",lastMessageAt:new Date().toISOString(),user1RemovedFromPool:!1,user2RemovedFromPool:!1};await z(M(K,`buddyPairs/${Ve}`),Oe),await z(M(K,`users/${ze.userId}/buddyInfo`),{hasBuddy:!0,buddyId:Je.userId,pairId:Ve,matchedAt:Oe.matchedAt}),await z(M(K,`users/${Je.userId}/buddyInfo`),{hasBuddy:!0,buddyId:ze.userId,pairId:Ve,matchedAt:Oe.matchedAt}),Object.keys(Re).forEach(async Ne=>{const Ue=Re[Ne];((Ue==null?void 0:Ue.uid)||(Ue==null?void 0:Ue.userId)||Ne)===ze.userId&&(await Ee(M(K,`matchingPool/${Ne}`)),console.log(`✅ Realtime Database: Removed ${ze.userId} (waiting) from matching pool`))}),await z(M(K,`buddyPairs/${Ve}/user1RemovedFromPool`),!0),await z(M(K,`buddyPairs/${Ve}/user2RemovedFromPool`),!1),console.log(`✅ Realtime Database: CHAIN PAIRING: Created buddy pair ${Ve}`),console.log(`✅ Realtime Database: CHAIN PAIRING: Kept ${Je.userId} (arriving) in matching pool for next pairing`)}catch(Ve){console.error("Error creating buddy pair:",Ve)}}else console.log("ℹ️ Realtime Database: Same user in pool, cannot pair")}else console.log("ℹ️ Realtime Database: Not enough users in pool for pairing (need 2, have",Qe.length,")");if(o!=null&&o.uid&&Qe.length>=2){const ze=Qe[0],Je=Qe[Qe.length-1];if([Je==null?void 0:Je.userId,ze==null?void 0:ze.userId].includes(o.uid))try{console.log("🔄 Buddy reloading will be handled by Arena component after matching")}catch(Oe){console.error("Error reloading buddy data:",Oe)}}}catch(M){console.error("Error in Realtime Database auto-matching:",M)}},al={heroName:"",stats:null,achievements:[],archetype:"",avatar:null,isEmpty:!0,message:"We are looking for a suitable buddy for you"},cs=()=>hn?{heroName:"Loading Buddy...",stats:{streakDays:0,addictionLevel:50,willpower:50,motivation:50,cravingResistance:50,triggerDefense:30,experiencePoints:0},achievements:[],archetype:"DETERMINED",avatar:Os("loading","adventurer"),isLoading:!0}:Sn?{heroName:"Error Loading Buddy",stats:{streakDays:0,addictionLevel:50,willpower:50,motivation:50,cravingResistance:50,triggerDefense:30,experiencePoints:0},achievements:[],archetype:"DETERMINED",avatar:Os("error","adventurer"),isError:!0,errorMessage:Sn}:mt||al,Bh=async M=>{console.log("Onboarding completed with user data:",M);try{if(!M||!M.heroName||!M.stats)throw new Error("Invalid user data received from onboarding");if(!p)throw new Error("No authenticated user found");const H=new Date,z={...M,uid:p.uid,email:p.email,displayName:p.displayName||M.heroName,photoURL:p.photoURL,onboardingCompleted:!0,createdAt:H.toISOString(),updatedAt:H.getTime(),originalQuitDate:H.toISOString(),lastQuitDate:H.toISOString(),lastRelapseDate:H.toISOString(),lastActivity:H.toISOString(),daily:{[H.toDateString()]:{logged:!0,onboarding:!0}}};console.log("Saving user data to Firebase:",z);const{ref:le,set:Ee}=await ke(()=>import("./index.esm-25d69fbc.js"),[]),We=le(K,`users/${p.uid}`);await Ee(We,z),console.log("Firebase save successful, updating app state..."),a(z),f(!0);try{const Re=Q.current||b;if(Re){console.log("✅ Using Firestore for matching pool");const Ce={quitStartDate:z.quitDate||new Date().toISOString(),addictionLevel:z.stats.addictionLevel||50,triggers:z.triggers||[],timezone:Intl.DateTimeFormat().resolvedOptions().timeZone,quitExperience:z.quitAttempts||"first",availableForMatching:!0,lastActive:new Date,userId:p.uid,heroName:z.heroName,archetype:z.archetype,joinedAt:new Date().toISOString()};if(await Re.addToMatchingPool(p.uid,Ce))console.log("✅ User successfully added to Firestore matching pool");else throw new Error("Failed to add user to Firestore matching pool")}else{console.log("⚠️ FirestoreBuddyService not available, falling back to Realtime Database");const{ref:Ce,set:St}=await ke(()=>import("./index.esm-25d69fbc.js"),[]),Qe={quitStartDate:z.quitDate||new Date().toISOString(),addictionLevel:z.stats.addictionLevel||50,triggers:z.triggers||[],timezone:Intl.DateTimeFormat().resolvedOptions().timeZone,quitExperience:z.quitAttempts||"first",availableForMatching:!0,lastActive:Date.now(),userId:p.uid,heroName:z.heroName,archetype:z.archetype,joinedAt:new Date().toISOString()};await St(Ce(K,`matchingPool/${p.uid}`),Qe),console.log("✅ User added to Realtime Database matching pool (fallback)")}try{console.log("⏳ Waiting 1 second before attempting auto-matching..."),await new Promise(Ce=>setTimeout(Ce,1e3)),await Cs()}catch(Ce){console.error("Automatic matching failed:",Ce)}}catch(Re){console.error("⚠️ Failed to add user to buddy matching pool:",Re)}const xe=await G(p.uid);r("arena")}catch(H){console.error("Error in handleOnboardingComplete:",H);const z=new Date,le={heroName:(M==null?void 0:M.heroName)||"Hero",archetype:(M==null?void 0:M.archetype)||"The Determined",avatar:(M==null?void 0:M.avatar)||Os("fallback"),stats:{addictionLevel:50,mentalStrength:50,motivation:50,triggerDefense:30,streakDays:0,experiencePoints:0},achievements:[],quitDate:z,createdAt:z.toISOString(),lastActivity:z.toISOString(),lastRelapseDate:z.toISOString(),uid:p==null?void 0:p.uid,email:p==null?void 0:p.email,onboardingCompleted:!0};if(p)try{const{ref:Ee,set:We}=await ke(()=>import("./index.esm-25d69fbc.js"),[]),xe=Ee(K,`users/${p.uid}`);await We(xe,le)}catch(Ee){console.error("Failed to save fallback data to Firebase:",Ee)}a(le),f(!0),r("arena")}},Ho=()=>{a(null),f(!1),r("onboarding"),e("arena"),i(null),localStorage.removeItem("quitCoachUser")},ll=async()=>{try{console.log("Logging out user...");const{signOut:M}=await ke(()=>import("./index.esm-e9addb65.js"),[]);await M(mi),a(null),y(null),f(!1),r("auth"),localStorage.removeItem("cravingWins"),localStorage.removeItem("specialFeatures"),console.log("User successfully logged out and redirected to login screen")}catch(M){console.error("Error during logout:",M),a(null),y(null),f(!1),r("auth")}},En=async()=>{if(!p){console.error("No authenticated user to reset");return}try{console.log("Resetting ALL user data for testing...");const{ref:M,set:H,remove:z}=await ke(()=>import("./index.esm-25d69fbc.js"),[]),le=M(K,`users/${p.uid}`);await H(le,null);const Ee=M(K,"users");await H(Ee,null);const We=M(K,"buddyPairs");await H(We,null);const xe=M(K,"matchingPool");await H(xe,null),console.log("All user data and buddy matching data cleared from database"),a(null),f(!1),r("onboarding"),dn(null),Jn(!1),mn(null),console.log("Account reset successful - ready for fresh onboarding")}catch(M){console.error("Error resetting account for testing:",M)}},zh=M=>{console.log("Tab changed to:",M),e(M),r(M),M==="arena"&&(o!=null&&o.uid)&&(console.log("🔄 Tab: Returning to Arena, forcing fresh stats reload..."),setTimeout(()=>{typeof refreshStats=="function"&&(console.log("🔄 Tab: Delayed refresh after tab switch..."),refreshStats())},1e3))},Qo=M=>{r(M==="mood-selector"?"mood-selector":"profile")},Ko=M=>{i(M),r("profile")},qm=()=>{r("profile")};return w?d.jsx("div",{className:"min-h-screen bg-gradient-to-br from-slate-900 via-blue-900 to-slate-900 flex items-center justify-center",children:d.jsxs("div",{className:"text-center text-white",children:[d.jsx("div",{className:"animate-spin rounded-full h-16 w-16 border-b-2 border-white mx-auto mb-6"}),d.jsx("h2",{className:"text-3xl font-bold mb-4",children:"🔐 Restoring Session..."}),d.jsx("p",{className:"text-xl text-gray-300 mb-4",children:"Checking authentication state"}),d.jsx("div",{className:"bg-slate-800/50 rounded-lg p-4 max-w-md mx-auto",children:d.jsxs("div",{className:"text-sm text-gray-400 space-y-2",children:[d.jsxs("div",{className:"flex items-center gap-2",children:[d.jsx("span",{className:"text-blue-400",children:"✓"}),"Checking Firebase Auth persistence"]}),d.jsxs("div",{className:"flex items-center gap-2",children:[d.jsx("span",{className:"text-blue-400",children:"✓"}),"Verifying user session (30 days)"]}),d.jsxs("div",{className:"flex items-center gap-2",children:[d.jsx("span",{className:"text-blue-400",children:"✓"}),"Loading user data from database"]})]})}),d.jsx("p",{className:"text-gray-400 text-sm mt-4",children:"This should take only a few seconds"})]})}):t==="auth"?d.jsx(J9,{onAuthSuccess:ur}):v.isLoading?d.jsx("div",{className:"min-h-screen bg-gradient-to-br from-slate-900 via-blue-900 to-slate-900 flex items-center justify-center",children:d.jsxs("div",{className:"text-center text-white",children:[d.jsx("div",{className:"animate-spin rounded-full h-16 w-16 border-b-2 border-white mx-auto mb-6"}),d.jsx("h2",{className:"text-3xl font-bold mb-4",children:"📊 Loading Your Data..."}),d.jsx("p",{className:"text-xl text-gray-300 mb-4",children:v.currentStep}),d.jsxs("div",{className:"bg-slate-800/50 rounded-lg p-4 max-w-md mx-auto mb-6",children:[d.jsx("div",{className:"w-full bg-slate-700 rounded-full h-3 mb-3",children:d.jsx("div",{className:"bg-blue-500 h-3 rounded-full transition-all duration-500 ease-out",style:{width:`${v.progress}%`}})}),d.jsxs("div",{className:"text-sm text-gray-400",children:[v.progress,"% Complete"]})]}),d.jsx("div",{className:"bg-slate-800/50 rounded-lg p-4 max-w-md mx-auto",children:d.jsxs("div",{className:"text-sm text-gray-400 space-y-2",children:[d.jsxs("div",{className:"flex items-center gap-2",children:[d.jsx("span",{className:"text-blue-400",children:"✓"}),"Profile and onboarding data"]}),d.jsxs("div",{className:"flex items-center gap-2",children:[d.jsx("span",{className:"text-blue-400",children:"✓"}),"Battle stats and progress"]}),d.jsxs("div",{className:"flex items-center gap-2",children:[d.jsx("span",{className:"text-blue-400",children:"✓"}),"Habits and achievements"]}),d.jsxs("div",{className:"flex items-center gap-2",children:[d.jsx("span",{className:"text-blue-400",children:"✓"}),"Setting up live sync"]})]})}),v.error&&d.jsxs("div",{className:"mt-4 p-3 bg-red-600/20 border border-red-500/30 rounded-lg max-w-md mx-auto",children:[d.jsxs("p",{className:"text-red-300 text-sm",children:[d.jsx("span",{className:"font-semibold",children:"Error:"})," ",v.error]}),d.jsx("p",{className:"text-red-400 text-xs mt-1",children:"Don't worry, you can still use the app with basic functionality"})]}),d.jsx("p",{className:"text-gray-400 text-sm mt-4",children:"Syncing your data across all devices..."})]})}):d.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-slate-900 via-blue-900 to-slate-900 relative",children:[L>0&&d.jsx("div",{className:"fixed top-0 left-0 right-0 z-50 bg-blue-600 text-white text-center py-2 transition-transform duration-200",style:{transform:`translateY(${Math.max(0,L-60)}px)`},children:L>80?"Release to refresh":"Pull to refresh"}),P&&d.jsx("div",{className:"fixed top-0 left-0 right-0 z-50 bg-green-600 text-white text-center py-2",children:d.jsxs("div",{className:"flex items-center justify-center gap-2",children:[d.jsx("div",{className:"animate-spin w-4 h-4 border-2 border-white border-t-transparent rounded-full"}),d.jsx("span",{children:"Refreshing..."})]})}),d.jsx(X9,{offlineManager:ue}),d.jsx(Z9,{offlineManager:ue}),d.jsx(eq,{sessionManager:window.sessionManager,authGuard:window.authGuard}),t==="onboarding"&&d.jsx("div",{children:d.jsx(yq,{onComplete:Bh,authUser:p,pwaInstallAvailable:k,promptInstall:qe})}),h&&o?d.jsxs(d.Fragment,{children:[t==="arena"&&d.jsx("div",{children:(()=>{try{const M=cs();return d.jsx(Iq,{user:o,userStats:rn,nemesis:M,onBackToLogin:ll,onResetForTesting:En,buddyLoading:hn,buddyError:Sn,realBuddy:mt,loadRealBuddy:ut,buddyLoadAttempted:dr},`arena-${o.uid}-${x}`)}catch(M){return console.error("Error rendering ArenaView:",M),d.jsxs("div",{className:"text-white text-center p-8",children:[d.jsx("h2",{className:"text-2xl font-bold mb-4",children:"Error Loading Arena"}),d.jsx("p",{className:"text-gray-300 mb-4",children:M.message}),d.jsx("button",{onClick:()=>window.location.reload(),className:"bg-blue-600 px-4 py-3 rounded hover:bg-blue-700 min-h-[44px]",children:"Reload App"})]})}})()}),t==="craving-support"&&d.jsx("div",{children:d.jsx(Tq,{user:o,nemesis:cs(),onBackToLogin:ll,onResetForTesting:En,behavioralService:B,onBreathingComplete:async M=>{await pe()},setActiveTab:e})}),t==="profile"&&d.jsx("div",{children:d.jsx(Cq,{user:o,onNavigate:Qo})}),t==="mood-selector"&&d.jsx(MoodSelector,{onMoodSelect:Ko,onBack:qm}),t==="settings"&&d.jsx(Dq,{onResetApp:Ho,onBackToLogin:ll,onResetForTesting:En,firestoreBuddyService:b,firestoreBuddyServiceRef:Q,initializeFirestoreBuddyService:De,behavioralService:B,user:o,onShowAnalytics:()=>u(!0)}),l&&d.jsx(mq,{user:o,behavioralService:B,onClose:()=>u(!1)}),d.jsx(xq,{activeTab:n,onTabChange:zh,dataLoadingState:v,onRefreshData:J,offlineManager:ue})]}):d.jsx("div",{className:"flex items-center justify-center min-h-screen text-white",children:d.jsxs("div",{className:"text-center",children:[d.jsx("h2",{className:"text-2xl font-bold mb-4",children:"Loading..."}),d.jsx("p",{className:"text-gray-300",children:h?"User data missing":"Onboarding not completed"}),d.jsxs("p",{className:"text-gray-300",children:["Current view: ",t]}),d.jsxs("p",{className:"text-gray-300",children:["User data: ",o?JSON.stringify(o,null,2):"None"]}),d.jsx("button",{onClick:()=>{console.log("Debug button clicked"),console.log("Current state:",{hasCompletedOnboarding:h,user:o,currentView:t}),console.log("User data:",o)},className:"mt-4 px-4 py-3 bg-blue-600 text-white rounded hover:bg-blue-700 min-h-[44px]",children:"Debug State"})]})})]})};Xy.createRoot(document.getElementById("root")).render(d.jsx(Oq,{}));export{Bq as $,qq as A,Wq as B,Gq as C,Pa as D,Vq as E,PR as F,r8 as G,s8 as H,i8 as I,o8 as J,y4 as K,l8 as L,he as M,jq as N,m4 as O,Fq as P,As as Q,bs as R,m8 as S,j4 as T,p8 as U,Xe as V,Uq as W,$q as X,e8 as Y,Zq as Z,v8 as _,P4 as a,j8 as a$,xP as a0,Kd as a1,oU as a2,jr as a3,C8 as a4,Ys as a5,At as a6,Ur as a7,tl as a8,nl as a9,Yt as aA,bW as aB,it as aC,I8 as aD,TW as aE,EW as aF,T8 as aG,as as aH,Q4 as aI,oi as aJ,Q8 as aK,K8 as aL,F8 as aM,gW as aN,pW as aO,H8 as aP,P8 as aQ,Jr as aR,b8 as aS,nU as aT,fU as aU,SW as aV,yU as aW,fW as aX,L8 as aY,IW as aZ,rp as a_,Dt as aa,W as ab,Js as ac,rU as ad,NU as ae,Un as af,Jc as ag,Ph as ah,sp as ai,km as aj,Dh as ak,Rm as al,kx as am,$r as an,Nm as ao,oo as ap,Ze as aq,RU as ar,xs as as,AU as at,Rw as au,ln as av,Da as aw,re as ax,S8 as ay,V4 as az,Kr as b,Zi as b$,Y8 as b0,N8 as b1,k8 as b2,O8 as b3,xW as b4,W8 as b5,q8 as b6,nn as b7,Oh as b8,_U as b9,Vl as bA,aP as bB,J8 as bC,A8 as bD,hW as bE,ip as bF,mU as bG,vW as bH,x8 as bI,X8 as bJ,z8 as bK,B8 as bL,G8 as bM,M8 as bN,rW as bO,yW as bP,D8 as bQ,Fl as bR,_W as bS,kW as bT,Vh as bU,jh as bV,DW as bW,eh as bX,il as bY,Xi as bZ,AW as b_,oW as ba,gU as bb,Z8 as bc,eW as bd,od as be,tW as bf,nW as bg,sU as bh,wW as bi,mW as bj,R8 as bk,U8 as bl,$8 as bm,JT as bn,aW as bo,cW as bp,lW as bq,iU as br,eb as bs,sW as bt,iW as bu,V8 as bv,hU as bw,uW as bx,dW as by,TU as bz,rw as c,LB as c$,ci as c0,Ri as c1,lp as c2,NW as c3,Ia as c4,Zl as c5,wz as c6,CW as c7,l7 as c8,Bv as c9,JW as cA,zW as cB,U$ as cC,u7 as cD,p7 as cE,y7 as cF,o7 as cG,ZW as cH,nB as cI,LW as cJ,PU as cK,$$ as cL,d7 as cM,f7 as cN,m7 as cO,HU as cP,r7 as cQ,Q$ as cR,z$ as cS,BW as cT,tB as cU,MW as cV,Bx as cW,VW as cX,G$ as cY,qW as cZ,c7 as c_,RW as ca,xz as cb,Zx as cc,eo as cd,UW as ce,rB as cf,a7 as cg,nD as ch,vz as ci,iD as cj,q$ as ck,FW as cl,_$ as cm,W$ as cn,PW as co,s7 as cp,WW as cq,YW as cr,Cz as cs,OW as ct,qU as cu,i7 as cv,_7 as cw,lb as cx,IB as cy,m$ as cz,Us as d,g7 as d0,n7 as d1,jW as d2,t7 as d3,QW as d4,KW as d5,h7 as d6,HW as d7,e7 as d8,XW as d9,GW as da,$W as db,mi as dc,K as dd,js as de,ke as df,Lq as dg,v7 as dh,w7 as di,fc as e,_8 as f,O4 as g,y8 as h,f8 as i,Yq as j,Jq as k,a8 as l,u8 as m,c8 as n,$e as o,D4 as p,d8 as q,MR as r,v1 as s,h8 as t,g8 as u,Iw as v,t8 as w,n8 as x,Hq as y,zq as z};
